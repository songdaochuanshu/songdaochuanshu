---
layout: post
title: 'ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ(ç§»åŠ¨ç«¯ H5 ç½‘ç«™ï¼ˆAPP é£æ ¼ï¼‰åŸºäºSpring Boot åç«¯ + Vue3 - 03'
date: "2025-08-17T00:47:20Z"
---
ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ(ç§»åŠ¨ç«¯ H5 ç½‘ç«™ï¼ˆAPP é£æ ¼ï¼‰åŸºäºSpring Boot åç«¯ + Vue3 - 03
====================================================

ä¼™ä¼´åŒ¹é…ç³»ç»Ÿ(ç§»åŠ¨ç«¯ H5 ç½‘ç«™ï¼ˆAPP é£æ ¼ï¼‰åŸºäºSpring Boot åç«¯ + Vue3 - 03
====================================================

**é¡¹ç›®åœ°å€ï¼š**

*   Githubï¼š[https://github.com/China-Rainbow-sea/yupao](https://github.com/China-Rainbow-sea/yupao)
*   Giteeï¼š[https://gitee.com/Rainbow--Sea/yupao](https://gitee.com/Rainbow--Sea/yupao)

å¼€å‘ç”¨æˆ·ä¿®æ”¹é¡µé¢ï¼šåç«¯
===========

å¼€å‘ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼šåç«¯
===========

to do
=====

æ›´æ–° è„±æ•ï¼Œbean(æ³¨æ„æ²¡æœ‰æ˜ å°„ï¼Œä»¥åŠé€»è¾‘åˆ é™¤æ³¨è§£)ï¼Œä»¥åŠ xml

å‰ç«¯ï¼šæŠ½è±¡é€šç”¨åˆ—è¡¨ç»„ä»¶
===========

æ‰¹é‡å¯¼å…¥æ•°æ® | å¤šç§æ–¹æ¡ˆä»‹ç»å¯¹æ¯”
=================

å°½é‡ä¸è¦ä¸€æ¬¡æ€§ï¼Œå¯¼å…¥å¤ªå¤šæ•°æ®ï¼Œè€Œæ˜¯ä¸€ç‚¹ä¸€ç‚¹çš„åŠ é‡å¯¼å…¥æ•°æ®ã€‚æ¯”å¦‚ï¼š10ï¼Œ100ï¼Œ1000ï¼Œ10000

å¯¼å…¥æ•°æ®
----

1.  ç”¨å¯è§†åŒ–ç•Œé¢ï¼šé€‚åˆä¸€æ¬¡æ€§å¯¼å…¥ï¼Œæ•°æ®é‡å¯æ§ã€‚
2.  å†™ç¨‹åºï¼š for å¾ªç¯ï¼Œå»ºè®®åˆ†æ‰¹ï¼Œä¸è¦ä¸€æŠŠæ¢­å“ˆï¼ˆå¯ä»¥ç”¨æ¥å£æ¥æ§åˆ¶ï¼‰ï¼Œ**è¦ä¿è¯å¯æ§ï¼Œå¹‚ç­‰ï¼Œæ³¨æ„ï¼šçº¿ä¸Šç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒæ˜¯æœ‰åŒºåˆ«çš„**ã€‚

ç¼–å†™ä¸€æ¬¡æ€§ä»»åŠ¡ï¼š
--------

for å¾ªç¯æ’å…¥æ•°æ®çš„é—®é¢˜ï¼š

1.  å»ºç«‹å’Œé‡Šæ”¾æ•°æ®è¿æ¥ï¼š
2.  for å¾ªç¯æ˜¯ç»å¯¹çº¿æ€§çš„ï¼šï¼ˆå¹¶å‘ï¼‰

**è¡¥å……ï¼š**Spring å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œ`@EnableScheduling // å¯åŠ¨å®šæ—¶ä»»åŠ¡`

    @EnableScheduling // å¯åŠ¨å®šæ—¶ä»»åŠ¡
    

    package com.rainbowsea.yupao;
    
    
    import org.mybatis.spring.annotation.MapperScan;
    import org.springframework.boot.SpringApplication;
    import org.springframework.boot.autoconfigure.SpringBootApplication;
    import org.springframework.scheduling.annotation.EnableScheduling;
    
    @SpringBootApplication
    @MapperScan("com.rainbowsea.yupao.mapper")
    @EnableScheduling // å¯åŠ¨å®šæ—¶ä»»åŠ¡
    public class YuPaoApplication {
    
        public static void main(String[] args) {
            SpringApplication.run(YuPaoApplication.class, args);
        }
    }
    
    

**å¹¶å‘ç¼–ç¨‹ï¼ˆå¤šçº¿ç¨‹æ± ï¼‰**

å¹¶å‘è¦æ³¨æ„æ‰§è¡Œçš„å…ˆåé¡ºåºæ— æ‰€è°“ï¼Œä¸è¦ç”¨åˆ°éå¹¶å‘ç±»çš„é›†åˆï¼ˆeg: ä¸è¦ç”¨ List é»˜è®¤æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼‰ï¼Œè¦è½¬æˆçº¿ç¨‹å®‰å…¨çš„é›†åˆã€‚

**for å¾ªç¯æ’å…¥æ•°æ®çš„ç‰¹ç‚¹ï¼š**

1.  é¢‘ç¹å»ºç«‹å’Œé‡Šæ”¾æ•°æ®åº“è¿æ¥ï¼ˆç”¨æ‰¹é‡æŸ¥è¯¢è§£å†³ï¼‰
2.  for å¾ªç¯æ˜¯ç»å¯¹çº¿æ€§çš„(å¯ä»¥å¹¶å‘æé€Ÿ)

ä½¿ç”¨ç®€å•çš„ for å¾ªç¯è¿›è¡Œä¸€ä¸ªå¹¶å‘æé€Ÿæ’å…¥ï¼Œæ‰¹é‡å…ƒç´ å†…å®¹ã€‚

    package com.rainbowsea.yupao.one;
    
    
    import com.rainbowsea.yupao.mapper.UserMapper;
    import com.rainbowsea.yupao.model.User;
    import com.rainbowsea.yupao.service.UserService;
    
    import org.junit.Test;
    import org.junit.runner.RunWith;
    import org.springframework.stereotype.Component;
    import org.springframework.test.context.junit4.SpringRunner;
    import org.springframework.util.StopWatch;
    
    import javax.annotation.Resource;
    import java.util.ArrayList;
    
    @Component
    @RunWith(SpringRunner.class)
    public class InsertUsers {
    
    
        @Resource
        private UserService userService;
    
    
        /**
         * æ‰¹é‡æ’å…¥ç”¨æˆ·
         */
        // @Scheduled(fixedDelay = 5000, fixedRate = Long.MAX_VALUE)
        @Test
        public void doInsertUsers() {
    
            StopWatch stopWatch = new StopWatch();  // ç›‘è§†æŸ¥çœ‹å†…å®¹ä¿¡æ¯
            stopWatch.start();  // å¼€å§‹æ—¶é—´ç‚¹
    
            ArrayList<User> userList = new ArrayList<>(); // ArrayList<>() æ”¯æŒå¹¶å‘ï¼Œä¸å­˜åœ¨å¤šå¹¶å‘é—®é¢˜
            final int INSERT_NUM = 100000;  // shift + ctrl + u åˆ‡æ¢ä¸ºå¤§å†™
            for (int i = 0; i < INSERT_NUM; i++) {
                User user = new User();
                user.setUsername("å‡é±¼çš®");
                user.setUserAccount("fakeuyupi");
                user.setAvatarUrl("https://profile-avatar.csdnimg.cn/2f8ef0ed68a647bcad04088152e00c69_weixin_61635597.jpg!1");
                user.setGender(0);
                user.setUserPassword("12345678");
                user.setPhone("123");
                user.setEmail("123@qq.com");
                user.setTags("[]");
                user.setUserStatus(0);
                user.setIsDelete(0);
                user.setPlanetCode("1111111");
    
                userList.add(user);
            }
    
    
            userService.saveBatch(userList, 1000);
            stopWatch.stop(); // ç»“æŸæ—¶é—´ç‚¹
            System.out.println(stopWatch.getTotalTimeMillis()); // æ‰“å°æ˜¾ç¤ºæç¤ºä¿¡æ¯
    
    
        }
    }
    
    

**ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼Œå®Œæˆå¹¶å‘å¤„ç†**

    package com.rainbowsea.yupao.one;
    
    
    import com.rainbowsea.yupao.mapper.UserMapper;
    import com.rainbowsea.yupao.model.User;
    import com.rainbowsea.yupao.service.UserService;
    
    import org.junit.Test;
    import org.junit.runner.RunWith;
    import org.springframework.stereotype.Component;
    import org.springframework.test.context.junit4.SpringRunner;
    import org.springframework.util.StopWatch;
    
    import javax.annotation.Resource;
    import java.util.ArrayList;
    
    @Component
    @RunWith(SpringRunner.class)
    public class InsertUsers {
    
    
        @Resource
        private UserService userService;
    
    
        /**
         * æ‰¹é‡æ’å…¥ç”¨æˆ·
         */
        @Scheduled(fixedDelay = 5000, fixedRate = Long.MAX_VALUE)// æ³¨æ„ä¸»å¯åŠ¨ç±»ä¸Šè¦åŠ ä¸Šï¼Œ@EnableScheduling // å¯åŠ¨å®šæ—¶ä»»åŠ¡
        // @Test
        public void doInsertUsers() {
    
            StopWatch stopWatch = new StopWatch();  // ç›‘è§†æŸ¥çœ‹å†…å®¹ä¿¡æ¯
            stopWatch.start();  // å¼€å§‹æ—¶é—´ç‚¹
    
            ArrayList<User> userList = new ArrayList<>();
            final int INSERT_NUM = 100000;  // shift + ctrl + u åˆ‡æ¢ä¸ºå¤§å†™
            for (int i = 0; i < INSERT_NUM; i++) {
                User user = new User();
                user.setUsername("å‡é±¼çš®");
                user.setUserAccount("fakeuyupi");
                user.setAvatarUrl("https://profile-avatar.csdnimg.cn/2f8ef0ed68a647bcad04088152e00c69_weixin_61635597.jpg!1");
                user.setGender(0);
                user.setUserPassword("12345678");
                user.setPhone("123");
                user.setEmail("123@qq.com");
                user.setTags("[]");
                user.setUserStatus(0);
                user.setIsDelete(0);
                user.setPlanetCode("1111111");
    
                userList.add(user);
            }
    
    
            userService.saveBatch(userList, 1000);
            stopWatch.stop(); // ç»“æŸæ—¶é—´ç‚¹
            System.out.println(stopWatch.getTotalTimeMillis()); // æ‰“å°æ˜¾ç¤ºæç¤ºä¿¡æ¯
    
    
        }
    }
    
    

* * *

**é‡‡ç”¨å¼‚æ­¥æ‰§è¡Œï¼Œå¹¶å‘æ‰§è¡Œçš„æ–¹å¼**

    package com.rainbowsea.yupao.one;
    
    
    import com.rainbowsea.yupao.mapper.UserMapper;
    import com.rainbowsea.yupao.model.User;
    import com.rainbowsea.yupao.service.UserService;
    
    import org.junit.Test;
    import org.junit.runner.RunWith;
    import org.springframework.stereotype.Component;
    import org.springframework.test.context.junit4.SpringRunner;
    import org.springframework.util.StopWatch;
    
    import javax.annotation.Resource;
    import java.util.ArrayList;
    import java.util.List;
    import java.util.concurrent.CompletableFuture;
    
    @Component
    @RunWith(SpringRunner.class)
    public class InsertUsers {
    
    
        @Resource
        private UserService userService;
    
    
        /**
         * æ‰¹é‡æ’å…¥ç”¨æˆ·
         */
        // @Scheduled(fixedDelay = 5000, fixedRate = Long.MAX_VALUE)
        @Test
        public void doInsertUsers() {
    
            StopWatch stopWatch = new StopWatch();  // ç›‘è§†æŸ¥çœ‹å†…å®¹ä¿¡æ¯
            stopWatch.start();  // å¼€å§‹æ—¶é—´ç‚¹
    
            final int INSERT_NUM = 100000;  // shift + ctrl + u åˆ‡æ¢ä¸ºå¤§å†™
    
            List<CompletableFuture<Void>> futureList = new ArrayList<>();  // åˆ—è¡¨
    
            // åˆ† 10 ç»„
            int j = 0;
            for (int i = 0; i < INSERT_NUM; i++) {
                List<User> userList = new ArrayList<>();
                while (true) {
                    j++;
    
                    User user = new User();
                    user.setUsername("å‡é±¼çš®");
                    user.setUserAccount("fakeuyupi");
                    user.setAvatarUrl("https://profile-avatar.csdnimg.cn/2f8ef0ed68a647bcad04088152e00c69_weixin_61635597.jpg!1");
                    user.setGender(0);
                    user.setUserPassword("12345678");
                    user.setPhone("123");
                    user.setEmail("123@qq.com");
                    user.setTags("[]");
                    user.setUserStatus(0);
                    user.setIsDelete(0);
                    user.setPlanetCode("1111111");
    
                    userList.add(user);
    
                    if(j % 10000 == 0) {
                        break;
                    }
                }
    
                // å¼‚æ­¥æ‰§è¡Œ
                CompletableFuture<Void> future = CompletableFuture.runAsync(() -> {
                    System.out.println("threadName:" + Thread.currentThread().getName());
                    userService.saveBatch(userList, 1000);
                });
    
                futureList.add(future);
    
            }
    
            CompletableFuture.allOf(futureList.toArray(new CompletableFuture[]{})).join();
    
    
            stopWatch.stop(); // ç»“æŸæ—¶é—´ç‚¹
            System.out.println(stopWatch.getTotalTimeMillis()); // æ‰“å°æ˜¾ç¤ºæç¤ºä¿¡æ¯
    
    
        }
    }
    
    

* * *

**æ³¨æ„ï¼š**ä½¿ç”¨å¹¶å‘æ—¶è¦æ³¨æ„æ•°æ®çš„æ’å…¥å…ˆåé¡ºåºæ˜¯å¦æ— æ‰€è°“ã€‚

å¹¶å‘æ—¶ä¸è¦ç”¨åˆ°éå¹¶å‘ç±»çš„é›†åˆã€‚

å»ºç«‹æ‰§è¡Œå™¨ï¼ˆçº¿ç¨‹æ± ï¼‰ï¼Œè‡ªå·±åˆ›å»ºçº¿ç¨‹æ± ï¼Œè¿›è¡Œä¸€ä¸ªè·å–è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹æ± ï¼Œæ‰§è¡Œå¹¶å‘ï¼Œè·å–çº¿ç¨‹æ± è¿æ¥ã€‚

    private ExecutorService executorService = new ThreadPoolExecutor(16, 1000, 10000, TimeUnit.MINUTES, new ArrayBlockingQueue<>(10000));
    
    

    package com.rainbowsea.yupao.one;
    
    
    import com.rainbowsea.yupao.mapper.UserMapper;
    import com.rainbowsea.yupao.model.User;
    import com.rainbowsea.yupao.service.UserService;
    
    import org.apache.tomcat.util.threads.ThreadPoolExecutor;
    import org.junit.Test;
    import org.junit.runner.RunWith;
    import org.springframework.stereotype.Component;
    import org.springframework.test.context.junit4.SpringRunner;
    import org.springframework.util.StopWatch;
    
    import javax.annotation.Resource;
    import java.util.ArrayList;
    import java.util.List;
    import java.util.concurrent.ArrayBlockingQueue;
    import java.util.concurrent.CompletableFuture;
    import java.util.concurrent.ExecutorService;
    import java.util.concurrent.TimeUnit;
    
    @Component
    @RunWith(SpringRunner.class)
    public class InsertUsers {
    
    
        @Resource
        private UserService userService;
    
        // CPU å¯†é›†å‹,åˆ†é…çš„æ ¸å¿ƒçº¿ç¨‹æ•° = CPU -1
        // IO å¯†é›†å‹ï¼Œåˆ†é…çš„æ ¸å¿ƒçº¿ç¨‹æ•°å¯ä»¥å¤§äº CPU æ ¸æ•°
        private ExecutorService executorService = new ThreadPoolExecutor(16, 1000, 10000, TimeUnit.MINUTES, new ArrayBlockingQueue<>(10000));
    
        /**
         * æ‰¹é‡æ’å…¥ç”¨æˆ·
         */
        // @Scheduled(fixedDelay = 5000, fixedRate = Long.MAX_VALUE)
        @Test
        public void doInsertUsers() {
    
            StopWatch stopWatch = new StopWatch();  // ç›‘è§†æŸ¥çœ‹å†…å®¹ä¿¡æ¯
            stopWatch.start();  // å¼€å§‹æ—¶é—´ç‚¹
    
            final int INSERT_NUM = 100000;  // shift + ctrl + u åˆ‡æ¢ä¸ºå¤§å†™
    
            List<CompletableFuture<Void>> futureList = new ArrayList<>();  // åˆ—è¡¨
    
            // åˆ† 10 ç»„
            int j = 0;
            for (int i = 0; i < INSERT_NUM; i++) {
                List<User> userList = new ArrayList<>();
                while (true) {
                    j++;
    
                    User user = new User();
                    user.setUsername("å‡é±¼çš®");
                    user.setUserAccount("fakeuyupi");
                    user.setAvatarUrl("https://profile-avatar.csdnimg.cn/2f8ef0ed68a647bcad04088152e00c69_weixin_61635597.jpg!1");
                    user.setGender(0);
                    user.setUserPassword("12345678");
                    user.setPhone("123");
                    user.setEmail("123@qq.com");
                    user.setTags("[]");
                    user.setUserStatus(0);
                    user.setIsDelete(0);
                    user.setPlanetCode("1111111");
    
                    userList.add(user);
    
                    if(j % 10000 == 0) {
                        break;
                    }
                }
    
                // å¼‚æ­¥æ‰§è¡Œ
                CompletableFuture<Void> future = CompletableFuture.runAsync(() -> {
                    System.out.println("threadName:" + Thread.currentThread().getName());
                    userService.saveBatch(userList, 1000);
                },executorService);
    
                futureList.add(future);
    
            }
    
            CompletableFuture.allOf(futureList.toArray(new CompletableFuture[]{})).join();
    
    
            stopWatch.stop(); // ç»“æŸæ—¶é—´ç‚¹
            System.out.println(stopWatch.getTotalTimeMillis()); // æ‰“å°æ˜¾ç¤ºæç¤ºä¿¡æ¯
    
    
        }
    }
    
    

è¿æ¥æ± å‚æ•°è®¾ç½®ï¼š

    // CPU å¯†é›†å‹ï¼šåˆ†é…çš„æ ¸å¿ƒçº¿ç¨‹æ•° = CPU - 1
    // IO å¯†é›†å‹ï¼šåˆ†é…çš„æ ¸å¿ƒçº¿ç¨‹æ•°å¯ä»¥å¤§äº CPU æ ¸æ•°
    
    

é¡µé¢åŠ è½½å¤ªæ…¢
======

*   ä¼˜åŒ–ï¼šæ•°æ®åº“æ…¢ï¼Œç”¨æˆ·ä¸ç™»å½•ï¼Œç”¨æˆ·æŸ¥çœ‹çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œæ—¢ç„¶æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦é‡å¤æŸ¥å¤šæ¬¡äº†ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥é¢„å…ˆæŠŠæ•°æ®æŸ¥å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªæ›´å¿«è¯»å–çš„åœ°æ–¹ï¼Œä¸ç”¨å†æŸ¥æ•°æ®åº“äº†ã€‚ç¼“å­˜ã€‚ä¸ºäº†é˜²æ­¢ç¬¬ä¸€ä¸ªç”¨æˆ·ï¼ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œæ²¡æœ‰èµ°ç¼“å­˜â€”â€”>é¢„åŠ è½½ç¼“å­˜ï¼Œå®šæ—¶æ›´æ–°ç¼“å­˜ã€‚ï¼ˆå¯ä»¥é‡‡ç”¨å®šæ—¶ä»»åŠ¡ï¼‰
*   å¤šä¸ªæœºå™¨éƒ½è¦æ‰§è¡Œä»»åŠ¡å‘¢ï¼Ÿï¼ˆåˆ†å¸ƒå¼é”ï¼šæ§åˆ¶åŒä¸€æ—¶é—´åªæœ‰ä¸€å°æœºå™¨å»æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼Œå…¶ä»–æœºå™¨ä¸ç”¨é‡å¤æ‰§è¡Œäº†ï¼‰
*   æ¯”è¾ƒæ…¢çš„åœ°æ–¹ï¼Œå¯ä»¥æƒ³æƒ³å¯ä¸å¯ä»¥å¤ç”¨ï¼Œå‡å°‘æ…¢çš„æ¬¡æ•°ã€‚

**å¤šä¸ªæ•°æ®ï¼Œå‰ç«¯æ˜¾ç¤ºï¼Œè¿›è¡Œåˆ†é¡µå¤„ç†ï¼Œå¦‚æœä¸€ä¸‹å­å°† 10W ä¸ªæ•°æ®ä¿¡æ¯ç»™å‰ç«¯è¿›è¡Œæ¸²æŸ“ï¼Œå‰ç«¯æ˜¯æ— æ³•æ¸²æŸ“å¤„ç†çš„ï¼Œæ˜¯ä¼šç›´æ¥æŠ¥é”™å¤„ç†çš„ï¼Œæ‰€ä»¥è¿™é‡Œè¿›è¡Œä¸€ä¸ª MyBatis-Plus çš„ä¸€ä¸ªåˆ†é¡µæ’ä»¶è¿›è¡Œå¤„ç†ï¼Œè¿è¡Œè§‚å¯Ÿæ‰§è¡Œçš„ SQL æ—¥å¿—ï¼Œå¹¶ä¸æ˜¯ç›´æ¥ä¸€æ¬¡æ€§å°† 10W / æ‰€æœ‰æ•°æ®æŸ¥è¯¢å‡ºæ¥ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢ï¼ŒæŸ¥è¯¢å…¶ä¸­æ‰€éœ€çš„ä¸€éƒ¨åˆ†ï¼Œå‘é€ç»™å‰ç«¯ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ï¼ŒåŒæ—¶é¿å…å‰ç«¯æ¥æ”¶è¿‡å¤šæ•°æ®ï¼Œæ¸²æŸ“åŠ è½½æ•°æ®å¤±è´¥ã€‚**

      /**
         * é¦–é¡µ recommend æ¨èæ˜¾ç¤ºå†…å®¹ï¼ŒåŒæ—¶è¿›è¡Œäº†åˆ†é¡µå¤„ç†
         *
         * @param request
         * @return
         */
        @GetMapping("/recommend")
        public BaseResponse<Page<User>> recommendUsers(long pageSize, long pageNum,HttpServletRequest request) {
            QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    
            Page<User> userList = userService.page(new Page<>(pageNum, pageSize), queryWrapper);
    
            //List<User> userList = userService.list(queryWrapper);
            //List<User> list = userList.stream().
            //        map(user -> userService.getSafetyUser(user)).
            //        collect(Collectors.toList());
    
            return ResultUtils.success(userList);
        }
    
    
    

åŒæ—¶éœ€è¦åœ¨ åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ Java é…ç½®æ¥æ·»åŠ åˆ†é¡µæ’ä»¶ï¼š

    @Configuration
    @MapperScan("scan.your.mapper.package")
    public class MybatisPlusConfig {
    
        /**
         * æ·»åŠ åˆ†é¡µæ’ä»¶
         */
        @Bean
        public MybatisPlusInterceptor mybatisPlusInterceptor() {
            MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
            interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL)); // å¦‚æœé…ç½®å¤šä¸ªæ’ä»¶, åˆ‡è®°åˆ†é¡µæœ€åæ·»åŠ 
            // å¦‚æœæœ‰å¤šæ•°æ®æºå¯ä»¥ä¸é…å…·ä½“ç±»å‹, å¦åˆ™éƒ½å»ºè®®é…ä¸Šå…·ä½“çš„ DbType
            return interceptor;
        }
    }
    

å‰ç«¯æ·»åŠ ä¸Šç›¸å…³ï¼Œåˆ†é¡µæºå¸¦çš„æ•°æ®ä¿¡æ¯ï¼š

    <template>
    
      <user-card-list :user-list="userList"/>
    <!--  <van-card-->
    <!--      v-for="user in userList"-->
    <!--      :desc="user.prfile"-->
    <!--      :title="`${user.username} (${user.planetCode}})`"-->
    <!--      :thumb="user.avatarUrl"-->
    
    <!--  >-->
    <!--    <template #tags>-->
    <!--      <van-tag plain type="danger" v-for="tag in user.tags" style="margin-right: 8px; margin-top: 8px">-->
    <!--        {{tag}}-->
    <!--      </van-tag>-->
    <!--    </template>-->
    <!--    <template #footer>-->
    <!--      <van-button size="mini">è”ç³»æˆ‘</van-button>-->
    <!--    </template>-->
    <!--  </van-card>-->
      <!-- æœç´¢æç¤º -->
      <van-empty v-if="!userList || userList.length < 1" description="æ•°æ®ä¸ºç©º"/>
    </template>
    
    <script setup>
    import {onMounted, ref} from 'vue';
    import {useRoute} from "vue-router";
    import myAxios from "../plugins/myAxios";
    import {Toast} from "vant";
    import UserCardList from "../components/UserCardList.vue";
    
    const route = useRoute();
    const {tags} = route.query;
    
    const userList = ref([]);
    
    onMounted(async () => {
      const userListData = await myAxios.get('/user/recommend', {
        params: {
          pageSize: 8,
          pageNum: 1,
        },
      })
          .then(function (response) {
            console.log('/user/recommend  succeed', response);
            Toast.success("è¯·æ±‚æˆåŠŸ")
            return response?.data?.records;
          })
          .catch(function (error) {
            console.error('/user/recommend  error', error);
            Toast.fail('è¯·æ±‚å¤±è´¥')
          })
      console.log("æ•°æ®æ•°æ®:", userListData)
      if (userListData) {
        userListData.forEach(user => {
          if (user.tags) {
            user.tags = JSON.parse(user.tags);
          }
        })
        userList.value = userListData;
      }
    })
    
    
    
    </script>
    
    <style scoped>
    
    </style>
    
    

**è¿è¡Œè§‚å¯Ÿæ‰§è¡Œçš„ SQL æ—¥å¿—ï¼Œå¹¶ä¸æ˜¯ç›´æ¥ä¸€æ¬¡æ€§å°† 10W / æ‰€æœ‰æ•°æ®æŸ¥è¯¢å‡ºæ¥ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢ï¼ŒæŸ¥è¯¢å…¶ä¸­æ‰€éœ€çš„ä¸€éƒ¨åˆ†ï¼Œå‘é€ç»™å‰ç«¯ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ï¼ŒåŒæ—¶é¿å…å‰ç«¯æ¥æ”¶è¿‡å¤šæ•°æ®ï¼Œæ¸²æŸ“åŠ è½½æ•°æ®å¤±è´¥ã€‚**

1.  é¦–å…ˆï¼Œæ¨¡æ‹Ÿæ’å…¥ 50W æ¡æ•°æ®ï¼Œæµ‹è¯•ã€‚è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç”¨äºæµ‹è¯•çš„æ•°æ®åº“åä¸º "usercentertest"

    create table tag
    (
        id         bigint auto_increment comment 'id'
            primary key,
        tagName    varchar(256)                       null comment 'æ ‡ç­¾åç§°',
        userId     bigint                             null comment 'ç”¨æˆ·id',
        parenId    bigint                             null comment 'çˆ¶æ ‡ç­¾ id',
        isParent   tinyint                            null comment '0 - ä¸æ˜¯, 1- çˆ¶æ ‡ç­¾',
        createTime datetime default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
        updateTime datetime default CURRENT_TIMESTAMP null comment 'æ›´æ–°æ—¶é—´',
        isDelete   tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤ 0 1ï¼ˆé€»è¾‘åˆ é™¤ï¼‰',
        constraint uniIdx_tagName
            unique (tagName)
    )
        comment 'æ ‡ç­¾';
    
    create index idx_userId
        on tag (userId);
    
    create table user
    (
        username     varchar(256)                       null comment 'ç”¨æˆ·æ˜µç§°',
        id           bigint auto_increment comment 'id'
            primary key,
        userAccount  varchar(256)                       null comment 'è´¦å·',
        avatarUrl    varchar(1024)                      null comment 'ç”¨æˆ·å¤´åƒ',
        gender       tinyint                            null comment 'æ€§åˆ«',
        userPassword varchar(512)                       not null comment 'å¯†ç ',
        phone        varchar(128)                       null comment 'ç”µè¯',
        email        varchar(512)                       null comment 'é‚®ç®±',
        userStatus   int      default 0                 not null comment 'çŠ¶æ€-0-æ­£å¸¸',
        createTime   datetime default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
        updateTime   datetime default CURRENT_TIMESTAMP null comment 'æ›´æ–°æ—¶é—´',
        isDelete     tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤ 0 1ï¼ˆé€»è¾‘åˆ é™¤ï¼‰',
        userRole     int      default 0                 not null comment 'ç”¨æˆ·è§’è‰² 0- æ™®é€šç”¨æˆ· 1 - ç®¡ç†å‘˜ 2 - vip',
        planetCode   varchar(512)                       null comment 'ç”¨æˆ·çš„ç¼–å·',
        tags         varchar(1024)                      null comment 'æ ‡ç­¾åˆ—è¡¨ json',
        profile      varchar(512)                       null comment 'ä¸ªäººç®€ä»‹'
    )
        comment 'ç”¨æˆ·';
    
    
    

è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨ for æ‰¹é‡æ’å…¥ 50W æ¡æ•°æ®ï¼Œæ³¨æ„ï¼šå¯¹äºè¿™ç§å¤§æ•°æ®æ’å…¥çš„æµ‹è¯•ï¼Œå¿…é¡»åˆ†ç»„ï¼Œåˆ†æ‰¹è¿›è¡Œï¼Œé˜²æ­¢æ’å…¥æ—¶ä¸­é—´å‘ç”ŸæŠ¥é”™å¤„ç†ã€‚

    package com.yupi.yupao.once.importuser;
    
    import com.yupi.yupao.mapper.UserMapper;
    import com.yupi.yupao.model.domain.User;
    import org.springframework.stereotype.Component;
    import org.springframework.util.StopWatch;
    
    import javax.annotation.Resource;
    
    /**
     * å¯¼å…¥ç”¨æˆ·ä»»åŠ¡
     *
     * @author <a href="https://github.com/liyupi">ç¨‹åºå‘˜é±¼çš®</a>
     * @from <a href="https://yupi.icu">ç¼–ç¨‹å¯¼èˆªçŸ¥è¯†æ˜Ÿçƒ</a>
     */
    @Component
    public class InsertUsers {
    
        @Resource
        private UserMapper userMapper;
    
        /**
         * æ‰¹é‡æ’å…¥ç”¨æˆ·
         */
    //    @Scheduled(initialDelay = 5000, fixedRate = Long.MAX_VALUE)
        public void doInsertUsers() {
            StopWatch stopWatch = new StopWatch();
            System.out.println("goodgoodgood");
            stopWatch.start();
            final int INSERT_NUM = 1000;
            for (int i = 0; i < INSERT_NUM; i++) {
                User user = new User();
                user.setUsername("å‡é±¼çš®");
                user.setUserAccount("fakeyupi");
                user.setAvatarUrl("https://636f-codenav-8grj8px727565176-1256524210.tcb.qcloud.la/img/logo.png");
                user.setGender(0);
                user.setUserPassword("12345678");
                user.setPhone("123");
                user.setEmail("123@qq.com");
                user.setTags("[]");
                user.setUserStatus(0);
                user.setUserRole(0);
                user.setPlanetCode("11111111");
                userMapper.insert(user);
            }
            stopWatch.stop();
            System.out.println(stopWatch.getTotalTimeMillis());
        }
    }
    
    

    package com.yupi.yupao.service;
    
    import com.yupi.yupao.model.domain.User;
    import org.junit.jupiter.api.Test;
    import org.springframework.boot.test.context.SpringBootTest;
    import org.springframework.util.StopWatch;
    
    import javax.annotation.Resource;
    import java.util.ArrayList;
    import java.util.List;
    import java.util.concurrent.*;
    
    /**
     * å¯¼å…¥ç”¨æˆ·æµ‹è¯•
     *
     * @author <a href="https://github.com/liyupi">ç¨‹åºå‘˜é±¼çš®</a>
     * @from <a href="https://yupi.icu">ç¼–ç¨‹å¯¼èˆªçŸ¥è¯†æ˜Ÿçƒ</a>
     */
    @SpringBootTest
    public class InsertUsersTest {
    
        @Resource
        private UserService userService;
    
        private ExecutorService executorService = new ThreadPoolExecutor(40, 1000, 10000, TimeUnit.MINUTES, new ArrayBlockingQueue<>(10000));
    
        /**
         * æ‰¹é‡æ’å…¥ç”¨æˆ·
         */
        @Test
        public void doInsertUsers() {
            StopWatch stopWatch = new StopWatch();
            stopWatch.start();
            final int INSERT_NUM = 100000;
            List<User> userList = new ArrayList<>();
            for (int i = 0; i < INSERT_NUM; i++) {
                User user = new User();
                user.setUsername("åŸ_åˆ› ã€é±¼_çš®ã€‘https://t.zsxq.com/0emozsIJh");
                user.setUserAccount("fakeyupi");
                user.setAvatarUrl("https://636f-codenav-8grj8px727565176-1256524210.tcb.qcloud.la/img/logo.png");
                user.setGender(0);
                user.setUserPassword("12345678");
                user.setPhone("123");
                user.setEmail("123@qq.com");
                user.setTags("[]");
                user.setUserStatus(0);
                user.setUserRole(0);
                user.setPlanetCode("11111111");
                userList.add(user);
            }
            // 20 ç§’ 10 ä¸‡æ¡
            userService.saveBatch(userList, 10000);
            stopWatch.stop();
            System.out.println(stopWatch.getTotalTimeMillis());
        }
    
        /**
         * å¹¶å‘æ‰¹é‡æ’å…¥ç”¨æˆ·
         */
        @Test
        public void doConcurrencyInsertUsers() {
            StopWatch stopWatch = new StopWatch();
            stopWatch.start();
            // åˆ†åç»„
            int batchSize = 5000;
            int j = 0;
            List<CompletableFuture<Void>> futureList = new ArrayList<>();
            for (int i = 0; i < 100; i++) {
                List<User> userList = new ArrayList<>();
                while (true) {
                    j++;
                    User user = new User();
                    user.setUsername("å‡é±¼çš®");
                    user.setUserAccount("fakeyupi");
                    user.setAvatarUrl("https://636f-codenav-8grj8px727565176-1256524210.tcb.qcloud.la/img/logo.png");
                    user.setGender(0);
                    user.setUserPassword("12345678");
                    user.setPhone("123");
                    user.setEmail("123@qq.com");
                    user.setTags("[]");
                    user.setUserStatus(0);
                    user.setUserRole(0);
                    user.setPlanetCode("11111111");
                    userList.add(user);
                    if (j % batchSize == 0) {
                        break;
                    }
                }
                // å¼‚æ­¥æ‰§è¡Œ
                CompletableFuture<Void> future = CompletableFuture.runAsync(() -> {
                    System.out.println("threadName: " + Thread.currentThread().getName());
                    userService.saveBatch(userList, batchSize);
                }, executorService);
                futureList.add(future);
            }
            CompletableFuture.allOf(futureList.toArray(new CompletableFuture[]{})).join();
            // 20 ç§’ 10 ä¸‡æ¡
            stopWatch.stop();
            System.out.println(stopWatch.getTotalTimeMillis());
        }
    }
    
    

è®¿é—®å‰ç«¯ï¼ŒæŸ¥çœ‹å‰ç«¯æ˜¯å¦ä¼šå› ä¸º 50 W æ•°æ®ï¼Œæ¸²æŸ“åŠ è½½å¤±è´¥ã€‚

è¿™é‡Œæœªä½¿ç”¨ MyBatis-Plus è¿›è¡Œåˆ†é¡µæŸ¥è¯¢ï¼Œå‰ç«¯æ¸²æŸ“å¤±è´¥ã€‚

* * *

**ä½¿ç”¨äº† MyBatis-Plus åˆ†é¡µæ’ä»¶ï¼Œæµ‹è¯•çš„æ•ˆæœ**

å…³äºï¼šé¡µé¢åŠ è½½å¤ªæ…¢çš„é—®é¢˜ï¼Œå¦‚ä¸‹ï¼šä½¿ç”¨ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ç­–ç•¥ï¼Œè§£å†³ã€‚

ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜
========

æ•°æ®æŸ¥è¯¢æ…¢æ€ä¹ˆåŠï¼Ÿ
---------

1.  ç”¨ç¼“å­˜ï¼šæå‰æŠŠæ•°æ®å–å‡ºæ¥ä¿å­˜å¥½(é€šå¸¸ä¿å­˜åˆ°è¯»å†™æ›´å¿«çš„ä»‹è´¨ï¼Œeg å†…å­˜)ï¼Œå°±å¯ä»¥æ›´å¿«åœ°è¯»å†™ã€‚

> ç¼“å­˜ï¼š
> 
> *   Redisï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰
> *   memcached(åˆ†å¸ƒå¼)
> *   Etcd( äº‘åŸç”Ÿæ¶æ„çš„ä¸€ä¸ªåˆ†å¸ƒå¼å­˜å‚¨ï¼Œ**å­˜å‚¨é…ç½®**ï¼Œæ‰©å®¹èƒ½åŠ›)
> 
> è¿›ç¨‹(å•æœº)ç¼“å­˜
> 
> *   ehcache
> *   Java å†…å­˜é›†åˆï¼Œå¦‚ HashMap
> *   Caffeine ( Java å†…å­˜ç¼“å­˜æ€§èƒ½ä¹‹ç‹ï¼Œé«˜æ€§èƒ½)
> *   Google Guava

2.  åˆ†åº“åˆ†è¡¨
3.  æå‰æŸ¥è¯¢

Java æ“ä½œ Redis
=============

Spriing Data Redis(æ¨è)
----------------------

åœ°å€ï¼š[https://mvnrepository.com/artifact/org.springframework.data/spring-data-redis](https://mvnrepository.com/artifact/org.springframework.data/spring-data-redis)

Spring Data : é€šç”¨çš„æ•°æ®è®¿é—®æ¡†æ¶ï¼Œå®šä¹‰äº†ä¸€ç»„ **å¢åˆ æ”¹æŸ¥**çš„æ¥å£ã€‚

è¿˜å¯ä»¥æ“ä½œï¼šMySQLï¼ŒRedisï¼ŒJPA

ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

1.  å¼•å…¥

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
        <version>2.6.4</version>
    </dependency>
    
    

ä¹Ÿå¯ä»¥æ·»åŠ ä¸Šï¼šLettuceæ˜¯ä¸€ä¸ªé«˜çº§rediså®¢æˆ·ç«¯ï¼Œæ”¯æŒé«˜çº§çš„redisç‰¹æ€§ï¼Œæ¯”å¦‚Sentinelã€é›†ç¾¤ã€æµæ°´çº¿ã€è‡ªåŠ¨é‡æ–°è¿æ¥å’Œredisæ•°æ®

    <!-- https://mvnrepository.com/artifact/io.lettuce/lettuce-core -->
    <dependency>
        <groupId>io.lettuce</groupId>
        <artifactId>lettuce-core</artifactId>
        <version>6.1.6.RELEASE</version>
    </dependency>
    

2.  é…ç½® Redis åœ°å€

    spring:
      # redis é…ç½®
      redis:
        port: 6379
        host: localhost
        database: 0 # æ˜¾å¼ä½¿ç”¨çš„æ˜¯ Redis 0 å·æ•°æ®åº“
    
    

**Redis æ•°æ®ç»“æ„ï¼š**

1.  String å­—ç¬¦ä¸²ç±»å‹ï¼šname:"yupi"
2.  List åˆ—è¡¨ï¼šnames:\["yupi","dogyupi"\]ã€‚ List å’Œ æ•°ç»„çš„åŒºåˆ«ã€‚æ•°ç»„çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œè€Œ List å¤§å°æ˜¯åŠ¨æ€çš„
3.  Set é›†åˆï¼šnames:\["yupi","dogyupi"\]ï¼ˆå€¼ä¸é‡å¤ï¼‰
4.  Hash å“ˆå¸Œï¼šnameAge:
5.  Zset é›†åˆï¼šnames: '{yupi - 9ï¼Œdogyupi - 12 }' é€‚åˆæ’è¡Œæ¦œ

**é«˜çº§ï¼š**

*   bloomfilter (å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä¸»è¦ä»å¤§é‡çš„æ•°æ®ä¸­å¿«é€Ÿè¿‡æ»¤å€¼ï¼Œæ¯”å¦‚é‚®ä»¶é»‘åå•æ‹¦æˆª)
*   geo(è®¡ç®—åœ°ç†ä½ç½®)
*   hyperloglog ï¼ˆpv / uvï¼‰
*   pub / sub(å‘å¸ƒè®¢é˜…ï¼Œç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—)
*   BitMap (100101010101010101010101)

> **å¼•å…¥ä¸€ä¸ªæ–°åº“æ—¶ï¼Œè®°å¾—å…ˆå†™æµ‹è¯•ç±»**ã€‚

**æµ‹è¯•ï¼šä½¿ç”¨æˆåŠŸè¿æ¥ä¸Šäº† Redis ï¼Œæ˜¯å¦å¯ä»¥æˆåŠŸæ“ä½œ Redis æ•°æ®åº“**

    package com.rainbowsea.yupao.service;
    
    
    import com.rainbowsea.yupao.model.User;
    import org.junit.jupiter.api.Assertions;
    import org.junit.jupiter.api.Test;
    import org.springframework.boot.test.context.SpringBootTest;
    import org.springframework.data.redis.core.RedisTemplate;
    import org.springframework.data.redis.core.ValueOperations;
    
    import javax.annotation.Resource;
    
    @SpringBootTest
    public class RedisTest {
    
    
        @Resource
        private RedisTemplate redisTemplate; // å®ä¾‹åŒ– æ“ä½œ Redis çš„å®ä¾‹æ¨¡æ¿
    
    
        @Test
        void test() {
            ValueOperations valueOperations = redisTemplate.opsForValue();
            // å¢
            valueOperations.set("yupiString","dog");
            valueOperations.set("yupiInt",1);
            valueOperations.set("yupiDouble",2.0);
    
            User user = new User();
            user.setId(1L);
            user.setUsername("yupi");
    
            valueOperations.set("yupiUser",user);
    
            // æŸ¥
            Object yupi = valueOperations.get("yupiString");
            Assertions.assertTrue("dog".equals((String)yupi));
            yupi = valueOperations.get("yupiInt");
            Assertions.assertTrue(1 == (Integer) yupi);
            yupi = valueOperations.get("yupiDouble");
            Assertions.assertTrue(2.0 == (Double) yupi);
    
            System.out.println(valueOperations.get("yupiUser"));
    
    
        }
    }
    
    

Reids è‡ªå®šä¹‰åºåˆ—åŒ–ï¼šRedisTemplateConfig
--------------------------------

ä¸ºäº†é˜²æ­¢å†™å…¥çš„ Redis çš„æ•°æ®ä¹±ç ï¼Œæµªè´¹ç©ºé—´ç­‰ï¼Œå¯ä»¥è‡ªå®šä¹‰åºåˆ—åŒ–å™¨ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

    package com.yupi.yupao.config;
    
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;
    import org.springframework.data.redis.connection.RedisConnectionFactory;
    import org.springframework.data.redis.core.RedisTemplate;
    import org.springframework.data.redis.serializer.RedisSerializer;
    
    @Configuration
    public class RedisTemplateConfig {
    
        @Bean
        public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory connectionFactory) {
            RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();
            redisTemplate.setConnectionFactory(connectionFactory);
            redisTemplate.setKeySerializer(RedisSerializer.string());
            return redisTemplate;
        }
    }
    
    

è®¾è®¡ç¼“å­˜ key
========

ä¸åŒç”¨æˆ·çœ‹åˆ°çš„æ•°æ®ä¸åŒã€‚

å»ºè®®æ ¼å¼ï¼š

systemID:moduleID:funcu: ï¼ˆæ³¨æ„ï¼šå°±æ˜¯ä¸è¦å’Œåˆ«çš„å†²çªï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªäºº/é¡¹ç›®å…±ç”¨ä¸€ä¸ª Redis ç¼“å­˜ï¼‰

egï¼šè¿™é‡Œæˆ‘ä»¬è®¾è®¡ï¼š`**yupao:user:recommed:userId**`

\*\*æ³¨æ„ï¼šRedis å†…å­˜ä¸èƒ½æ— é™å¢åŠ ï¼Œä¸€å®šè¦è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚Redis å†…å­˜æ˜¯æœ‰é™çš„ï¼Œè€Œä¸”åœ¨æœåŠ¡å™¨å½“ä¸­ç‰¹åˆ«è´µã€‚éå¸¸é‡è¦****ğŸŒŸğŸŒŸğŸŒŸ**** \*\*

**ç¼“å­˜ï¼Œè¿è¡Œæµ‹è¯•ï¼š**