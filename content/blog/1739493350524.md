---
layout: post
title: '如何正确配置 .gitignore 以忽略特定文件夹下的文件（除指定子文件夹外）'
date: "2025-02-14T00:35:50Z"
---
如何正确配置 .gitignore 以忽略特定文件夹下的文件（除指定子文件夹外）
========================================

在使用 Git 进行版本控制时，`.gitignore` 文件是一个非常有用的工具，可以帮助我们忽略不需要跟踪的文件或文件夹。然而，有时我们需要忽略某个文件夹下的所有内容，但保留其中的某个子文件夹。本文将详细介绍如何实现这一需求，并解决修改 `.gitignore` 后如何生效的问题。

### 场景描述

假设我们的项目根目录下有一个 `unpackage` 文件夹，我们希望忽略 `unpackage` 文件夹下的所有文件和文件夹，但保留其中的 `res` 文件夹。也就是说，`unpackage/res/` 需要被 Git 跟踪，而 `unpackage/` 下的其他内容需要被忽略。

### 解决方案

在 `.gitignore` 文件中添加以下规则：

unpackage/\*
!unpackage/res/

#### 规则解释：

1.  `unpackage/*`：忽略 `unpackage` 文件夹下的所有文件和文件夹。
    
2.  `!unpackage/res/`：排除 `unpackage/res/` 文件夹，即不忽略 `res` 文件夹及其内容。
    

* * *

### 修改 `.gitignore` 后如何生效

如果你之前已经在 `.gitignore` 文件中写了 `unpackage/*`，现在修改为上述规则后，需要执行以下步骤使更改生效：

#### 1\. 清除 Git 缓存

Git 会缓存已经跟踪的文件，即使它们现在被 `.gitignore` 规则匹配。我们需要清除缓存，让 Git 重新应用 `.gitignore` 规则。

运行以下命令：

git rm -r --cached unpackage/
git add .
git commit \-m "Update .gitignore to exclude unpackage except res"

#### 命令解释：

*   `git rm -r --cached unpackage/`：从 Git 缓存中移除 `unpackage` 文件夹的内容，但不会删除本地文件。
    
*   `git add .`：重新添加文件，应用新的 `.gitignore` 规则。
    
*   `git commit`：提交更改。
    

#### 2\. 检查是否生效

运行以下命令，检查 `unpackage` 文件夹的状态：

git status

你应该看到：

*   `unpackage/res/` 被跟踪。
    
*   `unpackage/` 下的其他文件或文件夹被忽略。
    

#### 3\. 推送更改（如果需要）

如果你在远程仓库中也需要这些更改，记得推送：

git push origin <branch-name>

* * *

### 注意事项

1.  如果你之前已经将 `unpackage/` 下的文件提交到了 Git 仓库，这些文件会保留在 Git 历史中。如果需要彻底从历史中删除，可以使用 `git filter-repo` 或 `BFG Repo-Cleaner` 工具。
    
2.  如果 `unpackage/res/` 下有子文件夹或文件需要被跟踪，Git 会自动跟踪它们，因为 `res` 文件夹本身没有被忽略。
    

* * *

### 总结

通过合理配置 `.gitignore` 文件，我们可以灵活地控制 Git 跟踪的文件和文件夹。本文介绍了如何忽略某个文件夹下的所有内容，但保留其中的指定子文件夹，并解决了修改 `.gitignore` 后如何生效的问题。希望这篇文章对你有所帮助！