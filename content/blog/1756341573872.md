---
layout: post
title: 'ã€æ¸²æŸ“æµæ°´çº¿ã€‘[è¾“å‡ºé˜¶æ®µ]-[åŒç¼“å†²æœºåˆ¶]ä»¥UnityURPä¸ºä¾‹'
date: "2025-08-28T00:39:33Z"
---
ã€æ¸²æŸ“æµæ°´çº¿ã€‘\[è¾“å‡ºé˜¶æ®µ\]-\[åŒç¼“å†²æœºåˆ¶\]ä»¥UnityURPä¸ºä¾‹
====================================

![ã€æ¸²æŸ“æµæ°´çº¿ã€‘[è¾“å‡ºé˜¶æ®µ]-[åŒç¼“å†²æœºåˆ¶]ä»¥UnityURPä¸ºä¾‹](https://img2024.cnblogs.com/blog/3685400/202508/3685400-20250827150348799-2104102233.png) Unity URPä¸­çš„åŒç¼“å†²æŠ€æœ¯è§£æ åŒç¼“å†²æŠ€æœ¯æ˜¯å›¾å½¢æ¸²æŸ“ä¸­è§£å†³ç”»é¢é—ªçƒå’Œæ’•è£‚çš„å…³é”®æœºåˆ¶ã€‚åœ¨Unity URPä¸­ï¼Œè¯¥æŠ€æœ¯é€šè¿‡SwapBufferSystemç±»å®ç°ï¼ŒåŒ…å«m\_Aå’Œm\_Bä¸¤ä¸ªç¼“å†²åŒºäº¤æ›¿ä½¿ç”¨ã€‚URPå¯¹åŒç¼“å†²è¿›è¡Œäº†ç³»ç»ŸåŒ–å°è£…ï¼Œç›¸æ¯”æ—©æœŸå†…ç½®ç®¡çº¿æ›´é«˜æ•ˆã€‚å®ç°åŸç†åŒ…æ‹¬ï¼š1)åˆ›å»ºä¸¤ä¸ªæ¸²æŸ“ç›®æ ‡ä½œä¸ºå¸§ç¼“å†²ï¼›2)é€šè¿‡æè¿°ç¬¦æ§åˆ¶å†…å­˜åˆ†é…ï¼›3)ä¸VSyncä¿¡å·åŒæ­¥é˜²æ­¢æ’•è£‚ã€‚ç¤ºä¾‹ä»£ç å±•ç¤ºäº†åœ¨åå¤„ç†æ•ˆæœã€è‡ªå®šä¹‰æ¸²æŸ“ç³»ç»Ÿå’Œå¤šç›¸æœºæ¸²æŸ“ä¸­çš„åº”ç”¨ï¼Œå¦‚ä½¿ç”¨ä¸´æ—¶æ¸²æŸ“ç›®æ ‡å®ç°æ•ˆæœå åŠ ï¼Œä»¥åŠå¤šç›¸æœºå¹³æ»‘åˆ‡æ¢ã€‚åŒç¼“å†²æœºåˆ¶çš„ä¼˜åŒ–ä½¿URPèƒ½å¤Ÿæ

*   æœ€ç»ˆå°†å¤„ç†ç»“æœå†™å…¥é¢œè‰²/æ·±åº¦/æ¨¡æ¿ç¼“å†²åŒº
*   å¯ç‹¬ç«‹æ§åˆ¶å„é€šé“å†™å…¥æƒé™â€Œ

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

**åŒç¼“å†²æœºåˆ¶ä»‹ç»**
===========

åŒç¼“å†²(Double Buffer)æ˜¯ä¸€ç§å›¾å½¢æ¸²æŸ“ä¸­çš„å¸¸ç”¨æŠ€æœ¯ï¼Œé€šè¿‡ä½¿ç”¨ä¸¤ä¸ªç¼“å†²åŒº(å‰å°ç¼“å†²åŒºå’Œåå°ç¼“å†²åŒº)æ¥è§£å†³å›¾å½¢æ¸²æŸ“è¿‡ç¨‹ä¸­çš„é—ªçƒå’Œæ’•è£‚é—®é¢˜ã€‚åœ¨Unity URPä¸­ï¼ŒåŒç¼“å†²æœºåˆ¶ä¸»è¦ç”¨äºç®¡ç†æ¸²æŸ“ç›®æ ‡ï¼Œç¡®ä¿æ¸²æŸ“è¿‡ç¨‹çš„å¹³æ»‘è¿›è¡Œã€‚

åŒç¼“å†²çš„æ ¸å¿ƒåŸç†æ˜¯ï¼šä¸€ä¸ªç¼“å†²åŒºç”¨äºå½“å‰æ˜¾ç¤ºçš„å¸§(å‰å°ç¼“å†²åŒº)ï¼Œå¦ä¸€ä¸ªç¼“å†²åŒºç”¨äºç»˜åˆ¶æ–°å¸§(åå°ç¼“å†²åŒº)ã€‚å½“åå°ç¼“å†²åŒºå®Œæˆç»˜åˆ¶åï¼Œç³»ç»Ÿä¼šæ‰§è¡Œäº¤æ¢æ“ä½œï¼Œå°†ä¸¤ä¸ªç¼“å†²åŒºç¬æ—¶äº¤æ¢ã€‚ç°ä»£GPUé€šå¸¸ä½¿ç”¨ä¸‰é‡ç¼“å†²ç­‰å¤šç¼“å†²æŠ€æœ¯æ¥è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ã€‚

**å†å²å‘å±•æµç¨‹**
==========

åŒç¼“å†²æŠ€æœ¯æœ€æ—©åº”ç”¨äºå›¾å½¢æ˜¾ç¤ºé¢†åŸŸï¼Œç”¨äºè§£å†³å±å¹•åˆ·æ–°å’Œå›¾å½¢ç»˜åˆ¶ä¹‹é—´çš„åŒæ­¥é—®é¢˜ã€‚åœ¨Unityå¼•æ“ä¸­ï¼ŒåŒç¼“å†²æœºåˆ¶éšç€æ¸²æŸ“ç®¡çº¿çš„æ¼”è¿›ä¸æ–­ä¼˜åŒ–ï¼š

*   â€Œ**å†…ç½®æ¸²æŸ“ç®¡çº¿æ—¶æœŸ**â€Œï¼šUnityæ—©æœŸç‰ˆæœ¬ä½¿ç”¨å†…ç½®æ¸²æŸ“ç®¡çº¿ï¼ŒåŒç¼“å†²ä¸»è¦é€šè¿‡å‘½ä»¤ç¼“å†²åŒº(CommandBuffer)å®ç°ï¼Œå¼€å‘è€…å¯ä»¥æ‰‹åŠ¨ç®¡ç†æ¸²æŸ“ç›®æ ‡çš„åˆ‡æ¢ã€‚
*   â€Œ**å¯ç¼–ç¨‹æ¸²æŸ“ç®¡çº¿(SRP)å¼•å…¥**â€Œï¼šUnity 2018ç‰ˆæœ¬å¼•å…¥å¯ç¼–ç¨‹æ¸²æŸ“ç®¡çº¿æ¦‚å¿µï¼Œä¸ºåŒç¼“å†²æä¾›äº†æ›´çµæ´»çš„æ¥å£ã€‚
*   â€Œ**URPæˆç†ŸæœŸ**â€Œï¼šåœ¨URP(Universal Render Pipeline)ä¸­ï¼ŒåŒç¼“å†²æœºåˆ¶è¢«ç³»ç»ŸåŒ–å°è£…ï¼Œå½¢æˆäº†SwapBufferSystemç­‰é«˜çº§æŠ½è±¡ï¼Œä¼˜åŒ–äº†åå¤„ç†æµç¨‹ã€‚

**å†…ç½®ç®¡çº¿ä¸URPä¸­çš„åŒç¼“å†²å˜é‡**
===================

**å†…ç½®ç®¡çº¿ä¸­çš„åŒç¼“å†²å˜é‡**
---------------

åœ¨å†…ç½®æ¸²æŸ“ç®¡çº¿ä¸­ï¼ŒåŒç¼“å†²ä¸»è¦é€šè¿‡ä»¥ä¸‹å˜é‡å’Œæœºåˆ¶å®ç°ï¼š

*   `CommandBuffer`ï¼šå­˜å‚¨ä¸€ç³»åˆ—æ¸²æŸ“æŒ‡ä»¤çš„å®¹å™¨ï¼Œå¯ç”¨äºè®¾ç½®æ¸²æŸ“ç›®æ ‡
*   `RenderTexture`ï¼šä¸´æ—¶æ¸²æŸ“çº¹ç†ï¼Œå¸¸è¢«ç”¨ä½œåå°ç¼“å†²åŒº
*   `BuiltinRenderTextureType`ï¼šå†…ç½®çº¹ç†ç±»å‹ï¼ŒåŒ…æ‹¬`CurrentActive`å’Œ`CameraTarget`ç­‰

**URPä¸­çš„åŒç¼“å†²å˜é‡**
==============

URPå¯¹åŒç¼“å†²æœºåˆ¶è¿›è¡Œäº†æ›´é«˜çº§çš„å°è£…ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹å˜é‡å’Œç±»ï¼š

*   `SwapBufferSystem`ï¼šURPä¸­çš„åŒç¼“å†²ç³»ç»Ÿå®ç°ï¼ŒåŒ…å«`m_A`å’Œ`m_B`ä¸¤ä¸ª`SwapBuffer`ç»“æ„ä½“
*   `RenderTargetHandle`ï¼šURPä¸­è¡¨ç¤ºæ¸²æŸ“ç›®æ ‡çš„å¥æŸ„
*   `ScriptableRenderPass`ï¼šæ¸²æŸ“é€šé“åŸºç±»ï¼ŒåŒ…å«è®¾ç½®æ¸²æŸ“ç›®æ ‡çš„æ¥å£
*   `UniversalRenderer`ï¼šURPé»˜è®¤æ¸²æŸ“å™¨ï¼Œç®¡ç†åŒç¼“å†²çš„åˆå§‹åŒ–å’Œäº¤æ¢

**åº•å±‚åŸç†è§£æ**
==========

**åº•å±‚å®ç°æ ¸å¿ƒç±»ä¸å˜é‡**
--------------

åœ¨Unity URPä¸­ï¼ŒåŒç¼“å†²æœºåˆ¶ä¸»è¦é€šè¿‡`SwapBufferSystem`ç±»å®ç°ï¼Œè¯¥ç±»åŒ…å«ä¸¤ä¸ªå…³é”®å˜é‡`m_A`å’Œ`m_B`ï¼Œåˆ†åˆ«ä»£è¡¨å‰åç¼“å†²åŒºã€‚å…·ä½“å®ç°ä½äº`UniversalRenderer`ç±»ä¸­ï¼Œä½œä¸ºæ¸²æŸ“ç›®æ ‡ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ã€‚

### ä¸»è¦å®ç°ç»†èŠ‚

*   `SwapBuffer`ç»“æ„ä½“ï¼šåŒ…å«`name`(ç¼“å†²åŒºåç§°)å’Œ`rt`(RenderTexture)ä¸¤ä¸ªå­—æ®µ
*   `SwapBufferSystem`ç±»ï¼šç®¡ç†ä¸¤ä¸ª`SwapBuffer`å®ä¾‹çš„äº¤æ¢é€»è¾‘
*   `UniversalRenderer`ç±»ï¼šåˆå§‹åŒ–å¹¶æ§åˆ¶åŒç¼“å†²ç³»ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸ

â€Œ**ç¼“å†²åŒºåˆ›å»º**â€Œ
-----------

*   åœ¨`UniversalRenderer`çš„`Setup`æ–¹æ³•ä¸­åˆ›å»ºä¸¤ä¸ªæ¸²æŸ“ç›®æ ‡ï¼Œè¿™äº›ç›®æ ‡å®é™…ä¸Šæ˜¯çº¹ç†æ”¯æŒçš„å¸§ç¼“å†²ã€‚

â€Œ**æè¿°ç¬¦æ§åˆ¶**â€Œ
-----------

*   é€šè¿‡`cameraTargetDescriptor`å‚æ•°æè¿°æ¸²æŸ“ç›®æ ‡çš„å†…å­˜åˆ†é…æ–¹å¼ï¼Œå¯ä»¥åœ¨`AddRenderPasses`é˜¶æ®µä¿®æ”¹è¿™äº›å‚æ•°æ¥"åŠ«æŒ"æ¸²æŸ“ç›®æ ‡ã€‚

â€Œ**äº¤æ¢æœºåˆ¶**â€Œ
----------

*   URPä½¿ç”¨`SwapBufferSystem`ç»´æŠ¤ä¸¤ä¸ªæ¸²æŸ“ç›®æ ‡ç¼“å†²åŒº(`m_A`å’Œ`m_B`)ï¼Œåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­äº¤æ›¿ä½¿ç”¨ï¼Œé¿å…ä¸­é—´ç¯èŠ‚çš„é‡å¤æ‹·è´ã€‚

â€Œ**åŒæ­¥æ§åˆ¶**â€Œ
----------

*   åŒç¼“å†²ä¸VSyncä¿¡å·é…åˆå·¥ä½œï¼Œç¡®ä¿ç¼“å†²åŒºäº¤æ¢ä¸å±å¹•åˆ·æ–°åŒæ­¥ï¼Œé˜²æ­¢ç”»é¢æ’•è£‚.

**åŒç¼“å†²æœºåˆ¶URPç¤ºä¾‹**
==============

**åå¤„ç†æ•ˆæœåŒç¼“å†²å®ç°**
--------------

*   PostProcessFeature.cs
    
    åå¤„ç†æ•ˆæœä¸­å¦‚ä½•ä½¿ç”¨ä¸´æ—¶æ¸²æŸ“ç›®æ ‡å®ç°åŒç¼“å†²äº¤æ¢ï¼Œé¿å…ç›´æ¥ä¿®æ”¹åŸå§‹å¸§ç¼“å†²å¯¼è‡´çš„é—®é¢˜
    
        using UnityEngine;
        using UnityEngine.Rendering;
        using UnityEngine.Rendering.Universal;
        
        public class CustomPostProcessPass : ScriptableRenderPass
        {
            private Material m_Material;
            private RenderTargetHandle m_TemporaryColorTexture;
            private RenderTargetHandle m_CameraColorTexture;
            
            public CustomPostProcessPass(Material material)
            {
                m_Material = material;
                m_TemporaryColorTexture.Init("_TemporaryColorTexture");
            }
        
            public override void Configure(CommandBuffer cmd, RenderTextureDescriptor cameraTextureDescriptor)
            {
                cmd.GetTemporaryRT(m_TemporaryColorTexture.id, cameraTextureDescriptor);
            }
        
            public override void Execute(ScriptableRenderContext context, ref RenderingData renderingData)
            {
                CommandBuffer cmd = CommandBufferPool.Get("Custom Post Processing");
                
                // åŒç¼“å†²äº¤æ¢
                Blit(cmd, m_CameraColorTexture.Identifier(), 
                    m_TemporaryColorTexture.Identifier(), m_Material);
                Blit(cmd, m_TemporaryColorTexture.Identifier(), 
                    m_CameraColorTexture.Identifier());
                    
                context.ExecuteCommandBuffer(cmd);
                CommandBufferPool.Release(cmd);
            }
        
            public override void FrameCleanup(CommandBuffer cmd)
            {
                cmd.ReleaseTemporaryRT(m_TemporaryColorTexture.id);
            }
        }
        
    

**è‡ªå®šä¹‰æ¸²æŸ“ç›®æ ‡åŒç¼“å†²ç³»ç»Ÿ**
----------------

*   CustomBufferSystem.cs
    
    å®ç°äº†ä¸€ä¸ªç®€å•çš„åŒç¼“å†²ç³»ç»Ÿç¤ºä¾‹ï¼Œå¯ç”¨äºéœ€è¦å¤šå¸§æ•°æ®ç´¯ç§¯çš„æ•ˆæœå¦‚è¿åŠ¨æ¨¡ç³Š
    
        
        using UnityEngine;
        using UnityEngine.Rendering;
        using UnityEngine.Rendering.Universal;
        
        public class CustomBufferSystem
        {
            private RenderTargetHandle[] m_Buffers = new RenderTargetHandle[2];
            private int m_CurrentBufferIndex = 0;
            
            public void Initialize(string name)
            {
                m_Buffers[0].Init(name + "_Buffer0");
                m_Buffers[1].Init(name + "_Buffer1");
            }
        
            public RenderTargetHandle GetCurrentBuffer()
            {
                return m_Buffers[m_CurrentBufferIndex];
            }
        
            public RenderTargetHandle GetNextBuffer()
            {
                return m_Buffers[(m_CurrentBufferIndex + 1) % 2];
            }
        
            public void Swap()
            {
                m_CurrentBufferIndex = (m_CurrentBufferIndex + 1) % 2;
            }
        
            public void Dispose(CommandBuffer cmd)
            {
                cmd.ReleaseTemporaryRT(m_Buffers[0].id);
                cmd.ReleaseTemporaryRT(m_Buffers[1].id);
            }
        }
        
    

**URPå¤šç›¸æœºæ¸²æŸ“åŒç¼“å†²åŒæ­¥**
-----------------

*   MultiCameraRenderer.cs
    
    å¤šç›¸æœºæ¸²æŸ“åœºæ™¯ä¸­å¦‚ä½•ä½¿ç”¨åŒç¼“å†²æœºåˆ¶å®ç°å¹³æ»‘çš„ç›¸æœºåˆ‡æ¢æ•ˆæœ
    
        using UnityEngine;
        using UnityEngine.Rendering;
        using UnityEngine.Rendering.Universal;
        
        public class MultiCameraRenderer : MonoBehaviour
        {
            public Camera[] cameras;
            private RenderTexture[] buffers = new RenderTexture[2];
            private int currentBufferIndex = 0;
            
            void Start()
            {
                buffers[0] = new RenderTexture(Screen.width, Screen.height, 24);
                buffers[1] = new RenderTexture(Screen.width, Screen.height, 24);
            }
        
            void Update()
            {
                var renderer = (UniversalRenderPipelineAsset)GraphicsSettings.currentRenderPipeline;
                
                // æ¸²æŸ“åˆ°åå°ç¼“å†²åŒº
                int nextBufferIndex = (currentBufferIndex + 1) % 2;
                cameras[0].targetTexture = buffers[nextBufferIndex];
                
                // äº¤æ¢ç¼“å†²åŒº
                currentBufferIndex = nextBufferIndex;
                
                // æ˜¾ç¤ºå½“å‰ç¼“å†²åŒº
                Graphics.Blit(buffers[currentBufferIndex], null as RenderTexture);
            }
        }
        
    

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰