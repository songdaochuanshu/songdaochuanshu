---
layout: post
title: 'ç”¨ Vue3 + fetch-event-source æ‰“é€ æµå¼ AI ç¿»è¯‘å¹³å°ï¼šOCR + å¤§æ¨¡å‹ + SSE å…¨é“¾è·¯å®æˆ˜'
date: "2026-02-03T00:58:39Z"
---
ç”¨ Vue3 + fetch-event-source æ‰“é€ æµå¼ AI ç¿»è¯‘å¹³å°ï¼šOCR + å¤§æ¨¡å‹ + SSE å…¨é“¾è·¯å®æˆ˜
==============================================================

ä» UI å·¥ç¨‹å¸ˆåˆ° AI åº”ç”¨æ¶æ„è€…

13 å¹´å‰ï¼Œæˆ‘çš„å·¥ä½œæ˜¯è®©æŒ‰é’®åœ¨ IE6 ä¸Šå¯¹é½ï¼›  
13 å¹´åï¼Œæˆ‘ç”¨ `fetch-event-source` è®¢é˜…å¤§æ¨¡å‹çš„â€œæ€ç»´æµâ€ï¼Œç”¨ OCR è§£é”å›¾ç‰‡ä¸­çš„æ–‡å­—â€”â€”**å‰ç«¯ï¼Œæ­£åœ¨æˆä¸º AI äº§å“çš„ç¬¬ä¸€é“ä½“éªŒé˜²çº¿**ã€‚

æœ€è¿‘ï¼Œæˆ‘åŸºäº **Vue 3 + Vite + TypeScript + Ant Design Vue** å¼€å‘äº†ä¸€æ¬¾ä¼ä¸šçº§ AI å¤šè¯­ç¿»è¯‘å¹³å°ã€‚å®ƒæ”¯æŒï¼š

*   *   âœ… æ–‡æœ¬/å›¾ç‰‡/æ–‡æ¡£å¤šæ¨¡æ€è¾“å…¥
    *   âœ… å¤§æ¨¡å‹åŠ¨æ€åˆ‡æ¢ï¼ˆé€šä¹‰åƒé—®ã€DeepSeek ç­‰ï¼‰
    *   âœ… è¡Œä¸šé¢†åŸŸå®šåˆ¶ï¼ˆåŒ»ç–—ã€æ³•å¾‹ã€é‡‘èï¼‰
    *   âœ… **SSE æµå¼è¾“å‡º**ï¼ˆä½¿ç”¨ `fetch-event-source`ï¼‰

ä»Šå¤©ï¼Œæˆ‘å°†**é€è¡Œæ‹†è§£æ ¸å¿ƒä»£ç **ï¼Œå¸¦ä½ å¤ç°è¿™ä¸€é«˜ä»·å€¼ AI åº”ç”¨çš„å‰ç«¯æ¶æ„ã€‚

* * *

ä¸€ã€æŠ€æœ¯é€‰å‹ï¼šä¸ºä»€ä¹ˆæ˜¯ `fetch-event-source`ï¼Ÿ
---------------------------------

è™½ç„¶æµè§ˆå™¨åŸç”Ÿæ”¯æŒ `EventSource`ï¼Œä½†åœ¨ç°ä»£å‰ç«¯å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ›´å€¾å‘ä½¿ç”¨ **`@microsoft/fetch-event-source`**ï¼š

*   *   âœ… åŸºäº `fetch`ï¼Œå¤©ç„¶æ”¯æŒ **AbortController**ï¼ˆå¯å–æ¶ˆè¯·æ±‚ï¼‰
    *   âœ… æ”¯æŒ **è‡ªå®šä¹‰ headers**ï¼ˆç”¨äºé‰´æƒï¼‰
    *   âœ… æ›´å¥½çš„ **TypeScript ç±»å‹æ”¯æŒ**
    *   âœ… ä¸ Axios/Vite ç”Ÿæ€æ— ç¼é›†æˆ

å®‰è£…ï¼š

    npm install @microsoft/fetch-event-source
    

* * *

äºŒã€OCR å›¾ç‰‡è¯†åˆ«ï¼šå‰ç«¯åªç®¡â€œä¼ â€å’Œâ€œæ˜¾â€
----------------------

ç”¨æˆ·ä¸Šä¼ ä¸€å¼ è‹±æ–‡èœå•æˆªå›¾ï¼Œç³»ç»Ÿè‡ªåŠ¨æå–æ–‡å­—å¹¶ç¿»è¯‘ã€‚å‰ç«¯ä¸ç¢° OCR ç®—æ³•ï¼Œä½†è¦**ç®¡ç†å…¨æµç¨‹çŠ¶æ€**ã€‚

### ğŸ”§ çœŸå®ä»£ç å®ç°ï¼ˆæ¥è‡ª `æ–‡æœ¬_r9uv.txt`ï¼‰

#### 1\. **ç³»ç»Ÿé…ç½®åŠ è½½ï¼ˆå«æ–‡ä»¶å¤§å°é™åˆ¶ï¼‰**

    // src/views/translation/index.vue
    const loadSystemPublicConfig = async () => {
      try {
        const response = await findSystemPublicConfig({ configKey: 'upload_file_max_limit_mb' });
        const config = response.data[0];
        systemConfig.value.uploadFileMaxLimit = parseInt(config.value) || 10; // é»˜è®¤10MB
      } catch (error) {
        ElMessage.error('åŠ è½½ç³»ç»Ÿé…ç½®å¤±è´¥');
      }
    };
    

#### 2\. **æ–‡ä»¶é€‰æ‹©ä¸æ ¡éªŒ**

    const handleFileSelect = (event: Event) => {
      const input = event.target as HTMLInputElement;
      if (input.files && input.files.length > 0) {
        const file = input.files[0];
        const maxSize = systemConfig.value.uploadFileMaxLimit * 1024 * 1024;
        if (file.size > maxSize) {
          message.error(`æ–‡ä»¶ä¸èƒ½è¶…è¿‡ ${systemConfig.value.uploadFileMaxLimit} MB`);
          return;
        }
        currentFile.value = file;
        startParsing(file);
      }
    };
    

#### 3\. **è°ƒç”¨ OCR æ¥å£ï¼ˆAnt Design Vue ç»„ä»¶åé¦ˆï¼‰**

    const handleObtainFileContentText = async () => {
      if (!currentFile.value) return;
      
      const formData = new FormData();
      formData.append('file', currentFile.value);
      
      try {
        const response = await obtainFileContentText(formData);
        if (response.success) {
          sourceLanguageText.value = response.data.contentText;
          currentUploadStatus.value = 'success';
        } else {
          currentUploadStatus.value = 'failed';
          message.error(response.message || 'è§£æå¤±è´¥');
        }
      } catch (error) {
        currentUploadStatus.value = 'failed';
        message.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
      }
    };
    

> ğŸ’¡ **å…³é”®è®¾è®¡**ï¼šçŠ¶æ€åˆ†ä¸º `'idle' | 'parsing' | 'success' | 'failed'`ï¼Œå¯¹åº”å››ä¸ª UI åŒºå—ï¼Œé¿å…ç”¨æˆ·å›°æƒ‘ã€‚

* * *

ä¸‰ã€å¤§æ¨¡å‹åŠ¨æ€é›†æˆï¼šè®©é€‰æ‹©â€œæ— æ„Ÿè€Œæ™ºèƒ½â€
--------------------

AI æ¨¡å‹ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè€Œæ˜¯è¦**é»˜è®¤æœ€ä¼˜ + åŠ¨æ€é€‚é…**ã€‚

### ğŸ”§ çœŸå®ä»£ç å®ç°

#### 1\. **åŠ è½½æ¨¡å‹ä¸è¯­ç§å­—å…¸**

    // åŠ è½½å¤§æ¨¡å‹åˆ—è¡¨
    const loadLargeModelDictionary = async () => {
      const response = await findLargeModelDictionary({ keyword: '' });
      largeModelList.value = response.data;
      if (largeModelList.value.length > 0) {
        const firstModel = largeModelList.value[0];
        selectedModelId.value = firstModel.id;
        await loadLargeModelLanguageSupport(firstModel.id); // å…³é”®ï¼šè”åŠ¨è¯­ç§
      }
    };
    
    // åŠ è½½æŸæ¨¡å‹æ”¯æŒçš„è¯­ç§
    const loadLargeModelLanguageSupport = async (modelId: string) => {
      const response = await findLargeModelLanguageSupport({ largeModelId: modelId });
      languageSupportList.value = response.data;
    };
    

#### 2\. **è¡Œä¸šé¢†åŸŸåˆå§‹åŒ–**

    const loadIndustrySectorDictionary = async () => {
      const response = await findIndustrySectorDictionary({ keyword: '' });
      industrySectorList.value = response.data;
      // ä¸šåŠ¡é€»è¾‘ï¼šè‹¥é»˜è®¤ä¸º 'general'ï¼Œåˆ™è·³è¿‡
      if (defaultIndustrySector.value === 'general' && industrySectorList.value.length > 1) {
        defaultIndustrySector.value = industrySectorList.value[1].code;
      }
    };
    

#### 3\. **Ant Design Vue ä¸‹æ‹‰æ¡†ç»‘å®š**

    <!-- æ¨¡å‹é€‰æ‹© -->
    <a-select
      v-model:value="selectedModelId"
      style="width: 100%"
      @change="handleModelChange"
    >
      <a-select-option
        v-for="item in largeModelList"
        :key="item.id"
        :value="item.id"
      >
        {{ item.name }}
      </a-select-option>
    </a-select>
    

* * *

å››ã€SSE æµå¼ç¿»è¯‘ï¼šç”¨ `fetch-event-source` å®ç°â€œæ‰“å­—æœºæ•ˆæœâ€
-------------------------------------------

è¿™æ˜¯ä½“éªŒå‡çº§çš„æ ¸å¿ƒï¼æˆ‘ä»¬ä½¿ç”¨ `@microsoft/fetch-event-source` æ›¿ä»£åŸç”Ÿ `EventSource`ã€‚

### ğŸ”§ å®Œæ•´æµå¼ç¿»è¯‘å®ç°ï¼ˆç»“åˆä½ çš„é¡¹ç›®ç»“æ„ï¼‰

    import { fetchEventSource } from '@microsoft/fetch-event-source';
    
    // å­˜å‚¨æ§åˆ¶å™¨ï¼Œç”¨äºå–æ¶ˆè¯·æ±‚
    let abortController: AbortController | null = null;
    
    const handleTranslate = async () => {
      if (isTranslating.value) return;
      
      // é‡ç½®ç»“æœ
      translationResult.value = '';
      isTranslating.value = true;
      
      // åˆ›å»º AbortController
      abortController = new AbortController();
      
      const params = new URLSearchParams({
        largeModelId: selectedModelId.value,
        sourceLangCode: selectedSourceLangCode.value,
        targetLangCode: selectedTargetLangCode.value,
        industrySector: defaultIndustrySector.value,
        enableDeepThinking: String(enableDeepThinking.value),
        content: sourceLanguageText.value.trim(),
      });
    
      try {
        await fetchEventSource(`/api/v1/large-model/translate/stream?${params}`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${getToken()}`, // ä» Pinia æˆ– localStorage è·å–
          },
          signal: abortAssistant.signal, // æ”¯æŒå–æ¶ˆ
          onmessage(event) {
            if (event.data) {
              translationResult.value += event.data;
              nextTick(() => {
                scrollToBottom();
              });
            }
          },
          onclose() {
            isTranslating.value = false;
          },
          onerror(err) {
            console.error('SSE Error:', err);
            message.error('ç¿»è¯‘æœåŠ¡å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•');
            isTranslating.value = false;
            abortController?.abort(); // ä¸»åŠ¨å…³é—­
          },
        });
      } catch (error) {
        if (abortController?.signal.aborted) {
          console.log('ç¿»è¯‘å·²å–æ¶ˆ');
        } else {
          message.error('è¿æ¥å¤±è´¥');
        }
        isTranslating.value = false;
      }
    };
    
    // å–æ¶ˆç¿»è¯‘
    const cancelTranslation = () => {
      if (abortController) {
        abortController.abort();
        isTranslating.value = false;
        message.info('ç¿»è¯‘å·²å–æ¶ˆ');
      }
    };
    

### ğŸ”§ è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨

    const scrollToBottom = () => {
      const container = document.querySelector('.translation-result-content');
      if (container) {
        container.scrollTop = container.scrollHeight;
      }
    };
    

> ğŸ’¡ **ä¸ºä»€ä¹ˆä¸ç”¨ WebSocketï¼Ÿ**
> 
> *   *   SSE æ˜¯ **å•å‘æµ**ï¼ˆæœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯ï¼‰ï¼Œå®Œç¾åŒ¹é…â€œAI ç”Ÿæˆæ–‡æœ¬â€åœºæ™¯
>     *   `fetch-event-source` æä¾› **Promise é£æ ¼ API**ï¼Œæ›´ç¬¦åˆç°ä»£å‰ç«¯ä¹ æƒ¯

* * *

äº”ã€å·¥ç¨‹åŒ–äº®ç‚¹ï¼š13å¹´ç»éªŒçš„æ²‰æ·€
----------------

### âœ… 1. **å“åº”å¼å¸ƒå±€ï¼ˆPC/Mobile é€‚é…ï¼‰**

    const updateMainHeight = () => {
      const mainEl = document.querySelector('.main') as HTMLElement;
      if (!mainEl) return;
      
      if (isMobile.value) {
        mainEl.style.minHeight = '100vh';
        mainEl.style.height = 'auto';
      } else {
        mainEl.style.height = '100vh';
        mainEl.style.minHeight = 'auto';
      }
    };
    

### âœ… 2. **å†…å­˜æ¸…ç†ï¼ˆé˜²æ­¢æ³„æ¼ï¼‰**

    onUnmounted(() => {
      if (abortController) {
        abortController.abort();
      }
      window.removeEventListener('resize', checkIsMobile);
    });
    

### âœ… 3. **é˜²é‡å¤æäº¤ + åŠ è½½çŠ¶æ€**

    <a-button
      type="primary"
      :loading="isTranslating"
      @click="handleTranslate"
      :disabled="!sourceLanguageText.trim()"
    >
      {{ isTranslating ? 'ç¿»è¯‘ä¸­...' : 'å¼€å§‹ç¿»è¯‘' }}
    </a-button>
    

* * *

ç»“è¯­ï¼šå‰ç«¯çš„ä»·å€¼ï¼Œåœ¨â€œAI ä¸äººä¹‹é—´â€
-------------------

è¿™ä¸ªé¡¹ç›®è®©æˆ‘ç¡®ä¿¡ï¼š**AI æ—¶ä»£ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆçš„ä¸å¯æ›¿ä»£æ€§åœ¨äºâ€œä½“éªŒè®¾è®¡â€**ã€‚

*   *   æˆ‘ä»¬ç”¨ `fetch-event-source` æŠŠå†°å†·çš„ token æµå˜æˆæ¸©æš–çš„â€œæ‰“å­—æœºâ€ï¼›
    *   æˆ‘ä»¬ç”¨ Ant Design Vue è®©å¤æ‚é…ç½®å˜å¾—ç®€å•ï¼›
    *   æˆ‘ä»¬ç”¨çŠ¶æ€æœºç®¡ç† OCR çš„æ¯ä¸€æ­¥ï¼Œä¸è®©ç”¨æˆ·è¿·å¤±ã€‚

å¦‚æœä½ ä¹Ÿæƒ³ä»â€œåˆ‡å›¾ä»”â€è½¬å‹ä¸ºâ€œAI åº”ç”¨æ¶æ„è€…â€ï¼Œä¸å¦¨ä»ä¸€ä¸ªæµå¼ç¿»è¯‘å·¥å…·å¼€å§‹ã€‚**æŠ€æœ¯ä¼šè¿‡æ—¶ï¼Œä½†è§£å†³é—®é¢˜çš„èƒ½åŠ›æ°¸è¿œç¨€ç¼º**ã€‚

> **é¡¹ç›®æŠ€æœ¯æ ˆ**ï¼šVue 3.4 + Vite 5 + TypeScript + Ant Design Vue 4 + fetch-event-source  
> **ä»£ç æ¥æº**ï¼šæœ¬æ–‡æ‰€æœ‰é€»è¾‘å‡æ¥è‡ªå®é™…ç”Ÿäº§é¡¹ç›®ï¼ˆå·²è„±æ•ï¼‰  
> **äº’åŠ¨**ï¼šä½ ç”¨è¿‡ `fetch-event-source` å—ï¼Ÿæ¬¢è¿åˆ†äº«ä½ çš„ SSE å®è·µï¼