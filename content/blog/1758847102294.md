---
layout: post
title: 'kubernetesäº‹ä»¶ç›‘æ§å·¥å…·--Kube-Event'
date: "2025-09-26T00:38:22Z"
---
kubernetesäº‹ä»¶ç›‘æ§å·¥å…·--Kube-Event
============================

![kubernetesäº‹ä»¶ç›‘æ§å·¥å…·--Kube-Event](https://img2024.cnblogs.com/blog/3413000/202509/3413000-20250925211144365-653982718.png) åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œæ€»ä¼šç¢°åˆ°å®¹å™¨â€œä¸ç»æ„é—´â€é‡å¯çš„æƒ…å†µï¼Œä½†æˆ‘å®Œå…¨ä¸çŸ¥é“ä¸Šæ¬¡é‡å¯æ˜¯ä»€ä¹ˆæ—¶å€™ã€‚å®¹å™¨ä¸€æ—¦é‡å¯ï¼Œæ—§å®ä¾‹å°±ä¼šè¢«é”€æ¯ï¼Œå¦‚æœæ—§å®¹å™¨æ—¥å¿—æ²¡æœ‰è¢«æ”¶é›†æˆ–è½¬å­˜ï¼Œå°±å½»åº•ä¸¢å¤±äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œæƒ³é€šè¿‡å†å²æ—¥å¿—æ’æŸ¥é—®é¢˜åŸå› å°±æ˜¾å¾—éå¸¸æ£˜æ‰‹......ä¸ºæ­¤ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„å°å·¥å…·Kube-Event

â€ƒâ€ƒæœ€è¿‘é‡åˆ°ä¸€ä¸ªå¾ˆå¤´ç–¼çš„éœ€æ±‚ï¼š**Kubernetes é›†ç¾¤å†…éƒ¨äº‹ä»¶çš„ç›‘æ§ä¸è¿½è¸ª**ã€‚ åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œæ€»ä¼šç¢°åˆ°å®¹å™¨â€œä¸ç»æ„é—´â€é‡å¯çš„æƒ…å†µï¼Œä½†æˆ‘å®Œå…¨ä¸çŸ¥é“ä¸Šæ¬¡é‡å¯æ˜¯ä»€ä¹ˆæ—¶å€™ã€‚å®¹å™¨ä¸€æ—¦é‡å¯ï¼Œæ—§å®ä¾‹å°±ä¼šè¢«é”€æ¯ï¼Œå¦‚æœæ—§å®¹å™¨æ—¥å¿—æ²¡æœ‰è¢«æ”¶é›†æˆ–è½¬å­˜ï¼Œå°±å½»åº•ä¸¢å¤±äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œæƒ³é€šè¿‡å†å²æ—¥å¿—æ’æŸ¥é—®é¢˜åŸå› å°±æ˜¾å¾—éå¸¸æ£˜æ‰‹ã€‚

â€ƒâ€ƒå…¶å®ï¼ŒK8s æœ¬èº«æ˜¯æœ‰äº‹ä»¶å­˜å‚¨æœºåˆ¶çš„ï¼Œä½†å®ƒä»¬å­˜åœ¨ä¸€ä¸ª **TTLï¼ˆé»˜è®¤ 1 å°æ—¶ï¼‰**ã€‚è¿™æ„å‘³ç€å¦‚æœå®¹å™¨é¢‘ç¹é‡å¯ï¼Œæˆ–è€…äº‹ä»¶è¿‡äº†ä¿ç•™æ—¶é—´ï¼Œä½ å°±æ— æ³•é€šè¿‡äº‹ä»¶è¿½æº¯è¿‡å»çš„é‡å¯æ—¶é—´ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå½“å®¹å™¨å¤šæ¬¡å´©æºƒé‡å¯æ—¶ï¼Œåç»­çš„äº‹ä»¶å¯èƒ½ä¼šè¦†ç›–æ‰å‰é¢çš„é—®é¢˜çº¿ç´¢ï¼Œå¤§å¤§å¢åŠ äº†æ’æŸ¥éš¾åº¦ã€‚

* * *

â€ƒâ€ƒæˆ‘å¼€å§‹æ”¶é›†ç½‘ç»œä¸Šçš„ä¸€äº›ç°æœ‰è§£å†³æ–¹æ¡ˆï¼Œè¿˜çœŸæ‰¾åˆ°ä¸€ä¸ªï¼š[k8s-event-exporter](https://github.com/neilkuan/k8s-event-to-loki-grafana)ã€‚

â€ƒâ€ƒè¿™æ˜¯ä¸€ä¸ª GitHub å¼€æºé¡¹ç›®ï¼Œä½œè€…çš„æƒ³æ³•æ˜¯å†™ä¸€ä¸ª exporterï¼Œç›‘å¬é›†ç¾¤äº‹ä»¶å¹¶æ¨é€åˆ° Loki å­˜å‚¨ï¼Œç„¶ååœ¨ Grafana ä¸Šå±•ç¤ºï¼Œæ€è·¯éå¸¸æ£’ï¼ä¸è¿‡è¿™ä¸ªé¡¹ç›®æœ€åä¸€æ¬¡æäº¤è¿˜æ˜¯ä¸¤å¹´å‰ï¼Œæ—¶é—´æœ‰ç‚¹ä¹…äº†ï¼Œä½†æˆ‘è¿˜æ˜¯æŠ±ç€å°è¯•çš„å¿ƒç†å»è¯•ç”¨äº†ä¸€ä¸‹ã€‚

â€ƒâ€ƒç„¶è€Œæ„å¤–å‘ç”Ÿäº†ï¼š**exporter æ‹¿åˆ°çš„äº‹ä»¶å¹¶ä¸å®Œæ•´**ã€‚ æœ€åˆæˆ‘ä»¥ä¸ºæ˜¯ K8s æœ¬èº«çš„äº‹ä»¶é€»è¾‘å¯¼è‡´çš„ï¼Œå› ä¸º K8s å¯¹çŸ­æ—¶é—´å†…é¢‘ç¹å‘ç”Ÿçš„åŒä¸€é€»è¾‘äº‹ä»¶ä¼šè‡ªåŠ¨åˆå¹¶ï¼ˆè¿™ç‚¹åˆç†ï¼Œå¯ä»¥é¿å… etcd å­˜å‚¨çš„é‡å¤äº‹ä»¶ï¼‰ã€‚ä½†å¥‡æ€ªçš„æ˜¯ï¼Œæˆ‘å‘ç°æœ‰äº›äº‹ä»¶æœ¬ä¸æ˜¯åŒä¸€ä¸ªäº‹ä»¶ï¼Œexporter å´ä¾ç„¶æ²¡æœ‰æ­£ç¡®æ¨é€ã€‚

.pod-flow-card { max-width: 1050px; margin: 40px auto; padding: 30px 20px; background: rgba(255, 255, 255, 1); border-radius: 12px; box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08); border: 1px solid rgba(224, 224, 224, 1) } .pod-flow-horizontal { font-family: "Segoe UI", Arial, sans-serif; display: flex; justify-content: space-between; align-items: flex-start; padding: 0; list-style: none !important; position: relative; margin: 0 } .pod-flow-horizontal li { position: relative; text-align: center; flex: 1; list-style: none !important } .pod-flow-horizontal li .emoji { display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; background: rgba(255, 255, 255, 1); border: 3px solid rgba(76, 175, 80, 1); border-radius: 50%; width: 60px; height: 60px; font-size: 28px; box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15); position: relative; z-index: 1 } .pod-flow-horizontal li .title { display: block; font-weight: bold; font-size: 16px; margin-bottom: 6px; color: rgba(44, 62, 80, 1) } .pod-flow-horizontal li .desc { font-size: 14px; color: rgba(85, 85, 85, 1) } .pod-flow-horizontal li .arrow { position: absolute; top: 50%; left: 150%; margin-left: 10px; transform: translateY(-50%); font-size: 28px; font-weight: bold; background: linear-gradient(90deg, rgba(76, 175, 80, 1), rgba(118, 255, 3, 1)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: 1.2s linear infinite slidearrow } .pod-flow-horizontal li:last-child .arrow { display: none } @keyframes slideArrow { 0% { transform: translateY(-50%) translateX(0) } 50% { transform: translateY(-50%) translateX(10px) } 100% { transform: translateY(-50%) translateX(0) } }

Pod åˆ›å»ºè¿‡ç¨‹ä¸­çš„å…¸å‹äº‹ä»¶é“¾è·¯

*   ğŸ—“ï¸ â¤
    
    Scheduled Pod è¢«è°ƒåº¦åˆ°èŠ‚ç‚¹
*   ğŸ“¦ â¤
    
    Pulled é•œåƒæ‹‰å–å®Œæˆ
*   ğŸ› ï¸ â¤
    
    Created å®¹å™¨å®ä¾‹è¢«åˆ›å»º
*   ğŸš€ â¤
    
    Started å®¹å™¨å¯åŠ¨æˆåŠŸ
*   â¤ï¸
    
    Liveness Probe å¥åº·æ£€æŸ¥å¼€å§‹æ‰§è¡Œ

â€ƒâ€ƒä½†å®é™…ç»“æœå´åªæœ‰ **ä¸€ä¸ª Pod äº‹ä»¶** æˆåŠŸæ¨é€åˆ° Lokiï¼Œå‰©ä¸‹çš„äº‹ä»¶å…¨éƒ½ä¸¢å¼ƒäº†ï¼Œæç¤ºæ˜¯â€œäº‹ä»¶è¿‡æœŸè¢«ä¸¢å¼ƒâ€ã€‚æœ€å…³é”®çš„æ˜¯ï¼Œæˆ‘å¹¶ä¸çŸ¥é“ exporter ä¸¢å¼ƒçš„åˆ°åº•æ˜¯ä¸æ˜¯æˆ‘æƒ³è¦çš„äº‹ä»¶ã€‚æ‰€æœ‰èƒ½è°ƒçš„é…ç½®æˆ‘å‡ ä¹éƒ½è¯•äº†ï¼Œå¯æƒœè¿˜æ˜¯æ²¡èƒ½è§£å†³ï¼Œå±å®å‡ºä¹æˆ‘æ„æ–™ /(ã„’oã„’)/~~

* * *

â€ƒâ€ƒæˆ‘çš„éœ€æ±‚å…¶å®éå¸¸æ˜ç¡®ï¼š **ç›‘å¬ K8s é›†ç¾¤å†…çš„äº‹ä»¶ï¼Œå¹¶æ¨é€åˆ° Lokiã€‚**

â€ƒâ€ƒç½‘ä¸Šæ–¹æ¡ˆé‡Œæˆ‘ç ”ç©¶è¿‡ `k8s-event-exporter`ã€`promtail`ã€å¼€å¯ `k8s-auditlog`ã€`falco`ï¼Œæœ€åå‘ç°åªæœ‰ exporter æœ€è´´åˆéœ€æ±‚ï¼Œä½†å®ƒå´æ²¡èƒ½æ»¡è¶³æˆ‘ã€‚é‚£æ€ä¹ˆåŠï¼Ÿ

â€ƒâ€ƒğŸ‘‰ **ä¸è¡Œï¼é‚£å°±è‡ªå·±å†™ä¸€ä¸ªï¼** æˆ‘åªéœ€è¦å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼Œåº”è¯¥ç”¨ä¸äº†å¤šå°‘è„‘å­â€¦â€¦äºæ˜¯ï¼Œ**kube-event** å°±è¿™æ ·æ¨ªç©ºå‡ºä¸–äº†

.card-container { display: flex; gap: 20px; align-items: stretch; flex-wrap: wrap; overflow: hidden; padding: 10px } .card-container a { flex: 1; text-decoration: none; color: inherit; min-width: 250px; transition: transform 0.3s ease, box-shadow 0.3s ease } .card { border-radius: 16px; padding: 20px; height: 100%; box-sizing: border-box; background: linear-gradient(rgba(255, 255, 255, 1), rgba(255, 255, 255, 1)) border-box padding-box, linear-gradient(135deg, rgba(106, 90, 205, 1), rgba(0, 198, 255, 1), rgba(0, 255, 176, 1)) border-box rgba(255, 255, 255, 0.85); backdrop-filter: blur(6px); border: 2px solid rgba(0, 0, 0, 0); box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05); transition: all 0.4s ease } .card-container a:hover .card { transform: translateY(-6px); box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12); background-image: linear-gradient(rgba(255, 255, 255, 1), rgba(255, 255, 255, 1)), linear-gradient(135deg, rgba(255, 110, 199, 1), rgba(106, 90, 205, 1), rgba(0, 198, 255, 1)) } @media (prefers-color-scheme: dark) { .card { box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3) } .card-container a:hover .card { box-shadow: 0 0 20px rgba(0, 198, 255, 0.25) } } .card strong { font-size: 2rem; background: linear-gradient(135deg, rgba(106, 90, 205, 1), rgba(0, 198, 255, 1)); -webkit-background-clip: text; -webkit-text-fill-color: transparent } .card span { display: block; margin-top: 8px; color: rgba(68, 68, 68, 1); font-size: 0.95rem } .card small { display: block; margin-top: 10px; color: rgba(119, 119, 119, 1); font-size: 0.8rem } @media (max-width: 600px) { .card-container { flex-direction: column } .card-container a { min-width: unset } }

[

**Kube-Event** This project is used to assist in monitoring events ... https://github.com/SmallFlames/Kube-Event

](https://github.com/SmallFlames/Kube-Event)

* * *

ä¸€ã€ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼
========

> éœ€åœ¨ **K8s Master èŠ‚ç‚¹** éƒ¨ç½²

    # ä¸‹è½½å¹¶è§£å‹è½¯ä»¶
    tar xf kube-event.tar.gz && cd kube-event
    # ä¿®æ”¹confé…ç½®æ–‡ä»¶ï¼Œä¸»è¦ä¿®æ”¹lokiçš„åœ°å€ï¼Œå…¶ä»–å‡ ä¸ªå‚æ•°çœ‹ä¸ªäººéœ€æ±‚å§
    vim config.json
    # å¯åŠ¨æœåŠ¡
    ./start.sh
    # åœæ­¢æœåŠ¡
    ./stop.sh
    

äºŒã€å®¹å™¨åŒ–éƒ¨ç½²
=======

    # ä¸‹è½½é•œåƒ
    docker pull registry.cn-beijing.aliyuncs.com/nanxi/kube-event:1.0.1
    

é…ç½®æ¸…å•ï¼ˆkube-event.yamlï¼‰å‚è€ƒå¦‚ä¸‹ï¼š

    apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: kube-event-sa
      namespace: default
    ---
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRole
    metadata:
      name: kube-event-reader
    rules:
    - apiGroups: [""]
      resources: ["events"]
      verbs: ["get", "list", "watch"]
    ---
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRoleBinding
    metadata:
      name: kube-event-reader-binding
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: ClusterRole
      name: kube-event-reader
    subjects:
    - kind: ServiceAccount
      name: kube-event-sa
      namespace: default
    ---
    apiVersion: v1
    kind: ConfigMap
    metadata:
      name: kube-event-conf
    data:
      config.json: |
        {
          "LOKI_URL": "http://172.21.0.237:32537/loki/api/v1/push",
          "DATA_DIR": "../data/",
          "DEDUPLICATE": 0,
          "PUSH_INTERVAL_SECONDS": 30,
          "ENABLE_DETAILED": false
        }
      logging.yaml: |
        version: 1
        disable_existing_loggers: False
        formatters:
          standard:
            format: "%(asctime)s [%(levelname)s] %(name)s:%(lineno)d - %(message)s"
          message_only:
            format: "%(message)s"
        handlers:
          console:
            class: logging.StreamHandler
            level: INFO
            formatter: standard
            stream: ext://sys.stdout
          file:
            class: logging.handlers.TimedRotatingFileHandler
            level: DEBUG
            formatter: standard
            filename: ../logs/app.log
            when: midnight
            backupCount: 7
            encoding: utf-8
          detailed_console:
            class: logging.StreamHandler
            level: INFO
            formatter: message_only
            stream: ext://sys.stdout
          detailed_file:
            class: logging.handlers.TimedRotatingFileHandler
            level: DEBUG
            formatter: message_only
            filename: ../logs/app.log
            when: midnight
            backupCount: 7
            encoding: utf-8
        loggers:
          detailed:
            level: INFO
            handlers: [detailed_console,detailed_file]
            propagate: false
        root:
          level: DEBUG
          handlers: [console,file]
    ---
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: kube-event
      namespace: default
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: kube-event
      template:
        metadata:
          labels:
            app: kube-event
        spec:
          serviceAccountName: kube-event-sa 
          containers:
          - name: kube-event
            image: kube-event:1.0.1
            volumeMounts:
            - name: conf-volume
              mountPath: /app/conf
            - name: log-volume
              mountPath: /app/logs
            - name: catche-data
              mountPath: /app/data
          volumes:
          - name: conf-volume
            configMap:
              name: kube-event-conf
          - name: log-volume
            hostPath:
              path: /var/log/kube-event/logs
              type: DirectoryOrCreate 
          - name: catche-data
            hostPath:
              path: /var/log/kube-event/data
              type: DirectoryOrCreate
    

ä¸‰ã€æ•ˆæœå±•ç¤º
======

â€ƒâ€ƒæ­£å¸¸å¯åŠ¨åè¾“å‡ºå¦‚ä¸‹ï¼š

![image](https://img2024.cnblogs.com/blog/3413000/202509/3413000-20250922225517771-567058884.png)

â€ƒâ€ƒç„¶åæˆ‘ä»¬å¯ä»¥é…åˆgrafanaè¿›è¡Œå±•ç¤ºï¼š

â€ƒâ€ƒè¿™ä¸ªæ¨¡æ¿ç¼–å·æ˜¯17882ï¼ŒåŸk8s-event-exporterçš„æ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å€Ÿç”¨ï¼Œæ•°æ®å±•ç¤ºçš„æ—¶å€™ä¿®æ”¹ä¸‹æŸ¥è¯¢SQLå³å¯ï¼Œ

![image](https://img2024.cnblogs.com/blog/3413000/202509/3413000-20250922225544054-2093970836.png)

â€ƒâ€ƒä»¥ä¸‹æ˜¯kube-eventè¿è¡ŒæˆåŠŸåæ­£å¸¸æ¨é€çš„æ•°æ®å±•ç¤ºï¼š

![image](https://img2024.cnblogs.com/blog/3413000/202509/3413000-20250922225623034-1944054914.png)

![image](https://img2024.cnblogs.com/blog/3413000/202509/3413000-20250922225634963-2107240163.png)

![image](https://img2024.cnblogs.com/blog/3413000/202509/3413000-20250922225646852-658673738.png)

![image](https://img2024.cnblogs.com/blog/3413000/202509/3413000-20250922225655662-5764184.png)

* * *

_éƒ¨ç½²å‰è¯·è®¤çœŸé˜…è¯»è¯´æ˜ï¼Œæ¨èä½¿ç”¨å®¹å™¨éƒ¨ç½²ï¼Œæ¬¢è¿è¯•ç”¨å¹¶åé¦ˆé—®é¢˜ï¼_