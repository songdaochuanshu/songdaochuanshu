---
layout: post
title: '迈向 MCP 集群化：Solon AI （支持 Java8+）在解决 MCP 服务可扩展性上的探索与实践'
date: "2025-12-27T00:43:41Z"
---
迈向 MCP 集群化：Solon AI （支持 Java8+）在解决 MCP 服务可扩展性上的探索与实践
====================================================

Solon AI v3.8推出STREAMABLE\_STATELESS通道，解决MCP服务集群化难题。该无状态设计放弃反向调用功能，采用短链接通讯，实现真正的水平扩展能力。同时新增CompletableFuture和Publisher异步支持，提升IO密集型任务处理效率。

随着 Model Context Protocol (MCP) 的快速普及，开发者已经不再满足于简单的本地 Stdio 进程通讯。在生产环境中，如何构建高可用、可水平扩展的 MCP 服务集群成为了核心挑战。

Solon AI 在最近的 v3.8 版本更新中，针对 MCP 服务集群化痛点，推出了一系列重磅特性，特别是 STREAMABLE\_STATELESS（无状态流传输） 通道的引入，为 MCP 迈向云原生集群时代铺平了道路。

一、 MCP 集群化的拦路虎：状态依赖
-------------------

传统的 MCP 传输协议（如 SSE 或标准的 STREAMABLE）通常是有状态的。

### 1\. 为什么“有状态”难以集群？

在 MCP 协议中，为了支持反向调用（Server 调用 Client 的采样请求 Sampling）或原语变更通知（Notifications），Server 和 Client 之间必须建立长链接。

*   连接绑定：Client 的短链接请求（发送指令）必须与长链接（接收通知）路由到同一台服务器。
*   运维复杂：在负载均衡器（如 Nginx）上，必须配置 ip\_hash 或粘性会话（Sticky Sessions），否则请求会因为找不到上下文而失败。

### 2\. Solon AI 的解题思路

Solon AI v3.8 引入了 McpChannel.STREAMABLE\_STATELESS，其核心理念是：放弃不常用的反向调用，换取极致的水平扩展能力。

二、 核心突破：STREAMABLE\_STATELESS 通道
--------------------------------

这是 Solon AI 为集群友好性专门设计的模式。它通过将长链接转变为短链接通讯，彻底消除了服务端的状态依赖。

特性

STREAMABLE (有状态)

STREAMABLE\_STATELESS (无状态)

链接类型

有长链接 (Long Connection)

只用短链接 (Short Connection)

集群路由

需要 ip\_hash

任意路由

反向通讯

支持 (Server -> Client)

不支持

适用场景

需要实时监控 Tool 变化的复杂应用

80% 的标准工具调用、高并发集群

开发者体验一致性： 无论底层通道如何变化，Solon AI 的开发代码几乎不需要修改，仅需在注解中切换 channel：

    @McpServerEndpoint(channel = McpChannel.STREAMABLE_STATELESS, mcpEndpoint = "/mcp/weather")
    public class McpServerTool {
        @ToolMapping(description = "查询天气预报")
        public String getWeather(@Param(description = "城市位置") String location) {
            return "晴，14度";
        }
    }
    

三、 异步性能优化：CompletableFuture 与 Publisher
---------------------------------------

在集群环境下，IO 密集型任务（如请求第三方 API）如果阻塞线程，会极大降低集群的吞吐量。Solon AI v3.8.0 全面增强了 异步支持。

### 1\. CompletableFuture 支持

现在，MCP 工具可以直接返回异步结果，完美适配现代 Java 的异步编程模型：

    @ToolMapping(description = "异步查询天气", returnDirect = true)
    public CompletableFuture<String> getWeatherAsync(String location) {
        return CompletableFuture.supplyAsync(() -> "异步返回：多云");
    }
    

### 2\. 响应式流支持

针对更高级的场景，Solon AI 适配了 org.reactivestreams.Publisher，使得 MCP 工具、资源（Resource）和提示词（Prompt）都能以非阻塞的方式工作。

    @ToolMapping(description = "异步查询天气", returnDirect = true)
    public Publisher<String> getWeatherAsync(String location) {
        return Mono.just("异步返回：多云");
    }
    

四、 传输方式全景对比
-----------

Solon AI 目前支持四种主流传输通道，覆盖了从本地到云端的全场景：

服务端通道

客户端通道

通讯方式

集群友好度

备注

STDIO

STDIO

进程间管道

N/A

本地开发首选

SSE

SSE

HTTP

需 ip\_hash

官方已标记弃用

STREAMABLE

STREAMABLE

HTTP

需 ip\_hash

用于替代 SSE

STREAMABLE\_STATELESS

STREAMABLE

HTTP

极高

集群推荐

注意：使用 STREAMABLE\_STATELESS 时，客户端依然配置为 STREAMABLE 即可，服务端会自动处理握手降级。

五、 总结与展望
--------

Solon AI 通过对 MCP 协议的深度解耦，不仅实现了对最新 2025-06-18 版本协议的支持，更通过无状态通道和全链路异步化，解决了 MCP 服务在大规模并发下的“落地难”问题。

对于追求高性能和易扩展的 AI 应用架构师来说，Solon AI 提供了一套“开发一致、部署灵活”的工具链，让 MCP 服务真正具备了工业级集群的能力。