---
layout: post
title: 'æ·±å…¥è§£æJavaå¯åŠ¨å‚æ•°ï¼šä»åŸºç¡€é…ç½®åˆ°é«˜çº§è°ƒä¼˜'
date: "2025-08-11T00:47:56Z"
---
æ·±å…¥è§£æJavaå¯åŠ¨å‚æ•°ï¼šä»åŸºç¡€é…ç½®åˆ°é«˜çº§è°ƒä¼˜
-----------------------

**å…¨é¢æŒ‡å—ï¼šå†…å­˜ç®¡ç†Â·GCç­–ç•¥Â·æ€§èƒ½ç›‘æ§Â·é¿å‘å®è·µ**

* * *

**ä¸€ã€å¯åŠ¨å‚æ•°çš„æ ¸å¿ƒåˆ†ç±»ä¸ä½œç”¨**
------------------

Javaå¯åŠ¨å‚æ•°æ˜¯è¿æ¥åº”ç”¨ä»£ç ä¸JVMçš„æ¡¥æ¢ï¼Œç›´æ¥å½±å“æ€§èƒ½ã€ç¨³å®šæ€§å’Œè¯Šæ–­èƒ½åŠ›ã€‚æ ¹æ®è§„èŒƒå±‚çº§å¯åˆ†ä¸ºä¸‰ç±»ï¼š

**ç±»å‹**

**å‰ç¼€/è¯­æ³•**

**æ ¸å¿ƒç”¨é€”**

**ç¨³å®šæ€§**

**å…¸å‹ç¤ºä¾‹**

**æ ‡å‡†å‚æ•°**

`-`

åŸºç¡€åŠŸèƒ½æ§åˆ¶ï¼ˆè·¨å¹³å°å…¼å®¹ï¼‰

âœ… é«˜

`-cp lib/*:classes` `-Dfile.encoding=UTF-8`

**éæ ‡å‡†å‚æ•°**

`-X`

å†…å­˜/çº¿ç¨‹ç­‰åŸºç¡€è°ƒä¼˜

âš ï¸ ä¸­ï¼ˆç‰ˆæœ¬ç›¸å…³ï¼‰

`-Xms512m` `-Xmx2g` `-Xss256k`

**é«˜çº§å‚æ•°**

`-XX:+Flag`ï¼ˆå¯ç”¨ï¼‰  
`-XX:-Flag`ï¼ˆç¦ç”¨ï¼‰

JVMåº•å±‚è°ƒä¼˜ï¼ˆGCç®—æ³•/å†…å­˜æ¨¡å‹ï¼‰

âš ï¸ ä½ï¼ˆç‰ˆæœ¬æ•æ„Ÿï¼‰

`-XX:+UseG1GC` `-XX:MaxMetaspaceSize=256m`

> ğŸ“Œ **æ‰©å±•ç±»å‹**ï¼š
> 
> *   **ç¨‹åºå‚æ•°**ï¼š`java -jar app.jar --profile=prod`ï¼ˆä¼ é€’ç»™`main()`æ–¹æ³•ï¼‰
> *   **æ¨¡å—å‚æ•°**ï¼ˆJava 9+ï¼‰ï¼š`--add-opens java.base/java.lang=ALL-UNNAMED`ï¼ˆè§£å†³åå°„è®¿é—®é™åˆ¶ï¼‰
> *   **Agentå‚æ•°**ï¼š`-javaagent:skywalking-agent.jar`ï¼ˆAPMç›‘æ§å·¥å…·æ¤å…¥ï¼‰

* * *

**äºŒã€å†…å­˜ç®¡ç†å‚æ•°è¯¦è§£ä¸é…ç½®ç­–ç•¥**
-------------------

### **1\. å †å†…å­˜ï¼ˆHeapï¼‰**

*   **`-Xms512m`**ï¼šåˆå§‹å †å¤§å°ï¼ˆé¿å…è¿è¡Œæ—¶åŠ¨æ€æ‰©å±•çš„å¼€é”€ï¼‰
*   **`-Xmx2g`**ï¼šæœ€å¤§å †å¤§å°ï¼ˆéœ€å°äºç‰©ç†å†…å­˜80%ï¼Œé˜²OOMï¼‰
*   **é»„é‡‘æ³•åˆ™**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®® **`-Xms`ä¸`-Xmx`è®¾ç›¸åŒå€¼**ï¼Œé¿å…å †éœ‡è¡

### **2\. éå †å†…å­˜**

*   **å…ƒç©ºé—´ï¼ˆJava 8+ï¼‰**ï¼š
    
        -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m  # ç±»å…ƒæ•°æ®å­˜å‚¨ï¼Œé»˜è®¤æ— ä¸Šé™éœ€ä¸»åŠ¨é™åˆ¶
        
    
*   **çº¿ç¨‹æ ˆ**ï¼š
    
        -Xss256k  # æ¯çº¿ç¨‹æ ˆå¤§å°ï¼ˆç™¾çº¿ç¨‹æœåŠ¡æ…è¶…1MBï¼Œé˜²å†…å­˜è€—å°½ï¼‰
        
    

### **3\. ç›´æ¥å†…å­˜ï¼ˆå †å¤–ï¼‰**

    -XX:MaxDirectMemorySize=1g  # NIOæ“ä½œä¸“ç”¨ï¼ˆNetty/Kafkaç­‰é«˜é¢‘IOå¿…å¤‡ï¼‰
    

* * *

**ä¸‰ã€åƒåœ¾å›æ”¶ï¼ˆGCï¼‰å‚æ•°è°ƒä¼˜æŒ‡å—**
--------------------

### **1\. å›æ”¶å™¨é€‰æ‹©**

**åœºæ™¯**

**æ¨èå›æ”¶å™¨**

**å¯ç”¨å‚æ•°**

ä½å»¶è¿Ÿå“åº”ï¼ˆ<100msï¼‰

G1ï¼ˆJDK9+é»˜è®¤ï¼‰

`-XX:+UseG1GC`

é«˜ååé‡è®¡ç®—

Parallel

`-XX:+UseParallelGC`

CMSå…¼å®¹ï¼ˆJDK8æ—§ç³»ç»Ÿï¼‰

CMSï¼ˆå·²æ·˜æ±°ï¼‰

`-XX:+UseConcMarkSweepGC`

### **2\. å…³é”®è°ƒä¼˜é¡¹**

    -XX:NewRatio=3           # è€å¹´ä»£/æ–°ç”Ÿä»£=3:1ï¼ˆé»˜è®¤2ï¼‰  
    -XX:SurvivorRatio=8      # Eden/Survivor=8:1ï¼ˆé»˜è®¤8ï¼‰  
    -XX:MaxGCPauseMillis=200 # G1æœ€å¤§åœé¡¿ç›®æ ‡ï¼ˆæ¯«ç§’ï¼‰  
    

### **3\. æ—¥å¿—ä¸è¯Šæ–­**

    -Xlog:gc*:file=gc.log  # JDK9+ç»Ÿä¸€æ—¥å¿—  
    -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/dump  # OOMæ—¶è‡ªåŠ¨è½¬å‚¨å†…å­˜å¿«ç…§
    

* * *

**å››ã€ç³»ç»Ÿå±æ€§ä¸è¯Šæ–­å‚æ•°**
---------------

### **1\. é€šç”¨é…ç½®**

    -Dspring.profiles.active=prod  # Spring Bootç¯å¢ƒåˆ‡æ¢  
    -Dserver.port=8080            # æœåŠ¡ç«¯å£  
    -Dlogging.level.root=WARN     # æ—¥å¿—çº§åˆ«æ§åˆ¶  
    

### **2\. è°ƒè¯•ä¸ç›‘æ§**

    # è¿œç¨‹è°ƒè¯•ï¼ˆå¼€å‘ç¯å¢ƒï¼‰  
    -Xdebug -Xrunjdwp:transport=dt_socket,address=5005,server=y,suspend=n  
    
    # é£è¡Œè®°å½•å™¨ï¼ˆç”Ÿäº§è¯Šæ–­ï¼‰  
    -XX:+FlightRecorder -XX:StartFlightRecording=duration=60s,filename=recording.jfr  
    

* * *

**äº”ã€Spring Bootä¸“å±å‚æ•°**
---------------------

    # é…ç½®æ–‡ä»¶å®šåˆ¶  
    -Dspring.config.location=classpath:/override/,file:/etc/config/  
    
    # Actuatorç›‘æ§  
    -Dmanagement.server.port=9090 -Dinfo.app.version=1.0.0  
    
    # çƒ­éƒ¨ç½²æ”¯æŒ  
    -Dspring.devtools.restart.enabled=true  
    

* * *

**å…­ã€ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µä¸é¿å‘æŒ‡å—**
-------------------

1.  **å†…å­˜åˆ†é…é»„é‡‘æ¯”ä¾‹**ï¼š
    
    *   æ–°ç”Ÿä»£ â‰ˆ å †çš„1/3ï¼ˆ`-Xmn`ï¼‰ï¼Œè€å¹´ä»£ â‰ˆ 2/3
    *   å…ƒç©ºé—´ â‰¥ 256mï¼ˆé˜²é¢‘ç¹Full GCï¼‰
2.  **å®¹å™¨åŒ–éƒ¨ç½²å¿…åš**ï¼š
    
        # æ„ŸçŸ¥å®¹å™¨å†…å­˜é™åˆ¶ï¼ˆJDK8u191+ï¼‰  
        -XX:+UseContainerSupport -XX:MaxRAMPercentage=75.0  
        
    
3.  **å‚æ•°ç¦ç”¨è­¦å‘Š**ï¼š
    
    *   **æ°¸ä¹…ä»£å‚æ•°**ï¼š`-XX:PermSize`ï¼ˆJava 8å‰æœ‰æ•ˆï¼ŒJava 8+æ— æ•ˆï¼‰
    *   **å‹ç¼©æŒ‡é’ˆ**ï¼š`-XX:-UseCompressedOops`ï¼ˆå †<32Gæ—¶å‹¿ç¦ç”¨ï¼Œçœå†…å­˜ï¼‰
4.  **å¯åŠ¨éªŒè¯å‘½ä»¤**ï¼š
    
        # æŸ¥çœ‹ç”Ÿæ•ˆå‚æ•°  
        jinfo -flags <PID>  
        java -XX:+PrintCommandLineFlags -version  
        
    

* * *

**ä¸ƒã€ç»ˆæé…ç½®ç¤ºä¾‹ï¼ˆç”Ÿäº§çº§æ¨¡æ¿ï¼‰**
-------------------

    java -server \  
      -Xms4g -Xmx4g -Xmn1g \  
      -XX:MaxMetaspaceSize=256m \  
      -XX:+UseG1GC -XX:MaxGCPauseMillis=150 \  
      -XX:+HeapDumpOnOutOfMemoryError \  
      -Xlog:gc*:file=logs/gc_%t.log:time \  
      -Dspring.profiles.active=cluster \  
      -Djava.security.egd=file:/dev/./urandom \  
      -jar application.jar
    

* * *

**å‚è€ƒèµ„æ–™**ï¼š

1.  [https://docs.pingcode.com/baike/310713](https://docs.pingcode.com/baike/310713)
2.  [https://blog.csdn.net/u010786653/article/details/111564276](https://blog.csdn.net/u010786653/article/details/111564276)
3.  [http://mp.weixin.qq.com/s?\_\_biz=MzI2NTE4MDkxNg==&mid=2247486438](http://mp.weixin.qq.com/s?__biz=MzI2NTE4MDkxNg==&mid=2247486438)

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š[dashery](https://www.cnblogs.com/ydswin/)ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/ydswin/p/19029896](https://www.cnblogs.com/ydswin/p/19029896)

posted on 2025-08-09 16:04Â  [dashery](https://www.cnblogs.com/ydswin)Â  é˜…è¯»(135)Â  è¯„è®º(0)Â  Â  [æ”¶è—](javascript:void\(0\))Â  [ä¸¾æŠ¥](javascript:void\(0\))