---
layout: post
title: 'C#å®ç°ä¸‰è±MCé€šè®¯åè®®åº“ï¼ˆ4Cå¸§-æ ¼å¼1ï¼‰'
date: "2025-12-08T00:44:07Z"
---
C#å®ç°ä¸‰è±MCé€šè®¯åè®®åº“ï¼ˆ4Cå¸§-æ ¼å¼1ï¼‰
======================

C#å®ç°ä¸‰è±MCé€šè®¯åè®®åº“ï¼ˆ4Cå¸§-æ ¼å¼1ï¼‰
======================

**è¿è¡Œç¯å¢ƒï¼šVS2022 .net Standard2.0**  
**é€šè®¯åº“é¡¹ç›®åœ°å€(Gitee)ï¼š[é€šè®¯åº“é¡¹ç›®Gitee ä»“åº“](https://gitee.com/dragonet-Z/mitsubishi-melseclib)**  
**Melsecé€šè®¯æ‰‹å†Œé“¾æ¥(è“å¥äº‘)ï¼š[ä¸‰è±Qç³»åˆ—ä¸Lç³»åˆ—MELSECé€šè®¯åè®®æ‰‹å†Œ](https://wwys.lanzoub.com/imWEJ3aty7mb)**  
**C24æ¨¡å—ç”¨æˆ·æ‰‹å†Œé“¾æ¥(è“å¥äº‘)ï¼š[ä¸‰è±Qç³»åˆ—ä¸²è¡Œé€šä¿¡æ¨¡å—ç”¨æˆ·æ‰‹å†Œï¼ˆåŸºç¡€ç¯‡ï¼‰](https://wwys.lanzoub.com/ibzqq3csejsf)**  
**QnAå…¼å®¹4Cå¸§æ ¼å¼1æŠ¥æ–‡åˆ†æï¼š[QnAå…¼å®¹4Cå¸§æ ¼å¼1æŠ¥æ–‡åˆ†æ](https://wwys.lanzoub.com/iyYgr3csbv4f)**  
**é€šè®¯å·¥å…·(è“å¥äº‘)ï¼š[Commix 1.4](https://wwys.lanzoub.com/iPQL02ynh7gf)**

> **æ¦‚è¦**ï¼šæ ¹æ®ä¸‰è±çš„ Melsec é€šè®¯åè®®(æœ¬æ–‡ç§°MCåè®®)æ‰‹å†Œå†…å®¹ï¼Œä½¿ç”¨**ä¸²å£**å®ç°äº† PC ä¸ PLC çš„é€šè®¯ï¼Œèƒ½å¤Ÿé€šè¿‡**QnAå…¼å®¹4Cå¸§çš„æ ¼å¼1**å®ç° PC è¯»å†™ PLC çš„**è½¯å…ƒä»¶å­˜å‚¨å™¨**å†…å®¹(**å¼‚æ­¥æ–¹æ³•**)ï¼Œæœ€åç”¨ä¸€ä¸ª C#æ§åˆ¶å°é¡¹ç›®æµ‹è¯•äº†é€šè®¯åº“åŠŸèƒ½

* * *

èƒŒæ™¯ä»‹ç»
----

MCåè®®æ˜¯ä¸‰è± PLC ä¸ä¸»æœºé€šè®¯çš„ä¸€ç§å…¬å¼€åè®®ï¼ŒPC å¯é€šè¿‡ä¸‰è±C24æˆ–è€…E71æ¨¡å—è¯»å– PLC çš„è¿è¡ŒçŠ¶æ€å’ŒI/Oç‚¹ä½

ä»¥ä¸‹æ˜¯MCåè®®çš„ä¸¤ç§æ¨¡å—å’Œé€‚ç”¨çš„é€šä¿¡å¸§å’Œé€šä¿¡æ ¼å¼ä»£ç è¡¨æ ¼

å¯¹è±¡æ¨¡å—

å¯ä½¿ç”¨çš„é€šä¿¡å¸§

é€šä¿¡æ•°æ®ä»£ç 

C24

QnAå…¼å®¹3Cå¸§

æ ¼å¼1~4

ASCIIä»£ç 

QnAå…¼å®¹4Cå¸§

æ ¼å¼5

äºŒè¿›åˆ¶ä»£ç 

QnAå…¼å®¹2Cå¸§

æ ¼å¼1~4

ASCIIä»£ç 

Aå…¼å®¹1Cå¸§

ASCIIä»£ç 

E71

4Eå¸§

ASCIIä»£ç æˆ–äºŒè¿›åˆ¶ä»£ç 

QnAå…¼å®¹3Eå¸§

ASCIIä»£ç æˆ–äºŒè¿›åˆ¶ä»£ç 

Aå…¼å®¹1Eå¸§

ASCIIä»£ç æˆ–äºŒè¿›åˆ¶ä»£ç 

é€šè¿‡MCåè®®è¿›è¡Œçš„æ•°æ®é€šä¿¡æ˜¯ä»¥åŠåŒå·¥é€šä¿¡è¿›è¡Œï¼Œåœ¨å¯¹PLCå‘é€æŒ‡ä»¤æŠ¥æ–‡åä¼šæ¥æ”¶åˆ°æ¥è‡ªPLCçš„å“åº”æŠ¥æ–‡ï¼Œæ¥æ”¶å®Œå…¨åæ‰èƒ½å†æ¬¡å‘é€ä¸‹ä¸€ä¸ªæŒ‡ä»¤æŠ¥æ–‡  
åœ¨æ²¡æ¥æ”¶å®Œå…¨å“åº”æŠ¥æ–‡å°±å‘é€ä¸‹ä¸€ä¸ªæŒ‡ä»¤æŠ¥æ–‡ä¼šå‘ç”Ÿé”™è¯¯ï¼

ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤º

![åŠåŒå·¥é€šä¿¡å›¾](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213413857-1405366318.png)

æœ¬æ–‡ä¸»è¦ä»‹ç»**QnAå…¼å®¹4Cå¸§**çš„**æ ¼å¼1**ï¼Œéœ€è¦ä½¿ç”¨RS232çº¿è¿æ¥PCä¸»æœºä¸PLCï¼Œè¿æ¥ç¤ºæ„å›¾ä¸RS232çº¿åºå›¾å¦‚ä¸‹æ‰€ç¤º

![è¿æ¥ç¤ºæ„å›¾](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213433045-1194363247.png)

![RS232çº¿åºå›¾](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213449583-588920958.png)

* * *

QnAå…¼å®¹4Cå¸§ï¼ˆæ ¼å¼1ï¼‰æŠ¥æ–‡åˆ†æ
-----------------

QnAå…¼å®¹4Cå¸§çš„æ ¼å¼1é€šè¿‡ASCIIä»£ç è¿›è¡Œé€šä¿¡ï¼Œé€šä¿¡æŠ¥æ–‡å¦‚ä¸‹è¡¨

> ä»¥QnAå…¼å®¹4Cå¸§(æ ¼å¼1)è¯»å†™M0ï½M4ã€D0ï½D1çš„ä¸¤ä¸ªä¾‹å­ï¼Œé€šè¿‡è¡¨æ ¼è¯´æ˜  
> æŠ¥æ–‡è¡¨æ ¼æ–‡ä»¶ï¼š**[QnAå…¼å®¹4Cå¸§æ ¼å¼1æŠ¥æ–‡åˆ†æ](https://wwys.lanzoub.com/iyYgr3csbv4f)**

### è¯»å†™M0ï½M4æŠ¥æ–‡ä¾‹å­

*   è¯»å–M0ï½M4

![è¯»å–M0ï½M4](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213524073-215712588.png)

*   å†™å…¥M0ï½M4

![å†™å…¥M0ï½M4](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213538736-1068650636.png)

### è¯»å†™D0ï½D1æŠ¥æ–‡ä¾‹å­

*   è¯»å–D0ï½D1

![è¯»å–D0ï½D1](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213556576-356116909.png)

*   å†™å…¥D0ï½D1

![è¯»å–D0ï½D1](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213610367-1169466975.png)

### QnAå…¼å®¹4Cå¸§çš„é€šç”¨æ•°æ®å†…å®¹è¯´æ˜

æ­¤éƒ¨åˆ†åœ¨å®˜æ–¹çš„åè®®æ‰‹å†Œæœ‰è¯¦ç»†è¯´æ˜ï¼Œç›¸å…³å†…å®¹é€šè¿‡ä¸‹åˆ—å›¾ç‰‡è¡¨ç¤º

#### æ§åˆ¶ä»£ç 

![æ§åˆ¶ä»£ç ](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213625701-2106791111.png)

#### æ•°æ®å­—èŠ‚æ•°(æ ¼å¼5ç”¨)

![æ•°æ®å­—èŠ‚æ•°](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213639756-92412944.png)

#### å¸§è¯†åˆ«ç¼–å·

![å¸§è¯†åˆ«ç¼–å·](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213651318-1236034347.png)

#### ç«™å·

![ç«™å·](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213708558-1647878624.png)

#### ç½‘ç»œç¼–å·ä¸å¯ç¼–ç¨‹æ§åˆ¶å™¨ç¼–å·

![ç½‘ç»œç¼–å·ä¸å¯ç¼–ç¨‹æ§åˆ¶å™¨ç¼–å·](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213722173-218523093.png)

#### è¯·æ±‚ç›®æ ‡æ¨¡å—I/Oç¼–å·

![è¯·æ±‚ç›®æ ‡æ¨¡å—I/Oç¼–å·](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213739300-1224301355.png)

#### è¯·æ±‚ç›®æ ‡æ¨¡å—ç«™å·

![è¯·æ±‚ç›®æ ‡æ¨¡å—ç«™å·1](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213756675-709991463.png)

![è¯·æ±‚ç›®æ ‡æ¨¡å—ç«™å·2](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213810580-1096953623.png)

#### æœ¬ç«™ç¼–å·

![æœ¬ç«™ç¼–å·](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213830159-2138042948.png)

#### å’Œæ ¡éªŒä»£ç 

> **åœ¨æŠ¥æ–‡ä¸­å‚ä¸å’Œæ ¡éªŒçš„éƒ¨åˆ†åœ¨å„ä¸ªæ ¼å¼ä¸­ä¸åŒï¼Œéœ€è¦è‡ªè¡ŒæŸ¥é˜…åè®®æ‰‹å†Œ**

![å’Œæ ¡éªŒä»£ç ](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213844488-1876576132.png)

#### å‡ºé”™ä»£ç 

> C24æ¨¡å—ä¸E71æ¨¡å—çš„é”™è¯¯ä»£ç å¯èƒ½ä¸ç›¸åŒï¼Œéœ€è¦è‡ªè¡ŒæŸ¥é˜…åè®®æ‰‹å†Œ  
> C24æ¨¡å—ç”¨æˆ·æ‰‹å†Œï¼š**[ä¸‰è±Qç³»åˆ—ä¸²è¡Œé€šä¿¡æ¨¡å—ç”¨æˆ·æ‰‹å†Œï¼ˆåŸºç¡€ç¯‡ï¼‰](https://wwys.lanzoub.com/ibzqq3csejsf)**

![å‡ºé”™ä»£ç ](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213901578-1277326407.png)

### è½¯å…ƒä»¶çš„æ‰¹é‡è¯»å†™æŒ‡ä»¤

#### æŒ‡ä»¤çš„éƒ¨åˆ†å†…å®¹è¯´æ˜

![å„ä¸ªæŒ‡ä»¤èŒƒå›´è¯´æ˜](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213917371-1265343245.png)

#### ä½å•å…ƒçš„è¯»å†™æŒ‡ä»¤

![ä½å•å…ƒè¯»å–æŒ‡ä»¤å†…å®¹](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213929300-1034917571.png)

![ä½å•å…ƒå†™å…¥æŒ‡ä»¤å†…å®¹](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213942814-1668818127.png)

#### å­—å•å…ƒçš„è¯»å†™æŒ‡ä»¤

![å­—å•å…ƒè¯»å–æŒ‡ä»¤å†…å®¹](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207213956889-1523443368.png)

![å­—å•å…ƒå†™å…¥æŒ‡ä»¤å†…å®¹](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207214009886-364684371.png)

> MCåè®®çš„åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œæœ¬æ–‡çš„å†…å®¹åªæ˜¯åˆ†äº«äº†å…¶ä¸­çš„ä¸€å°éƒ¨åˆ†ï¼Œå¦‚æœå¤§å®¶æœ‰éœ€è¦çš„è¯ï¼Œå¯ä»¥é€šè¿‡å®ƒçš„é€šè®¯æ‰‹å†Œæ›´æ·±å…¥çš„äº†è§£MCåè®®  
> MCåè®®æ‰‹å†Œï¼š**[ä¸‰è±Qç³»åˆ—ä¸Lç³»åˆ—MELSECé€šè®¯åè®®æ‰‹å†Œ](https://wwys.lanzoub.com/imWEJ3aty7mb)**

* * *

MCé€šè®¯åº“çš„C#å®ç°
----------

### å’Œæ ¡éªŒå®ç°

æ ¹æ®ä¸Šæ–‡æä¾›çš„å’Œæ ¡éªŒä»£ç è§„åˆ™åˆ¶ä½œäº†ä¸€ä¸ªå’Œæ ¡éªŒçš„æ–¹æ³•ï¼Œä»¥ä¸‹ä»£ç å¯ä»¥ç”¨äº**æ‰‹åŠ¨è°ƒè¯•**å’Œ**æ ¡éªŒä»£ç **çš„å†…å®¹

    Console.WriteLine("Start Test!!");
    
    //æµ‹è¯•ç”¨ï¼ŒFrame1çš„å’Œæ ¡éªŒä»£ç åº”ä¸º"0x31,0x43"ï¼›æˆ–è€…åè¿›åˆ¶çš„"49,67"
    List<byte> Frame1 = new List<byte> { 0x46, 0x39, 0x30, 0x30, 0x30, 0x30, 0x46, 0x46, 0x30, 0x30, 0x30, 0x34, 0x30, 0x31, 0x30, 0x30, 0x30, 0x31, 0x58, 0x2A, 0x30, 0x30, 0x30, 0x30, 0x34, 0x30, 0x30, 0x30, 0x30, 0x35 };
    
    List<byte> Frame2 = new List<byte> { 0x46, 0x38, 0x30, 0x30, 0x30, 0x30, 0x46, 0x46, 0x30, 0x33, 0x46, 0x46, 0x30, 0x30, 0x30, 0x30, 0x30, 0x34, 0x30, 0x31, 0x30, 0x30, 0x30, 0x31, 0x4d, 0x2a, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x35 };
    
    
    List<byte> result = CheckSum(Frame2);
    
    System.Console.WriteLine($"{result[0]},{result[1]}");
    
    System.Console.WriteLine("Over!!");
    
    public static List<byte> CheckSum(List<byte> frame)
    {
        try
        {
            List<byte> checkResult = new List<byte>();
    
            //å–å’Œ
            int sum = 0;
            foreach (byte b in frame)
            {
                sum += b;
            }
    
            //æˆªå–æœ€ååä¸¤ä½
            byte lowByte = (byte)(sum & 0xFF);
    
            //è½¬ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
            string hexString = lowByte.ToString("X2");
    
            if (hexString.Length >= 2)
            {
                char num1 = hexString[hexString.Length - 2];
                char num2 = hexString[hexString.Length - 1];
    
                //æŒ‰ç…§é«˜ä½åœ¨å‰é¡ºåºæ·»åŠ 
                checkResult.Add((byte)num1);
                checkResult.Add((byte)num2);
            }
            else
            {
                checkResult.Add(0x30);
                checkResult.Add((byte)hexString[0]);
            }
    
            return checkResult;
        }
        catch (Exception)
        {
            throw;
        }
    }
    

### ä¸²å£é€šè®¯å®ç°

é€šè®¯åº“ä½¿ç”¨äº†`Serial Port`è¿›è¡Œä¸²å£é€šè®¯ï¼Œé€šè¿‡ä½¿ç”¨`SemaphoreSlim`(ä¿¡å·é‡é™åˆ¶)ã€`DataReceived`(ä¸²å£æ¥æ”¶æ•°æ®æ–¹æ³•)å’Œ`TaskCompletionSource`(å¼‚æ­¥ä»»åŠ¡ä¼ è¾“ä¸²å£æ•°æ®)ç­‰å†…å®¹å®ç°ä¸²å£é€šè®¯

ä»¥ä¸‹æ˜¯éƒ¨åˆ†ä»£ç 

    //æ„é€ å‡½æ•°
    public Melsec4CClient(string portname, int baudrate, System.IO.Ports.Parity parity, int databits, System.IO.Ports.StopBits stopbits)
            {
                this.PortName = portname;
                this.BaudRate = baudrate;
                this.Parity = parity;
                this.DataBits = databits;
                this.StopBits = stopbits;
            }
    

    //ä¸²å£æ¥æ”¶æ•°æ®æ–¹æ³•
    private void Melsec_4C_ReadIO_DataReceived(object sender, SerialDataReceivedEventArgs e)
            {
                try
                {
                    //è·å–å¹¶æ·»åŠ åˆ°ç¼“å†²åŒº
                    int bytesToRead = serialPort.BytesToRead;
                    byte[] buffer = new byte[bytesToRead];
                    serialPort.Read(buffer, 0, bytesToRead);
    
                    receiveBuffer.AddRange(buffer);
    
                    //å¤„ç†æ•°æ®
                    //æŸ¥æ‰¾å®Œæ•´çš„æŠ¥æ–‡
                    while (true)
                    {
                        if (format == Melsec_4C_FormatEnum.Format1)
                        {
                            int startIndex = receiveBuffer.IndexOf((byte)0x02);//STX
                            int errIndex = receiveBuffer.IndexOf((byte)0x15);//NAK
    
                            if (startIndex != -1 && errIndex == -1)//åªæ‰¾åˆ°STX,æ­£å¸¸ç»“æŸ
                            {
                                if (receiveBuffer.Count > 17 + startIndex)//æ¥æ”¶ä¿æ–‡åˆ°Dataéƒ¨åˆ†
                                {
                                    int seqStartIndex = FindSeq(receiveBuffer, new byte[] { 0x02, 0x46, 0x38 });
                                    if (seqStartIndex == -1)
                                    {
                                        //ç»§ç»­æ¥æ”¶æ•°æ®
                                        break;
                                    }
                                    if (seqStartIndex != startIndex)
                                    {
                                        startIndex = seqStartIndex;
                                    }
    
                                    int endIndex = receiveBuffer.IndexOf((byte)0x03, startIndex + 17);//ETX
                                    if (endIndex == -1)
                                    {
                                        //ç»§ç»­æ¥æ”¶æ•°æ®
                                        break;
                                    }
                                    //æ‰¾åˆ°å’Œæ ¡éªŒä½ç½®
                                    if (isCheckSum)//æœ‰å’Œæ ¡éªŒ
                                    {
                                        if (receiveBuffer.Count >= (endIndex + 3))
                                        {
                                            int frameEnd = endIndex + 3;
                                            //æå–å®Œæ•´æŠ¥æ–‡ï¼ˆä»STXåˆ°å’Œæ ¡éªŒä»£ç ï¼‰
                                            List<byte> completeFrame = receiveBuffer.GetRange(startIndex, frameEnd - startIndex);
                                            //è¯»å–åˆ°çš„å’Œæ ¡éªŒæ•°å€¼
                                            List<byte> receivedCheckSum = new List<byte>() { completeFrame[completeFrame.Count - 2], completeFrame[completeFrame.Count - 1] };
                                            //ç”¨äºè®¡ç®—å’Œæ ¡éªŒçš„æ•°æ®
                                            List<byte> dataForCheckSum = new List<byte>();
    
                                            for (int i = 1; i < completeFrame.Count - 2; i++)//å¾…æµ‹è¯•
                                            {
                                                dataForCheckSum.Add(completeFrame[i]);
                                            }
    
                                            List<byte> calculatedCheckSum = Melsec_4C_Check.CheckSum(format, dataForCheckSum);
                                            if (!calculatedCheckSum.SequenceEqual(receivedCheckSum))
                                            {
                                                throw new InvalidOperationException("è¯»å–çš„å’Œæ ¡éªŒæ•°å€¼ä¸è®¡ç®—çš„ä¸ç¬¦");
                                            }
    
                                            //å®Œæˆç»“æœ
                                            receiveTcs.TrySetResult(completeFrame);
    
                                            //æ¸…é™¤ç¼“å†²åŒºä¸­å·²å¤„ç†çš„æŠ¥æ–‡
                                            receiveBuffer.RemoveRange(0, frameEnd);
                                        }
                                        else
                                        {
                                            //ç»§ç»­æ¥æ”¶æ•°æ®
                                            break;
                                        }
                                    }
                                    else//æ— å’Œæ ¡éªŒ
                                    {
                                        List<byte> completeFrame = receiveBuffer.GetRange(startIndex, endIndex - startIndex);//å¾…æµ‹è¯•ï¼Œæ˜¯å¦è¦+1ï¼Ÿ
    
                                        //å®Œæˆç»“æœ
                                        receiveTcs.TrySetResult(completeFrame);
    
                                        //æ¸…é™¤ç¼“å†²åŒºä¸­å·²å¤„ç†çš„æŠ¥æ–‡
                                        receiveBuffer.RemoveRange(0, endIndex);
                                    }
    
                                }
                                else
                                {
                                    //ç»§ç»­æ¥æ”¶æ•°æ®
                                    break;
                                }
                            }
                            else if (startIndex == -1 && errIndex != -1)//åªæ‰¾åˆ°NAKï¼Œå¼‚å¸¸ç»“æŸ
                            {
    
    
                                //åˆ°è¾¾å›ºå®šå­—æ•°
                                if (receiveBuffer.Count >= 21 + errIndex)
                                {
                                    int seqErrIndex = FindSeq(receiveBuffer, new byte[] { 0x15, 0x46, 0x38 });
                                    if (seqErrIndex == -1)
                                    {
                                        //ç»§ç»­æ¥æ”¶æ•°æ®
                                        break;
                                    }
                                    if (seqErrIndex != errIndex)
                                    {
                                        errIndex = seqErrIndex;
                                    }
    
                                    int frameEnd = errIndex + 21;
                                    List<byte> completeFrame = receiveBuffer.GetRange(errIndex, frameEnd - errIndex);//å¾…æµ‹è¯•ï¼Œæ˜¯å¦è¦+1ï¼Ÿ
                                                                                                                     //å®Œæˆç»“æœ
                                    receiveTcs.TrySetResult(completeFrame);
    
                                    //æ¸…é™¤ç¼“å†²åŒºä¸­å·²å¤„ç†çš„æŠ¥æ–‡
                                    receiveBuffer.RemoveRange(0, frameEnd);
                                }
                                else
                                {
                                    //ç»§ç»­æ¥æ”¶æ•°æ®
                                    break;
                                }
                            }
                            else //ä¸¤ä¸ªå¼€å¤´éƒ½æ²¡æ‰¾åˆ°
                            {
                                //ç»§ç»­æ¥æ”¶æ•°æ®
                                break;
                            }
    
                        }
                        else
                        {
                            //formatæ•°å€¼é”™è¯¯ï¼ŒæŠ›å‡ºå¼‚å¸¸
                            throw new ArgumentOutOfRangeException("format error!");
                        }
                    }
                }
                catch (Exception ex)
                {
                    if (receiveTcs.Task.IsCompleted == false)
                    {
                        receiveTcs.TrySetException(ex);
                    }
                }
            }
    

    //è¯»å–ä½å•ä½çš„å¼‚æ­¥æ–¹æ³•
    public async Task<List<bool>> ReadIOBitAsync(Melsec_4C_IOAreaEnum IOArea, uint IOAdr, uint ReadCount)
            {
                try
                {
                    Melsec_4C_FrameConfig config = new Melsec_4C_FrameConfig();
                    if (format == Melsec_4C_FormatEnum.Format1)
                    {
                        config.IDCode = Melsec_4C_ControlCode.IDCode_ASCII_4C;//F8
                        config.SNCode = new List<byte> { 0x30, 0x30 };//00
                        config.NetCode = new List<byte> { 0x30, 0x30 };//00
                        config.CPUCode = new List<byte> { 0x46, 0x46 };//FF
                        config.TargetModuleIOCode = new List<byte> { 0x30, 0x33, 0x46, 0x46 };//03FF
                        config.TargetModuleSNCode = new List<byte> { 0x30, 0x30 };//00
                        config.ThisSNCode = new List<byte> { 0x30, 0x30 };//00
                        config.Command = new List<byte> { 0x30, 0x34, 0x30, 0x31 };//0401
                        config.SonCommand = new List<byte> { 0x30, 0x30, 0x30, 0x31 };//0001
    
                        List<byte> datas = new List<byte>();
                        //é€‰æ‹©IOåŒºåŸŸä»£ç 
                        switch (IOArea)
                        {
                            case Melsec_4C_IOAreaEnum.IO_X:
                                datas.AddRange(Melsec_4C_IOAreaCode.IOArea_ASCII.IOArea_X);
                                break;
                            case Melsec_4C_IOAreaEnum.IO_Y:
                                datas.AddRange(Melsec_4C_IOAreaCode.IOArea_ASCII.IOArea_Y);
                                break;
                            case Melsec_4C_IOAreaEnum.IO_M:
                                datas.AddRange(Melsec_4C_IOAreaCode.IOArea_ASCII.IOArea_M);
                                break;
                            case Melsec_4C_IOAreaEnum.IO_L:
                                datas.AddRange(Melsec_4C_IOAreaCode.IOArea_ASCII.IOArea_L);
                                break;
                            case Melsec_4C_IOAreaEnum.IO_F:
                                datas.AddRange(Melsec_4C_IOAreaCode.IOArea_ASCII.IOArea_F);
                                break;
                            case Melsec_4C_IOAreaEnum.IO_V:
                                datas.AddRange(Melsec_4C_IOAreaCode.IOArea_ASCII.IOArea_V);
                                break;
                            case Melsec_4C_IOAreaEnum.IO_B:
                                datas.AddRange(Melsec_4C_IOAreaCode.IOArea_ASCII.IOArea_B);
                                break;
                            case Melsec_4C_IOAreaEnum.IO_TC:
                                datas.AddRange(Melsec_4C_IOAreaCode.IOArea_ASCII.IOArea_T);
                                break;
                            case Melsec_4C_IOAreaEnum.IO_CC:
                                datas.AddRange(Melsec_4C_IOAreaCode.IOArea_ASCII.IOArea_C);
                                break;
                            case Melsec_4C_IOAreaEnum.IO_S:
                                datas.AddRange(Melsec_4C_IOAreaCode.IOArea_ASCII.IOArea_S);
                                break;
                            default:
                                throw new ArgumentOutOfRangeException("IOåŒºåŸŸé€‰æ‹©å‡ºé”™");
                        }
    
                        datas.AddRange(MelsecConverter.Uint_D6String_ByteList(IOAdr));
                        datas.AddRange(MelsecConverter.Uint_D4String_ByteList(ReadCount));
    
                        config.Datas = datas;
    
                        var result = await ReadIOAreaAsync(config);
    
    
                        //resultè§£æ
                        if (result.IsSuccessed)
                        {
                            List<bool> listResult = MelsecConverter.ByteList_ASCII_BoolList(result.Datas);
                            return listResult;
                        }
                        else
                        {
                            throw new Exception(result.ExMessage);
                        }
                    }
                    else
                    {
                        throw new ArgumentOutOfRangeException("formaté€‰æ‹©å‡ºé”™");
                    }
                }
                catch (Exception)
                {
                    throw;
                }
            }
    

> è¯¦ç»†ä»£ç å¯å‚è€ƒï¼š**[é€šè®¯åº“é¡¹ç›®Gitee ä»“åº“](https://gitee.com/dragonet-Z/mitsubishi-melseclib)**

### æ§åˆ¶å°è¯•éªŒ

ä½¿ç”¨æ§åˆ¶å°è¿›è¡Œé€šè®¯åº“è¯•éªŒï¼Œä»¥ä¸‹æ˜¯è¯•éªŒä½¿ç”¨çš„ä»£ç å’Œè¯•éªŒç»“æœå›¾

    using Mitsubishi.MelsecLib;
    using Mitsubishi.MelsecLib.Melsec4CBase;
    using System.IO.Ports;
    
    namespace MelsecTest
    {
        internal class Program
        {
            private static Melsec4CClient? plc;
    
            private static Melsec_4C_FormatEnum format;
    
            static async Task Main(string[] args)
            {
                plc = new Melsec4CClient("COM6",9600, Parity.Even,7,StopBits.Two);
    
                var isConnect = await plc.ConnectAsync(Melsec_4C_FormatEnum.Format1,true,false);
    
                if (isConnect)
                {
                    Console.WriteLine("è¯»å–X0ï½X6");
    
                    var result1 = await plc.ReadIOBitAsync(Melsec_4C_IOAreaEnum.IO_X, 0, 6);
    
                    foreach (var b in result1)
                    {
                        Console.WriteLine(b.ToString());
                    }
    
                    await Task.Delay(1000);
    
                    Console.WriteLine("è¯»å–M300ï½M306");
    
                    var result2 = await plc.ReadIOBitAsync(Melsec_4C_IOAreaEnum.IO_M, 300, 6);
    
                    foreach (var b in result2)
                    {
                        Console.WriteLine(b.ToString());
                    }
    
                    await Task.Delay(1000);
    
                    Console.WriteLine("è¯»å–D3000ï½D3006");
    
                    var result3 = await plc.ReadIOWordAsync(Melsec_4C_IOAreaEnum.IO_D, 3000, 6);
    
                    foreach (var b in result3)
                    {
                        Console.WriteLine(b.ToString());
                    }
    
                    await Task.Delay(1000);
    
                    Console.WriteLine("å†™å…¥M300ï½M306");
    
                    var result4 = await plc.WriteIOBitAsync(Melsec_4C_IOAreaEnum.IO_M, 300, new List<bool> { true, false, true, true, false, true });
    
                    if (result4)
                    {
                        Console.WriteLine("å†™å…¥M300ï½M306ï¼šOK");
                    }
                    else
                    {
                        Console.WriteLine("å†™å…¥M300ï½M306ï¼šNG");
                    }
    
                    await Task.Delay(1000);
    
                    Console.WriteLine("è¯»å–M300ï½M306");
    
                    var result5 = await plc.ReadIOBitAsync(Melsec_4C_IOAreaEnum.IO_M, 300, 6);
    
                    foreach (var b in result5)
                    {
                        Console.WriteLine(b.ToString());
                    }
    
                    await Task.Delay(1000);
    
                    Console.WriteLine("å†™å…¥D3000ï½D3006");
    
                    var result6 = await plc.WriteIOWordAsync(Melsec_4C_IOAreaEnum.IO_D, 3000, new List<short> { 11,22,33,44,55,66 });
    
                    if (result6)
                    {
                        Console.WriteLine("å†™å…¥D3000ï½D3006ï¼šOK");
                    }
                    else
                    {
                        Console.WriteLine("å†™å…¥D3000ï½D3006ï¼šNG");
                    }
    
                    await Task.Delay(1000);
    
                    Console.WriteLine("è¯»å–D3000ï½D3006");
    
                    var result7 = await plc.ReadIOWordAsync(Melsec_4C_IOAreaEnum.IO_D, 3000, 6);
    
                    foreach (var b in result7)
                    {
                        Console.WriteLine(b.ToString());
                    }
    
                    await Task.Delay(1000);
    
                    Console.WriteLine("æ¢å¤M300ï½M306");
    
                    await plc.WriteIOBitAsync(Melsec_4C_IOAreaEnum.IO_M, 300, new List<bool> { false, false, false, false, false, false });
    
                    await Task.Delay(1000);
    
                    Console.WriteLine("æ¢å¤D3000ï½D3006");
    
                    await plc.WriteIOWordAsync(Melsec_4C_IOAreaEnum.IO_D, 3000, new List<short> { 0, 0, 0, 0, 0, 0 });
    
                    await Task.Delay(1000);
                }
                else
                {
                    Console.WriteLine("è¿æ¥é”™è¯¯");
                }
    
                await plc.DisconnectAsync();
                Console.ReadKey();
            }
        }
    }
    
    

> è¯¦ç»†ä»£ç å¯å‚è€ƒï¼š**[é€šè®¯åº“é¡¹ç›®Gitee ä»“åº“](https://gitee.com/dragonet-Z/mitsubishi-melseclib)**

è¯•éªŒç»“æœå›¾å¦‚ä¸‹å›¾

![è¯•éªŒç»“æœå›¾](https://img2024.cnblogs.com/blog/2368008/202512/2368008-20251207214029741-1815339850.png)

* * *

åç»­
--

é¡¹ç›®è¿˜æœ‰å¾ˆå¤šå€¼å¾—æ”¹è¿›çš„åœ°æ–¹ï¼Œä¾‹å¦‚ä½¿ç”¨`ConcurrentQueue`å¤šçº¿ç¨‹é˜Ÿåˆ—æ¥å®ç°ä¸²å£é€šè®¯çš„é˜Ÿåˆ—ï¼›å¼€å‘4Cå¸§çš„å…¶ä»–æ ¼å¼å’ŒE71æ¨¡å—çš„é€šè®¯ä»£ç ç­‰ï¼Œè¿™äº›åç»­è¿›è¡Œæ”¹è¿›äº†éƒ½ä¼šåœ¨ä»“åº“ä¸Šè¿›è¡Œæ›´æ–°ã€‚ğŸ˜ƒ

**ä½œè€…**ï¼š[Dragonet-Z](https://www.cnblogs.com/dragonet-Z/)

**å‡ºå¤„**ï¼š[https://www.cnblogs.com/dragonet-Z/p/19318911](https://www.cnblogs.com/dragonet-Z/p/19318911)

**ç‰ˆæƒå£°æ˜**ï¼šæœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹æ®Šå£°æ˜å¤–ï¼Œå‡éµå¾ª[BY-NC-SA](https://creativecommons.org/licenses/by-nc-sa/4.0/)è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼