---
layout: post
title: 'StreamJsonRpc åœ¨ HagiCode ä¸­çš„æ·±åº¦é›†æˆä¸å®è·µ'
date: "2026-01-29T00:54:52Z"
---
StreamJsonRpc åœ¨ HagiCode ä¸­çš„æ·±åº¦é›†æˆä¸å®è·µ
==================================

StreamJsonRpc åœ¨ HagiCode ä¸­çš„æ·±åº¦é›†æˆä¸å®è·µ
==================================

> æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† HagiCodeï¼ˆåŸ PCodeï¼‰é¡¹ç›®å¦‚ä½•æˆåŠŸé›†æˆ Microsoft çš„ StreamJsonRpc é€šä¿¡åº“ï¼Œä»¥æ›¿æ¢åŸæœ‰çš„è‡ªå®šä¹‰ JSON-RPC å®ç°ï¼Œå¹¶è§£å†³äº†é›†æˆè¿‡ç¨‹ä¸­çš„æŠ€æœ¯ç—›ç‚¹ä¸æ¶æ„æŒ‘æˆ˜ã€‚

èƒŒæ™¯
--

StreamJsonRpc æ˜¯å¾®è½¯å®˜æ–¹ç»´æŠ¤çš„ç”¨äº .NET å’Œ TypeScript çš„ JSON-RPC é€šä¿¡åº“ï¼Œä»¥å…¶å¼ºå¤§çš„ç±»å‹å®‰å…¨ã€è‡ªåŠ¨ä»£ç†ç”Ÿæˆå’Œæˆç†Ÿçš„å¼‚å¸¸å¤„ç†æœºåˆ¶è‘—ç§°ã€‚åœ¨ HagiCode é¡¹ç›®ä¸­ï¼Œä¸ºäº†é€šè¿‡ ACP (Agent Communication Protocol) ä¸å¤–éƒ¨ AI å·¥å…·ï¼ˆå¦‚ iflow CLIã€OpenCode CLIï¼‰è¿›è¡Œé€šä¿¡ï¼Œå¹¶æ¶ˆé™¤æ—©æœŸè‡ªå®šä¹‰ JSON-RPC å®ç°å¸¦æ¥çš„ç»´æŠ¤æˆæœ¬å’Œæ½œåœ¨ Bugï¼Œé¡¹ç›®å†³å®šé›†æˆ StreamJsonRpcã€‚ç„¶è€Œï¼Œåœ¨é›†æˆè¿‡ç¨‹ä¸­é‡åˆ°äº†æµå¼ JSON-RPC ç‰¹æœ‰çš„æŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†ä»£ç†ç›®æ ‡ç»‘å®šå’Œæ³›å‹å‚æ•°è¯†åˆ«æ—¶ã€‚

ä¸ºäº†è§£å†³è¿™äº›ç—›ç‚¹ï¼Œæˆ‘ä»¬åšäº†ä¸€ä¸ªå¤§èƒ†çš„å†³å®šï¼šæ•´ä¸ªæ„å»ºç³»ç»Ÿæ¨å€’é‡æ¥ã€‚è¿™ä¸ªå†³å®šå¸¦æ¥çš„å˜åŒ–ï¼Œå¯èƒ½æ¯”ä½ æƒ³è±¡çš„è¿˜è¦å¤§â€”â€”ç¨åæˆ‘ä¼šå…·ä½“è¯´ã€‚

å…³äº HagiCode
-----------

> å…ˆä»‹ç»ä¸€ä¸‹æœ¬æ–‡çš„"ä¸»è§’é¡¹ç›®"

å¦‚æœä½ åœ¨å¼€å‘ä¸­é‡åˆ°è¿‡è¿™äº›çƒ¦æ¼ï¼š

*   å¤šé¡¹ç›®ã€å¤šæŠ€æœ¯æ ˆï¼Œæ„å»ºè„šæœ¬ç»´æŠ¤æˆæœ¬é«˜
*   CI/CD æµæ°´çº¿é…ç½®ç¹çï¼Œæ¯æ¬¡æ”¹éƒ½è¦æŸ¥æ–‡æ¡£
*   è·¨å¹³å°å…¼å®¹æ€§é—®é¢˜å±‚å‡ºä¸ç©·
*   æƒ³è®© AI å¸®å¿™å†™ä»£ç ï¼Œä½†ç°æœ‰å·¥å…·ä¸å¤Ÿæ™ºèƒ½

é‚£ä¹ˆæˆ‘ä»¬æ­£åœ¨åšçš„ HagiCode å¯èƒ½ä½ ä¼šæ„Ÿå…´è¶£ã€‚

**HagiCode æ˜¯ä»€ä¹ˆï¼Ÿ**

*   ä¸€æ¬¾ AI é©±åŠ¨çš„ä»£ç æ™ºèƒ½åŠ©æ‰‹
*   æ”¯æŒå¤šè¯­è¨€ã€è·¨å¹³å°çš„ä»£ç ç”Ÿæˆä¸ä¼˜åŒ–
*   å†…ç½®æ¸¸æˆåŒ–æœºåˆ¶ï¼Œè®©ç¼–ç ä¸å†æ¯ç‡¥

**ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œæå®ƒï¼Ÿ**  
æœ¬æ–‡åˆ†äº«çš„ StreamJsonRpc é›†æˆæ–¹æ¡ˆï¼Œæ­£æ˜¯æˆ‘ä»¬åœ¨å¼€å‘ HagiCode è¿‡ç¨‹ä¸­å®è·µæ€»ç»“å‡ºæ¥çš„ã€‚å¦‚æœä½ è§‰å¾—è¿™å¥—å·¥ç¨‹åŒ–æ–¹æ¡ˆæœ‰ä»·å€¼ï¼Œè¯´æ˜æˆ‘ä»¬çš„æŠ€æœ¯å“å‘³è¿˜ä¸é”™â€”â€”é‚£ä¹ˆ HagiCode æœ¬èº«ä¹Ÿå€¼å¾—å…³æ³¨ä¸€ä¸‹ã€‚

**æƒ³äº†è§£æ›´å¤šï¼Ÿ**

*   GitHub: [github.com/HagiCode-org/site](https://github.com/HagiCode-org/site)ï¼ˆæ±‚ Starï¼‰
*   å®˜ç½‘: [hagicode-org.github.io/site](https://hagicode-org.github.io/site)
*   è§†é¢‘æ¼”ç¤º: [www.bilibili.com/video/BV1pirZBuEzq/](https://www.bilibili.com/video/BV1pirZBuEzq/)ï¼ˆ30 åˆ†é’Ÿå®æˆ˜æ¼”ç¤ºï¼‰
*   å®‰è£…æŒ‡å—: [hagicode-org.github.io/site/docs/installation/docker-compose](https://hagicode-org.github.io/site/docs/installation/docker-compose)
*   å…¬æµ‹å·²å¼€å§‹ï¼šç°åœ¨å®‰è£…å³å¯å‚ä¸å…¬æµ‹

åˆ†æ
--

å½“å‰é¡¹ç›®å¤„äº ACP åè®®é›†æˆçš„å…³é”®é˜¶æ®µï¼Œé¢ä¸´ç€ä»¥ä¸‹å‡ ä¸ªæŠ€æœ¯ç—›ç‚¹å’Œæ¶æ„æŒ‘æˆ˜ï¼š

### 1\. è‡ªå®šä¹‰å®ç°çš„å±€é™

åŸæœ‰çš„ JSON-RPC å®ç°ä½äº `src/HagiCode.ClaudeHelper/AcpImp/`ï¼ŒåŒ…å« `JsonRpcEndpoint` å’Œ `ClientSideConnection` ç­‰ç»„ä»¶ã€‚ç»´æŠ¤è¿™å¥—è‡ªå®šä¹‰ä»£ç æˆæœ¬é«˜ï¼Œä¸”ç¼ºä¹æˆç†Ÿåº“çš„é«˜çº§åŠŸèƒ½ï¼ˆå¦‚è¿›åº¦æŠ¥å‘Šã€å–æ¶ˆæ”¯æŒï¼‰ã€‚

### 2\. StreamJsonRpc é›†æˆéšœç¢

åœ¨å°è¯•å°†ç°æœ‰çš„ `CallbackProxyTarget` æ¨¡å¼è¿ç§»åˆ° StreamJsonRpc æ—¶ï¼Œå‘ç° `_rpc.AddLocalRpcTarget(target)` æ–¹æ³•æ— æ³•è¯†åˆ«é€šè¿‡ä»£ç†æ¨¡å¼åˆ›å»ºçš„ç›®æ ‡ã€‚å…·ä½“è¡¨ç°ä¸ºï¼ŒStreamJsonRpc æ— æ³•è‡ªåŠ¨å°†æ³›å‹ç±»å‹ `T` çš„å±æ€§æ‹†åˆ†ä¸º RPC æ–¹æ³•å‚æ•°ï¼Œå¯¼è‡´æœåŠ¡å™¨ç«¯æ— æ³•æ­£ç¡®å¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„æ–¹æ³•è°ƒç”¨ã€‚

### 3\. æ¶æ„åˆ†å±‚æ··ä¹±

ç°æœ‰çš„ `ClientSideConnection` æ··åˆäº†ä¼ è¾“å±‚ï¼ˆWebSocket/Stdioï¼‰ã€åè®®å±‚ï¼ˆJSON-RPCï¼‰å’Œä¸šåŠ¡å±‚ï¼ˆACP Agent æ¥å£ï¼‰ï¼Œå¯¼è‡´èŒè´£ä¸æ¸…ï¼Œä¸”å­˜åœ¨ `AcpAgentCallbackRpcAdapter` æ–¹æ³•ç»‘å®šç¼ºå¤±çš„é—®é¢˜ã€‚

### 4\. æ—¥å¿—ç¼ºå¤±

WebSocket ä¼ è¾“å±‚ç¼ºå°‘å¯¹åŸå§‹ JSON å†…å®¹çš„æ—¥å¿—è¾“å‡ºï¼Œå¯¼è‡´åœ¨è°ƒè¯• RPC é€šä¿¡é—®é¢˜æ—¶éš¾ä»¥å®šä½æ˜¯åºåˆ—åŒ–é—®é¢˜è¿˜æ˜¯ç½‘ç»œé—®é¢˜ã€‚

è§£å†³
--

é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä»¥ä¸‹ç³»ç»ŸåŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œä»æ¶æ„é‡æ„ã€åº“é›†æˆå’Œè°ƒè¯•å¢å¼ºä¸‰ä¸ªç»´åº¦è¿›è¡Œä¼˜åŒ–ï¼š

### 1\. å…¨é¢è¿ç§»è‡³ StreamJsonRpc

#### ç§»é™¤æ—§ä»£ç 

åˆ é™¤ `JsonRpcEndpoint.cs`ã€`AgentSideConnection.cs` åŠç›¸å…³çš„è‡ªå®šä¹‰åºåˆ—åŒ–è½¬æ¢å™¨ï¼ˆ`JsonRpcMessageJsonConverter` ç­‰ï¼‰ã€‚

#### é›†æˆå®˜æ–¹åº“

å¼•å…¥ `StreamJsonRpc` NuGet åŒ…ï¼Œåˆ©ç”¨å…¶ `JsonRpc` ç±»å¤„ç†æ ¸å¿ƒé€šä¿¡é€»è¾‘ã€‚

#### æŠ½è±¡ä¼ è¾“å±‚

å®šä¹‰ `IAcpTransport` æ¥å£ï¼Œç»Ÿä¸€å¤„ç† `WebSocket` å’Œ `Stdio` ä¸¤ç§ä¼ è¾“æ¨¡å¼ï¼Œç¡®ä¿åè®®å±‚ä¸ä¼ è¾“å±‚è§£è€¦ã€‚

    // IAcpTransport æ¥å£å®šä¹‰
    public interface IAcpTransport
    {
        Task SendAsync(string message, CancellationToken cancellationToken = default);
        Task<string> ReceiveAsync(CancellationToken cancellationToken = default);
        Task CloseAsync(CancellationToken cancellationToken = default);
    }
    
    // WebSocket ä¼ è¾“å®ç°
    public class WebSocketTransport : IAcpTransport
    {
        private readonly WebSocket _webSocket;
    
        public WebSocketTransport(WebSocket webSocket)
        {
            _webSocket = webSocket;
        }
    
        // å®ç°å‘é€å’Œæ¥æ”¶æ–¹æ³•
        // ...
    }
    
    // Stdio ä¼ è¾“å®ç°
    public class StdioTransport : IAcpTransport
    {
        private readonly StreamReader _reader;
        private readonly StreamWriter _writer;
    
        public StdioTransport(StreamReader reader, StreamWriter writer)
        {
            _reader = reader;
            _writer = writer;
        }
    
        // å®ç°å‘é€å’Œæ¥æ”¶æ–¹æ³•
        // ...
    }
    

### 2\. ä¿®å¤ä»£ç†ç›®æ ‡è¯†åˆ«é—®é¢˜

#### åˆ†æ `CallbackProxyTarget`

æ£€æŸ¥ç°æœ‰çš„åŠ¨æ€ä»£ç†ç”Ÿæˆé€»è¾‘ï¼Œç¡®å®š StreamJsonRpc æ— æ³•è¯†åˆ«çš„æ ¹æœ¬åŸå› ï¼ˆé€šå¸¸æ˜¯å› ä¸ºä»£ç†å¯¹è±¡æ²¡æœ‰å…¬å¼€å®é™…çš„æ–¹æ³•ç­¾åï¼Œæˆ–è€…ä½¿ç”¨äº† StreamJsonRpc ä¸æ”¯æŒçš„å‚æ•°ç±»å‹ï¼‰ã€‚

#### é‡æ„å‚æ•°ä¼ é€’

å°†æ³›å‹å±æ€§æ‹†åˆ†ä¸ºæ˜ç¡®çš„ RPC æ–¹æ³•å‚æ•°ã€‚ä¸å†ä¾èµ–åŠ¨æ€å±æ€§ï¼Œè€Œæ˜¯å®šä¹‰å…·ä½“çš„ Request/Response DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰ï¼Œç¡®ä¿ StreamJsonRpc èƒ½é€šè¿‡åå°„æ­£ç¡®è¯†åˆ«æ–¹æ³•ç­¾åã€‚

    // åŸæœ‰çš„æ³›å‹å±æ€§æ–¹å¼
    public class CallbackProxyTarget<T>
    {
        public Func<T, Task> Callback { get; set; }
    }
    
    // é‡æ„åçš„å…·ä½“æ–¹æ³•æ–¹å¼
    public class ReadTextFileRequest
    {
        public string FilePath { get; set; }
    }
    
    public class ReadTextFileResponse
    {
        public string Content { get; set; }
    }
    
    public interface IAcpAgentCallback
    {
        Task<ReadTextFileResponse> ReadTextFileAsync(ReadTextFileRequest request);
        // å…¶ä»–æ–¹æ³•...
    }
    

#### ä½¿ç”¨ `Attach` æ›¿ä»£ `AddLocalRpcTarget`

åœ¨æŸäº›å¤æ‚åœºæ™¯ä¸‹ï¼Œæ‰‹åŠ¨ä»£ç† `JsonRpc` å¯¹è±¡å¹¶å¤„ç† `RpcConnection` å¯èƒ½æ¯”ç›´æ¥æ·»åŠ ç›®æ ‡æ›´çµæ´»ã€‚

### 3\. å®ç°æ–¹æ³•ç»‘å®šä¸æ—¥å¿—å¢å¼º

#### å®ç° `AcpAgentCallbackRpcAdapter`

ç¡®ä¿è¯¥ç»„ä»¶æ˜¾å¼å®ç° StreamJsonRpc çš„ä»£ç†æ¥å£ï¼Œå°† ACP åè®®å®šä¹‰çš„æ–¹æ³•ï¼ˆå¦‚ `ReadTextFileAsync`ï¼‰æ˜ å°„åˆ° StreamJsonRpc çš„å›è°ƒå¤„ç†å™¨ä¸Šã€‚

#### é›†æˆæ—¥å¿—è®°å½•

åœ¨ WebSocket æˆ– Stdio çš„æ¶ˆæ¯å¤„ç†ç®¡é“ä¸­ï¼Œæ‹¦æˆªå¹¶è®°å½• JSON-RPC è¯·æ±‚å’Œå“åº”çš„åŸå§‹æ–‡æœ¬ã€‚åˆ©ç”¨ `ILogger` åœ¨è§£æå‰å’Œåºåˆ—åŒ–åè¾“å‡ºåŸå§‹ payloadï¼Œä»¥ä¾¿æ’æŸ¥æ ¼å¼é”™è¯¯ã€‚

    // æ—¥å¿—å¢å¼ºçš„ä¼ è¾“åŒ…è£…å™¨
    public class LoggingAcpTransport : IAcpTransport
    {
        private readonly IAcpTransport _innerTransport;
        private readonly ILogger<LoggingAcpTransport> _logger;
    
        public LoggingAcpTransport(IAcpTransport innerTransport, ILogger<LoggingAcpTransport> logger)
        {
            _innerTransport = innerTransport;
            _logger = logger;
        }
    
        public async Task SendAsync(string message, CancellationToken cancellationToken = default)
        {
            _logger.LogTrace("Sending message: {Message}", message);
            await _innerTransport.SendAsync(message, cancellationToken);
        }
    
        public async Task<string> ReceiveAsync(CancellationToken cancellationToken = default)
        {
            var message = await _innerTransport.ReceiveAsync(cancellationToken);
            _logger.LogTrace("Received message: {Message}", message);
            return message;
        }
    
        public async Task CloseAsync(CancellationToken cancellationToken = default)
        {
            _logger.LogDebug("Closing connection");
            await _innerTransport.CloseAsync(cancellationToken);
        }
    }
    

### 4\. æ¶æ„åˆ†å±‚é‡æ„

#### ä¼ è¾“å±‚ (`AcpRpcClient`)

å°è£… StreamJsonRpc è¿æ¥ï¼Œè´Ÿè´£ `InvokeAsync` å’Œè¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

    public class AcpRpcClient : IDisposable
    {
        private readonly JsonRpc _rpc;
        private readonly IAcpTransport _transport;
    
        public AcpRpcClient(IAcpTransport transport)
        {
            _transport = transport;
            _rpc = new JsonRpc(new StreamRpcTransport(transport));
            _rpc.StartListening();
        }
    
        public async Task<TResponse> InvokeAsync<TResponse>(string methodName, object parameters)
        {
            return await _rpc.InvokeAsync<TResponse>(methodName, parameters);
        }
    
        public void Dispose()
        {
            _rpc.Dispose();
            _transport.Dispose();
        }
    
        // StreamRpcTransport æ˜¯å¯¹ IAcpTransport çš„ StreamJsonRpc é€‚é…å™¨
        private class StreamRpcTransport : IDuplexPipe
        {
            // å®ç° IDuplexPipe æ¥å£
            // ...
        }
    }
    

#### åè®®å±‚ (`IAcpAgentClient` / `IAcpAgentCallback`)

å®šä¹‰æ¸…æ™°çš„ client-to-agent å’Œ agent-to-client æ¥å£ï¼Œç§»é™¤ `Func<IAcpAgent, IAcpClient>` è¿™ç§å¾ªç¯ä¾èµ–çš„å·¥å‚æ¨¡å¼ï¼Œæ”¹ç”¨ä¾èµ–æ³¨å…¥æˆ–ç›´æ¥æ³¨å†Œå›è°ƒã€‚

å®è·µ
--

åŸºäº StreamJsonRpc çš„æœ€ä½³å®è·µå’Œé¡¹ç›®ç»éªŒï¼Œä»¥ä¸‹æ˜¯å®æ–½è¿‡ç¨‹ä¸­çš„å…³é”®å»ºè®®ï¼š

### 1\. å¼ºç±»å‹ DTO ä¼˜äºåŠ¨æ€å¯¹è±¡

StreamJsonRpc çš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºå¼ºç±»å‹ã€‚ä¸è¦ä½¿ç”¨ `dynamic` æˆ– `JObject` ä¼ é€’å‚æ•°ã€‚åº”ä¸ºæ¯ä¸ª RPC æ–¹æ³•å®šä¹‰æ˜ç¡®çš„ C# POCO ç±»ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ä»…è§£å†³äº†ä»£ç†ç›®æ ‡è¯†åˆ«é—®é¢˜ï¼Œè¿˜èƒ½åœ¨ç¼–è¯‘æ—¶å‘ç°ç±»å‹é”™è¯¯ã€‚

ç¤ºä¾‹ï¼šå°† `CallbackProxyTarget` ä¸­çš„æ³›å‹å±æ€§æ›¿æ¢ä¸º `ReadTextFileRequest` å’Œ `WriteTextFileRequest` ç­‰å…·ä½“ç±»ã€‚

### 2\. æ˜¾å¼å£°æ˜ Method Name

ä½¿ç”¨ `[JsonRpcMethod]` ç‰¹æ€§æ˜¾å¼æŒ‡å®š RPC æ–¹æ³•åç§°ï¼Œä¸è¦ä¾èµ–é»˜è®¤çš„æ–¹æ³•åæ˜ å°„ã€‚è¿™å¯ä»¥é˜²æ­¢å› å‘½åé£æ ¼å·®å¼‚ï¼ˆå¦‚ PascalCase vs camelCaseï¼‰å¯¼è‡´çš„è°ƒç”¨å¤±è´¥ã€‚

    public interface IAcpAgentCallback
    {
        [JsonRpcMethod("readTextFile")]
        Task<ReadTextFileResponse> ReadTextFileAsync(ReadTextFileRequest request);
        
        [JsonRpcMethod("writeTextFile")]
        Task WriteTextFileAsync(WriteTextFileRequest request);
    }
    

### 3\. åˆ©ç”¨è¿æ¥çŠ¶æ€å›è°ƒ

StreamJsonRpc æä¾›äº† `JsonRpc.ConnectionLost` äº‹ä»¶ã€‚åŠ¡å¿…ç›‘å¬æ­¤äº‹ä»¶ä»¥å¤„ç†è¿›ç¨‹æ„å¤–é€€å‡ºæˆ–ç½‘ç»œæ–­å¼€çš„æƒ…å†µï¼Œè¿™æ¯”å•çº¯ä¾èµ– Orleans çš„ Grain å¤±æ•ˆæ£€æµ‹æ›´åŠæ—¶ã€‚

    _rpc.ConnectionLost += (sender, e) =>
    {
        _logger.LogError("RPC connection lost: {Reason}", e.ToString());
        // å¤„ç†é‡è¿é€»è¾‘æˆ–é€šçŸ¥ç”¨æˆ·
    };
    

### 4\. æ—¥å¿—åˆ†å±‚è®°å½•

*   **Trace çº§åˆ«**ï¼šè®°å½•å®Œæ•´çš„ JSON Request/Response åŸæ–‡ã€‚
*   **Debug çº§åˆ«**ï¼šè®°å½•æ–¹æ³•è°ƒç”¨æ ˆå’Œå‚æ•°æ‘˜è¦ã€‚
*   **æ³¨æ„**ï¼šç¡®ä¿æ—¥å¿—ä¸­ä¸åŒ…å«æ•æ„Ÿçš„ Authorization Token æˆ–å¤§æ–‡ä»¶å†…å®¹çš„ Base64 ç¼–ç ã€‚

### 5\. å¤„ç†æµå¼ä¼ è¾“çš„ç‰¹æ®Šæ€§

StreamJsonRpc åŸç”Ÿæ”¯æŒ `IAsyncEnumerable`ã€‚åœ¨å®ç° ACP çš„æµå¼ Prompt å“åº”æ—¶ï¼Œåº”ç›´æ¥ä½¿ç”¨ `IAsyncEnumerable` è€Œä¸æ˜¯è‡ªå®šä¹‰çš„åˆ†é¡µé€»è¾‘ã€‚è¿™èƒ½æå¤§ç®€åŒ–æµå¼å¤„ç†çš„ä»£ç é‡ã€‚

    public interface IAcpAgentCallback
    {
        [JsonRpcMethod("streamText")]
        IAsyncEnumerable<string> StreamTextAsync(StreamTextRequest request);
    }
    

### 6\. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)

ä¿æŒ `ACPSession` å’Œ `ClientSideConnection` çš„åˆ†ç¦»ã€‚`ACPSession` åº”ä¸“æ³¨äº Orleans çš„çŠ¶æ€ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æ¶ˆæ¯å…¥é˜Ÿï¼‰ï¼Œé€šè¿‡ç»„åˆè€Œéç»§æ‰¿çš„æ–¹å¼ä½¿ç”¨ StreamJsonRpc è¿æ¥å¯¹è±¡ã€‚

æ€»ç»“
--

é€šè¿‡å…¨é¢é›†æˆ StreamJsonRpcï¼ŒHagiCode é¡¹ç›®æˆåŠŸè§£å†³äº†åŸè‡ªå®šä¹‰å®ç°çš„ç»´æŠ¤æˆæœ¬é«˜ã€åŠŸèƒ½å±€é™æ€§å’Œæ¶æ„åˆ†å±‚æ··ä¹±ç­‰é—®é¢˜ã€‚å…³é”®æ”¹è¿›åŒ…æ‹¬ï¼š

1.  é‡‡ç”¨å¼ºç±»å‹ DTO æ›¿ä»£åŠ¨æ€å±æ€§ï¼Œæé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯é æ€§
2.  å®ç°äº†ä¼ è¾“å±‚æŠ½è±¡å’Œåè®®å±‚åˆ†ç¦»ï¼Œæå‡äº†æ¶æ„çš„æ¸…æ™°æ€§
3.  å¢å¼ºäº†æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œä¾¿äºæ’æŸ¥é€šä¿¡é—®é¢˜
4.  å¼•å…¥äº†æµå¼ä¼ è¾“æ”¯æŒï¼Œç®€åŒ–äº†æµå¼å¤„ç†çš„å®ç°

è¿™äº›æ”¹è¿›ä¸º HagiCode æä¾›äº†æ›´ç¨³å®šã€æ›´é«˜æ•ˆçš„é€šä¿¡åŸºç¡€ï¼Œä½¿å…¶èƒ½å¤Ÿæ›´å¥½åœ°ä¸å¤–éƒ¨ AI å·¥å…·è¿›è¡Œäº¤äº’ï¼Œå¹¶ä¸ºæœªæ¥çš„åŠŸèƒ½æ‰©å±•å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚

å‚è€ƒèµ„æ–™
----

*   StreamJsonRpc å®˜æ–¹æ–‡æ¡£ï¼š[https://learn.microsoft.com/en-us/dotnet/api/microsoft.visualstudio.threading.streamjsonrpc](https://learn.microsoft.com/en-us/dotnet/api/microsoft.visualstudio.threading.streamjsonrpc)
*   ACP (Agent Communication Protocol) è§„èŒƒï¼š[https://github.com/microsoft/agentcommunicationprotocol](https://github.com/microsoft/agentcommunicationprotocol)
*   HagiCode é¡¹ç›®ï¼š[https://github.com/HagiCode-org/site](https://github.com/HagiCode-org/site)
*   Orleans å®˜æ–¹æ–‡æ¡£ï¼š[https://learn.microsoft.com/en-us/dotnet/orleans](https://learn.microsoft.com/en-us/dotnet/orleans)

* * *

å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼š

*   ç‚¹ä¸ªèµè®©æ›´å¤šäººçœ‹åˆ°
*   æ¥ GitHub ç»™ä¸ª Starï¼š[github.com/HagiCode-org/site](https://github.com/HagiCode-org/site)
*   è®¿é—®å®˜ç½‘äº†è§£æ›´å¤šï¼š[hagicode-org.github.io/site](https://hagicode-org.github.io/site)
*   è§‚çœ‹ 30 åˆ†é’Ÿå®æˆ˜æ¼”ç¤ºï¼š[www.bilibili.com/video/BV1pirZBuEzq/](https://www.bilibili.com/video/BV1pirZBuEzq/)
*   ä¸€é”®å®‰è£…ä½“éªŒï¼š[hagicode-org.github.io/site/docs/installation/docker-compose](https://hagicode-org.github.io/site/docs/installation/docker-compose)
*   å…¬æµ‹å·²å¼€å§‹ï¼Œæ¬¢è¿å®‰è£…ä½“éªŒ

* * *

æ„Ÿè°¢æ‚¨çš„é˜…è¯»,å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡æœ‰ç”¨,å¿«ç‚¹å‡»ä¸‹æ–¹ç‚¹èµæŒ‰é’®ğŸ‘,è®©æ›´å¤šçš„äººçœ‹åˆ°æœ¬æ–‡ã€‚

æœ¬å†…å®¹é‡‡ç”¨äººå·¥æ™ºèƒ½è¾…åŠ©åä½œ,ç»æœ¬äººå®¡æ ¸,ç¬¦åˆæœ¬äººè§‚ç‚¹ä¸ç«‹åœºã€‚

*   **æœ¬æ–‡ä½œè€…:** [newbe36524](https://www.newbe.pro)
*   **æœ¬æ–‡é“¾æ¥:** [https://hagicode-org.github.io/site/blog/2026/01/28/-streamjsonrpc-integration-in-hagicode-](https://hagicode-org.github.io/site/blog/2026/01/28/-streamjsonrpc-integration-in-hagicode-)
*   **ç‰ˆæƒå£°æ˜:** æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–,å‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„!