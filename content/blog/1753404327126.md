---
layout: post
title: 'ä¸ºå¤§æ¨¡å‹ MCP Code Interpreter è€Œç”Ÿï¼šC# Runner å¼€æºå‘å¸ƒ'
date: "2025-07-25T00:45:27Z"
---
ä¸ºå¤§æ¨¡å‹ MCP Code Interpreter è€Œç”Ÿï¼šC# Runner å¼€æºå‘å¸ƒ
===========================================

åœ¨7æœˆåˆï¼Œæˆ‘ç«‹ä¸‹äº†ä¸€ä¸ª Flagï¼šè¦åšä¸€ä¸ªä¸“é—¨ä¸ºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è®¾è®¡çš„ C# è¿è¡Œå™¨ MCP (Model-Protocol-Context)ã€‚æˆ‘çš„å°å°æ‰§å¿µï¼Œæ˜¯å¸Œæœ› C# èƒ½å¤Ÿåƒ Python ä¸€æ ·ï¼Œæˆä¸ºå¤§æ¨¡å‹ä¸–ç•Œé‡Œçš„ä¸€ç­‰å…¬æ°‘ã€‚

ç»è¿‡ä¸€æ®µæ—¶é—´çš„æ„æ€ã€è¸©å‘å’Œå¼€å‘ï¼Œä»Šå¤©ï¼Œæˆ‘éå¸¸é«˜å…´åœ°å‘å¤§å®¶å®£å¸ƒï¼šè¿™ä¸ªé¡¹ç›®â€”â€” **C# Runner** å·²ç»æ­£å¼å¼€æºå‘å¸ƒäº†ï¼

è¿™æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å®‰å…¨æ€§çš„ C# ä»£ç åœ¨çº¿æ‰§è¡Œå¹³å°ï¼ˆæ²™ç®±ï¼‰ï¼Œä¸“ä¸ºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„ Function Callingã€åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ã€åŠ¨æ€è„šæœ¬æ‰§è¡Œç­‰åœºæ™¯è€Œè®¾è®¡ã€‚æˆ‘çš„ç›®æ ‡å¾ˆç®€å•ï¼š**ä¸º C# åœ¨ AI æµªæ½®ä¸­äº‰å¾—ä¸€å¸­ä¹‹åœ°ï¼Œä½¿å…¶æˆä¸ºåƒ Python ä¸€æ ·è¢«å¤§æ¨¡å‹è½»æ¾è°ƒåº¦çš„â€œä¸€ç­‰å…¬æ°‘â€**ã€‚

è¿™ä¸ªé¡¹ç›®çš„è¯ç”Ÿï¼Œæºäºæˆ‘æ­¤å‰å¯¹å®ç°â€œæ¯«ç§’çº§ã€é«˜å®‰å…¨æ€§â€æ‰§è¡Œ C# ä»£ç æ–¹æ¡ˆçš„å¤§é‡ç ”ç©¶å’Œå®éªŒã€‚ç°åœ¨ï¼Œæˆ‘å°†è¿™äº›æˆæœå‡èšæˆäº† C# Runnerã€‚

**é¡¹ç›®åœ°å€ï¼š[https://github.com/sdcb/csharp-runner](https://github.com/sdcb/csharp-runner)**

ç¼˜èµ·ï¼šä¸€ä¸ªæ¯«ç§’çº§çš„æ¢¦æƒ³
-----------

ä¸€åˆ‡å§‹äºä¸€ä¸ªç®€å•è€Œåˆæå…·æŒ‘æˆ˜æ€§çš„ç›®æ ‡ï¼š

> åœ¨ã€Œå†·å¯åŠ¨ã€åœºæ™¯ä¸‹ï¼ŒæŠŠä¸€æ®µæœªçŸ¥ã€å¯èƒ½ä¸å¯ä¿¡çš„ C# ä»£ç ç¼–è¯‘å¹¶æ‰§è¡Œå®Œæ¯•çš„æ—¶é—´æ§åˆ¶åœ¨ 100ms ä»¥å†…ï¼ˆç†æƒ³ < 20msï¼‰ï¼ŒåŒæ—¶ä¿è¯ç»å¯¹çš„å®‰å…¨ã€å¯ä¼¸ç¼©å’Œè·¨å¹³å°ã€‚

ç°åœ¨å¤§æ¨¡å‹çš„ Function Calling æˆ– Code Interpreter åŸºæœ¬éƒ½æ˜¯è·‘ Pythonï¼Œè¿™è®©æˆ‘å¾ˆä¸ç”˜å¿ƒã€‚æˆ‘å¸Œæœ›æ„å»ºä¸€ä¸ªæœåŠ¡ï¼Œèƒ½è®© C# ä»£ç çš„æ‰§è¡Œä½“éªŒå¦‚ä¸èˆ¬é¡ºæ»‘ï¼Œå¿«åˆ°æ¯«ç§’çº§åˆ«ï¼›åŒæ—¶å®ƒå¿…é¡»å›ºè‹¥é‡‘æ±¤ï¼Œå³ä½¿ç”¨æˆ·æäº¤äº†æ¶æ„ä»£ç ï¼Œä¹Ÿæ— æ³•å¯¹æœåŠ¡å™¨é€ æˆä»»ä½•å±å®³ã€‚

åœ¨å¾ˆå¤šç°ä»£åº”ç”¨åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬éƒ½æ¸´æœ›èƒ½åŠ¨æ€åœ°æ‰§è¡Œç”¨æˆ·æä¾›çš„ C# ä»£ç ã€‚ç„¶è€Œï¼Œè¿™é¢ä¸´ç€ä¸¤å¤§æ ¸å¿ƒæŒ‘æˆ˜ï¼š

1.  **æ€§èƒ½**ï¼šå¸¸è§„çš„ `dotnet run` æ–¹å¼æ¶‰åŠåˆ° MSBuildã€é¡¹ç›®è¿˜åŸç­‰é‡åº¦æ“ä½œï¼Œè€—æ—¶é€šå¸¸åœ¨æ•°ç™¾ç”šè‡³ä¸Šåƒæ¯«ç§’ï¼Œå®Œå…¨æ— æ³•æ»¡è¶³äº¤äº’å¼åœºæ™¯çš„æ€§èƒ½è¦æ±‚ã€‚
2.  **å®‰å…¨**ï¼šæ‰§è¡Œä¸€æ®µæœªçŸ¥çš„ã€å¯èƒ½ä¸å¯ä¿¡çš„ä»£ç ï¼Œæ— å¼‚äºåœ¨æœåŠ¡å™¨ä¸Šâ€œè£¸å¥”â€ã€‚å¿…é¡»æœ‰ä¸‡æ— ä¸€å¤±çš„æ²™ç®±æœºåˆ¶æ¥é˜²æ­¢æ¶æ„ä»£ç ç ´åç³»ç»Ÿã€çªƒå–æ•°æ®æˆ–æ»¥ç”¨èµ„æºã€‚

**C# Runner** æ­£æ˜¯ä¸ºè§£å†³è¿™ä¸€å¯¹æ ¸å¿ƒçŸ›ç›¾è€Œç”Ÿã€‚

æ•ˆæœæ¼”ç¤º
----

ä¸ºäº†ç›´è§‚å±•ç¤º C# Runner çš„æ€§èƒ½ï¼Œæˆ‘å°†ä¸€ä¸ªç¤ºä¾‹ç½‘ç«™éƒ¨ç½²åˆ°äº† Azure ä¸Šã€‚å¹¶ä¸”ä¸ºäº†å¢åŠ æŒ‘æˆ˜ï¼Œæˆ‘åªé€‰æ‹©äº†ä¸€å° 1GB å†…å­˜çš„ã€Azure ä¸Šæœ€ä¾¿å®œçš„è™šæ‹Ÿæœºã€‚

**æ¼”ç¤ºåœ°å€ï¼š[https://csharp.starworks.cc/](https://csharp.starworks.cc/)**

åœ¨è¿™ä¸ªç½‘ç«™ä¸Šï¼Œä½ å¯ä»¥ç›´æ¥è¾“å…¥ C# ä»£ç å¹¶æ‰§è¡Œï¼Œä½“éªŒæ¯«ç§’çº§çš„å“åº”é€Ÿåº¦ã€‚æ— è®ºæ˜¯ç®€å•çš„ `Console.WriteLine`ï¼Œè¿˜æ˜¯å¤æ‚çš„è®¡ç®—é€»è¾‘ï¼Œéƒ½èƒ½åœ¨æçŸ­æ—¶é—´å†…å®Œæˆã€‚

å®ƒé»˜è®¤å·²ç»å†™äº†ä¸€æ®µç®€å•çš„ä»£ç ï¼Œä½ å¯ä»¥å»ä¿®æ”¹å®ƒï¼Œç„¶åç‚¹å‡» **Run Code** æŒ‰é’®ï¼Œæ‰§è¡Œç»“æœä¼šæ˜¾ç¤ºåœ¨ä¸‹æ–¹çš„ Output åŒºåŸŸï¼š

![demo](https://img2024.cnblogs.com/blog/233608/202507/233608-20250724225512622-239615818.png)

å¦‚æœä½ ç»†å¿ƒè§‚å¯Ÿï¼Œä¼šå‘ç°è¿™ä¸ª Output åŒºåŸŸæ˜¯å®æ—¶æ›´æ–°çš„ã€‚è¿™å¾—ç›Šäº C# Runner å¯¹æµå¼è¾“å‡ºï¼ˆServer-Sent Events, SSEï¼‰çš„æ”¯æŒï¼Œä½ å¯ä»¥å®æ—¶çœ‹åˆ°ä»£ç çš„ `stdout`ã€`stderr` å’Œæœ€ç»ˆç»“æœã€‚

è¿™æ˜¯ç›®å‰è¿™å° Azure è™šæ‹Ÿæœºçš„ `htop` è´Ÿè½½æƒ…å†µï¼Œèµ„æºå ç”¨éå¸¸ä½ï¼š

![htop](https://img2024.cnblogs.com/blog/233608/202507/233608-20250724225518446-63624650.png)

C# Runner æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
-----------------

ä¸ºäº†åŒæ—¶å®ç°æè‡´çš„æ€§èƒ½å’Œå¼ºå¤§çš„å®‰å…¨æ€§ï¼ŒC# Runner é‡‡ç”¨äº†**åŸºäº Docker çš„ Host-Worker æ¶æ„**ã€‚

*   **Worker**ï¼šæ¯ä¸ª Worker éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€è½»é‡çº§çš„ Docker å®¹å™¨ã€‚å®ƒæ˜¯ä¸€ä¸ªå·²ç»åŠ è½½äº† Roslyn Scripting ç¯å¢ƒçš„ Web æœåŠ¡ï¼Œè´Ÿè´£å®é™…ç¼–è¯‘å’Œæ‰§è¡Œ C# ä»£ç ã€‚
*   **Host**ï¼šHost æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å…¥å£å’Œâ€œå¤§è„‘â€ã€‚å®ƒç»´æŠ¤ç€ä¸€ä¸ªç”±å¤šä¸ª Worker ç»„æˆçš„â€œèµ„æºæ± â€ã€‚è¿™äº› Worker åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å°±å·²ç»**æå‰åˆ›å»ºå¹¶é¢„çƒ­**ï¼Œéšæ—¶å¯ä»¥æ¥æ”¶ä»»åŠ¡ã€‚

å½“ä¸€ä¸ªä»£ç æ‰§è¡Œè¯·æ±‚åˆ°è¾¾ Host æ—¶ï¼ŒHost ä¼šé€šè¿‡è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ï¼‰é€‰æ‹©ä¸€ä¸ªç©ºé—²çš„ Workerï¼Œå¹¶å°†ä»£ç äº¤ç»™å®ƒæ‰§è¡Œã€‚è¿™ç§â€œ**æ± åŒ– + é¢„çƒ­**â€çš„æ¨¡å¼ï¼Œå®Œç¾è§„é¿äº† Docker å†·å¯åŠ¨çš„æ€§èƒ½å¼€é”€ï¼Œä½¿å¾—ç»ˆç«¯ç”¨æˆ·å¯ä»¥äº«å—åˆ°æ¯«ç§’çº§çš„å“åº”é€Ÿåº¦ã€‚

âœ¨ æ ¸å¿ƒç‰¹æ€§ä¸€è§ˆ
--------

#### ğŸ”’ å®‰å…¨ä¸ºæœ¬ (Security First)

*   **å®¹å™¨çº§éš”ç¦»**: æ‰€æœ‰ä»£ç å‡åœ¨ç‹¬ç«‹çš„ Docker Worker å®¹å™¨ä¸­æ‰§è¡Œï¼Œä¸ä¸»æœºç¯å¢ƒå½»åº•éš”ç¦»ã€‚
*   **èµ„æºç²¾ç»†æ§åˆ¶**: å¯é€šè¿‡ Docker Compose ç²¾ç¡®é™åˆ¶æ¯ä¸ª Worker çš„ CPUã€å†…å­˜ã€è¿›ç¨‹æ•°ç­‰èµ„æºï¼Œé˜²æ­¢èµ„æºæ»¥ç”¨ã€‚
*   **æ‰§è¡Œè¶…æ—¶**: æ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢æ¶æ„æ­»å¾ªç¯ä»£ç ã€‚
*   **è‡ªåŠ¨å›æ”¶**: å¯é…ç½® Worker æ‰§è¡Œ N æ¬¡ä»»åŠ¡åè‡ªåŠ¨é”€æ¯å¹¶ç”±æ–°çš„çº¯å‡€å®ä¾‹å–ä»£ï¼Œæœç»ç¯å¢ƒæ±¡æŸ“ã€‚

#### âš¡ æ€§èƒ½è‡³ä¸Š (Performance is Key)

*   **Worker é¢„çƒ­ä¸æ± åŒ–**: C# Runner çš„â€œç§˜å¯†æ­¦å™¨â€ï¼Œå°†å®¹å™¨å¯åŠ¨å’Œç¯å¢ƒåˆå§‹åŒ–çš„å¼€é”€æå‰ï¼Œä¿è¯ä¸šåŠ¡è¯·æ±‚çš„é«˜æ€§èƒ½å“åº”ã€‚
*   **Roslyn Scripting API**: é‡‡ç”¨å†…å­˜ä¸­ç¼–è¯‘æ‰§è¡Œçš„æ–¹å¼ï¼Œé€Ÿåº¦è¿œè¶…ä¼ ç»Ÿ `dotnet run`ã€‚
*   **è´Ÿè½½å‡è¡¡**: Host è‡ªåŠ¨å°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ª Workerï¼Œè½»æ¾å®ç°æ°´å¹³æ‰©å±•ã€‚

#### ğŸŒ åŠŸèƒ½ä¸°å¯Œ (Feature-Rich & Ready to Use)

*   **åŒåè®®æ”¯æŒ**: åŒæ—¶æä¾› **HTTP REST API** å’Œ **MCP (Model-Protocol-Context)** æ¥å£ï¼Œæ— ç¼å¯¹æ¥ä¼ ç»Ÿåº”ç”¨å’Œ AI Agentã€‚
*   **æµå¼è¾“å‡º (SSE)**: å®æ—¶è¿”å›ä»£ç çš„ `stdout`ã€`stderr` å’Œæœ€ç»ˆç»“æœï¼Œäº¤äº’ä½“éªŒæµç•…ã€‚
*   **å†…ç½® Web UI**: æä¾›ä¸€ä¸ªç¾è§‚ã€æ˜“ç”¨çš„ä»£ç ç¼–è¾‘å™¨ï¼Œæ”¯æŒè¯­æ³•é«˜äº®å’Œ `Ctrl+Enter` å¿«æ·æ‰§è¡Œï¼Œæ–¹ä¾¿å¿«é€Ÿæµ‹è¯•å’Œæ¼”ç¤ºã€‚
*   **ä¸€é”®éƒ¨ç½²**: æä¾›å®Œæ•´çš„ Docker Compose è§£å†³æ–¹æ¡ˆï¼Œä¸€æ¡å‘½ä»¤å³å¯å¯åŠ¨æ•´ä¸ªæœåŠ¡ã€‚

ğŸš€ 60 ç§’å¿«é€Ÿéƒ¨ç½²
-----------

ä½“éªŒ C# Runner éå¸¸ç®€å•ï¼Œä½ åªéœ€è¦æå‰å®‰è£…å¥½ Docker å’Œ Docker Composeã€‚

**1\. ä¸‹è½½ `docker-compose.yml` æ–‡ä»¶**

    curl -L https://raw.githubusercontent.com/sdcb/csharp-runner/refs/heads/master/docker-compose.yml -o docker-compose.yml
    

**2\. ä¸€é”®å¯åŠ¨æœåŠ¡**

    docker compose up -d
    

> è¯¥å‘½ä»¤ä¼šé»˜è®¤å¯åŠ¨ 1 ä¸ª Host å’Œ 3 ä¸ª Worker å®ä¾‹ã€‚

**3\. å¼€å§‹ä½¿ç”¨ï¼**

éƒ¨ç½²æˆåŠŸåï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://localhost:5050`ï¼Œå³å¯çœ‹åˆ°ä¸€ä¸ªç®€æ´çš„ä»£ç ç¼–è¾‘ç•Œé¢ï¼Œå¼€å§‹ä½ çš„ C# ä»£ç æ‰§è¡Œä¹‹æ—…ï¼

ğŸ”§ çµæ´»é…ç½®ä¸ä½¿ç”¨
----------

ä½ å¯ä»¥é€šè¿‡ `docker-compose.yml` æ–‡ä»¶è½»æ¾è°ƒæ•´ Worker çš„æ•°é‡ã€èµ„æºé™åˆ¶ä»¥åŠå›æ”¶ç­–ç•¥ï¼Œä»¥é€‚åº”ä¸åŒçš„è´Ÿè½½åœºæ™¯ã€‚

ä¾‹å¦‚ï¼Œå°† `replicas` ä¿®æ”¹ä¸º `10`ï¼Œå³å¯è½»æ¾å°†åç«¯å¤„ç†èƒ½åŠ›æ‰©å±•åˆ° 10 ä¸ª Worker å®ä¾‹ã€‚

    # docker-compose.yml
    services:
      # ... host service ...
      worker:
        # ...
        deploy:
          replicas: 10 # å°† Worker å®ä¾‹æ‰©å±•åˆ° 10 ä¸ª
          resources:
            limits:
              cpus: '0.50'
              memory: 256M
    

æ— è®ºæ˜¯é€šè¿‡å…¶ **HTTP API** é›†æˆåˆ°ä½ çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œè¿˜æ˜¯é€šè¿‡ **MCP ç«¯ç‚¹** empowering ä½ çš„ AI Agentï¼ŒC# Runner éƒ½æä¾›äº†æ¸…æ™°ã€ç®€å•çš„è°ƒç”¨æ–¹å¼ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è€ƒé¡¹ç›®ä¸»é¡µçš„ API æ–‡æ¡£ã€‚

åŸºäº MCP åè®®è°ƒç”¨
-----------

å¦‚æœä½ éœ€è¦ MCP åè®®ï¼Œå¹¶å¸Œæœ›é€šè¿‡å®ƒæ¥è°ƒç”¨ C# Runnerï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç¤ºä¾‹ï¼š

    var clientTransport = new SseClientTransport(new SseClientTransportOptions()
    {
        Name = "MyServer",
        Endpoint = new Uri("https://csharp.starworks.cc/mcp"),
    });
    
    var client = await McpClientFactory.CreateAsync(clientTransport);
    
    // Execute a tool (this would normally be driven by LLM tool invocations).
    (await client.CallToolAsync(
        "run_code",
        new Dictionary<string, object?>() { ["code"] = "Console.WriteLine(\"Hello World!\");" },
        new ProgressReporter(),
        cancellationToken: CancellationToken.None))
    .StructuredContent.Dump();
    
    
    public class ProgressReporter : IProgress<ProgressNotificationValue>
    {
        public void Report(ProgressNotificationValue value)
        {
            value.Dump();
        }
    }
    

è¾“å‡ºå°†æ˜¯å®æ—¶çš„æµå¼ç»“æœï¼š

    {"kind":"stdout","stdOutput":"Hello World!\n"}
    {
      "kind": "end",
      "stdOutput": "Hello World!\n",
      "elapsed": 30
    }
    

æ€»ç»“
--

C# Runner ä¸º .NET ç”Ÿæ€æä¾›äº†ä¸€ä¸ªå¼€ç®±å³ç”¨ã€å…¼é¡¾æ€§èƒ½ä¸å®‰å…¨çš„åŠ¨æ€ä»£ç æ‰§è¡Œè§£å†³æ–¹æ¡ˆã€‚æˆ‘å¸Œæœ›å®ƒèƒ½æˆä¸ºæ‚¨åœ¨æ„å»ºä¸‹ä¸€ä»£åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯ä¸ AI ç»“åˆçš„åº”ç”¨æ—¶çš„å¾—åŠ›å·¥å…·ã€‚

è¿™ä¸ªé¡¹ç›®æ˜¯æˆ‘ä¸ªäººçš„ä¸€æ¬¡æ¢ç´¢ï¼Œä¹Ÿå¿…ç„¶æœ‰è®¸å¤šå¯ä»¥æ”¹è¿›çš„åœ°æ–¹ã€‚æ¬¢è¿å¤§å®¶è¯•ç”¨ã€åé¦ˆï¼Œç”šè‡³å‚ä¸è´¡çŒ®ï¼

*   **ä¸ºé¡¹ç›®ç‚¹äº® Star â­**ï¼Œè¿™æ˜¯å¯¹æˆ‘æœ€å¤§çš„é¼“åŠ±ï¼š[https://github.com/sdcb/csharp-runner](https://github.com/sdcb/csharp-runner)
*   **æäº¤ä½ çš„æƒ³æ³•å’Œä»£ç **ï¼šæ¬¢è¿é€šè¿‡ Issue å’Œ Pull Request å‚ä¸é¡¹ç›®ã€‚
*   **åŠ å…¥ QQ ç¾¤è®¨è®º**ï¼šæ¬¢è¿åŠ å…¥ **.NET éªšæ“ä½œ QQ ç¾¤ï¼š495782587**ï¼Œä¸€èµ·äº¤æµ .NET å’Œ AI çš„æœ‰è¶£ç©æ³•ï¼