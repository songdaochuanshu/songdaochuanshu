---
layout: post
title: 'Flaskæ•°æ®åº“æ“ä½œè¿›é˜¶ï¼šå‘Šåˆ«è£¸å†™SQLï¼Œç”¨ORMæå‡å¼€å‘æ•ˆç‡'
date: "2025-12-09T00:43:49Z"
---
Flaskæ•°æ®åº“æ“ä½œè¿›é˜¶ï¼šå‘Šåˆ«è£¸å†™SQLï¼Œç”¨ORMæå‡å¼€å‘æ•ˆç‡
===============================

æœ¬æ–‡æ·±å…¥è®²è§£Flaskä¸­æ•°æ®åº“æ“ä½œçš„è¿›é˜¶æŠ€å·§ï¼Œé‡ç‚¹ä»‹ç»ä½¿ç”¨SQLAlchemyè¿›è¡ŒORMé›†æˆçš„æ–¹æ³•ã€‚å†…å®¹æ¶µç›–æ¨¡å‹å®šä¹‰ã€å…³ç³»æ˜ å°„ã€æŸ¥è¯¢ä¼˜åŒ–å’Œäº‹åŠ¡ç®¡ç†ï¼Œé€šè¿‡å®Œæ•´ä»£ç ç¤ºä¾‹å±•ç¤ºå¦‚ä½•æ„å»ºä¸€ä¸ªç®€æ˜“åšå®¢ç³»ç»Ÿï¼Œå¸®åŠ©å¼€å‘è€…é¿å…å¸¸è§é™·é˜±ï¼Œæå‡åº”ç”¨æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ï¼Œé€‚åˆæœ‰ä¸€å®šFlaskåŸºç¡€çš„è¯»è€…å­¦ä¹ å®è·µã€‚

è¿˜åœ¨ä¸ºFlaskä¸­æ‰‹åŠ¨æ‹¼æ¥SQLè¯­å¥è€Œçƒ¦æ¼ï¼Œæ‹…å¿ƒå®‰å…¨æ¼æ´å’Œä»£ç ç»´æŠ¤éš¾é¢˜ï¼Ÿ**æ®ç»Ÿè®¡ï¼Œè¶…è¿‡65%çš„Flaskåˆå­¦è€…å› æ•°æ®åº“æ“ä½œä¸å½“å¯¼è‡´é¡¹ç›®æ€§èƒ½ä¸‹é™æˆ–å®‰å…¨é£é™©**ï¼Œè€ŒæŒæ¡ORMæŠ€æœ¯åï¼Œå¼€å‘æ•ˆç‡å¯æå‡300%ï¼

> æœ¬æ–‡äº®ç‚¹ï¼šä»Flask-SQLAlchemyåŸºç¡€é›†æˆåˆ°é«˜çº§æŸ¥è¯¢ä¼˜åŒ–ï¼Œè¯¦è§£ORMæ¨¡å‹å®šä¹‰ã€å…³ç³»æ˜ å°„ã€è¿ç§»å·¥å…·ä½¿ç”¨ï¼Œå¹¶åŒ…å«äº‹åŠ¡ç®¡ç†å’Œé”™è¯¯å¤„ç†å®æˆ˜æŠ€å·§ã€‚é™„å®Œæ•´ä»£ç ç¤ºä¾‹ï¼Œå¸®ä½ æ„å»ºå¯ç»´æŠ¤çš„æ•°æ®åº“å±‚ã€‚  
>   
> ç›®å½•ï¼š  
> \- âœ¨ ä¸ºä»€ä¹ˆéœ€è¦ORMï¼šå‘Šåˆ«åŸç”ŸSQLçš„ç—›ç‚¹  
> \- ğŸ”§ Flask-SQLAlchemyå¿«é€Ÿé›†æˆ  
> \- ğŸš€ æ¨¡å‹å®šä¹‰ä¸å…³ç³»æ˜ å°„å®æˆ˜  
> \- âš¡ æŸ¥è¯¢ä¼˜åŒ–ï¼šæ‡’åŠ è½½ä¸è¿æ¥æŸ¥è¯¢  
> \- ğŸ›¡ï¸ äº‹åŠ¡ç®¡ç†ä¸é”™è¯¯å¤„ç†  
> \- ğŸ’» å®Œæ•´ä»£ç ï¼šä¸€ä¸ªç®€æ˜“åšå®¢ç³»ç»Ÿ

âœ¨ ä¸ºä»€ä¹ˆéœ€è¦ORMï¼šå‘Šåˆ«åŸç”ŸSQLçš„ç—›ç‚¹
---------------------

åœ¨Flaské¡¹ç›®ä¸­ï¼Œç›´æ¥ä½¿ç”¨`sqlite3`æˆ–`pymysql`è£¸å†™SQLï¼Œè™½ç„¶çµæ´»ï¼Œä½†å¾ˆå¿«ä½ ä¼šé‡åˆ°ï¼š

\- SQLæ³¨å…¥é£é™©ï¼Œéœ€è¦æ‰‹åŠ¨è½¬ä¹‰å‚æ•°

\- ä»£ç é‡å¤åº¦é«˜ï¼Œç»´æŠ¤å›°éš¾

\- æ•°æ®åº“åˆ‡æ¢æ—¶ï¼ŒSQLè¯­æ³•å·®å¼‚å¯¼è‡´é‡å†™

ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰å°†æ•°æ®åº“è¡¨æ˜ å°„ä¸ºPythonç±»ï¼Œè®©ä½ ç”¨é¢å‘å¯¹è±¡æ–¹å¼æ“ä½œæ•°æ®ã€‚**Flask-SQLAlchemyä½œä¸ºä¸»æµORMï¼Œä¸ä»…æå‡å¼€å‘é€Ÿåº¦ï¼Œè¿˜å†…ç½®å®‰å…¨æœºåˆ¶å’ŒæŸ¥è¯¢ä¼˜åŒ–**ï¼Œæ˜¯è¿›é˜¶å¿…å¤‡æŠ€èƒ½ã€‚

ğŸ”§ Flask-SQLAlchemyå¿«é€Ÿé›†æˆ
-----------------------

åªéœ€å‡ æ­¥ï¼Œå°†æ•°æ®åº“èå…¥Flaskåº”ç”¨ã€‚é¦–å…ˆå®‰è£…ï¼š`pip install flask-sqlalchemy`ï¼Œç„¶ååœ¨åº”ç”¨ä¸­é…ç½®ï¼š

    from flask import Flask
    from flask_sqlalchemy import SQLAlchemy
    
    app = Flask(__name__)
    # é…ç½®SQLiteæ•°æ®åº“URIï¼Œä¹Ÿå¯æ›¿æ¢ä¸ºMySQLæˆ–PostgreSQL
    app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///site.db'
    app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False  # å…³é—­è­¦å‘Š
    db = SQLAlchemy(app)

**å…³é”®é…ç½®é¡¹**ï¼š`SQLALCHEMY_DATABASE_URI`å®šä¹‰è¿æ¥å­—ç¬¦ä¸²ï¼›å…³é—­`SQLALCHEMY_TRACK_MODIFICATIONS`å¯é¿å…æ€§èƒ½å¼€é”€ã€‚é›†æˆåï¼Œ`db`å¯¹è±¡ç®¡ç†æ‰€æœ‰æ•°æ®åº“æ“ä½œã€‚

ğŸš€ æ¨¡å‹å®šä¹‰ä¸å…³ç³»æ˜ å°„å®æˆ˜
--------------

ç”¨Pythonç±»å®šä¹‰è¡¨ç»“æ„ï¼ŒFlask-SQLAlchemyè‡ªåŠ¨å»ºè¡¨ã€‚ä¾‹å¦‚ï¼Œæ„å»ºç”¨æˆ·å’Œæ–‡ç« æ¨¡å‹ï¼š

    class User(db.Model):
        id = db.Column(db.Integer, primary_key=True)
        username = db.Column(db.String(80), unique=True, nullable=False)
        email = db.Column(db.String(120), unique=True)
        # å®šä¹‰ä¸€å¯¹å¤šå…³ç³»ï¼šä¸€ä¸ªç”¨æˆ·æœ‰å¤šç¯‡æ–‡ç« 
        posts = db.relationship('Post', backref='author', lazy=True)
    
    class Post(db.Model):
        id = db.Column(db.Integer, primary_key=True)
        title = db.Column(db.String(100), nullable=False)
        content = db.Column(db.Text)
        user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)
    
    # åˆ›å»ºæ‰€æœ‰è¡¨
    with app.app_context():
        db.create_all()

**å…³ç³»æ˜ å°„æ˜¯ORMæ ¸å¿ƒ**ï¼š`db.relationship`å®šä¹‰é€»è¾‘å…³è”ï¼Œ`db.ForeignKey`ç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚é€šè¿‡`user.posts`å¯ç›´æ¥è®¿é—®ç”¨æˆ·çš„æ–‡ç« åˆ—è¡¨ï¼Œæ— éœ€æ‰‹åŠ¨JOINã€‚

âš¡ æŸ¥è¯¢ä¼˜åŒ–ï¼šæ‡’åŠ è½½ä¸è¿æ¥æŸ¥è¯¢
---------------

åŸºç¡€CRUDæ“ä½œç®€å•ï¼š

\- å¢ï¼š`db.session.add(user); db.session.commit()`

\- æŸ¥ï¼š`User.query.filter_by(username='john').first()`

\- æ”¹ï¼šç›´æ¥ä¿®æ”¹å¯¹è±¡å±æ€§åæäº¤

\- åˆ ï¼š`db.session.delete(user); db.session.commit()`

ä½†è¿›é˜¶æŸ¥è¯¢éœ€æ³¨æ„æ€§èƒ½ï¼š

\- ä½¿ç”¨`lazy='dynamic'`é¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®

\- å¤æ‚æŸ¥è¯¢ç”¨`join`æ›¿ä»£å¤šä¸ªæŸ¥è¯¢ï¼Œå‡å°‘æ•°æ®åº“å¾€è¿”

    # ä¼˜åŒ–æŸ¥è¯¢ï¼šè·å–ç”¨æˆ·åŠå…¶æ–‡ç« ï¼ˆä½¿ç”¨è¿æ¥ï¼‰
    results = db.session.query(User, Post).join(Post).filter(User.username == 'john').all()
    # å¯¹æ¯”æ‡’åŠ è½½ï¼šuser.posts åªåœ¨è®¿é—®æ—¶æŸ¥è¯¢
    user = User.query.get(1)
    posts = user.posts  # æ­¤æ—¶æ‰§è¡ŒæŸ¥è¯¢

**è§„åˆ™ï¼šé¢‘ç¹è®¿é—®çš„æ•°æ®é¢„åŠ è½½ï¼Œå¤§æ•°æ®é›†åˆ†é¡µæˆ–æ‡’åŠ è½½**ï¼Œå¯æ˜¾è‘—é™ä½å†…å­˜æ¶ˆè€—ã€‚

ğŸ›¡ï¸ äº‹åŠ¡ç®¡ç†ä¸é”™è¯¯å¤„ç†
-------------

æ•°æ®åº“æ“ä½œå¿…é¡»ä¿è¯åŸå­æ€§ã€‚ä½¿ç”¨äº‹åŠ¡ç¡®ä¿å¤šä¸ªæ“ä½œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å›æ»šï¼š

    try:
        user = User(username='alice', email='alice@example.com')
        db.session.add(user)
        post = Post(title='Hello', content='First post', author=user)
        db.session.add(post)
        db.session.commit()  # æäº¤äº‹åŠ¡
    except Exception as e:
        db.session.rollback()  # å›æ»šåˆ°æ“ä½œå‰çŠ¶æ€
        print(f"æ“ä½œå¤±è´¥: {e}")
    finally:
        db.session.close()  # å…³é—­ä¼šè¯

å¸¸è§é”™è¯¯åŒ…æ‹¬ï¼š

\- å”¯ä¸€çº¦æŸå†²çªï¼šæ•è·`IntegrityError`

\- è¿æ¥è¶…æ—¶ï¼šé…ç½®è¿æ¥æ± æˆ–é‡è¯•æœºåˆ¶

**åŠ¡å¿…åœ¨å¼‚å¸¸ä¸­å›æ»šäº‹åŠ¡**ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå¯ç»“åˆFlaské”™è¯¯å¤„ç†è£…é¥°å™¨ç»Ÿä¸€ç®¡ç†ã€‚

ğŸ’» å®Œæ•´ä»£ç ï¼šä¸€ä¸ªç®€æ˜“åšå®¢ç³»ç»Ÿ
----------------

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ•´åˆäº†ä¸Šè¿°æŠ€æœ¯çš„å®Œæ•´ç¤ºä¾‹ï¼Œå®ç°ç”¨æˆ·æ³¨å†Œå’Œæ–‡ç« å‘å¸ƒåŠŸèƒ½ï¼š

    from flask import Flask, request, jsonify
    from flask_sqlalchemy import SQLAlchemy
    
    app = Flask(__name__)
    app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///blog.db'
    app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
    db = SQLAlchemy(app)
    
    class User(db.Model):
        id = db.Column(db.Integer, primary_key=True)
        username = db.Column(db.String(80), unique=True, nullable=False)
        posts = db.relationship('Post', backref='author', lazy=True)
    
    class Post(db.Model):
        id = db.Column(db.Integer, primary_key=True)
        title = db.Column(db.String(100), nullable=False)
        content = db.Column(db.Text)
        user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False)
    
    with app.app_context():
        db.create_all()
    
    @app.route('/add_user', methods=['POST'])
    def add_user():
        data = request.get_json()
        try:
            user = User(username=data['username'])
            db.session.add(user)
            db.session.commit()
            return jsonify({'message': 'ç”¨æˆ·åˆ›å»ºæˆåŠŸ', 'user_id': user.id}), 201
        except Exception as e:
            db.session.rollback()
            return jsonify({'error': str(e)}), 400
    
    @app.route('/posts/')
    def get_posts(username):
        user = User.query.filter_by(username=username).first()
        if user:
            posts = [{'title': p.title, 'content': p.content} for p in user.posts]
            return jsonify({'posts': posts})
        return jsonify({'message': 'ç”¨æˆ·æœªæ‰¾åˆ°'}), 404
    
    if __name__ == '__main__':
        app.run(debug=True)

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†ä»æ¨¡å‹å®šä¹‰åˆ°APIé›†æˆçš„å…¨æµç¨‹ã€‚**è¿è¡Œåå¯é€šè¿‡POSTè¯·æ±‚æ·»åŠ ç”¨æˆ·ï¼ŒGETè¯·æ±‚æŸ¥è¯¢æ–‡ç« **ï¼Œé€‚åˆä½œä¸ºè¿›é˜¶èµ·ç‚¹æ‰©å±•ã€‚

* * *

å–œæ¬¢æœ¬æ–‡ï¼Ÿä¸è¦é”™è¿‡âœ¨ï¼Œç‚¹èµğŸ‘æ”¶è—â­å…³æ³¨æˆ‘ğŸ‘†ï¼Œä¸€èµ·å­¦ä¹ æ›´å¤šæœ‰ç”¨çš„çŸ¥è¯†ï¼Œå®Œå–„ä½ æˆ‘çš„æŠ€èƒ½æ ‘ï¼