---
layout: post
title: 'ã€URPã€‘Unity[è§†å·®é®æŒ¡è´´å›¾]åŸç†å‰–æå®è·µ'
date: "2025-10-25T00:39:47Z"
---
ã€URPã€‘Unity\[è§†å·®é®æŒ¡è´´å›¾\]åŸç†å‰–æå®è·µ
==========================

![ã€URPã€‘Unity[è§†å·®é®æŒ¡è´´å›¾]åŸç†å‰–æå®è·µ](https://img2024.cnblogs.com/blog/3685400/202510/3685400-20251024145555262-1990370788.png) è§†å·®é®æŒ¡è´´å›¾(POM)æ˜¯ä¸€ç§é«˜çº§æ¸²æŸ“æŠ€æœ¯ï¼Œé€šè¿‡å…‰çº¿æ­¥è¿›ç®—æ³•ç²¾ç¡®è®¡ç®—è§†çº¿ä¸é«˜åº¦å›¾çš„äº¤ç‚¹ï¼Œæ¨¡æ‹Ÿå¤æ‚è¡¨é¢çš„å‡ ä½•é®æŒ¡æ•ˆæœã€‚ç›¸æ¯”æ ‡å‡†è§†å·®è´´å›¾ï¼ŒPOMèƒ½æ›´çœŸå®è¡¨ç°æ·±åº¦å˜åŒ–å’Œè‡ªé˜´å½±ï¼Œé€‚ç”¨äºé«˜ç²¾åº¦æè´¨ã€‚å…¶æ ¸å¿ƒæ˜¯åˆ†å±‚æ·±åº¦æ£€æµ‹å’ŒåŠ¨æ€é‡‡æ ·ä¼˜åŒ–ï¼Œæ ¹æ®è§†è§’åŠ¨æ€è°ƒæ•´é‡‡æ ·å±‚æ•°ï¼Œå¹¶é€šè¿‡äºŒåˆ†æ³•é€¼è¿‘ç²¾ç¡®UVã€‚Unity URPå®ç°ä¸­ï¼Œå…³é”®ç‚¹åŒ…æ‹¬åŠ¨æ€é‡‡æ ·å±‚æ•°ã€å…‰çº¿æ­¥è¿›å¾ªç¯å’ŒäºŒåˆ†æ³•ä¼˜åŒ–ã€‚æŠ€æœ¯å¯¹æ¯”æ˜¾ç¤ºPOMç²¾åº¦æœ€é«˜ä½†æ€§èƒ½æ¶ˆè€—è¾ƒå¤§ï¼Œé€‚åˆPC/ä¸»æœºå¹³å°ï¼Œç§»åŠ¨ç«¯éœ€å‡å°‘é‡‡æ ·å±‚æ•°ã€‚å»ºè®®é«˜åº¦å›¾ä½¿ç”¨æ³•çº¿è´´å›¾çš„Alphaé€šé“èŠ‚çœèµ„æºï¼Œæ§åˆ¶\_ParallaxScal

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

**è§†å·®é®æŒ¡è´´å›¾ï¼ˆParallax Occlusion Mapping, POMï¼‰ä»‹ç»**
=============================================

è§†å·®é®æŒ¡è´´å›¾æ˜¯è§†å·®è´´å›¾æŠ€æœ¯çš„é«˜é˜¶å®ç°ï¼Œé€šè¿‡â€Œ**å…‰çº¿æ­¥è¿›ï¼ˆRaymarchingï¼‰ç®—æ³•**â€Œç²¾ç¡®è®¡ç®—è§†çº¿ä¸é«˜åº¦å›¾çš„äº¤ç‚¹ï¼Œæ¨¡æ‹Ÿå¤æ‚è¡¨é¢ï¼ˆå¦‚ç –å¢™ã€å²©çŸ³ï¼‰çš„å‡ ä½•é®æŒ¡æ•ˆæœã€‚ç›¸æ¯”æ ‡å‡†è§†å·®è´´å›¾ï¼ŒPOMèƒ½æ›´çœŸå®åœ°è¡¨ç°æ·±åº¦å˜åŒ–å’Œè‡ªé˜´å½±ï¼Œé€‚ç”¨äºé«˜ç²¾åº¦æè´¨è¡¨ç°ã€‚

**æ ¸å¿ƒåŸç†**
========

*   â€Œ**åˆ†å±‚æ·±åº¦æ£€æµ‹**â€Œå°†è§†çº¿æ–¹å‘åœ¨åˆ‡çº¿ç©ºé—´åˆ†è§£ä¸ºå¤šå±‚ï¼ˆé€šå¸¸8-15å±‚ï¼‰ï¼Œé€å±‚é‡‡æ ·é«˜åº¦å›¾ï¼Œé€šè¿‡äºŒåˆ†æ³•é€¼\*è§†çº¿ä¸è¡¨é¢çš„äº¤ç‚¹ã€‚
*   â€Œ**åŠ¨æ€é‡‡æ ·ä¼˜åŒ–**â€Œæ ¹æ®è§†è§’ä¸æ³•çº¿çš„å¤¹è§’åŠ¨æ€è°ƒæ•´é‡‡æ ·å±‚æ•°ï¼ˆ\*\*è¡Œè§†è§’å¢åŠ å±‚æ•°ï¼Œå‚ç›´è§†è§’å‡å°‘å±‚æ•°ï¼‰ï¼Œ\*è¡¡ç²¾åº¦ä¸æ€§èƒ½ã€‚
*   â€Œ**é®æŒ¡å…³ç³»é‡å»º**â€Œé€šè¿‡äº¤ç‚¹å¤„çš„UVåç§»ä¿®æ­£çº¹ç†é‡‡æ ·ä½ç½®ï¼Œæ¨¡æ‹Ÿå‡¹å‡¸è¡¨é¢çš„å…‰çº¿é®æŒ¡æ•ˆæœã€‚

* * *

**Unity URP å®ç°ç¤ºä¾‹ä¸åŸç†è¯¦è§£**
=======================

**ä»£ç å…³é”®ç‚¹è§£æ**
-----------

*   â€Œ**åŠ¨æ€é‡‡æ ·å±‚æ•°**â€Œ
    
    *   é€šè¿‡`lerp(_MaxSamples, _MinSamples, saturate(dot(float3(0,0,1), viewDirTS)))`å®ç°è§†è§’è‡ªé€‚åº”åˆ†å±‚ï¼Œä¼˜åŒ–æ€§èƒ½ã€‚
*   â€Œ**å…‰çº¿æ­¥è¿›å¾ªç¯**â€Œ
    
    *   å¾ªç¯æ¯”è¾ƒå½“å‰å±‚é«˜åº¦ä¸é‡‡æ ·æ·±åº¦ï¼Œæ‰¾åˆ°é¦–ä¸ªäº¤ç‚¹åŒºé—´ï¼Œé¿å…å…¨ç²¾åº¦éå†ã€‚
*   â€Œ**äºŒåˆ†æ³•ä¼˜åŒ–**â€Œ
    
    *   åœ¨åˆæ­¥äº¤ç‚¹åŒºé—´å†…ä½¿ç”¨`lerp`æ’å€¼è®¡ç®—ç²¾ç¡®UVï¼Œå‡å°‘é‡‡æ ·æ¬¡æ•°ã€‚
*   ParallaxOcclusionMapping.shader
    
        Shader "Universal Render Pipeline/POM"
        {
            Properties
            {
                _MainTex("Albedo", 2D) = "white" {}
                _NormalMap("Normal Map", 2D) = "bump" {}
                _HeightMap("Height Map", 2D) = "white" {}
                _ParallaxScale("Height Scale", Range(0, 0.1)) = 0.05
                _MinSamples("Min Samples", Int) = 8
                _MaxSamples("Max Samples", Int) = 15
            }
        
            SubShader
            {
                Tags { "RenderPipeline"="UniversalPipeline" }
        
                HLSLINCLUDE
                #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
        
                TEXTURE2D(_MainTex);    SAMPLER(sampler_MainTex);
                TEXTURE2D(_NormalMap);  SAMPLER(sampler_NormalMap);
                TEXTURE2D(_HeightMap);  SAMPLER(sampler_HeightMap);
                float _ParallaxScale;
                int _MinSamples, _MaxSamples;
        
                float2 ParallaxOcclusionMapping(float3 viewDirTS, float2 uv)
                {
                    // åŠ¨æ€è®¡ç®—é‡‡æ ·å±‚æ•°
                    int numSamples = (int)lerp(_MaxSamples, _MinSamples, saturate(dot(float3(0,0,1), viewDirTS)));
                    float layerHeight = 1.0 / numSamples;
                    float2 deltaUV = _ParallaxScale * viewDirTS.xy / viewDirTS.z / numSamples;
        
                    // å…‰çº¿æ­¥è¿›åˆå§‹åŒ–
                    float currentLayerHeight = 0;
                    float2 currentUV = uv;
                    float currentDepth = 1 - SAMPLE_TEXTURE2D(_HeightMap, sampler_HeightMap, currentUV).r;
        
                    // åˆ†å±‚æ£€æµ‹
                    [loop]
                    for (int i = 0; i < 15; ++i) {
                        if (currentLayerHeight >= currentDepth) break;
                        currentUV -= deltaUV;
                        currentDepth = 1 - SAMPLE_TEXTURE2D(_HeightMap, sampler_HeightMap, currentUV).r;
                        currentLayerHeight += layerHeight;
                    }
        
                    // äºŒåˆ†æ³•ç²¾ç¡®äº¤ç‚¹
                    float2 prevUV = currentUV + deltaUV;
                    float prevDepth = currentDepth - layerHeight;
                    float weight = (currentLayerHeight - currentDepth) / (prevDepth - currentDepth);
                    return lerp(currentUV, prevUV, weight);
                }
                ENDHLSL
        
                Pass
                {
                    HLSLPROGRAM
                    #pragma vertex vert
                    #pragma fragment frag
        
                    struct Attributes
                    {
                        float4 positionOS : POSITION;
                        float2 uv : TEXCOORD0;
                        float3 normalOS : NORMAL;
                        float4 tangentOS : TANGENT;
                    };
        
                    struct Varyings
                    {
                        float4 positionCS : SV_POSITION;
                        float2 uv : TEXCOORD0;
                        float3 viewDirTS : TEXCOORD1;
                    };
        
                    Varyings vert(Attributes IN)
                    {
                        Varyings OUT;
                        VertexPositionInputs posInput = GetVertexPositionInputs(IN.positionOS.xyz);
                        OUT.positionCS = posInput.positionCS;
        
                        // è½¬æ¢è§†è§’æ–¹å‘åˆ°åˆ‡çº¿ç©ºé—´
                        VertexNormalInputs normInput = GetVertexNormalInputs(IN.normalOS, IN.tangentOS);
                        float3 viewDirWS = GetWorldSpaceViewDir(posInput.positionWS);
                        OUT.viewDirTS = TransformWorldToTangent(viewDirWS, 
                            normInput.tangentWS, normInput.bitangentWS, normInput.normalWS);
        
                        OUT.uv = IN.uv;
                        return OUT;
                    }
        
                    half4 frag(Varyings IN) : SV_Target
                    {
                        // è®¡ç®—POMåç§»åçš„UV
                        float2 pomUV = ParallaxOcclusionMapping(normalize(IN.viewDirTS), IN.uv);
        
                        // é‡‡æ ·æœ€ç»ˆçº¹ç†
                        half4 albedo = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, pomUV);
                        half3 normalTS = UnpackNormal(SAMPLE_TEXTURE2D(_NormalMap, sampler_NormalMap, pomUV));
        
                        return half4(albedo.rgb, 1);
                    }
                    ENDHLSL
                }
            }
        }
        
    

* * *

**æŠ€æœ¯å¯¹æ¯”ä¸æ€§èƒ½å»ºè®®**
=============

ç‰¹æ€§

æ ‡å‡†è§†å·®è´´å›¾

é™¡å³­è§†å·®è´´å›¾

POM

â€Œ**é‡‡æ ·æ¬¡æ•°**â€Œ

å•æ¬¡

5-15æ¬¡

8-15æ¬¡+äºŒåˆ†æ³•

â€Œ**é™¡å³­è¡¨é¢ç²¾åº¦**â€Œ

ä½

ä¸­

é«˜

â€Œ**é€‚ç”¨\*å°**â€Œ

ç§»åŠ¨ç«¯

PC/ä¸»æœº

é«˜ç«¯PC

â€Œ**æ¨èå‚æ•°**â€Œ

`Scale=0.02`

`Scale=0.05`

`Scale=0.03-0.07`

å®é™…åº”ç”¨ä¸­éœ€æ³¨æ„ï¼š
---------

*   é«˜åº¦å›¾å»ºè®®ä½¿ç”¨æ³•çº¿è´´å›¾çš„Alphaé€šé“èŠ‚çœèµ„æº
*   è¿‡é«˜çš„`_ParallaxScale`å¯èƒ½å¯¼è‡´è¾¹ç¼˜æ‹‰ä¼¸ï¼Œå»ºè®®ä¸è¶…è¿‡0.1
*   ç§»åŠ¨ç«¯å¯å‡å°‘`_MaxSamples`è‡³8å±‚ä»¥é™ä½å¼€é”€

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**  
> ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰