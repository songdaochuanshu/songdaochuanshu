---
layout: post
title: 'Streamlit + LangChain 1.0 ç®€å•å®ç°æ™ºèƒ½é—®ç­”å‰åç«¯'
date: "2025-12-18T00:41:10Z"
---
Streamlit + LangChain 1.0 ç®€å•å®ç°æ™ºèƒ½é—®ç­”å‰åç«¯
=====================================

Streamlit æ˜¯ä¸€æ¬¾ä¸“ä¸ºæ•°æ®ç§‘å­¦å®¶å’Œæœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆè®¾è®¡çš„ Python åº“ï¼Œå¯å¿«é€Ÿå°†æ•°æ®è„šæœ¬è½¬æ¢ä¸ºäº¤äº’å¼ Web åº”ç”¨ï¼Œæ— éœ€å‰ç«¯å¼€å‘ç»éªŒï¼Œæ‰€ä»¥æœ€è¿‘ç ”ç©¶äº†ä¸€ä¸‹ï¼Œç»“åˆLangChain 1.0 å®ç°äº†ç®€å•çš„æ™ºèƒ½é—®ç­”å‰åç«¯åº”ç”¨ï¼Œå¤§æ¨¡å‹ä½¿ç”¨DeepSeekã€‚

Streamlit + LangChain 1.0 ç®€å•å®ç°æ™ºèƒ½é—®ç­”å‰åç«¯
=====================================

æ¦‚è¿°
--

Streamlit æ˜¯ä¸€æ¬¾ä¸“ä¸ºæ•°æ®ç§‘å­¦å®¶å’Œæœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆè®¾è®¡çš„ Python åº“ï¼Œå¯å¿«é€Ÿå°†æ•°æ®è„šæœ¬è½¬æ¢ä¸ºäº¤äº’å¼ Web åº”ç”¨ï¼Œæ— éœ€å‰ç«¯å¼€å‘ç»éªŒï¼Œæ‰€ä»¥æœ€è¿‘ç ”ç©¶äº†ä¸€ä¸‹ï¼Œç»“åˆLangChain 1.0 å®ç°äº†ç®€å•çš„æ™ºèƒ½é—®ç­”å‰åç«¯åº”ç”¨ï¼Œå¤§æ¨¡å‹ä½¿ç”¨DeepSeekã€‚

ä¾èµ–åº“
---

*   `streamlit`ï¼šç”¨äºæ„å»ºWebäº¤äº’ç•Œé¢
*   `langchain` åŠç›¸å…³ç»„ä»¶ï¼šå¤„ç†LLMäº¤äº’é€»è¾‘
*   `python-dotenv`ï¼šåŠ è½½ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚åŠ è½½å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­çš„API KEYã€‚

Highlight code
--------------

### 1\. åˆå§‹åŒ–é…ç½®

    # åŠ è½½ç¯å¢ƒå˜é‡
    load_dotenv()
    
    # é…ç½®é¡µé¢
    st.set_page_config(
        page_title="DeepSeek é—®ç­”åº”ç”¨",
        page_icon="ğŸ¤–",
        layout="wide",
        initial_sidebar_state="expanded"
    )
    

*   ä½¿ç”¨ `load_dotenv()` åŠ è½½ `.env` æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡
*   `st.set_page_config()` é…ç½®é¡µé¢åŸºæœ¬å±æ€§ï¼ŒåŒ…æ‹¬æ ‡é¢˜ã€å›¾æ ‡å’Œå¸ƒå±€

### 2\. é¡µé¢UIæ„å»º

    # è®¾ç½®é¡µé¢æ ‡é¢˜å’Œè¯´æ˜
    st.title("ğŸ¤– DeepSeek æ™ºèƒ½é—®ç­”åº”ç”¨")
    st.markdown("ä½¿ç”¨ LangChain 1.0 å’Œ Streamlit æ„å»ºçš„å¯¹è¯ç³»ç»Ÿ")
    

*   é€šè¿‡ `st.title()` å’Œ `st.markdown()` è®¾ç½®é¡µé¢æ ‡é¢˜å’Œè¯´æ˜æ–‡å­—

### 3\. ä¾§è¾¹æ é…ç½®

    with st.sidebar:
        st.header("é…ç½®é€‰é¡¹")
        # API å¯†é’¥é…ç½®
        deepseek_api_key = st.text_input(
            "DeepSeek API Key",
            value=os.getenv("DEEPSEEK_API_KEY", ""),
            type="password",
            help="è¯·è¾“å…¥æ‚¨çš„ DeepSeek API Key"
        )
        # æ¸…é™¤å¯¹è¯å†å²æŒ‰é’®
        if st.button("æ¸…é™¤å¯¹è¯å†å²", type="secondary"):
            st.session_state["messages"] = []
            st.rerun()
    

*   ä½¿ç”¨ `st.sidebar` åˆ›å»ºä¾§è¾¹æ é…ç½®åŒºåŸŸ
*   æä¾›APIå¯†é’¥è¾“å…¥æ¡†ï¼ˆå¯†ç ç±»å‹ï¼‰ï¼Œé»˜è®¤ä»ç¯å¢ƒå˜é‡è·å–
*   å®ç°æ¸…é™¤å¯¹è¯å†å²åŠŸèƒ½ï¼Œé€šè¿‡æ“ä½œ `st.session_state` å®ç°

### 4\. å¯¹è¯å†å²ç®¡ç†

    # åˆå§‹åŒ–å¯¹è¯å†å²
    if "messages" not in st.session_state:
        st.session_state["messages"] = []
    
    # æ˜¾ç¤ºå¯¹è¯å†å²
    for message in st.session_state["messages"]:
        if isinstance(message, HumanMessage):
            with st.chat_message("user"):
                st.markdown(message.content)
        elif isinstance(message, AIMessage):
            with st.chat_message("assistant"):
                st.markdown(message.content)
    

*   ä½¿ç”¨ `st.session_state` å­˜å‚¨å¯¹è¯å†å²ï¼Œå®ç°é¡µé¢åˆ·æ–°åæ•°æ®ä¿ç•™
*   åŒºåˆ†ç”¨æˆ·æ¶ˆæ¯ï¼ˆHumanMessageï¼‰å’ŒåŠ©æ‰‹æ¶ˆæ¯ï¼ˆAIMessageï¼‰å¹¶åˆ†åˆ«æ˜¾ç¤º

### 5\. ç”¨æˆ·è¾“å…¥å¤„ç†

    user_input = st.chat_input("è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...")
    
    if user_input:
        # éªŒè¯APIå¯†é’¥
        if not deepseek_api_key:
            st.error("è¯·åœ¨ä¾§è¾¹æ é…ç½®æ‚¨çš„ DeepSeek API Key")
            st.stop()
        
        # æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°ä¼šè¯å†å²
        st.session_state["messages"].append(HumanMessage(content=user_input))
        
        # æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
        with st.chat_message("user"):
            st.markdown(user_input)
    

*   ä½¿ç”¨ `st.chat_input()` è·å–ç”¨æˆ·è¾“å…¥
*   è¿›è¡ŒAPIå¯†é’¥éªŒè¯ï¼Œç¡®ä¿è°ƒç”¨æ¨¡å‹å‰å¯†é’¥å·²é…ç½®
*   å°†ç”¨æˆ·æ¶ˆæ¯æ·»åŠ åˆ°å†å²è®°å½•å¹¶æ˜¾ç¤º

### 6\. AIå“åº”ç”Ÿæˆ

    # æ˜¾ç¤ºåŠ©æ‰‹æ€è€ƒä¸­çŠ¶æ€
    with st.chat_message("assistant"):
        with st.spinner("æ­£åœ¨æ€è€ƒ..."):
            chat_model=init_chat_model(model="deepseek:deepseek-chat")
            
            # åˆ›å»ºæç¤ºæ¨¡æ¿
            prompt = ChatPromptTemplate.from_messages([
                ("system", "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œä½¿ç”¨ä¸­æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ï¼Œä¿æŒå‹å¥½å’Œä¸“ä¸šã€‚"),
                *st.session_state["messages"]
            ])
            
            # åˆ›å»ºé“¾
            chain = prompt | chat_model | StrOutputParser()
            
            try:
                # ç”Ÿæˆå›ç­”
                response = chain.invoke({})
                
                # æ˜¾ç¤ºå›ç­”
                st.markdown(response)
                
                # æ·»åŠ åŠ©æ‰‹æ¶ˆæ¯åˆ°ä¼šè¯å†å²
                st.session_state["messages"].append(AIMessage(content=response))
                
            except Exception as e:
                st.error(f"è¯·æ±‚å¤±è´¥: {str(e)}")
                st.error("è¯·æ£€æŸ¥æ‚¨çš„APIå¯†é’¥æˆ–ç½‘ç»œè¿æ¥")
    

*   ä½¿ç”¨ `st.spinner()` æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
*   é€šè¿‡ `init_chat_model()` åˆå§‹åŒ–DeepSeekæ¨¡å‹
*   ä½¿ç”¨LangChain 1.0çš„é“¾(Chain)è¯­æ³•ï¼š`prompt | chat_model | StrOutputParser()`
*   å¼‚å¸¸å¤„ç†ç¡®ä¿é”™è¯¯æ—¶èƒ½å‹å¥½æç¤ºç”¨æˆ·

å…³é”®æŠ€æœ¯ç‚¹
-----

1.  **Streamlit ä¼šè¯çŠ¶æ€**ï¼šåˆ©ç”¨ `st.session_state` ä¿å­˜å¯¹è¯å†å²ï¼Œå®ç°çŠ¶æ€ç®¡ç†
2.  **LangChain 1.0 é“¾è¯­æ³•**ï¼šé‡‡ç”¨æ–°çš„ç®¡é“è¿ç®—ç¬¦ `|` æ„å»ºå¤„ç†æµç¨‹
3.  **æ¶ˆæ¯ç±»å‹åŒºåˆ†**ï¼šä½¿ç”¨ `HumanMessage` å’Œ `AIMessage` åŒºåˆ†ä¸åŒè§’è‰²çš„æ¶ˆæ¯
4.  **API å¯†é’¥ç®¡ç†**ï¼šæ”¯æŒç¯å¢ƒå˜é‡å’Œæ‰‹åŠ¨è¾“å…¥ä¸¤ç§æ–¹å¼é…ç½®APIå¯†é’¥
5.  **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸æ•è·å’Œç”¨æˆ·æç¤º

è¿è¡Œ
--

    streamlit run LC_RAG_07a_Streamlit.py
    

runåé¢æ›¿æ¢æˆè‡ªå·±çš„æ–‡ä»¶åå°±å¯ä»¥å¯åŠ¨è¿è¡Œã€‚  
å®Œæ•´ç‰ˆæœ¬çš„ä»£ç å¯ä»¥åœ¨å¦‚ä¸‹ä½ç½®æ‰¾åˆ°ï¼š  
[https://github.com/microsoftbi/Langchain\_DEMO/blob/main/RAG/LC\_RAG\_07a\_Streamlit.py](https://github.com/microsoftbi/Langchain_DEMO/blob/main/RAG/LC_RAG_07a_Streamlit.py)

åè®°
--

ç›¸å¯¹Vueï¼Œsteamlitçš„å­¦ä¹ æˆæœ¬æ›´ä½ä¸€äº›ã€‚é€‚åˆç‹¬ç«‹çš„å¼€å‘å’Œå­¦ä¹ ã€‚ä½†æ˜¯åœ¨ç”Ÿäº§ä¸­ä¸»æµè¿˜æ˜¯æ›´æ¨èVueç­‰å‰ç«¯æ¡†æ¶ï¼Œå°¤å…¶åœ¨ç»†èŠ‚çš„å‰ç«¯å®šåˆ¶åŒ–å¼€å‘ä¸­ã€‚  
åç»­å¯ä»¥æ‰©å……ä¸‹æ¯”å¦‚streamlitå¦‚ä½•å“åº”langchainçš„middlewareç­‰åŠŸèƒ½ï¼Œæ¯”å¦‚HITLã€‚

\---------------------------------------------------------------

aspnetxçš„BIç¬”è®°ç³»åˆ—ç´¢å¼•ï¼š

[ä½¿ç”¨SQL Server Analysis Servicesæ•°æ®æŒ–æ˜çš„å…³è”è§„åˆ™å®ç°å•†å“æ¨èåŠŸèƒ½](http://www.cnblogs.com/aspnetx/archive/2013/02/25/2931603.html)

[ä¸€èµ·ç©è½¬SQL Server 2012 ä¸‹çš„åˆ†ææœåŠ¡](http://www.cnblogs.com/aspnetx/archive/2013/03/24/2978347.html)

[ä½¿ç”¨SQL Serveråˆ†ææœåŠ¡å®šä½ç›®æ ‡ç”¨æˆ·](http://www.cnblogs.com/aspnetx/archive/2013/04/05/3000448.html)

\---------------------------------------------------------------  

æ¥è‡ª[åšå®¢å›­](http://www.cnblogs.com/)çš„[aspnetx](http://aspnetx.cnblogs.com/)å®‹å«ä¸œ