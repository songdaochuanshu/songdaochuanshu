---
layout: post
title: 'Unityå¾®ä¿¡å°æ¸¸æˆå°çª—å£æ¨¡å¼ç‚¹å‡»é€‚é…'
date: "2025-07-20T00:51:01Z"
---
Unityå¾®ä¿¡å°æ¸¸æˆå°çª—å£æ¨¡å¼ç‚¹å‡»é€‚é…
===================

1\. é—®é¢˜æè¿°
--------

é¡¹ç›®ä½¿ç”¨UGUIæ–¹æ¡ˆï¼Œä»¥ç‚¹å‡»äº¤äº’ä¸ºä¸»ã€‚

å¾®ä¿¡unityæ–¹æ¡ˆæœ¬èº«åªèƒ½è°ƒPixelRatioï¼Œä¸èƒ½ç›´æ¥è°ƒæ•´Unityçš„åˆ†è¾¨ç‡ï¼Œï¼ˆè¿˜æ²¡æœ‰æµ‹è¯•è¿‡â€œè‡ªé€‚åº”å±å¹•å°ºå¯¸â€ä¼šæ€ä¹ˆæ ·ï¼‰ï¼Œä¸è¿‡çœ‹å‰æ®µæ—¶é—´çƒ­é—¨çš„unityå°æ¸¸æˆé¡¹ç›®ã€Šæ— å°½å†¬æ—¥ã€‹ä¹Ÿæ²¡æœ‰å¯¹åˆ†è¾¨ç‡è¿›è¡Œé€‚é…ï¼Œé‡‡ç”¨äº†åˆ†è¾¨ç‡æ‹‰ä¼¸çš„æ¨¡å¼ã€‚

ç®€å•ä»¥æˆ‘è‡ªå·±çš„æ‰‹æœºä¸¾ä¾‹ï¼Œå¦‚æœæ­£å¸¸æ‰“å¼€å¾®ä¿¡ï¼Œå†æ‰“å¼€å°æ¸¸æˆï¼Œåˆ†è¾¨ç‡æ˜¯`1080x2461`ï¼Œå¦‚æœæŠŠå°æ¸¸æˆçš„çª—å£å•ç‹¬æ‹–åˆ°å°çª—å£æ¨¡å¼ï¼Œ`WeChatWASM.WX.OnWindowResize()`çš„å›è°ƒç»™çš„åˆ†è¾¨ç‡æ˜¯`1080x1729`ï¼Œä½†å› ä¸ºä¸èƒ½è°ƒæ•´Unityçš„åˆ†è¾¨ç‡ï¼Œæ‰€ä»¥æ•´ä¸ªç”»é¢æ˜¯æ‹‰ä¼¸çš„ã€‚åè¿‡æ¥ï¼Œå¦‚æœå…ˆæ‰“å¼€å¾®ä¿¡ï¼ŒæŠŠå¾®ä¿¡æ‹‰æˆå°çª—å£ï¼Œå†æ‰“å¼€å°æ¸¸æˆï¼Œä¹‹åå†æŠŠå°æ¸¸æˆå…¨å±ï¼Œæ•ˆæœä¼šåè¿‡æ¥ã€‚

ç”»é¢æ‹‰ä¼¸é—®é¢˜ä¸ç®—å¤ªå¤§ï¼Œä½†ç‚¹å‡»å“åº”çš„é—®é¢˜æ¯”è¾ƒä¸¥é‡ï¼Œç»è¿‡æµ‹è¯•ï¼Œä»¥ä»å·¦åˆ°å³ä¸ºxè½´ï¼Œä»ä¸‹åˆ°ä¸Šä¸ºyè½´ï¼Œå…¨å±å¯åŠ¨å°æ¸¸æˆå†æ‹‰åˆ°å°çª—å£æ¨¡å¼å`(1080x1729)`ï¼Œå·¦ä¸Šè§’çš„è¾“å…¥åæ ‡è¿˜æ˜¯æ­£ç¡®çš„`(0,2461)`, ä½†å·¦ä¸‹è§’çš„åæ ‡å°±æ˜¯é”™è¯¯çš„`(0,732)`(2461-1729)ï¼Œå¯¼è‡´çš„ç°è±¡æ˜¯è¶Šé è¿‘ä¸Šæ–¹çš„æŒ‰é’®è¶Šæœ‰å¯èƒ½ç‚¹å¯¹ï¼Œé è¿‘ä¸‹æ–¹çš„å°±ç‚¹ä¸åˆ°äº†ã€‚æ­£ç¡®çš„åæ ‡å’Œè¾“å…¥åæ ‡çš„å…³ç³»æ˜¯

    Vector2 GetMousePosition()
    {
        var pos = Input.mousePosition;
    
        int originalHeight = 2461; // åˆå§‹åŒ–æ—¶å­˜å‚¨
        int modifiedHeight = 1729; // OnWindowResize() å›è°ƒè·å–
        if (originalHeight == modifiedHeight)
        {
            return pos;
        }
    
        float resolutionScale = 1; // åˆ†è¾¨ç‡ç¼©æ”¾
        float y = pos.y;
        pos.y = (y + (modifiedHeight - originalHeight) * resolutionScale) / modifedHeight * originalHeight;
        return pos;
    }
    

æ—§çš„è¾“å…¥ç³»ç»Ÿï¼ˆInputManager)ä¹Ÿèƒ½è¾¾æˆæ•ˆæœï¼Œéœ€è¦ç»§æ‰¿`GraphicRaycaster`ç±»ï¼Œä¿®æ”¹UIçš„ç‚¹å‡»æ£€æµ‹é€»è¾‘

å¦å¤–ä¸šåŠ¡é€»è¾‘ä¸­è·å–Input.mousePositonçš„åœ°æ–¹ä¹Ÿéœ€è¦è¦†ç›–ä¸€ä¸‹

    public class CustomGraphicRaycaster : GraphicRaycaster
    {
        public override void Raycast(PointerEventData eventData, List<RaycastResult> resultAppendLit)
        {
            var pos = eventData.position;
            // ä¿®æ”¹ä½ç½®
            event.position = pos;
            base.Raycast(eventData, resultAppendList);
        }
    }
    

é‚£å…¶å®ç›´æ¥æ”¹UGUIæºç å°±è¡Œ....

æ¢ç”¨äº†æ–°çš„è¾“å…¥ç³»ç»Ÿ`InputSystem`ï¼Œæ˜¯å› ä¸ºå½“æ—¶æ²¡è¯•å‡ºæ¥ğŸ˜‚

2\. ä»UnityEngine.Inputå‡çº§åˆ°UnityEngine.InputSystem
------------------------------------------------

1.  é¦–å…ˆè¦æ›´æ–°UGUIæºç (å¦‚æœä½¿ç”¨embbedæ¨¡å¼), è™½ç„¶ç‰ˆæœ¬å·ä¸€ç›´æ˜¯1.0.0, ä½†è¿˜æ˜¯æœ‰å¤šæ¬¡ä¿®æ”¹çš„
2.  Window > PackageManager å®‰è£… Input System (æœ¬æ–‡ä½¿ç”¨çš„æ˜¯1.7.0ç‰ˆæœ¬)
3.  Editor > Project Settings > OtherSettings > Active Input Handling, æ”¹ä¸º"Input System Package" (å…³é—­æ—§çš„è¾“å…¥ç³»ç»Ÿ)
4.  UGUIçš„äº‹ä»¶æ¥å…¥: æ‰¾åˆ°åœºæ™¯ä¸­çš„EventSystem, æŠŠåŸæœ¬çš„StandaloneUIInputModuleåˆ æ‰, æŒ‚ä¸€ä¸ªInputSystemUIInputModuleä¸Šå»

3\. å¸¸ç”¨APIçš„ç›´æ¥è¿‘ä¼¼æ›¿æ¢
----------------

éœ€è¦æ³¨æ„åˆ¤ç©º

é¼ æ ‡ï¼š

*   Input.mousePosition -> Mouse.current.position.ReadValue()
*   Input.GetMouseButton(index) -> Mouse.current.leftButton.isPressed | Mouse.current.rightButton.isPressed (ä¸‹é¢çœç•¥)
*   Input.GetMouseButtonDown(index) -> Mouse.current.leftButton.wasPressedThisFrame
*   Input.GetMouseButtonUp(index) -> Mouse.current.leftButton.wasReleasedThisFrame
*   Input.GetAxis("Mouse ScrollWheel") -> Mouse.current.scroll.ReadValue().y / 120f

é”®ç›˜ï¼ˆå®é™…åªæœ‰ç¼–è¾‘å™¨åœ¨ç”¨ï¼‰ï¼š

*   Input.GetKey(KeyCode.W) -> Keyboard.current.wKey.isPressed
*   Input.GetKey(keyCode) -> switch case
*   é”®ç›˜çš„Down\\Upä¹Ÿæ˜¯wasPressedThisFrame\\wasReleasedThisFrame

å¦å¤–é¼ æ ‡çš„é€»è¾‘æ›¿æ¢éœ€è¦æ³¨æ„åˆ¤æ–­è§¦å±ï¼Œä»¥`Input.mousePosition`ä¸ºä¾‹

    
    public static class Input
    {
        public static Vector2 mousePosition
        {
            get {
    #if !UNITY_EDITOR && UNITY_WEBGL
                var pos = TouchScreen.current?.primaryTouch.position.ReadValue() ?? Vector2.zero;
    #else
                var pos = Mouse.current?.position.ReadValue() ?? Vector2.zero;
    #endif
                return pos;
            }
        }
    }
    
    

4\. æ·»åŠ ä½œç”¨åˆ°UGUIçš„åæ ‡è½¬æ¢
------------------

ä¸ºäº†æ–¹ä¾¿ä¿®æ”¹ï¼Œç›´æ¥æŠŠInputSystemåŒ…æ”¹æˆembbedæ¨¡å¼ï¼ˆåŒ…æ–‡ä»¶å¤¹ä»`Library/PackageCache`ç§»åŠ¨åˆ°`Packages`æ–‡ä»¶å¤¹ï¼‰

æ–°å»º`Packages/com.unity.inputsystem@xxx/InputSystem/Controls/Processors/ResolutionVector2Processor.cs`

    
    namespace UnityEngine.InputSystem.Processors
    {
        public class ResolutionVector2Processor : InputProcessor<Vector2>
        {
            // è¿™äº›å‚æ•°è‡ªè¡Œæ‰¾æ—¶æœºä¼ é€’è¿‡æ¥å³å¯
            private static int s_OriginalHeight = 0;
            private static int s_ModifiedHeight = 0;
            private static float s_ResolutionScale = 1.0f;
    
            public override Vector2 Process(Vector2 value, InputControl control)
            {
                // å’Œç¬¬ä¸€èŠ‚çš„é€»è¾‘ç›¸åŒ
                if (s_OriginalHeight == s_ModifiedHeight) return value;
    
                float y = value.y;
                value.y = (y + (s_ModifiedHeight - s_OriginalHeight) * s_ResolutionScale) / s_ModifiedHeight * s_OriginalHeight;
                return value;
            }
    
            public override string ToString()
            {
                return $"ResolutionVector2()";
            }
        }
    }
    
    

åˆ°`Packages/com.unity.inputsystem@xxx/InputSystem/InputManager.cs`é‡Œé¢æ³¨å†Œä¸€ä¸‹

    internal void InitializeData()
    {
        // ...
        processors.AddTypeRegistration("ResolutionVector2", typeof());
        // ...
    }
    

ç„¶ååœ¨unityä¸­Projectçª—å£é€‰ä¸­`Packages/com.unity.inputsystem@xxx/InputSystem/Plugins/PlayerInput/DefaultInputActions.inputactions`

ç‚¹å‡»Inspectorçª—å£çš„`Edit asset`

ActionMapsé€‰æ‹©UI

Actionsé€‰æ‹© Point > touch\*/position \[Touchscreen\]

åœ¨Processorsä¸­æ·»åŠ åˆšæ‰æ–°å»ºçš„`ResolutionVector2`ï¼Œä¿å­˜å³å¯

5\. Input.mousePositionçš„æ›¿æ¢
--------------------------

å›åˆ°ç¬¬3èŠ‚çš„ä»£ç ï¼ŒæŠŠè½¬æ¢é€»è¾‘åŠ è¿›å»å³å¯