---
layout: post
title: 'ä¹. Redis æŒä¹…åŒ–-RDB(è¯¦ç»†è®²è§£è¯´æ˜ï¼Œä¸€ä¸ªé…ç½®ä¸€ä¸ªè¯´æ˜åˆ†æï¼Œæ­¥æ­¥è®²è§£åˆ°ä½)'
date: "2025-02-05T00:35:41Z"
---
ä¹. Redis æŒä¹…åŒ–-RDB(è¯¦ç»†è®²è§£è¯´æ˜ï¼Œä¸€ä¸ªé…ç½®ä¸€ä¸ªè¯´æ˜åˆ†æï¼Œæ­¥æ­¥è®²è§£åˆ°ä½)
==========================================

ä¹. Redis æŒä¹…åŒ–-RDB(è¯¦ç»†è®²è§£è¯´æ˜ï¼Œä¸€ä¸ªé…ç½®ä¸€ä¸ªè¯´æ˜åˆ†æï¼Œæ­¥æ­¥è®²è§£åˆ°ä½)
==========================================

@

ç›®å½•

*   [ä¹. Redis æŒä¹…åŒ–-RDB(è¯¦ç»†è®²è§£è¯´æ˜ï¼Œä¸€ä¸ªé…ç½®ä¸€ä¸ªè¯´æ˜åˆ†æï¼Œæ­¥æ­¥è®²è§£åˆ°ä½)](#ä¹-redis-æŒä¹…åŒ–-rdbè¯¦ç»†è®²è§£è¯´æ˜ä¸€ä¸ªé…ç½®ä¸€ä¸ªè¯´æ˜åˆ†ææ­¥æ­¥è®²è§£åˆ°ä½)
*   [1\. RDB æ¦‚è¿°](#1-rdb-æ¦‚è¿°)
*   [2\. RDB æŒä¹…åŒ–æ‰§è¡Œæµç¨‹](#2-rdb-æŒä¹…åŒ–æ‰§è¡Œæµç¨‹)
*   [3\. RDB çš„è¯¦ç»†é…ç½®](#3-rdb-çš„è¯¦ç»†é…ç½®)
*   [4\. RDB å¤‡ä»½&æ¢å¤](#4-rdb-å¤‡ä»½æ¢å¤)
*   [5\. RDB æŒä¹…åŒ–å°ç»“(ä¼˜åŠ¿ å’Œ åŠ£åŠ¿)](#5-rdb-æŒä¹…åŒ–å°ç»“ä¼˜åŠ¿-å’Œ-åŠ£åŠ¿)
*   [6\. æœ€åï¼š](#6-æœ€å)

* * *

**Redis æŒä¹…åŒ–-RDBï¼šå®˜ç½‘æ–‡æ¡£åœ°å€ï¼š** [https://redis.io/docs/latest/operate/oss\_and\_stack/management/persistence/](https://redis.io/docs/latest/operate/oss_and_stack/management/persistence/)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728247-1555900805.png)

**Redis å…³äºæŒä¹…åŒ–æ–¹æ¡ˆï¼šæœ‰ä¸¤ç§ï¼š**

1.  RDB(Redis DataBase)
2.  AOF(Append Of File)

> è¿™é‡Œæˆ‘ä»¬ä¸»è¦ä»‹ç» RDB æŒä¹…åŒ–æ–¹æ¡ˆï¼ŒAOF æŒä¹…åŒ–æ–¹æ¡ˆï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« å½“ä¸­ã€‚

1\. RDB æ¦‚è¿°
==========

**RDB æ˜¯ä»€ä¹ˆ ?ï¼š**

åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜å½“ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥åˆ°ç£ç›˜å½“ä¸­ï¼Œä¹Ÿå°±æ˜¯ `Snapshot` å¿«ç…§ï¼Œæ¢å¤æ—¶å°†å¿«ç…§æ–‡ä»¶å½“ä¸­çš„å†…å®¹è¯»å–åˆ°**å†…å­˜** å½“ä¸­ã€‚

2\. RDB æŒä¹…åŒ–æ‰§è¡Œæµç¨‹
===============

**RDB åŠå…¶æ‰§è¡Œæµç¨‹ï¼š**

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728068-1097413961.png)

**å¯¹ä¸Šå›¾çš„è§£è¯»ï¼š**

**å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š**

> 1.  Redis å®¢æˆ·ç«¯æ‰§è¡Œ bgsave å‘½ä»¤æˆ–è€…è‡ªåŠ¨è§¦å‘ bgsave å‘½ä»¤ã€‚
> 2.  ä¸»è¿›ç¨‹åˆ¤æ–­å½“å‰æ˜¯å¦å·²ç»å­˜åœ¨**æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹** ï¼Œå¦‚æœå­˜åœ¨ï¼Œé‚£ä¹ˆä¸»è¿›ç¨‹ç›´æ¥è¿”å›ã€‚
> 3.  å¦‚æœä¸å­˜åœ¨ï¼Œ**æ­£åœ¨æ‰§è¡Œçš„å­è¿›ç¨‹** ï¼Œé‚£ä¹ˆå°± fork ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹è¿›è¡ŒæŒä¹…åŒ–æ•°æ®ï¼Œfork è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œfork æ“ä½œå®Œæˆåä¸»è¿›ç¨‹å³å¯æ‰§è¡Œå…¶å®ƒæ“ä½œã€‚
> 4.  å­è¿›ç¨‹å…ˆå°†æ•°æ®å†™å…¥åˆ° **ä¸´æ—¶çš„ `rdb` æ–‡ä»¶ä¸­** ï¼Œå¾…å¿«ç…§æ•°æ®å†™å…¥å®Œæˆåï¼Œå†åŸå­æ›¿æ¢æ—§çš„ `rdb` æ–‡ä»¶ã€‚
> 5.  åŒæ—¶å‘é€ä¿¡å·ç»™ä¸»è¿›ç¨‹ï¼Œé€šçŸ¥ä¸»è¿›ç¨‹ `rdb` æŒä¹…åŒ–å®Œæˆï¼Œä¸»è¿›ç¨‹æ›´æ–°ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ã€‚

**å°ç»“ï¼š**

> 1.  æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½• **IO** æ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚
> 2.  å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£ RDB æ–¹å¼è¦æ¯” AOF æ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚
> 3.  RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–çš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚
> 
> å¦‚æœä½ æ˜¯æ­£å¸¸å…³é—­ Redis ï¼Œä»ç„¶ä¼šè¿›è¡ŒæŒä¹…åŒ–ï¼Œä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€‚
> 
> å¦‚æœæ˜¯ Redis **å¼‚å¸¸ç»ˆæ­¢/å®•æœº** ï¼Œå°±å¯èƒ½é€ æˆæ•°æ®ä¸¢å¤±ã€‚
> 
> åé¢åœ¨è®²è§£å¿«ç…§é…ç½®çš„æ—¶å€™ï¼Œè¿›è¡Œè¯´æ˜ã€‚

**Fork&Copy-On-Writeï¼š**

1.  Fork çš„ä½œç”¨æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å½“å‰è¿›ç¨‹ä¸€æ ·çš„è¿›ç¨‹ã€‚æ–°è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®(å˜é‡ï¼Œç¯å¢ƒå˜é‡ï¼Œç¨‹åºè®¡æ•°å™¨ç­‰)æ•°å€¼éƒ½å’ŒåŸè¿›ç¨‹ä¸€è‡´ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œå¹¶ä½œä¸ºåŸè¿›ç¨‹çš„å­è¿›ç¨‹ã€‚
    
2.  åœ¨ Linux ç¨‹åºä¸­ï¼Œfork() ä¼šäº§ç”Ÿä¸€ä¸ªå’Œçˆ¶è¿›ç¨‹å®Œå…¨ç›¸åŒçš„å­è¿›ç¨‹ï¼Œä½†å­è¿›ç¨‹åœ¨æ­¤åéƒ½ä¼š exec ç³»ç»Ÿè°ƒç”¨ï¼Œå‡ºäºæ•ˆç‡è€ƒè™‘ï¼ŒLinux ä¸­å¼•å…¥äº† **â€œå†™æ—¶å¤åˆ¶æŠ€æœ¯ å³ï¼šcopy-on-writeâ€** ï¼Œæœ‰å…´è¶£çš„å¯ä»¥ç§»æ­¥è‡³ğŸŒŸğŸŒŸğŸŒŸ [https://blog.csdn.net/Code\_beeps/article/details/92838520](https://blog.csdn.net/Code_beeps/article/details/92838520) ä¸€ä½ç½‘å‹çš„è§£è¯»ã€‚
    
3.  ä¸€èˆ¬æƒ…å†µçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¼šå…±ç”¨ä¸€æ®µç‰©ç†å†…å­˜ï¼Œåªæœ‰è¿›ç¨‹ç©ºé—´çš„å„æ®µçš„å†…å®¹è¦å‘é€å˜åŒ–æ—¶ï¼Œæ‰ä¼šå°†çˆ¶è¿›ç¨‹çš„å†…å®¹å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ã€‚
    

3\. RDB çš„è¯¦ç»†é…ç½®
=============

1.  **é»˜è®¤å¿«ç…§é…ç½®ï¼š**

Redis å½“ä¸­çš„å¿«ç…§çš„æ–‡ä»¶æ˜¯åä¸º `dump.rdb` æ–‡ä»¶ï¼Œè¿™æ˜¯é»˜è®¤çš„ã€‚

åœ¨ /etc/redis.conf ä¸­é…ç½®æ–‡ä»¶åç§°å½“ä¸­ï¼Œå­˜åœ¨è¿™ä¸ª `dump.rdb` çš„é…ç½®ã€‚  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727912-1435307234.png)

å¦‚ä½•é…ç½®

é»˜è®¤ä¸º Redis å¯åŠ¨æ—¶å‘½ä»¤è¡Œæ‰€åœ¨çš„ç›®å½•ä¸‹ï¼š

> æ„æ€å°±æ˜¯ï¼šé»˜è®¤ä¼šå°† â€œdump.rdbâ€ å¿«ç…§æ–‡ä»¶å­˜å‚¨åˆ° Redis å¯åŠ¨æ—¶å‘½ä»¤è¡Œæ‰€åœ¨çš„ç›®å½•ä¸‹  
> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728239-1787421806.png)

**é‡ç‚¹ï¼š** è¿›å…¥åˆ°`/usr/local/bin` ç›®å½•ä¸‹, å¯åŠ¨ Redis, è¿™ä¸ªé‚£ä¹ˆè¿™é‡Œçš„ `./` æ‰€æŒ‡çš„è·¯å¾„å°±æ˜¯ `/usr/local/bin` , å¦‚æœä½ åœ¨ `/root/` ç›®å½•ä¸‹å¯åŠ¨ Redis , é‚£ä¹ˆè¿™é‡Œ `./` æ‰€æŒ‡çš„å°±æ˜¯ `/root`/ ä¸‹äº†è·¯å¾„ , è¿™ç‚¹è¯·å¤§å®¶æ³¨æ„ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728080-1560196738.png)

> **é‚£ä¹ˆè¿™æ ·çš„é»˜è®¤é…ç½®å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ¯æ¬¡å»åˆ°ä¸åŒçš„ç›®å½•ä¸‹å¯åŠ¨ redis çš„åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ª`dump.rdb`ï¼ˆå¿«ç…§å­˜å‚¨æˆ‘ä»¬ä¿¡æ¯/æ•°æ®çš„æ–‡ä»¶ï¼‰ å°±ä¼šå­˜å‚¨åˆ°ä¸åŒçš„ç›®å½•ä¸‹ï¼Œè¿™æ ·å°±å¯¼è‡´äº†ï¼Œå¦‚æœè¯¥ç›®å½•ä¸‹æ²¡æœ‰æˆ‘ä»¬ä¹‹å‰æ‰§è¡Œå­˜å‚¨çš„æ•°æ®çš„ `dump.rdb` æ–‡ä»¶çš„è¯ï¼Œæˆ‘ä»¬Redis å°±æ— æ³•è¯»å–åˆ°è¯¥å­˜æœ‰æˆ‘ä»¬ä¹‹å‰`dump.rdb` æ•°æ®çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ— æ³•æ¢å¤æˆ‘ä»¬ä¹‹å‰å­˜å‚¨æ“ä½œçš„æ•°æ®äº†ã€‚**
> 
> **æ¼”ç¤ºï¼š**
> 
>     æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªç›®å½•ï¼šåˆ†åˆ«æ˜¯: test01ï¼Œå’Œ test02
>     åœ¨ test01 ç›®å½•ä¸‹æ‰§è¡Œ set k1 "test01"  åŒæ—¶æŸ¥çœ‹è¯¥ç›®å½•ä¸‹æ˜¯å¦ç”Ÿæˆ dump.rdb(å¿«ç…§æ–‡ä»¶)
>     åœ¨ test02 ç›®å½•ä¸‹æ‰§è¡Œ set k2 "test02" åŒæ—¶æŸ¥çœ‹è¯¥ç›®å½•ä¸‹æ˜¯å¦ç”Ÿæˆ dump.rdb(å¿«ç…§æ–‡ä»¶)
>     
> 
>     [root@localhost home]# mkdir test01 # åˆ›å»ºç›®å½•
>     
> 
> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728248-1860237829.png)

>     [root@localhost test01]# redis-cli
>     127.0.0.1:6379> keys *
>     (error) NOAUTH Authentication required.
>     127.0.0.1:6379> auth rainbowsea
>     OK
>     127.0.0.1:6379> keys *
>     (empty array)
>     127.0.0.1:6379> set k1 "test01"
>     OK
>     127.0.0.1:6379> keys *
>     1) "k1"
>     
>     
> 
> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728066-2072051585.png)

> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727977-919356141.png)

> åŒç†æ‰§è¡Œï¼štest02
> 
> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727944-934298843.png)

> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727855-1338571510.png)

**æ€ä¹ˆè§£å†³è¿™ä¸ªï¼ŒRedis åœ¨ä¸åŒçš„ç›®å½•ä¸‹ï¼Œå¯¼è‡´æ•°æ®å­˜å‚¨å¿«ç…§ä¸åŒï¼Œæ•°æ®æ²¡æœ‰è·Ÿä¸Šï¼Ÿ**

æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰é…ç½®å¥½è¿™ä¸ª dump.rdb æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œä¸æ˜¯é»˜è®¤çš„`dir./`(æ ¹æ®å¯åŠ¨Redisç›®å½•ä¸åŒè€Œå˜åŒ–) ï¼Œè€Œæ˜¯ä¸€ç›´é…ç½®åœ¨ä¸€ä¸ªå›ºå®šçš„è·¯å¾„ä¸‹ã€‚å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚

**è¿™é‡Œæˆ‘ä»¬å°†å…¶é…ç½®åˆ° `/root/` ç›®å½•ä¸‹ï¼Œè¿™æ ·æˆ‘ä»¬æ¯æ¬¡ç”Ÿæˆçš„ dump.rdb æ–‡ä»¶å°±ä¸€ç›´æ˜¯åœ¨åŒä¸€ä¸ªè·¯å¾„çš„ç›®å½•ä¸‹äº†**

    dir /root/
    

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727949-1097836725.png)

> **æ³¨æ„ï¼šéœ€è¦å…³é—­ Redis æœåŠ¡ï¼Œé‡æ–°å¯åŠ¨ Redis æœåŠ¡ï¼Œé…ç½®æ‰ä¼šç”Ÿæ•ˆ** ã€‚
> 
>     [root@localhost test02]# redis-server /etc/redis.conf
>     [root@localhost test02]# redis-cli
>     
> 
> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727915-1746463485.png)

> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727922-1214854932.png)

2.  **save å’Œ bgsave**

    127.0.0.1:6379> save
    

    127.0.0.1:6379> bgsave
    

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727797-898923423.png)

**é»˜è®¤çš„å¿«ç…§é…ç½®ï¼š** å¦‚å›¾ï¼šåŒæ ·æ˜¯åœ¨ \`/etc/redis.confæ–‡ä»¶å½“ä¸­é…ç½®çš„ã€‚  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727947-1902263498.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728216-2087698895.png)

**æ³¨æ„ç†è§£è¿™ä¸ªæ—¶é—´æ®µçš„æ¦‚å¿µ.ï¼š**

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727891-843131704.png)

å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¼€å¯ save çš„æ³¨é‡Š é‚£ä¹ˆåœ¨é€€å‡º,Redis æ—¶ ä¹Ÿä¼šè¿›è¡Œå¤‡ä»½ æ›´æ–° dump.rdb æ–‡ä»¶çš„ã€‚

*   **save ï¼š** save æ—¶åªç®¡ä¿å­˜ï¼Œå…¶å®ƒä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡ã€‚æ‰‹åŠ¨ä¿å­˜ï¼Œä¸å»ºè®®ã€‚
*   **bgsaveï¼š** Redis ä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œå¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚
*   å¯ä»¥é€šè¿‡ **lastave** å‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´(unix æ—¶é—´æˆ³)ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·è½¬æ¢ã€‚[https://tool.lu/timestamp/](https://tool.lu/timestamp/)

3.  **flushall**

*   æ‰§è¡Œ flushall å‘½ä»¤ï¼Œä¹Ÿä¼šäº§ç”Ÿ dump.rdb æ–‡ä»¶ï¼Œæ•°æ®ä¸ºç©ºã€‚
*   `Redis Flushall` å‘½ä»¤ç”¨äºæ¸…ç©ºæ•´ä¸ª Redis æœåŠ¡å™¨çš„æ•°æ®(åˆ é™¤æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰ key )  
    ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728064-801347360.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728075-1403666438.png)

4.  **Save**

æ ¼å¼ï¼šsave ç§’é’Ÿ å†™æ“ä½œæ¬¡æ•°, å¦‚å›¾

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728083-2059240994.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728167-346056623.png)

**RDB æ˜¯æ•´ä¸ªå†…å­˜çš„å‹ç¼©è¿‡çš„ Snapshotï¼ŒRDB çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é…ç½®å¤åˆçš„å¿«ç…§è§¦å‘æ¡ä»¶** ã€‚

**ç¦ç”¨ï¼šç»™ save ä¼ ç©ºå­—ç¬¦ä¸²ï¼Œå¯ä»¥çœ‹æ–‡æ¡£ï¼š**

5.  **stop-writes-on-bgsave-error**  
    ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728071-1163521156.png)

> æ„æ€æ˜¯ï¼š**å½“ Redis æ— æ³•å†™å…¥ç£ç›˜çš„è¯(æ¯”å¦‚ç£ç›˜æ»¡äº†), ç›´æ¥å…³æ‰ Redis çš„å†™æ“ä½œã€‚æ¨è yes**

6.  **rdbcompression**

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728118-1057793637.png)

**è¯¥é…ç½®çš„æ„æ€æ˜¯ï¼š**

> 1.  å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œredis ä¼šé‡‡ç”¨ **LZF** ç®—æ³•è¿›è¡Œå‹ç¼©ã€‚
> 2.  å¦‚æœä½ ä¸æƒ³æ¶ˆè€— CPU æ¥è¿›è¡Œå‹ç¼©çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½ï¼Œé»˜è®¤ yesã€‚

7.  **rdbchecksum**

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727985-1994836542.png)

**è¯¥é…ç½®çš„æ„æ€æ˜¯ï¼š**

> 1.  åœ¨å­˜å‚¨å¿«ç…§åï¼Œè¿˜å¯ä»¥è®© redis ä½¿ç”¨ CRC64ç®—æ³•æ¥è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œä¿è¯æ–‡ä»¶æ˜¯å®Œæ•´çš„ã€‚
> 2.  ä½†æ˜¯è¿™æ ·åšä¼šå¢åŠ å¤§çº¦ 10% çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¦‚æœå¸Œæœ›è·å–åˆ°æœ€å¤§çš„æ€§èƒ½æå‡ï¼Œå¯ä»¥å…³é—­æ­¤åŠŸèƒ½ï¼Œæ¨è yes æ‰“å¼€ã€‚

8.  **åŠ¨æ€åœæ­¢ RDBï¼š**
    
9.  åŠ¨æ€åœæ­¢RDBï¼š `redis-cli config set save ""` ï¼Œå°±æ˜¯ç»™ save å±æ€§èµ‹å€¼ä¸º `""`ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºç¦ç”¨ä¿æŠ¤ç­–ç•¥ã€‚è¿™é‡Œä½¿ç”¨å‘½ä»¤æ˜¯è®© å®¢æˆ·ç«¯åœ¨æ­¤åˆ»ï¼Œå¯åŠ¨çš„å®¢æˆ·ç«¯åœæ­¢ RDBï¼Œä¸€æ—¦é€€å‡ºäº†è¯¥å®¢æˆ·ç«¯å°±ï¼Œè¯¥é…ç½®å°±å¤±æ•ˆäº†ã€‚RDB æŒä¹…åŒ–ç­–ç•¥åˆå¯åŠ¨äº†ã€‚
    

* * *

**ç¤ºä¾‹æ¼”ç¤ºï¼š**

éœ€æ±‚: å¦‚æœ Redis çš„ key åœ¨ 30 ç§’å†…, æœ‰ 5 ä¸ª key å˜åŒ–, å°±è‡ªåŠ¨è¿›è¡Œ RDB å¤‡ä»½.  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727895-1061223627.png)

    save 30 5
    

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727721-1793891322.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728060-1093204588.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728057-848551200.png)  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728088-370827509.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728290-1573912056.png)

4\. RDB å¤‡ä»½&æ¢å¤
=============

Redis å¯ä»¥å……å½“ç¼“å­˜ï¼Œå¯¹é¡¹ç›®è¿›è¡Œä¼˜åŒ–ï¼Œå› æ­¤é‡è¦/æ•æ„Ÿçš„æ•°æ®å»ºè®®åœ¨ MySQLè¦ä¿å­˜ä¸€ä»½ã€‚

ä»è®¾è®¡å±‚é¢æ¥è¯´ï¼ŒRedis çš„å†…å­˜æ•°æ®ï¼Œéƒ½æ˜¯å¯ä»¥é‡æ–°è·å–çš„(å¯èƒ½æ¥è‡ªç¨‹åºï¼Œä¹Ÿå¯èƒ½æ¥è‡ªMySQL)

å› æ­¤æˆ‘ä»¬è¿™é‡Œè¯´çš„**å¤‡ä»½&æ¢å¤** ï¼š**ä¸»è¦æ˜¯ç»™å¤§å®¶è¯´æ˜ä¸€ä¸‹ Redis å¯åŠ¨æ—¶ï¼Œåˆå§‹åŒ–æ•°æ®æ˜¯ä» `dump.rdb` æ¥çš„** æ•´ä¸ªæœºåˆ¶ã€‚

**æ¼”ç¤ºï¼š**

è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºçš„æ˜¯ï¼š

> å°†æˆ‘ä»¬å·²ç»çš„ `dump.rdb` å¤‡ä»½æ–‡ä»¶å¤åˆ¶æ‹·è´(å¤‡ä»½)ä¸€ä»½ï¼Œå¤åˆ¶åä¹‹åï¼Œå†å°†åŸæ¥çš„`dump.rdb` æ–‡ä»¶åˆ é™¤äº†(æ¨¡æ‹Ÿæ–‡ä»¶æŸåäº†ï¼Œæˆ–è€…æ˜¯æ‰§è¡Œ flushall åˆ é™¤åº“)ã€‚å†å°†æˆ‘ä»¬æ‹·è´å¤‡ä»½çš„ dum.rdb æ–‡ä»¶ï¼Œå¤åˆ¶è¿‡å»ï¼Œç„¶åé‡å¯ redis è¯»å– dump.rdb å¤‡ä»½æ–‡ä»¶å½“ä¸­çš„æ•°æ®ï¼Œè¿›è¡Œä¸€ä¸ªæ•°æ®ä¸Šçš„æ¢å¤ã€‚

`config get dir` æŸ¥è¯¢ rdb æ–‡ä»¶çš„ç›®å½•

    127.0.0.1:6379> config get dir
    

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727893-2102326791.png)

å°† dump.rdb è¿›è¡Œå¤‡ä»½ å¦‚æœæœ‰å¿…è¦å¯ä»¥å†™ shell è„šæœ¬æ¥å®šæ—¶å¤‡ä»½ \[å‚è€ƒéŸ©é¡ºå¹³è€å¸ˆ Linux è¯¾ç¨‹å®šæ—¶  
,å¤‡ä»½ Mysql æ•°æ®åº“è§†é¢‘åœ°å€ [https://www.bilibili.com/video/BV1Sv411r7vd?p=105](https://www.bilibili.com/video/BV1Sv411r7vd?p=105) \] ã€‚

    [root@localhost ~]# cp /root/dump.rdb /root/dump.rdb.bak
    

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728235-1066469836.png)  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727919-1651991348.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728221-1396697556.png)

    127.0.0.1:6379> flushall
    

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728227-126968919.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728224-764722636.png)

> æ³¨æ„ï¼šè¿™é‡Œå¾—å…³é—­ä¸€ä¸‹æœåŠ¡å™¨
> 
> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728061-1739221397.png)

    [root@localhost ~]# rm /root/dump.rdb # åˆ é™¤æ–‡ä»¶å¤¹
    

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728230-1443492600.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728231-198659821.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728081-1120978350.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728072-1989254182.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728070-1479736544.png)

å…³é—­ Redis æœåŠ¡å™¨ï¼Œé‡æ–°å¯åŠ¨ Redis æœåŠ¡å™¨ï¼Œè®©å®ƒè¯»å–åˆ°æˆ‘ä»¬é…ç½®çš„`dump.rdb` å¤‡ä»½æ–‡ä»¶ï¼Œæ¢å¤æˆ‘ä»¬çš„æ•°æ®ä¿¡æ¯ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727767-425519328.png)

5\. RDB æŒä¹…åŒ–å°ç»“(ä¼˜åŠ¿ å’Œ åŠ£åŠ¿)
======================

**ä¼˜åŠ¿ï¼š**

1.  é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤
2.  å¯¹æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚ä¸é«˜æ›´é€‚åˆä½¿ç”¨
3.  èŠ‚çœç£ç›˜ç©ºé—´
4.  æ¢å¤é€Ÿåº¦å¿«  
    ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222727758-865338926.png)

**åŠ£åŠ¿ï¼š**

1.  è™½ç„¶ Redis åœ¨ fork æ—¶ä½¿ç”¨äº†å†™æ—¶æ‹·è´æŠ€æœ¯(Cop-On-Write) ï¼Œä½†æ˜¯å¦‚æœæ•°æ®åºå¤§æ—¶è¿˜æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚
2.  åœ¨å¤‡ä»½å‘¨æœŸåœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡å¤‡ä»½ï¼Œæ‰€ä»¥å¦‚æœ **Redis æ„å¤– down æ‰** çš„è¯(å¦‚æœæ­£å¸¸å…³é—­ Redisä»ç„¶ä¼šè¿›è¡Œ RDB å¤‡ä»½ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®)ï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹ã€‚

6\. æœ€åï¼š
=======

> â€œåœ¨è¿™ä¸ªæœ€åçš„ç¯‡ç« ä¸­ï¼Œæˆ‘è¦è¡¨è¾¾æˆ‘å¯¹æ¯ä¸€ä½è¯»è€…çš„æ„Ÿæ¿€ä¹‹æƒ…ã€‚ä½ ä»¬çš„å…³æ³¨å’Œå›å¤æ˜¯æˆ‘åˆ›ä½œçš„åŠ¨åŠ›æºæ³‰ï¼Œæˆ‘ä»ä½ ä»¬èº«ä¸Šå¸å–äº†æ— å°½çš„çµæ„Ÿä¸å‹‡æ°”ã€‚æˆ‘ä¼šå°†ä½ ä»¬çš„é¼“åŠ±ç•™åœ¨å¿ƒåº•ï¼Œç»§ç»­åœ¨å…¶ä»–çš„é¢†åŸŸå¥‹æ–—ã€‚æ„Ÿè°¢ä½ ä»¬ï¼Œæˆ‘ä»¬æ€»ä¼šåœ¨æŸä¸ªæ—¶åˆ»å†æ¬¡ç›¸é‡ã€‚â€
> 
> ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2024.cnblogs.com/blog/3084824/202502/3084824-20250204222728069-1975895416.gif)