---
layout: post
title: 'Springç›‘å¬å™¨ï¼ˆApplicationEventï¼‰ï¼šæ¯”MQæ›´è½»çš„å¼‚æ­¥ç¥å™¨ï¼'
date: "2025-12-06T00:41:45Z"
---
Springç›‘å¬å™¨ï¼ˆApplicationEventï¼‰ï¼šæ¯”MQæ›´è½»çš„å¼‚æ­¥ç¥å™¨ï¼
=======================================

![Springç›‘å¬å™¨ï¼ˆApplicationEventï¼‰ï¼šæ¯”MQæ›´è½»çš„å¼‚æ­¥ç¥å™¨ï¼](https://img2024.cnblogs.com/blog/3703499/202512/3703499-20251205091949269-1198401269.png) Springäº‹ä»¶é©±åŠ¨ï¼šäº¿çº§æµé‡ä¸‹çš„å’–å•¡åº—ç»è¥ä¹‹é“â€”â€”æ¯”MQæ›´è½»çš„å¼‚æ­¥è§£è€¦å®æˆ˜ã€‚Springä¸­ApplicationEventçš„æœ€ä½³å®è·µã€‚

### å¼•è¨€ï¼šå½“å’–å•¡åº—é­é‡ç¨‹åºå‘˜

> â€œé¡¾å®¢æŒ¤çˆ†æŸœå°æ—¶ï¼Œä¼˜ç§€çš„åº—é•¿ä¸ä¼šå‚¬ä¿ƒå’–å•¡å¸ˆåŠ é€Ÿï¼Œè€Œæ˜¯å¯åŠ¨ä¸€å¥—ç§‘å­¦çš„åä½œæœºåˆ¶â€”â€”  
> å°±åƒSpringäº‹ä»¶é©±åŠ¨ï¼Œç”¨**å‘å¸ƒ-è®¢é˜…æ¨¡å¼**è®©ç³»ç»Ÿåƒé¡¶çº§å’–å•¡å›¢é˜Ÿèˆ¬ä¼˜é›…åº”å¯¹æ´ªå³°æµé‡â€

* * *

### ä¸€ã€å’–å•¡åº—é‡Œçš„ç›‘å¬å™¨ï¼š3ä½çµé­‚è§’è‰²

**çœŸå®æˆ˜åœºè¿˜åŸ**ï¼ˆæ¯ç§’1000è®¢å•çš„å’–å•¡åº—ï¼‰ï¼š

graph LR é¡¾å®¢\["ğŸ”¥ é¡¾å®¢å–Šå•ï¼ˆäº‹ä»¶å‘å¸ƒè€…ï¼‰"\] --> è®¢å•äº‹ä»¶\["ğŸ“¦ OrderEventï¼ˆäº‹ä»¶å¯¹è±¡ï¼‰"\] è®¢å•äº‹ä»¶ --> å’–å•¡å¸ˆ\["â˜• å’–å•¡å¸ˆï¼ˆç›‘å¬å™¨1ï¼‰"\] è®¢å•äº‹ä»¶ --> æ”¶é“¶å‘˜\["ğŸ’° æ”¶é“¶å‘˜ï¼ˆç›‘å¬å™¨2ï¼‰"\] è®¢å•äº‹ä»¶ --> ç”œç‚¹å¸ˆ\["ğŸ° ç”œç‚¹å¸ˆï¼ˆç›‘å¬å™¨3ï¼‰"\]

#### 1\. äº‹ä»¶å®šä¹‰ï¼šå’–å•¡åº—çš„ã€Œè®¢å•å°ç¥¨ã€

    public class OrderEvent extends ApplicationEvent {
        // finalä¿®é¥°çš„è®¢å•IDï¼šå°±åƒå’–å•¡å¸ˆç»ä¸æ¶‚æ”¹çš„è®¢å•å°ç¥¨
        private final String orderId;  
        
        // åˆ›å»ºæ—¶é—´ï¼šè®°å½•è®¢å•è¯ç”Ÿæ—¶åˆ»ï¼ˆçº¿ç¨‹å®‰å…¨ä¸å¯å˜ï¼‰
        private final LocalDateTime createTime = LocalDateTime.now(); 
    
        // æ— setterï¼šé˜²æ­¢å¤šçº¿ç¨‹å¹¶å‘ç¯¡æ”¹è®¢å•
    }
    

#### 2\. äº‹ä»¶å‘å¸ƒï¼šåº—é•¿çš„ã€Œå¹¿æ’­ç³»ç»Ÿã€

    @Service
    public class OrderService {
        // åº—é•¿çš„éº¦å…‹é£ï¼ˆæ„é€ å™¨æ³¨å…¥æ›´ä¼˜é›…ï¼‰
        private final ApplicationEventPublisher eventPublisher; 
    
        public void createOrder(Order order) {
            // æ ¸å¿ƒä¸šåŠ¡ï¼šç”Ÿæˆè®¢å•ï¼ˆå’–å•¡åº—æ¥å•ï¼‰
            eventPublisher.publishEvent(new OrderEvent(this, order.getId())); // ğŸ“¢ å¹¿æ’­è®¢å•
        }
    }
    

#### 3\. äº‹ä»¶ç›‘å¬ï¼šå’–å•¡å›¢é˜Ÿçš„ã€ŒæŠ€èƒ½å“åº”ã€

    @Component
    public class CoffeeMakerListener {
        @EventListener 
        @Order(1) // ä¼˜å…ˆçº§ï¼šå…ˆåšå’–å•¡å†æ¨èç”œç‚¹
        public void makeCoffee(OrderEvent event) {
            // ä¸“æ³¨åšå’–å•¡ï¼Œä¸å…³å¿ƒè°ç»“è´¦
            log.info("å’–å•¡å¸ˆï¼šå¼€å§‹åˆ¶ä½œè®¢å•{}çš„æ‹¿é“...", event.getOrderId());
        }
    }
    

* * *

### äºŒã€æ‰›ä½äº¿çº§æµé‡çš„3æŠŠåˆ©å™¨

#### ğŸ”¥ **åœºæ™¯1ï¼šå†·å¯åŠ¨ç¼“å­˜é¢„åŠ è½½ï¼ˆé˜²é›ªå´©ï¼‰**

    @Component
    public class CachePreloader {
        // åœ¨Springå®¹å™¨"å¼€åº—å‡†å¤‡å®Œæˆ"æ—¶è§¦å‘
        @EventListener(ContextRefreshedEvent.class) 
        public void initCache() {
            // å¼‚æ­¥åŠ è½½çœæ—¶30%ï¼ˆå®æµ‹æ•°æ®ï¼‰
            CompletableFuture.runAsync(() -> {
                provinceService.loadProvincesToCache(); 
                productService.preloadHotProducts();
            });
        }
    }
    

#### ğŸ’¡ **åœºæ™¯2ï¼šäº‹åŠ¡æˆåŠŸåçš„ç¼“å­˜æ¸…ç†ï¼ˆä¿ä¸€è‡´æ€§ï¼‰**

    // åªåœ¨æ•°æ®åº“æäº¤æˆåŠŸåæ‰§è¡Œï¼ˆé¿å…è„æ¸…ç†ï¼‰
    @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
    public void cleanCache(OrderUpdateEvent event) {
        // å¼‚æ­¥æ¸…ç†ï¼šä¸é˜»å¡ç»“è´¦é˜Ÿä¼
        redisTemplate.executeAsync(new RedisCallback<>() {
            @Override
            public Void doInRedis(RedisConnection connection) {
                connection.del(("order:" + event.getId()).getBytes());
                return null;
            }
        });
    }
    

#### ğŸš€ **åœºæ™¯3ï¼šæ— ä¾µå…¥å¼åŠŸèƒ½æ‰©å±•**

**æ”¹é€ å‰ï¼ˆè‡ƒè‚¿çš„æ”¶é“¶å°ï¼‰**ï¼š

    public void pay() {
        paymentService.pay();   // æ ¸å¿ƒæ”¯ä»˜
        auditService.log();     // å®¡è®¡ä»£ç å…¥ä¾µ
        riskService.check();    // é£æ§ä»£ç è€¦åˆ
        marketingService.addPoints(); // æ–°å¢éœ€æ±‚æ±¡æŸ“æ ¸å¿ƒ
    }
    

**äº‹ä»¶é©±åŠ¨æ”¹é€ å**ï¼š

    // çº¯å‡€æ”¯ä»˜æ ¸å¿ƒï¼ˆä¸“æ³¨æ”¶é’±ï¼‰
    public void pay(Long orderId) {
        paymentService.process(orderId);
        eventPublisher.publishEvent(new PaymentSuccessEvent(orderId)); // ğŸ“¢ å¹¿æ’­æ”¯ä»˜æˆåŠŸ
    }
    
    // æ–°å¢ç§¯åˆ†æ¨¡å—ï¼ˆæ— éœ€ä¿®æ”¹æ”¯ä»˜ä»£ç ï¼‰
    @Component
    public class PointListener {
        @EventListener
        public void addPoints(PaymentSuccessEvent event) {
            // ç§¯åˆ†æœåŠ¡ç‹¬ç«‹æ¼”è¿›
            pointService.award(event.getOrderId(), 100); 
        }
    }
    

* * *

### ä¸‰ã€è¡€æ³ªæ•™è®­ï¼š3ä¸ªæ·±å¤œåŠ ç­äº‹æ•…

#### ğŸš« **äº‹æ•…1ï¼šå¤šçº¿ç¨‹ç¯¡æ”¹äº‹ä»¶ï¼ˆè®¢å•æ··ä¹±ï¼‰**

    // é”™è¯¯ï¼äº‹ä»¶å¿…é¡»æ˜¯åªè¯»çš„
    @EventListener
    public void handle(OrderEvent event) {
        event.setStatus("MODIFIED"); // âš ï¸ å¤šçº¿ç¨‹å¹¶å‘ä¿®æ”¹å¼•å‘è®¢å•é”™ä¹±
    }
    

> **æ­£ç¡®åšæ³•**ï¼šäº‹ä»¶ç±»è®¾è®¡ä¸ºfinalå­—æ®µ + æ— setter

#### ğŸš« **äº‹æ•…2ï¼šå¼‚æ­¥äº‹ä»¶ä¸¢å¤±ï¼ˆé¡¾å®¢æŠ•è¯‰ï¼‰**

    @SpringBootApplication
    @EnableAsync // å¿…é¡»æ˜¾å¼å¼€å¯å¼‚æ­¥
    public class Application {
        @Bean("eventExecutor") 
        public Executor taskExecutor() {
            // å…³é”®å‚æ•°ï¼šæ‹’ç»ç­–ç•¥ç”¨CallerRunsPolicyï¼ˆé¿å…ä¸¢å•ï¼‰
            ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
            executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
            return executor;
        }
    }
    
    // æŒ‡å®šçº¿ç¨‹æ± æ‰§è¡Œ
    @Async("eventExecutor") 
    @EventListener
    public void asyncHandle(OrderEvent event) {...}
    

#### ğŸš« **äº‹æ•…3ï¼šäº‹ä»¶å¾ªç¯è°ƒç”¨ï¼ˆå’–å•¡å¸ˆå¡æ­»ï¼‰**

    // é”™è¯¯ï¼šåœ¨äº‹ä»¶å¤„ç†ä¸­å‘å¸ƒæ–°äº‹ä»¶
    @EventListener
    public void handleA(EventA a) {
        publisher.publishEvent(new EventB()); 
    }
    
    @EventListener
    public void handleB(EventB b) {
        publisher.publishEvent(new EventA()); // â™»ï¸ æ­»å¾ªç¯ï¼
    }
    

* * *

### å››ã€å…³é”®æŠ‰æ‹©ï¼šç›‘å¬å™¨ vs MQ æ¶æ„å¯¹å’

**ç»´åº¦**

**Springç›‘å¬å™¨**

**MQæ¶ˆæ¯é˜Ÿåˆ—**

**é€‚ç”¨åœºæ™¯**

å•æœºäº‹åŠ¡åä½œ âœ…

è·¨æœåŠ¡é€šä¿¡ âœ…

**å¯é æ€§**

è¿›ç¨‹å®•æœºäº‹ä»¶æ¶ˆå¤± âŒ

æŒä¹…åŒ–/é‡è¯• âœ…

**ååé‡**

å†…å­˜çº§ä¼ è¾“ï¼Œ10w+/s ğŸš€

å—ç½‘ç»œé™åˆ¶ï¼Œ1w/s âš ï¸

**å¼€å‘æ•ˆç‡**

å…æ­å»ºMQï¼Œæ³¨è§£å³ç”¨ âœ…

éœ€éƒ¨ç½²ä¸­é—´ä»¶ âŒ

**æ•°æ®ä¸€è‡´æ€§**

æœ¬åœ°äº‹åŠ¡ä¿éšœ âœ…

éœ€åˆ†å¸ƒå¼äº‹åŠ¡ âš ï¸

> **é»„é‡‘å†³ç­–æ ‘**ï¼š
> 
> *   åŒJVMäº‹åŠ¡æ“ä½œ â†’ `Springç›‘å¬å™¨`ï¼ˆå¼€å‘æ•ˆç‡ç‹ç‚¸ï¼‰
> *   è·¨æœåŠ¡æœ€ç»ˆä¸€è‡´ â†’ `RocketMQ`ï¼ˆå¯é æ€§æ‹…å½“ï¼‰

* * *

### äº”ã€æ€§èƒ½è°ƒä¼˜ï¼šç›‘å¬å™¨çš„æ¶¡è½®å¢å‹

1.  **å¼‚æ­¥å–·å°„**ï¼š
    
        @Async // æ–¹æ³•çº§å¼‚æ­¥ï¼ˆçº¿ç¨‹æ± åŠ é€Ÿï¼‰
        @EventListener
        public void asyncProcess(LogEvent event) {...}
        
    
2.  **æ¡ä»¶è¿‡æ»¤**ï¼ˆå‡å°‘æ— æ•ˆå¤„ç†ï¼‰ï¼š
    
        // åªå¤„ç†VIPå®¢æˆ·çš„è®¢å•
        @EventListener(condition = "#event.user.level == 'VIP'")
        public void handleVipOrder(OrderEvent event) {...}
        
    
3.  **æ‰¹é‡å¤„ç†**ï¼ˆSpring 4.2+ç‰¹æ€§ï¼‰ï¼š
    
        // ä¸€æ¬¡æ€§å¤„ç†æ•´æ‰¹è®¢å•ï¼ˆæå‡æ•°æ®åº“IOæ•ˆç‡ï¼‰
        @EventListener
        public void batchProcess(List<OrderEvent> events) {
            orderDao.batchInsert(events.stream().map(OrderConverter::toEntity).toList());
        }
        
    

* * *

### å…­ã€æœ€ä½³å®è·µï¼š5æ¡ç”Ÿå­˜æ³•åˆ™

1.  **å•ä¸€èŒè´£åŸåˆ™**  
    `ä¸€ä¸ªç›‘å¬å™¨åªåšä¸€ä»¶äº‹`ï¼šå¦‚ `PaymentListener` åªå¤„ç†æ”¯ä»˜ï¼Œ`CouponListener` åªå‘åˆ¸
    
2.  **äº‹ä»¶è½»é‡åŒ–**  
    ç¦æ­¢åœ¨äº‹ä»¶ä¸­æºå¸¦ `HttpSession` ç­‰é‡å‹å¯¹è±¡ï¼ˆå»ºè®®åªä¼ IDï¼‰
    
3.  **å¼‚å¸¸éš”ç¦»èˆ±**  
    å¼‚æ­¥äº‹ä»¶å¿…é¡»ç‹¬ç«‹æ•è·å¼‚å¸¸ï¼š
    
        @Async
        @EventListener
        public void handle(Event event) {
            try { 
                businessLogic(); 
            } catch (Exception e) { 
                // è®°å½•æ—¥å¿— + å‘Šè­¦ï¼ˆé˜²æ­¢é›ªå´©ï¼‰
                log.error("äº‹ä»¶å¤„ç†å¤±è´¥: {}", event, e); 
                alarmManager.notify(e);
            }
        }
        
    
4.  **ç‰ˆæœ¬å…¼å®¹è®¾è®¡**  
    äº‹ä»¶ç±»é¢„ç•™ç‰ˆæœ¬å­—æ®µï¼š
    
        public class OrderEvent {
            private final String version = "1.0"; // æœªæ¥å¯æ‰©å±•
        }
        
    
5.  **ç›‘æ§ä¸‰ä»¶å¥—**
    
        // ç›‘æ§å¤„ç†æ—¶é•¿/å¤±è´¥ç‡/QPS
        @Around("@annotation(org.springframework.context.event.EventListener)")
        public Object monitor(ProceedingJoinPoint pjp) {
            Timer.Sample sample = Timer.start();
            try {
                return pjp.proceed();
            } finally {
                sample.stop(Metrics.timer("event.process.time"));
            }
        }
        
    

* * *

### ç»“è¯­ï¼šäº‹ä»¶é©±åŠ¨çš„è‰ºæœ¯

> ä¼˜ç§€æ¶æ„çš„æœ¬è´¨ä¸æ˜¯é¢„æµ‹æ‰€æœ‰éœ€æ±‚ï¼Œè€Œæ˜¯æ‹¥æŠ±å˜åŒ–ã€‚  
> é€šè¿‡Springäº‹ä»¶ç›‘å¬å™¨ï¼Œæˆ‘ä»¬å°†ç³»ç»Ÿæ‹†è§£ä¸º**å¯æ’æ‹”çš„ä¹é«˜æ¨¡å—**ï¼š
> 
> *   æ–°å¢åŠŸèƒ½æ—¶ â†’ æ·»åŠ ç›‘å¬å™¨ï¼ˆæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç ï¼‰
> *   æµé‡æš´å¢æ—¶ â†’ å¼€å¯å¼‚æ­¥ï¼ˆæ— éœ€é‡æ„æ¶æ„ï¼‰
> 
> è¿™æ°å¦‚ç»è¥å’–å•¡åº—çš„çœŸè°›ï¼š  
> **â€œä¸æ˜¯é›‡ä½£æ›´å¿«çš„å’–å•¡å¸ˆï¼Œè€Œæ˜¯è®¾è®¡æ°¸ä¸æ‹¥å µçš„åä½œæœºåˆ¶â€**
> 
> **ç¨‹åºå‘˜å½©è›‹**ï¼š  
> ä¸‹å›å½“ä½ ä¸ºéœ€æ±‚å˜æ›´ç„¦å¤´çƒ‚é¢æ—¶ï¼Œä¸å¦¨é—®é—®è‡ªå·±ï¼š  
> **â€œæˆ‘çš„ä»£ç ï¼Œåƒä¸€å®¶åº”å¯¹è‡ªå¦‚çš„å’–å•¡åº—å—ï¼Ÿâ€**

* * *

> æŠ€æœ¯é€‰å‹å»ºè®®ï¼š**ä¸‡çº§QPSä»¥å†…é¦–é€‰Springäº‹ä»¶ï¼Œè¶…è¶Šåˆ™ä¸ŠMQ**