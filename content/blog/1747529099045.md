---
layout: post
title: 'è‡ªåˆ¶ä½“ç§¯ä¸åˆ° 2kB çš„ä»£ç ç¼–è¾‘å™¨ï¼ŒareaEditor.jsï¼Œå¢å¼º textarea æ ‡ç­¾çš„ä»£ç ç¼–è¾‘ä½“éªŒ'
date: "2025-05-18T00:44:59Z"
---
è‡ªåˆ¶ä½“ç§¯ä¸åˆ° 2kB çš„ä»£ç ç¼–è¾‘å™¨ï¼ŒareaEditor.jsï¼Œå¢å¼º textarea æ ‡ç­¾çš„ä»£ç ç¼–è¾‘ä½“éªŒ
=====================================================

ç›®å½•

*   [èµ·å› ](#èµ·å› )
*   [å¿«é€Ÿä½¿ç”¨](#å¿«é€Ÿä½¿ç”¨)
*   [ç¼©è¿›åŠŸèƒ½](#ç¼©è¿›åŠŸèƒ½)
*   [ç¼©è¿›ç±»å‹](#ç¼©è¿›ç±»å‹)
*   [è‡ªåŠ¨è¡¥å…¨æ‹¬å·](#è‡ªåŠ¨è¡¥å…¨æ‹¬å·)
*   [çŠ¯éš¾](#çŠ¯éš¾)
*   [è‡ªåŠ¨è¡¥å…¨](#è‡ªåŠ¨è¡¥å…¨)
*   [é˜»æ­¢è¡¥å…¨](#é˜»æ­¢è¡¥å…¨)
*   [ç¼–è¾‘æ¡†æŠ–åŠ¨](#ç¼–è¾‘æ¡†æŠ–åŠ¨)
*   [åœ¨ç©ºè¡ŒæŒ‰ä¸‹åˆ é™¤é”®ï¼Œæ¸…ç©º](#åœ¨ç©ºè¡ŒæŒ‰ä¸‹åˆ é™¤é”®æ¸…ç©º)
*   [å°è£…ä»£ç ](#å°è£…ä»£ç )
*   [æ€ä¹ˆå‹ç¼© JavaScript ä»£ç ](#æ€ä¹ˆå‹ç¼©-javascript-ä»£ç )
*   [æ›´å¤šçš„åŠŸèƒ½ï¼Ÿ](#æ›´å¤šçš„åŠŸèƒ½)

èµ·å› 
--

å‰ä¸¤å¤©æˆ‘æçš„é‚£ä¸ªåœ¨çº¿ HTML æ–°æ ‡ç­¾é¡µé¢„è§ˆåŠŸèƒ½ [https://www.cnblogs.com/duyuanshang/p/18829312](https://www.cnblogs.com/duyuanshang/p/18829312) ï¼Œå¾ˆå¥½ç”¨ï¼Œæœ€è¿‘åœ¨æˆ‘å·¥ä½œä¸Šå¸®äº†å¾ˆå¤§çš„å¿™ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä¸ç”¨æ‰“å¼€æœ¬åœ°ä»£ç ç¼–è¾‘å™¨å°±èƒ½å¿«é€Ÿè°ƒè¯•ä¸€äº›å‰ç«¯ä»£ç ï¼Œæˆ‘ä¹Ÿé€æ­¥å®Œå–„å®ƒçš„äº†å¾ˆå¤šåŠŸèƒ½ã€‚å¯æ˜¯ï¼Œå¾ˆå¿«å®ƒå°±æœ‰äº†ä¸€ä¸ªé—®é¢˜ï¼š ä½¿ç”¨ `<textarea>` å†™ä»£ç å¾ˆä¸èˆ’æœã€‚

å½“ç„¶ï¼Œä½¿ç”¨å®ƒæ¥æ¥å—ç²˜è´´è¿‡åçš„ä»£ç è¿˜å¥½ï¼Œå¦‚æœæƒ³å†ç¼–è¾‘ä¸€ä¸‹ã€åˆ åˆ æ”¹æ”¹è°ƒæ•´è°ƒæ•´ç¼©è¿›ï¼Œé‚£ç®€ç›´éš¾å—æ­»äº†ã€‚

æœ€æ˜¾è€Œæ˜“è§çš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ä½¿ç”¨ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„ åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ çš„ js åº“ï¼Œåƒå¦‚ [Code Mirror](https://codemirror.net/ "Code Mirror") æˆ– [Ace](https://ace.c9.io/ "Ace") è¿™äº›æˆç†Ÿåˆè‘—åçš„ç¼–è¾‘å™¨ï¼Œå¯æ˜¯..... å®ƒä»¬ä½“ç§¯æœ‰ç‚¹å¤§ï¼Œè™½ç„¶å¤§åŠ›å‹ç¼©å¤„ç†åä¹Ÿä¸è¿‡ 100kb å·¦å³ï¼Œä½†ä¾ç„¶é‡é‡çº§ã€‚

åœ¨å¾ˆä¹…ä»¥å‰ï¼Œæˆ‘å°±æ„Ÿè§‰åˆ°ä»£ç ç¼–è¾‘æ¡†çš„é‡è¦æ€§äº†ï¼Œå¾ˆå¤šå‰ç«¯é¡µé¢éƒ½ä¼šæœ‰åœ¨çº¿å†™ä¸€äº›è„šæœ¬çš„éœ€æ±‚ï¼Œå¦‚æœä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„è¯ä¸€èˆ¬å°±å¼•å…¥ç¬¬ä¸‰æ–¹åº“äº†ï¼Œä½†æˆ‘çœŸçš„ä¸æƒ³å¼•å…¥ï¼Œè§‰å¾—å¾·ä¸é…ä½ï¼Œäºæ˜¯æˆ‘çœ‹ç€é‚£ä¸ª textarea æ¡†å¼€å§‹å‘å‘†ã€‚æˆ‘åœ¨æƒ³ï¼Œæœ‰æ²¡æœ‰åŠæ³•èƒ½è®©å®ƒåœ¨å†™ä»£ç æ—¶ï¼Œä½“éªŒå¥½ä¸€ç‚¹ã€‚

![image](https://img2024.cnblogs.com/blog/1669501/202505/1669501-20250517150538748-1805162333.png)

äºæ˜¯è¿™å‡ å¤©æˆ‘å°±æ£é¼“äº†ä¸€ä¸ªå¾ˆè¿·ä½ çš„ js åº“ï¼Œ[https://github.com/kohunglee/areaEditor](https://github.com/kohunglee/areaEditor) areaEditor.jsï¼Œç”¨ç€è¿˜çœŸæŒºèˆ’æœã€‚è¿™ä¸ªæ˜¯ä¸€ä¸ªæ¼”ç¤º ï¼š [https://www.ccgxk.com/areaEditor.html](https://www.ccgxk.com/areaEditor.html) ï¼Œ**æ¬¢è¿èµä¸ª star ï¼Œè°¢è°¢æ‚¨ Thanksâ™ª(ï½¥Ï‰ï½¥)ï¾‰**

 [![image](https://img2024.cnblogs.com/blog/1669501/202505/1669501-20250517140603390-1976620324.png) ğŸ‘ˆğŸ» å•å‡»è¿™é‡Œ](https://github.com/kohunglee/areaEditor)

ï¼ˆåˆèŠ±äº†åŠä¸ªæœˆï¼Œé€æ¸ä¼˜åŒ–åˆ°èƒ½å‡ºå±±äº†ï¼Œè™½ç„¶ç”¨ä¹ æƒ¯äº† IDE çš„äººå¯èƒ½è§‰å¾—å®ƒç”¨å¤„ä¸å¤§ï¼Œä½† `textarea` æ˜¯çœŸçš„æ²¡æ³•ç”¨ï¼Œå†µä¸”å®ƒåªæœ‰ 2kbï¼å°åˆ°å¿½ç•¥ä¸è®¡ï¼Œä½œç”¨å´ä¸å®¹å°è§‘ï¼Œæ‰€ä»¥ä¸€å®šä¼šæœ‰äººèƒ½ç”¨åˆ°ï¼ï¼‰

å¿«é€Ÿä½¿ç”¨
----

åªéœ€è¿™æ ·å³å¯ï¼š

    <script src="https://cdn.jsdelivr.net/gh/kohunglee/areaeditor/src/areaeditor.2.0.x.min.js" integrity="sha256-sP3tIYbNNHejSjhs3X0SBLULz54YEbR3g1dSJMvpCME=" crossorigin="anonymous"></script>
    <script>
        var editor = new AreaEditor('textarea', {indentType : { type: 'space', count: 4 }});
    </script>
    

è¿™æ ·ï¼Œæ‚¨çš„ç½‘é¡µä¸Šæ‰€æœ‰çš„ `<textarea>` å°±éƒ½å¯ä»¥ç¼©è¿›äº†ã€‚å½“ç„¶ï¼Œ`{indentType : { type: 'space', count: 4 }}` æ˜¯æ§åˆ¶ç¼©è¿›çš„ç±»å‹ï¼Œ`space` æ˜¯ç©ºæ ¼ç¼©è¿›ï¼Œç›®å‰æ˜¯ 4 ä¸ªç©ºæ ¼ã€‚å¦‚æœå†™æˆ `{indentType : { type: 'tab', count: 1 }}`ï¼Œåˆ™æ˜¯ä¸€ä¸ª `'\t'` TAB åˆ¶è¡¨ç¬¦ã€‚

ï¼ˆä¸å†™è¿™ä¸ªé…ç½®ï¼Œç›´æ¥ `new AreaEditor('textarea')` ä¹Ÿå¯ä»¥ï¼Œé»˜è®¤æ˜¯ 4 ä¸ªç©ºæ ¼ ï¼‰

åç»­ä¹Ÿå¯ä»¥åŠ¨æ€è¿›è¡Œæ›´æ”¹ã€‚æ¯”å¦‚ï¼š

    editor.indentType.type = 'tab';  // è¿™æ ·å¯ä»¥åŠ¨æ€ä¿®æ”¹ç¼©è¿›
    

å½“ç„¶ï¼Œå¦‚æœæ˜¯ç‰¹å®šå…ƒç´ ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€‰æ‹©å™¨ï¼š

    var editor = new AreaEditor('textarea');  // é€‰ä¸­æ‰€æœ‰çš„ textarea å…ƒç´ 
    var editor = new AreaEditor('.code-editor');  // é€‰ä¸­æ‰€æœ‰ class ä¸º code-editor çš„ textarea å…ƒç´ 
    var editor = new AreaEditor('#code-editor');  // é€‰ä¸­ id ä¸º code-editor çš„ textarea å…ƒç´ 
    

ç¼©è¿›åŠŸèƒ½
----

æœ€å¼€å§‹ï¼Œæˆ‘æ‰¾äº†å¾ˆå¤šèµ„æ–™ï¼Œå‘ç°è²Œä¼¼æ²¡äººæœ‰é’ˆå¯¹ `<textarea>` çš„ç›´æ¥ä¼˜åŒ–ã€‚ä»£ç ç¼–è¾‘å™¨æ˜¯å¾ˆå¤šï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å¦è¾Ÿä¸€å¤§å † `<div>` æ¨¡æ‹Ÿæ–°ç¼–è¾‘æ¡†äº†ï¼Œæˆ–è€…ç›´æ¥åœ¨å¤§è½®å­ Code Mirror åŸºç¡€ä¸Šè¿›ä¸€æ­¥æ”¹è¿›ã€‚

å…¶å®ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦çš„å¹¶ä¸å¤šã€‚æ¯”å¦‚ï¼Œè¿™äº›ä»£ç ç¼–è¾‘å™¨æœ‰é«˜äº®çš„åŠŸèƒ½ï¼Œèƒ½äº”é¢œå…­è‰²æ˜¾ç¤ºå…³é”®è¯ï¼Œå…¶å®è¿™ä¸ªå±äºã€Œæ¶ˆè´¹å‡çº§ã€çš„éåˆšéœ€åŠŸèƒ½äº†ï¼ŒçœŸæ­£åœ¨ç¼–è¾‘æ—¶çš„åˆšéœ€æ˜¯ **ä»£ç ç¼©è¿›**ï¼

    ä»£ç ç¼©è¿› > è‡ªåŠ¨ç¼©è¿› >> é«˜äº®æç¤º > æ™ºèƒ½è¡¥å…¨ > æ‹¬å·è¡¥å…¨  > çº é”™æç¤º > è¯­æ³•é«˜äº®
    

æˆ‘ä»¬è‚¯å®šå¾ˆè®¨åŒåœ¨ `<textarea>` å†™ä»£ç æ—¶ï¼Œä¸€æŒ‰ TAB é”®ï¼Œç„¶åå…‰æ ‡è·‘å¤–æ˜Ÿçš„é‚£ç§æ„Ÿè§‰ã€‚å…¶å®æˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨ js æ¥æ”¹è‰¯è¿™ä¸ªã€‚

ï¼ˆå¯ä»¥è¯•è¯•åœ¨ [https://www.ccgxk.com/cellhtmleditor.html](https://www.ccgxk.com/cellhtmleditor.html) è¿™ä¸ªå®æ—¶ç¼–è¾‘é¡µé¢è¿›è¡Œè°ƒè¯•ä¸‹é¢çš„è¿™äº›ä»£ç  ~ï¼‰

    <textarea id="editor" placeholder="æ¼”ç¤º tab é”®ç¼©è¿›"></textarea>
    <script>
        editor.addEventListener('keydown', function(e){
            var start = e.target.selectionStart;  // å…‰æ ‡å¼€å§‹çš„ä½ç½®
            var end = e.target.selectionEnd;  // å…‰æ ‡ç»“æŸçš„ä½ç½®
            var value = e.target.value;  // ç¼–è¾‘å™¨é‡Œçš„å†…å®¹
     
            if (e.key === 'Tab') {  // æŒ‰ä¸‹ TAB é”®
                e.preventDefault();  // é˜»æ­¢é»˜è®¤äº‹ä»¶
                e.target.value = value.substring(0, start) + '\t' + value.substring(end);  // æ·»åŠ  tab å­—ç¬¦
                e.target.selectionStart = e.target.selectionEnd = start + 1;  // å…‰æ ‡å‘å‰ +1
            }
        });
    </script>
    

é¦–å…ˆï¼Œæˆ‘ä»¬é˜»æ­¢äº† tab çš„é»˜è®¤äº‹ä»¶ï¼ˆè·³åˆ°ä¸‹ä¸€ä¸ªè¡¨å•å…ƒç´ ï¼‰`e.preventDefault();` ï¼Œç„¶åæˆ‘ä»¬è°ƒç”¨ `textarea` å…ƒç´ çš„ `.value` api é‡æ–°ä¸ºå…¶å¡«å……å†…å®¹ã€‚

ç„¶åæ˜¯ `e.target.selectionStart = e.target.selectionEnd = ...` è®©æˆ‘ä»¬çš„å…‰æ ‡ä½ç½®æ”¾åˆ°åº”è¯¥åˆ°è¾¾çš„åœ°æ–¹ã€‚

`.selectionStart` ã€ `.selectionEnd` ã€ `.value` è¿™ä¸‰ä¸ª API ç°åœ¨å®ç°è¿™æ ·ä¸€ä¸ªå°åŠŸèƒ½ï¼Œç„¶åè¿˜æ˜¯è¿™ä¸‰ä¸ª API ï¼Œæ¸æ¸è´¯å½»äº†æ•´ä¸ªä»£ç ã€‚ä¸€åˆ‡ä»è¿™é‡Œå¼€å§‹ã€‚

ç¼©è¿›ç±»å‹
----

ç›®å‰ï¼Œç¼©è¿›æ ¼å¼å¹¶ä¸ç»Ÿä¸€ï¼Œä¸»æµçš„ç¼©è¿›æ˜¯ 4 ä¸ªç©ºæ ¼ï¼Œæ‰€ä»¥ï¼Œå°±å¾—éœ€è¦èƒ½åˆ‡æ¢ã€‚

ï¼ˆå¯ä»¥è¯•è¯•åœ¨ [https://www.ccgxk.com/cellhtmleditor.html](https://www.ccgxk.com/cellhtmleditor.html) è¿™ä¸ªå®æ—¶ç¼–è¾‘é¡µé¢è¿›è¡Œè°ƒè¯•ä¸‹é¢çš„è¿™äº›ä»£ç  ~ï¼‰

    <textarea id="editor" placeholder="æ¼”ç¤ºç¼©è¿›ç±»å‹"></textarea>
    <script>
        editor.addEventListener('keydown', function(e){
            var type = 'space';  // ç¼©è¿›ç±»å‹
            var indentCount = 4;  // ç¼©è¿›çš„å­—ç¬¦æ•°é‡
            var tabChar = (type === 'tab') ? '\t' : Array(indentCount + 1).join(' ');  // ç¼©è¿›å­—ç¬¦
    
            var start = e.target.selectionStart;  // å…‰æ ‡å¼€å§‹çš„ä½ç½®
            var end = e.target.selectionEnd;  // å…‰æ ‡ç»“æŸçš„ä½ç½®
            var value = e.target.value;  // ç¼–è¾‘å™¨é‡Œçš„å†…å®¹
     
            if (e.key === 'Tab') {  // æŒ‰ä¸‹ TAB é”®
                e.preventDefault();  // é˜»æ­¢é»˜è®¤äº‹ä»¶
                e.target.value = value.substring(0, start) + tabChar + value.substring(end);  // æ·»åŠ  tab å­—ç¬¦
                e.target.selectionStart = e.target.selectionEnd = start + indentCount;  // å…‰æ ‡å‘å‰ +1
            }
        });
    </script>
    

ä»£ç é‡Œ `Array(indentCount + 1).join(' ')` æ˜¯ä¸€ç§æŠ€å·§ï¼Œå¯ä»¥è¿”å› n ä¸ªç©ºæ ¼ï¼Œæ¯”å¦‚ `Array(5 + 1).join(' ')` å°±æ˜¯ 5 ä¸ªç©ºæ ¼ï¼Œ`Array(3 + 1).join(' ')` å°±ç­‰äº 3 ä¸ªç©ºæ ¼ã€‚

æ ¹æ®è¿™ä¸ªåŸç†ï¼Œä»£ç çš„æ”¶ç¼©ä¹Ÿå®ç°äº†ã€‚ä¸è¿‡ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šå‘ï¼Œä¹ æƒ¯ä¸Šçš„å‘ï¼š

*   æ”¶ç¼©åï¼Œå…‰æ ‡çš„é€‰æ‹©æ€ä¹ˆè®¡ç®—ï¼Ÿ
*   å¦‚æœå…‰æ ‡çš„ start ä½äºç¼©è¿›ï¼Œæ¯”å¦‚ç©ºæ ¼ä¸Šï¼Œåˆè¯¥æ€ä¹ˆè®¡ç®—ï¼Ÿï¼Ÿ
*   ...

å¢åŠ ç¼©è¿›å¾ˆç®€å•ï¼Œå‡å°‘ç¼©è¿›æ²¡æƒ³åˆ°è¿™ä¹ˆå¤æ‚ï¼Œè®¡ç®—é€»è¾‘è¿˜æŒºæŠ½è±¡ï¼ŒèŠ±äº†å¥½å‡ ä¸ªå°æ—¶æ¶¦è‰²ï¼Œæ‰ç®—å®Œç¾è§£å†³ï¼Œä¸‹é¢æ˜¯æœ€ç»ˆçš„ä»£ç ï¼š

    // TAB é”®ç›˜çš„å¤„ç†
    if (e.key === 'Tab') {
    	e.preventDefault();
    	if (start === end) {  // å…‰æ ‡æœªé€‰ä¸­å¤šä¸ªå­—ç¬¦
    		e.target.value = value.substring(0, start) + this.tabChar + value.substring(end);
    		e.target.selectionStart = e.target.selectionEnd = start + this.tabLength;
    		return;
    	} else {
    		var contentArr = value.split('\n');
    		var contentArrOriginal = value.split('\n');
    		var startLine = (value.substring(0, start).match(/\n/g) || []).length;
    		var endLine = (value.substring(0, end).match(/\n/g) || []).length;
    		if (event.shiftKey) {  // æŒ‰ä¸‹ Shift é”®ï¼ˆå‡å°‘ç¼©è¿›ï¼‰ã€‚
    			for (var _i = startLine; _i <= endLine; _i++) {
    				contentArr[_i] = this._removeLeadingSpaces(contentArr[_i], this.tabLength);
    			}
    			e.target.value = contentArr.join('\n');
    			var lengthDiff = contentArrOriginal[startLine].length -
    				contentArrOriginal[startLine].trimStart().length; // è®¡ç®—å…‰æ ‡èµ·å§‹ç‚¹ä½äºé‚£ä¸€è¡Œ
    			var moveLength = Math.min(this.tabLength, lengthDiff);
    			
    			// è®¡ç®—æœ€å°å¯ç¼©è¿›å€¼ï¼Œä»¥é˜²æ­¢èµ·å§‹ä½ç½®ï¼ˆå¦‚è¡Œ5ï¼‰ç¼©è¿›è‡³è¡Œ4ã€‚
    			var limitLineNum = this._arrSum(contentArr, startLine);
    			
    			// å¤„ç†é€‰åŒºèµ·å§‹åœ¨ç¼©è¿›ï¼ˆç©ºç™½ï¼‰å¤„çš„æƒ…å†µã€‚
    			var startPoint = limitLineNum > start - moveLength - startLine ? limitLineNum + startLine : start - moveLength;
    			
    			e.target.selectionStart = lengthDiff > 0 ? startPoint : start;
    			e.target.selectionEnd = end - (contentArrOriginal.join('\n').length - e.target.value.length);
    		} else {  // å•ç‹¬æŒ‰ Tab é”®ï¼ˆå¢åŠ ç¼©è¿›ï¼‰ï¼Œè¿™ä¸ªç®€å•ï¼Œæ–‡ç« ä¸Šé¢å·²ç»å†™äº†
    			for (var _i = startLine; _i <= endLine; _i++) {
    				contentArr[_i] = this.tabChar + contentArr[_i];
    			}
    			e.target.value = contentArr.join('\n');
    			e.target.selectionStart = start + this.tabLength;
    			e.target.selectionEnd = end + this.tabLength * (startLine === endLine ? 1 : endLine - startLine + 1);
    		}
    	}
    }
    

è‡ªåŠ¨è¡¥å…¨æ‹¬å·
------

ä½†ï¼Œåªæœ‰è¿™ç§ç¼©è¿›ï¼Œè‚¯å®šè¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜éœ€è¦é‚£ç§å†™ä¸‹æ‹¬å·åï¼Œå†å›è½¦ï¼Œäº§ç”Ÿçš„é‚£ç§è‡ªåŠ¨æ¢è¡Œå’Œç¼©è¿›çš„æ•ˆæœã€‚

![image](https://img2024.cnblogs.com/blog/1669501/202505/1669501-20250517142325188-2087958505.png)

æŒ‰ä¸‹å›è½¦ï¼š

![image](https://img2024.cnblogs.com/blog/1669501/202505/1669501-20250517142334270-2024456078.png)

é¡ºä¾¿æŠŠè‡ªåŠ¨æ‹¬å·ä¹Ÿå®ç°ã€‚

äºæ˜¯å“å“ä¸€é¡¿å®ç°ï¼Œè®¡ç®—è¿˜ç®€å•ï¼Œä½†é€æ¸å‘ç°ä¸€ä¸ªé—®é¢˜ã€‚

è¿™æ˜¯ç¨‹åº 1.0 æ—¶å€™çš„ä¸€ä¸ªæ¡ˆä¾‹:

    <textarea placeholder="æ¼”ç¤º enter é”® bug"></textarea>
    <script src="https://cdn.jsdelivr.net/gh/kohunglee/areaeditor/src/areaeditor.1.0.x.min.js"></script>
    <script>
        var editor = new AreaEditor('textarea');
    </script>
    

å½“æˆ‘ä»¬ç”¨ä¸­æ–‡è¾“å…¥æ³•è¾“å…¥æ—¶ï¼Œä¸€å›è½¦ï¼ˆæŒ‰ç…§ä¹ æƒ¯ï¼Œåº”è¯¥åªä¼šè¾“å…¥ jtxql è¿™å…­ä¸ªå­—ç¬¦ï¼‰ï¼Œä¼šäº§ç”Ÿè¿™æ ·çš„æ•ˆæœï¼š

![image](https://img2024.cnblogs.com/blog/1669501/202505/1669501-20250517143124888-1382386749.png)

![image](https://img2024.cnblogs.com/blog/1669501/202505/1669501-20250517143151753-1326766658.png)

æ˜¾ç„¶ä½¿ç”¨ `addEventListener('keydown', ... )` æ˜¯ä¸è¡Œçš„ã€‚

äºæ˜¯åˆåŠ å…¥äº† `addEventListener('input', ... )` ã€‚`keydown` å’Œ `input` æ˜¯ä¸ä¸€æ ·çš„ã€‚å‰è€…æ˜¯åœ¨é”®ç›˜æŒ‰ä¸‹çš„ä¸€ç¬é—´è§¦å‘ï¼Œåœ¨å­—ç¬¦è¾“å…¥å‰ï¼ˆä¹Ÿå› æ­¤å¯ä»¥é˜»æ­¢å­—ç¬¦è¾“å…¥ï¼‰ï¼Œè€Œåè€… `input` æ˜¯åœ¨å­—ç¬¦è¾“å…¥åæ¢æµ‹ä½ æŒ‰ä¸‹äº†å“ªä¸ªæŒ‰é”®ã€‚

çŠ¯éš¾
--

è¿™å°±çŠ¯äº†éš¾ï¼Œæˆ‘åˆ°åº•æ˜¯ä½¿ç”¨å“ªä¸ªæ¥ç›‘æµ‹ `enter` é”®çš„æŒ‰ä¸‹ã€‚å¦‚æœæ˜¯å‰è€…ï¼Œé‚£æˆ‘é¿å…ä¸äº†è¿™ä¸ª bugï¼Œå¦‚æœæ˜¯åè€…ï¼Œé‚£ç”»é¢ä¼šè·³åŠ¨ä¸€ä¸‹ï¼Œå¾ˆè¯¡å¼‚ã€‚

æœ€åæˆ‘è¿˜æ˜¯ä½¿ç”¨åè€…ï¼Œåªä¸è¿‡æˆ‘ä¸æ˜¯ç›‘æµ‹çš„æŒ‰é’®ï¼Œè€Œæ˜¯å­—ç¬¦ `if(lastChar === '\n'){ ... }` ï¼Œç„¶åé‡æ–°ç”Ÿæˆç¼©è¿›å†…å®¹ï¼Œé‡Œé¢å¤šæ¥ä¸€ä¸ªæ¢è¡Œç¬¦å³å¯ã€‚

è‡ªåŠ¨è¡¥å…¨
----

è‡ªåŠ¨è¡¥å…¨å€’æ˜¯æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ã€‚å”¯ä¸€è¦è¯´çš„ï¼Œã€è‹¥ç”¨æˆ·ä»é€‰æ‹©æ‰‹åŠ¨å®Œæˆï¼Œåˆ™å¿½ç•¥ã€‘è¿™ä¸ªåŠŸèƒ½ï¼Œè®©è¿™ä¸ªè‡ªåŠ¨è¡¥å…¨å˜å¾—éå¸¸æµç•…ã€‚ä½†æˆ‘æ²¡æƒ³åˆ°ï¼Œè¦åˆ¤æ–­ç”¨æˆ·æœ‰æ²¡æœ‰æ‰‹åŠ¨è¡¥å…¨ï¼Œç«Ÿç„¶è¦åˆ¤æ–­ä¸‰ä¸ªå¸ƒå°”ï¼šå‰ä¸€ä¸ªå­—ç¬¦ï¼Œæ˜¯å¦å±äºè¦è¡¥å…¨çš„ç¬¦å·ï¼Œåä¸€ä¸ªå­—ç¬¦æ˜¯å¦ç­‰äºåº”è¡¥å…¨çš„ç¬¦å·ï¼Œç”¨æˆ·è¾“å…¥çš„æ˜¯å¦ç­‰äºå·²ç»è¡¥å…¨çš„ç¬¦å·ã€‚

    var autoPairs = { 
    	'{': '}',
    	'[': ']',
    	'(': ')',
    	'"': '"',
    	"'": "'",
    	'`': '`',
    };
    if (['{', '(', '[', '"', "'", '`', ']', '}', ')'].includes(lastChar) && start === end) {
    	if(this.isPreventAuto){
    		this.isPreventAuto = false;
    		return;
    	}
    	var pairChar = autoPairs[lastChar]  || '';
    	for (var leftBrace in autoPairs) {
    	
    		// è‹¥ç”¨æˆ·ä»é€‰æ‹©æ‰‹åŠ¨å®Œæˆï¼Œåˆ™å¿½ç•¥
    		if (leftBrace === secondLastChar && autoPairs[leftBrace] === lastChar && nextChar === lastChar) {
    			e.target.value = value.substring(0, start) + value.substring(start + 1);
    			e.target.selectionStart = e.target.selectionEnd = start;
    			return;
    		}
    	}
    	e.target.value = value.substring(0, start) + pairChar + value.substring(start);
    	e.target.selectionStart = e.target.selectionEnd = start;
    }
    

é˜»æ­¢è¡¥å…¨
----

å…¶å®ï¼Œä¸Šé¢çš„è¿™äº›è¡Œä¸ºï¼Œå¹¶ä¸èƒ½ä¸€ç›´éƒ½æœ‰æ•ˆã€‚æ‰€ä»¥æˆ‘åˆè®¾ç«‹äº†é˜»æ­¢è¡¥å…¨ã€‚ä¸èƒ½è¯´æˆ‘ä»¬æŒ‰å¿«æ·é”®å¤åˆ¶ç²˜è´´çš„æ—¶å€™ï¼Œä¹Ÿé¡ºæ‰‹è¡¥å…¨äº†ï¼Œä¹Ÿä¸èƒ½è¯´æˆ‘ä»¬åœ¨æŒ‰åˆ é™¤é”®çš„æ—¶å€™ä¹Ÿç»™è¡¥å…¨äº†ï¼ˆo(ï¿£â–½ï¿£)ï½„ è¿™æ ·å°±é™·å…¥æ­»å¾ªç¯äº† ~ ä¸€ä¸ªæ°¸è¿œä¹Ÿåˆ ä¸æ‰çš„å³æ‹¬å·ï¼‰

    AreaEditor.prototype.isPreventAuto = false;  // æ˜¯å¦é˜»æ­¢æŸäº›è‡ªåŠ¨è„šæœ¬
    

æ£€æµ‹åˆ°ä¸€äº›æŒ‰é”® æˆ– ç²˜è´´äº‹ä»¶ `addEventListener('paste', ...);` åï¼Œå°±ä¸å†æ‰§è¡Œã€‚

ç¼–è¾‘æ¡†æŠ–åŠ¨
-----

ä¸€ä¸ªä¸çŸ¥èµ·æºäºä½•æ—¶çš„ `textarea` ç‰¹æ€§ï¼Œå½“è¡Œæ•°æ¯”è¾ƒå¤§æ—¶ï¼Œå›è½¦ä¼šè®©è¾“å…¥æ¡†æŠ–ä¸€ä¸‹ï¼Œååˆ†å½±å“..... èµ·ç å½±å“å¿ƒæƒ…ï¼š

ï¼ˆå¯ä»¥è¯•è¯•åœ¨ [https://www.ccgxk.com/cellhtmleditor.html](https://www.ccgxk.com/cellhtmleditor.html) è¿™ä¸ªå®æ—¶ç¼–è¾‘é¡µé¢è¿›è¡Œè°ƒè¯•ä¸‹é¢çš„è¿™äº›ä»£ç  ~ï¼‰

    <textarea id=demoEditor rows=10 placeholder="æ¼”ç¤ºç¼–è¾‘æ¡†æŠ–åŠ¨"></textarea>
    <script src="https://cdn.jsdelivr.net/gh/kohunglee/areaeditor/src/areaeditor.1.0.js"></script>
    <script>
        var content = '';
        for(var i = 0; i < 200; i++){
            content += i+'\n'
        }
        demoEditor.value = content;
    </script>
    

![image](https://img2024.cnblogs.com/blog/1669501/202505/1669501-20250517151157858-947281075.png)

äºæ˜¯

![image](https://img2024.cnblogs.com/blog/1669501/202505/1669501-20250517151246272-632260747.png)

è¿™æ˜¯æµè§ˆå™¨çš„åŸç”Ÿç‰¹æ€§ï¼ˆbugï¼‰ï¼Œæ„ä¹‰ä¸æ˜ã€‚

å½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜å¥½è§£å†³ï¼Œåªéœ€è¦è®°å½•ä¸‹é«˜åº¦ï¼Œåœ¨å®Œæˆæˆ‘ä»¬çš„æ“ä½œåå°†é«˜åº¦è¿˜åŸå³å¯ã€‚

åœ¨ç©ºè¡ŒæŒ‰ä¸‹åˆ é™¤é”®ï¼Œæ¸…ç©º
-----------

åœ¨ä¸€ä¸ªåªå­˜åœ¨ç¼©è¿›ã€ç©ºæ ¼çš„è¡Œï¼Œæˆ‘ä»¬æŒ‰ä¸‹åˆ é™¤é”®ï¼Œä¸å‡ºæ„å¤–ï¼Œç›®çš„åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯å°†è¿™è¡Œåˆ å¹²å‡€ã€‚æ‰€ä»¥ï¼Œæˆ‘åˆåŠ ä¸Šè¿™æ ·ä¸€ä¸ªåŠŸèƒ½ï¼Œåœ¨ç©ºè¡ŒæŒ‰ä¸‹åˆ é™¤é”®ï¼Œæ¸…ç©ºã€‚

æœ¬ä»¥ä¸ºåªæ˜¯ä¸€ä¸¤è¡Œä»£ç æ‰èƒ½å®Œæˆï¼Œæœ€åæäº†ä¸€å¨ï¼š

    if (e.key === 'Backspace') {
    	var contentArr = value.split('\n');
    	var startLine = (value.substring(0, start).match(/\n/g) || []).length;
    	
    	// å½“å‰è¡Œä»…åŒ…å«ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦
    	if(start === end && (/^[\s\t]*$/.test(contentArr[startLine]) && contentArr[startLine] !== '')){
    		e.target.selectionStart = this._arrSum(contentArr, startLine) + startLine;
    		e.target.selectionEnd = start;
    	}
    }
    

ä½“éªŒæ„Ÿå¤§å¤§çš„å¥½ã€‚

å°è£…ä»£ç 
----

æˆ‘æƒ³æŠŠå®ƒåšæˆä¸€ä¸ªç¬¬ä¸‰æ–¹çš„å¼•ç”¨åº“ï¼Œé‚£ä¹ˆæˆ‘å°±è¦å°½å¯èƒ½å†™çš„æ ‡å‡†ä¸€ç‚¹ã€‚

æ¨¡ä»¿ jQueryã€Zepto å°†å®ƒå°è£…äº†ä¸€ä¸‹ã€‚

é¦–å…ˆæ˜¯ UMD æ¨¡å—åŒ–ï¼Œ

    (function (global, factory) {
        if (typeof define === 'function' && define.amd) {  // UMD æ¨¡å¼
            define([], factory);  // AMD
        } else if (typeof module === 'object' && module.exports) {
            module.exports = factory();  // CommonJS
        } else {
            global.AreaEditor = factory();  // è¿™æ ·å†™ï¼Œå¯ä»¥ä¸ç”¨ new å…³é”®å­—æ¥è°ƒç”¨
        }
    }(this, function () {
        'use strict';
    	
    	// æ„é€ å‡½æ•°
    	function AreaEditor(element, options = {indentType : { type: 'space', count: 4 }}) {
    	
    	.....
    	
    	.....
    	
    	return AreaEditor;
    }));
    

ç¬¬ä¸€ä¸ªï¼Œæ˜¯ä¾ç…§è¿‡å»æˆ‘ä»¬å¸¸ç”¨çš„ [requireJS](https://requirejs.org/ "requireJS") è¦æ±‚çš„æ ¼å¼æ¥å®šä¹‰çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–å·¥å…·ï¼Œè®©æˆ‘ä»¬çš„ JS æ–‡ä»¶ä»¬å¯ä»¥æŒ‰éœ€åŠ è½½ã€‚è™½ç„¶åœ¨ ES6 æ—¶ä»£æ—¥è–„è¥¿å±±ï¼Œä½†è¿˜æ˜¯èƒ½ç”¨å¾—åˆ°ã€‚å­¦ä¹ è¿™ä¸ªå¯ä»¥çœ‹é˜®ä¸€å³°å¤§ä½¬çš„[è¿™ç¯‡æ–‡ç« ](https://www.ruanyifeng.com/blog/2012/11/require_js.html "è¿™ç¯‡æ–‡ç« ")ã€‚

ç¬¬äºŒä¸ªæ˜¯ CommonJS ç¯å¢ƒä½¿ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å™¨ç«¯ã€‚ä¸»è¦ç”¨äº node.js ã€‚å¯ä»¥ä¾› `require('./logger.js')` è¿™ç§è¯­æ³•ä½¿ç”¨ã€‚

ç¬¬ä¸‰ä¸ªå°±æ˜¯æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„è¿™ç§æ–¹å¼ï¼Œå³æµè§ˆå™¨ç›´æ¥è°ƒç”¨ã€‚

é‡Œé¢çš„ `factory()` æ˜¯å·¥å‚å‡½æ•°ï¼Œ `'use strict';` åŠä»¥ä¸‹å°±æ˜¯è¿™ä¸ªå‡½æ•°çš„å†…å®¹ã€‚æˆ‘ä»¬åªéœ€å°†æˆ‘ä»¬çš„ `AreaEditor` å‡½æ•°å†™å…¥å³å¯ã€‚

`AreaEditor()` æ˜¯æ„é€ å‡½æ•°ï¼Œé€šå¸¸ä½¿ç”¨å¤§å†™å­—æ¯å¼€å¤´ã€‚å°±å¥½åƒä¸€ä¸ªå¯¹è±¡ä¸€æ ·ï¼Œä¸è¿‡è°ƒç”¨çš„æ—¶å€™éœ€è¦å†™ new ï¼Œæœ‰äº†ä¸Šé¢çš„ `factory()` çš„å¤„ç†åï¼Œä¸å†™ new å…³é”®å­—ä¹Ÿå¯ä»¥ã€‚

* * *

æ€ä¹ˆå‹ç¼© JavaScript ä»£ç 
------------------

åˆæ­¥å‹ç¼©ï¼Œä¸»æµçš„æœ‰ä¸‰ä¸ªé€‰æ‹©ï¼š

*   [Google Closure Compiler](https://developers.google.com/closure/compiler?hl=zh-cn "Google Closure Compiler") ï¼ˆæ„Ÿè§‰è°·æ­Œå¿«æ”¾å¼ƒå®ƒäº†ï¼‰
*   [UglifyJS](https://github.com/mishoo/UglifyJS "UglifyJS ")
*   [Terser](https://terser.org/ "Terser")

ç¬¬ä¸€ä¸ªæ˜¯è°·æ­Œå…¬å¸ä½¿ç”¨ Java æçš„æ™ºèƒ½å‹ç¼©ï¼Œå¯ä»¥åˆ†æä»£ç æŠŠå†—ä½™ç»™é“²é™¤ï¼Œç¡®ä¿ç»“æœä¸å˜ã€‚ä¸è¿‡æ•ˆæœå’Œä¸‹é¢ä¸¤ä¸ªå·®ä¸å¤šã€‚

ç¬¬ä¸‰ä¸ª Terser æˆ‘ä»¬å¯èƒ½éƒ½é—´æ¥ç”¨è¿‡ï¼Œå®ƒæ˜¯ webpack è¿™ä¸ªæ‰“åŒ…å·¥å…·çš„é»˜è®¤å‹ç¼©å·¥å…·ã€‚å…¶å®å®ƒæ˜¯åœ¨ UglifyJS åŸºç¡€ä¸Šè¿­ä»£çš„ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨äº† UglifyJS ã€‚å®ƒä¹Ÿä¼šæ™ºèƒ½å°†ä»£ç é‡Œçš„å¤šä½™çš„åœ°æ–¹ä¼˜åŒ–ï¼Œä»¥å®ç°å°½å¯èƒ½å°çš„ä½“ç§¯ï¼š

    var a=1;var a=2;
    // åˆå¹¶é‡å¤å˜é‡
    var a=2
    
    alert('a' + 'b');
    // ä¼˜åŒ–
    alert("ab");
    
    function a(){
        var info = 'a' + 'b';
        alert(info);
    }
    // ä¼˜åŒ–
    function a(){alert("ab")}
    

å®ƒæœ¬èº«æ˜¯ä¸€ä¸ª node.js åº“ï¼Œæ— æ³•ç›´æ¥åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œä¸è¿‡æœ‰å¤§ä½¬å°†å…¶è½¬åŒ–ä¸ºäº†æµè§ˆå™¨ç«¯ã€‚æˆ‘åˆå°†å…¶é…ç½®è¡¨å’Œç•Œé¢ç»™ç¿»è¯‘æˆä¸­æ–‡ï¼Œå°±æ˜¯ä¸‹é¢è¿™ä¸ªåœ°å€ï¼š

[https://git.ccgxk.com/jscompression/jsminifier.html](https://git.ccgxk.com/jscompression/jsminifier.html)

![image](https://img2024.cnblogs.com/blog/1669501/202505/1669501-20250517160908672-929448955.png)

![image](https://img2024.cnblogs.com/blog/1669501/202505/1669501-20250517162134968-2110038408.png)

ä½¿ç”¨å®ƒç”Ÿæˆåçš„ä»£ç ï¼Œè¿˜æ²¡æœ‰åˆ° 2kb è¿™ä¸ªé˜¶æ®µï¼Œç„¶åæˆ‘åˆæ‰¾åˆ°äº†ä¸ªåˆ©ç”¨å­—æ¯å‡ºç°é¢‘æ¬¡ï¼Œæ„æˆå­—å…¸ï¼Œç„¶åè¿›è¡Œå‹ç¼©çš„ js å‹ç¼©å·¥å…·ã€‚

å¸¸å‡ºç°åœ¨ä¸€äº› ä»£ç é«˜å°”å¤« ç‚«æŠ€æ¯”èµ›é‡Œï¼Œæ¯”æ¯”è°èƒ½ç”¨æ›´å°çš„ä½“ç§¯å®ç°æ›´å¤æ‚çš„åŠŸèƒ½æˆ–æ¸¸æˆè¿™ç§æ¯”èµ›é‡Œï¼Œç±»ä¼¼äº [https://js13kgames.com/](https://js13kgames.com/) ã€‚

æˆ‘æŠŠé‚£ä¸ªç•Œé¢æçš„æ¼‚äº®äº†ä¸€ç‚¹ï¼Œç„¶åå°†å…¨å±€å˜é‡æ”¹äº†ä¸€ä¸‹åï¼Œå°±æ˜¯è¿™ä¸ªé¡µé¢ï¼š

[https://git.ccgxk.com/jscompression/jscrush.html](https://git.ccgxk.com/jscompression/jscrush.html)

![image](https://img2024.cnblogs.com/blog/1669501/202505/1669501-20250517162503791-1471234915.png)

è¿™æ ·å°±å·®ä¸å¤š 2kb äº†ã€‚

ä½†æ˜¯ï¼Œè¿™ä¸ª js crush å‹ç¼©ï¼Œå…¶å®åœ¨æœ‰ Gzip çš„æœåŠ¡å™¨æƒ…å†µä¸‹ï¼Œå¹¶ä¸æ˜¯å¿…éœ€å“ï¼ŒGzip çš„å‹ç¼©ç‡å’Œè¿™ä¸ªå·®ä¸å¤šã€‚

æ›´å¤šçš„åŠŸèƒ½ï¼Ÿ
------

ä»¥åä¸ä¼šæ·»åŠ æ›´å¤šçš„åŠŸèƒ½äº†ï¼Œå› ä¸ºæ²¡å¿…è¦ ~ textarea çš„ç‰¹æ€§å°±å†³å®šäº†å®ƒæ— æ³•å®Œç¾å®ç°ä»£ç é«˜äº®ï¼Œè€Œè‡ªåŠ¨è¯­æ³•åˆæ˜¯å¾ˆå¤æ‚çš„äº‹æƒ…ï¼Œéœ€è¦å¤§é‡ä»£ç ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦ã€‚

æˆ‘çš„è¿™ä¸ª areaEditor.js çš„å­˜åœ¨æ„ä¹‰æ˜¯ï¼Œä¸ºé‚£äº›æç«¯æƒ…å†µä¸‹å‡†å¤‡çš„ï¼šæ¯”å¦‚ åœ¨çº¿æ”¹ä¸€äº›ç®€å•çš„ä»£ç ã€ä¸€äº›è½»é‡çº§çš„åº“ã€ä¸€äº›å¯¹ç½‘ç»œæœ‰é™åˆ¶çš„åœºæ™¯ã€ä¸€äº›ç®€å•çš„é¡µé¢ã€ä¸€äº›é»‘ç™½é¡µé¢....

å¦å¤–ï¼ŒåŠŸèƒ½å†å¤šä¸€ç‚¹ï¼Œå°±åˆ°ã€Œç»“ç•Œã€äº†ï¼šæ¯•ç«Ÿä½“ç§¯å¤§äº†ï¼Œæˆ‘ä¸ºä»€ä¹ˆä¸é€‰æ‹©æ›´ä¸“ä¸šçš„ï¼Ÿ

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š[ç‹¬å…ƒæ®‡](https://www.cnblogs.com/duyuanshang/)ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/duyuanshang/p/18856762](https://www.cnblogs.com/duyuanshang/p/18856762)