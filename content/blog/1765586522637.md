---
layout: post
title: 'CentOS 7 ä¸Š yt-dlp Youtubeé«˜ç”»è´¨ä¸‹è½½é—®é¢˜çš„ Docker è§£å†³æ–¹æ¡ˆ'
date: "2025-12-13T00:42:02Z"
---
CentOS 7 ä¸Š yt-dlp Youtubeé«˜ç”»è´¨ä¸‹è½½é—®é¢˜çš„ Docker è§£å†³æ–¹æ¡ˆ
=============================================

ğŸ”§Â CentOS 7 ä¸Š yt-dlp Youtubeé«˜ç”»è´¨ä¸‹è½½é—®é¢˜çš„ Docker è§£å†³æ–¹æ¡ˆ
------------------------------------------------

### ğŸ”´ CentOS 7 åœæ­¢ç»´æŠ¤ (End-of-Life, EOL) æé†’

**CentOS 7 å·²äº 2024 å¹´ 6 æœˆ 30 æ—¥åœæ­¢ç»´æŠ¤ã€‚** è¿™æ„å‘³ç€å®˜æ–¹é•œåƒæºå’Œå®‰å…¨æ›´æ–°å·²åœæ­¢æä¾›ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ‚¨åœ¨æ‰§è¡Œç¬¬ä¸€æ­¥æ—¶éœ€è¦åˆ‡æ¢ Yum æºã€‚å¼ºçƒˆå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒæˆ–éœ€è¦é•¿æœŸè¿è¡Œçš„æœåŠ¡ä¸­è¿ç§»åˆ°æ–°çš„ Linux å‘è¡Œç‰ˆï¼ˆå¦‚ CentOS Stream 8/9, RHEL, AlmaLinux, Rocky Linux ç­‰ï¼‰ã€‚æœ¬æŒ‡å—æä¾›çš„ Docker æ–¹æ¡ˆæ˜¯è§£å†³è€æ—§ç³»ç»Ÿä¾èµ–é—®é¢˜çš„ä¸´æ—¶ä¸”æœ‰æ•ˆçš„æ‰‹æ®µã€‚

1\. æ ¸å¿ƒç—›ç‚¹ï¼šä¸ºä»€ä¹ˆ yt-dlp çªç„¶â€œç½¢å·¥â€äº†ï¼Ÿ
----------------------------

å¾ˆå¤šç”¨æˆ·å‘ç°ï¼Œä»¥å‰èƒ½ç”¨çš„å‘½ä»¤ç°åœ¨çªç„¶æŠ¥é”™æˆ–ä¸‹è½½ç”»è´¨å˜å·®ã€‚è¿™å…¶å®æ˜¯ `yt-dlp` ä¸ºäº†åº”å¯¹ YouTube ç­–ç•¥è°ƒæ•´è€Œäº§ç”Ÿçš„å¼ºåˆ¶æ€§è¦æ±‚ï¼š

#### âš ï¸ å…³é”®æŠ¥é”™è§£è¯»

**WARNING: \[youtube\] No supported JavaScript runtime could be found...**

*   **åçˆ¬æœºåˆ¶å‡çº§ï¼š** YouTube ç°åœ¨å¤§é‡ä½¿ç”¨å¤æ‚çš„ JavaScript æ··æ·†ä»£ç æ¥ç”Ÿæˆè§†é¢‘æµ URLã€‚`yt-dlp` å¿…é¡»æ‰§è¡Œè¿™äº› JS ä»£ç æ‰èƒ½è§£å¯†å‡ºçœŸå®çš„ä¸‹è½½åœ°å€ã€‚
*   **åæœä¸¥é‡ï¼š** å½“æ‰¾ä¸åˆ° JS è¿è¡Œæ—¶ï¼ˆå¦‚ Deno, Node.js, Bun ç­‰ï¼‰ï¼Œ`yt-dlp` åªèƒ½ä½¿ç”¨å·²å¼ƒç”¨ï¼ˆdeprecatedï¼‰çš„æ—§ç‰ˆæå–ç®—æ³•ã€‚  
    âŒ **ç›´æ¥å¯¼è‡´ï¼š** æ— æ³•è§£æ 1080p/4K é«˜ç”»è´¨æµï¼Œæ— æ³•è·å–é«˜ç ç‡éŸ³é¢‘ï¼Œç”šè‡³å®Œå…¨æ— æ³•ä¸‹è½½ã€‚

2\. è¿›é€€ä¸¤éš¾çš„ CentOS 7ï¼šGLIBC é™åˆ¶
---------------------------

å½“ä½ å°è¯•è¿è¡Œç°ä»£ Node.js æ—¶ï¼Œä¼šç«‹å³é‡åˆ°è‘—åçš„åº•å±‚åº“ç¼ºå¤±é”™è¯¯ï¼š

    node: /lib64/libm.so.6: version `GLIBC_2.27' not found (required by node)

**è‡´å‘½é˜»ç¢ï¼š** CentOS 7 çš„æ ¸å¿ƒåº“ GLIBC ç‰ˆæœ¬æ­»é”åœ¨ 2.17ï¼Œè€Œç°ä»£ Node.js éœ€è¦ 2.27+ã€‚å¼ºè¡Œå‡çº§å®¿ä¸»æœº GLIBC ææ˜“å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚

3\. ç ´å±€ä¹‹é“ï¼šDocker å®¹å™¨åŒ– (éš”ç¦»ç¯å¢ƒ)
--------------------------

æœ€ä¼˜é›…çš„è§£æ³•æ˜¯ä½¿ç”¨ Dockerã€‚æˆ‘ä»¬åœ¨å®¹å™¨å†…æ„å»ºä¸€ä¸ªåŒ…å« **Node.js**ã€\*\*FFmpeg\*\* å’Œ \*\*Python\*\* çš„å…¨æ–°ç¯å¢ƒï¼Œç»•è¿‡ GLIBC é™åˆ¶ï¼Œå®Œç¾æ”¯æŒ yt-dlp çš„é«˜çº§åŠŸèƒ½ã€‚

* * *

ğŸš€ å®æ–½æ­¥éª¤
-------

### ç¬¬ä¸€æ­¥ï¼šä¿®å¤ CentOS 7 Yum æº (EOL é—®é¢˜)

åˆ‡æ¢åˆ°é˜¿é‡Œäº‘é•œåƒæºï¼Œå¹¶ç¦ç”¨å¤±æ•ˆçš„ SCLo ä»“åº“ã€‚

    # 1. å¤‡ä»½å¹¶æ›¿æ¢åŸºç¡€æº
    sudo mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak
    sudo curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
    
    # 2. ç¦ç”¨å·²å¤±æ•ˆçš„ SCLo ä»“åº“
    sudo yum-config-manager --disable centos-sclo-rh
    sudo yum-config-manager --disable centos-sclo-sclo
    
    # 3. æ¸…ç†å¹¶ç”Ÿæˆç¼“å­˜
    sudo yum clean all
    sudo yum makecache

### ç¬¬äºŒæ­¥ï¼šå®‰è£… Docker ç¯å¢ƒ

    # 1. å®‰è£…å¿…è¦çš„ä¾èµ–å·¥å…·
    sudo yum install -y yum-utils device-mapper-persistent-data lvm2
    
    # 2. æ·»åŠ  Docker å®˜æ–¹ä»“åº“
    sudo yum-config-manager \
        --add-repo \
        https://download.docker.com/linux/centos/docker-ce.repo
    
    # 3. å®‰è£… Docker CE (å¯é€‰é…ç½®ä»£ç†)
    sudo yum -y install docker-ce docker-ce-cli containerd.io docker-compose-plugin \
        --setopt=proxy=http://127.0.0.1:7890 \
        --setopt=proxy=https://127.0.0.1:7890
    
    # 4. å¯åŠ¨ Docker å¹¶éªŒè¯å®‰è£…
    sudo systemctl start docker
    sudo systemctl enable docker
    docker --version

### ç¬¬ä¸‰æ­¥ï¼šæ„å»º yt-dlp ä¸“ç”¨é•œåƒ

åˆ›å»º `Dockerfile`ï¼ŒåŒ…å« Pythonã€Node.jsã€Deno å’Œ FFmpegã€‚\*\*ï¼ˆå®Œæ•´ä»£ç ï¼‰\*\*

    # Dockerfile å†…å®¹
    # 1. åŸºç¡€é•œåƒï¼šä½¿ç”¨ Python 3.11 å®ƒåŸºäº Debianï¼ŒåŒ…å« Python 3.11
    FROM python:3.11
    
    # è®¾ç½®å·¥ä½œç›®å½•
    WORKDIR /app
    
    # è®¾ç½®ä»£ç†ï¼ˆå¯é€‰ï¼Œå¦‚æœå›½å†…ç½‘ç»œéœ€è¦ï¼‰
    ENV http_proxy=http://192.168.48.3:7890
    ENV https_proxy=http://192.168.48.3:7890
    
    # 1. å®‰è£…æ ¸å¿ƒä¾èµ– (ffmpeg, Node.js, npm, curl, unzip)
    # Node.js å’Œ ffmpeg æ˜¯ yt-dlp æˆåŠŸä¸‹è½½æ‰€å¿…éœ€çš„ã€‚
    RUN apt-get update && \
          apt-get install -y ffmpeg nodejs npm curl unzip && \
              rm -rf /var/lib/apt/lists/*
    
    # 2. å®‰è£… Deno
    # å°† Deno å®‰è£…åˆ° /usr/local/binï¼Œç¡®ä¿å®ƒèƒ½è¢« yt-dlp æ‰¾åˆ°
    RUN curl -fsSL https://deno.land/install.sh | DENO_INSTALL=/usr/local/bin sh
    
    # å®‰è£… Python åº“ï¼ˆä¸æŒ‡å®šç‰ˆæœ¬ï¼‰
    RUN pip install \
        annotated-doc \
        annotated-types \
        anyio \
        backports-datetime-fromisoformat \
        certifi \
        cffi \
        charset-normalizer \
        click \
        cryptography \
        curl_cffi \
        et_xmlfile \
        exceptiongroup \
        fake-useragent \
        Faker \
        fastapi \
        greenlet \
        h11 \
        httptools \
        idna \
        importlib_resources \
        lxml \
        m3u8 \
        numpy \
        openpyxl \
        pandas \
        pycparser \
        pycryptodome \
        pydantic \
        pydantic_core \
        PyMySQL \
        python-dateutil \
        python-dotenv \
        pytz \
        PyYAML \
        requests \
        six \
        sniffio \
        SQLAlchemy \
        starlette \
        tqdm \
        typing_extensions \
        typing-inspection \
        tzdata \
        urllib3 \
        uvicorn \
        uvloop \
        watchfiles \
        websockets \
        yt-dlp \
        zipp
    

**æ„å»ºé•œåƒï¼š**

    # åœ¨ Dockerfile æ‰€åœ¨ç›®å½•æ‰§è¡Œ
    docker build -t yt-dlp-full .

### ç¬¬å››æ­¥ï¼šDocker é•œåƒæ“ä½œä¸ä½¿ç”¨

#### âœ… 1. æŸ¥è¯¢å½“å‰æ‰€æœ‰é•œåƒ

æŸ¥çœ‹æ–°æ„å»ºçš„ `yt-dlp-full` é•œåƒæ˜¯å¦æˆåŠŸã€‚

    docker images

#### âœ… 2. ä¸‹è½½è§†é¢‘æµ‹è¯•

æŒ‚è½½å®¿ä¸»æœºç›®å½•ï¼Œå¹¶ä½¿ç”¨ `--js-runtimes deno` å‚æ•°è¿è¡Œä¸‹è½½ã€‚

    docker run --rm \
      -e http_proxy=http://192.168.48.3:7890 \
      -e https_proxy=http://192.168.48.3:7890 \
      -v /mnt/vepfs/data/yangzhenyu/videos:/downloads \
      yt-dlp-full \
      yt-dlp \
      --js-runtimes deno \
      --remote-components ejs:github \
      -o '/downloads/%(title)s.%(ext)s' \
      'https://www.youtube.com/watch?v=dQw4w9WgXcQ'

#### âœ… 3. åˆ é™¤ä¸å†éœ€è¦çš„é•œåƒ

æ¸…ç†ç£ç›˜ç©ºé—´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ é™¤æŒ‡å®šçš„é•œåƒã€‚

    # ä½¿ç”¨é•œåƒåç§°å’Œæ ‡ç­¾ (tag) åˆ é™¤
    docker rmi yt-dlp-full:latest
    
    # æˆ–è€…ä½¿ç”¨é•œåƒ ID (Image ID) åˆ é™¤
    docker rmi <Image ID>

**æ³¨æ„ï¼š** åªæœ‰åœ¨æ²¡æœ‰å®¹å™¨æ­£åœ¨ä½¿ç”¨è¯¥é•œåƒæ—¶ï¼Œæ‰èƒ½æˆåŠŸåˆ é™¤ã€‚

* * *

ğŸ“¦ ç¬¬äº”æ­¥ï¼šé•œåƒè¿ç§»ï¼ˆå¦ä¸€å°æœºå™¨ä½¿ç”¨ï¼‰
--------------------

å¦‚æœä½ éœ€è¦åœ¨å¦ä¸€å°æœºå™¨ä¸Šä½¿ç”¨è¿™ä¸ªç¯å¢ƒï¼Œæ— éœ€é‡æ–°æ„å»ºï¼Œç›´æ¥é€šè¿‡ \*\*tar åŒ…ä¿å­˜å’ŒåŠ è½½\*\* å³å¯ã€‚

#### æ–¹å¼ 1ï¼šä¿å­˜æˆ tar â†’ æ‹·è´åˆ°å¦ä¸€å°æœºå™¨å¯¼å…¥ï¼ˆæœ€å¸¸ç”¨ï¼‰

åœ¨ \*\*å½“å‰æœºå™¨\*\* å¯¼å‡ºé•œåƒï¼š

    docker save -o yt-dlp-full.tar yt-dlp-full

æŠŠ `yt-dlp-full.tar` å¤åˆ¶åˆ°å¦ä¸€å°æœºå™¨ï¼ˆå¯ä»¥ä½¿ç”¨ \`scp\` / \`rsync\` / Uç›˜ç­‰æ–¹å¼ï¼‰ï¼š

    # ç¤ºä¾‹ï¼šä½¿ç”¨ scp å¤åˆ¶æ–‡ä»¶åˆ°å¦ä¸€å°æœåŠ¡å™¨
    scp yt-dlp-full.tar user@remote_host:/path/to/save/

åœ¨ \*\*å¦ä¸€å°æœºå™¨\*\* å¯¼å…¥é•œåƒï¼š

    docker load -i yt-dlp-full.tar

å¯¼å…¥æˆåŠŸåï¼Œå³å¯åœ¨å¦ä¸€å°æœºå™¨ä¸Šä½¿ç”¨ `docker run yt-dlp-full ...` å‘½ä»¤è¿›è¡Œè§†é¢‘ä¸‹è½½ã€‚

body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: rgba(44, 62, 80, 1); padding: 20px; background-color: rgba(244, 246, 249, 1); text-align: left } .container { background-color: rgba(255, 255, 255, 1); padding: 40px; border-radius: 12px; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08); max-width: 1000px; margin-left: 0; margin-right: auto } h1 { font-size: 2.5em; color: rgba(0, 123, 255, 1); border-bottom: 3px solid rgba(0, 123, 255, 1); padding-bottom: 15px; margin-bottom: 30px; font-weight: 600 } h2 { color: rgba(52, 73, 94, 1); margin-top: 40px; border-left: 6px solid rgba(46, 204, 113, 1); padding-left: 15px; font-size: 1.8em } h3 { color: rgba(85, 85, 85, 1); margin-top: 30px; font-size: 1.4em } pre { background-color: rgba(233, 236, 239, 1); color: rgba(52, 58, 64, 1); padding: 18px; border-radius: 6px; overflow-x: auto; font-family: Consolas, Monaco, monospace; font-size: 1em; border: 1px solid rgba(206, 212, 218, 1) } code { font-family: Consolas, Monaco, monospace; background-color: rgba(248, 249, 250, 1); padding: 3px 6px; border-radius: 4px; color: rgba(214, 51, 132, 1) } pre code { background-color: rgba(0, 0, 0, 0); color: inherit; padding: 0 } .alert { padding: 15px 20px; margin-bottom: 20px; border: 1px solid rgba(0, 0, 0, 0); border-radius: 6px } .alert-warning { color: rgba(133, 100, 4, 1); background-color: rgba(255, 248, 230, 1); border-color: rgba(255, 224, 178, 1) } .alert-info { color: rgba(13, 93, 122, 1); background-color: rgba(227, 242, 253, 1); border-color: rgba(187, 222, 251, 1) } .alert-danger { color: rgba(114, 28, 36, 1); background-color: rgba(248, 215, 218, 1); border-color: rgba(245, 198, 203, 1); font-weight: bold } .section-separator { border: 0; height: 1px; background-image: linear-gradient(90deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0)); margin: 40px 0 }