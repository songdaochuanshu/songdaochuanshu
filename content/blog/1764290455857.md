---
layout: post
title: '3 å¤©ä» 0 å…¥é—¨ SQLï¼šäº¤æ˜“æ‰€ Market Surveillance å®æˆ˜é€Ÿæˆï¼ˆWash Trading / Spoofing / Pump & Dumpï¼‰'
date: "2025-11-28T00:40:55Z"
---
3 å¤©ä» 0 å…¥é—¨ SQLï¼šäº¤æ˜“æ‰€ Market Surveillance å®æˆ˜é€Ÿæˆï¼ˆWash Trading / Spoofing / Pump & Dumpï¼‰
=================================================================================

> é€‚åˆå²—ä½ï¼š  
> **Market Surveillance Intern / Market Risk Analyst / Data Analyst / Quant Intern**  
> é€‚åˆäººç¾¤ï¼š  
> **æ²¡æœ‰ SQL åŸºç¡€ / æœ‰åŸºç¡€ä½†ä¸ä¼šå†™å¤æ‚æŸ¥è¯¢ / æƒ³åœ¨ç®€å†å†™â€œç†Ÿç»ƒ SQLâ€**

è¿™å¥—æ•™ç¨‹ä¸æ˜¯é€šç”¨ SQLï¼Œè€Œæ˜¯ **ä¸“ä¸ºäº¤æ˜“æ‰€é£æ§ä¸å¸‚åœºç›‘å¯Ÿï¼ˆMSï¼‰åœºæ™¯** è®¾è®¡ï¼Œ3 å¤© 2~3 å°æ—¶å³å¯å®Œæˆï¼Œå­¦å®Œå³å¯ï¼š

*   æ‰‹å†™å¤æ‚ SQL
*   ç‹¬ç«‹å†™å‡º wash trading / spoofing / pump æŸ¥è¯¢
*   åœ¨é¢è¯•ç°åœº 3 åˆ†é’Ÿå†™å‡ºå®Œæ•´æ£€æµ‹é€»è¾‘
*   ç®€å†å¯å†™ï¼šâ€œç†Ÿç»ƒä½¿ç”¨ SQL è¿›è¡Œå¸‚åœºæ“çºµè¡Œä¸ºæ£€æµ‹â€

* * *

ğŸŸ¦ Day 1ï¼šè®°ä½ 6 å¤§æ ¸å¿ƒè¯­æ³•ï¼ˆ2 å°æ—¶é¡¶ä¸€è¾ˆå­ï¼‰
=============================

å¤§å¤šæ•°äººå­¦ SQL æœ€å¤§çš„ç—›è‹¦æ˜¯ï¼šè®°ä¸ä½ã€‚  
ä½† Market Surveillance çš„ SQL æ°¸è¿œåªç”¨è¿™ 6 ä¸ªè¯­æ³•ã€‚

Market Surveillance æ°¸è¿œç”¨è¿™ 6 ä¸ªå…³é”®è¯
-------------------------------

è¯­æ³•

ç”¨é€”

ç”¨åœ¨å“ªäº›é£æ§é€»è¾‘é‡Œï¼Ÿ

**SELECT**

å–å“ªäº›åˆ—

äº¤æ˜“æ¬¡æ•°ã€æˆäº¤é‡ã€æ¶¨å¹…

**FROM**

ä»å“ªå¼ è¡¨

trades / orders / positions

**WHERE**

è¿‡æ»¤è¡Œ

æŒ‰ symbolã€æ—¶é—´ã€ç”¨æˆ·è¿‡æ»¤

**GROUP BY**

åˆ†ç»„ç»Ÿè®¡

æŒ‰ user\_idã€symbol ç­‰æ±‡æ€»è¡Œä¸º

**HAVING**

è¿‡æ»¤åˆ†ç»„åçš„ç»“æœ

â€œäº¤æ˜“ â‰¥ 20 æ¬¡çš„ç”¨æˆ·â€â€œå‡€æˆäº¤é‡ â‰¤ 10â€

**ORDER BY**

æ’åº

æŒ‰å¯ç–‘ç¨‹åº¦æ’åº

**LIMIT**

åªçœ‹å‰å‡ å

Top 10 å¯ç–‘è´¦æˆ·

é¢å¤–å†è®° 4 ä¸ªèšåˆå‡½æ•°ï¼ˆç»Ÿè®¡å‡½æ•°ï¼‰ï¼š

*   COUNT(\*) â†’ ç»Ÿè®¡è¡Œæ•°ï¼ˆäº¤æ˜“æ¬¡æ•°ï¼‰
*   SUM(åˆ—) â†’ æ±‚å’Œï¼ˆæˆäº¤é‡ï¼‰
*   AVG(åˆ—) â†’ å¹³å‡å€¼ï¼ˆå¹³å‡ä»·æ ¼ï¼‰
*   MAX(åˆ—)/MIN(åˆ—) â†’ æœ€å¤§/æœ€å°

èƒŒå£è¯€ï¼ˆä»¥åæ‰€æœ‰æŸ¥è¯¢éƒ½æŒ‰è¿™ä¸ªé¡ºåºå†™ï¼‰
------------------

> â€œå…ˆ FROM å“ªå¼ è¡¨ â†’ WHERE è¿‡æ»¤è¡Œ â†’ GROUP BY åˆ†ç»„ â†’ HAVING è¿‡æ»¤ç»„ â†’ SELECT è¦ä»€ä¹ˆ â†’ ORDER BY æ’åº â†’ LIMIT å–å‡ ä¸ªâ€

çœ‹ä¾‹å­ï¼ˆäº¤æ˜“æ‰€é£æ§æœ€å¸¸è§çš„ç»“æ„ï¼‰ï¼š

    SELECT user_id, COUNT(*) AS trade_count
    FROM trades
    WHERE symbol = 'BTCUSDT'
    GROUP BY user_id
    HAVING COUNT(*) >= 100
    ORDER BY trade_count DESC
    LIMIT 10;
    

å«ä¹‰ï¼šæ‰¾å‡ºäº¤æ˜“ BTCUSDT è¶…è¿‡ 100 æ¬¡çš„ç”¨æˆ·ï¼Œæ’åºåå–å‰ 10 åã€‚

* * *

ğŸ“ Day 1 ä½œä¸šï¼ˆ30 åˆ†é’Ÿï¼‰
------------------

æŠŠä¸Šé¢çš„æŸ¥è¯¢æ”¹æˆï¼š

1.  æ”¹æˆ DOGEUSDT
2.  æ”¹æˆä»Šå¤©çš„æ•°æ®ï¼ˆWHERE trade\_time >= '2025-11-27'ï¼‰
3.  æ”¹æˆäº¤æ˜“æ¬¡æ•° â‰¥ 50 æ¬¡ è‡ªå·±æ•² 5 éï¼Œç›´åˆ°ä¸çœ‹ä¹Ÿèƒ½å†™å‡ºæ¥ã€‚

**è‡ªå·±æ•² 5 é** åšåˆ°ä¸çœ‹ç­”æ¡ˆä¹Ÿèƒ½å†™ã€‚

* * *

ğŸŸ© Day 2ï¼šå­¦ä¼š 4 ä¸ªç²¾åè¯­æ³• = èƒ½å†™ 90% çš„å¤æ‚æŸ¥è¯¢
==================================

ä»Šå¤©ä½ å°†æŒæ¡ Market Surveillance ç”¨å¾—æœ€å¤šçš„ 4 é¡¹æŠ€èƒ½ã€‚

â‘  AS é‡å‘½åï¼ˆè®©å†…å®¹å¯è¯»ï¼‰
---------------

    COUNT(*) AS trade_count -- åŸæ¥å« COUNT(*)ï¼Œç°åœ¨å« trade_count
    

â‘¡ CASE WHEN æ¡ä»¶åˆ¤æ–­ï¼ˆè¶…å…³é”®ï¼‰
---------------------

    -- æŠŠ BUY å˜æˆ +volumeï¼ŒSELL å˜æˆ -volume
    SUM(CASE WHEN side='BUY' THEN volume
             WHEN side='SELL' THEN -volume
             ELSE 0 END) AS net_volume
    

è¿™æ˜¯ **æ‰€æœ‰â€œå‡€æˆäº¤é‡ã€å‡€æ–¹å‘ã€å‡€èµ„é‡‘æµâ€ç±»é£æ§é€»è¾‘çš„æ ¸å¿ƒè¯­å¥**ã€‚

â‘¢ æ—¶é—´å¤„ç†ï¼ˆäº¤æ˜“æ‰€æœ‰å¤§é‡æŒ‰å°æ—¶/å¤©è¿‡æ»¤ï¼‰
---------------------

    WHERE trade_time >= '2025-11-27'                  -- æŸä¸€å¤©
    WHERE trade_time >= NOW() - INTERVAL '1 day'      -- æœ€è¿‘ 1 å¤©
    WHERE DATE(trade_time) = '2025-11-27'             -- æŒ‰è‡ªç„¶æ—¥
    

â‘£ WITH CTEï¼ˆå†™å¤æ‚é£æ§æŸ¥è¯¢çš„ç¥å™¨ï¼‰
----------------------

    WITH today_trades AS (
        SELECT * FROM trades WHERE DATE(trade_time) = '2025-11-27'
    )
    SELECT user_id, COUNT(*) FROM today_trades GROUP BY user_id;
    

* * *

ğŸ“ Day 2 ç»ˆæä½œä¸šï¼ˆ40 åˆ†é’Ÿï¼‰
--------------------

å†™å‡ºä¸‹é¢è¿™ä¸ªæ£€æµ‹ wash trading çš„ SQLï¼š

**â€œæ‰¾å‡ºä»Šå¤© DOGEUSDT ä¸Šï¼Œå‡€æˆäº¤é‡ â‰ˆ 0ï¼ˆâ‰¤ 50ï¼‰ï¼Œä¸”äº¤æ˜“æ¬¡æ•° â‰¥ 30 çš„ç”¨æˆ·â€**

ç­”æ¡ˆï¼ˆè‡ªå·±å†™å®Œå†çœ‹ï¼‰ï¼š

    SELECT 
        user_id,
        COUNT(*) AS trade_count,
        ABS(SUM(CASE WHEN side = 'BUY' THEN volume
                     WHEN side = 'SELL' THEN -volume
                     ELSE 0 END)) AS net_volume
    FROM trades
    WHERE symbol = 'DOGEUSDT'
      AND DATE(trade_time) = '2025-11-27'
    GROUP BY user_id
    HAVING COUNT(*) >= 30
       AND ABS(SUM(CASE WHEN side = 'BUY' THEN volume
                        WHEN side = 'SELL' THEN -volume ELSE 0 END)) <= 50
    ORDER BY trade_count DESC;
    

è¿™å°±æ˜¯ **wash trading æ£€æµ‹åŸºç¡€ç‰ˆ**ã€‚

* * *

ğŸŸ¥ Day 3ï¼šäº¤æ˜“æ‰€çœŸå®é¢è¯•é¢˜ï¼ˆæ‰‹æŠŠæ‰‹æ‹†è§£ï¼‰
========================

ä»Šå¤©ç›´æ¥å®æˆ˜ 3 ä¸ª Market Surveillance ç»å…¸é¢˜å‹ï¼Œç°åœ¨å°±æŠŠå‰é¢ç»™ä½ çš„ 3 ä¸ªå¤æ‚æŸ¥è¯¢æ‹†æˆæœ€ç®€å•çš„è¯ï¼Œä¸€å¥ä¸€å¥æ•™ä½ å†™ã€‚

* * *

âœ” çœŸé¢˜ 1ï¼šWash Trading æ£€æµ‹ï¼ˆæœ€å¸¸è§ï¼‰
---------------------------

    SELECT 
        user_id,
        symbol,
        COUNT(*) AS trade_count, -- äº¤æ˜“æ¬¡æ•°
        MIN(price) AS min_price, -- æœ€ä½ä»·
        MAX(price) AS max_price, -- æœ€é«˜ä»·
        ABS(SUM(CASE WHEN side='BUY' THEN volume ELSE -volume END)) AS net_volume -- å‡€æˆäº¤é‡
    FROM trades
    WHERE trade_time >= '2025-11-27'
    GROUP BY user_id, symbol
    HAVING 
          COUNT(*) >= 20
      AND (MAX(price) - MIN(price)) <= MIN(price) * 0.001  -- ä»·æ ¼æ³¢åŠ¨ â‰¤0.1%
      AND ABS(SUM(CASE WHEN side='BUY' THEN volume ELSE -volume END)) <= 10
    LIMIT 20;
    

### ğŸ¯ é€»è¾‘è§£é‡Šï¼ˆä½ åœ¨é¢è¯•è¦èƒ½è¯´å‡ºæ¥ï¼‰

*   äº¤æ˜“å¾ˆå¤šæ¬¡
*   ä½†ä»·æ ¼å‡ ä¹ä¸åŠ¨ï¼ˆæ¨ªç›˜ï¼‰
*   ä¹°å–é‡äº’ç›¸æŠµæ¶ˆï¼ˆå‡€æˆäº¤é‡â‰ˆ0ï¼‰

â†’ å…¸å‹æ´—é‡ï¼ˆåˆ¶é€ è™šå‡æ´»è·ƒï¼‰ã€‚

* * *

âœ” çœŸé¢˜ 2ï¼šSpoofingï¼ˆå¤§é‡ä¸‹å•â†’æ’¤å•ï¼‰
------------------------

    SELECT 
        user_id,
        COUNT(*) FILTER (WHERE status = 'CANCELED') AS cancel_count, -- æ’¤å•æ¬¡æ•°
        AVG(quantity) FILTER (WHERE status = 'CANCELED') AS avg_cancel_qty -- å¹³å‡æ’¤å•é‡
    FROM orders
    WHERE created_at >= NOW() - INTERVAL '1 hour'
    GROUP BY user_id
    HAVING cancel_count >= 50
    ORDER BY cancel_count DESC
    LIMIT 10;
    

### ğŸ¯ é€»è¾‘è§£é‡Š

*   1 å°æ—¶å†…æ’¤å• â‰¥ 50 æ¬¡
*   è¯´æ˜å¯èƒ½åå¤æŒ‚å•â†’æ’¤å•æ‰°åŠ¨ä»·æ ¼ï¼ˆspoofing è¡Œä¸ºï¼‰

* * *

âœ” çœŸé¢˜ 3ï¼šPump & Dump å¿«é€Ÿç›‘æµ‹
-----------------------

    SELECT 
        symbol,
        MAX(price)/MIN(price) - 1 AS max_rise
    FROM trades
    WHERE trade_time >= NOW() - INTERVAL '4 hours'
    GROUP BY symbol
    HAVING max_rise >= 0.5    -- 4å°æ—¶å†…æ¶¨å¹… â‰¥50%
    ORDER BY max_rise DESC  -- æœ€å¤§æ¶¨å¹…
    LIMIT 10;
    

### ğŸ¯ é€»è¾‘è§£é‡Š

*   åœ¨çŸ­æœŸå†…æš´æ¶¨ â‰¥ 50%
*   æ˜¯ pump & dump çš„æ½œåœ¨ç›®æ ‡

* * *

3 å¤©å®Œæ•´å­¦ä¹ ä»»åŠ¡è¡¨
==========

**Day 1ï¼ˆä»Šå¤©ï¼‰**ï¼š

1.  èƒŒä¼š 6 ä¸ªåŸºæœ¬è¯­æ³• + 4 ä¸ªèšåˆå‡½æ•°
2.  æ•² 10 éæœ€åŸºç¡€çš„â€œç»Ÿè®¡æ¯ä¸ªç”¨æˆ·äº¤æ˜“æ¬¡æ•°â€æŸ¥è¯¢
3.  å®Œæˆ Day1 ä½œä¸šï¼ˆæ”¹ 3 æ¬¡ï¼‰

**Day 2ï¼ˆæ˜å¤©ï¼‰**ï¼š

1.  å­¦ä¼š CASE WHEN å’Œæ—¶é—´å¤„ç†
2.  ç‹¬ç«‹å†™å‡ºâ€œå‡€æˆäº¤é‡å‡ ä¹ä¸º 0â€çš„æŸ¥è¯¢
3.  æ•² 5 é

**Day 3ï¼ˆåå¤©ï¼‰**ï¼š

1.  è·Ÿç€æˆ‘ä¸€å¥ä¸€å¥æ•²å®Œä¸Šé¢ 3 ä¸ªçœŸé¢˜
2.  è‡ªå·±é®ä½å†æ‰‹å†™ä¸€é
3.  æŠŠ 3 ä¸ªæŸ¥è¯¢èƒŒä¸‹æ¥ï¼Œéšæ—¶èƒ½ 3 åˆ†é’Ÿå†™å®Œ

å®Œæˆåï¼Œä½ å³å¯åœ¨ç®€å†å†™ï¼š

> **ç†Ÿç»ƒä½¿ç”¨ SQL è¿›è¡Œ wash tradingã€spoofingã€pump&dump ç­‰å¸‚åœºæ“çºµè¡Œä¸ºæ£€æµ‹ï¼Œèƒ½å¤Ÿç‹¬ç«‹ç¼–å†™å¤æ‚å¤šæ¡ä»¶æŸ¥è¯¢ã€‚**

* * *

ç°åœ¨å¼€å§‹å®æ“
======

æ‰“å¼€åœ¨çº¿æ•°æ®åº“ç»ƒä¹ ç½‘ç«™ï¼š

ğŸ‘‰ [https://www.db-fiddle.com/](https://www.db-fiddle.com/)

è¾“å…¥ï¼š

    SELECT 'hello world' AS message;
    

çœ‹åˆ°ç»“æœåï¼Œç»§ç»­åš Day 1 çš„ç¬¬ä¸€ä¸ªç»ƒä¹ ã€‚

> å…³æ³¨æˆ‘ï¼Œä¸€èµ·web3æ±‚èŒï¼š[http://vlink.cc/tosky](http://vlink.cc/tosky)