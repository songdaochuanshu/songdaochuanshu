---
layout: post
title: '快收藏！一个技巧从此不再搞混缓存穿透和缓存击穿'
date: "2025-03-01T00:40:11Z"
---
快收藏！一个技巧从此不再搞混缓存穿透和缓存击穿
=======================

在 Redis 中有两个定义：一个缓存击穿、一个缓存穿透，因为二者的名字比较像，因此很容易就搞混了。但本文会给你提供一个记忆的小技巧，帮你彻底区分二者的定义。

在讲这个技巧之前，我们先来了解一下二者的区别。

1.定义与区别
-------

*   **缓存穿透（Cache Penetration）**：缓存穿透是指查询的数据既不在缓存中，也不在数据库中，但用户仍然频繁请求该数据，导致请求直接穿透到数据库，增加数据库压力。![](https://cdn.nlark.com/yuque/0/2025/png/92791/1740711786342-b10d671d-b3f5-4f87-b49a-998424d83459.png)
    *   **核心问题**：请求的数据根本不存在，但请求量很大，导致数据库被无效查询。
*   **缓存击穿（Cache Breakdown）**：缓存击穿是指 热点数据的缓存失效，大量并发请求同时查询该数据，导致请求直接冲击数据库，增加数据库压力。![](https://cdn.nlark.com/yuque/0/2025/png/92791/1740711962945-2b3be460-d08f-4a1f-9747-42cdee7a4395.png)
    *   **核心问题**：缓存中的数据失效，但数据库中有对应的数据，请求量集中导致数据库压力骤增。

2.常见场景
------

*   **缓存穿透**：
    *   用户请求不存在的 ID（如负数 ID 或非法字符）。
    *   恶意攻击者故意请求不存在的数据。
    *   示例：请求用户 ID 为 -1 或不存在的用户信息。
*   **缓存击穿**：
    *   热点数据（如热门商品信息、热门新闻）的缓存过期。
    *   大量用户同时请求该热点数据。
    *   示例：促销活动中的热门商品信息突然失效。

3\. 解决方案
--------

### 3.1 缓存穿透的解决方案

1.  **布隆过滤器（Bloom Filter）**：在缓存层前加一层布隆过滤器，预存所有合法 Key 的哈希值。请求到达时，先检查布隆过滤器：
    *   如果不存在，直接拦截请求，返回空。
    *   如果存在，再查询缓存或数据库。
    *   优点：内存占用少，能有效拦截不存在的请求。
    *   缺点：可能存在误判，需要合理设置参数。
2.  **缓存空值（Cache Null）**：对查询结果为空的 Key，缓存一个 Null 值，避免重复穿透。
    *   优点：实现简单，能有效减少数据库压力。
    *   缺点：可能会占用额外的缓存空间。
3.  **参数校验**：在查询缓存之前，先对请求的参数进行合法性检查，如过滤非法字符、判断参数范围等，对于明显错误的参数，直接拦截返回。

### 3.2 缓存击穿的解决方案

1.  **互斥锁（Mutex Lock）**：当缓存失效时，通过分布式锁让一个线程重建缓存，其他线程等待锁释放后重试。
    *   优点：能有效避免多个线程同时查询数据库。
    *   缺点：实现复杂，可能会影响性能。
2.  **永不过期（Logical Expiration）**：对热点 Key 设置物理永不过期，通过后台异步线程定期更新缓存，保证数据新鲜度。
    *   优点：避免缓存失效导致的数据库压力。
    *   缺点：需要额外的逻辑来管理缓存更新。
3.  **熔断降级**：在缓存失效期间，启用降级策略（如返回默认值或静态页面），保护数据库。
    *   优点：能有效缓解数据库压力。
    *   缺点：用户体验可能受影响。

4.对比
----

**问题**

**定义**

**常见场景**

**解决方案**

**缓存穿透**

请求的数据既不在缓存中，也不在数据库中，但请求量很大，导致数据库压力增大

非法请求、恶意攻击

布隆过滤器、缓存空值、参数校验

**缓存击穿**

热点数据的缓存失效，大量并发请求直接冲击数据库

热点数据失效、高并发场景

互斥锁、永不过期、熔断降级

通过理解它们的定义、场景和解决方案，你可以更清晰地区分缓存穿透和缓存击穿，并在实际开发中选择合适的解决方法。

5.记忆秘诀
------

*   **缓存击穿**：核心是热点数据失效 -> 解决方案是**重建热点数据**。
*   **缓存穿透**：核心是 Redis 和 MySQL 都没有数据 -> 解决方案是**拦截无效请求**。

因此，我们可以认为：

*   缓存击穿 -> **正常的数据失效引发的问题**。
*   缓存穿透 -> **非正常的数据访问引发的问题**。

就像警察叔叔审讯犯人一样，我们可以用“**击穿犯罪嫌疑人的心里防线**”，但**不能用“穿透犯罪嫌疑的心里防线”**，所以，**击穿是“正义之词”，而穿透是“非正义之词”**，例如，你这点小心思，我还看不“透”，“透”这个词通常是用来描述不好的事情的，因此我们可以使用这个技巧来彻底区分缓存击穿和缓存穿透了，如下图所示：

![](https://cdn.nlark.com/yuque/0/2025/png/92791/1740712757367-8a0598d5-64f8-4e48-afb7-3d597d4a5ac3.png)

小结
--

缓存击穿和缓存穿透是 Redis 中两个常见的高频面试问题，但又很容易搞混二者的定义，我们通过学习本文的内容，相信可以彻底的区分二者的定义。

> PS：我是磊哥，一个不爱讲“标准答案”，但爱琢磨标准答案背后原因和原理的一位技术爱好者。关注我，一起学习更多 Java 干货知识。

> 本文已收录到我的面试小站 [www.javacn.site](https://www.javacn.site)，其中包含的内容有：场景题、并发编程、MySQL、Redis、Spring、Spring MVC、Spring Boot、Spring Cloud、MyBatis、JVM、设计模式、消息队列等模块。

关注下面二维码，订阅更多精彩内容。  
![](https://images.cnblogs.com/cnblogs_com/vipstone/848916/o_211225130402_gognzhonghao.jpg)

![](http://icdn.apigo.cn/gitchat/rabbitmq.png?imageView2/0/w/500/h/400)

![微信打赏](http://icdn.apigo.cn/myinfo/wchat-pay.png "微信打赏")  

关注公众号（加好友）： ![](http://icdn.apigo.cn/gongzhonghao2.png?imageView2/0/w/120/h/120)

  
作者： [王磊的博客](http://vipstone.cnblogs.com/)  
出处： [http://vipstone.cnblogs.com/](http://vipstone.cnblogs.com/)