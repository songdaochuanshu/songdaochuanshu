---
layout: post
title: 'ã€SQLå‘¨å‘¨ç»ƒã€‘ä¸€å¥ SQL å¦‚ä½•å¸®åŠ© 5 ä¸ªäººä¹°åˆ°ç”µå½±é™¢æœ€å¥½çš„åº§ä½ï¼Ÿ'
date: "2025-05-05T00:43:23Z"
---
ã€SQLå‘¨å‘¨ç»ƒã€‘ä¸€å¥ SQL å¦‚ä½•å¸®åŠ© 5 ä¸ªäººä¹°åˆ°ç”µå½±é™¢æœ€å¥½çš„åº§ä½ï¼Ÿ
-----------------------------------

Posted on 2025-05-04 08:52Â  [è’‹ç‚¹æ•°åˆ†](https://www.cnblogs.com/data-analytics)Â  é˜…è¯»(145)Â  è¯„è®º(0)Â  Â  [æ”¶è—](javascript:void\(0\))Â  [ä¸¾æŠ¥](javascript:void\(0\))

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯â€œè’‹ç‚¹æ•°åˆ†â€ï¼Œå¤šå¹´ä»¥æ¥ä¸€ç›´ä»äº‹æ•°æ®åˆ†æå·¥ä½œã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œä¸å¤§å®¶æŒç»­åˆ†äº«å…³äºæ•°æ®åˆ†æçš„å­¦ä¹ å†…å®¹ã€‚

æœ¬æ–‡æ˜¯ç¬¬ 3 ç¯‡ï¼Œä¹Ÿæ˜¯ã€SQL å‘¨å‘¨ç»ƒã€‘ç³»åˆ—çš„ç¬¬ 3 ç¯‡ã€‚è¯¥ç³»åˆ—æ˜¯æŒ‘é€‰æˆ–è‡ªåˆ›å…·æœ‰ä¸€äº›éš¾åº¦çš„ SQL é¢˜ç›®ï¼Œä¸€å‘¨è‡³å°‘æ›´æ–°ä¸€ç¯‡ã€‚åç»­åˆ›ä½œçš„å†…å®¹ï¼Œåˆæ­¥è§„åˆ’çš„æ–¹å‘åŒ…æ‹¬ï¼š

åç»­å†…å®¹è§„åˆ’
------

1.åˆ©ç”¨Â **Streamlit**Â å®ç°Â `Hive å…ƒæ•°æ®å±•ç¤º`ã€`SQL ç¼–è¾‘å™¨`ã€ ç»“åˆ`Docker æ²™ç®±å®ç°æ•°æ®åˆ†æ Agent`  
2.æ—¶é—´åºåˆ—å¼‚å¸¸è¯†åˆ«ã€å¼‚åŠ¨å½’å› ç®—æ³•  
3.ç•™å­˜ç‡æ‹Ÿåˆã€é¢„æµ‹ã€å»ºæ¨¡  
4.å­¦ä¹ Â `AB å®éªŒ`ã€å¤æ‚å®éªŒè®¾è®¡ç­‰  
5.`è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ `ã€è‡ªåŠ¨åŒ–ç‰¹å¾å·¥ç¨‹  
6.`å› æœæ¨æ–­`å­¦ä¹   
7\. â€¦â€¦

**æ¬¢è¿å…³æ³¨**ï¼Œä¸€èµ·å­¦ä¹ ã€‚

ç¬¬ 3 æœŸé¢˜ç›®
-------

é¢˜ç›®æ¥æºï¼šæ”¹è¿›çš„é¢˜ç›®ï¼Œå¢åŠ äº†ç”µå½±é™¢æœ€ä¼˜é€‰åº§çš„é€»è¾‘

### ä¸€ã€é¢˜ç›®ä»‹ç»

çœ‹åˆ°è¿™ä¸ªé¢˜ç›®ï¼Œæœ‰åŒå­¦å¯èƒ½ä¼šåæ§½ï¼šä½ å°å­æ‹‰äº†ï¼Œç¬¬ 3 æœŸå°±å‡ºç°å¸¸è§é¢˜ç›®ã€‚è¿™é‡Œæˆ‘è§£é‡Šä¸€ä¸‹ï¼Œã€**SQL å‘¨å‘¨ç»ƒ**ã€‘ç³»åˆ—çš„ç¡®æ˜¯æƒ³è¾“å‡ºä¸€ç³»åˆ—æˆ‘è®¤ä¸ºæœ‰æŒ‘æˆ˜æ€§æœ‰æ„æ€çš„é¢˜ï¼ˆæ‰€è°“æŒ‘æˆ˜æ€§æ˜¯å¯¹äºå¤§å¤šæ•°æ•°åˆ†ï¼ŒSQL èµ„æ·±è€…é™¤å¤–ï¼‰æˆ‘ä¸æƒ³ç…§æ¬ LeetCode æˆ–ç‰›å®¢çš„é¢˜ï¼Œæ›´ä¸æƒ³å†™ â€œå­¦ç”Ÿè¡¨â€ é‚£ç±»é¢˜ã€‚  
  

å¥ˆä½•æˆ‘æƒ³è±¡åŠ›æœ‰é™ï¼ˆæœªæ¥å¯èƒ½å¢åŠ ä¸€ä¸ª SQL ç ´æ¡ˆç³»åˆ—ï¼Œç›®å‰æ‰‹é‡Œæœ‰å‡ ç¯‡è‰ç¨¿ï¼Œæ¯”å¦‚é€šè¿‡è¡Œè½¦è½¨è¿¹è®¡ç®—ç½ªæ¡ˆç­–åˆ’åœ°ç‚¹ï¼‰å¯¹äºå¸‚é¢ä¸Šçš„é¢˜ï¼Œå¦‚æœå¢åŠ ä¸€äº›åˆ›æ–°ç‚¹ï¼Œæˆ‘è§‰å¾—ä¹Ÿå€¼å¾—è·Ÿå¤§å®¶åˆ†äº«ã€‚æ¯”å¦‚è¿™é“é¢˜ï¼Œæˆ‘å°±å¢åŠ äº†â€œæœ€ä¼˜é€‰åº§â€çš„é€»è¾‘ã€‚ä¸‹é¢ç›´æ¥è¯´é¢˜ï¼š

æœ‰ä¸€å¼ è¡¨è®°å½•äº†ç”µå½±é™¢æŸä¸ªå…æŸä¸ªåœºæ¬¡çš„åº§ä½å”®å‡ºæƒ…å†µï¼Œå‡è®¾æœ‰ 5 ä¸ªäººæ¥ä¹°ç¥¨ï¼Œè¯·æ‚¨ç”¨ SQL è¾“å‡ºæ‰€æœ‰å¯ä»¥é€‰æ‹©çš„Â 5 ä¸ªè¿ç»­åº§ä½ï¼Œè¿˜è¦æŒ‰ç…§ä¸€å®šè§„åˆ™æ ¹æ®åº§ä½çš„ä½ç½®è¿›è¡Œä¼˜åŠ£æ’åºã€‚åˆ—åå¦‚ä¸‹ï¼ˆè¿™é‡Œä¸æ˜¾ç¤ºæ—¥æœŸã€æ”¾æ˜ å…åå’Œåœºæ¬¡ç­‰å†—ä½™ä¿¡æ¯ï¼‰ï¼š

åˆ—å

æ•°æ®ç±»å‹

æ³¨é‡Š

seat\_no

string

åº§ä½å·ï¼ˆæ ¼å¼ï¼šè¡Œå·ç -åˆ—å·ç ï¼‰

is\_saled

int

æ˜¯å¦å”®å‡ºï¼ˆ0-æœªé”€å”®ï¼Œ1-å·²å”®å‡ºï¼‰

è¯´æ˜ï¼š

1.  1\. ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œå‡è®¾ä¸å­˜åœ¨â€œè¿‡é“â€ï¼ˆä»¥åæœ‰æœºä¼šå†"æ°´"ä¸€ç¯‡æ–‡ç« ï¼‰
    
2.  2\. ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œâ€œæœ€ä¼˜é€‰åº§â€çš„é€»è¾‘æ˜¯â€”â€”æœ€ä¼˜ç‚¹åœ¨ï¼ˆæ€»è¡Œæ•°\*0.65ï¼Œæ€»åˆ—æ•°\*0.5ï¼‰æ‰€é€‰åº§ä½ç›¸å¯¹äºå®ƒçš„â€œæ¬§å¼è·ç¦»â€ï¼ˆè¡Œæ–¹å‘ä¸åˆ—æ–¹å‘çš„æƒé‡æ¯”æ˜¯ 3:2ï¼‰ä¹‹å’Œæœ€å°è€…
    

### äºŒã€é¢˜ç›®æ€è·¯

æƒ³è¦ç­”é¢˜çš„åŒå­¦ï¼Œå¯ä»¥å…ˆæ€è€ƒç­”æ¡ˆğŸ¤”ã€‚  
â€¦â€¦

â€¦â€¦

â€¦â€¦

æˆ‘æ¥è°ˆè°ˆæˆ‘çš„æ€è·¯ï¼šè¿™é“é¢˜é¢˜ç›®ä¸­çš„â€œè¿ç»­â€ï¼Œå¯èƒ½ä¼šè®©éƒ¨åˆ†æ•°æ®åˆ†æå¸ˆæƒ³èµ·â€œè¿ç»­ç™»å½•â€è¿™ä¸ªç»å…¸é¢˜å‹ã€‚æˆ‘åœ¨ç¬¬ 1 æœŸæ–‡ç« ä¸­æåˆ°ï¼Œè¿™ç±»é¢˜å‹éœ€è¦æ„é€ ä¸€ä¸ªåˆ†ç»„æ ‡è¯†ã€‚ä½†æ˜¯ä»Šå¤©çš„é¢˜ç›®ç®€å•çš„å¤šï¼Œâ€œè¿ç»­ç™»å½•â€ç±»é—®é¢˜ä¹‹æ‰€ä»¥è¦æ„é€ åˆ†ç»„æ ‡è¯†ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬æ²¡åŠæ³•ç¡®å®šçª—å£èŒƒå›´ã€‚å¦‚æœè¿™é“é¢˜æ˜¯æ±‚æœ€å¤šæœ‰å¤šå°‘ä¸ªè¿ç»­ç©ºåº§ï¼Œé‚£å¥—è·¯æ˜¯ä¸€æ ·çš„ã€‚

å¯æ˜¯æ—¢ç„¶æ˜¯æ±‚ 5 ä¸ªæˆ–è€…ç‰¹å®šä¸ªè¿ç»­ç©ºåº§ï¼Œé‚£ä¹ˆé—®é¢˜å¤§å¤§ç®€åŒ–äº†ã€‚æˆ‘ä»¬çš„çª—å£èŒƒå›´æ˜¯å›ºå®šçš„ 5 è¡Œå°±è¡Œäº†ï¼Œä½ è¿™ 5 è¡Œä»å“ªä¸ªä½ç½®å¼€å§‹éƒ½å¯ä»¥å†™ã€‚æˆ‘å°±ä»å½“å‰è¡Œå¼€å§‹ç®—ï¼Œä¹Ÿå°±æ˜¯Â `order by seat_col asc rows between current row and 4 following`ã€‚

ä¸‹é¢ï¼Œæˆ‘åœ¨Â `Python`Â ä¸­ç”Ÿæˆæ¨¡æ‹Ÿçš„æ•°æ®é›†ã€‚ç›¸å¯¹äºå‰ä¸¤æœŸï¼Œè¿™æœŸæ¨¡æ‹Ÿæ•°æ®ç®€å•å¾—å¤šï¼š

### ä¸‰ã€ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®

åªå…³å¿ƒ SQL ä»£ç çš„åŒå­¦ï¼Œå¯ä»¥è·³è½¬åˆ°ç¬¬å››èŠ‚ï¼ˆæˆ‘åœ¨å·¥ä½œä¸­ä½¿ç”¨Â `Hive`Â è¾ƒå¤šï¼Œå› æ­¤é‡‡ç”¨Â `Hive`Â çš„è¯­æ³•ï¼‰

æ¨¡æ‹Ÿä»£ç å¦‚ä¸‹ï¼š

1\. å®šä¹‰æ¨¡æ‹Ÿé€»è¾‘éœ€è¦çš„`å¸¸é‡`ï¼Œå¤šå°‘æ’å¤šå°‘åˆ—çš„åº§ä½ã€‚ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œè¿™é‡Œå°±æ¨¡æ‹Ÿä¸€ä¸ªé•¿æ–¹å½¢çš„æ™®é€šå…ï¼Œæ²¡æœ‰è¿‡é“ï¼Œæ¯æ’åº§ä½æ•°ä¸€è‡´ï¼š

    importÂ numpyÂ asÂ np
    importÂ pandasÂ asÂ pd
    
    # æ„Ÿè§‰éšæœºæ•°ç§å­ 2024 æ¯” 2025 æœ€åå±•ç¤ºçš„æ•ˆæœ
    np.random.seed(2024)
    
    n_rows =Â 9Â Â # å¤šå°‘æ’åº§ä½
    n_cols =Â 25Â Â # å¤šå°‘åˆ—åº§ä½ï¼Œä¸ºäº†ç®€åŒ–å‡è®¾æ¯æ’åº§ä½æ•°ç›¸åŒ
    occupancy_rate =Â 0.3Â Â # ç”µå½±é™¢ä¸Šåº§ç‡

2\. ç”ŸæˆÂ `pd.DataFrame`ã€‚è¿™é‡Œå¼ºè°ƒä¸€ç‚¹ï¼Œä¸Šåº§ç‡ä¸èƒ½å½“ä½œÂ `0-1 åˆ†å¸ƒ`çš„æ¦‚ç‡ï¼Œä¸èƒ½ç”¨Â `0-1 åˆ†å¸ƒ`æŠ½æ ·æ¥æ¨¡æ‹Ÿåº§ä½å”®å‡ºæƒ…å†µï¼›è€Œæ˜¯åº”è¯¥ç”¨éšæœºæŠ½æŒ‡å®šæ•°é‡çš„åº§ä½ï¼Œå³ç”¨**é¢‘ç‡**çš„æ–¹å¼æ¥å¤„ç†ï¼š

    df = pd.DataFrame(
    Â  Â  {
    Â  Â  Â  Â Â "seat_no": [
    Â  Â  Â  Â  Â  Â Â f"{r}-{c}"forÂ rÂ inrange(1, n_rows +Â 1)Â forÂ cÂ inrange(1, n_cols +Â 1)
    Â  Â  Â  Â  ],
    Â  Â  Â  Â Â "is_saled": np.zeros(n_rows * n_cols, dtype=int),
    Â  Â  }
    )
    
    # æ ¹æ®ä¸Šåº§ç‡éšæœºæŠ½æ ·æŒ‡å®šä¸ªæ•°åº§ä½æ”¹ä¸ºå”®å‡ºçŠ¶æ€
    # æ³¨æ„ï¼šæˆ‘ä¸æ˜¯æŠŠä¸Šåº§ç‡å½“æˆ 0-1 åˆ†å¸ƒçš„æ¦‚ç‡
    # è€Œæ˜¯å½“æˆâ€œé¢‘ç‡"ï¼ŒæŠ½å–å®é™…é¢‘ç‡å¯¹åº”çš„å·²å”®å‡ºåº§ä½æ•°é‡
    saled_index = np.random.choice(
    Â  Â  df.index, size=int(occupancy_rate * df.shape[0]), replace=False
    )
    df.loc[saled_index,Â "is_saled"] =Â 1# 0 è¡¨ç¤ºåº§ä½æœªå”®å‡ºï¼Œ1è¡¨ç¤ºå·²å”®å‡º
    
    # åœ¨ Jupyer ç¯å¢ƒä¸­å±•ç¤ºæ•°æ®æ¡†
    # å¦‚æœåœ¨å…¶ä»–ç¯å¢ƒæ‰§è¡Œï¼Œå¯èƒ½æŠ¥é”™
    display(df)

3\. è¿™é‡Œåˆ›å»ºÂ `Hive`è¡¨ï¼Œå¹¶å°†æ•°æ®å†™å…¥ã€‚ä¸å‰ä¸¤æœŸä¸åŒï¼Œä¹‹å‰æˆ‘éƒ½æ˜¯å°†`pd.DataFrame`é‡‡ç”¨`to_csv`è½¬ä¸º`csv`æ–‡ä»¶ï¼›ç„¶åç”¨`pyHive`åœ¨`Hive`ä¸­å»ºå¥½è¡¨ï¼Œå†ä½¿ç”¨`load data local inpath`çš„æ–¹æ³•å¯¼å…¥æ•°æ®ã€‚è€Œè¿™ä¸€æ¬¡ï¼Œæˆ‘é‡‡ç”¨`CTAS`çš„æ–¹å¼æ¥å»ºè¡¨å¹¶å†™å…¥æ•°æ®ï¼Œä¹Ÿå°±æ˜¯`create table ... as select...`ï¼›ä½†æ˜¯è¿™ç§æ–¹æ³•æœ‰ç¼ºç‚¹ï¼Œæ¯”å¦‚æ— æ³•åœ¨å»ºè¡¨æ—¶å¢åŠ è¡¨å’Œåˆ—çš„å¤‡æ³¨ã€‚å› æ­¤æˆ‘ä½¿ç”¨`alter table`Â è¯­å¥æ¥å¢åŠ å¤‡æ³¨ã€‚

å…³äºÂ `alter table`Â è¯­å¥çš„ä½¿ç”¨æ ¼å¼å’Œå®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘å·²ç»åœ¨ä»£ç æ³¨é‡Šä¸­è¯´æ˜ï¼š

    fromÂ pyhiveÂ importÂ hive
    
    # é…ç½®è¿æ¥å‚æ•°
    host_ip =Â "127.0.0.1"
    port =Â 10000
    username =Â "è’‹ç‚¹æ•°åˆ†"
    
    hive_table_name =Â 'data_exercise.dwd_cinema_seat_sales_status'
    
    # '1-1' å¿…é¡»ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œå¦åˆ™åœ¨ sql ä¸­è¢«å½“æˆ 1-1 çš„æ•°å­¦è¡¨è¾¾å¼
    create_table_and_write_data_sql =Â f'''
    create tableÂ {hive_table_name}Â asÂ 
    select stack({df.shape[0]},
    {','.join([f"'{row[0]}',{row[1]}"Â forÂ rowÂ inÂ df.values])}
    ) as (seat_no, is_saled)
    '''
    
    drop_table_sql =Â f'''
    drop table if existsÂ {hive_table_name}
    '''
    
    withÂ hive.Connection(host=host_ip, port=port)Â asÂ conn:
    Â  Â  cursor = conn.cursor()
    Â  Â Â print(f'\næ‰§è¡Œåˆ é™¤è¡¨è¯­å¥ï¼š\n{drop_table_sql}')
    Â  Â Â # å¦‚æœè¯¥è¡¨å·²å­˜åœ¨ï¼Œåˆ™ drop
    Â  Â  cursor.execute(drop_table_sql)
    
    Â  Â Â # åˆ›å»ºè¡¨å¹¶å†™å…¥æ•°æ®
    Â  Â Â print(f'\né‡‡ç”¨ `CTAS` å»ºè¡¨å¹¶å†™å…¥æ•°æ®ï¼š\n{create_table_and_write_data_sql}')
    Â  Â  cursor.execute(create_table_and_write_data_sql)
    
    Â  Â Â # `CTAS` ä¸èƒ½åœ¨åˆ›å»ºæ—¶æ·»åŠ å¤‡æ³¨ï¼Œä½¿ç”¨ `alter` è¯­å¥å¢åŠ å¤‡æ³¨
    Â  Â Â # å®˜æ–¹æ–‡æ¡£
    Â  Â Â # https://hive.apache.org/docs/latest/languagemanual-ddl_27362034/#alter-table-comment
    Â  Â Â # ALTER TABLE table_name SET TBLPROPERTIES ('comment' = new_comment);
    Â  Â  cursor.execute(f'''
    Â  Â  alter tableÂ {hive_table_name}Â set tblproperties ('comment' =Â 
    Â  Â  Â  Â  'ç”µå½±é™¢è¿ç»­é€‰åº§ | authorï¼šè’‹ç‚¹æ•°åˆ† | æ–‡ç« ç¼–å·ï¼š7b68c66c')
    Â  Â  ''')
    
    Â  Â Â # å¢åŠ åˆ—å¤‡æ³¨ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£
    Â  Â Â # https://hive.apache.org/docs/latest/languagemanual-ddl_27362034/#alter-column
    Â  Â Â # ALTER TABLE table_name [PARTITION partition_spec] CHANGE [COLUMN] col_old_name col_new_name column_type
    Â  Â  Â Â # [COMMENT col_comment] [FIRST|AFTER column_name] [CASCADE|RESTRICT];
    Â  Â Â # æ²¡æœ‰æ‰“æ–¹æ‹¬å·çš„éƒ¨åˆ†æ˜¯å¿…é¡»å†™çš„ï¼Œä¹Ÿå°±æ˜¯å“ªæ€•ä½ ä¸æ›´æ”¹åˆ—åï¼Œä¸æ›´æ”¹æ•°æ®ç±»å‹ï¼Œä¹Ÿè¦å†™ä¸Šæ–°æ—§åˆ—åå’Œæ•°æ®ç±»å‹
    Â  Â  cursor.execute(f'''
    Â  Â  alter tableÂ {hive_table_name}Â change seat_no seat_no string comment 'åº§ä½ç¼–å·'
    Â  Â  ''')
    
    Â  Â  cursor.execute(f'''
    Â  Â  -- å¦‚æœå°è¯•å°† `is_saled` æ”¹ä¸º `tinyint` ä¼šæŠ¥é”™ï¼Œåªèƒ½å¾€æ›´å¤§çš„æ•´å‹ä¿®æ”¹
    Â  Â  alter tableÂ {hive_table_name}Â change is_saled is_saled int comment 'æ˜¯å¦å·²å”®å‡º'
    Â  Â  ''')
    
    Â  Â  cursor.execute(f'''
    Â  Â  desc formattedÂ {hive_table_name}
    Â  Â  ''')
    
    Â  Â  records = cursor.fetchall()
    
    Â  Â Â forÂ rÂ inÂ records:
    Â  Â  Â  Â Â print(r)
    Â  Â  Â  Â Â 
    Â  Â  cursor.close()

![](https://img2024.cnblogs.com/blog/3640949/202504/3640949-20250430075944488-333474640.png)

åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œæˆ‘åœ¨Â `select`Â è¯­å¥ä¸­ä½¿ç”¨äº†Â `stack`Â å‡½æ•°ï¼Œå®ƒæ˜¯è¡¨ç”Ÿæˆå‡½æ•°ã€‚å¦‚æœä½ ä¹‹å‰æ²¡æœ‰åœ¨Â `Hive`Â ä¸­ä½¿ç”¨è¿‡è¿™ä¸ªå‡½æ•°ï¼Œä½ å¯ä»¥æœæœå®ƒçš„ç”¨æ³•ã€‚æ•°æ®æ¯”è¾ƒç®€å•çš„æ—¶å€™ï¼Œæˆ‘å°±ç”¨å®ƒæ¥é…åˆÂ `CTAS`Â å†™å…¥æ•°æ®ã€‚

> æˆ‘é€šè¿‡ä½¿ç”¨Â `PyHive`Â åŒ…å®ç° Python æ“ä½œÂ `Hive`ã€‚æˆ‘ä¸ªäººç”µè„‘éƒ¨ç½²äº†Â `Hadoop`Â åŠÂ `Hive`ï¼Œä½†æ˜¯æ²¡æœ‰å¼€å¯è®¤è¯ï¼Œä¼ä¸šé‡Œä¸€èˆ¬å¸¸ç”¨Â `Kerberos`Â æ¥è¿›è¡Œå¤§æ•°æ®é›†ç¾¤çš„è®¤è¯ã€‚

4\. æ—¢ç„¶ä¸Šé¢æ•°æ®éƒ½å†™å…¥Â `Hive`Â äº†ï¼Œé‚£ä¹ˆæˆ‘è¿™é‡Œåˆè´´ä¸€æ®µä»£ç ï¼Œæ˜¯å¹²ä»€ä¹ˆå‘¢ï¼Ÿè¿™æ®µä»£ç æ˜¯ç”¨æ¥åšå¯è§†åŒ–çš„ï¼Œå°†æ¨¡æ‹Ÿç”Ÿæˆçš„æ•°æ®åˆ©ç”¨å‡½æ•°å†™å…¥ç½‘é¡µï¼ˆä»¥å‰åœ¨æ•°åˆ†å·¥ä½œä¸­ç®€å•çš„ä½¿ç”¨è¿‡Â `Vue`ï¼‰`getCinemaHtml`Â å‡½æ•°å…¶å®å°±æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ ¹æ®å‚æ•°è¿”å›å®Œæ•´çš„å­—ç¬¦ä¸²ã€‚å®Œæ•´å­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸ªç®€å•çš„ç½‘é¡µï¼Œé‡Œé¢ä½¿ç”¨ CDN æ–¹æ³•å¼•å…¥äº†Â `Vue3`ï¼Œä½œä¸ºåˆå­¦è€…ï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰ä½¿ç”¨å‰ç«¯æ„å»ºç­‰æ–¹æ³•æ¥åšï¼š

![](https://img2024.cnblogs.com/blog/3640949/202504/3640949-20250430080033453-195967952.png)

    # æ„é€ ç‰¹å®šæ ¼å¼ dict ç»™ç½‘é¡µç”»å›¾æä¾›æ•°æ®
    seats_info_list = []
    
    forÂ iÂ inÂ df.groupby(by=df["seat_no"].apply(lambdaÂ s: s.split("-")[0])):
    Â  Â  d = {"seat_row_no":Â int(i[0])}
    Â  Â  d["seat_col_arr"] = i[1]["seat_no"].apply(lambdaÂ s:Â int(s.split("-")[1])).to_list()
    Â  Â  d["is_saled_arr"] = i[1]["is_saled"].to_list()
    Â  Â  seats_info_list.append(d)
    
    print(seats_info_list)
    
    # å¤–éƒ¨çš„è‡ªå®šä¹‰å‡½æ•°
    fromÂ cinema_seats_htmlÂ importÂ getCinamaHtml
    
    withopen('cinema_seats.html',Â 'w')Â asÂ f:
    Â  Â Â '''
    Â  Â  å°† DataFrame çš„æ•°æ®å¤„ç†ä¸ºç‰¹å®šæ ¼å¼ï¼Œåœ¨ä½œä¸ºå­—ç¬¦ä¸²å†™å…¥
    Â  Â  html é¡µé¢çš„ script æ ‡ç­¾ä¸­ï¼›è®© Javascript å°†å…¶ä½œä¸º
    Â  Â  ä¸€ä¸ªå¯¹è±¡
    Â  Â  '''
    Â  Â  html_str = getCinemaHtml(seats_info_list)
    Â  Â  f.write(html_str)

ã€

### å››ã€SQL è§£ç­”

æˆ‘å…ˆå°†Â `seat_no`Â åˆ‡å¼€ï¼Œè¿™æ ·è¡Œå·ç å’Œåˆ—å·ç åé¢å†™ç€æ–¹ä¾¿ã€‚è®¡ç®—è¿ç»­ 5 ä¸ªç©ºåº§ä½ï¼Œä¸ºä»€ä¹ˆè¦Â `sum(if(is_saled=0, 1, 0)) = 5`Â è€Œä¸æ˜¯Â `sum(is_saled) = 0`ï¼Œå› ä¸ºÂ `rows between ... 4 following`ï¼Œåœ¨æ‰«åˆ°è¯¥åˆ†ç»„æœ€å 4 è¡Œæ—¶ï¼Œæ­¤æ—¶çª—å£çš„å®é™…é•¿åº¦å·²ç»ä¸æ˜¯ 5 ä¸ªäº†ï¼Œå› ä¸ºåé¢æ²¡æœ‰æ•°æ®äº†ã€‚`ç”¨ sum(is_saled) = 0`Â éœ€è¦å¢åŠ é¢å¤–çš„é€»è¾‘ã€‚ç”¨Â `3*abs(seat_row-0.65*seat_max_row)+2*abs(seat_col-0.5*seat_max_col_current_row`Â æ¥å¤„ç†æˆ‘è‡ªå®šä¹‰çš„â€œæ¬§å¼è·ç¦»â€ï¼Œè¿™é‡Œè¡Œæ–¹å‘å’Œåˆ—æ–¹å‘çš„æƒé‡æ˜¯ 3:2ï¼›æœ€åç­›é€‰ 5 ä¸ªè¿ç»­ç©ºåº§çš„æ ‡å¿—ï¼Œå°†â€œæ¬§å¼è·ç¦»â€å‡åºæ’åˆ—ï¼Œå¹¶ä¸”å°†è¿ç»­åº§ä½çš„æ˜¾ç¤ºæ ¼å¼è°ƒæ•´ä¸€ä¸‹å³å¯ã€‚

  

    -- æ±‚è¿ç»­ 5 ä¸ªçš„ç©ºåº§ä½
    
    withÂ simple_processing_tableÂ asÂ (
    Â  Â Â -- è¡¨åæ ¹æ®â€œæœ‰é“ç¿»è¯‘â€å–çš„ï¼Œå°±æ˜¯ç®€å•å¤„ç†ä¸€ä¸‹
    Â  Â Â -- å°†è¡Œå·å’Œåˆ—å·å•ç‹¬æ‹¿å‡ºæ¥ï¼Œåé¢å†™ç€æ–¹ä¾¿ä¸€ç‚¹ç‚¹ï¼›ä¸å¤„ç†ä¹Ÿå¯ä»¥
    Â  Â Â select
    Â  Â  Â  seat_no
    Â  Â  ,Â int(split(seat_no,Â '-')[0])Â asÂ seat_row
    Â  Â  ,Â int(split(seat_no,Â '-')[1])Â asÂ seat_col
    Â  Â  , is_saled
    Â  Â Â fromÂ data_exercise.dwd_cinema_seat_sales_status
    )
    
    , calc_5_continuous_seats_tableÂ asÂ (
    Â  Â -- è®¡ç®—è¿ç»­ 5 ä¸ªç©ºåº§ä½ï¼Œä¸ºä»€ä¹ˆè¦ sum(if(is_saled=0, 1, 0)) = 5 è€Œä¸æ˜¯
    Â  Â -- sum(is_saled) = 0ï¼Œå› ä¸º rows between ... 4 followingï¼Œåœ¨æ‰«åˆ°è¯¥åˆ†ç»„æœ€å 4 è¡Œæ—¶
    Â  Â -- æ­¤æ—¶çª—å£çš„å®é™…é•¿åº¦å·²ç»ä¸æ˜¯ 5 ä¸ªäº†ï¼Œå› ä¸ºåé¢æ²¡æœ‰æ•°æ®äº†ã€‚ç”¨ sum(is_saled) = 0
    Â  Â -- éœ€è¦å¢åŠ é¢å¤–çš„é€»è¾‘
    Â  Â Â select
    Â  Â  Â  seat_no, seat_row, seat_col
    Â  Â  ,Â sum(if(is_saled=0,Â 1,Â 0))Â overÂ (partitionbyÂ seat_rowÂ orderbyÂ seat_colÂ asc
    Â  Â  Â  Â Â rowsbetweencurrentrowand4Â following)Â asÂ tag
    Â  Â  , collect_set(seat_no)Â overÂ (partitionbyÂ seat_rowÂ orderbyÂ seat_colÂ asc
    Â  Â  Â  Â Â rowsbetweencurrentrowand4Â following)Â asÂ seat_plan_array
    Â  Â  ,Â max(seat_row)Â overÂ ()Â asÂ seat_max_row
    Â  Â Â -- è¿™é‡Œé˜Ÿåˆ—ä¹‹æ‰€ä»¥ç”¨ partition by seat_rowï¼Œä¸åƒæ±‚æœ€å¤šè¡Œ over åé¢æ²¡æœ‰å†…å®¹ï¼Œ
    Â  Â Â -- å…¶å®è¿˜æ˜¯å…¼å®¹äº†æ¯æ’åº§ä½æ•°ä¸åŒçš„æƒ…å†µï¼Œåªæ˜¯æ²¡æœ‰è¿‡äºç»†è‡´çš„å¤„ç†
    Â  Â  ,Â max(seat_col)Â overÂ (partitionbyÂ seat_row)Â asÂ seat_max_col_current_row
    Â  Â Â fromÂ simple_processing_table
    )Â 
    
    , calc_euclidean_distance_tableÂ asÂ (
    Â  Â Â -- è®¡ç®—æ¬§å¼è·ç¦»å’Œå°†åº§ä½æ±‡æ€»ï¼Œä¾æ—§æ˜¯æœ‰é“ç¿»è¯‘ï¼Œå–åå¤ªéš¾äº†
    Â  Â Â select
    Â  Â  Â  seat_noÂ asÂ start_seat_no
    Â  Â  Â Â -- æ³¨æ„åŠ  4
    Â  Â  , concat(seat_row,Â '-', seat_col,Â '~', seat_row,Â '-',seat_col+4)Â asÂ seat_plan
    Â  Â  , seat_max_row
    Â  Â  , seat_max_col_current_row
    Â  Â  , seat_plan_array
    Â  Â  Â Â -- æ³¨æ„åˆ°æ¯æ’æœ€å 4 ä¸ªçš„æ—¶å€™ï¼Œå®é™…å¯ä¸æ˜¯ 5 ä¸ªè·ç¦»ä¹‹å’Œäº†ï¼›åªä¸è¿‡åé¢ä¼šè¢«æ¡ä»¶ tag=5 ç­›æ‰
    Â  Â  ,Â sum(
    Â  Â  Â  Â Â 3*abs(seat_rowÂ -0.65*Â seat_max_row)Â +2*abs(seat_colÂ -0.5*Â seat_max_col_current_row)
    Â  Â  Â  )Â overÂ (partitionbyÂ seat_rowÂ orderbyÂ seat_colÂ asc
    Â  Â  Â Â rowsbetweencurrentrowand4Â following)Â asÂ a_distance
    Â  Â  , tagÂ 
    Â  Â Â fromÂ calc_5_continuous_seats_table
    )
    
    select
    Â  start_seat_no
    , seat_plan
    , seat_plan_array
    , a_distance
    , seat_max_row
    , seat_max_col_current_row
    fromÂ calc_euclidean_distance_table
    whereÂ tagÂ =5-- çª—å£å‡½æ•°å¡äº† 5 è¡Œï¼Œä¸å¯èƒ½è¶…è¿‡ 5
    orderbyÂ a_distanceÂ asc

æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š

![](https://img2024.cnblogs.com/blog/3640949/202504/3640949-20250430080125618-295329761.png)

å’±ä»¬è·Ÿç½‘é¡µç¤ºæ„å›¾æ ¸å¯¹æ ¸å¯¹ï¼ˆåœ¨ WPS æ¼”ç¤ºä¸­åŠ å·¥ä¸€ä¸‹å±•ç¤ºï¼‰ï¼Œç»¿è‰²åŒºåŸŸæ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œçº¢è‰²åŒºåŸŸå°±æ˜¯æœ€å·®çš„é€‰æ‹©ï¼š

![](https://img2024.cnblogs.com/blog/3640949/202504/3640949-20250430080138585-1669680149.png)

ä»¥ä¸‹æ˜¯è¿”å›ç½‘é¡µçš„Â `Python`Â å‡½æ•°ï¼Œåˆå­¦è€…é‡‡ç”¨Â `CDN`Â æ–¹æ³•å¼•å…¥çš„Â `Vue3`ï¼Œæœªä½¿ç”¨å‰ç«¯æ„å»ºå·¥å…·ï¼Œä¹Ÿæ²¡ä½¿ç”¨Â `Flask`Â æˆ–Â `Fastapi`Â å‰åç«¯åˆ†ç¦»ã€‚ä½œä¸ºä¸€åæ•°å­¦ï¼Œæ¥è§¦Â `Vue`Â ä¸ä¹…ï¼Œè¿˜è¯·æ‡‚å‰ç«¯çš„å¤§ä½¬æ”¾è¿‡ğŸ˜ƒï¼š

    defÂ getCinemaHtml(seat_info_str):
    Â  Â Â returnÂ """
    Â  Â  <!DOCTYPE html>
    Â  Â  <html lang="zh-CN">
    Â  Â  <head>
    Â  Â  Â  Â  <meta charset='UTF-8'>
    Â  Â  Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    Â  Â  Â  Â  <title>ç”µå½±é™¢é€‰åº§ demo</title>
    Â  Â  Â  Â  <link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-10-y/font-awesome/5.15.4/css/all.min.css" />
    Â  Â  Â  Â  <style>
    Â  Â  Â  Â  Â  #app{
    Â  Â  Â  Â  Â  Â overflow: visible;
    Â  Â  Â  Â  Â  }
    Â  Â  Â  Â  Â  .row {
    Â  Â  Â  Â  Â  Â  display: flex;
    Â  Â  Â  Â  Â  Â  align-items: center;
    Â  Â  Â  Â  Â  }
    Â  Â  Â  Â  Â  .seat {
    Â  Â  Â  Â  Â  Â  margin: 0 2px 2px 0;
    Â  Â  Â  Â  Â  Â  color: #DFDFDF;
    Â  Â  Â  Â  Â  Â  width: 30px;
    Â  Â  Â  Â  Â  Â  height: 50px;
    Â  Â  Â  Â  Â  Â  justify-content: center;
    Â  Â  Â  Â  Â  }
    Â  Â  Â  Â  Â  .seat.isSaled {
    Â  Â  Â  Â  Â  Â  color: #07c160;
    Â  Â  Â  Â  Â  }
    Â  Â  Â  Â  Â  .seat.isSaled:after {
    Â  Â  Â  Â  Â  Â  content: 'âœ“';
    Â  Â  Â  Â  Â  Â  font-size: 14px;
    Â  Â  Â  Â  Â  Â  color: #000000;
    Â  Â  Â  Â  Â  Â  position: relative;
    Â  Â  Â  Â  Â  Â  font-weight: 800;
    Â  Â  Â  Â  Â  Â  left: 7px;
    Â  Â  Â  Â  Â  Â  bottom: 42px;
    Â  Â  Â  Â  Â  }
    Â  Â  Â  Â  Â  .series {
    Â  Â  Â  Â  Â  Â  margin-left: 10px;
    Â  Â  Â  Â  Â  Â  white-space: nowrap;
    Â  Â  Â  Â  Â  }
    Â  Â  Â  Â  Â  .seat_no {
    Â  Â  Â  Â  Â  Â  font-size: 12px;
    Â  Â  Â  Â  Â  Â  font-weight: 600;
    Â  Â  Â  Â  Â  Â  white-space: nowrap;
    Â  Â  Â  Â  Â  }
    Â  Â  Â  Â  Â  .title {
    Â  Â  Â  Â  Â  Â  position: relative;
    Â  Â  Â  Â  Â  Â  left: calc(10 * 30px);
    Â  Â  Â  Â  Â  Â  margin-bottom: 16px;
    Â  Â  Â  Â  Â  Â  font-size: 16px;
    Â  Â  Â  Â  Â  }
    Â  Â  Â  Â  </style>
    Â  Â  </head>
    Â  Â  <body>
    Â  Â  Â  Â  <div id='app'>
    Â  Â  Â  Â  Â  Â  <div class="title">ç”µå½±é™¢è¿ç»­é€‰åº§ ç¤ºæ„å›¾ demo</div>
    Â  Â  Â  Â  Â  Â  <div class="row" v-for="(item, index) in seats_info" :key="item.seat_row_no">
    Â  Â  Â  Â  Â  Â  Â  Â  <div :class="{seat:true, isSaled:item.is_saled_arr[i]}"Â 
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  v-for="(s, i) in item.seat_col_arr">
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-chair" style="font-size:30px;"></i>
    Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="seat_no">{{ `${item.seat_row_no}-${s}` }}</div>
    Â  Â  Â  Â  Â  Â  Â  Â  </div>
    Â  Â  Â  Â  Â  Â  Â  Â  <div class="series">{{ `ç¬¬ ${item.seat_row_no} æ’`}}</div>
    Â  Â  Â  Â  Â  Â  </div>
    Â  Â  Â  Â  </div>
    Â  Â  <script type='module'>
    Â  Â  import { createApp, reactive } from 'https://unpkg.zhimg.com/vue@3.5.13/dist/vue.esm-browser.js';
    Â  Â Â 
    Â  Â  const app = createApp({
    Â  Â  Â  setup(){
    Â  Â  Â  Â  // å®šä¹‰ä¸€ä¸ª message
    Â  Â  Â  Â  const seats_info = reactive(
    Â  Â  Â  Â  Â  Â  %s
    Â  Â  Â  Â  );
    Â  Â  Â  Â  return {
    Â  Â  Â  Â  Â  seats_info
    Â  Â  Â  Â  }
    Â  Â  Â  }
    Â  Â  });
    Â  Â Â 
    Â  Â  app.mount('#app');
    Â  Â  </script>
    Â  Â  </body>
    Â  Â  </html>
    Â  Â  """Â % (seat_info_str)

* * *

ğŸ˜ƒğŸ˜ƒğŸ˜ƒ  
**æˆ‘ç°åœ¨æ­£åœ¨æ±‚èŒæ•°æ®ç±»å·¥ä½œ**ï¼ˆä¸»è¦æ˜¯æ•°æ®åˆ†ææˆ–æ•°æ®ç§‘å­¦ï¼‰ï¼›å¦‚æœæ‚¨æœ‰åˆé€‚çš„æœºä¼šï¼Œæ³è¯·æ‚¨ä¸æˆ‘è”ç³»ï¼Œå³æ—¶åˆ°å²—ï¼Œä¸é™åŸå¸‚ã€‚