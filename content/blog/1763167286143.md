---
layout: post
title: 'å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼'
date: "2025-11-15T00:41:26Z"
---
å¸¸ç”¨è®¾è®¡æ¨¡å¼ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼
=============

å¼•è¨€
--

æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Method Patternï¼‰æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ã€‚å®ƒå®šä¹‰ç®—æ³•éª¨æ¶ï¼Œå°†å…·ä½“æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»å®ç°ã€‚é€‚ç”¨äºå›ºå®šæµç¨‹ä½†éƒ¨åˆ†æ­¥éª¤å¯å˜çš„æƒ…æ™¯ï¼Œå¦‚æ¸¸æˆåˆå§‹åŒ–æˆ–æ•°æ®å¤„ç†ã€‚

å®šä¹‰
--

*   **æŠ½è±¡ç±»**ï¼šå®šä¹‰æ¨¡æ¿æ–¹æ³•ï¼ˆfinalæ–¹æ³•ï¼‰å’ŒæŠ½è±¡æ­¥éª¤ã€‚
*   **å…·ä½“å­ç±»**ï¼šå®ç°æŠ½è±¡æ­¥éª¤ã€‚

ä¼˜ç‚¹ï¼šä»£ç å¤ç”¨ï¼Œæ˜“æ‰©å±•ã€‚ç¼ºç‚¹ï¼šå­ç±»è¿‡å¤šæ—¶å¤æ‚ã€‚

classDiagram class Beverage { +prepare(): void +boilWater(): void +pourInCup(): void +brew(): void abstract +addCondiments(): void abstract } class Coffee { +brew(): void +addCondiments(): void } class Tea { +brew(): void +addCondiments(): void } Beverage <|-- Coffee Beverage <|-- Tea

TypeScript ç¤ºä¾‹
-------------

å‡è®¾å®ç°é¥®æ–™å†²æ³¡æµç¨‹ã€‚

### ç±»å®ç°

    // æŠ½è±¡ç±»
    abstract class Beverage {
      // æ¨¡æ¿æ–¹æ³•
      prepare(): void {
        this.boilWater();
        this.brew();
        this.pourInCup();
        this.addCondiments();
      }
    
      boilWater(): void {
        console.log("ç…®æ²¸æ°´");
      }
    
      abstract brew(): void; // æŠ½è±¡æ­¥éª¤
    
      pourInCup(): void {
        console.log("å€’å…¥æ¯ä¸­");
      }
    
      abstract addCondiments(): void; // æŠ½è±¡æ­¥éª¤
    }
    
    // å…·ä½“å­ç±»ï¼šå’–å•¡
    class Coffee extends Beverage {
      brew(): void {
        console.log("å†²æ³¡å’–å•¡");
      }
    
      addCondiments(): void {
        console.log("åŠ ç³–å’Œå¥¶");
      }
    }
    
    // å…·ä½“å­ç±»ï¼šèŒ¶
    class Tea extends Beverage {
      brew(): void {
        console.log("æµ¸æ³¡èŒ¶å¶");
      }
    
      addCondiments(): void {
        console.log("åŠ æŸ æª¬");
      }
    }
    
    // ä½¿ç”¨
    const coffee = new Coffee();
    coffee.prepare(); // è¾“å‡ºï¼šç…®æ²¸æ°´ å†²æ³¡å’–å•¡ å€’å…¥æ¯ä¸­ åŠ ç³–å’Œå¥¶
    
    const tea = new Tea();
    tea.prepare(); // è¾“å‡ºï¼šç…®æ²¸æ°´ æµ¸æ³¡èŒ¶å¶ å€’å…¥æ¯ä¸­ åŠ æŸ æª¬
    

`prepare()` æ˜¯æ¨¡æ¿æ–¹æ³•ï¼Œå›ºå®šæµç¨‹ã€‚å­ç±»é‡å†™ `brew()` å’Œ `addCondiments()`ï¼Œä¸æ”¹æ•´ä½“ç»“æ„ã€‚

### å‡½æ•°å¼å®ç°

    // ======================
    // Step 1: å®šä¹‰ç­–ç•¥å‡½æ•°ç±»å‹
    // ======================
    
    type BrewFunction = () => void;
    type AddCondimentsFunction = () => void;
    
    // ======================
    // Step 2: å›ºå®šæ­¥éª¤å‡½æ•°
    // ======================
    
    const boilWater = (): void => {
      console.log("ğŸ”¥ Boiling water...");
    };
    
    const pourInCup = (): void => {
      console.log("ğŸ¥› Pouring into cup...");
    };
    
    // ======================
    // Step 3: æ¨¡æ¿æ–¹æ³•ï¼ˆé«˜é˜¶å‡½æ•°ï¼‰
    // ======================
    
    const makeDrink =
      (brew: BrewFunction, addCondiments: AddCondimentsFunction) =>
      (): void => {
        console.log("\nğŸ§ª Starting to make a drink...\n");
    
        boilWater();           // å›ºå®š
        brew();                // å¯å˜
        pourInCup();           // å›ºå®š
        addCondiments();       // å¯å˜
    
        console.log("\nâœ… Drink is ready!\n");
      };
    
    // ======================
    // Step 4: ç­–ç•¥å®ç°ï¼ˆä¸åŒé¥®æ–™ï¼‰
    // ======================
    
    // Coffee
    const brewCoffee: BrewFunction = () => {
      console.log("â˜• Brewing coffee grounds...");
    };
    
    const addSugarAndMilk: AddCondimentsFunction = () => {
      console.log("ğŸ¬ Adding sugar and milk...");
    };
    
    // Tea
    const brewTea: BrewFunction = () => {
      console.log("ğŸµ Steeping the tea...");
    };
    
    const addLemon: AddCondimentsFunction = () => {
      console.log("ğŸ‹ Adding a slice of lemon...");
    };
    
    // ======================
    // Step 5: ç»„åˆå¹¶æ‰§è¡Œ
    // ======================
    
    const makeCoffee = makeDrink(brewCoffee, addSugarAndMilk);
    makeCoffee();
    
    const makeTea = makeDrink(brewTea, addLemon);
    makeTea();
    

çœŸå®æ¡ˆä¾‹
----

ä¸‹é¢åˆ—ä¸¾äº† 3 ä¸ªçœŸå®å¼€æºä»“åº“ï¼ŒåŒ…å«æ˜ç¡®çš„â€œæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Method Patternï¼‰â€é€»è¾‘ã€‚

### Apache Kafkaï¼ˆJavaï¼‰

Kafka çš„ å¤åˆ¶ï¼ˆReplica / Fetcher / LogCleanerï¼‰æµç¨‹å¤§é‡ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚

æ¨¡æ¿æ–¹æ³•éª¨æ¶ï¼Œæ–‡ä»¶ï¼šAbstractFetcherThread.java

    public abstract class AbstractFetcherThread extends ShutdownableThread {
        @Override
        public void doWork() {
            Map<TopicPartition, FetchData> fetched = fetchData();  // æ¨¡æ¿æ­¥éª¤
            processFetchedData(fetched);                           // æ¨¡æ¿æ­¥éª¤
            maybeThrottle();
        }
    
        protected abstract Map<TopicPartition, FetchData> fetchData();
        protected abstract void processFetchedData(Map<TopicPartition, FetchData> fetched);
    }
    

å­ç±»å®ç°æ­¥éª¤ï¼Œç¤ºä¾‹ï¼šReplicaFetcherThread.java

    @Override
    protected Map<TopicPartition, FetchData> fetchData() {
        // ä» leader æ‹‰å–æ—¥å¿—
    }
    
    @Override
    protected void processFetchedData(Map<TopicPartition, FetchData> fetched) {
        // å†™å…¥æœ¬åœ°æ—¥å¿—å‰¯æœ¬
    }
    

*   doWork() æ˜¯å›ºå®šæµç¨‹ï¼ˆéª¨æ¶ï¼‰
*   fetchData()ã€processFetchedData() ç”±å­ç±»å†³å®š

### Spring Framework / Spring AOP

Spring AOP çš„æ‹¦æˆªå™¨é“¾å®ç°ä¸­å¤§é‡ä½¿ç”¨æ¨¡æ¿æ–¹æ³•ç»“æ„ã€‚

æ¨¡æ¿æ–¹æ³•éª¨æ¶ï¼Œæ–‡ä»¶ï¼šAbstractPlatformTransactionManager.java

    public final TransactionStatus getTransaction(TransactionDefinition definition) {
        Object transaction = doGetTransaction();            // æ¨¡æ¿æ­¥éª¤
        boolean newTx = shouldStartTransaction(...);      
        if (newTx) {
            doBegin(transaction, definition);               // æ¨¡æ¿æ­¥éª¤
        }
        return prepareTransactionStatus(...);
    }
    
    protected abstract Object doGetTransaction();
    protected abstract void doBegin(Object transaction, TransactionDefinition definition);
    

å­ç±»å®ç°æ­¥éª¤ï¼Œç¤ºä¾‹ï¼šDataSourceTransactionManager.java

    @Override
    protected Object doGetTransaction() {
        return new DataSourceTransactionObject();
    }
    
    @Override
    protected void doBegin(Object transaction, TransactionDefinition definition) {
        // å¼€å¯ JDBC äº‹åŠ¡
    }
    

*   `getTransaction()` å®šä¹‰ç»Ÿä¸€äº‹åŠ¡å¼€å¯æµç¨‹
*   æŸäº›æ­¥éª¤ç”±å­ç±»å®ç°ï¼ˆJDBC, JPA, Hibernate éƒ½ä¸ä¸€æ ·ï¼‰

### Medusa.js

Medusa æ˜¯ä¸€ä¸ªåŸºäº TypeScript çš„ç”µå•†æ¡†æ¶ï¼Œæ‰¹é‡ä»»åŠ¡ã€æ”¯ä»˜ã€åº“å­˜ç­–ç•¥ç­‰é€šè¿‡æŠ½è±¡åŸºç±»å¼ºåˆ¶å­ç±»å®ç°æ­¥éª¤ã€‚

æ¨¡æ¿æ–¹æ³•éª¨æ¶ï¼Œæ–‡ä»¶ï¼šAbstractBatchJobStrategy.ts

    
    export abstract class AbstractBatchJobStrategy {
      async prepareBatchJob(batchJob: BatchJob): Promise<void> {
        await this.preProcessBatchJob(batchJob);   // æ¨¡æ¿æ­¥éª¤
        await this.processJob(batchJob);           // æ¨¡æ¿æ­¥éª¤
        await this.postProcessBatchJob(batchJob);  // æ¨¡æ¿æ­¥éª¤
      }
    
      protected abstract preProcessBatchJob(job: BatchJob): Promise<void>;
      protected abstract processJob(job: BatchJob): Promise<void>;
      protected abstract postProcessBatchJob(job: BatchJob): Promise<void>;
    }
    

å­ç±»å®ç°æ­¥éª¤ï¼Œç¤ºä¾‹ï¼šProductImportStrategy.ts

    export class ProductImportStrategy extends AbstractBatchJobStrategy {
      protected async preProcessBatchJob(job) { ... }
      protected async processJob(job) { ... }
      protected async postProcessBatchJob(job) { ... }
    }
    

*   åŸºç±»å®šä¹‰â€œæ‰¹å¤„ç†ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸæµç¨‹â€
*   å­ç±»å®Œæˆå…·ä½“é€»è¾‘

ç»“è¯­
--

æ¨¡æ¿æ–¹æ³•æ¨¡å¼æå‡ä»£ç å¯ç»´æŠ¤æ€§ï¼Œé€‚ç”¨äºæ¡†æ¶è®¾è®¡ã€‚