---
layout: post
title: 'Reactä¸­çš„æ•°æ®æµç®¡ç†'
date: "2025-01-27T00:36:38Z"
---
Reactä¸­çš„æ•°æ®æµç®¡ç†
============

> æˆ‘ä»¬æ˜¯[è¢‹é¼ äº‘æ•°æ ˆ UED å›¢é˜Ÿ](http://ued.dtstack.cn/)ï¼Œè‡´åŠ›äºæ‰“é€ ä¼˜ç§€çš„ä¸€ç«™å¼æ•°æ®ä¸­å°äº§å“ã€‚æˆ‘ä»¬å§‹ç»ˆä¿æŒå·¥åŒ ç²¾ç¥ï¼Œæ¢ç´¢å‰ç«¯é“è·¯ï¼Œä¸ºç¤¾åŒºç§¯ç´¯å¹¶ä¼ æ’­ç»éªŒä»·å€¼ã€‚

> æœ¬æ–‡ä½œè€…ï¼šéœœåº

å‰è¨€
--

> ğŸ’¡ ä¸ºä»€ä¹ˆæ•°æ®æµç®¡ç†é‡è¦ï¼Ÿ  
> React çš„æ ¸å¿ƒæ€æƒ³ä¸ºï¼šUI=render(data) ï¼Œdata å°±æ˜¯æ‰€è°“çš„æ•°æ®ï¼Œrender æ˜¯ React æä¾›çš„çº¯å‡½æ•°ï¼Œæ‰€ä»¥ UI å±•ç¤ºå®Œå…¨ç”±æ•°æ®å±‚å†³å®šã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œä¼šç®€å•ä»‹ç» React ä¸­çš„æ•°æ®æµç®¡ç†ï¼Œä»è‡ªèº«çš„ context åˆ°ä¸‰æ–¹åº“çš„ redux çš„ç›¸å…³æ¦‚å¿µï¼Œä»¥åŠ redux é™„å±å†…å®¹ä¸ç‰ˆå®ç°ã€‚

åœ¨æ­£æ–‡ä¹‹å‰ï¼Œå…ˆç®€å•ä»‹ç»**æ•°æ®**å’Œ**çŠ¶æ€**çš„æ¦‚å¿µã€‚React æ˜¯åˆ©ç”¨å¯å¤ç”¨çš„ç»„ä»¶æ¥æ„å»ºç•Œé¢ï¼Œç»„ä»¶æœ¬è´¨ä¸Šæ˜¯æœ‰é™çŠ¶æ€æœºï¼Œèƒ½å¤Ÿè®°ä½å½“å‰ç»„ä»¶çš„çŠ¶æ€ï¼Œæ ¹æ®ä¸åŒçš„çŠ¶æ€å˜åŒ–åšå‡ºç›¸å…³çš„æ“ä½œã€‚åœ¨Reactä¸­ï¼ŒæŠŠè¿™ç§çŠ¶æ€å®šä¹‰ä¸º `state` ã€‚é€šè¿‡ç®¡ç†çŠ¶æ€æ¥å®ç°å¯¹ç»„ä»¶çš„ç®¡ç†ï¼Œå½“ `state` å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒReact ä¼šè‡ªåŠ¨å»æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚

è€Œæ•°æ®ï¼Œå®ƒä¸ä»…æŒ‡ server å±‚è¿”å›ç»™å‰ç«¯çš„æ•°æ®ï¼ŒReact ä¸­çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸€ç§æ•°æ®ã€‚å½“æ•°æ®æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ”¹å˜çŠ¶æ€å»å¼•å‘ç•Œé¢çš„å˜æ›´ã€‚

Reactè‡ªèº«çš„æ•°æ®æµæ–¹æ¡ˆ
-------------

### åŸºäºPropsçš„å•å‘æ•°æ®æµ

React æ˜¯è‡ªä¸Šè€Œä¸‹çš„å•å‘æ•°æ®æµï¼Œå®¹å™¨ç»„ä»¶&å±•ç¤ºç»„ä»¶æ˜¯æœ€å¸¸è§çš„ React ç»„ä»¶è®¾è®¡æ–¹æ¡ˆã€‚å®¹å™¨ç»„ä»¶è´Ÿè´£å¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®ï¼Œå±•ç¤ºç»„ä»¶è´Ÿè´£å¤„ç† UI å±‚ã€‚é€šå¸¸æˆ‘ä»¬ä¼šæŠŠå±•ç¤ºç»„ä»¶æŠ½å‡ºæ¥å¤ç”¨æˆ–è€…ç»„ä»¶åº“çš„å°è£…ï¼Œå®¹å™¨ç»„ä»¶è‡ªèº«é€šè¿‡ state æ¥ç®¡ç†çŠ¶æ€ï¼ŒsetState æ›´æ–°çŠ¶æ€ï¼Œä»è€Œæ›´æ–° UI ï¼Œé€šè¿‡ props å°†è‡ªèº«çš„ state ä¼ é€’ç»™å±•ç¤ºç»„ä»¶å®ç°é€šä¿¡

![file](https://img2024.cnblogs.com/other/2332333/202501/2332333-20250126151131388-1390973151.png)

å¯¹äºç®€å•çš„é€šä¿¡ï¼ŒåŸºäº `props` ä¸²è”çˆ¶å­å’Œå…„å¼Ÿç»„ä»¶æ˜¯å¾ˆçµæ´»çš„ã€‚

ä½†å¯¹äºåµŒå¥—æ·±æ•°æ®æµç»„ä»¶ï¼ŒAâ†’Bâ†’Câ†’Dâ†’Eï¼ŒA çš„æ•°æ®éœ€è¦ä¼ é€’ç»™ E ä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ B/C/D çš„ `props` éƒ½åŠ ä¸Šè¯¥æ•°æ®ï¼Œå¯¼è‡´æœ€ä¸ºä¸­é—´ç»„ä»¶çš„ B/C/D æ¥è¯´ä¼šå¼•å…¥ä¸€äº›ä¸å±äºè‡ªå·±çš„å±æ€§

### ä½¿ç”¨ Context API ç»´æŠ¤å…¨å±€çŠ¶æ€

Context API æ˜¯ React å®˜æ–¹æä¾›çš„ä¸€ç§ç»„ä»¶æ ‘å…¨å±€é€šä¿¡æ–¹å¼

`Context` åŸºäºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œå¯¹åº” React ä¸­çš„ä¸‰ä¸ªæ¦‚å¿µ: **React.createContext** ã€ **Provider**ã€ **Consumer** ã€‚é€šè¿‡è°ƒç”¨ `createContext` åˆ›å»ºå‡ºä¸€ç»„ `Provider` ã€‚`Provider` ä½œä¸ºæ•°æ®çš„æä¾›æ–¹ï¼Œå¯ä»¥å°†æ•°æ®ä¸‹å‘ç»™è‡ªèº«ç»„ä»¶æ ‘ä¸­çš„ä»»æ„å±‚çº§çš„ `Consumer` ï¼Œè€Œ **Consumer ä¸ä»…èƒ½å¤Ÿè¯»å–åˆ° Provider ä¸‹å‘çš„æ•°æ®è¿˜èƒ½è¯»å–åˆ°è¿™äº›æ•°æ®åç»­çš„æ›´æ–°å€¼**

    const defaultValue = {
      count: 0,
      increment: () => {}
    };
    
    const ValueContext = React.createContext(defaultValue);
    
    <ValueContext.Provider value={this.state.contextState}>
      <div className="App">
        <div>Count: {count}</div>
        <ButtonContainer />
        <ValueContainer />
      </div>
    </ValueContext.Provider>
    
    <ValueContext.Consumer>
      {({ increment }) => (
        <button onClick={increment} className="button">increment</button>
      )}
    </ValueContext.Consumer>
    

[16.3ä¹‹å‰çš„ç”¨æ³•](https://codesandbox.io/s/context-use-before-16-3-318qr2?file=/src/App.js)ï¼Œ[16.3ä¹‹åçš„createContextç”¨æ³•](https://codesandbox.io/s/context-use-after-16-3-j566ro?file=/src/App.js:581-643)ï¼Œ[useContextç”¨æ³•](https://codesandbox.io/s/context-use-hooks-2l55gw?file=/src/App.js)

Contextå·¥ä½œæµçš„ç®€å•å›¾è§£ï¼š

![file](https://img2024.cnblogs.com/other/2332333/202501/2332333-20250126151131776-1484936154.png)

åœ¨ v16.3 ä¹‹å‰ç”±äºå„ç§å±€é™æ€§ä¸è¢«æ¨èä½¿ç”¨

*   ä»£ç ä¸å¤Ÿç®€å•ä¼˜é›…ï¼šç”Ÿäº§è€…éœ€è¦å®šä¹‰ `childContextTypes` å’Œ `getChildContext` ï¼Œæ¶ˆè´¹è€…éœ€è¦å®šä¹‰ `ChildTypes` æ‰èƒ½å¤Ÿè®¿é—® `this.context` è®¿é—®åˆ°ç”Ÿäº§è€…æä¾›çš„æ•°æ®
*   æ•°æ®æ— æ³•åŠæ—¶åŒæ­¥ï¼šç±»ç»„ä»¶ä¸­å¯ä»¥ä½¿ç”¨ `shouldComponentUpdate` è¿”å› false æˆ–è€…æ˜¯ `PureComponent` ï¼Œåä»£ç»„ä»¶éƒ½ä¸ä¼šè¢«æ›´æ–°ï¼Œè¿™è¿èƒŒäº† Context æ¨¡å¼çš„è®¾ç½®ï¼Œå¯¼è‡´ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ä¸èƒ½åŠæ—¶åŒæ­¥

åœ¨ v16.3 ä¹‹åçš„ç‰ˆæœ¬ä¸­åšäº†å¯¹åº”çš„è°ƒæ•´ï¼Œå³ä½¿ç»„ä»¶çš„ `shouldComponentUpdate` è¿”å› false ï¼Œå®ƒä»ç„¶å¯ä»¥â€ç©¿é€â€ç»„ä»¶ç»§ç»­å‘åä»£ç»„ä»¶è¿›è¡Œä¼ æ’­ï¼Œæ›´æ”¹äº†å£°æ˜æ–¹å¼å˜å¾—æ›´åŠ è¯­ä¹‰åŒ–ï¼Œä½¿å¾— Context æˆä¸ºäº†ä¸€ç§å¯è¡Œçš„é€šä¿¡æ–¹æ¡ˆ

ä½†æ˜¯ Context çš„ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªå®¹å™¨ç»„ä»¶æ¥ç®¡ç†çŠ¶æ€çš„ï¼Œä½†æ˜¯ `Consumer` å’Œ `Provider` æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œåœ¨é¡¹ç›®å¤æ‚åº¦é«˜çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°å¤šä¸ª `Provider` å’Œ`Consumer` ï¼Œç”šè‡³ä¸€ä¸ª `Consumer` éœ€è¦å¯¹åº”å¤šä¸ª `Provider` çš„æƒ…å†µ

å½“æŸä¸ªç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘å˜å¾—éå¸¸å¤æ‚æ—¶ï¼Œä»£ç ä¼šè¶Šå†™è¶Šå¤šï¼Œå› ä¸ºæˆ‘ä»¬åªèƒ½å¤Ÿåœ¨ç»„ä»¶å†…éƒ¨å»æ§åˆ¶æ•°æ®æµï¼Œè¿™æ ·å¯¼è‡´ Model å’Œ View éƒ½åœ¨ View å±‚ï¼Œä¸šåŠ¡é€»è¾‘å’Œ UI å®ç°éƒ½åœ¨ä¸€å—ï¼Œéš¾ä»¥ç»´æŠ¤

æ‰€ä»¥è¿™ä¸ªæ—¶å€™éœ€è¦çœŸæ­£çš„æ•°æ®æµç®¡ç†å·¥å…·ï¼Œä» UI å±‚å®Œå…¨æŠ½ç¦»å‡ºæ¥ï¼Œåªè´Ÿè´£ç®¡ç†æ•°æ®ï¼Œè®© React åªä¸“æ³¨äº View å±‚çš„ç»˜åˆ¶

Redux
-----

Redux æ˜¯ **JSåº”ç”¨** çš„çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹çš„çŠ¶æ€ç®¡ç†

Redux çš„ä¸‰å¤§åŸåˆ™

*   å•ä¸€æ•°æ®æºï¼šæ•´ä¸ªåº”ç”¨çš„ state éƒ½å­˜å‚¨åœ¨ä¸€æ£µæ ‘ä¸Šï¼Œå¹¶ä¸”è¿™æ£µçŠ¶æ€æ ‘åªå­˜åœ¨äºå”¯ä¸€çš„ store ä¸­
*   state æ˜¯åªè¯»çš„ï¼šå¯¹ state çš„ä¿®æ”¹åªæœ‰è§¦å‘ action
*   ç”¨çº¯å‡½æ•°æ‰§è¡Œä¿®æ”¹ï¼šreducer æ ¹æ®æ—§çŠ¶æ€å’Œä¼ è¿›æ¥çš„ action æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ state (ç±»ä¼¼äº reduce çš„æ€æƒ³ï¼Œæ¥å—ä¸Šä¸€ä¸ª state å’Œå½“å‰é¡¹ action ï¼Œè®¡ç®—å‡ºæ¥ä¸€ä¸ªæ–°å€¼)

Reduxå·¥ä½œæµ

![file](https://img2024.cnblogs.com/other/2332333/202501/2332333-20250126151132643-2029082273.png)

**ä¸å¯å˜æ€§( Immutability )**

mutable æ„ä¸ºå¯æ”¹å˜çš„ï¼Œimmutability æ„ä¸ºç”¨ä¸å¯æ”¹å˜çš„

åœ¨JSçš„å¯¹è±¡( object )å’Œæ•°ç»„( array )é»˜è®¤éƒ½æ˜¯ mutableï¼Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡/æ•°ç»„éƒ½æ˜¯å¯ä»¥æ”¹å˜å†…å®¹

    const obj = { name: 'FBB', age: 20 };
    obj.name = 'shuangxu';
    
    const arr = [1,2,3];
    arr[1] = 6;
    arr.push('change');
    

æ”¹å˜å¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œå†…å­˜ä¸­çš„å¼•ç”¨åœ°å€å°šæœªæ”¹å˜ï¼Œä½†æ˜¯å†…å®¹å·²ç»æ”¹å˜

å¦‚æœæƒ³ç”¨ä¸å¯å˜çš„æ–¹å¼æ¥æ›´æ–°ï¼Œä»£ç å¿…é¡»å¤åˆ¶åŸæ¥çš„å¯¹è±¡/æ•°ç»„ï¼Œæ›´æ–°å®ƒçš„å¤åˆ¶ä½“

    const obj = { info: { name: 'FBB', age: 20 }, phone: '177xxx' }
    const cloneObj = { ...obj, info: { name: 'shuangxu' } }
    
    //æµ…æ‹·è´ã€æ·±æ‹·è´
    

**ReduxæœŸæœ›æ‰€æœ‰çš„çŠ¶æ€éƒ½é‡‡ç”¨ä¸å¯å˜çš„æ–¹å¼ã€‚**

### react-redux

react-redux æ˜¯ Redux æä¾›çš„ react ç»‘å®šï¼Œè¾…åŠ©åœ¨ react é¡¹ç›®ä¸­ä½¿ç”¨ redux

å®ƒçš„ API ç®€å•ï¼ŒåŒ…æ‹¬ä¸€ä¸ªç»„ä»¶ `Provider` å’Œä¸€ä¸ªé«˜é˜¶å‡½æ•° `connect`

#### Provider

â“ä¸ºä»€ä¹ˆ `Provider` åªä¼ é€’ä¸€ä¸ª `store` ï¼Œè¢«å®ƒåŒ…è£¹çš„ç»„ä»¶éƒ½èƒ½å¤Ÿè®¿é—®åˆ° `store` çš„æ•°æ®å‘¢ï¼Ÿ

Provider åšäº†äº›å•¥ï¼Ÿ

*   åˆ›å»ºä¸€ä¸ª `contextValue` åŒ…å« `redux` ä¼ å…¥çš„ `store` å’Œæ ¹æ® `store` åˆ›å»ºå‡ºçš„ `subscription` ï¼Œå‘å¸ƒè®¢é˜…å‡ä¸º `subscription` åšçš„
*   é€šè¿‡ `context` ä¸Šä¸‹æ–‡æŠŠ`contextValue`ä¼ é€’å­ç»„ä»¶

#### Connect

â“connect åšäº†ä»€ä¹ˆäº‹æƒ…è®·ï¼Ÿ

ä½¿ç”¨å®¹å™¨ç»„ä»¶é€šè¿‡ `context` æä¾›çš„ `store` ï¼Œå¹¶å°† `mapStateToProps` å’Œ `mapDispatchToProps` è¿”å›çš„ `state` å’Œ `dispatch` ä¼ é€’ç»™ UI ç»„ä»¶

ç»„ä»¶ä¾èµ– redux çš„ `state` ï¼Œæ˜ å°„åˆ°å®¹å™¨ç»„ä»¶çš„ `props` ä¸­ï¼Œ`state` æ”¹å˜æ—¶è§¦å‘å®¹å™¨ç»„ä»¶çš„ `props` çš„æ”¹å˜ï¼Œè§¦å‘å®¹å™¨ç»„ä»¶ç»„ä»¶æ›´æ–°è§†å›¾

    const enhancer = connect(mapStateToProps, mapDispatchToProps)
    enhancer(Component)
    

#### react-reduxä¸ç‰ˆå®ç°

**Provider**

    export const Provider = (props) => {
      const { store, children, context } = props;
      const contextValue = { store };
      const Context = context || ReactReduxContext;
      return <Context.Provider value={contextValue}>{children}</Context.Provider>
    };
    

**connect**

    import { useContext, useReducer } from "react";
    import { ReactReduxContext } from "./ReactReduxContext";
    
    export const connect = (mapStateToProps, mapDispatchToProps) => (
      WrappedComponent
    ) => (props) => {
      const { ...wrapperProps } = props;
      const context = useContext(ReactReduxContext);
      const { store } = context; // è§£æ„å‡ºstore
      const state = store.getState(); // æ‹¿åˆ°state
      //ä½¿ç”¨useReducerå¾—åˆ°ä¸€ä¸ªå¼ºåˆ¶æ›´æ–°å‡½æ•°
      const [, forceComponentUpdateDispatch] = useReducer((count) => count + 1, 0);
      // è®¢é˜…stateçš„å˜åŒ–ï¼Œå½“stateå˜åŒ–çš„æ—¶å€™æ‰§è¡Œå›è°ƒ
      store.subscribe(() => {
        forceComponentUpdateDispatch();
      });
      // æ‰§è¡ŒmapStateToPropså’ŒmapDispatchToProps
      const stateProps = mapStateToProps?.(state);
      const dispatchProps = mapDispatchToProps?.(store.dispatch);
      // ç»„è£…æœ€ç»ˆçš„props
      const actualChildProps = Object.assign(
        {},
        stateProps,
        dispatchProps,
        wrapperProps
      );
      return <WrappedComponent {...actualChildProps} />;
    };
    

### redux Middleware

> â€œIt provides a third-party extension point between dispatching an action, and the moment it reaches the reducer.â€ â€“ Dan Abramov

`middleware` æä¾›åˆ†ç±»å¤„ç† `action` çš„æœºä¼šï¼Œåœ¨ `middleware` ä¸­å¯ä»¥æ£€æŸ¥æ¯ä¸€ä¸ª `action` ï¼ŒæŒ‘é€‰å‡ºç‰¹å®šç±»å‹çš„ `action` åšå¯¹åº”æ“ä½œ

![file](https://img2024.cnblogs.com/other/2332333/202501/2332333-20250126151132975-1304899671.png)

[middlewareç¤ºä¾‹](https://codesandbox.io/s/middleware-wn4pn?file=/src/App.js)

æ‰“å°æ—¥å¿—

    store.dispatch = (action) => {
      console.log("this state", store.getState());
      console.log(action);
      next(action);
      console.log("next state", store.getState());
    };
    

ç›‘æ§é”™è¯¯

    store.dispatch = (action) => {
      try {
        next(action);
      } catch (err) {
        console.log("catch---", err);
      }
    };
    

äºŒè€…åˆäºŒä¸ºä¸€

    store.dispatch = (action) => {
      try {
        console.log("this state", store.getState());
        console.log(action);
        next(action);
        console.log("next state", store.getState());
      } catch (err) {
        console.log("catch---", err);
      }
    };
    

æå– loggerMiddleware/catchMiddleware

    const loggerMiddleware = (action) => {
      console.log("this state", store.getState());
      console.log("action", action);
      next(action);
      console.log("next state", store.getState());
    };
    const catchMiddleware = (action) => {
      try {
        loggerMiddleware(action);
      } catch (err) {
        console.error("é”™è¯¯æŠ¥å‘Š: ", err);
      }
    };
    store.dispatch = catchMiddleware
    

catchMiddleware ä¸­éƒ½å†™æ­»äº†ï¼Œè°ƒç”¨ loggerMiddleware ï¼ŒloggerMiddleware ä¸­å†™æ­»äº† next(store.dispatch) ï¼Œéœ€è¦çµæ´»è¿ç”¨ï¼Œè®© middleware æ¥å— dispatch å‚æ•°

    const loggerMiddleware = (next) => (action) => {
      console.log("this state", store.getState());
      console.log("action", action);
      next(action);
      console.log("next state", store.getState());
    };
    const catchMiddleware = (next) => (action) => {
      try {
        /*loggerMiddleware(action);*/
        next(action);
      } catch (err) {
        console.error("é”™è¯¯æŠ¥å‘Š: ", err);
      }
    };
    /*loggerMiddleware å˜æˆå‚æ•°ä¼ è¿›å»*/
    store.dispatch = catchMiddleware(loggerMiddleware(next));
    

middlewareä¸­æ¥å—ä¸€ä¸ªstoreï¼Œå°±èƒ½å¤ŸæŠŠä¸Šé¢çš„æ–¹æ³•æå–åˆ°å•ç‹¬çš„å‡½æ•°æ–‡ä»¶ä¸­

    export const catchMiddleware = (store) => (next) => (action) => {
      try {
        next(action);
      } catch (err) {
        console.error("é”™è¯¯æŠ¥å‘Š: ", err);
      }
    };
    
    export const loggerMiddleware = (store) => (next) => (action) => {
      console.log("this state", store.getState());
      console.log("action", action);
      next(action);
      console.log("next state", store.getState());
    };
    
    const logger = loggerMiddleware(store);
    const exception = catchMiddleware(store);
    store.dispatch = exception(logger(next));
    

æ¯ä¸ª middleware éƒ½éœ€è¦æ¥å— store å‚æ•°ï¼Œç»§ç»­ä¼˜åŒ–è¿™ä¸ªè°ƒç”¨å‡½æ•°

    export const applyMiddleware = (middlewares) => {
      return (oldCreateStore) => {
        return (reducer, initState) => {
          //è·å¾—è€çš„store
          const store = oldCreateStore(reducer, initState);
          //[catch, logger]
          const chain = middlewares.map((middleware) => middleware(store));
          let oldDispatch = store.dispatch;
          chain
            .reverse()
            .forEach((middleware) => (oldDispatch = middleware(oldDispatch)));
          store.dispatch = oldDispatch;
          return store;
        };
      };
    };
    
    const newStore = applyMiddleware([catchMiddleware, loggerMiddleware])(
      createStore
    )(rootReducer);
    

Redux æä¾›äº† `applyMiddleware` æ¥åŠ è½½ `middleware` ï¼Œ`applyMiddleware` æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œ`middlewares` æ•°ç»„ / `redux` çš„ `createStore` / `reducer`

    export default function applyMiddleware(...middlewares) {
      return createStore => (reducer, ...args) => {
        //ç”±createStoreå’Œreduceråˆ›å»ºstore
        const store = createStore(reducer, ...args) 
        let dispatch = store.dispatch
        var middlewareAPI = {
          getState: store.getState,
          dispatch: (action, ...args) => dispatch(action, ...args)
        }
        //æŠŠgetState/dispatchä¼ ç»™middlewareï¼Œ
        //mapè®©æ¯ä¸ªmiddlewareè·å¾—äº†middlewareAPIå‚æ•°
        //å½¢æˆä¸€ä¸ªchainåŒ¿åå‡½æ•°æ•°ç»„[f1,f2,f3...fn]
        const chain = middlewares.map(middleware => middleware(middlewareAPI))
        //dispatch=f1(f2(f3(store.dispatch)))ï¼ŒæŠŠæ‰€æœ‰  çš„middlewareä¸²è”èµ·æ¥
        dispatch = compose(...chain)(store.dispatch)
        return {
          ...store,
          dispatch
        }
      }
    }
    

applyMiddleware ç¬¦åˆæ´‹è‘±æ¨¡å‹

![file](https://img2024.cnblogs.com/other/2332333/202501/2332333-20250126151133720-2086869257.png)

æ€»ç»“
--

æœ¬æ–‡æ„åœ¨è®²è§£ react çš„æ•°æ®æµç®¡ç†ã€‚ä» react æœ¬èº«çš„æä¾›çš„æ•°æ®æµæ–¹å¼å‡ºå‘

1.  åŸºäº `props` çš„å•å‘æ•°æ®æµï¼Œä¸²è”çˆ¶å­å’Œå…„å¼Ÿç»„ä»¶éå¸¸çµæ´»ï¼Œä½†æ˜¯å¯¹äºåµŒå¥—è¿‡æ·±çš„ç»„ä»¶ï¼Œä¼šä½¿å¾—ä¸­é—´ç»„ä»¶éƒ½åŠ ä¸Šä¸éœ€è¦çš„ `props` æ•°æ®
2.  ä½¿ç”¨ Context ç»´æŠ¤å…¨å±€çŠ¶æ€ï¼Œä»‹ç»äº† v16.3 ä¹‹å‰ã€v16.3ä¹‹åçš„hooks ï¼Œä¸åŒç‰ˆæœ¬ `context` çš„ä½¿ç”¨ï¼Œä»¥åŠ v16.3 ä¹‹å‰ç‰ˆæœ¬çš„ `context` çš„å¼Šç«¯ã€‚
3.  å¼•å…¥ redux ï¼Œç¬¬ä¸‰æ–¹çš„çŠ¶æ€å®¹å™¨ï¼Œä»¥åŠ react-redux API ( Provider/connect )åˆ†æä¸ä¸ç‰ˆå®ç°ï¼Œæœ€åä»‹ç»äº† redux å¼ºå¤§çš„ä¸­é—´ä»¶æ˜¯å¦‚ä½•é‡å†™ dispatch æ–¹æ³•

å‚è€ƒè¿æ¥
----

*   [å¯¹ React çŠ¶æ€ç®¡ç†çš„ç†è§£åŠæ–¹æ¡ˆå¯¹æ¯”](https://github.com/sunyongjian/blog/issues/36)
*   [èŠä¸€èŠæˆ‘å¯¹ React Context çš„ç†è§£ä»¥åŠåº”ç”¨](https://juejin.cn/post/6844903566381940744)
*   [redux middleware è¯¦è§£](https://zhuanlan.zhihu.com/p/20597452)
*   [æ‰‹å†™ react-redux](http://dennisgo.cn/Articles/React/React-Redux.html)

### æœ€å

æ¬¢è¿å…³æ³¨ã€è¢‹é¼ äº‘æ•°æ ˆUEDå›¢é˜Ÿã€‘~  
è¢‹é¼ äº‘æ•°æ ˆ UED å›¢é˜ŸæŒç»­ä¸ºå¹¿å¤§å¼€å‘è€…åˆ†äº«æŠ€æœ¯æˆæœï¼Œç›¸ç»§å‚ä¸å¼€æºäº†æ¬¢è¿ star

*   **[å¤§æ•°æ®åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿâ€”â€”Taier](https://dtstack.github.io/Taier/)**
*   **[è½»é‡çº§çš„ Web IDE UI æ¡†æ¶â€”â€”Molecule](https://dtstack.github.io/molecule/)**
*   **[é’ˆå¯¹å¤§æ•°æ®é¢†åŸŸçš„ SQL Parser é¡¹ç›®â€”â€”dt-sql-parser](https://dtstack.github.io/monaco-sql-languages/)**
*   **[è¢‹é¼ äº‘æ•°æ ˆå‰ç«¯å›¢é˜Ÿä»£ç è¯„å®¡å·¥ç¨‹å®è·µæ–‡æ¡£â€”â€”code-review-practices](https://github.com/DTStack/code-review-practices)**
*   **[ä¸€ä¸ªé€Ÿåº¦æ›´å¿«ã€é…ç½®æ›´çµæ´»ã€ä½¿ç”¨æ›´ç®€å•çš„æ¨¡å—æ‰“åŒ…å™¨â€”â€”ko](https://github.com/DTStack/ko)**
*   **[ä¸€ä¸ªé’ˆå¯¹ antd çš„ç»„ä»¶æµ‹è¯•å·¥å…·åº“â€”â€”ant-design-testing](https://github.com/DTStack/ant-design-testing)**