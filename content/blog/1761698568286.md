---
layout: post
title: 'ASP.NET Core WebApi é›†æˆ MCP åè®®å®Œå…¨æŒ‡å—'
date: "2025-10-29T00:42:48Z"
---
ASP.NET Core WebApi é›†æˆ MCP åè®®å®Œå…¨æŒ‡å—
=================================

å‰è¨€
--

Model Context Protocol (MCP) æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–åè®®ï¼Œè®© AI å®¢æˆ·ç«¯ï¼ˆå¦‚ Claudeã€ChatGPT ç­‰ï¼‰èƒ½å¤Ÿé€šè¿‡ç»Ÿä¸€çš„æ¥å£è°ƒç”¨ä½ çš„ APIã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ ASP.NET Core WebApi é¡¹ç›®ä¸­é›†æˆ MCP æ”¯æŒï¼Œå®ç° AI ä¸ä½ çš„æœåŠ¡æ— ç¼å¯¹æ¥ã€‚

ä»€ä¹ˆæ˜¯ MCPï¼Ÿ
--------

MCPï¼ˆModel Context Protocolï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾åè®®ï¼Œæ—¨åœ¨æ ‡å‡†åŒ– AI åº”ç”¨ä¸å¤–éƒ¨å·¥å…·ã€æ•°æ®æºä¹‹é—´çš„é€šä¿¡æ–¹å¼ã€‚é€šè¿‡ MCPï¼Œä½ çš„ API å¯ä»¥ï¼š

*   è¢« AI åŠ©æ‰‹è‡ªåŠ¨å‘ç°å’Œè°ƒç”¨
*   æä¾›æ ‡å‡†åŒ–çš„å·¥å…·æè¿°å’Œå‚æ•°å®šä¹‰
*   æ”¯æŒå¤šç§ä¼ è¾“æ¨¡å¼ï¼ˆHTTPã€Stdioï¼‰
*   å®ç°å®‰å…¨çš„è®¤è¯å’Œæˆæƒ

æ ¸å¿ƒç‰¹æ€§
----

æœ¬é¡¹ç›®å®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

*   âœ… ä½¿ç”¨å®˜æ–¹ ModelContextProtocol.AspNetCore SDK
*   âœ… é€šè¿‡ `[McpServerTool]` ç‰¹æ€§å¿«é€Ÿå®šä¹‰å·¥å…·
*   âœ… è‡ªåŠ¨å‚æ•°ç»‘å®šå’Œ JSON Schema ç”Ÿæˆ
*   âœ… æ”¯æŒ HTTP å’Œ Stdio åŒä¼ è¾“æ¨¡å¼
*   âœ… åŸºäº Token çš„è®¤è¯å’Œæˆæƒ
*   âœ… ä¸ç°æœ‰ WebApi å®Œç¾å…±å­˜

å¿«é€Ÿå¼€å§‹
----

### ç¬¬ä¸€æ­¥ï¼šå®‰è£… NuGet åŒ…

    dotnet add package ModelContextProtocol.AspNetCore --version 0.4.0-preview.3
    

### ç¬¬äºŒæ­¥ï¼šé…ç½® MCP æœåŠ¡

åœ¨ `Program.cs` ä¸­æ·»åŠ  MCP é…ç½®ï¼š

    using ModelContextProtocol.Server;
    
    var builder = WebApplication.CreateBuilder(args);
    
    builder.Services.AddControllers();
    
    // æ·»åŠ  MCP æœåŠ¡å™¨ï¼ˆæ”¯æŒ HTTP å’Œ Stdio åŒæ¨¡å¼ï¼‰
    builder.Services
        .AddMcpServer(options =>
        {
            options.ServerInfo = new ModelContextProtocol.Protocol.Implementation
            {
                Name = "Weather API",
                Version = "1.0.0"
            };
        })
        .WithHttpTransport()           // HTTP æ¨¡å¼ï¼šç”¨äº Web å®¢æˆ·ç«¯
        .WithStdioServerTransport()    // Stdio æ¨¡å¼ï¼šç”¨äº Kiro IDE ç­‰æœ¬åœ°å·¥å…·
        .WithToolsFromAssembly();
    
    var app = builder.Build();
    
    // æ·»åŠ è®¤è¯ä¸­é—´ä»¶ï¼ˆå¯é€‰ï¼‰
    app.UseMiddleware<McpAuthenticationMiddleware>();
    
    app.UseAuthorization();
    app.MapControllers();
    
    // æ˜ å°„ MCP ç«¯ç‚¹
    app.MapMcp("/mcp");
    
    app.Run();
    

### ç¬¬ä¸‰æ­¥ï¼šå®šä¹‰ MCP å·¥å…·

åˆ›å»º `Tools/WeatherTools.cs`ï¼š

    using System.ComponentModel;
    using ModelContextProtocol.Server;
    
    [McpServerToolType]
    public static class WeatherTools
    {
        [McpServerTool]
        [Description("Get weather forecast for the next 5 days")]
        public static IEnumerable<WeatherForecast> GetWeatherForecast()
        {
            var rng = new Random();
            return Enumerable.Range(1, 5).Select(index => new WeatherForecast
            {
                Date = DateOnly.FromDateTime(DateTime.Now.AddDays(index)),
                TemperatureC = rng.Next(-20, 55),
                Summary = Summaries[rng.Next(Summaries.Length)]
            }).ToArray();
        }
    
        [McpServerTool]
        [Description("Get current weather for a specific city")]
        public static WeatherForecast GetWeatherByCity(
            [Description("The name of the city")] string city)
        {
            var rng = new Random();
            return new WeatherForecast
            {
                Date = DateOnly.FromDateTime(DateTime.Now),
                TemperatureC = rng.Next(-20, 55),
                Summary = $"Weather in {city}: {Summaries[rng.Next(Summaries.Length)]}"
            };
        }
    
        private static readonly string[] Summaries = new[]
        {
            "Freezing", "Bracing", "Chilly", "Cool", "Mild",
            "Warm", "Balmy", "Hot", "Sweltering", "Scorching"
        };
    }
    

### ç¬¬å››æ­¥ï¼šé…ç½®è®¤è¯ï¼ˆå¯é€‰ï¼‰

åœ¨ `appsettings.json` ä¸­é…ç½®ï¼š

    {
      "McpAuth": {
        "Enabled": true,
        "ValidTokens": ["your-secret-token-here"]
      }
    }
    

å¼€å‘ç¯å¢ƒå¯ä»¥ç¦ç”¨è®¤è¯ï¼ˆ`appsettings.Development.json`ï¼‰ï¼š

    {
      "McpAuth": {
        "Enabled": false
      }
    }
    

### ç¬¬äº”æ­¥ï¼šè¿è¡Œå’Œæµ‹è¯•

    dotnet run
    

åº”ç”¨å¯åŠ¨åï¼Œå¯ä»¥è®¿é—®ï¼š

*   **Swagger UI**: `http://localhost:5000/swagger`
*   **WebApi**: `http://localhost:5000/weatherforecast`
*   **MCP ç«¯ç‚¹**: `http://localhost:5000/mcp`

ä¼ è¾“æ¨¡å¼è¯¦è§£
------

### HTTP æ¨¡å¼

é€‚ç”¨äº Web åº”ç”¨ã€Claude Desktopã€è¿œç¨‹è®¿é—®ç­‰åœºæ™¯ã€‚

**æµ‹è¯•ç¤ºä¾‹**ï¼š

    # åˆ—å‡ºæ‰€æœ‰å·¥å…·
    curl -X POST http://localhost:5000/mcp \
      -H "Content-Type: application/json" \
      -d '{"jsonrpc":"2.0","id":1,"method":"tools/list"}'
    
    # è°ƒç”¨å·¥å…·
    curl -X POST http://localhost:5000/mcp \
      -H "Authorization: Bearer your-secret-token-here" \
      -H "Content-Type: application/json" \
      -d '{
        "jsonrpc":"2.0",
        "id":2,
        "method":"tools/call",
        "params":{
          "name":"GetWeatherForecast",
          "arguments":{}
        }
      }'
    

**Claude Desktop é…ç½®**ï¼š

ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆWindows: `%APPDATA%\Claude\claude_desktop_config.json`ï¼‰ï¼š

    {
      "mcpServers": {
        "weather-api": {
          "url": "http://localhost:5000/mcp",
          "headers": {
            "Authorization": "Bearer your-secret-token-here"
          }
        }
      }
    }
    

### Stdio æ¨¡å¼

é€‚ç”¨äº Kiro IDEã€æœ¬åœ°å‘½ä»¤è¡Œå·¥å…·ç­‰åœºæ™¯ï¼Œæ— éœ€ç½‘ç»œç«¯å£ã€‚

**Kiro IDE é…ç½®**ï¼š

ç¼–è¾‘ `.kiro/settings/mcp.json`ï¼š

    {
      "mcpServers": {
        "weather-api": {
          "command": "dotnet",
          "args": ["run", "--project", "path/to/NetCoreApiMcpDemo.csproj"],
          "env": {
            "ASPNETCORE_ENVIRONMENT": "Development"
          }
        }
      }
    }
    

### æ¨¡å¼å¯¹æ¯”

ç‰¹æ€§

HTTP æ¨¡å¼

Stdio æ¨¡å¼

ä¼ è¾“æ–¹å¼

HTTP POST

æ ‡å‡†è¾“å…¥/è¾“å‡º

é€‚ç”¨åœºæ™¯

Web åº”ç”¨ã€è¿œç¨‹è®¿é—®

æœ¬åœ°å·¥å…·ã€IDE é›†æˆ

è®¤è¯

HTTP Header

ç¯å¢ƒå˜é‡/é…ç½®

ç½‘ç»œ

éœ€è¦ç½‘ç»œç«¯å£

æ— éœ€ç½‘ç»œ

æ€§èƒ½

ç½‘ç»œå¼€é”€

è¿›ç¨‹é—´é€šä¿¡ï¼Œæ›´å¿«

è®¤è¯å’Œæˆæƒ
-----

### å®ç°è®¤è¯ä¸­é—´ä»¶

åˆ›å»º `Middleware/McpAuthenticationMiddleware.cs`ï¼š

    public class McpAuthenticationMiddleware
    {
        private readonly RequestDelegate _next;
        private readonly IConfiguration _configuration;
        private readonly ILogger<McpAuthenticationMiddleware> _logger;
    
        public McpAuthenticationMiddleware(
            RequestDelegate next,
            IConfiguration configuration,
            ILogger<McpAuthenticationMiddleware> logger)
        {
            _next = next;
            _configuration = configuration;
            _logger = logger;
        }
    
        public async Task InvokeAsync(HttpContext context)
        {
            // åªå¯¹ MCP ç«¯ç‚¹è¿›è¡Œè®¤è¯
            if (!context.Request.Path.StartsWithSegments("/mcp"))
            {
                await _next(context);
                return;
            }
    
            // æ£€æŸ¥æ˜¯å¦å¯ç”¨è®¤è¯
            var authEnabled = _configuration.GetValue<bool>("McpAuth:Enabled");
            if (!authEnabled)
            {
                await _next(context);
                return;
            }
    
            // éªŒè¯ Token
            var authHeader = context.Request.Headers["Authorization"].FirstOrDefault();
            if (string.IsNullOrEmpty(authHeader) || !authHeader.StartsWith("Bearer "))
            {
                context.Response.StatusCode = 401;
                await context.Response.WriteAsJsonAsync(new { error = "Unauthorized" });
                return;
            }
    
            var token = authHeader.Substring("Bearer ".Length).Trim();
            var validTokens = _configuration.GetSection("McpAuth:ValidTokens").Get<string[]>();
    
            if (validTokens == null || !validTokens.Contains(token))
            {
                context.Response.StatusCode = 401;
                await context.Response.WriteAsJsonAsync(new { error = "Invalid token" });
                return;
            }
    
            await _next(context);
        }
    }
    

### å®‰å…¨æœ€ä½³å®è·µ

1.  **ä½¿ç”¨å¼º Token**ï¼šè‡³å°‘ 32 å­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²
2.  **å®šæœŸè½®æ¢**ï¼šå®šæœŸæ›´æ¢ Token
3.  **ä½¿ç”¨ HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS
4.  **ç¯å¢ƒéš”ç¦»**ï¼šå¼€å‘å’Œç”Ÿäº§ä½¿ç”¨ä¸åŒçš„ Token
5.  **æ—¥å¿—å®‰å…¨**ï¼šä¸è¦åœ¨æ—¥å¿—ä¸­è®°å½•å®Œæ•´ Token

å®¢æˆ·ç«¯é›†æˆç¤ºä¾‹
-------

### C# å®¢æˆ·ç«¯

    using ModelContextProtocol;
    using ModelContextProtocol.Client;
    
    var transport = new HttpClientTransport(new HttpClientTransportOptions
    {
        BaseUrl = new Uri("http://localhost:5000/mcp"),
        Headers = new Dictionary<string, string>
        {
            ["Authorization"] = "Bearer your-secret-token-here"
        }
    });
    
    var client = await McpClient.CreateAsync(transport);
    
    await client.InitializeAsync(new InitializeParams
    {
        ProtocolVersion = "2025-06-18",
        ClientInfo = new Implementation
        {
            Name = "MyApp",
            Version = "1.0.0"
        }
    });
    
    // åˆ—å‡ºå·¥å…·
    var tools = await client.ListToolsAsync();
    
    // è°ƒç”¨å·¥å…·
    var result = await client.CallToolAsync(
        "GetWeatherForecast",
        new Dictionary<string, object?>()
    );
    

### JavaScript/Vue å®¢æˆ·ç«¯

    <script setup>
    import { ref } from 'vue';
    
    const weather = ref('');
    const MCP_URL = 'http://localhost:5000/mcp';
    const TOKEN = 'your-secret-token-here';
    
    const callMcp = async (method, params = {}) => {
      const response = await fetch(MCP_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${TOKEN}`,
        },
        body: JSON.stringify({
          jsonrpc: '2.0',
          id: Date.now(),
          method,
          params,
        }),
      });
      return response.json();
    };
    
    const getWeather = async () => {
      const data = await callMcp('tools/call', {
        name: 'GetWeatherForecast',
        arguments: {},
      });
      weather.value = data.result.content[0].text;
    };
    </script>
    

MCP Tools æœ€ä½³å®è·µ
--------------

è®© AI æ›´å‡†ç¡®åœ°ä½¿ç”¨ä½ çš„å·¥å…·æ˜¯æˆåŠŸçš„å…³é”®ã€‚ä»¥ä¸‹æ˜¯ç»è¿‡å®è·µéªŒè¯çš„æœ€ä½³å®è·µã€‚

### æ ¸å¿ƒåŸåˆ™

AI é€šè¿‡ä»¥ä¸‹ä¿¡æ¯å†³å®šæ˜¯å¦ä½¿ç”¨ä½ çš„å·¥å…·ï¼š

1.  **å·¥å…·åç§°** - æ¸…æ™°ã€æè¿°æ€§
2.  **Description** - è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜
3.  **å‚æ•°æè¿°** - æ˜ç¡®çš„å‚æ•°ç”¨é€”
4.  **ä½¿ç”¨åœºæ™¯** - ä½•æ—¶åº”è¯¥ä½¿ç”¨è¿™ä¸ªå·¥å…·

### 1\. ä½¿ç”¨æ¸…æ™°çš„å‘½å

    // âŒ ä¸å¥½ - åç§°æ¨¡ç³Š
    [McpServerTool]
    public static string Get() { }
    
    // âœ… å¥½ - åŠ¨è¯å¼€å¤´ï¼Œæè¿°æ¸…æ™°
    [McpServerTool]
    public static string GetWeatherForecast() { }
    
    // âœ… æ›´å¥½ - åŒ…å«å…·ä½“ä¿¡æ¯
    [McpServerTool]
    public static string GetWeatherForecastForNextDays() { }
    

å‘½åå»ºè®®ï¼š

*   ä½¿ç”¨åŠ¨è¯å¼€å¤´ï¼šGet, Search, Calculate, Compare, Analyze
*   åŒ…å«æ“ä½œå¯¹è±¡ï¼šWeather, Temperature, Forecast
*   é¿å…ç¼©å†™å’Œç®€ç§°
*   ä½¿ç”¨ PascalCase

### 2\. ç¼–å†™è¯¦ç»†çš„ Descriptionï¼ˆæœ€é‡è¦ï¼ï¼‰

è¿™æ˜¯æœ€å…³é”®çš„éƒ¨åˆ†ï¼AI ä¸»è¦é€šè¿‡ Description åˆ¤æ–­æ˜¯å¦ä½¿ç”¨å·¥å…·ã€‚

    // âŒ ä¸å¥½ - å¤ªç®€çŸ­
    [Description("Get weather")]
    
    // âš ï¸ ä¸€èˆ¬ - æœ‰åŸºæœ¬ä¿¡æ¯ä½†ä¸å¤Ÿ
    [Description("Get weather forecast for the next 5 days")]
    
    // âœ… å¥½ - åŒ…å«è¯¦ç»†ä¿¡æ¯å’Œä½¿ç”¨åœºæ™¯
    [Description(@"Get detailed weather forecast for the next several days including temperature, weather conditions, and trends.
    
    Use this tool when users ask about:
    - Future weather (tomorrow, next week, upcoming days)
    - Weather predictions or forecasts
    - Planning activities based on weather
    - Temperature trends
    
    Examples of user queries:
    - 'What's the weather forecast for the next 5 days?'
    - 'Will it rain this week?'
    - 'What's the temperature trend?'")]
    

Description åº”è¯¥åŒ…å«ï¼š

1.  **åŠŸèƒ½è¯´æ˜** - å·¥å…·åšä»€ä¹ˆ
2.  **ä½¿ç”¨åœºæ™¯** - ä½•æ—¶ä½¿ç”¨ï¼ˆ"Use this tool when..."ï¼‰
3.  **ç¤ºä¾‹æŸ¥è¯¢** - ç”¨æˆ·å¯èƒ½çš„æé—®æ–¹å¼
4.  **æ”¯æŒçš„åŠŸèƒ½** - ç‰¹æ®Šèƒ½åŠ›æˆ–é™åˆ¶

### 3\. è¯¦ç»†çš„å‚æ•°æè¿°

    [McpServerTool]
    public static string GetWeatherByCity(
        // âŒ ä¸å¥½
        [Description("city")] string city,
    
        // âœ… å¥½
        [Description("The name of the city in English or Chinese (e.g., 'Beijing', 'åŒ—äº¬', 'Shanghai', 'New York')")]
        string city,
    
        // âœ… æ›´å¥½ - åŒ…å«é»˜è®¤å€¼è¯´æ˜
        [Description("Number of days to forecast (1-7 days). Default is 5 days if not specified.")]
        int days = 5
    )
    

å‚æ•°æè¿°åº”è¯¥åŒ…å«ï¼š

*   å‚æ•°çš„ç”¨é€”
*   æ”¯æŒçš„æ ¼å¼æˆ–å€¼èŒƒå›´
*   ç¤ºä¾‹å€¼
*   é»˜è®¤å€¼ï¼ˆå¦‚æœæœ‰ï¼‰

### 4\. è¿”å›æ ¼å¼åŒ–ã€æ˜“è¯»çš„ç»“æœ

    // âŒ ä¸å¥½ - è¿”å›åŸå§‹å¯¹è±¡
    public static WeatherForecast GetWeather(string city)
    {
        return new WeatherForecast { ... };
    }
    
    // âœ… å¥½ - è¿”å›æ ¼å¼åŒ–çš„æ–‡æœ¬
    public static string GetWeather(string city)
    {
        var weather = GetWeatherData(city);
    
        return $@"ğŸŒ Current Weather in {city}
    ğŸ“… Date: {weather.Date:yyyy-MM-dd}
    ğŸŒ¡ï¸ Temperature: {weather.TemperatureC}Â°C ({weather.TemperatureF}Â°F)
    â˜ï¸ Conditions: {weather.Summary}
    â° Updated: {DateTime.Now:HH:mm:ss}";
    }
    

### 5\. å®Œæ•´ç¤ºä¾‹ï¼šæŸ¥è¯¢å·¥å…·

    [McpServerTool]
    [Description(@"Get detailed weather forecast for the next several days including temperature, weather conditions, and trends.
    
    Use this tool when users ask about:
    - Future weather (tomorrow, next week, upcoming days)
    - Weather predictions or forecasts
    - Planning activities based on weather
    - Temperature trends
    - Weather conditions for travel planning
    
    Examples of user queries:
    - 'What's the weather forecast for the next 5 days?'
    - 'Will it rain this week?'
    - 'What's the temperature trend?'
    - 'Should I bring a jacket tomorrow?'
    - 'æœªæ¥å‡ å¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ'
    - 'è¿™å‘¨ä¼šä¸‹é›¨å—ï¼Ÿ'")]
    public static string GetWeatherForecast(
        [Description("Number of days to forecast (1-7 days). Default is 5 days if not specified.")]
        int days = 5)
    {
        var forecasts = GenerateForecasts(days);
    
        var result = new StringBuilder();
        result.AppendLine($"ğŸŒ¤ï¸ Weather Forecast for Next {days} Days");
        result.AppendLine();
    
        foreach (var forecast in forecasts)
        {
            result.AppendLine($"ğŸ“… {forecast.Date:yyyy-MM-dd (ddd)}");
            result.AppendLine($"   ğŸŒ¡ï¸ Temperature: {forecast.TemperatureC}Â°C ({forecast.TemperatureF}Â°F)");
            result.AppendLine($"   â˜ï¸ Conditions: {forecast.Summary}");
            result.AppendLine();
        }
    
        return result.ToString();
    }
    

### 6\. å®Œæ•´ç¤ºä¾‹ï¼šæ¯”è¾ƒå·¥å…·

    [McpServerTool]
    [Description(@"Compare weather conditions between two cities to help with travel decisions or general comparison.
    
    Use this tool when users want to:
    - Compare weather between cities
    - Decide which city has better weather
    - Plan travel between cities
    - Compare temperatures
    - Choose destination based on weather
    
    Examples of user queries:
    - 'Compare weather between Beijing and Shanghai'
    - 'Which city is warmer, Tokyo or Seoul?'
    - 'Weather difference between New York and London'
    - 'åŒ—äº¬å’Œä¸Šæµ·å“ªä¸ªåŸå¸‚å¤©æ°”æ›´å¥½ï¼Ÿ'
    - 'ä¸œäº¬å’Œé¦–å°”å“ªé‡Œæ›´æš–å’Œï¼Ÿ'")]
    public static string CompareWeatherBetweenCities(
        [Description("First city name (English or Chinese)")] string city1,
        [Description("Second city name (English or Chinese)")] string city2)
    {
        var weather1 = GetWeatherData(city1);
        var weather2 = GetWeatherData(city2);
    
        return $@"ğŸŒ Weather Comparison
    
    ğŸ“ {city1}:
       ğŸŒ¡ï¸ Temperature: {weather1.TemperatureC}Â°C
       â˜ï¸ Conditions: {weather1.Summary}
    
    ğŸ“ {city2}:
       ğŸŒ¡ï¸ Temperature: {weather2.TemperatureC}Â°C
       â˜ï¸ Conditions: {weather2.Summary}
    
    ğŸ“Š Difference: {Math.Abs(weather1.TemperatureC - weather2.TemperatureC)}Â°C
    {(weather1.TemperatureC > weather2.TemperatureC ? $"ğŸ”¥ {city1} is warmer" : $"ğŸ”¥ {city2} is warmer")}";
    }
    

### 7\. Description æ¨¡æ¿

åŸºç¡€æ¨¡æ¿ï¼š

    [Description(@"[ç®€çŸ­åŠŸèƒ½è¯´æ˜]
    
    Use this tool when users ask about:
    - [ä½¿ç”¨åœºæ™¯1]
    - [ä½¿ç”¨åœºæ™¯2]
    - [ä½¿ç”¨åœºæ™¯3]
    
    Examples of user queries:
    - '[ç¤ºä¾‹é—®é¢˜1]'
    - '[ç¤ºä¾‹é—®é¢˜2]'
    - '[ç¤ºä¾‹é—®é¢˜3]'")]
    

å®Œæ•´æ¨¡æ¿ï¼š

    [Description(@"[è¯¦ç»†åŠŸèƒ½è¯´æ˜ï¼ŒåŒ…æ‹¬è¿”å›çš„æ•°æ®ç±»å‹å’Œæ ¼å¼]
    
    Use this tool when users want to:
    - [ä½¿ç”¨åœºæ™¯1]
    - [ä½¿ç”¨åœºæ™¯2]
    - [ä½¿ç”¨åœºæ™¯3]
    
    Supports:
    - [æ”¯æŒçš„åŠŸèƒ½1]
    - [æ”¯æŒçš„åŠŸèƒ½2]
    
    Examples of user queries:
    - '[è‹±æ–‡ç¤ºä¾‹1]'
    - '[è‹±æ–‡ç¤ºä¾‹2]'
    - '[ä¸­æ–‡ç¤ºä¾‹1]'
    - '[ä¸­æ–‡ç¤ºä¾‹2]'
    
    Note: [ç‰¹æ®Šè¯´æ˜æˆ–é™åˆ¶]")]
    

### 8\. ä¼˜åŒ–æ£€æŸ¥æ¸…å•

åœ¨å‘å¸ƒå·¥å…·å‰ï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

*    å·¥å…·åç§°æ¸…æ™°ã€æè¿°æ€§å¼º
*    Description åŒ…å«è¯¦ç»†åŠŸèƒ½è¯´æ˜
*    Description åŒ…å«ä½¿ç”¨åœºæ™¯ï¼ˆ"Use this tool when..."ï¼‰
*    Description åŒ…å«ç¤ºä¾‹æŸ¥è¯¢
*    æ‰€æœ‰å‚æ•°éƒ½æœ‰è¯¦ç»†æè¿°
*    å‚æ•°æè¿°åŒ…å«ç¤ºä¾‹å€¼
*    è¿”å›å€¼æ ¼å¼åŒ–ã€æ˜“è¯»
*    åŒ…å«é”™è¯¯å¤„ç†
*    æ”¯æŒå¤šè¯­è¨€ï¼ˆå¦‚æœéœ€è¦ï¼‰
*    åœ¨ MCP Inspector ä¸­æµ‹è¯•é€šè¿‡
*    åœ¨ AI å®¢æˆ·ç«¯ä¸­æµ‹è¯•é€šè¿‡

é«˜çº§ç‰¹æ€§
----

### ä¾èµ–æ³¨å…¥æ”¯æŒ

å·¥å…·æ–¹æ³•å¯ä»¥æ³¨å…¥æœåŠ¡ï¼š

    [McpServerTool]
    [Description("Get weather with logging")]
    public static string GetWeatherWithLogging(
        ILogger<WeatherTools> logger,
        IWeatherService weatherService,
        string city)
    {
        logger.LogInformation("Getting weather for {City}", city);
        return weatherService.GetWeather(city);
    }
    

### æ·»åŠ  Prompts

    [McpServerPromptType]
    public static class WeatherPrompts
    {
        [McpServerPrompt]
        [Description("Creates a prompt to help plan outdoor activities based on weather")]
        public static ChatMessage PlanOutdoorActivity(
            [Description("The city name")] string city,
            [Description("The activity type")] string activity)
        {
            return new ChatMessage(
                ChatRole.User,
                $@"I want to plan a {activity} activity in {city}.
                Please check the weather forecast and suggest the best day and time.
                Consider temperature, conditions, and provide detailed recommendations."
            );
        }
    }
    

### å¤æ‚å‚æ•°ç±»å‹

SDK è‡ªåŠ¨æ”¯æŒï¼š

*   åŸºæœ¬ç±»å‹ï¼š`string`, `int`, `bool`, `double` ç­‰
*   å¤æ‚å¯¹è±¡ï¼šè‡ªåŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ–
*   å¯é€‰å‚æ•°ï¼šä½¿ç”¨é»˜è®¤å€¼
*   æ•°ç»„å’Œé›†åˆ

æ•…éšœæ’é™¤
----

### å·¥å…·æœªè¢«å‘ç°

æ£€æŸ¥é¡¹ï¼š

*   ç±»æ˜¯å¦æœ‰ `[McpServerToolType]` ç‰¹æ€§
*   æ–¹æ³•æ˜¯å¦æœ‰ `[McpServerTool]` ç‰¹æ€§
*   ç±»æ˜¯å¦æ˜¯é™æ€çš„
*   æ˜¯å¦é‡å¯äº†åº”ç”¨

### è®¤è¯å¤±è´¥

æ£€æŸ¥é¡¹ï¼š

*   Token æ˜¯å¦æ­£ç¡®
*   `appsettings.json` ä¸­ `Enabled` è®¾ç½®
*   Authorization header æ ¼å¼
*   ç¯å¢ƒé…ç½®ï¼ˆDevelopment vs Productionï¼‰

### CORS é—®é¢˜

åœ¨ `Program.cs` ä¸­æ·»åŠ  CORS æ”¯æŒï¼š

    builder.Services.AddCors(options =>
    {
        options.AddPolicy("AllowMcpClients", policy =>
        {
            policy.WithOrigins("http://localhost:3000")
                  .AllowAnyHeader()
                  .AllowAnyMethod();
        });
    });
    
    app.UseCors("AllowMcpClients");
    

é¡¹ç›®ç»“æ„
----

    NetCoreApiMcpDemo/
    â”œâ”€â”€ Controllers/
    â”‚   â””â”€â”€ WeatherForecastController.cs  # æ ‡å‡† WebApi æ§åˆ¶å™¨
    â”œâ”€â”€ Tools/
    â”‚   â””â”€â”€ WeatherTools.cs                # MCP å·¥å…·å®šä¹‰
    â”œâ”€â”€ Middleware/
    â”‚   â””â”€â”€ McpAuthenticationMiddleware.cs # è®¤è¯ä¸­é—´ä»¶
    â”œâ”€â”€ Program.cs                          # åº”ç”¨é…ç½®
    â”œâ”€â”€ appsettings.json                    # é…ç½®æ–‡ä»¶
    â””â”€â”€ appsettings.Development.json        # å¼€å‘é…ç½®
    

ä¸ºä»€ä¹ˆé€‰æ‹©å®˜æ–¹ SDKï¼Ÿ
------------

1.  **ä»£ç æ›´å°‘**ï¼šæ— éœ€è‡ªå®šä¹‰ç‰¹æ€§å’Œæä¾›è€…
2.  **æ›´å¯é **ï¼šå®˜æ–¹ç»´æŠ¤å’Œæ›´æ–°
3.  **æ›´å¼ºå¤§**ï¼šè‡ªåŠ¨ Schemaã€DI æ”¯æŒ
4.  **æ›´æ ‡å‡†**ï¼šå®Œå…¨ç¬¦åˆ MCP è§„èŒƒ
5.  **æ›´æ˜“ç»´æŠ¤**ï¼šæ— éœ€ç»´æŠ¤è‡ªå®šä¹‰ä»£ç 

æ€»ç»“
--

é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•åœ¨ ASP.NET Core WebApi ä¸­é›†æˆ MCP åè®®æ”¯æŒã€‚ä½¿ç”¨å®˜æ–¹ SDKï¼Œåªéœ€å‡ è¡Œä»£ç å°±èƒ½è®©ä½ çš„ API è¢« AI å®¢æˆ·ç«¯è°ƒç”¨ã€‚MCP åè®®çš„æ ‡å‡†åŒ–ç‰¹æ€§ï¼Œè®© AI åº”ç”¨ä¸åç«¯æœåŠ¡çš„é›†æˆå˜å¾—å‰æ‰€æœªæœ‰çš„ç®€å•ã€‚

å‚è€ƒèµ„æº
----

*   [MCP å®˜æ–¹æ–‡æ¡£](https://modelcontextprotocol.io/)
*   [MCP C# SDK](https://github.com/modelcontextprotocol/csharp-sdk)
*   [MCP è§„èŒƒ](https://spec.modelcontextprotocol.io/)
*   [NuGet åŒ…](https://www.nuget.org/packages/ModelContextProtocol.AspNetCore)

æºç åœ°å€
----

å®Œæ•´ç¤ºä¾‹ä»£ç è¯·è®¿é—®ï¼š\[GitHub ä»“åº“åœ°å€\]

* * *

å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€å…³æ³¨ï¼æœ‰ä»»ä½•é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºã€‚