---
layout: post
title: '【光照】[PBR][菲涅尔]实现方法对比'
date: "2025-10-04T00:36:25Z"
---
【光照】\[PBR\]\[菲涅尔\]实现方法对比
========================

![【光照】[PBR][菲涅尔]实现方法对比](https://img2024.cnblogs.com/blog/3685400/202510/3685400-20251002233209293-40276979.png) Unity URP中的菲涅尔效应主要采用Schlick近似模型，通过三步流程实现：确定基础反射率F₀、角度依赖计算和金属/非金属处理。该模型以1次pow运算实现高性价比的实时渲染，视觉误差小于2%，并与GGX+Smith模型完美配合。URP通过F0=lerp(0.04,albedo,metallic)统一处理材质反射率，同时提供移动端优化版和扩展功能。相比完整方程20+指令和Spherical Gaussian近似，Schlick在6-8指令内平衡性能与质量，成为行业标准方案，因其硬件友好、参数直观且扩展性

> [【从UnityURP开始探索游戏渲染】](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**专栏-直达**

**菲涅尔效应基本流程**
=============

菲涅尔效应(F)在BRDF中描述光线在不同入射角下的反射率变化，其计算流程通常分为三个步骤：

*   ‌**基础反射率确定**‌：0°入射角时的反射率(F₀)
*   ‌**角度依赖计算**‌：根据入射角变化调整反射率
*   ‌**金属/非金属处理**‌：区分导体和绝缘体的不同表现

**主要菲涅尔模型实现**
=============

**1\. Schlick近似模型**
-------------------

‌**原理**‌：

*   对完整菲涅尔方程的简化近似
*   使用有理函数替代复杂计算

‌**公式**‌：

$F\_{Schlick}(v,h)=F\_0+(1−F\_0)(1−(v⋅h))^5$

‌**特点**‌：

*   计算效率高
*   精度足够实时渲染使用
*   在掠射角(90°)强制反射率为1

‌**Unity URP实现**‌：

    hlsl
    // Packages/com.unity.render-pipelines.universal/ShaderLibrary/BRDF.hlsl
    half3 F_Schlick(half u, half3 F0)
    {
        return F0 + (1 - F0) * pow(1 - u, 5);
    }
    

**2\. 完整菲涅尔方程**
---------------

‌**原理**‌：

*   基于麦克斯韦电磁学方程
*   考虑光的偏振特性

‌**公式**‌：

$F\_{完整}=\\frac12\[(\\frac{g−c}{g+c})2+(\\frac{c(g+c)−1}{c(g−c)+1})2\]$

其中 $c=v⋅h, g=\\sqrt{n2+c2−1}$

‌**特点**‌：

*   物理精确但计算复杂
*   主要用于离线渲染

**3\. Spherical Gaussian近似**
----------------------------

‌**原理**‌：

*   用高斯函数近似菲涅尔曲线
*   特别适合移动端

‌**公式**‌：

$F\_{SG}(v,h)=F\_0+(1−F\_0)2^{(−5.55473(v⋅h)−6.98316)(v⋅h)}$

‌**特点**‌：

*   无pow函数计算
*   适合低精度硬件

**Unity URP的选择与实现**
===================

**核心方案：Schlick近似 + 金属工作流**
--------------------------

### ‌**完整实现代码**‌：

    hlsl
    // URP中的菲涅尔计算
    half3 F_Fresnel(half3 F0, half u)
    {
        half t = pow(1 - u, 5); // Schlick的(1-cosθ)^5项
        return saturate(F0 + (1 - F0) * t); // 基础Schlick公式
    }
    
    // 实际应用时：
    half3 F = F_Fresnel(F0, saturate(dot(viewDir, halfDir)));
    

### ‌**选择原因**‌：

*   ‌**性能与质量平衡**‌：
    
    *   仅需1次pow运算
    *   视觉误差小于2%，人眼难以察觉
*   ‌**金属/非金属统一处理**‌：
    
        hlsl
        // F0基础反射率计算
        half3 F0 = lerp(0.04, albedo, metallic); // 0.04是非金属基础反射率
        
    
*   ‌**能量守恒**‌：
    
    *   保证反射光能量不超过入射光
    *   与GGX+Smith模型完美配合
*   ‌**艺术家友好**‌：
    
    *   通过metallic参数直观控制
    *   反射颜色直接取自albedo贴图

**优化实现细节**
==========

*   ‌**移动端优化版**‌：
    
        hlsl
        half3 F_FresnelMobile(half3 F0, half u)
        {
            half t = exp2((-5.55473 * u - 6.98316) * u); // SG近似
            return saturate(F0 + (1 - F0) * t);
        }
        
    
*   ‌**各向异性扩展**‌：
    
        hlsl
        half3 F_Anisotropic(half3 F0, half u, half anisotropy)
        {
            half t = pow(1 - u, 5);
            return F0 + (max(1 - anisotropy, 0.1) - F0) * t;
        }
        
    
*   ‌**多散射补偿**‌：
    
        hlsl
        half3 F_MultiScatter(half3 F0, half u, half roughness)
        {
            half3 F = F_Fresnel(F0, u);
            half3 Favg = F0 + (1 - F0) / 21; // 平均菲涅尔
            return F + (Favg - F) * roughness * 0.9;
        }
        
    

**各模型性能对比**
===========

模型

指令数

特殊函数

移动端适用性

物理精度

Schlick

6-8

pow()

★★★★☆

★★★☆☆

完整方程

20+

sqrt等

★☆☆☆☆

★★★★★

Spherical Gaussian

5-7

exp2()

★★★★★

★★☆☆☆

URP实现

7-9

pow()

★★★★☆

★★★★☆

**为什么Schlick成为行业标准**
====================

‌**历史验证**‌：
-----------

*   自1994年提出以来经过大量实践验证
*   被所有主流引擎采用(Unreal, Unity, Frostbite等)

‌**硬件友好**‌：
-----------

*   现代GPU对pow函数有硬件优化
*   不需要复杂分支判断

‌**参数直观**‌：
-----------

    hlsl
    // 基础反射率设置示例
    float3 F0 = float3(0.04, 0.04, 0.04); // 塑料
    float3 F0 = float3(0.95, 0.64, 0.54); // 铜
    

‌**扩展性强**‌：
-----------

*   容易与各向异性、清漆层等效果结合
*   支持多散射补偿等高级特性

Unity URP选择Schlick近似是在实时渲染约束下做出的最优权衡，能够在保持物理合理性的同时满足性能要求，特别是在移动平台上表现出色。随着硬件发展，虽然更精确的模型变得可行，但Schlick因其简洁有效仍然是实时渲染的首选方案。

* * *

> [【从UnityURP开始探索游戏渲染】](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**专栏-直达**  
> （欢迎_点赞留言_探讨，更多人加入进来能更加完善这个探索的过程，🙏）