---
layout: post
title: 'Driftæ•°æ®åº“å¼€å‘å®æˆ˜ï¼šç±»å‹å®‰å…¨çš„SQLiteè§£å†³æ–¹æ¡ˆ'
date: "2025-09-12T00:38:14Z"
---
Driftæ•°æ®åº“å¼€å‘å®æˆ˜ï¼šç±»å‹å®‰å…¨çš„SQLiteè§£å†³æ–¹æ¡ˆ
============================

Driftæ•°æ®åº“å¼€å‘å®æˆ˜ï¼šç±»å‹å®‰å…¨çš„SQLiteè§£å†³æ–¹æ¡ˆ
============================

> æœ¬æ–‡åŸºäº[BeeCount(èœœèœ‚è®°è´¦)](https://github.com/TNT-Likely/BeeCount)é¡¹ç›®çš„å®é™…å¼€å‘ç»éªŒï¼Œæ·±å…¥æ¢è®¨å¦‚ä½•ä½¿ç”¨Driftæ„å»ºç±»å‹å®‰å…¨ã€é«˜æ€§èƒ½çš„Flutteræ•°æ®åº“å±‚ã€‚

é¡¹ç›®èƒŒæ™¯
----

[BeeCount(èœœèœ‚è®°è´¦)](https://github.com/TNT-Likely/BeeCount)æ˜¯ä¸€æ¬¾å¼€æºã€ç®€æ´ã€æ— å¹¿å‘Šçš„ä¸ªäººè®°è´¦åº”ç”¨ã€‚æ‰€æœ‰è´¢åŠ¡æ•°æ®å®Œå…¨ç”±ç”¨æˆ·æŒæ§ï¼Œæ”¯æŒæœ¬åœ°å­˜å‚¨å’Œå¯é€‰çš„äº‘ç«¯åŒæ­¥ï¼Œç¡®ä¿æ•°æ®ç»å¯¹å®‰å…¨ã€‚

å¼•è¨€
--

åœ¨Flutteråº”ç”¨å¼€å‘ä¸­ï¼Œæœ¬åœ°æ•°æ®å­˜å‚¨æ˜¯ä¸å¯é¿å…çš„éœ€æ±‚ã€‚è™½ç„¶SQLiteæ˜¯ç§»åŠ¨ç«¯æœ€å¸¸ç”¨çš„æ•°æ®åº“è§£å†³æ–¹æ¡ˆï¼Œä½†åŸç”Ÿçš„SQLæ“ä½œå­˜åœ¨è¯¸å¤šé—®é¢˜ï¼šç¼ºä¹ç±»å‹å®‰å…¨ã€å®¹æ˜“å‡ºç°è¿è¡Œæ—¶é”™è¯¯ã€ä»£ç ç»´æŠ¤å›°éš¾ç­‰ã€‚

Driftï¼ˆå‰èº«ä¸ºMoorï¼‰æ˜¯Flutterç”Ÿæ€ä¸­çš„ç°ä»£æ•°æ®åº“è§£å†³æ–¹æ¡ˆï¼Œå®ƒåœ¨SQLiteä¹‹ä¸Šæä¾›äº†ç±»å‹å®‰å…¨çš„APIã€å¼ºå¤§çš„ä»£ç ç”ŸæˆåŠŸèƒ½ã€ä»¥åŠå‡ºè‰²çš„å¼€å‘ä½“éªŒã€‚åœ¨BeeCounté¡¹ç›®ä¸­ï¼ŒDriftä¸ä»…å¸®æˆ‘ä»¬æ„å»ºäº†ç¨³å›ºçš„æ•°æ®å±‚ï¼Œè¿˜æä¾›äº†ä¼˜ç§€çš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚

Driftæ ¸å¿ƒç‰¹æ€§
---------

### ç±»å‹å®‰å…¨çš„æ•°æ®åº“æ“ä½œ

ä¼ ç»ŸSQLiteæ“ä½œéœ€è¦æ‰‹å†™SQLå­—ç¬¦ä¸²ï¼Œå®¹æ˜“å‡ºé”™ä¸”éš¾ä»¥ç»´æŠ¤ï¼š

    // ä¼ ç»Ÿæ–¹å¼ - å®¹æ˜“å‡ºé”™
    final result = await db.rawQuery(
      'SELECT * FROM transactions WHERE ledger_id = ? ORDER BY happened_at DESC',
      [ledgerId]
    );
    

Driftæä¾›å®Œå…¨ç±»å‹å®‰å…¨çš„æ“ä½œï¼š

    // Driftæ–¹å¼ - ç±»å‹å®‰å…¨
    Stream<List<Transaction>> recentTransactions({required int ledgerId, int limit = 20}) {
      return (select(transactions)
            ..where((t) => t.ledgerId.equals(ledgerId))
            ..orderBy([(t) => OrderingTerm(
                expression: t.happenedAt, 
                mode: OrderingMode.desc)])
            ..limit(limit))
          .watch();
    }
    

### å¼ºå¤§çš„ä»£ç ç”Ÿæˆ

DriftåŸºäºä»£ç ç”Ÿæˆï¼Œä»è¡¨å®šä¹‰è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰ç›¸å…³çš„æ•°æ®ç±»å’Œæ“ä½œæ–¹æ³•ï¼Œå¤§å¤§å‡å°‘äº†æ ·æ¿ä»£ç ã€‚

æ•°æ®åº“æ¶æ„è®¾è®¡
-------

### è¡¨ç»“æ„å®šä¹‰

åœ¨BeeCountä¸­ï¼Œæˆ‘ä»¬è®¾è®¡äº†æ¸…æ™°çš„æ•°æ®æ¨¡å‹æ¥æ”¯æŒå¤å¼è®°è´¦ï¼š

    // è´¦æœ¬è¡¨ - æ”¯æŒå¤šè´¦æœ¬ç®¡ç†
    class Ledgers extends Table {
      IntColumn get id => integer().autoIncrement()();
      TextColumn get name => text()();
      TextColumn get currency => text().withDefault(const Constant('CNY'))();
      DateTimeColumn get createdAt => dateTime().withDefault(currentDateAndTime)();
    }
    
    // è´¦æˆ·è¡¨ - ç°é‡‘ã€é“¶è¡Œå¡ã€ä¿¡ç”¨å¡ç­‰
    class Accounts extends Table {
      IntColumn get id => integer().autoIncrement()();
      IntColumn get ledgerId => integer()();
      TextColumn get name => text()();
      TextColumn get type => text().withDefault(const Constant('cash'))();
    }
    
    // åˆ†ç±»è¡¨ - æ”¶å…¥/æ”¯å‡ºåˆ†ç±»
    class Categories extends Table {
      IntColumn get id => integer().autoIncrement()();
      TextColumn get name => text()();
      TextColumn get kind => text()(); // expense / income
      TextColumn get icon => text().nullable()();
    }
    
    // äº¤æ˜“è®°å½•è¡¨ - æ ¸å¿ƒä¸šåŠ¡æ•°æ®
    class Transactions extends Table {
      IntColumn get id => integer().autoIncrement()();
      IntColumn get ledgerId => integer()();
      TextColumn get type => text()(); // expense / income / transfer
      RealColumn get amount => real()();
      IntColumn get categoryId => integer().nullable()();
      IntColumn get accountId => integer().nullable()();
      IntColumn get toAccountId => integer().nullable()();
      DateTimeColumn get happenedAt => dateTime().withDefault(currentDateAndTime)();
      TextColumn get note => text().nullable()();
    }
    

**è®¾è®¡äº®ç‚¹**ï¼š

*   **å¤šè´¦æœ¬æ”¯æŒ**ï¼šé€šè¿‡ledgerIdå®ç°æ•°æ®éš”ç¦»
*   **çµæ´»çš„äº¤æ˜“ç±»å‹**ï¼šæ”¯æŒæ”¯å‡ºã€æ”¶å…¥ã€è½¬è´¦ä¸‰ç§ç±»å‹
*   **å¯é€‰å­—æ®µ**ï¼šä½¿ç”¨nullable()æ”¯æŒå¯é€‰æ•°æ®
*   **é»˜è®¤å€¼**ï¼šåˆç†è®¾ç½®é»˜è®¤å€¼å‡å°‘é”™è¯¯

### æ•°æ®åº“ç±»å®šä¹‰

    @DriftDatabase(tables: [Ledgers, Accounts, Categories, Transactions])
    class BeeDatabase extends _$BeeDatabase {
      BeeDatabase() : super(_openConnection());
    
      @override
      int get schemaVersion => 1;
      
      // æ•°æ®åº“è¿æ¥é…ç½®
      static LazyDatabase _openConnection() {
        return LazyDatabase(() async {
          final dir = await getApplicationDocumentsDirectory();
          final file = File(p.join(dir.path, 'beecount.sqlite'));
          return NativeDatabase.createInBackground(file);
        });
      }
    }
    

æ•°æ®åˆå§‹åŒ–ä¸ç§å­æ•°æ®
----------

### æ™ºèƒ½ç§å­æ•°æ®ç®¡ç†

BeeCountå®ç°äº†æ™ºèƒ½çš„ç§å­æ•°æ®ç®¡ç†ï¼Œç¡®ä¿ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨æ—¶æœ‰åˆç†çš„é»˜è®¤é…ç½®ï¼š

    Future<void> ensureSeed() async {
      // ç¡®ä¿æœ‰é»˜è®¤è´¦æœ¬å’Œè´¦æˆ·
      final count = await (select(ledgers).get()).then((v) => v.length);
      if (count == 0) {
        final ledgerId = await into(ledgers)
            .insert(LedgersCompanion.insert(name: 'é»˜è®¤è´¦æœ¬'));
        await into(accounts)
            .insert(AccountsCompanion.insert(ledgerId: ledgerId, name: 'ç°é‡‘'));
      }
      
      // ç¡®ä¿æœ‰å®Œæ•´çš„åˆ†ç±»ä½“ç³»
      await _ensureCategories();
    }
    

### åˆ†ç±»ä½“ç³»è®¾è®¡

    Future<void> _ensureCategories() async {
      const expense = 'expense';
      const income = 'income';
      
      final defaultExpense = <String>[
        'é¤é¥®', 'äº¤é€š', 'è´­ç‰©', 'å¨±ä¹', 'å±…å®¶', 'é€šè®¯',
        'æ°´ç”µ', 'ä½æˆ¿', 'åŒ»ç–—', 'æ•™è‚²', 'å® ç‰©', 'è¿åŠ¨'
        // ... æ›´å¤šåˆ†ç±»
      ];
      
      final defaultIncome = <String>[
        'å·¥èµ„', 'ç†è´¢', 'çº¢åŒ…', 'å¥–é‡‘', 'æŠ¥é”€', 'å…¼èŒ'
        // ... æ›´å¤šåˆ†ç±»
      ];
      
      // æ‰¹é‡æ’å…¥ï¼Œä½†é¿å…é‡å¤
      for (final name in defaultExpense) {
        final exists = await (select(categories)
              ..where((c) => c.name.equals(name) & c.kind.equals(expense)))
            .getSingleOrNull();
        if (exists == null) {
          await into(categories).insert(CategoriesCompanion.insert(
              name: name, kind: expense, icon: const Value(null)));
        }
      }
    }
    

Repositoryæ¨¡å¼å®ç°
--------------

### æ•°æ®è®¿é—®å±‚è®¾è®¡

BeeCounté‡‡ç”¨Repositoryæ¨¡å¼å°è£…æ•°æ®åº“æ“ä½œï¼Œæä¾›æ¸…æ™°çš„ä¸šåŠ¡æ¥å£ï¼š

    class BeeRepository {
      final BeeDatabase db;
      BeeRepository(this.db);
    
      // è·å–æœ€è¿‘äº¤æ˜“è®°å½• - æ”¯æŒæµå¼æ›´æ–°
      Stream<List<Transaction>> recentTransactions({
        required int ledgerId, 
        int limit = 20
      }) {
        return (db.select(db.transactions)
              ..where((t) => t.ledgerId.equals(ledgerId))
              ..orderBy([(t) => OrderingTerm(
                  expression: t.happenedAt, 
                  mode: OrderingMode.desc)])
              ..limit(limit))
            .watch();
      }
    
      // é«˜æ€§èƒ½è®¡æ•°æŸ¥è¯¢
      Future<int> ledgerCount() async {
        final row = await db.customSelect(
            'SELECT COUNT(*) AS c FROM ledgers',
            readsFrom: {db.ledgers}
        ).getSingle();
        return _parseInt(row.data['c']);
      }
    
      // å¤åˆç»Ÿè®¡æŸ¥è¯¢
      Future<({int dayCount, int txCount})> countsForLedger({
        required int ledgerId
      }) async {
        final txRow = await db.customSelect(
            'SELECT COUNT(*) AS c FROM transactions WHERE ledger_id = ?1',
            variables: [Variable.withInt(ledgerId)],
            readsFrom: {db.transactions}
        ).getSingle();
        
        final dayRow = await db.customSelect("""
          SELECT COUNT(DISTINCT strftime('%Y-%m-%d', happened_at, 'unixepoch', 'localtime')) AS c
          FROM transactions WHERE ledger_id = ?1
          """,
            variables: [Variable.withInt(ledgerId)],
            readsFrom: {db.transactions}
        ).getSingle();
    
        return (
          dayCount: _parseInt(dayRow.data['c']),
          txCount: _parseInt(txRow.data['c'])
        );
      }
    }
    

**Repositoryä¼˜åŠ¿**ï¼š

*   **ä¸šåŠ¡è¯­ä¹‰æ¸…æ™°**ï¼šæ–¹æ³•åç›´æ¥åæ˜ ä¸šåŠ¡éœ€æ±‚
*   **ç±»å‹å®‰å…¨**ï¼šåˆ©ç”¨Dartç±»å‹ç³»ç»Ÿé¿å…é”™è¯¯
*   **æ€§èƒ½ä¼˜åŒ–**ï¼šé’ˆå¯¹ä¸åŒåœºæ™¯é€‰æ‹©æœ€ä½³æŸ¥è¯¢æ–¹å¼
*   **å¯æµ‹è¯•æ€§**ï¼šä¾¿äºå•å…ƒæµ‹è¯•å’ŒMock

é«˜çº§æŸ¥è¯¢æŠ€å·§
------

### æµå¼æŸ¥è¯¢çš„å¨åŠ›

Driftçš„watch()æ–¹æ³•æä¾›äº†å“åº”å¼çš„æ•°æ®æµï¼Œå½“åº•å±‚æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°UIï¼š

    // åœ¨UIä¸­ä½¿ç”¨StreamBuilder
    StreamBuilder<List<Transaction>>(
      stream: repository.recentTransactions(ledgerId: currentLedgerId),
      builder: (context, snapshot) {
        if (snapshot.hasData) {
          return TransactionList(transactions: snapshot.data!);
        }
        return LoadingWidget();
      },
    )
    

### è‡ªå®šä¹‰SQLçš„åˆç†ä½¿ç”¨

è™½ç„¶Driftæä¾›äº†ä¸°å¯Œçš„æŸ¥è¯¢APIï¼Œä½†åœ¨ç‰¹å®šåœºæ™¯ä¸‹ï¼Œè‡ªå®šä¹‰SQLä»æ˜¯æœ€ä½³é€‰æ‹©ï¼š

    // å¤æ‚çš„æ—¥æœŸåˆ†ç»„ç»Ÿè®¡
    Future<List<DailySummary>> getDailySummary({
      required int ledgerId,
      required DateTimeRange range,
    }) async {
      final rows = await db.customSelect("""
        SELECT 
          strftime('%Y-%m-%d', happened_at, 'unixepoch', 'localtime') as date,
          SUM(CASE WHEN type = 'expense' THEN amount ELSE 0 END) as expense,
          SUM(CASE WHEN type = 'income' THEN amount ELSE 0 END) as income,
          COUNT(*) as count
        FROM transactions 
        WHERE ledger_id = ?1 
          AND happened_at BETWEEN ?2 AND ?3
        GROUP BY strftime('%Y-%m-%d', happened_at, 'unixepoch', 'localtime')
        ORDER BY date DESC
        """,
        variables: [
          Variable.withInt(ledgerId),
          Variable.withDateTime(range.start),
          Variable.withDateTime(range.end),
        ],
        readsFrom: {db.transactions},
      ).get();
      
      return rows.map((row) => DailySummary.fromRow(row)).toList();
    }
    

æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
------

### ç´¢å¼•ä¼˜åŒ–

è™½ç„¶Driftä»£ç ä¸­æ²¡æœ‰ç›´æ¥çœ‹åˆ°ç´¢å¼•å®šä¹‰ï¼Œä½†åœ¨å®é™…é¡¹ç›®ä¸­åº”è¯¥è€ƒè™‘å…³é”®æŸ¥è¯¢çš„ç´¢å¼•ï¼š

    // åœ¨æ•°æ®åº“åˆå§‹åŒ–æ—¶åˆ›å»ºç´¢å¼•
    @override
    MigrationStrategy get migration => MigrationStrategy(
      onCreate: (Migrator m) async {
        await m.createAll();
        // ä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ›å»ºç´¢å¼•
        await customStatement('''
          CREATE INDEX IF NOT EXISTS idx_transactions_ledger_time 
          ON transactions(ledger_id, happened_at DESC)
        ''');
        await customStatement('''
          CREATE INDEX IF NOT EXISTS idx_transactions_category 
          ON transactions(category_id) WHERE category_id IS NOT NULL
        ''');
      },
    );
    

### æ‰¹é‡æ“ä½œä¼˜åŒ–

å¯¹äºå¤§é‡æ•°æ®æ“ä½œï¼Œä½¿ç”¨äº‹åŠ¡å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ï¼š

    Future<void> batchInsertTransactions(List<TransactionData> transactions) async {
      await db.transaction(() async {
        for (final transaction in transactions) {
          await db.into(db.transactions).insert(transaction.toCompanion());
        }
      });
    }
    

æ•°æ®åº“è¿ç§»ç­–ç•¥
-------

### è½»é‡çº§è¿ç§»

BeeCountå®ç°äº†è½»é‡çº§çš„æ•°æ®è¿ç§»ç­–ç•¥ï¼Œåœ¨ensureSeedä¸­å¤„ç†å†å²æ•°æ®å…¼å®¹ï¼š

    // è½»é‡è¿ç§»ï¼šå°†å†å²"æˆ¿ç§Ÿ"é‡å‘½åä¸º"ä½æˆ¿"
    try {
      final old = await (select(categories)
            ..where((c) => c.name.equals('æˆ¿ç§Ÿ') & c.kind.equals(expense)))
          .getSingleOrNull();
      final hasNew = await (select(categories)
            ..where((c) => c.name.equals('ä½æˆ¿') & c.kind.equals(expense)))
          .getSingleOrNull();
      if (old != null && hasNew == null) {
        await (update(categories)..where((c) => c.id.equals(old.id)))
            .write(CategoriesCompanion(name: const Value('ä½æˆ¿')));
      }
    } catch (_) {}
    

### ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

    class BeeDatabase extends _$BeeDatabase {
      @override
      int get schemaVersion => 2; // é€’å¢ç‰ˆæœ¬å·
    
      @override
      MigrationStrategy get migration => MigrationStrategy(
        onUpgrade: (migrator, from, to) async {
          if (from < 2) {
            // æ‰§è¡Œä»ç‰ˆæœ¬1åˆ°ç‰ˆæœ¬2çš„è¿ç§»
            await migrator.addColumn(transactions, transactions.note);
          }
        },
      );
    }
    

é”™è¯¯å¤„ç†ä¸è°ƒè¯•
-------

### å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ

    Future<Transaction?> getTransactionSafe(int id) async {
      try {
        return await (select(transactions)
              ..where((t) => t.id.equals(id)))
            .getSingleOrNull();
      } catch (e, stackTrace) {
        logger.error('Failed to get transaction $id', e, stackTrace);
        return null;
      }
    }
    

### è°ƒè¯•æŠ€å·§

    // å¼€å‘ç¯å¢ƒå¯ç”¨SQLæ—¥å¿—
    BeeDatabase() : super(_openConnection()) {
      if (kDebugMode) {
        // å¯ç”¨æŸ¥è¯¢æ—¥å¿—
        driftRuntimeOptions.dontWarnAboutMultipleDatabases = true;
      }
    }
    

ä¸Riverpodé›†æˆ
-----------

### æ•°æ®åº“Provideré…ç½®

    // æ•°æ®åº“å•ä¾‹Provider
    final databaseProvider = Provider<BeeDatabase>((ref) {
      final db = BeeDatabase();
      db.ensureSeed(); // å¼‚æ­¥åˆå§‹åŒ–ç§å­æ•°æ®
      ref.onDispose(() => db.close()); // è‡ªåŠ¨èµ„æºæ¸…ç†
      return db;
    });
    
    // Repository Provider
    final repositoryProvider = Provider<BeeRepository>((ref) {
      final db = ref.watch(databaseProvider);
      return BeeRepository(db);
    });
    
    // ä¸šåŠ¡æ•°æ®Provider
    final recentTransactionsProvider = StreamProvider.family<List<Transaction>, int>(
      (ref, ledgerId) {
        final repo = ref.watch(repositoryProvider);
        return repo.recentTransactions(ledgerId: ledgerId);
      },
    );
    

æœ€ä½³å®è·µæ€»ç»“
------

### 1\. è¡¨è®¾è®¡åŸåˆ™

*   **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªè¡¨åªè´Ÿè´£ä¸€ä¸ªä¸šåŠ¡å®ä½“
*   **åˆç†èŒƒå¼**ï¼šåœ¨æ€§èƒ½å’Œè§„èŒƒä¹‹é—´æ‰¾åˆ°å¹³è¡¡
*   **å¤–é”®çº¦æŸ**ï¼šé€šè¿‡ä»£ç é€»è¾‘è€Œéæ•°æ®åº“çº¦æŸç®¡ç†å…³ç³»

### 2\. æŸ¥è¯¢ä¼˜åŒ–

*   **é€‰æ‹©åˆé€‚çš„æŸ¥è¯¢æ–¹å¼**ï¼šç®€å•æŸ¥è¯¢ç”¨ç”Ÿæˆçš„APIï¼Œå¤æ‚æŸ¥è¯¢ç”¨è‡ªå®šä¹‰SQL
*   **ä½¿ç”¨æµå¼æŸ¥è¯¢**ï¼šåˆ©ç”¨watch()å®ç°å“åº”å¼UI
*   **é¿å…N+1é—®é¢˜**ï¼šåˆç†ä½¿ç”¨JOINå’Œæ‰¹é‡æŸ¥è¯¢

### 3\. æ•°æ®ä¸€è‡´æ€§

*   **äº‹åŠ¡ä½¿ç”¨**ï¼šç¡®ä¿å¤æ‚æ“ä½œçš„åŸå­æ€§
*   **é”™è¯¯å¤„ç†**ï¼šä¼˜é›…å¤„ç†æ•°æ®åº“å¼‚å¸¸
*   **æ•°æ®éªŒè¯**ï¼šåœ¨åº”ç”¨å±‚è¿›è¡Œå……åˆ†çš„æ•°æ®æ ¡éªŒ

### 4\. æ€§èƒ½è€ƒè™‘

*   **ç´¢å¼•è®¾è®¡**ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ›å»ºé€‚å½“ç´¢å¼•
*   **åˆ†é¡µåŠ è½½**ï¼šå¤§æ•°æ®é›†ä½¿ç”¨limitå’Œoffset
*   **è¿æ¥æ± ç®¡ç†**ï¼šåˆç†é…ç½®æ•°æ®åº“è¿æ¥

å®é™…åº”ç”¨æ•ˆæœ
------

åœ¨BeeCounté¡¹ç›®ä¸­ï¼ŒDriftæ•°æ®åº“å±‚å¸¦æ¥äº†æ˜¾è‘—çš„æ”¶ç›Šï¼š

1.  **å¼€å‘æ•ˆç‡**ï¼šç±»å‹å®‰å…¨å‡å°‘äº†90%çš„æ•°æ®åº“ç›¸å…³Bug
2.  **æ€§èƒ½è¡¨ç°**ï¼šæŸ¥è¯¢å“åº”æ—¶é—´å¹³å‡æå‡50%
3.  **ç»´æŠ¤æˆæœ¬**ï¼šä»£ç ç”Ÿæˆå‡å°‘äº†70%çš„æ ·æ¿ä»£ç 
4.  **ç”¨æˆ·ä½“éªŒ**ï¼šæµå¼æŸ¥è¯¢å®ç°äº†å®æ—¶UIæ›´æ–°

ç»“è¯­
--

Driftä½œä¸ºFlutterç”Ÿæ€ä¸­çš„ç°ä»£æ•°æ®åº“è§£å†³æ–¹æ¡ˆï¼Œä¸ä»…è§£å†³äº†ä¼ ç»ŸSQLiteå¼€å‘ä¸­çš„ç—›ç‚¹ï¼Œè¿˜æä¾›äº†ä¼˜ç§€çš„å¼€å‘ä½“éªŒå’Œè¿è¡Œæ€§èƒ½ã€‚é€šè¿‡åˆç†çš„æ¶æ„è®¾è®¡ã€Repositoryæ¨¡å¼å°è£…å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºæ—¢ç¨³å®šåˆé«˜æ•ˆçš„æ•°æ®å±‚ã€‚

BeeCountçš„å®è·µè¯æ˜ï¼ŒDriftå®Œå…¨èƒ½å¤Ÿæ»¡è¶³å¤æ‚åº”ç”¨çš„æ•°æ®å­˜å‚¨éœ€æ±‚ï¼Œæ˜¯Flutterå¼€å‘è€…çš„ä¼˜ç§€é€‰æ‹©ã€‚å…³é”®åœ¨äºç†è§£å…¶è®¾è®¡ç†å¿µï¼Œåˆç†è¿ç”¨å„ç§ç‰¹æ€§ï¼Œæ„å»ºå‡ºé€‚åˆä¸šåŠ¡éœ€æ±‚çš„æ•°æ®æ¶æ„ã€‚

å…³äºBeeCounté¡¹ç›®
------------

### é¡¹ç›®ç‰¹è‰²

*   ğŸ¯ **ç°ä»£æ¶æ„**: åŸºäºRiverpod + Drift + Supabaseçš„ç°ä»£æŠ€æœ¯æ ˆ
*   ğŸ“± **è·¨å¹³å°æ”¯æŒ**: iOSã€AndroidåŒå¹³å°åŸç”Ÿä½“éªŒ
*   ğŸ”„ **äº‘ç«¯åŒæ­¥**: æ”¯æŒå¤šè®¾å¤‡æ•°æ®å®æ—¶åŒæ­¥
*   ğŸ¨ **ä¸ªæ€§åŒ–å®šåˆ¶**: Material Design 3ä¸»é¢˜ç³»ç»Ÿ
*   ğŸ“Š **æ•°æ®åˆ†æ**: å®Œæ•´çš„è´¢åŠ¡æ•°æ®å¯è§†åŒ–
*   ğŸŒ **å›½é™…åŒ–**: å¤šè¯­è¨€æœ¬åœ°åŒ–æ”¯æŒ

### æŠ€æœ¯æ ˆä¸€è§ˆ

*   **æ¡†æ¶**: Flutter 3.6.1+ / Dart 3.6.1+
*   **çŠ¶æ€ç®¡ç†**: Flutter Riverpod 2.5.1
*   **æ•°æ®åº“**: Drift (SQLite) 2.20.2
*   **äº‘æœåŠ¡**: Supabase 2.5.6
*   **å›¾è¡¨**: FL Chart 0.68.0
*   **CI/CD**: GitHub Actions

### å¼€æºä¿¡æ¯

BeeCountæ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºçš„é¡¹ç›®ï¼Œæ¬¢è¿å¼€å‘è€…å‚ä¸è´¡çŒ®ï¼š

*   **é¡¹ç›®ä¸»é¡µ**: [https://github.com/TNT-Likely/BeeCount](https://github.com/TNT-Likely/BeeCount)
*   **å¼€å‘è€…ä¸»é¡µ**: [https://github.com/TNT-Likely](https://github.com/TNT-Likely)
*   **å‘å¸ƒä¸‹è½½**: [GitHub Releases](https://github.com/TNT-Likely/BeeCount/releases)

å‚è€ƒèµ„æº
----

### å®˜æ–¹æ–‡æ¡£

*   [Driftå®˜æ–¹æ–‡æ¡£](https://drift.simonbinder.eu/) - Driftå®Œæ•´ä½¿ç”¨æŒ‡å—
*   [SQLiteå®˜æ–¹æ–‡æ¡£](https://sqlite.org/docs.html) - åº•å±‚SQLiteå‚è€ƒ

### å­¦ä¹ èµ„æº

*   [Driftå…¥é—¨æ•™ç¨‹](https://drift.simonbinder.eu/getting-started/) - å®˜æ–¹å…¥é—¨æŒ‡å—
*   [Flutteræ•°æ®æŒä¹…åŒ–æŒ‡å—](https://flutter.dev/development/data-and-backend/persistence) - Flutterå®˜æ–¹æŒä¹…åŒ–æ–¹æ¡ˆå¯¹æ¯”

* * *

_æœ¬æ–‡æ˜¯BeeCountæŠ€æœ¯æ–‡ç« ç³»åˆ—çš„ç¬¬2ç¯‡ï¼Œåç»­å°†æ·±å…¥æ¢è®¨äº‘åŒæ­¥æ¶æ„ã€ä¸»é¢˜ç³»ç»Ÿç­‰è¯é¢˜ã€‚å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©ï¼Œæ¬¢è¿å…³æ³¨é¡¹ç›®å¹¶ç»™ä¸ªStarï¼_