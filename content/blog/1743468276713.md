---
layout: post
title: 'ä»é›¶åˆ›å»ºnpmä¾èµ–ï¼Œåªéœ€æ‰§è¡Œä¸€æ¡å‘½ä»¤'
date: "2025-04-01T00:44:36Z"
---
ä»é›¶åˆ›å»ºnpmä¾èµ–ï¼Œåªéœ€æ‰§è¡Œä¸€æ¡å‘½ä»¤
==================

ç”±æ¥
--

æœ€è¿‘åœ¨å¼„æ–°çš„npmä¾èµ–ï¼Œä½†æ˜¯å‘ç°æ²¡æœ‰éƒ½**ä»å¤´åˆ›å»ºé¡¹ç›®**å®å±æœ‰ç‚¹å„¿**éº»çƒ¦**ï¼Œç„¶åæˆ‘æ‰¾äº†ä¹‹å‰å¼€å‘çš„ä¾èµ–ï¼Œå°†å¤šä½™ä»£ç åˆ é™¤äº†ä½œä¸ºåˆå§‹åŒ–çš„é¡¹ç›®ã€‚äºæ˜¯~ä¸ºä»€ä¹ˆä¸å¼„ä¸ª**æ¨¡ç‰ˆ**ï¼Œæ¯æ¬¡åªéœ€è¦**åˆå§‹åŒ–æ¨¡ç‰ˆ**å³å¯ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ä¸ªæ¨¡ç‰ˆï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘è¿˜**å‘å¸ƒåˆ°äº†npm**ä¸Šï¼Œåªéœ€è¦**ç®€å•çš„æ‰§è¡Œå‘½ä»¤**å³å¯åˆå§‹åŒ–npmä¾èµ–å¼€å‘çš„é¡¹ç›®ã€‚

ç‰¹æ€§
--

*   ğŸš€ **å¿«é€Ÿåˆ›å»º**: ä¸€è¡Œå‘½ä»¤å³å¯åˆ›å»ºå®Œæ•´çš„TypeScript NPMåº“é¡¹ç›®
*   ğŸ’ª **TypeScript**: å†…ç½®TypeScriptæ”¯æŒä¸ç±»å‹å£°æ˜ç”Ÿæˆ
*   ğŸ“¦ **å¤šæ ¼å¼è¾“å‡º**: æ”¯æŒCommonJSã€ES Moduleã€UMDå’ŒIIFEæ ¼å¼
*   ğŸ¨ **CSS/SCSSæ”¯æŒ**: å¯ä»¥å°†æ ·å¼æ–‡ä»¶æ‰“åŒ…åˆ°JSä¸­æˆ–æå–ä¸ºå•ç‹¬æ–‡ä»¶
*   ğŸ§ª **æµ‹è¯•ç¯å¢ƒ**: å†…ç½®Node.jså’Œæµè§ˆå™¨æµ‹è¯•ç¯å¢ƒ
*   ğŸ”„ **çµæ´»é…ç½®**: æ¨¡å—åŒ–ä¸”æ˜“äºè‡ªå®šä¹‰çš„æ„å»ºé…ç½®

å¿«é€Ÿå¼€å§‹
----

æ— éœ€å®‰è£…ï¼Œç›´æ¥è¿è¡Œ:

    # ä½¿ç”¨npxï¼ˆæ¨èï¼‰
    npx create-ts-npm my-lib
    
    # æˆ–ä½¿ç”¨npm init
    npm init ts-npm my-lib
    
    # æˆ–ä½¿ç”¨yarn create
    yarn create ts-npm my-lib
    

ç„¶åæŒ‰ç…§æç¤ºæ“ä½œï¼Œè¾“å…¥åŒ…åç§°ã€æè¿°å’Œä½œè€…ä¿¡æ¯ã€‚

æ‰‹åŠ¨å®‰è£…
----

å¦‚æœä½ éœ€è¦å¤šæ¬¡ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å…¨å±€å®‰è£…:

    # å…¨å±€å®‰è£…
    npm install -g create-ts-npm
    
    # ç„¶åä½¿ç”¨
    create-ts-npm my-lib
    

ç”Ÿæˆçš„é¡¹ç›®å†…å®¹
-------

ç”Ÿæˆçš„é¡¹ç›®åŒ…å«ä»¥ä¸‹å†…å®¹:

    .
    â”œâ”€â”€ src/               # æºä»£ç ç›®å½•
    â”‚   â”œâ”€â”€ index.ts       # ä¸»å…¥å£æ–‡ä»¶
    â”‚   â””â”€â”€ styles/        # æ ·å¼æ–‡ä»¶
    â”œâ”€â”€ build/             # æ„å»ºé…ç½®
    â”œâ”€â”€ dist/              # æ‰“åŒ…è¾“å‡ºç›®å½•ï¼ˆæ„å»ºåç”Ÿæˆï¼‰
    â”œâ”€â”€ types/             # ç±»å‹å£°æ˜æ–‡ä»¶ï¼ˆæ„å»ºåç”Ÿæˆï¼‰
    â”œâ”€â”€ test-project/      # æµ‹è¯•é¡¹ç›®
    â”œâ”€â”€ tsconfig.json      # TypeScripté…ç½®
    â””â”€â”€ rollup.config.js   # Rollupé…ç½®
    

ç”Ÿæˆçš„é¡¹ç›®æ„å»ºé…ç½®è¯´æ˜
-----------

æœ¬æ¨¡æ¿é‡‡ç”¨æ¨¡å—åŒ–çš„æ„å»ºé…ç½®ï¼Œä¸»è¦é…ç½®æ–‡ä»¶å·²è¢«æ‹†åˆ†åˆ°`build/`ç›®å½•ä¸‹ï¼Œä½¿é…ç½®æ›´æ¸…æ™°ã€æ˜“äºç»´æŠ¤ã€‚

### é…ç½®æ–‡ä»¶ç»“æ„

*   `rollup.config.js`: ä¸»é…ç½®æ–‡ä»¶å…¥å£ç‚¹ï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹
*   `build/config.js`: é›†ä¸­ç®¡ç†æ‰€æœ‰å¯é…ç½®é€‰é¡¹çš„åœ°æ–¹ï¼Œ**ä¿®æ”¹æ­¤æ–‡ä»¶æ¥è‡ªå®šä¹‰é…ç½®**
*   `build/create-config.js`: åˆ›å»ºRollupé…ç½®å¯¹è±¡çš„å‡½æ•°
*   `build/plugins/`: åŒ…å«å„ç§æ’ä»¶é…ç½®çš„ç›®å½•

### ä¸»è¦é…ç½®é¡¹

è¦è‡ªå®šä¹‰æ„å»ºé…ç½®ï¼Œåªéœ€ç¼–è¾‘`build/config.js`æ–‡ä»¶ä¸­çš„é€‰é¡¹ï¼š

    // è¦ç”Ÿæˆçš„è¾“å‡ºæ ¼å¼ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æˆ–åˆ é™¤
    // å¯é€‰å€¼: 'cjs', 'es', 'umd', 'iife'
    exports.OUTPUT_FORMATS = ['cjs', 'es'];
    
    // æ˜¯å¦ç”Ÿæˆç±»å‹å£°æ˜æ–‡ä»¶
    exports.GENERATE_TYPES = true;
    
    // UMD/IIFEæ ¼å¼ä¸‹çš„å…¨å±€å˜é‡å
    exports.GLOBAL_NAME = pkg.name.replace(/-([a-z])/g, (_, letter) => letter.toUpperCase());
    
    // å¤–éƒ¨ä¾èµ–ï¼Œè¿™äº›ä¾èµ–ä¸ä¼šè¢«æ‰“åŒ…
    exports.EXTERNAL = [];
    
    // å…¥å£æ–‡ä»¶è·¯å¾„
    exports.INPUT_FILE = './src/index.ts';
    
    // CSS/SCSSé…ç½®
    exports.CSS_CONFIG = {
        // æ˜¯å¦å¯ç”¨CSS/SCSSå¤„ç†
        enabled: true,
        // æ˜¯å¦å°†CSSæå–ä¸ºå•ç‹¬çš„æ–‡ä»¶ï¼Œfalseè¡¨ç¤ºæ³¨å…¥åˆ°JSä¸­
        extract: false,
        // æ˜¯å¦å‹ç¼©CSS
        minimize: true,
        // CSSæ¨¡å—åŒ–ï¼Œè®¾ä¸ºtrueä¼šå°†ç±»åè½¬æ¢ä¸ºå“ˆå¸Œå€¼ï¼Œé¿å…æ ·å¼å†²çª
        modules: false,
        // æ˜¯å¦ä½¿ç”¨Sassé¢„å¤„ç†å™¨
        sass: true,
        // è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€
        autoPrefix: true,
        // æå–çš„CSSæ–‡ä»¶å
        fileName: 'styles.css'
    };
    

### è¾“å‡ºæ ¼å¼åŠå…¶é€‚ç”¨åœºæ™¯

æ ¼å¼

æ–‡ä»¶æ‰©å±•å

é€‚ç”¨åœºæ™¯

å…¨å±€å˜é‡

CJS (CommonJS)

`.js`

Node.jsç¯å¢ƒã€webpackç­‰æ‰“åŒ…å·¥å…·

ä¸é€‚ç”¨

ESM (ES Module)

`.mjs`

ç°ä»£æµè§ˆå™¨ã€æ”¯æŒESæ¨¡å—çš„æ‰“åŒ…å·¥å…·ã€æ”¯æŒtree-shaking

ä¸é€‚ç”¨

UMD (Universal)

`.umd.js`

é€šç”¨æ ¼å¼ï¼ŒåŒæ—¶æ”¯æŒNode.jsã€AMDå’Œæµè§ˆå™¨

éœ€è¦å®šä¹‰

IIFE (è‡ªæ‰§è¡Œå‡½æ•°)

`.min.js`

ç›´æ¥åœ¨æµè§ˆå™¨ä¸­é€šè¿‡scriptæ ‡ç­¾ä½¿ç”¨

éœ€è¦å®šä¹‰

### å¸¸è§é…ç½®ç¤ºä¾‹

1.  **æ·»åŠ UMDå’ŒIIFEæ ¼å¼**:
    
        // build/config.js
        exports.OUTPUT_FORMATS = ['cjs', 'es', 'umd', 'iife'];
        
    
2.  **é…ç½®å¤–éƒ¨ä¾èµ–**:
    
        // build/config.js
        exports.EXTERNAL = ['lodash', 'react', 'react-dom'];
        
    
3.  **æå–CSSä¸ºå•ç‹¬æ–‡ä»¶**:
    
        // build/config.js
        exports.CSS_CONFIG.extract = true;
        exports.CSS_CONFIG.fileName = 'your-style.css';
        
    
4.  **å¯ç”¨CSSæ¨¡å—åŒ–**:
    
        // build/config.js
        exports.CSS_CONFIG.modules = true;
        
    
5.  **ç¦ç”¨TypeScriptç±»å‹å£°æ˜ç”Ÿæˆ**:
    
        // build/config.js
        exports.GENERATE_TYPES = false;
        
    

### åœ¨é¡¹ç›®ä¸­ä½¿ç”¨CSS/SCSS

è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨CSSæˆ–SCSSæ–‡ä»¶ï¼Œåªéœ€è¦åœ¨TypeScriptæ–‡ä»¶ä¸­å¯¼å…¥å®ƒä»¬ï¼š

    // å¯¼å…¥CSSæ–‡ä»¶
    import './styles/style.css';
    
    // å¯¼å…¥SCSSæ–‡ä»¶
    import './styles/style.scss';
    

å¦‚æœå¯ç”¨äº†CSSæ¨¡å—åŒ–ï¼ˆ`CSS_CONFIG.modules = true`ï¼‰ï¼Œå¯ä»¥è¿™æ ·å¯¼å…¥å’Œä½¿ç”¨ï¼š

    // å¯¼å…¥CSSæ¨¡å—
    import styles from './styles/style.css';
    
    // ä½¿ç”¨CSSç±»
    element.className = styles.exampleClass;
    

ä½¿ç”¨ç”Ÿæˆçš„é¡¹ç›®
-------

ç”Ÿæˆé¡¹ç›®åï¼Œä½ å¯ä»¥:

    # å®‰è£…ä¾èµ–
    cd my-lib
    npm install
    
    # å¼€å‘æ¨¡å¼ï¼ˆæ„å»ºå¹¶åœ¨Node.jsä¸­æµ‹è¯•ï¼‰
    npm run dev
    
    # åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•
    npm run test:browser
    
    # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
    npm run build:pro
    
    # å‘å¸ƒåˆ°NPM
    npm run toPublish
    

æ›´å¤š
--

æ›´å¤šè¯´æ˜è§giteeï¼š[https://gitee.com/jl15988/npm-dependent-template](https://gitee.com/jl15988/npm-dependent-template)