---
layout: post
title: 'åšå®¢å›­å‡ºæµ·è®°-ç»„è£…é›†è£…ç®±ï¼šæ­å»º Kubernetes é›†ç¾¤'
date: "2025-09-13T00:37:05Z"
---
åšå®¢å›­å‡ºæµ·è®°-ç»„è£…é›†è£…ç®±ï¼šæ­å»º Kubernetes é›†ç¾¤
=============================

åœ¨å¼€ç¯‡ä¸­æˆ‘ä»¬å®£å¸ƒäº†åšå®¢å›­å‡ºæµ·è®¡åˆ’çš„å¯èˆªï¼Œå‡ºæµ·èˆªèˆ¹é€‰æ‹©äº†é˜¿é‡Œäº‘ã€‚ç¬¬ä¸€ä»¶å‡†å¤‡å·¥ä½œæ˜¯åœ¨èˆªèˆ¹ä¸Šç»„è£…é›†è£…ç®± â€”â€” æ­å»º Kubernetes é›†ç¾¤ã€‚å‡ºæµ·æ ¹æ®åœ°é€‰åœ¨äº†é˜¿é‡Œäº‘æ–°åŠ å¡æœºæˆ¿ï¼ŒKubernetes é›†ç¾¤ç”¨é˜¿é‡Œäº‘ ECS è‡ªå·±æ­å»ºï¼Œæ²¡æœ‰ä½¿ç”¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ ACKã€‚é¦–å…ˆè´­ä¹°ä¸€å° ECS ç”¨äºéƒ¨ç½² Control Plane èŠ‚ç‚¹ï¼ŒControl Plane æ˜¯æŒ‡æŒ¥åè°ƒæ§åˆ¶ä¸­å¿ƒï¼Œä¸å¹²å…·ä½“æ´»ï¼Œæ‰€ä»¥ä¸éœ€è¦å¾ˆé«˜çš„é…ç½®

![Benefits-of-Using-Kubernetes-810x506](https://img2024.cnblogs.com/blog/35695/202509/35695-20250912095708546-103627121.jpg)

åœ¨å¼€ç¯‡ä¸­æˆ‘ä»¬å®£å¸ƒäº†åšå®¢å›­å‡ºæµ·è®¡åˆ’çš„[å¯èˆª](https://www.cnblogs.com/cmt/p/19033255)ï¼Œå‡ºæµ·èˆªèˆ¹é€‰æ‹©äº†é˜¿é‡Œäº‘ã€‚

ç¬¬ä¸€ä»¶å‡†å¤‡å·¥ä½œæ˜¯åœ¨èˆªèˆ¹ä¸Šç»„è£…é›†è£…ç®± â€”â€” æ­å»º Kubernetes é›†ç¾¤ã€‚

å‡ºæµ·æ ¹æ®åœ°é€‰åœ¨äº†é˜¿é‡Œäº‘æ–°åŠ å¡æœºæˆ¿ï¼ŒKubernetes é›†ç¾¤ç”¨é˜¿é‡Œäº‘ ECS è‡ªå·±æ­å»ºï¼Œæ²¡æœ‰ä½¿ç”¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ ACKã€‚

é¦–å…ˆè´­ä¹°ä¸€å° ECS ç”¨äºéƒ¨ç½² Control Plane èŠ‚ç‚¹ï¼ŒControl Plane æ˜¯æŒ‡æŒ¥åè°ƒæ§åˆ¶ä¸­å¿ƒï¼Œä¸å¹²å…·ä½“æ´»ï¼Œæ‰€ä»¥ä¸éœ€è¦å¾ˆé«˜çš„é…ç½®ï¼Œé€‰æ‹©äº†2æ ¸4Gçš„ç»æµå‹ ECS å®ä¾‹ï¼ˆecs.e-c1m2.largeï¼‰ï¼Œæ“ä½œç³»ç»Ÿé€‰ç”¨äº† Ubuntu 24.04ï¼ŒåŠ å…¥æ–°å»ºçš„ kube å®‰å…¨ç»„ï¼ˆé›†ç¾¤ä¸­çš„èŠ‚ç‚¹æœåŠ¡å™¨éƒ½ä¼šåŠ å…¥è¿™ä¸ªå®‰å…¨ç»„)ï¼Œä¸»æœºåæ˜¯ kube-cp-01ã€‚

### å‡†å¤‡å·¥ä½œ

#### å®‰è£… k8s ä¸‰é©¾é©¬è½¦

å®‰è£… kubelet + kubeadm + kubectlï¼Œä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ 1.33.4

å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…

    apt-get update
    apt-get install -y apt-transport-https ca-certificates curl gnupg
    

æ·»åŠ  k8e å®‰è£…æºçš„ç­¾åç§˜é’¥

    curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.33/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
    chmod 644 /etc/apt/keyrings/kubernetes-apt-keyring.gpg
    

æ·»åŠ  k8e å®‰è£…æº

    echo 'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.33/deb/ /' | sudo tee /etc/apt/sources.list.d/kubernetes.list
    chmod 644 /etc/apt/sources.list.d/kubernetes.list
    

apt-get å‘½ä»¤å®‰è£…ä¸‰é©¾é©¬è½¦

    apt-get update
    apt-get install -y kubelet kubectl kubeadm
    

ç¡®è®¤ç‰ˆæœ¬

    ~# kubelet --version
    Kubernetes v1.33.4
    ~# kubectl version
    Client Version: v1.33.4
    ~# kubeadm version -o short
    v1.33.4
    

#### é…ç½®ç½‘ç»œ

å¼€å¯ IPv4 åŒ…è½¬å‘

    echo "net.ipv4.ip_forward = 1" | tee /etc/sysctl.d/k8s.conf
    sysctl --system
    

#### å®‰è£…å®¹å™¨è¿è¡Œæ—¶ containerd

é‡‡ç”¨æ‰‹åŠ¨å®‰è£…æ–¹å¼ï¼Œå®‰è£…çš„ containerd ç‰ˆæœ¬æ˜¯ 2.1.4

ä¸‹è½½å¹¶è§£å‹è‡³ /usr/local

    wget -c https://github.com/containerd/containerd/releases/download/v2.1.4/containerd-2.1.4-linux-amd64.tar.gz
    tar Cxzvf /usr/local containerd-2.1.4-linux-amd64.tar.gz
    

é€šè¿‡ systemd è‡ªåŠ¨è¿è¡Œ containerd

    mkdir -p /usr/local/lib/systemd/system
    wget -c https://raw.githubusercontent.com/containerd/containerd/main/containerd.service -O /usr/local/lib/systemd/system/containerd.service 
    systemctl daemon-reload
    systemctl enable --now containerd
    

å®‰è£… runc

    wget -c https://github.com/opencontainers/runc/releases/download/v1.3.1/runc.amd64
    install -m 755 runc.amd64 /usr/local/sbin/runc
    

å®‰è£… CNI æ’ä»¶

    wget -c https://github.com/containernetworking/plugins/releases/download/v1.8.0/cni-plugins-linux-amd64-v1.8.0.tgz
    mkdir -p /opt/cni/bin
    tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.8.0.tgz
    

ç”Ÿæˆ containerd é…ç½®

    mkdir /etc/containerd
    containerd config default > /etc/containerd/config.toml
    

åœ¨ /etc/containerd/config.toml ä¸­å¯ç”¨ SystemdCgroup

    [plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.runc]
      ...
      [plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.runc.options]
        SystemdCgroup = true
    

é‡å¯ containerd ä½¿é…ç½®ç”Ÿæ•ˆ

    systemctl restart containerd
    

å®‰è£… containerd å‘½ä»¤è¡Œå·¥å…· nerdctl

    wget -c https://github.com/containerd/nerdctl/releases/download/v2.1.4/nerdctl-2.1.4-linux-amd64.tar.gz
    tar -zxf nerdctl-2.1.4-linux-amd64.tar.gz
    mv nerdctl /usr/bin/nerdctl
    

å°† nerdctl çš„é»˜è®¤å‘½åç©ºé—´è®¾ç½®ä¸º k8s.io

    mkdir /etc/nerdctl
    echo 'namespace = "k8s.io"' | tee /etc/nerdctl/nerdctl.toml
    

### åˆ›å»ºé«˜å¯ç”¨é›†ç¾¤

åœ¨ /etc/hosts ä¸­æ·»åŠ  control-plane-endpoint çš„ä¸»æœºåè§£æ

    127.0.0.1  kube-api
    

ç”¨ kubeadm å‘½ä»¤åˆ›å»ºé›†ç¾¤

    kubeadm init \
        --control-plane-endpoint "kube-api:6443"  \
        --upload-certs \
        --pod-network-cidr=10.0.0.0/8 \
        --skip-phases=addon/kube-proxy
    

æ³¨ï¼šæ²¡æœ‰å®‰è£… kube-proxy æ˜¯å› ä¸ºä¼šç”¨ cilium å–ä»£å®ƒ

å‡ºç°ä¸‹é¢çš„è¾“å‡ºè¯´æ˜é›†ç¾¤åˆ›å»ºæˆåŠŸäº†

    Your Kubernetes control-plane has initialized successfully!
    ...
    

æ³¨ï¼šä¸Šé¢çš„è¾“å‡ºå†…å®¹ä¸­åŒ…å«åŠ å…¥ control-plane ä¸ worker èŠ‚ç‚¹çš„å‘½ä»¤ï¼Œåé¢ä¼šç”¨åˆ°

ç”¨ nerdctl ps å‘½ä»¤æŸ¥çœ‹å®¹å™¨è¿è¡Œæƒ…å†µ

    root@kube-cp-01 ~ # nerdctl ps    
    CONTAINER ID    IMAGE                                              COMMAND                   CREATED               STATUS
    f54d0fc6215a    registry.k8s.io/kube-proxy:v1.33.4                 "/usr/local/bin/kubeâ€¦"    About a minute ago    Up    
    73cbd7ab3d69    registry.k8s.io/kube-scheduler:v1.33.4             "kube-scheduler --auâ€¦"    About a minute ago    Up
    5ff05420d284    registry.k8s.io/kube-controller-manager:v1.33.4    "kube-controller-manâ€¦"    About a minute ago    Up
    7031f91cfc16    registry.k8s.io/kube-apiserver:v1.33.4             "kube-apiserver --adâ€¦"    About a minute ago    Up
    2c79907098d4    registry.k8s.io/etcd:3.5.21-0                      "etcd --advertise-clâ€¦"    About a minute ago    Up    
    975b724b2814    registry.k8s.io/pause:3.10                         "/pause"                  About a minute ago    Up       
    

æ·»åŠ  kubectl ç”¨åˆ°çš„é…ç½®æ–‡ä»¶

    mkdir -p $HOME/.kube
    sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
    sudo chown $(id -u):$(id -g) $HOME/.kube/config
    

æŸ¥çœ‹èŠ‚ç‚¹è¿è¡Œæƒ…å†µ

    root@kube-cp-01 ~ # kubectl get nodes
    NAME         STATUS   ROLES           AGE     VERSION
    kube-cp-01   Ready    control-plane   2m41s   v1.33.4
    

æ³¨ï¼šè¿™é‡Œ control-plane node å¤„äº Ready çŠ¶æ€ï¼Œå¦‚æœç”¨äº† kube-proxyï¼Œè¦ç­‰å®Œæˆå®‰è£… CNI ç½‘ç»œæ’ä»¶æ‰ä¼šå¤„äº Ready çŠ¶æ€

æŸ¥çœ‹ pod è¿è¡Œæƒ…å†µ

    root@kube-cp-01 ~ # kubectl get pods -n kube-system                                                                                                                                                                1 â†µ
    NAME                                 READY   STATUS    RESTARTS   AGE
    coredns-674b8bbfcf-994fx             0/1     Pending   0          2m40s
    coredns-674b8bbfcf-bsgdd             0/1     Pending   0          2m40s
    etcd-kube-cp-01                      1/1     Running   0          2m46s
    kube-apiserver-kube-cp-01            1/1     Running   0          2m45s
    kube-controller-manager-kube-cp-01   1/1     Running   0          2m44s
    kube-proxy-vlvt9                     1/1     Running   0          2m40s
    kube-scheduler-kube-cp-01            1/1     Running   0          2m44s
    

coredns å¤„äº Pending çŠ¶æ€æ˜¯å› ä¸ºè¿˜æ²¡å®‰è£… CNI ç½‘ç»œæ’ä»¶

### å®‰è£… CNI ç½‘ç»œæ’ä»¶

é€‰ç”¨ cilium ä½œä¸º CNI(å®¹å™¨ç½‘ç»œæ¥å£) æ’ä»¶

å®‰è£… cilium cli

    wget -c https://github.com/cilium/cilium-cli/releases/download/v0.18.7/cilium-linux-amd64.tar.gz
    tar xzvfC cilium-linux-amd64.tar.gz /usr/local/bin
    

å®‰è£… cilium

    root@kube-cp-01 ~ # cilium install --version 1.18.1 \
      --namespace kube-system \
      --set bpf.masquerade=true \
      --set kubeProxyReplacement=true
    â„¹ï¸  Using Cilium version 1.18.1
    ğŸ”® Auto-detected cluster name: kubernetes
    ğŸ”® Auto-detected kube-proxy has not been installed
    â„¹ï¸  Cilium will fully replace all functionalities of kube-proxy
    

æ£€æŸ¥ cillium çš„è¿è¡Œæƒ…å†µ

    root@kube-cp-01 ~ # cilium status --wait                
        /Â¯Â¯\
     /Â¯Â¯\__/Â¯Â¯\    Cilium:             OK
     \__/Â¯Â¯\__/    Operator:           OK
     /Â¯Â¯\__/Â¯Â¯\    Envoy DaemonSet:    OK
     \__/Â¯Â¯\__/    Hubble Relay:       disabled
        \__/       ClusterMesh:        disabled
    
    DaemonSet              cilium                   Desired: 1, Ready: 1/1, Available: 1/1
    DaemonSet              cilium-envoy             Desired: 1, Ready: 1/1, Available: 1/1
    Deployment             cilium-operator          Desired: 1, Ready: 1/1, Available: 1/1
    Containers:            cilium                   Running: 1
                           cilium-envoy             Running: 1
                           cilium-operator          Running: 1
                           clustermesh-apiserver    
                           hubble-relay             
    Cluster Pods:          2/2 managed by Cilium
    Helm chart version:    1.18.1
    

ç¡®è®¤ cilium å·²å–ä»£ kube-proxy

    root@kube-cp-01 ~ # kubectl -n kube-system exec ds/cilium -- cilium-dbg status | grep KubeProxyReplacement
    KubeProxyReplacement:    True   [eth0   172.21.49.56 fe80::216:3eff:fe0d:c8fe (Direct Routing)]
    

ç¡®è®¤å·²å¯ç”¨ eBPF Host-Routing

    root@kube-cp-01 ~ # kubectl -n kube-system exec ds/cilium -- cilium-dbg status | grep BPF                 
    Routing:                 Network: Tunnel [vxlan]   Host: BPF
    Masquerading:            BPF   [eth0]   10.0.0.0/24  [IPv4: Enabled, IPv6: Disabled]
    

Cillium æˆåŠŸéƒ¨ç½²åï¼Œcoredns pod ä¹Ÿéšä¹‹æ­£å¸¸è¿è¡Œ

    root@kube-cp-01 ~ # kubectl get pods -n kube-system
    NAME                                 READY   STATUS    RESTARTS   AGE
    coredns-674b8bbfcf-994fx             1/1     Running   0          8m46s
    coredns-674b8bbfcf-bsgdd             1/1     Running   0          8m46s
    

### æ·»åŠ æ›´å¤š Control Plane èŠ‚ç‚¹

ä¸€å…±éƒ¨ç½² 3 ä¸ª control plane èŠ‚ç‚¹ï¼Œå‡†å¤‡ 2 å°ä¸ kube-cp-01 åŒæ ·é…ç½®çš„2æ ¸4Gé˜¿é‡Œäº‘ ecsï¼ŒåŠ å…¥ kube å®‰å…¨ç»„ï¼Œä¸»æœºååˆ†åˆ«ä¸º kube-cp-02 ä¸ kube-cp-03ï¼Œç”¨ kube-cp-01 çš„é•œåƒåˆ›å»ºç³»ç»Ÿã€‚

åˆ†åˆ«ç™»å½•è¿™2å°æœåŠ¡å™¨ï¼Œä¿®æ”¹ä¸»æœºåï¼Œé‡ç½®å·²æœ‰çš„ k8s é…ç½®

    hostnamectl set-hostname kube-cp-02
    kubeadm reset
    

åœ¨ /etc/hosts ä¸­æ·»åŠ  kube-api çš„è§£æï¼Œè§£æåˆ° kube-cp-01 çš„ IP åœ°å€

    172.21.49.56  kube-api
    

é€šè¿‡ä¸‹é¢ kubeadm join å‘½ä»¤å°†æœåŠ¡å™¨åŠ å…¥é›†ç¾¤æˆä¸º control plane èŠ‚ç‚¹

    kubeadm join kube-api:6443 --token xxxxxx \
        --discovery-token-ca-cert-hash sha256:yyyyyy \
        --control-plane --certificate-key zzzzzz \
        -v=6
    

æ³¨ï¼šå¦‚æœå¿˜è®°ä¹‹å‰ kubeadm init åˆ›å»ºé›†ç¾¤æ—¶ç”Ÿæˆçš„ join å‘½ä»¤æ‰€éœ€çš„ token + hash + keyï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤åœ¨ kube-cp-01 ä¸Šç”Ÿæˆ

    kubeadm init phase upload-certs --upload-certs
    kubeadm token create --print-join-command
    

åœ¨ /etc/hosts ä¸­å°† kube-api è§£æåˆ° 127.0.0.1

    127.0.0.1  kube-api
    

è¿™æ—¶é€šè¿‡ kubectl å‘½ä»¤å°±å¯ä»¥çœ‹åˆ°3ä¸ª control plane èŠ‚ç‚¹

    root@kube-cp-03 ~ # kubectl get nodes
    NAME         STATUS   ROLES           AGE     VERSION
    kube-cp-01   Ready    control-plane   2d6h    v1.33.4
    kube-cp-02   Ready    control-plane   48m     v1.33.4
    kube-cp-03   Ready    control-plane   6m18s   v1.33.4
    

æŒ‡æŒ¥åè°ƒæ§åˆ¶ä¸­å¿ƒä¸‰äººç»„å°±è¿™æ ·ç»„å»ºå¥½äº†ã€‚

æ¥ä¸‹æ¥æ·»åŠ çœŸæ­£å¹²æ´»çš„ worker èŠ‚ç‚¹ï¼Œæ·»åŠ ä¹‹å‰è¦éƒ¨ç½²è´Ÿè½½å‡è¡¡ï¼Œworker èŠ‚ç‚¹é€šè¿‡è´Ÿè½½å‡è¡¡è®¿é—® control plane çš„ api serverï¼ŒæŒ‰ç…§ control plane çš„æŒ‡ä»¤ä¸ç›®æ ‡å¹²æ´»ã€‚

### éƒ¨ç½²è´Ÿè½½å‡è¡¡

é€‰ç”¨äº†é˜¿é‡Œäº‘ç½‘ç»œå‹è´Ÿè½½å‡è¡¡ï¼ˆNLBï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º kube-api çš„ç§ç½‘ NLB

![](https://img2024.cnblogs.com/blog/35695/202508/35695-20250820171610551-2047695641.png)

åˆ›å»º NLB æœåŠ¡å™¨ç»„ï¼Œå°† 3 å° control-plane èŠ‚ç‚¹æœåŠ¡å™¨åŠ å…¥æœåŠ¡å™¨ç»„

![](https://img2024.cnblogs.com/blog/35695/202509/35695-20250911220104381-477343480.png)

åˆ›å»ºç›‘å¬ï¼Œç›‘å¬åè®®æ˜¯ TCPï¼Œç«¯å£æ˜¯ 6443ï¼Œå…³è”æœåŠ¡å™¨ç»„é€‰æ‹©å‰ä¸€æ­¥åˆ›å»ºçš„æœåŠ¡å™¨ç»„ã€‚

![](https://img2024.cnblogs.com/blog/35695/202508/35695-20250830141111385-1638859711.png)

k8s é›†ç¾¤çš„ control-plane-endpoint ä¸»æœºåæ˜¯ kube-apiï¼ŒNLB çš„ endpoint ä¸»æœºåæ˜¯ä¸‹é¢è¿™ä¸ªå¾ˆé•¿çš„ä¸‰çº§åŸŸåï¼Œéœ€è¦éƒ¨ç½²å†…ç½‘ dns æœåŠ¡å™¨è¿›è¡Œ CNAME è§£æ

    nlb-uaohnyerknl7eraukw2.ap-southeast-1.nlb.aliyuncsslbintl.com
    

é€‰ç”¨äº†é˜¿é‡Œäº‘ã€Œäº‘è§£æ PrivateZoneã€ï¼Œåœ¨æ§åˆ¶å°æ·»åŠ ä¸€ä¸ªåŸŸåï¼Œç„¶åæ·»åŠ ä¸€ä¸ª CNAME è§£æè®°å½•ï¼Œå°† kube-api è§£æåˆ°é˜¿é‡Œäº‘è´Ÿè½½å‡è¡¡ç»‘å®šçš„ä¸»æœºå

![Screenshot 2025-08-30 at 22.02](https://img2024.cnblogs.com/blog/35695/202508/35695-20250830220345705-1859090249.jpg)

ç™»å½•åˆ° kube-cp-01 æœåŠ¡å™¨æµ‹è¯•ä¸€ä¸‹è§£æ

    ping kube-api
    PING nlb-uaohnyerknl7eraukw2.ap-southeast-1.com (172.21.49.53) 56(84) bytes of data.
    64 bytes from 172.21.49.53: icmp_seq=1 ttl=102 time=0.378 ms
    

è§£ææˆåŠŸï¼Œè´Ÿè½½å‡è¡¡éƒ¨ç½²å®Œæˆã€‚

### æ·»åŠ  Worker èŠ‚ç‚¹

å‡†å¤‡ä¸€å°4æ ¸8Gçš„é˜¿é‡Œäº‘ ecs ä½œä¸º worker èŠ‚ç‚¹ï¼ŒåŠ å…¥ kube å®‰å…¨ç»„ï¼Œä¸»æœºåè®¾ç½®ä¸º kube-worker-01ï¼Œä¹Ÿæ˜¯ç”¨ä¹‹å‰çš„é•œåƒåˆ›å»ºç³»ç»Ÿã€‚

ç™»å½• kube-worker-01 æœåŠ¡å™¨ï¼Œåˆ é™¤ /etc/hosts ä¸­çš„ kube-api è§£æï¼Œä¹‹å‰éƒ¨ç½²çš„å†…ç½‘ dns æœåŠ¡å™¨ä¼šè‡ªåŠ¨è¿›è¡Œè§£æã€‚

ç”¨ kubeadm reset å‘½ä»¤é‡ç½® k8s é…ç½®ï¼Œé€šè¿‡ kubeadm join å‘½ä»¤å°†è¿™å°æœåŠ¡å™¨ä½œä¸º worker èŠ‚ç‚¹åŠ å…¥é›†ç¾¤

    kubeadm join kube-api:6443 --token xxxxxx \
      --discovery-token-ca-cert-hash sha256:yyyyyy
    

å‡ºç°ä¸‹é¢çš„è¾“å‡ºï¼Œè¯´æ˜æˆåŠŸåŠ å…¥

    This node has joined the cluster:
    * Certificate signing request was sent to apiserver and a response was received.
    * The Kubelet was informed of the new secure connection details.
    
    Run 'kubectl get nodes' on the control-plane to see this node join the cluster.
    

ç™»å½•åˆ°å…¶ä¸­ä¸€å° control-plane æŸ¥çœ‹é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æƒ…å†µ

    root@kube-cp-01 ~ # kubectl get nodes                 
    NAME             STATUS   ROLES           AGE     VERSION
    kube-cp-01       Ready    control-plane   2d12h   v1.33.4
    kube-cp-02       Ready    control-plane   6h45m   v1.33.4
    kube-cp-03       Ready    control-plane   87m     v1.33.4
    kube-worker-01   Ready    <none>          54m     v1.33.4
    

3 ä¸ª control-plane èŠ‚ç‚¹ï¼Œ1 ä¸ª worker èŠ‚ç‚¹éƒ½è¿è¡Œæ­£å¸¸ï¼Œk8s é›†ç¾¤éƒ¨ç½²å®Œæˆï¼Œé›†è£…ç®±å‡†å¤‡å°±ç»ªï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å¾€é›†è£…ç®±ä¸­è£…åŒ…è£¹ï¼ˆéƒ¨ç½² podï¼‰ï¼Œä¼šåœ¨åç»­çš„åšæ–‡ä¸­åˆ†äº«ã€‚

### æ­å»ºä¸­é‡åˆ°çš„é—®é¢˜

å¼€å§‹å®‰è£…çš„æ˜¯æœ€æ–°ç‰ˆ kubernetes 1.34ï¼Œåœ¨éƒ¨ç½²æœ€æ–°ç‰ˆ cilium 1.18.1 æ—¶å‘ç° cilium ä¸å…¼å®¹ k8s 1.34ï¼Œåªèƒ½æ¢æˆ k8s 1.33.4ã€‚

æœ¬æ¥æƒ³å‚è€ƒ[è¿™ç¯‡åšæ–‡](https://littlechimera.com/posts/cilium-lb-cp-endpoint/)è¯•è¯• cilium çš„é«˜ç§‘æŠ€ï¼Œç”¨ k8s service å–ä»£é˜¿é‡Œäº‘è´Ÿè½½å‡è¡¡ä½œä¸º control plane çš„è´Ÿè½½å‡è¡¡ï¼Œä½†å®éªŒå¤±è´¥ï¼Œç­‰ä»¥åæ‰¾æ—¶é—´å†ç ”ç©¶ã€‚

### ç»“è¯­

è®©å¤§å®¶ä¹…ç­‰äº†ï¼Œå‡ºæµ·è®°ç¬¬2ç¯‡åšæ–‡å§—å§—æ¥å¤ªè¿Ÿï¼Œå› ä¸ºè¿™æ®µæ—¶é—´å¤ªå¿™äº†ï¼Œæœ‰æ—¶æ­å»ºåˆ°ä¸­é€”ï¼Œç«Ÿç„¶è¿ç»­å‡ å¤©æŠ½ä¸å‡ºæ—¶é—´ç»§ç»­æ­å»ºã€‚

æ¥ä¸‹æ¥ä¼šæ›´å¿™ï¼Œè¿™æ®µæ—¶é—´å’Œåä¸ºè¾¾æˆäº† HarmonyOS çš„æ¨å¹¿å’Œä¸“åŒºå»ºè®¾åˆä½œï¼Œæ¥ä¸‹æ¥è¦é‡ç‚¹å¿™äº HarmonyOS ä¸“åŒºçš„æ­å»ºä¸è¿è¥ï¼Œå‡ºæµ·è®°çš„åˆ†äº«ä¼šæ›´å—å½±å“ï¼Œä¼šè€ƒè™‘èš‚èšæ¬å®¶å¼åœ°ä¸€ç‚¹ä¸€ç‚¹åˆ†äº«ï¼Œæ¯”å¦‚éƒ¨ç½² redis åˆ†äº«ä¸€ç¯‡ï¼Œéƒ¨ç½² dapr åˆ†äº«ä¸€ç¯‡ï¼Œç›´åˆ°æ‰¾åˆ°è´Ÿè´£ HarmonyOS åˆä½œé¡¹ç›®çš„è¿è¥äººæ‰åŠ å…¥å›¢é˜Ÿï¼Œå‡ºæµ·çš„æ­¥ä¼æ‰èƒ½åŠ å¿«ã€‚

å¦å¤–ï¼Œå›­å­åŠå…¬å®¤éš”å£çš„ã€Œäº‘æ –å¼€å‘è€…åŸºåœ°ã€è£…ä¿®å¥½äº†ï¼Œä»¥åæ­å·çš„å›­å‹å¯ä»¥æœ‰å›ºå®šçš„åœ°æ–¹çº¿ä¸‹äº¤æµäº†ï¼Œå›­å­çš„å‡ºæµ·ä¹Ÿå¯ä»¥åœ¨çº¿ä¸‹æ¢è®¨äº¤æµäº†ã€‚