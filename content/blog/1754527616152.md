---
layout: post
title: '分析C#项目的单元测试覆盖率，提高代码质量'
date: "2025-08-07T00:46:56Z"
---
分析C#项目的单元测试覆盖率，提高代码质量
=====================

C#覆盖率分析？不就是用工具生成报告吗？VSCode、VS、Rider哪个不能干？真当这是啥高科技？

前言
--

正如我在[前一篇](https://blog.deali.cn/p/csharp-aot-imageglider)介绍 [ImageGlider](https://github.com/star-plan/image-glider) 的文章里预告的那样，这篇同样属于那套「C# + 自动化发布」开发流程的系列分享，继续把踩过的坑和总结的经验都记录下来，大家一起少走弯路。

单元测试的重要性不用我多说了吧？😄

而**覆盖率**，保证了单元测试的**广度和有效性——它能帮助开发者发现遗漏的逻辑分支，避免“测试了但其实没测到”的尴尬场面**。

特别是在如今的AI编程时代，完善的测试可以让AI自动验证功能的实现结果

刚好 C# 拥有非常完善的基础设施，这种功能丰富的语言，特别适应 AI 时代，我有预感，dotnet 平台在 AI 时代未来可期😁

要进行覆盖率测试，方法有非常多，一开始我使用了一个第三方工具来生成 HTML 报告，后面发现 VSCode、VS、Rider 这些 IDE 里都可以🤣

C#工具库
-----

今年我陆续用 C# 开发了不少工具

涵盖的范围也不小

感觉都可以组成一个小工具库了

这些工具分别是：

*   [视频剪辑工具 Clipify](https://blog.deali.cn/Blog/Post/6a903b1c6fb2487f)
*   [AI 文章发布工具 StarBlog Publisher](https://blog.deali.cn/Blog/Post/f41b7410d59aa6b0)
*   [图标生成工具 SharpIco](https://blog.deali.cn/p/sharpico-pure-csharp-zero-dependency-ico-generator)
*   [多功能图片处理工具 ImageGlider](https://blog.deali.cn/p/csharp-aot-imageglider)
*   [PDF 目录提取工具 PdfTocExtractor](https://github.com/star-plan/pdf-toc-extractor)

依赖
--

使用 `dotnet-reportgenerator-globaltool` 工具可以生成 HTML 报告

    dotnet tool install -g dotnet-reportgenerator-globaltool
    

测试覆盖率
-----

以 ImageGlider 项目为例

使用以下命令分析项目的单元测试覆盖率，并生成测试报告网页

    # 生成测试覆盖率报告
    dotnet test --collect:"XPlat Code Coverage" --results-directory ./temp/TestResults
    
    # 使用 reportgenerator 生成HTML报告
    reportgenerator -reports:"./temp/TestResults/*/coverage.cobertura.xml" -targetdir:"./TestResults/CoverageReport" -reporttypes:Html
    

生成的测试报告路径示例

    temp\TestResults\4eaa9684-a3b6-4b2a-81ac-d75e1e375e4b\coverage.cobertura.xml
    

直接打开这个网页就可以看到覆盖率的报告了

### HTML 报告

非常详细

### 总览

![](https://img2024.cnblogs.com/blog/866942/202508/866942-20250806232757389-1480062960.png)

### 查看详细覆盖率

这里可以调整分组模式

默认是 By assembly

可以改成 By namespace ，命名空间模式又分 level 1 和 level 2

其中 Line coverage 和 Branch coverage 都是可以筛选的

项目大点的话，建议选择 By Namespace level 2 ，比较直观

![](https://img2024.cnblogs.com/blog/866942/202508/866942-20250806232806367-554514041.png)

### 方法的测试覆盖率

点击具体的类，跳转到方法覆盖率页面

![](https://img2024.cnblogs.com/blog/866942/202508/866942-20250806232814964-1654238720.png)

这里可以看到哪个方法没写测试

或者哪些 case 是没有覆盖到的

总之非常方便

![image](https://img2024.cnblogs.com/blog/866942/202508/866942-20250806232840848-221384931.png)

VSCode
------

在 tests 目录上右键，运行覆盖率测试

很快就会在各个目录上出现类似手机电池的图标（好可爱😄）

可以很方便地看到各个项目、各个代码文件的测试覆盖率

![](https://img2024.cnblogs.com/blog/866942/202508/866942-20250806232905674-644565643.png)

Rider
-----

我是先在 VSCode 里发现的

我就在想

VSCode 都有的功能，老牌 C# IDE 的这个 Rider，应该更加有吧

结果测了一下，还真有

菜单 Tests -> Cover Unit Tests

这个功能也不错，还能导出 HTML 什么的

![](https://img2024.cnblogs.com/blog/866942/202508/866942-20250806232914145-559534939.png)

小结
--

总之，通过dotnet-reportgenerator-globaltool和VSCode、VS、Rider等IDE的内置功能，我们可以轻松分析C#项目的单元测试覆盖率，帮助提升代码质量和测试有效性。

微信公众号：「程序设计实验室」 专注于互联网热门新技术探索与团队敏捷开发实践，包括架构设计、机器学习与数据分析算法、移动端开发、Linux、Web前后端开发等，欢迎一起探讨技术，分享学习实践经验。