---
layout: post
title: 'å›½é™…åŒ–åˆ©å™¨ Intl Messageformat'
date: "2025-05-10T00:39:06Z"
---
å›½é™…åŒ–åˆ©å™¨ Intl Messageformat
========================

> æˆ‘ä»¬æ˜¯[è¢‹é¼ äº‘æ•°æ ˆ UED å›¢é˜Ÿ](http://ued.dtstack.cn/)ï¼Œè‡´åŠ›äºæ‰“é€ ä¼˜ç§€çš„ä¸€ç«™å¼æ•°æ®ä¸­å°äº§å“ã€‚æˆ‘ä»¬å§‹ç»ˆä¿æŒå·¥åŒ ç²¾ç¥ï¼Œæ¢ç´¢å‰ç«¯é“è·¯ï¼Œä¸ºç¤¾åŒºç§¯ç´¯å¹¶ä¼ æ’­ç»éªŒä»·å€¼ã€‚

> æœ¬æ–‡ä½œè€…ï¼š[éœœåº](https://luckyfbb.github.io/blog)

> Formats ICU Message strings with number, date, plural, and select placeholders to create localized messages.

ICU ä¿¡æ¯è¯­æ³•
========

[ICU](https://github.com/unicode-org/icu) æ˜¯ International Components for Unicode çš„ç®€ç§°ã€‚å¤„ç†å¤šè¯­è¨€å’Œå¤æ‚æ–‡æœ¬æ¨¡æ¿æä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„è¯­æ³•ã€‚å®ƒçš„ä¸»è¦ç”¨é€”æ˜¯é€šè¿‡æ¨¡æ¿æè¿°æ¶ˆæ¯å†…å®¹ï¼Œå¹¶æ ¹æ®ä¸Šä¸‹æ–‡ï¼ˆå¦‚è¯­è¨€ã€å¤æ•°è§„åˆ™ã€æ€§åˆ«ç­‰ï¼‰åŠ¨æ€ç”Ÿæˆæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### åŠ¨æ€æ’å€¼

åœ¨æ¨¡æ¿ä¸­æ’å…¥å˜é‡å€¼ï¼Œæ ¼å¼ä¸º`{key, type, format}`

    Hello, {name}!
    I have {workNum, number} things to do
    Almost {pctBlack, number, percent} of them are black.
    

å˜é‡`{key}`ä¼šè¢«å®é™…å€¼æ›¿æ¢ï¼Œä¾‹å¦‚ï¼š`Hello, FBB!`

#### å¤æ•°è§„åˆ™(Plurals)

å¤„ç†ä¸æ•°é‡ç›¸å…³çš„æ¶ˆæ¯å˜åŒ–ï¼Œæ ¼å¼ä¸º`{key, plural, matches}`

    {count, plural, =0{no items} one {1 item} other {# items}}
    

ä¼šæ ¹æ®ä¼ å…¥çš„ count ä¼šåŠ¨æ€å¤„ç†æˆåˆé€‚çš„æ–‡æœ¬

    count = 0   ===>   no items
    count = 1   ===>   1 item
    count = 4   ===>   4 items
    

#### æ¡ä»¶é€‰æ‹©(Select)

åŸºäºæ¡ä»¶é€‰æ‹©æ¶ˆæ¯å†…å®¹ï¼Œæ ¼å¼ä¸º`{key, select, matches}`

    {gender, select, male {He} female {She} other {They}} liked your post.
    

ä¼šæ ¹æ® gender çš„ä¼ å…¥åŠ¨æ€è¾“å‡º

    gender = male     ===>   He liked your post.
    gender = female   ===>   She liked your post.
    gender = other    ===>   They liked your post.
    

#### æ—¥æœŸä¸æ—¶é—´æ ¼å¼åŒ–

æ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´å€¼

    The event is scheduled on {date, date, long}.
    

è¾“å‡ºæ ¼å¼ä¾èµ–äºåŒºåŸŸè®¾ç½®ï¼Œå¦‚: `January 1, 2024`

### æ€»ç»“

*   å¼ºå¤§çš„æ¨¡ç‰ˆæ”¯æŒï¼Œæä¾›äº†å¤šç§æ¨¡å¼ä¾›ç”¨æˆ·é€‰æ‹©
*   è·¨å¹³å°æ”¯æŒï¼Œå¯ä»¥ç”¨äºä¸åŒè¯­è¨€

**Intl Messageformat**
----------------------

Intl MessageFormat æ˜¯ä¸€ä¸ªåŸºäº JavaScript å®ç°çš„åº“ï¼Œç”¨äºå¤„ç†å¤šè¯­è¨€å›½é™…åŒ–åœºæ™¯ï¼Œä¸»è¦åŠŸèƒ½æ˜¯åŠ¨æ€æ ¼å¼åŒ–æ–‡æœ¬æ¶ˆæ¯ã€‚

    pnpm add intl-messageformat
    

### åŸºç¡€ä½¿ç”¨

    import { IntlMessageFormat } from "intl-messageformat";
    
    const formatter = new IntlMessageFormat("Hello, {name}!");
    const message = formatter.format({ name: "World" });
    

    const formatter = new IntlMessageFormat(
      "{count, plural, =0{no items} one {1 item} other {# items}}"
    );
    const message = formatter.format({ count: 0 });
    const message1 = formatter.format({ count: 1 });
    const message2 = formatter.format({ count: 10 });
    
    console.log(message, message1, message2); // no items 1 items 10 items
    

å‘ç°äº†ä¸€ä¸ªå°å°çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆåœ¨`{ count: 1 }`çš„æ—¶å€™ï¼Œè¾“å‡ºçš„æ˜¯`1 items`ï¼Ÿ

`IntlMessageFormat`è¿˜æ¥å—å…¶ä»–çš„å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º`locales`ç”¨äºæŒ‡å®šå½“å‰çš„è¯­è¨€ã€‚å¦‚æœä¸ç‰¹æ®ŠæŒ‡å®šä¼šé€šè¿‡`new Intl.NumberFormat().resolvedOptions().locale`è·å–é»˜è®¤å€¼ï¼Œæ­¤æ—¶çš„é»˜è®¤å€¼ä¸º`zh-CN`ï¼Œæ— æ³•å¤„ç†`one`è¿™æ¡è§„åˆ™ï¼Œå› æ­¤åŒ¹é…åˆ°äº†`other`è¿™æ¡è§„åˆ™ã€‚åœ¨`locale`ä¸º`en`çš„è¯­è¨€ä¸‹èƒ½å¤Ÿæˆä¸ºæˆ‘ä»¬çš„æœŸæœ›å€¼ã€‚

é‚£ä¹ˆæˆ‘ä»¬åªèƒ½æ›´æ”¹ä¼ å…¥çš„`message`

    const formatter = new IntlMessageFormat(
      "{count, plural, =0{no items} =1{1 item} other {# items}}"
    );
    const message = formatter.format({ count: 0 });
    const message1 = formatter.format({ count: 1 });
    const message2 = formatter.format({ count: 10 });
    
    console.log(message, message1, message2); // no items 1 item 10 items
    

åœ¨æˆ‘ä»¬çš„äº§å“ä¸­ä¼šæœ‰è¿™æ ·çš„åœºæ™¯ï¼Œæ¯æœˆ x å·ï¼Œæ¯å‘¨æ˜ŸæœŸ x çš„æƒ…å†µï¼Œå½“æˆ‘ä»¬åšå›½é™…åŒ–çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ ICU ä¿¡æ¯æ¥åšã€‚

    const message = `The {day, selectordinal,
        one {#st}
        two {#nd}
        few {#rd}
        other {#th}
    } day of month`;
    const formatter = new IntlMessageFormat(message, "en");
    
    console.log(formatter.format({ day: 22 }));  // The 22nd day of month
    console.log(formatter.format({ day: 26 }));  // The 26th day of month
    

è¿™é‡Œåˆå‡ºæ¥ä¸€ç§æ–°çš„ç±»å‹`selectordinal`ï¼Œä¸»è¦ç”¨äºå¤„ç†åºæ•°è¯ï¼Œé€‚ç”¨äºæè¿°é¡ºåºæˆ–æ’åã€‚

`one/two/few/other` åˆ†åˆ«å¯¹åº”ç€ä¸åŒçš„åºæ•°å½¢å¼ã€‚`one`é€šå¸¸ç”¨äºä»¥1ç»“å°¾çš„æ•°å­—é™¤äº†11ï¼‰ï¼Œ`two` ç”¨äºä»¥2ç»“å°¾çš„æ•°å­—é™¤äº†12ï¼‰ï¼Œ`few`ç”¨äºä»¥3ç»“å°¾çš„æ•°å­—(é™¤äº†13ï¼‰ï¼Œè€Œ`other`åˆ™ç”¨äºæ‰€æœ‰å…¶ä»–æƒ…å†µã€‚

#### åµŒå¥— dom çš„æƒ…å†µ

å¸¸è§ä¾‹å­ï¼Œæˆ‘ä»¬äº§å“ä¸­éœ€è¦ä½¿ç”¨ showTotal ä¸­çš„ total éœ€è¦ç”¨ åŒ…è£¹åšæ ·å¼æ›´æ”¹ï¼Œæœ€åå¯èƒ½æå‡ºçš„æ–‡æœ¬ä¸º

    showTotal={(total) => (
        <span>
            å…±<span className="text-primary">{total}</span>
            æ¡æ•°æ®ï¼Œæ¯é¡µæ˜¾ç¤º{pagination.pageSize}æ¡
        </span>
    )}
    
    
    {
      W: 'å…±',
      X: 'æ¡æ•°æ®ï¼Œæ¯é¡µæ˜¾ç¤º',
      Y: 'æ¡',
    }
    

ä¸€å¥å®Œæ•´çš„è¯è¢«åˆ‡åˆ†çš„ä¹±ä¸ƒå…«ç³Ÿï¼Œç¿»è¯‘æˆè‹±æ–‡çš„æ—¶å€™ä¹Ÿä¼šå‡ºç°è¯­åºé—®é¢˜ã€‚

è¿™ä¸ªæ—¶å€™å°±éœ€è¦æ›´æ”¹å½“å‰çš„æ–¹æ³•ï¼Œç”¨ IntlMessageFormat çš„ tag æ¨¡å¼æ¥æ”¯æŒ

    å…± <BlueText>{val1}</BlueText> æ¡æ•°æ®<Fragment>ï¼Œæ¯é¡µæ˜¾ç¤º {val2} æ¡</Fragment>
    

### è‡ªå®šä¹‰ formatter

åœ¨`intl-messageformat`ä¸­ï¼Œæ‚¨å¯ä»¥ä¸ºæ¶ˆæ¯æ¨¡æ¿ä¸­çš„è‡ªå®šä¹‰ç±»å‹å®šä¹‰è‡ªå·±çš„æ ¼å¼åŒ–é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤æ”¯æŒ`number`ã€`date`å’Œ`time`ç±»å‹ï¼Œä½†é€šè¿‡è‡ªå®šä¹‰`formatters`ï¼Œæ‚¨å¯ä»¥æ·»åŠ è‡ªå·±çš„æ ¼å¼åŒ–ç±»å‹æˆ–æ‰©å±•ç°æœ‰ç±»å‹ã€‚

    const customFormatters = {
      getDateTimeFormat(locales, options) {
        const originalFormatter = new Intl.DateTimeFormat(locales, options);
        return {
          format: (value) => `ğŸ“… ${originalFormatter.format(value)}`,
        };
      },
    };
    
    const message = new IntlMessageFormat(
      "The event is on {eventDate, date}",
      "en",
      {},
      { formatters: customFormatters }
    );
    
    const msg = message.format({ eventDate: new Date("2024-01-01") });
    console.log(msg); // The event is on ğŸ“… 1/1/2024
    

åœ¨`formatters`ä¸­åªèƒ½å®šä¹‰`getNumberFormat/getDateTimeFormat/getPluralRules`ä¸‰ç§ç±»å‹æ–¹æ³•

åœ¨å‰é¢çš„æ—¶å€™æˆ‘ä»¬è¯´åˆ°`{pctBlack, number, percent}/{date, date, long}`ï¼Œæœ€åä¸€ä¸ªç§°ä¸º`style`å¯ä»¥ç”¨äºæ‰©å±•å†…ç½®çš„æ ¼å¼åŒ–åŠŸèƒ½

    const customFormatters = {
      getDateTimeFormat(locales, style) {
        if (style === "customDate") {
          const originalFormatter = new Intl.DateTimeFormat(locales, style);
          return {
            format: (value) => `ğŸ“… ${originalFormatter.format(value)} ğŸ“…`,
          };
        }
        return Intl.DateTimeFormat(locales, style);
      },
    };
    
    const message = new IntlMessageFormat(
      "The event is on {eventDate, date, customDate}",
      "en",
      { date: { customDate: "customDate" } },
      { formatters: customFormatters }
    );
    
    const msg = message.format({ eventDate: new Date("2024-01-01") });
    console.log(msg); // The event is on ğŸ“… 1/1/2024 ğŸ“…
    

### æ€»ç»“

åœ¨æˆ‘ä»¬åç»­å¦‚æœè¦å»å›½é™…åŒ–çš„æ—¶å€™ï¼Œé‡åˆ°ä¸€äº›éœ€è¦åšå•å¤æ•°/æ•°è¯çš„æ—¶å€™ï¼Œåº”è¯¥å»ä¿®æ”¹æˆ‘ä»¬çš„è‹±æ–‡ JSONï¼Œæœ€ååœ¨å­äº§å“å†…éƒ¨è°ƒç”¨`I18N.get`æ–¹æ³•å³å¯ã€‚å› ä¸ºåœ¨`get`æ–¹æ³•ä½¿ç”¨äº†`IntlMessageFormat`å»åšè½¬æ¢

**Intl Messageformat çš„å®ç°åŸç†**
----------------------------

Intl Messageformat éœ€è¦å°†ä¼ å…¥çš„`message`åšä¸€ä¸ªæ‹†è§£ï¼Œè·å–åˆ°å¯¹åº”`{}`ä¸­çš„æ•°æ®ï¼Œåœ¨ `format`çš„æ—¶å€™é€šè¿‡ä¼ å…¥çš„æ•°æ®åšå¡«å……ã€‚

### icu-m**essageformat-parser**

é’ˆå¯¹äº`icu message string`å®˜æ–¹æä¾›äº†å¯¹åº”çš„`parser`æ¥è§£æï¼Œå’Œæˆ‘ä»¬ç”Ÿæˆ`AST`ä¸€æ ·ï¼Œä¼šç”Ÿæˆå›ºå®šç±»å‹çš„æ•°æ®ã€‚

    import { parse } from "@formatjs/icu-messageformat-parser";
    
    const ast = parse(
      "Hello, {name}! You have {count, plural, one {# message} other {# messages}}."
    );
    
    // [
    //   { type: 0, value: "Hello, " },
    //   { type: 1, value: "name" },
    //   { type: 0, value: "! You have " },
    //   {
    //     type: 6,
    //     value: "count",
    //     options: {
    //       "=0": { value: [{ type: 0, value: "no items" }] },
    //       one: { value: [{ type: 0, value: "1 item" }] },
    //       other: { value: [{ type: 7 }, { type: 0, value: " items" }] },
    //     },
    //     offset: 0,
    //     pluralType: "cardinal",
    //   },
    //   { type: 0, value: "." },
    // ]
    

### format æ–¹æ³•

    const message = "Hello, {name}! You have {count, plural, =0{no items} one {1 item} other {# items}}.";
    const formatter = new IntlMessageFormat(message, "en");
    formatter.format({ name: "World", count: 0 });
    

å½“æˆ‘ä»¬è°ƒç”¨`format`çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯éå†ä¸Šè¿°çš„`AST`ï¼Œé’ˆå¯¹äºä¸åŒçš„`type`ä½¿ç”¨ä¸åŒçš„`formatter`

å¤„ç†å¥½æ•°æ®ã€‚

    // å¤„ç†æ™®é€šæ–‡æœ¬
    if (isArgumentElement(el)) {
      if (!value || typeof value === 'string' || typeof value === 'number') {
        value =
          typeof value === 'string' || typeof value === 'number'
            ? String(value)
            : ''
      }
      result.push({
        type: typeof value === 'string' ? PART_TYPE.literal : PART_TYPE.object,
        value,
      } as ObjectPart<T>)
    }
    
    // å¤„ç† Date
    if (isDateElement(el)) {
      const style =
        typeof el.style === 'string'
          ? formats.date[el.style]
          : isDateTimeSkeleton(el.style)
            ? el.style.parsedOptions
            : undefined
      result.push({
        type: PART_TYPE.literal,
        value: formatters.getDateTimeFormat(locales, style).format(value as number),
      })
    }
    

æ€»ç»“
--

`Intl MessageFormat`æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”æˆç†Ÿçš„å›½é™…åŒ–å·¥å…·ã€‚é€šè¿‡ç»“åˆ`ICU`ä¿¡æ¯è¯­æ³•å’ŒJSçš„`Intl API`ï¼Œå®ƒèƒ½å¤Ÿä¸ºå¤šè¯­è¨€åº”ç”¨æä¾›é«˜æ•ˆã€çµæ´»çš„æ¶ˆæ¯æ ¼å¼åŒ–è§£å†³æ–¹æ¡ˆ

### æœ€å

æ¬¢è¿å…³æ³¨ã€è¢‹é¼ äº‘æ•°æ ˆUEDå›¢é˜Ÿã€‘~  
è¢‹é¼ äº‘æ•°æ ˆ UED å›¢é˜ŸæŒç»­ä¸ºå¹¿å¤§å¼€å‘è€…åˆ†äº«æŠ€æœ¯æˆæœï¼Œç›¸ç»§å‚ä¸å¼€æºäº†æ¬¢è¿ star

*   **[å¤§æ•°æ®åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿâ€”â€”Taier](https://dtstack.github.io/Taier/)**
*   **[è½»é‡çº§çš„ Web IDE UI æ¡†æ¶â€”â€”Molecule](https://dtstack.github.io/molecule/)**
*   **[é’ˆå¯¹å¤§æ•°æ®é¢†åŸŸçš„ SQL Parser é¡¹ç›®â€”â€”dt-sql-parser](https://dtstack.github.io/monaco-sql-languages/)**
*   **[è¢‹é¼ äº‘æ•°æ ˆå‰ç«¯å›¢é˜Ÿä»£ç è¯„å®¡å·¥ç¨‹å®è·µæ–‡æ¡£â€”â€”code-review-practices](https://github.com/DTStack/code-review-practices)**
*   **[ä¸€ä¸ªé€Ÿåº¦æ›´å¿«ã€é…ç½®æ›´çµæ´»ã€ä½¿ç”¨æ›´ç®€å•çš„æ¨¡å—æ‰“åŒ…å™¨â€”â€”ko](https://github.com/DTStack/ko)**
*   **[ä¸€ä¸ªé’ˆå¯¹ antd çš„ç»„ä»¶æµ‹è¯•å·¥å…·åº“â€”â€”ant-design-testing](https://github.com/DTStack/ant-design-testing)**