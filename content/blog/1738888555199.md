---
layout: post
title: 'Windows 本地虚拟磁盘'
date: "2025-02-07T00:35:55Z"
---
Windows 本地虚拟磁盘
==============

本文介绍如何本地创建虚拟磁盘，本地虚拟磁盘可以在不扩展物理硬盘的情况下，新增磁盘、拆分文件的存储。  
虚拟磁盘vhdx是类似物理硬盘一样的磁盘，可以被格式化、内部添加分区，可以指定系统文件格式如NTFS、exFAT  
一个vhdx文件对应一个虚拟磁盘，下面我们来操作vhdx文件

### 1.创建VHDX

vhdx磁盘映像文件  
windows开始菜单-运行，输入“diskpart”打开磁盘命令行工具。

create vdisk file=C:\\Users\\yudong04\\Desktop\\test.vhdx maximum=100 type=expandable

主要参数：

*   file - 要创建VHDX文件的本地保存路径
*   maximum - 指定虚拟磁盘的大小(MB)，这里是100M
*   type - expandable表示虚拟磁盘为动态扩展，默认是fixed创建固定大小的磁盘

有需要了解其它参数的，可以help create vdisk查看。如source、parent，是针对现有vhdx创建新vhdx文件的场景  
如需要显示界面，可以打开磁盘管理工具-操作-创建VHD，在下面弹框中完成VHDX文件创建：

![](https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/cf1f445a5340490794a86104eb9d5391.png&code=VjJwQTc4STNfMTczODg0ODUxMTc5MA==)

2.挂载VHDX
--------

选择vhdx文件挂载：

select vdisk file=C:\\Users\\yudong04\\Desktop\\test.vhdx   
attach vdisk

挂载之后，可以通过list vdisk以及list disk查看列表情况：  

![](https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/59313c829a634eaa9e008124ec8a94c0.png&code=aEROa3I3dk1fMTczODg0ODUyOTM5Nw==)

也可以打开磁盘管理工具查看

### 3.初始化磁盘

继续用diskpart初始化磁盘：

select disk 3   
create partition primary

这里我们是直接创建主分区，还有其efi、msr等：

*   primary - 主分区，一般使用这个选项，用于创建启动分区、基本数据分区。
*   msr - 保留分区
*   efi - EFI系统分区，用于UEFI系统加载，一般我们用不上
*   extended - 扩展分区，只用于后续容纳逻辑分区，相当于容器
*   logical - 逻辑分区，在扩展分区内创建一个逻辑分区。用于突破一个磁盘只能创建4个paramary主分区的限制。

值得说明的是，不同磁盘GPT、MBR格式，创建primary分区得到的分区分别是：

*   GPT格式，基本数据分区
*   MBR格式，主分区

当然，我们默认都是GPT，这是新的分区方案，可以支持更大的磁盘容量及更多分区。另外，系统启动那块，我们win11之后有且仅有支持UEFI+GPT的启动方式。。。win8之前的BIOS+MBR启动方案，在后续windows已经弃用了  
创建分区时，可以指定分区大小，下面命令指定了60M：

create partition primary size=60

然后，我们完成后续的磁盘格式化：

format fs=ntfs label="虚拟磁盘" compress 
assign letter=F

format格式化的主要参数：

*   fs表示文件系统类型，如NTFS、FAT32、exFAT，一般我们使用NTFS就行了，exFAT适合于跨系统的兼容，FAT32
*   quick表示快速格式化，如果用了quick就不需要设置下面的一些label等参数了
*   label="xx"，表示指定卷标名称（也叫驱动器名称，即我们设备驱动器列表见到盘符前面的设备名）
*   unit=n，分配单位大小，以字节为单位。默认系统会选择一个适合分区大小的单独，我们不需要设置
*   compress，针对NTFS文件系统格式，可以启用文件压缩。其它文件格式不适用

assign就是分配盘符，与当前盘符列表冲突时会提示分配不可用  
执行结果如下：  

![](https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/a3d0e68a7c03470d8963ecb372fe850d.png&code=QVdlYkxmOWlfMTczODg0ODU0NDU0OQ==)

磁盘管理器显示列表如下：

![](https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/6e4b832c745a4a079a029b86ac7af747.png&code=TE9icDdGdmRfMTczODg0ODU1Nzc5Nw==)

4.卸载VHDX
--------

磁盘有分区的情况下，卸载磁盘是无法操作成功的。  
我们需要先删除分区，

1 list disk 
2 select disk 3 
3 list partition 
4 select partition 1 
5 delete partition

执行结果：  

![](https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/d8013edd0ab546ceaacebcc99bddf42f.png&code=dW92Z0dqVEFfMTczODg0ODU2ODQ3Nw==)

然后卸载VHDX文件，这个操作也叫分离VHD：

1 list vdisk 
2 select vdisk file="C:\\Users\\yudong04\\Desktop\\test.vhdx" 
3 detach vdisk

命令行执行结果：  

![](https://office.netease.com/api/pub/file/download?path=cowork/2025/02/06/70132f42b0b742ed9f0b10e9e62219b8.png&code=Y3FxZ0lENzdfMTczODg0ODU4MDQ1Nw==)

   
以上本地虚拟磁盘的主要操作就这些了。详细的磁盘以及分区操作，可以查询官网文档[diskpart | Microsoft Learn](https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/diskpart)  
注：本地虚拟磁盘，并没有扩容存储空间，只是相当于在原有硬盘上增加了个分区，方便用户隔离存储。

作者：[唐宋元明清2188](http://www.cnblogs.com/kybs0/)

出处：[http://www.cnblogs.com/kybs0/](http://www.cnblogs.com/kybs0/)

让学习成为习惯，假设明天就有重大机遇等着你，你准备好了么

本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须在文章页面给出原文连接，否则保留追究法律责任的权利。