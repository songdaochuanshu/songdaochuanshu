---
layout: post
title: 'æ‰‹æŠŠæ‰‹æå®šFastAPIé™æ€æ–‡ä»¶ï¼šå®‰å…¨ã€ä¸Šä¼ ä¸è®¿é—®'
date: "2026-01-03T00:43:05Z"
---
æ‰‹æŠŠæ‰‹æå®šFastAPIé™æ€æ–‡ä»¶ï¼šå®‰å…¨ã€ä¸Šä¼ ä¸è®¿é—®
=========================

æœ¬æ–‡ç³»ç»Ÿè®²è§£äº†FastAPIæ¡†æ¶ä¸­é™æ€æ–‡ä»¶çš„åŠ è½½ã€å­˜å‚¨ã€å®‰å…¨è®¾ç½®ä»¥åŠåª’ä½“æ–‡ä»¶ä¸Šä¼ ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œé€šè¿‡å…·ä½“ä»£ç ç¤ºä¾‹è¯¦ç»†è¯´æ˜äº†å¦‚ä½•æŒ‚è½½é™æ€ç›®å½•ã€è®¾ç½®å®‰å…¨é˜²æŠ¤ã€å¤„ç†faviconè¯·æ±‚å’Œå®ç°æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå¯ç›´æ¥è¿è¡Œçš„å®Œæ•´å®æˆ˜æ¡ˆä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€ŸæŒæ¡åœ¨FastAPIé¡¹ç›®ä¸­é«˜æ•ˆå®‰å…¨åœ°ç®¡ç†å„ç±»æ–‡ä»¶èµ„æºã€‚

ä½ çš„FastAPIåº”ç”¨è¿˜åœ¨â€œè£¸å¥”â€å—ï¼Ÿè¶…è¿‡70%çš„Webåº”ç”¨å®‰å…¨é—®é¢˜æºäºé™æ€èµ„æºçš„ä¸å½“é…ç½®ï¼

> è¿™ç¯‡æ–‡ç« å°†å¸¦ä½ ç³»ç»ŸæŒæ¡FastAPIä¸­é™æ€æ–‡ä»¶å¤„ç†çš„æ–¹æ–¹é¢é¢ï¼Œä¸æ­¢æ˜¯ç®€å•çš„â€œæŒ‚è½½â€ï¼Œæ›´æ¶µç›–å®‰å…¨é˜²æŠ¤ã€æ€§èƒ½æŠ€å·§å’Œå®æˆ˜å‘ç‚¹ï¼ŒåŒ…å«ä¸€ä¸ªå¯ç›´æ¥è¿è¡Œçš„å®Œæ•´ç¤ºä¾‹ã€‚  
>   
> \- ğŸ“‚ é™æ€æ–‡ä»¶çš„åŠ è½½ã€å­˜å‚¨ä¸åº”ç”¨åœºæ™¯  
> \- ğŸ›¡ï¸ è‡³å…³é‡è¦çš„é™æ€æ–‡ä»¶å®‰å…¨è®¾ç½®  
> \- ğŸ¯ ä¸€è¡Œä»£ç æå®šç½‘ç«™favicon  
> \- ğŸ–¼ï¸ å¤„ç†å›¾ç‰‡ç­‰åª’ä½“æ–‡ä»¶çš„ä¸Šä¼ ä¸è®¿é—®

âœ¨ ç›®å½•ä¸€è§ˆ
------

\- ğŸš€ èµ·æ­¥ï¼šä¸ºä»€ä¹ˆéœ€è¦å¤„ç†é™æ€æ–‡ä»¶ï¼Ÿ  
\- ğŸ“ FastAPIçš„â€œæ–‡ä»¶ç®¡å®¶â€ï¼šStaticFiles  
\- ğŸ”’ ç»™é™æ€æ–‡ä»¶åŠ æŠŠâ€œé”â€ï¼šå®‰å…¨è®¾ç½®è¯¦è§£  
\- â­ å°å›¾æ ‡å¤§å­¦é—®ï¼šFaviconçš„å¤„ç†  
\- ğŸ¬ ä¸æ­¢äºå›¾ç‰‡ï¼šåª’ä½“æ–‡ä»¶çš„ä¸Šä¼ ä¸å“åº”  
\- ğŸ§ª å®æˆ˜æ¼”ç»ƒï¼šä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹åº”ç”¨

ğŸš€ èµ·æ­¥ï¼šä¸ºä»€ä¹ˆéœ€è¦å¤„ç†é™æ€æ–‡ä»¶ï¼Ÿ
------------------

ä½ çš„APIå¾ˆé…·ï¼Œä½†ç”¨æˆ·è®¿é—® `http://localhost:8000/logo.png` å´å¾—åˆ°404ï¼Ÿè¿™æ˜¯å› ä¸ºFastAPIé»˜è®¤æ˜¯ä¸ªçº¯ç²¹çš„APIæ¡†æ¶ï¼Œ**å®ƒä¸ä¼šè‡ªåŠ¨æä¾›åƒå›¾ç‰‡ã€CSSã€JavaScriptè¿™æ ·çš„é™æ€æ–‡ä»¶ã€‚**

é™æ€æ–‡ä»¶æ˜¯é‚£äº›å†…å®¹å›ºå®šã€ä¸ç»å¸¸æ”¹å˜çš„æ–‡ä»¶ã€‚å®ƒä»¬å¯¹äºæ„å»ºä¸€ä¸ªå®Œæ•´çš„Webåº”ç”¨æˆ–APIæ–‡æ¡£é—¨æˆ·è‡³å…³é‡è¦ã€‚

ğŸ“ FastAPIçš„â€œæ–‡ä»¶ç®¡å®¶â€ï¼šStaticFiles
-----------------------------

å¼•å…¥`StaticFiles`ï¼Œä½ å°±èƒ½è½»æ¾æ­å»ºä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ã€‚å…¶æ ¸å¿ƒä¸‰æ­¥æ³•ï¼š

\- å¯¼å…¥ï¼š`from fastapi.staticfiles import StaticFiles`  
\- æŒ‚è½½ï¼šå°†URLè·¯å¾„â€œæŒ‚è½½â€åˆ°ä¸€ä¸ªå®é™…ç›®å½•ã€‚  
\- åº”ç”¨ï¼šä½¿ç”¨`app.mount`æ–¹æ³•ã€‚

    from fastapi import FastAPI
    from fastapi.staticfiles import StaticFiles
    
    app = FastAPI()
    
    # å°†è·¯å¾„ â€œ/staticâ€ æ˜ å°„åˆ°é¡¹ç›®ä¸‹çš„ â€œstaticâ€ ç›®å½•
    app.mount("/static", StaticFiles(directory="static"), name="static")

**ç†è§£â€œæŒ‚è½½â€**ï¼šå®ƒæ„å‘³ç€æ‰€æœ‰è®¿é—®`/static/*`çš„è¯·æ±‚ï¼Œéƒ½ä¼šç”±`StaticFiles`å®ä¾‹å»`./static`ç›®å½•ä¸‹æŸ¥æ‰¾å¯¹åº”æ–‡ä»¶ã€‚å®ƒä¸æ˜¯APIè·¯ç”±ï¼Œè€Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å­åº”ç”¨ã€‚

ğŸ”’ ç»™é™æ€æ–‡ä»¶åŠ æŠŠâ€œé”â€ï¼šå®‰å…¨è®¾ç½®è¯¦è§£
--------------------

å¼€æ”¾æ–‡ä»¶è®¿é—®æ˜¯å±é™©çš„ï¼é”™è¯¯çš„é…ç½®å¯èƒ½å¯¼è‡´æ•æ„Ÿæ–‡ä»¶æ³„éœ²ï¼ˆå¦‚`.env`ã€`.git`ç›®å½•ï¼‰ã€‚

1\. **é™åˆ¶ç›®å½•è®¿é—®èŒƒå›´**ï¼šæ°¸è¿œä¸è¦å°†æ ¹ç›®å½•â€œ`/`â€æŒ‚è½½åˆ°é™æ€æ–‡ä»¶æœåŠ¡ã€‚åŠ¡å¿…ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„ã€æƒé™æ˜ç¡®çš„å­ç›®å½•ï¼ˆå¦‚`static`ã€`assets`ï¼‰ã€‚

2\. **ä½¿ç”¨â€œhtml=Trueâ€å®‰å…¨åœ°æä¾›HTML**ï¼šå¦‚æœä½ æƒ³æä¾›å•é¡µåº”ç”¨ï¼ˆå¦‚Vue/Reactæ„å»ºçš„äº§ç‰©ï¼‰ï¼Œå¯ä»¥è®¾ç½®`html=True`ï¼Œå¹¶è®©`index.html`ä½œä¸ºç›®å½•çš„é»˜è®¤é¡µã€‚

    # å®‰å…¨åœ°æä¾›å‰ç«¯æ„å»ºäº§ç‰©ç›®å½•
    app.mount("/app", StaticFiles(directory="./frontend/dist", html=True), name="spa_app")

æ³¨æ„ï¼š`html=True`åªå¯¹æä¾›å‰ç«¯SPAå‹å¥½ï¼Œå®ƒæœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚çœŸæ­£çš„å®‰å…¨åœ¨äºå¯¹`directory`å‚æ•°çš„æ§åˆ¶ã€‚

â­ å°å›¾æ ‡å¤§å­¦é—®ï¼šFaviconçš„å¤„ç†
-------------------

æµè§ˆå™¨ä¼šè‡ªåŠ¨è¯·æ±‚`/favicon.ico`ã€‚å¦‚æœä½ æ²¡å¤„ç†ï¼Œæ—¥å¿—é‡Œå°±ä¼šå †æ»¡404é”™è¯¯ï¼Œæ˜¾å¾—ä¸ä¸“ä¸šã€‚

æœ€ç®€å•çš„æ–¹æ³•ï¼šç›´æ¥æŠŠå®ƒå½“æˆä¸€ä¸ªé™æ€æ–‡ä»¶å¤„ç†ã€‚

    # æ–¹æ³•ï¼šä¸ºfavicon.icoå•ç‹¬è®¾ç½®ä¸€ä¸ªè·¯å¾„è·¯ç”±ï¼ˆæˆ–å°†å®ƒæ”¾åœ¨staticç›®å½•ï¼‰
    from fastapi.responses import FileResponse
    
    @app.get("/favicon.ico")
    async def favicon():
        return FileResponse("static/favicon.ico")

è¿™èƒ½ä¸€åŠ³æ°¸é€¸åœ°æ¶ˆé™¤é‚£ä¸ªçƒ¦äººçš„404è¯·æ±‚ã€‚

ğŸ¬ ä¸æ­¢äºå›¾ç‰‡ï¼šåª’ä½“æ–‡ä»¶çš„ä¸Šä¼ ä¸å“åº”
-------------------

é™æ€æ–‡ä»¶æ˜¯â€œè¯»â€ï¼Œåª’ä½“æ–‡ä»¶åˆ™å¸¸æ¶‰åŠâ€œå†™â€ï¼ˆä¸Šä¼ ï¼‰ã€‚FastAPIå¤„ç†ä¸Šä¼ éå¸¸ä¼˜é›…ã€‚

\- **ä¸Šä¼ **ï¼šä½¿ç”¨`File`å’Œ`UploadFile`ã€‚  
\- **å­˜å‚¨**ï¼šä½¿ç”¨`shutil`æˆ–`aiofiles`å†™å…¥ç‰¹å®šç›®å½•ï¼ˆå¦‚`media/`ï¼‰ã€‚  
\- **è®¿é—®**ï¼šå†æ¬¡å€ŸåŠ©`StaticFiles`æŒ‚è½½`media/`ç›®å½•ã€‚

    from fastapi import File, UploadFile
    import shutil
    import os
    
    UPLOAD_DIR = "media"
    os.makedirs(UPLOAD_DIR, exist_ok=True)
    
    @app.post("/upload/image/")
    async def upload_image(file: UploadFile = File(...)):
        file_path = os.path.join(UPLOAD_DIR, file.filename)
        with open(file_path, "wb") as buffer:
            shutil.copyfileobj(file.file, buffer)
        return {"filename": file.filename, "url": f"/media/{file.filename}"}
    
    # æŒ‚è½½ä¸Šä¼ çš„åª’ä½“æ–‡ä»¶ç›®å½•
    app.mount("/media", StaticFiles(directory="media"), name="media")

ğŸ§ª å®æˆ˜æ¼”ç»ƒï¼šä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹åº”ç”¨
-----------------

ä¸‹é¢æ˜¯ä¸€ä¸ªæ•´åˆäº†ä¸Šè¿°æ‰€æœ‰çŸ¥è¯†ç‚¹çš„å®Œæ•´`main.py`æ–‡ä»¶ï¼Œå¤åˆ¶å³å¯è¿è¡Œä½“éªŒã€‚

    from fastapi import FastAPI, File, UploadFile, Request
    from fastapi.staticfiles import StaticFiles
    from fastapi.responses import FileResponse, HTMLResponse
    import shutil
    import os
    from pathlib import Path
    
    app = FastAPI()
    
    # 1. åˆ›å»ºå¿…è¦çš„ç›®å½•
    static_dir = Path("static")
    media_dir = Path("media")
    static_dir.mkdir(exist_ok=True)
    media_dir.mkdir(exist_ok=True)
    
    # 2. æŒ‚è½½é™æ€æ–‡ä»¶ç›®å½•ï¼ˆå­˜æ”¾CSSï¼ŒJSï¼Œé¢„ç½®å›¾ç‰‡ï¼‰
    app.mount("/static", StaticFiles(directory=static_dir), name="static")
    
    # 3. æŒ‚è½½åª’ä½“æ–‡ä»¶ç›®å½•ï¼ˆå­˜æ”¾ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ï¼‰
    app.mount("/media", StaticFiles(directory=media_dir), name="media")
    
    # 4. å¤„ç†faviconè¯·æ±‚
    @app.get("/favicon.ico", include_in_schema=False)
    async def get_favicon():
        # å‡è®¾ä½ çš„favicon.icoæ”¾åœ¨staticç›®å½•ä¸‹
        return FileResponse(static_dir / "favicon.ico")
    
    # 5. æ–‡ä»¶ä¸Šä¼ æ¥å£
    @app.post("/upload/")
    async def create_upload_file(file: UploadFile = File(...)):
        # ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶åˆ°mediaç›®å½•
        save_path = media_dir / file.filename
        with save_path.open("wb") as buffer:
            shutil.copyfileobj(file.file, buffer)
        # è¿”å›æ–‡ä»¶çš„è®¿é—®URL
        return {"url": f"/media/{file.filename}"}
    
    # 6. ä¸€ä¸ªç®€å•çš„å‰ç«¯é¡µé¢ï¼Œç”¨äºæ¼”ç¤ºå’Œæµ‹è¯•ä¸Šä¼ 
    @app.get("/", response_class=HTMLResponse)
    async def main():
        return """
        <html>
            <head>
                <title>FastAPIé™æ€æ–‡ä»¶æ¼”ç¤º</title>
            </head>
            <body>
                <h2>ä¸Šä¼ å›¾ç‰‡æµ‹è¯•</h2>
                <form action="/upload/" enctype="multipart/form-data" method="post">
                <input name="file" type="file">
                <input type="submit">
                </form>
                <br>
                <h3>å°è¯•è®¿é—®ï¼š</h3>
                <ul>
                    <li><a href="/static/example.txt">é¢„ç½®çš„é™æ€æ–‡ä»¶ (/static/example.txt)</a></li>
                    <li>ä¸Šä¼ åï¼Œè®¿é—®ï¼š<code>/media/[ä½ çš„æ–‡ä»¶å]</code></li>
                </ul>
            </body>
        </html>
        """
    
    if __name__ == "__main__":
        import uvicorn
        uvicorn.run(app, host="0.0.0.0", port=8000)

è¿è¡Œåï¼Œè®¿é—® `http://localhost:8000` å³å¯ä½“éªŒä¸Šä¼ å’Œè®¿é—®æ–‡ä»¶ã€‚è®°å¾—å…ˆåœ¨`static/`ç›®å½•ä¸‹æ”¾ä¸ª`example.txt`æ–‡ä»¶ã€‚

\---

å–œæ¬¢æœ¬æ–‡ï¼Ÿä¸è¦é”™è¿‡âœ¨ï¼Œç‚¹èµğŸ‘æ”¶è—â­å…³æ³¨æˆ‘ğŸ‘†ï¼Œä¸€èµ·å­¦ä¹ æ›´å¤šæœ‰ç”¨çš„çŸ¥è¯†ï¼Œå®Œå–„ä½ æˆ‘çš„æŠ€èƒ½æ ‘ï¼ä¹Ÿè¯·è·¯è¿‡çš„å¤§ä½¬ç»™äº›å»ºè®®å’ŒæŒ‡æ•™ğŸ‘‰ğŸ‘ˆğŸ¥ºï¼