---
layout: post
title: 'æœ¬åœ°ï¼Ÿçº¿ä¸Šï¼Ÿåˆ†å¸ƒå¼ç³»ç»Ÿå‰åç«¯æ¶æ„ã€éƒ¨ç½²ã€è”è°ƒæŒ‡å—ï¼Œçªç ´æŠ€æœ¯'
date: "2025-02-27T00:37:04Z"
---
æœ¬åœ°ï¼Ÿçº¿ä¸Šï¼Ÿåˆ†å¸ƒå¼ç³»ç»Ÿå‰åç«¯æ¶æ„ã€éƒ¨ç½²ã€è”è°ƒæŒ‡å—ï¼Œçªç ´æŠ€æœ¯
=============================

> â€œ  
> å¼•è¨€ï¼šå¯¹äºå¸¸è§çš„BSæ¶æ„ç³»ç»Ÿï¼Œç¨‹åºå‘˜å¦‚ä½•è¿›è¡Œæœ¬åœ°æˆ–è€…çº¿ä¸Šç¯  
> å¢ƒè”è°ƒï¼Œè¿™æœ‰åŠ©äºæé«˜ä¸ªäººå·¥ä½œæ•ˆç‡ï¼Œç«™åœ¨æ›´é«˜çš„è§’åº¦å®¡è§†ç³»ç»Ÿï¼Œ  
> ä»æ­¤ä»¥åå†æ— æƒ§Bugï¼Œè®©ä½ æ—©å¹²å®Œæ´»ï¼Œæ—©æ‘¸é±¼ğŸŸï¼Œæ—©ä¸‹ç­ã€‚  
> å¯¹äºJavaåˆå­¦è€…ï¼Œæˆ–è€…æ˜¯ä¸‰å¹´å·¥ä½œç»éªŒçš„â€œæ–°æ‰‹â€  
> ï¼Œå¸Œæœ›æ­¤æ–‡å¯¹ä½ æœ‰æ‰€è£¨ç›Šï¼
> 
> \-- è¯—ç»æœ‰äº‘ï¼Œæœ‰åŒªå›å­ï¼Œå¦‚åˆ‡å¦‚ç£‹ï¼Œå¦‚ç¢å¦‚ç£¨ã€‚

å‰ç«¯å¯åŠ¨ä¹‹åï¼Œè®¿é—®åç«¯æœåŠ¡ï¼Œéœ€è¦é€šè¿‡ä»£ç†æŒ‡å‘ç›®æ ‡æœåŠ¡å™¨ï¼Œæœ¬æ–‡åŸºäºVue+SpringCloud Gateway+K8s(kubernetes)+Nginxè®²è§£å¦‚ä¸‹ä¸‰ç§åœºæ™¯ï¼š

*   æœ¬åœ°å‰ç«¯å¯¹æ¥æœ¬åœ°åç«¯ï¼šå…ˆå¯åŠ¨åç«¯ï¼Œæµè§ˆå™¨è®¿é—®æœ¬åœ°å‰ç«¯ç¯å¢ƒlocalhost:port+/apiï¼Œæœ¬åœ°å‰ç«¯å†é€šè¿‡é…ç½®vue.config.jsä»£ç†è®¿é—®æœ¬åœ°åç«¯æœåŠ¡å¹¶é‡å†™/apiè§„åˆ™
*   çº¿ä¸Šå‰ç«¯å¯¹æ¥çº¿ä¸Šåç«¯ï¼šæµè§ˆå™¨è®¿é—®çº¿ä¸Šk8såŸŸåï¼ˆingressï¼‰+/apiï¼Œçº¿ä¸Šk8såŸŸåï¼ˆingressï¼‰/apiå†è½¬å‘åˆ°çº¿ä¸Šå‰ç«¯æœåŠ¡ï¼Œçº¿ä¸Šå‰ç«¯æœåŠ¡å†…ç½®nginxé€šè¿‡nginx.confæ¥ä»£ç†å¹¶é‡å†™/apiè§„åˆ™è®¿é—®çº¿ä¸Šåç«¯æœåŠ¡
*   æœ¬åœ°å‰ç«¯å¯¹æ¥çº¿ä¸Šåç«¯ï¼šå…ˆå¯åŠ¨åç«¯ï¼Œæµè§ˆå™¨è®¿é—®æœ¬åœ°å‰ç«¯ç¯å¢ƒlocalhost:portï¼Œæœ¬åœ°å‰ç«¯å†é€šè¿‡é…ç½®vue.config.jsä»£ç†è®¿é—®çº¿ä¸ŠåŸŸå+/api

ä»¥ä¸Šå¦‚æœæ˜¯åˆ†å¸ƒå¼åœºæ™¯ï¼Œåˆ™é€šè¿‡vue.config.jsä»£ç†æˆ–è€…nginx.confæ¥ä»£ç†ä¹‹åï¼Œåç«¯ç»Ÿä¸€å…¥å£æŒ‡çš„æ˜¯åç«¯ç½‘å…³æœåŠ¡GateWayï¼Œè¯·æ±‚æ ¼å¼ç»Ÿä¸€æ˜¯ `host[:port]+/api+/service-name`

*   ç¬¬ä¸€å±‚å£³/apiç”±vue.config.jsä»£ç†æˆ–è€…nginx.confä»£ç†å»æ‰
*   ç¬¬äºŒå±‚å£³ç”±åç«¯ç½‘å…³æœåŠ¡GateWayå»æ‰
*   æœ€ç»ˆç”±åç«¯ç½‘å…³æœåŠ¡GateWayè½¬å‘åˆ°å…·ä½“çš„å¾®æœåŠ¡

æœ¬åœ°ç¯å¢ƒå¯¹æ¥æœ¬åœ°åç«¯vue.config.js
-----------------------

vue.config.js

*   é…ç½®ä»£ç†ç›®æ ‡æœåŠ¡å™¨åœ°å€ï¼Œ`target: 'http://localhost:8034',`
*   é…ç½®/apiå‰ç¼€é‡å†™è§„åˆ™ï¼Œå»å£³/apiï¼Œ`pathRewrite: {'^/api': ''}`

![](https://img2024.cnblogs.com/blog/1846149/202502/1846149-20250226221508829-960302231.png)

vue.config.jså…¨é‡é…ç½®å¦‚ä¸‹ï¼Œé‡ç‚¹æ˜¯proxyé…ç½®ï¼š

        devServer: {
            disableHostCheck: true,
            hot: true,
            port: devPort,
            open: false,
            noInfo: false,
            overlay: {
                warnings: true,
                errors: true
            },
            after: require('./mock/mock-server.js'),
            headers: {
                'Access-Control-Allow-Origin': '*'
            },
            proxy: {
                '/api': { 
                    target: 'http://localhost:8034',
                    // target: 'https://åå°åŸŸå/api',
                    ws: true,
                    secure: false,
                    changeOrigin: true,
                    pathRewrite: {
                        '^/api': ''
                    }
                }
            }
        },
    

çº¿ä¸Šç¯å¢ƒå¯¹æ¥çº¿ä¸Šåç«¯ingress+nginx
-----------------------

k8sçš„ingressé…ç½®å¦‚ä¸‹ï¼š

*   é…ç½®ä»£ç†ç›®æ ‡æœåŠ¡å™¨åœ°å€ï¼Œå¹¶è½¬å‘ç»™æ‰“åŒ…åçš„å‰ç«¯çº¿ä¸ŠæœåŠ¡

    apiVersion: networking.k8s.io/v1
    kind: Ingress
    metadata:
      annotations:
        vke.volcengine.com/description: ""
      creationTimestamp: "2024-06-27T07:41:41Z"
      generation: 2
      managedFields:
        manager: nginx-ingress-controller
        operation: Update
        time: "2024-06-27T07:42:15Z"
      name: xxx-ingress-https
      namespace: xxx-test
    spec:
      ingressClassName: nginx
      rules:
      - host: è®¿é—®åŸŸå
        http:
          paths:
          - backend:
              service:
                name: xxx-web
                port:
                  number: 80
            path: /
            pathType: Prefix
      tls:
      - secretName: ingress-cert
    

é¦–å…ˆè¯·æ±‚é€šè¿‡åŸŸåæ¥åˆ°ingressï¼Œç„¶åé€šè¿‡ingressè½¬å‘ç»™å‰ç«¯æœåŠ¡xxx-webï¼ˆk8sæœåŠ¡ï¼‰

![](https://img2024.cnblogs.com/blog/1846149/202502/1846149-20250226221530887-769141929.png)

å‰ç«¯æœåŠ¡xxx-webæ˜¯å‰ç«¯æ‰“åŒ…ä¹‹åï¼Œä»¥nginxä¸ºåŸºç¡€çš„dockeré•œåƒæœåŠ¡ï¼Œå…¶nginx.confé…ç½®ï¼ˆk8sé…ç½®é¡¹configmapï¼‰,å…³é”®ä¿¡æ¯å¦‚ä¸‹

*   è½¬å‘ç»™çº¿ä¸Šåç«¯çš„ç½‘å…³gatewayæœåŠ¡ï¼š`proxy_pass http://xxx-gateway:8034;`
*   é…ç½®/apiå‰ç¼€é‡å†™è§„åˆ™ï¼Œ`rewrite ^/api/(.*)$ /$1 break;`

    server {
        listen 80;
        server_name  _;
        client_max_body_size 300m;
    
        #access_log  /var/log/nginx/host.access.log  main;
        add_header Access-Control-Allow-Credentials true;
        add_header Access-Control-Allow-Origin * always;
        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS' always;
        add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-prototype-Version,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization' always;
        server_tokens off;
        real_ip_header   X-Forwarded-For;
        real_ip_recursive on;
    
    
        location / {
            root   /etc/nginx/html/;
            index  index.html index.htm;
            try_files $uri $uri/ /index.html;
        } 
        location ^~/api/actuator {
        deny all;
        }
        location ^~/api { 
          proxy_set_header Host $host; 
          proxy_set_header X-Real-IP $remote_addr; 
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
          proxy_buffering off; 
          add_header Cache-Control no-store; 
          rewrite ^/api/(.*)$ /$1 break; 
          proxy_pass http://service-gateway:8034; 
          }
    
    
      
    }
    

æœ¬åœ°ç¯å¢ƒå¯¹æ¥çº¿ä¸Šåç«¯vue.config.js
-----------------------

è¿™ç§æƒ…å†µæ˜¯ä¸ºäº†æœ¬åœ°å‰ç«¯è”è°ƒçº¿ä¸Šçš„åç«¯æµ‹è¯•ç¯å¢ƒï¼ŒåŸç†ä¸æœ¬åœ°ç¯å¢ƒå¯¹æ¥æœ¬åœ°åç«¯ï¼Œéƒ½åªæ˜¯å¾ˆç®€å•çš„æ­£å‘ä»£ç†vue.config.js

åŒºåˆ«æ˜¯vue.config.jsé‡Œçš„targetåœ°å€è¦æ”¹æˆçº¿ä¸Šçš„åŸŸååœ°å€+/api

![](https://img2024.cnblogs.com/blog/1846149/202502/1846149-20250226221544026-1432420839.png)

vue.config.jsç®€åŒ–ç‰ˆé…ç½®å¦‚ä¸‹

*   é…ç½®ä»£ç†ç›®æ ‡æœåŠ¡å™¨åœ°å€ï¼Œ`target: 'https://åå°åŸŸå/api',`
*   é…ç½®/apiå‰ç¼€é‡å†™è§„åˆ™ï¼Œå»å£³/apiï¼Œ`pathRewrite: {'^/api': ''}`

        devServer: {
            disableHostCheck: true,
            hot: true,
            port: devPort,
            open: false,
            noInfo: false,
            overlay: {
                warnings: true,
                errors: true
            },
            after: require('./mock/mock-server.js'),
            headers: {
                'Access-Control-Allow-Origin': '*'
            },
            proxy: {
                '/api': { 
                    //target: 'http://localhost:8034',
                    target: 'https://åå°åŸŸå/api',
                    ws: true,
                    secure: false,
                    changeOrigin: true,
                    pathRewrite: {
                        '^/api': ''
                    }
                }
            }
        },