---
layout: post
title: 'easy-queryéšå¼Groupé©å‘½æ€§OLAPä¼˜åŒ–JAVAä¸‹æœ€å¼ºæŸ¥è¯¢ORMæ²¡æœ‰ä¹‹ä¸€å­æŸ¥è¯¢åˆå¹¶'
date: "2025-04-21T00:42:28Z"
---
easy-queryéšå¼Groupé©å‘½æ€§OLAPä¼˜åŒ–JAVAä¸‹æœ€å¼ºæŸ¥è¯¢ORMæ²¡æœ‰ä¹‹ä¸€å­æŸ¥è¯¢åˆå¹¶
===============================================

easy-query JAVAä¸‹æœ€å¼ºæŸ¥è¯¢ORMæ²¡æœ‰ä¹‹ä¸€çš„ä»»æ„å­æŸ¥è¯¢åˆå¹¶é©å‘½æ€§OLAPä¼˜åŒ–
============================================

å‰è¨€
--

å¯¹äºå¤§éƒ¨åˆ†OLTPè€Œè¨€çš„æŸ¥è¯¢å¸‚é¢ä¸Šå¸¸è§çš„ormå·²ç»èƒ½å¾ˆå¥½çš„å¤„ç†,åªè¦å»ºç«‹å¥½å¯¹è±¡å…³ç³»é‚£ä¹ˆå°±å¯ä»¥éå¸¸ç®€å•çš„å®ç°éšå¼joinæˆ–è€…éšå¼å­æŸ¥è¯¢

easy-queryä¸€æ¬¾å°†ORMçš„Relationalåœ¨æŸ¥è¯¢ä¸­è¡¨ç°å¾—æ·‹æ¼“å°½è‡´,æ”¯æŒæ‰‹åŠ¨joinã€æ‰‹åŠ¨å­æŸ¥è¯¢ä¹Ÿæ”¯æŒéšå¼joinã€éšå¼å­æŸ¥è¯¢å¹¶ä¸”æ”¯æŒæ‰‹åŠ¨å’Œéšå¼æ··ç”¨ï¼Œç»è¿‡2å¹´åŠæ—¶é—´çš„æ‰“ç£¨åŠªåŠ›ä»è¿½èµ¶.net ormåˆ°è¶…è¶Šæˆ‘æ•¢è¯´é‡Œé¢æœ‰ç€è®¸å¤šäººçš„åŠªåŠ›å’Œä¼—å¤šæ¡†æ¶ä½œè€…çš„æ€æƒ³å€Ÿé‰´æ‰èƒ½è®©easy-queryåœ¨çŸ­çŸ­2å¹´å˜å¾—è¶Šæ¥è¶Šå®Œå–„åŠŸèƒ½ä¹Ÿæ˜¯è¶Šæ¥è¶Šå¼ºå¤§

*   2023å¹´å¦‚ä½•å®ç°æ›´å¤šçš„sqlè®©ormåœ¨é¡¹ç›®å¼€å‘ä¸­å˜å¾—å¯ç”¨åšåˆ°é›¶sql
*   2024å®ç°å¦‚ä½•ä¸ä»¥ç¿»è¯‘sqlä¸ºç›®æ ‡å®ç°ç”¨æˆ·å¿ƒä¸­æ— sqlç¼–å†™è¡¨è¾¾å¼
*   2025è‡³ä»Šä¼˜åŒ–å¤æ‚sqlåœ¨olapä¸‹çš„ä¼˜åŒ–å¤„ç†

**å½“ä½ åœ¨æƒ³æ€ä¹ˆè¿è¡¨çš„æ—¶å€™ã€å½“ä½ åœ¨æƒ³è¿™ä¸ªsqlæ€ä¹ˆç¿»è¯‘æˆè¡¨è¾¾å¼çš„æ—¶å€™å…¶å®ä½ å·²ç»é™·å…¥äº†â€œè‡ªè¯â€çš„ç¯èŠ‚ï¼Œæˆ‘ä»¬åº”è¯¥è¦è€ƒè™‘çš„æ˜¯ä½ å¸Œæœ›å®ç°çš„åŠŸèƒ½æ¯”å¦‚æŸ¥è¯¢ç”¨æˆ·æ¡ä»¶æ˜¯é“¶è¡Œå¡æœ‰2å¼ çš„ï¼Œè€Œä¸æ˜¯å†™å¥½ä¸€å †sqlç„¶åé—®ormä½œè€…è¿™ä¸ªæ€ä¹ˆå†™ï¼Œä»é¢å‘sqlç»“æœå‘é¢å‘éœ€æ±‚ç¼–å†™è¡¨è¾¾å¼çš„è½¬å˜ã€‚**

ä»‹ç»
--

### easy-query

[æ–‡æ¡£åœ°å€](https://www.easy-query.com/easy-query-doc/) [https://www.easy-query.com/easy-query-doc/](https://www.easy-query.com/easy-query-doc/)

[GITHUBåœ°å€](https://github.com/dromara/easy-query) [https://github.com/dromara/easy-query](https://github.com/dromara/easy-query)

[GITEEåœ°å€](https://gitee.com/dromara/easy-query) [https://gitee.com/dromara/easy-query](https://gitee.com/dromara/easy-query)

å¯¹è±¡å…³ç³»
----

![](https://img2024.cnblogs.com/blog/1346660/202504/1346660-20250420224323130-687103965.svg)

### éšå¼join

å¸¸è§çš„éšå¼joinå¦‚ä¸‹

æŸ¥è¯¢é“¶è¡Œå¡è¦æ±‚æ˜¯ç­›é€‰æ¡ä»¶æ˜¯é“¶è¡Œå¡æ‰€å±ç”¨æˆ·æ‰‹æœºå·åŒ…å«1234å¹¶ä¸”æ‰€å±é“¶è¡Œæ˜¯å·¥å•†é“¶è¡Œçš„

    
            List<SysBankCard> bankCards = easyEntityQuery.queryable(SysBankCard.class)
                    .where(bank_card -> {
                        bank_card.user().phone().like("1234");
                        bank_card.bank().name().eq("å·¥å•†é“¶è¡Œ");
                    }).toList();
    
    

ç”Ÿæˆçš„sqlä¸º

    
        SELECT
            t.`id`,
            t.`uid`,
            t.`code`,
            t.`type`,
            t.`bank_id`,
            t.`open_time` 
        FROM
            `t_bank_card` t 
        LEFT JOIN
            `t_sys_user` t1 
                ON t1.`id` = t.`uid` 
        INNER JOIN
            `t_bank` t2 
                ON t2.`id` = t.`bank_id` 
        WHERE
            t1.`phone` LIKE '%1234%' 
            AND t2.`name` = 'å·¥å•†é“¶è¡Œ'
    

æœ‰äº›å°ä¼™ä¼´å°±å¾ˆå¥‡æ€ªä¸ºä»€ä¹ˆå¯¹äº`user`è€Œè¨€æ˜¯`left join`å¯¹äº`bank`è€Œè¨€ç¼ºæ˜¯`inner join`åŸå› å°±æ˜¯åœ¨åˆ›å»ºå¯¹è±¡å…³ç³»çš„æ—¶å€™æˆ‘ä»¬æŒ‡å®šäº†SysBankCardå’ŒSysBankçš„å…³ç³»æ˜¯å¤–é”®å…³ç³»æ‰€ä»¥ä¸å¯èƒ½å­˜åœ¨æœ‰é“¶è¡Œå¡æ²¡æœ‰é“¶è¡Œçš„æƒ…å†µ  
å…·ä½“å¯¹è±¡å¦‚ä¸‹

    
    @Table("t_bank")
    @EntityProxy
    @Data
    @FieldNameConstants
    @EasyAlias("bank")
    public class SysBank implements ProxyEntityAvailable<SysBank, SysBankProxy> {
        @Column(primaryKey = true)
        private String id;
        /**
         * é“¶è¡Œåç§°
         */
        private String name;
        /**
         * æˆç«‹æ—¶é—´
         */
        private LocalDateTime createTime;
    
        /**
         * æ‹¥æœ‰çš„é“¶è¡Œå¡
         */
        @Navigate(value = RelationTypeEnum.OneToMany,
                selfProperty = {"id"},
                targetProperty = {"bankId"})
        private List<SysBankCard> bankCards;
    }
    
    
    @Table("t_bank_card")
    @EntityProxy
    @Data
    @FieldNameConstants
    @EasyAlias("bank_card")
    public class SysBankCard implements ProxyEntityAvailable<SysBankCard , SysBankCardProxy> {
        @Column(primaryKey = true)
        private String id;
        private String uid;
        /**
         * é“¶è¡Œå¡å·
         */
        private String code;
        /**
         * é“¶è¡Œå¡ç±»å‹å€Ÿè®°å¡ å‚¨è“„å¡
         */
        private String type;
        /**
         * æ‰€å±é“¶è¡Œ
         */
        private String bankId;
        /**
         * ç”¨æˆ·å¼€æˆ·æ—¶é—´
         */
        private LocalDateTime openTime;
    
        /**
         * æ‰€å±é“¶è¡Œ
         */
        @Navigate(value = RelationTypeEnum.ManyToOne, selfProperty = {"bankId"}, targetProperty = {"id"})
        @ForeignKey//å¯ä»¥ä¸åŠ  åŠ äº†å°±æ˜¯InnerJoinå¤„ç†æ›´å¤šç»†èŠ‚æŸ¥çœ‹æ³¨è§£ç¯‡ç« 
        private SysBank bank;
    
        /**
         * æ‰€å±ç”¨æˆ·
         */
        @Navigate(value = RelationTypeEnum.ManyToOne, selfProperty = {"uid"}, targetProperty = {"id"})
        private SysUser user;
    }
    
    
    @Table("t_sys_user")
    @EntityProxy
    @Data
    @FieldNameConstants
    @EasyAlias("user")
    public class SysUser implements ProxyEntityAvailable<SysUser , SysUserProxy> {
        @Column(primaryKey = true)
        private String id;
        private String name;
        private String phone;
        private Integer age;
        private LocalDateTime createTime;
    
        /**
         * ç”¨æˆ·æ‹¥æœ‰çš„é“¶è¡Œå¡æ•°
         */
        @Navigate(value = RelationTypeEnum.OneToMany, selfProperty = {"id"}, targetProperty = {"uid"})
        private List<SysBankCard> bankCards;
    
        /**
         * ç”¨æˆ·æ‹¥æœ‰çš„ä¹¦æœ¬
         */
        @Navigate(value = RelationTypeEnum.OneToMany, selfProperty = {"id"}, targetProperty = {"uid"})
        private List<SysUserBook> userBooks;
    }
    
    
    @Table("t_sys_user_book")
    @EntityProxy
    @Data
    @FieldNameConstants
    @EasyAlias("user_book")
    public class SysUserBook implements ProxyEntityAvailable<SysUserBook , SysUserBookProxy> {
        private String id;
        private String name;
        private String uid;
        private BigDecimal price;
    }
    

æ¼”ç¤ºäº†éšå¼joinåæˆ‘åœ¨æ¼”ç¤ºå¯¹åº”çš„éšå¼å­æŸ¥è¯¢

### éšå¼å­æŸ¥è¯¢

ç­›é€‰å‡ºç”¨æˆ·æ‹¥æœ‰è‡³å°‘2å¼ å·¥å•†é“¶è¡Œå¡ä¸”è¿˜æœªåœ¨å»ºè®¾é“¶è¡Œå¼€æˆ·çš„ç”¨æˆ·

    List<SysUser> list = easyEntityQuery.queryable(SysUser.class)
            .where(user -> {
                user.bankCards().where(card -> {
                    card.bank().name().eq("å·¥å•†é“¶è¡Œ");
                }).count().ge(2L);
    
                user.bankCards().none(card -> {
                    card.bank().name().eq("å»ºè®¾é“¶è¡Œ");
                });
            }).toList();
    
    

ç”Ÿæˆçš„sqlä¸º

    SELECT
        t.`id`,
        t.`name`,
        t.`phone`,
        t.`age`,
        t.`create_time` 
    FROM
        `t_sys_user` t 
    WHERE
        (
            SELECT
                COUNT(*) 
            FROM
                `t_bank_card` t1 
            INNER JOIN
                `t_bank` t2 
                    ON t2.`id` = t1.`bank_id` 
            WHERE
                t1.`uid` = t.`id` 
                AND t2.`name` = 'å·¥å•†é“¶è¡Œ'
        ) >= 2 
        AND NOT ( EXISTS (SELECT
            1 
        FROM
            `t_bank_card` t3 
        INNER JOIN
            `t_bank` t4 
                ON t4.`id` = t3.`bank_id` 
        WHERE
            t3.`uid` = t.`id` 
            AND t4.`name` = 'å»ºè®¾é“¶è¡Œ' LIMIT 1))
    

è¿™é‡Œå‡ºç°äº†ä¸¤ä¸ªå­æŸ¥è¯¢åˆ†åˆ«æ˜¯\[è‡³å°‘2å¼ å·¥å•†é“¶è¡Œå¡\]å’Œ\[è¿˜æœªåœ¨å»ºè®¾é“¶è¡Œå¼€æˆ·çš„ç”¨æˆ·\]ä¸¤ä¸ªæ¡ä»¶

é‚£ä¹ˆåˆ°è¿™é‡Œå°±æ˜¯å¤§éƒ¨åˆ†ORMèƒ½åšçš„äº‹æƒ…äº†,ç”šè‡³å¤§éƒ¨åˆ†ORMè¿è¿™ç‚¹éƒ½åšä¸åˆ°,æ‰€ä»¥è¯´å¦‚æœä½ çš„ORMæ”¯æŒå­æŸ¥è¯¢é‚£ä¹ˆä½ çš„ORMåœ¨é¢å¯¹å¤æ‚æŸ¥è¯¢å¦‚æœåªèƒ½åšåˆ°è¿™ä¹ˆä¸€ç‚¹é‚£ä¹ˆåªèƒ½ç®—æ˜¯ä¸€ä¸ªåˆšåˆ°åŠæ ¼çº¿çš„ORM,å› ä¸ºå¦‚æœå‡ºç°å¤šä¸ªå­æŸ¥è¯¢æˆ–è€…åœ¨å¤šå¯¹å¤šä¸‹è¿™ç§å¤„ç†æ˜¯éå¸¸è‡´å‘½çš„ï¼Œå°¤å…¶æ˜¯æŸ¥è¯¢ç”¨æˆ·æ¡ä»¶æ˜¯èœå•ä¸º/adminè¿™ç§

æ­£ç‰‡å¼€å§‹
----

æ‰€è°“é±¼(å¯ç»´æŠ¤æ€§)å’Œç†ŠæŒ(æ€§èƒ½)ä¸å¯å…¼å¾—,é‚£ä¹ˆeasy-queryæ˜¯å¦‚ä½•å¤„ç†åƒè¿™ç§æƒ…å†µä¸‹çš„å‘¢ï¼Œåˆæ˜¯å¦‚ä½•è®©ä½ å…¼å¾—é±¼å’Œç†ŠæŒçš„æœ‰è¯·æˆ‘ä»¬çš„æœ¬æœŸä¸»è§’ã€éšå¼Groupã€‘

### éšå¼Group

ç­›é€‰å‡ºç”¨æˆ·æ‹¥æœ‰è‡³å°‘2å¼ å·¥å•†é“¶è¡Œå¡ä¸”è¿˜æœªåœ¨å»ºè®¾é“¶è¡Œå¼€æˆ·çš„ç”¨æˆ·

å¯¹äºç›¸åŒçš„æ¡ä»¶easy-queryåªéœ€è¦ä¸€ä¸ªé…ç½®å°±å¯ä»¥è®©ä½ å…¼å¾—é±¼(å¯ç»´æŠ¤æ€§)å’Œç†ŠæŒ(æ€§èƒ½)

    List<SysUser> list = easyEntityQuery.queryable(SysUser.class)
            //å¯ç”¨éšå¼group,æ— è®ºå®åœ¨whereè¿˜æ˜¯selecté‡Œé¢ç”¨åˆ°çš„bankCardså­æŸ¥è¯¢éƒ½ä¼šå¤ç”¨åŒä¸€ä¸ªéšå¼Group
            .subQueryToGroupJoin(u->u.bankCards())
            .where(user -> {
                //è‡³å°‘2å¼ å·¥å•†é“¶è¡Œ
                user.bankCards().where(card -> {
                    card.bank().name().eq("å·¥å•†é“¶è¡Œ");
                }).count().ge(2L);
    
                //æ²¡æœ‰å»ºè¡Œå¡
                user.bankCards().none(card -> {
                    card.bank().name().eq("å»ºè®¾é“¶è¡Œ");
                });
            }).toList();
    

æˆ‘ä»¬å†æ¥çœ‹ç”Ÿæˆçš„sql

    SELECT
        t.`id`,
        t.`name`,
        t.`phone`,
        t.`age`,
        t.`create_time`  
    FROM
        `t_sys_user` t 
    LEFT JOIN
        (
            SELECT
                t1.`uid` AS `uid`,
                COUNT((CASE WHEN t3.`name` = 'å·¥å•†é“¶è¡Œ' THEN 1 ELSE NULL END)) AS `__count2__`,
                (CASE WHEN COUNT((CASE WHEN t3.`name` = 'å»ºè®¾é“¶è¡Œ' THEN 1 ELSE NULL END)) > 0 THEN false ELSE true END) AS `__none3__` 
            FROM
                `t_bank_card` t1 
            INNER JOIN
                `t_bank` t3 
                    ON t3.`id` = t1.`bank_id` 
            GROUP BY
                t1.`uid`
        ) t2 
            ON t2.`uid` = t.`id` 
    WHERE
        IFNULL(t2.`__count2__`,0) >= 2 
        AND IFNULL(t2.`__none3__`,true) = true
    

æœ‰æ²¡æœ‰ä¸€ç§çœ¼å‰ä¸€äº®çš„æ„Ÿè§‰,æˆ‘æ•¢è¯´ç›®å‰æ¥è®²å¹¶æ²¡æœ‰å¤šå°‘ORMå®ç°äº†éšå¼Group,å½“ç„¶å¯¹äºOLAPè€Œè¨€easy-queryçš„æä¾›çš„åŠŸèƒ½è¿œä¸æ­¢æ­¤

partition by
------------

ç­›é€‰ç”¨æˆ·æ¡ä»¶ä¸ºå–œæ¬¢å·¥å•†é“¶è¡Œçš„(ç¬¬ä¸€å¼ å¼€æˆ·çš„é“¶è¡Œå¡æ˜¯å·¥å•†é“¶è¡Œçš„)

    List<SysUser> list = easyEntityQuery.queryable(SysUser.class)
            .where(user -> {
                //ç”¨æˆ·çš„é“¶è¡Œå¡ä¸­ç¬¬ä¸€ä¸ªå¼€æˆ·é“¶è¡Œå¡æ˜¯å·¥å•†é“¶è¡Œçš„
                user.bankCards().orderBy(x->x.openTime().asc()).firstElement().bank().name().eq("å·¥å•†é“¶è¡Œ");
            }).toList();
    

ç”Ÿæˆçš„sql

    SELECT
        t.`id`,
        t.`name`,
        t.`phone`,
        t.`age`,
        t.`create_time` 
    FROM
        `t_sys_user` t 
    LEFT JOIN
        (
            SELECT
                t2.`id` AS `id`,
                t2.`uid` AS `uid`,
                t2.`code` AS `code`,
                t2.`type` AS `type`,
                t2.`bank_id` AS `bank_id`,
                t2.`open_time` AS `open_time` 
            FROM
                (SELECT
                    t1.`id`,
                    t1.`uid`,
                    t1.`code`,
                    t1.`type`,
                    t1.`bank_id`,
                    t1.`open_time`,
                    (ROW_NUMBER() OVER (PARTITION BY t1.`uid` ORDER BY t1.`open_time` ASC)) AS `__row__` 
                FROM
                    `t_bank_card` t1) t2 
            WHERE
                t2.`__row__` = 1
            ) t4 
                ON t4.`uid` = t.`id` 
        INNER JOIN
            `t_bank` t5 
                ON t5.`id` = t4.`bank_id` 
        WHERE
            t5.`name` = 'å·¥å•†é“¶è¡Œ'
    

æ˜¯çš„ä½ æ²¡çœ‹é”™å°±æ˜¯è¿™ä¹ˆç®€å•å¦‚æœä½ éœ€è¦åŠ¨æ€é‚£ä¹ˆåªéœ€è¦ç”¨where(true/false,æ¡ä»¶)æˆ–è€…æ›´åŠ ç›´ç™½çš„æ–¹å¼å³å¯

ç­›é€‰ç”¨æˆ·æ¡ä»¶ä¸ºå–œæ¬¢å·¥å•†é“¶è¡Œçš„(ç¬¬ä¸€å¼ å¼€æˆ·çš„é“¶è¡Œå¡æ˜¯å·¥å•†é“¶è¡Œçš„)å’Œç”¨æˆ·å§“åå«å°æ˜çš„,å…¶ä¸­å–œæ¬¢å·¥å•†é“¶è¡Œè¿™ä¸ªæ¡ä»¶å¯ä»¥æ˜¯åŠ¨æ€çš„

    
            boolean likeICBC = false;
            String name = "å°æ˜";
            List<SysUser> list = easyEntityQuery.queryable(SysUser.class)
                    .where(user -> {
                        if(EasyStringUtil.isNotBlank(name)){
                            user.name().like(name);
                        }
                        if(likeICBC){
                            //ç”¨æˆ·çš„é“¶è¡Œå¡ä¸­ç¬¬ä¸€ä¸ªå¼€æˆ·é“¶è¡Œå¡æ˜¯å·¥å•†é“¶è¡Œçš„
                            user.bankCards().orderBy(x -> x.openTime().asc()).firstElement().bank().name().eq("å·¥å•†é“¶è¡Œ");
                        }
                    }).toList();
    

ç”Ÿæˆçš„sql

        SELECT
            `id`,
            `name`,
            `phone`,
            `age`,
            `create_time` 
        FROM
            `t_sys_user` 
        WHERE
            `name` LIKE '%å°æ˜%'
    

æ˜¯çš„ä½ æ²¡çœ‹é”™åŠ¨æ€partitionå°±æ˜¯è¿™ä¹ˆç®€å•å°±æ˜¯è¿™ä¹ˆå®¹æ˜“é˜…è¯»å’Œç»´æŠ¤

### selectå­æŸ¥è¯¢

å†™äº†è¿™ä¹ˆå¤šwhereå­æŸ¥è¯¢çš„éšå¼Groupé‚£ä¹ˆå†æ¥å†™ç‚¹selectå­æŸ¥è¯¢ç›¸å…³çš„å§

æŸ¥è¯¢ç”¨æˆ·è¿”å›ç”¨æˆ·å§“åå’Œç”¨æˆ·å¼€æˆ·çš„å‰ä¸¤å¼ é“¶è¡Œå¡ç±»å‹é€—å·åˆ†å‰²

    List<Draft2<String, String>> list = easyEntityQuery.queryable(SysUser.class)
                    .where(user -> {
                        user.name().like("å°æ˜");
    
                    }).select(user -> Select.DRAFT.of(
                            user.name(),
                            //ç”¨æˆ·çš„é“¶è¡Œå¡ä¸­å‰ä¸¤ä¸ªå¼€æˆ·é“¶è¡Œå¡ç±»å‹
                            user.bankCards().orderBy(x -> x.openTime().asc()).elements(0, 1).joining(x -> x.type(),",")
                    )).toList();
    

ç”Ÿæˆçš„sql

    SELECT
        t.`name` AS `value1`,
        (SELECT
            GROUP_CONCAT(t1.`type` SEPARATOR ',') 
        FROM
            `t_bank_card` t1 
        WHERE
            t1.`uid` = t.`id` 
        ORDER BY
            t1.`open_time` ASC LIMIT 2) AS `value2` 
    FROM
        `t_sys_user` t 
    WHERE
        t.`name` LIKE '%å°æ˜%'
    

### è¶…çº§æ— æ•Œç©¶æå­æŸ¥è¯¢è½¬groupğŸ”¥ğŸ”¥ğŸ”¥

ç­›é€‰ç”¨æˆ·æ¡ä»¶ä¸ºå§“ååŒ…å«å°æ˜,å¹¶ä¸”ç”¨æˆ·çš„æ‰€æœ‰å‚¨è“„å¡ä¸­å‰ä¸‰å¼ é“¶è¡Œå¡éƒ½ä¸æ˜¯åœ¨2000å¹´å‰çš„é“¶è¡Œä¸­å¼€æˆ·çš„,å¹¶ä¸”è¿”å›ç”¨æˆ·å§“åå’Œå‚¨è“„å¡çš„æ‰€å±é“¶è¡Œåç§°é€—å·åˆ†å‰²

    List<Draft2<String, String>> list = easyEntityQuery.queryable(SysUser.class)
            .subQueryToGroupJoin(x -> x.bankCards())
            .where(user -> {
                user.name().like("å°æ˜");
    
                user.bankCards()
                    .where(x -> x.type().eq("å‚¨è“„å¡"))
                    .orderBy(x -> x.openTime().asc()).elements(0, 2)
                    .none(x -> x.bank().createTime().ge(LocalDateTime.of(2000,1,1,0,0)));
    
            }).select(user -> Select.DRAFT.of(
                    user.name(),
                    user.bankCards()
                        .where(x -> x.type().eq("å‚¨è“„å¡"))
                        .orderBy(x -> x.openTime().asc())
                        .elements(0, 2).joining(x -> x.bank().name(),",")
            )).toList();
    
    
    

ç”Ÿæˆçš„sql

    SELECT
        t.`name` AS `value1`,
        t3.`__joining3__` AS `value2` 
    FROM
        `t_sys_user` t 
    LEFT JOIN
        (
            SELECT
                t2.`uid` AS `uid`,
                (CASE 
                    WHEN COUNT((CASE WHEN t4.`create_time` >= '2000-01-01 00:00' THEN 1 ELSE NULL END)) > 0 THEN false ELSE true 
                END) AS `__none2__`,
                GROUP_CONCAT(t4.`name` SEPARATOR ',') AS `__joining3__` 
            FROM
                (SELECT
                    t1.`id`,
                    t1.`uid`,
                    t1.`code`,
                    t1.`type`,
                    t1.`bank_id`,
                    t1.`open_time` 
                FROM
                    `t_bank_card` t1 
                WHERE
                    t1.`type` = 'å‚¨è“„å¡' 
                ORDER BY
                    t1.`open_time` ASC LIMIT 3) t2 
            INNER JOIN
                `t_bank` t4 
                    ON t4.`id` = t2.`bank_id` 
            GROUP BY
                t2.`uid`) t3 
                    ON t3.`uid` = t.`id` 
            WHERE
                t.`name` LIKE '%å°æ˜%' 
                AND IFNULL(t3.`__none2__`,true) = true
    

æ˜¯çš„ä½ æ²¡çœ‹é”™è¿™å°±æ˜¯easy-queryåœ¨2023å¹´è¯ç”Ÿåˆ°ç°åœ¨2å¹´æ—¶é—´çš„åŠªåŠ›,æ˜¯å¦æœ‰ä¸€ç§æƒŠè‰³åˆ°ä½ çš„å†²åŠ¨

æœ€å
--

å¯èƒ½æœ‰å¾ˆå¤šå°ä¼™ä¼´ä¼šæ¨èæˆ‘jpaæˆ–è€…jooqæˆ‘æƒ³è¯´å¦‚æœæˆ‘æ²¡èƒ½åŠ›é‚£ä¹ˆæˆ‘å¯èƒ½ä¼šé€‰æ‹©ä»–ä»¬,å¦‚æœä»–ä»¬æ”¯æŒå›½äº§æ•°æ®åº“æˆ‘å¯èƒ½ä¼šé€‰æ‹©ä»–ä»¬,ä½†æ˜¯ä½ æˆ‘æ›´æ„¿æ„æ¨è`easy-query`å› ä¸ºæˆ‘ä¼šè†å¬å¼€å‘è€…çš„å£°éŸ³èµ·ç ä½ å«çš„åŠ¨æˆ‘,æˆ‘æ˜¯ä¸€ä¸ªåœ¨crudæ··çš„èœé¸Ÿå¼€å‘,crudçš„å›°éš¾ï¼Œormçš„å›°éš¾å¿…é¡»æ˜¯ä¸€ä¸ªæ··è¿¹åœ¨ä¸šåŠ¡å¼€å‘çš„ç¨‹åºå‘˜æ‰èƒ½å¼€å‘å‡ºæ¥çš„å¥½æ¡†æ¶ï¼Œåœ¨æ²¡å¼€å‘å‡ºè¿™ä¸ªapiçš„æ—¶å€™å·²ç»æœ‰å¾ˆå¤šå°ä¼™ä¼´ä½¿ç”¨lambdaçš„apiè¿›è¡Œäº†å¼€å‘åå‘éå¸¸ä¸é”™ï¼ŒæœŸå¾…æ‚¨çš„ä½¿ç”¨ã€‚