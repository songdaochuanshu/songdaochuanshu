---
layout: post
title: 'Webå‰ç«¯å…¥é—¨ç¬¬ 82 é—®ï¼šJavaScript cookie æœ‰å¤§å°é™åˆ¶å—ï¼Ÿæº¢å‡ºä¼šæ€æ ·ï¼Ÿ'
date: "2025-07-30T00:45:52Z"
---
Webå‰ç«¯å…¥é—¨ç¬¬ 82 é—®ï¼šJavaScript cookie æœ‰å¤§å°é™åˆ¶å—ï¼Ÿæº¢å‡ºä¼šæ€æ ·ï¼Ÿ
=============================================

é¢è¯•æ—¶å€™ç»å¸¸ä¼šè¢«é—®åŠ Cookie å¤§å°é™åˆ¶ï¼Œä½†ä¸€ç›´æ²¡å°è¯•å†™ä¸€äº› demo æµ‹è¯•ä¸‹æº¢å‡ºæé™å€¼ä¼šæ€æ ·~~

æœ¬æ–‡å°±æ¥çœ‹çœ‹å„ç§æé™æƒ…å†µï¼

è‹±æ–‡
--

æµ‹è¯•ä»£ç ï¼š

    (() => {
      const maxSize = 4 * 1024; // 4KB
      const name = 'name'
      // æœ€å¤§å‡ºå…¥çš„ value é•¿åº¦
      const maxValueStr = 'a'.repeat(maxSize - name.length);
      // firefox ä¸èƒ½ä½¿ç”¨ Secure
      document.cookie = `${name}=${encodeURIComponent(maxValueStr)};expires=${new Date(2026, 0, 1).toUTCString()};path=/`;
    })()
    

### Chrome/Edge/Firefox æµè§ˆå™¨

**è‹±æ–‡ï¼š**`åå­— + å†…å®¹` å­—ç¬¦ä¸²é•¿åº¦é™åˆ¶ 4096 å­—ç¬¦ã€‚

å„å®¶æµè§ˆå™¨çš„å­˜å‚¨é¢æ¿éƒ½èƒ½çœ‹åˆ° Cookie å¤§å°ï¼Œæ­¤å¤§å°åŒ…å«å­˜å…¥ Cookie çš„**åå­—å’Œå†…å®¹åŠ åœ¨ä¸€èµ·çš„é•¿åº¦**ã€‚

### ä¸åŒä¹‹å¤„

#### Chrome/Edge

è¶…è¿‡ 4KB å¤§å°æ— æ³•å­˜å‚¨ï¼Œæµè§ˆå™¨æ— æŠ¥é”™ï¼Œä¹Ÿæ— æç¤ºï¼Œçº¯ç²¹æ¯«æ— æ„ŸçŸ¥ã€‚

#### Firefox

è¶…è¿‡ 4KB å¤§å°ä¼šæœ‰æç¤ºï¼š

    Cookie â€œnameâ€å¤ªå¤§è€Œæ— æ•ˆã€‚æœ€å¤§å¤§å°ä¸º 4096 å­—èŠ‚ã€‚
    

æ¯”å¦‚è¿™æ®µä»£ç å­˜å…¥ cookie çš„å€¼è¶…è¿‡ä¸€ä¸ªå­—ç¬¦ï¼š

    (() => {
      const maxSize = 4 * 1024 - 5; // 4KB
      const maxStr = 'a'.repeat(maxSize) + 'b1';
      console.log('ğŸš€ ~ maxStr:', maxStr.length);
      document.cookie = `name=${encodeURIComponent(maxStr)};expires=${new Date(2026, 0, 1).toUTCString()};path=/`;
    })()
    

è¿è¡Œæœ‰è­¦å‘Šï¼š

å¦‚æœåœ¨ Firefox ä¸­ localhost ä½¿ç”¨ secure ä¼šæŠ¥é”™ï¼ï¼

    ç”±äºé HTTPS Cookie æ— æ³•è®¾ç½®â€œsecureâ€å±æ€§ï¼Œå·²æ‹’ç» Cookie â€œnameâ€ã€‚
    

æ¯”å¦‚è¿™æ®µä»£ç åœ¨æœ¬åœ° localhost çš„ç¯å¢ƒä¸­ Chrome å’Œ Edge éƒ½èƒ½æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ Firefox ä¼šæŠ¥é”™ï¼š

    document.cookie = `name=${encodeURIComponent(maxStr)};expires=${new Date(2026, 0, 1).toUTCString()};path=/;Secure;SameSite=Lax`;
    

æŠ¥é”™ï¼š

ä¸­æ–‡
--

**ä¸€ä¸ªä¸­æ–‡å ç”¨3ä¸ªè‹±æ–‡é•¿åº¦ï¼ï¼ï¼**

æµ‹è¯•ä»£ç ï¼š

    (() => {
      const maxSize = 4 * 1024; // 4KB
      const name = 'name'
      const valueSize = maxSize - name.length
      console.log(valueSize / 3);
      const value = 'ä¸­'.repeat(Math.floor(valueSize / 3));
      // firefox ä¸èƒ½ä½¿ç”¨ Secure
      document.cookie = `name=${(value)};expires=${new Date(2026, 0, 1).toUTCString()};path=/`;
    })()
    

4KB å­—ç¬¦ä¸²é•¿åº¦å‡å» name çš„é•¿åº¦ï¼Œé™¤ä»¥ 3 ç­‰äº 1364 ä¸­æ–‡å­—ç¬¦é•¿åº¦ï¼Œåˆšå¥½æ˜¯æµè§ˆå™¨èƒ½å­˜å‚¨çš„æé™å€¼ã€‚

Firefox æ˜¾ç¤ºçš„å¤§å°æ¯”è¾ƒå¦ç±»ï¼Œå®ƒæ²¡æŒ‰ç…§è½¬æ¢åçš„å¤§å°æ˜¾ç¤ºï¼Œè€Œæ˜¯ç›´æ¥æ˜¾ç¤ºäº†ä¸­æ–‡å€¼é•¿åº¦ + è‹±æ–‡åç§°é•¿åº¦ï¼Œè€Œ Chrome å’Œ Edge æ˜¾ç¤ºçš„æ˜¯å ç”¨ç©ºé—´é•¿åº¦ã€‚å¦‚ä¸‹å›¾ï¼š

ä¸€èˆ¬åœ¨å­˜å‚¨ä¸­æ–‡çš„çš„æ—¶å€™ï¼Œä¼šç”¨åˆ° `encodeURIComponent` ç¼–ç ä¸€ä¸‹ä¸­æ–‡å­—ç¬¦ï¼Œè¿™æ–¹æ³•ç¼–ç ä¹‹åï¼Œä¸€ä¸ªä¸­æ–‡å­—ç¬¦å°†ä¼šè½¬æˆ 9 ä¸ªè‹±æ–‡å­—ç¬¦ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•å­˜å‚¨ä¸­æ–‡æ—¶å€™éœ€ç‰¹åˆ«æ³¨æ„ï¼ï¼ï¼

ä½¿ç”¨ cookieStore
--------------

cookieStore å­˜å…¥è¶…è¿‡å¤§å°é™åˆ¶çš„å­—ç¬¦ä¸²é•¿åº¦æ—¶ï¼Œä¼šæŠ¥ä¸€ä¸ªå¥‡å¥‡æ€ªæ€ªçš„é”™è¯¯ï¼Œæ¯”å¦‚ï¼š

    (async () => {
      const maxSize = 4 * 1024; // 4KB
      const name = 'name'
      const valueSize = maxSize - name.length
      console.log(valueSize / 3);
      const value = 'ä¸­'.repeat(Math.floor(valueSize / 3));
      const res = await cookieStore.set({
        name: 'name',
        // æ¯”æé™å€¼å¤šå‡ºä¸€ä¸ªé•¿åº¦
        value: value + '1',
        expires: new Date(2026, 0, 1).getTime(), // Unix æ—¶é—´æˆ³ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½è¡¨ç¤ºï¼‰
        path: '/',
        sameSite: 'lax'
      })
      console.log('å­˜å‚¨ç»“æœï¼š', res); // æ­£å¸¸å†™å…¥è¿”å› undefined
    })()
    

æŠ¥é”™ï¼š

ç¿»è¯‘è¿‡æ¥çš„å¤§è‡´æ„æ€ï¼š**ç”±äºè§£ææ—¶å‡ºç°é—®é¢˜ï¼Œå¯¼è‡´ Cookie æ ¼å¼é”™è¯¯ï¼Œæ— æ³•å­˜å‚¨ã€‚**

åæ­£ä¸æ˜¯æ˜ç¡®çš„å‘Šè¯‰å¼€å‘è€…é•¿åº¦å¼‚å¸¸äº†ï¼ï¼æ‰€ä»¥åœ¨ä½¿ç”¨ `cookieStore` æ—¶ï¼Œéœ€è¦è¿›è¡Œå¼‚å¸¸æ•è·ã€‚

**æœ¬æ–‡ç¼–å†™æ—¶ Firefox æœ€æ–°ç‰ˆæœ¬ 138.0.4 è¿˜ä¸æ”¯æŒ cookieStoreã€‚**

Cookie ä¸ªæ•°é™åˆ¶
-----------

å•ä¸ª Cookie çš„å¤§å°é™åˆ¶äº†è§£äº†ï¼Œå†çœ‹çœ‹ Cookie ä¸ªæ•°é™åˆ¶ã€‚

### å¤šä¸ªè¶…å¤§ Cookie

æµ‹è¯•ä»£ç ï¼š

    (async () => {
      document.cookie = ''
      const name = 'name'
      // æœ€å¤§å‡ºå…¥çš„ value é•¿åº¦
      let cookieStr = ''
      for (let i = 0; i < 200; i++) {
        document.cookie = `${name + i}=${'a'.repeat(4000)};expires=${new Date(2026, 0, 1).toUTCString()};path=/`;
      }
      // JS æŸ¥æ‰¾ name å‡ºç°æ¬¡æ•°
      console.log(document.cookie.match(/name/g).length)
    })()
    

ç¬¬ä¸€æ¬¡éƒ½èƒ½æ­£å¸¸æ‰“å¼€é¡µé¢ï¼Œç¬¬äºŒæ¬¡åˆ·æ–°é¡µé¢ä¹‹åéƒ½ä¼šæŠ¥é”™ï¼š

æ­¤é—®é¢˜åº”è¯¥æ˜¯è·Ÿ http åè®®çš„é™åˆ¶æœ‰å…³ï¼Œè¯·æ±‚å¤´å‘é€çš„ Cookie é•¿åº¦å¤ªé•¿äº†ï¼Œå¯¼è‡´å“åº” 431 çŠ¶æ€ç ã€‚

Firefox åœ¨é¡µé¢æœªæ­£å¸¸æ‰“å¡çš„æƒ…å†µä¸‹è¿˜ä¸æ”¯æŒæ¸…ç©º Cookieï¼Œéœ€è¦ç‚¹å‡»**å³ä¸Šè§’èœå•--è®¾ç½®--éšç§ä¸å®‰å…¨--æ¸…é™¤æ•°æ®**åˆ é™¤ä¿å­˜çš„è¶…å¤§ Cookie æµè§ˆå™¨æ‰èƒ½æ­£å¸¸è®¿é—®ã€‚

### å° Cookie ä¸ªæ•°é™åˆ¶

æµ‹è¯•ä»£ç ï¼š

    (async () => {
      function setCookie(name, value) {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            document.cookie = `${name}=${value};path=/`;
            resolve()
          }, 5);
        });
      }
      const name = 'name'
      // æœ€å¤§å‡ºå…¥çš„ value é•¿åº¦
      let cookieStr = ''
      for (let i = 0; i < 2000; i++) {
        console.log('æ­£åœ¨å†™å…¥ï¼š', i);
        await setCookie(name + i, 'a')
      }
      setTimeout(() => {
        // JS æŸ¥æ‰¾ name å‡ºç°æ¬¡æ•°
        console.log(document.cookie?.match(/name/g)?.length)
      }, 1000);
    })()
    

**Chromeã€Edgeã€Firefox æµè§ˆå™¨æ¯æ¬¡åˆ·æ–°å†™å…¥çš„ Cookie ä¸ªæ•°éƒ½ä¸ä¸€æ ·ï¼Œå¯ä»¥å¤åˆ¶ä»¥ä¸Šä»£ç åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•ï¼**

AI å›ç­”ï¼š

å†™åœ¨æœ€å
----

æ ¹æ®æµ‹è¯•ç»“æœå¯ä»¥å¾—å‡ºï¼šåœ¨ä½¿ç”¨ Cookie æ—¶åªå»ºè®®ç”¨äºå­˜å…¥å…³é”®æ•°æ®ï¼Œè€Œä¸æ˜¯ç”¨æ¥åšç›¸å…³ç¼“å­˜ï¼ï¼

æ–‡ç« é¦–å‘äºå¾®ä¿¡å…¬ä¼—å·ã€å‰ç«¯è·¯å¼•ã€‘ï¼Œæ¬¢è¿ å¾®ä¿¡æ‰«ä¸€æ‰« æŸ¥çœ‹æ›´å¤šæ–‡ç« ã€‚

![](https://images.cnblogs.com/cnblogs_com/linx/2447020/o_250228035031_%E5%85%AC%E4%BC%97%E5%8F%B7%E4%BA%8C%E7%BB%B4%E7%A0%81.png)

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š[å‰ç«¯è·¯å¼•](https://www.cnblogs.com/linx/)ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/linx/p/19010392](https://www.cnblogs.com/linx/p/19010392)