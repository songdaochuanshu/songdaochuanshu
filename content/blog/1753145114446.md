---
layout: post
title: 'ä½¿ç”¨django-simple-historyå®ç°ç®€å•å®¡è®¡åŠŸèƒ½'
date: "2025-07-22T00:45:14Z"
---
ä½¿ç”¨django-simple-historyå®ç°ç®€å•å®¡è®¡åŠŸèƒ½
===============================

å‰è¨€
--

æœ¬æ–‡ä¾ç„¶æ˜¯ä¸­å°é¡¹ç›®å»¶ä¼¸çš„ç¬”è®°

è¿™ä¸ªç³»åˆ—çš„æ–‡ç« å¤ªå°ä¼—äº†ï¼Œçœ‹çš„äººéƒ½ä¸å¤š

æˆ‘äº‰å–å°½å¿«æŠŠè¿™ç³»åˆ—å®Œç»“äº†ï¼Œç„¶åè¿›å…¥æ–°çš„é¡¹ç›®

å…³äºå®¡è®¡
----

ä¹‹å‰æˆ‘åœ¨ dotnet çš„é¡¹ç›®é‡Œå·²ç»è‡ªå·±å®ç°äº†å®¡è®¡åŠŸèƒ½äº†ï¼Œè¿˜æ˜¯ç”¨åˆ‡é¢æ€æƒ³æçš„

è¯¦è§ï¼š

*   [AspNetCoreå¼€å‘ç¬”è®°ï¼šå®ç°åŠ¨æ€å®¡è®¡æ—¥å¿—åŠŸèƒ½](https://blog.deali.cn/Blog/Post/38b0ad0d91248f21)
*   [AspNetCoreå¼€å‘ç¬”è®°ï¼šè¿›ä¸€æ­¥å®ç°éä¾µå…¥æ€§å®¡è®¡æ—¥å¿—åŠŸèƒ½](https://blog.deali.cn/Blog/Post/9527cd9e7cfa854c)

Django ç”Ÿæ€éå¸¸ä¸°å¯Œï¼Œå®ç°å®¡è®¡åº”è¯¥ä¹Ÿæœ‰å¾ˆå¤šæ–¹æ³•å’Œç°æˆçš„åº“

è€Œä¸”å› ä¸ºå¼ºç»‘å®šäº†è‡ªå·±çš„ä¸€å¥— ORM ï¼Œæ•´ä¸ªç”Ÿæ€éƒ½å›´ç»•è¿™ä¸ªä½“ç³»æ¥å±•å¼€ï¼Œæ›´åŠ çš„å¼€ç®±å³ç”¨

simple-history
--------------

æœ¬æ–‡ä½¿ç”¨äº†çš„è¿™ä¸ª simple-history å¯ä»¥è®°å½•æ¯ä¸ª model çš„æ“ä½œ

æ­é… DjangoStarter æ¡†æ¶ä½¿ç”¨ï¼Œç›®å‰å·²ç»åˆ‡æ¢åˆ° unfold admin ä½œä¸ºç®¡ç†åå°ï¼Œå¯ä»¥æ— ç¼é›†æˆ

*   [https://github.com/django-commons/django-simple-history](https://github.com/django-commons/django-simple-history)
*   [https://unfoldadmin.com/docs/integrations/django-simple-history/](https://unfoldadmin.com/docs/integrations/django-simple-history/)

å®‰è£…(æ™®é€šDjangoé¡¹ç›®)
--------------

è¿™é‡Œæ˜¯æ™®é€š Django é¡¹ç›®çš„æ­¥éª¤

å…ˆå®‰è£…ä¾èµ–

    pdm add django-simple-history
    

æ³¨å†Œåº”ç”¨

    INSTALLED_APPS = [
        # ...
        'simple_history',
    ]
    

æ·»åŠ ä¸­é—´ä»¶

è¿™ä¸ªåº“çš„å®¡è®¡åŠŸèƒ½æ˜¯é€šè¿‡ä¸­é—´ä»¶æ¥å®ç°çš„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨ä¸­é—´ä»¶ï¼Œéœ€è¦é¢å¤–çš„æ–¹å¼æŠ˜è…¾ã€‚

    MIDDLEWARE = [
        # ...
        'simple_history.middleware.HistoryRequestMiddleware',
    ]
    

ç„¶åä¿®æ”¹ admin ç»§æ‰¿ `SimpleHistoryAdmin`

    from simple_history.admin import SimpleHistoryAdmin
    
    @admin.register(Movie)
    class MovieAdmin(SimpleHistoryAdmin):
        ...
    

è¿™æ ·å°±å¯ä»¥åœ¨åå°çœ‹åˆ°è¿™ä¸ª model çš„ç›¸å…³æ“ä½œäº†

DjangoStarteré›†æˆ
---------------

å®é™…ä¸Šæ˜¯ unfold çš„é›†æˆğŸ¤£

### æ³¨å†ŒæœåŠ¡

ç¡®ä¿æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ³¨å†Œapp

    INSTALLED_APPS = [
        "unfold",
        # ...
        "unfold.contrib.simple_history",
        # ...
        "simple_history",
    ]
    

### ä¿®æ”¹admin

è™½ç„¶ä¸ä¿®æ”¹ä¹Ÿèƒ½ work

ä¸è¿‡å°±æ²¡é‚£ä¹ˆå¥½çš„é›†æˆåº¦å’Œæ ·å¼

    from unfold.admin import ModelAdmin
    from simple_history.admin import SimpleHistoryAdmin
    
    @admin.register(Movie)
    class MovieAdmin(SimpleHistoryAdmin, ModelAdmin):
        ...
    

å¦‚ä½•ä½¿ç”¨
----

åœ¨éœ€è¦è®°å½•æ“ä½œå†å²çš„ model æ·»åŠ  `history = HistoricalRecords()` å­—æ®µ

    class Movie(ModelExt):
        title = models.CharField(max_length=100)
        description = models.TextField()
        year = models.IntegerField()
        rating = models.IntegerField()
        genre = models.CharField(max_length=100)
        director = models.CharField(max_length=100)
        actors = models.CharField(max_length=100)
        history = HistoricalRecords()
    

è€è§„çŸ©ï¼Œä¿®æ”¹äº†æ¨¡å‹éœ€è¦åŒæ­¥æ•°æ®åº“

    python src/manage.py makemigrations
    python src/manage.py migrate
    

è®°å¾— admin ä¹Ÿè¦åŒæ­¥ä¿®æ”¹ï¼Œæ–¹æ³•åœ¨å‰é¢ä»‹ç»è¿‡äº†

è¿™æ—¶å€™è¿›å…¥ admin ç®¡ç†ç•Œé¢ï¼Œç‚¹å‡»æŸä¸€ä¸ªå…·ä½“æ•°æ®ï¼Œå³ä¸Šè§’å°±æœ‰ä¸ªâ€œå†å²â€æŒ‰é’®ï¼Œç‚¹è¿›å»å¯ä»¥çœ‹åˆ°æ‰€æœ‰æ“ä½œè®°å½•äº†

å®ç°æ•ˆæœ
----

æŸ¥çœ‹åˆ°æ“ä½œå†å²ç±»ä¼¼ä¸‹é¢è¿™æ ·

å¯ä»¥çœ‹åˆ°ä¿®æ”¹äººå’Œä¿®æ”¹äº†å“ªäº›å†…å®¹

è®°å½•å¯¹è±¡

æ—¥æœŸ/æ—¶é—´

å¤‡æ³¨

ä¿®æ”¹äºº

ä¿®æ”¹åŸå› 

Changes

[æ¼”å‘˜1](http://127.0.0.1:18080/admin/demo/actor/22/history/5/)

2025å¹´7æœˆ19æ—¥ 23:56

å·²ä¿®æ”¹

[admin](http://127.0.0.1:18080/admin/auth/user/3/change/)

None

**City:** Tokyo â¡ï¸ Tokyo Sega

[æ¼”å‘˜1](http://127.0.0.1:18080/admin/demo/actor/22/history/4/)

2025å¹´7æœˆ19æ—¥ 23:56

å·²åˆ›å»º

[admin](http://127.0.0.1:18080/admin/auth/user/3/change/)

None

å°ç»“
--

è¿™ä¸ªåº“è¿˜æœ‰å¾ˆå¤šå¯ä»¥è‡ªå®šä¹‰çš„åœ°æ–¹ï¼Œæ–‡æ¡£ä¹Ÿå†™å¾—å¾ˆè¯¦ç»†äº†

æˆ‘å°±æ²¡å¿…è¦æ¬è¿äº†ï¼ˆå…¶å®æ˜¯æˆ‘ç”¨åˆ°çš„åŠŸèƒ½å°±è¿™ä¹ˆç®€å•ï¼‰

unfold è¿˜æœ‰å¾ˆå¤šé›†æˆçš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ„Ÿè§‰éƒ½ä¸é”™ï¼ˆè¿Ÿæ—©è¦é›†æˆåˆ° DjangoStarter é‡Œï¼‰

*   [django-celery-beat](https://unfoldadmin.com/docs/integrations/django-celery-beat/)
    
*   [django-money](https://unfoldadmin.com/docs/integrations/django-money/)
    
*   [django-constance](https://unfoldadmin.com/docs/integrations/django-constance/)
    
*   [django-import-export](https://unfoldadmin.com/docs/integrations/django-import-export/)
    
*   [django-simple-history](https://unfoldadmin.com/docs/integrations/django-simple-history/)
    
*   [django-guardian](https://unfoldadmin.com/docs/integrations/django-guardian/)
    
*   [django-modeltranslation](https://unfoldadmin.com/docs/integrations/django-modeltranslation/)
    
*   [django-location-field](https://unfoldadmin.com/docs/integrations/django-location-field/)
    

å¾®ä¿¡å…¬ä¼—å·ï¼šã€Œç¨‹åºè®¾è®¡å®éªŒå®¤ã€ ä¸“æ³¨äºäº’è”ç½‘çƒ­é—¨æ–°æŠ€æœ¯æ¢ç´¢ä¸å›¢é˜Ÿæ•æ·å¼€å‘å®è·µï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡ã€æœºå™¨å­¦ä¹ ä¸æ•°æ®åˆ†æç®—æ³•ã€ç§»åŠ¨ç«¯å¼€å‘ã€Linuxã€Webå‰åç«¯å¼€å‘ç­‰ï¼Œæ¬¢è¿ä¸€èµ·æ¢è®¨æŠ€æœ¯ï¼Œåˆ†äº«å­¦ä¹ å®è·µç»éªŒã€‚