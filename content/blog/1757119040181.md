---
layout: post
title: 'ogg-opusåè®®è§£æç¤ºä¾‹'
date: "2025-09-06T00:37:20Z"
---
ogg-opusåè®®è§£æç¤ºä¾‹
==============

OGG å¤´çš„ç¤ºæ„å›¾

è¿™å¼ å›¾ç”»çš„å¾ˆå¥½ï¼Œå€Ÿç”¨ä¸€ä¸‹ï¼Œå›¾ç‰‡æ¥æºï¼šhttps://chenliang.org/2020/03/14/ogg-container-format/

Â ç„¶åæˆ‘ä»¬å°±ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ¥è§£è¯»ï¼Œå¢å¼ºè®°å¿†

ç¬¬ä¸€ä¸ªé¡µ
====

ç¬¬ä¸€éƒ¨åˆ†ï¼šOgg é¡µé¢å¤´ï¼ˆOgg Page Headerï¼‰

4F 67 67 53 00 02 00 00 00 00 00 00 00 00 7B C0 CC 0B 00 00 00 00 01 BA D3 2F 01 13 4F 70 75 73 48 65 61 64 01 01 38 01 80 BB 00 00 00 00 00

å‰ 27 å­—èŠ‚æ˜¯ Ogg é¡µé¢å¤´ï¼ˆOgg Page Headerï¼‰ï¼Œæ ‡å‡†é•¿åº¦ä¸º 27 å­—èŠ‚ã€‚

Offset: 00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26

Bytes: 4F 67 67 53 00 02 00 00 00 00 00 00 00 00 7B C0 CC 0B 00 00 00 00 01 BA D3 2F 01  
ASCII: O g g S

å­—æ®µ

å­—èŠ‚

å€¼

è¯´æ˜

`capture_pattern`

`4F 67 67 53`

`"OggS"`

Ogg æ–‡ä»¶æ ‡è¯†ç¬¦

`version`

`00`

0

Ogg æ ¼å¼ç‰ˆæœ¬

`header_type`

`02`

2

é¡µé¢ç±»å‹ï¼š`0x02`Â è¡¨ç¤ºè¿™æ˜¯Â åˆå§‹é¡µï¼ˆbosï¼‰ï¼Œé€šå¸¸æ˜¯å¤´ä¿¡æ¯

`granule_position`

`00 00 00 00 00 00 00 00`

0

éŸ³é¢‘é‡‡æ ·ä½ç½®ï¼ˆæ­¤å¤„ä¸º 0ï¼Œå› ä¸ºæ˜¯å¤´é¡µï¼‰

`bitstream_serialno`

`7B C0 CC 0B`

`0x0BCC C07B`

æµçš„å”¯ä¸€ IDï¼ˆå°ç«¯åºï¼‰

`page_sequence_no`

`00 00 00 00`

0

é¡µé¢åºå·ï¼Œå¤´é¡µä¸º 0

`CRC_checksum`

`01 BA D3 2F`

CRC32 æ ¡éªŒå’Œ

ç”¨äºæ ¡éªŒ

`page_segments`

`01`

1

è¯¥é¡µåŒ…å« 1 ä¸ª segment

ç¬¬äºŒéƒ¨åˆ†ï¼šSegment Table + OpusHead æ•°æ®

æ¥ä¸‹æ¥æ˜¯ segment table å’Œå®é™…æ•°æ®ã€‚

*   `page_segments`Â æ˜¯Â `01`ï¼Œè¡¨ç¤ºæœ‰ 1 ä¸ª segmentã€‚
*   segment table æ˜¯ 1 å­—èŠ‚ï¼š`13`Â â†’ è¡¨ç¤ºç¬¬ä¸€ä¸ª segment é•¿åº¦ä¸º 0x13 =Â 19 å­—èŠ‚

æ‰€ä»¥æ¥ä¸‹æ¥çš„Â 19 å­—èŠ‚æ˜¯ OpusHead æ•°æ®ï¼š

Offset: 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45  
Bytes: 4F 70 75 73 48 65 61 64 01 01 38 01 80 BB 00 00 00 00 00  
ASCII: O p u s H e a d

å­—æ®µ

å­—èŠ‚

å€¼

è¯´æ˜

`magic_signature`

8 å­—èŠ‚

`4F 70 75 73 48 65 61 64`

`"OpusHead"`Â ASCII

`version`

1 å­—èŠ‚

`01`

ç‰ˆæœ¬å·ï¼Œå¿…é¡»ä¸º 1

`channel_count`

1 å­—èŠ‚

`01`

å£°é“æ•°ï¼š1ï¼ˆå•å£°é“ï¼‰

`pre_skip`

2 å­—èŠ‚ï¼ˆå°ç«¯ï¼‰

`38 01`Â â†’Â `0x0138`Â =Â 312

ç¼–ç å™¨åœ¨è§£ç æ—¶åº”è·³è¿‡çš„æ ·æœ¬æ•°

`input_sample_rate`

4 å­—èŠ‚ï¼ˆå°ç«¯ï¼‰

`80 BB 00 00`Â â†’Â `0x0000BB80`Â =Â 48000 Hz

è¾“å…¥é‡‡æ ·ç‡ï¼ˆä»…ä½œå‚è€ƒï¼‰

`output_gain`

2 å­—èŠ‚ï¼ˆå°ç«¯ï¼‰

`00 00`

å¢ç›Šï¼ˆdB Ã— 256ï¼‰ï¼Œ0 è¡¨ç¤ºæ— å¢ç›Š

`channel_mapping_family`

1 å­—èŠ‚

`00`

é€šé“æ˜ å°„æ—ï¼š0 è¡¨ç¤ºæ— ç‰¹æ®Šæ˜ å°„ï¼ˆRTP æ ‡å‡†ï¼‰

### è¯¦ç»†è§£é‡Šï¼š

*   âœ…Â `magic_signature`:Â `"OpusHead"`ï¼Œç¡®è®¤æ˜¯ Opus å¤´ã€‚
*   âœ…Â `version = 1`ï¼šç¬¦åˆè§„èŒƒã€‚
*   ğŸ§Â `channel_count = 1`ï¼šå•å£°é“éŸ³é¢‘ã€‚
*   â©Â `pre_skip = 312`ï¼šè§£ç ååº”ä¸¢å¼ƒå‰ 312 ä¸ªæ ·æœ¬ï¼Œç”¨äºæ¶ˆé™¤ç¼–ç å™¨å¼•å…¥çš„å‰å¯¼å™ªå£°ã€‚
*   ğŸ“Â `input_sample_rate = 48000`ï¼šåŸå§‹è¾“å…¥é‡‡æ ·ç‡ä¸º 48 kHzï¼ˆOpus å†…éƒ¨å§‹ç»ˆä»¥ 48kHz è¿è¡Œï¼Œæ­¤å­—æ®µä»…ä½œæç¤ºï¼‰ã€‚
*   ğŸ”ŠÂ `output_gain = 0`ï¼šæ’­æ”¾æ—¶æ— éœ€è°ƒæ•´éŸ³é‡ã€‚
*   ğŸ”—Â `channel_mapping_family = 0`ï¼šä½¿ç”¨ç®€å•æµï¼Œæ— å¤æ‚é€šé“æ˜ å°„ï¼ˆé€‚ç”¨äºå•å£°é“æˆ–ç«‹ä½“å£°ï¼‰ã€‚

ç¬¬äºŒé¡µ
===

4F 67 67 53 00 00 00 00 00 00 00 00 00 00 7B C0 CC 0B 01 00 00 00 15 6E F0 0B 01 3D

4F 70 75 73 54 61 67 73 0C 00 00 00 4C 61 76 66 36 32 2E 34 2E 31 30 31 01 00 00 00 1D 00 00 00 65 6E 63 6F 64 65 72 3D 4C 61 76 63 36 32 2E 31 33 2E 31 30 31 20 6C 69 62 6F 70 75 73

Ogg Page Header è§£æï¼ˆå‰ 27 å­—èŠ‚ï¼‰

åç§»

å­—èŠ‚

å†…å®¹

è¯´æ˜

0x00

`4F 67 67 53`

`"OggS"`

Ogg é¡µå¤´æ ‡è¯†

0x04

`00`

ç‰ˆæœ¬å·

0ï¼Œæ ‡å‡†ç‰ˆæœ¬

0x05

`00`

æ ‡å¿—ä½

0x00ï¼šæ™®é€šé¡µï¼Œéå¼€å§‹ã€éç»“æŸ

0x06

`00 00 00 00 00 00 00 00`

Granule Position

64ä½ï¼Œå½“å‰ä¸º 0 â†’ é€šå¸¸æ˜¯é¦–å¸§ä¹‹åçš„æ•°æ®é¡µæˆ–æ³¨é‡Šé¡µ

0x0E

`00 00 00 00`

Stream Serial Number

æµ ID = 0

0x12

`7B C0 CC 0B`

Page Sequence No

å°ç«¯è¡¨ç¤ºï¼š`0B CC C0 7B`Â =Â `197,865,595`ï¼ˆåè¿›åˆ¶ï¼‰

0x16

`15 6E F0 0B`

Checksum

å°ç«¯ï¼š`0B F0 6E 15`Â =Â `210,562,581`ï¼ˆæ ¡éªŒç”¨ï¼‰

0x1A

`01`

Segment æ•°é‡

1 ä¸ª segment

0x1B

`3D`

Segment Table

è¯¥ segment é•¿åº¦ä¸ºÂ `0x3D = 61 å­—èŠ‚`

æ¥ä¸‹æ¥çš„ 61 å­—èŠ‚æ˜¯ Opus çš„Â æ³¨é‡Šå¤´ï¼ˆComment Headerï¼‰ï¼Œç»“æ„å¦‚ä¸‹ï¼š

### 1\. â€œOpusTagsâ€ æ ‡è¯†ï¼ˆ8 å­—èŠ‚ï¼‰

    4F 70 75 73 54 61 67 73 â†’ ASCII: "OpusTags"
    

âœ… è¡¨ç¤ºè¿™æ˜¯ Opus çš„Â æ³¨é‡Šå¤´ï¼ˆComment Headerï¼‰ï¼Œä¸æ˜¯è¯†åˆ«å¤´ï¼ˆIdentification Headerï¼‰ã€‚

### 2\. Vendor String Lengthï¼ˆ4 å­—èŠ‚ï¼Œå°ç«¯ï¼‰Â 

    0C 00 00 00 â†’ 0x0000000C = 12
    

â†’ Vendor å­—ç¬¦ä¸²é•¿åº¦ä¸ºÂ 12 å­—èŠ‚

### 3\. Vendor Stringï¼ˆ12 å­—èŠ‚ï¼‰Â 

    4C 61 76 66 36 32 2E 34 2E 31 30 31 â†’ "Lavf62.4.101"
    

*   `Lavf`Â =Â Libavformatï¼ˆFFmpeg çš„å°è£…åº“ï¼‰
*   `62.4.101`Â = FFmpeg çš„ç‰ˆæœ¬å·

ğŸ‘‰ è¡¨ç¤ºè¿™ä¸ªæ–‡ä»¶æ˜¯Â ç”¨ FFmpeg 62.4.101 ç‰ˆæœ¬ç”Ÿæˆçš„ã€‚

### 4\. User Comment List Lengthï¼ˆ4 å­—èŠ‚ï¼Œå°ç«¯ï¼‰

    01 00 00 00 â†’ 0x00000001 = 1
    

â†’ æœ‰Â 1 æ¡ç”¨æˆ·æ³¨é‡Š

### 5\. ç¬¬ä¸€ä¸ªæ³¨é‡Šï¼šé•¿åº¦ + å†…å®¹

### é•¿åº¦ï¼ˆ4 å­—èŠ‚ï¼Œå°ç«¯ï¼‰ï¼šÂ 

    1D 00 00 00 â†’ 0x1D = 29 å­—èŠ‚
    

#### å†…å®¹ï¼ˆ29 å­—èŠ‚ï¼‰ï¼šÂ 

    65 6E 63 6F 64 65 72 3D 4C 61 76 63 36 32 2E 31 33 2E 31 30 31 20 6C 69 62 6F 70 75 73
    

ASCII è§£ç ï¼šÂ 

    encoder=Lavc62.13.101 libopus
    

*   `Lavc`Â =Â Libavcodecï¼ˆFFmpeg çš„ç¼–ç åº“ï¼‰
*   `62.13.101`Â = ç¼–ç å™¨ç‰ˆæœ¬
*   `libopus`Â = ä½¿ç”¨çš„ Opus ç¼–ç å™¨åç«¯

ğŸ‘‰ è¡¨ç¤ºéŸ³é¢‘æ˜¯ç”¨Â FFmpeg çš„ libavcodec è°ƒç”¨ libopus ç¼–ç å™¨å®Œæˆçš„ã€‚

ç¬¬ä¸‰é¡µï¼ˆç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼‰
===========

4F 67 67 53 00 00 80 BB 00 00 00 00 00 00 7B C0 CC 0B 02 00 00 00 D0 E4 54 E5 32 3A 36 3E 39 37 36 32 3D 40 39 38 3C 3A 38 38 2F 33 36 33 3B 3C 3F 49 43 40 38 3A 40 3C 3A 3E 3A 3E 35 34 33 31 31 2F 2E 33 2F 33 35 31 37 3A 36 3E 39 78 80 D3 60 D2 DA CB 7F 25 98 67 83 D8 E8 67 61 E1 3C

Ogg Page Header è§£æï¼ˆå‰ 27 å­—èŠ‚ï¼‰

åç§»

å­—èŠ‚

å†…å®¹

è¯´æ˜

0x00

`4F 67 67 53`

`"OggS"`

Ogg æ ‡è¯†

0x04

`00`

ç‰ˆæœ¬å·

0

0x05

`00`

æ ‡å¿—ä½

0x00 â†’ æ™®é€šæ•°æ®é¡µ

0x06

`80 BB 00 00 00 00 00 00`

Granule Position

å°ç«¯ 64 ä½ï¼š`0xBB80 = 48000`

0x0E

`7B C0 CC 0B`

Stream Serial No

å°ç«¯ï¼š`0B CC C0 7B = 197,865,595`

0x12

`02 00 00 00`

Page Sequence No

å°ç«¯ï¼š`2`Â â†’ ç¬¬ 3 é¡µ

0x16

`D0 E4 54 E5`

Checksum

`0xE554E4D0`ï¼ˆç”¨äºæ ¡éªŒï¼‰

0x1A

`32`

Segment Count

`0x32 = 50`Â â†’ æœ‰ 50 ä¸ª segments

Segment Tableï¼ˆLacing Valuesï¼‰â€”â€”æ¥ä¸‹æ¥çš„ 50 å­—èŠ‚

ä» offsetÂ `0x1B`Â å¼€å§‹ï¼Œæœ‰Â 50 ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ª segment çš„é•¿åº¦ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰ï¼Œç§°ä¸ºÂ lacing valueã€‚

è¿™äº›å€¼æ˜¯ï¼šÂ 

    3A 36 3E 39 37 36 32 3D 40 39 38 3C 3A 38 38 2F 33 36 33 3B 3C 3F 49 43 40 38 3A 40 3C 3A 3E 3A 3E 35 34 33 31 31 2F 2E 33 2F 33 35 31 37 3A 36 3E 39
    

æˆ‘ä»¬å°†å…¶è½¬æ¢ä¸ºÂ åè¿›åˆ¶é•¿åº¦ï¼ˆæ¯ä¸ªæ˜¯ 1 å­—èŠ‚ï¼‰ï¼šÂ 

    58, 54, 62, 57, 55, 54, 50, 61, 64, 57, 56, 60, 58, 56, 56,
    47, 51, 54, 51, 59, 60, 63, 73, 67, 64, 56, 58, 64, 60, 58,
    62, 58, 62, 53, 52, 51, 49, 49, 47, 46, 51, 47, 51, 53, 49,
    55, 58, 54, 62, 57
    

âœ… æ€»å…± 50 ä¸ª Opus æ•°æ®åŒ…ï¼ˆpacketsï¼‰ï¼Œæ¯ä¸ªåŒ…çš„å¤§å°å¦‚ä¸Šã€‚

### Granule Position = 48000

*   Opus ä½¿ç”¨Â 48 kHz å†…éƒ¨é‡‡æ ·ç‡
*   Granule Position è¡¨ç¤ºâ€œåˆ°æœ¬é¡µä¸ºæ­¢ç´¯è®¡çš„éŸ³é¢‘æ ·æœ¬æ•°â€
*   `48000`Â = æ­£å¥½Â 1 ç§’ï¼ˆ48000 ä¸ªæ ·æœ¬ï¼‰

ğŸ‘‰ è¡¨ç¤ºè¿™æ˜¯Â å‰ 1 ç§’éŸ³é¢‘çš„ç»“æŸä½ç½®