---
layout: post
title: '一天一个Python库：markupsafe - 让你的字符串安全又优雅'
date: "2026-02-01T01:04:41Z"
---
一天一个Python库：markupsafe - 让你的字符串安全又优雅
====================================

markupsafe - 让你的字符串安全又优雅
========================

一、什么是markupsafe？
----------------

**markupsafe** 是一个用于处理标记语言（如HTML、XML）字符串的 Python 库。  
它可以帮助你：

*   **安全地转义字符串**：防止跨站脚本（XSS）攻击，特别是当你需要将用户输入显示在网页上时。
*   **标记安全字符串**：将经过转义或信任的字符串标记为“安全”，避免重复转义，提高效率。
*   **模板引擎集成**：在像Jinja2这样的模板引擎中，markupsafe扮演了核心角色，确保渲染的HTML内容是安全的。

二、应用场景
------

**markupsafe** 广泛应用于以下实际场景：

*   **Web开发框架**: 在Flask、Jinja2等Web框架中，用于自动转义模板渲染的输出，防止注入攻击。
*   **用户生成内容**: 当你的网站允许用户输入并显示内容时（如评论、论坛帖子），markupsafe能确保这些内容在显示时是安全的。
*   **构建动态HTML/XML**: 在程序中动态生成HTML或XML片段时，需要确保所有插入的数据都经过了正确的转义。

三、如何安装
------

1.  使用 pip 安装

    pip install markupsafe
    
    # 如果安装慢的话，推荐使用国内镜像源
    pip install markupsafe -i https://www.python64.cn/pypi/simple/
    

2.  使用 [PythonRun](https://www.min2k.com/tools/python-run/) 在线运行代码（无需本地安装）

四、示例代码
------

转义用户输入以防止XSS攻击

    from markupsafe import escape, Markup
    
    # 用户输入，可能包含恶意脚本
    user_input_raw = "<script>alert('您被攻击了！')</script>"
    is_admin = True # 假设有一个条件判断用户是否是管理员
    
    # 使用escape转义用户输入
    safe_output = escape(user_input_raw)
    
    # 打印转义后的结果
    print(f"转义后的内容: {safe_output}")
    
    # 假设有一些信任的HTML内容，我们不希望它被转义
    trusted_html = Markup("<b>这是加粗的文本</b>")
    
    # 如果是管理员，则直接显示原始输入（这里仅为演示，实际应用需极其谨慎）
    if is_admin:
        print(f"管理员显示（危险！）：{user_input_raw}")
    else:
        # 否则显示安全的内容
        print(f"普通用户显示（安全！）：{safe_output}")
    
    # 结合使用，Markup标记的内容不会被二次转义
    formatted_output = Markup(f"<p>Hello, {safe_output}!</p>")
    print(f"组合后的安全HTML: {formatted_output}")
    
    # 检查是否是Markup实例
    if isinstance(formatted_output, Markup):
        print("formatted_output 是一个 Markup 实例，已被标记为安全。")
    else:
        print("formatted_output 不是 Markup 实例。")
    

使用 [PythonRun](https://www.min2k.com/tools/python-run/?code=from%20markupsafe%20import%20escape%2C%20Markup%0A%0A%23%20%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%EF%BC%8C%E5%8F%AF%E8%83%BD%E5%8C%85%E5%90%AB%E6%81%B6%E6%84%8F%E8%84%9A%E6%9C%AC%0Auser_input_raw%20%3D%20%22%3Cscript%3Ealert%28'%E6%82%A8%E8%A2%AB%E6%94%BB%E5%87%BB%E4%BA%86%EF%BC%81'%29%3C%2Fscript%3E%22%0Ais_admin%20%3D%20True%20%23%20%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%B8%AA%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E7%94%A8%E6%88%B7%E6%98%AF%E5%90%A6%E6%98%AF%E7%AE%A1%E7%90%86%E5%91%98%0A%0A%23%20%E4%BD%BF%E7%94%A8escape%E8%BD%AC%E4%B9%89%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%0Asafe_output%20%3D%20escape%28user_input_raw%29%0A%0A%23%20%E6%89%93%E5%8D%B0%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E7%BB%93%E6%9E%9C%0Aprint%28f%22%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%3A%20%7Bsafe_output%7D%22%29%0A%0A%23%20%E5%81%87%E8%AE%BE%E6%9C%89%E4%B8%80%E4%BA%9B%E4%BF%A1%E4%BB%BB%E7%9A%84HTML%E5%86%85%E5%AE%B9%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%8D%E5%B8%8C%E6%9C%9B%E5%AE%83%E8%A2%AB%E8%BD%AC%E4%B9%89%0Atrusted_html%20%3D%20Markup%28%22%3Cb%3E%E8%BF%99%E6%98%AF%E5%8A%A0%E7%B2%97%E7%9A%84%E6%96%87%E6%9C%AC%3C%2Fb%3E%22%29%0A%0A%23%20%E5%A6%82%E6%9E%9C%E6%98%AF%E7%AE%A1%E7%90%86%E5%91%98%EF%BC%8C%E5%88%99%E7%9B%B4%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%8E%9F%E5%A7%8B%E8%BE%93%E5%85%A5%EF%BC%88%E8%BF%99%E9%87%8C%E4%BB%85%E4%B8%BA%E6%BC%94%E7%A4%BA%EF%BC%8C%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E9%9C%80%E6%9E%81%E5%85%B6%E8%B0%A8%E6%85%8E%EF%BC%89%0Aif%20is_admin%3A%0A%20%20%20%20print%28f%22%E7%AE%A1%E7%90%86%E5%91%98%E6%98%BE%E7%A4%BA%EF%BC%88%E5%8D%B1%E9%99%A9%EF%BC%81%EF%BC%89%EF%BC%9A%7Buser_input_raw%7D%22%29%0Aelse%3A%0A%20%20%20%20%23%20%E5%90%A6%E5%88%99%E6%98%BE%E7%A4%BA%E5%AE%89%E5%85%A8%E7%9A%84%E5%86%85%E5%AE%B9%0A%20%20%20%20print%28f%22%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%98%BE%E7%A4%BA%EF%BC%88%E5%AE%89%E5%85%A8%EF%BC%81%EF%BC%89%EF%BC%9A%7Bsafe_output%7D%22%29%0A%0A%23%20%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8%EF%BC%8CMarkup%E6%A0%87%E8%AE%B0%E7%9A%84%E5%86%85%E5%AE%B9%E4%B8%8D%E4%BC%9A%E8%A2%AB%E4%BA%8C%E6%AC%A1%E8%BD%AC%E4%B9%89%0Aformatted_output%20%3D%20Markup%28f%22%3Cp%3EHello%2C%20%7Bsafe_output%7D!%3C%2Fp%3E%22%29%0Aprint%28f%22%E7%BB%84%E5%90%88%E5%90%8E%E7%9A%84%E5%AE%89%E5%85%A8HTML%3A%20%7Bformatted_output%7D%22%29%0A%0A%23%20%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E6%98%AFMarkup%E5%AE%9E%E4%BE%8B%0Aif%20isinstance%28formatted_output%2C%20Markup%29%3A%0A%20%20%20%20print%28%22formatted_output%20%E6%98%AF%E4%B8%80%E4%B8%AA%20Markup%20%E5%AE%9E%E4%BE%8B%EF%BC%8C%E5%B7%B2%E8%A2%AB%E6%A0%87%E8%AE%B0%E4%B8%BA%E5%AE%89%E5%85%A8%E3%80%82%22%29%0Aelse%3A%0A%20%20%20%20print%28%22formatted_output%20%E4%B8%8D%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%E3%80%82%22%29) 在线运行这段代码，结果如下：

    转义后的内容: &lt;script&gt;alert(&#39;您被攻击了！&#39;)&lt;/script&gt;
    管理员显示（危险！）：<script>alert('您被攻击了！')</script>
    组合后的安全HTML: <p>Hello, &lt;script&gt;alert(&#39;您被攻击了！&#39;)&lt;/script&gt;!</p>
    formatted_output 是一个 Markup 实例，已被标记为安全。
    

使用 [MermaidGo](https://www.min2k.com/tools/mermaid/?code=flowchart%20TB%0A%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E5%92%8C%E7%AE%A1%E7%90%86%E5%91%98%E7%8A%B6%E6%80%81%7D%3B%0A%20%20B%20--%3E%20C%5B%E4%BD%BF%E7%94%A8escape%E8%BD%AC%E4%B9%89%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%5D%3B%0A%20%20C%20--%3E%20D%5B%E6%89%93%E5%8D%B0%E8%BD%AC%E4%B9%89%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%5D%3B%0A%20%20D%20--%3E%20E%7B%E5%A6%82%E6%9E%9C%20isAdmin%20%E4%B8%BA%20True%3F%7D%3B%0A%20%20E%20--%20%E6%98%AF%20--%3E%20F%5B%E6%89%93%E5%8D%B0%E5%8E%9F%E5%A7%8B%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%20%28%E5%8D%B1%E9%99%A9%29%5D%3B%0A%20%20E%20--%20%E5%90%A6%20--%3E%20G%5B%E6%89%93%E5%8D%B0%E5%AE%89%E5%85%A8%E7%9A%84%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%5D%3B%0A%20%20F%20--%3E%20H%5B%E5%88%9B%E5%BB%BA%E5%AE%89%E5%85%A8%E7%9A%84%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20G%20--%3E%20H%3B%0A%20%20H%20--%3E%20I%5B%E6%89%93%E5%8D%B0%E7%BB%84%E5%90%88%E5%90%8E%E7%9A%84%E5%AE%89%E5%85%A8HTML%5D%3B%0A%20%20I%20--%3E%20J%7B%E6%A3%80%E6%9F%A5%20formatted_output%20%E6%98%AF%E5%90%A6%E4%B8%BA%20Markup%20%E5%AE%9E%E4%BE%8B%3F%7D%3B%0A%20%20J%20--%20%E6%98%AF%20--%3E%20K%5B%E6%89%93%E5%8D%B0%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20J%20--%20%E5%90%A6%20--%3E%20L%5B%E6%89%93%E5%8D%B0%E4%B8%8D%E6%98%AF%20Markup%20%E5%AE%9E%E4%BE%8B%5D%3B%0A%20%20K%20--%3E%20M%5B%E7%BB%93%E6%9D%9F%5D%3B%0A%20%20L%20--%3E%20M%3B) 绘制示例代码的流程图，结果如下：

五、学习资源
------

1.  开源项目：[markupsafe](https://github.com/pallets/markupsafe)
2.  中文自述：[REMDME](https://www.python64.cn/readme/markupsafe/)
3.  在线运行：[PythonRun](https://www.min2k.com/tools/python-run/)

> 如果这篇文章对你有帮助，欢迎点赞、收藏、转发！  
> 学习过程中有任何问题，欢迎在评论区留言交流～