---
layout: post
title: 'æœ€å¼ºORMè®©ä½ å¼€å‘æ•ˆç‡æå‡ç™¾å€'
date: "2025-08-08T00:46:18Z"
---
æœ€å¼ºORMè®©ä½ å¼€å‘æ•ˆç‡æå‡ç™¾å€
===============

æœ€å¼ºORMè®©ä½ å¼€å‘æ•ˆç‡æå‡ç™¾å€
===============

`easy-query`åœ¨ç»è¿‡2å¹´çš„è¿­ä»£ç›®å‰å·²ç»åœ¨æŸ¥è¯¢é¢†åŸŸå¯ä»¥è¯´æ˜¯æ— æ•Œçš„å­˜åœ¨,ä»»ä½•orméƒ½ä¸æ˜¯å¯¹æ‰‹ï¼Œè¿™å‡ å¹´çš„åŠŸèƒ½ç‚¹ç®€å•ç½—åˆ—ä¸€ä¸‹

\[x\] åŠ¨æ€join:æŸ¥è¯¢æ¶‰åŠåˆ°å¯¹åº”çš„å…³ç³»è¡¨å°±ä¼šè‡ªåŠ¨æ·»åŠ joinåä¹‹åˆ™ä¸ä¼šè®²joinåŠ å…¥åˆ°sqlä¸­(2025å¹´äº†æ„Ÿè§‰ä¹Ÿä¸æ˜¯ä»€ä¹ˆæ–°é²œç‰¹æ€§äº†)  
\[x\] ç»“æ„åŒ–DTOï¼Œè‡ªåŠ¨æ ¹æ®DTOå’Œè¡¨å…³ç³»çš„è·¯å¾„è‡ªåŠ¨ç­›é€‰å‡ºéœ€è¦çš„ç»“æ„åŒ–å±æ€§(å¼€å‘æ•ˆç‡æ€æ‰‹)  
\[x\] ç»“æ„åŒ–DTOé¢å¤–é…ç½®,æ”¯æŒç»“æ„åŒ–DTOçš„è¿”å›ä¸‹è¿˜èƒ½é¢å¤–æ·»åŠ æŸ¥è¯¢æ¡ä»¶å’Œç­›é€‰æ¡ä»¶  
\[x\] éšå¼PARTITION BY  
\[X\] éšå¼å­æŸ¥è¯¢  
\[x\] `å­æŸ¥è¯¢è½¬GroupJoin`å…¨ä¸–ç•Œåº”è¯¥æ˜¯ç‹¬ä¸€ä»½çš„åŠŸèƒ½,è§£å†³å¤šå¯¹å¤šæ·±å±‚å…³ç³»åœ¨ORMä¸­çš„å­æŸ¥è¯¢è¿‡å¤šå¯¼è‡´çš„æ€§èƒ½é—®é¢˜çœŸæ­£è§£å†³äº†ORMåœ¨å¤æ‚æŸ¥è¯¢ä¸‹å¼€å‘æ•ˆç‡å’Œæ€§èƒ½çš„å…¼é¡¾

æ¡†æ¶åœ°å€ [https://github.com/dromara/easy-query](https://github.com/dromara/easy-query)  
æ–‡æ¡£åœ°å€ [https://www.easy-query.com/easy-query-doc/](https://www.easy-query.com/easy-query-doc/)  
è¯¥æ–‡ç« demoåœ°å€ [https://github.com/xuejmnet/eq-doc](https://github.com/xuejmnet/eq-doc)

åˆšå¥½å‰å‡ å¤©æˆ‘çœ‹åˆ°å…¬ä¼—å·æœ‰ç¯‡å…³äºefcoreçš„æ€§èƒ½æ–‡ç« ,æˆ‘çœ‹äº†å…¶å®æˆ‘ä¸€çœ¼å°±çŸ¥é“äº†ä»–çš„é—®é¢˜å°±æ˜¯eqçš„`å­æŸ¥è¯¢è½¬GroupJoin`ä½†æ˜¯æ­£å¦‚å¼ºå¤§çš„efcoreä¹Ÿæ˜¯æ²¡æœ‰å®ç°è¯¥åŠŸèƒ½ï¼Œè¯ä¸å¤šè¯´æœ¬ç« èŠ‚æˆ‘ä»¬å°†å…¥é—¨é€šè¿‡å…¬ä¼—å·çš„demoå®ç°å¤§éƒ¨åˆ†å¸–å­ç›¸å…³çš„æŸ¥è¯¢å’ŒåŠŸèƒ½

å»ºæ¨¡
--

å®ä½“å…³ç³»å¦‚ä¸‹ï¼š

*   ç”¨æˆ·Userï¼šæ¯ä¸ªç”¨æˆ·æœ‰å¤šç¯‡å¸–å­å’Œå¤šæ¡è¯„è®ºå’Œå¤šä¸ªç‚¹èµ
*   åˆ†ç±»Categoryï¼šå¸–å­æ‰€å±åˆ†ç±»ç±»ç›®æ”¯æŒå¤šä¸ªåˆ†ç±»ä¸€ä¸ªå¸–å­æˆ–è€…å¤šä¸ªå¸–å­å…¬ç”¨åŒä¸€ä¸ªåˆ†ç±»
*   å¸–å­Postï¼šæ¯ç¯‡å¸–å­æœ‰å¤šä¸ªåˆ†ç±»å¹¶å¯è·å¾—å¤šä¸ªèµ
*   è¯„è®ºCommentï¼šæ¯æ¡è¯„è®ºå±äºä¸€ä¸ªç”¨æˆ·å¹¶å…³è”ä¸€ç¯‡å¸–å­ ä¸”è¯„è®ºæ”¯æŒæ¥¼ä¸­æ¥¼
*   ç‚¹èµLikeï¼šæ¯ä¸ªèµå…³è”ä¸€ç¯‡å¸–å­ï¼Œå¤šä¸ªç‚¹èµå¯ä»¥å…³è”åŒä¸€ç¯‡å¸–å­
*   åˆ†ç±»å¸–å­å…³è”CategoryPostï¼šå¸–å­å’Œåˆ†ç±»çš„å…³è”å…³ç³»è¡¨

ç‚¹å‡»æŸ¥çœ‹å®ä½“ä»£ç 

    @Data
    @Table("t_user")
    @EntityProxy
    @EasyAlias("t_user")
    @EasyAssertMessage("æœªæ‰¾åˆ°å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯")
    public class User implements ProxyEntityAvailable<User , UserProxy> {
        @Column(primaryKey = true,comment = "ç”¨æˆ·id")
        private String id;
        @Column(comment = "ç”¨æˆ·å§“å")
        private String name;
        @Column(comment = "ç”¨æˆ·æ‰‹æœº")
        private String phone;
        @Column(comment = "åˆ›å»ºæ—¶é—´")
        private LocalDateTime createAt;
    }
    
    
    @Data
    @Table("t_category")
    @EntityProxy
    @EasyAlias("t_category")
    @EasyAssertMessage("æœªæ‰¾åˆ°å¯¹åº”çš„ç±»ç›®ä¿¡æ¯")
    public class Category implements ProxyEntityAvailable<Category , CategoryProxy> {
        @Column(primaryKey = true,comment = "ç±»ç›®id")
        private String id;
        @Column(comment = "ç±»ç›®å§“å")
        private String name;
        @Column(comment = "ç±»ç›®æ’åº")
        private Integer sort;
    }
    
    @Data
    @Table("t_post")
    @EntityProxy
    @EasyAlias("t_post")
    @EasyAssertMessage("æœªæ‰¾åˆ°å¯¹åº”çš„å¸–å­ä¿¡æ¯")
    public class Post implements ProxyEntityAvailable<Post, PostProxy> {
        @Column(primaryKey = true,comment = "å¸–å­id")
        private String id;
        @Column(comment = "å¸–å­æ ‡é¢˜")
        private String title;
        @Column(comment = "å¸–å­å†…å®¹")
        private String content;
        @Column(comment = "ç”¨æˆ·id")
        private String userId;
        @Column(comment = "å‘å¸ƒæ—¶é—´")
        private LocalDateTime publishAt;
    }
    
    @Data
    @Table("t_comment")
    @EntityProxy
    @EasyAlias("t_comment")
    @EasyAssertMessage("æœªæ‰¾åˆ°å¯¹åº”çš„è¯„è®ºä¿¡æ¯")
    public class Comment implements ProxyEntityAvailable<Comment , CommentProxy> {
        @Column(primaryKey = true,comment = "è¯„è®ºid")
        private String id;
        @Column(comment = "çˆ¶id")
        private String parentId;
        @Column(comment = "å¸–å­å†…å®¹")
        private String content;
        @Column(comment = "ç”¨æˆ·id",nullable = false)
        private String userId;
        @Column(comment = "å¸–å­id",nullable = false)
        private String postId;
        @Column(comment = "å›å¤æ—¶é—´")
        private LocalDateTime createAt;
    }
    @Data
    @Table("t_like")
    @EntityProxy
    @EasyAlias("t_like")
    @EasyAssertMessage("æœªæ‰¾åˆ°å¯¹åº”çš„ç‚¹èµä¿¡æ¯")
    public class Like implements ProxyEntityAvailable<Like , LikeProxy> {
        @Column(primaryKey = true,comment = "è¯„è®ºid")
        private String id;
        @Column(comment = "ç”¨æˆ·id",nullable = false)
        private String userId;
        @Column(comment = "å¸–å­id",nullable = false)
        private String postId;
        @Column(comment = "ç‚¹èµæ—¶é—´")
        private LocalDateTime createAt;
    }
    
    @Data
    @Table("t_category_post")
    @EntityProxy
    @EasyAlias("t_category_post")
    @EasyAssertMessage("æœªæ‰¾åˆ°å¯¹åº”çš„ç±»ç›®å¸–å­å…³è”ä¿¡æ¯")
    public class CategoryPost implements ProxyEntityAvailable<CategoryPost , CategoryPostProxy> {
        @Column(primaryKey = true,comment = "è¯„è®ºid")
        private String id;
        @Column(comment = "å¸–å­id",nullable = false)
        private String postId;
        @Column(comment = "ç±»ç›®id",nullable = false)
        private String categoryId;
    }

å¸–å­ç›¸å…³æŸ¥è¯¢
======

å¸–å­åˆ†é¡µ
----

å¯¹Postè¡¨è¿›è¡Œåˆ†é¡µæŒ‰`publishAt`å€’åºè¿›è¡Œæ’åºæŒ‰`title`è¿›è¡Œæœç´¢

é¦–å…ˆæˆ‘ä»¬å®šä¸€ä¸ªå…¬ç”¨ç±»

    
    @Data
    public class PageRequest {
        private Integer pageIndex=1;
        private Integer pageSize=5;
    }
    

å®šä¹‰è¯·æ±‚å‚æ•°

    @Data
    public class PostPageRequest extends PageRequest {
        private String title;
    }
    

### åˆ†é¡µåŠ¨æ€æ¡ä»¶

        @PostMapping("/page")
        public EasyPageResult<Post> page(@RequestBody PostPageRequest request) {
            return easyEntityQuery.queryable(Post.class)
                    .where(t_post -> {
    //                    if(EasyStringUtil.isNotBlank(request.getTitle())){
    //                        t_post.title().contains(request.getTitle());
    //                    }
                        t_post.title().contains(EasyStringUtil.isNotBlank(request.getTitle()),request.getTitle());
                    })
                    .orderBy(t_post -> t_post.publishAt().desc())
                    .toPageResult(request.getPageIndex(),request.getPageSize());
        }
    

è¿™è¾¹æä¾›äº†ä¸¤ç§æ–¹å¼å®ç°åŠ¨æ€æŸ¥è¯¢,å½“titleä¸ä¸ºç©ºçš„æ—¶å€™åŠ å…¥è¡¨è¾¾å¼ç­›é€‰,æ‰§è¡Œæˆ‘ä»¬æ¥çœ‹çœ‹å®é™…æƒ…å†µ

*   ä½¿ç”¨ifå‡½æ•°åŒ…è£¹è¡¨è¾¾å¼æ–­è¨€,æ”¯æŒä»»æ„javaè¡¨è¾¾å¼
*   ä½¿ç”¨æ–­è¨€å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°é‡è½½ï¼Œé»˜è®¤ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºtrueæ‰ä¼šæ‰§è¡Œæ–­è¨€æ“ä½œ
*   ä½¿ç”¨whereé‡è½½ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºtrueæ‰§è¡Œå½“å‰where

è¯·æ±‚å‚æ•°

    {"pageIndex":1,"pageSize":5,"title":"ç”µå½±"}
    

    ==> Preparing: SELECT COUNT(*) FROM `t_post` WHERE `title` LIKE CONCAT('%',?,'%')
    ==> Parameters: ç”µå½±(String)
    
    
    ==> Preparing: SELECT `id`,`title`,`content`,`user_id`,`publish_at` FROM `t_post` WHERE `title` LIKE CONCAT('%',?,'%') ORDER BY `publish_at` DESC LIMIT 3
    ==> Parameters: ç”µå½±(String)
    

**containerè¿˜æ˜¯like!!!**  
**\> ç»†å¿ƒåœ°æœ‹å‹ä¼šå‘ç°æˆ‘ä»¬ä½¿ç”¨äº†containså‡½æ•°è€Œä¸æ˜¯likeå‡½æ•°,å› ä¸ºå½“ä¼ å…¥çš„æŸ¥è¯¢æ¡ä»¶æœ¬èº«å¸¦æœ‰%æ—¶é‚£ä¹ˆlikeä¼šè®©%å˜æˆé€šé…ç¬¦ï¼Œè€Œcontainsä¼šå°†%è§†ä¸ºè¢«æŸ¥è¯¢çš„ä¸€éƒ¨åˆ†,è¿™æ˜¯éœ€è¦ç”¨æˆ·æ³¨æ„çš„,å…·ä½“ä½¿ç”¨containsè¿˜æ˜¯likeåº”è¯¥æœ‰ç”¨æˆ·è‡ªè¡Œå†³æ–­**

æ¨èå†™æ³•ğŸ”¥: å¯èƒ½ç”±ç”¨æˆ·ä¼šé—®å¦‚æœæˆ‘æ·»åŠ çš„æ¡ä»¶æœ‰å¾ˆå¤šæ€ä¹ˆåŠéš¾é“æ¯ä¸€ä¸ªéƒ½è¦è¿™ä¹ˆå†™ä¸€éå—?eqè´´å¿ƒçš„æä¾›äº†å¤šç§æ–¹å¼æ¥å®ç°åŠ¨æ€æŸ¥è¯¢æ¯”å¦‚`filterConfigure`

    
        easyEntityQuery.queryable(Post.class)
              .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
              .where(t_post -> {
                  t_post.title().contains(request.getTitle());
              })
              .orderBy(t_post -> t_post.publishAt().desc())
              .toPageResult(pageIndex,pageSize);
    

é€šè¿‡æ·»åŠ `filterConfigure`æ”¯æŒè®©å‚æ•°ä¸ºnullä¸å‚ä¸ä¸šåŠ¡,å¦‚æœæ˜¯å­—ç¬¦ä¸²åˆ™å¿…é¡»ä¿è¯`isNotBlank`ï¼Œå½“ç„¶ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡è‡ªå·±çš„è‡ªå®šä¹‰æ¥å®ç°

[æ›´å¤šçš„åŠ¨æ€æ¡ä»¶è®¾ç½®è¯·å‚è€ƒæ–‡æ¡£](https://www.easy-query.com/easy-query-doc/ability/adv/where)

**\> æ­£å¸¸æˆ‘ä»¬æ¨èä½¿ç”¨`filterConfigure`æˆ–è€…ä½¿ç”¨`if`å‡½æ•°åŒ…è£¹æ¡ä»¶è€Œä¸æ˜¯ä½¿ç”¨æ–¹æ³•å‚æ•°çš„ç¬¬ä¸€ä¸ª`boolean`ç±»å‹æ¥æ§åˆ¶ï¼Œå› ä¸ºå‚æ•°booleanç±»å‹é‡è½½ç›¸å¯¹ä¼šè®©è¡¨è¾¾å¼ä¸å¤Ÿç›´è§‚ä¸”éš¾ä»¥é˜…è¯»æ‰€ä»¥æˆ‘ä»¬æåŠ›æ¨èå¦å¤–å‡ ç§æ–¹å¼**

æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•åœ¨å•è¡¨æŸ¥è¯¢åˆ†é¡µä¸‹ä½¿ç”¨åŠ¨æ€å‚æ•°æ§åˆ¶sql,é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨å‚æ•°å¤–éƒ¨æ§åˆ¶åŠ¨æ€æ’åº

### åˆ†é¡µåŠ¨æ€æ’åº

é¦–å…ˆæˆ‘ä»¬å¯¹è¯·æ±‚çš„æ¡ä»¶è¿›è¡Œä¿®æ”¹

    @Data
    public class PostPage3Request extends PageRequest {
        private String title;
    
        private List<InternalOrder> orders;
    
        @Data
         public static class InternalOrder{
             private String property;//è¿™ä¸ªæ˜¯æŸ¥è¯¢Postå†…çš„å±æ€§å­—æ®µ
             private boolean asc;//è¡¨ç¤ºæ˜¯å¦éœ€è¦æ­£åºæ’åº
         }
    }
    
    @PostMapping("/page3")
    public EasyPageResult<Post> page3(@RequestBody PostPage3Request request) {
        return easyEntityQuery.queryable(Post.class)
                .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                .where(t_post -> {
                    t_post.title().contains(request.getTitle());
                })
                //è¿™ä¸ªrequest.getOrders()!=nullä¸ºtrueæ‰ä¼šæ‰§è¡Œåç»­çš„æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨ifåŒ…è£¹
                //å½“ç„¶å¦‚æœä½ èƒ½ç¡®ä¿request.getOrders()è‚¯å®šä¸ç­‰äºnullçš„é‚£ä¹ˆä¸éœ€è¦åŠ è¿™ä¸ªåˆ¤æ–­
                .orderBy(request.getOrders()!=null,t_post -> {
                    for (PostPage3Request.InternalOrder order : request.getOrders()) {
                        //anyColumnè¡¨ç¤ºéœ€è¦æ’åºçš„å­—æ®µ,orderByè¡¨ç¤ºä½¿ç”¨æ­£åºè¿˜æ˜¯å€’åº
                        t_post.anyColumn(order.getProperty()).orderBy(order.isAsc());
                    }
                })
                .toPageResult(request.getPageIndex(),request.getPageSize());
    }
    

è¯·æ±‚å‚æ•°

    {"pageIndex":1,"pageSize":5,"title":"","orders":[{"property":"publishAt","asc":false},{"property":"title","asc":true}]}
    

æ‰§è¡Œè¯·æ±‚åç”Ÿæˆçš„sqlä¸º

    ==> Preparing: SELECT COUNT(*) FROM `t_post`
    <== Time Elapsed: 13(ms)
    
    ==> Preparing: SELECT `id`,`title`,`content`,`user_id`,`publish_at` FROM `t_post` ORDER BY `publish_at` DESC,`title` ASC LIMIT 5
    <== Time Elapsed: 17(ms)
    

æ”¯æŒæˆ‘ä»¬å·²ç»æ”¯æŒäº†åˆ†é¡µçš„åŠ¨æ€æ’åº,å½“ç„¶åŠ¨æ€æ’åºåŠŸèƒ½è¿œä¸æ­¢æ­¤,[æ›´å¤šåŠ¨æ€æ’åºè¯·ç‚¹å‡»é“¾æ¥](/easy-query-doc/ability/adv/order)

### åˆ†é¡µjoinç­›é€‰

å½“ç„¶å¯¹äºå¤§éƒ¨åˆ†ä¸šåŠ¡è€Œè¨€å®ä½“å¯¹è±¡ä¸æ˜¯ä¸€ä¸ªå­¤å•å¯¹è±¡,å½“å‰çš„`Post`å¯¹è±¡ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæœ‰è¿è¡¨æˆ–è€…å­æŸ¥è¯¢ç­‰æ“ä½œï¼Œé‚£ä¹ˆ`eq`æ˜¯å¦‚ä½•å¿«é€Ÿä¾¿æ·çš„å®ç°`join`çš„å‘¢

ä¸‹é¢è¿™ç§é€šè¿‡å…³è”å…³ç³»å®ç°joinçš„æ“ä½œæˆ‘ä»¬ç§°ä¹‹ä¸º`éšå¼join`

*   æŸ¥è¯¢å¸–å­è¦æ±‚æŸ¥è¯¢æ¡ä»¶æ˜¯æŸä¸ªç”¨æˆ·çš„

é¦–å…ˆå› ä¸ºæ¶‰åŠåˆ°joiné‚£ä¹ˆeqæä¾›äº†å…³è”å…³ç³»å°†åŸå…ˆçš„`Post`å•è¡¨å’Œç”¨æˆ·è¡¨è¿›è¡Œå¤šå¯¹ä¸€çš„å…³è”

#### é€šè¿‡æ’ä»¶ç”Ÿæˆå…³è”å…³ç³»

*   ç¬¬ä¸€æ­¥å‘¼å‡ºuiç•Œé¢

*   ç¬¬äºŒæ­¥è®¾ç½®å…³è”å…³ç³»

é€‰æ‹©å¥½å¯¹åº”çš„å…³è”é”®åç‚¹å‡»ç¡®è®¤æ’ä»¶ä¼šå¸®ä½ è‡ªåŠ¨ç”Ÿæˆå¼ºç±»å‹å±æ€§|lombokå±æ€§æˆ–å­—ç¬¦ä¸²

å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰‹å†™å…³è”å…³ç³»

    @Data
    @Table("t_post")
    @EntityProxy
    @EasyAlias("t_post")
    @EasyAssertMessage("æœªæ‰¾åˆ°å¯¹åº”çš„å¸–å­ä¿¡æ¯")
    public class Post implements ProxyEntityAvailable<Post, PostProxy> {
        @Column(primaryKey = true, comment = "å¸–å­id")
        private String id;
        @Column(comment = "å¸–å­æ ‡é¢˜")
        private String title;
        @Column(comment = "å¸–å­å†…å®¹")
        private String content;
        @Column(comment = "ç”¨æˆ·id")
        private String userId;
        @Column(comment = "å‘å¸ƒæ—¶é—´")
        private LocalDateTime publishAt;
    
        /**
         * å‘å¸–äºº
         **/
        @Navigate(value = RelationTypeEnum.ManyToOne, selfProperty = {PostProxy.Fields.userId}, targetProperty = {UserProxy.Fields.id})
        private User user;
    }
    

ä¿®æ”¹å®Œå®ä½“å¯¹è±¡åæˆ‘ä»¬åšäº†ä¸€ä¸ª`post.userId=user.id`çš„å…³ç³»æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºæŸ¥è¯¢å¯¹è±¡

    
    @Data
    public class PostPage4Request extends PageRequest {
        private String title;
    
        private String userName; â‘ 
    
        private List<InternalOrder> orders;
    
        @Data
         public static class InternalOrder{
             private String property;
             private boolean asc;
         }
    }
    
        @PostMapping("/page4")
        public EasyPageResult<Post> page4(@RequestBody PostPage4Request request) {
            return easyEntityQuery.queryable(Post.class)
                    .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                    .where(t_post -> {
                        t_post.title().contains(request.getTitle());
                        t_post.user().name().contains(request.getUserName());
                    })
                    .orderBy(request.getOrders()!=null,t_post -> {
                        for (PostPage4Request.InternalOrder order : request.getOrders()) {
                            t_post.anyColumn(order.getProperty()).orderBy(order.isAsc());
                        }
                    })
                    .toPageResult(request.getPageIndex(),request.getPageSize());
        }
    
    

*   â‘ æ˜¯æˆ‘ä»¬æ–°æ·»åŠ çš„æŸ¥è¯¢å±æ€§`userName`

æ¥ä¸‹æ¥æˆ‘ä»¬å‘é€è¯·æ±‚

    {
    	"pageIndex": 1,
    	"pageSize": 5,
    	"title": "",
    	"userName": "ç”¨æˆ·A",â‘ 
    	"orders": [{
    		"property": "user.createAt",â‘¡
    		"asc": false
    	}, {
    		"property": "title",
    		"asc": true
    	}]
    }
    

    ==> Preparing: SELECT COUNT(*) FROM `t_post` t LEFT JOIN `t_user` t1 ON t1.`id` = t.`user_id` WHERE t1.`name` LIKE CONCAT('%',?,'%')
    ==> Parameters: ç”¨æˆ·A(String)
    
    ==> Preparing: SELECT t.`id`,t.`title`,t.`content`,t.`user_id`,t.`publish_at` FROM `t_post` t LEFT JOIN `t_user` t1 ON t1.`id` = t.`user_id` WHERE t1.`name` LIKE CONCAT('%',?,'%') ORDER BY t1.`create_at` DESC,t.`title` ASC LIMIT 3
    ==> Parameters: ç”¨æˆ·A(String)
    
    

*   â‘ æˆ‘ä»¬ä½¿ç”¨äº†ç”¨æˆ·åç§°ä½œä¸ºç­›é€‰æ¡ä»¶
*   â‘¡æˆ‘ä»¬ä½¿ç”¨äº†ç”¨æˆ·ä¸‹çš„åˆ›å»ºæ—¶é—´ä½œä¸ºæ’åºæ—¶é—´,`user.createAt`ä¸­`user`æ˜¯å…³è”å¯¼èˆªå±æ€§å°±æ˜¯æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„å¤šå¯¹ä¸€,`createAt`æ˜¯è¿™ä¸ªå¯¼èˆªå±æ€§çš„å­—æ®µå

å½“æˆ‘ä»¬ä¼ é€’`userName`é‚£ä¹ˆçœ‹ä¸‹sqlä¼šæ˜¯æ€ä¹ˆæ ·çš„

    ==> Preparing: SELECT COUNT(*) FROM `t_post` t
    
    ==> Preparing: SELECT t.`id`,t.`title`,t.`content`,t.`user_id`,t.`publish_at` FROM `t_post` t LEFT JOIN `t_user` t1 ON t1.`id` = t.`user_id` ORDER BY t1.`create_at` DESC,t.`title` ASC LIMIT 5
    
    

æˆ‘ä»¬æƒŠè®¶çš„å‘ç°eqéå¸¸æ™ºèƒ½çš„å°†åˆ†é¡µä¸­çš„`total`æŸ¥è¯¢çš„æ‰€æœ‰`join`éƒ½å»æ‰äº†,å¹¶ä¸”è¿”å›é›†åˆçš„é‚£ä¸ªsqlä»»ç„¶ä¿ç•™,å¦‚æœæˆ‘ä»¬å°†`orderBy`ä¹Ÿå»æ‰ä¼šå‘ç°eqå±…ç„¶æ•´ä¸ªsqléƒ½ä¸ä¼šæ·»åŠ `join`é€‰é¡¹

    ==> Preparing: SELECT COUNT(*) FROM `t_post` t
    <== Time Elapsed: 21(ms)
    <== Total: 1
    ==> Preparing: SELECT t.`id`,t.`title`,t.`content`,t.`user_id`,t.`publish_at` FROM `t_post` t ORDER BY t.`title` ASC LIMIT 5
    <== Time Elapsed: 18(ms)
    <== Total: 5
    

ä½ æ²¡æœ‰çœ‹é”™åŠ¨æ€joinå°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œè¿™å°±æ˜¯çœŸæ­£çš„åªèƒ½ormæ¡†æ¶

### å›é¡¾ä¸€ä¸‹

*   é¦–å…ˆæˆ‘ä»¬æ·»åŠ äº†åŠ¨æ€æŸ¥è¯¢ç­›é€‰å™¨é…ç½®`filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)`è®©æ‰€æœ‰æ¡ä»¶å‚æ•°énulléç©ºçš„å€¼æ”¯æŒåŠ å…¥æ¡ä»¶ï¼Œè¿™æ ·å°±åšåˆ°äº†åŠ¨æ€æŸ¥è¯¢çš„ç‰¹æ€§
*   ç¬¬äºŒç‚¹å› ä¸ºæˆ‘ä»¬ä¼ é€’userNameå‚æ•°ï¼Œæ‰€ä»¥è¡¨è¾¾å¼çš„`t_post.user().name().contains(request.getUserName());`ä¼šç”Ÿæ•ˆå¹¶ä¸”ä¼šè‡ªåŠ¨æ ¹æ®å¯¹åº”çš„å…³ç³»ä½¿ç”¨`leftJoin`å°†postå’Œuserå…³è”èµ·æ¥å¹¶ä¸”æŸ¥è¯¢postä¸‹çš„userä¸‹çš„å§“å
*   ç¬¬ä¸‰ç‚¹å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¼ é€’userNameå‚æ•°ï¼Œæ‰€ä»¥è¡¨è¾¾å¼çš„`t_post.user().name().contains(request.getUserName());`ä¸ä¼šç”Ÿæ•ˆ,ä½†æ˜¯`orderBy`çš„`user.createAt`è¿˜æ˜¯ä¼šç”Ÿæ•ˆ,æ‰€ä»¥pageçš„æ—¶å€™`total`çš„å“ªä¸€æ¬¡æŸ¥è¯¢å› ä¸ºæ²¡æœ‰ä½¿ç”¨`user`è¡¨æ‰€ä»¥ä¸ä¼š`join`ï¼Œä½†æ˜¯toListçš„é‚£ä¸€æ¬¡å› ä¸º`orderBy`ç”¨åˆ°äº†æ‰€ä»¥ä»»ç„¶ä¼šè¿›è¡Œ`leftJoin`

æ‰©å±•ç¯‡
---

### ä¸ºä»€ä¹ˆä½¿ç”¨leftJoin

å› ä¸ºä»»ä½•ä¸¤å¼ è¡¨çš„å…³ç³»åœ¨æ²¡æœ‰æ˜ç¡®æŒ‡å®šä¸€å®šå­˜åœ¨çš„æƒ…å†µä¸‹é‚£ä¹ˆleftJoinçš„æ“ä½œæ˜¯ä¸ä¼šå½±å“ä¸»è¡¨çš„ç»“æœé›†,å‡å¦‚æ¯ä¸ªPostå¹¶ä¸æ˜¯éƒ½ä¼šæœ‰ä¸€ä¸ªuserçš„æƒ…å†µä¸‹æˆ‘å¦‚æœä½¿ç”¨user.createAtè¿›è¡Œæ’åºé‚£ä¹ˆinner joinä¼šè®©ä¸»è¡¨çš„ç»“æœé›†å˜å°‘,ä½†è¿™æ˜¯å®Œå…¨ä¸è¢«å…è®¸çš„è¿™ç§åšæ³•ä¼šå¤§å¤§å¢åŠ ç”¨æˆ·ä½¿ç”¨çš„å¿ƒæ™ºè´Ÿæ‹…

é‚£ä¹ˆå¦‚æœæˆ‘å¸Œæœ›ä½¿ç”¨`innerJoin`è€Œä¸æ˜¯`leftJoin`å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥å†é…ç½®`@Navigate`çš„æ—¶å€™é€šè¿‡å±æ€§`required=true`æ¥å‘ŠçŸ¥æ¡†æ¶Postå¿…å®šæœ‰user

    //.....çœç•¥å…¶å®ƒä»£ç 
    public class Post{
    
        /**
         * å‘å¸–äºº
         **/
        @Navigate(value = RelationTypeEnum.ManyToOne,
                selfProperty = {PostProxy.Fields.userId},
                targetProperty = {UserProxy.Fields.id},
                required = true) â‘ 
        private User user;
    }
    

æ·»åŠ â‘ å±æ€§`required = true`è¿™æ ·æŸ¥è¯¢æˆ‘ä»¬å°±èƒ½å¤Ÿå‘ç°æ¡†æ¶ä¼šæ™ºèƒ½çš„ä½¿ç”¨`innerJoin`è€Œä¸æ˜¯`leftJoin`

    ==> Preparing: SELECT COUNT(*) FROM `t_post` t INNER JOIN `t_user` t1 ON t1.`id` = t.`user_id` WHERE t1.`name` LIKE CONCAT('%',?,'%')
    ==> Parameters: ç”¨æˆ·A(String)
    
    
    ==> Preparing: SELECT t.`id`,t.`title`,t.`content`,t.`user_id`,t.`publish_at` FROM `t_post` t INNER JOIN `t_user` t1 ON t1.`id` = t.`user_id` WHERE t1.`name` LIKE CONCAT('%',?,'%') ORDER BY t1.`create_at` DESC,t.`title` ASC LIMIT 3
    ==> Parameters: ç”¨æˆ·A(String)
    
    

### éšå¼joinæ€ä¹ˆæ·»åŠ onæ¡ä»¶

å¾ˆå¤šç»†å¿ƒçš„ç›†å‹å¯èƒ½å¸Œæœ›æˆ‘ä»¬åœ¨å…³è”ç”¨æˆ·çš„æ—¶å€™æ·»åŠ é¢å¤–çš„æŸ¥è¯¢æ¡ä»¶é‚£ä¹ˆåº”è¯¥å¦‚ä½•å®ç°å‘¢

è¯·æ±‚jsonä¸ºå¦‚ä¸‹ä¸æŸ¥è¯¢userName,ä¸è¿›è¡Œuserçš„å±æ€§æ’åº

    {
        "pageIndex":1,
        "pageSize":5,
        "title":"",
        "userName":"",
        "orders":[
            {
                "property":"title",
                "asc":true
            }
        ]
    }
    

    
        @PostMapping("/page4")
        public EasyPageResult<Post> page4(@RequestBody PostPage4Request request) {
            return easyEntityQuery.queryable(Post.class)
                    .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                    .where(t_post -> {
                        t_post.user().filter(u -> { â‘ 
                            u.phone().ne("123");
                        });
                        t_post.title().contains(request.getTitle());
                        t_post.user().name().contains(request.getUserName());
                    })
                    .orderBy(request.getOrders() != null, t_post -> {
                        for (PostPage4Request.InternalOrder order : request.getOrders()) {
                            t_post.anyColumn(order.getProperty()).orderBy(order.isAsc());
                        }
                    })
                    .toPageResult(request.getPageIndex(), request.getPageSize());
        }
    

    ==> Preparing: SELECT COUNT(*) FROM `t_post` t INNER JOIN `t_user` t1 ON t1.`id` = t.`user_id` AND t1.`phone` <> ?
    ==> Parameters: 123(String)
    
    ==> Preparing: SELECT t.`id`,t.`title`,t.`content`,t.`user_id`,t.`publish_at` FROM `t_post` t INNER JOIN `t_user` t1 ON t1.`id` = t.`user_id` AND t1.`phone` <> ? ORDER BY t.`title` ASC LIMIT 5
    ==> Parameters: 123(String)
    
    

*   â‘ ä¼šå°†æ¡ä»¶æ·»åŠ åˆ°joinçš„onä¸Šé¢å®ç°å…³è”å…³ç³»çš„å®šä¹‰ç­›é€‰

å¥‡æ€ªçš„äº‹æƒ…å‘ç”Ÿäº†ä¸ºä»€ä¹ˆè¿™æ¬¡æˆ‘ä»¬æ²¡æœ‰ä¼ é€’userç›¸å…³çš„æ•°æ®ä¾ç„¶ç»™æˆ‘ä»¬æŠŠ`inner join`åŠ ä¸Šäº†,å…¶å®æœ¬è´¨æ˜¯`inner join`çš„`on`æ¡ä»¶æ˜¯ä¼šå½±å“ä¸»è¡¨æ•°é‡ï¼Œæœ¬è´¨å’Œå†™åˆ°`where`é‡Œé¢æ˜¯ä¸€æ ·çš„,æ‰€ä»¥è™½ç„¶ä½ æ²¡æœ‰`where`çš„æ¡ä»¶ä½†æ˜¯`inner join`çš„`on`æ¡ä»¶ä¾ç„¶ä¼šè®©æ•´ä¸ªè¡¨è¾¾å¼çš„`join`æ— æ³•åŠ¨æ€ä¼˜åŒ–,

**filter!!!**  
**\> å…³è”å…³ç³»çš„`filter`ä¼šä»¥`join on`çš„å½¢å¼å‡ºç°åœ¨sqlä¸­,ç›¸å½“äºæ˜¯é¢å¤–å¯¹å…³è”å…³ç³»çš„ç­›é€‰ï¼Œç¼©å°å…³ç³»è¡¨,åˆå› ä¸ºpostå’Œuserçš„å…³ç³»ä¸ºpostå¿…å®šæœ‰user:`required=true`æ‰€ä»¥ä¼šä½¿ç”¨`inner join`ä»£æ›¿`left join`**

å¸–å­å†…å®¹è¿”å›ç”¨æˆ·å
---------

æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨å…³è”è®©å¸–å­ç­›é€‰æ”¯æŒç”¨æˆ·å§“å,é‚£ä¹ˆå¦‚æœæˆ‘ä»¬éœ€è¦è¿”å›å¸–å­å’Œå¯¹åº”çš„å‘å¸–äººå§“ååº”è¯¥æ€ä¹ˆå¤„ç†å‘¢

### åˆ›å»ºå“åº”dto

    /**
     * create time 2025/8/6 22:45
     * {@link com.eq.doc.domain.Post} â‘ 
     *
     * @author xuejiaming
     */
    @Data
    @EntityProxy â‘¡
    @SuppressWarnings("EasyQueryFieldMissMatch") â‘¢
    public class PostPage4Response {
        private String id;
        private String title;
        private String content;
        private String userId;
        private LocalDateTime publishAt;
        
        private String userName; â‘£
    }
    
    

*   â‘ åœ¨dtoä¸Šæ ‡è®°å½“å‰è¡¨æ¥è‡ªäºå“ªå¼ è¡¨,æ’ä»¶å¯ä»¥æç¤ºç›¸å…³é”™è¯¯
*   â‘¡è‡ªå®šä¹‰dtoå¯¹è±¡ä»£ç†å®ç°è¡¨è¾¾å¼å†…èµ‹å€¼
*   â‘¢å› ä¸ºâ‘ çš„å­˜åœ¨æ‰€ä»¥â‘£ä¼šæœ‰æ’ä»¶æç¤ºä¸å­˜åœ¨è¿™ä¸ªå­—æ®µçš„è­¦å‘Šï¼Œé€šè¿‡æ·»åŠ â‘¢æ¥è®©æ’ä»¶ä¸è¿›è¡Œæç¤º
*   â‘£é¢å¤–å¢åŠ ä¸€ä¸ªå­—æ®µæ¥å—ç”¨æˆ·å§“å

    
        @PostMapping("/page5")
        public EasyPageResult<PostPage4Response> page5(@RequestBody PostPage4Request request) {
            return easyEntityQuery.queryable(Post.class)
                    .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                    .where(t_post -> {
                        t_post.title().contains(request.getTitle());
                        t_post.user().name().contains(request.getUserName());
                    })
                    .orderBy(request.getOrders() != null, t_post -> {
                        for (PostPage4Request.InternalOrder order : request.getOrders()) {
                            t_post.anyColumn(order.getProperty()).orderBy(order.isAsc());
                        }
                    })
                    .select(t_post -> new PostPage4ResponseProxy() â‘ 
                            .id().set(t_post.id())
                            .title().set(t_post.title())
                            .content().set(t_post.content())
                            .userId().set(t_post.userId())
                            .publishAt().set(t_post.publishAt())
                            .userName().set(t_post.user().name()) â‘¡
                    )
                    .toPageResult(request.getPageIndex(), request.getPageSize());
        }
    

*   â‘ é€šè¿‡@EntityProxyæ³¨è§£eqæ¡†æ¶ä¼šç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œæ”¹å¯¹è±¡æ”¯æŒdslè¡¨è¾¾å¼èµ‹å€¼
*   â‘¡é€šè¿‡ä½¿ç”¨éšå¼joinçš„æ–¹å¼èµ‹å€¼åˆ°dtoä¸­

    ==> Preparing: SELECT COUNT(*) FROM `t_post` t
    
    ==> Preparing: SELECT t.`id` AS `id`,t.`title` AS `title`,t.`content` AS `content`,t.`user_id` AS `user_id`,t.`publish_at` AS `publish_at`,t1.`name` AS `user_name` FROM `t_post` t INNER JOIN `t_user` t1 ON t1.`id` = t.`user_id` ORDER BY t.`title` ASC LIMIT 5
    

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„sqlå°†`join`çš„`user`è¡¨çš„`name`èµ‹å€¼ç»™äº†dtoçš„`userName`å±æ€§

é‚£ä¹ˆå¦‚æœå±æ€§å¾ˆå¤šåˆä¸€æ ·æˆ‘ä»¬æ˜¯å¦å¯ä»¥æœ‰å»ºè®®æ–¹ä¾¿çš„åšæ³•å‘¢

    .select(t_post -> new PostPage4ResponseProxy()
            .selectAll(t_post) â‘ 
            .userName().set(t_post.user().name())
    )
    

*   â‘ å°†åŸå…ˆçš„å±æ€§èµ‹å€¼ä½¿ç”¨`selectAll`è¿›è¡Œå¤åˆ¶å¦‚æœå­˜åœ¨ä¸éœ€è¦çš„å­—æ®µåˆ™å¯é€šè¿‡`selectIgnores`è¿›è¡Œæ’é™¤å¦‚ä¸‹

    
            return easyEntityQuery.queryable(Post.class)
                    .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                    .where(t_post -> {
                        t_post.title().contains(request.getTitle());
                        t_post.user().name().contains(request.getUserName());
                    })
                    .orderBy(request.getOrders() != null, t_post -> {
                        for (PostPage4Request.InternalOrder order : request.getOrders()) {
                            t_post.anyColumn(order.getProperty()).orderBy(order.isAsc());
                        }
                    })
                    .select(t_post -> new PostPage4ResponseProxy()
                            .selectAll(t_post)//æŸ¥è¯¢postçš„å…¨å­—æ®µ
                            .selectIgnores(t_post.title())//æ’é™¤title
                            .userName().set(t_post.user().name())
                    )
                    .toPageResult(request.getPageIndex(), request.getPageSize());
    

    ==> Preparing: SELECT COUNT(*) FROM `t_post` t
    
    ==> Preparing: SELECT t.`id`,t.`content`,t.`user_id`,t.`publish_at`,t1.`name` AS `user_name` FROM `t_post` t INNER JOIN `t_user` t1 ON t1.`id` = t.`user_id` ORDER BY t.`title` ASC LIMIT 5
    
    

é‚£ä¹ˆæ˜¯å¦æœ‰ä¸ä½¿ç”¨@EntityProxyçš„æ–¹å¼æ¥è¿”å›å‘¢

### includeæŸ¥è¯¢

æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›è¿”å›çš„æ•°æ®å†…å®¹åŒ…å«ç”¨æˆ·ç›¸å…³ä¿¡æ¯é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•æ“ä½œæ‰èƒ½å°†è¿”å›çš„postä¿¡æ¯é‡Œé¢åŒ…å«userä¿¡æ¯å‘¢

    
        @PostMapping("/page7")
        public EasyPageResult<Post> page7(@RequestBody PostPage7Request request) {
            return easyEntityQuery.queryable(Post.class)
                    .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                    .include(t_post -> t_post.user())
                    .where(t_post -> {
                        t_post.title().contains(request.getTitle());
                        t_post.user().name().contains(request.getUserName());
                    })
                    .toPageResult(request.getPageIndex(), request.getPageSize());
        }
    

è¿™æ¬¡æˆ‘ä»¬é€‰æ‹©è¿”å›postæœ¬ä½“å¯¹è±¡,å¹¶ä¸”ä¸å®šä¹‰dtoç»“æ„è¿”å›

    ==> Preparing: SELECT COUNT(*) FROM `t_post` t
    
    
    ==> Preparing: SELECT t.`id`,t.`title`,t.`content`,t.`user_id`,t.`publish_at` FROM `t_post` t LIMIT 5
    
    
    ==> Preparing: SELECT t.`id`,t.`name`,t.`phone`,t.`create_at` FROM `t_user` t WHERE t.`id` IN (?,?,?,?)
    ==> Parameters: c529b9ba-a90d-490e-9bad-15ef7c4f33cc(String),8510a91a-274e-494f-9325-f55c004706e5(String),1b59fa07-1824-4e01-a491-c780d167cf44(String),23376c96-a315-4a3f-aeb8-2e29c02f330b(String)
    

æ¡†æ¶é€šè¿‡å¤šæ¬¡åˆ†æ‰¹è¿”å›å°†æ•´ä¸ªæ•°æ®è¿”å›(æ³¨æ„æ•°æ®äºŒæ¬¡æŸ¥è¯¢æ²¡æœ‰N+1é—®é¢˜å®Œå…¨æ”¾å¿ƒä½¿ç”¨)ï¼Œä¸”è¿”å›çš„æ•°æ®æ˜¯ä»¥ç»“æ„åŒ–å¯¹è±¡çš„å½¢å¼æ¥è¿”å›åˆ°å‰ç«¯çš„

è¿”å›çš„å“åº”æ•°æ®

    
            {
                "id": "0c7fd05f-f999-4fcc-8c98-c0509b22b7f1",
                "title": "å¥èº«è®¡åˆ’åˆ†äº«",
                "content": "# è¿™æ˜¯ç”¨æˆ·ç”¨æˆ·Dçš„å¸–å­å†…å®¹\nåŒ…å«ä¸°å¯Œçš„æ–‡æœ¬å†…å®¹...",
                "userId": "c529b9ba-a90d-490e-9bad-15ef7c4f33cc",
                "publishAt": "2025-08-03T21:24:00.577",
                "user": {
                    "id": "c529b9ba-a90d-490e-9bad-15ef7c4f33cc",
                    "name": "ç”¨æˆ·D",
                    "phone": "18806982998",
                    "createAt": "2025-07-10T13:24:00.576"
                }
            }
    

é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¸Œæœ›è¿”å›çš„æ—¶å€™åªè¿”å›userçš„idå’Œnameåº”è¯¥å¦‚ä½•å®ç°

*   ç¬¬ä¸€ç§è¿”å›æ•°æ®åº“å¯¹è±¡ä½†æ˜¯åªæŸ¥è¯¢idå’Œname
*   ç¬¬äºŒç§å®šä¹‰dtoä½¿ç”¨`selectAutoInclude`

### includeéƒ¨åˆ†åˆ—

    easyEntityQuery.queryable(Post.class)
                    .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                    .include(t_post -> t_post.user(),uq->{
                        uq.select(u->u.FETCHER.id().name());
                    })
                    .where(t_post -> {
                        t_post.title().contains(request.getTitle());
                        t_post.user().name().contains(request.getUserName());
                    })
                    .toList()
    

    ==> Preparing: SELECT COUNT(*) FROM `t_post` t
    
    
    ==> Preparing: SELECT t.`id`,t.`title`,t.`content`,t.`user_id`,t.`publish_at` FROM `t_post` t LIMIT 5
    
    
    ==> Preparing: SELECT t.`id`,t.`name` FROM `t_user` t WHERE t.`id` IN (?,?,?,?)
    ==> Parameters: c529b9ba-a90d-490e-9bad-15ef7c4f33cc(String),8510a91a-274e-494f-9325-f55c004706e5(String),1b59fa07-1824-4e01-a491-c780d167cf44(String),23376c96-a315-4a3f-aeb8-2e29c02f330b(String)
    
    

è¿”å›çš„å“åº”æ•°æ®

    
            {
                "id": "0c7fd05f-f999-4fcc-8c98-c0509b22b7f1",
                "title": "å¥èº«è®¡åˆ’åˆ†äº«",
                "content": "# è¿™æ˜¯ç”¨æˆ·ç”¨æˆ·Dçš„å¸–å­å†…å®¹\nåŒ…å«ä¸°å¯Œçš„æ–‡æœ¬å†…å®¹...",
                "userId": "c529b9ba-a90d-490e-9bad-15ef7c4f33cc",
                "publishAt": "2025-08-03T21:24:00.577",
                "user": {
                    "id": "c529b9ba-a90d-490e-9bad-15ef7c4f33cc",
                    "name": "ç”¨æˆ·D",
                    "phone": null,
                    "createAt": null
                }
            }
    

includeå‡½æ•°å­˜åœ¨å¤šä¸ªé‡è½½å…¶ä¸­ç¬¬äºŒå‚æ•°ç”¨äºæè¿°å‰ä¸€ä¸ªincludeå’Œå¯¹åº”çš„é¢å¤–æ“ä½œè¿™è¾¹è®¾ç½®ä¸ºåªè¿”å›idå’Œname

æˆ‘ä»¬çœ‹åˆ°æŸ¥è¯¢çš„æ—¶å€™ä»…æŸ¥è¯¢idå’Œname

è¿™ç§æŸ¥è¯¢è¿”å›çš„ä»»ç„¶æ˜¯æ•°æ®åº“å¯¹è±¡æ‰€ä»¥æ— æ³•å†è¿”å›çš„å½¢çŠ¶ä¸Šç§»é™¤`phone`å’Œ`createAt`,é‚£ä¹ˆæ˜¯å¦æœ‰ä¸€ç§åŠæ³•å¯ä»¥åšåˆ°å½¢çŠ¶ç¡®å®šå‘¢

ç­”æ¡ˆæ˜¯æœ‰çš„æ—¶å€™dtoæ¥ä»£æ›¿æ•°æ®åº“å¯¹è±¡åœ¨ä½¿ç”¨`selectAutoInclude`api

### ç»“æ„åŒ–dto

ç»“æ„åŒ–dtoç”¨æ¥è¿”å›dtoä¸”å½¢çŠ¶ç¡®å®šé€‚åˆç”Ÿæˆæ–‡æ¡£å’Œä¸‹æ¸¸æ•°æ®äº¤äº’é‚£ä¹ˆå¯ä»¥é€šè¿‡å®‰è£…æ’ä»¶åè¿›è¡Œå¦‚ä¸‹æ“ä½œ

ç¬¬ä¸€æ­¥æˆ‘ä»¬ä½¿ç”¨æ’ä»¶åˆ›å»ºç»“æ„åŒ–dto

åœ¨dtoçš„packageå¤„å³é”®é€‰æ‹©`CreateStructDTO`

ç¬¬äºŒæ­¥é€‰æ‹©è¦è¿”å›çš„å¯¹è±¡

ç¬¬ä¸‰æ­¥å‹¾é€‰è¦è¿”å›çš„å­—æ®µ

ç¡®å®šdtoåç§°åæ¡†æ¶ä¼šå¸®æˆ‘ä»¬ç›´æ¥ç”Ÿæˆdtoå¯¹è±¡

    
    /**
     * this file automatically generated by easy-query struct dto mapping
     * å½“å‰æ–‡ä»¶æ˜¯easy-queryè‡ªåŠ¨ç”Ÿæˆçš„ ç»“æ„åŒ–dto æ˜ å°„
     * {@link com.eq.doc.domain.Post }
     *
     * @author xuejiaming
     * @easy-query-dto schema: normal
     */
    @Data
    public class PostDTO {
    
    
        @Column(comment = "å¸–å­id")
        private String id;
        @Column(comment = "å¸–å­æ ‡é¢˜")
        private String title;
        @Column(comment = "å¸–å­å†…å®¹")
        private String content;
        @Column(comment = "å‘å¸ƒæ—¶é—´")
        private LocalDateTime publishAt;
        /**
         * å‘å¸–äºº
         **/
        @Navigate(value = RelationTypeEnum.ManyToOne)
        private InternalUser user;
    
    
        /**
         * {@link com.eq.doc.domain.User }
         */
        @Data
        public static class InternalUser {
            @Column(comment = "ç”¨æˆ·id")
            private String id;
            @Column(comment = "ç”¨æˆ·å§“å")
            private String name;
    
    
        }
    
    }
    
    
    @PostMapping("/selectAutoInclude")
    public List<PostDTO> selectAutoInclude(@RequestBody PostPage7Request request) {
        return easyEntityQuery.queryable(Post.class)
                .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                .include(t_post -> t_post.user(),uq->{
                    uq.select(u->u.FETCHER.id().name());
                })
                .where(t_post -> {
                    t_post.title().contains(request.getTitle());
                    t_post.user().name().contains(request.getUserName());
                })
                .selectAutoInclude(PostDTO.class) â‘ 
                .toList();
    }
    

    ==> Preparing: SELECT t.`id`,t.`title`,t.`content`,t.`publish_at`,t.`user_id` AS `__relation__userId` FROM `t_post` t
    
    
    ==> Preparing: SELECT t.`id`,t.`name` FROM `t_user` t WHERE t.`id` IN (?,?,?,?,?)
    ==> Parameters: c529b9ba-a90d-490e-9bad-15ef7c4f33cc(String),8510a91a-274e-494f-9325-f55c004706e5(String),1b59fa07-1824-4e01-a491-c780d167cf44(String),23376c96-a315-4a3f-aeb8-2e29c02f330b(String),947ee5fd-5fd0-4889-94e3-03c5efff2c3a(String)
    

    
        {
            "id": "0c7fd05f-f999-4fcc-8c98-c0509b22b7f1",
            "title": "å¥èº«è®¡åˆ’åˆ†äº«",
            "content": "# è¿™æ˜¯ç”¨æˆ·ç”¨æˆ·Dçš„å¸–å­å†…å®¹\nåŒ…å«ä¸°å¯Œçš„æ–‡æœ¬å†…å®¹...",
            "publishAt": "2025-08-03T21:24:00.577",
            "user": {
                "id": "c529b9ba-a90d-490e-9bad-15ef7c4f33cc",
                "name": "ç”¨æˆ·D"
            }
        }
    

æ¡†æ¶ä¾ç„¶é€šè¿‡inæ¥è§£å†³n+1çš„é—®é¢˜å®ç°ç»“æ„åŒ–çš„å¯¹è±¡è¿”å›,æ¡†æ¶æ”¯æŒä»»æ„ç»“æ„åŒ–å¯¹è±¡è¿”å›åŒ…æ‹¬ç»“æ„åŒ–å¯¹è±¡æ‰å¹³åŒ–

*   â‘ `selectAutoInclude`æ˜¯`select`apiå’Œ`include`çš„ç»“åˆï¼Œä¼šè‡ªåŠ¨å®‰è£…dtoçš„è¦æ±‚å°†æ•°æ®ç»“æ„è¿›è¡Œç»„è£…è¿”å›

**è¯´æ˜!!!**  
**\> æ³¨æ„åƒä¸‡ä¸è¦å†`selectAutoInclude`ä¸­ä¼ å…¥æ•°æ®åº“å¯¹è±¡,å› ä¸ºæ•°æ®åº“å¯¹è±¡çš„ä¼ å…¥ä¼šå¯¼è‡´`selectAutoInclude`å°†æ•´ä¸ªå…³ç³»æ ‘è¿æ ¹æ‹”èµ·éƒ½æŸ¥è¯¢å‡ºæ¥**  
**\> æ³¨æ„åƒä¸‡ä¸è¦å†`selectAutoInclude`ä¸­ä¼ å…¥æ•°æ®åº“å¯¹è±¡,å› ä¸ºæ•°æ®åº“å¯¹è±¡çš„ä¼ å…¥ä¼šå¯¼è‡´`selectAutoInclude`å°†æ•´ä¸ªå…³ç³»æ ‘è¿æ ¹æ‹”èµ·éƒ½æŸ¥è¯¢å‡ºæ¥**  
**\> æ³¨æ„åƒä¸‡ä¸è¦å†`selectAutoInclude`ä¸­ä¼ å…¥æ•°æ®åº“å¯¹è±¡,å› ä¸ºæ•°æ®åº“å¯¹è±¡çš„ä¼ å…¥ä¼šå¯¼è‡´`selectAutoInclude`å°†æ•´ä¸ªå…³ç³»æ ‘è¿æ ¹æ‹”èµ·éƒ½æŸ¥è¯¢å‡ºæ¥**

**selectAutoInclude!!!**  
**\> `selectAutoInclude`è¿™ä¸ªapiæ˜¯eqçš„æ ¸å¿ƒæ•°æ®æŸ¥è¯¢apiä¹‹ä¸€ç”¨æˆ·å¿…é¡»å®Œå…¨æŒæ¡å¯ä»¥æé«˜1000%çš„æ•ˆç‡,å¹¶ä¸”æ²¡æœ‰n+1é—®é¢˜æ”¯æŒåç»­ä¸€å¯¹ä¸€ ä¸€å¯¹å¤šçš„ä»»æ„æ•°æ®ç©¿é€æŸ¥è¯¢**

### NavigateFlat ğŸ”¥

è¿”å›æ•°æ®çš„æ—¶å€™æˆ‘ä»¬å¦‚æœä¸å¸Œæœ›ä»¥ç»“æ„åŒ–å¯¹è±¡çš„å½¢å¼è¿”å›,å¸Œæœ›å°†userå¯¹è±¡å¹³é“ºåˆ°æ•´ä¸ªpostä¸­ï¼Œåˆä¸å¸Œæœ›ä½¿ç”¨setæ‰‹åŠ¨å¤åˆ¶é‚£ä¹ˆå¯ä»¥é€šè¿‡`@NavigateFlat`æ¥å®ç°é¢å¤–å±æ€§çš„è·å–

    
    /**
     * create time 2025/8/6 22:45
     * {@link com.eq.doc.domain.Post} â‘ 
     *
     * @author xuejiaming
     */
    @Data
    public class PostPage6Response {
        private String id;
        private String title;
        private String content;
        private String userId;
        private LocalDateTime publishAt;
    
        @NavigateFlat(pathAlias = "user.id") â‘¡
        private String userName;
    }
    
    

æ³¨æ„æˆ‘ä»¬å¿…é¡»è¦å°†â‘ çš„linkè¡¨ç¤ºæ·»åŠ ä¸Šï¼Œè¿™æ ·æˆ‘ä»¬åœ¨å†™â‘¡çš„pathAliasæ—¶æ’ä»¶ä¼šè‡ªåŠ¨ç»™å‡ºç›¸åº”çš„æç¤º,æŸ¥è¯¢æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨`selectAutoInclude`æ¥å®ç°ä¸‡èƒ½æŸ¥è¯¢

    
        @PostMapping("/page6")
        public EasyPageResult<PostPage6Response> page6(@RequestBody PostPage4Request request) {
            return easyEntityQuery.queryable(Post.class)
                    .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                    .where(t_post -> {
                        t_post.title().contains(request.getTitle());
                        t_post.user().name().contains(request.getUserName());
                    })
                    .orderBy(request.getOrders() != null, t_post -> {
                        for (PostPage4Request.InternalOrder order : request.getOrders()) {
                            t_post.anyColumn(order.getProperty()).orderBy(order.isAsc());
                        }
                    })
                    .selectAutoInclude(PostPage6Response.class)
                    .toPageResult(request.getPageIndex(), request.getPageSize());
        }
    

    ==> Preparing: SELECT COUNT(*) FROM `t_post` t
    
    
    ==> Preparing: SELECT t.`id`,t.`title`,t.`content`,t.`user_id`,t.`publish_at` FROM `t_post` t ORDER BY t.`title` ASC LIMIT 5
    
    
    ==> Preparing: SELECT `id` FROM `t_user` WHERE `id` IN (?,?,?)
    ==> Parameters: 8510a91a-274e-494f-9325-f55c004706e5(String),23376c96-a315-4a3f-aeb8-2e29c02f330b(String),c529b9ba-a90d-490e-9bad-15ef7c4f33cc(String)
    

**\> æ³¨æ„åƒä¸‡ä¸è¦å†`selectAutoInclude`ä¸­ä¼ å…¥æ•°æ®åº“å¯¹è±¡,å› ä¸ºæ•°æ®åº“å¯¹è±¡çš„ä¼ å…¥ä¼šå¯¼è‡´`selectAutoInclude`å°†æ•´ä¸ªå…³ç³»æ ‘è¿æ ¹æ‹”èµ·éƒ½æŸ¥è¯¢å‡ºæ¥**  
**\> æ³¨æ„åƒä¸‡ä¸è¦å†`selectAutoInclude`ä¸­ä¼ å…¥æ•°æ®åº“å¯¹è±¡,å› ä¸ºæ•°æ®åº“å¯¹è±¡çš„ä¼ å…¥ä¼šå¯¼è‡´`selectAutoInclude`å°†æ•´ä¸ªå…³ç³»æ ‘è¿æ ¹æ‹”èµ·éƒ½æŸ¥è¯¢å‡ºæ¥**  
**\> æ³¨æ„åƒä¸‡ä¸è¦å†`selectAutoInclude`ä¸­ä¼ å…¥æ•°æ®åº“å¯¹è±¡,å› ä¸ºæ•°æ®åº“å¯¹è±¡çš„ä¼ å…¥ä¼šå¯¼è‡´`selectAutoInclude`å°†æ•´ä¸ªå…³ç³»æ ‘è¿æ ¹æ‹”èµ·éƒ½æŸ¥è¯¢å‡ºæ¥**

`@NavigateFlat`æ”¯æŒä»»æ„çº§åˆ«å¯¹è±¡å…³ç³»è·å–,å¦‚æœå¯¹è±¡å…³ç³»è·å–ä¸­é—´å­˜åœ¨`toMany`æ— è®ºæ˜¯OneToManyè¿˜æ˜¯`ManyToMany`é‚£ä¹ˆæœ€ç»ˆéƒ½ä¼šå˜æˆ`List<?>`é›†åˆ

å¸–å­å†…å®¹å¸¦è¯„è®º
-------

ç®€å•çš„é¢å¤–å¯¹è±¡è·å–åæˆ‘ä»¬å¸Œæœ›å®ç°è¿”å›ç»™å‰ç«¯å¸–å­å†…å®¹å¹¶ä¸”æºå¸¦ä¸Šå‰ä¸‰æ¡ç›¸å…³è¯„è®ºï¼Œé‚£ä¹ˆeqæœ‰å‡ ç§æ–¹å¼å‘¢

*   `NaviagteFlat`+`limit`+`union`
*   `NaviagteFlat`+`limit`+`partition by`
*   `subquery`+`limit`+`joining`

### è¯„è®ºå…³ç³»æ·»åŠ 

    
    @Data
    @Table("t_post")
    @EntityProxy
    @EasyAlias("t_post")
    @EasyAssertMessage("æœªæ‰¾åˆ°å¯¹åº”çš„å¸–å­ä¿¡æ¯")
    public class Post implements ProxyEntityAvailable<Post, PostProxy> {
        //....ä¸šåŠ¡å­—æ®µ
    
        /**
         * å‘å¸–äºº
         **/
        @Navigate(value = RelationTypeEnum.ManyToOne,
                selfProperty = {PostProxy.Fields.userId},
                targetProperty = {UserProxy.Fields.id},
                required = true)
        private User user;
    
    
        /**
         * è¯„è®ºä¿¡æ¯
         **/
        @Navigate(value = RelationTypeEnum.OneToMany,
                selfProperty = {PostProxy.Fields.id},
                targetProperty = {CommentProxy.Fields.postId})
        private List<Comment> commentList;
    }
    
    

å› ä¸ºå¸–å­å’Œè¯„è®ºçš„å…³ç³»æ˜¯ä¸€å¯¹å¤šæ‰€ä»¥æˆ‘ä»¬åœ¨å¸–å­é‡Œé¢é€šè¿‡æ’ä»¶æˆ–è€…æ‰‹åŠ¨æ·»åŠ å…³è”å…³ç³»

### limit+union

é¦–å…ˆæˆ‘ä»¬å®šä¹‰å¥½éœ€è¦è¿”å›çš„å¯¹è±¡

    
    /**
     * create time 2025/8/6 22:45
     * {@link com.eq.doc.domain.Post}
     *
     * @author xuejiaming
     */
    @Data
    public class PostPage8Response {
        private String id;
        private String title;
        private String content;
        private String userId;
        private LocalDateTime publishAt;
    
        @NavigateFlat(pathAlias = "user.id")
        private String userName;
    
        /**
         * è¯„è®ºä¿¡æ¯
         **/
        @Navigate(value = RelationTypeEnum.OneToMany,orderByProps = {
                @OrderByProperty(property = "createAt",asc = true)
        },limit = 3)
        private List<InternalComment> commentList;
    
        /**
         * {@link Comment}
         **/
        @Data
        public static class InternalComment {
            private String id;
            private String parentId;
            private String content;
            private LocalDateTime createAt;
        }
    
    }
    

è¿™æ ·æˆ‘ä»¬å°±è®¾ç½®å¥½äº†è¦è¿”å›çš„æ•°æ®å¹¶ä¸”æ”¯æŒé¢å¤–è¿”å›3æ¡è¯„è®º

    
        @PostMapping("/postWithCommentPage")
        public List<PostPage8Response> postWithCommentPage(@RequestBody PostPage7Request request) {
            return easyEntityQuery.queryable(Post.class)
                    .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                    .where(t_post -> {
                        t_post.title().contains(request.getTitle());
                        t_post.user().name().contains(request.getUserName());
                    })
                    .selectAutoInclude(PostPage8Response.class).toList();
        }
    

    
        {
            "id": "0c7fd05f-f999-4fcc-8c98-c0509b22b7f1",
            "title": "å¥èº«è®¡åˆ’åˆ†äº«",
            "content": "# è¿™æ˜¯ç”¨æˆ·ç”¨æˆ·Dçš„å¸–å­å†…å®¹\nåŒ…å«ä¸°å¯Œçš„æ–‡æœ¬å†…å®¹...",
            "userId": "c529b9ba-a90d-490e-9bad-15ef7c4f33cc",
            "publishAt": "2025-08-03T21:24:00.577",
            "userName": "c529b9ba-a90d-490e-9bad-15ef7c4f33cc",
            "commentList": [
                {
                    "id": "67c9ceb0-3eef-44ba-8bbc-c0d1f15f00ad",
                    "parentId": "0",
                    "content": "æœŸå¾…æ›´å¤šè¿™æ ·çš„å†…å®¹",
                    "createAt": "2025-08-05T17:24:00.579"
                },
                {
                    "id": "d7753586-4bb9-448b-bedb-b178df897bca",
                    "parentId": "fa80aaa0-9742-4a02-9209-a08d1bd979df",
                    "content": "@ç”¨æˆ·B æˆ‘ä¹Ÿè¿™ä¹ˆè®¤ä¸º",
                    "createAt": "2025-08-06T00:24:00.579"
                },
                {
                    "id": "2b40e873-5c0d-41c4-bf10-a38461017300",
                    "parentId": "67c9ceb0-3eef-44ba-8bbc-c0d1f15f00ad",
                    "content": "@ç”¨æˆ·C å…·ä½“æ˜¯æŒ‡å“ªæ–¹é¢ï¼Ÿ",
                    "createAt": "2025-08-06T03:24:00.579"
                }
            ]
        }
    

æˆ‘ä»¬çœ‹åˆ°çœŸçš„å’Œç¼–å†™çš„dtoå¦‚å‡ºä¸€è¾™çš„è¿”å›äº†æŸ¥è¯¢ç»“æœ

    -- ç¬¬1æ¡sqlæ•°æ®
     SELECT
            t.`id`,
            t.`title`,
            t.`content`,
            t.`user_id`,
            t.`publish_at` 
        FROM
            `t_post` t
    
    -- ç¬¬2æ¡sqlæ•°æ®
    SELECT t1.`id`, t1.`parent_id`, t1.`content`, t1.`create_at`, t1.`post_id` AS `__relation__postId`
    FROM (
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = 'c529b9ba-a90d-490e-9bad-15ef7c4f33cc'
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    	UNION ALL
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = '8510a91a-274e-494f-9325-f55c004706e5'
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    	UNION ALL
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = '1b59fa07-1824-4e01-a491-c780d167cf44'
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    	UNION ALL
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = '23376c96-a315-4a3f-aeb8-2e29c02f330b'
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    	UNION ALL
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = '947ee5fd-5fd0-4889-94e3-03c5efff2c3a'
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    	UNION ALL
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = ?
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    	UNION ALL
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = ?
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    	UNION ALL
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = ?
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    	UNION ALL
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = ?
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    	UNION ALL
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = ?
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    	UNION ALL
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = ?
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    	UNION ALL
    	(SELECT t.`id`, t.`parent_id`, t.`content`, t.`user_id`, t.`post_id`
    		, t.`create_at`
    	FROM `t_comment` t
    	WHERE t.`post_id` = ?
    	ORDER BY t.`create_at` ASC
    	LIMIT 3)
    ) t1
    -- ç¬¬3æ¡sqlæ•°æ®
       SELECT
            `id` 
        FROM
            `t_user` 
        WHERE
            `id` IN (?, ?, ?, ?, ?)
    

ä¸€ä¸ªç”Ÿæˆäº†ä¸‰æ¡sqlï¼Œä¸­limit+unionæ˜¯ç¬¬äºŒæ¡sql,ä½†æ˜¯unionç›¸å¯¹sqlä¼šå˜å¾—å¤æ‚å¹¶ä¸”å†—ä½™æ‰€ä»¥æˆ‘ä»¬å°è¯•eqæä¾›çš„ç¬¬äºŒç§æ–¹å¼

### limit+partition by

`springboot`çš„a`pplication.yml`å¢åŠ é…ç½®é¡¹

    easy-query:
      #æ”¯æŒçš„æ•°æ®åº“
      database: mysql
      #å¯¹è±¡å±æ€§å’Œæ•°æ®åº“åˆ—åçš„è½¬æ¢å™¨
      name-conversion: underlined
      default-track: true
      include-limit-mode: partition
    

*   `include-limit-mode: partition`è¿™å¥è¯è®©åŸå…ˆçš„`union all`å˜æˆ`partition`(åç»­`partition`å¯èƒ½ä¼šå˜æˆé»˜è®¤)

æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­è¯·æ±‚

    
    -- ç¬¬1æ¡sqlæ•°æ®
    
        SELECT
            t.`id`,
            t.`title`,
            t.`content`,
            t.`user_id`,
            t.`publish_at` 
        FROM
            `t_post` t
    
    
    -- ç¬¬2æ¡sqlæ•°æ®
    
        SELECT
            t2.`id` AS `id`,
            t2.`parent_id` AS `parent_id`,
            t2.`content` AS `content`,
            t2.`create_at` AS `create_at`,
            t2.`post_id` AS `__relation__postId` 
        FROM
            (SELECT
                t1.`id` AS `id`,
                t1.`parent_id` AS `parent_id`,
                t1.`content` AS `content`,
                t1.`user_id` AS `user_id`,
                t1.`post_id` AS `post_id`,
                t1.`create_at` AS `create_at` 
            FROM
                (SELECT
                    t.`id`,
                    t.`parent_id`,
                    t.`content`,
                    t.`user_id`,
                    t.`post_id`,
                    t.`create_at`,
                    (ROW_NUMBER() OVER (PARTITION 
                BY
                    t.`post_id` 
                ORDER BY
                    t.`create_at` ASC)) AS `__row__` 
                FROM
                    `t_comment` t 
                WHERE
                    t.`post_id` IN ('09e8395e-b7f7-48b4-8227-fcbf96c35d1e', '5d40f560-af15-4566-93cd-9359e0a27501', '76cdba56-b1f8-4432-bc0e-764d491c6cd5', '81eb5fb7-ec57-45d3-b9b9-5e6217ec4d31', '8a6f16a6-b51e-4a39-9ea9-fda57502bb29', 'a6982186-afc5-4f49-977d-97ff8c25cd9f', 'b1eb997d-9cb0-40ca-9495-a9d41da21125', 'b4f74aeb-3868-4810-9845-cab9e882229b', 'bf7e62ee-d833-4f5a-9a0a-07b9634ba26a', 'c6d0631f-160a-4a8c-8401-62db614f87c8', 'd9629994-d9fa-46a3-bd7c-5982f0900a3d', 'ed01ea8a-4162-42ba-a632-dd6d67bf9d45', 'f27edcf7-0fd8-44e3-b3cc-cbba41427dfe')) t1 
            WHERE
                t1.`__row__` >= 1 
                AND t1.`__row__` <= 3) t2
    
    
    
    -- ç¬¬3æ¡sqlæ•°æ®
    
        SELECT
            `id` 
        FROM
            `t_user` 
        WHERE
            `id` IN ('15b6a7c1-3f27-4d21-b67c-9c05cd9bf4b6', '2ae21dfa-9330-4d8c-bbfa-6b4618c56c45', '6e50464d-17a7-4f12-8458-c896d55dd276', '1d2a9d56-63df-4413-bd83-ff9a0c0a2166', '2ede4599-8f1a-4d0c-a0af-0dd50d903b87')
    

    {
            "id": "5d40f560-af15-4566-93cd-9359e0a27501",
            "title": "å¥èº«è®¡åˆ’åˆ†äº«",
            "content": "# è¿™æ˜¯ç”¨æˆ·ç”¨æˆ·Eçš„å¸–å­å†…å®¹\nåŒ…å«ä¸°å¯Œçš„æ–‡æœ¬å†…å®¹...",
            "userId": "2ae21dfa-9330-4d8c-bbfa-6b4618c56c45",
            "publishAt": "2025-08-04T08:09:30.301",
            "userName": "2ae21dfa-9330-4d8c-bbfa-6b4618c56c45",
            "commentList": [
                {
                    "id": "de5337b2-e13c-49f3-9b15-ac393784fc6f",
                    "parentId": "46da0914-b046-45ad-8847-1c65c82ac71c",
                    "content": "@ç”¨æˆ·C æœ‰ä¸åŒçœ‹æ³•ï¼š",
                    "createAt": "2025-08-07T06:09:30.304"
                },
                {
                    "id": "daf5102c-b4dd-4f65-bee6-9b3df4f1b5d9",
                    "parentId": "0",
                    "content": "å†™å¾—çœŸè¯¦ç»†",
                    "createAt": "2025-08-07T09:09:30.304"
                },
                {
                    "id": "46da0914-b046-45ad-8847-1c65c82ac71c",
                    "parentId": "0",
                    "content": "æœŸå¾…æ›´å¤šè¿™æ ·çš„å†…å®¹",
                    "createAt": "2025-08-07T10:09:30.304"
                }
            ]
        }
    

æˆ‘ä»¬çœ‹åˆ°é€šè¿‡ç®€å•çš„é…ç½®æˆ‘ä»¬å°†ä¸€å¯¹å¤šè¿”å›å‰næ¡å˜åŠ¨è½»æ¾ç®€å•å¹¶ä¸”å¯ä»¥å¿«é€Ÿå®ç°æ”¯æŒåˆ†é¡µ,ä½†æ˜¯ç»†å¿ƒçš„æœ‹å‹è‚¯å®šå‘ç°äº†ä¸€ä¸ªé—®é¢˜,æˆ‘ä»¬éœ€è¦çš„è¯„è®ºå¹¶ä¸æ˜¯å¹³é“ºåˆ°æ•´ä¸ªpostè´´å­çš„ï¼Œå¸–å­å’Œè¯„è®ºè™½ç„¶æ˜¯ä¸€å¯¹å¤šä½†æ˜¯è¯„è®ºè‡ªå·±ä¹Ÿæ˜¯è‡ªå…³è”ï¼Œè¯„è®ºè®¾è®¡ä¹Ÿæ˜¯æ¥¼ä¸­æ¥¼ä¸ºæ”¯æŒçš„é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¦‚ä½•è®¾ç½®è®©æˆ‘ä»¬è¿”å›çš„è¯„è®ºæ”¯æŒè¿”å›ç¬¬ä¸€å±‚çº§å‘¢

### EXTRA\_AUTO\_INCLUDE\_CONFIGURE

ä½¿ç”¨eqçš„`EXTRA_AUTO_INCLUDE_CONFIGURE`å¯ä»¥å¯¹`selectAutoInclude`çš„æŸ¥è¯¢æ·»åŠ é¢å¤–å­—æ®µæˆ–é¢å¤–æœç´¢æ’åºç­‰å¤„ç†

å…³äº`EXTRA_AUTO_INCLUDE_CONFIGURE`çš„æ›´å¤šä¿¡æ¯è¯·[æŸ¥çœ‹æ–‡æ¡£](/easy-query-doc/ability/return-result/extra)

ç¬¬ä¸€æ­¥å¯¹åŸå§‹çš„dtoå¯¹è±¡è¿›è¡Œæ’ä»¶å¿«é€Ÿæç¤ºæ’å…¥`EXTRA_AUTO_INCLUDE_CONFIGURE`

æˆ‘ä»¬ç§»é™¤`select`æ“ä½œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦

æœ€ç»ˆæˆ‘ä»¬çš„è¿”å›dtoå¦‚ä¸‹

    
    /**
     * create time 2025/8/6 22:45
     * {@link com.eq.doc.domain.Post}
     *
     * @author xuejiaming
     */
    @Data
    public class PostPage9Response {
        private String id;
        private String title;
        private String content;
        private String userId;
        private LocalDateTime publishAt;
    
        @NavigateFlat(pathAlias = "user.id")
        private String userName;
    
        /**
         * è¯„è®ºä¿¡æ¯
         **/
        @Navigate(value = RelationTypeEnum.OneToMany,orderByProps = {
                @OrderByProperty(property = "createAt",asc = true)
        },limit = 3)
        private List<InternalComment> commentList;
    
        /**
         * {@link Comment}
         **/
        @Data
        public static class InternalComment {
    
    
            private static final ExtraAutoIncludeConfigure EXTRA_AUTO_INCLUDE_CONFIGURE = CommentProxy.TABLE.EXTRA_AUTO_INCLUDE_CONFIGURE()
                    .where(t_comment -> {
                        t_comment.parentId().eq("0");
                    });
    
            private String id;
            private String parentId;
            private String content;
            private LocalDateTime createAt;
        }
    
    }
    

æˆ‘ä»¬çœ‹ä¸­é—´sqlå¦‚ä¸‹

    
        SELECT
            t2.`id` AS `id`,
            t2.`parent_id` AS `parent_id`,
            t2.`content` AS `content`,
            t2.`create_at` AS `create_at`,
            t2.`post_id` AS `__relation__postId` 
        FROM
            (SELECT
                t1.`id` AS `id`,
                t1.`parent_id` AS `parent_id`,
                t1.`content` AS `content`,
                t1.`user_id` AS `user_id`,
                t1.`post_id` AS `post_id`,
                t1.`create_at` AS `create_at` 
            FROM
                (SELECT
                    t.`id`,
                    t.`parent_id`,
                    t.`content`,
                    t.`user_id`,
                    t.`post_id`,
                    t.`create_at`,
                    (ROW_NUMBER() OVER (PARTITION 
                BY
                    t.`post_id` 
                ORDER BY
                    t.`create_at` ASC)) AS `__row__` 
                FROM
                    `t_comment` t 
                WHERE
                    t.`parent_id` = '0'  â‘ 
                    AND t.`post_id` IN ('09e8395e-b7f7-48b4-8227-fcbf96c35d1e', '5d40f560-af15-4566-93cd-9359e0a27501', '76cdba56-b1f8-4432-bc0e-764d491c6cd5', '81eb5fb7-ec57-45d3-b9b9-5e6217ec4d31', '8a6f16a6-b51e-4a39-9ea9-fda57502bb29', 'a6982186-afc5-4f49-977d-97ff8c25cd9f', 'b1eb997d-9cb0-40ca-9495-a9d41da21125', 'b4f74aeb-3868-4810-9845-cab9e882229b', 'bf7e62ee-d833-4f5a-9a0a-07b9634ba26a', 'c6d0631f-160a-4a8c-8401-62db614f87c8', 'd9629994-d9fa-46a3-bd7c-5982f0900a3d', 'ed01ea8a-4162-42ba-a632-dd6d67bf9d45', 'f27edcf7-0fd8-44e3-b3cc-cbba41427dfe')) t1 
            WHERE
                t1.`__row__` >= 1 
                AND t1.`__row__` <= 3) t2
    

*   â‘ æ˜¯æˆ‘ä»¬é€šè¿‡é¢å¤–é…ç½®æ·»åŠ ä¸Šå»çš„

è¿”å›çš„jsonå¦‚ä¸‹

    {
            "id": "b4f74aeb-3868-4810-9845-cab9e882229b",
            "title": "åˆæ¢äººå·¥æ™ºèƒ½",
            "content": "# è¿™æ˜¯ç”¨æˆ·ç”¨æˆ·Eçš„å¸–å­å†…å®¹\nåŒ…å«ä¸°å¯Œçš„æ–‡æœ¬å†…å®¹...",
            "userId": "2ae21dfa-9330-4d8c-bbfa-6b4618c56c45",
            "publishAt": "2025-08-07T02:09:30.301",
            "userName": "2ae21dfa-9330-4d8c-bbfa-6b4618c56c45",
            "commentList": [
                {
                    "id": "238fea11-c5d1-4485-977d-a0126cb74402",
                    "parentId": "0",
                    "content": "æœŸå¾…æ›´å¤šè¿™æ ·çš„å†…å®¹",
                    "createAt": "2025-08-07T09:09:30.304"
                },
                {
                    "id": "e216eaf8-bf15-4eeb-aa4c-6489be83c355",
                    "parentId": "0",
                    "content": "å†…å®¹å¾ˆå®ç”¨",
                    "createAt": "2025-08-07T16:09:30.304"
                },
                {
                    "id": "830bd1d9-1600-43a2-94b7-f6426a8a78c9",
                    "parentId": "0",
                    "content": "å†™å¾—çœŸè¯¦ç»†",
                    "createAt": "2025-08-07T17:09:30.304"
                }
            ]
        }
    

æˆ‘ä»¬è¿”å›çš„postèŠ‚ç‚¹å®Œç¾çš„ç¬¦åˆæˆ‘ä»¬å†…å®¹

ä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦è¿”å›çš„æ˜¯postä¿¡æ¯å’Œå‰ä¸‰æ¡å†…å®¹å¹¶ä¸”å°†å‰ä¸‰æ¡å†…å®¹åˆå¹¶åˆ°ä¸€ä¸ªå­—æ®µä¸Šå»é‚£ä¹ˆåº”è¯¥æ€ä¹ˆåš

### joiningé€—å·åˆ†å‰²

ä¸€å¦‚æ—¢å¾€æˆ‘ä»¬è¿˜æ˜¯å®šä¹‰å¯¹åº”çš„dto

    
    @Data
    @EntityProxy
    public class PostPage10Response {
        private String id;
        private String title;
        private String content;
        private String userId;
        private LocalDateTime publishAt;
    
        private String userName;
        
        private String commentContent;
    
    }
    
    
    
        @PostMapping("/postWithCommentPage3")
        public List<PostPage10Response> postWithCommentPage3(@RequestBody PostPage7Request request) {
            return easyEntityQuery.queryable(Post.class)
                    .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                    .where(t_post -> {
                        t_post.title().contains(request.getTitle());
                        t_post.user().name().contains(request.getUserName());
                    })
                    .select(t_post -> new PostPage10ResponseProxy()
                            .selectAll(t_post)
                            .userName().set(t_post.user().name())
                            .commentContent().set(t_post.commentList().where(c->c.parentId().eq("0")).elements(0,2).joining(c->c.content()))
                    ).toList();
        }
    

æˆ‘ä»¬æ¥çœ‹ä¸‹è¡¨è¾¾å¼`t_post.commentList().where(c->c.parentId().eq("0")).joining(c->c.content())`è¿™ä¸ªè¡¨è¾¾å¼æ˜¯å°†postä¸‹æ–¹çš„è¯„è®ºé›†åˆ`commentList`é€šè¿‡whereç­›é€‰å–å‰ä¸‰ä¸ªçš„contentå†…å®¹åˆå¹¶

    {
            "id": "09e8395e-b7f7-48b4-8227-fcbf96c35d1e",
            "title": "å¤æ—¥æ—…è¡Œæ”»ç•¥",
            "content": "# è¿™æ˜¯ç”¨æˆ·ç”¨æˆ·Dçš„å¸–å­å†…å®¹\nåŒ…å«ä¸°å¯Œçš„æ–‡æœ¬å†…å®¹...",
            "userId": "15b6a7c1-3f27-4d21-b67c-9c05cd9bf4b6",
            "publishAt": "2025-08-05T03:09:30.301",
            "userName": "ç”¨æˆ·D",
            "commentContent": "éå¸¸å¥½çš„åˆ†äº«ï¼,æœŸå¾…æ›´å¤šè¿™æ ·çš„å†…å®¹,éå¸¸å¥½çš„åˆ†äº«ï¼"
        },
        {
            "id": "5d40f560-af15-4566-93cd-9359e0a27501",
            "title": "å¥èº«è®¡åˆ’åˆ†äº«",
            "content": "# è¿™æ˜¯ç”¨æˆ·ç”¨æˆ·Eçš„å¸–å­å†…å®¹\nåŒ…å«ä¸°å¯Œçš„æ–‡æœ¬å†…å®¹...",
            "userId": "2ae21dfa-9330-4d8c-bbfa-6b4618c56c45",
            "publishAt": "2025-08-04T08:09:30.301",
            "userName": "ç”¨æˆ·E",
            "commentContent": "å®Œå…¨åŒæ„ä½ çš„è§‚ç‚¹,æœŸå¾…æ›´å¤šè¿™æ ·çš„å†…å®¹,å†™å¾—çœŸè¯¦ç»†"
        }
    

é€šè¿‡ç»“æœæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°`commentContent`è¢«`joining`å‡½æ•°é€šè¿‡é€—å·åˆ†å‰²ç»„åˆåœ¨ä¸€èµ·äº†  
æˆ‘ä»¬å†æ¥çœ‹å¯¹åº”çš„sql

    
        SELECT
            t.`id`,
            t.`title`,
            t.`content`,
            t.`user_id`,
            t.`publish_at`,
            t1.`name` AS `user_name`,
            (SELECT
                GROUP_CONCAT(t2.`content` SEPARATOR ',') 
            FROM
                `t_comment` t2 
            WHERE
                t2.`post_id` = t.`id` 
                AND t2.`parent_id` = '0' 
            LIMIT
                3) AS `comment_content` 
        FROM
            `t_post` t 
        INNER JOIN
            `t_user` t1 
                ON t1.`id` = t.`user_id`
    

æ¡†æ¶é€šè¿‡`selectå­æŸ¥è¯¢`å°†ç»“æœæ¸…æ™°çš„å°†ç»“æœé›†é€šè¿‡`group_concat`å‡½æ•°ç»„è£…åˆ°äº†`comment_content`åˆ—ä¸Š

::: warning æ€§èƒ½!!!

> å¦‚æœç”±ç”¨æˆ·å«Œå¼ƒselectå­æŸ¥è¯¢æ€§èƒ½ä½ä¸‹eqè´´å¿ƒçš„æä¾›äº†å­æŸ¥è¯¢è½¬`groupJoin`åŠ©åŠ›ç”¨æˆ·å®ç°æ›´é«˜æ•ˆçš„sql  
> :::

å½“ç„¶è¿™è¾¹ä¸ºäº†æ¼”ç¤ºä½¿ç”¨äº†å†…å®¹é€—å·åˆ†å‰²ï¼Œå…¶å®æœ¬è´¨è€Œè¨€åº”è¯¥æ˜¯å°†ç±»ç›®é€—å·åˆ†å‰²æ›´åŠ åˆé€‚

æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºå¸–å­çš„ç±»ç›®å…³ç³»è¡¨

å¸–å­å’Œç±»ç›®å…³ç³»æ˜¯å¤šå¯¹å¤šé€šè¿‡CategoryPostè¡¨è¿›è¡Œå…³è”

    
    @Data
    @Table("t_post")
    @EntityProxy
    @EasyAlias("t_post")
    @EasyAssertMessage("æœªæ‰¾åˆ°å¯¹åº”çš„å¸–å­ä¿¡æ¯")
    public class Post implements ProxyEntityAvailable<Post, PostProxy> {
        //....å…¶ä»–ä¸šåŠ¡å­—æ®µå’Œå¯¼èˆªå±æ€§
    
    
        /**
         * å¸–å­ç±»ç›®ä¿¡æ¯
         **/
        @Navigate(value = RelationTypeEnum.ManyToMany,
                selfProperty = {PostProxy.Fields.id},
                selfMappingProperty = {CategoryPostProxy.Fields.postId},
                mappingClass = CategoryPost.class, targetProperty = {CategoryProxy.Fields.id},
                targetMappingProperty = {CategoryPostProxy.Fields.categoryId}, subQueryToGroupJoin = true) â‘ 
        private List<Category> categoryList;
    }
    

*   å…¶ä¸­æˆ‘ä»¬çœ‹åˆ°â‘ `subQueryToGroupJoin = true`è¯¥é…ç½®é¡¹è®©åŸæœ¬çš„å¤šå¯¹å¤šå­æŸ¥è¯¢å¯ä»¥ç›´æ¥åœ¨ä½¿ç”¨çš„æ—¶å€™ä½¿ç”¨`groupJoin`æ¥ä»£æ›¿å¯ä»¥è®©ç”Ÿæˆçš„sqlæ€§èƒ½æ›´åŠ é«˜æ•ˆ

è¿”å›å¸–å­å†…å®¹+ç”¨æˆ·+è¯„è®ºå‰ä¸‰ä¸ª+æ‰€å±ç±»ç›®é€—å·åˆ†å‰²

è®¾ç½®è¿”å›dto

    
    /**
     * create time 2025/8/6 22:45
     * {@link com.eq.doc.domain.Post}
     *
     * @author xuejiaming
     */
    @Data
    public class PostPage11Response {
    
        private static final ExtraAutoIncludeConfigure EXTRA_AUTO_INCLUDE_CONFIGURE = PostProxy.TABLE.EXTRA_AUTO_INCLUDE_CONFIGURE()
                .select(t_post -> Select.of(
                        t_post.categoryList().joining(cate->cate.name()).as("categoryNames")
                ));
            
        private String id;
        private String title;
        private String content;
        private String userId;
        private LocalDateTime publishAt;
    
        @NavigateFlat(pathAlias = "user.id")
        private String userName;
    
        @SuppressWarnings("EasyQueryFieldMissMatch")
        private String categoryNames;
    
        /**
         * è¯„è®ºä¿¡æ¯
         **/
        @Navigate(value = RelationTypeEnum.OneToMany, orderByProps = {
                @OrderByProperty(property = "createAt", asc = true)
        }, limit = 3)
        private List<InternalComment> commentList;
    
        /**
         * {@link Comment}
         **/
        @Data
        public static class InternalComment {
    
    
            private static final ExtraAutoIncludeConfigure EXTRA_AUTO_INCLUDE_CONFIGURE = CommentProxy.TABLE.EXTRA_AUTO_INCLUDE_CONFIGURE()
                    .where(t_comment -> {
                        t_comment.parentId().eq("0");
                    });
    
            private String id;
            private String parentId;
            private String content;
            private LocalDateTime createAt;
        }
    
    }
    
    
    
    
    @PostMapping("/postList4")
    public List<PostPage11Response> postList4(@RequestBody PostPage7Request request) {
        return easyEntityQuery.queryable(Post.class)
                .filterConfigure(NotNullOrEmptyValueFilter.DEFAULT_PROPAGATION_SUPPORTS)
                .where(t_post -> {
                    t_post.title().contains(request.getTitle());
                    t_post.user().name().contains(request.getUserName());
                })
                .selectAutoInclude(PostPage11Response.class).toList();
    }
    

æˆ‘ä»¬é€šè¿‡å¯¹ä¸»è¡¨è¿›è¡Œé¢å¤–å­—æ®µçš„æ·»åŠ è®©å…¶ç›´æ¥æ”¯æŒé¢å¤–å­—æ®µè¿”å›

*   `@SuppressWarnings("EasyQueryFieldMissMatch")`è¿™ä¸ªæ³¨è§£ä¸»è¦æ˜¯ç”¨æ¥æŠ‘åˆ¶æ’ä»¶è­¦å‘Šï¼Œæ‚¨å¦‚æœè§‰å¾—è­¦å‘Šæ— æ‰€è°“é‚£ä¹ˆå¯ä»¥ä¸åŠ è¯¥æ³¨è§£å¯¹ç»“æœæ²¡æœ‰å½±å“

    
        {
            "id": "0c6ab3ab-29a4-4320-a08e-195bdac27095",
            "title": "JVMè°ƒä¼˜å®æˆ˜",
            "content": "# è¿™æ˜¯ç”¨æˆ·ç”¨æˆ·Cçš„å¸–å­å†…å®¹\nåŒ…å«ä¸°å¯Œçš„æ–‡æœ¬å†…å®¹...",
            "userId": "2e509ef4-0282-448f-ace0-43501d46ccf4",
            "publishAt": "2025-08-04T23:42:43.525",
            "userName": "2e509ef4-0282-448f-ace0-43501d46ccf4",
            "categoryNames": "å¨±ä¹,æ•™è‚²",
            "commentList": [
                {
                    "id": "2d3643e6-8fb5-4a2b-a0bc-1c92030bfa34",
                    "parentId": "0",
                    "content": "å®Œå…¨åŒæ„ä½ çš„è§‚ç‚¹",
                    "createAt": "2025-08-07T00:42:43.526"
                },
                {
                    "id": "5f7b2333-5578-40cd-940e-28e97d1b0aa1",
                    "parentId": "0",
                    "content": "å®Œå…¨åŒæ„ä½ çš„è§‚ç‚¹",
                    "createAt": "2025-08-07T11:42:43.526"
                },
                {
                    "id": "0b1d0cbd-62a7-4922-b5fe-0ef4780e4c24",
                    "parentId": "0",
                    "content": "å†…å®¹å¾ˆå®ç”¨",
                    "createAt": "2025-08-07T15:42:43.526"
                }
            ]
        },
        {
            "id": "1a0e5854-c748-4c6b-a11d-d5bbb58326a1",
            "title": "ç”µå½±æ¨èåˆé›†",
            "content": "# è¿™æ˜¯ç”¨æˆ·ç”¨æˆ·Bçš„å¸–å­å†…å®¹\nåŒ…å«ä¸°å¯Œçš„æ–‡æœ¬å†…å®¹...",
            "userId": "70ec5f9f-7e9b-4f57-b2a4-9a35a163bd3e",
            "publishAt": "2025-08-03T02:42:43.525",
            "userName": "70ec5f9f-7e9b-4f57-b2a4-9a35a163bd3e",
            "categoryNames": "æ•™è‚²,ç§‘æŠ€",
            "commentList": [
                {
                    "id": "723a588c-0d95-4db7-be6b-1745bfcfc540",
                    "parentId": "0",
                    "content": "å†…å®¹å¾ˆå®ç”¨",
                    "createAt": "2025-08-07T00:42:43.526"
                },
                {
                    "id": "116ab46b-9b61-4644-ac10-73e65f5a01b9",
                    "parentId": "0",
                    "content": "å†…å®¹å¾ˆå®ç”¨",
                    "createAt": "2025-08-07T18:42:43.526"
                },
                {
                    "id": "65cb0f86-7076-46a6-b333-c9c50e9336ae",
                    "parentId": "0",
                    "content": "å†™å¾—çœŸè¯¦ç»†",
                    "createAt": "2025-08-07T18:42:43.526"
                }
            ]
        }
    
    

å®Œå…¨å®Œç¾ç¬¦åˆæˆ‘ä»¬éœ€è¦çš„ç»“æœ

    
    -- ç¬¬1æ¡sqlæ•°æ®
    
        SELECT
            t5.`__joining2__` AS `category_names`,
            t.`id`,
            t.`title`,
            t.`content`,
            t.`user_id`,
            t.`publish_at` 
        FROM
            `t_post` t 
        LEFT JOIN
            (SELECT
                t3.`post_id` AS `post_id`, GROUP_CONCAT(t2.`name` SEPARATOR ',') AS `__joining2__` FROM `t_category` t2 
            INNER JOIN
                `t_category_post` t3 
                    ON t2.`id` = t3.`category_id` 
            GROUP BY
                t3.`post_id`) t5 
                ON t5.`post_id` = t.`id`
    -- ç¬¬2æ¡sqlæ•°æ®
    
        SELECT
            t2.`id` AS `id`,
            t2.`parent_id` AS `parent_id`,
            t2.`content` AS `content`,
            t2.`create_at` AS `create_at`,
            t2.`post_id` AS `__relation__postId` 
        FROM
            (SELECT
                t1.`id` AS `id`,
                t1.`parent_id` AS `parent_id`,
                t1.`content` AS `content`,
                t1.`user_id` AS `user_id`,
                t1.`post_id` AS `post_id`,
                t1.`create_at` AS `create_at` 
            FROM
                (SELECT
                    t.`id`,
                    t.`parent_id`,
                    t.`content`,
                    t.`user_id`,
                    t.`post_id`,
                    t.`create_at`,
                    (ROW_NUMBER() OVER (PARTITION 
                BY
                    t.`post_id` 
                ORDER BY
                    t.`create_at` ASC)) AS `__row__` 
                FROM
                    `t_comment` t 
                WHERE
                    t.`parent_id` = '0' 
                    AND t.`post_id` IN ('015c8538-0eaa-4afb-a1c7-4cca00dd6638', '0c6ab3ab-29a4-4320-a08e-195bdac27095', '1a0e5854-c748-4c6b-a11d-d5bbb58326a1', '31a955ba-04ec-4d07-a6d4-fac6c408ab7d', '36eba6b0-5dd4-41b3-a4af-d9c522a86b3a', '573ca56a-4575-458e-8258-7b76c2cfe959', '5f72b5bf-3ae6-4bd6-9df9-cf0c43abc37c', '63d5b82f-64e6-4985-ad4b-acf71d8368fc', '669ce2a5-abaf-49e8-bb7e-e498f7377b15', '73f5d341-c6df-43a1-afcd-e246c4d1fcc9', '89bf6652-0ae0-451a-8a16-d9b543898f81', '8dbcfcfe-44a7-45c2-9db9-d0302c5a9a94')) t1 
            WHERE
                t1.`__row__` >= 1 
                AND t1.`__row__` <= 3) t2
    -- ç¬¬3æ¡sqlæ•°æ®
    
        SELECT
            `id` 
        FROM
            `t_user` 
        WHERE
            `id` IN ('3b63ddd9-b038-4c24-969e-8b478fe862a5', '2e509ef4-0282-448f-ace0-43501d46ccf4', '70ec5f9f-7e9b-4f57-b2a4-9a35a163bd3e', 'f2bf383e-ee8d-44c5-968d-263191ab058e', 'eda79345-6fbf-4ca6-b9bf-4743a3f991e4')
    

*   ç¬¬ä¸€æ¡sqlæˆ‘ä»¬çœ‹åˆ°ç”¨æ¥æŸ¥è¯¢è¿”å›postä¿¡æ¯å’Œå¯¹åº”çš„categoryNameså­—æ®µä½¿ç”¨`groupJoin`æ¥ä»£æ›¿å¤šå¯¹å¤šè‡ªæŸ¥
*   ç¬¬äºŒæ¡sqlæˆ‘ä»¬çœ‹åˆ°æ¡†æ¶ä½¿ç”¨`patrtition by`è®©ç”¨æˆ·å¯ä»¥è½»æ¾çš„è¿”å›è¯„è®ºä¿¡æ¯å‰næ¡
*   ç¬¬ä¸‰æ¡sqlæˆ‘ä»¬ä½¿ç”¨`NaviagteFlat`äºŒæ¬¡æŸ¥è¯¢æœç»n+1æ¥è¿”å›ç”¨æˆ·ä¿¡æ¯

åˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬çš„å¸–å­ç›¸å…³çš„æŸ¥è¯¢å·²ç»ç»“æŸ ä¸»è¦æˆ‘ä»¬å®ç°äº†æ¡†æ¶å¯¹ä¸€å¯¹å¤š å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šä¸‹å¦‚ä½•å¿«é€ŸæŸ¥è¯¢å¹¶ä¸”æ”¯æŒä¼—å¤šå¼€çª—å‡½æ•°çš„éšå¼ä½¿ç”¨

æœ€åçš„æœ€åæˆ‘éå¸¸æ„Ÿè°¢æ‚¨èƒ½çœ‹åˆ°è¿™è¾¹æˆ‘ç›¸ä¿¡eqç»å¯¹æ˜¯ä½ ä¸äºŒçš„ormé€‰æ‹©
---------------------------------

æ¡†æ¶åœ°å€ [https://github.com/dromara/easy-query](https://github.com/dromara/easy-query)  
æ–‡æ¡£åœ°å€ [https://www.easy-query.com/easy-query-doc/](https://www.easy-query.com/easy-query-doc/)  
è¯¥æ–‡ç« demoåœ°å€ [https://github.com/xuejmnet/eq-doc](https://github.com/xuejmnet/eq-doc)