---
layout: post
title: 'å¦‚ä½•ä½¿ç”¨ GitHub Actions + image-syncer å®ç° Docker Hub åˆ° Azure ACR çš„è‡ªåŠ¨åŒ–é•œåƒåŒæ­¥'
date: "2026-01-26T00:51:41Z"
---
å¦‚ä½•ä½¿ç”¨ GitHub Actions + image-syncer å®ç° Docker Hub åˆ° Azure ACR çš„è‡ªåŠ¨åŒ–é•œåƒåŒæ­¥
=====================================================================

å®ç° Docker Hub åˆ° Azure ACR çš„è‡ªåŠ¨åŒ–é•œåƒåŒæ­¥
==================================

> æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ GitHub Actions å’Œ image-syncer å·¥å…·ï¼Œå®ç° Docker Hub é•œåƒåˆ° Azure Container Registry çš„è‡ªåŠ¨åŒ–åŒæ­¥ï¼Œè§£å†³äº†å›½å†…åŠéƒ¨åˆ† Azure åŒºåŸŸè®¿é—® Docker Hub é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œæå‡äº†é•œåƒçš„å¯ç”¨æ€§å’Œ Azure ç¯å¢ƒçš„éƒ¨ç½²æ•ˆç‡ã€‚

èƒŒæ™¯/å¼•è¨€
-----

HagiCode é¡¹ç›®ä½¿ç”¨ Docker é•œåƒä½œä¸ºæ ¸å¿ƒè¿è¡Œæ—¶ç»„ä»¶ï¼Œä¸»è¦é•œåƒæ‰˜ç®¡åœ¨ Docker Hubã€‚éšç€é¡¹ç›®å‘å±•å’Œ Azure ç¯å¢ƒéƒ¨ç½²éœ€æ±‚çš„å¢åŠ ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä»¥ä¸‹ç—›ç‚¹ï¼š

*   é•œåƒæ‹‰å–é€Ÿåº¦æ…¢ï¼ŒDocker Hub åœ¨å›½å†…åŠéƒ¨åˆ† Azure åŒºåŸŸè®¿é—®å—é™
*   ä¾èµ–å•ä¸€é•œåƒæºå­˜åœ¨å•ç‚¹æ•…éšœé£é™©
*   Azure ç¯å¢ƒä¸‹ä½¿ç”¨ Azure Container Registry èƒ½è·å¾—æ›´å¥½çš„ç½‘ç»œæ€§èƒ½å’Œé›†æˆä½“éªŒ

ä¸ºè§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„é•œåƒåŒæ­¥æœºåˆ¶ï¼Œå°† Docker Hub çš„é•œåƒå®šæœŸåŒæ­¥åˆ° Azure ACRï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿåœ¨ Azure ç¯å¢ƒä¸­è·å¾—æ›´å¿«çš„é•œåƒæ‹‰å–é€Ÿåº¦å’Œæ›´é«˜çš„å¯ç”¨æ€§ã€‚

å…³äº HagiCode
-----------

æˆ‘ä»¬æ­£åœ¨å¼€å‘ HagiCodeâ€”â€”ä¸€æ¬¾ AI é©±åŠ¨çš„ä»£ç æ™ºèƒ½åŠ©æ‰‹ï¼Œè®©å¼€å‘ä½“éªŒå˜å¾—æ›´æ™ºèƒ½ã€æ›´ä¾¿æ·ã€æ›´æœ‰è¶£ã€‚

æ™ºèƒ½â€”â€”AI å…¨ç¨‹è¾…åŠ©ï¼Œä»æƒ³æ³•åˆ°ä»£ç ï¼Œè®©ç¼–ç æ•ˆç‡æå‡æ•°å€ã€‚ä¾¿æ·â€”â€”å¤šçº¿ç¨‹å¹¶å‘æ“ä½œï¼Œå……åˆ†åˆ©ç”¨èµ„æºï¼Œå¼€å‘æµç¨‹é¡ºç•…æ— é˜»ã€‚æœ‰è¶£â€”â€”æ¸¸æˆåŒ–æœºåˆ¶å’Œæˆå°±ç³»ç»Ÿï¼Œè®©ç¼–ç ä¸å†æ¯ç‡¥ï¼Œå……æ»¡æˆå°±æ„Ÿã€‚

é¡¹ç›®æ­£åœ¨å¿«é€Ÿè¿­ä»£ä¸­ï¼Œå¦‚æœä½ å¯¹æŠ€æœ¯å†™ä½œã€çŸ¥è¯†ç®¡ç†æˆ–è€… AI è¾…åŠ©å¼€å‘æ„Ÿå…´è¶£ï¼Œæ¬¢è¿æ¥ GitHub çœ‹çœ‹ã€‚

æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”
------

åœ¨åˆ¶å®šè§£å†³æ–¹æ¡ˆæ—¶ï¼Œæˆ‘ä»¬å¯¹æ¯”äº†å¤šç§æŠ€æœ¯æ–¹æ¡ˆï¼š

### 1\. image-syncerï¼ˆæœ€ç»ˆé€‰æ‹©ï¼‰

*   å¢é‡åŒæ­¥ï¼šä»…åŒæ­¥å˜æ›´çš„é•œåƒå±‚ï¼Œæ˜¾è‘—å‡å°‘ç½‘ç»œä¼ è¾“
*   æ–­ç‚¹ç»­ä¼ ï¼šç½‘ç»œä¸­æ–­åå¯æ¢å¤åŒæ­¥
*   å¹¶å‘æ§åˆ¶ï¼šæ”¯æŒé…ç½®å¹¶å‘çº¿ç¨‹æ•°ï¼Œæå‡å¤§é•œåƒåŒæ­¥æ•ˆç‡
*   å®Œå–„çš„é”™è¯¯å¤„ç†ï¼šå†…ç½®å¤±è´¥é‡è¯•æœºåˆ¶ï¼ˆé»˜è®¤ 3 æ¬¡ï¼‰
*   è½»é‡çº§éƒ¨ç½²ï¼šå•äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ— ä¾èµ–
*   å¤šä»“åº“æ”¯æŒï¼šå…¼å®¹ Docker Hubã€Azure ACRã€Harbor ç­‰

### 2\. Docker CLI

*   ä¸æ”¯æŒå¢é‡åŒæ­¥ï¼šæ¯æ¬¡éƒ½éœ€è¦æ‹‰å–å®Œæ•´çš„é•œåƒå†…å®¹
*   æ•ˆç‡è¾ƒä½ï¼šç½‘ç»œä¼ è¾“é‡å¤§ï¼Œæ—¶é—´é•¿
*   ç®€å•æ˜“ç”¨ï¼šä½¿ç”¨ç†Ÿæ‚‰çš„ docker pull/push å‘½ä»¤

### 3\. Azure CLI

*   å¤æ‚åº¦é«˜ï¼šéœ€è¦é…ç½® Azure CLI è®¤è¯
*   åŠŸèƒ½é™åˆ¶ï¼šaz acr import åŠŸèƒ½ç›¸å¯¹å•ä¸€
*   åŸç”Ÿé›†æˆï¼šä¸ Azure æœåŠ¡é›†æˆè‰¯å¥½

æ¶æ„è®¾è®¡å†³ç­–
------

### å†³ç­– 1ï¼šåŒæ­¥é¢‘ç‡è®¾ç½®ä¸ºæ¯æ—¥ UTC 00:00

*   å¹³è¡¡é•œåƒæ–°é²œåº¦å’Œèµ„æºæ¶ˆè€—
*   é¿å¼€ä¸šåŠ¡é«˜å³°æœŸï¼Œå‡å°‘å¯¹å…¶ä»–æ“ä½œçš„å½±å“
*   Docker Hub é•œåƒé€šå¸¸åœ¨æ¯æ—¥æ„å»ºåæ›´æ–°

### å†³ç­– 2ï¼šåŒæ­¥æ‰€æœ‰é•œåƒæ ‡ç­¾

*   ä¿æŒä¸ Docker Hub çš„å®Œå…¨ä¸€è‡´æ€§
*   ä¸ºç”¨æˆ·æä¾›çµæ´»çš„ç‰ˆæœ¬é€‰æ‹©
*   ç®€åŒ–åŒæ­¥é€»è¾‘ï¼Œé¿å…å¤æ‚çš„æ ‡ç­¾è¿‡æ»¤è§„åˆ™

### å†³ç­– 3ï¼šä½¿ç”¨ GitHub Secrets å­˜å‚¨è®¤è¯ä¿¡æ¯

*   GitHub Actions åŸç”Ÿæ”¯æŒï¼Œå®‰å…¨æ€§é«˜
*   é…ç½®ç®€å•ï¼Œæ˜“äºç®¡ç†å’Œç»´æŠ¤
*   æ”¯æŒä»“åº“çº§åˆ«çš„è®¿é—®æ§åˆ¶

é£é™©è¯„ä¼°ä¸ç¼“è§£
-------

### é£é™© 1ï¼šAzure ACR è®¤è¯ä¿¡æ¯æ³„éœ²

*   ä½¿ç”¨ GitHub Secrets åŠ å¯†å­˜å‚¨
*   å®šæœŸè½®æ¢ ACR å¯†ç 
*   é™åˆ¶ ACR ç”¨æˆ·æƒé™ä¸ºä»…æ¨é€
*   ç›‘æ§ ACR è®¿é—®æ—¥å¿—

### é£é™© 2ï¼šåŒæ­¥å¤±è´¥å¯¼è‡´é•œåƒä¸ä¸€è‡´

*   image-syncer å†…ç½®å¢é‡åŒæ­¥æœºåˆ¶
*   è‡ªåŠ¨å¤±è´¥é‡è¯•ï¼ˆé»˜è®¤ 3 æ¬¡ï¼‰
*   è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œå¤±è´¥é€šçŸ¥
*   æ–­ç‚¹ç»­ä¼ åŠŸèƒ½

### é£é™© 3ï¼šèµ„æºæ¶ˆè€—è¿‡å¤§

*   å¢é‡åŒæ­¥å‡å°‘ç½‘ç»œä¼ è¾“
*   å¯é…ç½®å¹¶å‘çº¿ç¨‹æ•°ï¼ˆå½“å‰è®¾ç½®ä¸º 10ï¼‰
*   ç›‘æ§åŒæ­¥çš„é•œåƒæ•°é‡å’Œå¤§å°
*   åœ¨éé«˜å³°æ—¶æ®µè¿è¡ŒåŒæ­¥

æ ¸å¿ƒè§£å†³æ–¹æ¡ˆ
------

æˆ‘ä»¬é‡‡ç”¨ GitHub Actions + image-syncer çš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆï¼Œå®ç°ä» Docker Hub åˆ° Azure ACR çš„é•œåƒåŒæ­¥ã€‚

å®æ–½æ­¥éª¤
----

### 1\. å‡†å¤‡é˜¶æ®µ

*   åœ¨ Azure Portal ä¸­åˆ›å»ºæˆ–ç¡®è®¤ Azure Container Registry
*   åˆ›å»º ACR è®¿é—®å¯†é’¥ï¼ˆç”¨æˆ·åå’Œå¯†ç ï¼‰
*   ç¡®è®¤ Docker Hub é•œåƒä»“åº“è®¿é—®æƒé™

### 2\. é…ç½® GitHub Secrets

åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­æ·»åŠ ä»¥ä¸‹ Secretsï¼š

*   AZURE\_ACR\_USERNAME: Azure ACR ç”¨æˆ·å
*   AZURE\_ACR\_PASSWORD: Azure ACR å¯†ç 

### 3\. åˆ›å»º GitHub Actions å·¥ä½œæµ

åœ¨ .github/workflows/sync-docker-acr.yml ä¸­é…ç½®å·¥ä½œæµï¼š

*   å®šæ—¶è§¦å‘ï¼šæ¯å¤© UTC 00:00
*   æ‰‹åŠ¨è§¦å‘ï¼šæ”¯æŒ workflow\_dispatch
*   é¢å¤–è§¦å‘ï¼špublish åˆ†æ”¯æ¨é€æ—¶è§¦å‘ï¼ˆç”¨äºå¿«é€ŸåŒæ­¥ï¼‰

### 4\. å·¥ä½œæµæ‰§è¡Œæµç¨‹

sequenceDiagram participant GH as GitHub Actions participant IS as image-syncer participant DH as Docker Hub participant ACR as Azure ACR Note over GH: è§¦å‘å·¥ä½œæµ GH->>IS: ä¸‹è½½å¹¶æ‰§è¡Œ image-syncer IS->>DH: è·å–é•œåƒ manifest å’Œæ ‡ç­¾åˆ—è¡¨ DH-->>IS: è¿”å›é•œåƒå…ƒæ•°æ® IS->>ACR: è·å–å·²å­˜åœ¨çš„é•œåƒä¿¡æ¯ ACR-->>IS: è¿”å›ç›®æ ‡é•œåƒä¿¡æ¯ IS->>IS: å¯¹æ¯”å·®å¼‚ï¼Œè¯†åˆ«å˜æ›´çš„é•œåƒå±‚ Note over IS: å¢é‡åŒæ­¥ï¼šä»…ä¼ è¾“å˜æ›´çš„é•œåƒå±‚ IS->>DH: æ‹‰å–å˜æ›´çš„é•œåƒå±‚ DH-->>IS: è¿”å›é•œåƒå±‚å†…å®¹ IS->>ACR: æ¨é€å˜æ›´çš„é•œåƒå±‚åˆ° ACR ACR-->>IS: è¿”å›æ¨é€ç»“æœ IS-->>GH: è¿”å›åŒæ­¥ç»Ÿè®¡ä¿¡æ¯ GH->>GH: è®°å½•åŒæ­¥æ—¥å¿—å¹¶ä¸Šä¼  artifact

GitHub Actions å·¥ä½œæµå®ç°
--------------------

ä»¥ä¸‹æ˜¯å®é™…è¿è¡Œçš„å·¥ä½œæµé…ç½®ï¼ˆ.github/workflows/sync-docker-acr.ymlï¼‰ï¼š

    name: Sync Docker Image to Azure ACR
    
    on:
      schedule:
        - cron: "0 0 * * *" # æ¯å¤© UTC 00:00
      workflow_dispatch: # æ‰‹åŠ¨è§¦å‘
      push:
        branches: [publish]
    
    permissions:
      contents: read
    
    jobs:
      sync:
        runs-on: ubuntu-latest
    
        steps:
          - name: Checkout code
            uses: actions/checkout@v4
    
          - name: Download image-syncer
            run: |
              # ä¸‹è½½ image-syncer äºŒè¿›åˆ¶æ–‡ä»¶
              wget https://github.com/AliyunContainerService/image-syncer/releases/download/v1.5.5/image-syncer-v1.5.5-linux-amd64.tar.gz
              tar -zxvf image-syncer-v1.5.5-linux-amd64.tar.gz
              chmod +x image-syncer
    
          - name: Create auth config
            run: |
              # ç”Ÿæˆè®¤è¯é…ç½®æ–‡ä»¶ (YAML æ ¼å¼)
              cat > auth.yaml <<EOF
              hagicode.azurecr.io:
                username: "${{ secrets.AZURE_ACR_USERNAME }}"
                password: "${{ secrets.AZURE_ACR_PASSWORD }}"
              EOF
    
          - name: Create images config
            run: |
              # ç”Ÿæˆé•œåƒåŒæ­¥é…ç½®æ–‡ä»¶ (YAML æ ¼å¼)
              cat > images.yaml <<EOF
              docker.io/newbe36524/hagicode: hagicode.azurecr.io/hagicode
              EOF
    
          - name: Run image-syncer
            run: |
              # æ‰§è¡ŒåŒæ­¥ (ä½¿ç”¨æ–°ç‰ˆ --auth å’Œ --images å‚æ•°)
              ./image-syncer --auth=./auth.yaml --images=./images.yaml --proc=10 --retries=3
    
          - name: Upload logs
            if: always()
            uses: actions/upload-artifact@v4
            with:
              name: sync-logs
              path: image-syncer-*.log
              retention-days: 7
    

é…ç½®è¯´æ˜
----

### 1\. è§¦å‘æ¡ä»¶

*   å®šæ—¶è§¦å‘ï¼šcron: "0 0 \* \* \*" - æ¯å¤© UTC 00:00 æ‰§è¡Œ
*   æ‰‹åŠ¨è§¦å‘ï¼šworkflow\_dispatch - å…è®¸ç”¨æˆ·åœ¨ GitHub UI æ‰‹åŠ¨è¿è¡Œ
*   æ¨é€è§¦å‘ï¼špush: branches: \[publish\] - å‘å¸ƒåˆ†æ”¯æ¨é€æ—¶è§¦å‘ï¼ˆç”¨äºå¿«é€ŸåŒæ­¥ï¼‰

### 2\. è®¤è¯é…ç½® (auth.yaml)

    hagicode.azurecr.io:
      username: "${{ secrets.AZURE_ACR_USERNAME }}"
      password: "${{ secrets.AZURE_ACR_PASSWORD }}"
    

### 3\. é•œåƒåŒæ­¥é…ç½®

    docker.io/newbe36524/hagicode: hagicode.azurecr.io/hagicode
    

æ­¤é…ç½®è¡¨ç¤ºå°† docker.io/newbe36524/hagicode çš„æ‰€æœ‰æ ‡ç­¾åŒæ­¥åˆ° hagicode.azurecr.io/hagicode

### 4\. image-syncer å‚æ•°

*   \--auth=./auth.yaml: è®¤è¯é…ç½®æ–‡ä»¶è·¯å¾„
*   \--images=./images.yaml: é•œåƒåŒæ­¥é…ç½®æ–‡ä»¶è·¯å¾„
*   \--proc=10: å¹¶å‘çº¿ç¨‹æ•°ä¸º 10
*   \--retries=3: å¤±è´¥é‡è¯• 3 æ¬¡

GitHub Secrets é…ç½®æ¸…å•
-------------------

åœ¨ GitHub ä»“åº“çš„ Settings â†’ Secrets and variables â†’ Actions ä¸­é…ç½®ï¼š

Secret åç§°

æè¿°

ç¤ºä¾‹å€¼

è·å–æ–¹å¼

AZURE\_ACR\_USERNAME

Azure ACR ç”¨æˆ·å

hagicode

Azure Portal â†’ ACR â†’ Access keys

AZURE\_ACR\_PASSWORD

Azure ACR å¯†ç 

xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

Azure Portal â†’ ACR â†’ Access keys â†’ Password

ä½¿ç”¨è¯´æ˜
----

### 1\. æ‰‹åŠ¨è§¦å‘åŒæ­¥

1.  è®¿é—® GitHub ä»“åº“çš„ Actions æ ‡ç­¾é¡µ
2.  é€‰æ‹© Sync Docker Image to Azure ACR å·¥ä½œæµ
3.  ç‚¹å‡» Run workflow æŒ‰é’®
4.  é€‰æ‹©åˆ†æ”¯å¹¶ç‚¹å‡» Run workflow ç¡®è®¤

### 2\. æŸ¥çœ‹åŒæ­¥æ—¥å¿—

1.  åœ¨ Actions é¡µé¢ç‚¹å‡»å…·ä½“çš„å·¥ä½œæµè¿è¡Œè®°å½•
2.  æŸ¥çœ‹å„ä¸ªæ­¥éª¤çš„æ‰§è¡Œæ—¥å¿—
3.  åœ¨é¡µé¢åº•éƒ¨çš„ Artifacts åŒºåŸŸä¸‹è½½ sync-logs æ–‡ä»¶

### 3\. éªŒè¯åŒæ­¥ç»“æœ

    # ç™»å½•åˆ° Azure ACR
    az acr login --name hagicode
    
    # åˆ—å‡ºé•œåƒåŠå…¶æ ‡ç­¾
    az acr repository show-tags --name hagicode --repository hagicode --output table
    

æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ
---------

### 1\. å®‰å…¨å»ºè®®

*   å®šæœŸè½®æ¢ Azure ACR å¯†ç ï¼ˆå»ºè®®æ¯ 90 å¤©ï¼‰
*   ä½¿ç”¨ä¸“ç”¨çš„ ACR æœåŠ¡è´¦æˆ·ï¼Œé™åˆ¶æƒé™ä¸ºä»…æ¨é€
*   ç›‘æ§ ACR çš„è®¿é—®æ—¥å¿—ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸è®¿é—®
*   ä¸è¦åœ¨æ—¥å¿—ä¸­è¾“å‡ºè®¤è¯ä¿¡æ¯
*   ä¸è¦å°†è®¤è¯ä¿¡æ¯æäº¤åˆ°ä»£ç ä»“åº“

### 2\. æ€§èƒ½ä¼˜åŒ–

*   è°ƒæ•´ --proc å‚æ•°ï¼šæ ¹æ®ç½‘ç»œå¸¦å®½è°ƒæ•´å¹¶å‘æ•°ï¼ˆå»ºè®® 5-20ï¼‰
*   ç›‘æ§åŒæ­¥æ—¶é—´ï¼šå¦‚æœåŒæ­¥æ—¶é—´è¿‡é•¿ï¼Œè€ƒè™‘å‡å°‘å¹¶å‘æ•°
*   å®šæœŸæ¸…ç†æ—¥å¿—ï¼šè®¾ç½®åˆç†çš„ retention-daysï¼ˆå½“å‰ä¸º 7 å¤©ï¼‰

### 3\. æ•…éšœæ’æŸ¥

#### é—®é¢˜ 1ï¼šè®¤è¯å¤±è´¥

    Error: failed to authenticate to hagicode.azurecr.io
    

è§£å†³æ–¹æ¡ˆï¼š

1.  æ£€æŸ¥ GitHub Secrets æ˜¯å¦æ­£ç¡®é…ç½®
2.  éªŒè¯ Azure ACR å¯†ç æ˜¯å¦è¿‡æœŸ
3.  ç¡®è®¤ ACR æœåŠ¡è´¦æˆ·æƒé™æ˜¯å¦æ­£ç¡®

#### é—®é¢˜ 2ï¼šç½‘ç»œè¶…æ—¶

    Error: timeout waiting for response
    

è§£å†³æ–¹æ¡ˆï¼š

1.  æ£€æŸ¥ç½‘ç»œè¿æ¥
2.  å‡å°‘å¹¶å‘çº¿ç¨‹æ•°ï¼ˆ--proc å‚æ•°ï¼‰
3.  ç­‰å¾…ç½‘ç»œæ¢å¤åé‡æ–°è§¦å‘å·¥ä½œæµ

#### é—®é¢˜ 3ï¼šé•œåƒåŒæ­¥ä¸å®Œæ•´

    Warning: some tags failed to sync
    

è§£å†³æ–¹æ¡ˆï¼š

1.  æ£€æŸ¥åŒæ­¥æ—¥å¿—ï¼Œè¯†åˆ«å¤±è´¥çš„æ ‡ç­¾
2.  æ‰‹åŠ¨è§¦å‘å·¥ä½œæµé‡æ–°åŒæ­¥
3.  éªŒè¯ Docker Hub æºé•œåƒæ˜¯å¦æ­£å¸¸

### 4\. ç›‘æ§å’Œå‘Šè­¦

*   å®šæœŸæ£€æŸ¥ Actions é¡µé¢ï¼Œç¡®è®¤å·¥ä½œæµè¿è¡ŒçŠ¶æ€
*   è®¾ç½® GitHub é€šçŸ¥ï¼ŒåŠæ—¶è·å–å·¥ä½œæµå¤±è´¥é€šçŸ¥
*   ç›‘æ§ Azure ACR çš„å­˜å‚¨ä½¿ç”¨æƒ…å†µ
*   å®šæœŸéªŒè¯é•œåƒæ ‡ç­¾ä¸€è‡´æ€§

å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
---------

### Q1: å¦‚ä½•åŒæ­¥ç‰¹å®šæ ‡ç­¾è€Œä¸æ˜¯æ‰€æœ‰æ ‡ç­¾ï¼Ÿ

ä¿®æ”¹ images.yaml é…ç½®æ–‡ä»¶ï¼š

    # ä»…åŒæ­¥ latest å’Œ v1.0 æ ‡ç­¾
    docker.io/newbe36524/hagicode:latest: hagicode.azurecr.io/hagicode:latest
    docker.io/newbe36524/hagicode:v1.0: hagicode.azurecr.io/hagicode:v1.0
    

### Q2: å¦‚ä½•åŒæ­¥å¤šä¸ªé•œåƒä»“åº“ï¼Ÿ

åœ¨ images.yaml ä¸­æ·»åŠ å¤šè¡Œé…ç½®ï¼š

    docker.io/newbe36524/hagicode: hagicode.azurecr.io/hagicode
    docker.io/newbe36524/another-image: hagicode.azurecr.io/another-image
    

### Q3: åŒæ­¥å¤±è´¥åå¦‚ä½•é‡è¯•ï¼Ÿ

*   è‡ªåŠ¨é‡è¯•ï¼šimage-syncer å†…ç½®é‡è¯•æœºåˆ¶ï¼ˆé»˜è®¤ 3 æ¬¡ï¼‰
*   æ‰‹åŠ¨é‡è¯•ï¼šåœ¨ GitHub Actions é¡µé¢ç‚¹å‡» Re-run all jobs

### Q4: å¦‚ä½•æŸ¥çœ‹åŒæ­¥çš„è¯¦ç»†è¿›åº¦ï¼Ÿ

*   åœ¨ Actions é¡µé¢æŸ¥çœ‹å®æ—¶æ—¥å¿—
*   ä¸‹è½½ sync-logs artifact æŸ¥çœ‹å®Œæ•´æ—¥å¿—æ–‡ä»¶
*   æ—¥å¿—æ–‡ä»¶åŒ…å«æ¯ä¸ªæ ‡ç­¾çš„åŒæ­¥çŠ¶æ€å’Œä¼ è¾“é€Ÿåº¦

### Q5: åŒæ­¥éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ

*   é¦–æ¬¡å…¨é‡åŒæ­¥ï¼šæ ¹æ®é•œåƒå¤§å°ï¼Œé€šå¸¸éœ€è¦ 10-30 åˆ†é’Ÿ
*   å¢é‡åŒæ­¥ï¼šå¦‚æœé•œåƒå˜æ›´å°ï¼Œé€šå¸¸ 2-5 åˆ†é’Ÿ
*   æ—¶é—´å–å†³äºç½‘ç»œå¸¦å®½ã€é•œåƒå¤§å°å’Œå¹¶å‘è®¾ç½®

æ‰©å±•åŠŸèƒ½å»ºè®®
------

### 1\. æ·»åŠ åŒæ­¥é€šçŸ¥

åœ¨å·¥ä½œæµä¸­æ·»åŠ é€šçŸ¥æ­¥éª¤ï¼š

    - name: Notify on success
      if: success()
      run: |
        echo "Docker images synced successfully to Azure ACR"
    

### 2\. å®ç°é•œåƒæ ‡ç­¾è¿‡æ»¤

åœ¨å·¥ä½œæµä¸­æ·»åŠ æ ‡ç­¾è¿‡æ»¤é€»è¾‘ï¼š

    - name: Filter tags
      run: |
        # ä»…åŒæ­¥ä»¥ v å¼€å¤´çš„æ ‡ç­¾
        echo "docker.io/newbe36524/hagicode:v* : hagicode.azurecr.io/hagicode:v*" > images.yaml
    

### 3\. æ·»åŠ åŒæ­¥ç»Ÿè®¡æŠ¥å‘Š

    - name: Generate report
      if: always()
      run: |
        echo "## Sync Report" >> $GITHUB_STEP_SUMMARY
        echo "- Total tags: $(grep -c 'synced' image-syncer-*.log)" >> $GITHUB_STEP_SUMMARY
        echo "- Sync time: ${{ steps.sync.outputs.duration }}" >> $GITHUB_STEP_SUMMARY
    

æ€»ç»“
--

é€šè¿‡æœ¬æ–‡ä»‹ç»çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†ä» Docker Hub åˆ° Azure ACR çš„è‡ªåŠ¨åŒ–é•œåƒåŒæ­¥ã€‚è¿™ä¸ªæ–¹æ¡ˆåˆ©ç”¨ GitHub Actions çš„å®šæ—¶è§¦å‘å’Œæ‰‹åŠ¨è§¦å‘åŠŸèƒ½ï¼Œç»“åˆ image-syncer çš„å¢é‡åŒæ­¥å’Œé”™è¯¯å¤„ç†æœºåˆ¶ï¼Œç¡®ä¿äº†é•œåƒçš„åŠæ—¶åŒæ­¥å’Œä¸€è‡´æ€§ã€‚

æˆ‘ä»¬è¿˜è®¨è®ºäº†å®‰å…¨æœ€ä½³å®è·µã€æ€§èƒ½ä¼˜åŒ–ã€æ•…éšœæ’æŸ¥ç­‰æ–¹é¢çš„å†…å®¹ï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç®¡ç†å’Œç»´æŠ¤è¿™ä¸ªåŒæ­¥æœºåˆ¶ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿä¸ºéœ€è¦åœ¨ Azure ç¯å¢ƒä¸­éƒ¨ç½² Docker é•œåƒçš„å¼€å‘è€…æä¾›æœ‰ä»·å€¼çš„å‚è€ƒã€‚

å‚è€ƒèµ„æ–™
----

*   [HagiCode é¡¹ç›® GitHub ä»“åº“](https://github.com/HagiCode-org/site)
*   [image-syncer å®˜æ–¹æ–‡æ¡£](https://github.com/AliyunContainerService/image-syncer)
*   [Azure Container Registry å®˜æ–¹æ–‡æ¡£](https://learn.microsoft.com/zh-cn/azure/container-registry/)
*   [GitHub Actions å®˜æ–¹æ–‡æ¡£](https://docs.github.com/zh-cn/actions)

* * *

äº’åŠ¨å¼•å¯¼
----

æ„Ÿè°¢æ‚¨çš„é˜…è¯»,å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡æœ‰ç”¨,å¿«ç‚¹å‡»ä¸‹æ–¹ç‚¹èµæŒ‰é’®ğŸ‘,è®©æ›´å¤šçš„äººçœ‹åˆ°æœ¬æ–‡ã€‚

AI è¾…åŠ©å£°æ˜
-------

æœ¬å†…å®¹é‡‡ç”¨äººå·¥æ™ºèƒ½è¾…åŠ©åä½œ,ç»æœ¬äººå®¡æ ¸,ç¬¦åˆæœ¬äººè§‚ç‚¹ä¸ç«‹åœºã€‚

å…ƒä¿¡æ¯
---

*   **æœ¬æ–‡ä½œè€…:** [newbe36524](https://www.newbe.pro)
*   **æœ¬æ–‡é“¾æ¥:** [https://hagicode-org.github.io/site/blog/2026/01/25/how-to-sync-docker-hub-to-azure-acr-with-github](https://hagicode-org.github.io/site/blog/2026/01/25/how-to-sync-docker-hub-to-azure-acr-with-github)
*   **ç‰ˆæƒå£°æ˜:** æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–,å‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„!