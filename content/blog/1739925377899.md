---
layout: post
title: 'Linux环境Docker使用代理推拉镜像'
date: "2025-02-19T00:36:17Z"
---
Linux环境Docker使用代理推拉镜像
=====================

闲扯几句
----

不知不觉已经2月中了，1个半月忙得没写博客，这篇其实很早就想写了（可追溯到Docker刚刚无法拉镜像的时候），由于工作和生活上的事比较多又在备考软考架构，拖了好久……

简单记录下怎么做的，以防同事和朋友问我怎么拉镜像仓库的，直接祭出本文😆

> 适用于将Docker以Systemd服务安装的Linux环境。其他环境仅供参考。

怎么做
---

**第1步 自备代理工具**，以我本地挂的梯子 192.168.56.1:7899 举例，请自行变通。

**第2步 修改docker.service**

    vim /lib/systemd/system/docker.service
    

将代理环境变量写入该服务文件，写的位置在`[Service]`块下

    # proxy
    Environment="HTTP_PROXY=http://192.168.56.1:7899"
    Environment="HTTPS_PROXY=http://192.168.56.1:7899"
    Environment="NO_PROXY=localhost,127.0.0.1,10.*,172.*"
    

其中`NO_PROXY`可追加需要免代理的仓库地址。以下是截图：

![](https://img2024.cnblogs.com/blog/1149398/202502/1149398-20250218170318087-313147210.png)

**第3步 重加载docker Unit文件并重启Docker**

    systemctl daemon-reload
    systemctl restart docker
    

**第4步 验证**

    docker login
    docker pull hellxz/alpine-tomcat:openjdk8-tomcat-8.5.78
    

![](https://img2024.cnblogs.com/blog/1149398/202502/1149398-20250218171126869-938328770.png)

原理
--

Systemd的每个Unit（服务）都是在启动时加载的，不会加载到当前会话中的临时设置的环境变量，Unit文件主要存在于以下三个目录中，加载的优先级就是我这边的排序：

*   /lib/systemd/system
*   /run/systemd/system
*   /etc/systemd/system

按文中修改docker.service这个Unit文件时也一样，用的是最高优先级的。systemd重新加载Unit文件后会读取到配置在Unit文件中的环境变量，这样就会生效了。

至于代理怎么弄，这个就不多说了，得需要点魔法。

再扯几句
----

近期可能会写一点软考相关内容，有兴趣的可以关注下。

本文同步发布在博客园 [https://www.cnblogs.com/hellxz](https://www.cnblogs.com/hellxz) 与 CSDN [https://blog.csdn.net/u012586326，原创不易，请勿转载！](https://blog.csdn.net/u012586326%EF%BC%8C%E5%8E%9F%E5%88%9B%E4%B8%8D%E6%98%93%EF%BC%8C%E8%AF%B7%E5%8B%BF%E8%BD%AC%E8%BD%BD%EF%BC%81)