---
layout: post
title: 'PVEæŠ˜è…¾ç¬”è®° (3) åœ¨åŸQNAPä½¿ç”¨çš„ç¡¬ç›˜ä¸Šåˆ›å»ºZFS'
date: "2025-06-20T00:42:32Z"
---
PVEæŠ˜è…¾ç¬”è®° (3) åœ¨åŸQNAPä½¿ç”¨çš„ç¡¬ç›˜ä¸Šåˆ›å»ºZFS
=============================

QNAPç¡¬ç›˜æ¢ZFSï¼Ÿè‡ªæ„ˆåŠŸèƒ½æŒºå¥½ç”¨ï¼Œä½†æŠ˜è…¾Linuxå…¼å®¹æ€§å¤Ÿé—¹å¿ƒã€‚LVMæ®‹ç•™å¯¼è‡´æ“¦ç›˜å¤±è´¥ï¼Ÿå†…æ ¸å¯¹è±¡å¾—ä¸€ä¸ªä¸ªå¹²æ‰ã€‚Poolåˆ›å»ºæ—¶å‚æ•°é€‰é”™ï¼Ÿé‚£å¯çœŸæ˜¯åæ‚£æ— ç©·ã€‚

å‰è¨€
--

åœ¨ç»è¿‡ä¸€ç•ªç ”ç©¶åï¼Œæˆ‘å†³å®šä½¿ç”¨ZFSä½œä¸ºä¿©æœºæ¢°ç¡¬ç›˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ¬æ¥ä¹Ÿå¯ä»¥å’ŒQNAPä¸€æ ·ç›´æ¥ext4çš„ï¼Œä½†ZFSæ¯”è¾ƒå®‰å…¨ï¼Œæœ‰è‡ªæ„ˆåŠŸèƒ½ï¼Œå¯ä»¥å¤„ç†æ¯”ç‰¹ä½ç¿»è½¬çš„é—®é¢˜ï¼Œæ€»ä¹‹å°±æ˜¯å¥½ç”¨ã€‚

å¦‚æœè¿½æ±‚çµæ´»æ€§å¯ä»¥ä½¿ç”¨Btrfsï¼Œè¿™æ–¹é¢æœ‰ä¸ªå¤§ä½¬è®²å¾—ä¸é”™ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹: [æ•°æ®ç¡¬ç›˜åˆ†åŒºï¼šBtrfsæ–‡ä»¶ç³»ç»Ÿ - ä»é›¶å¼€å§‹çš„NAS/å°å‹æœåŠ¡å™¨æ­å»º](https://zhuanlan.zhihu.com/p/699986909)

> ä¸€å¥è¯ç†è§£ï¼šZFS ä¸åªæ˜¯æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ˜¯ä¸€å¥—æ™ºèƒ½çš„å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚

ZFSï¼ˆZettabyte File Systemï¼‰æ˜¯ç”± Sun Microsystems å¼€å‘çš„ä¸€ç§å¼€æºçš„å…ˆè¿›æ–‡ä»¶ç³»ç»Ÿå’Œé€»è¾‘å·ç®¡ç†å™¨ã€‚

ä¸ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ ext4ã€NTFSï¼‰ä¸åŒï¼ŒZFS **èåˆäº†æ–‡ä»¶ç³»ç»Ÿ + RAID + å·ç®¡ç†**äºä¸€ä½“ã€‚

å…³é”®è¯ï¼š**è‡ªä¿®å¤ã€å¿«ç…§ã€é«˜å¯é æ€§ã€å¤§å®¹é‡æ”¯æŒ**ã€‚

æŸ¥çœ‹ç¡¬ç›˜
----

ä¸»è¦ä½¿ç”¨ `fdisk -l` å’Œ `lsblk` è¿™ä¸¤ä¸ªå‘½ä»¤ã€‚

*   `fdisk -l`ï¼šæŸ¥çœ‹ç£ç›˜çš„ **åˆ†åŒºä¿¡æ¯ï¼ˆååº•å±‚ã€åŸå§‹ï¼‰**
*   `lsblk`ï¼šæŸ¥çœ‹ç£ç›˜çš„ **å—è®¾å¤‡æ ‘çŠ¶ç»“æ„ï¼ˆæ›´ç›´è§‚ã€é¢å‘äººç±»ï¼‰**

### å‘½ä»¤è¯´æ˜ï¼š

#### ğŸ§± `fdisk -l`

*   å…¨ç§°æ˜¯ **"list partition table"**
    
*   æ˜¾ç¤ºæ‰€æœ‰ç£ç›˜å’Œå®ƒä»¬çš„ **åˆ†åŒºä¿¡æ¯ã€å®¹é‡ã€æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆMBR/GPTï¼‰ç­‰**
    
*   éœ€è¦ root æƒé™ï¼ˆæ‰€ä»¥å¸¸ç”¨ `sudo fdisk -l`ï¼‰
    
*   è¾“å‡ºç¤ºä¾‹ï¼š
    
        pgsqlå¤åˆ¶ç¼–è¾‘Disk /dev/sda: 512 GB
        Device     Boot Start       End   Sectors   Size Type
        /dev/sda1  *     2048    999423    997376   487M EFI System
        /dev/sda2        999424 976773119 975773696 465G Linux filesystem
        
    
*   ğŸ“Œ æ›´åâ€œåº•å±‚â€ï¼Œæœ‰åŠ©äºäº†è§£ç£ç›˜åˆ†åŒºè¡¨ç»“æ„ã€‚
    

#### ğŸŒ³ `lsblk`

*   å…¨ç§°æ˜¯ **"list block devices"**
    
*   æ˜¾ç¤ºæ‰€æœ‰çš„å—è®¾å¤‡ï¼ˆç£ç›˜ã€åˆ†åŒºã€LVMã€RAID ç­‰ï¼‰ä»¥åŠå®ƒä»¬çš„æŒ‚è½½æƒ…å†µ
    
*   ç±»ä¼¼æ ‘çŠ¶ç»“æ„ï¼Œæ›´åŠ  **ç›´è§‚**
    
*   ä¸æ˜¾ç¤ºæŒ‚è½½ç‚¹ä¸ºç©ºçš„ loop è®¾å¤‡ï¼ˆé™¤éåŠ å‚æ•°ï¼‰
    
*   é»˜è®¤ä¸éœ€è¦ root æƒé™
    
*   è¾“å‡ºç¤ºä¾‹ï¼š
    
        pgsqlå¤åˆ¶ç¼–è¾‘NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
        sda      8:0    0   512G  0 disk
        â”œâ”€sda1   8:1    0   487M  0 part /boot/efi
        â””â”€sda2   8:2    0 511.5G  0 part /
        
    
*   ğŸ“Œ æ›´é€‚åˆç”¨æ¥ **å¿«é€Ÿè¯†åˆ«å“ªä¸ªè®¾å¤‡æŒ‚è½½åˆ°å“ªä¸ªç›®å½•**ï¼Œæ¯”å¦‚ä½ æ’äº†æ–° SSDï¼Œå®ƒå°±ä¼šä»¥ `/dev/sdX` æˆ– `/dev/nvmeXn1` çš„åå­—å‡ºç°ã€‚
    

å¤‡ä»½æ•°æ®
----

å‚è€ƒæˆ‘ä¹‹å‰çš„å†…å®¹

æœ‰å‡ ç§æ–¹æ³•ï¼š

*   rsync: `rsync -a --info=progress2 /mnt/disk1/your-folder /mnt/disk2/`
*   Midnight Commander (mc) (å¯è§†åŒ–)

æ¨èç”¨ mcï¼Œæ³¨æ„å¦‚æœæ˜¯ SSH åˆ°æœåŠ¡å™¨æ“ä½œçš„è¯ï¼Œä¸€å®šå¾—ç”¨ screen ä¹‹ç±»çš„å·¥å…·å¼€å¯åå°ä¼šè¯ï¼Œé˜²æ­¢å¤åˆ¶åˆ°ä¸€åŠè¿æ¥æ–­äº†ã€‚

å¤‡ä»½å®Œæˆåè¯·è‡ªè¡Œæ ¡éªŒæ•°æ®ã€‚æ–¹æ³•ä¹Ÿå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« ã€‚

æ ¼å¼åŒ–ç¡¬ç›˜
-----

æœ€ç®€å•çš„æ–¹æ³•æ˜¯åªæœ‰ç”¨ PVE é‡Œçš„ Wipe Disk åŠŸèƒ½ã€‚

### æŠ¥é”™

ä¸è¿‡æˆ‘åœ¨ä½¿ç”¨çš„æ—¶å€™é‡åˆ°æŠ¥é”™ï¼š `disk/partition '/dev/sda1' has a holder`

åˆ†æä¸‹åŸå› ï¼Œ`holder` ä»£è¡¨ä»æœ‰å†…æ ¸å¯¹è±¡åœ¨ä½¿ç”¨è¿™å—åˆ†åŒº

å¸¸è§æŒæœ‰è€…ï¼ˆholdersï¼‰

è®¾å¤‡ç±»å‹

æ£€æŸ¥å‘½ä»¤

å…¸å‹å‡ºç°åœ¨ QNAP æ—§ç›˜é‡Œçš„åŸå› 

**LVM PV â†’ dm-?**

`pvs`, `lsblk -o NAME,TYPE`

QTS é»˜è®¤æŠŠæ•´ç›˜å·è¿› `vg1/lv1`

**mdraid â†’ md127**

`mdadm --detail --scan`

QTS å¯èƒ½åˆ›å»ºè¿‡è½¯ RAID ç¼“å­˜åŒº

**dm-crypt / luks**

`lsblk -f`

å¦‚æœå¼€äº†åŠ å¯†å…±äº«

**æŒ‚è½½ç‚¹**

\`mount

grep sda1\`

åªè¦è¿˜æœ‰ **holders**ï¼ŒProxmox çš„ _wipe\_disk_ è„šæœ¬ï¼ˆæœ¬è´¨æ˜¯ `sgdisk --zap-all` + `wipefs -a`ï¼‰å°±ä¼šè¢«å†…æ ¸æ‹’ç»å†™å…¥ï¼Œä»è€ŒæŠ›å‡º 500 é”™è¯¯ã€‚

### æ’æŸ¥æ–¹å¼

    lsblk -f
    ls /sys/block/sda/sda1/holders
    

è¾“å‡ºå¦‚ dm-0 dm-1 â†’ è¯´æ˜è¢« LVM/MD ç­‰å ç€

### è§£å†³æ–¹æ³•

**âš ï¸ æ‰€æœ‰å‘½ä»¤è¯·ç¡®è®¤ç£ç›˜åï¼ˆè¿™é‡Œç”¨ /dev/sda ä¸¾ä¾‹ï¼‰ï¼Œè¯¯æ“ä½œä¼šç«‹åˆ»æ¯ç­æ•°æ®ï¼**

æ­¥éª¤

å‘½ä»¤

è¯´æ˜

1ï¸âƒ£ å¸è½½æŒ‚è½½ç‚¹

`umount -f /dev/sda? 2>/dev/null`

ä¿è¯åˆ†åŒºä¸åœ¨ç”¨

2ï¸âƒ£ åœç”¨ LVM

`vgchange -an vg1` `lvremove -f /dev/vg1/lv1` `pvremove /dev/sda1`

vg/lv åå­—ä»¥ `pvs`, `vgs` æŸ¥è¯¢ä¸ºå‡†

3ï¸âƒ£ åœæ‰ mdraid

`mdadm --stop /dev/md127` `mdadm --zero-superblock /dev/sda1`

è‹¥ `lsblk` æ˜¾ç¤ºæœ‰ `md*`

4ï¸âƒ£ æœ€ç»ˆæŠ¹ç­¾å

`sgdisk --zap-all /dev/sda` `wipefs -a /dev/sda`

ç­‰åŒ PVE â€œWipe Diskâ€

åšå®Œå† `ls /sys/block/sda/sda1/holders` â€”â€” ç›®å½•åº”ä¸ºç©º

è¿™æ—¶å›åˆ° Web UI ç‚¹ **Wipe Disk** å°±ä¸ä¼šæŠ¥é”™äº†ã€‚

åˆ›å»º ZFS
------

åœ¨ Web UI é‡Œï¼Œé€‰æ‹©èŠ‚ç‚¹ï¼ˆæˆ‘çš„æ˜¯å« PVEï¼‰ - ç£ç›˜ - ZFS - åˆ›å»º ZFS

**å¤ªé•¿ä¸çœ‹ï¼šé€‰æ‹©ç£ç›˜ï¼Œå¡«å†™åç§°ï¼ŒRAID çº§åˆ«é€‰å•ç£ç›˜ï¼Œå¦‚æœæƒ³å†—ä½™çš„è¯å¯ä»¥é€‰ Mirrorï¼Œå‹ç¼©é€‰ lz4ï¼Œashift é€‰ 12**

æƒ³æ·±å…¥äº†è§£çš„åŒå­¦å¯ä»¥çœ‹ä»¥ä¸‹è¯´æ˜

### æ¨èæ–¹æ¡ˆ

**RAID çº§åˆ«**ï¼šæŒ‰å®¹é‡ã€æ€§èƒ½ã€å®¹é”™ã€é‡å»ºé€Ÿåº¦ç­‰æƒè¡¡é€‰æ‹©ï¼ˆmirror/raid10 åæ€§èƒ½+å°è§„æ¨¡ï¼ŒraidzN åå®¹é‡+ç®€å•ï¼ŒdraidN åå®¹é‡+å¿«é€Ÿè‡ªæ„ˆï¼‰ã€‚

**å‹ç¼©ç®—æ³•**ï¼šè‹¥ä¸ç‰¹æ®Šéœ€æ±‚ï¼Œç›´æ¥é€‰ `lz4`ï¼ˆæˆ– `on`ï¼‰ï¼›è¦æé™å‹ç¼©å¯è€ƒè™‘ `zstd` æˆ– `gzip`ã€‚

**ashift**ï¼šç°ä»£ç›˜é€‰ `12`ã€‚

### è¿™äº›å‚æ•°éƒ½æ˜¯å•¥æ„æ€ï¼Ÿ

#### RAID çº§åˆ«ï¼ˆPool å¸ƒå±€ï¼‰

ç±»å‹

æœ€å°‘ç›˜æ•°

å®¹é”™èƒ½åŠ›

ç‰¹ç‚¹ä¸é€‚ç”¨åœºæ™¯

**mirror**

â‰¥2

1 ç›˜ï¼ˆæ¯ä¸ª mirror ç»„å†…ï¼‰

å°†æ¯å—ç›˜æ•°æ®å®Œå…¨é•œåƒåˆ°å¦ä¸€å—ç›˜ï¼Œè¯»æ€§èƒ½ç•¥ä¼˜ã€å†™æ€§èƒ½ä¸å•ç›˜ç›¸å½“ï¼›æ¨èå¯¹æ€§èƒ½å’Œå¯é æ€§éƒ½è¾ƒæ•æ„Ÿçš„å°è§„æ¨¡éƒ¨ç½²ã€‚

**raid10**

â‰¥4

æœ€å°‘å¯å®¹å¿ 1 ä¸ªç›˜ï¼ˆæ¯ä¸ª mirror ç»„ï¼‰

å…ˆæˆå¯¹é•œåƒï¼Œå†è·¨ç»„åšæ¡å¸¦ï¼ˆstripeï¼‰ï¼›å…¼é¡¾è¯»å†™æ€§èƒ½å’Œå®¹é”™ï¼Œé€‚åˆéœ€è¦é«˜ IOPS çš„åœºæ™¯ã€‚

**raidz1** (Proxmox ç•Œé¢å« â€œRAIDZâ€)

â‰¥3

1 ç›˜ï¼ˆå•é‡æ ¡éªŒï¼‰

å•å—å¥‡å¶æ ¡éªŒç›˜ï¼Œç©ºé—´åˆ©ç”¨ç‡é«˜äº mirrorï¼Œä½†é‡å»ºï¼ˆresilverï¼‰æ—¶å½±å“æ€§èƒ½ï¼›é€‚åˆå®¹é‡ä¼˜å…ˆã€å¯¹é‡å»ºæ—¶é—´ä¸å¤ªæ•æ„Ÿçš„åœºæ™¯ã€‚

**raidz2**

â‰¥4

2 ç›˜ï¼ˆåŒé‡æ ¡éªŒï¼‰

åŒé‡å¥‡å¶æ ¡éªŒï¼Œèƒ½å®¹å¿ä¸¤å—ç›˜åŒæ—¶å¤±æ•ˆï¼›æ¯” raidz1 å¤šä¸€å—æ ¡éªŒç›˜ï¼Œé€‚åˆä¸­å¤§å‹å®¹é‡æ± ï¼Œå¯¹å¯é æ€§è¦æ±‚æ›´é«˜æ—¶ã€‚

**raidz3**

â‰¥5

3 ç›˜ï¼ˆ3 é‡æ ¡éªŒï¼‰

ä¸‰é‡å¥‡å¶æ ¡éªŒï¼Œèƒ½å®¹å¿ä¸‰å—ç›˜åŒæ—¶å¤±æ•ˆï¼›é€‚åˆæµ·é‡å­˜å‚¨ã€å¯¹æ•°æ®å®‰å…¨æåº¦æ•æ„Ÿçš„åœºæ™¯ã€‚

**draid1**

â‰¥ï¼ˆP+1+1ï¼‰ 1

1 ç›˜ æ ¡éªŒ + åŠ¨æ€å¤‡ç”¨

åŠ¨æ€ RAIDZ1ï¼Œç­‰åŒäº raidz1+é›†æˆçƒ­å¤‡ï¼›å¤±æ•ˆåå¯å¹¶è¡Œè‡ªæ„ˆï¼ˆrebuildï¼‰ï¼Œé‡å»ºé€Ÿåº¦æ›´å¿«ã€‚é€‚åˆéœ€å¿«é€Ÿæ¢å¤çš„å¤§è§„æ¨¡é˜µåˆ—ã€‚

**draid2**

â‰¥ï¼ˆP+2+1ï¼‰

2 ç›˜ æ ¡éªŒ + åŠ¨æ€å¤‡ç”¨

åŒç†ï¼ŒåŒé‡æ ¡éªŒ ï¼‹ åŠ¨æ€çƒ­å¤‡ï¼›å…¼é¡¾å¯é æ€§å’Œé‡å»ºæ€§èƒ½ã€‚

**draid3**

â‰¥ï¼ˆP+3+1ï¼‰

3 ç›˜ æ ¡éªŒ + åŠ¨æ€å¤‡ç”¨

ä¸‰é‡æ ¡éªŒ ï¼‹ åŠ¨æ€çƒ­å¤‡ï¼›æè‡´å¯é ï¼Œæ”¯æŒå¹¶è¡Œé‡å»ºã€‚

> æ³¨ï¼š
> 
> 1.  å¯¹åº”å…¬å¼ï¼š`æ€»ç›˜æ•° â‰¥ æ ¡éªŒç›˜æ•° P + æ•°æ®ç›˜æ•° D + 1 (çƒ­å¤‡åˆ†åŒº)`ï¼›Proxmox ç•Œé¢åªåˆ—å‡º `draid1/draid2/draid3`ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®š Dï¼Œåªç®¡æ»¡è¶³æœ€å°‘ç›˜æ•°å³å¯ã€‚
> 2.  **raidzN vs. draidN** å¯¹æ¯”ï¼š
>     *   **raidzN**ï¼šä¸“ç”¨å¥‡å¶ç›˜ï¼Œæ•…éšœåå•ä»»åŠ¡é‡å»ºï¼Œå½±å“é˜µåˆ—æ€§èƒ½ï¼›
>     *   **draidN**ï¼šé›†æˆçƒ­å¤‡ï¼Œä¸”é‡å»ºè¿‡ç¨‹å¹¶è¡Œåˆ†å¸ƒåœ¨æ‰€æœ‰ç›˜ä¸Šï¼Œé€Ÿåº¦æ›´å¿«ã€å¯¹åœ¨çº¿ I/O å½±å“æ›´å°ã€‚

#### å‹ç¼©ï¼ˆcompressionï¼‰

ZFS æ”¯æŒåœ¨å†™å…¥æ—¶å¯¹æ•°æ®å—åšå‹ç¼©ï¼Œèƒ½èŠ‚çœç©ºé—´å¹¶åœ¨å¤šæ•°æƒ…å†µä¸‹æå‡ I/O æ€§èƒ½ï¼ˆè¯»å–æ—¶å°‘é‡ CPU æ¢å–æ›´å°‘çš„ç£ç›˜ I/Oï¼‰ã€‚

é€‰é¡¹

å«ä¹‰

ä¼˜ç¼ºç‚¹

**off**

å…³é—­å‹ç¼©

å†™å…¥æœ€å¿«ï¼Œä½†ç©ºé—´å ç”¨å¤§ï¼Œè¯»å†™ I/O æ›´å¤šã€‚

**on**

å¯ç”¨é»˜è®¤ç®—æ³•ï¼ˆProxmox/ZFS é»˜è®¤é€šå¸¸æ˜¯ `lz4`ï¼‰

ç»¼åˆæ€§èƒ½å¥½ï¼Œæ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚

**lz4**

LZ4 ç®—æ³•ï¼šè¶…å¿«çš„å‹ç¼©/è§£å‹ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯

å‹ç¼©ç‡ä¸­ç­‰ï¼ŒCPU å ç”¨ä½ï¼Œè¯»å†™æ€§èƒ½å‡ ä¹æ— æŸã€‚

**gzip**

Gzip ç®—æ³•ï¼ˆå¯æŒ‡å®šçº§åˆ«ï¼Œå¦‚ `gzip-1`â€¦`gzip-9`ï¼‰

å‹ç¼©ç‡é«˜ï¼ˆå°¤å…¶é«˜çº§åˆ«ï¼‰ï¼Œä½† CPU å ç”¨ä¹Ÿé«˜ï¼›é€‚åˆåªè¯»æˆ–å°‘å†™åœºæ™¯ã€‚

**zstd**

Zstandardï¼šæ¯” gzip æ›´å¥½çš„å‹ç¼©ç‡ä¸é€Ÿåº¦æŠ˜ä¸­

é«˜å‹ç¼©ç‡ã€è§£å‹é€Ÿåº¦å¿«ï¼Œå†™å…¥æ€§èƒ½ç•¥ä½äº lz4ï¼›é€‚åˆå¯¹å­˜å‚¨æ›´æ•æ„Ÿçš„åœºæ™¯ã€‚

**lzjb**

æ—§ç‰ˆ LZJB ç®—æ³•

å‹ç¼©ç‡ã€æ€§èƒ½å‡ä¸åŠ lz4ï¼Œç°åœ¨åŸºæœ¬å·²è¢«æ·˜æ±°ã€‚

**zle**

Zero-Length Encodingï¼ˆé›¶å—è·³è¿‡ï¼‰

åªè·³è¿‡å…¨ 0 åŒºå—ï¼Œæ—  CPU æˆ–éå¸¸ä½å¼€é”€ï¼Œé€‚åˆç£ç›˜æ˜ åƒã€ç¨€ç–æ–‡ä»¶ç­‰åŒ…å«å¤§é‡é›¶å—çš„å·¥ä½œè´Ÿè½½ã€‚

#### ashiftï¼ˆå¯¹é½å¤§å°ï¼‰

*   **å«ä¹‰**  
    ZFS åœ¨ç‰©ç†ç›˜ä¸Šä»¥ 2 çš„å¹‚æ¬¡æ–¹å­—èŠ‚å¤§å°åš I/Oï¼Œ`ashift` å°±æ˜¯è¿™ä¸ªå¹‚æ¬¡ï¼ˆ`ashift = log2(å—å¤§å°)`ï¼‰ã€‚
*   **å¸¸è§å–å€¼**
    *   `ashift=9`ï¼š2^9 = 512 Bï¼Œå¯¹åº”ä¼ ç»Ÿ 512 å­—èŠ‚æ‰‡åŒºã€‚
    *   `ashift=12`ï¼š2^12 = 4096 Bï¼Œå¯¹åº”ç°ä»£ 4K æ‰‡åŒºï¼ˆSSD ä¹Ÿå¸¸ä»¥ 4K ç‰©ç†å†™å…¥ï¼‰ã€‚
*   **å»ºè®®**
    1.  **ç°ä»£ç›˜ï¼ˆå°¤å…¶ SSD æˆ– 4K æ‰‡åŒºç›˜ï¼‰** ä¸€å¾‹ç”¨ `ashift=12`ï¼Œé¿å…è·¨æ‰‡åŒºå†™å…¥å¸¦æ¥çš„æ€§èƒ½å’Œå¯¿å‘½æƒ©ç½šã€‚
    2.  å¦‚æœä½ ç¡®è®¤æ‰€æœ‰ç›˜éƒ½æ˜¯ç»å…¸ 512B æ‰‡åŒºç›˜ï¼Œ`ashift=9` å¯ä»¥ç•¥å¾®èŠ‚çœç©ºé—´ï¼Œä½†é£é™©è¾ƒå¤§ä¸”ç°åœ¨å°‘è§ã€‚

> **æ³¨æ„**ï¼š`ashift` åªèƒ½åœ¨åˆ›å»º pool æ—¶æŒ‡å®šï¼Œä¸€æ—¦å»ºç«‹åæ— æ³•æ›´æ”¹ï¼Œå› æ­¤åŠ¡å¿…è¦ä¸€å¼€å§‹å°±é€‰å¯¹ã€‚

å¸¸ç”¨å‘½ä»¤
----

åˆ›å»ºå®Œ ZFS å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰ ZVOL å’Œ Dataset

    zfs list
    

ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ ZFS æ± 

    zpool list
    

ä¿®æ”¹æŒ‚è½½ç‚¹
-----

é»˜è®¤æŒ‚è½½ç‚¹æ˜¯æ ¹ç›®å½•ï¼Œä»¥ ZFS æ± çš„åç§°ä¸ºæŒ‚è½½ç‚¹

æ¯”å¦‚ `/data1`

å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹

    sudo zfs set mountpoint=/storage/data1 data1
    

æŸ¥çœ‹å½“å‰æŒ‚è½½ç‚¹

    zfs get mountpoint data1
    

ä½†æ˜¯ä¿®æ”¹å®Œè¿˜å¾—åŒæ­¥ä¿®æ”¹ PVE é…ç½® `/etc/pve/storage.cfg`

å…¶ä¸­ä¼šæœ‰ç±»ä¼¼è¿™æ ·çš„é…ç½®

    zfspool: data1
        pool data1
        content rootdir,images
        mountpoint /data1
    
    zfspool: data2
        pool data2
        content rootdir,images
        mountpoint /data2
    

éœ€è¦ä¿®æ”¹å¯¹åº”çš„ `mountpoint` åˆ° `/storage/data1`

ä¿å­˜é€€å‡ºå³å¯ï¼Œ`/etc/pve` æ˜¯ç”± Proxmox çš„é›†ç¾¤é…ç½®æ–‡ä»¶ç³»ç»Ÿï¼ˆ`pmxcfs`ï¼‰è‡ªåŠ¨æ‰˜ç®¡å¹¶çƒ­æ›´æ–°çš„ï¼ŒPVE ç›¸å…³æœåŠ¡ï¼ˆæ¯”å¦‚å¯åŠ¨å®¹å™¨ï¼‰ä¼šå³æ—¶è¯»å–è¿™ä¸ªæ–‡ä»¶çš„å˜åŒ–ã€‚

å¯ä»¥ä½¿ç”¨ `pvesm status` å‘½ä»¤æŸ¥çœ‹å­˜å‚¨ï¼Œä¸è¿‡è¿™å‘½ä»¤æ²¡æœ‰è¾“å‡ºè·¯å¾„

    root@pve:/storage# pvesm status
    Name             Type     Status           Total            Used       Available        %
    backups           dir     active        98497780        13794364        79653868   14.00%
    data1          zfspool     active      3771203584       650276484      3120927100   17.24%
    data2          zfspool     active      3771203584      1778071764      1993131820   47.15%
    local             dir     active        98497780        13794364        79653868   14.00%
    local-lvm     lvmthin     active       847638528         2966734       844671793    0.35%
    

å¾®ä¿¡å…¬ä¼—å·ï¼šã€Œç¨‹åºè®¾è®¡å®éªŒå®¤ã€ ä¸“æ³¨äºäº’è”ç½‘çƒ­é—¨æ–°æŠ€æœ¯æ¢ç´¢ä¸å›¢é˜Ÿæ•æ·å¼€å‘å®è·µï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡ã€æœºå™¨å­¦ä¹ ä¸æ•°æ®åˆ†æç®—æ³•ã€ç§»åŠ¨ç«¯å¼€å‘ã€Linuxã€Webå‰åç«¯å¼€å‘ç­‰ï¼Œæ¬¢è¿ä¸€èµ·æ¢è®¨æŠ€æœ¯ï¼Œåˆ†äº«å­¦ä¹ å®è·µç»éªŒã€‚