---
layout: post
title: 'MAFå¿«é€Ÿå…¥é—¨ï¼ˆ12ï¼‰ä¸»å·¥ä½œæµ+å­å·¥ä½œæµ'
date: "2026-01-20T00:44:44Z"
---
MAFå¿«é€Ÿå…¥é—¨ï¼ˆ12ï¼‰ä¸»å·¥ä½œæµ+å­å·¥ä½œæµ
====================

![MAFå¿«é€Ÿå…¥é—¨ï¼ˆ12ï¼‰ä¸»å·¥ä½œæµ+å­å·¥ä½œæµ](https://img2024.cnblogs.com/blog/381412/202601/381412-20260116201534655-550888663.png) åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¾€å¾€éœ€è¦åœ¨ä¸»å·¥ä½œæµä¸­æ ¹æ®å·¥å•ç±»å‹åˆ†å‘æˆ–ç§»äº¤åˆ°ä¸åŒçš„æ ‡å‡†åŒ–å­æµç¨‹ä¸­è¿›è¡Œåç»­å¤„ç†ã€‚æœ¬æ–‡ä»‹ç»äº†MAFä¸­ä¸»å·¥ä½œæµ + å­å·¥ä½œæµçš„å·¥ä½œæ¨¡å¼ï¼Œæœ€åé€šè¿‡ä¸€ä¸ªä¼ä¸šå®¢æœä¸­å¿ƒå¤„ç†æŠ•è¯‰å·¥å•çš„æ¡ˆä¾‹ä»‹ç»äº†è¿™ç§æ¨¡å¼çš„ä»£ç å®ç°ã€‚

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Edisonã€‚

æœ€è¿‘æˆ‘ä¸€ç›´åœ¨è·Ÿç€åœ£æ°çš„ã€Š[.NET+AIæ™ºèƒ½ä½“å¼€å‘è¿›é˜¶](https://mp.weixin.qq.com/s?__biz=MzA4NzQzNTg4Ng==&mid=2651744458&idx=1&sn=139f7584e81aeecd0945133bdc2b4791&scene=21#wechat_redirect)ã€‹è¯¾ç¨‹å­¦ä¹ MAFå¼€å‘å¤šæ™ºèƒ½ä½“å·¥ä½œæµï¼Œæˆ‘å¼ºçƒˆæ¨èä½ ä¹Ÿä¸Šè½¦è·Ÿæˆ‘ä¸€èµ·å‡ºå‘ï¼

[ä¸Šä¸€ç¯‡](https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper11)ï¼Œæˆ‘ä»¬å­¦ä¹ äº†MAFä¸­å¦‚ä½•è¿›è¡Œå¹¶è¡Œå·¥ä½œæµã€‚æœ¬ç¯‡ï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸‹åœ¨MAFä¸­å¦‚ä½•å¼€å¯ ä¸»å·¥ä½œæµ + è‡ªå·¥ä½œæµ çš„æ¨¡å¼ï¼Œç›¸ä¿¡è¿™ä¼šæ˜¯å¤§å®¶å¯èƒ½ä¼šç¢°åˆ°çš„åœºæ™¯ã€‚

**1 å­å·¥ä½œæµæ¨¡å¼ä»‹ç»**
==============

åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¾€å¾€éœ€è¦åœ¨ä¸»å·¥ä½œæµä¸­æ ¹æ®å·¥å•ç±»å‹åˆ†å‘æˆ–ç§»äº¤åˆ°ä¸åŒçš„æ ‡å‡†åŒ–å­æµç¨‹ä¸­è¿›è¡Œåç»­å¤„ç†ã€‚

åœ¨MAFä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Sub-Worklfow æ¨¡å¼æ¥å®ç°è¿™ä¸ªç›®çš„ï¼Œå¦‚ä¸‹ä»£ç ç‰‡æ®µæ‰€ç¤ºã€‚

é¦–å…ˆï¼Œå°†å­å·¥ä½œæµè½¬æ¢ä¸ºä¸€ä¸ªExecutorï¼š

var logisticsSubExecutor = 
  logisticsSubWorkflow.BindAsExecutor("LogisticsSubWorkflow");
var productQualitySubExecutor = 
  productQualitySubWorkflow.BindAsExecutor("ProductQualitySubWorkflow");

ç„¶åï¼Œæ„å»ºä¸»å·¥ä½œæµå¹¶æ ¹æ®æ¡ä»¶è·¯ç”±åˆ°å­å·¥ä½œæµExecutorï¼š

var mainWorkflow = new WorkflowBuilder(classifierExecutor)
    .AddEdge<ComplaintProcessingRecord>(classifierExecutor, productQualitySubExecutor, 
        condition: record \=> record.Category == "äº§å“è´¨é‡")
    .AddEdge<ComplaintProcessingRecord>(classifierExecutor, logisticsSubExecutor, 
        condition: record \=> record.Category == "ç‰©æµé—®é¢˜")
    .AddEdge(productQualitySubExecutor, complianceExecutor)
    .AddEdge(logisticsSubExecutor, complianceExecutor)
    .AddEdge(complianceExecutor, sentimentExecutor)
    .WithOutputFrom(sentimentExecutor)
    .Build();

è¿™æ ·å°±å®ç°äº†ï¼š**ä¸»å·¥ä½œæµè¿›è¡Œåˆ†ç±»è½¬å‘ï¼Œè‡ªå·¥ä½œæµè¿›è¡Œè¯¦ç»†å¤„ç†**ã€‚

**2 ä¸»å·¥ä½œæµ+å­å·¥ä½œæµå®éªŒæ¡ˆä¾‹**
===================

å‡è®¾æˆ‘ä»¬æ˜¯ä¸€ä¸ªä¼ä¸šçš„å®¢æœä¸­å¿ƒï¼Œæ¯å¤©éƒ½ä¼šæ”¶åˆ°å¤§é‡çš„å·¥å•ï¼Œéœ€è¦æ ¹æ®å·¥å•ç±»å‹ï¼ˆæ¯”å¦‚æ˜¯ äº§å“è´¨é‡è¯é¢˜ è¿˜æ˜¯ ç‰©æµè¯é¢˜ï¼‰åˆ†å‘åˆ°ä¸åŒçš„æ ‡å‡†åŒ–å­æµç¨‹å»åšåç»­å¤„ç†ï¼Œæœ€åç”Ÿæˆä¸€ä¸ªç”¨æˆ·å‹å¥½ ä¸” æ»¡è¶³åˆè§„è¦æ±‚ çš„å›å¤ç»™ç”¨æˆ·ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼šé…ç½®Â 1ä¸ªä¸»å·¥ä½œæµ + 2ä¸ªå­å·¥ä½œæµÂ æ¥è¦†ç›–è¿™ä¸ªéœ€æ±‚ã€‚

### **2.1 å…³é”®ä¾èµ–åŒ…å¼•å…¥**

åœ¨ä»Šå¤©çš„è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶åˆ›å»ºäº†ä¸€ä¸ª.NETæ§åˆ¶å°åº”ç”¨ç¨‹åºï¼Œå®‰è£…äº†ä»¥ä¸‹NuGetåŒ…ï¼š

*   Microsoft.Agents.AI.OpenAI
*   Microsoft.Agents.AI.Workflows
*   Microsoft.Extensions.AI.OpenAI

### 2.2 å®šä¹‰æ•°æ®ä¼ è¾“æ¨¡å‹

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸‹åœ¨è¿™ä¸ªå·¥ä½œæµä¸­éœ€è¦ç”Ÿæˆä¼ é€’çš„æ•°æ®æ¨¡å‹ï¼š

æŠ•è¯‰æ•°æ®æ¨¡å‹ åŠ å…±äº«çŠ¶æ€

namespace SubWorkflow.Models;
// å…±äº«çŠ¶æ€ï¼šæŠ•è¯‰å¤„ç†è®°å½•ï¼ˆå„æ‰§è¡Œå™¨ä¼šæ›´æ–°æ­¤å¯¹è±¡ï¼‰
internal class ComplaintProcessingRecord
{
    public CustomerComplaint Original { get; set; }
    public string Category { get; set; } = "æœªåˆ†ç±»";
    public string Handler { get; set; } = "å¾…åˆ†é…";
    public List<string\> ProcessingSteps { get; set; } = new();
    public string AIGeneratedResponse { get; set; } = "";
    public string ComplianceStatus { get; set; } = "å¾…å®¡æ ¸";
    public string SentimentScore { get; set; } = "æœªè¯„ä¼°";
}
// æŠ•è¯‰æ•°æ®æ¨¡å‹
internal record CustomerComplaint(
    string OrderId,
    string CustomerName,
    string ComplaintText,
    DateTime SubmittedAt
);

### 2.3 å®šä¹‰äº§å“è´¨é‡å¤„ç†å­å·¥ä½œæµ

****ï¼ˆ1ï¼‰é—®é¢˜è¯„ä¼°ï¼š****å°è£…äº§å“è´¨é‡è¯„ä¼°çš„é€»è¾‘ï¼Œè¿™é‡Œä»…ä»…åšæ¼”ç¤ºç”¨æ— å®é™…é€»è¾‘ã€‚

internal sealed class ProductEvaluationExecutor() : Executor<ComplaintProcessingRecord, ComplaintProcessingRecord>(nameof(ProductEvaluationExecutor))
{
    public override ValueTask<ComplaintProcessingRecord> HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = default)
    {
        Console.WriteLine("ğŸ” æ­£åœ¨è¯„ä¼°äº§å“è´¨é‡é—®é¢˜...");
        record.ProcessingSteps.Add("\[äº§å“è¯„ä¼°\] æ£€æµ‹åˆ°å±å¹•å¤–è§‚ç¼ºé™·ï¼Œç¬¦åˆè´¨é‡é—®é¢˜å®šä¹‰");
        record.Handler \= "äº§å“è´¨é‡å›¢é˜Ÿ";
        return ValueTask.FromResult(record);
    }
}

**ï¼ˆ2ï¼‰é€€/æ¢è´§åˆ¤å®šï¼š**è´Ÿè´£åˆ¤å®šæ˜¯é€€è´§ è¿˜æ˜¯ æ¢è´§ å¤„ç†ã€‚

internal sealed class ReturnPolicyExecutor() : Executor<ComplaintProcessingRecord, ComplaintProcessingRecord>(nameof(ReturnPolicyExecutor))
{
    public override ValueTask<ComplaintProcessingRecord> HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = default)
    {
        Console.WriteLine("ğŸ“¦ åˆ¤å®šé€€æ¢è´§æ”¿ç­–...");
        var daysFromOrder = (DateTime.Now - record.Original.SubmittedAt).Days;
        if (daysFromOrder <= 7)
        {
            record.ProcessingSteps.Add("\[é€€æ¢è´§åˆ¤å®š\] ç¬¦åˆ7å¤©æ— ç†ç”±é€€è´§æ”¿ç­–ï¼Œæ‰¹å‡†å…¨é¢é€€æ¬¾");
        }
        else
        {
            record.ProcessingSteps.Add("\[é€€æ¢è´§åˆ¤å®š\] è¶…è¿‡é€€è´§æœŸé™ï¼Œå»ºè®®æ¢è´§æˆ–éƒ¨åˆ†è¡¥å¿");
        }
        return ValueTask.FromResult(record);
    }
}

****ï¼ˆ3ï¼‰AIå›å¤ï¼š****åœ¨æŠ•è¯‰å†…å®¹å’Œåˆ¤å®šç»“æœçš„åŸºç¡€ä¸Šç”Ÿæˆå‹å¥½çš„å›å¤è¿”å›ç»™ç”¨æˆ·ã€‚

internal sealed class AIResponseGeneratorExecutor(IChatClient chatClient) : Executor<ComplaintProcessingRecord, ComplaintProcessingRecord>(nameof(AIResponseGeneratorExecutor))
{
    public override async ValueTask<ComplaintProcessingRecord> HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = default)
    {
        Console.WriteLine("ğŸ¤– AI æ­£åœ¨ç”Ÿæˆå®¢æˆ·å›å¤...");
        var prompt = $@"ä½ æ˜¯ä¸“ä¸šçš„å®¢æœä¸»ç®¡ã€‚æ ¹æ®ä»¥ä¸‹æŠ•è¯‰å¤„ç†ä¿¡æ¯ï¼Œç”Ÿæˆä¸€å°æ­£å¼ã€æœ‰åŒç†å¿ƒçš„å®¢æˆ·å›å¤é‚®ä»¶ï¼ˆ150å­—å†…ï¼‰ï¼š

å®¢æˆ·ï¼š{record.Original.CustomerName}
è®¢å•å·ï¼š{record.Original.OrderId}
æŠ•è¯‰å†…å®¹ï¼š{record.Original.ComplaintText}
å¤„ç†æ­¥éª¤ï¼š
{string.Join("\\n", record.ProcessingSteps)}
è¦æ±‚ï¼š
1. è¡¨è¾¾æ­‰æ„å’Œç†è§£
2. è¯´æ˜å¤„ç†æ–¹æ¡ˆ
3. æä¾›åç»­è”ç³»æ–¹å¼
4. è¯­æ°”çœŸè¯šã€ä¸“ä¸š";

        var response = await chatClient.GetResponseAsync(prompt, cancellationToken: cancellationToken);
        record.AIGeneratedResponse \= response.Text ?? "AI ç”Ÿæˆå¤±è´¥";
        record.ProcessingSteps.Add($"\[AI å›å¤\] å·²ç”Ÿæˆå®¢æˆ·å›å¤æ¨¡æ¿ï¼ˆ{record.AIGeneratedResponse.Length}å­—ï¼‰");
        return record;
    }
}

æœ€åï¼Œæ„å»ºå­å·¥ä½œæµå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªExecutorä»¥ä¾¿åç»­é›†æˆåˆ°ä¸»å·¥ä½œæµä¸­ï¼š

var productEvalExecutor = new ProductEvaluationExecutor();
var returnPolicyExecutor = new ReturnPolicyExecutor();
var aiResponseExecutor = new AIResponseGeneratorExecutor(chatClient);
var productQualitySubWorkflow = new WorkflowBuilder(productEvalExecutor)
    .AddEdge(productEvalExecutor, returnPolicyExecutor)
    .AddEdge(returnPolicyExecutor, aiResponseExecutor)
    .WithOutputFrom(aiResponseExecutor)
    .Build();
var productQualitySubExecutor = 
  productQualitySubWorkflow.BindAsExecutor("ProductQualitySubWorkflow");

### 2.4 å®šä¹‰ç‰©æµé—®é¢˜å¤„ç†å­å·¥ä½œæµ

****ï¼ˆ1ï¼‰ç‰©æµè¿½è¸ªï¼š****å°è£…ç‰©æµæŸ¥è¯¢é€»è¾‘ï¼Œè¿™é‡Œä»…ä»…åšæ¼”ç¤ºç”¨æ— å®é™…é€»è¾‘ã€‚

internal sealed class LogisticsTrackingExecutor() : Executor<ComplaintProcessingRecord, ComplaintProcessingRecord>(nameof(LogisticsTrackingExecutor))
{
    public override ValueTask<ComplaintProcessingRecord> HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = default)
    {
        Console.WriteLine("ğŸšš æ­£åœ¨æŸ¥è¯¢ç‰©æµä¿¡æ¯...");
        record.ProcessingSteps.Add("\[ç‰©æµè¿½è¸ª\] åŒ…è£¹åœ¨ä¸­è½¬ç«™æ»ç•™3å¤©ï¼Œå½“å‰çŠ¶æ€ï¼šè¿è¾“ä¸­");
        record.Handler \= "ç‰©æµè¿è¥å›¢é˜Ÿ";
        return ValueTask.FromResult(record);
    }
}

****ï¼ˆ2ï¼‰å»¶è¿Ÿåˆ†æï¼š****å°è£…å»¶è¿Ÿåˆ†æé€»è¾‘ï¼Œè¿™é‡Œä»…ä»…åšæ¼”ç¤ºç”¨æ— å®é™…é€»è¾‘ã€‚

internal sealed class DelayAnalysisExecutor() : Executor<ComplaintProcessingRecord, ComplaintProcessingRecord>(nameof(DelayAnalysisExecutor))
{
    public override ValueTask<ComplaintProcessingRecord> HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = default)
    {
        Console.WriteLine("ğŸ“Š åˆ†æå»¶è¿ŸåŸå› ...");
        record.ProcessingSteps.Add("\[å»¶è¿Ÿåˆ†æ\] å»¶è¿ŸåŸå› ï¼šæš´é›¨å¯¼è‡´é“è·¯å°é—­ï¼Œé¢„è®¡2å¤©å†…æ¢å¤é…é€");
        record.ProcessingSteps.Add("\[è¡¥å¿æ–¹æ¡ˆ\] æä¾›50å…ƒä¼˜æƒ åˆ¸ + å…è¿è´¹");
        return ValueTask.FromResult(record);
    }
}

æœ€åï¼Œæ„å»ºå­å·¥ä½œæµå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªExecutorä»¥ä¾¿åç»­é›†æˆåˆ°ä¸»å·¥ä½œæµä¸­ï¼š

var logisticsTrackExecutor = new LogisticsTrackingExecutor();
var delayAnalysisExecutor = new DelayAnalysisExecutor();
var logisticsAIResponseExecutor = new AIResponseGeneratorExecutor(chatClient);

var logisticsSubWorkflow = new WorkflowBuilder(logisticsTrackExecutor)
    .AddEdge(logisticsTrackExecutor, delayAnalysisExecutor)
    .AddEdge(delayAnalysisExecutor, logisticsAIResponseExecutor)
    .WithOutputFrom(logisticsAIResponseExecutor)
    .Build();
var logisticsSubExecutor = 
  logisticsSubWorkflow.BindAsExecutor("LogisticsSubWorkflow");

### **2.5 æ„å»ºä¸»å·¥ä½œæµ**

ç°åœ¨å¼€å§‹æ„å»ºä¸»å·¥ä½œæµï¼š

Step1: è·å–ChatClient

var chatClient = new OpenAIClient(
        new ApiKeyCredential(openAIProvider.ApiKey),
        new OpenAIClientOptions { Endpoint = new Uri(openAIProvider.Endpoint) })
    .GetChatClient(openAIProvider.ModelId)
    .AsIChatClient();

Step2: åˆ›å»ºå·¥å•åˆ†ç±»Executor,Â åˆè§„å®¡æ ¸Executor ä»¥åŠ æƒ…ç»ªè¯„ä¼°Executor

// 1. å·¥å•åˆ†ç±»æ‰§è¡Œå™¨
internal sealed class ComplaintClassifierExecutor() : Executor<ComplaintProcessingRecord, ComplaintProcessingRecord>(nameof(ComplaintClassifierExecutor))
{
    public override ValueTask<ComplaintProcessingRecord> HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = default)
    {
        Console.WriteLine("ğŸ·ï¸ æ­£åœ¨åˆ†ç±»æŠ•è¯‰ç±»å‹...");
        // ç®€å•è§„åˆ™åˆ†ç±»ï¼ˆå®é™…å¯ç”¨ AI åˆ†ç±»ï¼‰
        if (record.Original.ComplaintText.Contains("åˆ’ç—•") || record.Original.ComplaintText.Contains("è´¨é‡") || record.Original.ComplaintText.Contains("é€€è´§"))
        {
            record.Category \= "äº§å“è´¨é‡";
        }
        else if (record.Original.ComplaintText.Contains("å»¶è¿Ÿ") || record.Original.ComplaintText.Contains("ç‰©æµ") || record.Original.ComplaintText.Contains("é…é€"))
        {
            record.Category \= "ç‰©æµé—®é¢˜";
        }
        else
        {
            record.Category \= "å…¶ä»–";
        }
        record.ProcessingSteps.Add($"\[åˆ†ç±»å™¨\] æŠ•è¯‰ç±»å‹è¯†åˆ«ä¸ºï¼š{record.Category}");
        return ValueTask.FromResult(record);
    }
}

// 2. åˆè§„å®¡æ ¸æ‰§è¡Œå™¨
internal sealed class ComplianceCheckExecutor() : Executor<ComplaintProcessingRecord, ComplaintProcessingRecord>(nameof(ComplianceCheckExecutor))
{
    public override ValueTask<ComplaintProcessingRecord> HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = default)
    {
        Console.WriteLine("ğŸ›¡ï¸ åˆè§„å®¡æ ¸ä¸­...");
        var checks = new List<string\>();
        if (record.AIGeneratedResponse.Contains("æ­‰æ„")) checks.Add("âœ… åŒ…å«é“æ­‰");
        if (record.AIGeneratedResponse.Length <= 300) checks.Add("âœ… å­—æ•°åˆè§„");
        if (!record.AIGeneratedResponse.Contains("æ³•å¾‹") && !record.AIGeneratedResponse.Contains("è¯‰è®¼"))
            checks.Add("âœ… æ— æ•æ„Ÿæ³•å¾‹è¯æ±‡");

        record.ComplianceStatus \= checks.Count >= 2 ? "âœ… å®¡æ ¸é€šè¿‡" : "âš ï¸ éœ€äººå·¥å¤å®¡";
        record.ProcessingSteps.Add($"\[åˆè§„å®¡æ ¸\] {record.ComplianceStatus} - {string.Join(", ", checks)}");
        return ValueTask.FromResult(record);
    }
}

// 3. æƒ…ç»ªè¯„ä¼°æ‰§è¡Œå™¨ï¼ˆä½¿ç”¨ AIï¼‰
internal sealed class SentimentAnalysisExecutor(IChatClient chatClient) : Executor<ComplaintProcessingRecord, ComplaintProcessingRecord>(nameof(SentimentAnalysisExecutor))
{
    public override async ValueTask<ComplaintProcessingRecord> HandleAsync(ComplaintProcessingRecord record, IWorkflowContext context, CancellationToken cancellationToken = default)
    {
        Console.WriteLine("ğŸ˜Š AI æƒ…ç»ªè¯„ä¼°ä¸­...");
        var prompt = $@"åˆ†æä»¥ä¸‹å®¢æœå›å¤çš„æƒ…ç»ªåŸºè°ƒï¼Œç”¨ä¸€ä¸ªè¯æ¦‚æ‹¬ï¼ˆå¦‚ï¼šå‹å¥½ã€ä¸“ä¸šã€å†·æ·¡ã€çƒ­æƒ…ï¼‰ï¼š

{record.AIGeneratedResponse}

åªè¿”å›ä¸€ä¸ªè¯ï¼Œä¸è¦è§£é‡Šã€‚";

        var response = await chatClient.GetResponseAsync(prompt, cancellationToken: cancellationToken);
        record.SentimentScore \= response.Text?.Trim() ?? "ä¸­æ€§";
        record.ProcessingSteps.Add($"\[æƒ…ç»ªè¯„ä¼°\] AI è¯„ä¼°è¯­æ°”ä¸ºï¼š{record.SentimentScore}");
        return record;
    }
}

NOTEï¼šå‰é¢çš„å­å·¥ä½œæµå‡ç”Ÿæˆäº†AIå›å¤ï¼Œè¿™é‡Œéœ€è¦å¯¹å…¶è¿›è¡Œåˆè§„å®¡æ ¸ä»¥é˜²æ­¢ä¸åˆè§„çš„å›å¤åˆ°ç”¨æˆ·é‚£é‡Œã€‚

Step3: åˆ›å»ºä¸»å·¥ä½œæµ

var classifierExecutor = new ComplaintClassifierExecutor();
var complianceExecutor = new ComplianceCheckExecutor();
var sentimentExecutor = new SentimentAnalysisExecutor(chatClient);

// ä¸»å·¥ä½œæµï¼šåˆ†ç±» â†’ æ¡ä»¶è·¯ç”±åˆ°å­æµç¨‹ â†’ åˆè§„ â†’ æƒ…ç»ª
var mainWorkflow = new WorkflowBuilder(classifierExecutor)
    .AddEdge<ComplaintProcessingRecord>(classifierExecutor, productQualitySubExecutor,
        condition: record \=> record.Category == "äº§å“è´¨é‡")
    .AddEdge<ComplaintProcessingRecord>(classifierExecutor, logisticsSubExecutor,
        condition: record \=> record.Category == "ç‰©æµé—®é¢˜")
    .AddEdge(productQualitySubExecutor, complianceExecutor)
    .AddEdge(logisticsSubExecutor, complianceExecutor)
    .AddEdge(complianceExecutor, sentimentExecutor)
    .WithOutputFrom(sentimentExecutor)
    .Build();
Console.OutputEncoding \= Encoding.UTF8;
Console.WriteLine("âœ… Main + Sub Workflow æ„å»ºå®Œæˆ");

### 2.6 æµ‹è¯•å·¥ä½œæµ

å®šä¹‰æŠ•è¯‰çš„å·¥å•å†…å®¹å¦‚ä¸‹ï¼šè¿™æ˜¯ä¸€ä¸ªäº§å“è´¨é‡ç›¸å…³çš„æŠ•è¯‰ã€‚

var processingRecord = new ComplaintProcessingRecord 
{ 
    Original \= new CustomerComplaint(
        OrderId: "ORD-2025-8821",
        CustomerName: "å¼ å…ˆç”Ÿ",
        ComplaintText: "æ”¶åˆ°çš„æ‰‹æœºå±å¹•æœ‰æ˜æ˜¾åˆ’ç—•ï¼Œè¦æ±‚é€€è´§é€€æ¬¾",
        SubmittedAt: DateTime.Now)
};

é€šè¿‡Streamingæµå¼æ‰§è¡Œï¼š

Console.WriteLine("ğŸš€ å¼€å§‹æ‰§è¡ŒæŠ•è¯‰å¤„ç†æµæ°´çº¿...");
Console.WriteLine(new string('â”', 60));
await using (var streaming = await InProcessExecution.StreamAsync(mainWorkflow, processingRecord))
{
    await foreach (WorkflowEvent evt in streaming.WatchStreamAsync())
    {
        switch (evt)
        {
            case ExecutorInvokedEvent started:
                Console.WriteLine($"\\nğŸ”¹ {started.ExecutorId} å¼€å§‹æ‰§è¡Œ");
                break;
            case ExecutorCompletedEvent completed when completed.Data is ComplaintProcessingRecord rec:
                Console.WriteLine($"   å…±äº«çŠ¶æ€æ›´æ–° â†’ å¤„ç†æ­¥éª¤æ•°ï¼š{rec.ProcessingSteps.Count}");
                break;
            case WorkflowOutputEvent outputEvt when outputEvt.Data is ComplaintProcessingRecord finalRecord:
                Console.WriteLine("\\n" + new string('â”', 60));
                Console.WriteLine("ğŸ‰ æŠ•è¯‰å¤„ç†å®Œæˆï¼æœ€ç»ˆå¤„ç†è®°å½•:\\n");
                Console.WriteLine(JsonSerializer.Serialize(finalRecord));
                Console.WriteLine("\\nğŸ“ å¤„ç†æ­¥éª¤è¯¦æƒ…ï¼š");
                foreach (var step in finalRecord.ProcessingSteps)
                {
                    Console.WriteLine($"  {step}");
                }

                Console.WriteLine("\\nğŸ’¬ AI ç”Ÿæˆçš„å®¢æˆ·å›å¤ï¼š");
                Console.WriteLine(new string('â”€', 60));
                Console.WriteLine(finalRecord.AIGeneratedResponse);
                Console.WriteLine(new string('â”€', 60));
                break;
        }
    }
}

æµ‹è¯•ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

é¦–å…ˆï¼Œå¯ä»¥é€šè¿‡ç›‘æ§æ—¥å¿—å‘ç°å‡†ç¡®åœ°è¿›å…¥åˆ°äº†äº§å“è´¨é‡å­æµç¨‹ï¼š

![image](https://img2024.cnblogs.com/blog/381412/202601/381412-20260116201359984-901569605.png)

å…¶æ¬¡ï¼Œæœ€åç”±AIç”Ÿæˆçš„å›å¤å†…å®¹ä¹Ÿå¾ˆå‹å¥½ï¼ŒåŒæ—¶ä¹Ÿæ»¡è¶³åˆè§„å®¡æ ¸çš„è¦æ±‚ï¼š

![image](https://img2024.cnblogs.com/blog/381412/202601/381412-20260116201408277-1480451793.png)

**3 å°ç»“**
========

æœ¬æ–‡ä»‹ç»äº†MAFä¸­ä¸»å·¥ä½œæµ + å­å·¥ä½œæµçš„å·¥ä½œæ¨¡å¼ï¼Œæœ€åé€šè¿‡ä¸€ä¸ªä¼ä¸šå®¢æœä¸­å¿ƒå¤„ç†æŠ•è¯‰å·¥å•çš„æ¡ˆä¾‹ä»‹ç»äº†è¿™ç§æ¨¡å¼çš„ä»£ç å®ç°ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

*   å»ºè®®æ¯ä¸ªå­å·¥ä½œæµéƒ½æ˜¯ç”¨**æ ‡å‡†ç»Ÿä¸€**çš„çŠ¶æ€æ¨¡å‹ï¼Œä»¥ä¾¿åœ¨ä¸»å·¥ä½œæµä¸­å¤ç”¨ å’Œ ä¼ é€’ã€‚
*   å»ºè®®æ¯ä¸ªå­å·¥ä½œæµåªä¿æŒ3~4ä¸ªæ­¥éª¤ï¼Œ**å•ä¸€èŒè´£**åœ¨å·¥ä½œæµä¸­åŒæ ·é€‚ç”¨ï¼

ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°†ç»§ç»­å­¦ä¹ MAFä¸­æ™ºèƒ½ä½“çš„å‡ ç§å¸¸è§ç¼–æ’æ¨¡å¼ -Â é¡ºåºï¼Œå¹¶å‘ å’Œ ç§»äº¤ã€‚

ç¤ºä¾‹æºç 
====

GitHub:Â [https://github.com/EdisonTalk/MAFD](https://github.com/EdisonTalk/MAFD)

å‚è€ƒèµ„æ–™
====

åœ£æ°ï¼Œã€Š[.NET + AI æ™ºèƒ½ä½“å¼€å‘è¿›é˜¶](https://www.cnblogs.com/sheng-jie/p/19200934)ã€‹ï¼ˆæ¨èæŒ‡æ•°ï¼šâ˜…â˜…â˜…â˜…â˜…ï¼‰

Microsoft Learnï¼Œã€Š[Agent Framework Tutorials](https://learn.microsoft.com/en-us/agent-framework/overview/agent-framework-overview?wt.mc_id=MVP_397012)ã€‹

![](https://images.cnblogs.com/cnblogs_com/edisonchou/1647700/o_200902144330EdisonTalk-Footer.jpg)

ä½œè€…ï¼šçˆ±è¿ªç”Ÿ

å‡ºå¤„ï¼š[https://edisontalk.cnblogs.com](https://edisontalk.cnblogs.com "from")

æœ¬æ–‡ç‰ˆæƒå½’ä½œè€…å’Œåšå®¢å›­å…±æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œä¸”åœ¨æ–‡ç« é¡µé¢æ˜æ˜¾ä½ç½®ç»™å‡ºåŸæ–‡é“¾æ¥ã€‚

[![](http://service.t.sina.com.cn/widget/qmd/2068032061/d643d182/10.png)](https://weibo.com/u/2068032061?s=6uyXnP)