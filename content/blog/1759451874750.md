---
layout: post
title: '10.1è€ƒè¯•T4ï¼ˆswapï¼‰é¢˜è§£'
date: "2025-10-03T00:37:54Z"
---
10.1è€ƒè¯•T4ï¼ˆswapï¼‰é¢˜è§£
================

é¢˜ç›®æè¿°
----

[\\(link\\)](https://www.luogu.com.cn/problem/T672992)

å° D æ­£åœ¨ç ”ç©¶äº¤æ¢ã€‚

å° D è®¤ä¸ºä¸€ä¸ªæ•´æ•°åºåˆ—æ˜¯å¥½çš„ï¼Œå½“ä¸”ä»…å½“å®ƒå…ˆï¼ˆä¸ä¸¥æ ¼ï¼‰ä¸Šå‡ï¼Œåï¼ˆä¸ä¸¥æ ¼ï¼‰ä¸‹é™ã€‚

å½¢å¼åŒ–åœ°ï¼Œæˆ‘ä»¬è®¤ä¸ºåºåˆ— \\(ğ‘\_1,ğ‘\_2,...,ğ‘\_ğ‘›\\) æ˜¯å¥½çš„ï¼Œå½“ä¸”ä»…å½“å­˜åœ¨æŸä¸ª \\(ğ‘˜âˆˆ\[1,ğ‘›\]\\)ï¼Œä½¿å¾—å¯¹äºä»»æ„  
\\(1 â‰¤ğ‘– <ğ‘˜\\)ï¼Œæœ‰ \\(ğ‘\_ğ‘– â‰¤ğ‘\_ğ‘–+1\\)ï¼Œä¸”å¯¹äºä»»æ„ \\(ğ‘˜â‰¤ğ‘–<ğ‘›\\)ï¼Œæœ‰ \\(ğ‘\_ğ‘– \\ge ğ‘\_ğ‘–+1\\)ã€‚

å° D å¾—åˆ°äº†ä¸€ä¸ªé•¿åº¦ä¸º ğ‘› çš„åºåˆ— \\(ğ‘\_1,ğ‘\_2,...,ğ‘\_ğ‘›\\)ï¼Œä»–æƒ³è®©è¿™ä¸ªåºåˆ—å˜æˆå¥½çš„ã€‚

å° D æ¯æ¬¡å¯ä»¥äº¤æ¢ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ã€‚å› ä¸ºäº¤æ¢å¾ˆç´¯ï¼Œæ‰€ä»¥å° D æƒ³çŸ¥é“ï¼Œä»–æœ€å°‘éœ€è¦äº¤æ¢å¤šå°‘æ¬¡ã€‚

è¿™ä¸‹å° D ä¸ä¼šäº†ï¼Œè¯·ä½ å¸®å¸®ä»–ã€‚

subtask1(15pts):\\(ğ‘› â‰¤ 10\\)ï¼›

subtask2(20pts):\\(ğ‘› â‰¤ 500\\)ï¼›

subtask3(15pts):\\(ğ‘› â‰¤ 5000\\)ï¼›

subtask4(15pts):\\(ğ‘› â‰¤ 10^5\\)ï¼›

subtask5(20pts):\\({ğ‘}\\) æ˜¯ä¸€ä¸ª \\(\[1,ğ‘›\]\\) çš„æ’åˆ—ã€‚

subtask6(15pts):æ— ç‰¹æ®Šé™åˆ¶ã€‚

å¯¹äº 100% çš„æ•°æ®ï¼Œ\\(1â‰¤ğ‘›â‰¤3Ã—10^5ï¼Œ1â‰¤ğ‘\_ğ‘– â‰¤ğ‘›\\)ã€‚

æ–¹æ³•
--

è€ƒè™‘è´ªå¿ƒã€‚

å¯¹äºä¸€ä¸ªåºåˆ—ï¼Œå¦‚æœæˆ‘ä»¬è¦è®©ä»–å˜å¥½ï¼Œå…¶æœ€å°å€¼ä¸€å®šä¼šè¢«ç§»åˆ°æœ€å·¦è¾¹æˆ–æœ€å³è¾¹ã€‚ç§»åˆ°æœ€å·¦è¾¹æˆ–æœ€å³è¾¹å°±å–å†³äºç§»åˆ°å“ªè¾¹éœ€è¦çš„æ¬¡æ•°æœ€å°‘ã€‚

äºæ˜¯ï¼Œæˆ‘ä»¬å†è€ƒè™‘åˆ†æ²»ã€‚æ¯æ¬¡å°†å¯¹åºåˆ—ä¸­æœ€å°çš„æ•°ç§»åˆ°æœ€è¾¹ä¸Šï¼Œç»™ \\(ans\\) åŠ ä¸Šç§»åŠ¨æ¬¡æ•°ï¼Œå¹¶å°†è¿™ä¸ªæ•°åˆ æ‰ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±åˆå¾—åˆ°äº†ä¸€ä¸ªåºåˆ—ã€‚å¯¹åºåˆ—è¿›è¡Œè¿™æ ·çš„é‡å¤æ“ä½œï¼Œç›´åˆ° \\(n\\) ä¸ªæ•°å…¨éƒ¨è¢«åˆ é™¤ï¼Œè¾“å‡º \\(ans\\) å³å¯ã€‚

**ä½†æ˜¯**ï¼Œå½“æˆ‘ä»¬æœ‰å¾ˆå¤šä¸ªå¹¶åˆ—æœ€å°çš„æ•°æ—¶ï¼Œå¯¹è¿™äº›æ•°åˆ é™¤çš„é¡ºåºæ˜¯æœ‰è®²ç©¶çš„ã€‚æ¯æ¬¡åªèƒ½åˆ é™¤æœ€å·¦è¾¹æˆ–æœ€å³è¾¹çš„æ•°ï¼Œå¦åˆ™ä¸€å®šä¼šäº§ç”Ÿä¸¤ä¸ªç›¸ç­‰çš„æ•°äº¤æ¢ä½ç½®çš„æƒ…å†µã€‚è¿™æ— ç–‘æ˜¯æ— æ„ä¹‰çš„ï¼Œä¼šä½¿ç­”æ¡ˆä¸æ˜¯æœ€ä¼˜ã€‚å¹¶ä¸”ï¼Œåº”åˆ é™¤æœ€å·¦è¾¹æˆ–æœ€å³è¾¹ä¸­åˆ é™¤æ‰€éœ€æ¬¡æ•°æ›´å°‘çš„ä¸€è¾¹ã€‚è¿™æ ·ï¼Œæ‰èƒ½ä¿è¯åé¢è¢«åˆ é™¤çš„æ•°æ˜¯æœ€ä¼˜çš„ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š\\(O(n^2)\\)

ä¼˜åŒ–
--

è§‚å¯Ÿåˆ° \\(n\\) æœ€å¤§èƒ½è¾¾åˆ° \\(3Ã—10^5\\) ï¼Œ\\(n ^ 2\\) æ˜¯è‚¯å®šå¡ä¸è¿‡å»çš„ã€‚è¿™æ—¶å€™æˆ‘ä»¬ä¾¿éœ€è¦ä¼˜åŒ–ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¹³è¡¡æ ‘\\(fhq-treap\\)ã€‚å…¶å®æ ‘çŠ¶æ•°ç»„ä¹Ÿå¯ä»¥ç”¨ï¼Œåˆå¿«åˆå¥½äº›ï¼Œå¹æ™®å¸¸æ•°å¤§çš„æ²¡è¾¹ï¼Œä½†æˆ‘æ˜¯èŒƒæµ©å¼ºå¹æ™®æ­»å¿ ç²‰ï¼Œæˆ‘å°±è¦ç”¨ã€‚ ç»´æŠ¤ \\(treap\\) å¯¹ä¸€ä¸ªåºåˆ—åˆ†æˆä¸‰æ®µï¼Œä¸€æ®µä¸ºè¦åˆ çš„æ•°å‰çš„æ•°ï¼Œä¸€æ®µä¸ºå…¶è‡ªå·±ï¼Œä¸€æ®µä¸ºå…¶åé¢çš„æ•°ï¼Œå¯åŠ¨æ¬¡æ•°å°±æ˜¯å‰é¢çš„æ•°çš„ \\(size\\) å’Œåé¢çš„æ•°çš„ \\(size\\) å– \\(min\\)ï¼Œç„¶åå†å°†å‰åçš„æ•°åˆå¹¶ï¼Œå³å°†è¦åˆ æ‰çš„æ•°åˆ æ‰ã€‚é‡å¤æ“ä½œå³å¯ï¼Œç»†èŠ‚çœ‹ä»£ç å°±è¡Œã€‚æˆ‘å¯¹æˆ‘é©¬èœ‚çš„ç¾ä¸½ç¨‹åº¦è¿˜æ˜¯å¾ˆè‡ªä¿¡çš„ã€‚

ä»£ç 
--

    #include <bits/stdc++.h>
    using namespace std;
    #define int long long
    #define usd unsigned
    #define el cout << '\n'
    #define lowbit(x) (x & (-x))
    const int ranmod = 1e7;
    #define random ((rand() * rand()) % ranmod)
    #define AC return 
    #define AK return 0
    #define YS cout << "YES"
    #define NO cout << "NO"
    #define Ys cout << "Yes"
    #define No cout << "No"
    #define ys cout << "yes"
    #define no cout << "no"
    #define ls(i) ch[i][0]
    #define rs(i) ch[i][1]
    #define debug(num) cerr << #num << ' ' << num << '\n'
    // void init();
    void main_();
    signed main() {
    	ios :: sync_with_stdio(false);
    	cin.tie(NULL);
    	cout.tie(NULL);
    	// freopen(".in", "r", stdin);
    	// freopen(".out", "w", stdout);
    	int t = 1;
    	// cin >> t;
    	while(t--) {
    		// init();
    		main_();
    	}
    	AK;
    }
    const int mod = 95225987, maxn = 3 * 1e5 + 18;
    
    int ch[maxn][2], rnd[maxn], val[maxn], siz[maxn], tot, rt;
    int add(int num) {
        tot++;
        ls(tot) = rs(tot) = 0;
        rnd[tot] = random;
        siz[tot] = 1;
        val[tot] = num;
        return tot;
    }
    void push_up(int i) {
        siz[i] = siz[ls(i)] + siz[rs(i)] + 1;
    }
    int merge(int l, int r) {
        if(l * r == 0) return l + r;
        int res = 0;
        if(rnd[l] < rnd[r]) {
            res = l;
            rs(l) = merge(rs(l), r);
        } else {
            res = r;
            ls(r) = merge(l, ls(r));
        }
        push_up(res);
        return res;
    }
    void split(int rt, int v, int &l, int &r) {
        if(rt == 0) {l = 0, r = 0; AC;}
        if(val[rt] <= v) {
            l = rt;
            split(rs(l), v, rs(l), r);
            push_up(l);
        } else {
            r = rt;
            split(ls(r), v, l, ls(r));
            push_up(r);
        }   
    }
    int show(int id) {
        int a, b, mid;
        split(rt, id, a, b);
        split(a, id - 1, a, mid);
        int res = min(siz[a], siz[b]);
        debug(siz[a]), debug(siz[b]);
        rt = merge(a, merge(mid, b));
        return res;
    }
    int del(int id) {
        int a, b, mid;
        split(rt, id, a, b);
        split(a, id - 1, a, mid);
        int res = min(siz[a], siz[b]);
        debug(siz[a]), debug(siz[b]);
        rt = merge(a, b);
        return res;
    }
    
    int n, ans = 0;
    map <int, deque <int> > a;
    
    void main_() {
    	cin >> n;
        for(int i = 1; i <= n; i++) {
            int num;
            cin >> num;
            rt = merge(rt, add(i));
            a[num].push_back(i);
        }
        for(auto tmp : a) {
            while(!tmp.second.empty()) {
                if(tmp.second.size() == 1) {
                    ans += del(tmp.second.front());
                    tmp.second.pop_front();
                } else  {
                    int l = show(tmp.second.front()), r = show(tmp.second.back());
                    if(l <= r) {
                        ans += del(tmp.second.front());
                        tmp.second.pop_front();
                    } else {
                        ans += del(tmp.second.back());
                        tmp.second.pop_back();
                    }
                }
            }
        }
        cout << ans; el;
    }