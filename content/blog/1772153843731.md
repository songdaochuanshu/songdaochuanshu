---
layout: post
title: 'MAFå¿«é€Ÿå…¥é—¨ï¼ˆ17ï¼‰ç”¨æˆ·æ™ºèƒ½ä½“äº¤äº’åè®®AG-UIï¼ˆä¸­ï¼‰'
date: "2026-02-27T00:57:23Z"
---
MAFå¿«é€Ÿå…¥é—¨ï¼ˆ17ï¼‰ç”¨æˆ·æ™ºèƒ½ä½“äº¤äº’åè®®AG-UIï¼ˆä¸­ï¼‰
============================

![MAFå¿«é€Ÿå…¥é—¨ï¼ˆ17ï¼‰ç”¨æˆ·æ™ºèƒ½ä½“äº¤äº’åè®®AG-UIï¼ˆä¸­ï¼‰](https://img2024.cnblogs.com/blog/381412/202602/381412-20260225172927811-936310258.png) æœ¬æ–‡ä»‹ç»äº†AG-UI Toolså³AG-UIçš„å·¥å…·ç³»ç»Ÿï¼Œæ¼”ç¤ºäº†ä¸€ä¸ªç»“åˆå‰åç«¯å·¥å…·ä½¿ç”¨çš„æ··åˆæ¨¡å¼æ¡ˆä¾‹ï¼Œé€šè¿‡æ¡ˆä¾‹å¯ä»¥äº†è§£å¦‚ä½•åœ¨AG-UIä¸­è°ƒç”¨å·¥å…·å¹¶è§‚å¯Ÿè°ƒç”¨é“¾ã€‚

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Edisonã€‚

æœ€è¿‘æˆ‘ä¸€ç›´åœ¨è·Ÿç€åœ£æ°çš„ã€Š.NET+AIæ™ºèƒ½ä½“å¼€å‘è¿›é˜¶ã€‹è¯¾ç¨‹å­¦ä¹ MAFå¼€å‘å¤šæ™ºèƒ½ä½“å·¥ä½œæµï¼Œæˆ‘å¼ºçƒˆæ¨èä½ ä¹Ÿä¸Šè½¦è·Ÿæˆ‘ä¸€èµ·å‡ºå‘ï¼

[ä¸Šä¸€ç¯‡](https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper16)ï¼Œæˆ‘ä»¬åˆæ­¥å­¦ä¹ äº†AG-UIã€‚æœ¬ç¯‡ï¼Œæˆ‘ä»¬æ¥äº†è§£AG-UI Tools ä»¥åŠ å®ç°ä¸€ä¸ªå‰åç«¯å·¥å…·æ··åˆä½¿ç”¨çš„æ¡ˆä¾‹ã€‚

**1 ä»€ä¹ˆæ˜¯AG-UI Toolsï¼Ÿ**
=====================

AG-UI Tools æ˜¯ AG-UI çš„ å·¥å…·ç³»ç»Ÿï¼Œåˆ†ä¸º Backend Tools å’Œ Frontend Toolsï¼Œå®ƒä»¬æ˜¯AI Agentå’Œå¤–éƒ¨ä¸–ç•Œäº¤äº’çš„æ¡¥æ¢ï¼Œè®©AI Agentèƒ½å¤Ÿæ‰§è¡Œå®é™…æ“ä½œï¼Œè€Œä¸ä»…ä»…æ˜¯ç”Ÿæˆæ–‡æœ¬ã€‚

### Backend Tools

é¡¾åæ€ä¹‰ï¼ŒBackend Toolså³åç«¯å·¥å…·ï¼Œå®ƒåœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œä¸»è¦ç”¨äºåšä¸€äº›ç±»ä¼¼æ•°æ®åº“æŸ¥è¯¢ã€APIè°ƒç”¨ æˆ– æ•æ„Ÿæ“ä½œç­‰ç”¨é€”ï¼Œä¸»è¦è®¿é—®æœåŠ¡ç«¯èµ„æºï¼Œå®‰å…¨æ€§è¦æ±‚è¾ƒé«˜ã€‚

ä½•æ—¶éœ€è¦ä½¿ç”¨Backend Toolsï¼Ÿ

*   ğŸ” æ¶‰åŠæ•æ„Ÿæ•°æ®æˆ– API å¯†é’¥
    
*   ğŸ’¾ éœ€è¦è®¿é—®æ•°æ®åº“æˆ–åç«¯æœåŠ¡
    
*   âš¡ è®¡ç®—å¯†é›†å‹ä»»åŠ¡
    
*   ğŸ”’ éœ€è¦æœåŠ¡ç«¯éªŒè¯å’Œå®¡è®¡
    

### Frontend Tools

é¡¾åæ€ä¹‰ï¼ŒFrontend Toolså³å‰ç«¯å·¥å…·ï¼Œå®ƒåœ¨å®¢æˆ·ç«¯æ‰§è¡Œï¼Œä¸»è¦ç”¨äºåšä¸€äº›ç±»ä¼¼GPSå®šä½ã€å‰ªè´´æ¿ æˆ–è€… è®¾å¤‡ä¼ æ„Ÿå™¨ç­‰ç”¨é€”ï¼Œä¸»è¦è®¿é—®å®¢æˆ·ç«¯è®¾å¤‡èµ„æºï¼Œå®‰å…¨æ€§ä¸Šä»…éœ€åšå®¢æˆ·ç«¯éªŒè¯ã€‚

ä½•æ—¶éœ€è¦ä½¿ç”¨Frontend Toolsï¼Ÿ

*   ğŸ“ éœ€è¦è®¿é—®è®¾å¤‡åŠŸèƒ½ï¼ˆGPSã€ç›¸æœºç­‰ï¼‰
    
*   ğŸ“‹ éœ€è¦è¯»å–æœ¬åœ°èµ„æºï¼ˆå‰ªè´´æ¿ã€æ–‡ä»¶ï¼‰
    
*   ğŸ”‘ æ¶‰åŠç”¨æˆ·éšç§æ•°æ®
    
*   âš¡ éœ€è¦å¿«é€Ÿå“åº”çš„æœ¬åœ°æ“ä½œ
    

**2 å¿«é€Ÿå¼€å§‹ï¼šå‰åç«¯å·¥å…·æ··åˆä½¿ç”¨**
====================

å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼šæˆ‘ä»¬å‘Agentè¯¢é—®â€œé™„è¿‘æœ‰ä»€ä¹ˆå¥½åƒçš„é¤å…â€ï¼ŒAG-UIå‰ç«¯ä¼šä½¿ç”¨å‰ç«¯å·¥å…·è·å–å½“å‰å®šä½ä¿¡æ¯ï¼Œç„¶åå°†é—®é¢˜å’Œå®šä½å‘ç»™AG-UIæœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯åˆè°ƒç”¨æœåŠ¡ç«¯å·¥å…·æœç´¢é™„è¿‘çš„é¤é¦†ä¿¡æ¯ï¼Œæœ€åç”±å¤§æ¨¡å‹æ•´åˆç»“æœè¾“å‡ºæœ€ç»ˆä¿¡æ¯ã€‚

æ•´ä¸ªè°ƒç”¨æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image](https://img2024.cnblogs.com/blog/381412/202602/381412-20260225172225128-1957872183.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€æ­¥ä¸€æ­¥å®Œæˆä¸€ä¸ªAG-UI Toolsç¤ºä¾‹åº”ç”¨æ¶‰åŠåˆ°çš„Server å’Œ Clientã€‚

### **AG-UI Tools Server**

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªASP.NET Webåº”ç”¨ï¼Œå®‰è£…ä»¥ä¸‹NuGetåŒ…ï¼š

Microsoft.Agents.AI.Hosting.AGUI.AspNetCore
Microsoft.Agents.AI.OpenAI
Microsoft.Extensions.AI.OpenAI

ç„¶åï¼Œå°±æ˜¯æ•´ä¸ªç¤ºä¾‹çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¸€å—ä¸€å—æ¥è¯´ï¼š

**ï¼ˆ1ï¼‰å®šä¹‰ç›¸å…³æ•°æ®æ¨¡å‹**

è¯´æ˜ï¼šè¿™é‡Œé…ç½® JsonSerializerContext ï¼ˆJSONæºç”Ÿæˆå™¨ï¼‰ä¸»è¦ç”¨ä»¥æé«˜åºåˆ—åŒ–æ€§èƒ½ï¼Œç¡®ä¿åœ¨Native AOTç¯å¢ƒä¸‹ä¹Ÿèƒ½å¤Ÿæ­£å¸¸åºåˆ—åŒ–ï¼Œå³AOTå‹å¥½ã€‚

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸ“¦ æ•°æ®æ¨¡å‹å®šä¹‰
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
internal sealed class RestaurantSearchResult
{
    public string Location { get; set; } = string.Empty;
    public double SearchRadius { get; set; }
    public int TotalResults { get; set; }
    public NearbyRestaurant\[\] Restaurants { get; set; } = \[\];
}
internal sealed class NearbyRestaurant
{
    public string Name { get; set; } = string.Empty;
    public string Cuisine { get; set; } = string.Empty;
    public double Distance { get; set; }
    public double Rating { get; set; }
    public string Address { get; set; } = string.Empty;
}
internal sealed class RestaurantDetail
{
    public string Name { get; set; } = string.Empty;
    public string Description { get; set; } = string.Empty;
    public string OpeningHours { get; set; } = string.Empty;
    public string PriceRange { get; set; } = string.Empty;
    public string\[\] RecommendedDishes { get; set; } = \[\];
    public string Phone { get; set; } = string.Empty;
    public bool HasParking { get; set; }
    public bool AcceptsReservation { get; set; }
}
// JSON åºåˆ—åŒ–ä¸Šä¸‹æ–‡
\[JsonSerializable(typeof(RestaurantSearchResult))\]
\[JsonSerializable(typeof(NearbyRestaurant))\]
\[JsonSerializable(typeof(RestaurantDetail))\]
internal sealed partial class MixedToolsJsonContext : JsonSerializerContext;

**ï¼ˆ2ï¼‰å®šä¹‰backend tools**

internal class BackendTools
{
    // ğŸ”§ é¤å…æœç´¢å·¥å…·ï¼ˆåç«¯æ‰§è¡Œï¼‰
    \[Description("æ ¹æ®ä½ç½®æœç´¢é™„è¿‘çš„é¤å…ã€‚Search for nearby restaurants based on location.")\]
    public static RestaurantSearchResult SearchNearbyRestaurants(
        \[Description("ç”¨æˆ·å½“å‰ä½ç½®æè¿°")\] string location,
        \[Description("æœç´¢åŠå¾„ï¼ˆå…¬é‡Œï¼‰")\] double radiusKm = 2.0,
        \[Description("èœç³»åå¥½ï¼ˆå¯é€‰ï¼‰")\] string? cuisinePreference = null)
    {
        Console.ForegroundColor \= ConsoleColor.Green;
        Console.WriteLine($"\\nğŸ” \[åç«¯å·¥å…·\] SearchNearbyRestaurants");
        Console.WriteLine($"   ğŸ“ ä½ç½®: {location}");
        Console.WriteLine($"   ğŸ“ åŠå¾„: {radiusKm} km");
        Console.WriteLine($"   ğŸ½ï¸ èœç³»åå¥½: {cuisinePreference ?? "ä¸é™"}");
        Console.ResetColor();
        // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
        var restaurants = new List<NearbyRestaurant>
    {
        new() { Name = "è€åŒ—äº¬ç‚¸é…±é¢", Cuisine = "åŒ—äº¬èœ", Distance = 0.5, Rating = 4.7, Address = $"{location}ä¸œè·¯100å·" },
        new() { Name = "å·é¦™é˜", Cuisine = "å·èœ", Distance = 0.8, Rating = 4.5, Address = $"{location}è¥¿è·¯200å·" },
        new() { Name = "ç²¤å‘³è½©", Cuisine = "ç²¤èœ", Distance = 1.2, Rating = 4.8, Address = $"{location}å—è·¯300å·" },
        new() { Name = "æ—¥å¼æ–™ç†å±‹", Cuisine = "æ—¥æœ¬æ–™ç†", Distance = 1.5, Rating = 4.6, Address = $"{location}åŒ—è·¯400å·" },
        new() { Name = "çƒ¤åŒ ", Cuisine = "å·èœ", Distance = 2.5, Rating = 4.8, Address = $"{location}å¤©åºœå››è¡—é“¶æ³°åŸ5æ¥¼" }
    };
        // å¦‚æœæœ‰èœç³»åå¥½ï¼Œè¿‡æ»¤ç»“æœ
        if (!string.IsNullOrEmpty(cuisinePreference))
        {
            restaurants \= restaurants
                .Where(r \=> r.Cuisine.Contains(cuisinePreference, StringComparison.OrdinalIgnoreCase))
                .ToList();
        }
        Console.ForegroundColor \= ConsoleColor.Green;
        Console.WriteLine($"   âœ… æ‰¾åˆ° {restaurants.Count} å®¶é¤å…");
        Console.ResetColor();
        return new RestaurantSearchResult
        {
            Location \= location,
            SearchRadius \= radiusKm,
            TotalResults \= restaurants.Count,
            Restaurants \= restaurants.ToArray()
        };
    }
    // ğŸ”§ è·å–é¤å…è¯¦æƒ…ï¼ˆåç«¯æ‰§è¡Œï¼‰
    \[Description("è·å–æŒ‡å®šé¤å…çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¥ä¸šæ—¶é—´ã€èœå•æ¨èç­‰ã€‚Get detailed information about a specific restaurant.")\]
    public static RestaurantDetail GetRestaurantDetail(
        \[Description("é¤å…åç§°")\] string restaurantName)
    {
        Console.ForegroundColor \= ConsoleColor.Green;
        Console.WriteLine($"\\nğŸ“– \[åç«¯å·¥å…·\] GetRestaurantDetail");
        Console.WriteLine($"   ğŸª é¤å…: {restaurantName}");
        Console.ResetColor();
        // æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢
        var detail = new RestaurantDetail
        {
            Name \= restaurantName,
            Description \= $"{restaurantName}æ˜¯ä¸€å®¶çŸ¥åçš„ç‰¹è‰²é¤å…ï¼Œæ‹¥æœ‰20å¹´å†å²ã€‚",
            OpeningHours \= "10:00 - 22:00",
            PriceRange \= "äººå‡ 80-150 å…ƒ",
            RecommendedDishes \= \["æ‹›ç‰Œèœ", "ç‰¹è‰²å°åƒ", "ä¸»å¨æ¨è"\],
            Phone \= "010-12345678",
            HasParking \= true,
            AcceptsReservation \= true
        };
        Console.ForegroundColor \= ConsoleColor.Green;
        Console.WriteLine($"   âœ… è·å–æˆåŠŸ");
        Console.ResetColor();
        return detail;
    }
}

**ï¼ˆ3ï¼‰åˆ›å»ºåº”ç”¨å¹¶æ³¨å†ŒAG-UIæœåŠ¡**

// Step0. Create WebApplication builder
var builder = WebApplication.CreateBuilder(args);
builder.Services.AddHttpClient().AddLogging();
// â­ é…ç½® JSON åºåˆ—åŒ–ä¸Šä¸‹æ–‡ (ç”¨äºæ•°æ®æ¨¡å‹çš„åºåˆ—åŒ–)
builder.Services.ConfigureHttpJsonOptions(options =>
    options.SerializerOptions.TypeInfoResolverChain.Add(MixedToolsJsonContext.Default));
// Step1. Register AG-UI services
builder.Services.AddAGUI();

**ï¼ˆ4ï¼‰åŠ è½½å¯ç”¨backend toolså¹¶åˆ›å»ºAgent**

var app = builder.Build();

// Step3. Create AI Agent
var jsonOptions = app.Services.GetRequiredService<IOptions<JsonOptions>>().Value;
AITool\[\] backendTools \=
\[
    AIFunctionFactory.Create(BackendTools.SearchNearbyRestaurants, serializerOptions: jsonOptions.SerializerOptions),
    AIFunctionFactory.Create(BackendTools.GetRestaurantDetail, serializerOptions: jsonOptions.SerializerOptions)
\];
Console.WriteLine("ğŸ”§ å·²æ³¨å†Œåç«¯å·¥å…·ï¼š");
foreach (var tool in backendTools)
{
    Console.WriteLine($"   â€¢ {tool.Name} (æœåŠ¡ç«¯æ‰§è¡Œ)");
}
Console.WriteLine("ğŸ“ å‰ç«¯å·¥å…·å°†ç”±å®¢æˆ·ç«¯æ³¨å†Œ");

var agent = chatClient.AsIChatClient()
    .AsAIAgent(
        name: "MixedToolsAssistant",
    instructions: """
        ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½é¤å…æ¨èåŠ©æ‰‹ï¼Œå…·å¤‡ä»¥ä¸‹èƒ½åŠ›ï¼š

        ğŸŒ ä½ç½®æ„ŸçŸ¥ï¼š
        \- å¯ä»¥è·å–ç”¨æˆ·çš„å½“å‰ä½ç½®ï¼ˆä½¿ç”¨ GetUserLocation å·¥å…·ï¼‰
        \- å½“ç”¨æˆ·è¯´"é™„è¿‘"ã€"å‘¨å›´"æ—¶ï¼Œå…ˆè·å–ä½ç½®

        ğŸ½ï¸ é¤å…æ¨èï¼š
        \- ä½¿ç”¨ SearchNearbyRestaurants æœç´¢é™„è¿‘é¤å…
        \- ä½¿ç”¨ GetRestaurantDetail è·å–è¯¦ç»†ä¿¡æ¯

        ğŸ¯ ä½¿ç”¨æµç¨‹ï¼š
        1. å¦‚æœç”¨æˆ·é—®"é™„è¿‘æœ‰ä»€ä¹ˆé¤å…"ï¼Œå…ˆè°ƒç”¨ GetUserLocation è·å–ä½ç½®
        2. ç„¶åè°ƒç”¨ SearchNearbyRestaurants æœç´¢
        3. å¦‚æœç”¨æˆ·æƒ³äº†è§£æŸå®¶é¤å…ï¼Œè°ƒç”¨ GetRestaurantDetail

        è¯·ç”¨ä¸­æ–‡å‹å¥½åœ°å›ç­”ç”¨æˆ·ã€‚
        """,
    tools: backendTools);
Console.WriteLine("âœ… AI Agent åˆ›å»ºæˆåŠŸ");

**ï¼ˆ5ï¼‰æ˜ å°„AGUIç«¯ç‚¹å¹¶å¯åŠ¨åº”ç”¨ï¼š**

// Step5. Mapping AG-UI Endpoints
app.MapAGUI("/", agent);

app.Run();

### **AG-UI Tools Client**

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ§åˆ¶å°åº”ç”¨ï¼Œå®‰è£…ä»¥ä¸‹NuGetåŒ…ï¼š

Microsoft.Agents.AI.AGUI
Microsoft.Agents.AI

ç„¶åï¼Œå®šä¹‰frontend toolsï¼š

internal class FrontendTools
{
    // ğŸ”§ è·å–ç”¨æˆ·ä½ç½®ï¼ˆå‰ç«¯å·¥å…· - åªæœ‰å®¢æˆ·ç«¯èƒ½è®¿é—® GPSï¼‰
    \[Description("è·å–ç”¨æˆ·å½“å‰çš„åœ°ç†ä½ç½®ä¿¡æ¯ã€‚è¿™æ˜¯å®¢æˆ·ç«¯è®¾å¤‡åŠŸèƒ½ï¼Œç”¨äºè·å– GPS ä½ç½®ã€‚Get the user's current location from GPS.")\]
    public static string GetUserLocation()
    {
        Console.ForegroundColor \= ConsoleColor.Magenta;
        Console.WriteLine("\\nğŸ“ \[å‰ç«¯å·¥å…·\] GetUserLocation");
        Console.WriteLine("   ğŸ”„ æ­£åœ¨è®¿é—®è®¾å¤‡ GPS...");
        Console.ResetColor();
        // æ¨¡æ‹Ÿ GPS è·å–å»¶è¿Ÿ
        Thread.Sleep(800);
        // æ¨¡æ‹Ÿä¸åŒçš„ä½ç½®ï¼ˆéšæœºé€‰æ‹©ï¼‰
        string\[\] locations =
        \[
            "åŒ—äº¬å¸‚æœé˜³åŒºä¸‰é‡Œå±¯",
            "ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºé™†å®¶å˜´",
            "å¹¿å·å¸‚å¤©æ²³åŒºç æ±Ÿæ–°åŸ",
            "æ·±åœ³å¸‚å—å±±åŒºç§‘æŠ€å›­",
            "æˆéƒ½å¸‚é«˜æ–°åŒºå¤©åºœè½¯ä»¶å›­"
        \];
        Random random \= new();
        string location = locations\[random.Next(locations.Length)\];
        Console.ForegroundColor \= ConsoleColor.Magenta;
        Console.WriteLine($"   âœ… GPS å®šä½æˆåŠŸ: {location}");
        Console.ResetColor();
        return location;
    }
    // ğŸ”§ è·å–ç”¨æˆ·åå¥½è®¾ç½®ï¼ˆå‰ç«¯å·¥å…· - è®¿é—®æœ¬åœ°å­˜å‚¨ï¼‰
    \[Description("è·å–ç”¨æˆ·ä¿å­˜çš„é¤é¥®åå¥½è®¾ç½®ã€‚Get user's saved dining preferences.")\]
    public static string GetUserPreferences()
    {
        Console.ForegroundColor \= ConsoleColor.Magenta;
        Console.WriteLine("\\nâš™ï¸ \[å‰ç«¯å·¥å…·\] GetUserPreferences");
        Console.WriteLine("   ğŸ”„ è¯»å–æœ¬åœ°åå¥½è®¾ç½®...");
        Console.ResetColor();
        // æ¨¡æ‹Ÿè¯»å–æœ¬åœ°å­˜å‚¨
        Thread.Sleep(300);
        string preferences = "åå¥½èœç³»: å·èœã€ç²¤èœ; ä»·ä½: ä¸­ç­‰; å¿Œå£: æ— ";
        Console.ForegroundColor \= ConsoleColor.Magenta;
        Console.WriteLine($"   âœ… è¯»å–æˆåŠŸ: {preferences}");
        Console.ResetColor();
        return preferences;
    }
}

éšåï¼Œæˆ‘ä»¬åˆ›å»ºAG-UI Client å’Œ AI Agentï¼š

......
var serverEndpoint = config.GetValue<string\>("AGUI\_SERVER\_URL")
    ?? "https://localhost:8443";

// åŠ è½½å‰ç«¯å·¥å…·
AITool\[\] frontendTools =
\[
    AIFunctionFactory.Create(FrontendTools.GetUserLocation),
    AIFunctionFactory.Create(FrontendTools.GetUserPreferences)
\];
Console.WriteLine("ğŸ”§ å·²æ³¨å†Œå‰ç«¯å·¥å…·ï¼š");
foreach (var tool in frontendTools)
{
    Console.WriteLine($"   â€¢ {tool.Name} (å®¢æˆ·ç«¯æ‰§è¡Œ)");
}
Console.WriteLine("ğŸ“ åç«¯å·¥å…·ç”±æœåŠ¡ç«¯æä¾› (SearchNearbyRestaurants, GetRestaurantDetail)");
Console.WriteLine();

// Step1. Create HTTP Client
using HttpClient httpClient = new()
{
    Timeout \= TimeSpan.FromSeconds(180) // å»¶é•¿è¶…æ—¶ï¼Œå› ä¸ºå¯èƒ½æœ‰å¤šä¸ªå·¥å…·è°ƒç”¨
};

// Step2. Create AG-UI Client
var chatClient = new AGUIChatClient(httpClient, serverEndpoint);

// Step3. Create AI Agent
var agent = chatClient.AsAIAgent(
    name: "agui-client",
    description: "AG-UI æ··åˆå·¥å…·å®¢æˆ·ç«¯",
    tools: frontendTools);  // ğŸ‘ˆ æ³¨å†Œå‰ç«¯å·¥å…·

æœ€åï¼Œå‡†å¤‡å¼€å§‹å¯¹è¯ï¼š

// Step4. Prepare for Conversation
var session = await agent.GetNewSessionAsync();
var messages = new List<ChatMessage>()
{
    new ChatMessage(ChatRole.System, """
        ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½é¤å…æ¨èåŠ©æ‰‹ã€‚
        ä½ å¯ä»¥ä½¿ç”¨å¤šç§å·¥å…·æ¥å¸®åŠ©ç”¨æˆ·æ‰¾åˆ°åˆé€‚çš„é¤å…ã€‚
        å½“ç”¨æˆ·é—®"é™„è¿‘æœ‰ä»€ä¹ˆé¤å…"æ—¶ï¼Œå…ˆè·å–ä»–ä»¬çš„ä½ç½®ï¼Œå†æœç´¢é¤å…ã€‚
        """)
};

Console.WriteLine("ğŸ’¬ å¼€å§‹å¯¹è¯ï¼ˆè¾“å…¥ :q æˆ– quit é€€å‡ºï¼‰\\n");

while (true)
{
    Console.Write("ğŸ‘¤ ç”¨æˆ·: ");
    string? message = Console.ReadLine();

    if (string.IsNullOrWhiteSpace(message))
    {
        Console.WriteLine("âš ï¸ æ¶ˆæ¯ä¸èƒ½ä¸ºç©ºï¼Œè¯·é‡æ–°è¾“å…¥ã€‚");
        continue;
    }

    if (message is ":q" or "quit")
    {
        Console.WriteLine("\\nğŸ‘‹ å†è§ï¼");
        break;
    }


    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    messages.Add(new ChatMessage(ChatRole.User, message));

    // ç»Ÿè®¡å·¥å…·è°ƒç”¨
    int frontendToolCalls = 0;
    int backendToolCalls = 0;
    bool isFirstUpdate = true;
    List<string\> toolCallChain = \[\];

    Console.WriteLine();
    Console.WriteLine("â”â”â”â”â”â”â”â”â”â”â”â”â”â” å¼€å§‹å¤„ç† â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

    // æµå¼æ¥æ”¶å“åº”
    Console.Write("ğŸ¤– åŠ©æ‰‹: ");
    await foreach (var update in agent.RunStreamingAsync(messages, session))
    {
        var chatUpdate = update.AsChatResponseUpdate();

        if (isFirstUpdate)
        {
            Console.ForegroundColor \= ConsoleColor.DarkGray;
            Console.WriteLine($"\[ğŸ”„ Run Started - Thread: {chatUpdate.ConversationId?.Substring(0, 8)}...\]");
            Console.ResetColor();
            isFirstUpdate \= false;
        }

        foreach (AIContent content in update.Contents)
        {
            switch (content)
            {
                case TextContent textContent:
                    Console.ForegroundColor \= ConsoleColor.Cyan;
                    Console.Write(textContent.Text);
                    Console.ResetColor();
                    break;

                case FunctionCallContent functionCall:
                    // åˆ¤æ–­æ˜¯å‰ç«¯è¿˜æ˜¯åç«¯å·¥å…·
                    var isFrontendTool = frontendTools.Any(t =>
                        t.Name \== functionCall.Name);

                    if (isFrontendTool)
                    {
                        frontendToolCalls++;
                        Console.ForegroundColor \= ConsoleColor.Magenta;
                        Console.WriteLine($"\\nğŸ“± \[å‰ç«¯å·¥å…·è°ƒç”¨\] {functionCall.Name}");
                    }
                    else
                    {
                        backendToolCalls++;
                        Console.ForegroundColor \= ConsoleColor.Yellow;
                        Console.WriteLine($"\\nğŸ–¥ï¸ \[åç«¯å·¥å…·è°ƒç”¨\] {functionCall.Name}");

                        // æ˜¾ç¤ºåç«¯å·¥å…·å‚æ•°
                        if (functionCall.Arguments != null)
                        {
                            Console.WriteLine("   ğŸ“ å‚æ•°:");
                            foreach (var kvp in functionCall.Arguments)
                            {
                                Console.WriteLine($"      â€¢ {kvp.Key}: {kvp.Value}");
                            }
                        }
                    }
                    Console.ResetColor();

                    toolCallChain.Add(isFrontendTool ? $"ğŸ“±{functionCall.Name}" : $"ğŸ–¥ï¸{functionCall.Name}");
                    break;

                case FunctionResultContent functionResult:
                    // åç«¯å·¥å…·ç»“æœæ˜¾ç¤º
                    if (!frontendTools.Any(t => toolCallChain.LastOrDefault()?.Contains(t.Name) ?? false))
                    {
                        Console.ForegroundColor \= ConsoleColor.Green;
                        string resultPreview = functionResult.Result?.ToString() ?? "null";
                        if (resultPreview.Length > 150)
                        {
                            resultPreview \= resultPreview.Substring(0, 150) + "...";
                        }
                        Console.WriteLine($"   âœ… ç»“æœ: {resultPreview}");
                        Console.ResetColor();
                    }
                    break;

                case ErrorContent errorContent:
                    Console.ForegroundColor \= ConsoleColor.Red;
                    Console.WriteLine($"\\nâŒ é”™è¯¯: {errorContent.Message}");
                    Console.ResetColor();
                    break;
            }
        }
    }

    // æ˜¾ç¤ºå·¥å…·è°ƒç”¨é“¾
    Console.WriteLine();
    Console.WriteLine("â”â”â”â”â”â”â”â”â”â”â”â”â”â” å¤„ç†å®Œæˆ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
    Console.ForegroundColor \= ConsoleColor.DarkGray;
    Console.WriteLine($"\[âœ… Run Finished\]");
    Console.WriteLine($"   ğŸ“± å‰ç«¯å·¥å…·è°ƒç”¨: {frontendToolCalls}");
    Console.WriteLine($"   ğŸ–¥ï¸ åç«¯å·¥å…·è°ƒç”¨: {backendToolCalls}");

    if (toolCallChain.Count > 0)
    {
        Console.WriteLine($"   ğŸ”— è°ƒç”¨é“¾: {string.Join(" â†’ ", toolCallChain)}");
    }

    Console.ResetColor();
    Console.WriteLine();
}

Console.WriteLine("ğŸ‘‹ å†è§ï¼");
Console.ReadKey();

3 æµ‹è¯•ç»“æœ
======

### æµ‹è¯•åœºæ™¯1

ç”¨æˆ·ï¼šé™„è¿‘æœ‰ä»€ä¹ˆå¥½åƒçš„é¤å…ï¼Ÿ

è°ƒç”¨é“¾è·¯ï¼šğŸ“±GetUserLocation â†’ ğŸ–¥ï¸SearchNearbyRestaurants

![agui-gif-demo-001](https://img2024.cnblogs.com/blog/381412/202602/381412-20260225172731030-801445898.gif)

### æµ‹è¯•åœºæ™¯2

ç”¨æˆ·ï¼šæ ¹æ®æˆ‘çš„åå¥½æ¨èé¤å…

è°ƒç”¨é“¾è·¯ï¼šğŸ“±GetUserPreferences â†’ ğŸ“±GetUserLocation â†’ ğŸ–¥ï¸SearchNearbyRestaurants

![agui-gif-demo-002](https://img2024.cnblogs.com/blog/381412/202602/381412-20260225172744700-1349617727.gif)

### æµ‹è¯•åœºæ™¯3

ç”¨æˆ·ï¼šçƒ¤åŒ è¿™å®¶åº—æ€ä¹ˆæ ·ï¼Ÿ

è°ƒç”¨é“¾è·¯ï¼šğŸ–¥ï¸GetRestaurantDetail

![agui-gif-demo-003](https://img2024.cnblogs.com/blog/381412/202602/381412-20260225172809095-1411472636.gif)

å¯ä»¥çœ‹åˆ°ï¼ŒAgentå¯ä»¥è‡ªåŠ¨åè°ƒå·¥å…·è°ƒç”¨é¡ºåºï¼Œå‰åç«¯å·¥å…·èƒ½å¤Ÿå®ç°ååŒå·¥ä½œï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°å®Œæ•´çš„å·¥å…·è°ƒç”¨é“¾è·¯ã€‚

**4 å°ç»“**
========

æœ¬æ–‡ä»‹ç»äº†AG-UI Toolså³AG-UIçš„å·¥å…·ç³»ç»Ÿï¼Œæ¼”ç¤ºäº†ä¸€ä¸ªç»“åˆå‰åç«¯å·¥å…·ä½¿ç”¨çš„æ··åˆæ¨¡å¼æ¡ˆä¾‹ï¼Œé€šè¿‡æ¡ˆä¾‹å¯ä»¥äº†è§£å¦‚ä½•åœ¨AG-UIä¸­è°ƒç”¨å·¥å…·å¹¶è§‚å¯Ÿè°ƒç”¨é“¾ã€‚

ç¤ºä¾‹æºç 
====

GitHub:Â [https://github.com/EdisonTalk/MAFD](https://github.com/EdisonTalk/MAFD)

å‚è€ƒèµ„æ–™
====

åœ£æ°ï¼Œã€Š[.NET + AI æ™ºèƒ½ä½“å¼€å‘è¿›é˜¶](https://www.cnblogs.com/sheng-jie/p/19200934)ã€‹ï¼ˆæ¨èæŒ‡æ•°ï¼šâ˜…â˜…â˜…â˜…â˜…ï¼‰

Microsoft Learnï¼Œã€Š[Agent Framework Tutorials](https://learn.microsoft.com/en-us/agent-framework/overview/agent-framework-overview?wt.mc_id=MVP_397012)ã€‹

![](https://images.cnblogs.com/cnblogs_com/edisonchou/1647700/o_200902144330EdisonTalk-Footer.jpg)

ä½œè€…ï¼šçˆ±è¿ªç”Ÿ

å‡ºå¤„ï¼š[https://edisontalk.cnblogs.com](https://edisontalk.cnblogs.com "from")

æœ¬æ–‡ç‰ˆæƒå½’ä½œè€…å’Œåšå®¢å›­å…±æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œä¸”åœ¨æ–‡ç« é¡µé¢æ˜æ˜¾ä½ç½®ç»™å‡ºåŸæ–‡é“¾æ¥ã€‚

[![](http://service.t.sina.com.cn/widget/qmd/2068032061/d643d182/10.png)](https://weibo.com/u/2068032061?s=6uyXnP)