---
layout: post
title: '[python] Pythonæ•°æ®ç±»ä½¿ç”¨æŒ‡åŒ—'
date: "2025-11-26T00:42:44Z"
---
\[python\] Pythonæ•°æ®ç±»ä½¿ç”¨æŒ‡åŒ—
========================

åœ¨Pythonç¼–ç¨‹ä¸­ï¼Œç±»å®šä¹‰æ˜¯ç»„ç»‡æ•°æ®ä¸å°è£…é€»è¾‘çš„æ ¸å¿ƒèŒƒå¼ã€‚ç„¶è€Œï¼Œå½“éœ€è¦åˆ›å»ºä»…ç”¨äºæ•°æ®å­˜å‚¨çš„ç®€å•ç±»æ—¶ï¼Œå¼€å‘è€…å¾€å¾€éœ€ç¼–å†™å¤§é‡é‡å¤æœºæ¢°çš„æ ·æ¿ä»£ç ã€‚ä¾‹å¦‚ç”¨äºå±æ€§åˆå§‹åŒ–çš„`__init__`æ–¹æ³•ã€æ”¯æŒå¯¹è±¡ä¿¡æ¯å‹å¥½å±•ç¤ºçš„`__repr__`æ–¹æ³•ã€å®ç°å¯¹è±¡ç›¸ç­‰æ€§æ¯”è¾ƒçš„`__eq__`æ–¹æ³•ç­‰ã€‚è¿™ç±»ä»£ç ä¸ä»…è€—è´¹å¼€å‘ç²¾åŠ›ï¼Œè¿˜å®¹æ˜“å› ç»†èŠ‚ç–å¿½å¼•å…¥æ½œåœ¨é”™è¯¯ï¼Œå¯¼è‡´ä»£ç å¯è¯»æ€§ä¸ç»´æŠ¤æ€§ä¸‹é™ã€‚

ä¸ºè§£å†³è¿™ä¸€è¡Œä¸šç—›ç‚¹ï¼ŒPython 3.7å¼•å…¥äº†`dataclasses`æ¨¡å—ï¼Œå…¶æä¾›çš„`@dataclass`è£…é¥°å™¨å ªç§°æ•°æ®ç±»å¼€å‘çš„é«˜æ•ˆç¼–ç¨‹åˆ©å™¨ã€‚è¯¥è£…é¥°å™¨èƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä¸Šè¿°å¸¸ç”¨é­”æœ¯æ–¹æ³•ï¼Œè®©å¼€å‘è€…æ— éœ€å…³æ³¨å†—ä½™çš„åº•å±‚å®ç°ï¼Œä»…éœ€èšç„¦æ ¸å¿ƒå±æ€§å®šä¹‰ï¼Œå³å¯å¿«é€Ÿæ„å»ºå‡ºåŠŸèƒ½å®Œå¤‡ã€æ˜“ç”¨æ€§é«˜çš„æ•°æ®ç±»ã€‚

![](https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20Python%E6%95%B0%E6%8D%AE%E7%B1%BB%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8C%97/imgs/demo.jpg)

æœ¬æ–‡å°†ä»åŸºç¡€æ¦‚å¿µåˆ‡å…¥ï¼Œç»“åˆå®é™…æ¡ˆä¾‹è¯¦ç»†æ‹†è§£`@dataclass`çš„æ ¸å¿ƒç”¨æ³•ã€‚

ç›®å½•

*   [1 åŸºç¡€ä½¿ç”¨](#1-åŸºç¡€ä½¿ç”¨)
    *   [1.1 åŸºç¡€æ–¹æ³•](#11-åŸºç¡€æ–¹æ³•)
    *   [1.2 è¿›é˜¶ä½¿ç”¨](#12-è¿›é˜¶ä½¿ç”¨)
*   [2 å‚è€ƒ](#2-å‚è€ƒ)

1 åŸºç¡€ä½¿ç”¨
======

1.1 åŸºç¡€æ–¹æ³•
--------

ä¼ ç»Ÿæ–¹å¼ä¸‹ï¼Œå®šä¹‰ä¸€ä¸ªç®€å•çš„æ•°æ®ç±»éœ€è¦æ‰‹åŠ¨ç¼–å†™å¤§é‡æ ·æ¿ä»£ç ï¼š

    class Person:
        def __init__(self, name: str, age: int, email: str = "unknown@example.com"):
            self.name = name
            self.age = age
            self.email = email
        
        def __repr__(self):
            return f"Person(name='{self.name}', age={self.age}, email='{self.email}')"
        
        def __eq__(self, other):
            if not isinstance(other, Person):
                return False
            return (self.name == other.name and 
                    self.age == other.age and 
                    self.email == other.email)
    
    # ä½¿ç”¨ç¤ºä¾‹
    p1 = Person("Alice", 25)
    p2 = Person("Bob", 30, "bob@example.com")
    
    print(p1)
    print(p1 == Person("Alice", 25))
    

å€ŸåŠ©`@dataclass`è£…é¥°å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æå°‘çš„ä»£ç å®ç°ç›¸åŒåŠŸèƒ½ï¼š

    from dataclasses import dataclass
    
    @dataclass
    class Person:
        name: str
        age: int
        email: str = "unknown@example.com"  # é»˜è®¤å€¼
    
    # ä½¿ç”¨ç¤ºä¾‹
    p1 = Person("Alice", 25)
    p2 = Person("Bob", 30, "bob@example.com")
    
    print(p1)
    print(p1 == Person("Alice", 25))
    

`@dataclass`é»˜è®¤ä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆä»¥ä¸‹æ–¹æ³•ï¼š

*   `__init__`ï¼šåˆå§‹åŒ–æ–¹æ³•ï¼Œæ ¹æ®å®šä¹‰çš„å­—æ®µåˆ›å»ºå®ä¾‹ï¼›
*   `__repr__`ï¼š æä¾›å‹å¥½çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œä¾¿äºè°ƒè¯•å’Œæ—¥å¿—è®°å½•ï¼›
*   `__eq__`ï¼š åŸºäºå­—æ®µå€¼çš„ç›¸ç­‰æ€§æ¯”è¾ƒï¼›
*   `__hash__`ï¼š é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰€æœ‰å­—æ®µéƒ½æ˜¯ä¸å¯å˜ç±»å‹ï¼Œåˆ™ç”Ÿæˆå“ˆå¸Œæ–¹æ³•ï¼ˆå¯é€šè¿‡`unsafe_hash`å‚æ•°æ§åˆ¶ï¼‰ã€‚

è¿˜å¯ä»¥åœ¨æ•°æ®ç±»ä¸­æ·»åŠ è‡ªå®šä¹‰æ–¹æ³•å’Œ`@property`è®¡ç®—å±æ€§ï¼Œå…¼é¡¾æ•°æ®å­˜å‚¨ä¸ç®€å•ä¸šåŠ¡é€»è¾‘ï¼š

    from dataclasses import dataclass
    from datetime import datetime
    
    @dataclass
    class Person:
        name: str
        age: int 
        email: str = "unknown@example.com"  # é»˜è®¤å€¼
        
        # è‡ªå®šä¹‰æ–¹æ³•ï¼šæ‰“æ‹›å‘¼
        def greet(self) -> str:
            """è¿”å›ä¸€ä¸ªä¸ªæ€§åŒ–çš„é—®å€™è¯­"""
            return f"Hello, my name is {self.name} and I'm {self.age} years old!"
        
        # è‡ªå®šä¹‰æ–¹æ³•ï¼šæ£€æŸ¥æ˜¯å¦æˆå¹´
        def is_adult(self) -> bool:
            """åˆ¤æ–­æ˜¯å¦è¾¾åˆ°æˆå¹´å¹´é¾„ï¼ˆ18å²ï¼‰"""
            return self.age >= 18
        
        # @propertyè®¡ç®—å±æ€§ï¼šå‡ºç”Ÿå¹´ä»½ï¼ˆåŸºäºå½“å‰å¹´é¾„æ¨ç®—ï¼‰
        @property
        def birth_year(self) -> int:
            """æ ¹æ®å½“å‰å¹´é¾„å’Œå¹´ä»½ï¼Œè®¡ç®—å‡ºç”Ÿå¹´ä»½"""
            current_year = datetime.now().year
            return current_year - self.age
    
    # ä½¿ç”¨ç¤ºä¾‹
    p1 = Person("Alice", 25)
    p2 = Person("Bob", 17, "bob@example.com")
    
    # åŸæœ‰åŠŸèƒ½ä¿æŒä¸å˜
    print(p1)
    print(p1 == Person("Alice", 25))
    
    # è°ƒç”¨è‡ªå®šä¹‰æ–¹æ³•
    print(p1.greet())          # è¾“å‡º: Hello, my name is Alice and I'm 25 years old!
    print(f"Alice is adult? {p1.is_adult()}")  # è¾“å‡º: Alice is adult? True
    print(f"Bob is adult? {p2.is_adult()}")    # è¾“å‡º: Bob is adult? False
    
    # è®¿é—®è®¡ç®—å±æ€§ï¼ˆåƒè®¿é—®æ™®é€šå±æ€§ä¸€æ ·ï¼‰
    print(f"Alice was born in {p1.birth_year}")  
    

1.2 è¿›é˜¶ä½¿ç”¨
--------

`@dataclass`çš„å¼ºå¤§ä¹‹å¤„ä¸ä»…åœ¨äºç®€åŒ–åŸºç¡€ä»£ç ï¼Œæ›´åœ¨äºæ”¯æŒå¤æ‚åœºæ™¯çš„å®šåˆ¶åŒ–å¼€å‘ã€‚å€ŸåŠ©å®ƒæä¾›çš„é…ç½®å‡½æ•°æˆ–å‚æ•°è®¾å®šï¼Œæˆ‘ä»¬èƒ½è§£å†³å¯å˜ç±»å‹é»˜è®¤å€¼ã€å­—æ®µå®šåˆ¶åŒ–è¿™ç±»é—®é¢˜ï¼Œç”šè‡³ç»“åˆè‡ªå®šä¹‰æ–¹æ³•è½åœ°ä¸šåŠ¡é€»è¾‘ã€‚æœ¬èŠ‚å†…å®¹å°†é’ˆå¯¹è¿™äº›æ ¸å¿ƒèƒ½åŠ›å±•å¼€å…·ä½“è§£æï¼Œè‹¥éœ€è¿›ä¸€æ­¥çš„å»¶å±•å­¦ä¹ ï¼Œå¯å‚è€ƒï¼š[Data Classes: @dataclass Decorator](https://www.krython.com/tutorial/python/data-classes-dataclass-decorator)ã€‚

**å¯å˜ç±»å‹çš„é»˜è®¤å€¼é™·é˜±**

åœ¨Pythonä¸­ï¼Œåˆ—è¡¨ã€å­—å…¸ç­‰å¯å˜å¯¹è±¡ä¸é€‚åˆä½œä¸ºå‡½æ•°æˆ–æ–¹æ³•çš„é»˜è®¤å‚æ•°ã€‚è¿™æ˜¯å› ä¸ºé»˜è®¤å‚æ•°çš„å€¼æ˜¯åœ¨å‡½æ•°å®šä¹‰æ—¶è®¡ç®—å¹¶åˆå§‹åŒ–çš„ï¼Œè€Œéæ¯æ¬¡è°ƒç”¨æ—¶ã€‚è¿™æ„å‘³ç€ï¼Œæ‰€æœ‰å‡½æ•°è°ƒç”¨éƒ½ä¼šå…±äº«åŒä¸€ä¸ªå¯å˜å¯¹è±¡å®ä¾‹ï¼Œä»è€Œå¯¼è‡´æ„å¤–çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼š

    # é”™è¯¯ç¤ºä¾‹ï¼šæ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€ä¸ªåˆ—è¡¨
    class BadPerson:
        def __init__(self, name: str, hobbies: list = []):  # å±é™©ï¼
            self.name = name
            self.hobbies = hobbies
    
    p1 = BadPerson("Alice")
    p1.hobbies.append("reading")
    p2 = BadPerson("Bob")
    print(p2.hobbies)  # è¾“å‡º['reading']â€”â€”p2æ„å¤–å…±äº«äº†p1çš„åˆ—è¡¨ï¼
    

`dataclasses`æ¨¡å—çš„fieldå‡½æ•°å¯é€šè¿‡default\_factoryå‚æ•°æŒ‡å®šé»˜è®¤å€¼ç”Ÿæˆçš„å·¥å‚å‡½æ•°ï¼Œä¸ºå¯å˜ç±»å‹é»˜è®¤å€¼é—®é¢˜æä¾›å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼š

    from dataclasses import dataclass, field  # å¯¼å…¥fieldå‡½æ•°
    
    @dataclass
    class GoodPerson:
        name: str
        # ä½¿ç”¨listä½œä¸ºå·¥å‚å‡½æ•°ï¼Œæ¯æ¬¡åˆ›å»ºå®ä¾‹æ—¶ç”Ÿæˆæ–°åˆ—è¡¨
        hobbies: list = field(default_factory=list)
    
    p1 = GoodPerson("Alice")
    p1.hobbies.append("reading")
    p2 = GoodPerson("Bob")
    print(p2.hobbies)  # è¾“å‡º[]ï¼Œæ¯ä¸ªå®ä¾‹æœ‰ç‹¬ç«‹çš„åˆ—è¡¨ï¼
    

`field`å‡½æ•°çš„æ ¸å¿ƒå‚æ•°ï¼š

*   `default_factory`ï¼šæŒ‡å®šä¸€ä¸ªæ— å‚å‡½æ•°ï¼ˆå·¥å‚å‡½æ•°ï¼‰ï¼Œç”¨äºç”Ÿæˆå­—æ®µçš„é»˜è®¤å€¼ï¼ˆå¦‚ `list`ã€`dict`ã€`lambda` æˆ–è‡ªå®šä¹‰å‡½æ•°ï¼‰ï¼›
*   `default`ï¼šæŒ‡å®šä¸å¯å˜ç±»å‹çš„é»˜è®¤å€¼ï¼ˆç­‰åŒäºç›´æ¥èµ‹å€¼ï¼Œå¦‚ `field(default=0)`ï¼‰ï¼›
*   `init=False`ï¼šè¡¨ç¤ºè¯¥å­—æ®µä¸å‚ä¸ `__init__` æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ï¼ˆéœ€æ‰‹åŠ¨èµ‹å€¼æˆ–é€šè¿‡å…¶ä»–æ–¹å¼åˆå§‹åŒ–ï¼‰ï¼›
*   `repr=False`ï¼šè¡¨ç¤ºè¯¥å­—æ®µä¸æ˜¾ç¤ºåœ¨ `__repr__` æ–¹æ³•çš„è¾“å‡ºä¸­ï¼›
*   `compare=False`ï¼šè¡¨ç¤ºè¯¥å­—æ®µä¸å‚ä¸ `__eq__` ç­‰æ¯”è¾ƒæ–¹æ³•çš„é€»è¾‘ã€‚

    from dataclasses import dataclass, field
    import uuid
    from datetime import date
    
    @dataclass
    class Book:
        """ä¸€ä¸ªè¡¨ç¤ºå›¾ä¹¦ä¿¡æ¯çš„æ•°æ®ç±»"""
        
        # å›¾ä¹¦çš„åŸºæœ¬ä¿¡æ¯ï¼Œåˆ›å»ºå®ä¾‹æ—¶å¿…é¡»æä¾›
        title: str          # ä¹¦å
        author: str         # ä½œè€…
        price: float        # ä»·æ ¼
        
        # å›¾ä¹¦çš„å”¯ä¸€æ ‡è¯†ï¼Œä½¿ç”¨UUIDè‡ªåŠ¨ç”Ÿæˆï¼Œæ¯”è¾ƒå¯¹è±¡æ—¶å¿½ç•¥æ­¤å­—æ®µ
        book_id: str = field(
            default_factory=lambda: str(uuid.uuid4())[:6],  # ç”Ÿæˆ6ä½çš„å”¯ä¸€ID
            compare=False                                   # æ¯”è¾ƒå¯¹è±¡æ—¶ä¸è€ƒè™‘è¿™ä¸ªå­—æ®µ
        )
        # å‡ºç‰ˆæ—¥æœŸï¼Œé»˜è®¤ä½¿ç”¨å½“å‰æ—¥æœŸï¼Œæ¯”è¾ƒå¯¹è±¡æ—¶å¿½ç•¥æ­¤å­—æ®µ
        publish_date: date = field(
            default_factory=date.today                     # é»˜è®¤ä½¿ç”¨ä»Šå¤©çš„æ—¥æœŸ
        )
        # å†…éƒ¨åº“å­˜ç¼–ç ï¼Œæœ‰é»˜è®¤å€¼ï¼Œæ‰“å°å¯¹è±¡æ—¶ä¸æ˜¾ç¤ºæ­¤å­—æ®µ
        inventory_code: str = field(
            default="N/A",                                  # é»˜è®¤å€¼ä¸º"N/A"
            compare=False,
            repr=False                                      # æ‰“å°å¯¹è±¡æ—¶ä¸æ˜¾ç¤ºè¿™ä¸ªå­—æ®µ
        )
    
    # åˆ›å»ºä¸¤æœ¬å†…å®¹ç›¸åŒçš„å›¾ä¹¦å®ä¾‹
    book1 = Book("Pythonç¼–ç¨‹", "å¼ ä¸‰", 59.90, inventory_code="PY-001")
    book2 = Book("Pythonç¼–ç¨‹", "å¼ ä¸‰", 59.90, inventory_code="PY-002")
    
    # æ‰“å°ç¬¬ä¸€æœ¬ä¹¦çš„ä¿¡æ¯ï¼ˆä¸ä¼šæ˜¾ç¤ºinventory_codeï¼‰
    print("ç¬¬ä¸€æœ¬ä¹¦ä¿¡æ¯:", book1)
    # æ¯”è¾ƒä¸¤æœ¬ä¹¦æ˜¯å¦ç›¸ç­‰ï¼ˆåªä¼šæ¯”è¾ƒtitle, author, priceï¼‰
    print("ä¸¤æœ¬ä¹¦æ˜¯å¦ç›¸ç­‰?", book1 == book2)
    
    # è®¿é—®è¢«éšè—çš„å­—æ®µ
    print("ç¬¬ä¸€æœ¬ä¹¦çš„åº“å­˜ç¼–ç :", book1.inventory_code)
    print("ç¬¬ä¸€æœ¬ä¹¦çš„ID:", book1.book_id)
    

**è¾…åŠ©å‡½æ•°**

é™¤äº†`field`è¾…åŠ©å‡½æ•°å¤–ï¼ŒPythonçš„`dataclasses`æ¨¡å—è¿˜æä¾›äº†ä¸€ç³»åˆ—å®ç”¨çš„å·¥å…·å‡½æ•°ä¸ç‰¹æ®Šç±»å‹ï¼Œæå¤§åœ°æ‰©å±•äº†æ•°æ®ç±»çš„çµæ´»æ€§ä¸åŠŸèƒ½æ€§ï¼š

*   `asdict()`ï¼šå°†æ•°æ®ç±»å®ä¾‹è½¬æ¢ä¸ºæ ‡å‡†å­—å…¸ï¼Œ
*   `astuple()`ï¼šå°†æ•°æ®ç±»å®ä¾‹è½¬æ¢ä¸ºå…ƒç»„ï¼Œ
*   `replace()`ï¼šåˆ›å»ºæ•°æ®ç±»å®ä¾‹çš„å‰¯æœ¬ï¼Œå¹¶æŒ‰éœ€æ›¿æ¢æŒ‡å®šå­—æ®µå€¼ï¼Œ
*   `fields()`ï¼šè·å–æ•°æ®ç±»çš„å­—æ®µå…ƒæ•°æ®ä¿¡æ¯ï¼Œ
*   `is_dataclass()`ï¼šåˆ¤æ–­å¯¹è±¡ï¼ˆç±»æˆ–å®ä¾‹ï¼‰æ˜¯å¦ä¸ºæ•°æ®ç±»ï¼Œ
*   `make_dataclass()`ï¼šåŠ¨æ€ç¼–ç¨‹æ–¹å¼åˆ›å»ºæ•°æ®ç±»ï¼ˆæ— éœ€è£…é¥°å™¨ï¼‰ï¼Œ
*   `InitVar`ï¼šæ ‡è®°ä»…ç”¨äº`__init__`åˆå§‹åŒ–çš„ä¸´æ—¶å˜é‡ï¼ˆä¸ä¼šæˆä¸ºå®ä¾‹å±æ€§ï¼‰ã€‚

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

    from dataclasses import (
        dataclass, asdict, astuple, replace, fields, 
        is_dataclass, make_dataclass, InitVar,field
    )
    
    # å®šä¹‰åŸºç¡€æ•°æ®ç±»ï¼ˆå«InitVaræ¼”ç¤ºï¼‰
    @dataclass
    class Person:
        name: str
        age: int
        # InitVaræ ‡è®°ï¼šaddressä»…ç”¨äºåˆå§‹åŒ–ï¼Œä¸ä¼šæˆä¸ºå®ä¾‹å±æ€§
        address: InitVar[str] = field(default="æœªçŸ¥åœ°å€")  # è®¾ç½®é»˜è®¤å€¼
    
        def __post_init__(self, address):
            # åˆ©ç”¨InitVarå‚æ•°åˆå§‹åŒ–å®ä¾‹å±æ€§
            self.full_info = f"{self.name} ({self.age}), åœ°å€: {address}"
    
    # åˆ›å»ºå®ä¾‹
    person = Person("Alice", 30, "123 Main St")
    
    # 1. asdict()ï¼šè½¬å­—å…¸
    print("asdictç»“æœ:", asdict(person))
    
    # 2. astuple()ï¼šè½¬å…ƒç»„
    print("astupleç»“æœ:", astuple(person))
    
    # 3. replace()ï¼šåˆ›å»ºå‰¯æœ¬å¹¶ä¿®æ”¹å­—æ®µ
    new_person = replace(person, age=31)
    print("replaceåçš„å®ä¾‹:", new_person)
    
    # 4. fields()ï¼šè·å–å­—æ®µä¿¡æ¯
    print("\nå­—æ®µä¿¡æ¯:")
    for field_info in fields(person):
        print(f"å­—æ®µå: {field_info.name}, ç±»å‹: {field_info.type}, æ˜¯å¦InitVar: {isinstance(field_info.type, InitVar)}")
    
    # 5. is_dataclass()ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºæ•°æ®ç±»
    print("\nis_dataclass(Person):", is_dataclass(Person))
    print("is_dataclass(person):", is_dataclass(person))
    print("is_dataclass(dict):", is_dataclass(dict))
    
    # 6. make_dataclass()ï¼šåŠ¨æ€åˆ›å»ºæ•°æ®ç±»
    DynamicPerson = make_dataclass(
        "DynamicPerson",  # ç±»å
        [("name", str), ("age", int)],  # å­—æ®µåˆ—è¡¨
        namespace={"greet": lambda self: f"Hello, {self.name}!"}  # é¢å¤–æ–¹æ³•/å±æ€§
    )
    dynamic_person = DynamicPerson("Bob", 25)
    print("\nåŠ¨æ€åˆ›å»ºçš„æ•°æ®ç±»å®ä¾‹:", dynamic_person)
    print("åŠ¨æ€ç±»æ–¹æ³•è°ƒç”¨:", dynamic_person.greet())
    

**åˆå§‹åŒ–åå¤„ç†**

åœ¨`dataclasses`æ¨¡å—ä¸­ï¼Œ`__post_init__`æ˜¯ä¸€ä¸ªé­”æœ¯æ–¹æ³•ï¼Œä¼šåœ¨è‡ªåŠ¨ç”Ÿæˆçš„`__init__`æ–¹æ³•æ‰§è¡Œå®Œæ¯•åç«‹å³è¢«è°ƒç”¨ï¼Œä¸»è¦ç”¨äºå®ç°åˆå§‹åŒ–åçš„è‡ªåŠ¨å¤„ç†é€»è¾‘ï¼ˆä¾‹å¦‚è®¡ç®—æ´¾ç”Ÿå­—æ®µã€è¡¥å……å±æ€§èµ‹å€¼ç­‰ï¼‰ï¼›å½“ä¸æŒ‡å®š`init=False`çš„å­—æ®µé…åˆä½¿ç”¨æ—¶ï¼Œè¯¥æ–¹æ³•å¯çµæ´»å¤„ç†æ— éœ€ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ä¼ å…¥ã€ä»…éœ€é€šè¿‡åˆå§‹åŒ–åé€»è¾‘ç”Ÿæˆçš„æ´¾ç”Ÿå±æ€§ã€‚

    from dataclasses import dataclass, field
    
    @dataclass
    class Product:
        name: str
        price: float
        quantity: int = 1
        total_price: float = field(init=False)  # æ€»ä»·ç”±å…¶ä»–å­—æ®µè®¡ç®—
        
        def __post_init__(self):
            """åˆå§‹åŒ–åè‡ªåŠ¨è®¡ç®—æ€»ä»·"""
            self.total_price = self.price * self.quantity
    
    # ä½¿ç”¨ç¤ºä¾‹
    apple = Product("Apple", 5.5, 10)
    banana = Product("Banana", 3.0)
    
    print(f"Apple total: ${apple.total_price}")  # è¾“å‡º: 55.0
    print(f"Banana total: ${banana.total_price}")  # è¾“å‡º: 3.0
    

**å­—æ®µé¡ºåºè¦æ±‚**

åœ¨å®šä¹‰`dataclass`ç±»å­—æ®µæ—¶ï¼Œæ— é»˜è®¤å€¼çš„å­—æ®µå¿…é¡»æ”¾åœ¨æœ‰é»˜è®¤å€¼çš„å­—æ®µä¹‹å‰ã€‚

*   é”™è¯¯å†™æ³•ï¼šå…ˆå£°æ˜å¸¦é»˜è®¤å€¼çš„`address`ï¼Œå†å£°æ˜æ— é»˜è®¤å€¼çš„`id` â†’ å¼•å‘è¯­æ³•é”™è¯¯ã€‚
*   æ­£ç¡®å†™æ³•ï¼šå…ˆå£°æ˜æ— é»˜è®¤å€¼çš„`id`ï¼Œå†å£°æ˜å¸¦é»˜è®¤å€¼çš„`address` â†’ æ­£å¸¸è¿è¡Œã€‚

è¿™å¹¶é`dataclass`çš„ä¸“å±é™åˆ¶ï¼Œè€Œæ˜¯Pythonè¯­è¨€çš„åŸºç¡€è¯­æ³•è§„åˆ™ã€‚

`@dataclass`è£…é¥°å™¨çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œæ˜¯æ ¹æ®ç±»ä¸­å®šä¹‰çš„å­—æ®µï¼Œè‡ªåŠ¨ç”Ÿæˆ`__init__`æ„é€ æ–¹æ³•ã€‚

*   å½“ä½ è¿™æ ·å†™ï¼š
    
        @dataclass
        class InvalidFieldOrder:
            address: str = "Beijing"
            id: int
        
    
    å®ƒä¼šå°è¯•ç”Ÿæˆè¿™æ ·çš„`__init__`ï¼š
    
        def __init__(self, address: str = "Beijing", id: int):
            ...
        
    

ä½†è¿™åœ¨Pythonä¸­**æ˜¯å®Œå…¨ä¸å…è®¸çš„**ï¼å‡½æ•°å®šä¹‰æ—¶ï¼Œå¸¦é»˜è®¤å€¼çš„å‚æ•°ï¼ˆå¯é€‰å‚æ•°ï¼‰ä¸èƒ½å‡ºç°åœ¨æ— é»˜è®¤å€¼çš„å‚æ•°ï¼ˆå¿…å¡«å‚æ•°ï¼‰ä¹‹å‰ã€‚

*   è€Œæ­£ç¡®çš„å†™æ³•ï¼š
    
        @dataclass
        class ValidFieldOrder:
            id: int
            address: str = "Beijing"
        
    
    ä¼šç”Ÿæˆåˆæ³•çš„ `__init__`ï¼š
    
        def __init__(self, id: int, address: str = "Beijing"):
            ...
        
    

è¿™å®Œå…¨ç¬¦åˆPythonçš„è¯­æ³•è§„èŒƒï¼šå¿…å¡«å‚æ•°åœ¨å‰ï¼Œå¯é€‰å‚æ•°åœ¨åã€‚

**æ•°æ®ç±»ç»§æ‰¿**

æ•°æ®ç±»æ—¢å¯ä»¥ä½œä¸ºçˆ¶ç±»è¢«å…¶ä»–æ•°æ®ç±»ç»§æ‰¿ï¼Œä¹Ÿå¯ä»¥è¢«æ™®é€šPythonç±»ç»§æ‰¿ï¼šå½“æ•°æ®ç±»ç»§æ‰¿å¦ä¸€ä¸ªæ•°æ®ç±»æ—¶ï¼Œå­ç±»ä¼šè‡ªåŠ¨åˆå¹¶çˆ¶ç±»çš„å­—æ®µï¼›è€Œæ™®é€šç±»ç»§æ‰¿æ•°æ®ç±»æ—¶ï¼Œè‹¥éœ€ä½¿ç”¨çˆ¶ç±»çš„å­—æ®µå’Œæ„é€ é€»è¾‘ï¼Œåˆ™å¿…é¡»æ‰‹åŠ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°å¹¶å¤„ç†ç›¸å…³å‚æ•°ã€‚

    from dataclasses import dataclass
    
    # ğŸŸ¡ åŸºç±»ï¼šå½¢çŠ¶ï¼ˆæ•°æ®ç±»ï¼‰
    @dataclass
    class Shape:
        color: str
    
    # ğŸŸ¦ å­ç±»ï¼šæ­£æ–¹å½¢ï¼ˆæ•°æ®ç±»ï¼‰
    @dataclass
    class Square(Shape):
        side_length: float = 1.0  # é»˜è®¤è¾¹é•¿ä¸º1
    
    # ğŸŸ¢ å­ç±»ï¼šåœ†å½¢ï¼ˆæ™®é€šç±»ï¼Œä¸æ˜¯æ•°æ®ç±»ï¼‰
    class Circle(Shape):
        def __init__(self, color: str, radius: float = 1.0):
            # å¿…é¡»æ‰‹åŠ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ– color
            super().__init__(color)
            self.radius = radius
        
        # å¦‚æœéœ€è¦å‹å¥½çš„æ‰“å°æ ¼å¼ï¼Œå¿…é¡»è‡ªå·±å®ç° __repr__ æ–¹æ³•
        def __repr__(self):
            return f"Circle(color='{self.color}', radius={self.radius})"
    
    # ä½¿ç”¨ç¤ºä¾‹
    red_square = Square("red")
    print(red_square) 
    
    blue_circle = Circle("blue", 5.0)
    print(blue_circle) 
    
    default_circle = Circle("green")
    print(default_circle) 
    

**@dataclassè£…é¥°å™¨å‚æ•°è¯¦è§£**

`@dataclass`è£…é¥°å™¨æä¾›äº†å¤šä¸ªå¯çµæ´»é…ç½®çš„å‚æ•°ï¼Œé€‚é…å„ç±»å¼€å‘åœºæ™¯ã€‚ä»¥ä¸‹ä¸ºæ ¸å¿ƒå‚æ•°çš„è¯¦ç»†è¯´æ˜ï¼Œæ¶µç›–åŠŸèƒ½ä½œç”¨ã€ä½¿ç”¨çº¦æŸåŠç‰ˆæœ¬è¦æ±‚ï¼š

1.  `init=True`
    
    *   æ§åˆ¶æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ `__init__()` æ–¹æ³•ã€‚
    *   å¦‚æœè®¾ä¸º `False`ï¼Œä½ éœ€è¦è‡ªå·±å®šä¹‰ `__init__` æ–¹æ³•ã€‚
2.  `repr=True`
    
    *   æ§åˆ¶æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ `__repr__()` æ–¹æ³•ã€‚
    *   ç”Ÿæˆçš„ `repr` ä¼šåŒ…å«ç±»åå’Œæ‰€æœ‰å­—æ®µåŠå…¶å€¼ã€‚
3.  `eq=True`
    
    *   æ§åˆ¶æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ `__eq__()` æ–¹æ³•ã€‚
    *   åŸºäºç±»çš„å­—æ®µå€¼è¿›è¡Œç›¸ç­‰æ€§æ¯”è¾ƒã€‚
4.  `order=False`
    
    *   æ§åˆ¶æ˜¯å¦ç”Ÿæˆæ¯”è¾ƒè¿ç®—ç¬¦æ–¹æ³• (`__lt__`, `__le__`, `__gt__`, `__ge__`)ã€‚
    *   è®¾ä¸º `True` æ—¶ï¼Œä¼šæ ¹æ®å­—æ®µå®šä¹‰çš„é¡ºåºè¿›è¡Œæ¯”è¾ƒã€‚
    *   æ³¨æ„ï¼šè®¾ç½® `order=True` æ—¶ï¼Œ`eq` å¿…é¡»ä¸º `True`ï¼ˆé»˜è®¤ï¼‰ã€‚
5.  `unsafe_hash=False`
    
    *   æ§åˆ¶æ˜¯å¦ç”Ÿæˆ `__hash__()` æ–¹æ³•ã€‚
    *   é»˜è®¤æƒ…å†µä¸‹ï¼š
        *   å¦‚æœ `frozen=True`ï¼Œä¼šç”ŸæˆåŸºäºå­—æ®µçš„ `__hash__`
        *   å¦‚æœ `frozen=False`ï¼Œ`__hash__` ä¼šè¢«è®¾ä¸º `None`
    *   è®¾ä¸º `True` ä¼šå¼ºåˆ¶ç”Ÿæˆ `__hash__`ï¼Œä½†åœ¨å®ä¾‹å¯å˜æ—¶ä½¿ç”¨å¯èƒ½å¯¼è‡´é—®é¢˜ã€‚
6.  `frozen=False`
    
    *   å¦‚æœè®¾ä¸º `True`ï¼Œä¼šåˆ›å»ºä¸€ä¸ªâ€œå†»ç»“â€çš„ç±»ï¼Œå®ä¾‹å±æ€§æ— æ³•è¢«ä¿®æ”¹ã€‚
    *   å°è¯•ä¿®æ”¹ä¼šæŠ›å‡º `dataclasses.FrozenInstanceError`ã€‚
7.  `match_args=True` (Python 3.10+)
    
    *   æ§åˆ¶æ˜¯å¦ç”Ÿæˆ `__match_args__` å±æ€§ï¼Œç”¨äºæ¨¡å¼åŒ¹é…ã€‚
8.  `kw_only=False` (Python 3.10+)
    
    *   å¦‚æœè®¾ä¸º`True`ï¼Œæ‰€æœ‰å­—æ®µéƒ½å°†æˆä¸ºå…³é”®å­—å‚æ•°ï¼Œå®ä¾‹åŒ–æ—¶å¿…é¡»é€šè¿‡å…³é”®å­—å½¢å¼ä¼ å‚ï¼Œä¸èƒ½ä½¿ç”¨ä½ç½®å‚æ•°ã€‚
9.  `slots=False` (Python 3.10+)
    
    *   å¦‚æœè®¾ä¸º `True`ï¼Œä¼šç”Ÿæˆ `__slots__` å±æ€§ï¼Œèƒ½é™åˆ¶ç±»å®ä¾‹åªèƒ½æ‹¥æœ‰é¢„å®šä¹‰çš„å±æ€§ï¼ŒåŒæ—¶èŠ‚çœå†…å­˜å¹¶æé«˜å±æ€§è®¿é—®é€Ÿåº¦ã€‚
10.  `weakref_slot=False` (Python 3.11+)
     
     *   å½“ `slots=True` æ—¶ï¼Œå¦‚æœè®¾ä¸º `True`ï¼Œä¼šæ·»åŠ ä¸€ä¸ªç”¨äºå¼±å¼•ç”¨çš„æ§½ä½ã€‚

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

    from dataclasses import dataclass, FrozenInstanceError
    import weakref
    
    # 1. init=False ç¤ºä¾‹
    @dataclass(init=False)
    class Person:
        name: str
        age: int
        
        # æ‰‹åŠ¨å®šä¹‰ __init__ æ–¹æ³•
        def __init__(self, name):
            self.name = name
            self.age = 0  # è®¾ç½®é»˜è®¤å¹´é¾„
    
    # 2. repr=False ç¤ºä¾‹
    @dataclass(repr=False)
    class Point:
        x: int
        y: int
        
        # è‡ªå®šä¹‰ repr
        def __repr__(self):
            return f"Point at ({self.x}, {self.y})"
    
    # 3. eq=Trueç¤ºä¾‹
    @dataclass(eq=True)
    class Product:
        id: int
        name: str
    
    # 4. order=True ç¤ºä¾‹
    @dataclass(order=True)
    class Student:
        score: int
        name: str
    
    # 5. unsafe_hash=True ç¤ºä¾‹
    @dataclass(unsafe_hash=True)
    class Book:
        title: str
        author: str
    
    # 6. frozen=True ç¤ºä¾‹
    @dataclass(frozen=True)
    class ImmutablePoint:
        x: int
        y: int
    
    # 7. match_args=True ç¤ºä¾‹ (Python 3.10+)
    @dataclass(match_args=True)
    class Shape:
        type: str
        size: int
    
    # 8. kw_only=True ç¤ºä¾‹ (Python 3.10+)
    @dataclass(kw_only=True)
    class Car:
        brand: str
        model: str
    
    # 9. slots=True ç¤ºä¾‹ (Python 3.10+)
    @dataclass(slots=True)
    class User:
        id: int
        username: str
    
    # 10. weakref_slot=True ç¤ºä¾‹ (Python 3.11+)
    @dataclass(slots=True, weakref_slot=True)
    class Node:
        value: int
    
    # æµ‹è¯•ä»£ç 
    if __name__ == "__main__":
        # 1. æµ‹è¯• init=False
        p = Person("Alice")
        print(f"1. Person: {p.name}, {p.age}")
        
        # 2. æµ‹è¯• repr=False
        point = Point(3, 4)
        print(f"2. Point: {point}")
        
        # 3. æµ‹è¯• eq=True
        p1 = Product(1, "Apple")
        p2 = Product(1, "Apple")
        print(f"3. Products equal? {p1 == p2}")
        
        # 4. æµ‹è¯• order=True
        s1 = Student(90, "Bob")
        s2 = Student(85, "Alice")
        print(f"4. s1 > s2? {s1 > s2}") # æŒ‰ç…§å‚æ•°å®šä¹‰é¡ºåºæ¯”è¾ƒ
        
        # 5. æµ‹è¯• unsafe_hash=True
        book = Book("Python", "Guido")
        print(f"5. Book hash: {hash(book)}")
        
        # 6. æµ‹è¯• frozen=True
        immutable_point = ImmutablePoint(1, 2)
        try:
            immutable_point.x = 3
        except FrozenInstanceError as e:
            print(f"6. Frozen error: {e}")
        
        # 7. æµ‹è¯• match_args=True (Python 3.10+)
        shape = Shape("circle", 5)
        match shape:
            case Shape("circle", size):
                print(f"7. Circle with size {size}")
            case Shape("square", size):
                print(f"7. Square with size {size}")
        
        # 8. æµ‹è¯• kw_only=True
        car = Car(brand="Toyota", model="Camry")
        print(f"8. Car: {car}")
        
        # 9. æµ‹è¯• slots=True
        user = User(1, "admin")
        print(f"9. User: {user}")
        try:
            user.email = "admin@example.com"
        except AttributeError as e:
            print(f"9. Slots error: {e}")
        
        # 10. æµ‹è¯• weakref_slot=True
        node = Node(10)
        ref = weakref.ref(node)
        print(f"10. Weakref node value: {ref().value}")
    

2 å‚è€ƒ
====

*   [Data Classes: @dataclass Decorator](https://www.krython.com/tutorial/python/data-classes-dataclass-decorator)

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š[è½ç—•çš„å¯’å‡](https://www.cnblogs.com/luohenyueji/)ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/luohenyueji/p/19269848](https://www.cnblogs.com/luohenyueji/p/19269848)

![](https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/wechat/content/%E5%8A%A0%E6%B2%B9%E9%B8%AD.gif)