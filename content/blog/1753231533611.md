---
layout: post
title: 'C#è§£æJSONæ•°æ®å…¨æ”»ç•¥'
date: "2025-07-23T00:45:33Z"
---
C#è§£æJSONæ•°æ®å…¨æ”»ç•¥
=============

æœ¬æ–‡è¯¦ç»†ä»‹ç»C#ä¸­è·å–å’Œè§£æJSONæ•°æ®çš„å®Œæ•´æµç¨‹ï¼Œæ¶µç›–HttpClientç½‘ç»œè¯·æ±‚ã€System.Text.JsonåŠ¨æ€è§£æä¸å¼ºç±»å‹è½¬æ¢æŠ€æœ¯ï¼Œæä¾›æ—¥æœŸæ ¼å¼å¤„ç†å’Œç©ºå€¼é˜²èŒƒç­‰å®ç”¨æŠ€å·§ï¼Œå¹¶é™„èµ å¯è¿è¡Œä»£ç ç¤ºä¾‹

è¿˜åœ¨ä¸ºC#å¤„ç†ç½‘ç»œAPIè¿”å›çš„å¤æ‚JSONæ•°æ®å¤´ç–¼å—ï¼Ÿ**æ®ç»Ÿè®¡**ï¼Œ90%çš„å¼€å‘è€…éƒ½æ›¾åœ¨JSONè§£æä¸Šæ ½è¿‡è·Ÿå¤´ï¼

æœ¬æ–‡å°†æ‰‹æŠŠæ‰‹æ•™ä½ ç”¨C#è½»æ¾ç©è½¬JSONæ•°æ®ï¼š  
\- HttpClientè·å–ç½‘ç»œJSONæ•°æ®  
\- System.Text.JsonåŠ¨æ€è§£ææŠ€å·§  
\- å¼ºç±»å‹æ¨¡å‹è½¬æ¢å®æˆ˜  
\- ç‰¹æ®Šå­—ç¬¦/æ—¥æœŸæ ¼å¼å¤„ç†æ–¹æ¡ˆ  
\- å®Œæ•´å¯è¿è¡Œä»£ç ç¤ºä¾‹

ğŸ” ä¸€ã€ä¸ºä»€ä¹ˆJSONæ˜¯C#å¼€å‘å¿…ä¿®è¯¾ï¼Ÿ
---------------------

ç°ä»£Web APIä¸­**95%çš„æ•°æ®äº¤æ¢**é‡‡ç”¨JSONæ ¼å¼ã€‚æ— è®ºæ˜¯è°ƒç”¨å¤©æ°”APIã€æ”¯ä»˜æ¥å£ï¼Œè¿˜æ˜¯å¤„ç†äº‘æœåŠ¡è¿”å›æ•°æ®ï¼ŒJSONè§£æéƒ½æ˜¯æ ¸å¿ƒæŠ€èƒ½ï¼

âš™ï¸ äºŒã€å››æ­¥æå®šç½‘ç»œJSONæ•°æ®
-----------------

### 1\. è·å–æ•°æ® - HttpClientæœ€ä½³å®è·µ

    using var httpClient = new HttpClient();
    var response = await httpClient.GetAsync("https://api.example.com/data");
    var jsonString = await response.Content.ReadAsStringAsync();

**å…³é”®ç‚¹ï¼š**ä½¿ç”¨usingè‡ªåŠ¨é‡Šæ”¾èµ„æºï¼Œå¼‚æ­¥æ–¹æ³•æå‡æ€§èƒ½

### 2\. åŠ¨æ€è§£æ - å¿«é€Ÿè¯»å–å­—æ®µ

    using System.Text.Json;
    var jsonDoc = JsonDocument.Parse(jsonString);
    string name = jsonDoc.RootElement
                    .GetProperty("user")
                    .GetProperty("name")
                    .GetString();

**é€‚ç”¨åœºæ™¯ï¼š**å¿«é€Ÿæå–å°‘é‡å­—æ®µï¼Œæ— éœ€åˆ›å»ºå®Œæ•´æ¨¡å‹

### 3\. å¼ºç±»å‹è§£æ - æ¨èæ–¹æ¡ˆï¼

    public class User {
        public string Name { get; set; }
        public int Age { get; set; }
        public DateTime RegisterDate { get; set; }
    }
    
    var user = JsonSerializer.Deserialize<User>(jsonString, new JsonSerializerOptions {
        PropertyNameCaseInsensitive = true // å¿½ç•¥å¤§å°å†™
    });

**ä¼˜åŠ¿ï¼š**ç¼–è¯‘æ—¶æ£€æŸ¥ + æ™ºèƒ½æç¤º + é«˜å¯ç»´æŠ¤æ€§

### 4\. ç‰¹æ®Šåœºæ™¯å¤„ç†

\- æ—¥æœŸæ ¼å¼è½¬æ¢ï¼š

    options.Converters.Add(new DateTimeConverter("yyyy-MM-dd"));

\- å¤„ç†JSONæ³¨é‡Šï¼š

    options.ReadCommentHandling = JsonCommentHandling.Skip;

ğŸš¨ ä¸‰ã€é¿å‘æŒ‡å—
---------

\- **NULLå¼•ç”¨å¼‚å¸¸ï¼š**ç»™å±æ€§è®¾ç½®é»˜è®¤å€¼ `public string Name { get; set; } = string.Empty;`

\- **å­—æ®µç¼ºå¤±ï¼š**ä½¿ç”¨`[JsonIgnore]`å¿½ç•¥ä¸å­˜åœ¨çš„å±æ€§

\- **æ€§èƒ½é™·é˜±ï¼š**å¤§æ–‡ä»¶è§£æç”¨`JsonDocument`æ›¿ä»£`JObject`

ğŸ’» å››ã€å®Œæ•´ä»£ç ç¤ºä¾‹
-----------

    using System.Text.Json;
    
    public async Task<WeatherData> GetWeatherAsync() {
        using var httpClient = new HttpClient();
        
        // è·å–æ­å·å¤©æ°”æ•°æ®
        var response = await httpClient.GetAsync(
            "https://api.weather.com/v3?location=hangzhou");
        
        response.EnsureSuccessStatusCode();
        var json = await response.Content.ReadAsStringAsync();
        
        // å¼ºç±»å‹è§£æ
        return JsonSerializer.Deserialize<WeatherData>(json, new JsonSerializerOptions {
            PropertyNameCaseInsensitive = true,
            NumberHandling = JsonNumberHandling.AllowReadingFromString
        });
    }
    
    // å®šä¹‰æ•°æ®æ¨¡å‹
    public class WeatherData {
        public string Location { get; set; } = string.Empty;
        public double Temperature { get; set; }
        public string Unit { get; set; } = "Celsius";
        [JsonPropertyName("wind_speed")]
        public double WindSpeed { get; set; }
    }

å–œæ¬¢æœ¬æ–‡ï¼Ÿç‚¹èµğŸ‘æ”¶è—â­ï¼Œå…³æ³¨æˆ‘ï¼Œä¸€èµ·å­¦ä¹ æ›´å¤šæœ‰ç”¨çš„çŸ¥è¯†ï¼Œå®Œå–„ä½ çš„æŠ€èƒ½æ ‘ï¼