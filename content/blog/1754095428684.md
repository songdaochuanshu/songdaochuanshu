---
layout: post
title: 'åŸºäºé˜¿é‡Œäº‘RDS SQL Server + å‡½æ•°è®¡ç®— + é€šä¹‰AIæ„å»ºæ™ºèƒ½é”€å”®åˆ†æå¹³å°Demo'
date: "2025-08-02T00:43:48Z"
---
åŸºäºé˜¿é‡Œäº‘RDS SQL Server + å‡½æ•°è®¡ç®— + é€šä¹‰AIæ„å»ºæ™ºèƒ½é”€å”®åˆ†æå¹³å°Demo
===============================================

â€ƒâ€ƒéšç€äº‘åŸç”ŸæŠ€æœ¯å’ŒAIèƒ½åŠ›çš„ä¸æ–­æˆç†Ÿï¼Œå¦‚ä½•å°†ä¼ ç»Ÿæ•°æ®åº“ã€æ— æœåŠ¡å™¨è®¡ç®—å’Œäººå·¥æ™ºèƒ½æœ‰æœºç»“åˆï¼Œæ„å»ºç°ä»£åŒ–çš„æ•°æ®åˆ†æå¹³å°ï¼Œå¹¶å€ŸåŠ©é˜¿é‡Œäº‘æä¾›çš„åŸºç¡€ç»„ä»¶æ„å»ºåº”ç”¨ã€‚æœ¬æ–‡åŸºäºå¾®è½¯ç»å…¸çš„WorldWideImportsç¤ºä¾‹æ•°æ®åº“ï¼Œè®¾è®¡å¹¶å®ç°äº†ä¸€ä¸ªæ™ºèƒ½é”€å”®åˆ†æå¹³å°çš„æŠ€æœ¯åŸå‹ï¼Œå¹¶ä½¿ç”¨é€šä¹‰AIåœ¨æ•°æ®æ´å¯Ÿå’Œå†…å®¹ç”Ÿæˆæ–¹é¢çš„æ™ºèƒ½åŒ–èƒ½åŠ›ã€‚é€šè¿‡è¯¥Demoé¡¹ç›®ï¼Œæˆ‘ä»¬ä¸ä»…éªŒè¯äº†å„ä¸ªç»„ä»¶çš„ååŒå¯è¡Œæ€§ï¼Œè¿˜å±•ç¤ºäº†ä»è´­ç‰©ç¯®åˆ†æã€å•†å“å…³è”æŒ–æ˜åˆ°AIè¥é”€ç´ æç”Ÿæˆçš„å®Œæ•´æŠ€æœ¯é“¾è·¯ï¼Œä¸ºç±»ä¼¼çš„ä¼ä¸šçº§åº”ç”¨æä¾›äº†å‚è€ƒå’Œå®ç°æ€è·¯ã€‚

æ•´ä½“æ¶æ„
====

æ¶æ„å›¾
---

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155441034-1125929667.png)

æ•´ä¸ªDEMOæ¶æ„ç›¸å¯¹ç®€å•ï¼š

*   æ•°æ®å­˜å‚¨å±‚ é˜¿é‡Œäº‘RDS for SQL Serverä½œä¸ºæ ¸å¿ƒæ•°æ®åº“ï¼Œé‡‡ç”¨å¾®è½¯å®˜æ–¹ç¤ºä¾‹æ•°æ®åº“
    
*   è®¡ç®—ç¼–æ’å±‚ï¼šä½¿ç”¨é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—ä½œä¸ºæ ¸å¿ƒå¼•æ“ï¼Œæ‰¿æ‹…äº†æ•°æ®æŸ¥è¯¢ã€ä¸šåŠ¡é€»è¾‘å¤„ç†å’ŒæœåŠ¡ç¼–æ’çš„èŒè´£ã€‚å‡½æ•°è®¡ç®—çš„æŒ‰éœ€ä»˜è´¹æ¨¡å¼å¾ˆé€‚åˆè¿™ç§DEMOåˆ†æåœºæ™¯ï¼Œæ—¢èƒ½å¤„ç†æ•°æ®åº“æŸ¥è¯¢ï¼Œåˆèƒ½å¯¹æ¥ç™¾ç‚¼å¤§æ¨¡å‹æœåŠ¡è¿›è¡Œæ™ºèƒ½åˆ†æã€‚
    
*   Webå‰ç«¯ï¼šé‡‡ç”¨çº¯é™æ€é¡µé¢çš„æ–¹å¼ï¼Œé€šè¿‡HTTPè¯·æ±‚ç›´æ¥è°ƒç”¨å‡½æ•°è®¡ç®—æ¥å£ã€‚æ•´ä½“è¾ƒä¸ºç®€å•
    

ä½¿ç”¨åˆ°çš„äº‘äº§å“ç®€ä»‹
---------

é˜¿é‡Œäº‘RDS for SQL Serverï¼šä¼ä¸šçº§æ•°æ®åº“æœåŠ¡

é˜¿é‡Œäº‘RDS for SQL Serveræ˜¯åŸºäºå¾®è½¯SQL Serverå¼•æ“çš„æ‰˜ç®¡æ•°æ®åº“æœåŠ¡ï¼Œæä¾›äº†å®Œæ•´çš„ä¼ä¸šçº§æ•°æ®ç®¡ç†èƒ½åŠ›ã€‚ç›¸æ¯”è‡ªå»ºæ•°æ®åº“ï¼ŒRDSå…·å¤‡è‡ªåŠ¨å¤‡ä»½æ¢å¤ã€é«˜å¯ç”¨æ¶æ„ã€æ€§èƒ½ç›‘æ§ç­‰å¼€ç®±å³ç”¨çš„ç‰¹æ€§ï¼Œå¤§å¹…é™ä½äº†æ•°æ®åº“è¿ç»´å¤æ‚åº¦ã€‚

é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—ï¼šæ— æœåŠ¡å™¨è®¡ç®—å¹³å°

å‡½æ•°è®¡ç®—ï¼ˆFunction Computeï¼‰æ˜¯é˜¿é‡Œäº‘æä¾›çš„äº‹ä»¶é©±åŠ¨çš„å…¨æ‰˜ç®¡è®¡ç®—æœåŠ¡ï¼Œå¼€å‘è€…æ— éœ€ç®¡ç†æœåŠ¡å™¨å³å¯è¿è¡Œä»£ç ã€‚è¯¥æœåŠ¡æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€è¿è¡Œæ—¶ï¼Œå…·å¤‡æ¯«ç§’çº§å†·å¯åŠ¨ã€æŒ‰é‡ä»˜è´¹ã€è‡ªåŠ¨å¼¹æ€§ä¼¸ç¼©ç­‰ç‰¹æ€§ã€‚åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Pythonè¿è¡Œæ—¶æ„å»ºäº†ç»Ÿä¸€çš„å¤„ç†å‡½æ•°ï¼Œé€šè¿‡å‚æ•°è·¯ç”±å®ç°æ•°æ®æŸ¥è¯¢ã€AIåˆ†æç­‰å¤šç§åŠŸèƒ½ã€‚å‡½æ•°è®¡ç®—çš„æ— çŠ¶æ€ç‰¹æ€§å’ŒæŒ‰éœ€æ‰§è¡Œæ¨¡å¼ï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿå…·å¤‡äº†è‰¯å¥½çš„æˆæœ¬æ§åˆ¶èƒ½åŠ›å’Œé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œéå¸¸é€‚åˆæ„å»ºè½»é‡çº§çš„APIæœåŠ¡ã€‚

ç™¾ç‚¼å¹³å°ä¸é€šä¹‰å¤§æ¨¡å‹ï¼šAIèƒ½åŠ›çš„ç»Ÿä¸€å…¥å£

ç™¾ç‚¼æ˜¯é˜¿é‡Œäº‘æ¨å‡ºçš„å¤§æ¨¡å‹æœåŠ¡å¹³å°ï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¾¿æ·çš„AIèƒ½åŠ›è°ƒç”¨æ¥å£ã€‚é€šè¿‡ç™¾ç‚¼å¹³å°ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè½»æ¾æ¥å…¥é€šä¹‰åƒé—®å’Œé€šä¹‰ä¸‡åƒä¸¤å¤§æ ¸å¿ƒæ¨¡å‹ã€‚é€šä¹‰åƒé—®ä½œä¸ºå¤§è¯­è¨€æ¨¡å‹ï¼Œå…·å¤‡å¼ºå¤§çš„è‡ªç„¶è¯­è¨€ç†è§£å’Œç”Ÿæˆèƒ½åŠ›ï¼Œèƒ½å¤Ÿå°†å¤æ‚çš„æ•°æ®åˆ†æç»“æœè½¬åŒ–ä¸ºæ˜“æ‡‚çš„å•†ä¸šæ´å¯Ÿå’Œå»ºè®®ã€‚é€šä¹‰ä¸‡åƒåˆ™ä¸“æ³¨äºå›¾åƒç”Ÿæˆé¢†åŸŸï¼Œæ”¯æŒæ ¹æ®æ–‡æœ¬æè¿°åˆ›å»ºé«˜è´¨é‡çš„è¥é”€å›¾ç‰‡ã€‚

æ•°æ®å‡†å¤‡
====

åœ¨å¼€å§‹æ„å»ºæ™ºèƒ½é”€å”®åˆ†æå¹³å°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå‡†å¤‡å¥½ç¤ºä¾‹æ•°æ®ã€‚WorldWideImportsæ˜¯å¾®è½¯å®˜æ–¹æä¾›çš„SQL Serverç¤ºä¾‹æ•°æ®åº“ï¼ŒåŒ…å«äº†å®Œæ•´çš„é”€å”®ã€åº“å­˜ã€å®¢æˆ·ç­‰ä¸šåŠ¡æ•°æ®ï¼Œéå¸¸é€‚åˆç”¨äºæ•°æ®åˆ†æåœºæ™¯çš„æ¼”ç¤ºã€‚

æ•°æ®åº“å‡†å¤‡
-----

åœ¨https://github.com/Microsoft/sql-server-samples ä¸‹è½½å®˜æ–¹ç¤ºä¾‹æ•°æ®åº“ï¼Œå¹¶ä¸Šä¼ åˆ°ä¸RDS for SQL ServeråŒä¸€å¯ç”¨åŒºçš„OSS Bucketä¸­ã€‚

åœ¨é˜¿é‡Œäº‘RDSæ§åˆ¶å°ä¸­

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155456886-2028886042.png)

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155512708-506087730.png)

ä¸¤åˆ†é’Ÿåï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å°çœ‹åˆ°è¯¥æ•°æ®åº“å·²ç»Readyã€‚

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155525056-1887462333.png)

æ•°æ®åº“è´¦å·å‡†å¤‡
-------

åœ¨æ§åˆ¶å°åˆ›å»ºè´¦å·ï¼Œå¹¶ç»™ä¸WWIæ•°æ®åº“è¯»å†™æƒé™ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œè¯¥è´¦å·ç”¨äºå‡½æ•°è®¡ç®—è¿æ¥RDS SQL Server

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155539572-197733313.png)

SQLå‡†å¤‡
-----

é€šè¿‡ä¸€äº›å¤æ‚çš„åˆ†æSQLï¼Œæˆ‘ä»¬å¯ä»¥å®ç°5ç§ä¸é”€å”®åˆ†ææœ‰å…³çš„SQLï¼Œå¦‚ä¸‹

    # 1. çƒ­é”€å•†å“åˆ†ææŸ¥è¯¢
    # ç”¨é€”ï¼šæ˜¾ç¤ºé”€å”®é¢æœ€é«˜çš„å•†å“åŠå…¶è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ”¶å…¥ã€å®¢æˆ·æ•°é‡ã€å¹³å‡ä»·æ ¼ç­‰
    TOP_SELLING_PRODUCTS_QUERY = """
                                 -- çƒ­é”€å•†å“åˆ†ææŸ¥è¯¢ï¼ˆå·²éªŒè¯å¯ç”¨ï¼‰
    -- æ˜¾ç¤ºé”€å”®é¢æœ€é«˜çš„å•†å“åŠå…¶è¯¦ç»†ä¿¡æ¯
                                 WITH TopProducts AS (SELECT TOP 10
            si.StockItemName, si.SearchDetails, \
                                                             ISNULL(sc.ColorName, 'Default') as ColorName, \
                                                             si.Brand, \
                                                             si.Size, \
                                                             SUM(ol.Quantity * ol.UnitPrice) as Revenue, \
                                                             COUNT(DISTINCT o.CustomerID)    as CustomerCount, \
                                                             AVG(ol.UnitPrice)               as AvgPrice, \
                                                             SUM(ol.Quantity)                as TotalQuantitySold \
                                                      FROM Warehouse.StockItems si \
                                                               LEFT JOIN Sales.OrderLines ol ON si.StockItemID = ol.StockItemID \
                                                               LEFT JOIN Sales.Orders o ON ol.OrderID = o.OrderID \
                                                               LEFT JOIN Warehouse.Colors sc ON si.ColorID = sc.ColorID \
                                                      WHERE o.OrderDate >= '2016-01-01' \
                                                      GROUP BY si.StockItemID, si.StockItemName, si.SearchDetails, \
                                                               sc.ColorName, si.Brand, si.Size \
                                                      HAVING SUM(ol.Quantity * ol.UnitPrice) > 0 \
                                                      ORDER BY Revenue DESC)
                                 SELECT * \
                                 FROM TopProducts; \
                                 """
    
    # 2. å•†å“å…³è”åˆ†ææŸ¥è¯¢ï¼ˆè´­ç‰©ç¯®åˆ†æï¼‰
    # ç”¨é€”ï¼šåˆ†æå“ªäº›å•†å“ç»å¸¸ä¸€èµ·è¢«è´­ä¹°ï¼Œç”¨äºæ¨èç³»ç»Ÿå’Œäº¤å‰é”€å”®
    PRODUCT_AFFINITY_ANALYSIS_QUERY = """
                                      -- å•†å“å…³è”åˆ†ææŸ¥è¯¢ï¼ˆè´­ç‰©ç¯®åˆ†æï¼‰
    -- åˆ†æå“ªäº›å•†å“ç»å¸¸ä¸€èµ·è¢«è´­ä¹°
                                      WITH ProductAffinityAnalysis AS (SELECT ol1.StockItemID                       AS Product1, \
                                                                              ol2.StockItemID                       AS Product2, \
                                                                              p1.StockItemName                      AS Product1Name, \
                                                                              p2.StockItemName                      AS Product2Name, \
                                                                              COUNT(*)                              AS CoOccurrence, \
                                                                              COUNT(*) * 1.0 / \
                                                                              (SELECT COUNT(DISTINCT OrderID) \
                                                                               FROM Sales.OrderLines \
                                                                               WHERE StockItemID = ol1.StockItemID) AS SupportScore \
                                                                       FROM Sales.OrderLines ol1 \
                                                                                INNER JOIN Sales.OrderLines ol2 \
                                                                                           ON ol1.OrderID = ol2.OrderID AND ol1.StockItemID < ol2.StockItemID \
                                                                                INNER JOIN Warehouse.StockItems p1 ON ol1.StockItemID = p1.StockItemID \
                                                                                INNER JOIN Warehouse.StockItems p2 ON ol2.StockItemID = p2.StockItemID \
                                                                                INNER JOIN Sales.Orders o ON ol1.OrderID = o.OrderID \
                                                                       WHERE o.OrderDate >= '2016-01-01' \
                                                                       GROUP BY ol1.StockItemID, ol2.StockItemID, \
                                                                                p1.StockItemName, p2.StockItemName \
                                                                       HAVING COUNT(*) >= 3 -- è‡³å°‘åŒæ—¶å‡ºç°3æ¬¡
                                      )
                                      SELECT TOP 20 
        Product1Name, Product2Name,
                                             CoOccurrence,
                                             SupportScore
                                      FROM ProductAffinityAnalysis
                                      ORDER BY SupportScore DESC; \
                                      """
    
    # 3. åº“å­˜çŠ¶æ€åˆ†ææŸ¥è¯¢
    # ç”¨é€”ï¼šåˆ†æå½“å‰åº“å­˜çŠ¶æ€å’Œå•†å“éœ€æ±‚ï¼Œè¯†åˆ«åº“å­˜é£é™©
    INVENTORY_STATUS_ANALYSIS_QUERY = """
                                      -- åº“å­˜çŠ¶æ€åˆ†ææŸ¥è¯¢
    -- åˆ†æå½“å‰åº“å­˜çŠ¶æ€å’Œå•†å“éœ€æ±‚
                                      SELECT TOP 30
        si.StockItemID, si.StockItemName,
                                             si.Brand,
                                             si.Size,
                                             ISNULL(sih.QuantityOnHand, 0)   as CurrentStock,
                                             ISNULL(sih.LastCostPrice, 0)    as LastCostPrice,
                                             COUNT(ol.OrderLineID)           as OrderFrequency,
                                             AVG(ol.Quantity)                AS AvgDemand,
                                             SUM(ol.Quantity * ol.UnitPrice) as TotalRevenue,
                                             CASE
                                                 WHEN ISNULL(sih.QuantityOnHand, 0) <= 50 THEN 'Critical'
                                                 WHEN ISNULL(sih.QuantityOnHand, 0) <= 200 THEN 'Low'
                                                 ELSE 'Normal'
                                                 END                         AS StockStatus
                                      FROM Warehouse.StockItems si
                                               LEFT JOIN Warehouse.StockItemHoldings sih ON si.StockItemID = sih.StockItemID
                                               LEFT JOIN Sales.OrderLines ol ON si.StockItemID = ol.StockItemID
                                               LEFT JOIN Sales.Orders o ON ol.OrderID = o.OrderID
                                      WHERE o.OrderDate >= '2015-06-01' \
                                         OR o.OrderDate IS NULL
                                      GROUP BY si.StockItemID, si.StockItemName, si.Brand, si.Size, sih.QuantityOnHand, \
                                               sih.LastCostPrice
                                      ORDER BY OrderFrequency DESC; \
                                      """
    
    # 4. å®¢æˆ·è´­ä¹°è¡Œä¸ºåˆ†ææŸ¥è¯¢
    # ç”¨é€”ï¼šåˆ†æå®¢æˆ·è´­ä¹°æ¨¡å¼å’Œä»·å€¼ï¼Œç”¨äºå®¢æˆ·åˆ†å±‚å’Œè¥é”€ç­–ç•¥
    CUSTOMER_BEHAVIOR_ANALYSIS_QUERY = """
                                       -- å®¢æˆ·è´­ä¹°è¡Œä¸ºåˆ†ææŸ¥è¯¢
    -- åˆ†æå®¢æˆ·è´­ä¹°æ¨¡å¼å’Œä»·å€¼
                                       WITH CustomerAnalysis AS (SELECT c.CustomerID, \
                                                                        c.CustomerName, \
                                                                        c.DeliveryAddressLine1, \
                                                                        c.DeliveryAddressLine2, \
                                                                        COUNT(DISTINCT o.OrderID)                     as OrderCount, \
                                                                        SUM(ol.Quantity * ol.UnitPrice)               as TotalSpent, \
                                                                        AVG(ol.Quantity * ol.UnitPrice)               as AvgOrderValue, \
                                                                        MAX(o.OrderDate)                              as LastOrderDate, \
                                                                        DATEDIFF(DAY, MAX(o.OrderDate), '2016-05-31') as DaysSinceLastOrder, \
                                                                        COUNT(DISTINCT ol.StockItemID)                as UniqueProductsPurchased \
                                                                 FROM Sales.Customers c \
                                                                          INNER JOIN Sales.Orders o ON c.CustomerID = o.CustomerID \
                                                                          INNER JOIN Sales.OrderLines ol ON o.OrderID = ol.OrderID \
                                                                 WHERE o.OrderDate >= '2016-01-01' \
                                                                 GROUP BY c.CustomerID, c.CustomerName, \
                                                                          c.DeliveryAddressLine1, c.DeliveryAddressLine2)
                                       SELECT TOP 20
        CustomerName, DeliveryAddressLine2 as Region,
                                              OrderCount,
                                              TotalSpent,
                                              AvgOrderValue,
                                              UniqueProductsPurchased,
                                              CASE
                                                  WHEN TotalSpent > 50000 THEN 'VIP'
                                                  WHEN TotalSpent > 20000 THEN 'Premium'
                                                  WHEN TotalSpent > 5000 THEN 'Regular'
                                                  ELSE 'Basic'
                                                  END AS CustomerTier,
                                              CASE
                                                  WHEN DaysSinceLastOrder <= 30 THEN 'Active'
                                                  WHEN DaysSinceLastOrder <= 90 THEN 'At Risk'
                                                  ELSE 'Inactive'
                                                  END AS CustomerStatus
                                       FROM CustomerAnalysis
                                       ORDER BY TotalSpent DESC; \
                                       """
    
    # 5. å­£èŠ‚æ€§é”€å”®è¶‹åŠ¿åˆ†ææŸ¥è¯¢
    # ç”¨é€”ï¼šåˆ†æå•†å“åœ¨ä¸åŒæœˆä»½çš„é”€å”®è¡¨ç°ï¼Œè¯†åˆ«å­£èŠ‚æ€§æ¨¡å¼
    SEASONAL_SALES_TREND_QUERY = """
                                 -- å­£èŠ‚æ€§é”€å”®è¶‹åŠ¿åˆ†ææŸ¥è¯¢
    -- åˆ†æå•†å“åœ¨ä¸åŒæœˆä»½çš„é”€å”®è¡¨ç°
                                 SELECT
                                     MONTH (o.OrderDate) as OrderMonth, DATENAME(MONTH, o.OrderDate) as MonthName, si.StockItemName, SUM (ol.Quantity * ol.UnitPrice) as MonthlyRevenue, COUNT (DISTINCT o.OrderID) as OrderCount, AVG (ol.Quantity) as AvgQuantityPerOrder, SUM (ol.Quantity) as TotalQuantitySold
                                 FROM Sales.Orders o
                                     INNER JOIN Sales.OrderLines ol \
                                 ON o.OrderID = ol.OrderID
                                     INNER JOIN Warehouse.StockItems si ON ol.StockItemID = si.StockItemID
                                 WHERE o.OrderDate >= '2016-01-01'
                                   AND si.StockItemName IN (
                                 -- åªåˆ†æå‰10ä¸ªçƒ­é”€å•†å“çš„å­£èŠ‚æ€§è¶‹åŠ¿
                                     SELECT TOP 10 si2.StockItemName
                                     FROM Warehouse.StockItems si2
                                     INNER JOIN Sales.OrderLines ol2 ON si2.StockItemID = ol2.StockItemID
                                     INNER JOIN Sales.Orders o2 ON ol2.OrderID = o2.OrderID
                                     WHERE o2.OrderDate >= '2016-01-01'
                                     GROUP BY si2.StockItemName
                                     ORDER BY SUM (ol2.Quantity * ol2.UnitPrice) DESC
                                     )
                                 GROUP BY MONTH (o.OrderDate), DATENAME(MONTH, o.OrderDate), si.StockItemName
                                 ORDER BY OrderMonth, MonthlyRevenue DESC; \
                                 """

ç¤ºä¾‹ç»“æœå¦‚å›¾

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155632733-1238707042.png)

é…ç½®å¤§æ¨¡å‹è®¿é—®
=======

è¿›å…¥é˜¿é‡Œäº‘ç™¾ç‚¼æ§åˆ¶å°[https://bailian.console.aliyun.com/](https://bailian.console.aliyun.com/) ï¼Œè·å–ç”¨äºè°ƒç”¨å¤§æ¨¡å‹çš„API Keyï¼Œè¿™é‡Œæˆ‘ä»¬çš„æ–‡æœ¬æ¨¡å¼ä½¿ç”¨qwen-maxï¼Œå›¾ç‰‡ç”Ÿæˆæ¨¡å‹ä½¿ç”¨ wanx2.1-t2i-plus

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155649020-1108605670.png)

å¯¹äºè¿™5ç§é”€å”®åˆ†æåœºæ™¯ï¼Œæˆ‘ä»¬åˆ†åˆ«å°†æç¤ºè¯å°è£…åˆ°ç±»ä¸­ï¼Œå°†SQL Serverè¿”å›çš„æ•°æ®é…åˆå›ºå®šçš„ç³»ç»Ÿæç¤ºè¯ä¸ç”¨æˆ·æç¤ºè¯ä¼ ç»™ä»£ç ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

    class AIEnhance:
        """å°è£…å¯¹å¤§è¯­è¨€æ¨¡å‹çš„è°ƒç”¨ï¼Œç”¨äºæ•°æ®åˆ†æ"""
    
        def __init__(self, model='qwen-max', image_model='wanx2.1-t2i-plus'):
            self.model = model
            self.image_model = image_model
    
    
        def analyze_top_selling_products(self, products_data):
            system_prompt = "ä½ æ˜¯ä¸€ä½èµ„æ·±çš„æ•°æ®åˆ†æå¸ˆã€‚"
            user_prompt = ("è¯·æ ¹æ®ä»¥ä¸‹çƒ­é”€å•†å“æ•°æ®ï¼Œç”Ÿæˆä¸€æ®µç®€æ´ã€æ·±åˆ»çš„åˆ†ææŠ¥å‘Šã€‚\n"
                           "æŠ¥å‘Šåº”åŒ…æ‹¬ï¼š\n"
                           "1. æ€»ç»“å…³é”®çš„é”€å”®è¶‹åŠ¿ã€‚\n"
                           "2. æŒ‡å‡ºè¡¨ç°æœ€çªå‡ºçš„å‡ æ¬¾å•†å“åŠå…¶ç‰¹ç‚¹ã€‚\n"
                           "3. åŸºäºæ•°æ®ï¼Œæå‡º1-2æ¡å…·ä½“çš„å•†ä¸šå»ºè®®ã€‚")
            return self._execute_analysis_prompt(system_prompt, user_prompt, products_data)
    
        def analyze_product_affinity(self, affinity_data):
            system_prompt = "ä½ æ˜¯ä¸€ä½é›¶å”®ç­–ç•¥å¸ˆï¼Œæ“…é•¿é€šè¿‡è´­ç‰©ç¯®åˆ†ææå‡äº¤å‰é”€å”®ã€‚"
            user_prompt = ("è¯·åˆ†æä»¥ä¸‹å•†å“å…³è”æ•°æ®ï¼ˆå“ªäº›å•†å“ç»å¸¸è¢«ä¸€èµ·è´­ä¹°ï¼‰ã€‚\n"
                           "åˆ†æåº”åŒ…æ‹¬ï¼š\n"
                           "1. è¯†åˆ«å‡ºå…³è”æ€§æœ€å¼ºçš„å‡ ç»„å•†å“ï¼ˆåŸºäºSupportScoreå’ŒCoOccurrenceï¼‰ã€‚\n"
                           "2. æå‡ºå…·ä½“çš„è¥é”€å»ºè®®ï¼Œå¦‚å•†å“æ†ç»‘ã€ç»„åˆæŠ˜æ‰£æˆ–åœ¨å•†å“é¡µé¢è¿›è¡Œæ¨èã€‚\n"
                           "3. æŒ‡å‡ºæ˜¯å¦æœ‰ä»»ä½•éç›´è§‚çš„ã€æœ‰è¶£çš„å•†å“ç»„åˆå€¼å¾—å…³æ³¨ã€‚")
            return self._execute_analysis_prompt(system_prompt, user_prompt, affinity_data)
    
        def analyze_inventory(self, inventory_data):
            system_prompt = "ä½ æ˜¯ä¸€ä½ä¾›åº”é“¾å’Œåº“å­˜ç®¡ç†ä¸“å®¶ã€‚"
            user_prompt = ("è¯·æ ¹æ®ä¸‹é¢çš„åº“å­˜çŠ¶æ€å’Œé”€å”®æ•°æ®è¿›è¡Œåˆ†æã€‚\n"
                           "åˆ†æåº”åŒ…æ‹¬ï¼š\n"
                           "1. è¯†åˆ«å‡ºæœ‰é£é™©çš„å•†å“ï¼Œç‰¹åˆ«æ˜¯åº“å­˜çŠ¶æ€ä¸º'Critical'ä¸”è®¢å•é¢‘ç‡(OrderFrequency)è¾ƒé«˜çš„å•†å“ï¼Œå¹¶å»ºè®®ç«‹å³é‡‡å–è¡ŒåŠ¨ã€‚\n"
                           "2. æ‰¾å‡ºåº“å­˜ç§¯å‹çš„å•†å“ï¼ˆåº“å­˜é‡å¤§ä½†è®¢å•é¢‘ç‡ä½ï¼‰ï¼Œå¹¶å»ºè®®å¤„ç†æ–¹å¼ï¼ˆå¦‚ä¿ƒé”€ã€æ¸…ä»“ï¼‰ã€‚\n"
                           "3. å¯¹æ•´ä½“åº“å­˜å¥åº·çŠ¶å†µç»™å‡ºä¸€ä¸ªç®€è¦è¯„ä»·ã€‚")
            return self._execute_analysis_prompt(system_prompt, user_prompt, inventory_data)
    
        def analyze_customer_behavior(self, customer_data):
            system_prompt = "ä½ æ˜¯ä¸€ä½å®¢æˆ·å…³ç³»ç®¡ç†ï¼ˆCRMï¼‰ä¸è¥é”€ä¸“å®¶ã€‚"
            user_prompt = ("è¯·åˆ†æä»¥ä¸‹å®¢æˆ·è¡Œä¸ºå’Œåˆ†å±‚æ•°æ®ã€‚\n"
                           "åˆ†æåº”åŒ…æ‹¬ï¼š\n"
                           "1. æ€»ç»“å®¢æˆ·ç¾¤ä½“çš„æ„æˆï¼ˆå¦‚VIP, Premiumå®¢æˆ·çš„å æ¯”å’Œç‰¹ç‚¹ï¼‰ã€‚\n"
                           "2. ä¸ºä¸åŒå®¢æˆ·çŠ¶æ€('Active', 'At Risk', 'Inactive')çš„å®¢æˆ·ç¾¤ä½“æå‡ºå·®å¼‚åŒ–çš„è¥é”€ç­–ç•¥ã€‚\n"
                           "3. æè¿°é«˜ä»·å€¼å®¢æˆ·çš„æ ¸å¿ƒç‰¹å¾ï¼Œä¸ºç²¾å‡†è¥é”€æä¾›ä¾æ®ã€‚")
            return self._execute_analysis_prompt(system_prompt, user_prompt, customer_data)
    
        def analyze_seasonal_trends(self, seasonal_data):
            system_prompt = "ä½ æ˜¯ä¸€ä½å¸‚åœºåˆ†æå¸ˆï¼Œç²¾é€šé”€å”®é¢„æµ‹å’Œå­£èŠ‚æ€§è¶‹åŠ¿åˆ†æã€‚"
            user_prompt = ("è¯·åˆ†æä»¥ä¸‹çƒ­é”€å•†å“çš„æœˆåº¦é”€å”®æ•°æ®ï¼Œè¯†åˆ«å­£èŠ‚æ€§è¶‹åŠ¿ã€‚\n"
                           "åˆ†æåº”åŒ…æ‹¬ï¼š\n"
                           "1. æŒ‡å‡ºå“ªäº›å•†å“æœ‰æ˜æ˜¾çš„é”€å”®æ—ºå­£å’Œæ·¡å­£ã€‚\n"
                           "2. æ€»ç»“å“ªäº›æœˆä»½æ˜¯æ•´ä½“é”€å”®çš„é«˜å³°æœŸå’Œä½è°·æœŸã€‚\n"
                           "3. åŸºäºè¿™äº›å­£èŠ‚æ€§æ¨¡å¼ï¼Œä¸ºåº“å­˜è§„åˆ’å’Œè¥é”€æ´»åŠ¨æä¾›å…·ä½“å»ºè®®ã€‚")
            return self._execute_analysis_prompt(system_prompt, user_prompt, seasonal_data)

é…ç½®å‡½æ•°è®¡ç®—
======

è¿›å…¥å‡½æ•°è®¡ç®—æ§åˆ¶å°[https://fcnext.console.aliyun.com/](https://fcnext.console.aliyun.com/overview) ï¼Œåˆ›å»ºå‡½æ•°

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155706259-174075216.png)

å‡½æ•°ç±»å‹é€‰æ‹©â€œä»»åŠ¡å‡½æ•°â€ã€‚

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155720427-780899443.png)

éƒ¨ç½²ä»£ç 
----

åˆ›å»ºå®Œæˆåï¼Œéƒ¨ç½²ä»£ç ï¼Œå…¥å£ä»£ç å¦‚ä¸‹ï¼Œé€šè¿‡è§£æç®€å•çš„QueryStringè·å–å‚æ•°ï¼Œé€šè¿‡ä¸åŒçš„è®¿é—®ç±»åˆ«è°ƒç”¨ä¸åŒçš„SQLä¸å¤§æ¨¡å‹åˆ†æï¼Œå…¸å‹çš„è®¿é—®è¯·æ±‚ä¾‹å¦‚ï¼š

https://è‡ªå®šä¹‰å‡½æ•°åœ°å€.cn-beijing.fcapp.run?analysis\_type=product\_affinity&ai\_result=true&generate\_image=true

    import json
    import logging
    
    # é…ç½®æ—¥å¿—
    logger = logging.getLogger()
    logger.setLevel(logging.INFO)
    
    from database_wrapper import WideWorldImportersDB
    from ai_enhance import create_ai_analyzer
    
    db = WideWorldImportersDB()
    ai_service = create_ai_analyzer()
    
    
    def handler(event, context):
        """
        å‡½æ•°å…¥å£ç‚¹ (äº‹ä»¶é©±åŠ¨)
        Args:
            event (dict): æœŸæœ›åŒ…å«:
                         - analysis_type: åˆ†æç±»å‹ (å¿…éœ€)
                         - ai_result: æ˜¯å¦éœ€è¦AIåˆ†æ (å¯é€‰ï¼Œå€¼ä¸º 'true' æ—¶å¯ç”¨)
                         - generate_image: æ˜¯å¦ç”Ÿæˆå›¾ç‰‡ (å¯é€‰ï¼Œå€¼ä¸º 'true' æ—¶å¯ç”¨ï¼Œä»…æ”¯æŒ product_affinity)
    
        Returns:
            dict: åŒ…å«åŸå§‹æ•°æ®æˆ–AIåˆ†æç»“æœçš„å­—å…¸
        """
    
        # è§£æäº‹ä»¶æ•°æ®
        if isinstance(event, bytes):
            event = json.loads(event.decode('utf-8'))
        elif isinstance(event, str):
            event = json.loads(event)
    
        # è·å–åˆ†æç±»å‹å‚æ•°
        analysis_type = event.get('analysis_type')
        if not analysis_type:
            query_params = event.get('queryParameters', {})
            analysis_type = query_params.get('analysis_type')
    
        if not analysis_type:
            return {"status": "error", "message": "è¯·æ±‚ä¸­ç¼ºå°‘ 'analysis_type' å‚æ•°"}
    
        # è·å–å…¶ä»–å¯é€‰å‚æ•°
        ai_result = event.get('ai_result') or event.get('queryParameters', {}).get('ai_result')
        generate_image = event.get('generate_image') or event.get('queryParameters', {}).get('generate_image')
    
        logging.info(f"å¤„ç†è¯·æ±‚: analysis_type={analysis_type}, ai_result={ai_result}, generate_image={generate_image}")
    
        try:
            # è·å–åŸå§‹æ•°æ®
            raw_data = get_raw_data(analysis_type)
            if not raw_data:
                return {"status": "error", "message": f"æœªæ‰¾åˆ° {analysis_type} ç±»å‹çš„æ•°æ®"}
    
            # æ„å»ºåŸºç¡€è¿”å›ç»“æœ
            result = {
                "status": "success",
                "analysis_type": analysis_type,
                "data_count": len(raw_data),
                "raw_data": raw_data
            }
    
            # å¦‚æœéœ€è¦AIåˆ†æç»“æœ
            if ai_result == 'true':
                logging.info(f"å¼€å§‹æ‰§è¡ŒAIåˆ†æ: {analysis_type}")
                analysis_result = get_ai_analysis(analysis_type, raw_data)
                result["ai_analysis"] = analysis_result
                logging.info("AIåˆ†æå®Œæˆ")
    
            # å¦‚æœéœ€è¦ç”Ÿæˆå›¾ç‰‡ï¼ˆç›®å‰åªæ”¯æŒå•†å“å…³è”åˆ†æï¼‰
            if generate_image == 'true':
                if analysis_type == 'product_affinity':
                    logging.info("å¼€å§‹ç”Ÿæˆå•†å“ç»„åˆå›¾ç‰‡")
                    image_result = ai_service.generate_product_bundle_image(raw_data)
                    result["generated_image"] = image_result
                    logging.info("å›¾ç‰‡ç”Ÿæˆå®Œæˆ")
                else:
                    result["image_warning"] = f"å›¾ç‰‡ç”ŸæˆåŠŸèƒ½ç›®å‰åªæ”¯æŒ 'product_affinity' ç±»å‹ï¼Œå½“å‰ç±»å‹ä¸º '{analysis_type}'"
    
            return result
    
        except Exception as e:
            error_msg = f"å¤„ç† {analysis_type} è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯: {str(e)}"
            logging.error(error_msg)
            return {"status": "error", "message": error_msg}
    
    
    def get_raw_data(analysis_type):
        """
        æ ¹æ®åˆ†æç±»å‹è·å–åŸå§‹æ•°æ®
    
        Args:
            analysis_type (str): åˆ†æç±»å‹
    
        Returns:
            list: åŸå§‹æ•°æ®åˆ—è¡¨ï¼Œå¦‚æœç±»å‹ä¸æ”¯æŒåˆ™è¿”å› None
        """
    
        if analysis_type == 'top_selling_products':
            return db.get_top_selling_products(10)
    
        elif analysis_type == 'product_affinity':
            return db.get_product_affinity_analysis(min_occurrence=5, limit=15)
    
        elif analysis_type == 'inventory_status':
            return db.get_inventory_status_analysis(30)
    
        elif analysis_type == 'customer_behavior':
            return db.get_customer_behavior_analysis(20)
    
        elif analysis_type == 'seasonal_sales':
            return db.get_seasonal_sales_trend(10)
    
        else:
            logging.warning(f"ä¸æ”¯æŒçš„åˆ†æç±»å‹: {analysis_type}")
            return None
    
    
    def get_ai_analysis(analysis_type, data):
        """
        æ ¹æ®åˆ†æç±»å‹å’Œæ•°æ®è·å–AIåˆ†æç»“æœ
    
        Args:
            analysis_type (str): åˆ†æç±»å‹
            data (list): åŸå§‹æ•°æ®
    
        Returns:
            str: AIåˆ†æç»“æœæ–‡æœ¬
        """
    
        if analysis_type == 'top_selling_products':
            return ai_service.analyze_top_selling_products(data)
    
        elif analysis_type == 'product_affinity':
            return ai_service.analyze_product_affinity(data)
    
        elif analysis_type == 'inventory_status':
            return ai_service.analyze_inventory(data)
    
        elif analysis_type == 'customer_behavior':
            return ai_service.analyze_customer_behavior(data)
    
        elif analysis_type == 'seasonal_sales':
            return ai_service.analyze_seasonal_trends(data)
    
        else:
            return f"ä¸æ”¯æŒçš„åˆ†æç±»å‹: {analysis_type}"

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155757235-1606919398.png)

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå‡½æ•°è®¡ç®—ä¸­éœ€è¦ä¾èµ–çš„ç±»åº“éœ€è¦æ‰‹åŠ¨å®‰è£…ï¼Œä¾èµ–çš„ç±»åº“å¦‚ä¸‹ï¼š

requirements.txt

    pymssql==2.3.7
    requests==2.31.0
    dashscope==1.14.1
    alibabacloud-tea-openapi==0.3.7

åœ¨æ‰“åŒ…ä¸Šä¼ ä»£ç ä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤éƒ¨ç½²ä¾èµ–åŒ…ï¼š

    pip install -r requirements.txt -t .

é…ç½®ç¯å¢ƒå˜é‡&è®¾ç½®ç«¯å£
-----------

å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éƒ¨ç½²ç¯å¢ƒå˜é‡ï¼Œå­˜å…¥RDS SQL Serverçš„åœ°å€ã€ç”¨æˆ·åä¸å¯†ç ï¼Œä»¥åŠç™¾ç‚¼çš„API Keyï¼Œè¿™é‡Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨KMSï¼Œä½†ä¸ºäº†DEMOç®€å•èµ·è§ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡æ–¹å¼

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155816397-2099732397.png)

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155833055-1342535625.png)

é€šè¿‡åˆ›å»ºè§¦å‘å™¨ï¼Œå…è®¸å‡½æ•°é€šè¿‡HTTPè¯·æ±‚è§¦å‘ï¼Œå¦‚ä¸‹å›¾ï¼š

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155845197-1478635967.png)

ä¸ºäº†DEMOç®€å•ï¼Œé€‰æ‹©æ— éœ€è®¤è¯ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸èƒ½è¿™ä¹ˆåšã€‚

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155859123-862628056.png)

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155912372-959154497.png)

éªŒè¯å‡½æ•°
----

å‡½æ•°åˆ›å»ºå®Œæˆåï¼Œè°ƒç”¨å‡½æ•°æŸ¥çœ‹ç»“æœï¼Œçœ‹èµ·æ¥ä¸€åˆ‡æ­£å¸¸ï¼š

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155928754-1325746511.png)

å‰ç«¯
==

å‰ç«¯ä½¿ç”¨Flask + é™æ€é¡µé¢çš„æ–¹å¼è¿›è¡Œã€‚è¾ƒä¸ºç®€å•ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

    from flask import Flask, render_template, jsonify, request
    import requests
    import logging
    
    import os
    
    # Initialize Flask app with explicit template folder
    app = Flask(__name__, template_folder=os.path.join(os.path.dirname(os.path.abspath(__file__)), 'templates'))
    app.secret_key = 'your-secret-key-here'
    
    # é…ç½®æ—¥å¿—
    logging.basicConfig(level=logging.INFO)
    logger = logging.getLogger(__name__)
    
    # APIåŸºç¡€URL
    API_BASE_URL = "https://sales-insights-zfdsymcpgw.cn-beijing.fcapp.run"
    
    # åˆ†æç±»å‹é…ç½®
    ANALYSIS_TYPES = {
        'top_selling_products': {
            'name': 'çƒ­é”€å•†å“åˆ†æ',
            'description': 'å±•ç¤ºé”€å”®é¢æœ€é«˜çš„å•†å“åŠå…¶è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ”¶å…¥ã€å®¢æˆ·æ•°é‡ã€å¹³å‡ä»·æ ¼ç­‰',
            'icon': 'ğŸ†',
            'color': 'from-blue-400 to-blue-600',
            'supports_image': False
        },
        'product_affinity': {
            'name': 'å•†å“å…³è”åˆ†æ',
            'description': 'åˆ†æå“ªäº›å•†å“ç»å¸¸ä¸€èµ·è¢«è´­ä¹°ï¼Œç”¨äºæ¨èç³»ç»Ÿå’Œäº¤å‰é”€å”®',
            'icon': 'ğŸ”—',
            'color': 'from-green-400 to-green-600',
            'supports_image': True
        },
        'inventory_status': {
            'name': 'åº“å­˜çŠ¶æ€åˆ†æ',
            'description': 'åˆ†æå½“å‰åº“å­˜çŠ¶æ€å’Œå•†å“éœ€æ±‚ï¼Œè¯†åˆ«åº“å­˜é£é™©',
            'icon': 'ğŸ“¦',
            'color': 'from-yellow-400 to-yellow-600',
            'supports_image': False
        },
        'customer_behavior': {
            'name': 'å®¢æˆ·è¡Œä¸ºåˆ†æ',
            'description': 'åˆ†æå®¢æˆ·è´­ä¹°æ¨¡å¼å’Œä»·å€¼ï¼Œç”¨äºå®¢æˆ·åˆ†å±‚å’Œè¥é”€ç­–ç•¥',
            'icon': 'ğŸ‘¥',
            'color': 'from-purple-400 to-purple-600',
            'supports_image': False
        },
        'seasonal_sales': {
            'name': 'å­£èŠ‚æ€§é”€å”®è¶‹åŠ¿',
            'description': 'åˆ†æå•†å“åœ¨ä¸åŒæœˆä»½çš„é”€å”®è¡¨ç°ï¼Œè¯†åˆ«å­£èŠ‚æ€§æ¨¡å¼',
            'icon': 'ğŸ“Š',
            'color': 'from-red-400 to-red-600',
            'supports_image': False
        }
    }
    
    
    @app.route('/')
    def index():
        """ä¸»é¡µé¢ - å±•ç¤ºæ‰€æœ‰åˆ†æç±»å‹"""
        return render_template('index.html', analysis_types=ANALYSIS_TYPES)
    
    
    @app.route('/analysis/<analysis_type>')
    def analysis_detail(analysis_type):
        """åˆ†æè¯¦æƒ…é¡µé¢"""
        if analysis_type not in ANALYSIS_TYPES:
            return "åˆ†æç±»å‹ä¸å­˜åœ¨", 404
    
        config = ANALYSIS_TYPES[analysis_type]
        return render_template('analysis.html',
                               analysis_type=analysis_type,
                               config=config)
    
    
    @app.route('/api/get_data/<analysis_type>')
    def get_raw_data(analysis_type):
        """è·å–åŸå§‹æ•°æ®çš„APIç«¯ç‚¹"""
        try:
            url = f"{API_BASE_URL}?analysis_type={analysis_type}"
            response = requests.get(url, timeout=30)
            response.raise_for_status()
            return jsonify(response.json())
        except requests.exceptions.RequestException as e:
            logger.error(f"è·å–åŸå§‹æ•°æ®å¤±è´¥: {str(e)}")
            return jsonify({"status": "error", "message": f"è·å–æ•°æ®å¤±è´¥: {str(e)}"}), 500
    
    
    @app.route('/api/get_ai_analysis/<analysis_type>')
    def get_ai_analysis(analysis_type):
        """è·å–AIåˆ†æç»“æœçš„APIç«¯ç‚¹"""
        try:
            url = f"{API_BASE_URL}?analysis_type={analysis_type}&ai_result=true"
            response = requests.get(url, timeout=60)
            response.raise_for_status()
            return jsonify(response.json())
        except requests.exceptions.RequestException as e:
            logger.error(f"è·å–AIåˆ†æå¤±è´¥: {str(e)}")
            return jsonify({"status": "error", "message": f"è·å–AIåˆ†æå¤±è´¥: {str(e)}"}), 500
    
    
    # æ›¿æ¢ç°æœ‰çš„ generate_image è·¯ç”±
    @app.route('/api/generate_image/<analysis_type>')
    def generate_image(analysis_type):
        """ç”Ÿæˆå›¾ç‰‡ - è°ƒç”¨åŒ…å«AIåˆ†æå’Œå›¾ç‰‡ç”Ÿæˆçš„å®Œæ•´API"""
        if analysis_type != 'product_affinity':
            return jsonify({"status": "error", "message": "å›¾ç‰‡ç”ŸæˆåŠŸèƒ½åªæ”¯æŒå•†å“å…³è”åˆ†æ"}), 400
    
        try:
            # è°ƒç”¨åŒ…å«AIåˆ†æå’Œå›¾ç‰‡ç”Ÿæˆçš„å®Œæ•´API
            url = f"{API_BASE_URL}?analysis_type={analysis_type}&ai_result=true&generate_image=true"
            logger.info(f"è°ƒç”¨å®Œæ•´APIï¼ˆå«å›¾ç‰‡ç”Ÿæˆï¼‰: {url}")
            response = requests.get(url, timeout=120)  # å¢åŠ è¶…æ—¶æ—¶é—´ï¼Œå› ä¸ºå›¾ç‰‡ç”Ÿæˆéœ€è¦æ›´é•¿æ—¶é—´
            response.raise_for_status()
    
            result = response.json()
    
            # åªè¿”å›å›¾ç‰‡ç›¸å…³çš„æ•°æ®
            if result.get('status') == 'success' and result.get('generated_image'):
                return jsonify({
                    "status": "success",
                    "generated_image": result['generated_image']
                })
            else:
                return jsonify({
                    "status": "error",
                    "message": result.get('message', 'å›¾ç‰‡ç”Ÿæˆå¤±è´¥')
                }), 500
    
        except requests.exceptions.Timeout:
            logger.error("å›¾ç‰‡ç”Ÿæˆè¶…æ—¶")
            return jsonify({"status": "error", "message": "å›¾ç‰‡ç”Ÿæˆè¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•"}), 500
        except requests.exceptions.RequestException as e:
            logger.error(f"ç”Ÿæˆå›¾ç‰‡å¤±è´¥: {str(e)}")
            return jsonify({"status": "error", "message": f"ç”Ÿæˆå›¾ç‰‡å¤±è´¥: {str(e)}"}), 500
    
    @app.errorhandler(404)
    def not_found(error):
        return render_template('404.html'), 404
    
    
    @app.errorhandler(500)
    def internal_error(error):
        return render_template('500.html'), 500
    
    
    if __name__ == '__main__':
        app.run(debug=True, host='0.0.0.0', port=5000)

æ•´ä½“æ•ˆæœ
====

å‰ç«¯å¯åŠ¨åï¼Œä¸‹é¢æ˜¯æœ€ç»ˆæ•ˆæœã€‚

ä¸»é¡µ
--

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801155946561-271067589.png)

çƒ­é”€å•†å“åˆ†æ
------

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801160002504-1671571104.png)

å­£èŠ‚é”€å”®è¶‹åŠ¿åˆ†æ
--------

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801160015112-1834717502.png)

å•†å“å…³è”åˆ†æå¹¶ç”Ÿæˆå…³è”å•†å“çš„è¥é”€å›¾
-----------------

![image](https://img2024.cnblogs.com/blog/35368/202508/35368-20250801160030084-121117096.png)

å°ç»“
==

æœ¬æ–‡å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨äº‘åŸç”ŸæŠ€æœ¯æ ˆæ„å»ºç°ä»£åŒ–çš„æ™ºèƒ½é”€å”®åˆ†æå¹³å°ï¼Œå®ç°äº†ä¼ ç»Ÿæ•°æ®åº“ã€æ— æœåŠ¡å™¨è®¡ç®—å’Œäººå·¥æ™ºèƒ½çš„æ·±åº¦èåˆã€‚é€šè¿‡é˜¿é‡Œäº‘RDS for SQL Serverã€å‡½æ•°è®¡ç®—å’Œç™¾ç‚¼å¤§æ¨¡å‹çš„ååŒå·¥ä½œï¼Œæ„å»ºäº†ä¸€ä¸ªå…·å¤‡æ•°æ®æ´å¯Ÿå’Œå†…å®¹ç”Ÿæˆèƒ½åŠ›çš„ç«¯åˆ°ç«¯è§£å†³æ–¹æ¡ˆã€‚

æ ¸å¿ƒæŠ€æœ¯äº®ç‚¹ï¼š

*   æ— æœåŠ¡å™¨æ¶æ„ï¼šé‡‡ç”¨å‡½æ•°è®¡ç®—ä½œä¸ºæ ¸å¿ƒå¼•æ“ï¼Œå®ç°æŒ‰éœ€ä»˜è´¹å’Œè‡ªåŠ¨å¼¹æ€§ä¼¸ç¼©ï¼Œæ˜¾è‘—é™ä½è¿ç»´æˆæœ¬
    
*   AIåŸç”Ÿè®¾è®¡ï¼šé›†æˆé€šä¹‰åƒé—®å’Œé€šä¹‰ä¸‡åƒï¼Œå°†æ•°æ®åˆ†æç»“æœè½¬åŒ–ä¸ºå•†ä¸šæ´å¯Ÿå’Œè¥é”€ç´ æ
    
*   å®Œæ•´åˆ†æé“¾è·¯ï¼šä»è´­ç‰©ç¯®åˆ†æã€å•†å“å…³è”æŒ–æ˜åˆ°AIè¥é”€ç´ æç”Ÿæˆçš„å…¨æµç¨‹è‡ªåŠ¨åŒ–
    

è¿™ç§æ¶æ„æ¨¡å¼ç‰¹åˆ«é€‚åˆä¸­å°ä¼ä¸šå¿«é€Ÿæ„å»ºæ•°æ®åˆ†æèƒ½åŠ›ï¼Œä¹Ÿä¸ºå¤§å‹ä¼ä¸šçš„æ•°å­—åŒ–è½¬å‹æä¾›äº†è½»é‡çº§çš„è¯•ç‚¹æ–¹æ¡ˆã€‚åç»­å¯ä»¥æ‰©å±•æ”¯æŒæ›´å¤šæ•°æ®æºã€å¢åŠ å®æ—¶åˆ†æèƒ½åŠ›ï¼Œæˆ–é›†æˆæ›´å¤šAIæ¨¡å‹æ¥æ»¡è¶³ä¸åŒä¸šåŠ¡åœºæ™¯çš„éœ€æ±‚ã€‚

é€šè¿‡è¯¥Demoé¡¹ç›®ï¼Œç°ä»£äº‘æœåŠ¡å’ŒAIæŠ€æœ¯çš„ç»„åˆèƒ½å¤Ÿä»¥è¾ƒä½çš„æˆæœ¬å’Œå¤æ‚åº¦ï¼Œä¸ºä¼ ç»Ÿä¸šåŠ¡å¸¦æ¥æ™ºèƒ½åŒ–æå‡ã€‚