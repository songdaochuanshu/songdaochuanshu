---
layout: post
title: 'ã€æ¸²æŸ“ç®¡çº¿ã€‘UnityURPä¸­[æ¸²æŸ“è·¯å¾„]é€‰æ‹©â€Œ'
date: "2025-08-30T00:37:55Z"
---
ã€æ¸²æŸ“ç®¡çº¿ã€‘UnityURPä¸­\[æ¸²æŸ“è·¯å¾„\]é€‰æ‹©â€Œ
==========================

![ã€æ¸²æŸ“ç®¡çº¿ã€‘UnityURPä¸­[æ¸²æŸ“è·¯å¾„]é€‰æ‹©â€Œ](https://img2024.cnblogs.com/blog/3685400/202508/3685400-20250829095314919-888288675.png) æœ¬æ–‡æ·±å…¥è§£æUnity URPæ¸²æŸ“ç®¡çº¿æŠ€æœ¯ç‰¹ç‚¹ï¼Œé‡ç‚¹å¯¹æ¯”äº†Build-inä¸URPçš„æ ¸å¿ƒå·®å¼‚ã€‚URPåŸºäºSRPæ¶æ„ï¼Œæ”¯æŒåœ¨æ¸²æŸ“æµç¨‹ä¸­æ’å…¥è‡ªå®šä¹‰Passï¼Œæä¾›Forwardã€Deferredã€Forward+ç­‰å¤šç§æ¸²æŸ“è·¯å¾„ã€‚æ–‡ç« è¯¦ç»†æ‹†è§£äº†URPçš„æ¸²æŸ“é˜¶æ®µé¡ºåºï¼ˆä»BeforeRenderingåˆ°AfterRenderingå…±11ä¸ªå…³é”®èŠ‚ç‚¹ï¼‰ï¼Œå¹¶ç€é‡åˆ†æäº†å»¶è¿Ÿæ¸²æŸ“è·¯å¾„çš„æŠ€æœ¯å®ç°ï¼ŒåŒ…æ‹¬GBufferå¤„ç†ã€å…‰ç…§è®¡ç®—æµç¨‹å’ŒåŠé€æ˜ç‰©ä½“å‰å‘æ¸²æŸ“çš„ç‰¹æ®Šè§„åˆ™ã€‚é€šè¿‡Shaderé…ç½®ç¤ºä¾‹å’Œè°ƒè¯•æ–¹æ³•ï¼Œå±•ç¤ºäº†URPå»¶è¿Ÿæ¸²æŸ“è·¯å¾„ä¸‹&qu

URPåŸºäºSRPï¼Œç›¸æ¯”äºBuild-inçš„æ¸²æŸ“ç®¡çº¿ï¼Œè¿›ä¸€æ­¥å¼€æ”¾äº†æ¸²æŸ“æµæ°´çº¿ä¸­å„ä¸ªPassçš„é…ç½®ä¸å¯ç¼–ç¨‹æ€§ã€‚é™¤äº†å†…ç½®çš„Forwardå‰å‘æ¸²æŸ“è·¯å¾„ã€Deferredå»¶è¿Ÿæ¸²æŸ“è·¯å¾„ã€Forward+å‰å‘åŠ æ¸²æŸ“è·¯å¾„ï¼Œè¿™å‡ ç§æ¸²æŸ“è·¯å¾„ä¸­ç‰¹å®šéœ€è¦çš„æ¸²æŸ“Passä»¥å¤–ï¼Œå¯ä»¥åœ¨æ¸²æŸ“ç®¡çº¿_**å„ä¸ªé˜¶æ®µ**_æ’å…¥è‡ªå®šä¹‰Passæ¥å®Œæˆè‡ªå®šä¹‰æ“ä½œã€‚Build-inä¸å…·å¤‡ä¿®æ”¹ç®¡çº¿ä¸­çš„å„ä¸ªé˜¶æ®µæ’å…¥è‡ªå®šä¹‰Passçš„èƒ½åŠ›ã€‚

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

æ¸²æŸ“çš„å„ä¸ªé˜¶æ®µçš„äº‹ä»¶
==========

*   è¿™é‡Œåˆ—å‡ºæ¸²æŸ“çš„å„ä¸ªé˜¶æ®µçš„äº‹ä»¶æšä¸¾`RenderPassEvent`ï¼ˆcom.unity.render-pipelines.universal@14.0.12/Runtime/Passes/ScriptableRenderPass.csï¼‰ï¼Œä¾æ­¤ä¹Ÿå¯å¿«é€Ÿçœ‹å‡ºæ¸²æŸ“çš„æµç¨‹é¡ºåºï¼š
    
    > BeforeRenderingï¼ˆå¼€å§‹æ¸²æŸ“å‰ï¼‰ â†’ RenderingShadowsï¼ˆé˜´å½±æ¸²æŸ“ï¼‰ â†’  
    > RenderingPrePassesï¼ˆé¢„æ¸²æŸ“ï¼‰ â†’ RenderingGbufferï¼ˆG-bufferï¼‰ â†’  
    > RenderingDeferredLightsï¼ˆå»¶è¿Ÿç€è‰²ï¼‰ â†’ RenderingOpaquesï¼ˆæ¸²æŸ“ä¸é€æ˜ï¼‰ â†’  
    > RenderingSkyboxï¼ˆæ¸²æŸ“å¤©ç©ºç›’ï¼‰ â†’ RenderingTransparentsï¼ˆæ¸²æŸ“é€æ˜ï¼‰ â†’  
    > RenderingPostProcessingï¼ˆåå¤„ç†ï¼‰ â†’ AfterRenderingï¼ˆæ¸²æŸ“ç»“æŸåï¼‰
    

æšä¸¾å€¼

æ•°å€¼

æè¿°

BeforeRendering

0

åœ¨æ¸²æŸ“ç®¡çº¿ä¸­å…¶ä»–æ‰€æœ‰é€šé“ä¹‹å‰æ‰§è¡ŒScriptableRenderPassã€‚æ­¤æ—¶ç›¸æœºçŸ©é˜µå’Œç«‹ä½“æ¸²æŸ“å°šæœªè®¾ç½®ã€‚å¯ç”¨äºç»˜åˆ¶åæœŸç®¡çº¿ä¸­ä½¿ç”¨çš„è‡ªå®šä¹‰è¾“å…¥çº¹ç†ï¼Œå¦‚LUTçº¹ç†ã€‚

BeforeRenderingShadows

50

åœ¨æ¸²æŸ“é˜´å½±è´´å›¾ä¹‹å‰æ‰§è¡ŒScriptableRenderPassã€‚æ­¤æ—¶ç›¸æœºçŸ©é˜µå’Œç«‹ä½“æ¸²æŸ“å°šæœªè®¾ç½®ã€‚

AfterRenderingShadows

100

åœ¨æ¸²æŸ“é˜´å½±è´´å›¾ä¹‹åæ‰§è¡ŒScriptableRenderPassã€‚æ­¤æ—¶ç›¸æœºçŸ©é˜µå’Œç«‹ä½“æ¸²æŸ“å°šæœªè®¾ç½®ã€‚

BeforeRenderingPrePasses

150

åœ¨æ¸²æŸ“é¢„é€šé“(å¦‚æ·±åº¦é¢„é€šé“)ä¹‹å‰æ‰§è¡ŒScriptableRenderPassã€‚æ­¤æ—¶ç›¸æœºçŸ©é˜µå’Œç«‹ä½“æ¸²æŸ“å·²ç»è®¾ç½®å®Œæˆã€‚

AfterRenderingPrePasses

200

åœ¨æ¸²æŸ“é¢„é€šé“(å¦‚æ·±åº¦é¢„é€šé“)ä¹‹åæ‰§è¡ŒScriptableRenderPassã€‚æ­¤æ—¶ç›¸æœºçŸ©é˜µå’Œç«‹ä½“æ¸²æŸ“å·²ç»è®¾ç½®å®Œæˆã€‚

BeforeRenderingGbuffer

210

åœ¨æ¸²æŸ“G-bufferé€šé“ä¹‹å‰æ‰§è¡ŒScriptableRenderPassã€‚

AfterRenderingGbuffer

220

åœ¨æ¸²æŸ“G-bufferé€šé“ä¹‹åæ‰§è¡ŒScriptableRenderPassã€‚

BeforeRenderingDeferredLights

230

åœ¨æ¸²æŸ“å»¶è¿Ÿç€è‰²é€šé“ä¹‹å‰æ‰§è¡ŒScriptableRenderPassã€‚

AfterRenderingDeferredLights

240

åœ¨æ¸²æŸ“å»¶è¿Ÿç€è‰²é€šé“ä¹‹åæ‰§è¡ŒScriptableRenderPassã€‚

BeforeRenderingOpaques

250

åœ¨æ¸²æŸ“ä¸é€æ˜ç‰©ä½“ä¹‹å‰æ‰§è¡ŒScriptableRenderPassã€‚

AfterRenderingOpaques

300

åœ¨æ¸²æŸ“ä¸é€æ˜ç‰©ä½“ä¹‹åæ‰§è¡ŒScriptableRenderPassã€‚

BeforeRenderingSkybox

350

åœ¨æ¸²æŸ“å¤©ç©ºç›’ä¹‹å‰æ‰§è¡ŒScriptableRenderPassã€‚

AfterRenderingSkybox

400

åœ¨æ¸²æŸ“å¤©ç©ºç›’ä¹‹åæ‰§è¡ŒScriptableRenderPassã€‚

BeforeRenderingTransparents

450

åœ¨æ¸²æŸ“é€æ˜ç‰©ä½“ä¹‹å‰æ‰§è¡ŒScriptableRenderPassã€‚

AfterRenderingTransparents

500

åœ¨æ¸²æŸ“é€æ˜ç‰©ä½“ä¹‹åæ‰§è¡ŒScriptableRenderPassã€‚

BeforeRenderingPostProcessing

550

åœ¨æ¸²æŸ“åå¤„ç†æ•ˆæœä¹‹å‰æ‰§è¡ŒScriptableRenderPassã€‚

AfterRenderingPostProcessing

600

åœ¨æ¸²æŸ“åå¤„ç†æ•ˆæœä¹‹åæ‰§è¡ŒScriptableRenderPassï¼Œä½†åœ¨æœ€ç»ˆblitã€åå¤„ç†AAæ•ˆæœå’Œè‰²å½©åˆ†çº§ä¹‹å‰ã€‚

AfterRendering

1000

åœ¨æ‰€æœ‰æ•ˆæœæ¸²æŸ“å®Œæˆåæ‰§è¡ŒScriptableRenderPassã€‚

â€Œ**å‰å‘æ¸²æŸ“**â€Œ
==========

*   é€ç‰©ä½“å¤„ç†å…‰ç…§ï¼Œé€‚åˆç§»åŠ¨ç«¯å’Œç®€å•å…‰ç…§åœºæ™¯ã€‚

â€Œ**å»¶è¿Ÿæ¸²æŸ“**â€Œ
==========

*   åˆ†ç¦»å‡ ä½•ä¸å…‰ç…§è®¡ç®—ï¼Œåœ¨å±å¹•ç©ºé—´æ‰§è¡Œå…‰ç…§ï¼Œæ”¯æŒå¤§é‡åŠ¨æ€å…‰æºï¼Œä½†éœ€æ›´é«˜æ˜¾å­˜å¼€é”€ â€Œã€‚é…ç½®æ–¹å¼ï¼šURP Asset ä¸­è®¾ç½®æ¸²æŸ“è·¯å¾„ã€‚
*   **å»¶è¿Ÿæ¸²æŸ“è·¯å¾„ä¸‹GBufferPassé˜¶æ®µåï¼Œç®¡çº¿å†…éƒ¨ä¼šå›ºå®šå¤„ç†LightingPassé˜¶æ®µï¼Œè®¡ç®—å…‰ç…§è¾“å‡ºåˆ°ç¼“å†²åŒºçš„**

**ä¸€ã€å…‰ç…§è®¡ç®—æµç¨‹â€Œ**
-------------

### â€Œ**è¾“å…¥æ•°æ®æ¥æº**â€Œ

*   è¯»å–GBufferçº¹ç†ï¼ˆRT0-RT3ï¼‰ä¸­çš„æè´¨å±æ€§ï¼ˆæ¼«åå°„ã€æ³•çº¿ã€é«˜å…‰ç­‰ï¼‰
*   æ·±åº¦ç¼“å†²åŒºç”¨äºå¯è§æ€§åˆ¤æ–­å’Œå…‰æºè£å‰ª

### â€Œ**è®¡ç®—æ–¹å¼**â€Œ

*   å…¨å±å››è¾¹å½¢æˆ–å…‰æºå‡ ä½•ä½“é€åƒç´ å¤„ç†
*   å®šå‘å…‰å…¨å±€è®¡ç®—ï¼Œç‚¹/èšå…‰ç¯é€šè¿‡æ¨¡æ¿æµ‹è¯•å±€éƒ¨æ¸²æŸ“

### â€Œ**è¾“å‡ºç›®æ ‡**â€Œ

*   ç›´æ¥å†™å…¥å¸§ç¼“å†²åŒºï¼ˆFrame Bufferï¼‰å½¢æˆæœ€ç»ˆé¢œè‰²

* * *

**â€ŒäºŒã€å…³é”®å®ç°æ–‡ä»¶â€Œ**
--------------

### â€Œ**æ ¸å¿ƒç€è‰²å™¨**â€Œ

*   `Internal-DeferredShading.shader`ï¼šå†…ç½®å»¶è¿Ÿå…‰ç…§è®¡ç®—é€»è¾‘â€Œ
*   åŒ…å«å…‰æºç±»å‹åˆ†æ”¯ï¼ˆå®šå‘å…‰ã€ç‚¹å…‰æºã€èšå…‰ç¯ï¼‰å’Œé˜´å½±å¤„ç†

### â€Œ**HLSLå·¥å…·åº“**â€Œ

*   `UnityDeferredLibrary.hlsl`ï¼šæä¾›å…‰ç…§æ¨¡å‹å‡½æ•°ï¼ˆå¦‚Blinn-Phong/PBRï¼‰â€Œ
*   `UnityGBuffer.hlsl`ï¼šå®šä¹‰GBufferæ•°æ®ç¼–ç /è§£ç æ–¹æ³•â€Œ

### â€Œ**C#ç®¡çº¿æ§åˆ¶**â€Œ

*   `DeferredLights.cs`ï¼šç®¡ç†GBufferåˆ›å»ºä¸å…‰ç…§Passè°ƒåº¦â€Œ

* * *

**â€Œä¸‰ã€æŠ€æœ¯ç‰¹æ€§â€Œ**
------------

### â€Œ**æ€§èƒ½ä¼˜åŒ–**â€Œ

*   é€šè¿‡å…‰æºä½“ç§¯å‰”é™¤å’Œæ¨¡æ¿æµ‹è¯•å‡å°‘æ— æ•ˆè®¡ç®—

### â€Œ**æ‰©å±•æ€§**â€Œ

*   å¯é€šè¿‡æ›¿æ¢`Internal-DeferredShading.shader`è‡ªå®šä¹‰å…‰ç…§æ¨¡å‹â€Œ
*   å»¶è¿Ÿæ¸²æŸ“è·¯å¾„ä¸‹ï¼Œé€æ˜åºåˆ—çš„ç‰©ä½“ä½¿ç”¨LightModeä¸ºUniversalForwardçš„passæ¥æ¸²æŸ“åŠé€æ˜ç‰©ä½“
*   åœ¨Unity URPå»¶è¿Ÿæ¸²æŸ“è·¯å¾„ä¸‹ï¼Œâ€Œ**è®¾ç½®`LightMode="UniversalForward"`çš„Passä¼šè¢«æ‰§è¡Œ**â€Œï¼Œä½†ä»…é’ˆå¯¹ç‰¹å®šç±»å‹çš„ç‰©ä½“ã€‚ä»¥ä¸‹æ˜¯å…·ä½“è§„åˆ™ï¼š

**â€Œä¸€ã€å»¶è¿Ÿæ¸²æŸ“è·¯å¾„ä¸‹çš„å‰å‘Passæ‰§è¡Œè§„åˆ™â€Œ**
--------------------------

### â€Œ**åŠé€æ˜ç‰©ä½“å¼ºåˆ¶å‰å‘æ¸²æŸ“**â€Œ

*   æ‰€æœ‰æ ‡è®°ä¸º`"Queue"="Transparent"`çš„ç‰©ä½“ï¼Œå³ä½¿ç®¡çº¿ä½¿ç”¨å»¶è¿Ÿæ¸²æŸ“è·¯å¾„ï¼Œå…¶`LightMode="UniversalForward"`çš„Passä»ä¼šè¢«æ‰§è¡Œ
*   åŸå› ï¼šå»¶è¿Ÿæ¸²æŸ“æ— æ³•å¤„ç†é€æ˜åº¦æ··åˆï¼Œéœ€é€€å›å‰å‘è·¯å¾„

### â€Œ**ä¸é€æ˜ç‰©ä½“çš„ä¾‹å¤–**â€Œ

*   ä¸é€æ˜ç‰©ä½“ï¼ˆ`"Queue"="Geometry"`ï¼‰çš„`UniversalForward`Â Passåœ¨å»¶è¿Ÿè·¯å¾„ä¸‹â€Œ**ä¸ä¼šæ‰§è¡Œ**â€Œ
*   æ­¤ç±»ç‰©ä½“ç»Ÿä¸€ç”±GBuffer Passï¼ˆ`LightMode="UniversalGBuffer"`ï¼‰å¤„ç†

* * *

**â€ŒäºŒã€æŠ€æœ¯å®ç°åŸç†â€Œ**
--------------

â€Œ**ç®¡çº¿é˜¶æ®µ**â€Œ

â€Œ**æ‰§è¡Œå†…å®¹**â€Œ

â€Œ**ç›¸å…³Passçš„LightMode**â€Œ

â€Œ**ä¸é€æ˜ç‰©ä½“é˜¶æ®µ**â€Œ

å†™å…¥GBufferï¼ˆé¢œè‰²ã€æ³•çº¿ã€æè´¨å±æ€§ç­‰ï¼‰

`UniversalGBuffer`

â€Œ**å…‰ç…§è®¡ç®—é˜¶æ®µ**â€Œ

åŸºäºGBufferè¿›è¡Œå±å¹•ç©ºé—´å…‰ç…§å åŠ 

å†…ç½®ç®¡çº¿Passï¼ˆæ— LightModeæ ‡ç­¾ï¼‰

â€Œ**åŠé€æ˜ç‰©ä½“é˜¶æ®µ**â€Œ

æŒ‰å‰å‘æ¸²æŸ“æ–¹å¼é€ç‰©ä½“è®¡ç®—å…‰ç…§ï¼Œæ··åˆåˆ°å¸§ç¼“å†²åŒº

`UniversalForward`

> å…‰ç…§è®¡ç®—ç”±URPå†…ç½®ç€è‰²å™¨Internal-DeferredShading.shaderå®Œæˆï¼Œä¸ä¾èµ–æè´¨Shaderä¸­çš„Pass

* * *

**â€Œä¸‰ã€éªŒè¯ä¸å®è·µè¦ç‚¹â€Œ**
---------------

### â€Œ**Shaderé…ç½®ç¤ºä¾‹**â€Œ

*   åŠé€æ˜ç‰©ä½“å¿…é¡»æ˜¾å¼å£°æ˜å‰å‘æ ‡ç­¾ï¼š

    SubShader {
        Tags { "Queue" = "Transparent" }
        Pass {
            Tags { "LightMode" = "UniversalForward" } // å»¶è¿Ÿè·¯å¾„ä¸‹ä»ä¼šæ‰§è¡Œ
            Blend SrcAlpha OneMinusSrcAlpha
            ZWrite Off
            ...
        }
    } 
    

### â€Œ**è°ƒè¯•æ–¹æ³•**â€Œ

*   ä½¿ç”¨â€Œ**Frame Debugger**â€Œå·¥å…·å¯è§‚å¯Ÿåˆ°ï¼š
    *   ä¸é€æ˜ç‰©ä½“ä»…æ˜¾ç¤º`Render Opaques`å’Œ`GBuffer`ç›¸å…³æ¡ç›®
    *   åŠé€æ˜ç‰©ä½“æ˜¾ç¤º`Render Transparents`æ¡ç›®å¹¶æ‰§è¡Œ`UniversalForward`Â Pass

* * *

**â€Œå››ã€åº•å±‚æœºåˆ¶è¯´æ˜â€Œ**
--------------

*   URPå»¶è¿Ÿè·¯å¾„æœ¬è´¨ä¸Šæ˜¯â€Œ**æ··åˆæ¸²æŸ“æ–¹æ¡ˆ**â€Œï¼š
    
*   ä¸é€æ˜ç‰©ä½“ â†’ â€Œ**å»¶è¿Ÿæ¸²æŸ“**â€Œï¼ˆGBuffer + å±å¹•ç©ºé—´å…‰ç…§ï¼‰
    
*   åŠé€æ˜/ç‰¹æ®Šæ•ˆæœç‰©ä½“ â†’ â€Œ**å‰å‘æ¸²æŸ“**â€Œï¼ˆé€ç‰©ä½“å…‰ç…§è®¡ç®—ï¼‰è¿™ç§è®¾è®¡å…¼é¡¾äº†ä¸é€æ˜ç‰©ä½“çš„å…‰ç…§æ€§èƒ½ä¸ç‰¹æ®Šæè´¨çš„çµæ´»æ€§
    

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰