---
layout: post
title: 'ä»0åˆ°1ï¼Œå¿«é€Ÿè®­ç»ƒå¹¶ä½¿ç”¨YOLOæ¨¡å‹'
date: "2026-02-02T00:58:30Z"
---
ä»0åˆ°1ï¼Œå¿«é€Ÿè®­ç»ƒå¹¶ä½¿ç”¨YOLOæ¨¡å‹
==================

ç®€ä»‹
==

**YOLO**æ˜¯ç›®å‰è®¡ç®—æœºè§†è§‰é¢†åŸŸæœ€å‰æ²¿ã€åº”ç”¨æœ€å¹¿æ³›çš„**ç›®æ ‡æ£€æµ‹**ç®—æ³•æ¡†æ¶ï¼Œä»–èƒ½å¿«é€Ÿè¯†åˆ«åŒºåˆ†ç›®æ ‡ï¼Œå¹¿æ³›åº”ç”¨äºæ¸¸æˆï¼Œæ— äººé©¾é©¶ï¼Œå·¥ä¸šç­‰é¢†åŸŸã€‚

ä»¥è¯†åˆ«èº²é¿æ‰è½æ»‘å—çš„æ¸¸æˆçš„ç‰©ä½“å›¾ç‰‡ä½œä¸ºä¾‹å­ã€‚

ä¸€ï¼Œç¯å¢ƒé…ç½®
======

    pip install ultralytics
    

äºŒï¼Œå‡†å¤‡æ•°æ®é›†
=======

è¿™ä¸ªæ ¼å¼ç›®å½•å¦‚ä¸‹ï¼š

    my_dataset/
    â”œâ”€â”€ data.yaml # é…ç½®æ–‡ä»¶ï¼ˆå®šä¹‰è·¯å¾„å’Œç±»åˆ«ï¼‰
    â”œâ”€â”€ train/ #è®­ç»ƒæ•°æ®é›†
    â”‚   â”œâ”€â”€ images/ # è®­ç»ƒå›¾ç‰‡
    â”‚   â””â”€â”€ labels/ # æ ‡æ³¨æ–‡ä»¶ (.txt)
    â””â”€â”€ val/ #éªŒè¯æ•°æ®é›†
        â”œâ”€â”€ images/ 
        â””â”€â”€ labels/ 
    

### data.yml

    path: D:\D_MyProject\Ai\game_ai\my_dataset #æ•°æ®é›†è·¯å¾„
    train: train/images #è®­ç»ƒé›†å›¾ç‰‡è·¯å¾„
    val: val/images #éªŒè¯é›†å›¾ç‰‡è·¯å¾„
    
    nc: 3 #æ ‡è®°ä¸ªæ•°
    names:  #æ¯ä¸ªæ ‡è®°çš„åç§°
    Â  0: player
    Â  1: enemy
    Â  2: game_over
    

### ä¸‹é¢æ˜¯ç”¨AIç”Ÿæˆäº†æ•°æ®é›†çš„ç”Ÿæˆè„šæœ¬

æ•°æ®é‡å¤ªå¤šäº†ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ–è€…å­¦ä¹ ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢è„šæœ¬

    import pygame
    import random
    import sys
    import os
    import shutil
    
    # =================é…ç½®åŒºåŸŸ=================
    # æ•°æ®é›†æ ¹ç›®å½•åç§°
    DATASET_ROOT = "my_dataset"
    # é‡‡é›†æ€»æ•°é‡
    MAX_IMAGES = 1000
    # è®­ç»ƒé›†å æ¯” (0.8 = 80% è®­ç»ƒ, 20% éªŒè¯)
    TRAIN_RATIO = 0.8
    
    # ================= 1. ç¯å¢ƒæ¸…ç†ä¸ç›®å½•åˆ›å»º =================
    print(f"ğŸš€ æ­£åœ¨åˆå§‹åŒ–æ•°æ®é›†ç›®å½•: {DATASET_ROOT} ...")
    
    # å¦‚æœç›®å½•å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤ï¼ˆé˜²æ­¢æ—§æ•°æ®æ··å…¥ï¼‰ï¼Œç¡®ä¿æ•°æ®çº¯å‡€
    if os.path.exists(DATASET_ROOT):
        shutil.rmtree(DATASET_ROOT)
    
    # åˆ›å»º YOLO æ ‡å‡†ç›®å½•ç»“æ„
    for split in ['train', 'val']:
        os.makedirs(os.path.join(DATASET_ROOT, split, 'images'), exist_ok=True)
        os.makedirs(os.path.join(DATASET_ROOT, split, 'labels'), exist_ok=True)
    
    # ================= 2. è‡ªåŠ¨ç”Ÿæˆ data.yaml =================
    yaml_content = f"""
    path: {os.path.abspath(DATASET_ROOT)} # ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œé˜²æ­¢æŠ¥é”™
    train: train/images
    val: val/images
    
    nc: 3
    names:
      0: player
      1: enemy
      2: game_over
    """
    with open(os.path.join(DATASET_ROOT, "data.yaml"), "w", encoding='utf-8') as f:
        f.write(yaml_content)
    print("âœ… data.yaml é…ç½®æ–‡ä»¶å·²ç”Ÿæˆã€‚")
    
    # ================= 3. æ¸¸æˆä¸é‡‡é›†é€»è¾‘ =================
    pygame.init()
    WIDTH, HEIGHT = 800, 600
    # ä½¿ç”¨ hidden æ¨¡å¼æˆ–æ­£å¸¸æ¨¡å¼å‡å¯ï¼Œè¿™é‡Œç”¨æ­£å¸¸æ¨¡å¼æ–¹ä¾¿ä½ çœ‹åˆ°è¿›åº¦
    screen = pygame.display.set_mode((WIDTH, HEIGHT))
    pygame.display.set_caption("Auto Data Generator")
    clock = pygame.time.Clock()
    
    font_big = pygame.font.SysFont("monospace", 50)
    font_small = pygame.font.SysFont("monospace", 35)
    
    # æ¸¸æˆçŠ¶æ€
    player_size, enemy_size = 50, 50
    player_x = WIDTH // 2
    player_y = HEIGHT - player_size - 10
    enemies = []
    
    img_count = 0
    GAMEPLAY_LIMIT = int(MAX_IMAGES * 0.9) # 90% æ­£å¸¸æ¸¸æˆï¼Œ10% Game Over
    
    print(f"ğŸ“¸ å¼€å§‹é‡‡é›† {MAX_IMAGES} å¼ å›¾ç‰‡ (è‡ªåŠ¨åˆ’åˆ† Train/Val)...")
    
    while img_count < MAX_IMAGES:
        # å¤„ç†é€€å‡ºäº‹ä»¶ï¼Œé˜²æ­¢å¡æ­»
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
                sys.exit()
    
        screen.fill((0, 0, 0))
        labels = [] # å­˜å‚¨å½“å‰å¸§çš„æ ‡ç­¾
        dw, dh = 1.0 / WIDTH, 1.0 / HEIGHT # å½’ä¸€åŒ–ç³»æ•°
    
        # --- é€»è¾‘åˆ†æ”¯ï¼šæ­£å¸¸æ¸¸æˆ vs Game Over ---
        if img_count < GAMEPLAY_LIMIT:
            # A. æ­£å¸¸æ¸¸æˆç”»é¢
            # 1. ç©å®¶ç§»åŠ¨
            if random.random() < 0.2: # å¢åŠ ç§»åŠ¨é¢‘ç‡
                player_x += random.choice([-15, 15])
                player_x = max(0, min(WIDTH - player_size, player_x))
    
            # 2. æ•Œäººç”Ÿæˆä¸ç§»åŠ¨
            if random.randint(0, 20) == 0: # å¢åŠ æ•Œäººå¯†åº¦
                enemies.append([random.randint(0, WIDTH - enemy_size), 0])
            
            for enemy in enemies: enemy[1] += 15 # åŠ å¿«ä¸‹è½é€Ÿåº¦
            enemies = [e for e in enemies if e[1] < HEIGHT]
    
            # 3. ç»˜åˆ¶ç©å®¶ (Class 0)
            pygame.draw.rect(screen, (50, 150, 255), (player_x, player_y, player_size, player_size))
            # è®¡ç®— YOLO åæ ‡ (class x_center y_center width height)
            px, py = (player_x + player_size/2) * dw, (player_y + player_size/2) * dh
            labels.append(f"0 {px:.6f} {py:.6f} {player_size*dw:.6f} {player_size*dh:.6f}")
    
            # 4. ç»˜åˆ¶æ•Œäºº (Class 1)
            for e in enemies:
                pygame.draw.rect(screen, (255, 50, 50), (e[0], e[1], enemy_size, enemy_size))
                ex, ey = (e[0] + enemy_size/2) * dw, (e[1] + enemy_size/2) * dh
                labels.append(f"1 {ex:.6f} {ey:.6f} {enemy_size*dw:.6f} {enemy_size*dh:.6f}")
    
        else:
            # B. Game Over ç”»é¢ (Class 2)
            text_surf = font_big.render("GAME OVER", True, (255, 50, 50))
            
            # éšæœºæŠ–åŠ¨ä½ç½®ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ
            off_x, off_y = random.randint(-50, 50), random.randint(-50, 50)
            text_x = WIDTH // 2 - text_surf.get_width() // 2 + off_x
            text_y = HEIGHT // 2 - 100 + off_y
            screen.blit(text_surf, (text_x, text_y))
    
            # å¹²æ‰°é¡¹
            score_surf = font_small.render(f"Score: {random.randint(0,999)}", True, (255,255,255))
            screen.blit(score_surf, (WIDTH//2 - score_surf.get_width()//2, HEIGHT//2 + 50))
    
            # è®°å½•æ ‡ç­¾
            tw, th = text_surf.get_width(), text_surf.get_height()
            tx, ty = (text_x + tw/2) * dw, (text_y + th/2) * dh
            labels.append(f"2 {tx:.6f} {ty:.6f} {tw*dw:.6f} {th*dh:.6f}")
    
        # ================= 4. ä¿å­˜é€»è¾‘ (æ ¸å¿ƒä¿®æ”¹) =================
        pygame.display.flip()
        
        # é‡‡æ ·ç‡ï¼šä¸æ˜¯æ¯ä¸€å¸§éƒ½ä¿å­˜ï¼Œé˜²æ­¢é‡å¤åº¦è¿‡é«˜ (è¿™é‡Œè®¾ä¸º 30% æ¦‚ç‡ä¿å­˜)
        if random.random() < 0.3:
            # A. å†³å®šæ˜¯å» Train è¿˜æ˜¯ Val
            split_folder = "train" if random.random() < TRAIN_RATIO else "val"
            
            # B. ç”Ÿæˆæ–‡ä»¶å
            filename = f"{img_count:06d}"
            img_save_path = os.path.join(DATASET_ROOT, split_folder, "images", f"{filename}.jpg")
            lbl_save_path = os.path.join(DATASET_ROOT, split_folder, "labels", f"{filename}.txt")
    
            # C. ä¿å­˜å›¾ç‰‡
            pygame.image.save(screen, img_save_path)
    
            # D. ä¿å­˜æ ‡ç­¾
            with open(lbl_save_path, "w") as f:
                f.write("\n".join(labels))
    
            img_count += 1
            
            # æ‰“å°è¿›åº¦æ¡
            print(f"[{split_folder.upper()}] è¿›åº¦: {img_count}/{MAX_IMAGES}", end="\r")
    
        # åŠ é€Ÿæ¨¡æ‹Ÿï¼Œä¸è¦å‚ç›´åŒæ­¥ï¼Œè¶Šå¿«è¶Šå¥½
        clock.tick(0) 
    
    pygame.quit()
    print(f"\n\nâœ¨ å…¨éƒ¨å®Œæˆï¼æ•°æ®é›†å·²å°±ç»ªï¼š{os.path.abspath(DATASET_ROOT)}")
    print("ğŸ’¡ ä¸‹ä¸€æ­¥ï¼šç›´æ¥è¿è¡Œ model.train(data='my_dataset/data.yaml')")
    

ä¸‰ï¼Œè®­ç»ƒYOLOæ¨¡å‹
==========

å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨`ultralytics`æ¡†æ¶è®­ç»ƒYOLOçš„ä»£ç éå¸¸ç®€å•ï¼Œåªéœ€è¦å‡ è¡Œ  
**æ³¨æ„ï¼šè¿™é‡ŒYOLOä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹å¹¶è®­ç»ƒï¼Œä¸‹è½½æ—¶å¤±è´¥å¯èƒ½éœ€è¦æŒ‚æ¢¯å­**

    from ultralytics import YOLO
    
    def train_model():
        #åŠ è½½æ¨¡å‹
        model = YOLO("yolo11n.pt") 
    
        #å¼€å§‹è®­ç»ƒ
        print("å¼€å§‹è®­ç»ƒ...")
        results = model.train(
            data="my_dataset/data.yaml", #æ•°æ®é›†é…ç½®æ–‡ä»¶
            epochs=30, #è®­ç»ƒè½®æ•°
            imgsz=640, #å›¾ç‰‡è¾“å…¥å°ºå¯¸
            batch=16, #æ˜¾å­˜å¤Ÿå¤§å¯ä»¥æ”¹å¤§ï¼Œæ¯”å¦‚ 32 æˆ– 64
            device=0, #å¼ºåˆ¶ä½¿ç”¨ç¬¬ä¸€å¼ æ˜¾å¡ (éœ€è¦CUDA)
            workers=0, #Windowsä¸‹è®¾ä¸º0é˜²æ­¢å¤šè¿›ç¨‹æŠ¥é”™
            project="dodge_project",#ä¿å­˜è·¯å¾„
            name="ai_model" #è®­ç»ƒè¿è¡Œåç§°
        )
        print(f"è®­ç»ƒå®Œæˆï¼æœ€ä½³æ¨¡å‹ä¿å­˜åœ¨: {results.save_dir}/weights/best.pt")
    
    if __name__ == "__main__":
        train_model()
    

å››ï¼Œä½¿ç”¨YOLOæ¨¡å‹
==========

    from ultralytics import YOLO
    
    #é…ç½®è·¯å¾„
    MODEL_PATH = "dodge_project/ai_model/weights/best.pt" 
    PIC_PATH = "my_dataset/val/images/000045.jpg"
    
    #åŠ è½½æ¨¡å‹
    model = YOLO(MODEL_PATH)
    print(f"æ¨¡å‹åŠ è½½æˆåŠŸ")
    
    #è¯†åˆ«å›¾ç‰‡
    results = model.predict(PIC_PATH, verbose=False, conf=0.4, imgsz=640)
    result = results[0]
    
    #è·å–ä¿¡æ¯å¹¶æ‰“å°
    for box in result.boxes:
        # è·å–åæ ‡ (x1, y1, x2, y2)ã€ç±»åˆ« ID å’Œç½®ä¿¡åº¦
        x1, y1, x2, y2 = map(int, box.xyxy[0])
        cls_id = int(box.cls[0])
        conf = float(box.conf[0])
        
        # ç±»åˆ«åç§°æ˜ å°„
        names = {0: "Player", 1: "Enemy", 2: "Game Over"}
        label = names.get(cls_id, f"Unknown({cls_id})")
        print(f"æ‰¾åˆ°ç‰©ä½“: [{label:10}] | ç½®ä¿¡åº¦: {conf:.2f} | åæ ‡: ({x1}, {y1}) -> ({x2}, {y2})")
    
    #å±•ç¤ºå›¾ç‰‡
    result.show()
    

**å¦‚æœâ¤å–œæ¬¢â¤æœ¬ç³»åˆ—æ•™ç¨‹ï¼Œå°±ç‚¹ä¸ªå…³æ³¨å§ï¼Œåç»­ä¸å®šæœŸæ›´æ–°~**