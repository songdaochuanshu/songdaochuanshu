---
layout: post
title: 'ä½¿ç”¨systemd ç›‘æ§æœåŠ¡å¹¶å®ç°æ•…éšœè‡ªåŠ¨é‡å¯'
date: "2025-07-06T00:47:46Z"
---
ä½¿ç”¨systemd ç›‘æ§æœåŠ¡å¹¶å®ç°æ•…éšœè‡ªåŠ¨é‡å¯
-----------------------

ğŸ”§ ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨é‡å¯ï¼Ÿ
---------------

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒæœåŠ¡å¯èƒ½å› å†…å­˜æº¢å‡ºã€èµ„æºç«äº‰ã€å¤–éƒ¨ä¾èµ–ä¸­æ–­ç­‰é—®é¢˜æ„å¤–å´©æºƒã€‚æ‰‹åŠ¨æ¢å¤æ•ˆç‡ä½ä¸‹ï¼Œè€Œ **systemd çš„è‡ªåŠ¨é‡å¯æœºåˆ¶**å¯åœ¨ç§’çº§å†…æ¢å¤æœåŠ¡ï¼Œæ˜¾è‘—æå‡ç³»ç»Ÿå¯ç”¨æ€§ã€‚

* * *

âš™ï¸ äºŒã€systemd è‡ªåŠ¨é‡å¯çš„æ ¸å¿ƒé…ç½®
----------------------

### 1\. **æœåŠ¡æ–‡ä»¶å…³é”®å‚æ•°**

åœ¨ `/etc/systemd/system/your-service.service` ä¸­å®šä¹‰ä»¥ä¸‹å‚æ•°ï¼š

    [Service]
    Restart=on-failure   # æœåŠ¡å¼‚å¸¸é€€å‡ºæ—¶é‡å¯ï¼ˆæ¨èï¼‰
    RestartSec=10s        # é‡å¯å‰ç­‰å¾…æ—¶é—´ï¼ˆé¿å…é¢‘ç¹é‡å¯ï¼‰
    StartLimitIntervalSec=300 # 300ç§’å†…æœ€å¤šé‡å¯æ¬¡æ•°
    StartLimitBurst=5     # æœ€å¤šå°è¯•5æ¬¡é‡å¯
    

### 2\. **é‡å¯ç­–ç•¥è¯¦è§£**

**ç­–ç•¥**

é€‚ç”¨åœºæ™¯

`Restart=on-failure`

æœåŠ¡å› é”™è¯¯ï¼ˆéé›¶é€€å‡ºç ï¼‰ç»ˆæ­¢æ—¶é‡å¯ï¼Œé€‚åˆéœ€æ‰‹åŠ¨å¹²é¢„çš„åœºæ™¯ï¼ˆå¦‚è°ƒè¯•ï¼‰

`Restart=always`

æ— æ¡ä»¶é‡å¯ï¼ˆåŒ…æ‹¬æ­£å¸¸é€€å‡ºï¼‰ï¼Œé€‚ç”¨äºæ•°æ®åº“ã€WebæœåŠ¡å™¨ç­‰å…³é”®æœåŠ¡

### 3\. **é˜²å´©æºƒä¿æŠ¤æœºåˆ¶**

    StartLimitIntervalSec=60
    StartLimitBurst=3
    

è‹¥æœåŠ¡åœ¨ **60ç§’å†…å´©æºƒè¶…è¿‡3æ¬¡**ï¼Œsystemd å°†åœæ­¢é‡å¯å¹¶æ ‡è®°ä¸ºå¤±è´¥çŠ¶æ€ï¼Œé˜²æ­¢èµ„æºè€—å°½ã€‚

* * *

ğŸ› ï¸ ä¸‰ã€å®æˆ˜é…ç½®ç¤ºä¾‹ï¼ˆä»¥Spring Bootåº”ç”¨ä¸ºä¾‹ï¼‰
------------------------------

    [Unit]
    Description=Spring Boot Application
    After=network.target postgresql.service  # ä¾èµ–ç½‘ç»œå’Œæ•°æ®åº“
    
    [Service]
    User=appuser
    ExecStart=/usr/bin/java -jar /opt/app.jar
    Restart=on-failure
    RestartSec=30s
    Environment="DB_URL=jdbc:postgresql://localhost/db"
    StartLimitIntervalSec=300
    StartLimitBurst=5
    
    # æ—¥å¿—é‡å®šå‘ï¼ˆå¯é€‰ï¼‰
    StandardOutput=file:/var/log/myapp.log
    StandardError=file:/var/log/myapp-error.log
    
    [Install]
    WantedBy=multi-user.target
    

**æ“ä½œå‘½ä»¤**ï¼š

    sudo systemctl daemon-reload              # é‡è½½é…ç½®
    sudo systemctl enable your-service        # å¼€æœºè‡ªå¯
    sudo systemctl start your-service         # ç«‹å³å¯åŠ¨
    

* * *

ğŸ” å››ã€æ•…éšœæ’æŸ¥æŠ€å·§
-----------

1.  **æŸ¥çœ‹å®æ—¶çŠ¶æ€**ï¼š
    
        systemctl status your-service  # æ£€æŸ¥è¿è¡ŒçŠ¶æ€å’Œæœ€è¿‘é”™è¯¯
        
    
2.  **è¿½è¸ªæ—¥å¿—**ï¼š
    
        journalctl -u your-service -f  # å®æ—¶æ—¥å¿—
        
    
3.  **æµ‹è¯•è‡ªåŠ¨é‡å¯**ï¼š
    
        sudo kill -9 $(pgrep -f "app.jar")  # æ¨¡æ‹Ÿå´©æºƒ
        systemctl status your-service      # ç¡®è®¤æ˜¯å¦åœ¨30ç§’åé‡å¯
        
    

* * *

âš ï¸ äº”ã€é¿å‘æŒ‡å—
---------

1.  **æƒé™é—®é¢˜**ï¼šè‹¥æœåŠ¡ä»¥é root ç”¨æˆ·è¿è¡Œï¼Œéœ€ç¡®ä¿è¯¥ç”¨æˆ·å¯¹æ–‡ä»¶è·¯å¾„æœ‰è¯»å†™æƒé™ã€‚
2.  **ç¯å¢ƒå˜é‡ç¼ºå¤±**ï¼šé€šè¿‡ `Environment` æ˜¾å¼å£°æ˜å˜é‡ï¼ˆå¦‚ `JAVA_HOME`ï¼‰ã€‚
3.  **èµ„æºæ³„æ¼**ï¼šé¢‘ç¹é‡å¯å¯èƒ½åŠ å‰§èµ„æºæ¶ˆè€—ï¼Œå»ºè®®ç»“åˆ `cgroups` é™åˆ¶å†…å­˜/CPUï¼š
    
        MemoryLimit=1G   # é™åˆ¶å†…å­˜ä¸º1GB
        CPUQuota=80%     # é™åˆ¶CPUä½¿ç”¨ç‡
        
    

* * *

ğŸ’¡ å…­ã€è¿›é˜¶æŠ€å·§
---------

*   **å¤šå®ä¾‹æœåŠ¡**ï¼šä½¿ç”¨æ¨¡æ¿åˆ›å»ºå¤šä¸ªå®ä¾‹ï¼ˆå¦‚ `app@1.service`ã€`app@2.service`ï¼‰ã€‚
*   **å®‰å…¨éš”ç¦»**ï¼šå¯ç”¨æ²™ç›’æ¨¡å¼å¢å¼ºå®‰å…¨æ€§ï¼š
    
        PrivateTmp=true         # ç‹¬ç«‹ä¸´æ—¶ç›®å½•
        ProtectSystem=strict     # ç¦æ­¢å†™å…¥ç³»ç»Ÿæ–‡ä»¶
        
    
*   **çœ‹é—¨ç‹—æœºåˆ¶**ï¼šé…åˆ `WatchdogSec=30` å®ç°åº”ç”¨çº§å¿ƒè·³æ£€æµ‹ã€‚

* * *

ğŸ’ æ€»ç»“
-----

**\> systemd çš„è‡ªåŠ¨é‡å¯ä¸æ˜¯ç®€å•çš„â€œé‡å¯å¼€å…³â€ï¼Œè€Œæ˜¯èåˆäº†ç†”æ–­æœºåˆ¶ã€ä¾èµ–ç®¡ç†ã€èµ„æºéš”ç¦»çš„ä¼ä¸šçº§è¿ç»´æ–¹æ¡ˆã€‚**  
é€šè¿‡åˆç†é…ç½® `Restart` ç­–ç•¥ä¸èµ„æºé™åˆ¶ï¼Œå¯å°†æœåŠ¡åœæœºæ—¶é—´ç¼©çŸ­è‡³ç§’çº§ï¼ŒåŒæ—¶é¿å…å´©æºƒå¾ªç¯å¼•å‘çš„é›ªå´©æ•ˆåº”ã€‚å…¶æ—¥å¿—é›†æˆï¼ˆ`journalctl`ï¼‰å’ŒçŠ¶æ€ç›‘æ§ï¼ˆ`systemctl status`ï¼‰èƒ½åŠ›ï¼Œè¿›ä¸€æ­¥é™ä½äº†è¿ç»´å¤æ‚åº¦ã€‚

> **è¡ŒåŠ¨å»ºè®®**ï¼š  
> ä¸‹æ¬¡éƒ¨ç½²æœåŠ¡æ—¶ï¼Œ**åˆ«å†ç”¨ `nohup` äº†**ï¼èŠ± 5 åˆ†é’Ÿå†™ä¸€ä¸ª systemd å•å…ƒæ–‡ä»¶ï¼Œè®©ç³»ç»Ÿè‡ªåŠ¨å®ˆæŠ¤ä½ çš„è¿›ç¨‹ã€‚

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š[dashery](https://www.cnblogs.com/ydswin/)ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/ydswin/p/18967243](https://www.cnblogs.com/ydswin/p/18967243)

posted on 2025-07-05 15:07Â  [dashery](https://www.cnblogs.com/ydswin)Â  é˜…è¯»(67)Â  è¯„è®º(0)Â  Â  [æ”¶è—](javascript:void\(0\))Â  [ä¸¾æŠ¥](javascript:void\(0\))