---
layout: post
title: 'kubectl pluginï¼šneat çš„å®‰è£…ä¸ä½¿ç”¨'
date: "2026-01-24T00:44:59Z"
---
kubectl pluginï¼šneat çš„å®‰è£…ä¸ä½¿ç”¨
==========================

å‰è¨€
==

åœ¨ä½¿ç”¨ `kubectl get $KIND -o yaml` æŸ¥çœ‹ k8s èµ„æºæ—¶ï¼Œè¾“å‡ºç»“æœä¸­åŒ…å«å¤§é‡ç”±é›†ç¾¤è‡ªåŠ¨ç”Ÿæˆçš„å…ƒæ•°æ®ï¼ˆå¦‚ `managedFields`ã€`resourceVersion`ã€`uid` ç­‰ï¼‰ã€‚è¿™äº›ä¿¡æ¯åœ¨å®é™…å¤ç”¨ yaml æ¸…å•æ—¶éœ€è¦æ‰‹åŠ¨æ¸…ç†ï¼Œå¢åŠ äº†é¢å¤–çš„å·¥ä½œé‡ã€‚

ä½¿ç”¨ [kubectl-neat](https://github.com/itaysk/kubectl-neat) æ’ä»¶ï¼Œå¯ä»¥è‡ªåŠ¨ç§»é™¤è¿™äº›ç”±é›†ç¾¤ç”Ÿæˆçš„å†—ä½™å­—æ®µï¼Œä»…ä¿ç•™æœ‰æ„ä¹‰çš„å†…å®¹ï¼Œä½¿ yaml æ›´åŠ ç®€æ´ï¼Œæ–¹ä¾¿å¤ç”¨ã€‚

å®‰è£…
==

æ’ä»¶æ–¹å¼å®‰è£…
------

    kubectl krew install neat
    
    ## ä½œä¸º kubectl æ’ä»¶å®‰è£…,ä½¿ç”¨æ–¹å¼ä¸º:
    kubectl neat
    

äºŒè¿›åˆ¶æ–¹å¼å®‰è£…
-------

    ## ç‰ˆæœ¬é€‰æ‹©:
    ## https://github.com/itaysk/kubectl-neat/releases
    
    ## å½“å‰ç¯å¢ƒä¸º ubuntu 2404 LTS
    wget https://github.com/itaysk/kubectl-neat/releases/download/v2.0.4/kubectl-neat_linux_amd64.tar.gz
    tar xf kubectl-neat_linux_amd64.tar.gz
    mv ./kubectl-neat /usr/local/bin/
    
    ## åˆ›å»ºåˆ«å(è¿™é‡Œçœ‹ä¸ªäººä¹ æƒ¯)
    vim /root/.bashrc
    alias kneat='kubectl-neat'
    

ä½¿ç”¨
==

æœ¬æ¬¡ä½¿ç”¨äºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²ï¼Œå®é™…ä¸Šå‚æ•°æ˜¯ç›¸åŒçš„ï¼Œæ²¡åŒºåˆ«

    root@network-demo:~# kubectl-neat help
    Usage:
      kubectl-neat [flags]
      kubectl-neat [command]
    
    ## ç¤ºä¾‹æ˜¯é€šè¿‡ kubectl plugin æ–¹å¼å®‰è£…,ä½¿ç”¨äºŒè¿›åˆ¶å®‰è£…æ”¹æˆ kubectl-neat å°±å¥½
    Examples:
    kubectl get pod mypod -o yaml | kubectl neat
    kubectl get pod mypod -oyaml | kubectl neat -o json
    kubectl neat -f - <./my-pod.json
    kubectl neat -f ./my-pod.json
    kubectl neat -f ./my-pod.json --output yaml
    
    Available Commands:
      ## è‡ªåŠ¨è¡¥å…¨å‘½ä»¤ç”¨çš„
      completion  Generate the autocompletion script for the specified shell
      get         
      help        Help about any command
      version     Print kubectl-neat version
    
    Flags:
      -f, --file string     file path to neat, or - to read from stdin (default "-")
      -h, --help            help for kubectl-neat
      -o, --output string   output format: yaml or json (default "yaml")
    

å‘½ä»¤è¡¥å…¨
----

ç®€å•æ¥è¯´å°±æ˜¯æŒ‰ä¸¤ä¸‹ tab åè‡ªåŠ¨è¡¥å……æ²¡æ‹¼å®Œçš„å‚æ•°

> ğŸ’¡ æ³¨ï¼šå…¶å®æ²¡å•¥ç”¨...ä»–åªèƒ½è¡¥å…¨å‘½ä»¤æœ¬èº«çš„å‚æ•°ï¼Œå¹¶ä¸èƒ½è¡¥å…¨ k8s ç›¸å…³ä¿¡æ¯

    root@network-demo:~# kubectl-neat completion --help
    Generate the autocompletion script for kubectl-neat for the specified shell.
    See each sub-command's help for details on how to use the generated script.
    
    Usage:
      kubectl-neat completion [command]
    
    Available Commands:
      bash        Generate the autocompletion script for bash
      fish        Generate the autocompletion script for fish
      powershell  Generate the autocompletion script for powershell
      zsh         Generate the autocompletion script for zsh
    
    Flags:
      -h, --help   help for completion
    
    Global Flags:
      -o, --output string   output format: yaml or json (default "yaml")
    

    ## å½“å‰ç¯å¢ƒä½¿ç”¨ bash
    root@network-demo:~# hostnamectl 
     Static hostname: network-demo
           Icon name: computer-vm
             Chassis: vm
      Virtualization: kvm
    Operating System: Ubuntu 24.04.3 LTS              
              Kernel: Linux 6.8.0-88-generic
        Architecture: x86-64
    
    ## æ·»åŠ å‘½ä»¤è¡¥å…¨
    echo "source <(kneat completion bash)" >> ~/.bashrc && source ~/.bashrc
    
    ## æŸ¥çœ‹æ•ˆæœ
    ## ä¸Šé¢è¯´æ²¡å•¥ç”¨çš„åœ°æ–¹å°±åœ¨è¿™...å®é™…ä¸Šèƒ½ç”¨çš„å‚æ•°åªæœ‰ get(kubectl-neat è‡ªå·±çš„å‚æ•°)
    ## å½“ä½ è¡¥å…¨ get åå°±ä¼šå‘ç°ä»–æ— æ³•è¯†åˆ« k8s èµ„æº
    root@network-demo:~# kubectl-neat
    completion  (Generate the autocompletion script for the specified shell)  help        (Help about any command)                                      
    get                                                                       version     (Print kubectl-neat version)
    

ä½¿ç”¨æ–¹å¼
----

    ## è¿™é‡Œæˆ‘ç›´æ¥å°† kubectl get -o yaml ä¸ kubectl-neat get -o yaml è¾“å‡ºå¯¹æ¯”
    
    kubectl-neat get -- pods -n deepflow deepflow-server-fc484c85-p67gl -o yaml > deepflow-kneat.yaml
    kubectl get pods -n deepflow deepflow-server-fc484c85-p67gl -o yaml > deepflow-kubectl.yaml
    

    ## é€šè¿‡ icdiff è¾“å‡ºä¸¤ä¸ªæ–‡ä»¶çš„å¯¹æ¯”ç»“æœ,è¿™é‡Œä¸ºäº†æ–¹ä¾¿å¤§å®¶çœ‹,åªæŠŠåˆ é™¤çš„å†…å®¹æ”¾ä¸Šæ¥äº†
    root@network-demo:~# icdiff deepflow-kubectl.yaml deepflow-kneat.yaml
      creationTimestamp: "2026-01-23T02:24:57Z"
      generateName: deepflow-server-fc484c85-
      generation: 1
      ownerReferences:
      - apiVersion: apps/v1
        blockOwnerDeletion: true
        controller: true
        kind: ReplicaSet
        name: deepflow-server-fc484c85
        uid: 528ab77f-67ba-4099-8771-bfe06ca9ce2f
      resourceVersion: "4864722"
      uid: 0d5ff97b-9c48-4abf-be8b-d2b76f7a14d2
        nodeAffinity: {}
              apiVersion: v1
              apiVersion: v1
              apiVersion: v1
              apiVersion: v1
              apiVersion: v1
            scheme: HTTP
          successThreshold: 1
          timeoutSeconds: 1
          protocol: TCP
          protocol: TCP
          protocol: TCP
          protocol: TCP
            scheme: HTTP
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        securityContext: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsConfig: {}
      dnsPolicy: ClusterFirst
      enableServiceLinks: true
      nodeName: network-demo
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      serviceAccount: deepflow-server
      terminationGracePeriodSeconds: 30
          defaultMode: 420
          defaultMode: 420
                  apiVersion: v1
    status:
    ## ä¸‹é¢æ˜¯æ‰€æœ‰ status å†…å®¹...