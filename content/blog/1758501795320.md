---
layout: post
title: 'Influxdb å¾—æ¨¡ç³ŠæŸ¥è¯¢æ€»ç»“'
date: "2025-09-22T00:43:15Z"
---
Influxdb å¾—æ¨¡ç³ŠæŸ¥è¯¢æ€»ç»“
================

InfluxDB æ¨¡ç³ŠæŸ¥è¯¢å®Œæ•´æ€»ç»“ä¸ç¤ºä¾‹ï¼ˆä¿®æ­£ç‰ˆï¼‰
=========================

ğŸ“Š æŸ¥è¯¢æ–¹å¼å…¨é¢æ€»ç»“ï¼ˆInfluxQLï¼‰
---------------------

### 1\. **ç²¾ç¡®åŒ¹é…**ï¼ˆæœ€ä½³æ€§èƒ½ï¼‰

    -- å•å€¼ç²¾ç¡®åŒ¹é…
    WHERE routername = 'NJ-MAIPU-1'
    
    -- å¤šå€¼ç²¾ç¡®åŒ¹é…ï¼ˆä½¿ç”¨ORï¼‰
    WHERE routername = 'NJ-MAIPU-1' OR routername = 'NJ-SCT-R02'
    

### 2\. **åŸºç¡€æ¨¡ç³ŠåŒ¹é…**ï¼ˆç®€æ´å†™æ³•ï¼‰

    -- åŒ…å«åŒ¹é…
    WHERE routername =~ /MAIPU/
    WHERE host =~ /web/
    
    -- ç­‰åŒäºæ˜ç¡®å†™æ³•
    WHERE routername =~ /.*MAIPU.*/
    

### 3\. **æ ‡å‡†æ¨¡å¼åŒ¹é…**ï¼ˆæ˜ç¡®èŒƒå›´ï¼‰

    -- å¼€å¤´åŒ¹é…
    WHERE routername =~ /^NJ-.*/
    
    -- ç»“å°¾åŒ¹é…
    WHERE routername =~ /.*-R01$/
    
    -- åŒ…å«åŒ¹é…ï¼ˆæ˜ç¡®å†™æ³•ï¼‰
    WHERE routername =~ /.*MAIPU.*/
    

### 4\. **å¤šå€¼ç»„åˆåŒ¹é…**ï¼ˆé«˜æ•ˆå¤šé€‰ï¼‰

    -- å¤šå€¼æˆ–åŒ¹é…
    WHERE routername =~ /(MAIPU|SCT|CORE)/
    
    -- ç²¾ç¡®å¤šå€¼åŒ¹é…
    WHERE routername =~ /^(NJ-MAIPU-1|NJ-SCT-R02)$/
    

### 5\. **å­—ç¬¦èŒƒå›´åŒ¹é…**

    -- æ•°å­—åŒ¹é…
    WHERE routername =~ /[0-9]/
    
    -- å­—æ¯åŒ¹é…
    WHERE routername =~ /[A-Z]/
    
    -- ç»„åˆåŒ¹é…
    WHERE routername =~ /[A-Z][0-9]/  -- å¦‚A1, B2ç­‰
    

âš ï¸ **é‡è¦æ³¨æ„äº‹é¡¹**
-------------

### InfluxQL **ä¸æ”¯æŒ**çš„ç‰¹æ€§ï¼š

    -- ä»¥ä¸‹è¯­æ³•ä¼šæŠ¥é”™ï¼
    WHERE routername IN ('NJ-MAIPU-1', 'NJ-SCT-R02')
    WHERE routername IN ('value1', 'value2')
    

### å¤šORæ­£åˆ™ï¼ˆé¿å…ä½¿ç”¨ï¼‰ï¼š

    -- æ€§èƒ½å·®ï¼Œé¿å…ä½¿ç”¨
    WHERE routername =~ /MAIPU/ OR routername =~ /SCT/ OR routername =~ /CORE/
    

ğŸ” å„ç§æ–¹å¼çš„ç‰¹æ€§å¯¹æ¯”
------------

æŸ¥è¯¢æ–¹å¼

è¯­æ³•ç¤ºä¾‹

æ€§èƒ½

å¯è¯»æ€§

é€‚ç”¨åœºæ™¯

**ç²¾ç¡®åŒ¹é…**

`routername = 'å€¼'`

â­â­â­â­â­

â­â­â­â­â­

å·²çŸ¥å…·ä½“å€¼

**å¤šå€¼ORç²¾ç¡®**

`name = 'A' OR name = 'B'`

â­â­â­â­

â­â­â­â­

å·²çŸ¥å¤šä¸ªå…·ä½“å€¼

**åŸºç¡€æ¨¡ç³Š**

`name =~ /pattern/`

â­â­â­

â­â­â­â­â­

å¿«é€Ÿç®€å•åŒ¹é…

**å¤šå€¼ç»„åˆ**

`name =~ /(pat1|pat2)/`

â­â­â­

â­â­â­â­

åŒç±»å‹å¤šå€¼åŒ¹é…

**æ ‡å‡†æ¨¡å¼**

`name =~ /.*pattern.*/`

â­â­â­

â­â­â­â­

æ˜ç¡®èŒƒå›´åŒ¹é…

**å¤šORæ­£åˆ™**

`=~ /a/ or =~ /b/`

â­

â­â­

**é¿å…ä½¿ç”¨**

ğŸ¯ åº”ç”¨åœºæ™¯è¯¦ç»†ç¤ºä¾‹
-----------

### åœºæ™¯1ï¼š**ç²¾ç¡®è®¾å¤‡æŸ¥è¯¢**

    -- æŸ¥è¯¢ç‰¹å®šè®¾å¤‡
    SELECT * FROM xr_intf_stats 
    WHERE routername = 'NJ-MAIPU-1'
    ORDER BY time DESC 
    LIMIT 10
    
    -- æŸ¥è¯¢å¤šä¸ªç‰¹å®šè®¾å¤‡
    SELECT * FROM xr_intf_stats 
    WHERE routername = 'NJ-MAIPU-1' OR routername = 'NJ-SCT-R02'
    ORDER BY time DESC 
    LIMIT 10
    

### åœºæ™¯2ï¼š**è®¾å¤‡ç±»å‹ç­›é€‰**

    -- æŸ¥è¯¢æ‰€æœ‰MAIPUè®¾å¤‡
    SELECT * FROM xr_intf_stats 
    WHERE routername =~ /MAIPU/
    ORDER BY time DESC 
    
    -- æŸ¥è¯¢å¤šç§ç±»å‹è®¾å¤‡
    SELECT * FROM xr_intf_stats 
    WHERE routername =~ /(MAIPU|SCT|CORE)/
    ORDER BY time DESC 
    

### åœºæ™¯3ï¼š**è®¾å¤‡ç¼–å·æ¨¡å¼åŒ¹é…**

    -- æŸ¥è¯¢æ‰€æœ‰Rç³»åˆ—è®¾å¤‡
    SELECT * FROM xr_intf_stats 
    WHERE routername =~ /.*-R[0-9]+$/
    ORDER BY time DESC 
    
    -- æŸ¥è¯¢NJå¼€å¤´çš„æ‰€æœ‰è®¾å¤‡
    SELECT * FROM xr_intf_stats 
    WHERE routername =~ /^NJ-.*/
    ORDER BY time DESC 
    

### åœºæ™¯4ï¼š**ç«¯å£å’Œæ¥å£æŸ¥è¯¢**

    -- æŸ¥è¯¢Tengigabitæ¥å£
    SELECT * FROM xr_intf_stats 
    WHERE name =~ /tengigabit/
    ORDER BY time DESC 
    
    -- æŸ¥è¯¢ç‰¹å®šç«¯å£èŒƒå›´
    SELECT * FROM xr_intf_stats 
    WHERE name =~ /0\/0\/[1-4]/
    ORDER BY time DESC 
    

ğŸ› ï¸ æ€§èƒ½ä¼˜åŒ–å®è·µ
----------

### 1\. **å­—æ®µç±»å‹æ£€æŸ¥**

    -- ç¡®è®¤routernameæ˜¯tagå­—æ®µï¼ˆæœ‰ç´¢å¼•ï¼‰
    SHOW TAG KEYS FROM xr_intf_stats
    
    -- å¦‚æœæ˜¯fieldå­—æ®µï¼Œè€ƒè™‘ä¿®æ”¹æ•°æ®æ¨¡å‹
    SHOW FIELD KEYS FROM xr_intf_stats
    

### 2\. **æŸ¥è¯¢æ€§èƒ½å±‚çº§**

    -- 1. æœ€ä½³ï¼šç²¾ç¡®åŒ¹é…
    WHERE routername = 'NJ-MAIPU-1'
    
    -- 2. è‰¯å¥½ï¼šå¤šå€¼ORç²¾ç¡®åŒ¹é…  
    WHERE routername = 'NJ-MAIPU-1' OR routername = 'NJ-SCT-R02'
    
    -- 3. ä¸€èˆ¬ï¼šå•æ­£åˆ™åŒ¹é…
    WHERE routername =~ /MAIPU/
    
    -- 4. ä¸€èˆ¬ï¼šå¤šå€¼ç»„åˆæ­£åˆ™
    WHERE routername =~ /(MAIPU|SCT)/
    
    -- 5. é¿å…ï¼šå¤šORæ­£åˆ™
    WHERE routername =~ /MAIPU/ OR routername =~ /SCT/
    

### 3\. **æ•°æ®æ¨¡å‹ä¼˜åŒ–å»ºè®®**

    -- åŸå§‹æ•°æ®
    INSERT xr_intf_stats,routername="NJ-MAIPU-1" value=100
    
    -- ä¼˜åŒ–å»ºè®®ï¼šæ·»åŠ è®¾å¤‡ç±»å‹tag
    INSERT xr_intf_stats,
        routername="NJ-MAIPU-1",
        device_type="MAIPU",
        location="NJ"
    value=100
    

ğŸ“ˆ å®é™…æŸ¥è¯¢ç¤ºä¾‹
---------

### ç¤ºä¾‹1ï¼šå¤šè®¾å¤‡æµé‡æŸ¥è¯¢

    SELECT mean("byte_in") AS avg_in, mean("byte_out") AS avg_out
    FROM xr_intf_stats
    WHERE time > now() - 1h
      AND (routername = 'NJ-MAIPU-1' OR routername = 'NJ-SCT-R02')
    GROUP BY time(1m), routername
    

### ç¤ºä¾‹2ï¼šè®¾å¤‡ç±»å‹èšåˆ

    SELECT mean("byte_in") AS avg_in
    FROM xr_intf_stats
    WHERE time > now() - 24h
      AND routername =~ /(MAIPU|SCT)/
    GROUP BY time(1h), routername
    

### ç¤ºä¾‹3ï¼šå¼‚å¸¸ç«¯å£æ£€æµ‹

    SELECT *
    FROM xr_intf_stats
    WHERE time > now() - 30m
      AND (err_bitrate > 0 OR byte_in = 0)
      AND routername =~ /^NJ-.*/
    ORDER BY time DESC
    

ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“
---------

1.  **é¦–é€‰ç²¾ç¡®åŒ¹é…**ï¼š`routername = 'å…·ä½“å€¼'`
2.  **å¤šå€¼ç”¨ORè¿æ¥**ï¼š`name = 'A' OR name = 'B'`
3.  **æ¨¡ç³Šç”¨å•æ­£åˆ™**ï¼š`name =~ /pattern/`
4.  **å¤šæ¨¡å¼ç”¨ç»„åˆ**ï¼š`name =~ /(pat1|pat2)/`
5.  **é¿å…å¤šORæ­£åˆ™**ï¼šæ€§èƒ½æå·®
6.  **ç¡®è®¤å­—æ®µç±»å‹**ï¼štagå­—æ®µæ‰æœ‰ç´¢å¼•
7.  **ä¼˜åŒ–æ•°æ®æ¨¡å‹**ï¼šæ·»åŠ è¡ç”Ÿtagå­—æ®µ

ğŸš¨ å¸¸è§é”™è¯¯é¿å…
---------

    -- é”™è¯¯ï¼šINè¯­æ³•ä¸æ”¯æŒ
    SELECT * FROM xr_intf_stats WHERE routername IN ('A','B')
    
    -- é”™è¯¯ï¼šå•å¼•å·ä½ç½®
    SELECT * FROM xr_intf_stats WHERE routername =~ /'(A|B)'/
    
    -- æ­£ç¡®ï¼šå¤šå€¼æŸ¥è¯¢
    SELECT * FROM xr_intf_stats 
    WHERE routername = 'A' OR routername = 'B'
    
    -- æ­£ç¡®ï¼šæ­£åˆ™å¤šå€¼
    SELECT * FROM xr_intf_stats 
    WHERE routername =~ /^(A|B)$/
    

è¿™ä¸ªæ€»ç»“åŸºäºInfluxQLçš„å®é™…è¯­æ³•é™åˆ¶ï¼Œæä¾›äº†å¯ç«‹å³ä½¿ç”¨çš„æ­£ç¡®æŸ¥è¯¢ç¤ºä¾‹ã€‚