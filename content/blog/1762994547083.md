---
layout: post
title: '如何通过Python SDK更新Collection中已存在的Doc'
date: "2025-11-13T00:42:27Z"
---
如何通过Python SDK更新Collection中已存在的Doc
==================================

本文介绍如何通过Python SDK更新Collection中已存在的Doc。

本文介绍如何通过Python SDK更新Collection中已存在的Doc。

**说明**

1.  若更新Doc时指定id不存在，则本次更新Doc操作无效
    
2.  如只更新部分属性fields，其他未更新属性fields默认被置为`None`
    
3.  **Python SDK 1.0.11版本后，更新Doc时vector变为非必填项**
    

前提条件
----

*   已创建Cluster
*   已获得API-KEY
*   已安装最新版SDK

**接口定义**
--------

Python示例：

    Collection.update(
        docs: Union[Doc, List[Doc], Tuple, List[Tuple]],
        partition: Optional[str] = None,
        async_req: False
    ) -> DashVectorResponse
    

**使用示例**
--------

**说明**

1.  需要使用您的api-key替换示例中的YOUR\_API\_KEY、您的Cluster Endpoint替换示例中的YOUR\_CLUSTER\_ENDPOINT，代码才能正常运行。
    
2.  本示例需要参考[新建Collection-使用示例](https://help.aliyun.com/document_detail/2510242.html#hivl6)提前创建好名称为`quickstart`的Collection。
    

Python示例：

    import dashvector
    from dashvector import Doc
    import numpy as np
    
    client = dashvector.Client(
        api_key='YOUR_API_KEY',
        endpoint='YOUR_CLUSTER_ENDPOINT'
    )
    collection = client.get(name='quickstart')
    

### **更新Doc**

Python示例：

    # 通过Doc对象update
    ret = collection.update(
        Doc(
            id='1',
            vector=[0.1, 0.2, 0.3, 0.4]
        )
    )
    # 判断update是否成功
    assert ret
    
    # 简化形式：通过Tuple update
    ret = collection.update(
        ('2', [0.1, 0.1, 0.1, 0.1])               # (id, vector)
    )
    

### 更新带有Fields的Doc

Python示例：

    # update单条数据，并设置Fields Value
    ret = collection.update(
        Doc(
            id='3',
            vector=np.random.rand(4),
            fields={
                # 设置创建Collection时预定义的Fields Value
                'name': 'zhangsan', 'weight':70.0, 'age':30, 
                # 设置Schema-Free的Field & Value
                'anykey1': 'str-value', 'anykey2': 1,
                'anykey3': True, 'anykey4': 3.1415926
            }
        )
    )
    
    # update单条数据，并设置Fields Value
    ret = collection.update(
        ('4', np.random.rand(4), {'foo': 'bar'})  # (id, vector, fields)
    )
    

### **批量更新Doc**

Python示例：

    # 通过Doc对象，批量update 10条数据
    ret = collection.update(
        [
            Doc(id=str(i+5), vector=np.random.rand(4)) for i in range(10)
        ]
    )
    
    # 简化形式：通过Tuple，批量update 3条数据
    ret = collection.update(
        [
            ('15', [0.2,0.7,0.8,1.3], {'age': 20}),
            ('16', [0.3,0.6,0.9,1.2], {'age': 30}),
            ('17', [0.4,0.5,1.0,1.1], {'age': 40})
        ]                                         # List[(id, vector, fields)]
    )
    
    # 判断批量update是否成功
    assert ret
    

### 异步更新Doc

Python示例：

    # 异步批量update 10条数据
    ret_funture = collection.update(
        [
            Doc(id=str(i+18), vector=np.random.rand(4), fields={'name': 'foo' + str(i)}) for i in range(10)
        ],
        async_req=True
    )
    # 等待并获取异步update结果
    ret = ret_funture.get()
    

### **更新带有Sparse Vector的Doc**

Python示例：

    ret = collection.update(
        Doc(
            id='28',
            vector=[0.1, 0.2, 0.3, 0.4],
            sparse_vector={1:0.4, 10000:0.6, 222222:0.8}
        )
    )