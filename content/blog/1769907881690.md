---
layout: post
title: '[python] python-docx-templateå®ç”¨æ¡ˆä¾‹è§£æ'
date: "2026-02-01T01:04:41Z"
---
\[python\] python-docx-templateå®ç”¨æ¡ˆä¾‹è§£æ
=====================================

Python-docx-templateæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„Wordæ–‡æ¡£è‡ªåŠ¨åŒ–ç”Ÿæˆåº“ï¼Œå®ƒåŸºäºæ¨¡æ¿å¼•æ“çš„è®¾è®¡æ€æƒ³ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡ç¼–å†™æ¨¡æ¿ä¸Pythonä»£ç é€»è¾‘åˆ†ç¦»çš„æ–¹å¼ï¼Œé«˜æ•ˆç”Ÿæˆç»“æ„å¤æ‚ã€æ ·å¼å¤šæ ·çš„Wordæ–‡æ¡£ã€‚åœ¨æ–‡ç« [python-docx-templateæ¨¡æ¿åŒ–Wordæ–‡æ¡£ç”ŸæˆæŒ‡åŒ—](https://www.cnblogs.com/luohenyueji/p/19503461)ä»‹ç»è¯¥åº“çš„åŸºç¡€ç”¨æ³•ä¹‹ä¸Šï¼Œæœ¬æ–‡å°†è¿›ä¸€æ­¥ç»“åˆå®˜æ–¹ç¤ºä¾‹ï¼Œæä¾›å¤šä¸ªå®ç”¨åœºæ™¯çš„ä»£ç è§£æä¸æ‹“å±•ï¼Œæ¶µç›–å¤æ‚æ ·å¼ã€è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€åµŒå¥—å¾ªç¯åŠå¯Œæ–‡æœ¬æ¸²æŸ“ç­‰é«˜çº§åŠŸèƒ½ï¼Œä»¥æå‡æ–‡æ¡£ç”Ÿæˆçš„æ•ˆç‡ä¸çµæ´»æ€§ã€‚ä¸‹æ–‡å°†åˆ†æ¨¡å—å±•å¼€å…·ä½“ç¤ºä¾‹ä¸å®ç°ã€‚

python-docx-templateçš„å®˜æ–¹ä»£ç ä»“åº“åœ°å€ä¸ºï¼š[python-docx-template](https://github.com/elapouya/python-docx-template)ï¼Œè¯¦ç»†æ–‡æ¡£å¯å‚é˜…ï¼š[python-docx-template doc](https://docxtpl.readthedocs.io/)ã€‚

![](https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E5%AE%9E%E7%94%A8%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90/imgs/img1.png)

æœ¬æ–‡ä½¿ç”¨çš„python-docx-templateç‰ˆæœ¬ä¸º0.20.2ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š

> pip install docxtpl

ç›®å½•

*   [1 å®ç”¨æ¡ˆä¾‹](#1-å®ç”¨æ¡ˆä¾‹)
    *   [1.1 è¡¨æ ¼æ ·å¼ç”Ÿæˆ](#11-è¡¨æ ¼æ ·å¼ç”Ÿæˆ)
    *   [1.2 è‡ªå®šä¹‰Jinja2è¿‡æ»¤å™¨](#12-è‡ªå®šä¹‰jinja2è¿‡æ»¤å™¨)
    *   [1.3 æ–‡æ¡£åµŒå…¥](#13-æ–‡æ¡£åµŒå…¥)
    *   [1.4 è‡ªåŠ¨è½¬ä¹‰](#14-è‡ªåŠ¨è½¬ä¹‰)
    *   [1.5 å›¾ç‰‡æ›¿æ¢](#15-å›¾ç‰‡æ›¿æ¢)
    *   [1.6 å‘½ä»¤è¡Œæ‰§è¡Œ](#16-å‘½ä»¤è¡Œæ‰§è¡Œ)
    *   [1.7 å¤šå±‚åµŒå¥—](#17-å¤šå±‚åµŒå¥—)
    *   [1.8 åœ°åŒºå­—ä½“å¤„ç†](#18-åœ°åŒºå­—ä½“å¤„ç†)
    *   [1.9 å¯Œæ–‡æœ¬ä½¿ç”¨](#19-å¯Œæ–‡æœ¬ä½¿ç”¨)
    *   [1.10 é”™è¯¯ç®¡ç†](#110-é”™è¯¯ç®¡ç†)
*   [2 å‚è€ƒ](#2-å‚è€ƒ)

1 å®ç”¨æ¡ˆä¾‹
======

1.1 è¡¨æ ¼æ ·å¼ç”Ÿæˆ
----------

æœ¬ç¤ºä¾‹ç”¨äºç”ŸæˆåŒ…å«å¯Œæ–‡æœ¬æ ·å¼ä¸å•å…ƒæ ¼èƒŒæ™¯è‰²çš„Wordè¡¨æ ¼æ–‡æ¡£ã€‚

æ¨¡æ¿å†…å®¹ï¼š

![](https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E5%AE%9E%E7%94%A8%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90/imgs/image.png)

æ¸²æŸ“ä»£ç ï¼š

    # python-docx-template/blob/master/tests/comments.py
    from docxtpl import DocxTemplate, RichText
    # data: python-docx-template/blob/master/tests/templates/cellbg_tpl.docx
    tpl = DocxTemplate("templates/cellbg_tpl.docx")
    
    context = {
        "alerts": [
            {
                "date": "2015-03-10",
                "desc": RichText("Very critical alert", color="FF0000", bold=True),
                "type": "CRITICAL",
                "bg": "FF0000",
            },
            {
                "date": "2015-03-11",
                "desc": RichText("Just a warning"),
                "type": "WARNING",
                "bg": "FFDD00",
            }
        ],
    }
    
    tpl.render(context)
    tpl.save("output/cellbg.docx")
    

1.2 è‡ªå®šä¹‰Jinja2è¿‡æ»¤å™¨
----------------

æœ¬ç¤ºä¾‹ä¸»è¦ä»‹ç»é€šè¿‡è‡ªå®šä¹‰Jinja2è¿‡æ»¤å™¨å®ç°åŠ¨æ€æ•°æ®æ¸²æŸ“ï¼ŒJinja2æ¨¡æ¿ä¸­è¿‡æ»¤å™¨çš„æ ¸å¿ƒæ ¼å¼ä¸ºï¼š`{{ å˜é‡å|è¿‡æ»¤å™¨å(å‚æ•°1, å‚æ•°2, ...) }}`ï¼Œå…¶ä¸­ï¼š

*   `|`ï¼ˆç«–çº¿ï¼‰æ˜¯è¿‡æ»¤å™¨çš„åˆ†éš”ç¬¦ï¼Œå·¦ä¾§æ˜¯è¦å¤„ç†çš„å˜é‡ï¼Œå³ä¾§æ˜¯è¿‡æ»¤å™¨åç§°ï¼›
*   æ‹¬å·`()`å†…æ˜¯ä¼ ç»™è¿‡æ»¤å™¨å‡½æ•°çš„å‚æ•°ï¼ˆæ— å‚æ•°æ—¶å¯çœç•¥æ‹¬å·ï¼‰ï¼›
*   ç¤ºä¾‹ï¼š`{{ base_value_float|my_filterB(2) }}` ä¸­ï¼Œ`base_value_float`æ˜¯å˜é‡ï¼Œ`my_filterB`æ˜¯è¿‡æ»¤å™¨åï¼Œ`2`æ˜¯ä¼ é€’çš„å‚æ•°ã€‚

æ¨¡æ¿å†…å®¹ï¼š

![](https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E5%AE%9E%E7%94%A8%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90/imgs/image-1.png)

æ¸²æŸ“ä»£ç ï¼š

    # python-docx-template/blob/master/tests/custom_jinja_filters.py
    from docxtpl import DocxTemplate
    import jinja2
    
    # åˆ›å»ºjinja2ç¯å¢ƒå¯¹è±¡ï¼Œç”¨äºç®¡ç†æ¨¡æ¿æ¸²æŸ“çš„é…ç½®
    jinja_env = jinja2.Environment()
    
    # è‡ªå®šä¹‰è¿‡æ»¤å™¨å‡½æ•°
    def my_filterA(value, my_string_arg):
        # å°†åŸå§‹å€¼å’Œå‚æ•°å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¸­é—´åŠ ç©ºæ ¼
        return_value = value + " " + my_string_arg
        return return_value
    def my_filterB(value, my_float_arg):
        # å°†åŸå§‹å€¼å’Œå‚æ•°æ•°å€¼ç›¸åŠ 
        return_value = value + my_float_arg
        return return_value
    
    # å°†è‡ªå®šä¹‰è¿‡æ»¤å™¨æ³¨å†Œåˆ°jinja2ç¯å¢ƒä¸­ï¼Œä½¿å…¶èƒ½åœ¨æ¨¡æ¿ä¸­è¢«è°ƒç”¨
    # æ³¨å†Œååœ¨Wordæ¨¡æ¿ä¸­å¯é€šè¿‡{{ å˜é‡å| my_filterA('å‚æ•°') }}å½¢å¼ä½¿ç”¨
    jinja_env.filters["my_filterA"] = my_filterA
    jinja_env.filters["my_filterB"] = my_filterB
    
    context = {
        "base_value_string": " Hello",  
        "base_value_float": 1.5         
    }
    # data: python-docx-template/blob/master/tests/templates/custom_jinja_filters_tpl.docx
    tpl = DocxTemplate("templates/custom_jinja_filters_tpl.docx")
    tpl.render(context, jinja_env)
    tpl.save("output/custom_jinja_filters.docx")
    

1.3 æ–‡æ¡£åµŒå…¥
--------

ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•æ¸²æŸ“å­Wordæ–‡æ¡£ï¼Œæ›¿æ¢ä¸»Wordæ–‡æ¡£ä¸­åµŒå…¥çš„å„ç±»æ–‡ä»¶ï¼Œå¡«å……æ•°æ®åä¿å­˜æ–‡æ¡£ï¼š

    # python-docx-template/blob/master/tests/embedded.py
    from docxtpl import DocxTemplate
    
    # åŠ è½½å†…åµŒå­æ¨¡æ¿æ–‡ä»¶
    # data: python-docx-template/blob/master/tests/templates/embedded_embedded_docx_tpl.docx
    embedded_docx_tpl = DocxTemplate("templates/embedded_embedded_docx_tpl.docx")
    
    # å®šä¹‰æ¨¡æ¿æ¸²æŸ“çš„ä¸Šä¸‹æ–‡æ•°æ®
    context = {
        "name": "John Doe",  # è¦å¡«å……åˆ°æ¨¡æ¿ä¸­çš„å§“åå€¼
    }
    embedded_docx_tpl.render(context)
    
    # ä¿å­˜æ¸²æŸ“åçš„å­æ¨¡æ¿åˆ°æŒ‡å®šè·¯å¾„ï¼Œä¾›åç»­ä¸»æ¨¡æ¿è°ƒç”¨
    embedded_docx_tpl.save("output/embedded_embedded_docx.docx")
    
    # åŠ è½½ä¸»æ¨¡æ¿æ–‡ä»¶
    tpl = DocxTemplate("templates/embedded_main_tpl.docx")
    
    # å®šä¹‰ä¸»æ¨¡æ¿çš„ä¸Šä¸‹æ–‡æ•°æ®
    context = {
        "name": "John Doe",
    }
    
    # æ›¿æ¢ä¸»æ¨¡æ¿ä¸­åµŒå…¥çš„Wordæ–‡æ¡£
    # å‚æ•°1ï¼šæ¨¡åŸæœ¬åµŒå…¥çš„å ä½æ–‡ä»¶è·¯å¾„
    # å‚æ•°2ï¼šè¦æ›¿æ¢æˆçš„ç›®æ ‡æ–‡ä»¶è·¯å¾„
    tpl.replace_embedded(
        "templates/embedded_dummy.docx", "templates/embedded_static_docx.docx"
    )
    
    tpl.replace_embedded(
        "templates/embedded_dummy2.docx", "output/embedded_embedded_docx.docx"
    )
    
    # è¯´æ˜ï¼šdocx æœ¬è´¨æ˜¯ zip å‹ç¼©åŒ…ï¼ŒåµŒå…¥çš„æ–‡ä»¶ä¼šå­˜å‚¨åœ¨word/embeddings/ç›®å½•ä¸‹
    tpl.replace_zipname(
        "word/embeddings/Feuille_Microsoft_Office_Excel3.xlsx", 
        "templates/real_Excel.xlsx"  # è¦æ›¿æ¢æˆçš„å®é™…æ–‡ä»¶è·¯å¾„
    )
    tpl.replace_zipname(
        "word/embeddings/Pr_sentation_Microsoft_Office_PowerPoint4.pptx",
        "templates/real_PowerPoint.pptx" 
    )
    
    tpl.render(context)
    tpl.save("output/embedded.docx")
    

1.4 è‡ªåŠ¨è½¬ä¹‰
--------

æœ¬ç¤ºä¾‹å±•ç¤ºäº†åœ¨è‡ªåŠ¨è½¬ä¹‰æ¨¡å¼ä¸‹ï¼Œå°†åŒ…å«XMLç‰¹æ®Šå­—ç¬¦ã€Unicodeæ–‡æœ¬å’ŒåŠ¨æ€é”®å€¼å¯¹çš„ä¸Šä¸‹æ–‡æ•°æ®æ¸²æŸ“åˆ°æ¨¡æ¿ä¸­ã€‚

æ¨¡æ¿å†…å®¹ï¼š  
![](https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E5%AE%9E%E7%94%A8%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90/imgs/image-2.png)

æ¸²æŸ“ä»£ç ï¼š

    # python-docx-template/blob/master/tests/escape_auto.py
    import os
    from unicodedata import name
    from docxtpl import DocxTemplate
    XML_RESERVED = """<"&'>"""
    # data: python-docx-template/blob/master/tests/templates/escape_tpl_auto.docx
    tpl = DocxTemplate("templates/escape_tpl_auto.docx")
    
    context = {
        "nested_dict": {name(str(c)): c for c in XML_RESERVED},
        "autoescape": 'Escaped "str & ing"!',
        "autoescape_unicode": "This is an escaped <unicode> example \u4f60 & \u6211",
        "iteritems": lambda x: x.items(),
    }
    # autoescape=Trueè¡¨ç¤ºè‡ªåŠ¨è½¬ä¹‰
    tpl.render(context, autoescape=True)
    
    OUTPUT = "output"
    if not os.path.exists(OUTPUT):
        os.makedirs(OUTPUT)
    tpl.save(OUTPUT + "/escape_auto.docx")
    

å®é™…ä¸Š`iteritems(nested_dict)`å°±æ˜¯è°ƒç”¨æ¸²æŸ“å®šä¹‰çš„lambdaå‡½æ•°ï¼ŒæŠŠnested\_dictä¼ è¿›å»ï¼Œæ‹¿åˆ°å®ƒçš„æ‰€æœ‰é”®å€¼å¯¹ï¼š

    {% for k, v in iteritems(nested_dict) %}
    {{ k.capitalize() }}: {{ v }}{% endfor %}
    

ä¹Ÿå¯ä»¥åœ¨Jinja2æ¨¡æ¿ä¸­ä½¿ç”¨Pythonè¡¨è¾¾å¼ï¼Œç›´æ¥è°ƒç”¨å­—å…¸çš„itemæ–¹æ³•ï¼š

    {% for k, v in nested_dict.items() %}
    {{ k.capitalize() }}: {{ v }}{% endfor %}
    

1.5 å›¾ç‰‡æ›¿æ¢
--------

ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜å¦‚ä½•æ›¿æ¢Wordæ¨¡æ¿æ–‡æ¡£ï¼ˆåŒ…å«é¡µçœ‰é¡µè„šï¼‰ä¸­çš„å›¾ç‰‡ï¼Œå¹¶æ¼”ç¤ºå¦‚ä½•å°†å¤„ç†åçš„æ–‡æ¡£åˆ†åˆ«é€šè¿‡å¸¸è§„æ–¹å¼å’Œå†…å­˜æ–‡ä»¶å¯¹è±¡ä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶ï¼š

    # python-docx-template/blob/master/tests/header_footer_image_file_obj.py
    from docxtpl import DocxTemplate
    import io
    
    # å®šä¹‰ä¸¤ä¸ªè¾“å‡ºæ–‡æ¡£çš„è·¯å¾„å’Œæ–‡ä»¶å
    DEST_FILE = "output/header_footer_image_file_obj.docx"
    DEST_FILE2 = "output/header_footer_image_file_obj2.docx"
    # data: python-docx-template/blob/master/tests/templates/header_footer_image_tpl.docx
    tpl = DocxTemplate("templates/header_footer_image_tpl.docx")
    
    context = {
        "mycompany": "The World Wide company",  
    }
    
    # è¯»å–æ¨¡æ¿ä¸­éœ€è¦è¢«æ›¿æ¢çš„å›¾ç‰‡æ–‡ä»¶ï¼Œå¹¶è½¬æ¢ä¸ºå†…å­˜å­—èŠ‚æµå¯¹è±¡
    dummy_pic = io.BytesIO(open("templates/dummy_pic_for_header.png", "rb").read())
    # è¯»å–æ–°çš„æ›¿æ¢å›¾ç‰‡æ–‡ä»¶ï¼ˆpython.pngï¼‰ï¼Œå¹¶è½¬æ¢ä¸ºå†…å­˜å­—èŠ‚æµå¯¹è±¡
    new_image = io.BytesIO(open("templates/python.png", "rb").read())
    
    # å°†dummy_picå¯¹åº”çš„å›¾ç‰‡æ›¿æ¢ä¸ºnew_imageå¯¹åº”çš„å›¾ç‰‡
    tpl.replace_media(dummy_pic, new_image)
    tpl.render(context)
    tpl.save(DEST_FILE)
    
    tpl = DocxTemplate("templates/header_footer_image_tpl.docx")
    
    # å°†å†…å­˜ä¸­çš„å›¾ç‰‡å­—èŠ‚æµæŒ‡é’ˆé‡ç½®åˆ°èµ·å§‹ä½ç½®
    dummy_pic.seek(0)
    new_image.seek(0)
    
    # å†æ¬¡æ‰§è¡Œå›¾ç‰‡æ›¿æ¢æ“ä½œ
    tpl.replace_media(dummy_pic, new_image)
    # å†æ¬¡æ¸²æŸ“æ¨¡æ¿å˜é‡
    tpl.render(context)
    
    # åˆ›å»ºä¸€ä¸ªç©ºçš„å†…å­˜å­—èŠ‚æµå¯¹è±¡ï¼Œç”¨äºä¸´æ—¶å­˜å‚¨æ–‡æ¡£å†…å®¹
    file_obj = io.BytesIO()
    # å°†å¤„ç†åçš„æ–‡æ¡£ä¿å­˜åˆ°å†…å­˜å­—èŠ‚æµå¯¹è±¡ä¸­
    tpl.save(file_obj)
    # å°†å†…å­˜å­—èŠ‚æµæŒ‡é’ˆé‡ç½®åˆ°èµ·å§‹ä½ç½®ï¼Œå‡†å¤‡è¯»å–å†…å®¹
    file_obj.seek(0)
    
    # ä»¥äºŒè¿›åˆ¶å†™å…¥æ¨¡å¼æ‰“å¼€ç¬¬äºŒä¸ªè¾“å‡ºæ–‡ä»¶ï¼Œå°†å†…å­˜ä¸­çš„æ–‡æ¡£å†…å®¹å†™å…¥æ–‡ä»¶
    with open(DEST_FILE2, "wb") as f:
        f.write(file_obj.read())
    dummy_pic.close()
    new_image.close()
    

ä¸Šè¿°ä»£ç å®ç°å›¾ç‰‡æ›¿æ¢å¹¶éåŸºäºæ–‡ä»¶åï¼Œè€Œæ˜¯åŸºäºäºŒè¿›åˆ¶å†…å®¹çš„åŒ¹é…ã€‚è¿™æ˜¯å› ä¸º`replace_media`æ–¹æ³•æ ¹æ®å›¾ç‰‡çš„äºŒè¿›åˆ¶å†…å®¹æ¥è¯†åˆ«å›¾åƒï¼Œè€Œéä¾èµ–æ–‡ä»¶åæˆ–åœ¨Wordä¸­æ˜¾ç¤ºçš„åç§°ã€‚  
ç”±äºWordæ–‡æ¡£ (.docx) æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œå…¶ä¸­çš„å›¾ç‰‡ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨åœ¨`word/media/`ç›®å½•ä¸‹ï¼Œä¸”åœ¨æŸäº›Wordç‰ˆæœ¬ä¸­ï¼Œå›¾ç‰‡æ–‡ä»¶åå¯èƒ½è¢«è‡ªåŠ¨é‡å‘½åï¼ˆä¾‹å¦‚æ”¹ä¸º `image1.png`ï¼‰ï¼Œä¸åŸå§‹æ–‡ä»¶åæ— å…³ã€‚

**æ³¨æ„ğŸš€**ï¼šå¾…æ›¿æ¢å›¾ç‰‡å°ºå¯¸ä¸å®œè¿‡å¤§ï¼Œä¸”éœ€å…³é—­Wordæ¨¡æ¿çš„å›¾ç‰‡å‹ç¼©åŠŸèƒ½ï¼›å¦åˆ™Wordä¼šè‡ªåŠ¨å‹ç¼©æ¨¡æ¿ä¸­çš„å›¾ç‰‡ï¼Œæ”¹å˜å…¶äºŒè¿›åˆ¶æ•°æ®ï¼Œæœ€ç»ˆå¯¼è‡´å›¾ç‰‡æ›¿æ¢æ“ä½œå¤±è´¥ã€‚

1.6 å‘½ä»¤è¡Œæ‰§è¡Œ
---------

ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨docxtplæ¨¡å—ï¼ŒåŸºäºæ¨¡æ¿æ–‡ä»¶å’Œä½œä¸ºä¸Šä¸‹æ–‡æ•°æ®çš„JSONæ–‡ä»¶ç”Ÿæˆdocxæ–‡æ¡£ï¼š

    # python-docx-template/blob/master/tests/module_execute.py
    import os
    # data: python-docx-template/blob/master/tests/templates/module_execute_tpl.docx
    TEMPLATE_PATH = "templates/module_execute_tpl.docx"
    # å­˜å‚¨éœ€è¦å¡«å……åˆ°æ¨¡æ¿ä¸­çš„æ•°æ®
    JSON_PATH = "templates/module_execute.json"
    OUTPUT_FILENAME = "output/module_execute.docx"
    # docxtplå‘½ä»¤å‚æ•°ï¼šå¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨çš„è¾“å‡ºæ–‡ä»¶
    OVERWRITE = "-o"
    # docxtplå‘½ä»¤å‚æ•°ï¼šé™é»˜æ¨¡å¼æ‰§è¡Œï¼Œä¸è¾“å‡ºé¢å¤–æ—¥å¿—ä¿¡æ¯
    QUIET = "-q"
     # åˆ é™¤å·²å­˜åœ¨çš„è¾“å‡ºæ–‡ä»¶
    if os.path.exists(OUTPUT_FILENAME):
        os.unlink(OUTPUT_FILENAME) 
    
    # åˆ‡æ¢å·¥ä½œç›®å½•åˆ°å½“å‰è„šæœ¬æ‰€åœ¨çš„ç›®å½•
    os.chdir(os.path.dirname(__file__))
    
    # é€šè¿‡Pythonæ¨¡å—æ–¹å¼è°ƒç”¨docxtplï¼Œä¼ å…¥æ¨¡æ¿ã€æ•°æ®ã€è¾“å‡ºè·¯å¾„å’Œå‚æ•°
    # å¯é€šè¿‡python -m docxtpl -helpæŸ¥çœ‹è°ƒç”¨å¸®åŠ©
    cmd = "python -m docxtpl %s %s %s %s %s" % (
        TEMPLATE_PATH,       # æ¨¡æ¿æ–‡ä»¶è·¯å¾„
        JSON_PATH,           # æ•°æ®æ–‡ä»¶è·¯å¾„
        OUTPUT_FILENAME,    # è¾“å‡ºæ–‡ä»¶è·¯å¾„
        OVERWRITE,           # è¦†ç›–å‚æ•°
        QUIET                # é™é»˜å‚æ•°
    )
    
    print('Executing "%s" ...' % cmd)
    os.system(cmd)
    if os.path.exists(OUTPUT_FILENAME):
        print("    --> File %s has been generated." % OUTPUT_FILENAME)
    

1.7 å¤šå±‚åµŒå¥—
--------

ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡æ¨¡æ¿è¯­æ³•å®ç°é€å±‚å¾ªç¯æ¸²æŸ“ï¼Œæœ€ç»ˆç”ŸæˆåŒ…å«è¿™äº›åµŒå¥—æ•°æ®çš„Wordæ–‡æ¡£ï¼š

    # python-docx-template/blob/master/tests/nested_for.py
    from docxtpl import DocxTemplate
    # data: python-docx-template/blob/master/tests/templates/nested_for_tpl.docx
    tpl = DocxTemplate("templates/nested_for_tpl.docx")
    
    context = {
        "dishes": [
            {"name": "Pizza", "ingredients": ["bread", "tomato", "ham"]},
            {
                "name": "Hamburger",
                "ingredients": ["bread", "chopped steak", "cheese"],
            },
        ],
        "authors": [
            {
                "name": "Saint-Exupery",
                "books": [
                    {"title": "Le petit prince"},
                    {"title": "L'aviateur"},
                ],
            },
            {
                "name": "Barjavel",
                "books": [
                    {"title": "Ravage"},
                    {"title": "La nuit des temps"},
                ],
            },
        ],
    }
    
    tpl.render(context)
    tpl.save("output/nested_for.docx")
    

1.8 åœ°åŒºå­—ä½“å¤„ç†
----------

è‹¥å­—ä½“æ˜¾ç¤ºå¼‚å¸¸ï¼Œé€šå¸¸æ˜¯ç”±äºå­—ä½“ä»…é€‚é…äº†ç‰¹å®šæ–‡å­—åŒºåŸŸã€‚è§£å†³æ–¹æ³•æ˜¯åœ¨å­—ä½“åå‰åŠ ä¸ŠåŒºåŸŸæ ‡è¯†å’Œå†’å·ï¼ˆå¦‚ eastAsia:å¾®è½¯é›…é»‘ï¼‰ï¼Œä»è€ŒæŒ‡å®šæ–‡å­—çš„åŒºåŸŸæ¸²æŸ“æ–¹å¼ã€‚å¦‚æœä¸æ¸…æ¥šåŒºåŸŸæ ‡è¯†ï¼Œä¹Ÿå¯è§£å‹æ¨¡æ¿æ–‡ä»¶ååˆ†æ`document.xml`ç¡®è®¤å­—ä½“å¯¹åº”çš„åŒºåŸŸã€‚å¸¸è§åŒºåŸŸæ ‡è¯†åŒ…æ‹¬ï¼š

*   eastAsiaï¼šç”¨äºä¸œäºšå­—ç¬¦å¦‚ä¸­æ–‡
*   hAnsiï¼šç”¨äºæ‹‰ä¸å­—ç¬¦å¦‚è‹±æ–‡
*   asciiï¼šç”¨äºå…¼å®¹æ—§ç‰ˆè‹±æ–‡

ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•è®¾ç½®ä¸åŒçš„ä¸œäºšå­—ä½“ï¼š

    # python-docx-template/blob/master/tests/richtext_eastAsia.py
    from docxtpl import DocxTemplate, RichText
    # data: python-docx-template/blob/master/tests/templates/richtext_eastAsia_tpl.docx
    tpl = DocxTemplate("templates/richtext_eastAsia_tpl.docx")
    # 2. åˆ›å»ºå¯Œæ–‡æœ¬å¯¹è±¡ï¼Œåˆ†åˆ«è®¾ç½®ä¸åŒçš„ä¸œäºšå­—ä½“
    # eastAsia: å‰ç¼€è¡¨ç¤ºè¯¥å­—ä½“è®¾ç½®ä»…ä½œç”¨äºä¸œäºšå­—ç¬¦ï¼ˆä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ç­‰ï¼‰
    rt = RichText("æµ‹è¯•TEST", font="eastAsia:Microsoft YaHei")
    ch = RichText("æµ‹è¯•TEST", font="eastAsia:å¾®è½¯é›…é»‘")
    sun = RichText("æµ‹è¯•TEST", font="eastAsia:SimSun")
    context = {
        "example": rt,
        "Chinese": ch,
        "simsun": sun,
    }
    
    tpl.render(context)
    tpl.save("output/richtext_eastAsia.docx")
    

1.9 å¯Œæ–‡æœ¬ä½¿ç”¨
---------

Python-docx-templateçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯åŸºäºJinja2è¯­æ³•åŠ¨æ€ç”ŸæˆWordæ–‡æ¡£ã€‚å…¶RichTextç±»è¿›ä¸€æ­¥å¢å¼ºäº†çµæ´»æ€§ï¼Œå…è®¸ç›´æ¥ä»¥ç¼–ç¨‹æ–¹å¼æ’å…¥æ ¼å¼ä¸°å¯Œçš„æ–‡æœ¬ï¼Œè€Œæ— éœ€ä¸ºæ¯ç§æ ·å¼ç»„åˆå•ç‹¬è®¾ç½®æ¨¡æ¿å˜é‡ã€‚RichTextå¯¹è±¡å¯åœ¨åˆå§‹åŒ–æ—¶ç›´æ¥ä¼ å…¥æ–‡æœ¬ï¼Œé€šè¿‡å¤šæ¬¡è°ƒç”¨addæ–¹æ³•å¯å‘å…¶è¿½åŠ ä¸åŒæ ¼å¼çš„æ–‡æœ¬ç‰‡æ®µã€‚æœ€åï¼Œå°†è¯¥å¯¹è±¡æ•´ä½“èµ‹ç»™æ¨¡æ¿ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡ã€‚åœ¨Wordæ¨¡æ¿ä¸­ï¼Œåªéœ€ä½¿ç”¨`{{ rich_text_var }}`å¼•ç”¨è¯¥å˜é‡ï¼Œå³å¯æ¸²æŸ“æˆåŒ…å«å¤šç§æ ¼å¼çš„è¿ç»­æ®µè½ã€‚

![](https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/CSDN/%5Bpython%5D%20python-docx-template%E5%AE%9E%E7%94%A8%E6%A1%88%E4%BE%8B%E8%A7%A3%E6%9E%90/imgs/img2.png)

addæ–¹æ³•æ˜¯æ„å»ºRichTextå¯¹è±¡çš„æ ¸å¿ƒï¼Œå…¶æ‰€æœ‰å‚æ•°å‡ç”¨äºæ§åˆ¶å½“å‰æ“ä½œæ‰€æ·»åŠ æ–‡æœ¬çš„æ ¼å¼ï¼š

å‚æ•°

ç±»å‹

é»˜è®¤å€¼

è¯´æ˜

text

str

æ— 

å”¯ä¸€å¿…éœ€å‚æ•°ï¼Œè¦è¿½åŠ çš„æ–‡æœ¬å†…å®¹

style

str

None

åº”ç”¨æ®µè½æ ·å¼ï¼Œè¿™ä¼šå½±å“æ•´ä¸ªç”±RichTextå¯¹è±¡ç”Ÿæˆçš„æ®µè½çš„æ ·å¼

color

str

None

å­—ä½“é¢œè‰²æ”¯æŒåå…­è¿›åˆ¶ï¼ˆå¦‚#FF0000ï¼‰æˆ–Wordé¢„è®¾é¢œè‰²åï¼ˆå¦‚redï¼‰

highlight

str

None

æ–‡æœ¬èƒŒæ™¯é«˜äº®è‰²ï¼Œå–å€¼åŒcolorå‚æ•°

size

int

None

å­—ä½“å¤§å°

subscript

bool

None

è®¾ä¸ºTrueæ—¶æ–‡æœ¬æ˜¾ç¤ºä¸ºä¸‹æ ‡ï¼Œä¸superscriptäº’æ–¥

superscript

bool

None

è®¾ä¸ºTrueæ—¶æ–‡æœ¬æ˜¾ç¤ºä¸ºä¸Šæ ‡ï¼Œä¸subscriptäº’æ–¥

bold

bool

False

è®¾ä¸ºTrueæ—¶ï¼Œæ–‡æœ¬åŠ ç²—

italic

bool

False

è®¾ä¸ºTrueæ—¶ï¼Œæ–‡æœ¬å€¾æ–œ

underline

bool

False

è®¾ä¸ºTrueæ—¶ï¼Œæ–‡æœ¬æ·»åŠ ä¸‹åˆ’çº¿

strike

bool

False

è®¾ä¸ºTrueæ—¶ï¼Œæ–‡æœ¬æ·»åŠ åˆ é™¤çº¿

font

str

None

å­—ä½“åç§°

url\_id

str

None

æ·»åŠ è¶…é“¾æ¥ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªé“¾æ¥IDï¼Œè¯¥IDä¸€èˆ¬é€šè¿‡æ–‡æ¡£å¯¹è±¡çš„build\_url\_id()æ–¹æ³•ç”Ÿæˆ

rtl

bool

False

è®¾ä¸ºTrueæ—¶ï¼Œæ–‡æœ¬ä»å³å‘å·¦æ’åˆ—ï¼Œä»…å¯¹é˜¿æ‹‰ä¼¯è¯­ã€å¸Œä¼¯æ¥è¯­ç­‰æœ‰æ•ˆ

lang

str

None

è®¾ç½®æ–‡æœ¬çš„è¯­è¨€ï¼Œç”¨äºæ‹¼å†™æ£€æŸ¥å’Œæ–­å­—

> é‡è¦æç¤ºğŸš©ï¼šstyleï¼ˆæ®µè½æ ·å¼ï¼‰å‚æ•°æ¯”è¾ƒç‰¹æ®Šã€‚å®ƒé€šå¸¸åªåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨addæ–¹æ³•æ—¶æœ‰æ•ˆï¼Œåç»­è°ƒç”¨ä¸­å†è®¾ç½®styleé€šå¸¸ä¼šè¢«å¿½ç•¥ã€‚

ä»¥ä¸‹æ˜¯ä¸€æ®µä½¿ç”¨ç¤ºä¾‹ä»£ç ï¼ŒæŒ‰é¡ºåºä»‹ç»`RichText.add()`æ–¹æ³•çš„å„ä¸ªå‚æ•°ï¼š

    from docxtpl import DocxTemplate, RichText
    import os
    # 1. åˆ›å»ºæ¨¡æ¿å¯¹è±¡å¹¶åˆå§‹åŒ–RichText
    doc = DocxTemplate("template.docx")
    rt = RichText()
    
    # 2. æ·»åŠ åŸºç¡€æ–‡æœ¬ï¼ˆå¿…éœ€å‚æ•°ï¼‰
    rt.add("è¿™æ˜¯æ™®é€šæ–‡æœ¬")
    
    # 3. è®¾ç½®æ®µè½æ ·å¼ï¼ˆå½±å“æ•´ä¸ªæ®µè½ï¼‰
    rt.add("\næ ‡é¢˜æ–‡æœ¬", style="Heading1")
    
    # 4. è®¾ç½®å­—ä½“é¢œè‰²
    rt.add(" çº¢è‰²æ–‡å­—", color="#FF0000")
    rt.add(" è“è‰²æ–‡å­—", color="blue")
    
    # 5. è®¾ç½®èƒŒæ™¯é«˜äº®
    rt.add(" é»„åº•æ–‡å­—", highlight="yellow")
    
    # 6. è®¾ç½®å­—ä½“å¤§å°ï¼ˆå•ä½ï¼šç£…ï¼‰
    rt.add(" å°å·å­—", size=8)
    rt.add(" å¤§å·å­—", size=20)
    
    # 7. ä¸Šä¸‹æ ‡è®¾ç½®
    rt.add(" æ­£å¸¸æ–‡å­—")
    rt.add(" ä¸Šæ ‡", superscript=True)
    rt.add(" ä¸‹æ ‡", subscript=True)
    
    # 8. å­—ä½“æ ·å¼
    rt.add(" åŠ ç²—", bold=True)
    rt.add(" å€¾æ–œ", italic=True)
    rt.add(" ä¸‹åˆ’çº¿", underline=True)
    rt.add(" åˆ é™¤çº¿", strike=True)
    
    # 9. å­—ä½“è®¾ç½®
    rt.add(" å®‹ä½“", font="eastAsia:SimSun")
    rt.add(" å¾®è½¯é›…é»‘", font="eastAsia:Microsoft YaHei")
    
    # 10. è¶…é“¾æ¥ï¼ˆéœ€è¦å…ˆç”Ÿæˆé“¾æ¥IDï¼‰
    url_id = doc.build_url_id("https://www.example.com")
    rt.add(" è¶…é“¾æ¥æ–‡æœ¬", url_id=url_id)
    
    # 11. æ–‡å­—æ–¹å‘
    rt.add(" æ­£å¸¸æ–¹å‘")
    rt.add(" ä»å³å‘å·¦æ–‡å­—", rtl=True) # ä¸­æ–‡è®¾ç½®æ— æ•ˆæœ
    
    # 12. è¯­è¨€è®¾ç½®
    rt.add(" English text", lang="en-US")
    rt.add(" ä¸­æ–‡æ–‡æœ¬", lang="zh-CN")
    
    context = {
        'rich_text_var': rt
    }
    doc.render(context)
    os.makedirs('output',exist_ok=True)
    doc.save("output/generated_document.docx")
    

åœ¨æ¨¡æ¿ä¸­åªéœ€ç®€å•å¼•ç”¨ï¼š

    {{ rich_text_var }}
    

1.10 é”™è¯¯ç®¡ç†
---------

TemplateErrorç±»æ˜¯Jinja2æ¨¡æ¿å¼•æ“ä¸­æ‰€æœ‰æ¨¡æ¿ç›¸å…³å¼‚å¸¸çš„åŸºç±»ï¼Œåœ¨python-docx-templateä¸­ä¸“é—¨ç”¨äºæ•è·æ¨¡æ¿æ¸²æŸ“è¿‡ç¨‹ä¸­å‡ºç°çš„å„ç±»é”™è¯¯ã€‚å½“ä½¿ç”¨`tpl.render()`æ¸²æŸ“ Word æ¨¡æ¿æ—¶ï¼Œä»¥ä¸‹æƒ…å†µä¼šæŠ›å‡º`TemplateError`å¼‚å¸¸ï¼š

*   æ¨¡æ¿ä¸­å¼•ç”¨äº†æœªä¼ å…¥çš„å˜é‡ï¼ˆå¦‚æ¨¡æ¿å†™äº†`{{ name }}`ï¼Œä½†`render`åªä¼ äº†`test_variable`ï¼‰ï¼›
*   æ¨¡æ¿ä¸­çš„Jinja2è¯­æ³•é”™è¯¯ï¼ˆå¦‚ç¼ºå°‘é—­åˆçš„`{% endif %}`ã€å˜é‡å¼•ç”¨æ ¼å¼é”™è¯¯ï¼‰ï¼›
*   æ¨¡æ¿ä¸­ä½¿ç”¨äº†ä¸å­˜åœ¨çš„è¿‡æ»¤å™¨/å‡½æ•°ï¼ˆå¦‚`{{ test_variable | xxx }}`ï¼Œ`xxx`ä¸æ˜¯ Jinja2 å†…ç½®è¿‡æ»¤å™¨ï¼‰ã€‚

ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•æµ‹æ•è·Wordæ¨¡æ¿æ¸²æŸ“æ—¶çš„TemplateErrorå¼‚å¸¸ï¼Œå¹¶æ‰“å°è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š

    from docxtpl import DocxTemplate
    from jinja2.exceptions import TemplateError
    
    print("=" * 50)
    print("æ­£åœ¨ç”Ÿæˆæµ‹è¯•ç”¨çš„æ¨¡æ¿é”™è¯¯")
    print("." * 50)
    
    try:
        tpl = DocxTemplate("templates/template_error_tpl.docx")
        # å¦‚æœæ¨¡æ¿ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯æˆ–å˜é‡ç¼ºå¤±ï¼Œä¼šè§¦å‘TemplateErrorå¼‚å¸¸
        tpl.render({"test_variable": "æµ‹è¯•å˜é‡å€¼"})
    # æ•è·æ¨¡æ¿æ¸²æŸ“è¿‡ç¨‹ä¸­å‡ºç°çš„æ‰€æœ‰TemplateErrorå¼‚å¸¸
    except TemplateError as the_error:
        # æ‰“å°é”™è¯¯çš„åŸºæœ¬æè¿°ä¿¡æ¯
        print(f"æ¨¡æ¿æ¸²æŸ“é”™è¯¯ï¼š{str(the_error)}")
        # æ£€æŸ¥å¼‚å¸¸å¯¹è±¡æ˜¯å¦åŒ…å«docx_contextå±æ€§
        if hasattr(the_error, "docx_context"):
            # æ‰“å°ä¸Šä¸‹æ–‡ä¿¡æ¯çš„æ ‡é¢˜
            print("é”™è¯¯ä¸Šä¸‹æ–‡è¯¦æƒ…ï¼š")
            # éå†å¹¶æ‰“å°é”™è¯¯ä¸Šä¸‹æ–‡çš„æ¯ä¸€è¡Œå†…å®¹
            for line in the_error.docx_context:
                print(line)
    # ç¡®ä¿tplå˜é‡å­˜åœ¨æ—¶å†æ‰§è¡Œä¿å­˜æ“ä½œ
    if 'tpl' in locals():
        # å°†æ¸²æŸ“åçš„æ–‡æ¡£ä¿å­˜åˆ°æŒ‡å®šè·¯å¾„
        tpl.save("output/template_error.docx")
        print(f"æ–‡æ¡£å·²ä¿å­˜è‡³ï¼šoutput/template_error.docx")
    print("." * 50)
    print(" æ¨¡æ¿é”™è¯¯æµ‹è¯•å®Œæˆ ")
    print("=" * 50)
    

2 å‚è€ƒ
====

*   [python-docx-templateæ¨¡æ¿åŒ–Wordæ–‡æ¡£ç”ŸæˆæŒ‡åŒ—](https://www.cnblogs.com/luohenyueji/p/19503461)
*   [python-docx-template](https://github.com/elapouya/python-docx-template)
*   [python-docx-template doc](https://docxtpl.readthedocs.io/)

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š[è½ç—•çš„å¯’å‡](https://www.cnblogs.com/luohenyueji/)ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/luohenyueji/p/19556736](https://www.cnblogs.com/luohenyueji/p/19556736)

![](https://gitlab.com/luohenyueji/article_picture_warehouse/-/raw/main/wechat/content/%E5%8A%A0%E6%B2%B9%E9%B8%AD.gif)