---
layout: post
title: 'C++ æµ'
date: "2025-07-02T00:43:13Z"
---
C++ æµ
=====

åœ¨ C++ æ ‡å‡†åº“ä¸­ï¼Œ**streamï¼ˆæµï¼‰**æ˜¯å¤„ç†è¾“å…¥è¾“å‡ºï¼ˆI/Oï¼‰çš„æ ¸å¿ƒæŠ½è±¡ï¼Œåˆ†ä¸ºè¾“å…¥æµï¼ˆ`istream`ï¼‰ã€è¾“å‡ºæµï¼ˆ`ostream`ï¼‰ã€è¾“å…¥è¾“å‡ºæµï¼ˆ`iostream`ï¼‰ç­‰å¤šç§ç±»å‹ï¼Œä¸”æ”¯æŒé¢å‘ä¸åŒè®¾å¤‡ï¼ˆæ–‡ä»¶ã€å­—ç¬¦ä¸²ã€æ§åˆ¶å°ç­‰ï¼‰çš„å…·ä½“æµç±»å‹ã€‚

* * *

Stream ç±»å‹
=========

ç±»åˆ«

ä¸»è¦ç±»å‹åŠè¯´æ˜

å¤´æ–‡ä»¶

**è¾“å…¥æµ**

`std::istream`ï¼šé€šç”¨è¾“å…¥æµåŸºç±»

`<istream>`

`std::ifstream`ï¼šæ–‡ä»¶è¾“å…¥æµ

`<fstream>`

`std::istringstream`ï¼šå­—ç¬¦ä¸²è¾“å…¥æµ

`<sstream>`

**è¾“å‡ºæµ**

`std::ostream`ï¼šé€šç”¨è¾“å‡ºæµåŸºç±»

`<ostream>`

`std::ofstream`ï¼šæ–‡ä»¶è¾“å‡ºæµ

`<fstream>`

`std::ostringstream`ï¼šå­—ç¬¦ä¸²è¾“å‡ºæµ

`<sstream>`

**è¾“å…¥è¾“å‡ºæµ**

`std::iostream`ï¼šé€šç”¨è¾“å…¥è¾“å‡ºæµåŸºç±»

`<iostream>`

`std::fstream`ï¼šæ–‡ä»¶è¾“å…¥è¾“å‡ºæµ

`<fstream>`

`std::stringstream`ï¼šå­—ç¬¦ä¸²è¾“å…¥è¾“å‡ºæµ

`<sstream>`

**æ ‡å‡†æµå¯¹è±¡**

`std::cin`ï¼šæ ‡å‡†è¾“å…¥æµï¼ˆå…¨å±€å¯¹è±¡ï¼‰

`<iostream>`

`std::cout`ï¼šæ ‡å‡†è¾“å‡ºæµï¼ˆå…¨å±€å¯¹è±¡ï¼‰

`<iostream>`

`std::cerr`ï¼šæ ‡å‡†é”™è¯¯è¾“å‡ºæµï¼ˆæ— ç¼“å†²ï¼‰

`<iostream>`

`std::clog`ï¼šæ ‡å‡†é”™è¯¯è¾“å‡ºæµï¼ˆå¸¦ç¼“å†²ï¼‰

`<iostream>`

* * *

ç»§æ‰¿å…³ç³»ç®€å›¾ï¼ˆç®€åŒ–ç‰ˆï¼‰

    std::ios_base
        â””â”€â”€ std::ios
               â”œâ”€â”€ std::istream
               â”‚      â”œâ”€â”€ std::ifstream
               â”‚      â””â”€â”€ std::istringstream
               â”œâ”€â”€ std::ostream
               â”‚      â”œâ”€â”€ std::ofstream
               â”‚      â””â”€â”€ std::ostringstream
               â””â”€â”€ std::iostream
                      â”œâ”€â”€ std::fstream
                      â””â”€â”€ std::stringstream
    

* * *

* * *

ä¸€ã€æ ‡å‡†æµ
-----

C++ æ ‡å‡†åº“å®šä¹‰äº†å››ä¸ªä¸»è¦çš„æ ‡å‡†æµå¯¹è±¡ï¼š

å¯¹è±¡å

ç±»å‹

åŠŸèƒ½æè¿°

ç¼“å†²æœºåˆ¶

ç”¨é€”

`std::cin`

`std::istream`

æ ‡å‡†è¾“å…¥æµï¼Œé€šå¸¸å…³è”é”®ç›˜è¾“å…¥

å¸¦ç¼“å†²

ä»é”®ç›˜æˆ–é‡å®šå‘è¾“å…¥è¯»å–æ•°æ®

`std::cout`

`std::ostream`

æ ‡å‡†è¾“å‡ºæµï¼Œé€šå¸¸å…³è”æ§åˆ¶å°æ˜¾ç¤º

å¸¦ç¼“å†²

å‘æ§åˆ¶å°æˆ–é‡å®šå‘è¾“å‡ºå†™æ•°æ®

`std::cerr`

`std::ostream`

æ ‡å‡†é”™è¯¯è¾“å‡ºæµï¼Œå…³è”æ§åˆ¶å°æ˜¾ç¤º

**æ— ç¼“å†²**

ç”¨äºé”™è¯¯æˆ–å³æ—¶è¾“å‡ºæç¤º

`std::clog`

`std::ostream`

æ ‡å‡†æ—¥å¿—è¾“å‡ºæµï¼Œå…³è”æ§åˆ¶å°æ˜¾ç¤º

å¸¦ç¼“å†²

ç”¨äºç¨‹åºæ—¥å¿—ä¿¡æ¯è¾“å‡º

* * *

### 1\. `std::cin` - æ ‡å‡†è¾“å…¥æµ

*   ç±»å‹ï¼š`std::istream`
*   é»˜è®¤å…³è”è®¾å¤‡ï¼šé”®ç›˜ï¼ˆç»ˆç«¯è¾“å…¥ï¼‰
*   ç”¨æ³•ï¼š

    int x;
    std::cin >> x;  // ä»æ ‡å‡†è¾“å…¥è¯»å–ä¸€ä¸ªæ•´æ•°
    

*   **ç¼“å†²**ï¼šå¸¦ç¼“å†²ã€‚è¾“å…¥æ—¶ä¼šå…ˆç¼“å†²ä¸€éƒ¨åˆ†æ•°æ®ï¼Œé€šå¸¸æ˜¯æ•´è¡Œè¯»å–åäº¤ç»™ç¨‹åºå¤„ç†ã€‚
*   æ”¯æŒæ ¼å¼åŒ–è¾“å…¥ï¼š`operator>>` ä¼šè‡ªåŠ¨è·³è¿‡ç©ºç™½ã€æ¢è¡Œï¼Œè¿›è¡Œç±»å‹è½¬æ¢ã€‚
*   æ”¯æŒé‡å®šå‘ï¼šä¾‹å¦‚ä»æ–‡ä»¶è¯»å–æ—¶ï¼Œå‘½ä»¤è¡Œé‡å®šå‘è¾“å…¥ `program < input.txt`ã€‚

* * *

### 2\. `std::cout` - æ ‡å‡†è¾“å‡ºæµ

*   ç±»å‹ï¼š`std::ostream`
*   é»˜è®¤å…³è”è®¾å¤‡ï¼šæ§åˆ¶å°ï¼ˆç»ˆç«¯æ˜¾ç¤ºï¼‰
*   ç”¨æ³•ï¼š

    std::cout << "Hello, world!" << std::endl;
    

*   **ç¼“å†²**ï¼šå¸¦ç¼“å†²ã€‚ç¼“å†²åŒºæ»¡æˆ–è€…é‡åˆ° `std::endl` ä¼šåˆ·æ–°ç¼“å†²åŒºå†™åˆ°ç»ˆç«¯ã€‚
*   æ”¯æŒå„ç§ç±»å‹çš„æ ¼å¼åŒ–è¾“å‡ºï¼ˆæ•´å‹ã€æµ®ç‚¹ã€å­—ç¬¦ä¸²ã€è‡ªå®šä¹‰ç±»å‹é‡è½½ `operator<<`ï¼‰ã€‚
*   æ”¯æŒé‡å®šå‘ï¼šä¾‹å¦‚æŠŠè¾“å‡ºå†™å…¥æ–‡ä»¶ `program > output.txt`ã€‚

* * *

### 3\. `std::cerr` - æ ‡å‡†é”™è¯¯è¾“å‡ºæµ

*   ç±»å‹ï¼š`std::ostream`
*   é»˜è®¤å…³è”è®¾å¤‡ï¼šæ§åˆ¶å°ï¼ˆç»ˆç«¯æ˜¾ç¤ºï¼‰
*   **æ— ç¼“å†²**è¾“å‡ºï¼šå†™å…¥æ—¶ç«‹å³å‘é€åˆ°ç»ˆç«¯ï¼Œé€‚åˆæ‰“å°é”™è¯¯æˆ–è­¦å‘Šä¿¡æ¯ï¼Œç¡®ä¿åŠæ—¶å¯è§ã€‚
*   ç”¨æ³•ï¼š

    std::cerr << "Error: File not found!" << std::endl;
    

*   ä½œç”¨æ˜¯å’Œ `cout` åˆ†å¼€è¾“å‡ºï¼Œæ–¹ä¾¿ç»ˆç«¯æˆ–è„šæœ¬æ•è·é”™è¯¯ä¿¡æ¯ã€‚
*   ä¸å—ç¼“å†²å½±å“ï¼Œå³ä½¿ç¨‹åºå¼‚å¸¸é€€å‡ºä¹Ÿæ›´å®¹æ˜“ä¿è¯é”™è¯¯ä¿¡æ¯æ‰“å°å‡ºæ¥ã€‚

* * *

### 4\. `std::clog` - æ ‡å‡†æ—¥å¿—è¾“å‡ºæµ

*   ç±»å‹ï¼š`std::ostream`
*   é»˜è®¤å…³è”è®¾å¤‡ï¼šæ§åˆ¶å°ï¼ˆç»ˆç«¯æ˜¾ç¤ºï¼‰
*   **å¸¦ç¼“å†²**è¾“å‡ºï¼Œé€‚åˆå¤§é‡æ—¥å¿—ä¿¡æ¯ï¼Œæ•ˆç‡é«˜ã€‚
*   ç”¨æ³•ï¼š

    std::clog << "Log: Starting the program..." << std::endl;
    

*   ç”¨äºæ—¥å¿—ä¿¡æ¯è¾“å‡ºï¼Œä¸åŒäº `cerr` ä¸»è¦æ˜¯â€œé”™è¯¯â€ï¼Œ`clog` ä¸»è¦æ˜¯â€œæ—¥å¿—â€ã€‚
*   å’Œ `cerr` åŒºåˆ«åœ¨äºç¼“å†²æ–¹å¼å’Œè¾“å‡ºè¯­ä¹‰ã€‚

* * *

### æ ‡å‡†æµå¯¹è±¡å¸¸ç”¨æ“ä½œå’Œç‰¹æ€§

æ“ä½œ

ç¤ºä¾‹

è¯´æ˜

è¯»å–è¾“å…¥

`std::cin >> x;`

ä»é”®ç›˜è¯»å–æ ¼å¼åŒ–è¾“å…¥

è¾“å‡ºæ–‡æœ¬

`std::cout << "Hello\n";`

å‘ç»ˆç«¯æ‰“å°æ–‡æœ¬

è¾“å‡ºé”™è¯¯ä¿¡æ¯

`std::cerr << "Error!\n";`

ç«‹å³æ‰“å°é”™è¯¯ä¿¡æ¯

è¾“å‡ºæ—¥å¿—

`std::clog << "Log message\n";`

ç¼“å†²å†™å…¥æ—¥å¿—ä¿¡æ¯

åˆ·æ–°ç¼“å†²åŒº

`std::cout.flush();` æˆ– `std::cout << std::flush;`

ç«‹å³å°†ç¼“å†²å†…å®¹å†™å…¥è®¾å¤‡

æ“çºµç¬¦æ¢è¡Œ+åˆ·æ–°

`std::cout << std::endl;`

è¾“å‡ºæ¢è¡Œå¹¶åˆ·æ–°ç¼“å†²

åˆ¤æ–­æµçŠ¶æ€

`if (!std::cin) { /* è¯»å–å¤±è´¥ */ }`

åˆ¤æ–­æµæ˜¯å¦å¤„äºé”™è¯¯çŠ¶æ€

é‡å®šå‘æµ

å‘½ä»¤è¡Œé‡å®šå‘ `program < input.txt > output.txt`

æ”¹å˜æµçš„è¾“å…¥è¾“å‡ºè®¾å¤‡

* * *

### æ ‡å‡†æµå¯¹è±¡çš„ç¼“å†²ç­–ç•¥

æµå¯¹è±¡

ç¼“å†²ç±»å‹

è¯´æ˜

`std::cin`

å¸¦ç¼“å†²

è¯»å–æ—¶å…ˆç¼“å†²ï¼Œä¼˜åŒ–è¾“å…¥æ•ˆç‡

`std::cout`

å¸¦ç¼“å†²

è¾“å‡ºæ—¶ç¼“å­˜ï¼Œé‡æ¢è¡Œæˆ–ç¼“å†²æ»¡æ—¶åˆ·æ–°

`std::cerr`

æ— ç¼“å†²

é”™è¯¯ä¿¡æ¯ç«‹å³è¾“å‡ºï¼Œä¸ç­‰å¾…ç¼“å†²åˆ·æ–°

`std::clog`

å¸¦ç¼“å†²

æ—¥å¿—è¾“å‡ºç¼“å†²ï¼Œæé«˜æ•ˆç‡

äºŒã€è¾“å…¥è¾“å‡ºæµ
-------

åœ¨C++ä¸­ï¼Œ**è¾“å…¥è¾“å‡ºæµï¼ˆInput/Output Streamï¼‰**æ˜¯å¯¹æ•°æ®æµåŠ¨æ–¹å‘çš„æŠ½è±¡ï¼Œç”¨äºä»æŸä¸ªè®¾å¤‡ï¼ˆå¦‚é”®ç›˜ã€æ–‡ä»¶ã€å†…å­˜ï¼‰è¯»å–æ•°æ®æˆ–å‘å…¶å†™å…¥æ•°æ®ã€‚è¾“å…¥æµè´Ÿè´£è¯»å–ï¼Œè¾“å‡ºæµè´Ÿè´£å†™å…¥ã€‚**è¾“å…¥è¾“å‡ºæµ**å³åŒæ—¶æ”¯æŒ**è¾“å…¥å’Œè¾“å‡º**çš„æµï¼Œèƒ½æ—¢ä»ä¸­è¯»å–æ•°æ®ï¼Œä¹Ÿå‘å…¶ä¸­å†™å…¥æ•°æ®ã€‚

### åŸºæœ¬æµå±‚çº§å’Œå…·ä½“å®ç°ç±»

### `std::iostream`

*   ç»§æ‰¿è‡ª `std::istream` å’Œ `std::ostream`ã€‚æ”¯æŒæ ‡å‡†è¾“å…¥è¾“å‡ºæµçš„æ‰€æœ‰æ“ä½œã€‚æ—¢å¯ä»¥ç”¨ä½œè¾“å…¥æµï¼Œä¹Ÿå¯ä»¥ç”¨ä½œè¾“å‡ºæµã€‚
*   åº•å±‚ä¾èµ–äºç¼“å†²åŒºï¼ˆbufferï¼‰ç®¡ç†ï¼Œé¿å…é¢‘ç¹ç³»ç»Ÿè°ƒç”¨ï¼Œæå‡æ•ˆç‡ã€‚`iostream` å¯¹è±¡æ‹¥æœ‰ä¸€ä¸ª`streambuf`ç¼“å†²åŒºæŒ‡é’ˆï¼Œé€šè¿‡å®ƒå®ç°å…·ä½“è¯»å†™ã€‚`iostream` ç»§æ‰¿äº†æ ¼å¼åŒ–è¾“å…¥è¾“å‡ºçš„èƒ½åŠ›ï¼Œæ¯”å¦‚æ”¯æŒ`operator>>`ã€`operator<<`å¯¹å„ç§ç±»å‹çš„é‡è½½ã€‚

ç±»å

åŠŸèƒ½æè¿°

å¤´æ–‡ä»¶

`std::ios_base`

I/O åº“çš„åŸºç¡€ç±»ï¼Œç®¡ç†æ ¼å¼åŒ–å’ŒçŠ¶æ€

`<ios>`

`std::ios`

ç»§æ‰¿è‡ª `ios_base`ï¼Œå¢åŠ ç¼“å†²ç­‰æ”¯æŒ

`<ios>`

`std::istream`

è¾“å…¥æµåŸºç±»

`<istream>`

`std::ostream`

è¾“å‡ºæµåŸºç±»

`<ostream>`

`std::iostream`

è¾“å…¥è¾“å‡ºæµåŸºç±»ï¼ˆç»§æ‰¿è‡ª `istream` å’Œ `ostream`ï¼‰

`<iostream>`

`iostream`ç»§æ‰¿äº†è¾“å…¥æµå’Œè¾“å‡ºæµçš„åŠŸèƒ½ï¼Œå› æ­¤å¯åŒæ—¶è¯»å†™ã€‚

* * *

å…·ä½“å®ç°ç±»ï¼š

ç±»å

ç”¨é€”

å¤´æ–‡ä»¶

`std::fstream`

æ–‡ä»¶è¾“å…¥è¾“å‡ºæµ

`<fstream>`

`std::stringstream`

å†…å­˜å­—ç¬¦ä¸²è¾“å…¥è¾“å‡ºæµ

`<sstream>`

#### 1\. æ–‡ä»¶è¯»å†™ï¼ˆä½¿ç”¨ `std::fstream`ï¼‰

    #include <fstream>
    #include <iostream>
    #include <string>
    
    int main() {
        std::fstream file("example.txt", std::ios::in | std::ios::out | std::ios::trunc);
        if (!file) {
            std::cerr << "æ–‡ä»¶æ‰“å¼€å¤±è´¥\n";
            return 1;
        }
    
        // å†™å…¥æ•°æ®
        file << "Hello, iostream!\n";
    
        // é‡ç½®æ–‡ä»¶è¯»å–ä½ç½®åˆ°å¼€å¤´
        file.seekg(0);
    
        // è¯»å–æ•°æ®
        std::string line;
        std::getline(file, line);
        std::cout << "æ–‡ä»¶å†…å®¹: " << line << std::endl;
    
        file.close();
        return 0;
    }
    

* * *

#### 2\. å†…å­˜å­—ç¬¦ä¸²è¯»å†™ï¼ˆä½¿ç”¨ `std::stringstream`ï¼‰

    #include <sstream>
    #include <iostream>
    
    int main() {
        std::stringstream ss;
    
        // å†™å…¥
        ss << "123 456";
    
        int a, b;
        // è¯»å–
        ss >> a >> b;
    
        std::cout << "è¯»å–åˆ°çš„æ•°å­—ï¼š" << a << ", " << b << std::endl;
    }
    //è¾“å‡ºï¼š è¯»å–åˆ°çš„æ•°å­—ï¼š123, 456
    

* * *

### å¸¸ç”¨æˆå‘˜å‡½æ•°ï¼ˆéƒ¨åˆ†ï¼‰

å‡½æ•°

è¯´æ˜

`operator>>`

æ ¼å¼åŒ–è¾“å…¥ï¼ˆè¯»å–ï¼‰

`operator<<`

æ ¼å¼åŒ–è¾“å‡ºï¼ˆå†™å…¥ï¼‰

`read(char*, size_t)`

è¯»å–åŸå§‹å­—èŠ‚æµ

`write(char*, size_t)`

å†™å…¥åŸå§‹å­—èŠ‚æµ

`get()`

è¯»å–ä¸€ä¸ªå­—ç¬¦

`put(char)`

å†™å…¥ä¸€ä¸ªå­—ç¬¦

`seekg(pos)`

è®¾ç½®è¾“å…¥ä½ç½®

`seekp(pos)`

è®¾ç½®è¾“å‡ºä½ç½®

`tellg()`

è·å–å½“å‰è¾“å…¥ä½ç½®

`tellp()`

è·å–å½“å‰è¾“å‡ºä½ç½®

`good()`, `fail()`, `eof()`

æ£€æŸ¥æµçŠ¶æ€

`flush()`

åˆ·æ–°ç¼“å†²åŒº

æµçŠ¶æ€åŠé”™è¯¯å¤„ç†
--------

åœ¨ C++ ä¸­ï¼Œè¾“å…¥è¾“å‡ºæµï¼ˆ`iostream`ï¼‰æä¾›äº†çŠ¶æ€æ ‡å¿—å’Œé”™è¯¯å¤„ç†æœºåˆ¶ï¼Œç”¨äºæ£€æµ‹å’Œå¤„ç† I/O æ“ä½œä¸­çš„å¼‚å¸¸æˆ–é”™è¯¯æƒ…å†µã€‚ç†è§£è¿™äº›æœºåˆ¶å¯¹äºç¼–å†™å¥å£®çš„ I/O ä»£ç éå¸¸é‡è¦ã€‚

* * *

### æµçš„çŠ¶æ€æ ‡å¿—ï¼ˆStream State Flagsï¼‰

C++ çš„æµå¯¹è±¡ï¼ˆå¦‚ `std::ifstream`, `std::ofstream`, `std::cin`, `std::cout` ç­‰ï¼‰éƒ½ç»§æ‰¿è‡ª `std::ios_base` ç±»ï¼Œå¹¶ç»´æŠ¤ä¸€ç»„çŠ¶æ€æ ‡å¿—æ¥è¡¨ç¤ºæµå½“å‰çš„çŠ¶æ€ã€‚è¿™äº›çŠ¶æ€æ ‡å¿—æ˜¯é€šè¿‡æˆå‘˜å‡½æ•° `rdstate()` è·å–çš„ï¼Œå…¶ç±»å‹ä¸º `std::ios_base::iostate`ã€‚

å¸¸è§çš„çŠ¶æ€æ ‡å¿—åŒ…æ‹¬ï¼š

æ ‡å¿—

å«ä¹‰

`goodbit`

æ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼ˆä¸€åˆ‡æ­£å¸¸ï¼‰

`badbit`

å‘ç”Ÿäº†ä¸å¯æ¢å¤çš„è¯»å†™é”™è¯¯ï¼ˆä¾‹å¦‚åº•å±‚è®¾å¤‡å‡ºé”™ï¼‰

`failbit`

è¾“å…¥/è¾“å‡ºæ“ä½œå¤±è´¥ï¼ˆä½†æµä»å¯ç”¨ï¼Œä¾‹å¦‚ç±»å‹ä¸åŒ¹é…ï¼‰

`eofbit`

åˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼ˆEOFï¼‰

### ç¤ºä¾‹ï¼š

    #include <iostream>
    #include <fstream>
    
    int main() {
        std::ifstream file("example.txt");
        if (!file) {
            std::cerr << "Failed to open file.\n";
        }
    
        int value;
        file >> value;
    
        if (file.fail()) {
            std::cerr << "Input failed: type mismatch or bad input.\n";
        }
        if (file.bad()) {
            std::cerr << "Serious I/O error occurred.\n";
        }
        if (file.eof()) {
            std::cerr << "End of file reached.\n";
        }
        if (file.good()) {
            std::cout << "Everything is fine.\n";
        }
    
        return 0;
    }
    

* * *

### çŠ¶æ€æ£€æŸ¥å‡½æ•°

é™¤äº†ç›´æ¥ä½¿ç”¨ `rdstate()` æ¥è·å–çŠ¶æ€ä½å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æˆå‘˜å‡½æ•°è¿›è¡ŒçŠ¶æ€åˆ¤æ–­ï¼š

å‡½æ•°å

è¿”å›å€¼è¯´æ˜

`good()`

æ˜¯å¦å¤„äºè‰¯å¥½çŠ¶æ€ï¼ˆæ²¡æœ‰è®¾ç½®ä»»ä½•é”™è¯¯æ ‡å¿—ï¼‰

`bad()`

æ˜¯å¦å‘ç”Ÿäº†ä¸å¯æ¢å¤çš„é”™è¯¯

`fail()`

æ˜¯å¦å‘ç”Ÿäº†å¯æ¢å¤çš„é”™è¯¯ï¼ˆåŒ…æ‹¬ `eofbit`ï¼‰

`eof()`

æ˜¯å¦åˆ°è¾¾æ–‡ä»¶æœ«å°¾

`operator!()`

æ˜¯å¦å¤„äºå¤±è´¥çŠ¶æ€ï¼ˆå³ `fail()` ä¸ºçœŸï¼‰

`operator bool()`

æ˜¯å¦å¤„äºéå¤±è´¥çŠ¶æ€ï¼ˆå³ `!fail()` ä¸ºçœŸï¼‰

* * *

æ¸…é™¤çŠ¶æ€æ ‡å¿—
------

å¦‚æœä½ å¸Œæœ›ç»§ç»­ä½¿ç”¨ä¸€ä¸ªå·²ç»å‡ºé”™çš„æµå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ `clear()` æˆ– `clear(iostate)` å‡½æ•°æ¥æ¸…é™¤çŠ¶æ€æ ‡å¿—ã€‚

### ç¤ºä¾‹ï¼š

    #include <iostream>
    
    int main() {
        int num;
        std::cin >> num;
    
        if (std::cin.fail()) {
            std::cin.clear(); // æ¸…é™¤ failbit
            std::cin.ignore(10000, '\n'); // å¿½ç•¥ç¼“å†²åŒºä¸­çš„éæ³•è¾“å…¥
            std::cout << "Invalid input. Please enter an integer: ";
            std::cin >> num;
        }
    
        std::cout << "You entered: " << num << std::endl;
        return 0;
    }
    

* * *

é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æœºåˆ¶ï¼ˆException Handlingï¼‰
-----------------------------

é»˜è®¤æƒ…å†µä¸‹ï¼ŒC++ æµä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡çŠ¶æ€æ ‡å¿—æ¥æŠ¥å‘Šé”™è¯¯ã€‚ä½†ä½ å¯ä»¥é€šè¿‡ `exceptions()` å‡½æ•°å¯ç”¨å¼‚å¸¸å¤„ç†ã€‚

### ç¤ºä¾‹ï¼šå¯ç”¨å¼‚å¸¸

    #include <iostream>
    #include <fstream>
    
    int main() {
        std::ifstream file("nonexistent.txt");
    
        // å¯ç”¨å¼‚å¸¸ï¼šå½“æµçŠ¶æ€å˜ä¸º badbit æˆ– failbit æ—¶æŠ›å‡ºå¼‚å¸¸
        file.exceptions(std::ifstream::failbit | std::ifstream::badbit);
    
        try {
            int value;
            file >> value; // å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æ³•è¯»å–ï¼Œå°†æŠ›å‡ºå¼‚å¸¸
        } catch (const std::ios_base::failure& e) {
            std::cerr << "Caught an exception: " << e.what() << '\n';
        }
    
        return 0;
    }
    

> âš ï¸ æ³¨æ„ï¼šå¯ç”¨å¼‚å¸¸åï¼ŒæŸäº›æ“ä½œï¼ˆå¦‚æ„é€ å¤±è´¥ï¼‰å¯èƒ½ä¸ä¼šè§¦å‘å¼‚å¸¸ã€‚å»ºè®®ç»“åˆ `if (!file)` è¿›è¡Œæ£€æŸ¥ã€‚

ä¸‰ã€è¾“å…¥æµ
-----

åœ¨ C++ ä¸­ï¼Œ**è¾“å…¥æµï¼ˆInput Streamï¼‰** æ˜¯ä¸€ç§ç”¨äºä»æ•°æ®æºè¯»å–æ•°æ®çš„æœºåˆ¶ã€‚C++ çš„æ ‡å‡†åº“æä¾›äº†å¼ºå¤§çš„ I/O æµç±»åº“ï¼Œå…¶ä¸­ä¸è¾“å…¥ç›¸å…³çš„ç±»ä¸»è¦åŒ…æ‹¬ï¼š

*   `std::istream`ï¼šåŸºæœ¬è¾“å…¥æµç±»ã€‚
*   `std::ifstream`ï¼šç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚
*   `std::istringstream`ï¼šç”¨äºä»å­—ç¬¦ä¸²ä¸­è¯»å–æ•°æ®ã€‚
*   `std::cin`ï¼šæ ‡å‡†è¾“å…¥æµå¯¹è±¡ï¼ˆé€šå¸¸æ¥è‡ªé”®ç›˜ï¼‰ã€‚

æ‰€æœ‰è¾“å…¥æµéƒ½ç»§æ‰¿è‡ª `std::istream` ç±»ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯æä¾›è¯»å–æ“ä½œç¬¦ `>>` å’Œæˆå‘˜å‡½æ•°å¦‚ `get()`, `getline()`, `read()` ç­‰ã€‚

### å¸¸ç”¨è¾“å…¥æµå¯¹è±¡ï¼š

å¯¹è±¡/ç±»

æè¿°

`std::cin`

æ ‡å‡†è¾“å…¥æµï¼Œé»˜è®¤ä»æ§åˆ¶å°è¯»å–

`std::ifstream`

æ–‡ä»¶è¾“å…¥æµ

`std::istringstream`

å­—ç¬¦ä¸²è¾“å…¥æµ

* * *

### å¸¸ç”¨è¾“å…¥æ–¹æ³•

### 1\. ä½¿ç”¨ `operator >>`ï¼ˆæå–è¿ç®—ç¬¦ï¼‰

è¿™æ˜¯æœ€å¸¸ç”¨çš„è¾“å…¥æ–¹å¼ï¼Œç”¨äºæŒ‰ç±»å‹è¯»å–æ•°æ®ã€‚

    #include <iostream>
    
    int main() {
        int age;
        std::cout << "Enter your age: ";
        std::cin >> age;
        std::cout << "You are " << age << " years old.\n";
        return 0;
    }
    

> **æ³¨æ„ï¼š**
> 
> *   å®ƒä¼šè‡ªåŠ¨è·³è¿‡å‰å¯¼ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€æ¢è¡Œã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰ã€‚
> *   å¦‚æœè¾“å…¥ç±»å‹ä¸åŒ¹é…ï¼ˆæ¯”å¦‚è¾“å…¥å­—æ¯è€Œéæ•°å­—ï¼‰ï¼Œå°†è®¾ç½® `failbit` æ ‡å¿—ã€‚

* * *

### 2\. ä½¿ç”¨ `get()` å‡½æ•°

ç”¨äºé€ä¸ªæˆ–æ‰¹é‡è¯»å–å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºç™½å­—ç¬¦ï¼‰ã€‚

#### å•å­—ç¬¦è¯»å–ï¼š

    #include <iostream>
    
    int main() {
        char ch;
        while (std::cin.get(ch)) {
            std::cout << ch;
        }
        return 0;
    }
    

#### å¤šå­—ç¬¦è¯»å–ï¼ˆå¸¦ç¼“å†²åŒºï¼‰ï¼š

    #include <iostream>
    
    int main() {
        char buffer[100];
        std::cin.get(buffer, 100);
        std::cout << "You entered: " << buffer << std::endl;
        return 0;
    }
    

> `get()` ä¸ä¼šè·³è¿‡ç©ºç™½å­—ç¬¦ï¼Œå¹¶ä¸”ä¸ä¼šè‡ªåŠ¨æ·»åŠ  `\0` ç»“å°¾ã€‚

* * *

### 3\. ä½¿ç”¨ `getline()` å‡½æ•°

ç”¨äºè¯»å–æ•´è¡Œè¾“å…¥ï¼Œç›´åˆ°é‡åˆ°æ¢è¡Œç¬¦ã€‚

    #include <iostream>
    
    int main() {
        char buffer[100];
        std::cin.get(buffer, 100);
        std::cout << "You entered: " << buffer << std::endl;
        return 0;
    }
    

æˆ–è€…ä½¿ç”¨ `std::string` ç‰ˆæœ¬ï¼š

    #include <iostream>
    #include <string>
    
    int main() {
        std::string line;
        std::getline(std::cin, line);
        std::cout << "You entered: " << line << std::endl;
        return 0;
    }
    

> `getline()` æ›´é€‚åˆè¯»å–åŒ…å«ç©ºæ ¼çš„å®Œæ•´å¥å­ã€‚

* * *

### 4\. ä½¿ç”¨ `read()` å‡½æ•°ï¼ˆäºŒè¿›åˆ¶æ¨¡å¼ï¼‰

ç”¨äºä¸€æ¬¡æ€§è¯»å–æŒ‡å®šæ•°é‡çš„å­—èŠ‚ï¼Œå¸¸ç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶å¤„ç†ã€‚

    char buffer[100];
    std::cin.read(buffer, sizeof(buffer));
    std::streamsize count = std::cin.gcount();
    std::cout.write(buffer, count); // è¾“å‡ºå·²è¯»å–çš„å†…å®¹
    

### æ–‡ä»¶è¾“å…¥æµ`ifstream`

`std::ifstream`ï¼ˆ**input file stream**ï¼‰æ˜¯**æ–‡ä»¶è¾“å…¥æµ**ï¼Œç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå°±åƒ `std::cin` ç”¨äºä»æ ‡å‡†è¾“å…¥è¯»å–ä¸€æ ·ã€‚

å®ƒæ˜¯ C++ çš„ IO åº“ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®šä¹‰åœ¨å¤´æ–‡ä»¶ `<fstream>` ä¸­ã€‚

    #include <fstream>
    

ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š

    std::ios_base
        â†‘
    std::ios
        â†‘
    std::istream
        â†‘
    std::ifstream
    

* * *

#### å¸¸ç”¨æ„é€ å‡½æ•°

æ„é€ å‡½æ•°å½¢å¼

è¯´æ˜

`ifstream()`

åˆ›å»ºæœªæ‰“å¼€ä»»ä½•æ–‡ä»¶çš„æµå¯¹è±¡

`ifstream(const char* filename)`

æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å–ï¼Œä½¿ç”¨é»˜è®¤æ¨¡å¼ï¼ˆæ–‡æœ¬æ¨¡å¼ï¼‰

`ifstream(const char* filename, ios::openmode mode)`

æŒ‡å®šæ¨¡å¼æ‰“å¼€æ–‡ä»¶

`ifstream(const std::string& filename, ios::openmode mode)`

ä½¿ç”¨ `std::string` ä½œä¸ºæ–‡ä»¶å

* * *

#### å¸¸è§æ‰“å¼€æ¨¡å¼ï¼ˆ`std::ios::openmode`ï¼‰

ä½ å¯ä»¥ä¼ ç»™ `ifstream` æ„é€ å‡½æ•°æˆ–è€… `open()` æ–¹æ³•çš„æ¨¡å¼ï¼š

æ¨¡å¼

å«ä¹‰

`ios::in`

ä»¥è¯»æ¨¡å¼æ‰“å¼€ï¼ˆé»˜è®¤ï¼‰

`ios::binary`

ä»¥äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€

`ios::ate`

æ‰“å¼€æ–‡ä»¶å¹¶å®šä½åˆ°æ–‡ä»¶å°¾

`ios::app`

è¿½åŠ æ¨¡å¼ï¼ˆifstream å¾ˆå°‘ç”¨ï¼‰

`ios::trunc`

æ¸…ç©ºæ–‡ä»¶ï¼ˆä»…ç”¨äº ofstreamï¼‰

âš ï¸ æ³¨æ„ï¼š`ifstream` é»˜è®¤è‡ªå¸¦ `ios::in`ï¼Œæ‰€ä»¥ä½ ä¸ç”¨æ˜¾å¼åŠ  unless å’Œå…¶ä»–æ¨¡å¼ç»„åˆã€‚

#### å¸¸è§ç”¨æ³•ç¤ºä¾‹

ğŸ”¸ 1. åŸºæœ¬è¯»å–ä¸€æ•´è¡Œ

    #include <iostream>
    #include <fstream>
    #include <string>
    
    int main() {
        std::ifstream infile("example.txt");
    
        if (!infile.is_open()) {
            std::cerr << "Failed to open file.\n";
            return 1;
        }
    
        std::string line;
        while (std::getline(infile, line)) {
            std::cout << "Line: " << line << '\n';
        }
    
        infile.close();
        return 0;
    }
    

* * *

ğŸ”¸ 2. æŒ‰å•è¯è¯»å–

    #include <iostream>
    #include <fstream>
    #include <string>
    
    int main() {
        std::ifstream infile("example.txt");
    
        if (!infile.is_open()) {
            std::cerr << "Failed to open file.\n";
        }
    
        std::string word;
        while (infile >> word) {
            std::cout << "Word: " << word << '\n';
        }
    
        infile.close();
        return 0;
    }
    

* * *

ğŸ”¸ 3. æŒ‰æ•°å­—è¯»å–

    #include <iostream>
    #include <fstream>
    #include <string>
    
    int main() {
        try {
            std::ifstream infile("/home/fxq/untitled3/example.txt");
    
            if (!infile.is_open()) {
                std::cerr << "Failed to open file.\n";
            }
    
            int num;
            while (infile >> num) {
                std::cout << "Read number: " << num << '\n';
            }
    
            infile.close();
        } catch (const std::runtime_error& e) {
             std::cerr << "å‘ç”Ÿå¼‚å¸¸: " << e.what() <<  std::endl;
        }
        return 0;
    }
    

* * *

ğŸ”¸ 4. ç”¨ `.open()` å»¶è¿Ÿæ‰“å¼€

    std::ifstream infile;
    infile.open("data.txt");
    
    if (!infile) {
        std::cerr << "Failed to open.\n";
    }
    

#### ç¼“å†²åŒº

C++ çš„ `std::ifstream` é»˜è®¤æ˜¯**å¸¦ç¼“å†²çš„**ï¼Œå…¶åº•å±‚ä½¿ç”¨äº†ä¸€ä¸ª**ç¼“å†²åŒºï¼ˆbufferï¼‰\*_æ¥ä¼˜åŒ–æ–‡ä»¶è¯»å–æ•ˆç‡ã€‚ä½†ä½ å¯ä»¥\*_è‡ªå®šä¹‰ç¼“å†²åŒºå¤§å°å’Œå†…å­˜**ï¼Œç”šè‡³è®¾ç½®æˆ**æ— ç¼“å†²**ã€‚ä¸‹é¢æ˜¯è¯¦ç»†è®²è§£ã€‚

* * *

##### é»˜è®¤æƒ…å†µä¸‹ï¼š`ifstream` è‡ªå¸¦ç¼“å†²

*   `ifstream` ä¼šä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„ç¼“å†²åŒºï¼ˆé€šå¸¸æ˜¯ 4KB æˆ– 8KBï¼‰ã€‚
*   å½“ä½ è°ƒç”¨ `read()`ã€`getline()`ã€`operator>>` ç­‰å‡½æ•°æ—¶ï¼Œ**æ•°æ®å…ˆè¿›å…¥ç¼“å†²åŒºï¼Œå†ä»ä¸­è§£ææˆ–è¿”å›ç»™ç”¨æˆ·ç¨‹åº**ã€‚
*   å¥½å¤„æ˜¯ï¼šå‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œæé«˜è¯»å–æ€§èƒ½ã€‚

* * *

##### è‡ªå®šä¹‰ç¼“å†²åŒºï¼š`rdbuf()->pubsetbuf()`

ä½ å¯ä»¥è®¾ç½®è‡ªå·±çš„ç¼“å†²åŒºæˆ–å–æ¶ˆç¼“å†²åŒºï¼š

    std::ifstream file("example.txt");
    char buffer[4096];  // è‡ªå®šä¹‰ç¼“å†²åŒº
    
    file.rdbuf()->pubsetbuf(buffer, sizeof(buffer));
    

*   `pubsetbuf(buffer, size)`ï¼šè®¾ç½®ç¼“å†²åŒºèµ·å§‹åœ°å€å’Œå¤§å°
*   åªèƒ½åœ¨ `open()` ä¹‹å‰è°ƒç”¨ï¼ˆå¯¹å·²æ‰“å¼€æ–‡ä»¶æ— æ•ˆï¼‰

* * *

##### è®¾ç½®æ— ç¼“å†²æ¨¡å¼ï¼ˆ**å¼ºçƒˆä¸æ¨èé™¤éç‰¹æ®Šéœ€æ±‚**ï¼‰

    file.rdbuf()->pubsetbuf(nullptr, 0); // ç¦ç”¨ç¼“å†²
    

âš ï¸ è¿™ä¼šè®©æ¯ä¸€æ¬¡ `read()` æˆ– `getline()` éƒ½å˜æˆç³»ç»Ÿè°ƒç”¨ï¼Œ**æ€§èƒ½ä¼šå¤§å¹…ä¸‹é™**ï¼Œåªåœ¨éœ€è¦æä½å»¶è¿Ÿçš„æ•°æ®äº¤äº’ä¸­æ‰ä½¿ç”¨ï¼ˆå¦‚ä¸²å£é€šä¿¡ç­‰ï¼‰ã€‚

* * *

##### å®Œæ•´ç¤ºä¾‹ï¼šè‡ªå®šä¹‰ç¼“å†²åŒºè¯»å–å¤§æ–‡ä»¶

    #include <iostream>
    #include <fstream>
    
    int main() {
        // æœ‰é—®é¢˜è¯•ä¸€ä¸‹å…¨è·¯å¾„
        std::ifstream file("example.txt");
    
        // è‡ªå®šä¹‰ç¼“å†²åŒº
        char custom_buffer[8192];  // 8KB
        file.rdbuf()->pubsetbuf(custom_buffer, sizeof(custom_buffer));
    
        if (!file) {
            std::cerr << "æ‰“å¼€æ–‡ä»¶å¤±è´¥\n";
            return 1;
        }
    
        std::string line;
        size_t count = 0;
        while (std::getline(file, line)) {
            std::cout << line << std::endl;
            ++count;
        }
    
        std::cout << "å…±è¯»å–è¡Œæ•°ï¼š" << count << "\n";
        file.close();
        return 0;
    }
    

* * *

##### æ¨èåœºæ™¯

åœºæ™¯

ç¼“å†²è®¾ç½®å»ºè®®

å¤§æ–‡ä»¶ï¼ˆå‡ ç™¾ MB ä»¥ä¸Šï¼‰

è‡ªå®šä¹‰å¤§ç¼“å†²åŒºï¼ˆå¦‚ 64KBï¼‰

å°æ–‡ä»¶ / ä¸€æ¬¡æ€§è¯»å–

é»˜è®¤ç¼“å†²å³å¯

å®æ—¶è¯»å–ï¼ˆå¦‚ä¸²å£ï¼‰

`pubsetbuf(nullptr, 0)`

å¤šçº¿ç¨‹è¯»å–ï¼ˆå°‘è§ï¼‰

æ¯çº¿ç¨‹ç‹¬ç«‹ç¼“å†²åŒº

å­—ç¬¦ä¸²è¾“å…¥æµï¼ˆistringstreamï¼‰
---------------------

ç”¨äºä»å­—ç¬¦ä¸²ä¸­è§£ææ•°æ®ï¼Œå¸¸ç”¨äºå­—ç¬¦ä¸²æ‹†åˆ†å’Œæ ¼å¼è½¬æ¢ã€‚

    #include <sstream>
    #include <iostream>
    
    int main() {
        std::string data = "John 25 85.5";
        std::istringstream iss(data);
    
        std::string name;
        int age;
        double score;
    
        iss >> name >> age >> score;
        std::cout << name << ", " << age << ", " << score << std::endl;
    
        return 0;
    }
    

### æ€»ç»“

æ–¹æ³•

ç”¨é€”

`>>`

æå–æ•°æ®ï¼Œè‡ªåŠ¨è·³è¿‡ç©ºç™½ï¼Œç±»å‹å®‰å…¨

`get()`

è¯»å–å­—ç¬¦ï¼ˆå«ç©ºç™½ï¼‰

`getline()`

è¯»å–ä¸€è¡Œï¼ˆæ¨èç”¨äºæ•´è¡Œè¾“å…¥ï¼‰

`read()`

è¯»å–äºŒè¿›åˆ¶æ•°æ®

`gcount()`

è·å–æœ€åä¸€æ¬¡è¯»å–çš„å­—ç¬¦æ•°

`clear()`

æ¸…é™¤é”™è¯¯çŠ¶æ€

`ignore()`

å¿½ç•¥ç¼“å†²åŒºä¸­çš„æ— æ•ˆå­—ç¬¦

å››ã€è¾“å‡ºæµ
-----

è¾“å‡ºæµæ˜¯ C++ I/O åº“ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äº**å‘å¤–éƒ¨ç›®æ ‡è¾“å‡ºæ•°æ®**ï¼Œç›®æ ‡å¯ä»¥æ˜¯ï¼š

*   æ§åˆ¶å°ï¼ˆæ ‡å‡†è¾“å‡º `std::cout`ï¼‰
*   æ–‡ä»¶ï¼ˆ`std::ofstream`ï¼‰
*   å­—ç¬¦ä¸²ï¼ˆ`std::ostringstream`ï¼‰
*   è‡ªå®šä¹‰è®¾å¤‡ï¼ˆå¦‚ç½‘ç»œã€GUI ç­‰ï¼‰

    std::ios_base
      â””â”€â”€ std::ios
            â””â”€â”€ std::ostream      // è¾“å‡ºæµåŸºç±»
                  â”œâ”€â”€ std::ofstream       // æ–‡ä»¶è¾“å‡ºæµ
                  â”œâ”€â”€ std::ostringstream  // å­—ç¬¦ä¸²è¾“å‡ºæµ
                  â””â”€â”€ std::iostream       // åŒæ—¶æ”¯æŒè¾“å…¥è¾“å‡º
    

* * *

### å¸¸è§è¾“å‡ºæµç±»å‹

ç±»å‹

åŠŸèƒ½

å¤´æ–‡ä»¶

`std::ostream`

æ‰€æœ‰è¾“å‡ºæµçš„åŸºç±»

`<ostream>`

`std::cout`

æ ‡å‡†è¾“å‡ºæµï¼ˆæ§åˆ¶å°ï¼‰

`<iostream>`

`std::cerr`

é”™è¯¯è¾“å‡ºæµï¼ˆæ— ç¼“å†²ï¼‰

`<iostream>`

`std::clog`

æ—¥å¿—è¾“å‡ºæµï¼ˆæœ‰ç¼“å†²ï¼‰

`<iostream>`

`std::ofstream`

æ–‡ä»¶è¾“å‡ºæµ

`<fstream>`

`std::ostringstream`

å­—ç¬¦ä¸²è¾“å‡ºæµ

`<sstream>`

### å¸¸è§è¾“å‡ºå‡½æ•°

å‡½æ•°å

åŠŸèƒ½è¯´æ˜

ç¤ºä¾‹

`operator<<`

æ ¼å¼åŒ–è¾“å‡º

`os << x`

`put(char)`

è¾“å‡ºä¸€ä¸ªå­—ç¬¦

`os.put('A')`

`write(char*, size_t)`

è¾“å‡ºå­—èŠ‚æµï¼ˆé€šå¸¸ç”¨äºäºŒè¿›åˆ¶ï¼‰

`os.write(buf, n)`

`flush()`

åˆ·æ–°ç¼“å†²åŒºï¼Œå¼ºåˆ¶è¾“å‡º

`os.flush()`

* * *

### æ ¼å¼åŒ–æ§åˆ¶ï¼ˆä½¿ç”¨ `std::iomanip`ï¼‰

    #include <iostream>
    #include <iomanip>
    int main() {
        double pi = 3.14159265;
        std::cout << std::fixed << std::setprecision(2) << pi << std::endl; // è¾“å‡º 3.14
    }
    

æ§åˆ¶ç¬¦

åŠŸèƒ½

`std::setw(n)`

è®¾ç½®å­—æ®µå®½åº¦

`std::setfill(c)`

è®¾ç½®å¡«å……å­—ç¬¦

`std::setprecision(n)`

è®¾ç½®æµ®ç‚¹æ•°ç²¾åº¦

`std::fixed`

å›ºå®šå°æ•°ä½æ ¼å¼

`std::scientific`

ç§‘å­¦è®¡æ•°æ³•æ ¼å¼

`std::hex`/`std::dec`/`std::oct`

è®¾ç½®æ•´æ•°è¿›åˆ¶

`std::left` / `std::right` / `std::internal`

å¯¹é½æ–¹å¼

* * *

### æ–‡ä»¶è¾“å‡ºæµï¼ˆ`std::ofstream`ï¼‰ç¤ºä¾‹

    #include <fstream>
    int main() {
        std::ofstream ofs("output.txt");
        if (!ofs) {
            std::cerr << "æ— æ³•æ‰“å¼€æ–‡ä»¶ï¼" << std::endl;
            return 1;
        }
        ofs << "å†™å…¥æ–‡ä»¶çš„ç¬¬ä¸€è¡Œ" << std::endl;
        ofs.close();
    }
    

* * *

### å­—ç¬¦ä¸²è¾“å‡ºæµï¼ˆ`std::ostringstream`ï¼‰

    #include <sstream>
    #include <iostream>
    int main() {
        std::ostringstream oss;
        oss << "Name: " << "Alice" << ", Age: " << 30;
    
        std::string result = oss.str(); // è·å–å†™å…¥çš„å­—ç¬¦ä¸²
        std::cout << "å­—ç¬¦ä¸²æµç»“æœ: " << result << std::endl;
    }
    

### è¾“å‡ºæµçš„ç¼“å†²åˆ·æ–°æœºåˆ¶

*   ä¼šè‡ªåŠ¨åˆ·æ–°ç¼“å†²åŒºçš„æƒ…å†µï¼š
    *   `std::endl`ï¼šè¾“å‡ºæ¢è¡Œå¹¶åˆ·æ–°
    *   `flush()` æ‰‹åŠ¨åˆ·æ–°
    *   ç¼“å†²åŒºæ»¡æ—¶è‡ªåŠ¨åˆ·æ–°
    *   ç¨‹åºæ­£å¸¸é€€å‡ºæ—¶è‡ªåŠ¨åˆ·æ–°
    *   `std::cerr` æ˜¯**æ— ç¼“å†²**çš„

äº”ã€é‡å®šå‘æµ
------

C++ ä¸­æµçš„é‡å®šå‘ï¼ˆredirectï¼‰æ˜¯æŒ‡æ”¹å˜æ ‡å‡†è¾“å…¥è¾“å‡ºæµï¼ˆå¦‚ `std::cout`ã€`std::cin`ï¼‰çš„ç›®æ ‡ï¼Œ**ä½¿å®ƒä»¬æŒ‡å‘å…¶ä»–è®¾å¤‡ï¼ˆå¦‚æ–‡ä»¶ã€å­—ç¬¦ä¸²ã€ç½‘ç»œç­‰ï¼‰**ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„æ§åˆ¶å°ï¼ˆç»ˆç«¯ï¼‰ã€‚è¿™å¯¹äºæ—¥å¿—ä¿å­˜ã€æµ‹è¯•ã€æ•è·è¾“å‡ºéƒ½éå¸¸æœ‰ç”¨ã€‚

* * *

### é‡å®šå‘ `std::cout`ã€`std::cerr` åˆ°æ–‡ä»¶

æ–¹æ³•ï¼šä¿®æ”¹æµç¼“å†²åŒºï¼ˆ`streambuf`ï¼‰

`std::cout` ç­‰æµå¯¹è±¡å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªç¼“å†²åŒºæŒ‡é’ˆ `rdbuf()`ï¼Œé€šè¿‡æ›¿æ¢å®ƒï¼Œæˆ‘ä»¬å¯ä»¥è®©è¾“å‡ºå†™åˆ°åˆ«å¤„ã€‚

* * *

#### ä»£ç ç¤ºä¾‹ï¼šæŠŠ `std::cout` é‡å®šå‘åˆ°æ–‡ä»¶

    #include <iostream>
    #include <fstream>
    
    int main() {
        std::ofstream file("example.txt");
        if (!file) {
            std::cerr << "æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼" << std::endl;
            return 1;
        }
    
        // å¤‡ä»½åŸ cout ç¼“å†²åŒºæŒ‡é’ˆ
        std::streambuf* old_cout_buf = std::cout.rdbuf();
    
        // å°† cout ç¼“å†²åŒºæŒ‡å‘æ–‡ä»¶æµçš„ç¼“å†²åŒº
        std::cout.rdbuf(file.rdbuf());
    
        // ç°åœ¨æ‰€æœ‰ cout è¾“å‡ºå†™å…¥æ–‡ä»¶
        std::cout << "è¿™è¡Œå†™å…¥äº† example.txt æ–‡ä»¶" << std::endl;
    
        // æ¢å¤åŸæ¥çš„ç¼“å†²åŒºï¼ˆè¾“å‡ºå›ç»ˆç«¯ï¼‰
        std::cout.rdbuf(old_cout_buf);
    
        std::cout << "è¿™è¡Œåˆè¾“å‡ºåˆ°ç»ˆç«¯äº†" << std::endl;
    
        return 0;
    }
    

* * *

### é‡å®šå‘ `std::cin` ä»æ–‡ä»¶è¯»å–

    #include <iostream>
    #include <fstream>
    
    int main() {
        std::ifstream file("/home/fxq/untitled3/example.txt");
        if (!file) {
            std::cerr << "æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼" << std::endl;
            return 1;
        }
    
        // å¤‡ä»½åŸ cin ç¼“å†²åŒºæŒ‡é’ˆ
        std::streambuf* old_cin_buf = std::cin.rdbuf();
    
        // å°† cin ç¼“å†²åŒºæŒ‡å‘æ–‡ä»¶æµ
        std::cin.rdbuf(file.rdbuf());
    
        std::string line;
        std::getline(std::cin, line);
        std::cout << "ä»æ–‡ä»¶è¯»å–çš„å†…å®¹: " << line << std::endl;
    
        // æ¢å¤åŸç¼“å†²åŒº
        std::cin.rdbuf(old_cin_buf);
    
        return 0;
    }
    

* * *

### é‡å®šå‘æµåˆ°å­—ç¬¦ä¸²ï¼ˆå†…å­˜ï¼‰

å¯ä»¥ç”¨ `std::stringstream`ï¼š

    #include <iostream>
    #include <sstream>
    
    int main() {
        std::stringstream ss;
        
        // é‡å®šå‘ cout åˆ° stringstream
        std::streambuf* old_buf = std::cout.rdbuf(ss.rdbuf());
    
        std::cout << "Hello, å†…å­˜æµï¼" << std::endl;
    
        // æ¢å¤ cout
        std::cout.rdbuf(old_buf);
    
        // è·å–å†™å…¥çš„å­—ç¬¦ä¸²
        std::string captured = ss.str();
        std::cout << "æ•è·çš„å­—ç¬¦ä¸²å†…å®¹æ˜¯: " << captured << std::endl;
    
        return 0;
    }
    

* * *

### æ€»ç»“é‡å®šå‘å…³é”®ç‚¹

æ“ä½œæ­¥éª¤

è¯´æ˜

ä¿å­˜æ—§ç¼“å†²åŒºæŒ‡é’ˆ

`std::streambuf* old_buf = stream.rdbuf();`

æ›¿æ¢ç¼“å†²åŒºæŒ‡é’ˆ

`stream.rdbuf(new_stream.rdbuf());`

ä½¿ç”¨æ–°çš„æµè¿›è¡Œè¾“å…¥è¾“å‡º

è¾“å‡ºä¼šé‡å®šå‘åˆ°æ–°æµ

æ¢å¤åŸç¼“å†²åŒºæŒ‡é’ˆ

`stream.rdbuf(old_buf);`

* * *

### è¡¥å……ï¼šå‘½ä»¤è¡Œé‡å®šå‘

æ“ä½œç³»ç»Ÿå±‚é¢ä¹Ÿæ”¯æŒé‡å®šå‘ï¼Œä¸ç”¨ä»£ç å®ç°ï¼Œä¾‹å¦‚ï¼š

    ./program > output.txt  # é‡å®šå‘ stdout
    ./program < input.txt   # é‡å®šå‘ stdin
    ./program 2> error.log  # é‡å®šå‘ stderr
    

* * *

æœªç»ä½œè€…åŒæ„è¯·å‹¿è½¬è½½

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ä½œè€…ï¼š[aixueforever](https://www.cnblogs.com/aslanvon/)ï¼ŒåŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/aslanvon/p/18959951](https://www.cnblogs.com/aslanvon/p/18959951)