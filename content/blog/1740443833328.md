---
layout: post
title: 'binæ ¼å¼è½¬safetensors'
date: "2025-02-25T00:37:13Z"
---
binæ ¼å¼è½¬safetensors
=================

![binæ ¼å¼è½¬safetensors](https://img2024.cnblogs.com/blog/2277440/202502/2277440-20250224153653140-1582530615.png) æœ¬æ–‡ä»‹ç»äº†ä¸€ç§å°†Hugging Faceä¸Šbinæ ¼å¼çš„å¤§æ¨¡å‹æ–‡ä»¶ï¼Œåœ¨çº¿è½¬æ¢ä¸ºsafetensorsæ–‡ä»¶æ ¼å¼ï¼Œç„¶åä¸‹è½½åˆ°æœ¬åœ°çš„æ–¹æ³•ã€‚

æŠ€æœ¯èƒŒæ™¯
====

æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨Hugging Faceä¸ŠæŠŠbinæ ¼å¼çš„æ¨¡å‹æ–‡ä»¶è½¬ä¸ºsafetensorsæ ¼å¼çš„æ¨¡å‹æ–‡ä»¶ï¼Œå¹¶ä¸‹è½½åˆ°æœ¬åœ°çš„æ–¹æ³•ã€‚

binè½¬safetensors
===============

é¦–å…ˆå®‰è£…safetensorsï¼š

    $ python3 -m pip install safetensors --upgrade
    

ç„¶åæŠŠGithubçš„safetensorsä»“åº“å…‹éš†ä¸‹æ¥ï¼š

    $ git clone https://github.com/huggingface/safetensors.git
    æ­£å…‹éš†åˆ° 'safetensors'...
    remote: Enumerating objects: 4812, done.
    remote: Counting objects: 100% (1486/1486), done.
    remote: Compressing objects: 100% (406/406), done.
    remote: Total 4812 (delta 1340), reused 1082 (delta 1079), pack-reused 3326 (from 2)
    æ¥æ”¶å¯¹è±¡ä¸­: 100% (4812/4812), 1.15 MiB | 1.22 MiB/s, å®Œæˆ.
    å¤„ç† delta ä¸­: 100% (2457/2457), å®Œæˆ.
    

è¿›å…¥å­ç›®å½•ï¼š

    $ cd safetensors/bindings/python/
    $ ll
    æ€»ç”¨é‡ 84
    drwxrwxr-x 6 dechin dechin  4096 2æœˆ  21 16:37 ./
    drwxrwxr-x 3 dechin dechin  4096 2æœˆ  21 16:37 ../
    drwxrwxr-x 2 dechin dechin  4096 2æœˆ  21 16:37 benches/
    -rw-rw-r-- 1 dechin dechin   476 2æœˆ  21 16:37 Cargo.toml
    -rw-rw-r-- 1 dechin dechin  1454 2æœˆ  21 16:37 convert_all.py
    -rw-rw-r-- 1 dechin dechin 14769 2æœˆ  21 16:37 convert.py
    -rw-rw-r-- 1 dechin dechin   729 2æœˆ  21 16:37 fuzz.py
    -rw-rw-r-- 1 dechin dechin   685 2æœˆ  21 16:37 .gitignore
    -rw-rw-r-- 1 dechin dechin  1103 2æœˆ  21 16:37 Makefile
    -rw-rw-r-- 1 dechin dechin   190 2æœˆ  21 16:37 MANIFEST.in
    -rw-rw-r-- 1 dechin dechin  2419 2æœˆ  21 16:37 pyproject.toml
    drwxrwxr-x 3 dechin dechin  4096 2æœˆ  21 16:37 py_src/
    -rw-rw-r-- 1 dechin dechin   852 2æœˆ  21 16:37 README.md
    -rw-rw-r-- 1 dechin dechin   891 2æœˆ  21 16:37 setup.cfg
    drwxrwxr-x 2 dechin dechin  4096 2æœˆ  21 16:37 src/
    -rw-rw-r-- 1 dechin dechin  5612 2æœˆ  21 16:37 stub.py
    drwxrwxr-x 3 dechin dechin  4096 2æœˆ  21 16:37 tests/
    

å…¶ä¸­æœ‰ä¸€ä¸ª`convert.py`çš„æ ¼å¼è½¬æ¢è„šæœ¬ã€‚æŸ¥çœ‹ç”¨æ³•ï¼š

    $ python3 convert.py --help
    usage: convert.py [-h] [--revision REVISION] [--force] [-y] model_id
    
    Simple utility tool to convert automatically some weights on the hub to `safetensors` format. It is PyTorch
    exclusive for now. It works by downloading the weights (PT), converting them locally, and uploading them back as a
    PR on the hub.
    
    positional arguments:
      model_id             The name of the model on the hub to convert. E.g. `gpt2` or `facebook/wav2vec2-base-960h`
    
    options:
      -h, --help           show this help message and exit
      --revision REVISION  The revision to convert
      --force              Create the PR even if it already exists of if the model was already converted.
      -y                   Ignore safety prompt
    

è¿™ä¸ªè„šæœ¬å¯ä»¥å°†æŒ‡å®šè·¯å¾„çš„æ¨¡å‹æ–‡ä»¶è½¬ä¸ºsafetensorsæ¨¡å‹ï¼Œä½†æ˜¯å¦‚æœç›´æ¥è¿è¡Œä¼šæŠ¥é”™ï¼š

    $ python3 convert.py --force -y Salesforce/blip-image-captioning-base
    config.json: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4.56k/4.56k [00:00<00:00, 15.3MB/s]
    pytorch_model.bin: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 990M/990M [02:06<00:00, 7.82MB/s]
    Traceback (most recent call last):
      File "/home/dechin/anaconda3/envs/llama/lib/python3.10/site-packages/huggingface_hub/utils/_http.py", line 406, in hf_raise_for_status
        response.raise_for_status()
      File "/home/dechin/anaconda3/envs/llama/lib/python3.10/site-packages/requests/models.py", line 1024, in raise_for_status
        raise HTTPError(http_error_msg, response=self)
    requests.exceptions.HTTPError: 401 Client Error: Unauthorized for url: https://huggingface.co/api/models/Salesforce/blip-image-captioning-base/preupload/main?create_pr=1
    
    The above exception was the direct cause of the following exception:
    
    Traceback (most recent call last):
      File "/datb/DeepSeek/safetensors/bindings/python/convert.py", line 369, in <module>
        commit_info, errors = convert(api, model_id, revision=args.revision, force=args.force)
      File "/datb/DeepSeek/safetensors/bindings/python/convert.py", line 313, in convert
        new_pr = api.create_commit(
      File "/home/dechin/anaconda3/envs/llama/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
        return fn(*args, **kwargs)
      File "/home/dechin/anaconda3/envs/llama/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 1524, in _inner
        return fn(self, *args, **kwargs)
      File "/home/dechin/anaconda3/envs/llama/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 3961, in create_commit
        self.preupload_lfs_files(
      File "/home/dechin/anaconda3/envs/llama/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 4184, in preupload_lfs_files
        _fetch_upload_modes(
      File "/home/dechin/anaconda3/envs/llama/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py", line 114, in _inner_fn
        return fn(*args, **kwargs)
      File "/home/dechin/anaconda3/envs/llama/lib/python3.10/site-packages/huggingface_hub/_commit_api.py", line 542, in _fetch_upload_modes
        hf_raise_for_status(resp)
      File "/home/dechin/anaconda3/envs/llama/lib/python3.10/site-packages/huggingface_hub/utils/_http.py", line 454, in hf_raise_for_status
        raise _format(RepositoryNotFoundError, message, response) from e
    huggingface_hub.errors.RepositoryNotFoundError: 401 Client Error. (Request ID: Root=1-67b83d70-5af65b805cde0ba55c72abd1;ce2be295-8da7-4230-a8db-f505919ddb85)
    
    Repository Not Found for url: https://huggingface.co/api/models/Salesforce/blip-image-captioning-base/preupload/main?create_pr=1.
    Please make sure you specified the correct `repo_id` and `repo_type`.
    If you are trying to access a private or gated repo, make sure you are authenticated.
    Invalid username or password.
    Note: Creating a commit assumes that the repo already exists on the Huggingface Hub. Please use `create_repo` if it's not the case.
    

è¿™éœ€è¦æˆ‘ä»¬å…ˆæ³¨å†Œä¸€ä¸ªHugging Faceçš„è´¦å·ï¼Œç„¶åå…è´¹è·å–ä¸€ä¸ªtokenï¼š

![](https://img2024.cnblogs.com/blog/2277440/202502/2277440-20250224155039951-1371143747.png)

æŠŠtokenåŠ åˆ°convert.pyçš„å‰ä¸¤è¡Œï¼š

    $ head -n 2 convert.py 
    from huggingface_hub import login
    login("your_token")
    

å†æ¬¡æ‰§è¡Œè¯¥è½¬æ¢è„šæœ¬ï¼š

    $ python3 convert.py --force -y Salesforce/blip-image-captioning-base
    config.json: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4.56k/4.56k [00:00<00:00, 16.2MB/s]
    pytorch_model.bin: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 990M/990M [02:04<00:00, 7.94MB/s]
    Pr created at https://huggingface.co/Salesforce/blip-image-captioning-base/discussions/42
    
    ### Success ğŸ”¥
    Yay! This model was successfully converted and a PR was open using your token, here:
    [https://huggingface.co/Salesforce/blip-image-captioning-base/discussions/42](https://huggingface.co/Salesforce/blip-image-captioning-base/discussions/42)
    

æˆåŠŸæ„å»ºsafetensoræ–‡ä»¶ã€‚å¹¶æäº¤äº†ä¸€ä¸ªPull Requestï¼Œé‚£ä¹ˆå°±ç®—è¿™ä¸ªPRæ²¡æœ‰åˆå¹¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»è‡ªå·±çš„PRä¸‹è½½ç›¸å…³æ¨¡å‹æ–‡ä»¶ã€‚

ä»HFä¸‹è½½ä»“åº“
=======

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`git-lfs`ä»Hugging Faceçš„PRé‡Œé¢ä¸‹è½½æ¨¡å‹æ–‡ä»¶ã€‚é¦–å…ˆæˆ‘ä»¬ä»ä¸»åˆ†æ”¯ä¸‹è½½æ‰€æœ‰çš„å°å‹æ–‡ä»¶ï¼ˆéLFSæ–‡ä»¶ï¼‰ï¼š

    $ GIT_LFS_SKIP_SMUDGE=1 git clone https://huggingface.co/Salesforce/blip-image-captioning-base
    æ­£å…‹éš†åˆ° 'blip-image-captioning-base'...
    remote: Enumerating objects: 76, done.
    remote: Counting objects: 100% (76/76), done.
    remote: Compressing objects: 100% (38/38), done.
    remote: Total 76 (delta 39), reused 72 (delta 37), pack-reused 0 (from 0)
    å±•å¼€å¯¹è±¡ä¸­: 100% (76/76), 323.20 KiB | 1.05 MiB/s, å®Œæˆ.
    

ä¸‹è½½å®Œè½»é‡çº§æ–‡ä»¶ï¼Œè¿›å…¥åˆ°ä¸‹è½½çš„è·¯å¾„ä¸‹ï¼š

    $ cd blip-image-captioning-base/
    $ ll
    æ€»ç”¨é‡ 976
    drwxrwxr-x 3 dechin dechin   4096 2æœˆ  21 17:22 ./
    drwxrwxr-x 3 dechin dechin   4096 2æœˆ  21 17:22 ../
    -rw-rw-r-- 1 dechin dechin   4563 2æœˆ  21 17:22 config.json
    drwxrwxr-x 9 dechin dechin   4096 2æœˆ  21 17:22 .git/
    -rw-rw-r-- 1 dechin dechin   1477 2æœˆ  21 17:22 .gitattributes
    -rw-rw-r-- 1 dechin dechin    287 2æœˆ  21 17:22 preprocessor_config.json
    -rw-rw-r-- 1 dechin dechin    134 2æœˆ  21 17:22 pytorch_model.bin
    -rw-rw-r-- 1 dechin dechin   6359 2æœˆ  21 17:22 README.md
    -rw-rw-r-- 1 dechin dechin    125 2æœˆ  21 17:22 special_tokens_map.json
    -rw-rw-r-- 1 dechin dechin    134 2æœˆ  21 17:22 tf_model.h5
    -rw-rw-r-- 1 dechin dechin    506 2æœˆ  21 17:22 tokenizer_config.json
    -rw-rw-r-- 1 dechin dechin 711396 2æœˆ  21 17:22 tokenizer.json
    -rw-rw-r-- 1 dechin dechin 231508 2æœˆ  21 17:22 vocab.txt
    

å¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„å¤§æ¨¡å‹æ–‡ä»¶æ˜¯æ²¡æœ‰è¢«ä¸‹è½½ä¸‹æ¥çš„ï¼Œç„¶ååœ¨è¿™ä¸ªè·¯å¾„ä¸‹pullæˆ‘ä»¬è‡ªå·±çš„PRåˆ†æ”¯çš„å†…å®¹ï¼š

    $ git pull origin refs/pr/42
    remote: Enumerating objects: 4, done.
    remote: Counting objects: 100% (4/4), done.
    remote: Compressing objects: 100% (3/3), done.
    remote: Total 3 (delta 1), reused 0 (delta 0), pack-reused 0 (from 0)
    å±•å¼€å¯¹è±¡ä¸­: 100% (3/3), 1.42 KiB | 1.42 MiB/s, å®Œæˆ.
    æ¥è‡ª https://huggingface.co/Salesforce/blip-image-captioning-base
     * branch            refs/pr/42 -> FETCH_HEAD
    æ›´æ–° 82a3776..0f2f8a0
    Fast-forward
     model.safetensors | 3 +++
     1 file changed, 3 insertions(+)
     create mode 100644 model.safetensors
    

originåé¢è·Ÿç€çš„æ˜¯æˆ‘ä»¬çš„PRçš„åç§°ï¼Œåœ¨Hugging Faceç›¸å…³åˆ†æ”¯ä¸»é¡µå¯ä»¥æŸ¥çœ‹:

![](https://img2024.cnblogs.com/blog/2277440/202502/2277440-20250224155203694-1809495704.png)

å†æ¬¡æŸ¥çœ‹æœ¬åœ°è·¯å¾„ï¼š

    $ ll
    æ€»ç”¨é‡ 967508
    drwxrwxr-x 3 dechin dechin      4096 2æœˆ  21 17:24 ./
    drwxrwxr-x 3 dechin dechin      4096 2æœˆ  21 17:22 ../
    -rw-rw-r-- 1 dechin dechin      4563 2æœˆ  21 17:22 config.json
    drwxrwxr-x 9 dechin dechin      4096 2æœˆ  21 17:24 .git/
    -rw-rw-r-- 1 dechin dechin      1477 2æœˆ  21 17:22 .gitattributes
    -rw-rw-r-- 1 dechin dechin 989721336 2æœˆ  21 17:24 model.safetensors
    -rw-rw-r-- 1 dechin dechin       287 2æœˆ  21 17:22 preprocessor_config.json
    -rw-rw-r-- 1 dechin dechin       134 2æœˆ  21 17:22 pytorch_model.bin
    -rw-rw-r-- 1 dechin dechin      6359 2æœˆ  21 17:22 README.md
    -rw-rw-r-- 1 dechin dechin       125 2æœˆ  21 17:22 special_tokens_map.json
    -rw-rw-r-- 1 dechin dechin       134 2æœˆ  21 17:22 tf_model.h5
    -rw-rw-r-- 1 dechin dechin       506 2æœˆ  21 17:22 tokenizer_config.json
    -rw-rw-r-- 1 dechin dechin    711396 2æœˆ  21 17:22 tokenizer.json
    -rw-rw-r-- 1 dechin dechin    231508 2æœˆ  21 17:22 vocab.txt
    

å¯ä»¥çœ‹åˆ°safetensorsæ¨¡å‹æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼Œè¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†çº¿ä¸Šæ¨¡å‹æ ¼å¼è½¬æ¢ï¼Œå†ä¸‹è½½åˆ°æœ¬åœ°çš„è¿‡ç¨‹ã€‚

æ€»ç»“æ¦‚è¦
====

æœ¬æ–‡ä»‹ç»äº†ä¸€ç§å°†Hugging Faceä¸Šbinæ ¼å¼çš„å¤§æ¨¡å‹æ–‡ä»¶ï¼Œåœ¨çº¿è½¬æ¢ä¸ºsafetensorsæ–‡ä»¶æ ¼å¼ï¼Œç„¶åä¸‹è½½åˆ°æœ¬åœ°çš„æ–¹æ³•ã€‚

ç‰ˆæƒå£°æ˜
====

æœ¬æ–‡é¦–å‘é“¾æ¥ä¸ºï¼š[https://www.cnblogs.com/dechinphy/p/bin-safetensors.html](https://www.cnblogs.com/dechinphy/p/bin-safetensors.html)

ä½œè€…IDï¼šDechinPhy

æ›´å¤šåŸè‘—æ–‡ç« ï¼š[https://www.cnblogs.com/dechinphy/](https://www.cnblogs.com/dechinphy/)

è¯·åšä¸»å–å’–å•¡ï¼š[https://www.cnblogs.com/dechinphy/gallery/image/379634.html](https://www.cnblogs.com/dechinphy/gallery/image/379634.html)