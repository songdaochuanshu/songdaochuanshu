---
layout: post
title: 'QTå®ç°DockWidgetå†…éƒ¨ç»„ä»¶è‡ªåŠ¨æ¢è¡Œå¸ƒå±€'
date: "2025-10-23T00:40:47Z"
---
QTå®ç°DockWidgetå†…éƒ¨ç»„ä»¶è‡ªåŠ¨æ¢è¡Œå¸ƒå±€
========================

ä¸»è¦åŠŸèƒ½æ¦‚è¿°
======

#### å½“DockWidgetçª—å£å¤§å°æ”¹å˜æ—¶ï¼Œå†…éƒ¨çš„æŒ‰é’®èƒ½å¤Ÿè‡ªåŠ¨é‡æ–°æ’åˆ—ï¼Œä»¥æœ€ä½³æ–¹å¼åˆ©ç”¨å¯ç”¨ç©ºé—´ã€‚å…·ä½“è¡¨ç°ä¸ºï¼š

#### 1\. å½“æ°´å¹³ç©ºé—´è¶³å¤Ÿæ—¶ï¼ŒæŒ‰é’®æ’æˆä¸€è¡Œ

#### 2\. å½“æ°´å¹³ç©ºé—´ä¸è¶³æ—¶ï¼ŒæŒ‰é’®è‡ªåŠ¨æ¢è¡Œ

ç¨‹åºç¯å¢ƒ
----

> Python 3.8.9  
> pyside6==6.1.3

    pip install pyside6==6.1.3
    

è®¾è®¡ç»“æ„å›¾è§£
------

å®ç°æ•ˆæœ
----

demoä»£ç è·å–
--------

#### Giteeï¼š[dockwidget-demo](https://gitee.com/RreaRem/dockwidget-demo "dockwidget-demo")

#### ç™¾åº¦ç½‘ç›˜ï¼š[https://pan.baidu.com/s/1PRAjVGBtLQFZkWnZsJ2f2A?pwd=eiti](https://pan.baidu.com/s/1PRAjVGBtLQFZkWnZsJ2f2A?pwd=eiti)

ä»£ç å®ç°
====

#### ä»¥ä¸‹æ˜¯å®Œæ•´çš„å®ç°ä»£ç ï¼š

    import re
    import sys
    from PySide6.QtWidgets import QApplication
    from ui_main_windowtest import *
    
    class MainWindow(QMainWindow, Ui_MainWindow):
        def __init__(self):
            super().__init__()
            self.setupUi(self)
            self.row = 0    # è¡Œ
            self.col = 0    # åˆ—
            self.buttons_per_row = 0    # æ¯è¡ŒæŒ‰é’®æ•°é‡
            self.scrollArea.widget().installEventFilter(self)
    
            # è·å–å¸ƒå±€å‚æ•°
            self.h_spacing = self.gridLayout_2.horizontalSpacing()
            self.v_spacing = self.gridLayout_2.verticalSpacing()
            self.margins = self.gridLayout_2.contentsMargins()
    
            # è·å–ç¬¬ä¸€ä¸ªæŒ‰é’®çš„å‚è€ƒå°ºå¯¸
            if self.gridLayout_2.count() > 0:
                first_button = self.gridLayout_2.itemAt(0).widget()
                self.button_width = first_button.sizeHint().width() + self.h_spacing
                self.button_height = first_button.sizeHint().height() + self.v_spacing + 10 # æ ¹æ®æµ‹è¯•è¿™é‡Œ+10å®¹å·®å¯ä»¥é˜²æ­¢å‡ºç°ç¨‹åºæ— é™æ‰§è¡ŒrearrangeButtonsæ–¹æ³•çš„æƒ…å†µ
    
        def eventFilter(self, obj, event):
            """ç›‘æ§ScrollAreaå†…widgetçš„resizeäº‹ä»¶"""
            if event.type() == QEvent.Resize:
                # è·å–å½“å‰å¯ç”¨å®½é«˜
                available_height = self.scrollArea.widget().size().height()
                available_width = self.scrollArea.widget().size().width()
    
                # æ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°æ’åˆ—æŒ‰é’®
                if available_height > (self.row + 1) * self.button_height and available_width > self.button_width:
                    self.rearrangeButtons()
                elif available_width > (self.buttons_per_row + 1) * self.button_width and available_height > self.button_height:
                    self.rearrangeButtons()
            return super().eventFilter(obj, event)
    
        def rearrangeButtons(self):
            """é‡æ–°æ’åˆ—æŒ‰é’®ä»¥é€‚åº”æ–°çš„çª—å£å¤§å°"""
            # è®¡ç®—æ–°çš„æ¯è¡ŒæŒ‰é’®æ•°é‡
            available_width = self.scrollArea.widget().width() - self.margins.left() - self.margins.right()
            new_buttons_per_row = max(1, available_width // self.button_width)
    
            # å¦‚æœæ¯è¡ŒæŒ‰é’®æ•°é‡æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸éœ€è¦é‡æ–°æ’åˆ—
            if new_buttons_per_row != self.buttons_per_row:
                self.buttons_per_row = new_buttons_per_row
            else:
                return
    
            # æ”¶é›†æ‰€æœ‰æŒ‰é’®
            buttons = []
            for i in range(self.gridLayout_2.count()):
                item = self.gridLayout_2.itemAt(i)
                if item.widget():
                    buttons.append(item.widget())
    
            # æŒ‰æŒ‰é’®åç§°è‡ªç„¶æ’åºï¼ˆ1, 2, 3, ..., 10, 11ï¼‰ï¼Œä¸æ’åºæ¯æ¬¡é‡å¯ç¨‹åºé¡ºåºéƒ½ä¼šä¸ä¸€æ ·
            buttons.sort(key=lambda btn: [
                int(text) if text.isdigit() else text.lower()
                for text in re.split('([0-9]+)', btn.objectName())
            ])
    
            # æ¸…é™¤å½“å‰å¸ƒå±€
            while self.gridLayout_2.count():
                item = self.gridLayout_2.takeAt(0)
                if item.widget():
                    item.widget().setParent(None)
    
            # é‡æ–°æ’åˆ—æŒ‰é’®
            for i, button in enumerate(buttons):
                self.row = i // self.buttons_per_row
                self.col = i % self.buttons_per_row
                self.gridLayout_2.addWidget(button, self.row, self.col)
    
    if __name__ == "__main__":
        app = QApplication(sys.argv)
        window = MainWindow()
        window.show()
        sys.exit(app.exec())
    

ä»£ç è§£æ
====

1\. åˆå§‹åŒ–å¸ƒå±€å‚æ•°
-----------

#### è·å–äº†å¸ƒå±€çš„å…³é”®å‚æ•°,è¿™äº›å‚æ•°ç”¨äºå‡†ç¡®è®¡ç®—å¯ç”¨ç©ºé—´å’ŒæŒ‰é’®å°ºå¯¸ï¼š

    self.h_spacing = self.gridLayout_2.horizontalSpacing()
    self.v_spacing = self.gridLayout_2.verticalSpacing()
    self.margins = self.gridLayout_2.contentsMargins()
    

2\. è®¡ç®—æŒ‰é’®å°ºå¯¸
----------

#### æˆ‘ä»¬ä»¥scrollAreaç¬¬ä¸€ä¸ªQwidgetä¸ºå‚è€ƒï¼Œè®¡ç®—Qwidgetçš„å®½åº¦å’Œé«˜åº¦(æ‰€æœ‰Qwidgetå®½é«˜å¿…é¡»ç»Ÿä¸€)ï¼š

> ps:è¿™é‡Œå˜é‡åå†™æˆäº†buttonï¼Œå…¶å®è·å–çš„æ˜¯Qwidgetçš„å®½åº¦å’Œé«˜åº¦

    first_button = self.gridLayout_2.itemAt(0).widget()
    self.button_width = first_button.sizeHint().width() + self.h_spacing
    self.button_height = first_button.sizeHint().height() + self.v_spacing + 10
    

#### æ³¨æ„è¿™é‡ŒåŠ äº†10åƒç´ çš„å®¹å·®ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…åœ¨æŸäº›è¾¹ç•Œæƒ…å†µä¸‹å‡ºç°æ— é™å¾ªç¯çš„é—®é¢˜ã€‚

3\. äº‹ä»¶è¿‡æ»¤å™¨
---------

#### é€šè¿‡`eventFilter`ç›‘æ§ScrollAreaå†…widgetçš„resizeäº‹ä»¶ï¼š

    def eventFilter(self, obj, event):
        if event.type() == QEvent.Resize:
            # è·å–å½“å‰å¯ç”¨å®½é«˜
            available_height = self.scrollArea.widget().size().height()
            available_width = self.scrollArea.widget().size().width()
    
            # æ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°æ’åˆ—
            if available_height > (self.row + 1) * self.button_height and available_width > self.button_width:
                self.rearrangeButtons()
            elif available_width > (self.buttons_per_row + 1) * self.button_width and available_height > self.button_height:
                self.rearrangeButtons()
        return super().eventFilter(obj, event)
    

4\. é‡æ–°æ’åˆ—æŒ‰é’®
----------

#### `rearrangeButtons`æ–¹æ³•æ˜¯æ ¸å¿ƒé€»è¾‘æ‰€åœ¨ï¼š

    def rearrangeButtons(self):
        # è®¡ç®—æ–°çš„æ¯è¡ŒæŒ‰é’®æ•°é‡
        available_width = self.scrollArea.widget().width() - self.margins.left() - self.margins.right()
        new_buttons_per_row = max(1, available_width // self.button_width)
    
        # å¦‚æœæ¯è¡ŒæŒ‰é’®æ•°é‡æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸éœ€è¦é‡æ–°æ’åˆ—
        if new_buttons_per_row != self.buttons_per_row:
            self.buttons_per_row = new_buttons_per_row
        else:
            return
    
        # æ”¶é›†å¹¶æ’åºæŒ‰é’®
        buttons = []
        for i in range(self.gridLayout_2.count()):
            item = self.gridLayout_2.itemAt(i)
            if item.widget():
                buttons.append(item.widget())
    
        # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®ç°æŒ‰é’®åç§°çš„è‡ªç„¶æ’åº,å¯ä»¥é€šè¿‡å‘½åçš„æ–¹å¼å¼ºåˆ¶è§„å®šQwidgetç»„ä»¶é¡ºåº
        buttons.sort(key=lambda btn: [
            int(text) if text.isdigit() else text.lower()
            for text in re.split('([0-9]+)', btn.objectName())
        ])
    
        # æ¸…é™¤å½“å‰å¸ƒå±€
        while self.gridLayout_2.count():
            item = self.gridLayout_2.takeAt(0)
            if item.widget():
                item.widget().setParent(None)
    
        # é‡æ–°æ’åˆ—
        for i, button in enumerate(buttons):
            self.row = i // self.buttons_per_row
            self.col = i % self.buttons_per_row
            self.gridLayout_2.addWidget(button, self.row, self.col)
    

æ³¨æ„äº‹é¡¹
----

1.  **æŒ‰é’®å°ºå¯¸**ï¼šDockWidgetä¸‹çš„æ‰€æœ‰Qwidgetåº”å…·æœ‰ç›¸åŒçš„å°ºå¯¸ï¼Œå¦åˆ™å¸ƒå±€å¯èƒ½ä¼šä¸å‡åŒ€
2.  **å®¹å·®è®¾ç½®**ï¼šä»£ç ä¸­çš„+10åƒç´ å®¹å·®æ˜¯ç»éªŒå€¼ï¼Œå¯èƒ½éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´

### END ğŸ˜ƒ