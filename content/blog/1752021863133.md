---
layout: post
title: 'Spring AI Alibabaæ™ºèƒ½æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ'
date: "2025-07-09T00:44:23Z"
---
Spring AI Alibabaæ™ºèƒ½æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ
=========================

ğŸ‘‹ è¿˜åœ¨ä¸ºæ‰‹åŠ¨ç¼–å†™æµ‹è¯•ç”¨ä¾‹ç§ƒå¤´å—ï¼Ÿé¢å¯¹å¤æ‚éœ€æ±‚æ–‡æ¡£ï¼Œä¸€ä¸ªä¸€ä¸ªæŠ æµ‹è¯•ç‚¹ï¼Œä¸ä»…æ•ˆç‡ä½ï¼Œè¿˜å®¹æ˜“é—æ¼å…³é”®åœºæ™¯ï¼Ÿä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œç¬”è€…ä¾æ‰˜Spring AIå¼€å‘äº†æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆå·¥å…·~

â€‹åç«¯æºç ï¼š[https://github.com/qa-dpp/case-ai-backend](https://github.com/qa-dpp/case-ai-backend)

å‰ç«¯æºç ï¼š[https://github.com/qa-dpp/case-ai-front](https://github.com/qa-dpp/case-ai-front)

ğŸŒŸÂ **æ ¸å¿ƒåŠŸèƒ½**â€‹

*   å…¨ç±»å‹æ–‡æ¡£åˆ†æï¼šåŸºäº Spring AI Alibabaçš„è‡ªç„¶è¯­è¨€å¤„ç†å’Œå›¾åƒè¯†åˆ«èƒ½åŠ›ï¼Œæ”¯æŒpdf ã€wordã€txtå¤šç§æ ¼å¼éœ€æ±‚æ–‡æ¡£ï¼Œç²¾å‡†æå–éœ€æ±‚ç‚¹ã€‚â€‹

*   æ™ºèƒ½ç”Ÿæˆä¸ç­›é€‰ï¼šé‡‡ç”¨Â Spring AI Alibabaçš„ç”Ÿæˆè€…è¯„ä¼°è€…æ¨¡å¼ï¼Œç”Ÿæˆè€…æ‰¹é‡äº§å‡ºå€™é€‰æµ‹è¯•ç”¨ä¾‹ï¼Œè¯„ä¼°è€…ä»åˆç†æ€§ã€è¦†ç›–ç‡ç­‰ç»´åº¦ç­›é€‰ï¼Œä¿éšœç”¨ä¾‹è´¨é‡ä¸å…¨é¢æ€§ã€‚â€‹

*   è„‘å›¾å¯è§†åŒ–å‘ˆç°ï¼šå°†ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹è‡ªåŠ¨è½¬åŒ–ä¸ºè¡¨æ ¼å’Œè„‘å›¾ï¼Œæ¸…æ™°å±•ç¤ºç”¨ä¾‹é€»è¾‘ç»“æ„å’Œä¸éœ€æ±‚çš„å¯¹åº”å…³ç³»ï¼Œæ–¹ä¾¿ç†è§£ã€æ‰§è¡Œä¸å›¢é˜Ÿåä½œã€‚â€‹

ğŸ› ï¸Â **æŠ€æœ¯æ¶æ„**â€‹

*   åº•å±‚æ¡†æ¶ï¼šä¾æ‰˜ Spring AI Alibabaï¼Œå®ç°å¯¹æ–‡æ¡£çš„æ™ºèƒ½è§£æä¸å¤„ç†ã€‚â€‹

*   ç”Ÿæˆæ¨¡å¼ï¼šè¿ç”¨ç”Ÿæˆè€…è¯„ä¼°è€…æ¨¡å¼ï¼Œæ„å»ºé«˜æ•ˆå¯é çš„æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆæµç¨‹ã€‚â€‹

*   å¯è§†åŒ–ï¼šé›†æˆè¡¨æ ¼å’Œè„‘å›¾ç”ŸæˆæŠ€æœ¯ï¼Œè®©æµ‹è¯•ç”¨ä¾‹ä»¥ç›´è§‚å›¾å½¢åŒ–æ–¹å¼å‘ˆç°ã€‚

ğŸ› ï¸**ä»£ç æ•´ä½“æ¡†æ¶ï¼š**

ğŸ› ï¸**ä»£ç è¯¦è§£ï¼š**

### 1\. å¸¸é‡å®šä¹‰ï¼ˆConsts.javaï¼‰

package com.fingertip.caseaibackend.commons;

public class Consts {
    public static final String ANALYZE\_PROMPT = ...;
    public static final String CASE\_WRITER\_PROMPT = ...;
    public static final String CASE\_REVIEWER\_PROMPT = ...;
    public static final String CASE\_FORMAT\_PROMPT = ...;
    public static final String VISUAL\_PROMPT = ...;

    public static final String ORIGIN\_MESSAGE = "originMessage";
    public static final String CASE\_INFO\_MESSAGE = "caseInfoMessage";
    public static final String CASE\_REVIEW\_MESSAGE = "caseReviewMessage";
    public static final String CASE\_FORMAT\_MESSAGE = "caseFormatMessage";
}

è¯¥ç±»å®šä¹‰äº†ä¸€ç³»åˆ—å¸¸é‡ï¼ŒåŒ…æ‹¬ä¸å¤§è¯­è¨€æ¨¡å‹äº¤äº’æ—¶ä½¿ç”¨çš„æç¤ºä¿¡æ¯ï¼ˆå¦‚éœ€æ±‚åˆ†ææç¤ºã€æµ‹è¯•ç”¨ä¾‹ç¼–å†™æç¤ºç­‰ï¼‰ä»¥åŠçŠ¶æ€å›¾ä¸­ä½¿ç”¨çš„æ¶ˆæ¯é”®ã€‚

### 2\. é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰

server:
  port: 8080

spring:
  application:
    name: spring-ai-alibaba-openai-chat-model-example
  ai:
    openai:
      api-key: xxx
      base-url: https://api.siliconflow.cn/
      chat:
        options:
          model: deepseek-ai/DeepSeek-R1
  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 50MB
case-model:
  visual:
    api-key: xxx
    base-url: https://api.siliconflow.cn/
    model: Qwen/Qwen2.5-VL-72B-Instruct
  analyze:
    api-key: xxx
    base-url: https://api.siliconflow.cn/
    model: deepseek-ai/DeepSeek-R1
  generate:
    api-key: xxx
    base-url: https://api.siliconflow.cn/
    model: deepseek-ai/DeepSeek-R1-Distill-Qwen-7B
  reviewer:
    api-key: xxx
    base-url: https://api.siliconflow.cn/
    model: MiniMaxAI/MiniMax-M1-80k
  format:
    api-key: xxx
    base-url: https://api.siliconflow.cn/
    model: deepseek-ai/DeepSeek-V3
logging:
  level:
    root: INFO
    org.springframework.ai: DEBUG
    com.example.demo: DEBUG

é…ç½®æ–‡ä»¶å®šä¹‰äº†æœåŠ¡å™¨ç«¯å£ã€Spring AI çš„åŸºæœ¬é…ç½®ï¼ˆå¦‚ API å¯†é’¥ã€åŸºç¡€ URLã€æ¨¡å‹ç±»å‹ï¼‰ä»¥åŠä¸åŒä»»åŠ¡ï¼ˆå¦‚å¯è§†åŒ–ã€éœ€æ±‚åˆ†æã€æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆç­‰ï¼‰ä½¿ç”¨çš„æ¨¡å‹ä¿¡æ¯ã€‚åŒæ—¶ï¼Œè¿˜é…ç½®äº†æ–‡ä»¶ä¸Šä¼ çš„æœ€å¤§å¤§å°å’Œæ—¥å¿—çº§åˆ«ã€‚

### 3\. å¤§è¯­è¨€æ¨¡å‹é…ç½®ï¼ˆLLMConfig.javaï¼‰

package com.fingertip.caseaibackend.aiproxies.configs;

import org.springframework.ai.chat.model.ChatModel;
import org.springframework.ai.openai.OpenAiChatModel;
import org.springframework.ai.openai.OpenAiChatOptions;
import org.springframework.ai.openai.api.OpenAiApi;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class LLMConfig {
    @Value("${case-model.analyze.api-key}")
    private String analyze\_apiKey = "";
    @Value("${case-model.analyze.base-url}")
    private String analyze\_baseUrl = "";
    @Value("${case-model.analyze.model}")
    private String analyze\_Model = "";

    @Bean
    public ChatModel analyzeModel() {
        OpenAiChatOptions options = new OpenAiChatOptions();
        options.setModel(analyze\_Model);
        options.setTemperature(0.7);
        return OpenAiChatModel.builder().openAiApi(OpenAiApi.builder().apiKey(analyze\_apiKey).baseUrl(analyze\_baseUrl).build()).defaultOptions(options).build();
    }

    // å…¶ä»–æ¨¡å‹é…ç½®...
}

è¯¥ç±»ä½¿ç”¨ Spring çš„Â `@Configuration`Â æ³¨è§£ï¼Œé€šè¿‡Â `@Value`Â æ³¨è§£ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–ä¸åŒä»»åŠ¡æ‰€éœ€çš„ API å¯†é’¥ã€åŸºç¡€ URL å’Œæ¨¡å‹ç±»å‹ï¼Œç„¶ååˆ›å»ºç›¸åº”çš„Â `ChatModel`Â å®ä¾‹ã€‚

### 4\. æ§åˆ¶å™¨ï¼ˆAiChatController.javaï¼‰

@RestController
@RequestMapping("/ai-api")
public class AiChatController {
    private static final String DEFAULT\_PROMPT = "ä½ å¥½ï¼Œä»‹ç»ä¸‹ä½ è‡ªå·±ï¼";

    private final ChatClient openAiAnalyzeChatClient;
    private final ChatClient openAiGenerateChatClient;
    private final ChatClient openAiReviewerChatClient;
    private final ChatClient openAiFormatChatClient;
    private final ChatClient openAiVisualChatClient;

    public AiChatController(@Qualifier("analyzeModel") ChatModel analyzeModel, ...) {
        this.openAiAnalyzeChatClient = ChatClient.builder(analyzeModel)
                .defaultAdvisors(new SimpleLoggerAdvisor())
                .defaultOptions(OpenAiChatOptions.builder().topP(0.7).build())
                .build();
        // å…¶ä»– ChatClient åˆå§‹åŒ–...
    }

    @PostMapping("/file/upload")
    public ApiResult<String> uploadFile(@RequestParam("files") MultipartFile\[\] files) {
        ApiResult<String> result = new ApiResult<>();
        try {
            if (files == null || files.length == 0) {
                result.setMessage("ä¸Šä¼ æ–‡ä»¶ä¸ºç©º");
                result.setCode(400);
                return result;
            }

            StringBuilder contentBuilder = new StringBuilder();
            for (MultipartFile file : files) {
                if (file.isEmpty()) {
                    continue;
                }
                String fileName = file.getOriginalFilename();
                if (fileName == null) {
                    continue;
                }

                if (fileName.endsWith(".docx") || fileName.endsWith(".pdf")) {
                    List<Media> mediaList = null;
                    if (fileName.endsWith(".docx")) {
                        // å°† docx è½¬æ¢ä¸º PDF
                        XWPFDocument docxDoc = new XWPFDocument(file.getInputStream());
                        ByteArrayOutputStream pdfOutputStream = new ByteArrayOutputStream();
                        PdfOptions options = PdfOptions.create();
                        PdfConverter.getInstance().convert(docxDoc, pdfOutputStream, options);
                        byte\[\] pdfBytes = pdfOutputStream.toByteArray();
                        mediaList = convertPdfToImages(pdfBytes);
                    } else if (fileName.endsWith(".pdf")) {
                        mediaList = convertPdfToImages(file.getBytes());
                    }
                    if (mediaList != null && !mediaList.isEmpty()) {
                        UserMessage message = UserMessage.builder().text(Consts.VISUAL\_PROMPT).media(mediaList).metadata(new HashMap<>()).build();
                        message.getMetadata().put(MESSAGE\_FORMAT, MessageFormat.IMAGE);
                        String content = openAiVisualChatClient.prompt(new Prompt(message)).call().content();
                        contentBuilder.append(content).append("\\n");
                    }
                } else {
                    if (!file.isEmpty()) {
                        contentBuilder.append(file.getOriginalFilename()).append(":\\n");
                        contentBuilder.append(new String(file.getBytes(), StandardCharsets.UTF\_8)).append("\\n");
                    }
                }
            }
            String content = contentBuilder.toString();

            String resp = openAiAnalyzeChatClient
                    .prompt(Consts.ANALYZE\_PROMPT)
                    .user(content)
                    .call()
                    .content();

            result.setData(resp);
            result.setMessage("è§£æå®Œæˆ");
            result.setCode(200);
        } catch (Exception e) {
            result.setMessage("æ–‡ä»¶å¤„ç†å¼‚å¸¸: " + e.getMessage());
            result.setCode(500);
            return result;
        }
        return result;
    }

    // å…¶ä»–æ¥å£æ–¹æ³•...
}

`AiChatController`Â æ˜¯é¡¹ç›®çš„æ§åˆ¶å™¨ç±»ï¼Œè´Ÿè´£å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å®ƒé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¸åŒä»»åŠ¡çš„Â `ChatClient`Â å®ä¾‹ï¼Œæä¾›äº†æ–‡ä»¶ä¸Šä¼ ã€æµå¼æ–‡ä»¶ä¸Šä¼ å’Œæµ‹è¯•ç”¨ä¾‹åˆ›å»ºç­‰æ¥å£ã€‚åœ¨æ–‡ä»¶ä¸Šä¼ æ¥å£ä¸­ï¼Œä¼šæ ¹æ®æ–‡ä»¶ç±»å‹ï¼ˆ`.docx`Â æˆ–Â `.pdf`ï¼‰è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¦‚å°†Â `docx`Â è½¬æ¢ä¸ºÂ `PDF`ï¼Œå†å°†Â `PDF`Â è½¬æ¢ä¸ºå›¾ç‰‡ï¼Œæœ€åè°ƒç”¨å¯è§†åŒ–æ¨¡å‹è¿›è¡Œå¤„ç†

### 5\. èŠ‚ç‚¹ç±»ï¼ˆCaseGenerateNode.java,Â CaseReviewerNode.java,Â CaseFormatNode.javaï¼‰

package com.fingertip.caseaibackend.aiproxies.nodes;

import com.alibaba.cloud.ai.graph.OverAllState;
import com.alibaba.cloud.ai.graph.action.NodeAction;
import com.fingertip.caseaibackend.commons.Consts;
import org.springframework.ai.chat.client.ChatClient;
import org.springframework.ai.chat.model.ChatResponse;
import org.springframework.util.StringUtils;

import java.util.HashMap;
import java.util.Map;

public class CaseGenerateNode implements NodeAction {
    private final ChatClient chatClient;

    public CaseGenerateNode(ChatClient chatClient) {
        this.chatClient = chatClient;
    }

    @Override
    public Map<String, Object> apply(OverAllState t) {
        String origin\_message = (String) t.value(Consts.ORIGIN\_MESSAGE).orElse("");
        String case\_reviewer\_message = (String) t.value(Consts.CASE\_REVIEW\_MESSAGE).orElse("");
        String caseInfo = (String) t.value(Consts.CASE\_INFO\_MESSAGE).orElse("");

        if (!StringUtils.hasText(origin\_message)) {
            throw new IllegalArgumentException("æ²¡æœ‰æ‰¾åˆ°åŸå§‹æ¶ˆæ¯");
        }
        String content = Consts.CASE\_WRITER\_PROMPT + "\\n\\n" + origin\_message;
        if (StringUtils.hasText(case\_reviewer\_message) && StringUtils.hasText(caseInfo)) {
            content = "%s\\n# åŸå§‹éœ€æ±‚:\\n%s\\n\\n# ä¸Šä¸ªç‰ˆæœ¬éœ€æ±‚ç”¨ä¾‹:\\n%s \\n# ä¸“å®¶æ„è§:%s\\n".formatted(Consts.CASE\_WRITER\_PROMPT, origin\_message, caseInfo, case\_reviewer\_message);
        }

        ChatResponse response = chatClient.prompt(content).call().chatResponse();
        String output = null;
        if (response != null) {
            output = response.getResult().getOutput().getText();
        }

        Map<String, Object> updated = new HashMap<>();
        updated.put(Consts.CASE\_INFO\_MESSAGE, output);

        return updated;
    }
}

è¿™äº›èŠ‚ç‚¹ç±»å®ç°äº†Â `NodeAction`Â æ¥å£ï¼Œç”¨äºåœ¨çŠ¶æ€å›¾ä¸­æ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œ`CaseGenerateNode`Â è´Ÿè´£æ ¹æ®åŸå§‹éœ€æ±‚å’Œè¯„å®¡æ„è§ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼Œå®ƒä»Â `OverAllState`Â ä¸­è·å–æ‰€éœ€çš„ä¿¡æ¯ï¼Œæ„é€ è¯·æ±‚å†…å®¹ï¼Œè°ƒç”¨ç›¸åº”çš„Â `ChatClient`Â ä¸å¤§è¯­è¨€æ¨¡å‹äº¤äº’ï¼Œæœ€åå°†ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ä¿¡æ¯å­˜å‚¨åˆ°Â `OverAllState`Â ä¸­ã€‚

### 6\. åé¦ˆåˆ†å‘å™¨ï¼ˆFeedbackDispatcher.javaï¼‰

package com.fingertip.caseaibackend.aiproxies.nodes;

import com.alibaba.cloud.ai.graph.OverAllState;
import com.alibaba.cloud.ai.graph.action.EdgeAction;
import com.fingertip.caseaibackend.commons.Consts;

public class FeedbackDispatcher implements EdgeAction {
    @Override
    public String apply(OverAllState t) {
        String output = (String) t.value(Consts.CASE\_REVIEW\_MESSAGE).orElse("");
        return output.toLowerCase().contains("approve") ? "positive" : "negative";
    }
}

`FeedbackDispatcher`Â å®ç°äº†Â `EdgeAction`Â æ¥å£ï¼Œæ ¹æ®æµ‹è¯•ç”¨ä¾‹è¯„å®¡ç»“æœï¼ˆ`CASE_REVIEW_MESSAGE`ï¼‰åˆ¤æ–­æ˜¯å¦é€šè¿‡è¯„å®¡ï¼Œå¹¶è¿”å›ç›¸åº”çš„åé¦ˆç»“æœï¼ˆ`positive`Â æˆ–Â `negative`ï¼‰ï¼Œç”¨äºçŠ¶æ€å›¾ä¸­çš„æµç¨‹æ§åˆ¶

ğŸŒŸCç«¯é¡µé¢

Â æ€»ç»“ï¼š

ç›®å‰ç”¨ä¾‹ç”Ÿæˆçš„promotéœ€æŒç»­è°ƒä¼˜ï¼Œæµ‹è¯•ç”¨ä¾‹çš„è¡¥å…¨ã€æœ€ç»ˆç”¨ä¾‹çš„å­˜å‚¨ã€ä¸‹è½½åŠŸèƒ½æœ‰å¾…å¼€å‘ï¼Œæ•¬è¯·æœŸå¾…~