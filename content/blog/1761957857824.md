---
layout: post
title: 'ï¸ æ·±åº¦è§£ææˆ‘çš„ Overleaf ç§æœ‰åŒ–éƒ¨ç½²ï¼šä¸€ä»½ç¨³å®šã€é«˜å…¼å®¹æ€§çš„ `docker-compose.yaml`'
date: "2025-11-01T00:44:17Z"
---
ğŸ› ï¸ æ·±åº¦è§£ææˆ‘çš„ Overleaf ç§æœ‰åŒ–éƒ¨ç½²ï¼šä¸€ä»½ç¨³å®šã€é«˜å…¼å®¹æ€§çš„ \`docker-compose.yaml\`
============================================================

é€šè¿‡ç§æœ‰åŒ–éƒ¨ç½² Overleafï¼ˆShareLaTeX CEï¼‰ï¼Œæˆ‘ä»¬èƒ½å½»åº•æŒæ§ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ LaTeX åä½œç¯å¢ƒï¼Œä¸ºæ‚¨çš„è®ºæ–‡ç¼–å†™å’Œæ•°æ®å®‰å…¨æä¾›å¼ºå¤§ä¿éšœï¼Œå‘Šåˆ«å®˜æ–¹æœåŠ¡çš„ä»˜è´¹é™åˆ¶ä¸ç¡¬ä»¶å…¼å®¹æ€§çƒ¦æ¼ã€‚

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ **XuHe**ã€‚åœ¨ä¸Šä¸€ç¯‡åšå®¢[å‘Šåˆ« LaTeX é…ç½®åœ°ç‹±ï¼šæˆ‘çš„ Overleaf (ShareLaTeX-CE) å®Œæ•´ç‰ˆç§æœ‰åŒ–éƒ¨ç½²æ–¹æ¡ˆ](https://www.cnblogs.com/xuhe2/p/19122407)ï¼Œæˆ‘æƒ³è¯¦ç»†è§£æä¸€ä¸‹æˆ‘ä¸º **Overleaf Community Edition (ShareLaTeX CE)** é¡¹ç›®æ‰€é…ç½®çš„ `docker-compose.yaml` æ–‡ä»¶ã€‚

ä¸€ä¸ªç¨³å®šã€å¯ç»´æŠ¤çš„ Overleaf ç§æœ‰éƒ¨ç½²ï¼Œå…¶çµé­‚å°±åœ¨äºå¦‚ä½•é…ç½®å¥½ä¸‰ä¸ªæ ¸å¿ƒæœåŠ¡ï¼š**ShareLaTeX åº”ç”¨**ã€**MongoDB æ•°æ®åº“**å’Œ **Redis ç¼“å­˜**ã€‚

æˆ‘è¿™ä»½é…ç½®ä¸ä»…è§£å†³äº†**AVX å…¼å®¹æ€§é—®é¢˜**ï¼Œè¿˜é€šè¿‡ä¸€ç³»åˆ—ç¯å¢ƒå˜é‡ä¼˜åŒ–äº†**ä½¿ç”¨ä½“éªŒ**å’Œ**ç¼–è¯‘ç¨³å®šæ€§**ã€‚

    services:
        sharelatex:
            restart: always
            # image: sharelatex/sharelatex:4.2.3
            image: xuhe-sharelatex-ce:latest # custom image(include new texlive)
            container_name: leaf-sharelatex
            depends_on:
                mongo:
                    condition: service_healthy
                redis:
                    condition: service_started
            ports:
                - 8008:80
            links:
                - mongo
                - redis
            stop_grace_period: 60s
            volumes:
                - ./sharelatex:/var/lib/sharelatex
            environment:
                SHARELATEX_APP_NAME: XuHe's Overleaf
    
                SHARELATEX_MONGO_URL: mongodb://mongo/sharelatex
    
                # Same property, unfortunately with different names in
                # different locations
                SHARELATEX_REDIS_HOST: redis
                REDIS_HOST: redis
    
                ENABLED_LINKED_FILE_TYPES: "project_file,project_output_file"
    
                # Enables Thumbnail generation using ImageMagick
                ENABLE_CONVERSIONS: "true"
    
                # Disables email confirmation requirement
                EMAIL_CONFIRMATION_DISABLED: "true"
    
                # temporary fix for LuaLaTex compiles
                # see https://github.com/overleaf/overleaf/issues/695
                TEXMFVAR: /var/lib/sharelatex/tmp/texmf-var
    
        mongo:
            restart: always
            image: mongo:4.4
            container_name: leaf-mongo
            command: "--replSet overleaf"
            expose:
                - 27017
            volumes:
                - ./mongo:/data/db
            healthcheck:
                test: echo 'db.stats().ok' | mongo localhost:27017/test --quiet
                interval: 10s
                timeout: 10s
                retries: 5
    
        redis:
            restart: always
            image: redis:6.2
            container_name: leaf-redis
            expose:
                - 6379
            volumes:
                - ./redis:/data
    

### ä¸€ã€æ ¸å¿ƒæœåŠ¡æ€»è§ˆ

æˆ‘çš„éƒ¨ç½²æ–¹æ¡ˆä¸­åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæœåŠ¡ï¼š

æœåŠ¡åç§°

è§’è‰²

å…³é”®ç‰ˆæœ¬ï¼ˆå…¼å®¹æ€§è€ƒé‡ï¼‰

`sharelatex`

ä¸»åº”ç”¨æœåŠ¡

è‡ªå®šä¹‰é•œåƒ (`xuhe-sharelatex-ce:latest`)

`mongo`

æ•°æ®å­˜å‚¨æœåŠ¡

`mongo:4.4` (ä¸ºå…¼å®¹æ—  AVX æŒ‡ä»¤é›† CPU)

`redis`

ç¼“å­˜ä¸å®æ—¶æ•°æ®æœåŠ¡

`redis:6.2`

* * *

### äºŒã€ShareLaTeX åº”ç”¨é…ç½®è¯¦è§£ (`sharelatex` Service)

`sharelatex` æœåŠ¡æ˜¯æ•´ä¸ªéƒ¨ç½²çš„æ ¸å¿ƒã€‚è¿™é‡Œæˆ‘ä»¬ä¸ä»…æŒ‡å®šäº†è‡ªå®šä¹‰é•œåƒï¼Œè¿˜é€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œäº†å¤§é‡åŠŸèƒ½å®šåˆ¶ã€‚

#### 1\. å¯åŠ¨ä¸ä¾èµ–

é…ç½®é¡¹

å€¼

æ ¸å¿ƒä½œç”¨

`image`

`xuhe-sharelatex-ce:latest`

ä½¿ç”¨æˆ‘ä»¬**è‡ªå®šä¹‰çš„å®Œæ•´ TeX Live é•œåƒ**ã€‚

`restart`

`always`

ä¿è¯æœåŠ¡å´©æºƒæˆ–é‡å¯åè‡ªåŠ¨æ¢å¤è¿è¡Œã€‚

`depends_on`

`mongo` (healthy), `redis` (started)

ç¡®ä¿ ShareLaTeX åªæœ‰åœ¨æ•°æ®åº“å’Œç¼“å­˜æœåŠ¡å‡†å¤‡å°±ç»ªåæ‰å¯åŠ¨ã€‚

#### 2\. æ ¸å¿ƒç¯å¢ƒå˜é‡ (`environment`)

ä»¥ä¸‹ç¯å¢ƒå˜é‡æ˜¯å®šåˆ¶ Overleaf è¡Œä¸ºçš„å…³é”®ï¼Œæˆ‘é‡ç‚¹ä»‹ç»äº†å‡ ä¸ªæé«˜ç”¨æˆ·ä½“éªŒå’Œç¨³å®šæ€§çš„é…ç½®ï¼š

ç¯å¢ƒå˜é‡

å€¼

ç›®çš„ä¸è¯´æ˜

`SHARELATEX_APP_NAME`

`XuHe's Overleaf`

**åº”ç”¨åç§°**ã€‚è‡ªå®šä¹‰æµè§ˆå™¨ Tab å’Œç™»å½•é¡µé¢çš„åç§°ï¼Œå¢å¼ºç§æœ‰åŒ–æ ‡è¯†ã€‚

`SHARELATEX_MONGO_URL`

`mongodb://mongo/sharelatex`

**MongoDB è¿æ¥**ã€‚ä½¿ç”¨ Docker Compose å†…éƒ¨æœåŠ¡å `mongo` è¿›è¡Œè¿æ¥ã€‚

`EMAIL_CONFIRMATION_DISABLED`

`"true"`

**è·³è¿‡é‚®ä»¶éªŒè¯**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°ç”¨æˆ·æ³¨å†Œéœ€è¦é‚®ä»¶éªŒè¯ã€‚å°†å…¶è®¾ç½®ä¸º `true` å¯ç›´æ¥ç™»å½•ä½¿ç”¨ï¼Œéå¸¸é€‚åˆå†…éƒ¨æˆ–ç§æœ‰éƒ¨ç½²ã€‚

`ENABLE_CONVERSIONS`

`"true"`

**å¯ç”¨å›¾ç‰‡/ç¼©ç•¥å›¾è½¬æ¢**ã€‚å…è®¸ Overleaf ä½¿ç”¨ ImageMagick è¿›è¡Œå›¾ç‰‡å¤„ç†å’Œç”Ÿæˆ PDF ç¼©ç•¥å›¾ã€‚

`TEXMFVAR`

`/var/lib/sharelatex/tmp/texmf-var`

**LuaLaTeX å…¼å®¹æ€§ä¿®å¤**ã€‚è¿™æ˜¯ä¸€ä¸ªé’ˆå¯¹ç‰¹å®šç‰ˆæœ¬ LuaLaTeX ç¼–è¯‘é—®é¢˜çš„ä¸´æ—¶ä¿®å¤ï¼Œæå‡ç¼–è¯‘ç¨³å®šæ€§ã€‚

`ENABLED_LINKED_FILE_TYPES`

`"project_file,..."`

**å¯ç”¨å¤–éƒ¨æ–‡ä»¶ç±»å‹é“¾æ¥**ï¼ˆé«˜çº§ï¼‰ã€‚ç”¨äºæ§åˆ¶å“ªäº›æ–‡ä»¶ç±»å‹å¯ä»¥è¢«é“¾æ¥æˆ–å¼•ç”¨ã€‚

#### 3\. æ•°æ®æŒä¹…åŒ–ä¸ç½‘ç»œ

*   **ç«¯å£æ˜ å°„ (`ports`)**: æˆ‘å°†å®¹å™¨å†…éƒ¨çš„ `80` ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ `8008` ç«¯å£ (`8008:80`)ï¼Œæ–¹ä¾¿é€šè¿‡æµè§ˆå™¨è®¿é—®ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ `8008`ã€‚
*   **æ•°æ®å· (`volumes`)**: `./sharelatex:/var/lib/sharelatex`ã€‚è¿™æ˜¯**è‡³å…³é‡è¦**çš„é…ç½®ï¼Œå®ƒå°†å®¹å™¨å†…çš„é¡¹ç›®æ•°æ®ç›®å½•æŒä¹…åŒ–æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šçš„ `./sharelatex` æ–‡ä»¶å¤¹ï¼Œç¡®ä¿é¡¹ç›®æ–‡ä»¶ä¸ä¼šä¸¢å¤±ã€‚

### ä¸‰ã€æ•°æ®åº“å’Œç¼“å­˜æœåŠ¡é…ç½®

#### 1\. MongoDB (`mongo` Service)

*   **ç‰ˆæœ¬ (`image`)**: é€‰æ‹©äº† **`mongo:4.4`**ã€‚è¿™æ˜¯ä¸ºäº†è§„é¿æœ€æ–°ç‰ˆ MongoDB å¯¹ **AVX æŒ‡ä»¤é›†**çš„å¼ºåˆ¶ä¾èµ–ï¼Œä»¥ç¡®ä¿åœ¨æ—§ç¡¬ä»¶ä¸Šé¡ºåˆ©è¿è¡Œã€‚
*   **å‰¯æœ¬é›† (`command`)**: `"--replSet overleaf"`ã€‚è¿™æ˜¯ Overleaf è¿è¡Œæ‰€å¿…éœ€çš„é…ç½®ï¼Œç”¨äºå¯ç”¨ MongoDB çš„**å‰¯æœ¬é›†**åŠŸèƒ½ã€‚å¯åŠ¨åï¼Œè¿˜éœ€è¦æ‰§è¡Œä¸€æ¬¡ `docker exec` å‘½ä»¤è¿›è¡Œåˆå§‹åŒ–ï¼ˆè¯¦è§æˆ‘çš„ READMEï¼‰ã€‚
*   **å¥åº·æ£€æŸ¥ (`healthcheck`)**: ä¿è¯ ShareLaTeX æœåŠ¡åªåœ¨ MongoDB ç¡®è®¤å¯ä»¥è¿æ¥å¹¶å·¥ä½œæ­£å¸¸æ—¶æ‰å¯åŠ¨ï¼Œæå‡å¯åŠ¨å¯é æ€§ã€‚
*   **æ•°æ®å· (`volumes`)**: `./mongo:/data/db`ï¼Œç¡®ä¿æ•°æ®åº“æ•°æ®æŒä¹…åŒ–ã€‚

#### 2\. Redis (`redis` Service)

*   **ç‰ˆæœ¬ (`image`)**: `redis:6.2`ï¼Œä¸€ä¸ªç¨³å®šä¸”åŠŸèƒ½å®Œæ•´çš„ Redis ç‰ˆæœ¬ã€‚
*   **ä½œç”¨**: Redis ä¸»è¦ç”¨äº Overleaf çš„å®æ—¶æ•°æ®ã€ä¼šè¯ç®¡ç†å’Œç¼“å­˜ï¼Œæ˜¯å®ç°ååŒç¼–è¾‘åŠŸèƒ½çš„åŸºç¡€ã€‚
*   **æ•°æ®å· (`volumes`)**: `./redis:/data`ï¼Œç”¨äºæŒä¹…åŒ– Redis çš„æŒä¹…åŒ–æ•°æ®ã€‚

* * *

### å››ã€ç»“è¯­

è¿™ä»½ `docker-compose.yaml` æ–‡ä»¶æ˜¯æˆ‘åœ¨ä¿è¯**æœ€å¤§ç¡¬ä»¶å…¼å®¹æ€§**çš„å‰æä¸‹ï¼Œå¯¹ Overleaf éƒ¨ç½²è¿›è¡Œå®šåˆ¶å’Œä¼˜åŒ–çš„æˆæœã€‚é€šè¿‡ç²¾å‡†çš„ç¯å¢ƒå˜é‡é…ç½®ï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†å¸¸è§çš„éƒ¨ç½²éš¾é¢˜ï¼Œè¿˜è®© Overleaf çš„ä½¿ç”¨ä½“éªŒæ›´åŠ è´´åˆç§æœ‰åŒ–éœ€æ±‚ã€‚

æ¬¢è¿è®¿é—®æˆ‘çš„ GitHub ä»“åº“ [xuhe2/sharelatex-ce](https://github.com/xuhe2/sharelatex-ce) è·å–å®Œæ•´çš„é…ç½®æ–‡ä»¶å’Œéƒ¨ç½²æŒ‡å—ã€‚

* * *

**ğŸ™ ç‰¹åˆ«è‡´è°¢**

æœ¬æ–‡çš„ç»“æ„æ¢³ç†ä¸å†…å®¹ç²¾ç‚¼å¾—åˆ°äº† **Gemini** æ™ºèƒ½åŠ©æ‰‹çš„ååŠ©ã€‚