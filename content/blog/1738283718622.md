---
layout: post
title: '【译】.NET 升级助手现在支持升级到集中式包管理'
date: "2025-01-31T00:35:18Z"
---
【译】.NET 升级助手现在支持升级到集中式包管理
=========================

原文 | McKenna Barlow

翻译 | 郑子铭

最近，.NET 升级助手引入了一些有用的新功能和一种新的中央包管理 (CPM) 升级类型。

.NET 升级助手可帮助您将解决方案升级到较新版本的 .NET。无论您是从 .NET Framework 升级到 .NET 8 还是仅在 .NET 版本之间升级，.NET 升级助手都可以帮助您了解需要进行哪些更改，并为您自动执行许多更改。.NET 升级助手可作为 [Visual Studio 扩展](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.upgradeassistant)或[命令行工具](https://www.nuget.org/packages/upgrade-assistant)使用。

最新版本的升级助手引入了一种新类型的升级，允许您将整个解决方案或选定的一组项目转换为使用 [Nuget 中央包管理 (CPM)](https://learn.microsoft.com/nuget/consume-packages/Central-Package-Management)。

升级以在 Visual Studio 中使用 CPM
--------------------------

要开始在[安装了](https://learn.microsoft.com/dotnet/core/porting/upgrade-assistant-install)升级助手扩展的 Visual Studio 中将项目升级到 CPM，请右键单击解决方案资源管理器中的项目节点并选择升级。您会注意到一个新的升级项目功能 - Nuget Central 包管理 (CPM)。

![](https://img2024.cnblogs.com/blog/1412316/202501/1412316-20250129234627713-444558476.png)

如果您选择此选项，下一个屏幕将为您提供选择解决方案中任意数量的其他项目以升级到 CPM 的选项，但在大多数情况下，我们建议您升级解决方案中的所有项目。

![](https://img2024.cnblogs.com/blog/1412316/202501/1412316-20250129234637029-1704097668.png)

下一页提供了一些自定义选项。如果您还想将选定的项目转换为 SDK 样式，可以选中该选项的复选框。默认情况下，Web 项目不会转换为 SDK 样式，因为如果将经典 Web 项目原样转换为 SDK 样式，则没有官方工具支持。建议您单独升级这些 Web 项目，但如果您想在此处包含它们，可以通过选中“将 Web 项目包含到 SDK 转换”复选框来实现。

![](https://img2024.cnblogs.com/blog/1412316/202501/1412316-20250129234651348-1166243905.png)

此页面还提供 Nuget Central 包管理设置。建议使用传递固定，默认情况下启用。我们还提供了建议的文件路径，所有集中包版本都将存储在该路径中。如果建议的位置不正确，您可以自行选择其他位置。最后一个自定义选项是能够添加 JSON 配置文件来定义这些相同的选择。

当您对选择感到满意时，单击升级以继续升级到 CPM。

使用 CLI 升级
---------

也可以通过 [.NET 升级助手命令行工具](https://learn.microsoft.com/dotnet/core/porting/upgrade-assistant-install#install-the-net-global-tool)进行相同的 CPM 升级。通过在命令提示符中导航到您的解决方案并使用以下命令来调用升级助手 CLI：

`upgrade-assistant upgrade`

首先，您将选择要升级的项目，但稍后您可以选择更多项目。接下来，您将选择要如何升级项目。新的 CPM 升级选项可以在 NuGet 升级下找到，列为“NuGet 中央包管理 (CPM)”。

![](https://img2024.cnblogs.com/blog/1412316/202501/1412316-20250129234707940-314928494.png)

接下来，您将选择解决方案中要升级到 CPM 的项目。您可以选择升级所有项目或选择部分项目。按空格键进行选择，然后按 Enter 键接受当前选择。

![](https://img2024.cnblogs.com/blog/1412316/202501/1412316-20250129234716045-54563178.png)

现在，您将有机会提供一个 JSON 文件来定义运行配置。定义了所有值的示例运行配置文件如下：

    {
      "upgrade": {
        "settings": {
          "cpm": {
            "convertProjectsToSdkStyle": false,
            "includeWebProjects": false,
            "useTransitivePinning": true,
            "rootPath": "somePath"
          }
        }
      }
    }
    

接下来系统会询问您是否也想升级到 SDK 样式。

![](https://img2024.cnblogs.com/blog/1412316/202501/1412316-20250129234725179-1680627400.png)

如果您对此问题选择“是”，系统会询问您是否希望在此次升级中包含 Web 项目。再次值得注意的是，我们建议您单独升级这些 Web 项目。最后，系统会询问您是否希望启用传递固定，在大多数情况下建议启用传递固定。

![](https://img2024.cnblogs.com/blog/1412316/202501/1412316-20250129234733869-386012922.png)

完成所有这些选择后，按 Enter 键。系统将询问您是否要继续升级。输入“y”并按 Enter 键以使用当前选择运行升级助手工具。

了解文件更改
------

当您在 Visual Studio 中单击“升级”或按 Enter 键运行 .NET CLI 工具时，带有包引用的项目将被修改，并且您的解决方案或选定的项目现在将使用 NuGet Central 包管理。

如果您查看项目的 Git 更改，您可以看到该工具所做的文件更改。

![](https://img2024.cnblogs.com/blog/1412316/202501/1412316-20250129234745425-21826812.png)

您会注意到 .csproj 文件中的版本属性和 package.config 程序集引用已被删除。该工具现在可以查找存储库中项目导入的所有目标中的所有 PackageReference。所有包版本都已合并到 Directory.packages.props 中。

![](https://img2024.cnblogs.com/blog/1412316/202501/1412316-20250129234754588-1346729864.png)

包发现
---

作为升级助手最新改进的一部分，我们改变了在各种升级中发现和修改项目依赖项的方式。以前，升级会直接在项目文件中修改 NuGet 包引用、程序集引用和项目引用。现在，这些内容是在定义它们的位置进行编辑，而不是直接编辑项目文件，即如果在显式导入的目标文件或隐式导入（如 `Directory.Build.props`、`Directory.Build.targets` 或 `Directory.Packages.props`）中定义了 PackageReference，我们将在那里进行修改。

改进的可访问性
-------

除了更新 CPM 支持和包发现之外，我们还改进了工具及其报告的可访问性。Visual Studio 工具及其生成的 HTML 报告都提高了可访问性评级，并且与屏幕阅读器和其他辅助技术的兼容性更高。

对受支持的 Visual Studio 版本的安全相关更改
-----------------------------

升级助手支持的最低 VS 版本现在是 17.3（以前是 17.1）。由于 Visual Studio 的变化，我们建议更新低于 17.3 的版本以保持安全。因此，升级助手不再支持低于 17.3 的 Visual Studio 版本。

反馈
--

请通过直接在 .NET 升级助手[存储库](https://github.com/dotnet/upgrade-assistant/issues)中提交问题或通过 [Visual Studio 反馈渠道](https://learn.microsoft.com/visualstudio/ide/suggest-a-feature?view=vs-2022)（在 Visual Studio 中选择帮助|发送反馈）向我们提供反馈或报告任何问题。请在标题中提及“.NET 升级助手”，以便将其快速路由到我们的团队。我们感谢您的意见，并希望为您构建最好的工具！

原文链接
----

[.NET Upgrade Assistant Now Supports Upgrading to Centralized Package Mangement](https://devblogs.microsoft.com/dotnet/dotnet-upgrade-assistant-cpm-upgrade/)

[![知识共享许可协议](https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-nc-sa/4.0/)

本作品采用[知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议](http://creativecommons.org/licenses/by-nc-sa/4.0/)进行许可。

欢迎转载、使用、重新发布，但务必保留文章署名 郑子铭 （包含链接： [http://www.cnblogs.com/MingsonZheng/](http://www.cnblogs.com/MingsonZheng/) ），不得用于商业目的，基于本文修改后的作品务必以相同的许可发布。

如有任何疑问，请与我联系 ([MingsonZheng@outlook.com](mailto:MingsonZheng@outlook.com))