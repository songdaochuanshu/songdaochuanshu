---
layout: post
title: 'K8så®¹å™¨è¿è¡Œæ—¶ï¼Œç§»é™¤Dockershimåå­˜åœ¨å“ªäº›ç–‘æƒ‘ï¼Ÿ'
date: "2025-04-24T00:40:07Z"
---
K8så®¹å™¨è¿è¡Œæ—¶ï¼Œç§»é™¤Dockershimåå­˜åœ¨å“ªäº›ç–‘æƒ‘ï¼Ÿ
=============================

K8så®¹å™¨è¿è¡Œæ—¶ï¼Œç§»é™¤Dockershimåå­˜åœ¨å“ªäº›ç–‘æƒ‘ï¼Ÿ
=============================

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç§‹æ„é›¶ã€‚

K8sç‰ˆæœ¬æˆªæ­¢ç›®å‰ï¼ˆ24/09ï¼‰å·²ç»å‘å¸ƒåˆ°äº†1.31.xç‰ˆæœ¬ã€‚æ—©åœ¨K8sç‰ˆæœ¬ä»1.24.xèµ·ï¼ˆ22/05ï¼‰ï¼Œé»˜è®¤çš„å®¹å™¨è¿è¡Œæ—¶å°±ä¸å†æ˜¯Dockeräº†æˆ–è€…è¯´Dockershimã€‚

> [å‘è¡Œç‰ˆæœ¬ | Kubernetes](https://kubernetes.io/zh-cn/releases/)
> 
> [Patch Releases | Kubernetes](https://v1-27.docs.kubernetes.io/releases/patch-releases/#1-24)
> 
> ![](https://blog.images.qiuyl.com/blog_images/202409221601451.png)

æœ€ç›´æ¥çš„åŸå› ï¼Œå°±æ˜¯å½±å“äº†æ€§èƒ½ã€‚å› ä¸ºK8sè°ƒç”¨Dockerä¸­Containerdå®¹å™¨è¿è¡Œæ—¶éœ€è¦ä¸€ä¸ªä¸­é—´å±‚Dockershimï¼Œé€ æˆäº†å¤šä½™çš„æ€§èƒ½å’Œç³»ç»Ÿç¨³å®šæ€§é—®é¢˜ã€‚å…·ä½“æ˜¯æ€ä¹ˆä¸ªäº‹å‘¢ï¼Œè¿™é‡Œå°±æ¥æ‹ä¸Šä¸€æ‹ï¼åŒæ—¶ä»‹ç»runcã€ctrã€crictlã€nerdctléƒ½æ˜¯æ€ä¹ˆä¸ªäº‹ï¼

> å†…å¿ƒOSï¼š1.24ç¬¬ä¸€ç‰ˆæœ¬æ—©åœ¨22/05å°±å‘å¸ƒäº†ï¼Œè·ä»Šå·²ç»è¿‡å»2å¹´å¤šäº†ã€‚ç°åœ¨æ‰æ¥æ‹å±å®æ„Ÿè§‰æœ‰ç‚¹æ™šäº†ï¼Œä¸çŸ¥æœ‰æ²¡æœ‰æœ‹å‹å’Œæˆ‘ä¸€æ ·ä¸€ç›´æ²¡æœ‰æ‹æ˜ç™½å‘¢ğŸ˜¬ï¼
> 
> å¦‚æœæ˜¯ é‚£å°±æ¥ç€å¾€ä¸‹çœ‹ï¼Œæœ‰ç”¨ç‚¹ä¸ªèµã€è¯„è®ºæ˜ç™½äº†ğŸ˜˜ï¼

Containerd ç®€ä»‹
-------------

å®˜æ–¹è§£é‡Šï¼šcontainerd æ˜¯ä¸€ç§è¡Œä¸šæ ‡å‡†çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œå¼ºè°ƒç®€å•æ€§ã€å¥å£®æ€§å’Œå¯ç§»æ¤æ€§ã€‚å®ƒå¯ä½œä¸º Linux å’Œ Windows çš„å®ˆæŠ¤è¿›ç¨‹ä½¿ç”¨ï¼Œå¯ä»¥ç®¡ç†å…¶ä¸»æœºç³»ç»Ÿçš„å®Œæ•´å®¹å™¨ç”Ÿå‘½å‘¨æœŸï¼šé•œåƒä¼ è¾“å’Œå­˜å‚¨ã€å®¹å™¨æ‰§è¡Œå’Œç›‘ç£ã€åº•å±‚å­˜å‚¨å’Œç½‘ç»œé™„ä»¶ç­‰ã€‚

ä¸€å¥è¯æ€»ç»“ï¼šContainerd æ˜¯ä¸€ç§**åŸºäº CRI** çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œç”¨äºç®¡ç†å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚

**PSï¼š**

*   å®¹å™¨è¿è¡Œæ—¶ï¼šæ˜¯è´Ÿè´£è¿è¡Œå®¹å™¨çš„è½¯ä»¶
    
*   CRIï¼šè¿™ä¸ªæ¥å£æ˜¯ Kubernetes ä¸å®¹å™¨è¿è¡Œæ—¶äº¤äº’çš„æ ‡å‡†æ¥å£
    

> K8sæ¶æ„ç†è§£ï¼š[ã€æ¢ç´¢ Kubernetes|å®¹å™¨åŸºç¡€è¿›é˜¶ç¯‡ ç³»åˆ— 4ã€‘ç†è§£ç°ä»£äº‘åŸç”Ÿæ—¶ä»£çš„å¼•æ“](https://blog.csdn.net/qq_48450494/article/details/130840896)

æ‹ä¸Šä¸€æ‹
----

**1ï¼‰ä¸ºä»€ä¹ˆä¸ç»§ç»­ä½¿ç”¨Dockerä½œä¸ºè¿è¡Œæ—¶**

Dockerå¹¶ä¸æ˜¯ä¸€ä¸ªâ€œç‰©ä»¶â€ï¼Œä»–æ˜¯ä¸€ä¸ªå®Œæ•´æŠ€æœ¯æ ˆã€‚å®ƒæŠ€æœ¯æ ˆä¸­æœ‰ä¸€ä¸ªå«åš â€œcontainerdâ€ çš„éƒ¨ä»¶æœ¬èº«ï¼Œæ‰æ˜¯ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶ã€‚

> æ‰§è¡Œ`yum install docker-ce`ï¼ŒéªŒè¯Dockeræ˜¯å¦åŒ…å«Containerdï¼Œæœ€ç®€å•çš„æ–¹å¼ã€‚
> 
> ![](https://blog.images.qiuyl.com/blog_images/202409221657188.png)

Docker å®ƒæä¾›äº†å¾ˆå¤šç”¨æˆ·ä½“éªŒå¢å¼ºåŠŸèƒ½ï¼Œè€Œè¿™ç®€åŒ–äº†æˆ‘ä»¬ç”¨æˆ·å¼€å‘å·¥ä½œæ—¶çš„æ“ä½œã€‚ç„¶è€Œ Kubernetes ç”¨ä¸åˆ°è¿™äº›å¢å¼ºçš„ç”¨æˆ·ä½“éªŒï¼Œæ¯•ç«Ÿå®ƒå¹¶éäººç±»ã€‚

å› ä¸ºè¿™ä¸ªç”¨æˆ·å‹å¥½çš„æŠ½è±¡å±‚ï¼ŒKubernetes é›†ç¾¤ä¸å¾—ä¸å¼•å…¥ä¸€ä¸ªå«åš Dockershim çš„å·¥å…·æ¥è®¿é—®å®ƒçœŸæ­£éœ€è¦çš„ containerdã€‚ è¿™ä¸æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œå› ä¸ºè¿™å¼•å…¥äº†é¢å¤–çš„è¿ç»´å·¥ä½œé‡ï¼ŒåŒæ—¶å½±å“æ€§èƒ½ä¸ç¨³å®šæ€§ï¼Œè€Œä¸”è¿˜å¯èƒ½å‡ºé”™ã€‚

**2ï¼‰ä¸ºä»€ä¹ˆK8sä¸ç›´æ¥è®¿é—®Dockerä¸­çš„Containerdç»„ä»¶ï¼Œä¸ºä»€ä¹ˆéœ€è¦Dockershimå‘¢ï¼Ÿ**

Docker Engine æ²¡æœ‰å®ç°ï¼ˆCRIï¼‰æ¥å£ï¼Œå› æ­¤ Kubernetes é¡¹ç›®åˆ›å»ºäº†ç‰¹æ®Šä»£ç æ¥å¸®åŠ©è¿‡æ¸¡ï¼Œ å¹¶ä½¿ Dockershim ä»£ç æˆä¸º Kubernetes çš„ä¸€éƒ¨åˆ†ã€‚Dockershim ä»£ç ä¸€ç›´æ˜¯ä¸€ä¸ªä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆå› æ­¤å¾—åï¼šshim å«ç‰‡ï¼‰ã€‚

å¦‚æœ Docker å…¼å®¹ CRIï¼Œå°±ä¸éœ€è¦è¿™ä¸ª Dockershim äº†ã€‚

**3ï¼‰Dockeræ„å»º/æ‹‰å–çš„é•œåƒï¼ŒK8sè¿˜èƒ½ä½¿ç”¨å˜›ï¼Ÿ**

Docker æ„å»ºçš„é•œåƒå¹¶ä¸æ˜¯ Docker ç‰¹æœ‰çš„é•œåƒï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº OCI çš„é•œåƒã€‚ä»»ä¸€ä»¥ OCI ä¸ºæ ‡å‡†æ„å»ºçš„é•œåƒï¼ŒK8séƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚

**PSï¼š**

*   OCIï¼šå®šä¹‰äº†å®¹å™¨è¿è¡Œæ—¶çš„è§„èŒƒå’Œé•œåƒæ ¼å¼è§„èŒƒ
    

> K8sæ¶æ„ç†è§£ï¼š[ã€æ¢ç´¢ Kubernetes|å®¹å™¨åŸºç¡€è¿›é˜¶ç¯‡ ç³»åˆ— 4ã€‘ç†è§£ç°ä»£äº‘åŸç”Ÿæ—¶ä»£çš„å¼•æ“](https://blog.csdn.net/qq_48450494/article/details/130840896)

Containerd ä¸ runc å…³ç³»
--------------------

å®˜æ–¹è§£é‡Šï¼š`runc`æ˜¯ä¸€ä¸ª CLI å·¥å…·ï¼Œç”¨äºæ ¹æ® OCI è§„èŒƒåœ¨ Linux ä¸Šç”Ÿæˆå’Œè¿è¡Œå®¹å™¨ã€‚

> [GitHub - opencontainers/runc](https://github.com/opencontainers/runc)

**1ï¼‰Containerd ä¸ runc å…³ç³»**

Containerd çš„è¿è¡Œæ—¶è¦æ±‚éå¸¸ä½ã€‚ä¸ Linux å’Œ Windows å®¹å™¨åŠŸèƒ½é›†çš„å¤§å¤šæ•°äº¤äº’éƒ½æ˜¯é€šè¿‡ runc å’Œç‰¹å®šäºæ“ä½œç³»ç»Ÿçš„åº“å¤„ç†çš„ã€‚æ‰€æœ‰Containerd ä¾èµ–äº runc æ¥å®ç°å…·ä½“åŠŸèƒ½ã€‚

*   runc æ˜¯ä¸€ä¸ª**ä½çº§åˆ«çš„å·¥å…·**ï¼Œç”¨äºåˆ›å»ºã€è¿è¡Œå’Œç®¡ç†å®¹å™¨çš„è¿›ç¨‹ã€‚å®ƒæ˜¯å®¹å™¨è¿è¡Œæ—¶ï¼ˆcontainer runtimeï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºæ‰§è¡Œå®¹å™¨å†…çš„åº”ç”¨ç¨‹åºã€‚runc å®ç°äº† OCIï¼ˆOpen Container Initiativeï¼‰è§„èŒƒï¼Œå…è®¸å¼€å‘è€…ä»¥æ ‡å‡†åŒ–çš„æ–¹å¼åˆ›å»ºå’Œè¿è¡Œå®¹å™¨ã€‚
    
*   Containerd æ˜¯ä¸€ä¸ªæ›´é«˜å±‚æ¬¡çš„å®¹å™¨ç®¡ç†ç³»ç»Ÿï¼Œå®ƒè´Ÿè´£ç®¡ç†å®¹å™¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬å®¹å™¨çš„åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ä»¥åŠé•œåƒçš„ç®¡ç†ç­‰ã€‚Containerd æä¾›äº†ä¸€ä¸ªç¨³å®šã€å¯æ’æ‹”çš„æ¶æ„ï¼Œå…è®¸å¼€å‘è€…ä»¥é«˜åº¦å¯å®šåˆ¶çš„æ–¹å¼ç®¡ç†å’Œç¼–æ’å®¹å™¨ã€‚
    

**æ€»ç»“ï¼š**Containerd å’Œ runc ä¹‹é—´çš„å…³ç³»å¯ä»¥ç±»æ¯”ä¸ºä¸»ç®¡ä¸æ‰§è¡Œè€…çš„å…³ç³»ã€‚Containerd ä½œä¸ºä¸»ç®¡ï¼Œè´Ÿè´£é«˜å±‚æ¬¡çš„ç®¡ç†å·¥ä½œï¼Œå¦‚å®¹å™¨å’Œé•œåƒçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œè€Œ runc ä½œä¸ºæ‰§è¡Œè€…ï¼Œè´Ÿè´£å…·ä½“å®¹å™¨è¿›ç¨‹çš„åˆ›å»ºå’Œè¿è¡Œã€‚

ctrã€crictlã€nerdctl åˆ†ä¸æ¸…ï¼Ÿ
-----------------------

1ï¼‰`ctr` æ˜¯ containerd çš„åŸç”Ÿè‡ªå¸¦å‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·ï¼Œä¸»è¦ç”¨äºä¸ containerd è¿›è¡Œä½çº§åˆ«çš„äº¤äº’ã€‚å®ƒæä¾›äº†å¯¹ containerd çš„å…¨é¢ç®¡ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬é•œåƒç®¡ç†ã€å®¹å™¨ç®¡ç†ã€æ²™ç®±ç®¡ç†ç­‰ã€‚

2ï¼‰`crictl` æ˜¯ Kubernetes Container Runtime Interface (CRI) çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œç”¨äºä¸å®ç°äº† CRI æ¥å£çš„å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ containerd æˆ– Dockerï¼‰è¿›è¡Œäº¤äº’ã€‚å®ƒæä¾›äº†ç±»ä¼¼äº `docker` å‘½ä»¤çš„é«˜çº§åŠŸèƒ½ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†å®¹å™¨å’Œé•œåƒã€‚

3ï¼‰`nerdctl` æ˜¯ containerd çš„å¦ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªä¸ `docker` å‘½ä»¤ç›¸ä¼¼çš„ä½“éªŒï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ— ç¼åœ°ä» Docker è¿ç§»åˆ° containerdã€‚`nerdctl` æä¾›äº†è®¸å¤šä¸ `docker` å‘½ä»¤ç›¸åŒçš„å­å‘½ä»¤ï¼Œä½¿å¾—è¿ç§»æ›´åŠ ç®€ä¾¿ã€‚ä½†åªæ”¯æŒ containerd å®¹å™¨è¿è¡Œæ—¶ã€‚

### å¸¸ç”¨æ“ä½œæŒ‡ä»¤

Containerdå®¹å™¨è¿è¡Œæ—¶ï¼Œå­˜åœ¨NameSpaceçš„æ¦‚å¿µã€‚åˆ›å»ºå¥½K8sé›†ç¾¤åContainerdä¸­å­˜åœ¨ä¸¤ä¸ªåç§°ç©ºé—´defaultä¸k8s.io

> NameSpaceå°±å¥½æ¯”ï¼ŒWindowsç³»ç»Ÿä¸­çš„æ–‡ä»¶å¤¹ï¼Œæ¯ä¸ªNameSpaceå†…å®¹ç›¸äº’éš”ç¦»ã€‚
> 
> **æ³¨æ„**ï¼šä¸K8sçš„åç§°ç©ºé—´ç±»ä¼¼ï¼Œä¸è¿‡ä¸è¦ææ··äº†ã€‚K8såç§°ç©ºé—´æ˜¯éš”ç¦»èµ„æºï¼ŒContainerdåç§°ç©ºé—´æ˜¯éš”ç¦»é•œåƒã€‚

**ctrã€crictlã€nerdctl**

1.  ctr é»˜è®¤é‡‡ç”¨ default åç§°ç©ºé—´
    
    > åˆ‡æ¢åç§°ç©ºé—´ï¼š-nå‚æ•°é€‰æ‹©ä¸åŒçš„åç§°ç©ºé—´`ctr -n k8s.io images ls`
    
2.  crictl é»˜è®¤é‡‡ç”¨ k8s.io åç§°ç©ºé—´
    
3.  nerdctl é»˜è®¤é‡‡ç”¨ default åç§°ç©ºé—´
    
    > åˆ‡æ¢åç§°ç©ºé—´ï¼šåœ¨ /etc/nerdctl/nerdctl.toml ä¸­æ·»åŠ æˆ–ä¿®æ”¹é…ç½® `namespace = "k8s.io"`
    

#### **1ï¼‰Ctrï¼ˆä¸å¸¸ç”¨ï¼Œå¯å¿½ç•¥ï¼Œäº†è§£å³å¯ï¼‰**

é•œåƒç®¡ç†

`1.Â æŸ¥çœ‹é•œåƒ   ctrÂ imagesÂ lsÂ #Â imageså¯ä»¥ç®€å†™ä¸ºiã€‚å¦‚ï¼šctrÂ iÂ lsÂ    æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´é•œåƒ   ctrÂ -nk8s.ioÂ imagesÂ ls   2.Â ä¸‹è½½é•œåƒ   ctrÂ imageÂ pullÂ <é•œåƒåç§°>   3.Â åˆ é™¤é•œåƒ   ctrÂ imageÂ rmÂ <é•œåƒåç§°>   4.Â é•œåƒå¯¼å‡º   ctrÂ iÂ exportÂ <å¯¼å‡ºåç§°>Â <éœ€è¦å¯¼å‡ºçš„æºé•œåƒåç§°>   5.Â é•œåƒå¯¼å…¥   ctrÂ iÂ importÂ <é•œåƒè¢«å¯¼å‡ºæ—¶çš„é•œåƒåç§°>   6.Â ä¿®æ”¹tag   ctrÂ imagesÂ tagÂ <æºé•œåƒåç§°>Â <>   7.Â æŸ¥çœ‹åç§°ç©ºé—´   ctrÂ nsÂ ls   `

å®¹å™¨ç®¡ç†

`1.Â æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨   ctrÂ containerÂ lsÂ Â #Â containerå¯ä»¥ç®€å†™ä¸ºcã€‚å¦‚ï¼šctrÂ cÂ lsÂ    2.Â åˆ›å»ºå®¹å™¨   ctrÂ containerÂ createÂ <é•œåƒåç§°>Â <å®¹å™¨åç§°>   3.Â æŸ¥çœ‹å®¹å™¨ä¸­è·‘çš„è¿›ç¨‹   ctrÂ taskÂ ls   4.Â åœæ­¢å®¹å™¨   ctrÂ tasksÂ killÂ <å®¹å™¨åç§°>   5.Â åˆ é™¤å®¹å™¨   ctrÂ tasksÂ deleteÂ <å®¹å™¨åç§°>   `

crictlã€nerdctlå¸¸ç”¨æŒ‡ä»¤ï¼Œå°±ä¸åˆ—å‡ºæ¥ï¼Œç½‘ä¸Šå¯ä»¥æ‰¾åˆ°å¾ˆå¤šã€‚

#### 2ï¼‰crictl

[crictl å¸¸è§çš„å‘½ä»¤å¤§å…¨ (aliyun.com)](https://developer.aliyun.com/article/1608376)

#### 3ï¼‰nerdctl

[ç®€å•çš„nerdctlå‘½ä»¤ä½¿ç”¨ï¼Œæ“ä½œæ‰‹å†Œ-CSDNåšå®¢](https://blog.csdn.net/luck099/article/details/131381809)

å‚è€ƒ
==

[å®¹å™¨è¿è¡Œæ—¶ | Kubernetes](https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#containerd)

[GitHub - containerd/containerdï¼šå¼€æ”¾å¯é çš„å®¹å™¨è¿è¡Œæ—¶](https://github.com/containerd/containerd?tab=readme-ov-file)

[æ›´æ–°ï¼šç§»é™¤ Dockershim çš„å¸¸è§é—®é¢˜ | Kubernetes](https://kubernetes.io/zh-cn/blog/2022/02/17/dockershim-faq/)

[åˆ«æ…Œ: Kubernetes å’Œ Docker | Kubernetes](https://kubernetes.io/zh-cn/blog/2020/12/02/dont-panic-kubernetes-and-docker/)

End
===