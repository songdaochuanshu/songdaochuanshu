---
layout: post
title: 'shell脚本快速检查192.168.1网段ip是否在用'
date: "2025-01-13T00:39:09Z"
---
shell脚本快速检查192.168.1网段ip是否在用
----------------------------

检查 `192.168.1` 网段中哪些 IP 地址正在使用，可以使用 Shell 脚本结合 `ping` 命令来并发扫描整个网段。以下是实现这一功能的完整脚本：

* * *

### **脚本：检查 `192.168.1` 网段 IP 是否在用**

    #!/bin/bash
    
    # 定义网段
    NETWORK="192.168.1"
    
    # 定义超时时间（秒）
    TIMEOUT=1
    
    # 定义并行扫描的 IP 数量
    PARALLEL=20
    
    # 日志函数
    function log_info() {
      echo -e "[INFO] $1"
    }
    
    function log_success() {
      echo -e "\033[32m[SUCCESS] $1\033[0m"
    }
    
    function log_error() {
      echo -e "\033[31m[ERROR] $1\033[0m"
    }
    
    # 检查单个 IP 是否在线
    function check_ip() {
      local ip=$1
      if ping -c 1 -W "$TIMEOUT" "$ip" &> /dev/null; then
        log_success "IP $ip is online"
      else
        log_error "IP $ip is offline"
      fi
    }
    
    # 主函数
    function main() {
      log_info "Scanning network $NETWORK.0/24..."
    
      # 使用循环遍历 1-254 的 IP 地址
      for i in {1..254}; do
        ip="$NETWORK.$i"
        check_ip "$ip" &
    
        # 控制并行数量
        if [[ $(jobs -r -p | wc -l) -ge $PARALLEL ]]; then
          wait -n
        fi
      done
    
      # 等待所有后台任务完成
      wait
    }
    
    # 执行主函数
    main
    

* * *

### **脚本说明**

1.  **网段定义**
    
    *   `NETWORK="192.168.1"`：定义要扫描的网段。
2.  **超时时间**
    
    *   `TIMEOUT=1`：设置 `ping` 命令的超时时间为 1 秒。
3.  **并行扫描**
    
    *   `PARALLEL=20`：设置同时扫描的 IP 数量为 20 个，以提高扫描效率。
4.  **日志输出**
    
    *   使用不同颜色的日志区分在线和离线的 IP 地址：
        *   绿色：IP 在线。
        *   红色：IP 离线。
5.  **`check_ip` 函数**
    
    *   使用 `ping` 命令检查单个 IP 是否在线。
    *   如果 `ping` 成功，则 IP 在线；否则，IP 离线。
6.  **主函数 `main`**
    
    *   遍历 `192.168.1.1` 到 `192.168.1.254` 的所有 IP 地址。
    *   使用 `&` 将 `check_ip` 放入后台执行，实现并行扫描。
    *   使用 `jobs` 和 `wait` 控制并行任务数量。

* * *

### **使用方法**

1.  将脚本保存为 `scan_network.sh`。
2.  赋予执行权限：
    
        chmod +x scan_network.sh
        
    
3.  运行脚本：
    
        ./scan_network.sh
        
    

* * *

### **示例输出**

    [INFO] Scanning network 192.168.1.0/24...
    [SUCCESS] IP 192.168.1.1 is online
    [ERROR] IP 192.168.1.2 is offline
    [SUCCESS] IP 192.168.1.3 is online
    [ERROR] IP 192.168.1.4 is offline
    ...
    

* * *

### **优化建议**

1.  **增加 IP 范围参数**  
    可以通过命令行参数指定扫描的 IP 范围，例如：
    
        ./scan_network.sh 192.168.1.10 192.168.1.20
        
    
    修改脚本：
    
        START_IP=${1:-1}
        END_IP=${2:-254}
        
        for i in $(seq "$START_IP" "$END_IP"); do
          ip="$NETWORK.$i"
          check_ip "$ip" &
        done
        
    
2.  **保存结果到文件**  
    可以将扫描结果保存到文件中，便于后续分析：
    
        LOG_FILE="scan_results.txt"
        function log_success() {
          echo -e "\033[32m[SUCCESS] $1\033[0m"
          echo "[SUCCESS] $1" >> "$LOG_FILE"
        }
        function log_error() {
          echo -e "\033[31m[ERROR] $1\033[0m"
          echo "[ERROR] $1" >> "$LOG_FILE"
        }
        
    
3.  **使用 `fping` 替代 `ping`**  
    `fping` 是一个更高效的网络扫描工具，支持批量扫描。如果系统安装了 `fping`，可以替换 `ping` 命令：
    
        fping -c 1 -t "$TIMEOUT" "$ip" &> /dev/null
        
    

* * *

### **总结**

该脚本通过并行 `ping` 扫描 `192.168.1` 网段，快速检测哪些 IP 地址在线。通过调整并行数量和超时时间，可以平衡扫描速度和准确性。如果需要更高效的扫描，可以考虑使用 `nmap` 或 `fping` 等专业工具。

本文来自博客园，作者：[dashery](https://www.cnblogs.com/ydswin/)，转载请注明原文链接：[https://www.cnblogs.com/ydswin/p/18666134](https://www.cnblogs.com/ydswin/p/18666134)

posted on 2025-01-12 11:47  [dashery](https://www.cnblogs.com/ydswin)  阅读(64)  评论(0)  [编辑](https://i.cnblogs.com/EditPosts.aspx?postid=18666134)  [收藏](javascript:void\(0\))  [举报](javascript:void\(0\))