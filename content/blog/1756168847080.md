---
layout: post
title: 'ã€æ¸²æŸ“æµæ°´çº¿ã€‘[é€ç‰‡å…ƒé˜¶æ®µ]-[æ·±åº¦å†™å…¥]ä»¥UnityURPä¸ºä¾‹'
date: "2025-08-26T00:40:47Z"
---
ã€æ¸²æŸ“æµæ°´çº¿ã€‘\[é€ç‰‡å…ƒé˜¶æ®µ\]-\[æ·±åº¦å†™å…¥\]ä»¥UnityURPä¸ºä¾‹
====================================

![ã€æ¸²æŸ“æµæ°´çº¿ã€‘[é€ç‰‡å…ƒé˜¶æ®µ]-[æ·±åº¦å†™å…¥]ä»¥UnityURPä¸ºä¾‹](https://img2024.cnblogs.com/blog/3685400/202508/3685400-20250825162011114-1217598734.png) æœ¬æ–‡æ¢è®¨Unity URPæ¸²æŸ“ç®¡çº¿ä¸­çš„æ·±åº¦å†™å…¥æœºåˆ¶ï¼Œé‡ç‚¹è§£æZWriteOn/OffçŠ¶æ€å¯¹æ¸²æŸ“æ•ˆæœçš„å½±å“ã€‚æ·±åº¦ç¼“å†²åŒºé€šè¿‡æ¯”è¾ƒåƒç´ æ·±åº¦å€¼å®ç°é®æŒ¡è®¡ç®—ï¼ŒZWriteOné€‚ç”¨äºä¸é€æ˜ç‰©ä½“ç¡®ä¿æ­£ç¡®é®æŒ¡ï¼ŒZWriteOffåˆ™ç”¨äºåŠé€æ˜ç‰©ä½“é¿å…é”™è¯¯é®æŒ¡ã€‚æ–‡ç« è¯¦ç»†ä»‹ç»äº†URPä¸­æ·±åº¦å†™å…¥çš„æŠ€æœ¯åŸç†ã€å‘å±•å†ç¨‹å’Œå…¸å‹åº”ç”¨åœºæ™¯ï¼ŒåŒ…æ‹¬æ ‡å‡†ä¸é€æ˜ç‰©ä½“æ¸²æŸ“ã€åŠé€æ˜ç‰©ä½“çš„æ·±åº¦é¢„å†™å…¥æŠ€æœ¯ï¼Œä»¥åŠæ°´ä½“æ•ˆæœçš„æ·±åº¦äº¤äº’å®ç°ã€‚é€šè¿‡Shaderä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ä¸åŒåœºæ™¯ä¸‹é…ç½®æ·±åº¦å†™å…¥çŠ¶æ€ï¼Œä¸ºæ¸¸æˆæ¸²æŸ“å¼€å‘æä¾›å®ç”¨å‚è€ƒã€‚

*   æ·±åº¦å†™å…¥é˜¶æ®µå†³å®šäº†ç‰©ä½“æ·±åº¦å€¼æ˜¯å¦å†™å…¥æ·±åº¦ç¼“å†²åŒºä»¥è¿›è¡Œé®æŒ¡è®¡ç®—ï¼›æ“ä½œçŠ¶æ€`ZWrite On/Off`æ§åˆ¶è¿™ä¸€å†™å…¥è¡Œä¸ºï¼Œå½±å“æ¸²æŸ“é¡ºåºå’ŒåŠé€æ˜æ•ˆæœçš„æ­£ç¡®æ€§ã€‚

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ç®€ä»‹
==

**æ·±åº¦ç¼“å†²åŒºæœºåˆ¶**â€Œ
------------

*   æ¯ä¸ªåƒç´ çš„æ·±åº¦å€¼è¢«å­˜å‚¨ä¸ºäºŒç»´çŸ©é˜µï¼Œå°ºå¯¸ä¸å±å¹•å°ºå¯¸åŒ¹é…ã€‚å½“æ¸²æŸ“æ–°ç‰©ä½“æ—¶ï¼Œç³»ç»Ÿæ¯”è¾ƒå½“å‰åƒç´ æ·±åº¦ä¸ç¼“å†²åŒºå€¼ï¼Œå†³å®šæ˜¯å¦è¦†ç›–é¢œè‰²å¹¶æ›´æ–°æ·±åº¦ï¼ˆé€šè¿‡ZTestï¼‰ã€‚

â€Œ**å†™å…¥é˜¶æ®µæ“ä½œ**â€Œ
------------

*   æ·±åº¦å†™å…¥æ˜¯å…‰æ …åŒ–çš„å­æ­¥éª¤ï¼Œè‹¥å¼€å¯ï¼ˆZWrite Onï¼‰ï¼Œåˆ™å°†ç‰©ä½“æ·±åº¦å†™å…¥ç¼“å†²åŒºï¼›è‹¥å…³é—­ï¼ˆZWrite Offï¼‰ï¼Œåˆ™è·³è¿‡å†™å…¥ï¼Œé¿å…å¹²æ‰°åç»­æ¸²æŸ“é¡ºåºã€‚

â€Œ**URPç‰¹å®šæµç¨‹**â€Œ
-------------

*   URPä¼˜åŒ–äº†ä¼ ç»Ÿç®¡çº¿ï¼Œæ·±åº¦å†™å…¥ä¸æ¨¡æ¿æµ‹è¯•ï¼ˆStencilï¼‰å¹¶è¡Œæ‰§è¡Œï¼Œç¡®ä¿é«˜æ€§èƒ½æ¸²æŸ“ï¼Œå°¤å…¶åœ¨åŠé€æ˜ç‰©ä½“å¤„ç†ä¸­éœ€åˆ†ç¦»å†™å…¥ä¸é¢œè‰²æ··åˆé˜¶æ®µã€‚

**æ“ä½œçŠ¶æ€ZWrite On/Offç®€ä»‹**
=======================

*   `ZWrite`çŠ¶æ€é€šè¿‡ShaderLabå‘½ä»¤è®¾ç½®ï¼Œç›´æ¥å½±å“æ¸²æŸ“æ•ˆæœï¼š

â€Œ**ZWrite On**â€Œ
---------------

*   `ZWrite On`ï¼šå¼€å¯æ·±åº¦å†™å…¥ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œå°†ç‰‡å…ƒæ·±åº¦å€¼å†™å…¥æ·±åº¦ç¼“å†²â€Œ
*   é»˜è®¤çŠ¶æ€ï¼Œé€‚ç”¨äºä¸é€æ˜ç‰©ä½“ã€‚å¼€å¯æ·±åº¦å†™å…¥åï¼Œç‰©ä½“æ·±åº¦å€¼è¦†ç›–ç¼“å†²åŒºåŸæœ‰å€¼ï¼Œç¡®ä¿è¿‘å¤„ç‰©ä½“æ­£ç¡®é®æŒ¡è¿œå¤„ç‰©ä½“ï¼ˆåŸºäºæ·±åº¦æµ‹è¯•è§„åˆ™å¦‚LEqualï¼‰ã€‚ä¾‹å¦‚ï¼Œä¸é€æ˜æ¨¡å‹å¿…é¡»å¼€å¯ä»¥é¿å…æ¸²æŸ“é¡ºåºæ··ä¹±ã€‚

â€Œ**ZWrite Off**â€Œ
----------------

*   `ZWrite Off`ï¼šå…³é—­æ·±åº¦å†™å…¥ï¼Œå¸¸ç”¨äºé€æ˜ç‰©ä½“æ¸²æŸ“â€Œ
*   ç”¨äºåŠé€æ˜æˆ–ç‰¹æ•ˆç‰©ä½“ã€‚å…³é—­å†™å…¥åï¼Œæ·±åº¦ç¼“å†²åŒºä¸ä¼šè¢«æ›´æ–°ï¼Œé˜²æ­¢åŠé€æ˜ç‰©ä½“é®æŒ¡åç»­ç‰©ä½“ï¼Œä½†éœ€é…åˆä»åå¾€å‰çš„æ¸²æŸ“é¡ºåºï¼ˆå¦‚Transparenté˜Ÿåˆ—ï¼‰ç¡®ä¿æ··åˆæ­£ç¡®ã€‚å…¸å‹æ¡ˆä¾‹åŒ…æ‹¬UIå…ƒç´ æˆ–ç²’å­æ•ˆæœï¼Œå…³é—­å¯é¿å…è‡ªèº«ç©¿é€é—®é¢˜ã€‚

â€Œ**çŠ¶æ€åˆ‡æ¢åœºæ™¯**â€Œ
------------

*   åœ¨Shaderä¸­é€šè¿‡`ZWrite On|Off`å£°æ˜ï¼Œæˆ–åœ¨æè´¨çƒæš´éœ²å¼€å…³ï¼ˆå¦‚`[Enum(Off,0,On,1)]_ZWrite`ï¼‰å®ç°åŠ¨æ€æ§åˆ¶ã€‚URPä¸­ï¼ŒåŠé€æ˜ç‰©ä½“å¸¸é‡‡ç”¨åŒPassç­–ç•¥ï¼šç¬¬ä¸€Passä»…å†™å…¥æ·±åº¦ï¼ˆZWrite Onï¼‰ï¼Œç¬¬äºŒPasså…³é—­å†™å…¥å¹¶è¿›è¡Œé¢œè‰²æ··åˆ
*   ç»“åˆ`RenderQueue`æ ‡ç­¾æ§åˆ¶æ¸²æŸ“é¡ºåºï¼Œä¾‹å¦‚é€æ˜ç‰©ä½“é€šå¸¸è®¾ç½®ä¸º`"Queue"="Transparent"`å¹¶å…³é—­æ·±åº¦å†™å…¥â€Œ
*   é€šè¿‡`Camera.depthTextureMode`ç”Ÿæˆæ·±åº¦çº¹ç†ï¼Œç”¨äºå±å¹•ç©ºé—´æ•ˆæœï¼ˆå¦‚é›¾æ•ˆã€è¾¹ç¼˜æ£€æµ‹ï¼‰

**å‘å±•å†å²**
========

æ·±åº¦å†™å…¥æŠ€æœ¯åœ¨Unityä¸­çš„æ¼”å˜åæ˜ äº†æ¸²æŸ“ç®¡çº¿çš„ä¼˜åŒ–ï¼š

â€Œ**æ—©æœŸé˜¶æ®µ**â€Œ
----------

*   æ·±åº¦ç¼“å†²æ¦‚å¿µèµ·æºäºå›¾å½¢å­¦åŸºç¡€ï¼ˆå¦‚Z-bufferingï¼‰ï¼ŒUnityå†…ç½®ç®¡çº¿æ²¿ç”¨OpenGLæ ‡å‡†ï¼ŒZWriteä½œä¸ºæ ¸å¿ƒçŠ¶æ€ç”±ShaderLabæ§åˆ¶ï¼Œé»˜è®¤å¼€å¯ä¸”ä¾èµ–CPUæ’åºè§£å†³åŠé€æ˜é—®é¢˜16ã€‚

â€Œ**URPå¼•å…¥å**â€Œ
------------

*   URPï¼ˆ2018å¹´èµ·ï¼‰å¼ºåŒ–äº†æ€§èƒ½ä¸è·¨å¹³å°æ”¯æŒï¼Œä½†ä¿ç•™ZWriteæ ¸å¿ƒæœºåˆ¶ã€‚å·®å¼‚åœ¨äºURPç»Ÿä¸€äº†æ¸²æŸ“é˜Ÿåˆ—ç®¡ç†ï¼ˆå¦‚Backgroundè‡³Overlayé˜Ÿåˆ—ï¼‰ï¼Œå‡å°‘äº†æ‰‹åŠ¨æ’åºéœ€æ±‚ï¼›åŒæ—¶ï¼Œæ·±åº¦å†™å…¥é˜¶æ®µæ›´ç´§å¯†é›†æˆäºå¯ç¼–ç¨‹æ¸²æŸ“ç®¡çº¿ï¼ˆSRPï¼‰ï¼Œæ”¯æŒè‡ªå®šä¹‰Passå®ç°é«˜æ•ˆæ·±åº¦å¤„ç†47ã€‚

â€Œ**å½“å‰è¿›å±•**â€Œ
----------

*   2025å¹´ç‰ˆæœ¬è¿›ä¸€æ­¥å®Œå–„ï¼Œä¾‹å¦‚URPçš„åå¤„ç†å…¼å®¹æ€§æå‡ï¼Œæ·±åº¦å†™å…¥ä¸æ¨¡æ¿æµ‹è¯•ååŒä¼˜åŒ–ï¼Œå‡å°‘äº†åŠé€æ˜æ¸²æŸ“é”™è¯¯ï¼›æœªæ¥è¶‹åŠ¿èšç„¦äºå®æ—¶æ¸²æŸ“ä¸­æ·±åº¦å†™å…¥çš„è‡ªåŠ¨åŒ–ç®¡ç†

**â€Œåº”ç”¨1ï¼šä¸é€æ˜ç‰©ä½“çš„æ ‡å‡†æ·±åº¦å†™å…¥â€Œ**
======================

â€Œ**åœºæ™¯**â€Œ
--------

*   ç¡®ä¿ä¸é€æ˜ç‰©ä½“æ­£ç¡®é®æŒ¡åç»­æ¸²æŸ“çš„ç‰©ä½“ï¼Œé¿å…ç©¿é€é—®é¢˜ã€‚

â€Œ**åŸç†**â€Œ
--------

*   é»˜è®¤å¼€å¯`ZWrite On`ï¼Œå°†æ·±åº¦å€¼å†™å…¥ç¼“å†²åŒºï¼Œé…åˆ`ZTest LEqual`å®ç°é®æŒ¡ã€‚
    
*   **StandardOpaque.shader**
    
    *   â€Œ**åŠŸèƒ½**â€Œï¼šé€‚ç”¨äºURPç®¡çº¿çš„ä¸é€æ˜ç‰©ä½“æ¸²æŸ“ï¼Œå¼ºåˆ¶å†™å…¥æ·±åº¦å€¼
    *   â€Œ**ç‰¹ç‚¹**â€Œï¼šä½¿ç”¨`Geometry`é˜Ÿåˆ—ï¼Œç¬¦åˆURPçš„`UniversalPipeline`æ ‡ç­¾è§„èŒƒ
    
        Shader "Custom/StandardOpaque" {
            Properties { _BaseColor ("Color", Color) = (1,1,1,1) }
            SubShader {
                Tags { 
                    "RenderType"="Opaque" 
                    "RenderPipeline"="UniversalPipeline"
                    "Queue"="Geometry"
                }
                Pass {
                    ZWrite On
                    HLSLPROGRAM
                    #pragma vertex vert
                    #pragma fragment frag
                    #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
                    struct Attributes { float4 positionOS : POSITION; };
                    struct Varyings { float4 positionHCS : SV_POSITION; };
                    Varyings vert(Attributes IN) {
                        Varyings OUT;
                        OUT.positionHCS = TransformObjectToHClip(IN.positionOS.xyz);
                        return OUT;
                    }
                    half4 _BaseColor;
                    half4 frag(Varyings IN) : SV_Target { return _BaseColor; }
                    ENDHLSL
                }
            }
        }
        
    

**â€Œåº”ç”¨2ï¼šåŠé€æ˜ç‰©ä½“çš„æ·±åº¦é¢„å†™å…¥ï¼ˆDepth Prepassï¼‰â€Œ**
====================================

â€Œ**åœºæ™¯**â€Œ
--------

*   åŠé€æ˜ç‰©ä½“éœ€å…ˆå†™å…¥æ·±åº¦ä½†ä¸æ··åˆé¢œè‰²ï¼Œè§£å†³æ’åºé—®é¢˜ã€‚

â€Œ**åŸç†**â€Œ
--------

*   ç¬¬ä¸€Passä»…å†™å…¥æ·±åº¦ï¼ˆ`ZWrite On`ï¼‰ï¼Œç¬¬äºŒPasså…³é—­å†™å…¥å¹¶æ··åˆé¢œè‰²ã€‚

### **TransparentPrepass.shader**

*   â€Œ**åŠŸèƒ½**â€Œï¼šé€šè¿‡åŒPassåˆ†ç¦»æ·±åº¦å†™å…¥ä¸é¢œè‰²æ··åˆï¼Œä¼˜åŒ–åŠé€æ˜æ¸²æŸ“
*   â€Œ**ç‰¹ç‚¹**â€Œï¼šä½¿ç”¨URPçš„`Core.hlsl`åº“ï¼Œæ”¯æŒçº¹ç†é‡‡æ ·ä¸Alphaæ··åˆ

     "Custom/TransparentPrepass" {
        Properties { 
            _BaseColor ("Color", Color) = (1,0,0,0.5) 
            _MainTex ("Texture", 2D) = "white" {}
        }
        SubShader {
            Tags { 
                "RenderType"="Transparent" 
                "RenderPipeline"="UniversalPipeline"
                "Queue"="Transparent"
            }
            // Pass 1: ä»…å†™å…¥æ·±åº¦
            Pass {
                ZWrite On
                ColorMask 0
                HLSLPROGRAM
                #pragma vertex vert
                #pragma fragment frag
                #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
                struct Attributes { float4 positionOS : POSITION; };
                struct Varyings { float4 positionHCS : SV_POSITION; };
                Varyings vert(Attributes IN) {
                    Varyings OUT;
                    OUT.positionHCS = TransformObjectToHClip(IN.positionOS.xyz);
                    return OUT;
                }
                half4 frag(Varyings IN) : SV_Target { return 0; }
                ENDHLSL
            }
            // Pass 2: æ··åˆé¢œè‰²
            Pass {
                ZWrite Off
                Blend SrcAlpha OneMinusSrcAlpha
                HLSLPROGRAM
                #pragma vertex vert
                #pragma fragment frag
                #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
                TEXTURE2D(_MainTex); SAMPLER(sampler_MainTex);
                struct Attributes { 
                    float4 positionOS : POSITION; 
                    float2 uv : TEXCOORD0; 
                };
                struct Varyings { 
                    float4 positionHCS : SV_POSITION; 
                    float2 uv : TEXCOORD0; 
                };
                Varyings vert(Attributes IN) {
                    Varyings OUT;
                    OUT.positionHCS = TransformObjectToHClip(IN.positionOS.xyz);
                    OUT.uv = IN.uv;
                    return OUT;
                }
                half4 _BaseColor;
                half4 frag(Varyings IN) : SV_Target {
                    half4 col = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, IN.uv) * _BaseColor;
                    return col;
                }
                ENDHLSL
            }
        }
    }
    

* * *

**â€Œåº”ç”¨3ï¼šæ°´ä½“æ•ˆæœçš„æ·±åº¦äº¤äº’â€Œ**
===================

â€Œ**åœºæ™¯**â€Œ
--------

*   æ°´ä½“éœ€è¯»å–åœºæ™¯æ·±åº¦å¹¶å…³é—­è‡ªèº«æ·±åº¦å†™å…¥ï¼Œå®ç°åŠé€æ˜ä¸æ·±åº¦äº¤äº’ã€‚

â€Œ**åŸç†**â€Œ
--------

*   å…³é—­`ZWrite`ï¼Œé€šè¿‡`_CameraDepthTexture`è®¡ç®—æ°´ä½“ä¸åœºæ™¯çš„æ·±åº¦å·®ã€‚

### **WaterEffect.shader**

*   â€Œ**åŠŸèƒ½**â€Œï¼šåŠ¨æ€è®¡ç®—æ°´ä½“ä¸åœºæ™¯æ·±åº¦å·®ï¼Œå®ç°è¾¹ç¼˜æ¸å˜æ•ˆæœ
*   â€Œ**ç‰¹ç‚¹**â€Œï¼šä½¿ç”¨URPçš„`DeclareDepthTexture.hlsl`è®¿é—®æ·±åº¦å›¾ï¼Œéœ€åœ¨URPè®¾ç½®ä¸­å¯ç”¨æ·±åº¦çº¹ç†

    Shader "Custom/WaterEffect" {
        Properties {
            _WaterColor ("Color", Color) = (0,0.5,1,0.8)
            _DepthFade ("Depth Fade", Range(0,1)) = 0.5
        }
        SubShader {
            Tags { 
                "RenderType"="Transparent" 
                "RenderPipeline"="UniversalPipeline"
                "Queue"="Transparent+100"
            }
            Pass {
                ZWrite Off
                Blend SrcAlpha OneMinusSrcAlpha
                HLSLPROGRAM
                #pragma vertex vert
                #pragma fragment frag
                #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
                #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/DeclareDepthTexture.hlsl"
                struct Attributes { float4 positionOS : POSITION; };
                struct Varyings { 
                    float4 positionHCS : SV_POSITION;
                    float4 screenPos : TEXCOORD0;
                };
                Varyings vert(Attributes IN) {
                    Varyings OUT;
                    OUT.positionHCS = TransformObjectToHClip(IN.positionOS.xyz);
                    OUT.screenPos = ComputeScreenPos(OUT.positionHCS);
                    return OUT;
                }
                half4 _WaterColor;
                half _DepthFade;
                half4 frag(Varyings IN) : SV_Target {
                    float2 uv = IN.screenPos.xy / IN.screenPos.w;
                    float sceneDepth = LinearEyeDepth(SampleSceneDepth(uv), _ZBufferParams);
                    float waterDepth = IN.screenPos.w;
                    float depthDiff = saturate((sceneDepth - waterDepth) * _DepthFade);
                    return half4(_WaterColor.rgb, _WaterColor.a * depthDiff);
                }
                ENDHLSL
            }
        }
    }
    

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰