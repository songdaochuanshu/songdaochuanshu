---
layout: post
title: 'AI开发-python-langchain框架（1-9 返回字符串列表-格式解析器）'
date: "2026-02-04T00:54:24Z"
---
AI开发-python-langchain框架（1-9 返回字符串列表-格式解析器）
==========================================

     大模型输出结果通常都是文本信息，如何让他按照你期望的格式输出？

     这段代码演示了如何使用LangChain将大语言模型的自由文本输出转换为结构化的字符串列表。核心目标是让模型返回逗号分隔的多个值，并通过专用解析器自动拆分为Python列表。

     CommaSeparatedListOutputParser专用于解析逗号分隔的文本，自动处理空格、引号等边界字符，输出类型为List\[str\]。与StrOutputParser返回纯字符串不同，它强制将响应拆分为离散元素，适用于多值提取场景。

    提示词设计必须显式约束输出格式。通过partial\_variables注入格式指令（如"内容1, 内容2, 内容3"），引导模型生成符合解析器要求的纯列表文本。若缺少格式约束，模型可能返回自然语言描述，导致解析器机械分割产生语义错误。

代码如下：

from langchain.output\_parsers import CommaSeparatedListOutputParser
from langchain.prompts import PromptTemplate
from langchain\_openai import ChatOpenAI
import os

#输出-字符串列表
output\_parser = CommaSeparatedListOutputParser()

#这里指定分隔符
format\_instructions = "您的响应应该是csv格式的逗号分隔值的列表，例如：'内容1, 内容2, 内容3'"

#构建提示词-给出样例，提高返回的准确率
prompt = PromptTemplate(
    template="{format\_instructions}\\n请列出五个 {subject}.",
    input\_variables=\["subject"\],
    partial\_variables={"format\_instructions": format\_instructions},
)

#输出提示词
print('#######################')
print(prompt.invoke({"subject": "宠物狗的品种"}).text)
print('#######################')

llm = ChatOpenAI(
    api\_key=os.getenv("DEEPSEEK\_API\_KEY"),
    base\_url=os.getenv("BASE\_URL"),  # Deepseek 的 API 基础地址
    model="deepseek-v3:671b",  # Deepseek 对话模型（可选：deepseek-chat-pro 等高级模型）
    temperature=0.7,  # 温度参数（0-1，越低越稳定）
    max\_tokens=1024  # 最大生成 tokens
)


chain = prompt | llm | output\_parser

result = chain.invoke({"subject": "宠物狗的品种"})
print(result)

 输出结果如下：

#######################  
您的响应应该是csv格式的逗号分隔值的列表，例如：'内容1, 内容2, 内容3'  
请列出五个 宠物狗的品种.  
#######################  
\["'拉布拉多", '金毛寻回犬', '德国牧羊犬', '贵宾犬', "比格犬'"\]