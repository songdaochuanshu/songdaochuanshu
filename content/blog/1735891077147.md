---
layout: post
title: '促销系统：促销活动、优惠券、优惠规则概念模型设计'
date: "2025-01-03T07:57:57Z"
---
促销系统：促销活动、优惠券、优惠规则概念模型设计
========================

大家好，我是汤师爷~

概念模型设计是促销系统开发的关键环节，我们需要基于之前的功能分析，将复杂的促销业务拆解成清晰的领域概念，这些概念之间的关系界定和边界划分，将直接决定系统的可维护性和扩展性。

### **促销系统核心概念模型**

![](https://img2024.cnblogs.com/other/2625446/202501/2625446-20250103104435102-1700851296.png)

通过对促销业务的分析，我们可以抽象出促销系统的关键概念模型。

**1、促销活动模型**

促销活动模型对活动的各个要素和规则进行抽象，包含活动名称、描述、时间、类型和状态等基本属性。

**2、优惠券活动模型**

优惠券活动是一种特定的促销活动类型，通过发放优惠券吸引消费者购买商品并提升品牌忠诚度。该模型包含活动名称、时间、发放数量限制和券总量等属性。

**3、活动叠加互斥规则**

该规则定义了促销活动之间的组合关系，某些优惠不能与其他优惠同时使用（互斥），而某些优惠可以与其他活动一起使用（叠加）。

**4、优惠模型**

优惠模型是对商家提供给消费者的福利的抽象，可以是折扣、固定金额减免等。一般来说，消费者必须满足特定行为才能享受到。

**1）为何抽象出一个“优惠”模型**

优惠规则通常是促销活动的一部分，为啥不能合并到活动模型中，需要抽象出一个“优惠”模型？主要有以下考量因素：

*   业务关注点不同：虽然优惠规则通常是促销活动的一部分，但促销活动本质上是对客户的一种行动号召，并承诺客户满足特定行为，就能给予优惠。促销活动主要关注如何吸引消费者参与，可能包含推广、营销策划和销售目标制定。而优惠是客户实际享受的具体折扣、返利、积分累积或其他福利。
*   灵活性和扩展性：将优惠作为一个独立模型，可以更灵活地扩展促销系统。例如，新增一个促销活动”会员专享优惠“，只需基于现有的优惠模型，设置会员专享的优惠门槛和优惠内容即可，不影响现有的优惠处理逻辑。此外，优惠不仅可以来源于促销活动，还可以来源于其他场景，例如会员等级成长所带来的优惠。
*   简化会计和财务处理：从会计和财务角度看，不同促销活动的处理方式可能完全不一样，将优惠模型独立出来，也是为了简化会计和财务处理，针对不同的优惠模式、优惠级别，进行标准化的处理。

**2）优惠级别**

优惠级别分为商品级、订单级、权益级，这些级别定义了优惠价值如何被分配和应用。

*   商品级：优惠价值应用于符合优惠门槛的单个商品或多个商品。例如，买一送一场景，优惠金额减免会直接应用于这些买赠的商品上。
*   订单级：优惠价值应用于整个订单，通常是基于订单总价来计算，同时之前应用的商品级价格也会跟着减少。
*   权益级：优惠价值应用于一个权益账户，通常只适用于延迟赠送的奖励。例如，消费者因为下单支付而获得积分，这些积分累积在账户中，可以在未来用作折扣或兑换商品。

**3）优惠模式**

优惠模式分为立享、抵扣、返还模式。

*   立享：在交易过程中立即兑换优惠价值，如满减、满折、满赠等。
*   抵扣：之前积累的优惠价值，在后续交易订单的最终支付金额上提供抵扣，如使用优惠券、余额、红包、积分等。
*   返还：基于订单的实付金额或特定策略提供返利，可在未来购买时使用，如满返积分、满返优惠券等。

**5、优惠内容**

详细说明优惠的具体内容，优惠内容可分为：价格替代、折扣、固定金额减免、运费减免、积分/优惠券返还及其他奖励。

**6、优惠门槛**

消费者享受优惠需要达到的条件，门槛类型包括商品相关（特定商品、品牌、分类）、购买数量、金额、销售渠道、客户相关（特定客户账户、会员等级）、特定支付方式等。

**7、优惠券模板**

用于创建具体优惠券的基本属性和规则，模板定义了优惠券的基本属性，如名称、有效期、使用门槛、可用次数限制等。

**8、客户优惠券实例**

客户优惠券实例是客户领券后，根据优惠券模板生成的具体优惠券实体。

**9、客户权益账户**

记录和管理客户在商家下的积分、红包等权益的账户，通常用于追踪顾客的购买历史、积分累计和兑换等。

基于上述核心概念模型，下面将讲解促销计价的处理逻辑。

### 活动叠加互斥规则

活动叠加互斥规则用于控制多个促销活动是否可以同时生效。针对同一商品或订单，系统需要判断是否允许多种优惠叠加。若只允许一种优惠生效，称为互斥；若允许多个优惠同时生效，则为叠加。以下是常见的叠加互斥规则：

**1、单品级组内互斥**

单品级组内互斥规定同一商品只能享受一种优惠。比如某商品同时参与"一口价"和"限时折扣"两种促销，活动生效时，只能选择其中一种，这样可以防止单个商品优惠力度过大，避免商家利润受损。

**2、订单级组内可以共享**

订单级组内共享是指允许多个基于订单总额的活动同时生效，如"满减"、"满折"、"满赠"等订单维度的促销活动。

举例来说，消费者下单金额为120元，同时满足"满100减10"和"满100赠5元券"的条件。在订单级允许共享的情况下，这两个优惠可以同时享受。

如果商家希望控制优惠力度，也可以将"满减"和"满赠"设置为互斥，但这会降低促销的灵活性。

**3、配送费组内互斥**

配送费组内互斥是指限制配送费促销活动只能生效一种，以防止配送费优惠过度。例如"配送费减5元"和"配送费减半"这类优惠只能二选一，不能叠加使用，这样可以避免商家承担过高的运费成本。

### 活动命中规则

活动命中规则决定当商品或订单同时满足多个活动条件时，应该使用哪个活动。

"叠加互斥规则"解决了"是否可以叠加"的问题，而"命中规则"则解决了"不能叠加时选哪个"的问题，它帮助系统选择最适合且最有利于商家的活动方案。

活动命中规则并无统一标准，需要根据具体业务场景来制定。运营团队通常会从优惠力度、活动优先级和活动有效期等方面来确定活动的优先顺序。

**1、按优惠金额优先**

当系统以"优惠金额最大化"为导向时，会根据促销活动的实际让利金额来确定优先级。例如，某商品原价10元，可享受7折或限时特价5元两种优惠。因为7折优惠3元，而特价优惠5元，系统会选择限时特价方案。

**2、按活动优先级排列**

部分商家会通过后台配置活动优先级，系统按优先级从高到低依次判断。例如，新品推广活动的权重高于常规促销，系统会优先采用新品活动。

**3、按时间先后**

按时间先后的活动命中规则主要考虑两个因素：

*   活动创建时间：系统优先选择较早创建的活动，确保原有活动得到充分利用。
*   活动结束时间：系统优先考虑即将到期的活动，以充分利用活动资源，避免名额或预算浪费。

例如，当商品同时满足两个活动条件时，若其中一个活动将在24小时内结束，另一个还有一周有效期，系统会优先使用即将结束的活动，确保临期活动能被及时使用。

### 优惠计算顺序

优惠计算顺序决定了多个活动在同一订单中的计算先后顺序。这个顺序直接影响最终订单价格。例如，先计算折扣再计算满减，与先计算满减再计算折扣，最终结果可能会有显著差异。

优惠计算的常见顺序如下：

1.  先计算单品优惠，这会直接改变商品的结算价格。
2.  然后计算订单级优惠，因为需要根据商品的最终单价来判断是否达到优惠门槛。
3.  最后处理返还类优惠，比如"支付后返积分"需要用户完成支付才能触发。

部分商家可能会根据运营需求灵活调整这个顺序以提高转化率。无论采用何种顺序，关键是要确保计算逻辑清晰、避免歧义，并保证结果可以准确复现。

### **优惠分摊**

优惠分摊是指将活动优惠金额按比例分配到各个享受优惠的商品上，从而在数据统计或退款时能准确计算出每件商品获得的实际优惠金额。

常见分摊公式：商品优惠金额 = 总优惠金额 ×（商品金额 / 参与优惠的商品价格总和）

**1、分摊要点**

首先要确定参与分摊的商品范围，未参与优惠的商品不应参与分摊。

将优惠按商品金额从小到大依次分摊，并将最大金额商品作为最后一件，以确保优惠金额能完全分配完毕。

对于舍入和尾差，当分摊金额出现小数时，需要明确四舍五入的规则，并将尾差加到最后一件商品上，确保分摊总额与实际优惠金额相符。

**2、分摊示例**

假设用户购买A、B、C三件商品，单价分别为20元、30元、40元，总价90元。参加"满80减20"活动，总优惠20元。

A商品分摊金额：20 / 90 × 20 = 4.44元

B商品分摊金额：30 / 90 × 20 = 6.67元

C商品分摊金额：40 / 90 × 20 = 8.89元

为确保数据准确，最终分摊总额必须等于20元。如遇四舍五入误差，可将尾差计入C商品或最大金额商品中。

> 本文已收录于，我的技术网站：[tangshiye.cn](https://tangshiye.cn) 里面有，AI 编程、算法 Leetcode 详解、面试八股文、BAT面试真题、简历模版、架构设计，等经验分享。

本文来自博客园，作者：[架构师汤师爷](https://www.cnblogs.com/tangshiye/)，转载请注明原文链接：[https://www.cnblogs.com/tangshiye/p/18649626](https://www.cnblogs.com/tangshiye/p/18649626)