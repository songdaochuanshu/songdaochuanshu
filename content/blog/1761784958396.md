---
layout: post
title: 'åŸºäº Word æ¨¡æ¿å ä½ç¬¦çš„åŠ¨æ€æ–‡æ¡£ç”Ÿæˆå®è·µï¼ˆæºç +ä¿å§†ç‰ˆï¼‰'
date: "2025-10-30T00:42:38Z"
---
åŸºäº Word æ¨¡æ¿å ä½ç¬¦çš„åŠ¨æ€æ–‡æ¡£ç”Ÿæˆå®è·µï¼ˆæºç +ä¿å§†ç‰ˆï¼‰
==============================

ä¸€ã€**åŸºäº Word æ¨¡æ¿å ä½ç¬¦çš„åŠ¨æ€æ–‡æ¡£ç”ŸæˆæŠ€æœ¯**
============================

> ğŸ’¡ **ä½œè€…**ï¼šå¤æ¸¡è“æŒ‰
> 
> **ä¸ªäººå¾®ä¿¡å…¬ä¼—å·**ï¼šå¾®ä¿¡å…¬ä¼—å·ï¼ˆæ·±å…¥æµ…å‡ºè°ˆjavaï¼‰  
> æ„Ÿè§‰æœ¬ç¯‡å¯¹ä½ æœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ä¸€ä¸‹ï¼Œä¼šä¸å®šæœŸæ›´æ–°çŸ¥è¯†å’Œé¢è¯•èµ„æ–™ã€æŠ€å·§ï¼ï¼ï¼

### ğŸ“ ç®€ä»‹

åœ¨ä¼ä¸šä¸šåŠ¡ç³»ç»Ÿä¸­ï¼ŒåˆåŒã€å·¥å•ã€æŠ¥å‘Šç­‰ Word æ–‡æ¡£å¾€å¾€æ ¼å¼å›ºå®šä½†å†…å®¹åŠ¨æ€ã€‚ä¼ ç»Ÿç¡¬ç¼–ç æ–¹å¼å¼€å‘æ•ˆç‡ä½ã€ç»´æŠ¤æˆæœ¬é«˜ã€‚  
æœ¬æ–‡ä»‹ç»ä¸€ç§é«˜æ•ˆã€çµæ´»çš„è§£å†³æ–¹æ¡ˆï¼š**é€šè¿‡é¢„å®šä¹‰ Word æ¨¡æ¿ä¸­çš„ `${KEY}` å ä½ç¬¦ï¼Œç»“åˆåç«¯æ•°æ®è‡ªåŠ¨å¡«å……ç”Ÿæˆæœ€ç»ˆæ–‡æ¡£**ã€‚è¯¥æ–¹æ³•å®ç°é€»è¾‘æ¸…æ™°ã€æ¨¡æ¿å¯ç”±éæŠ€æœ¯äººå‘˜ç»´æŠ¤ï¼Œæ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ä¸ç³»ç»Ÿå¯æ‰©å±•æ€§ã€‚ä»¥ä¸‹æ˜¯ä»£ç å®ç°æ­¥éª¤å’Œé€»è¾‘ã€‚

  

äºŒã€æ·»åŠ ä¾èµ–:**Apache POI**
---------------------

    <!-- Apache POI for Word -->
            <dependency>
                <groupId>org.apache.poi</groupId>
                <artifactId>poi-ooxml</artifactId>
                <version>5.2.4</version>
            </dependency>
    
            <!-- Optional: For logging -->
            <dependency>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
                <optional>true</optional>
            </dependency>
    

  

ä¸‰ã€åˆ¶ä½œä»£å ä½ç¬¦çš„word æ¨¡æ¿
----------------

æ‰“å¼€éœ€è¦ç”Ÿäº§çš„æ•°æ®æ¨¡æ¿ï¼Œåœ¨å¯¹åº”ä½ç½®å¡«å†™å ä½ç¬¦ï¼Œç±»ä¼¼ä¸‹å›¾ï¼š**å ä½ç¬¦æ ¼å¼ä¸ºï¼š${XXXXX}**

ğŸ“Œ **æ³¨ï¼šå ä½ç¬¦é‡Œé¢çš„å¿…é¡»å’Œä»£ç ä¸­çš„key å€¼ä¸€æ ·**

åˆ¶ä½œå®Œæˆåï¼Œæ”¾åˆ° `src/main/resources/templates/` ç›®å½•ä¸‹ä½œä¸ºæ¨¡æ¿æ–‡ä»¶ï¼š

    src/main/resources/templates/production_order_template.docx
    

**å›¾ç‰‡ç¤ºä¾‹**

![image-20251029155045954](https://img2024.cnblogs.com/blog/2719585/202510/2719585-20251029165748315-1410650026.png)

  

å››ã€ç¼–å†™æ ¸å¿ƒé€»è¾‘
--------

### **Controller ä»£ç **

    @Slf4j
    @RestController
    public class ProductionOrderController {
    
    
    
        @Resource
        private WordGeneratorService productionOrderService;
    
        @GetMapping("/api/generate-word")
        public void generateWord(@RequestParam Long id, HttpServletResponse response) throws IOException {
    
            ProductionOrder order = new ProductionOrder();
    
            byte[] docBytes = productionOrderService.generateProductionOrderDoc(order);
    
            // è®¾ç½®æ­£ç¡®çš„ Content-Type
            response.setContentType("application/vnd.openxmlformats-officedocument.wordprocessingml.document");
            response.setContentLength(docBytes.length);
    
            // âœ… å®‰å…¨è®¾ç½®å¸¦ä¸­æ–‡çš„æ–‡ä»¶åï¼ˆå…³é”®ï¼ï¼‰
            String filename = "ç”Ÿäº§ä»»åŠ¡å•_" + id + ".docx";
            String encodedFilename = URLEncoder.encode(filename, StandardCharsets.UTF_8).replace("+", "%20");
    
            // ä½¿ç”¨ filename* è¯­æ³•ï¼ˆRFC 5987ï¼‰ï¼šæ”¯æŒ UTF-8 æ–‡ä»¶å
            response.setHeader("Content-Disposition",
                    "attachment; filename=\"" + encodedFilename + "\"; filename*=UTF-8''" + encodedFilename);
    
            // å†™å…¥å“åº”ä½“
            response.getOutputStream().write(docBytes);
            response.getOutputStream().flush();
        }
    
        @GetMapping("/api/generate-word2")
        public void generateWord2(@RequestParam String no, HttpServletResponse response) throws IOException {
            // è¿™é‡Œçš„ProductionOrder å¯ä»¥æ¢æˆè‡ªå·±å¯¹åº”çš„å®ä½“æˆ–è€…éœ€è¦å¡«å†™åˆ°æ•°æ®åº“çš„å¯¹è±¡
            // æ­£å¸¸é€»è¾‘æ˜¯ï¼Œè¿™ä¸ªorder æ˜¯éœ€è¦æŸ¥åå°æ•°æ®ï¼Œç„¶åè¿”å›orderå¯¹è±¡ï¼Œå†åœ¨åç»­åšæ¨¡æ¿å’Œå€¼ æ˜ å°„,ç±»ä¼¼ä¸‹åˆ—ä»£ç ï¼Œ
            // è¿™ä¸€æ­¥æœ€å¥½æ”¾åˆ°å®ç°ç±»å»å†™ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿
            //TODO:List<ProductionOrder> getProductDataList = this.list(
            //        new LambdaQueryWrapper<ProductionOrder>()
            //                .eq(ProductionOrder::getNo, no));
            ProductionOrder order = new ProductionOrder();
    
            // æ”¹ç”¨æ¨¡æ¿ç”Ÿæˆ
            byte[] docBytes = productionOrderService.generateFromTemplate(order);
    
    
            // è®¾ç½®æ­£ç¡®çš„ Content-Type
            response.setContentType("application/vnd.openxmlformats-officedocument.wordprocessingml.document");
            response.setContentLength(docBytes.length);
    
            // âœ… å®‰å…¨è®¾ç½®å¸¦ä¸­æ–‡çš„æ–‡ä»¶åï¼ˆå…³é”®ï¼ï¼‰
            String filename = "ç”Ÿäº§ä»»åŠ¡å•_" + no + ".docx";
            String encodedFilename = URLEncoder.encode(filename, StandardCharsets.UTF_8).replace("+", "%20");
    
            // ä½¿ç”¨ filename* è¯­æ³•ï¼ˆRFC 5987ï¼‰ï¼šæ”¯æŒ UTF-8 æ–‡ä»¶å
            response.setHeader("Content-Disposition",
                    "attachment; filename=\"" + encodedFilename + "\"; filename*=UTF-8''" + encodedFilename);
    
            // å†™å…¥å“åº”ä½“
            response.getOutputStream().write(docBytes);
            response.getOutputStream().flush();
        }
    }
    
    

### **Serviceå±‚æ ¸å¿ƒå®ç°ä»£ç **

ğŸ“Œ **æ³¨ï¼šè¿™é‡Œå°±çœå»äº†æ¥å£å±‚ï¼ˆéœ€è¦å¯ä»¥è‡ªå·±åŠ ï¼‰ï¼Œç›´æ¥æ”¾ç½®çš„æ ¸å¿ƒæ–¹æ³•**

    @Service
    public class WordGeneratorService {
    
        public byte[] generateProductionOrderDoc(ProductionOrder order) {
            try (XWPFDocument document = new XWPFDocument()) {
                // æ ‡é¢˜
                XWPFParagraph titlePara = document.createParagraph();
                titlePara.setAlignment(ParagraphAlignment.CENTER);
                XWPFRun titleRun = titlePara.createRun();
                titleRun.setText("ç”Ÿäº§ä»»åŠ¡å•ç”³è¯·è¡¨");
                titleRun.setFontSize(16);
                titleRun.setBold(true);
    
                // åˆ›å»ºè¡¨æ ¼ï¼ˆ20åˆ—æ¨¡æ‹ŸåŸè¡¨å®½åº¦ï¼Œå®é™…æŒ‰å†…å®¹åˆå¹¶ï¼‰
                XWPFTable table = document.createTable(5, 4);
                table.setWidth("100%");
    
                // ç¬¬ä¸€è¡Œï¼šå®¢æˆ·å•ä½ & è®¢å•å·
                setCellText(table.getRow(0).getCell(0), "å®¢æˆ·å•ä½ï¼š");
                setCellText(table.getRow(0).getCell(1), order.getCustomer());
                setCellText(table.getRow(0).getCell(2), "è®¢å•å·/åˆåŒç¼–å·ï¼š");
                setCellText(table.getRow(0).getCell(3), order.getOrderNo());
    
                // ç¬¬äºŒè¡Œï¼šäº§å“åç§° & å‹å·
                setCellText(table.getRow(1).getCell(0), "äº§å“åç§°ï¼š");
                setCellText(table.getRow(1).getCell(1), order.getProductName());
                setCellText(table.getRow(1).getCell(2), "äº§å“å‹å·ï¼š");
                setCellText(table.getRow(1).getCell(3), order.getModel());
    
                // ç¬¬ä¸‰è¡Œï¼šè§„æ ¼ï¼ˆç”µå‹ã€ç”µæµã€æ•°é‡ï¼‰
                setCellText(table.getRow(2).getCell(0), "è§„æ ¼");
                setCellText(table.getRow(2).getCell(1), "ç”µå‹ï¼š" + order.getVoltage());
                setCellText(table.getRow(2).getCell(2), "ç”µæµï¼š" + order.getCurrent());
                setCellText(table.getRow(2).getCell(3), "æ•°é‡ï¼š" + order.getQuantity());
    
                // ç¬¬å››è¡Œï¼šç”Ÿäº§å‘¨æœŸ
                setCellText(table.getRow(3).getCell(0), "ç”Ÿäº§å‘¨æœŸ");
                setCellText(table.getRow(3).getCell(1), "è®¡åˆ’å‡ºè´§æ—¥æœŸï¼š" + order.getPlannedShipDate());
                setCellText(table.getRow(3).getCell(2), "é”€å”®é¡¹ç›®äººï¼š");
                setCellText(table.getRow(3).getCell(3), order.getSalesPerson());
    
                // ç¬¬äº”è¡Œï¼šå¤‡æ³¨æˆ–å…¶ä»–
                setCellText(table.getRow(4).getCell(0), "å…¶ä»–è¦æ±‚ï¼š");
                table.getRow(4).getCell(1).getParagraphs().get(0);
    
                // åˆå¹¶å•å…ƒæ ¼ï¼ˆå¯é€‰ï¼Œç®€åŒ–å¤„ç†ï¼‰
                // å®é™…å¤æ‚è¡¨æ ¼å»ºè®®ç”¨æ¨¡æ¿æˆ– Apache POI é«˜çº§åˆå¹¶
    
                ByteArrayOutputStream out = new ByteArrayOutputStream();
                document.write(out);
                return out.toByteArray();
            } catch (Exception e) {
                throw new RuntimeException("ç”Ÿæˆ Word å¤±è´¥", e);
            }
        }
    
        private void setCellText(XWPFTableCell cell, String text) {
            cell.setText(text);
            // å¯é€‰ï¼šè®¾ç½®å­—ä½“
            for (XWPFParagraph p : cell.getParagraphs()) {
                for (XWPFRun r : p.getRuns()) {
                    r.setFontFamily("å®‹ä½“");
                    r.setFontSize(10);
                }
            }
        }
    
    
        //æ–¹å¼äºŒ
    
        private static final String TEMPLATE_PATH = "templates/production_order_template.docx";
    
        public byte[] generateFromTemplate(ProductionOrder order) {
            try {
                // 1. åŠ è½½æ¨¡æ¿
                ClassPathResource resource = new ClassPathResource(TEMPLATE_PATH);
                try (InputStream is = resource.getInputStream();
                     ByteArrayOutputStream out = new ByteArrayOutputStream()) {
    
                    XWPFDocument document = new XWPFDocument(is);
    
                    // 2. æ„å»ºæ•°æ®æ˜ å°„
                    Map<String, String> data = new HashMap<>();
                    data.put("customer", safeStr(order.getCustomer()));
                    data.put("orderNo", safeStr(order.getOrderNo()));
                    data.put("workOrderNo", safeStr(order.getWorkOrderNo()));
                    data.put("productName", safeStr(order.getProductName()));
                    data.put("model", safeStr(order.getModel()));
                    data.put("voltage", safeStr(order.getVoltage()));
                    data.put("current", safeStr(order.getCurrent()));
                    data.put("quantity", safeStr(order.getQuantity() != null ? order.getQuantity().toString() : ""));
                    data.put("plannedShipDate", safeStr(order.getPlannedShipDate()));
                    data.put("salesPerson", safeStr(order.getSalesPerson()));
                    
                    
                    //å¦‚æœä½ å¸Œæœ›æŸäº›å­—æ®µåªæ˜¾ç¤ºâ€œâˆšâ€è¡¨ç¤ºé€‰ä¸­ï¼Œå¯ä»¥åœ¨ Java ä¸­è¿™æ ·å¤„ç†ï¼š
                    data.put("hasEmbeddedSeal", order.isEmbeddedSeal() ? "âˆš" : "");
    
    
                    
    
                    // 3. æ›¿æ¢æ‰€æœ‰æ®µè½ä¸­çš„å ä½ç¬¦
                    replaceInParagraphs(document.getParagraphs(), data);
    
                    // 4. æ›¿æ¢è¡¨æ ¼ä¸­çš„å ä½ç¬¦
                    for (XWPFTable table : document.getTables()) {
                        for (XWPFTableRow row : table.getRows()) {
                            for (XWPFTableCell cell : row.getTableCells()) {
                                replaceInParagraphs(cell.getParagraphs(), data);
                            }
                        }
                    }
    
                    // 5. è¾“å‡ºä¸ºå­—èŠ‚æ•°ç»„
                    document.write(out);
                    return out.toByteArray();
                }
            } catch (Exception e) {
                throw new RuntimeException("ç”Ÿæˆ Word æ–‡æ¡£å¤±è´¥", e);
            }
        }
    
        /**
         * æ›¿æ¢æ®µè½ä¸­çš„å ä½ç¬¦
         */
        private void replaceInParagraphs(List<XWPFParagraph> paragraphs, Map<String, String> data) {
            for (XWPFParagraph para : paragraphs) {
                for (XWPFRun run : para.getRuns()) {
                    if (run != null && run.getText(0) != null) {
                        String text = run.getText(0);
                        String replaced = replacePlaceholders(text, data);
                        if (!text.equals(replaced)) {
                            run.setText(replaced, 0);
                        }
                    }
                }
            }
        }
    
        /**
         * ä½¿ç”¨æ­£åˆ™æ›¿æ¢ ${key} ä¸º value
         */
        private String replacePlaceholders(String text, Map<String, String> data) {
            Pattern pattern = Pattern.compile("\\$\\{([^}]+)\\}");
            Matcher matcher = pattern.matcher(text);
            StringBuffer sb = new StringBuffer();
            while (matcher.find()) {
                String key = matcher.group(1);
                String replacement = data.getOrDefault(key, matcher.group(0)); // æœªæ‰¾åˆ°åˆ™ä¿ç•™åŸæ ·
                matcher.appendReplacement(sb, replacement == null ? "" : Matcher.quoteReplacement(replacement));
            }
            matcher.appendTail(sb);
            return sb.toString();
        }
    
        private String safeStr(String str) {
            return str == null ? "" : str;
        }
    }
    

  

äº”ã€æ³¨æ„äº‹é¡¹
------

### âš ï¸ **1ã€å ä½ç¬¦è¢«æ‹†åˆ†é—®é¢˜ï¼ˆæœªèƒ½æ­£ç¡®æ˜¾ç¤ºæ•°å€¼ï¼‰**

Word ä¼šå› æ ¼å¼å˜åŒ–å°† `${NO}` æ‹†æˆå¤šä¸ª `Run`ï¼ˆå¦‚ `${N` + `O}`ï¼‰ï¼Œå¯¼è‡´æ— æ³•åŒ¹é…ã€‚è¿™é‡Œä¸è¦ç”¨æ–‡æœ¬æ¡†æˆ–è‰ºæœ¯å­—ç­‰

Apache POI åœ¨è¯»å– Word æ–‡æ¡£æ—¶ï¼Œä¼šå°†æ–‡æœ¬æŒ‰æ ¼å¼ï¼ˆå­—ä½“ã€é¢œè‰²ã€åŠ ç²—ç­‰ï¼‰æ‹†åˆ†æˆå¤šä¸ª **`XWPFRun`** å¯¹è±¡ã€‚

ä¾‹å¦‚ä¸‹é¢å›¾ç‰‡ï¼Œç¼–å·æœªèƒ½æ­£ç¡®æ˜¾ç¤º

![image-20251029163259173](https://img2024.cnblogs.com/blog/2719585/202510/2719585-20251029165832778-1129694254.png)

**âŒ é—®é¢˜åœºæ™¯ï¼š**

å¦‚æœåœ¨ Word ä¸­è¾“å…¥ `${NO}` æ—¶ï¼š

*   ä¸­é—´ä¸å°å¿ƒæŒ‰äº†æ–¹å‘é”®ã€ç©ºæ ¼ã€Backspace
*   æˆ–å¯¹éƒ¨åˆ†å­—ç¬¦è®¾ç½®äº†æ ¼å¼ï¼ˆæ¯”å¦‚åªåŠ ç²—äº† `N`ï¼‰
*   æˆ–ä»å…¶ä»–åœ°æ–¹å¤åˆ¶ç²˜è´´è¿‡æ¥

é‚£ä¹ˆ Word å†…éƒ¨å¯èƒ½å­˜å‚¨ä¸ºï¼š

    Run1: "${N"
    Run2: "O}"
    

è€Œæ›¿æ¢é€»è¾‘æ˜¯ **é€ `Run` å¤„ç†**ï¼š

    for (XWPFRun run : para.getRuns()) {
        String text = run.getText(0); // åªæ‹¿åˆ° "${N" æˆ– "O}"
        // æ— æ³•åŒ¹é…å®Œæ•´ "${NO}"
    }
    

â†’ **ç»“æœï¼š`${NO}` æ²¡æœ‰è¢«è¯†åˆ«ï¼Œä¹Ÿå°±ä¸ä¼šè¢«æ›¿æ¢ï¼**

è€Œå…¶ä»–å ä½ç¬¦ï¼ˆå¦‚ `${SJBBH}`ï¼‰å¯èƒ½æ˜¯ä¸€æ¬¡æ€§è¾“å…¥çš„ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ª `Run` é‡Œï¼Œèƒ½æ­£å¸¸æ›¿æ¢ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

*   **åœ¨æ¨¡æ¿ä¸­ä¸€æ¬¡æ€§è¾“å…¥å®Œæ•´å ä½ç¬¦ï¼Œé¿å…ä¸­é€”æ ¼å¼è°ƒæ•´ã€‚ï¼ˆä¸è¦ä¸­é€”æŒ‰æ–¹å‘é”®ã€ä¸è¦è®¾ç½®å±€éƒ¨æ ¼å¼ï¼‰**
    
    > ğŸ’¡ æŠ€å·§ï¼šå¯ä»¥å…ˆè¾“å…¥ `ABC`ï¼Œç¡®è®¤å®ƒåœ¨ä¸€ä¸ª Run é‡Œï¼ˆæ¯”å¦‚å…¨é€‰åç»Ÿä¸€åŠ ç²—ï¼‰ï¼Œå†æ›¿æ¢æˆ `${NO}`ã€‚
    
*   **æˆ–ä½¿ç”¨æ›´é«˜çº§çš„è·¨ `Run` åˆå¹¶æ›¿æ¢ç®—æ³•ï¼ˆå®ç°å¤æ‚ï¼‰ã€‚**
    
    å½“å‰é€»è¾‘åªå¤„ç†å•ä¸ª Runï¼Œæ— æ³•å¤„ç†è¢«æ‹†åˆ†çš„å ä½ç¬¦ã€‚å¯ä»¥æ”¹ç”¨æ›´å¥å£®çš„æ–¹æ¡ˆï¼š
    
    æ–¹æ¡ˆ Aï¼šåˆå¹¶æ®µè½æ‰€æœ‰æ–‡æœ¬ï¼Œæ•´ä½“æ›¿æ¢ï¼ˆç®€å•ä½†ä¼šä¸¢å¤±æ ¼å¼ï¼Œä¸æ¨èï¼Œä¼šç ´ååŸæœ‰æ ·å¼ï¼‰
    
    æ–¹æ¡ˆ Bï¼šä½¿ç”¨é€’å½’æˆ–ç¼“å†²åŒºæ‹¼æ¥ Runï¼ˆå¤æ‚ï¼‰ï¼Œä½†å¯¹å¤§å¤šæ•°é¡¹ç›®æ¥è¯´ï¼Œ**æ–¹æ³• 1ï¼ˆè§„èŒƒæ¨¡æ¿è¾“å…¥ï¼‰æ˜¯æœ€é«˜æ•ˆã€æœ€å¯é çš„**ã€‚
    

ğŸ”§ **è°ƒè¯•æŠ€å·§**ï¼šå¦‚æœæ›¿æ¢å¤±è´¥ï¼Œå¯ä¸´æ—¶æ‰“å° `run.getText(0)` æŸ¥çœ‹å®é™…æ–‡æœ¬åˆ†æ®µã€‚

*   **æ¬¡è¦å¯èƒ½åŸå› æ’æŸ¥**
    
    *   ### âœ… 1. æ£€æŸ¥ Java å®ä½“ç±»å­—æ®µæ˜¯å¦æ­£ç¡®
        
    *   ### 2\. æ£€æŸ¥ Word æ¨¡æ¿ä¸­æ˜¯å¦çœŸçš„æ˜¯ `${NO}`ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰
        
    *   ### æ£€æŸ¥æ˜¯å¦åœ¨è¡¨æ ¼ or æ®µè½ä¸­ï¼Ÿ
        

* * *

### âš ï¸**2ã€ä½¿ç”¨æ–¹å¼ä¸€ï¼Œè¿”å›çš„æ˜¯zipæ–‡ä»¶è€Œä¸æ˜¯word æ–‡ä»¶**

æ ¸å¿ƒåŸå› ï¼š

**`.docx` æ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª ZIP å‹ç¼©åŒ…**ï¼

*   Microsoft Office 2007 åŠä»¥åçš„ `.docx`ã€`.xlsx`ã€`.pptx` æ–‡ä»¶éƒ½é‡‡ç”¨ **Open XML æ ¼å¼**ã€‚
*   è¿™ç§æ ¼å¼å®é™…ä¸Šæ˜¯å°† XMLã€å›¾ç‰‡ã€æ ·å¼ç­‰æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª **ZIP å‹ç¼©åŒ…**ï¼Œåªæ˜¯æ‰©å±•åæ”¹æˆäº† `.docx`ã€‚
*   å½“ç”¨ä»£ç ç”Ÿæˆ.docxä½†æ²¡æœ‰æ­£ç¡®è®¾ç½® HTTP å“åº”å¤´ï¼ˆContent-Type å’Œ Content-Dispositionï¼‰
    *   æµè§ˆå™¨æ— æ³•è¯†åˆ«è¿™æ˜¯ Word æ–‡æ¡£
    *   ä¼šæ ¹æ®æ–‡ä»¶å†…å®¹çš„â€œçœŸå®ç±»å‹â€ï¼ˆZIPï¼‰æ¥å¤„ç†
    *   äºæ˜¯**è‡ªåŠ¨ä¸‹è½½ä¸º `.zip` æ–‡ä»¶**ï¼Œæˆ–æç¤ºâ€œæ–‡ä»¶æŸåâ€

**è§£å†³æ–¹æ¡ˆ**ï¼š

*   è®¾ç½®æ­£ç¡®çš„å“åº”å¤´

    HttpHeaders headers = new HttpHeaders();
    
    // 1. è®¾ç½® Content-Typeï¼ˆMIME ç±»å‹ï¼‰
    headers.setContentType(MediaType.parseMediaType("application/vnd.openxmlformats-officedocument.wordprocessingml.document"));
    
    // 2. è®¾ç½® Content-Dispositionï¼ˆå‘Šè¯‰æµè§ˆå™¨è¿™æ˜¯é™„ä»¶ï¼Œä¸”æ–‡ä»¶åæ˜¯ .docxï¼‰
    headers.setContentDispositionFormData("attachment", "ç”Ÿäº§ä»»åŠ¡å•.docx");
    
    return new ResponseEntity<>(docBytes, headers, HttpStatus.OK);
    

**âŒ å¸¸è§é”™è¯¯å†™æ³•ï¼ˆä¼šå¯¼è‡´ ZIP ä¸‹è½½ï¼‰ï¼š**

    // é”™è¯¯1ï¼šContent-Type å†™æˆ application/zip æˆ– application/octet-stream
    headers.setContentType(MediaType.APPLICATION_OCTET_STREAM); // âŒ
    
    // é”™è¯¯2ï¼šæ–‡ä»¶åæ²¡æœ‰ .docx åç¼€
    headers.setContentDispositionFormData("attachment", "report"); // âŒ ä¸‹è½½ä¸º report.zip
    
    // é”™è¯¯3ï¼šæ–‡ä»¶ååŒ…å«éæ³•å­—ç¬¦ï¼ˆå¦‚ / \ : * ? " < > |ï¼‰
    headers.setContentDispositionFormData("attachment", "ç”Ÿäº§/ä»»åŠ¡å•.docx"); // âŒ å¯èƒ½è¢«æˆªæ–­æˆ–å˜ ZIP
    

ğŸ”§ é¢å¤–æ£€æŸ¥ç‚¹ï¼š

1.  **ç¡®è®¤ç”Ÿæˆçš„å­—èŠ‚æ•°ç»„ç¡®å®æ˜¯åˆæ³• `.docx`**
    
    *   å°† `docBytes` ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ï¼š`Files.write(Paths.get("test.docx"), docBytes);`
    *   ç”¨ Word èƒ½æ­£å¸¸æ‰“å¼€å—ï¼Ÿå¦‚æœæ‰“ä¸å¼€ â†’ è¯´æ˜ç”Ÿæˆé€»è¾‘æœ‰è¯¯ï¼ˆä¸æ˜¯ ZIP é—®é¢˜ï¼Œæ˜¯æ–‡ä»¶æŸåï¼‰
2.  **ä¸è¦ç”¨ `application/zip` æˆ– `application/octet-stream`**  
    å³ä½¿å†…å®¹æ˜¯ ZIP ç»“æ„ï¼Œä¹Ÿå¿…é¡»å£°æ˜ä¸º Word çš„ MIME ç±»å‹ï¼
    

* * *

### âš ï¸**3ã€ä½¿ç”¨æµè§ˆå™¨ç›´æ¥è¯·æ±‚æŠ¥é”™**

æŠ¥é”™ç¤ºä¾‹ï¼š

    java.lang.IllegalArgumentException: The Unicode character [ç”Ÿ] at code point [29,983] cannot be encoded as it is outside the permitted range of 0 to 255
    

**æ ¹æœ¬åŸå› **ï¼š  
åœ¨è®¾ç½® HTTP å“åº”å¤´ï¼ˆç‰¹åˆ«æ˜¯ `Content-Disposition` æ–‡ä»¶åï¼‰æ—¶ï¼Œ**ç›´æ¥ä½¿ç”¨äº†åŒ…å«ä¸­æ–‡å­—ç¬¦ï¼ˆå¦‚â€œç”Ÿäº§ä»»åŠ¡å•.docxâ€ï¼‰çš„å­—ç¬¦ä¸²**ï¼Œè€Œ Tomcat åœ¨å¤„ç† HTTP å“åº”å¤´æ—¶ï¼Œé»˜è®¤ä½¿ç”¨ **ISO-8859-1 ç¼–ç **ï¼ˆåªæ”¯æŒ 0â€“255 çš„å­—èŠ‚èŒƒå›´ï¼‰ï¼Œæ— æ³•è¡¨ç¤ºä¸­æ–‡å­—ç¬¦ï¼ˆUnicode è¶…å‡º 255ï¼‰ï¼Œäºæ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚

âœ… æ­£ç¡®è§£å†³æ–¹æ¡ˆï¼šå¯¹æ–‡ä»¶åè¿›è¡Œ **RFC 5987 / RFC 2231 å…¼å®¹çš„ç¼–ç **

HTTP åè®®è§„å®šï¼š**å“åº”å¤´ä¸­çš„é ASCII å­—ç¬¦å¿…é¡»è¿›è¡Œç¼–ç **ã€‚æ¨èä½¿ç”¨ **`filename\*` è¯­æ³•ï¼ˆå¸¦ç¼–ç å£°æ˜ï¼‰**ã€‚

    // è®¾ç½®æ­£ç¡®çš„ Content-Type
        response.setContentType("application/vnd.openxmlformats-officedocument.wordprocessingml.document");
        response.setContentLength(docBytes.length);
    
        // âœ… å®‰å…¨è®¾ç½®å¸¦ä¸­æ–‡çš„æ–‡ä»¶åï¼ˆå…³é”®ï¼ï¼‰
        String filename = "ç”Ÿäº§ä»»åŠ¡å•_" + id + ".docx";
        String encodedFilename = URLEncoder.encode(filename, StandardCharsets.UTF_8).replace("+", "%20");
    
        // ä½¿ç”¨ filename* è¯­æ³•ï¼ˆRFC 5987ï¼‰ï¼šæ”¯æŒ UTF-8 æ–‡ä»¶å
        response.setHeader("Content-Disposition",
            "attachment; filename=\"" + encodedFilename + "\"; filename*=UTF-8''" + encodedFilename);
    
        // å†™å…¥å“åº”ä½“
        response.getOutputStream().write(docBytes);
        response.getOutputStream().flush();
    
    

  

å…­ã€æ¥å£éªŒè¯
------

å¯ä»¥è®¿é—®æ¥å£ï¼š[http://127.0.0.1:8199/api/generate-word2?no=27202SCRW250006](http://127.0.0.1:8199/api/generate-word2?no=27202SCRW250006)

è¿™æ ·ä½ çš„æµè§ˆå™¨å°±ä¼šå¼¹å‡ºä¸‹è½½é¡µé¢ï¼Œå¹¶ä¸”è·å–ä¸€ä¸ªå¡«å……æ•°æ®çš„word æ–‡æ¡£

![image-20251029164051702](https://img2024.cnblogs.com/blog/2719585/202510/2719585-20251029165906142-91108606.png)