---
layout: post
title: '（原创）[开源][.Net Standard 2.0]  SimpleMMF （进程间通信框架）更新 v1.1，极低CPU占用'
date: "2025-01-20T00:36:08Z"
---
（原创）\[开源\]\[.Net Standard 2.0\] SimpleMMF （进程间通信框架）更新 v1.1，极低CPU占用
==================================================================

一、前言
====

在上一篇 [（原创）\[.Net\] 进程间通信框架（基于共享内存）——SimpleMMF](https://www.cnblogs.com/lesliexin/p/15106309.html) 中，发布了v1.0版，最大的问题是：**CPU占用较高，至少40-50%**。  
这既与我的开发水平有关，也与SimpleMMF诞生环境有关，这个主要是用在数字孪生各软件之间同步数据，而部署软件的工作站性能都强悍，像我常用的便是一个有着192GB内存的工作站，CPU的具体型号忘了。  
再加上相关的软件一个比一个吃资源，所以也不差SimpleMMF这一个。

但是，毕竟不完善，这几年间也时间有人发邮件说此问题，同时也反馈.net 4.8的版本也较低，也有人发了提升了.net版本及优化的工程，既然SimpleMMF不止我用，还在发挥作用，趁近期得空，好好的优化一版。

**相信看完的你，一定会有所收获！**

本文地址：[https://www.cnblogs.com/lesliexin/p/18676994](https://www.cnblogs.com/lesliexin/p/18676994)

二、开源地址
======

SimpleMMF 是开源的，开源地址如下：

GitHub:  
[https://github.com/lesliexinxin/LeslieXin.SimpleMMF](https://github.com/lesliexinxin/LeslieXin.SimpleMMF)

Gitee:  
[https://gitee.com/lesliexin/lesliexin.simplemmf](https://gitee.com/lesliexin/lesliexin.simplemmf)

同时v1.1也上传到了NuGet上，地址如下：  
[https://www.nuget.org/packages/LeslieXin.SimpleMMF](https://www.nuget.org/packages/LeslieXin.SimpleMMF)

三、优化内容
======

本节是本文的核心，优化主要分两部分：  
1，.Net框架版本低的问题。  
2，CPU占用高的问题。  
我们下面分别来看。

1，.Net框架版本低的问题
--------------

V1.0的版本是基于 .Net 4.5 开发的，为了兼容更广，特别是支持.Net Core、.Net6\\7\\8\\9，必然要做调整。

经过对比选型，决定使用 .Net Standard 2.0 进行开发，因为它支持的范围更广，如图所示：

![](https://img2024.cnblogs.com/blog/1686429/202501/1686429-20250117151800344-1321903438.png)

如此一来，本问题也就解决了。

2，CPU占用高的问题
-----------

这个问题的根源，在于代码中使用轮询的方式，去监测共享内存状态，这样便会导致空转过快，进而导致CPU占用提升。

而优化方法，便是使用 **命名事件** ，MSDN上的解释如下：  
（[https://learn.microsoft.com/zh-cn/dotnet/standard/threading/eventwaithandle）](https://learn.microsoft.com/zh-cn/dotnet/standard/threading/eventwaithandle%EF%BC%89)  
![](https://img2024.cnblogs.com/blog/1686429/202501/1686429-20250117160759172-690917223.png)

因为有**命名事件**的参与，所以就不需要3个共享内存块了，只需要一个用来存储数据即可。

四、效果显示
======

演示Demo已开源：

GitHub:  
[https://github.com/lesliexinxin/Demo\_SimpleMMF](https://github.com/lesliexinxin/Demo_SimpleMMF)

Gitee:  
[https://gitee.com/lesliexin/demo-simplemmf](https://gitee.com/lesliexin/demo-simplemmf)

请看下面的录屏，主要便是看CPU的占用与变化。

五、结语
====

技术没有新旧之分同，只有合不合适之分。  
感谢的大家的观看与学习，如有错误欢迎批评指正。