---
layout: post
title: 'MAFå¿«é€Ÿå…¥é—¨ï¼ˆ14ï¼‰å¿«é€Ÿé›†æˆA2A Agent'
date: "2026-02-05T00:57:51Z"
---
MAFå¿«é€Ÿå…¥é—¨ï¼ˆ14ï¼‰å¿«é€Ÿé›†æˆA2A Agent
========================

![MAFå¿«é€Ÿå…¥é—¨ï¼ˆ14ï¼‰å¿«é€Ÿé›†æˆA2A Agent](https://img2024.cnblogs.com/blog/381412/202602/381412-20260204221255430-336185513.png) A2A å³ Agent-to-Agentï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯â€œæ™ºèƒ½ä»£ç†ä¹‹é—´çš„åè®®â€ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªå¤§æ¨¡å‹Agentä»¬ç”¨æ¥â€œèŠå¤©â€çš„â€œé€šç”¨è¯­è¨€â€ã€‚æœ¬æ–‡ä»‹ç»äº†MAFä¸­é›†æˆA2A Agentçš„æ ¸å¿ƒæ“ä½œï¼šå°†A2A Agentè½¬æ¢ä¸ºAIFunctionå·¥å…·ï¼Œç„¶åç”±ä¸»Agentè‡ªä¸»é€‰æ‹©è°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ªA2A Agentè·å–ä¿¡æ¯æ•´åˆåæœ€ç»ˆç”Ÿæˆå›ç­”ã€‚

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Edisonã€‚

æœ€è¿‘æˆ‘ä¸€ç›´åœ¨è·Ÿç€åœ£æ°çš„ã€Š[.NET+AIæ™ºèƒ½ä½“å¼€å‘è¿›é˜¶](https://mp.weixin.qq.com/s?__biz=MzA4NzQzNTg4Ng==&mid=2651744458&idx=1&sn=139f7584e81aeecd0945133bdc2b4791&scene=21#wechat_redirect)ã€‹è¯¾ç¨‹å­¦ä¹ MAFå¼€å‘å¤šæ™ºèƒ½ä½“å·¥ä½œæµï¼Œæˆ‘å¼ºçƒˆæ¨èä½ ä¹Ÿä¸Šè½¦è·Ÿæˆ‘ä¸€èµ·å‡ºå‘ï¼

[ä¸Šä¸€ç¯‡](https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper13)ï¼Œæˆ‘ä»¬å­¦ä¹ äº†MAFä¸­å¸¸è§çš„å¤šæ™ºèƒ½ä½“ç¼–æ’æ¨¡å¼ã€‚æœ¬ç¯‡ï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸‹åœ¨MAFä¸­å¦‚ä½•å¿«é€Ÿé›†æˆA2A (Agent to Agent)ã€‚

1 A2Aåè®®ä»‹ç»
=========

åœ¨ä¹‹å‰çš„ç³»åˆ—æ–‡ç« ä¸­æˆ‘ä»¬å…¶å®å·²ç»ä»‹ç»è¿‡A2Aåè®®äº†ï¼Œè¿™é‡Œæˆ‘ä»¬å¿«é€Ÿæ¸©ä¹ ä¸€ä¸‹ã€‚A2A å³ Agent-to-Agentï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯â€œæ™ºèƒ½ä»£ç†ä¹‹é—´çš„åè®®â€ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå®ƒå°±æ˜¯ä¸€ä¸ªå¤§æ¨¡å‹Agentä»¬ç”¨æ¥â€œèŠå¤©â€çš„â€œé€šç”¨è¯­è¨€â€ã€‚

![image](https://img2024.cnblogs.com/blog/381412/202602/381412-20260204220340896-177118451.png)

A2Aå®šä¹‰äº†ä¸€å¥—æ¸…æ™°ã€æ ‡å‡†çš„æ²Ÿé€šæ–¹å¼ï¼Œè®©Agentä»¬å¯ä»¥é¡ºç•…åœ°äº¤æµï¼Œè®©ä¸åŒå¹³å°å’Œæ¡†æ¶ä¸‹çš„Agentéƒ½èƒ½å¤Ÿè¯´â€œåŒä¸€ç§è¯â€ï¼Œå®ç°æ— éšœç¢çš„ä¿¡æ¯äº¤æ¢å’Œåä½œã€‚

æ›´å¤šå…³äºA2Aåè®®çš„å†…å®¹ï¼š

*   ****[å¤šAgentåä½œå…¥é—¨ï¼šåŸºäºA2Aåè®®çš„Agenté€šä¿¡ï¼ˆä¸Šï¼‰](https://www.cnblogs.com/edisontalk/p/-/quick-start-agent-to-agent-part01)****
*   ****[å¤šAgentåä½œå…¥é—¨ï¼šåŸºäºA2Aåè®®çš„Agenté€šä¿¡ï¼ˆä¸­ï¼‰](https://www.cnblogs.com/edisontalk/p/-/quick-start-agent-to-agent-part02)****

**2 å°†A2A Agentå°è£…ä¸ºTool**
=======================

åœ¨MAFé›†æˆA2A Agentï¼Œæœ€ä¸»è¦çš„æ“ä½œå°±æ˜¯ï¼š**å°†A2A Agentå°è£…ä¸ºä¸€ä¸ªTool**ï¼Œè¿™ä¸ªToolå¯¹åº”åˆ°MAFä¸­å°±æ˜¯ä¸€ä¸ª**AIFunction**å¯¹è±¡ã€‚

å‰é¢æˆ‘ä»¬æåˆ°å¯ä»¥å°†MCPæœåŠ¡ä¹Ÿå°è£…ä¸ºä¸€ä¸ªToolï¼ˆAIFunctionï¼‰è®©Agentè°ƒç”¨ï¼Œè¿™é‡ŒA2A Agentä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ã€‚

è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š**è®©MAFä¸­çš„Agentåƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·è°ƒç”¨è¿œç¨‹A2A AgentÂ æˆ– MCP Server**ã€‚

ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†åœ¨MAFä¸­å°†A2A Cardè½¬æ¢ä¸ºAgentï¼Œç„¶åå†å°†Agentè½¬æ¢ä¸ºAIFunctionï¼š

......
var functionTools = new List<AIFunction>();
foreach (var endpoint in agentEndpoints)
{
    var resolver = new A2ACardResolver(new Uri(endpoint));
    var card = await resolver.GetAgentCardAsync();
    var agent = card.AsAIAgent(); // Convert A2A Agent to AIAgent instance
    functionTools.AddRange(AgentFunctionHelper.CreateFunctionTools(agent, card));
}
......

ä¸‹é¢æ˜¯AgentFunctionHelperç±»çš„ä»£ç å®ç°ï¼š

public class AgentFunctionHelper
{
    public static IEnumerable<AIFunction> CreateFunctionTools(AIAgent a2aAgent, AgentCard agentCard)
    {
        foreach (var skill in agentCard.Skills)
        {
            AIFunctionFactoryOptions options \= new()
            {
                Name \= Sanitize(skill.Id),
                Description \= $$"""
                {
                    "description": "{{skill.Description}}",
                    "tags": "\[{{string.Join(", ", skill.Tags ?? \[\])}}\]",
                    "examples": "\[{{string.Join(", ", skill.Examples ?? \[\])}}\]",
                    "inputModes": "\[{{string.Join(", ", skill.InputModes ?? \[\])}}\]",
                    "outputModes": "\[{{string.Join(", ", skill.OutputModes ?? \[\])}}\]"
                }
                """,
            };

            yield return AIFunctionFactory.Create(RunAgentAsync, options);
        }

        async Task<string\> RunAgentAsync(string input, CancellationToken cancellationToken)
        {
            var response = await a2aAgent.RunAsync(input, cancellationToken: cancellationToken).ConfigureAwait(false);

            return response.Text;
        }
    }

    private static readonly Regex InvalidNameCharsRegex = new Regex("\[^0-9A-Za-z\]+", RegexOptions.Compiled);

    public staticstringSanitize(string name)
    {
        return InvalidNameCharsRegex.Replace(name, "\_");
    }
}

å…¶ä¸­çš„CreateFunctionToolsæ–¹æ³•å®ç°äº†å°†A2A Agentçš„æ‰€æœ‰å…¬å¼€æŠ€èƒ½è½¬æ¢ä¸ºAIFunctionå·¥å…·ã€‚

è€ŒSanitizeæ–¹æ³•åˆ™å®ç°äº†å‡½æ•°åç§°çš„è§„èŒƒåŒ–ï¼Œå› ä¸ºAIFunctionçš„åç§°å¿…é¡»ç¬¦åˆä¸€å®šè§„èŒƒï¼ˆä»…é™å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼‰ï¼Œå› æ­¤éœ€è¦ä¸»åŠ¨å¯¹æŠ€èƒ½åç§°è¿›è¡Œè§„èŒƒåŒ–ã€‚

****3 å®Œæ•´é›†æˆç¤ºä¾‹****
================

è¿™æ¬¡æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ä¸Šæ¬¡æ–‡ç« ä¸­çš„æ¡ˆä¾‹ï¼Œå³ä¸€ä¸ªæ—…æ¸¸åŠ©æ‰‹ï¼Œå®ƒå¯ä»¥é€šè¿‡A2Aåè®®è°ƒç”¨å¤šä¸ªAgentçš„æŠ€èƒ½ã€‚

![image](https://img2024.cnblogs.com/blog/381412/202602/381412-20260204220618986-812169228.png)

æˆ‘ä»¬éœ€è¦åˆ›å»ºå››ä¸ª.NETé¡¹ç›®ï¼Œå…¶ä¸­ï¼š

*   1ä¸ª.NETæ§åˆ¶å°é¡¹ç›®ï¼šä¸»åŠ©æ‰‹
    
*   3ä¸ªASP.NET Webé¡¹ç›®ï¼šå¤©æ°”æ™ºèƒ½ä½“ã€é…’åº—æ™ºèƒ½ä½“ã€è·¯çº¿æ™ºèƒ½ä½“
    

åœ¨VSä¸­çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

![image](https://img2024.cnblogs.com/blog/381412/202602/381412-20260204220634044-600923620.png)

æœ¬æ¬¡æ¡ˆä¾‹æˆ‘ä»¬å¸Œæœ›å®ç°ä¸»åŠ©æ‰‹å¯ä»¥å›ç­”ç”¨æˆ·å…³äºä¸åŒä¸»é¢˜ï¼ˆæ™¯ç‚¹ï¼Œé…’åº—ï¼Œå¤©æ°”ï¼‰çš„é—®é¢˜ï¼Œå®ƒå¯ä»¥æ ¹æ®é—®é¢˜è‡ªä¸»é€‰æ‹©éœ€è¦è°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ªAgentå»è·å–å¿…è¦çš„ä¿¡æ¯åè¿›è¡Œæ•´åˆä¼˜åŒ–åå†å›å¤ç”¨æˆ·ã€‚

### 3.1 å¤©æ°”Agent

æ·»åŠ NuGetåŒ…ï¼Œåç»­A2A Agenté¡¹ç›®éƒ½éœ€è¦å®‰è£…æ­¤åŒ…ï¼Œä¸å†èµ˜è¿°ï¼š

A2A.AspNetCore

åˆ›å»ºä¸€ä¸ª WeatherAgentç±»ï¼Œå®šä¹‰å…¶èƒ½åŠ› å’Œ AgentCardï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å…¬å¼€ä¸€ä¸ªAgentSkillå³å¤©æ°”æŸ¥è¯¢çš„èƒ½åŠ›ï¼š

public class WeatherAgent
{
    public void Attach(ITaskManager taskManager)
    {
        taskManager.OnMessageReceived \= QueryWeatherAsync;
        taskManager.OnAgentCardQuery \= GetAgentCardAsync;
    }

    private Task<A2AResponse> QueryWeatherAsync(MessageSendParams messageSendParams, CancellationToken cancellationToken)
    {
        if (cancellationToken.IsCancellationRequested)
        {
            return Task.FromCanceled<A2AResponse>(cancellationToken);
        }

        // Process the message
        var messageText = messageSendParams.Message.Parts.OfType<TextPart>().First().Text;

        // Create and return an artifact
        var message = new AgentMessage()
        {
            Role \= MessageRole.Agent,
            MessageId \= Guid.NewGuid().ToString(),
            ContextId \= messageSendParams.Message.ContextId,
            Parts \= \[new TextPart() {
                Text \= $"""
                    ğŸŒ¤ï¸ \*\*å¤©æ°”æŸ¥è¯¢ç»“æœ\*\*

                    æŸ¥è¯¢æ—¶é—´ï¼š{DateTime.Now:yyyy\-MM-dd HH:mm}

                    \*\*åŒ—äº¬å¤©æ°”\*\*
                    - ä»Šæ—¥ï¼šæ™´è½¬å¤šäº‘ï¼Œæ°”æ¸© -2Â°C ~ 8Â°C
                    \- æ˜æ—¥ï¼šå¤šäº‘ï¼Œæ°”æ¸© 0Â°C ~ 10Â°C
                    \- åæ—¥ï¼šé˜´ï¼Œæ°”æ¸© 2Â°C ~ 9Â°C

                    \*\*ä¸Šæµ·å¤©æ°”\*\*
                    - ä»Šæ—¥ï¼šå¤šäº‘ï¼Œæ°”æ¸© 5Â°C ~ 12Â°C
                    \- æ˜æ—¥ï¼šå°é›¨ï¼Œæ°”æ¸© 6Â°C ~ 10Â°C
                    \- åæ—¥ï¼šé˜´è½¬æ™´ï¼Œæ°”æ¸© 4Â°C ~ 11Â°C

                    ğŸ‘” ç©¿è¡£å»ºè®®ï¼šåŒ—äº¬è¾ƒå†·ï¼Œå»ºè®®ç©¿ç¾½ç»’æœï¼›ä¸Šæµ·æ¸©å’Œï¼Œå»ºè®®ç©¿å¤¹å…‹å¤–å¥—ï¼Œå¸¦å¥½é›¨å…·ã€‚
                    """
            }\]
        };

        return Task.FromResult<A2AResponse>(message);
    }

    private Task<AgentCard> GetAgentCardAsync(string agentUrl, CancellationToken cancellationToken)
    {
        if (cancellationToken.IsCancellationRequested)
        {
            return Task.FromCanceled<AgentCard>(cancellationToken);
        }

        var capabilities = new AgentCapabilities()
        {
            Streaming \= true,
            PushNotifications \= false,
        };

        return Task.FromResult(new AgentCard()
        {
            Name \= "weather agent",
            Description \= "weather information agent",
            Url \= agentUrl,
            Version \= "1.0.0",
            DefaultInputModes \= \["text"\],
            DefaultOutputModes \= \["text"\],
            Capabilities \= capabilities,
            Skills \= \[
                new AgentSkill
                {
                    Id \= "weather-query",
                    Name \= "å¤©æ°”æŸ¥è¯¢",
                    Description \= "æŸ¥è¯¢æŒ‡å®šåŸå¸‚çš„å¤©æ°”é¢„æŠ¥ï¼ŒåŒ…æ‹¬æ¸©åº¦ã€é™æ°´æ¦‚ç‡ã€ç©¿è¡£å»ºè®®ç­‰",
                    Tags \= \["weather", "forecast", "climate"\],
                    Examples \= \["ä¸Šæµ·æ˜å¤©å¤©æ°”æ€ä¹ˆæ ·", "æˆéƒ½è¿™å‘¨çš„å¤©æ°”é¢„æŠ¥", "æ­å·ä¸‹é›¨å—"\],
                    InputModes \= \["text"\],
                    OutputModes \= \["text"\]
                }\],
        });
    }
}

è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿æ˜¯ç›´æ¥è¿”å›äº†ä¸€ä¸ªå›ºå®šçš„å¤©æ°”ä¿¡æ¯è¾“å‡ºå†…å®¹ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­å¾€å¾€éœ€è¦è¿›è¡Œå…·ä½“çš„**ä¸šåŠ¡é€»è¾‘å¤„ç†**Â æˆ–Â **è°ƒç”¨å¤§æ¨¡å‹**è¿›è¡Œå¤„ç†ã€‚

ä¸‹é¢çš„å‡ ä¸ªAgentä¹Ÿæ˜¯ç±»ä¼¼çš„æƒ…å†µï¼Œå°±ä¸å†èµ˜è¿°ã€‚ç„¶åï¼Œåœ¨Program.csä¸­è¿›è¡Œæ³¨å†Œï¼Œå®Œæˆç«¯å£æ˜ å°„ï¼š

using A2A;
using A2A.AspNetCore;
using WeatherAgentServer;

var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

var taskManager = new TaskManager();
var agent = new WeatherAgent();
agent.Attach(taskManager);
// Add JSON-RPC endpoint for A2A
app.MapA2A(taskManager, "/weather");
// Add well-known agent card endpoint for A2A
app.MapWellKnownAgentCard(taskManager, "/weather");
// Add HTTP endpoint for A2A
app.MapHttpA2A(taskManager, "/weather");

app.Run();

### 3.2 é…’åº—Agent

åˆ›å»ºä¸€ä¸ªHotelAgentç±»ï¼Œå®šä¹‰å…¶èƒ½åŠ› å’Œ AgentCardï¼š

public class HotelAgent
{
    public void Attach(ITaskManager taskManager)
    {
        taskManager.OnMessageReceived \= QueryHotelsAsync;
        taskManager.OnAgentCardQuery \= GetAgentCardAsync;
    }

    private Task<A2AResponse> QueryHotelsAsync(MessageSendParams messageSendParams, CancellationToken cancellationToken)
    {
        if (cancellationToken.IsCancellationRequested)
        {
            return Task.FromCanceled<A2AResponse>(cancellationToken);
        }

        // Process the message
        var messageText = messageSendParams.Message.Parts.OfType<TextPart>().First().Text;

        // Create and return an artifact
        var message = new AgentMessage()
        {
            Role \= MessageRole.Agent,
            MessageId \= Guid.NewGuid().ToString(),
            ContextId \= messageSendParams.Message.ContextId,
            Parts \= \[new TextPart() {
                Text \= $"""
                    ğŸ¨ \*\*é…’åº—æ¨è\*\*

                    æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œä¸ºæ‚¨æ¨èä»¥ä¸‹é…’åº—ï¼š

                    \*\*è±ªåå‹ â­â­â­â­â­\*\*
                    1. ä¸Šæµ·å¤–æ»©åå°”é“å¤«é…’åº—
                       \- ğŸ“ å¤–æ»©æ ¸å¿ƒä½ç½®ï¼Œæ±Ÿæ™¯æˆ¿
                       \- ğŸ’° Â¥2,500/æ™šèµ·
                       \- â­ è¯„åˆ† 4.9/5.0

                    \*\*èˆ’é€‚å‹ â­â­â­â­\*\*
                    2. ä¸Šæµ·é™å®‰é¦™æ ¼é‡Œæ‹‰å¤§é…’åº—
                       \- ğŸ“ é™å®‰å¯ºå•†åœˆï¼Œäº¤é€šä¾¿åˆ©
                       \- ğŸ’° Â¥1,200/æ™šèµ·
                       \- â­ è¯„åˆ† 4.7/5.0

                    \*\*ç»æµå‹ â­â­â­\*\*
                    3. å…¨å­£é…’åº—ï¼ˆä¸Šæµ·å—äº¬è·¯åº—ï¼‰
                       \- ğŸ“ å—äº¬è·¯æ­¥è¡Œè¡—æ—
                       \- ğŸ’° Â¥380/æ™šèµ·
                       \- â­ è¯„åˆ† 4.5/5.0

                    ğŸ’¡ æç¤ºï¼šå»ºè®®æå‰é¢„è®¢ï¼Œå‘¨æœ«å’ŒèŠ‚å‡æ—¥ä»·æ ¼å¯èƒ½ä¸Šæ¶¨ 20\-50%ã€‚
                    """
            }\]
        };

        return Task.FromResult<A2AResponse>(message);
    }

    private Task<AgentCard> GetAgentCardAsync(string agentUrl, CancellationToken cancellationToken)
    {
        if (cancellationToken.IsCancellationRequested)
        {
            return Task.FromCanceled<AgentCard>(cancellationToken);
        }

        var capabilities = new AgentCapabilities()
        {
            Streaming \= true,
            PushNotifications \= false,
        };

        return Task.FromResult(new AgentCard()
        {
            Name \= "hotel-a2a-agent",
            Description \= "hotel information agent",
            Url \= agentUrl,
            Version \= "1.0.0",
            DefaultInputModes \= \["text"\],
            DefaultOutputModes \= \["text"\],
            Capabilities \= capabilities,
            Skills \= \[
                new AgentSkill
                {
                    Id \= "hotel-recommendation",
                    Name \= "é…’åº—æ¨è",
                    Description \= "æ ¹æ®ç›®çš„åœ°å’Œé¢„ç®—æ¨èåˆé€‚çš„é…’åº—ï¼ŒåŒ…æ‹¬è±ªåå‹ã€èˆ’é€‚å‹ã€ç»æµå‹",
                    Tags \= \["hotel", "accommodation", "booking", "travel"\],
                    Examples \= \["æ¨èä¸Šæµ·çš„é…’åº—", "ä¸Šæµ·å¤–æ»©é™„è¿‘æœ‰ä»€ä¹ˆå¥½é…’åº—", "é¢„ç®—500ä»¥å†…çš„åŒ—äº¬é…’åº—"\],
                    InputModes \= \["text"\],
                    OutputModes \= \["text"\]
                }
                \],
        });
    }
}

åŒæ ·ï¼Œè¯·å‚è€ƒå¤©æ°”Agentå®ŒæˆProgram.csä¸­çš„æ³¨å†Œã€‚

### 3.3 æ™¯ç‚¹Agent

åˆ›å»ºä¸€ä¸ªPlanAgentç±»ï¼Œå®šä¹‰å…¶èƒ½åŠ› å’Œ AgentCardï¼š

public class PlanAgent
{
    public void Attach(ITaskManager taskManager)
    {
        taskManager.OnMessageReceived \= QueryPlansAsync;
        taskManager.OnAgentCardQuery \= GetAgentCardAsync;
    }

    private Task<A2AResponse> QueryPlansAsync(MessageSendParams messageSendParams, CancellationToken cancellationToken)
    {
        if (cancellationToken.IsCancellationRequested)
        {
            return Task.FromCanceled<A2AResponse>(cancellationToken);
        }

        // Process the message
        var messageText = messageSendParams.Message.Parts.OfType<TextPart>().First().Text;

        // Create and return an artifact
        var message = new AgentMessage()
        {
            Role \= MessageRole.Agent,
            MessageId \= Guid.NewGuid().ToString(),
            ContextId \= messageSendParams.Message.ContextId,
            Parts \= \[new TextPart() {
                Text \= $"""
                    ğŸ¡ \*\*æ™¯ç‚¹æ¨è\*\*

                    ä¸ºæ‚¨æ¨èä¸Šæµ·å¿…æ¸¸æ™¯ç‚¹ï¼š

                    \*\*å†å²æ–‡åŒ–ç±»\*\*
                    1. ğŸ›ï¸ å¤–æ»© - æ¬£èµä¸‡å›½å»ºç­‘åšè§ˆç¾¤
                    2. ğŸ¯ è±«å›­ - æ±Ÿå—å¤å…¸å›­æ—ä»£è¡¨
                    3. ğŸ•Œ åŸéšåº™ - å“å°åœ°é“ä¸Šæµ·å°åƒ

                    \*\*ç°ä»£éƒ½å¸‚ç±»\*\*
                    4. ğŸ—¼ ä¸œæ–¹æ˜ç å¡” - ä¸Šæµ·åœ°æ ‡ï¼Œä¿¯ç°æµ¦æ±Ÿä¸¤å²¸
                    5. ğŸŒ† é™†å®¶å˜´ - é‡‘èä¸­å¿ƒï¼Œä¸Šæµ·ä¹‹å·…
                    6. ğŸ›ï¸ å—äº¬è·¯æ­¥è¡Œè¡— - è´­ç‰©å¤©å ‚

                    \*\*æ–‡è‰ºä¼‘é—²ç±»\*\*
                    7. ğŸ¨ ç”°å­åŠ - æ–‡è‰ºå°åº—èšé›†åœ°
                    8. ğŸ“š æ­¦åº·è·¯ - æ¢§æ¡æ ‘ä¸‹çš„æ³•å¼é£æƒ…
                    9. ğŸŒ³ ä¸–çºªå…¬å›­ - åŸå¸‚ç»¿è‚ºï¼Œäº²å­æ¸¸é¦–é€‰

                    ğŸ“… å»ºè®®æ¸¸ç©æ—¶é—´ï¼š3\-4 å¤©å¯è¦†ç›–ä¸»è¦æ™¯ç‚¹
                    """
            }\]
        };

        return Task.FromResult<A2AResponse>(message);
    }

    private Task<AgentCard> GetAgentCardAsync(string agentUrl, CancellationToken cancellationToken)
    {
        if (cancellationToken.IsCancellationRequested)
        {
            return Task.FromCanceled<AgentCard>(cancellationToken);
        }

        var capabilities = new AgentCapabilities()
        {
            Streaming \= true,
            PushNotifications \= false,
        };

        return Task.FromResult(new AgentCard()
        {
            Name \= "plan agent",
            Description \= "travel plan & attraction agent",
            Url \= agentUrl,
            Version \= "1.0.0",
            DefaultInputModes \= \["text"\],
            DefaultOutputModes \= \["text"\],
            Capabilities \= capabilities,
            Skills \= \[
                new AgentSkill
                {
                    Id \= "attraction-recommendation",
                    Name \= "æ™¯ç‚¹æ¨è",
                    Description \= "æ¨èç›®çš„åœ°çš„çƒ­é—¨æ™¯ç‚¹å’Œæ¸¸ç©è·¯çº¿ï¼ŒåŒ…æ‹¬å†å²æ–‡åŒ–ã€ç°ä»£éƒ½å¸‚ã€æ–‡è‰ºä¼‘é—²ç­‰ç±»å‹",
                    Tags \= \["attraction", "sightseeing", "tourism", "travel"\],
                    Examples \= \["ä¸Šæµ·æœ‰ä»€ä¹ˆå¥½ç©çš„", "åŒ—äº¬å¿…å»çš„æ™¯ç‚¹", "æ­å·è¥¿æ¹–æ€ä¹ˆç©"\],
                    InputModes \= \["text"\],
                    OutputModes \= \["text"\]
                }
                \],
        });
    }
}

åŒæ ·ï¼Œè¯·å‚è€ƒå¤©æ°”Agentå®ŒæˆProgram.csä¸­çš„æ³¨å†Œã€‚

### 3.4 ä¸»åŠ©æ‰‹

è¿™é‡Œæˆ‘ä»¬æš‚ä¸”å‘½åä¸ºTravelPlannerClientï¼Œåœ¨è¯¥é¡¹ç›®ä¸­æˆ‘ä»¬éœ€è¦ç”¨åˆ°MAFï¼Œå› æ­¤æˆ‘ä»¬å…ˆå®‰è£…ä¸€ä¸‹ç›¸å…³NuGetåŒ…ï¼š

Microsoft.Extensions.AI.OpenAI
Microsoft.Agents.AI.A2A
Microsoft.Agents.AI.Abstractions
Microsoft.Extensions.AI.Abstractions

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªChatClientä¾›ä¸»åŠ©æ‰‹ä½¿ç”¨ï¼š

var chatClient = new OpenAIClient(
        new ApiKeyCredential(openAIProvider.ApiKey),
        new OpenAIClientOptions { Endpoint = new Uri(openAIProvider.Endpoint) })
    .GetChatClient(openAIProvider.ModelId)
    .AsIChatClient();

å…¶æ¬¡ï¼Œå°†è¿œç¨‹A2A Agentsè½¬æ¢ä¸ºAIFunction Toolsï¼š

var agentEndpoints = new\[\]
{
    "https://localhost:7021/a2a", // hotel agent 
    "https://localhost:7011/a2a", // weather agent
    "https://localhost:7031/a2a" // plan agent
};

// Collecting all AI Tools
var functionTools = new List<AIFunction>();
foreach (var endpoint in agentEndpoints)
{
    var resolver = new A2ACardResolver(new Uri(endpoint));
    var card = await resolver.GetAgentCardAsync();
    var agent = card.AsAIAgent(); // Convert A2A Agent to AIAgent instance
    functionTools.AddRange(AgentFunctionHelper.CreateFunctionTools(agent, card));
}

ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªå¯ä»¥è°ƒç”¨A2A Agentsçš„ä¸»Agentï¼Œè¿™ä¸€æ­¥æ˜¯æ ¸å¿ƒæ‰€åœ¨ï¼š

var mainAgent = new ChatClientAgent(
    chatClient: chatClient,
    instructions: """
    ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½æ—…è¡Œè§„åˆ’åŠ©æ‰‹ã€‚ä½ å¯ä»¥åˆ©ç”¨å¯ç”¨çš„å·¥å…·æ¥å¸®åŠ©ç”¨æˆ·å®Œæˆä»»åŠ¡ã€‚
    å½“ç”¨æˆ·è¯¢é—®æ—¶ï¼Œè¯·ä½¿ç”¨åˆé€‚çš„å·¥å…·è·å–ä¿¡æ¯ï¼Œç„¶åå›å¤ç”¨æˆ·ã€‚
    """,
    tools: \[.. functionTools\]
   );

æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åšä¸‹æµ‹è¯•ï¼š

// ç”¨æˆ·è¯·æ±‚ - æµ‹è¯•ä¸åŒçš„æŠ€èƒ½è°ƒç”¨
var userRequests = new\[\]
{
    "æŸ¥è¯¢ä¸€ä¸‹ä¸Šæµ·çš„å¤©æ°”æƒ…å†µ",
    "æ¨èä¸€ä¸‹ä¸Šæµ·çš„é…’åº—",
    "å¸®æˆ‘è§„åˆ’ä¸€ä¸‹ä»Šæ—¥ä¸Šæµ·çš„ä¸€æ—¥æ¸¸æ™¯ç‚¹ï¼Œå¹¶å‘Šè¯‰æˆ‘è¯¥å¦‚ä½•ç©¿è¡£æœ",
};

foreach (var userRequest in userRequests)
{
    Console.WriteLine("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
    Console.WriteLine($"ğŸ‘¤ ç”¨æˆ·è¯·æ±‚: {userRequest}");
    Console.WriteLine("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

    // æ‰§è¡Œ Agent
    Console.WriteLine("â±ï¸ ä¸» Agent å¤„ç†ä¸­...");
    var response = await mainAgent.RunAsync(userRequest);
    Console.WriteLine($"ğŸ’¬ å›ç­”:\\n{response.Text}");
    Console.WriteLine();
}

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æµ‹è¯•ç»“æœï¼š

******case1ï¼šæŸ¥è¯¢ä¸€ä¸‹ä¸Šæµ·çš„å¤©æ°”æƒ…å†µï¼ˆ******ç®€å•ä»»åŠ¡******ï¼‰******

![image](https://img2024.cnblogs.com/blog/381412/202602/381412-20260204221026757-365275321.png)

å¯ä»¥çœ‹åˆ°ï¼Œä¸»åŠ©æ‰‹é€šè¿‡è°ƒç”¨å¤©æ°”Agentè·å–å¤©æ°”ä¿¡æ¯å®Œæˆäº†å›ç­”ã€‚

****case2ï¼šæ¨èä¸Šæµ·çš„é…’åº—ï¼ˆç®€å•ä»»åŠ¡ï¼‰****

![image](https://img2024.cnblogs.com/blog/381412/202602/381412-20260204221108758-778672394.png)

å¯ä»¥çœ‹åˆ°ï¼Œä¸»åŠ©æ‰‹é€šè¿‡è°ƒç”¨é…’åº—Agentè·å–é…’åº—ä¿¡æ¯å®Œæˆäº†å›ç­”

**********case3ï¼šå¸®æˆ‘è§„åˆ’ä¸€ä¸‹ä»Šæ—¥ä¸Šæµ·çš„ä¸€æ—¥æ¸¸æ™¯ç‚¹ï¼Œå¹¶å‘Šè¯‰æˆ‘è¯¥å¦‚ä½•ç©¿è¡£æœï¼ˆå¤æ‚ä»»åŠ¡ï¼‰**********

![image](https://img2024.cnblogs.com/blog/381412/202602/381412-20260204221128267-114288133.png)

å¯ä»¥çœ‹åˆ°ï¼Œä¸»åŠ©æ‰‹è°ƒç”¨äº†å¤šä¸ªAgentï¼ˆæ™¯ç‚¹Agent å’Œ å¤©æ°”Agentï¼‰è·å–ä¿¡æ¯ï¼Œè¿˜åœ¨æ­¤ä¹‹ä¸Šè¿›è¡Œäº†æ•´åˆä¼˜åŒ–ï¼Œæœ€åè¾“å‡ºäº†å®Œå–„çš„å›å¤ã€‚

4 å°ç»“
====

æœ¬æ–‡ä»‹ç»äº†MAFä¸­é›†æˆA2A Agentçš„æ ¸å¿ƒæ“ä½œï¼šå°†A2A Agentè½¬æ¢ä¸ºAIFunctionå·¥å…·ï¼Œç„¶åç”±ä¸»Agentè‡ªä¸»é€‰æ‹©è°ƒç”¨æœ€ç»ˆç”Ÿæˆå›ç­”ï¼Œå¸Œæœ›æœ¬æ–‡çš„æ¡ˆä¾‹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚

ç¤ºä¾‹æºç 
====

GitHub:Â [https://github.com/EdisonTalk/MAFD](https://github.com/EdisonTalk/MAFD)

å‚è€ƒèµ„æ–™
====

åœ£æ°ï¼Œã€Š[.NET + AI æ™ºèƒ½ä½“å¼€å‘è¿›é˜¶](https://www.cnblogs.com/sheng-jie/p/19200934)ã€‹ï¼ˆæ¨èæŒ‡æ•°ï¼šâ˜…â˜…â˜…â˜…â˜…ï¼‰

Microsoft Learnï¼Œã€Š[Agent Framework Tutorials](https://learn.microsoft.com/en-us/agent-framework/overview/agent-framework-overview?wt.mc_id=MVP_397012)ã€‹

![](https://images.cnblogs.com/cnblogs_com/edisonchou/1647700/o_200902144330EdisonTalk-Footer.jpg)

ä½œè€…ï¼šçˆ±è¿ªç”Ÿ

å‡ºå¤„ï¼š[https://edisontalk.cnblogs.com](https://edisontalk.cnblogs.com "from")

æœ¬æ–‡ç‰ˆæƒå½’ä½œè€…å’Œåšå®¢å›­å…±æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œä¸”åœ¨æ–‡ç« é¡µé¢æ˜æ˜¾ä½ç½®ç»™å‡ºåŸæ–‡é“¾æ¥ã€‚

[![](http://service.t.sina.com.cn/widget/qmd/2068032061/d643d182/10.png)](https://weibo.com/u/2068032061?s=6uyXnP)