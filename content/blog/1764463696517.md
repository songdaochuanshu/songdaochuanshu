---
layout: post
title: 'Kafkaå…¥é—¨ï¼šä»åˆè¯†åˆ°Spring Bootå®æˆ˜'
date: "2025-11-30T00:48:16Z"
---
Kafkaå…¥é—¨ï¼šä»åˆè¯†åˆ°Spring Bootå®æˆ˜
=========================

å›é¡¾å®ŒRabbitMQï¼Œå†è·Ÿæˆ‘ä¸€èµ·å›é¡¾ä¸‹Kafka ~
===========================

ä¸€ã€Kafkaä»‹ç»
---------

### 1\. ä»€ä¹ˆæ˜¯Kafkaï¼Ÿ

Kafkaæ˜¯ç”±Apacheè½¯ä»¶åŸºé‡‘ä¼šå¼€å‘çš„**åˆ†å¸ƒå¼æµå¤„ç†å¹³å°**ï¼Œæœ€åˆç”±LinkedInå…¬å¸è®¾è®¡ï¼Œç°å·²æˆä¸ºå¤§æ•°æ®é¢†åŸŸæ ¸å¿ƒçš„æ¶ˆæ¯ä¸­é—´ä»¶ã€‚å®ƒèƒ½å¤„ç†**å®æ—¶æ•°æ®æµ**ï¼Œæ”¯æŒé«˜ååã€ä½å»¶è¿Ÿã€å¯æ‰©å±•çš„æ¶ˆæ¯ä¼ é€’ï¼Œå¹¿æ³›ç”¨äºæ—¥å¿—æ”¶é›†ã€å®æ—¶åˆ†æã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰åœºæ™¯ã€‚

### 2\. æ ¸å¿ƒç‰¹ç‚¹

*   **é«˜åå**ï¼šå•æœºå¯æ”¯æŒç™¾ä¸‡çº§æ¶ˆæ¯/ç§’ï¼Œé€šè¿‡åˆ†åŒºå¹¶è¡Œå¤„ç†å®ç°ã€‚
*   **æŒä¹…åŒ–**ï¼šæ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ”¯æŒTBçº§æ•°æ®å­˜å‚¨ï¼ˆé»˜è®¤ä¿ç•™7å¤©ï¼‰ã€‚
*   **åˆ†å¸ƒå¼**ï¼šé›†ç¾¤ç”±å¤šä¸ªBrokerï¼ˆæœåŠ¡å™¨ï¼‰ç»„æˆï¼Œæ”¯æŒæ°´å¹³æ‰©å±•ã€‚
*   **å¤šè®¢é˜…è€…**ï¼šä¸€ä¸ªTopicçš„æ¶ˆæ¯å¯è¢«å¤šä¸ªæ¶ˆè´¹è€…ç»„ç‹¬ç«‹æ¶ˆè´¹ï¼ˆå¹¿æ’­/è´Ÿè½½å‡è¡¡ï¼‰ã€‚

äºŒã€Kafkaæ¶æ„ä¸æ ¸å¿ƒç»„ä»¶
--------------

### 1\. æ ¸å¿ƒç»„ä»¶

**ç»„ä»¶**

**ä½œç”¨**

**Broker**

KafkaæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå­˜å‚¨Topicæ•°æ®ï¼Œæ¯ä¸ªBrokeræœ‰å”¯ä¸€IDï¼ˆ`broker.id`ï¼‰ã€‚

**Topic**

æ¶ˆæ¯çš„é€»è¾‘åˆ†ç±»ï¼ˆå¦‚`order-topic`ï¼‰ï¼Œç±»ä¼¼â€œæ¶ˆæ¯é¢‘é“â€ï¼ŒåŒ…å«å¤šä¸ªPartitionã€‚

**Partition**

Topicçš„ç‰©ç†åˆ†ç‰‡ï¼ˆæœ‰åºæ—¥å¿—æ–‡ä»¶ï¼‰ï¼Œåˆ†å¸ƒå¼å­˜å‚¨çš„åŸºæœ¬å•ä½ï¼Œæ¯ä¸ªPartitionæœ‰Leaderå’ŒFollowerå‰¯æœ¬ã€‚

**Producer**

å‘é€æ¶ˆæ¯åˆ°Topicçš„å®¢æˆ·ç«¯ï¼ˆå¦‚è®¢å•æœåŠ¡ï¼‰ã€‚

**Consumer**

ä»Topicè®¢é˜…æ¶ˆæ¯çš„å®¢æˆ·ç«¯ï¼ˆå¦‚åº“å­˜æœåŠ¡ï¼‰ã€‚

**Consumer Group**

æ¶ˆè´¹è€…ç»„ï¼Œç»„å†…å¤šä¸ªæ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡æ¶ˆè´¹Partitionï¼Œç»„é—´ç‹¬ç«‹æ¶ˆè´¹ï¼ˆå¹¿æ’­ï¼‰ã€‚

### 2\. æ¶æ„å›¾ï¼ˆMermaidï¼‰

graph TD subgraph Kafka Cluster Broker1\[Broker 1<br/>broker.id=0<br/>â€¢ TopicA-Partition0 Leader<br/>â€¢ TopicB-Partition1 Follower\] Broker2\[Broker 2<br/>broker.id=1<br/>â€¢ TopicA-Partition1 Leader<br/>â€¢ TopicB-Partition0 Leader\] Broker3\[Broker 3<br/>broker.id=2<br/>â€¢ TopicA-Partition0 Follower\] end ZK\[ZooKeeper<br/>é›†ç¾¤åè°ƒ<br/>å­˜å‚¨å…ƒæ•°æ®\] Producer\[Producer<br/>å‘é€æ¶ˆæ¯åˆ°Topic\] ConsumerGroup\[Consumer Group<br/>ç»„å†…è´Ÿè½½å‡è¡¡æ¶ˆè´¹\] TopicA\[TopicA<br/>â€¢ Partition0<br/>â€¢ Partition1\] Producer -->|å‘é€æ¶ˆæ¯| TopicA TopicA -->|åˆ†åŒºå­˜å‚¨| Broker1 TopicA -->|åˆ†åŒºå­˜å‚¨| Broker2 Broker1 -->|åŒæ­¥æ•°æ®| Broker3 TopicA -->|è´Ÿè½½å‡è¡¡æ¶ˆè´¹| ConsumerGroup ZK -.->|åè°ƒ| Broker1 ZK -.->|åè°ƒ| Broker2 ZK -.->|åè°ƒ| Broker3 ZK -.->|ç®¡ç†æ¶ˆè´¹è€…ç»„| ConsumerGroup

ä¸‰ã€æ¶ˆæ¯æµè½¬å®Œæ•´è·¯å¾„ï¼ˆç”Ÿäº§è€…â†’æ¶ˆè´¹è€…ï¼‰
-------------------

### 1\. æµè½¬æ­¥éª¤

1.  **ç”Ÿäº§è€…å‘é€æ¶ˆæ¯**ï¼šç”Ÿäº§è€…æŒ‡å®šTopicå’ŒKeyï¼ˆå¯é€‰ï¼‰ï¼Œé€šè¿‡åˆ†åŒºå™¨å°†æ¶ˆæ¯åˆ†é…åˆ°Partitionï¼ˆé»˜è®¤æŒ‰Keyå“ˆå¸Œï¼‰ã€‚
2.  **Brokerå­˜å‚¨æ¶ˆæ¯**ï¼šLeaderå‰¯æœ¬æ¥æ”¶æ¶ˆæ¯å¹¶å†™å…¥ç£ç›˜ï¼ˆSegmentæ–‡ä»¶ï¼‰ï¼ŒFollowerå‰¯æœ¬åŒæ­¥æ•°æ®ã€‚
3.  **æ¶ˆè´¹è€…ç»„åˆ†é…Partition**ï¼šæ¶ˆè´¹è€…ç»„å¯åŠ¨æ—¶ï¼Œåè°ƒè€…ï¼ˆCoordinatorï¼‰å°†Topicçš„Partitionåˆ†é…ç»™ç»„å†…æ¶ˆè´¹è€…ï¼ˆä¸€ä¸ªPartitionä»…è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼‰ã€‚
4.  **æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯**ï¼šæ¶ˆè´¹è€…å®šæœŸæ‹‰å–ï¼ˆPollï¼‰åˆ†é…åˆ°çš„Partitionæ¶ˆæ¯ï¼Œå¤„ç†åæäº¤åç§»é‡ï¼ˆOffsetï¼‰ã€‚

### 2\. æ¶ˆæ¯æµè½¬å›¾ç¤ºï¼ˆMermaidï¼‰

sequenceDiagram participant P as Producer participant B as Broker (Leader) participant F as Broker (Follower) participant C as Consumer (Group) Note over P,B: 1. ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ P->>B: å‘é€æ¶ˆæ¯åˆ°Topic-Partition0 (Key: order-1) B->>B: å†™å…¥æœ¬åœ°æ—¥å¿— (LEO=100) B->>F: åŒæ­¥æ¶ˆæ¯ (LEO=100) F->>B: ç¡®è®¤åŒæ­¥ (LEO=100) B->>P: è¿”å›ACK (æ¶ˆæ¯æäº¤æˆåŠŸ) Note over B,C: 2. æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯ C->>B: Pollè¯·æ±‚ (è·å–Partition0æ¶ˆæ¯) B->>C: è¿”å›æ¶ˆæ¯ (Offset=99, Value=è®¢å•æ•°æ®) C->>C: å¤„ç†æ¶ˆæ¯ (æ‰£å‡åº“å­˜) C->>B: æäº¤åç§»é‡ (Offset=100)

å››ã€Kafkaå®‰è£…ï¼ˆZooKeeperä¼ ç»Ÿæ¨¡å¼ï¼ŒCentOS 7ï¼‰
---------------------------------

### 1\. ç¯å¢ƒå‡†å¤‡

*   CentOS 7ç³»ç»Ÿï¼Œå…³é—­é˜²ç«å¢™ï¼ˆæˆ–å¼€æ”¾ç«¯å£2181ã€9092ï¼‰ï¼š
    
        systemctl stop firewalld && systemctl disable firewalld
        
    
*   å®‰è£…JDK 8+ï¼š
    
        yum install java-1.8.0-openjdk-devel -y
        
    

### 2\. å®‰è£…ZooKeeperï¼ˆKafkaä¾èµ–ï¼‰

#### æ­¥éª¤1ï¼šä¸‹è½½å¹¶è§£å‹

    wget https://archive.apache.org/dist/zookeeper/zookeeper-3.7.1/apache-zookeeper-3.7.1-bin.tar.gz
    tar -zxvf apache-zookeeper-3.7.1-bin.tar.gz -C /opt/
    mv /opt/apache-zookeeper-3.7.1-bin /opt/zookeeper
    

#### æ­¥éª¤2ï¼šé…ç½®ZooKeeper

    cd /opt/zookeeper/conf
    cp zoo_sample.cfg zoo.cfg
    vim zoo.cfg  # ä¿®æ”¹ä»¥ä¸‹é…ç½®
    

    dataDir=/var/lib/zookeeper  # æ•°æ®å­˜å‚¨ç›®å½•
    clientPort=2181             # å®¢æˆ·ç«¯ç«¯å£
    

#### æ­¥éª¤3ï¼šå¯åŠ¨ZooKeeper

    mkdir -p /var/lib/zookeeper
    /opt/zookeeper/bin/zkServer.sh start  # å¯åŠ¨
    /opt/zookeeper/bin/zkServer.sh status  # æŸ¥çœ‹çŠ¶æ€ï¼ˆæ˜¾ç¤ºMode: standaloneä¸ºæˆåŠŸï¼‰
    

### 3\. å®‰è£…Kafka Broker

#### æ­¥éª¤1ï¼šä¸‹è½½å¹¶è§£å‹

    wget https://archive.apache.org/dist/kafka/3.6.0/kafka_2.13-3.6.0.tgz
    tar -zxvf kafka_2.13-3.6.0.tgz -C /opt/
    mv /opt/kafka_2.13-3.6.0 /opt/kafka
    

#### æ­¥éª¤2ï¼šé…ç½®Kafka

    cd /opt/kafka/config
    vim server.properties  # ä¿®æ”¹ä»¥ä¸‹é…ç½®
    

    # æ ¸å¿ƒé…ç½®
    broker.id=0                  # å½“å‰Brokerå”¯ä¸€IDï¼ˆé›†ç¾¤ä¸­ä¸å¯é‡å¤ï¼‰
    listeners=PLAINTEXT://localhost:9092  # ç›‘å¬åœ°å€ï¼ˆæœ¬åœ°æµ‹è¯•ç”¨localhostï¼‰
    log.dirs=/var/lib/kafka/logs  # æ¶ˆæ¯å­˜å‚¨ç›®å½•
    zookeeper.connect=localhost:2181/kafka  # è¿æ¥ZooKeeperï¼ˆ/kafkaä¸ºæ ¹èŠ‚ç‚¹ï¼‰
    

#### æ­¥éª¤3ï¼šå¯åŠ¨Kafka

    mkdir -p /var/lib/kafka/logs
    /opt/kafka/bin/kafka-server-start.sh -daemon config/server.properties  # åå°å¯åŠ¨
    jps  # æŸ¥çœ‹è¿›ç¨‹ï¼ˆæ˜¾ç¤ºKafkaä¸ºæˆåŠŸï¼‰
    

### 4\. åˆ›å»ºTopicï¼ˆæµ‹è¯•ç”¨ï¼‰

    /opt/kafka/bin/kafka-topics.sh --create \
      --topic order-topic \          # ä¸»é¢˜åç§°
      --bootstrap-server localhost:9092 \  # Kafkaåœ°å€
      --partitions 3 \               # åˆ†åŒºæ•°ï¼ˆå»ºè®®â‰¥3ï¼‰
      --replication-factor 1         # å‰¯æœ¬æ•°ï¼ˆå•èŠ‚ç‚¹åªèƒ½è®¾1ï¼‰
    

äº”ã€Spring Bootä¿å§†çº§æ¡ˆä¾‹ï¼ˆç”Ÿäº§è€…+æ¶ˆè´¹è€…ï¼‰
---------------------------

### 1\. é¡¹ç›®ç»“æ„

    src/main/java/com/example/kafkademo/
    â”œâ”€â”€ KafkaDemoApplication.java  # å¯åŠ¨ç±»
    â”œâ”€â”€ model/Order.java           # è®¢å•å®ä½“ç±»
    â”œâ”€â”€ producer/OrderProducer.java # ç”Ÿäº§è€…æœåŠ¡
    â”œâ”€â”€ consumer/OrderConsumer.java # æ¶ˆè´¹è€…æœåŠ¡
    â””â”€â”€ controller/OrderController.java # æµ‹è¯•æ¥å£
    src/main/resources/
    â””â”€â”€ application.yml            # é…ç½®æ–‡ä»¶
    

### 2\. pom.xmlä¾èµ–

    <?xml version="1.0" encoding="UTF-8"?>
    <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
        <modelVersion>4.0.0</modelVersion>
        <parent>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-parent</artifactId>
            <version>2.7.15</version> <!-- Spring Boot 2.7.xç¨³å®šç‰ˆ -->
            <relativePath/>
        </parent>
    
        <groupId>com.example</groupId>
        <artifactId>kafka-demo</artifactId>
        <version>0.0.1-SNAPSHOT</version>
        <name>kafka-demo</name>
    
        <dependencies>
            <!-- Webä¾èµ–ï¼ˆæä¾›HTTPæ¥å£ï¼‰ -->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-web</artifactId>
            </dependency>
    
            <!-- Kafkaä¾èµ– -->
            <dependency>
                <groupId>org.springframework.kafka</groupId>
                <artifactId>spring-kafka</artifactId>
            </dependency>
    
            <!-- Lombokï¼ˆç®€åŒ–å®ä½“ç±»ï¼‰ -->
            <dependency>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
                <optional>true</optional>
            </dependency>
        </dependencies>
    
        <build>
            <plugins>
                <plugin>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-maven-plugin</artifactId>
                </plugin>
            </plugins>
        </build>
    </project>
    

### 3\. application.ymlé…ç½®

    server:
      port: 8080  # åº”ç”¨ç«¯å£
    
    spring:
      application:
        name: kafka-demo  # åº”ç”¨åç§°
      kafka:
        bootstrap-servers: localhost:9092  # Kafkaé›†ç¾¤åœ°å€ï¼ˆå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰
        
        # ç”Ÿäº§è€…é…ç½®
        producer:
          key-serializer: org.apache.kafka.common.serialization.StringSerializer  # Keyåºåˆ—åŒ–å™¨ï¼ˆå­—ç¬¦ä¸²ï¼‰
          value-serializer: org.springframework.kafka.support.serialization.JsonSerializer  # Valueåºåˆ—åŒ–å™¨ï¼ˆJSONï¼‰
          acks: all  # æ¶ˆæ¯ç¡®è®¤çº§åˆ«ï¼šall=æ‰€æœ‰ISRå‰¯æœ¬ç¡®è®¤ï¼ˆæœ€é«˜å¯é æ€§ï¼‰
          retries: 3  # å‘é€å¤±è´¥é‡è¯•æ¬¡æ•°
          enable-idempotence: true  # å¯ç”¨å¹‚ç­‰æ€§ï¼ˆé˜²é‡å¤æ¶ˆæ¯ï¼‰
        
        # æ¶ˆè´¹è€…é…ç½®
        consumer:
          group-id: order-group  # æ¶ˆè´¹è€…ç»„IDï¼ˆåŒä¸€ç»„å†…è´Ÿè½½å‡è¡¡ï¼‰
          key-deserializer: org.apache.kafka.common.serialization.StringDeserializer  # Keyååºåˆ—åŒ–å™¨
          value-deserializer: org.springframework.kafka.support.serialization.JsonDeserializer  # Valueååºåˆ—åŒ–å™¨
          auto-offset-reset: earliest  # æ— åç§»é‡æ—¶ç­–ç•¥ï¼šearliest=ä»å¤´æ¶ˆè´¹
          enable-auto-commit: false  # å…³é—­è‡ªåŠ¨æäº¤åç§»é‡ï¼ˆæ‰‹åŠ¨æ§åˆ¶ï¼‰
          properties:
            spring.json.trusted.packages: "com.example.kafkademo.model"  # ä¿¡ä»»çš„å®ä½“ç±»åŒ…ï¼ˆJSONååºåˆ—åŒ–ç”¨ï¼‰
        
        # ç›‘å¬å™¨é…ç½®ï¼ˆæ¶ˆè´¹è€…ï¼‰
        listener:
          ack-mode: manual_immediate  # æ‰‹åŠ¨ç«‹å³æäº¤åç§»é‡ï¼ˆå¤„ç†å®Œä¸€æ¡æäº¤ä¸€æ¡ï¼‰
          concurrency: 3  # å¹¶å‘æ¶ˆè´¹è€…æ•°ï¼ˆå»ºè®®=Topicåˆ†åŒºæ•°ï¼Œæ­¤å¤„3åˆ†åŒºï¼‰
    

### 4\. å®ä½“ç±»ï¼ˆOrder.javaï¼‰

    package com.example.kafkademo.model;
    
    import lombok.AllArgsConstructor;
    import lombok.Data;
    import lombok.NoArgsConstructor;
    import java.math.BigDecimal;
    
    /**
     * è®¢å•å®ä½“ç±»ï¼ˆæ¶ˆæ¯è½½ä½“ï¼‰
     */
    @Data  // Lombokæ³¨è§£ï¼šè‡ªåŠ¨ç”Ÿæˆgetter/setter/toStringç­‰
    @NoArgsConstructor  // æ— å‚æ„é€ 
    @AllArgsConstructor  // å…¨å‚æ„é€ 
    public class Order {
        private String orderId;  // è®¢å•ID
        private String productName;  // å•†å“åç§°
        private BigDecimal amount;  // è®¢å•é‡‘é¢
        private String status;  // è®¢å•çŠ¶æ€ï¼ˆCREATED/PAID/SHIPPEDï¼‰
    }
    

### 5\. ç”Ÿäº§è€…æœåŠ¡ï¼ˆOrderProducer.javaï¼‰

    package com.example.kafkademo.producer;
    
    import com.example.kafkademo.model.Order;
    import lombok.extern.slf4j.Slf4j;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.kafka.core.KafkaTemplate;
    import org.springframework.kafka.support.SendResult;
    import org.springframework.stereotype.Service;
    import org.springframework.util.concurrent.ListenableFuture;
    import org.springframework.util.concurrent.ListenableFutureCallback;
    
    import java.math.BigDecimal;
    import java.util.UUID;
    
    /**
     * è®¢å•ç”Ÿäº§è€…æœåŠ¡ï¼šå‘é€è®¢å•æ¶ˆæ¯åˆ°Kafka
     */
    @Service  // æ ‡è®°ä¸ºSpringæœåŠ¡ç»„ä»¶
    @Slf4j  // Lombokæ—¥å¿—æ³¨è§£
    public class OrderProducer {
    
        // æ³¨å…¥KafkaTemplateï¼ˆSpring Bootè‡ªåŠ¨é…ç½®ï¼Œç”¨äºå‘é€æ¶ˆæ¯ï¼‰
        @Autowired
        private KafkaTemplate<String, Order> kafkaTemplate;
    
        private static final String TOPIC_NAME = "order-topic";  // ç›®æ ‡Topicåç§°ï¼ˆéœ€ä¸æ¶ˆè´¹è€…ä¸€è‡´ï¼‰
    
        /**
         * å‘é€è®¢å•æ¶ˆæ¯
         * @param order è®¢å•å¯¹è±¡ï¼ˆè‹¥ä¸ºnullåˆ™è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•è®¢å•ï¼‰
         */
        public void sendOrder(Order order) {
            // 1. è‹¥è®¢å•IDä¸ºç©ºï¼Œç”ŸæˆUUIDä½œä¸ºè®¢å•ID
            if (order == null) {
                order = new Order();
                order.setOrderId(UUID.randomUUID().toString());  // éšæœºç”Ÿæˆè®¢å•ID
                order.setProductName("æµ‹è¯•å•†å“");  // æµ‹è¯•å•†å“åç§°
                order.setAmount(new BigDecimal("99.99"));  // æµ‹è¯•é‡‘é¢
                order.setStatus("CREATED");  // åˆå§‹çŠ¶æ€ï¼šå·²åˆ›å»º
            }
    
            // 2. å‘é€æ¶ˆæ¯åˆ°Kafkaï¼ˆKey=è®¢å•IDï¼Œç¡®ä¿åŒä¸€è®¢å•è¿›å…¥åŒä¸€Partitionï¼‰
            ListenableFuture<SendResult<String, Order>> future = 
                kafkaTemplate.send(TOPIC_NAME, order.getOrderId(), order);
    
            // 3. å¼‚æ­¥å›è°ƒï¼šå¤„ç†å‘é€ç»“æœï¼ˆæˆåŠŸ/å¤±è´¥ï¼‰
            future.addCallback(new ListenableFutureCallback<SendResult<String, Order>>() {
                @Override
                public void onSuccess(SendResult<String, Order> result) {
                    // å‘é€æˆåŠŸï¼šæ‰“å°æ¶ˆæ¯å…ƒæ•°æ®ï¼ˆTopicã€åˆ†åŒºã€åç§»é‡ï¼‰
                    log.info("è®¢å•å‘é€æˆåŠŸï¼šorderId={}, åˆ†åŒº={}, åç§»é‡={}",
                            order.getOrderId(),
                            result.getRecordMetadata().partition(),
                            result.getRecordMetadata().offset());
                }
    
                @Override
                public void onFailure(Throwable ex) {
                    // å‘é€å¤±è´¥ï¼šæ‰“å°é”™è¯¯ä¿¡æ¯
                    log.error("è®¢å•å‘é€å¤±è´¥ï¼šorderId={}, åŸå› ={}", order.getOrderId(), ex.getMessage());
                }
            });
        }
    }
    

### 6\. æ¶ˆè´¹è€…æœåŠ¡ï¼ˆOrderConsumer.javaï¼‰

    package com.example.kafkademo.consumer;
    
    import com.example.kafkademo.model.Order;
    import lombok.extern.slf4j.Slf4j;
    import org.apache.kafka.clients.consumer.ConsumerRecord;
    import org.springframework.kafka.annotation.KafkaListener;
    import org.springframework.kafka.support.Acknowledgment;
    import org.springframework.stereotype.Service;
    
    /**
     * è®¢å•æ¶ˆè´¹è€…æœåŠ¡ï¼šä»Kafkaæ¥æ”¶å¹¶å¤„ç†è®¢å•æ¶ˆæ¯
     */
    @Service  // æ ‡è®°ä¸ºSpringæœåŠ¡ç»„ä»¶
    @Slf4j  // Lombokæ—¥å¿—æ³¨è§£
    public class OrderConsumer {
    
        /**
         * ç›‘å¬order-topicä¸»é¢˜ï¼Œæ¶ˆè´¹è®¢å•æ¶ˆæ¯
         * @param record æ¶ˆæ¯è®°å½•ï¼ˆåŒ…å«Topicã€åˆ†åŒºã€åç§»é‡ã€æ¶ˆæ¯ä½“ç­‰ï¼‰
         * @param ack æ‰‹åŠ¨æäº¤åç§»é‡çš„å·¥å…·ç±»
         */
        @KafkaListener(topics = "order-topic", groupId = "order-group")  // ç›‘å¬çš„Topicå’Œæ¶ˆè´¹è€…ç»„ID
        public void consumeOrder(ConsumerRecord<String, Order> record, Acknowledgment ack) {
            // 1. è§£ææ¶ˆæ¯ä½“ï¼ˆOrderå¯¹è±¡ï¼‰
            Order order = record.value();
            log.info("æ”¶åˆ°è®¢å•æ¶ˆæ¯ï¼šorderId={}, productName={}, amount={}, status={}, åˆ†åŒº={}, åç§»é‡={}",
                    order.getOrderId(),
                    order.getProductName(),
                    order.getAmount(),
                    order.getStatus(),
                    record.partition(),
                    record.offset());
    
            try {
                // 2. æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†ï¼ˆå¦‚æ‰£å‡åº“å­˜ã€æ›´æ–°è®¢å•çŠ¶æ€ï¼‰
                log.info("å¤„ç†è®¢å•ï¼šorderId={}ï¼Œå¼€å§‹æ‰£å‡åº“å­˜...", order.getOrderId());
                order.setStatus("PAID");  // æ›´æ–°çŠ¶æ€ä¸ºâ€œå·²æ”¯ä»˜â€
                Thread.sleep(500);  // æ¨¡æ‹Ÿå¤„ç†è€—æ—¶
                log.info("è®¢å•å¤„ç†å®Œæˆï¼šorderId={}ï¼ŒçŠ¶æ€æ›´æ–°ä¸º{}", order.getOrderId(), order.getStatus());
    
                // 3. æ‰‹åŠ¨æäº¤åç§»é‡ï¼ˆç¡®è®¤æ¶ˆæ¯å·²å¤„ç†ï¼ŒKafkaä¸å†é‡å¤æŠ•é€’ï¼‰
                ack.acknowledge();
                log.info("åç§»é‡æäº¤æˆåŠŸï¼šorderId={}ï¼Œåˆ†åŒº={}ï¼Œåç§»é‡={}",
                        order.getOrderId(), record.partition(), record.offset());
            } catch (Exception e) {
                log.error("è®¢å•å¤„ç†å¤±è´¥ï¼šorderId={}, åŸå› ={}", order.getOrderId(), e.getMessage());
                // å¤„ç†å¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œè§¦å‘é‡è¯•ï¼ˆéœ€é…ç½®é‡è¯•ç­–ç•¥ï¼Œæ­¤å¤„ç®€åŒ–ï¼‰
            }
        }
    }
    

### 7\. æµ‹è¯•æ§åˆ¶å™¨ï¼ˆOrderController.javaï¼‰

    package com.example.kafkademo.controller;
    
    import com.example.kafkademo.model.Order;
    import com.example.kafkademo.producer.OrderProducer;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.web.bind.annotation.PostMapping;
    import org.springframework.web.bind.annotation.RequestBody;
    import org.springframework.web.bind.annotation.RestController;
    
    import java.math.BigDecimal;
    
    /**
     * æµ‹è¯•æ¥å£ï¼šé€šè¿‡HTTPå‘é€è®¢å•æ¶ˆæ¯
     */
    @RestController  // æ ‡è®°ä¸ºRESTæ¥å£æ§åˆ¶å™¨
    public class OrderController {
    
        @Autowired  // æ³¨å…¥ç”Ÿäº§è€…æœåŠ¡
        private OrderProducer orderProducer;
    
        /**
         * åˆ›å»ºè®¢å•æ¥å£ï¼ˆå‘é€æ¶ˆæ¯åˆ°Kafkaï¼‰
         * @param order è®¢å•å¯¹è±¡ï¼ˆJSONæ ¼å¼ï¼‰
         * @return å“åº”æ¶ˆæ¯
         */
        @PostMapping("/create-order")
        public String createOrder(@RequestBody(required = false) Order order) {
            // è°ƒç”¨ç”Ÿäº§è€…å‘é€è®¢å•ï¼ˆè‹¥orderä¸ºnullï¼Œç”Ÿäº§è€…è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•è®¢å•ï¼‰
            orderProducer.sendOrder(order);
            return "è®¢å•æ¶ˆæ¯å·²å‘é€ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼";
        }
    }
    

### 8\. å¯åŠ¨ç±»ï¼ˆKafkaDemoApplication.javaï¼‰

    package com.example.kafkademo;
    
    import org.springframework.boot.SpringApplication;
    import org.springframework.boot.autoconfigure.SpringBootApplication;
    
    @SpringBootApplication  // Spring Bootå¯åŠ¨ç±»æ³¨è§£
    public class KafkaDemoApplication {
        public static void main(String[] args) {
            SpringApplication.run(KafkaDemoApplication.class, args);  // å¯åŠ¨åº”ç”¨
        }
    }
    

å…­ã€æµ‹è¯•æ­¥éª¤
------

1.  **å¯åŠ¨Kafkaé›†ç¾¤**ï¼šç¡®ä¿ZooKeeperå’ŒKafka Brokerå·²å¯åŠ¨ï¼ˆå‚è€ƒâ€œå››ã€Kafkaå®‰è£…â€ï¼‰ã€‚
2.  **åˆ›å»ºTopic**ï¼šè‹¥æœªåˆ›å»ºï¼Œæ‰§è¡Œå‘½ä»¤ï¼š
    
        /opt/kafka/bin/kafka-topics.sh --create --topic order-topic --bootstrap-server localhost:9092 --partitions 3 --replication-factor 1
        
    
3.  **è¿è¡ŒSpring Bootåº”ç”¨**ï¼šå¯åŠ¨`KafkaDemoApplication`ï¼Œè®¿é—®`http://localhost:8080/create-order`ï¼ˆPOSTè¯·æ±‚ï¼Œå¯ä¼ JSONè®¢å•æˆ–ç”¨Postmanæµ‹è¯•ï¼‰ã€‚
4.  **æŸ¥çœ‹æ—¥å¿—**ï¼š
    *   ç”Ÿäº§è€…æ—¥å¿—ï¼šæ˜¾ç¤ºâ€œè®¢å•å‘é€æˆåŠŸâ€åŠåˆ†åŒºã€åç§»é‡ã€‚
    *   æ¶ˆè´¹è€…æ—¥å¿—ï¼šæ˜¾ç¤ºâ€œæ”¶åˆ°è®¢å•æ¶ˆæ¯â€â€œå¤„ç†è®¢å•â€â€œåç§»é‡æäº¤æˆåŠŸâ€ã€‚

æ€»ç»“
--

æœ¬æ–‡ä»Kafkaæ¶æ„ã€å®‰è£…åˆ°Spring Bootå®æˆ˜ï¼Œè¦†ç›–äº†å…¥é—¨çº§æ ¸å¿ƒå†…å®¹ã€‚é€šè¿‡â€œç”Ÿäº§è€…å‘é€è®¢å•â†’æ¶ˆè´¹è€…æ¶ˆè´¹è®¢å•â€çš„ç®€å•æ¡ˆä¾‹ï¼Œå¿«é€Ÿä¸Šæ‰‹Kafkaçš„åŸºæœ¬ä½¿ç”¨ã€‚åç»­å¯æ·±å…¥å­¦ä¹ åˆ†åŒºç­–ç•¥ã€æ•°æ®å¯é æ€§ã€äº‹åŠ¡ç­‰é«˜çº§ç‰¹æ€§ã€‚

â¤ï¸ å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·ç‚¹èµæ”¯æŒï¼ ğŸ‘ åŒæ—¶æ¬¢è¿å…³æ³¨æˆ‘çš„åšå®¢ï¼Œè·å–æ›´å¤šç²¾å½©å†…å®¹ï¼

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š[ä½›ç¥–è®©æˆ‘æ¥å·¡å±±](https://www.cnblogs.com/sun-10387834/)ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/sun-10387834/p/19286179](https://www.cnblogs.com/sun-10387834/p/19286179)