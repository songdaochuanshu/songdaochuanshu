---
layout: post
title: 'ã€URPã€‘[Unityæ ¸å¿ƒBufferåŠå…¶åº”ç”¨]'
date: "2025-09-04T00:38:13Z"
---
ã€URPã€‘\[Unityæ ¸å¿ƒBufferåŠå…¶åº”ç”¨\]
==========================

![ã€URPã€‘[Unityæ ¸å¿ƒBufferåŠå…¶åº”ç”¨]](https://img2024.cnblogs.com/blog/3685400/202509/3685400-20250904000157493-918355285.png) æœ¬æ–‡ä»‹ç»äº†Unity URPæ¸²æŸ“ç®¡çº¿ä¸­çš„æ ¸å¿ƒBufferç±»å‹åŠå…¶åº”ç”¨ã€‚ä¸»è¦åŒ…æ‹¬å¸¸é‡ç¼“å†²åŒº(å­˜å‚¨å…¨å±€æ•°æ®)ã€æ¨¡æ¿ç¼“å†²åŒº(æ§åˆ¶æ¸²æŸ“åŒºåŸŸ)ã€æ·±åº¦ç¼“å†²åŒº(ç®¡ç†ç‰©ä½“é®æŒ¡)å’Œå¸§ç¼“å†²åŒº(å­˜å‚¨æœ€ç»ˆè¾“å‡º)ã€‚æ–‡ç« è¯¦ç»†è¯´æ˜äº†å„ç±»ç¼“å†²åŒºçš„åŠŸèƒ½ç‰¹ç‚¹ã€å®ç°æ–¹å¼åŠä¼˜åŒ–ç­–ç•¥ï¼Œå¦‚å¸¸é‡ç¼“å†²åŒºå‡å°‘æ•°æ®ä¼ è¾“ã€æ¨¡æ¿ç¼“å†²åŒºå®ç°ç‰¹æ•ˆã€æ·±åº¦ç¼“å†²åŒºä¼˜åŒ–åŠé€æ˜æ¸²æŸ“ç­‰ã€‚åŒæ—¶æä¾›äº†å…·ä½“ä»£ç ç¤ºä¾‹å’Œæ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼Œå¦‚åˆ†å±‚ç®¡ç†ã€ç¼“å†²åŒºå¤ç”¨ç­‰æŠ€å·§ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°æŒæ¡URPæ¸²æŸ“æŠ€æœ¯ï¼Œæå‡æ¸¸æˆæ¸²æŸ“æ•ˆç‡å’Œè´¨é‡ã€‚

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

**â€Œä¸€ã€æ ¸å¿ƒ Buffer ç±»å‹åŠç”¨é€”â€Œ**
=======================

â€Œå¸¸é‡ç¼“å†²åŒºï¼ˆConstant Bufferï¼‰
-----------------------

### â€Œ**åŠŸèƒ½**â€Œ

*   å­˜å‚¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¸å˜çš„å…¨å±€æ•°æ®ï¼ˆå¦‚å˜æ¢çŸ©é˜µã€å…‰ç…§å‚æ•°ã€æè´¨å±æ€§ï¼‰ã€‚

### **å®ç°ç±»**â€Œ

*   é€šè¿‡`Shader.SetGlobal`ç³»åˆ—æ–¹æ³•æˆ–`MaterialPropertyBlock`é—´æ¥ç®¡ç†ï¼Œåº•å±‚ç”±`UnityEngine.Rendering.CommandBuffer`æ§åˆ¶

### â€Œ**è„šæœ¬ä½ç½®**â€Œ

*   æ•°æ®æ³¨å…¥é€šå¸¸åœ¨`ScriptableRenderPass`æˆ–`MonoBehaviour`è„šæœ¬ä¸­å®Œæˆï¼ˆå¦‚`Camera.main.SetGlobalMatrix`ï¼‰

### â€Œ**åº”ç”¨ä½ç½®**â€Œ

*   ç”¨äºé¿å…æ¯å¸§é‡å¤ä¼ è¾“æ•°æ®ï¼Œæå‡ SRP åˆæ‰¹æ•ˆç‡ã€‚
    
        hlsl
        CBUFFER_START(UnityPerMaterial)
        float4 _Color; // æè´¨å±æ€§
        float4x4 _WorldToCamera; // è§†å›¾çŸ©é˜µ
        CBUFFER_END
        
    

### **å¸¸é‡ç¼“å†²åŒºæ›´æ–°**â€Œ

    csharp
    // CPUæ³¨å…¥æ•°æ®ï¼ˆå¦‚æ¯å¸§æ›´æ–°VPçŸ©é˜µï¼‰
    Shader.SetGlobalMatrix("_CameraViewProjection", camera.projectionMatrix * camera.worldToCameraMatrix);
    

*   GPUåœ¨ç€è‰²å™¨ä¸­é€šè¿‡`CBUFFER_START(UnityPerCamera)`è¯»å–

â€Œæ¨¡æ¿ç¼“å†²åŒºï¼ˆStencil Bufferï¼‰
----------------------

### â€Œ**åŠŸèƒ½**â€Œ

*   é€šè¿‡åƒç´ çº§æ©ç è§„åˆ™æ§åˆ¶æ¸²æŸ“åŒºåŸŸï¼ˆå¦‚è½®å»“å…‰ã€UI é®ç½©ï¼‰ã€‚

### **å®ç°ç±»**â€Œ

*   `UnityEngine.Rendering.Universal.RenderTargetHandle`ï¼Œé€šè¿‡`CreateDepthTexture`å’Œ`ConfigureTarget`é…ç½®

### â€Œ**è„šæœ¬ä½ç½®**â€Œ

*   URPçš„`ForwardRendererAsset`é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œè¿è¡Œæ—¶ç”±`ScriptableRenderer`ç®¡ç†

### â€Œ**åº”ç”¨é€»è¾‘**â€Œï¼š

*   è®¾ç½®æ¨¡æ¿è§„åˆ™ï¼ˆå¦‚Â `Stencil{ Ref 1 Comp Equal }`Â ä»…æ¸²æŸ“æ ‡è®°ä¸º 1 çš„åŒºåŸŸï¼‰
*   ç”¨äºè§’è‰²æè¾¹ã€é•œå­åå°„ç­‰ç‰¹æ•ˆã€‚

### æ¨¡æ¿ç¼“å†²åŒºæ§åˆ¶

    hlsl
    Stencil {
        Ref 2
        Comp Equal
        Pass Keep
    } // ä»…æ¸²æŸ“æ¨¡æ¿å€¼ä¸º2çš„åƒç´ 
    

*   ç”±URPçš„`RenderObjects`ç‰¹æ€§åœ¨`Execute`é˜¶æ®µè§¦å‘å†™å…¥

æ·±åº¦ç¼“å†²åŒºï¼ˆDepth Bufferï¼‰
-------------------

### â€Œ**åŠŸèƒ½**â€Œ

*   å­˜å‚¨åƒç´ æ·±åº¦å€¼ï¼Œç®¡ç†ç‰©ä½“å‰åé®æŒ¡å…³ç³»ï¼ˆé»˜è®¤å¼€å¯ ZWriteï¼‰ã€‚

### â€Œ**ä¼˜åŒ–åœºæ™¯**â€Œ

*   åŠé€æ˜ç‰©ä½“å…³é—­ ZWrite é¿å…æ·±åº¦å†²çªï¼Œå¦‚ç²’å­ç‰¹æ•ˆã€‚

### **æ·±åº¦ç¼“å†²åŒºå¤ç”¨**

    csharp
    // URP Renderer Featureä¸­é…ç½®æ·±åº¦çº¹ç†
    renderingData.cameraData.requiresDepthTexture = true;
    

*   åå¤„ç†é€šè¿‡`_CameraDepthTexture`é‡‡æ ·æ·±åº¦å€¼

â€Œå¸§ç¼“å†²åŒºï¼ˆFrame Bufferï¼‰
-------------------

### â€Œ**åŠŸèƒ½**â€Œ

*   å­˜å‚¨æœ€ç»ˆæ¸²æŸ“è¾“å‡ºï¼Œæ”¯æŒå¤šæ¸²æŸ“ç›®æ ‡ï¼ˆMRTï¼‰ç”¨äºåå¤„ç†ã€‚

### **å®ç°ç±»**â€Œ

*   é€»è¾‘æ¦‚å¿µï¼Œå®é™…ç”±`RenderTexture`å’Œ`Camera.targetTexture`ç»„åˆå®ç°

### â€Œ**è„šæœ¬ä½ç½®**â€Œ

*   URPæ¸²æŸ“ç®¡çº¿æ ¸å¿ƒé€»è¾‘ä½äº`UniversalRenderPipeline.cs`

### â€Œ**URP é…ç½®**â€Œï¼š

    csharp
    // URP Renderer Feature ä¸­é…ç½®
    ConfigureCameraTarget(BufferA, BufferB);// åŒç¼“å†²åŒºå®ç°è¿åŠ¨æ¨¡ç³Š
    

**â€ŒäºŒã€å…³é”®åº”ç”¨åœºæ™¯â€Œ**
==============

â€Œ**GraphicsBuffer**â€Œ
--------------------

*   åŠ¨æ€åœ°å½¢è£å‰ªæ—¶é¢„åŠ è½½åŒ…å›´ç›’é¡¶ç‚¹æ•°æ®åˆ°æ˜¾å­˜ï¼Œå‡å°‘ CPU-GPU ä¼ è¾“ã€‚

â€Œ**å¸¸é‡ç¼“å†²åŒº**â€Œ
-----------

*   SRP åˆæ‰¹ä¸­åˆå¹¶æè´¨å±æ€§ï¼Œé™ä½ Draw Callï¼ˆå¦‚é™æ€åœºæ™¯æ‰¹é‡æ¸²æŸ“ï¼‰ã€‚

â€Œ**æ¨¡æ¿ç¼“å†²åŒº**â€Œ
-----------

*   é€šè¿‡Â `RenderObjects`Â ç‰¹æ€§ä¸ºç‰¹å®šå±‚çº§ï¼ˆå¦‚â€œOutlineâ€ï¼‰å¯ç”¨æ¨¡æ¿æµ‹è¯•ã€‚

â€Œ**æ·±åº¦ç¼“å†²åŒº**â€Œ
-----------

*   åœ¨ Renderer Feature ä¸­è®¿é—®Â `_CameraDepthTexture`Â å®ç°å±å¹•ç©ºé—´é˜´å½±ã€‚

**â€Œä¸‰ã€æ€§èƒ½ä¼˜åŒ–åŸåˆ™â€Œ**
==============

â€Œ**å‡å°‘ä¼ è¾“**â€Œ
----------

*   é™æ€æ•°æ®ç”¨Â `GraphicsBuffer`Â ä¸€æ¬¡æ€§ä¸Šä¼ ï¼ŒåŠ¨æ€æ•°æ®å¢é‡æ›´æ–°ã€‚

â€Œ**åˆ†å±‚ç®¡ç†**â€Œ
----------

*   é€šè¿‡Â `Camera.cullingMask`Â å‰”é™¤æ— å…³å±‚çº§ï¼Œç»“åˆè·ç¦»è£å‰ªé™ä½è´Ÿè½½ã€‚

â€Œ**ç¼“å†²åŒºå¤ç”¨**â€Œ
-----------

*   åœ¨ URP Renderer Feature ä¸­å…±äº«Â `_CameraColorTexture`Â é¿å…é‡å¤åˆ›å»º

**å¸¸é‡ç¼“å†²åŒº**â€Œ
----------

*   å•å¸§å†…é¿å…é¢‘ç¹æ›´æ–°ï¼Œåˆå¹¶ç›¸å…³å˜é‡åˆ°åŒä¸€`CBUFFER`

**æ¨¡æ¿/æ·±åº¦**â€Œ
----------

*   é€šè¿‡`Camera.main.depthTextureMode`æ§åˆ¶ç”Ÿæˆç­–ç•¥

**å¸§ç¼“å†²åŒº**â€Œ
---------

*   ä½¿ç”¨`RenderTexture.GetTemporary`åŠ¨æ€åˆ†é…é¿å…å†…å­˜æ³„æ¼

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰