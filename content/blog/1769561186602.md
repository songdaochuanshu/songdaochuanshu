---
layout: post
title: '面积图的奇妙变形：流图与地平线图'
date: "2026-01-28T00:46:26Z"
---
面积图的奇妙变形：流图与地平线图
================

想象一下面积图就像一层层叠起来的彩色玻璃片，每一层代表一个类别，从下往上堆叠，形成整体的视觉冲击。

但有时我们需要更特别的方式来展示数据的变化：是像河流一样蜿蜒流淌，还是像地平线上的群山连绵起伏？

今天，本文将介绍两种创意**面积图变体**——**流图**和**地平线图**，它们能让你的时间序列数据讲述更生动的故事。

1\. 流图：数据的河流
============

如果把传统的堆叠面积图想象成一块块整齐堆叠的积木，那么**流图**就像一条蜿蜒流淌的河流，河道的宽窄变化自然流畅，波峰波谷过渡平滑。

它特别适合展示多个类别数据随时间的变化趋势，尤其是当你想强调整体流动感和各部分的相对比例变化时。

**流图**的**核心思想**是将传统的堆叠面积图进行"平滑"处理。

在`matplotlib`中，我们可以使用`fill_between`函数结合样条插值来创建平滑的边缘。

关键在于将堆叠的数据进行累积，然后对累积边界进行平滑处理。

    # 数据准备
    x = np.linspace(0, 10, 100)
    # 构造三组波浪数据
    y1 = 2 + np.sin(x)            # 基础波动
    y2 = 2 + np.cos(x - 1.5)      # 错位波动
    y3 = 2 + np.sin(x + 2)        # 再次错位
    
    # 省略 ...
    
    # 绘图设置
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))
    
    # --- 左图：普通堆叠面积图 (baseline='zero') ---
    ax1.stackplot(x, y_data, labels=labels, colors=colors, baseline='zero', alpha=0.8)
    # 省略 ...
    
    # --- 右图：流图 (baseline='sym') ---
    # 'sym' 表示对称中心布局
    ax2.stackplot(x, y_data, labels=labels, colors=colors, baseline='sym', alpha=0.8)
    ax2.axhline(0, color='black', ls='--', alpha=0.1) # 画一条中心参考线
    # 省略 ...
    
    # 去除右图边框，增加流动感
    for spine in ax2.spines.values():
        spine.set_visible(False)
    
    plt.tight_layout()
    plt.show()
    

![](https://img2024.cnblogs.com/blog/83005/202601/83005-20260127095106236-1661454977.png)

**流图**解决了一个视觉错觉问题：在普通**堆叠面积图**中，上面的数据层会因为下面数据层的起伏而被迫“扭曲”，很难看出它原本的形状。

**流图**通过中心布局，减少了这种扭曲，非常适合展示随时间变化的趋势和不同类别权重的波动，这种有机的形态还能给读者带来极强的审美愉悦感。

2\. 地平线图：数据的群山
==============

想象一下远处的地平线上有一排连绵的山脉，每座山的高度代表一个数据值。

**地平线图**就是这样一种可视化技术，它将时间序列数据压缩在一个很小的垂直空间内，通过颜色和分层来展示数据的变化。

特别适合在有限空间内展示多个时间序列的对比。

**地平线图**的**核心思想**是数据分层和颜色渐变。

它将数据值分成若干层（通常是2-3层），每层用一种颜色表示。当数据值超过一层时，就用更深的颜色或不同的颜色填充。这样可以在很小的垂直空间内展示很大的数据范围。

    from datetime import timedelta
    
    # 生成模拟数据：过去10年五大科技公司的股价波动
    np.random.seed(42)
    
    # 生成日期范围：过去10年，每月一个数据点
    dates = pd.date_range("2013-01-01", "2023-01-01", freq="ME")
    companies = ["苹果", "谷歌", "微软", "亚马逊", "Meta"]
    
    # 生成各公司的股价模拟数据（标准化到相似范围）
    data = {}
    for company in companies:
        # 基础趋势：每家公司有不同的增长趋势，但最终都在70-90范围内
        # 省略 ...
    
    # 转换为DataFrame
    df = pd.DataFrame(data, index=dates)
    
    # 创建对比图表
    fig, axes = plt.subplots(2, 1, figsize=(14, 10))
    
    # ============ 传统堆叠面积图 ============
    colors = ["#FF6B6B", "#4ECDC4", "#45B7D1", "#FFD166", "#9B5DE5"]
    
    # 为堆叠面积图重新归一化数据
    df_normalized = df.div(df.sum(axis=1), axis=0) * 100
    y_cumulative = np.zeros(len(df))
    
    for i, company in enumerate(companies):
        axes[0].fill_between(
            df.index,
            y_cumulative,
            y_cumulative + df_normalized[company].values,
            color=colors[i],
            alpha=0.7,
            label=company,
            edgecolor="white",
            linewidth=0.5,
        )
        y_cumulative += df_normalized[company].values
    
    # 省略 ...
    
    # ============ 地平线图：股价波动对比 ============
    # 生成股价变化百分比数据（更能体现波动对比）
    np.random.seed(42)
    price_changes = {}
    for company in companies:
        # 生成均值附近波动的变化数据
        # 省略 ...
    
    # 关键参数：定义“波段”
    BAND_HEIGHT = 3.0  # 每个颜色波段代表的变化率幅度 (%)
    NUM_BANDS = 3  # 正负方向各使用的波段层数
    
    df = pd.DataFrame(price_changes, index=dates)
    
    # 为每家公司计算并绘制地平线
    for i, company in enumerate(companies):
        # 公司的基准Y轴位置（水平线）
        # 省略 ...
    
        # 分层与绘制：从第1层到第NUM_BANDS层
        for band in range(NUM_BANDS):
            # --- 处理正偏差（上涨）---
            # 计算当前层的数据：偏差值减去已绘制层的高度，并限制在本层高度内
            # 省略 ...
    
            # --- 处理负偏差（下跌）---
            # 对负值取绝对值，进行类似处理
            # 省略 ...
    
    # 美化图表
    # 省略 ...
    
    # 6. 添加图例
    import matplotlib.patches as mpatches
    
    legend_patches = []
    # 省略 ...
    
    plt.tight_layout(h_pad=5)
    plt.show()
    

![](https://img2024.cnblogs.com/blog/83005/202601/83005-20260127095106427-578985873.png)

**地平线图**是空间利用大师。当你有 20 个股票或者 50 个城市的温度需要放在一张图里对比时，普通的面积图会挤成一团乱麻。

**地平线图**可以将每个序列压缩成一个窄窄的横条，但在保持视觉分辨率的同时，还能让你看清极值（通过深颜色）。

3\. 总结
======

数据可视化不仅是科学，也是艺术。**流图**和**地平线图**这两种面积图变体，分别从**"流动之美"**和**"空间效率"**两个角度拓展了面积图的可能性。

它们证明了，通过对基础图表的创意改造，我们可以让数据讲述更丰富、更生动的故事。

下次当你面对时间序列数据时，不妨问问自己：我的数据像一条蜿蜒的河流，还是像地平线上的群山？选择适合的可视化方式，让你的数据真正"流动"起来或"层叠"起来。

记住，最好的可视化不是最复杂的，而是最能清晰传达信息、启发思考的那一个。

完整的代码共享在：[面积图的2个变种.ipynb](https://url11.ctfile.com/f/45455611-8635132430-f06d31?p=6872) (访问密码: 6872)