---
layout: post
title: '按部就班--从零开始建设k8s监控（二）'
date: "2025-01-07T00:36:29Z"
---
按部就班--从零开始建设k8s监控（二）
====================

前言
--

书接上文，prometheus已经安装好了，并且能够对k8s的整体状态进行监控，但是我们还需要更多

环境准备
----

组件

版本

操作系统

Ubuntu 22.04.4 LTS

docker

24.0.7

grafana

11.2.2

下载编排文件
------

本文所有的编排文件，[都在这里](https://github.com/wilsonchai8/installations/tree/main/prometheus)

    ▶ cd /tmp && git clone git@github.com:wilsonchai8/installations.git && cd installations/prometheus
    

安装grafana
---------

prometheus提供了原生的PromQL，但是并不是每次都是需要使用PromQL查询监控数据的，把常用的监控数据固化下来形成图标，才是最好的选择，所以可以借用grafana解决问题

安装grafana我们就不拘泥于在k8s里面了，为了方便，直接单机部署即可，数据文件放入当前的grafana目录

    ▶ docker run -d --network=host --name=grafana \
        -p 3000:3000 \
        -v ./grafana:/var/lib/grafana \
        registry.cn-beijing.aliyuncs.com/wilsonchai/grafana:11.2.2
    

检查是否安装成功

![](https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113249678-1539056785.png)

配置grafana
---------

### 1\. 添加数据源，选择prometheus

![](https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113304614-1965661044.png)

### 2\. 填入prometheus的地址

参考之前prometheus的安装，`http://192.168.49.2:32648/`

![](https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113332581-12557201.png)

保存并测试通过

### 3\. 检查数据源

![](https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113344200-1060538141.png)

### 4\. 创建panel

[开源模版](https://grafana.com/grafana/dashboards/) 下载一个适合的模版，然后导入

![](https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113418135-1925665577.png)

可以直接使用模版的id，当然也可以下载下来导入json

![](https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113428355-1353264327.png)

导入之后选择数据源

![](https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113438873-613473240.png)

### 5\. 导入完成

![](https://img2024.cnblogs.com/blog/1416773/202501/1416773-20250106113456596-1590390282.png)

当然有些数据是需要修复的 \_

联系我
---

*   联系我，做深入的交流

![](https://img2024.cnblogs.com/blog/1416773/202411/1416773-20241121135740959-1907948957.png#)

* * *

至此，本文结束  
在下才疏学浅，有撒汤漏水的，请各位不吝赐教...

本文来自博客园，作者：[it排球君](https://www.cnblogs.com/MrVolleyball/)，转载请注明原文链接：[https://www.cnblogs.com/MrVolleyball/p/18654962](https://www.cnblogs.com/MrVolleyball/p/18654962)

本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须在文章页面给出原文连接，否则保留追究法律责任的权利。