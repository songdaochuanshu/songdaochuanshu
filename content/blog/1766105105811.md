---
layout: post
title: '基于Python实现微信通知和预警'
date: "2025-12-19T00:45:05Z"
---
基于Python实现微信通知和预警
-----------------

一、功能定义：

1.  当系统正常时给某微信群发送“成功“消息
2.  当系统异常时给某值班人员打微信电话，提醒其登陆系统排查解决问题

二、技术方案：

1.  核心模块：pyautogui，模拟人工鼠标和键盘操作
2.  重要功能：locateCenterOnScreen，利用该图像识别方法可以匹配界面中某个区域，比如需要点击微信聊天框中的“电话”图标。

三、代码实现：

import pyperclip
import pyautogui
import time
import show\_mouse

def locate\_tpl(tpl\_path, confidence=0.8):
    """模板匹配 -> 返回屏幕绝对坐标"""
    pos \= pyautogui.locateCenterOnScreen(tpl\_path, confidence=confidence)
    # pos = pyautogui.locateCenterOnScreen(tpl\_path)
    if pos is None:
        raise RuntimeError(f'未找到模板 {tpl\_path}，请确认微信已置顶并重新截图')
    return pos

def open\_app\_by\_search(app\_name: str):
    """查找软件并打开"""
    # 1. 按 Win 键呼出开始菜单
    pyautogui.press('win')
    time.sleep(0.5)

    # 2. 输入软件名
    pyautogui.write(app\_name, interval=0.1)
    time.sleep(0.1)

    # 3. 回车打开（默认第一项就是）
    pyautogui.press('enter')
    time.sleep(1)          # 给软件启动留时间

def record\_active\_window():
    """返回当前活动窗口的坐标+尺寸 dict"""
    win \= pyautogui.getActiveWindow()     # 当前获得焦点的窗口
    return {
        'title': win.title,
        'left': win.left,
        'top': win.top,
        'width': win.width,
        'height': win.height,
        'box': (win.left, win.top, win.width, win.height)  # region 直接可用
    }
def search\_friend\_and\_open\_chatbox(sw\_posi\_info, friend):
    """搜索某个联系人或者群并打开聊天窗口"""
    # 1. 获取微信左上角输入框位置
    search\_input\_x = sw\_posi\_info\['left'\] + 150
    search\_input\_y \= sw\_posi\_info\['top'\] + 32

    # 2. 点击输入框
    pyautogui.click(search\_input\_x, search\_input\_y)
    show\_mouse.click\_with\_ring(search\_input\_x, search\_input\_y)

    # 3. 输入好友昵称并回车搜索（用 pyperclip 避免中文输入乱码）
    pyperclip.copy(friend)
    pyautogui.hotkey("ctrl", "v")
    time.sleep(1)
    pyautogui.press("enter")
    time.sleep(2)
    
def send\_wechat\_msg(friend, send\_msg):
    """给某个微信好友或者微信群发消息"""
    # 1. 打开微信
    open\_app\_by\_search('weixin')
    pyautogui.press("enter")
    time.sleep(2)

    # 2. 获取软件的坐标
    sw\_posi\_info = record\_active\_window()
    #print(sw\_posi\_info)

    # 3. 搜索联系人并打开聊天框
    search\_friend\_and\_open\_chatbox(sw\_posi\_info, friend)

    # 4. 找到消息输入框，并点击获取焦点
    send\_button\_x = sw\_posi\_info\['left'\] + sw\_posi\_info\['width'\] - 100
    send\_button\_y \= sw\_posi\_info\['top'\] + sw\_posi\_info\['height'\] - 100
    pyautogui.click(send\_button\_x, send\_button\_y)
    show\_mouse.click\_with\_ring(send\_button\_x, send\_button\_y)

    # 5. 粘贴要发送的消息
    pyperclip.copy(send\_msg)
    pyautogui.hotkey("ctrl", "v")
    time.sleep(0.3)

    # 6. 点击发送按钮
    send\_button\_x = sw\_posi\_info\['left'\] + sw\_posi\_info\['width'\] - 100
    send\_button\_y \= sw\_posi\_info\['top'\] + sw\_posi\_info\['height'\] - 32
    pyautogui.click(send\_button\_x, send\_button\_y)
    show\_mouse.click\_with\_ring(send\_button\_x, send\_button\_y)

def send\_wechat\_call(friend):
    """给某个微信好友打微信电话"""

    # 1. 打开微信
    open\_app\_by\_search('weixin')
    pyautogui.press("enter")
    time.sleep(2)

    # 2. 获取软件的坐标
    sw\_posi\_info = record\_active\_window()
    #print(sw\_posi\_info)

    # 3. 搜索联系人并打开聊天框
    search\_friend\_and\_open\_chatbox(sw\_posi\_info, friend)

    # 4. 搜索打电话图标的位置
    call\_pic = 'wechat\_call\_pic.png'  # 提前截图准备好的打电话图标
    call\_pic\_x, call\_pic\_y = locate\_tpl(call\_pic)
    #print(call\_pic\_x)
    #print(call\_pic\_y)

    # 5. 点击图标并拨打电话
    pyautogui.click(call\_pic\_x, call\_pic\_y)
    show\_mouse.click\_with\_ring(call\_pic\_x, call\_pic\_y)

call\_wechat

import tkinter as tk

def click\_with\_ring(x, y, r=30, ms=400):
    """在 (x,y) 画一个逐渐消失的圆环，模拟点击特效"""
    root \= tk.Tk()
    root.overrideredirect(True)          # 无边框
    root.attributes('\-topmost', True)    # 置顶
    root.attributes('\-transparentcolor', 'white')  # 白色全透明
    root.geometry(f'{r\*2}x{r\*2}+{x-r}+{y-r}')

    c \= tk.Canvas(root, bg='white', highlightthickness=0)
    c.pack(fill\='both', expand=True)
    ring \= c.create\_oval(2, 2, r\*2-2, r\*2-2, outline='red', width=3)

    def fade(alpha=255):
        if alpha <= 0:
            root.destroy()
            return
        c.itemconfig(ring, fill\='#%02x0000' % alpha)
        root.after(int(ms/15), fade, alpha-17)
    fade()
    root.mainloop()

show\_mouse

四、注意点&Tips：

1.  搜索微信群名时，用拼音即可直接定位群名，而用中文反而无法直接定位群（中文搜索可以直接定位好友，群需要再手动选择，多了一步操作）。
2.  pyautogui运行时，Python脚本后台进程会与前台操作争抢输入（鼠标及键盘），因此代码中要适时的加入一些等待，避免Python后台进程干扰前台操作。
3.  该uiautomation/PyOfficeRobot等框架方案相比，pyautogui是模拟人来操作，实际运行一段时间后，在低频操作场景下，发现微信被系统踢出的概率较小。

posted on 2025-12-18 17:13  [davawang](https://www.cnblogs.com/davablog)  阅读(105)  评论(0)    [收藏](javascript:void\(0\))  [举报](javascript:void\(0\))