---
layout: post
title: 'SeaTunneléƒ¨ç½²åŠå…¶Demo'
date: "2025-11-29T00:40:51Z"
---
SeaTunneléƒ¨ç½²åŠå…¶Demo
-----------------

SeaTunneléƒ¨ç½²åŠå…¶Demo
=================

![image](https://img2024.cnblogs.com/blog/1848807/202511/1848807-20251128163821721-378978960.png)

*   ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºseatunnelçš„conf(æ‰§è¡Œå‘½ä»¤æ–‡ä»¶)ï¼Œä¸»è¦æ˜¯sourceã€transformã€sinkç»„æˆ
*   ğŸ“¥ Sourceï¼ˆæ•°æ®æºï¼‰ï¼šä½œç”¨ï¼šä»å„ç§æ•°æ®æºè¯»å–æ•°æ®
*   ğŸ”„ Transformï¼ˆæ•°æ®è½¬æ¢ï¼‰ï¼šä½œç”¨ï¼šå¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ã€è½¬æ¢ã€åŠ å·¥
*   ğŸ“¤ Sinkï¼ˆæ•°æ®ç›®æ ‡ï¼‰ï¼šä½œç”¨ï¼šå°†å¤„ç†åçš„æ•°æ®å†™å…¥ç›®æ ‡ç³»ç»Ÿ

* * *

1ç¯å¢ƒã€å®‰è£…ä¸‹è½½ï¼ˆå›½å†…é•œåƒä¸‹è½½ï¼‰
----------------

*   ç¯å¢ƒå‡†å¤‡ï¼šç¡®ä¿ä½ çš„ç³»ç»Ÿå·²å®‰è£… Java 8 æˆ– 11ï¼Œå¹¶æ­£ç¡®è®¾ç½®äº† JAVA\_HOME ç¯å¢ƒå˜é‡ã€‚

### 1.1ä¸‹è½½ï¼Œè§£å‹

    https://mirrors.tuna.tsinghua.edu.cn/apache/seatunnel/2.3.12/apache-seatunnel-2.3.12-bin.tar.gz
    
    tar -zxvf apache-seatunnel-2.3.12-bin.tar.gz
    

### 1.2ä¸‹è½½æ’ä»¶ï¼ˆæ ¹æ®éœ€è¦ä¸‹è½½ï¼‰

    å®‰è£…è¿æ¥å™¨æ’ä»¶ï¼šä»2.2.0-betaç‰ˆæœ¬å¼€å§‹ï¼ŒäºŒè¿›åˆ¶åŒ…é»˜è®¤ä¸åŒ…å«è¿æ¥å™¨ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ã€‚
    
    è¿›å…¥è§£å‹åçš„SeaTunnelç›®å½•ï¼Œæ‰§è¡Œå®‰è£…è„šæœ¬ï¼š
    
    å¦‚æœéœ€è¦æŒ‡å®šè¿æ¥å™¨ç‰ˆæœ¬ï¼ˆä¾‹å¦‚2.3.8ï¼‰ï¼Œåˆ™æ‰§è¡Œ sh bin/install-plugin.sh 2.3.8ã€‚
    
    ä½ é€šå¸¸ä¸éœ€è¦å…¨éƒ¨è¿æ¥å™¨ã€‚å¯ä»¥ç¼–è¾‘ config/plugin_config æ–‡ä»¶ï¼ŒæŒ‰æ ¼å¼ï¼ˆä¾‹å¦‚ä¸‹æ–¹ï¼‰æŒ‡å®šæ‰€éœ€æ’ä»¶ã€‚è¦è®©ç¤ºä¾‹åº”ç”¨è¿è¡Œï¼Œé€šå¸¸éœ€è¦ connector-fake å’Œ connector-consoleã€‚
    
     è¿æ¥å™¨æ’ä»¶çš„ä½œç”¨
    è¿æ¥å™¨æ’ä»¶ = æ•°æ®æºé©±åŠ¨ç¨‹åº
    
    æ¯ä¸ªæ’ä»¶è®© SeaTunnel èƒ½å¤Ÿè¿æ¥ç‰¹å®šçš„æ•°æ®æº
    
    MySQL æ’ä»¶ï¼šè¿æ¥ MySQL æ•°æ®åº“
    
    Oracle æ’ä»¶ï¼šè¿æ¥ Oracle æ•°æ®åº“
    
    Console æ’ä»¶ï¼šè¾“å‡ºåˆ°æ§åˆ¶å°
    
    Fake æ’ä»¶ï¼šç”Ÿæˆæµ‹è¯•æ•°æ®
    

*   ä¿®æ”¹ config/plugin\_configï¼Œåªä¿ç•™ä½ éœ€è¦çš„ï¼šï¼ˆä¹Ÿå¯ä»¥ä¸æ”¹ï¼Œå…¨éƒ¨ä¸‹è½½ï¼‰

    --connectors-v2--
    connector-jdbc-mysql
    connector-jdbc-oracle
    connector-console  # è¿™ä¸ªå»ºè®®ä¿ç•™ï¼Œç”¨äºè°ƒè¯•è¾“å‡º
    --end--
    

*   å®‰è£…æ’ä»¶,æ‰§è¡Œå‘½ä»¤

    # è¿›å…¥ SeaTunnel ç›®å½•
    sh bin/install-plugin.sh
    

![image](https://img2024.cnblogs.com/blog/1848807/202511/1848807-20251128115058787-1977386906.png)

### 1.3JVMå‚æ•°çš„é…ç½®

*   ç¼–è¾‘ bin/seatunnel.sh æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å¼€å¤´é™„è¿‘æ·»åŠ æˆ–ä¿®æ”¹

    export JVM_ARGS="-Xmx2g -Xms1g -XX:MaxDirectMemorySize=1g"
    
    # å…¶ä»–é…ç½®
    

*   å†…å­˜é…ç½®å»ºè®®

æœºå™¨å†…å­˜

JVMå †å†…å­˜

å¹¶è¡Œåº¦

Batch Size

4G

\-Xmx2g -Xms1g

2

500

8G

\-Xmx4g -Xms2g

4

1000

16G

\-Xmx8g -Xms4g

8

2000

32G

\-Xmx16g -Xms8g

16

5000

2ä½¿ç”¨
---

*   mysqlå®˜æ–¹æ–‡æ¡£  
    [https://seatunnel.apache.org/docs/2.3.3/connector-v2/source/Mysql](https://seatunnel.apache.org/docs/2.3.3/connector-v2/source/Mysql)  
    [https://seatunnel.apache.org/docs/2.3.3/connector-v2/sink/Mysql](https://seatunnel.apache.org/docs/2.3.3/connector-v2/sink/Mysql)

### 2.1ã€ç‰¹æ®Šå‚æ•°è¯´æ˜

#### source

*   2.3.x æ–°ç‰ˆæœ¬ï¼šå¿…é¡»ä½¿ç”¨ queryï¼Œä¸å†æ”¯æŒ table å‚æ•°

#### sink

*   generate\_sink\_sql = trueï¼šç”Ÿæˆè‡ªåŠ¨æ’å…¥sqlã€‚å¦‚æœç›®æ ‡åº“æ²¡æœ‰è¡¨ï¼Œä¹Ÿä¼šè‡ªåŠ¨å»ºè¡¨

### 2.2ã€libä¸‹å¢åŠ jdbcçš„åŒ…ï¼ˆmysqlå¿…é¡»ï¼‰

*   ä½¿ç”¨mysqlçš„è¯ï¼Œéœ€è¦æ‹·è´jaråŒ…åˆ°**seatunnelå®‰è£…åŒ…/lib** ä¸‹  
    1ã€[https://seatunnel.apache.org/docs/2.3.3/connector-v2/source/Mysql](https://seatunnel.apache.org/docs/2.3.3/connector-v2/source/Mysql)  
    2ã€[https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.33/mysql-connector-java-8.0.33.jar](https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.33/mysql-connector-java-8.0.33.jar)

![image](https://img2024.cnblogs.com/blog/1848807/202511/1848807-20251128140927516-1904302756.png)

### 2.3ã€å¢åŠ æµ‹è¯•æ•°æ®

    -- mysqlå»ºè¡¨
    CREATE TABLE `t_8_100w`  (
      `id` bigint NOT NULL COMMENT 'ä¸»é”®',
      `name` varchar(2000) NULL COMMENT 'åå­—',
      `sex` int null COMMENT 'æ€§åˆ«ï¼š1ç”·ï¼›2å¥³',
      `decimal_f` decimal(32, 6) NULL COMMENT 'å¤§æ•°å­—',
      `phone_number` varchar(20) DEFAULT '13456780000' COMMENT 'ç”µè¯',
      `age` varchar(255) NULL COMMENT 'å­—ç¬¦ä¸²å¹´é¾„è½¬æ•°å­—',
      `create_time` timestamp DEFAULT CURRENT_TIMESTAMP COMMENT 'æ–°å¢æ—¶é—´',
      `description` longtext NULL COMMENT 'å¤§æ–‡æœ¬',
      `address` varchar(2000) NULL COMMENT 'ç©ºåœ°å€è½¬é»˜è®¤å€¼ï¼šæœªçŸ¥',
      PRIMARY KEY (`id`)
    );
    
    -- æ–°å¢å­˜å‚¨è¿‡ç¨‹
    DELIMITER $$
    CREATE PROCEDURE InsertMultipleRows_Batch(
        IN start_id INT,        -- èµ·å§‹ID
        IN end_id INT,          -- ç»“æŸID
        IN batch_size INT       -- æ‰¹æ¬¡å¤§å°
    )
    BEGIN
        DECLARE i INT DEFAULT start_id;
        DECLARE description_text LONGTEXT;
        DECLARE address_text VARCHAR(255);
    		DECLARE sex_text INT;
        DECLARE total_to_insert INT;
        
        SET total_to_insert = end_id - start_id;
        
        -- å¼€å§‹äº‹åŠ¡
        START TRANSACTION;
        
        WHILE i < end_id DO
            -- ç”Ÿæˆç²¾ç¡®çš„1KBæ–‡æœ¬
            SET description_text = REPEAT(CONCAT('DataX_Test_Text_', i, '_ABCDEFGHIJKLMN_'), 41);
            
            -- æ ¹æ®i%2ç”Ÿæˆåœ°å€
            IF i % 2 = 0 THEN
                SET address_text = CONCAT('åœ°å€', i);
    						SET sex_text = 1;
            ELSE
                SET address_text = NULL;
    						SET sex_text = 2;
            END IF;
            
            -- æ’å…¥æ•°æ®
            INSERT INTO t_8_100w (`id`, `name`, `sex`, `decimal_f`, `age`, `description`, `address`) 
            VALUES (
                i, 
                CONCAT('åå­—', i), 
    						sex_text,
                i + 0.000001, 
                ROUND((RAND() * 12) + 18),
                description_text,
                address_text
            );
            
            SET i = i + 1;
            
            -- æ¯batch_sizeæ¡æäº¤ä¸€æ¬¡
            IF i % batch_size = 0 OR i = end_id THEN
                COMMIT;
                IF i < end_id THEN
                    START TRANSACTION;
                END IF;
                
                -- æ˜¾ç¤ºè¿›åº¦
                IF i % 50000 = 0 OR i = end_id THEN
                    SELECT CONCAT('æ‰¹æ¬¡ ', start_id, '-', end_id, ': å·²æ’å…¥ ', i - start_id, ' / ', total_to_insert, ' æ¡è®°å½•') AS progress;
                END IF;
            END IF;
        END WHILE;
        
        SELECT CONCAT('æ‰¹æ¬¡å®Œæˆ! IDèŒƒå›´: ', start_id, ' åˆ° ', end_id - 1, ' (å…±', total_to_insert, 'æ¡)') AS batch_complete;
    END$$
    DELIMITER ;
    
    -- åˆ†åˆ«æ‰§è¡Œæ–°å¢æ•°æ®
    -- æµ‹è¯•1ä¸‡æ¡
    CALL InsertMultipleRows_Batch(0, 10000, 500);
    -- æ¯10ä¸‡æ¡åˆ›å»ºä¸€æ¬¡ï¼Œåˆ†æ‰¹æ‰§è¡Œ
    CALL InsertMultipleRows_Batch(10000, 100000, 1000);
    CALL InsertMultipleRows_Batch(100000, 200000, 1000);
    CALL InsertMultipleRows_Batch(200000, 300000, 1000);
    CALL InsertMultipleRows_Batch(300000, 400000, 1000);
    CALL InsertMultipleRows_Batch(400000, 500000, 1000);
    CALL InsertMultipleRows_Batch(500000, 600000, 1000);
    CALL InsertMultipleRows_Batch(600000, 700000, 1000);
    CALL InsertMultipleRows_Batch(700000, 800000, 1000);
    CALL InsertMultipleRows_Batch(800000, 900000, 1000);
    CALL InsertMultipleRows_Batch(900000, 1000000, 1000);
    

### 2.4ã€DEMO1ï¼ˆç›´æ¥æŠŠé‡‡é›†æ•°æ®æ‰“å°åˆ°æ§åˆ¶é¢æ¿ï¼‰

    # test2mysql.conf - æµ‹è¯•æºæ•°æ®
    env {
      # å¹¶è¡Œåº¦ï¼ˆçº¿ç¨‹æ•°ï¼‰
      execution.parallelism = 2
      job.mode = "BATCH"
    }
    
    source {
      Jdbc {
        url = "jdbc:mysql://ip:port/Cs1"
        driver = "com.mysql.cj.jdbc.Driver"
        user = "root"
        password = "******"
        query = "select * from t_sea_01"
        
        # è¿æ¥å‚æ•°
        connection_check_timeout_sec = 300
        properties = {
          useUnicode = true
          characterEncoding = "utf8"
          serverTimezone = "Asia/Shanghai"
        }
      }
    }
    
    sink {
      Console {}
    }
    

æ‰§è¡Œå‘½ä»¤

    ./data/seatunnel/apache-seatunnel-2.3.12/bin/seatunnel.sh --config ./data/seatunnel/myconf/test2mysql.conf -m local
    

æŸ¥çœ‹ç»“æœ  
![image](https://img2024.cnblogs.com/blog/1848807/202511/1848807-20251128151931429-1452854653.png)  
çœŸèƒŒCPUå•Šï¼ˆ2æ ¸äº‘æœåŠ¡å™¨ï¼‰  
![image](https://img2024.cnblogs.com/blog/1848807/202511/1848807-20251128154900697-961747996.png)

### 2.5ã€DEMO2(mysql2mysqlçš„ä¸åŒåº“)

*   å¯ä»¥æµ‹è¯•è‡ªåŠ¨å»ºè¡¨

    -- åœ¨mysqlå¦ä¸€ä¸ªæ•°æ®åº“æ‰§è¡Œ
    CREATE TABLE `t_8_100w_import`  (
      `id` bigint NOT NULL COMMENT 'ä¸»é”®',
      `name` varchar(2000) NULL COMMENT 'åå­—',
      `sex` int null COMMENT 'æ€§åˆ«ï¼š1ç”·ï¼›2å¥³',
      `decimal_f` decimal(32, 6) NULL COMMENT 'å¤§æ•°å­—',
      `phone_number` varchar(20) COMMENT 'ç”µè¯',
      `age` varchar(255) NULL COMMENT 'å­—ç¬¦ä¸²å¹´é¾„è½¬æ•°å­—',
      `create_time` timestamp COMMENT 'æ–°å¢æ—¶é—´',
      `description` longtext NULL COMMENT 'å¤§æ–‡æœ¬',
      `address` varchar(2000) NULL COMMENT 'ç©ºåœ°å€è½¬é»˜è®¤å€¼ï¼šæœªçŸ¥',
      PRIMARY KEY (`id`)
    );
    

*   confæ–‡ä»¶

    # mysql2mysql.conf
    # 2025-11-28 16:47:47
    # 
    env {
      execution.parallelism = 8
      job.mode = "BATCH"
    }
    
    source {
      Jdbc {
        url = "jdbc:mysql://ip:13306/Cs1"
        driver = "com.mysql.cj.jdbc.Driver"
        user = "root"
        password = "abc123"
        query = "select * from t_8_100w"
        
        # å¹¶è¡Œè¯»å–é…ç½®
        # æ•°å€¼å‹ä¸»é”®å­—æ®µ
        partition_column = "id"
        # åˆ†ç‰‡æ•°ï¼ŒåŒ¹é…å¹¶è¡Œåº¦
        partition_num = 8
        # partition_lower_bound = 1     # å¯é€‰ï¼šèµ·å§‹ID
        # partition_upper_bound = 1000000 # å¯é€‰ï¼šç»“æŸID
        fetch_size = 500
        
        # è¿æ¥å‚æ•°
        # è¿æ¥è¶…æ—¶æ—¶é—´300ms
        connection_check_timeout_sec = 300
        properties = {
          useUnicode = true
          characterEncoding = "utf8"
          serverTimezone = "Asia/Shanghai"
          # ä½¿ç”¨æ¸¸æ ‡æé«˜å¤§ç»“æœé›†æ€§èƒ½
          useCursorFetch = "true"
          # æ¯æ¬¡è·å–è¡Œæ•°
          defaultFetchSize = "500"
        }
      }
    }
    
    transform {}
    
    sink {
      jdbc {
        url = "jdbc:mysql://ip:13306/Cs2"
        driver = "com.mysql.cj.jdbc.Driver"
        user = "root"
        password = "abc123"
        # query = "insert into test_table(name,age) values(?,?)"
        # ç”Ÿæˆè‡ªåŠ¨æ’å…¥sqlã€‚å¦‚æœç›®æ ‡åº“æ²¡æœ‰è¡¨ï¼Œä¹Ÿä¼šè‡ªåŠ¨å»ºè¡¨
        generate_sink_sql = true
        # generate_sink_sql=trueã€‚æ‰€ä»¥ï¼šdatabaseå¿…é¡»è¦
        database = Cs2
        table = "t_8_100w_import"
        
        # æ‰¹é‡å†™å…¥æ¡æ•°
        batch_size = 500
        # æ‰¹æ¬¡æäº¤é—´éš”
        batch_interval_ms = 500
        # é‡è¯•æ¬¡æ•°
        max_retries = 3
        
        # è¿æ¥å‚æ•°
        # è¿æ¥è¶…æ—¶æ—¶é—´300ms
        connection_check_timeout_sec = 300
        properties = {
          useUnicode = true
          characterEncoding = "utf8"
          serverTimezone = "Asia/Shanghai"
          
          # å…³é”®ï¼šå¯ç”¨æ‰¹é‡é‡å†™
          rewriteBatchedStatements = "true"
          # å¯ç”¨å‹ç¼©
          useCompression = "true"
          # ç¦ç”¨æœåŠ¡ç«¯é¢„å¤„ç†
          useServerPrepStmts = "false"
        }
      }
    }
    

*   æ‰§è¡Œå‘½ä»¤

    ./data/seatunnel/apache-seatunnel-2.3.12/bin/seatunnel.sh --config ./data/seatunnel/myconf/mysql2mysql.conf -m local
    
    # åå°æ‰“å°æ—¥å¿—æ‰§è¡Œ
    nohup /data/seatunnel/apache-seatunnel-2.3.12/bin/seatunnel.sh --config ./data/seatunnel/myconf/mysql2mysql.conf -m local > /data/seatunnel/logs/seatunnel.log 2>&1 &
    

### 2.5ã€DEMO3(mysql2mysqlâ€”â€”å­—æ®µæ˜ å°„ã€æ¸…æ´—ã€è½¬æ¢)

*   ç­‰æœ‰ç©ºäº†å†åš

å‚è€ƒ
--

[https://www.jb51.net/program/2850931un.htm](https://www.jb51.net/program/2850931un.htm)  
[https://www.cnblogs.com/robots2/p/17939863](https://www.cnblogs.com/robots2/p/17939863)

posted on 2025-11-28 16:58Â  [C\_C\_èœå›­](https://www.cnblogs.com/kakarotto-chen)Â  é˜…è¯»(60)Â  è¯„è®º(0)Â  Â  [æ”¶è—](javascript:void\(0\))Â  [ä¸¾æŠ¥](javascript:void\(0\))