---
layout: post
title: 'ã€æ¸²æŸ“æµæ°´çº¿ã€‘[å‡ ä½•é˜¶æ®µ]-[é¡¶ç‚¹ç€è‰²]ä»¥UnityURPä¸ºä¾‹'
date: "2025-08-13T00:43:38Z"
---
ã€æ¸²æŸ“æµæ°´çº¿ã€‘\[å‡ ä½•é˜¶æ®µ\]-\[é¡¶ç‚¹ç€è‰²\]ä»¥UnityURPä¸ºä¾‹
===================================

![ã€æ¸²æŸ“æµæ°´çº¿ã€‘[å‡ ä½•é˜¶æ®µ]-[é¡¶ç‚¹ç€è‰²]ä»¥UnityURPä¸ºä¾‹](https://img2024.cnblogs.com/blog/3685400/202508/3685400-20250812160701253-568568307.png) URPé¡¶ç‚¹ç€è‰²å™¨æ ¸å¿ƒå›´ç»•ç©ºé—´å˜æ¢ä½“ç³»å±•å¼€ï¼Œé€šè¿‡æ¨¡å‹çŸ©é˜µ(M)ã€è§‚å¯ŸçŸ©é˜µ(V)ã€æŠ•å½±çŸ©é˜µ(P)ä¸‰çº§è”è¿ç®—å®ç°æ¨¡å‹ç©ºé—´åˆ°è£å‰ªç©ºé—´è½¬æ¢ã€‚å…¶ç‰¹æœ‰å®ç°åŒ…å«TransformObjectToWorldç­‰ä¸“ç”¨å®æ›¿ä»£ä¼ ç»Ÿå‡½æ•°ï¼Œå¹¶å¼ºåˆ¶ä½¿ç”¨Varyings/Attributesç»“æ„ä½“å‘½åè§„èŒƒã€‚æ•°æ®å¤„ç†æ¨¡å—è´Ÿè´£æ³•çº¿/åˆ‡çº¿è®¡ç®—åŠTEXCOORDå¤šé€šé“UVä¼ é€’ï¼Œé€šè¿‡è¯­ä¹‰ç»‘å®šç±»è‡ªåŠ¨å…³è”è¾“å…¥è¾“å‡ºæ•°æ®ã€‚

*   **ä½œç”¨**â€Œï¼šå¤„ç†æ¨¡å‹é¡¶ç‚¹æ•°æ®ï¼ˆåæ ‡ã€æ³•çº¿ã€UVï¼‰ï¼Œè¾“å‡ºè£å‰ªç©ºé—´ä½ç½®ï¼ˆå¦‚é¡¶ç‚¹çš„MVPçŸ©é˜µè½¬æ¢é¡¶ç‚¹ä»æ¨¡å‹ç©ºé—´åˆ°è£å‰ªç©ºé—´ï¼‰ã€‚
*   **è£å‰ªç©ºé—´**â€Œï¼šMVPå˜æ¢çš„ç»ˆç‚¹ï¼Œé¡¶ç‚¹åæ ‡æœªå½’ä¸€åŒ–ï¼Œéœ€ä¿ç•™wåˆ†é‡ç”¨äºæ·±åº¦è®¡ç®—â€Œ
*   â€Œ**å¯é…ç½®**â€Œï¼šé€šè¿‡ Shader ä»£ç é‡å†™é¡¶ç‚¹å‡½æ•°ï¼ˆå¦‚Â `#pragma vertex vert`ï¼‰ã€‚

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

æ ¸å¿ƒåŠŸèƒ½
====

*   **é¡¶ç‚¹å˜æ¢â€Œ**ï¼šå°†æ¨¡å‹ç©ºé—´é¡¶ç‚¹ä½ç½®è½¬æ¢ä¸ºé½æ¬¡è£å‰ªç©ºé—´åæ ‡ï¼ˆpositionOS â†’ positionHCSï¼‰ï¼Œè¿™æ˜¯æ¸²æŸ“çš„åŸºç¡€æ­¥éª¤ã€‚é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„ SV\_POSITION è¯­ä¹‰å˜é‡å†³å®šäº†æœ€ç»ˆå±å¹•ä½ç½®ã€‚
*   â€Œ**æ•°æ®é¢„å¤„ç†â€Œ**ï¼šè®¡ç®—æ³•çº¿ã€åˆ‡çº¿ã€UV ç­‰å±æ€§ï¼Œå¹¶ä¼ é€’ç»™ç‰‡å…ƒç€è‰²å™¨è¿›è¡Œå…‰ç…§æˆ–çº¹ç†é‡‡æ ·ã€‚ä¾‹å¦‚ï¼Œå¯¹ UV è¿›è¡Œ Tilling å’Œ Offset æ“ä½œä»¥é€‚åº”è´´å›¾é‡å¤ã€‚
*   â€Œ**æ’å€¼æ•°æ®ç”Ÿæˆâ€Œ**ï¼šä¸ºç‰‡å…ƒç€è‰²å™¨å‡†å¤‡æ’å€¼æ•°æ®ï¼ˆå¦‚å…‰ç…§è´´å›¾åæ ‡ã€é›¾æ•ˆæ··åˆå› å­ï¼‰ï¼Œç¡®ä¿ä¸‰è§’é¢ç‰‡å†…å±æ€§çš„å¹³æ»‘è¿‡æ¸¡ã€‚

å…³é”®æŠ€æœ¯åº”ç”¨â€Œ
=======

*   â€Œ**GPU Instancing æ”¯æŒâ€Œ**ï¼šé€šè¿‡ UNITY\_MATRIX\_MVP ç­‰å®å¤„ç†å®ä¾‹åŒ–å¯¹è±¡çš„å˜æ¢çŸ©é˜µï¼Œæå‡æ‰¹é‡æ¸²æŸ“æ•ˆç‡ã€‚
*   â€Œ**ç‰¹æ•ˆå®ç°â€Œï¼š**
    *   **é¡¶ç‚¹åç§»â€Œ**ï¼šåŠ¨æ€ä¿®æ”¹é¡¶ç‚¹ä½ç½®ï¼ˆå¦‚ v.positionOS.x += sin(\_Time.y)ï¼‰ï¼Œå®ç°æ¨¡å‹æ‰­æ›²ã€å¹½çµæ•ˆæœç­‰åŠ¨æ€è§†è§‰ã€‚
    *   **æè¾¹æŠ€æœ¯â€Œ**ï¼šé€šè¿‡å¹³æ»‘æ³•çº¿è®¡ç®—ï¼ˆå­˜å‚¨åœ¨é¡¶ç‚¹è‰²ä¸­ï¼‰å¹¶å¤–æ‰©é¡¶ç‚¹ï¼Œå®ç°å¡é€šæ¸²æŸ“ä¸­çš„æè¾¹æ•ˆæœï¼Œé¿å…å°–ç«¯æ–­è£‚é—®é¢˜

æ³¨æ„äº‹é¡¹â€Œ
=====

*   **ç©ºé—´è½¬æ¢é¡ºåºâ€Œ**ï¼šé€è§†çŸ«æ­£æ’å€¼å¿…é¡»åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è¿›è¡Œï¼Œé¡¶ç‚¹ç€è‰²å™¨ä¸­ç›´æ¥ä½¿ç”¨å±å¹•åæ ‡ä¼šå¯¼è‡´é”™è¯¯ã€‚
*   **æ¸²æŸ“æµç¨‹è§¦å‘â€Œ**ï¼šé€šè¿‡ CommandBuffer æäº¤ç»˜åˆ¶å‘½ä»¤åï¼ŒGPU è‡ªåŠ¨æ‰§è¡Œé¡¶ç‚¹ç€è‰²å™¨ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨

**é¡¶ç‚¹çš„ç©ºé—´è½¬æ¢**
===========

*   **ç©ºé—´è½¬æ¢çš„å¿…è¦æ€§**
    
    åœ¨æ¸²æŸ“ç®¡çº¿ä¸­ï¼Œé¡¶ç‚¹æ•°æ®éœ€è¦ç»å†å¤šæ¬¡åæ ‡å˜æ¢æ‰èƒ½æœ€ç»ˆå‘ˆç°åœ¨å±å¹•ä¸Šã€‚ç©ºé—´è½¬æ¢çš„æ ¸å¿ƒç›®çš„æ˜¯ï¼š
    
    1.  **ç»Ÿä¸€è®¡ç®—åŸºå‡†**ï¼šå°†æ¨¡å‹ã€å…‰ç…§ã€ç›¸æœºç­‰æ•°æ®å¯¹é½åˆ°åŒä¸€åæ ‡ç³»
    2.  **ä¼˜åŒ–æ¸²æŸ“æ•ˆç‡**ï¼šè£å‰ªç©ºé—´è½¬æ¢åå¯ç›´æ¥è¿›è¡Œè§†é”¥å‰”é™¤
    3.  **å®ç°è§†è§‰æ•ˆæœ**ï¼šå¦‚é€è§†æŠ•å½±ã€æ³•çº¿è´´å›¾ç­‰ç‰¹æ•ˆä¾èµ–ç‰¹å®šç©ºé—´çš„è®¡ç®—
*   **æ¨¡å‹çŸ©é˜µï¼ˆMçŸ©é˜µï¼‰**
    
    ç›¸å…³ç©ºé—´ï¼šæ¨¡å‹ç©ºé—´ â†’ ä¸–ç•Œç©ºé—´
    
    *   **ä½œç”¨**ï¼šå°†é¡¶ç‚¹ä»æ¨¡å‹å±€éƒ¨åæ ‡ç³»è½¬æ¢åˆ°å…¨å±€ä¸–ç•Œåæ ‡ç³»
        
    *   **å¿…è¦æ€§**â€Œï¼š
        
        æ¨¡å‹ç©ºé—´ï¼ˆå±€éƒ¨åæ ‡ï¼‰ä»…æè¿°ç‰©ä½“è‡ªèº«ç»“æ„ï¼Œä½†åœºæ™¯ä¸­æ‰€æœ‰ç‰©ä½“éœ€ç»Ÿä¸€å‚è€ƒç³»è¿›è¡Œäº¤äº’ï¼ˆå¦‚å…‰ç…§ã€ç¢°æ’ï¼‰ã€‚
        
    *   â€Œ**åŠŸèƒ½**â€Œï¼š
        
        *   â€Œ**å…¨å±€å®šä½**â€Œï¼šç‰©ä½“ä½ç½®ã€æ—‹è½¬ã€ç¼©æ”¾ç»Ÿä¸€åˆ°ä¸–ç•Œåæ ‡ç³»ï¼Œå®ç°åœºæ™¯å¸ƒå±€ã€‚
            
        *   â€Œ**ç‰©ç†è®¡ç®—**â€Œï¼šå…‰ç…§æ–¹å‘ï¼ˆå¦‚å¹³è¡Œå…‰ï¼‰ã€ç¢°æ’æ£€æµ‹ä¾èµ–ä¸–ç•Œåæ ‡ã€‚
            
        *   â€Œ**ç©ºé—´å…³ç³»**â€Œï¼šè®¡ç®—ç‰©ä½“é—´è·ç¦»æˆ–ç›¸å¯¹æ–¹å‘ï¼ˆå¦‚ç²’å­ç‰¹æ•ˆè·Ÿéšï¼‰ã€‚
            
        *   **å…³é”®å‚æ•°**ï¼š
            
            `unity_ObjectToWorld // æ¨¡å‹â†’ä¸–ç•ŒçŸ©é˜µ unity_WorldToObject // ä¸–ç•Œâ†’æ¨¡å‹é€†çŸ©é˜µ`
            
    *   **å…¸å‹åº”ç”¨**ï¼š
        
        *   è®¡ç®—ä¸–ç•Œåæ ‡ï¼š`mul(unity_ObjectToWorld, v.vertex)`
        *   æ³•çº¿è½¬æ¢éœ€ä½¿ç”¨é€†è½¬ç½®çŸ©é˜µï¼š`UnityObjectToWorldNormal()`
    
    æŠ€æœ¯ç»†èŠ‚ï¼š
    
    *   åŒ…å«æ—‹è½¬(R)ã€å¹³ç§»(T)ã€ç¼©æ”¾(S)åˆ†é‡ï¼š**M = T Ã— R Ã— S**
    *   éç»Ÿä¸€ç¼©æ”¾ä¼šå¯¼è‡´æ³•çº¿æ‰­æ›²ï¼Œå¿…é¡»ç‰¹æ®Šå¤„ç†
*   **è§‚å¯ŸçŸ©é˜µï¼ˆVçŸ©é˜µï¼‰**
    
    ç›¸å…³ç©ºé—´ï¼šä¸–ç•Œç©ºé—´ â†’ è§‚å¯Ÿç©ºé—´
    
    *   **ä½œç”¨**ï¼šä»¥æ‘„åƒæœºä¸ºåŸç‚¹å»ºç«‹å³æ‰‹åæ ‡ç³»
        
    *   **å¿…è¦æ€§**â€Œï¼š
        
        ä¸–ç•Œåæ ‡éœ€è½¬æ¢ä¸ºä»¥æ‘„åƒæœºä¸ºåŸç‚¹çš„åæ ‡ç³»ï¼Œç¡®å®šé¡¶ç‚¹ç›¸å¯¹äºæ‘„åƒæœºçš„å¯è§æ€§ã€‚
        
    *   â€Œ**åŠŸèƒ½**â€Œï¼š
        
        *   â€Œ**è£å‰ªå‡†å¤‡**â€Œï¼šåç»­è£å‰ªæ“ä½œéœ€åŸºäºæ‘„åƒæœºè§†è§’ï¼ˆå¦‚è§†é”¥ä½“è£å‰ªï¼‰ã€‚
        *   â€Œ**è§†è§’ç›¸å…³æ•ˆæœ**â€Œï¼šå®ç°è¾¹ç¼˜å…‰ã€é›¾æ•ˆç­‰ä¾èµ–è§†è§’æ–¹å‘çš„ç‰¹æ•ˆã€‚
        *   **é€è§†æ ¡æ­£**â€Œï¼šé½æ¬¡é™¤æ³•ï¼ˆ`x/w, y/w`ï¼‰å®ç°è¿‘å¤§è¿œå°æ•ˆæœã€‚
        *   **æ·±åº¦ç¼“å†²**â€Œï¼š`z/w`Â ç”Ÿæˆæ ‡å‡†åŒ–æ·±åº¦å€¼ \[0,1\]ï¼Œç”¨äºé®æŒ¡æ’åºã€‚
        *   â€Œ**ç®€åŒ–æŠ•å½±**â€Œï¼šè§‚å¯Ÿç©ºé—´æ˜¯æŠ•å½±å˜æ¢çš„è¾“å…¥åŸºå‡†ã€‚
        *   **ç‰¹æ€§**ï¼š
            *   Zè½´æŒ‡å‘æ‘„åƒæœºå‰æ–¹
            *   åæ ‡ç³»åŸç‚¹åœ¨æ‘„åƒæœºä½ç½®
    *   **URPæ¥å£**ï¼š
        
        `UNITY_MATRIX_V // ä¸–ç•Œâ†’è§‚å¯ŸçŸ©é˜µ GetWorldSpaceViewDir() // è·å–è§‚å¯Ÿæ–¹å‘`
        
    
    è®¡ç®—åŸç†ï¼š
    
    *   ç”±æ‘„åƒæœºä½ç½®/æ—‹è½¬å‚æ•°æ„å»º
    *   å®é™…æ˜¯**ä¸–ç•Œâ†’è§‚å¯Ÿ**çš„é€†å˜æ¢
*   **æŠ•å½±çŸ©é˜µï¼ˆPçŸ©é˜µï¼‰**
    
    ç›¸å…³ç©ºé—´ï¼šè§‚å¯Ÿç©ºé—´ â†’ è£å‰ªç©ºé—´
    
    *   **æ ¸å¿ƒåŠŸèƒ½**ï¼š
        1.  é€è§†/æ­£äº¤æŠ•å½±è½¬æ¢
        2.  å®šä¹‰è§†é”¥ä½“èŒƒå›´ï¼ˆè¿‘/è¿œè£å‰ªé¢ï¼‰
        3.  ç”Ÿæˆé½æ¬¡åæ ‡ï¼ˆwåˆ†é‡ç”¨äºé€è§†é™¤æ³•ï¼‰
    *   **URPå®ç°**ï¼š

`UNITY_MATRIX_P // è§‚å¯Ÿâ†’è£å‰ªçŸ©é˜µ UnityObjectToClipPos() // æ•´åˆMVPçš„å¿«æ·å®`  
é€è§†çŸ©é˜µç‰¹æ€§ï¼š

*   äº§ç”Ÿè¿‘å¤§è¿œå°æ•ˆæœ
    
*   è®¡ç®—å…¬å¼ï¼š
    
*   `[x'] = [ (2n)/(r-l) 0 (r+l)/(r-l) 0 ] [x]`
    
*   `[y'] = [ 0 (2n)/(t-b) (t+b)/(t-b) 0 ] [y]`
    
*   `[y'] = [ 0 (2n)/(t-b) (t+b)/(t-b) 0 ] [y]`
    
*   `[w'] = [ 0 0 -1 0 ] [w]`
    
*   **çŸ©é˜µç»„åˆä¸åº”ç”¨**
    
    1.  **å®Œæ•´å˜æ¢é“¾**ï¼š
        
        `MVP = P Ã— V Ã— M`
        
        `clipPos = mul(UNITY_MATRIX_VP, mul(unity_ObjectToWorld, v.vertex))`
        
    2.  **URPä¼˜åŒ–ç­–ç•¥**ï¼š
        
        *   é¢„è®¡ç®—VPçŸ©é˜µå‡å°‘ä¹˜æ³•æ¬¡æ•°
        *   ä½¿ç”¨`TransformXXX`ç³»åˆ—å®ä¿è¯è·¨å¹³å°ä¸€è‡´æ€§
    3.  **è°ƒè¯•æŠ€å·§**ï¼š
        
        *   é€šè¿‡Frame DebuggeréªŒè¯å„ç©ºé—´åæ ‡
        *   ä½¿ç”¨`Visualize Space`ç€è‰²å™¨è°ƒè¯•å·¥å…·
    
        // URP é¡¶ç‚¹ç€è‰²å™¨ç‰‡æ®µ
        v2f vert (Attributes v) {
            v2f o;
            // M è½¬æ¢ï¼šæ¨¡å‹ â†’ ä¸–ç•Œ
            float3 worldPos = TransformObjectToWorld(v.positionOS);
            // V è½¬æ¢ï¼šä¸–ç•Œ â†’ è§‚å¯Ÿ
            float3 viewPos = TransformWorldToView(worldPos);
            // P è½¬æ¢ï¼šè§‚å¯Ÿ â†’ è£å‰ª
            o.positionCS = TransformWViewToHClip(viewPos);
            return o;
        }
        
    

URP é¡¶ç‚¹ç€è‰²å™¨ä¸­å…³é”®åŠŸèƒ½
==============

*   **MVPçŸ©é˜µåº”ç”¨â€Œ**
    
    *   â€Œ**æ¨¡å‹ç©ºé—´â†’è£å‰ªç©ºé—´è½¬æ¢**â€Œä½¿ç”¨Â `UnityObjectToClipPos`Â å®ï¼ˆå†…éƒ¨å°è£… MVP çŸ©é˜µä¹˜æ³•ï¼‰å°†é¡¶ç‚¹åæ ‡è½¬æ¢åˆ°è£å‰ªç©ºé—´ï¼š
        
            hlsl
            v2f vert (appdata v) {
                v2f o;
                o.pos = UnityObjectToClipPos(v.vertex); // ç­‰æ•ˆäº mul(UNITY_MATRIX_VP, mul(unity_ObjectToWorld, v.vertex))
                return o;
            }
            
        
    *   â€Œ**æ‰‹åŠ¨æ‹†åˆ†è®¡ç®—**â€Œï¼ˆéœ€å¤„ç†å®ä¾‹åŒ–ï¼‰ï¼š
        
            hlsl
            float4 worldPos = mul(unity_ObjectToWorld, v.vertex);
            o.pos = mul(UNITY_MATRIX_VP, worldPos);
            
        
*   **UVé‡‡æ ·ä¸å˜å½¢â€Œ**
    
    *   â€Œ**åŸºç¡€UVä¼ é€’**â€Œï¼šé€šè¿‡Â `TEXCOORD0`Â è¯­ä¹‰ä¼ é€’UVåæ ‡ï¼š
        
            hlsl
            struct v2f {
                float2 uv : TEXCOORD0;
                //...
            };
            o.uv = v.uv; // ç›´æ¥ä¼ é€’
            
        
    *   â€Œ**åŠ¨æ€UVåç§»**â€Œï¼ˆå¦‚æ°´æµæ•ˆæœï¼‰ï¼š
        
            hlsl
            o.uv = v.uv + float2(0, _Time.y * _Speed); // å‚ç›´æ»šåŠ¨
            
        
*   **æ³•çº¿å¤„ç†â€Œ**
    
    *   â€Œ**ä¸–ç•Œç©ºé—´æ³•çº¿è®¡ç®—**â€Œï¼šä½¿ç”¨Â `UnityObjectToWorldNormal`Â å®å¤„ç†éç»Ÿä¸€ç¼©æ”¾ï¼š
        
            hlsl
            o.worldNormal = UnityObjectToWorldNormal(v.normal); // è‡ªåŠ¨å¤„ç†é€†è½¬ç½®çŸ©é˜µ
            
        
    *   â€Œ**æ³•çº¿è´´å›¾æ”¯æŒ**â€Œï¼šä¼ é€’åˆ‡çº¿ç©ºé—´åŸºå‘é‡ï¼š
        
            hlsl
            o.tangent = UnityObjectToWorldDir(v.tangent.xyz);
            o.bitangent = cross(o.normal, o.tangent) * v.tangent.w;
            
        
*   **åˆ‡çº¿å¤„ç†â€Œ**
    
    *   â€Œ**åˆ‡çº¿ç©ºé—´è½¬æ¢**â€Œï¼šç”¨äºæ³•çº¿è´´å›¾é‡‡æ ·ï¼š
        
            hlsl
            struct appdata {
                float4 tangent : TANGENT; // åˆ‡çº¿ï¼ˆwåˆ†é‡å†³å®šå‰¯åˆ‡çº¿æ–¹å‘ï¼‰
            };
            v2f vert(appdata v) {
                o.tangent = mul(unity_ObjectToWorld, float4(v.tangent.xyz, 0)).xyz;
            }
            
        
*   **â€Œå¸¸ç”¨åŠŸèƒ½æ‰©å±•â€Œ**
    
    *   â€Œ**é¡¶ç‚¹åŠ¨ç”»**â€Œï¼ˆå¦‚æ­£å¼¦æ³¢åŠ¨ç”»ï¼‰ï¼š
        
            hlsl
            v.vertex.y += sin(_Time.y + v.vertex.x) * _Amplitude;
            
        
*   â€Œ**GPUå®ä¾‹åŒ–æ”¯æŒ**â€Œï¼šé€šè¿‡Â `UNITY_INSTANCING_BUFFER_START`Â å®ä¼ é€’å®ä¾‹æ•°æ®ã€‚
    
*   â€Œ**é›¾æ•ˆåæ ‡ç”Ÿæˆ**â€Œï¼šä½¿ç”¨Â `UNITY_TRANSFER_FOG`Â å®è®¡ç®—é›¾æ•ˆæ··åˆå› å­
    

URP é¡¶ç‚¹ç€è‰²å™¨ å†™æ³•ä¸å†…ç½®ç®¡çº¿çš„åŒºåˆ«
====================

Unity URP é¡¶ç‚¹ç€è‰²å™¨çš„å†™æ³•ç›¸è¾ƒå†…ç½®ç®¡çº¿æœ‰å¤šå¤„å…³é”®å·®å¼‚ï¼Œä¸»è¦ä½“ç°åœ¨å®å‡½æ•°ã€ç»“æ„å‘½åã€Passé…ç½®ã€æ–‡ä»¶åŒ…å«å’Œæ•°æ®ç±»å‹ä¸Šã€‚æ ¸å¿ƒåŒºåˆ«å¦‚ä¸‹ï¼š

*   â€Œ**åæ ‡å˜æ¢å®çš„ä½¿ç”¨**â€Œï¼š
    
    å†…ç½®ç®¡çº¿ä½¿ç”¨Â `UnityObjectToClipPos`ï¼ˆæˆ–æ—§ç‰ˆÂ `mul(UNITY_MATRIX_VP, ...)`ï¼‰è¿›è¡Œæ¨¡å‹åˆ°è£å‰ªç©ºé—´è½¬æ¢ï¼›URP ä¸­ä¹Ÿæ”¯æŒæ­¤å®ï¼Œä½†éœ€é€šè¿‡Â `HLSLPROGRAM`Â å£°æ˜å¹¶åŒ…å« URP ä¸“å±åº“æ–‡ä»¶ï¼ˆå¦‚Â `Core.hlsl`ï¼‰ã€‚
    
        hlsl
        // URP é¡¶ç‚¹ç€è‰²å™¨ç¤ºä¾‹
        v2f vert (Attributes v) {
            v2f o;
            o.vertex = TransformObjectToHClip(v.positionOS); // URP ä¸“ç”¨å®
            return o;
        }
        
    
*   â€Œ**è¾“å…¥è¾“å‡ºç»“æ„å‘½åæƒ¯ä¾‹**â€Œï¼š
    
    å†…ç½®ç®¡çº¿å¸¸ç”¨Â `appdata`ï¼ˆè¾“å…¥ï¼‰å’ŒÂ `v2f`ï¼ˆè¾“å‡ºï¼‰ç»“æ„ä½“3ï¼›URP æ¨èæ”¹ç”¨Â `Attributes`ï¼ˆè¾“å…¥ï¼‰å’ŒÂ `Varying`ï¼ˆè¾“å‡ºï¼‰ä½œä¸ºå‘½åçº¦å®šï¼Œä½†éå¼ºåˆ¶è¦æ±‚ã€‚
    
*   â€Œ**Pass æ ‡ç­¾ä¸å…‰ç…§å¤„ç†**â€Œï¼š
    
    å†…ç½®ç®¡çº¿ä¾èµ–å¤š Pass å¤„ç†å…‰æºï¼ˆæ¯ä¸ªåŠ¨æ€å…‰æºç‹¬ç«‹ Passï¼‰ï¼›URP é€šè¿‡å• Pass å‰å‘æ¸²æŸ“å®ç°å…‰æºè®¡ç®—ï¼ŒPass æ ‡ç­¾éœ€è®¾ä¸ºÂ `"LightMode"="UniversalForward"`Â æˆ–çœç•¥ï¼ˆé»˜è®¤Â `"SRPDefaultUnlit"`ï¼‰ã€‚
    
*   â€Œ**æ–‡ä»¶åŒ…å«ä¸ç¼–ç¨‹å—**â€Œï¼š
    
    å†…ç½®ç®¡çº¿ä½¿ç”¨Â `CGPROGRAM/ENDCG`Â å¹¶åŒ…å«Â `UnityCG.cginc`ï¼›URP å¿…é¡»æ”¹ç”¨Â `HLSLPROGRAM/ENDHLSL`ï¼Œå¹¶åŒ…å« URP åº“æ–‡ä»¶ï¼ˆå¦‚Â `Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl`ï¼‰ï¼Œä»¥é¿å…å®å†²çªã€‚
    
*   â€Œ**æ•°æ®ç±»å‹é™åˆ¶**â€Œï¼š
    
    å†…ç½®ç®¡çº¿æ”¯æŒÂ `fixed`Â ç²¾åº¦ç±»å‹ï¼›URP ä¸­éœ€æ›¿æ¢ä¸ºÂ `half`ï¼ˆä¸­ç­‰ç²¾åº¦ï¼‰ã€‚
    
*   â€Œ**ä¸æ”¯æŒçš„ç‰¹æ€§**â€Œï¼š
    
    URP å®Œå…¨å¼ƒç”¨è¡¨é¢ç€è‰²å™¨ï¼ˆ`#pragma surface`ï¼‰ï¼Œä»…æ”¯æŒé¡¶ç‚¹/ç‰‡å…ƒç€è‰²å™¨ï¼›åŒæ—¶ä¸æ”¯æŒÂ `GrabPass`ï¼Œéœ€æ”¹ç”¨ç›¸æœºä¸é€æ˜çº¹ç†æˆ–è‡ªå®šä¹‰æ¸²æŸ“å‘½ä»¤å®ç°ç±»ä¼¼æ•ˆæœ
    

URPä¸­è¯­ä¹‰è§£æçš„æ ¸å¿ƒæœºåˆ¶
=============

*   **â€Œè¯­ä¹‰è§£æçš„åº•å±‚ç±»â€Œ**
    
    *   â€Œ`ShaderPass`Â ä¸Â `ShaderCompiler`ï¼šURP é€šè¿‡Â `ShaderCompiler`Â è§£æ HLSL ä»£ç ä¸­çš„è¯­ä¹‰ï¼ˆå¦‚Â `POSITION`ã€`NORMAL`ï¼‰ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ° GPU è¾“å…¥æ§½ä½ã€‚`ShaderPass`Â è´Ÿè´£å°†è¯­ä¹‰ä¸æ¸²æŸ“ç®¡çº¿é˜¶æ®µç»‘å®šã€‚
    *   â€Œ`InputLayoutBuilder`ï¼šåœ¨ Unity åº•å±‚ï¼ˆå¦‚Â `InputLayoutBuilder`Â ç±»ï¼‰ä¸­ï¼Œè¯­ä¹‰ä¼šè¢«è½¬æ¢ä¸º Direct3D/OpenGL çš„é¡¶ç‚¹å±æ€§æè¿°ç¬¦ï¼Œå®šä¹‰æ•°æ®åœ¨ GPU å†…å­˜ä¸­çš„å¸ƒå±€ã€‚
*   **â€Œè‡ªåŠ¨è¯†åˆ«æœºåˆ¶â€Œ**
    
    *   â€Œ**ç³»ç»Ÿå€¼è¯­ä¹‰ SV\_å‰ç¼€**â€Œ
        *   `SV_POSITION`Â ç­‰ç³»ç»Ÿè¯­ä¹‰ç”± GPU é©±åŠ¨ç›´æ¥è¯†åˆ«ï¼Œå…‰æ …åŒ–é˜¶æ®µè‡ªåŠ¨è¯»å–å…¶å€¼è¿›è¡Œå±å¹•æ˜ å°„å’Œè£å‰ªã€‚
        *   ä¾‹å¦‚ï¼Œé¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„Â `SV_POSITION`Â ä¼šè¢«å›ºå®šç®¡çº¿ç”¨äºé€è§†é™¤æ³•å’Œè§†å£å˜æ¢ï¼Œæ— éœ€å¼€å‘è€…å¹²é¢„ã€‚
    *   â€Œ**è‡ªå®šä¹‰è¯­ä¹‰ å¦‚Â TEXCOORD0**â€Œ
        *   é€šè¿‡Â `VertexAttribute`Â ç‰¹æ€§æˆ– HLSL ç»“æ„ä½“å£°æ˜ï¼ŒURP åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨å…³è”æ’å€¼å™¨å¯„å­˜å™¨ï¼ˆå¦‚Â `TEXCOORD0`Â å¯¹åº”æ’å€¼å™¨ 0ï¼‰ã€‚
        *   å…‰æ …åŒ–é˜¶æ®µæ ¹æ®æ’å€¼è§„åˆ™ï¼ˆå¦‚é€è§†æ ¡æ­£ï¼‰ç”Ÿæˆç‰‡å…ƒæ•°æ®ï¼Œä¼ é€’ç»™ç‰‡å…ƒç€è‰²å™¨ã€‚
*   **â€Œç®¡çº¿é˜¶æ®µååŒâ€Œ**
    
    *   â€Œ**é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºåˆ°ç‰‡å…ƒç€è‰²å™¨**â€Œï¼š
        *   è¯­ä¹‰æ ‡è®°çš„æ•°æ®ï¼ˆå¦‚Â `TEXCOORD0`ï¼‰åœ¨å‡ ä½•é˜¶æ®µå¤„ç†åï¼Œç”±å…‰æ …åŒ–å™¨æ’å€¼ï¼Œæœ€ç»ˆè¢«ç‰‡å…ƒç€è‰²å™¨é€šè¿‡ç›¸åŒè¯­ä¹‰åè¯»å–ã€‚
    *   â€Œ**å¹³å°é€‚é…**â€Œï¼š
        *   URP çš„Â `ShaderLibrary`Â é€šè¿‡å®ï¼ˆå¦‚Â `UNITY_VERTEX_INPUT_INSTANCE_ID`ï¼‰å¤„ç†è·¨å¹³å°è¯­ä¹‰å·®å¼‚ï¼Œç¡®ä¿ Vulkan/Metal ç­‰ API å…¼å®¹ã€‚
*   **â€Œè°ƒè¯•ä¸éªŒè¯â€Œ**
    
    *   â€Œ**å¸§è°ƒè¯•å™¨Frame Debugger**â€Œï¼šå¯æŸ¥çœ‹è¯­ä¹‰æ•°æ®åœ¨ç®¡çº¿å„é˜¶æ®µçš„çŠ¶æ€ï¼ˆå¦‚é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„è£å‰ªç©ºé—´åæ ‡ï¼‰ã€‚
    *   â€Œ**Shader å˜ä½“æ—¥å¿—**â€Œï¼šé€šè¿‡Â `Shader Variant Log Level`Â æ£€æŸ¥è¯­ä¹‰æ˜¯å¦è¢«æ­£ç¡®å‰¥ç¦»æˆ–ä¿ç•™ã€‚
*   â€ŒURP é€šè¿‡Â `ShaderCompiler`Â å’Œåº•å±‚å›¾å½¢ API åä½œè§£æè¯­ä¹‰ï¼Œç³»ç»Ÿå€¼è¯­ä¹‰ç”±ç¡¬ä»¶è‡ªåŠ¨å¤„ç†ï¼Œè‡ªå®šä¹‰è¯­ä¹‰åˆ™é€šè¿‡æ’å€¼å™¨å¯„å­˜å™¨ä¼ é€’ï¼Œæœ€ç»ˆå®ç°æ•°æ®åœ¨ç®¡çº¿ä¸­çš„æµåŠ¨
    

**å¸¸ç”¨è¯­ä¹‰**
========

â€Œ**è¯­ä¹‰**â€Œ

â€Œ**æ•°æ®ç±»å‹**â€Œ

â€Œ**æè¿°**â€Œ

`POSITION`

`float3/float4`

æ¨¡å‹ç©ºé—´é¡¶ç‚¹åæ ‡â€Œ

`NORMAL`

`float3`

æ¨¡å‹ç©ºé—´æ³•çº¿å‘é‡â€Œ

`TANGENT`

`float4`

æ¨¡å‹ç©ºé—´åˆ‡çº¿å‘é‡ï¼ˆ`.w`åˆ†é‡å­˜å‚¨å‰¯åˆ‡çº¿æ–¹å‘æ ‡å¿—ï¼‰â€Œ

`TEXCOORDn`

`float2/float4`

é¡¶ç‚¹çº¹ç†åæ ‡ï¼ˆ`n=0-7`ï¼Œå¦‚`TEXCOORD0`è¡¨ç¤ºç¬¬ä¸€ç»„UVï¼‰â€Œ

`COLOR`

`fixed4/float4`

é¡¶ç‚¹é¢œè‰²â€Œ

`SV_VertexID`

`uint`

é¡¶ç‚¹ID

`SV_InstanceID`

`uint`

å®ä¾‹ID

**TEXCOORDå¸¸è§ç”¨é€”**
================

0: ä¸»UVåæ ‡  
1: å…‰ç…§è´´å›¾UV/æ¬¡UV  
2: åŠ¨æ€å…‰ç…§UV  
3: é¡¶ç‚¹åŠ¨ç”»æ•°æ®  
4: çƒ˜ç„™æ•°æ®/è‡ªå®šä¹‰æ•°æ®  
5: åœ°å½¢æ··åˆæƒé‡  
6: GPUå®ä¾‹åŒ–æ•°æ®  
7: è‡ªå®šä¹‰ç”¨é€”

**å±•ç¤ºäº†URPé¡¶ç‚¹ç€è‰²å™¨ä¸­æ‰€æœ‰å¸¸ç”¨è¯­ä¹‰çš„ä½¿ç”¨æ–¹å¼**
===========================

*   åŒ…å«äº†POSITION/NORMAL/TANGENTç­‰åŸºç¡€è¯­ä¹‰
    
*   æ¼”ç¤ºäº†TEXCOORD0-7çš„å…¸å‹ç”¨é€”åˆ†é…
    
*   ä½¿ç”¨äº†SV\_VertexIDå’ŒSV\_InstanceIDå®ç°ç‰¹æ®Šæ•ˆæœ
    
*   åŒ…å«äº†å®Œæ•´çš„URPç€è‰²å™¨ç»“æ„å’Œå¿…è¦çš„HLSLåŒ…å«æ–‡ä»¶
    
*   å±•ç¤ºäº†é¡¶ç‚¹ç€è‰²å™¨åˆ°ç‰‡æ®µç€è‰²å™¨çš„æ•°æ®ä¼ é€’æ–¹å¼
    
*   URPVertexShaderExample.shader
    
        // HLSL
        Shader "Custom/URPVertexShaderExample"
        {
            Properties
            {
                _MainTex ("Texture", 2D) = "white" {}
                _Color ("Color", Color) = (1,1,1,1)
            }
        
            SubShader
            {
                Tags { "RenderType"="Opaque" "RenderPipeline"="UniversalPipeline" }
                
                Pass
                {
                    HLSLPROGRAM
                    #pragma vertex vert
                    #pragma fragment frag
                    
                    #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
        
                    struct Attributes
                    {
                        float4 positionOS   : POSITION;
                        float3 normalOS     : NORMAL;
                        float4 tangentOS    : TANGENT;
                        float4 color        : COLOR;
                        float2 uv0          : TEXCOORD0;
                        float2 uv1          : TEXCOORD1;
                        float2 uv2          : TEXCOORD2;
                        float3 uv3          : TEXCOORD3;
                        float4 uv4          : TEXCOORD4;
                        float2 uv5          : TEXCOORD5;
                        float4 uv6          : TEXCOORD6;
                        float2 uv7          : TEXCOORD7;
                        uint vertexID       : SV_VertexID;
                        uint instanceID     : SV_InstanceID;
                    };
        
                    struct Varyings
                    {
                        float4 positionCS   : SV_POSITION;
                        float3 normalWS     : TEXCOORD0;
                        float4 tangentWS    : TEXCOORD1;
                        float4 color        : TEXCOORD2;
                        float2 uv           : TEXCOORD3;
                        float2 lightmapUV   : TEXCOORD4;
                        float3 dynamicLight : TEXCOORD5;
                        float3 animData     : TEXCOORD6;
                        float4 bakedData    : TEXCOORD7;
                    };
        
                    TEXTURE2D(_MainTex);
                    SAMPLER(sampler_MainTex);
                    CBUFFER_START(UnityPerMaterial)
                        float4 _MainTex_ST;
                        float4 _Color;
                    CBUFFER_END
        
                    Varyings vert(Attributes IN)
                    {
                        Varyings OUT;
                        
                        // ä½¿ç”¨æ‰€æœ‰è¾“å…¥è¯­ä¹‰
                        VertexPositionInputs positionInputs = GetVertexPositionInputs(IN.positionOS.xyz);
                        VertexNormalInputs normalInputs = GetVertexNormalInputs(IN.normalOS, IN.tangentOS);
                        
                        OUT.positionCS = positionInputs.positionCS;
                        OUT.normalWS = normalInputs.normalWS;
                        OUT.tangentWS = float4(normalInputs.tangentWS, IN.tangentOS.w);
                        OUT.color = IN.color * _Color;
                        
                        // å¤„ç†å„ç§UVç”¨é€”
                        OUT.uv = TRANSFORM_TEX(IN.uv0, _MainTex);  // ä¸»UV
                        OUT.lightmapUV = IN.uv1;                   // å…‰ç…§è´´å›¾UV
                        OUT.dynamicLight = float3(IN.uv2, 0);      // åŠ¨æ€å…‰ç…§æ•°æ®
                        OUT.animData = IN.uv3;                     // é¡¶ç‚¹åŠ¨ç”»æ•°æ®
                        OUT.bakedData = IN.uv4;                    // çƒ˜ç„™æ•°æ®
                        
                        // ä½¿ç”¨é¡¶ç‚¹IDå’Œå®ä¾‹IDè¿›è¡Œç‰¹æ®Šå¤„ç†
                        if (IN.vertexID % 2 == 0) {
                            OUT.color.rgb *= 0.9;
                        }
                        
                        if (IN.instanceID > 0) {
                            OUT.positionCS.y += sin(_Time.y * 2.0 + IN.instanceID) * 0.1;
                        }
                        
                        return OUT;
                    }
        
                    half4 frag(Varyings IN) : SV_Target
                    {
                        half4 col = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, IN.uv) * IN.color;
                        return col;
                    }
                    ENDHLSL
                }
            }
        }
        
        
    

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ï¼ˆæ¬¢è¿ç‚¹èµç•™è¨€æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰