---
layout: post
title: 'IL2CPP逆向'
date: "2025-12-01T00:53:51Z"
---
IL2CPP逆向
========

Unity 程序为了防止大量的外挂和盗版游戏，推出了一种 **il2cpp** 的操作，大概就是让 C# 的中间代码 IL 转换成 C++ 来编译，最后生成汇编程序使得反编译难度大大增加。

编译时
---

用il2cpp编译：可以在`unity hub`里的`Build Settings->Player Settings->Other Settings`看到

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220442024-544445420.png)

然后选择相应的选项就可以了

这样build出来的就是以下结构

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220517588-876439249.png)

进入challenge\_Data会发现没有我想要的`Managed->Assembly-CSharp.dll`，为了学习unity里il2cpp的逆向，我也自己出了道比较简单的题上手练习(好吧其实是为了拷打新生)

逆向
--

没有了`Assembly-CSharp.dll`也就意味着无法用dnspy一把梭了，这时我们需要另一个工具进行dump，比如这个[Perfare/Il2CppDumper: Unity il2cpp reverse engineer](https://github.com/Perfare/Il2CppDumper/)

使用时需要将`GameAssembly.dll`和`challenge_Data->il2cpp_data->Metadata->global-metadata.dat`放在一起，然后用下载解压得到的`Il2CppDumper.exe`进行dump(不要把`config.json`丢掉（）)，使用以下命令

    Il2CppDumper.exe <executable-file> <global-metadata> <output-directory>
    

即

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220532226-821546569.png)

然后就会看到输出了一堆文件

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220544660-2030354844.png)

以下是它们的作用

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220913222-25038274.png)

具体详见\[[原创\]IL2CPP 逆向初探-软件逆向-看雪论坛-安全社区|非营利性质技术交流社区](https://bbs.kanxue.com/thread-278275.htm)

其中我们一会会用到`il2cpp.h`和`GameAssembly.dll`

然后在DummyDll里，我们就看到了我们朝思暮想的`Assembly-CSharp.dll`  
![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220624321-2124438697.png)

把它扔进dnspy，却发现啥都没有，只有函数名空壳

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220559004-627632297.png)

这时我们就要召唤我们的IDA辣，把`GameAssembly.dll`扔进IDA

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220642785-767124133.png)

没有符号表，一点也不好看，我们需要导入一下文件恢复符号表(File->Script File)

先选择`l2cpp_dumper`里的`ida_with_struct_py3.py`，再选择刚才dump出来的`script.json`，打开，再选择`il2cpp.h`，等它加载完成，符号表就恢复出了很多，此时我们可以搜索想要分析的函数

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220652343-1799657237.png)

这个就是这道题主要函数

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220659828-1328740895.png)

经过分析，就是个简单的自定义base32

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220706943-576998323.png)

字母表在这里

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220713098-436100505.png)

密文在这里

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220719487-1057681746.png)

然后赛博厨子一把梭就有了

![image](https://img2024.cnblogs.com/blog/3349395/202511/3349395-20251130220733002-279016858.png)