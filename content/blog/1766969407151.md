---
layout: post
title: 'Flutter Android Live2D 2026 å®æˆ˜ï¼šæ¨¡å‹åŠ è½½ + é›†æˆæ¸²æŸ“ + æ˜¾ç¤ºå…¨æµç¨‹ + 10 ä¸ªæ ¸å¿ƒå‘ï¼ˆ OpenGL ï¼‰'
date: "2025-12-29T00:50:07Z"
---
Flutter Android Live2D 2026 å®æˆ˜ï¼šæ¨¡å‹åŠ è½½ + é›†æˆæ¸²æŸ“ + æ˜¾ç¤ºå…¨æµç¨‹ + 10 ä¸ªæ ¸å¿ƒå‘ï¼ˆ OpenGL ï¼‰
======================================================================

![Flutter Android Live2D 2026 å®æˆ˜ï¼šæ¨¡å‹åŠ è½½ + é›†æˆæ¸²æŸ“ + æ˜¾ç¤ºå…¨æµç¨‹ + 10 ä¸ªæ ¸å¿ƒå‘ï¼ˆ OpenGL ï¼‰](https://img2024.cnblogs.com/blog/1591373/202512/1591373-20251228192145593-156017676.png) æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†åœ¨Android Flutteråº”ç”¨ä¸­é›†æˆLive2D SDKçš„æŠ€æœ¯æ–¹æ¡ˆã€‚ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼ŒåŒ…å«Flutterå±‚ã€Android Kotlinå±‚ã€C++ JNIå±‚å’ŒLive2D SDK C++å±‚ã€‚æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬Live2D\_v3.javaæ¥å£å±‚ã€lapp\_model.cpp JNIç»‘å®šå±‚å’ŒLAppModel.cppæ¨¡å‹ç®¡ç†æ¨¡å—ï¼Œå®ç°äº†æ¨¡å‹åŠ è½½ã€æ¸²æŸ“å’Œäº¤äº’åŠŸèƒ½ã€‚æ–‡æ¡£æä¾›äº†å„å±‚å…³é”®ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†è·¨è¯­è¨€è°ƒç”¨æœºåˆ¶å’Œæ¨¡å‹å¤„ç†æµç¨‹ã€‚

ç‰¹åˆ«æ„Ÿè°¢ [RealCoolSnow/live2d-android](https://github.com/RealCoolSnow/live2d-android) å¤§ä½¬çš„å¼€å…ƒåˆ†äº«
------------------------------------------------------------------------------------------

*   å…³äº Flutter ç«¯åŠ è½½ä»£ç ï¼šå…¶å®åªè¦ Android åŸç”Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºï¼ŒFlutter è¿™è¾¹ç”¨ PlatformView å¯¹æ¥çš„é€»è¾‘å¾ˆå›ºå®šï¼Œè®© AI ç”ŸæˆåŸºç¡€ä»£ç å°±è¡Œï¼ˆæ¯”å¦‚ Dart ä¾§çš„ AndroidView åˆ›å»ºã€åŸç”Ÿè§†å›¾æ³¨å†Œï¼‰ï¼Œä¸ç”¨é‡å¤è´´å†—ä½™ä»£ç ï¼›
*   é‡ç‚¹è¯´æ˜ï¼šè¿™ç¯‡æ–‡ç« ä¼šèšç„¦ã€ŒAndroid åŸç”Ÿé›†æˆæ ¸å¿ƒæµç¨‹ã€ã€Œè·¨å±‚è°ƒç”¨è¸©å‘ã€ã€ŒOpenGL ä¸Šä¸‹æ–‡å†²çªè§£å†³ã€è¿™äº› AI å†™ä¸å‡ºæ¥çš„å®æˆ˜ç»†èŠ‚ï¼Œéƒ½æ˜¯æˆ‘å®æµ‹è¸©è¿‡çš„ç¡¬å‘ï¼›
*   æ³è¯·å¤§å®¶ï¼šè§‰å¾—æœ‰ç”¨çš„è¯ï¼ŒåŠ¡å¿…ç»™åŸä½œè€…å¤§ä½¬ç‚¹ä¸ª starğŸŒŸ[RealCoolSnow/live2d-android](https://github.com/RealCoolSnow/live2d-android)ï¼Œå†ç»™è¿™ç¯‡æ–‡ç« ç‚¹ä¸ªèµï½ å¼€æºä½œè€…çš„åˆ†äº«ä¸æ˜“ï¼Œä½ çš„æ”¯æŒæ‰æ˜¯ä»–ä»¬æŒç»­è¾“å‡ºçš„åŠ¨åŠ›ï¼Œä¸ç„¶ä»¥åå¯å°±éš¾æŒ–åˆ°è¿™ä¹ˆå¥½çš„å…è´¹èµ„æºå•¦ï¼

ç¬¬ä¸€ç« ï¼Œè¦åœ¨androidä¸Šé›†æˆlive2d
======================

Live2D SDK é›†æˆè¯´æ˜æ–‡æ¡£
=================

1\. æ¦‚è¿°
------

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†åœ¨Android Flutteråº”ç”¨ä¸­å¦‚ä½•é›†æˆLive2D SDKï¼Œå®ç°ä»æ¨¡å‹åŠ è½½åˆ°æ˜¾ç¤ºçš„å®Œæ•´æµç¨‹ã€‚æ•´ä¸ªé›†æˆæ¶‰åŠJava/Kotlinå±‚ã€JNIå±‚å’ŒC++åŸç”Ÿå±‚çš„ååŒå·¥ä½œã€‚

2\. æ¶æ„å±‚æ¬¡
--------

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Flutterå±‚ (Dart)                  â”‚
    â”‚   - Live2DView Widget               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ PlatformView
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Android Kotlinå±‚                  â”‚
    â”‚   - Live2DPlatformView              â”‚
    â”‚   - Live2D_v3 (Javaæ¥å£)            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ JNIè°ƒç”¨
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   C++ JNIå±‚                         â”‚
    â”‚   - lapp_model.cpp (JNIç»‘å®š)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Live2D SDK C++å±‚                  â”‚
    â”‚   - LAppModel (æ¨¡å‹ç®¡ç†)            â”‚
    â”‚   - CubismRenderer (æ¸²æŸ“å™¨)         â”‚
    â”‚   - CubismModel (æ¨¡å‹æ•°æ®)          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    

3\. æ ¸å¿ƒç»„ä»¶è¯´æ˜
----------

### 3.1 Live2D\_v3.java - Java/Kotlinæ¥å£å±‚

**æ–‡ä»¶ä½ç½®**: `android/app/src/main/kotlin/com/hornhuang/tomato_plan/Live2D_v3.java`

è¿™æ˜¯Live2D SDKçš„Java/Kotlinæ¥å£ï¼Œæä¾›SDKåˆå§‹åŒ–å’Œæ¨¡å‹ç®¡ç†åŠŸèƒ½ã€‚

**å…³é”®ä»£ç **:

    public class Live2D_v3 {
        private static boolean initialized = false;
        private static Context context;
    
        public static void init(Context ctx) {
            if (!initialized) {
                context = ctx;
                Csm_CubismFramework.initialize();
                initialized = true;
            }
        }
    
        public static void dispose() {
            if (initialized) {
                Csm_CubismFramework.dispose();
                initialized = false;
            }
        }
    
        public static void clearBuffer(float r, float g, float b, float a) {
            GLES20.glClearColor(r, g, b, a);
            GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT);
        }
    
        public static class LAppModel {
            private final long nativeModel;
    
            public LAppModel() {
                nativeModel = createNativeModel();
            }
    
            private native long createNativeModel();
            private native void destroyNativeModel(long model);
            public native void loadModelJson(String fileName);
            public native void resize(int ww, int wh);
            public native void update();
            public native void draw();
            public native void startMotion(String group, int no, int priority,
                OnBeganMotionCallback onStart, OnFinishedMotionCallback onFinish);
            public native void setExpression(String expressionID);
            public native void setParameterValue(String id, float value);
            public native void setParameterValueByIndex(int index, float value);
            public native void addParameterValue(String id, float value);
            public native void addParameterValueByIndex(int index, float value);
            public native void setPartsOpacity(String id, float opacity);
            public native void setPartsOpacityByIndex(int index, float opacity);
            public native void hitTest(String hitAreaName, float x, float y);
            public native void setDragging(float x, float y);
            public native void setAcceleration(float x, float y, float z);
        }
    }
    

### 3.2 lapp\_model.cpp - JNIç»‘å®šå±‚

**æ–‡ä»¶ä½ç½®**: `android/app/src/main/cpp/lapp_model.cpp`

è´Ÿè´£å°†Java/Kotlinæ–¹æ³•è°ƒç”¨è½¬æ¢ä¸ºC++å‡½æ•°è°ƒç”¨ï¼Œå®ç°è·¨è¯­è¨€äº¤äº’ã€‚

**å…³é”®ä»£ç **:

    extern "C" JNIEXPORT jlong JNICALL
    Java_com_hornhuang_tomato_1plan_Live2D_1v3_00024LAppModel_createNativeModel(JNIEnv *, jobject) {
        auto *model = new LAppModel();
        return reinterpret_cast<long>(model);
    }
    
    extern "C" JNIEXPORT void JNICALL
    Java_com_hornhuang_tomato_1plan_Live2D_1v3_00024LAppModel_loadModelJson(JNIEnv *env, jobject thiz,
                                                               jstring file_name) {
        const char *json_file = env->GetStringUTFChars(file_name, nullptr);
        getModel(env, thiz)->LoadAssets(json_file);
        env->ReleaseStringUTFChars(file_name, json_file);
    }
    
    extern "C" JNIEXPORT void JNICALL
    Java_com_hornhuang_tomato_1plan_Live2D_1v3_00024LAppModel_resize(JNIEnv *env, jobject thiz,
                                                        jint ww, jint wh) {
        getModel(env, thiz)->Resize(ww, wh);
    }
    
    extern "C" JNIEXPORT void JNICALL
    Java_com_hornhuang_tomato_1plan_Live2D_1v3_00024LAppModel_update(JNIEnv *env, jobject thiz) {
        getModel(env, thiz)->Update();
    }
    
    extern "C" JNIEXPORT void JNICALL
    Java_com_hornhuang_tomato_1plan_Live2D_1v3_00024LAppModel_draw(JNIEnv *env, jobject thiz) {
        getModel(env, thiz)->Draw();
    }
    

### 3.3 LAppModel.cpp - æ¨¡å‹ç®¡ç†æ ¸å¿ƒ

**æ–‡ä»¶ä½ç½®**: `android/app/src/main/cpp/Main/src/LAppModel.cpp`

å®ç°Live2Dæ¨¡å‹çš„åŠ è½½ã€æ›´æ–°ã€æ¸²æŸ“å’Œäº¤äº’å¤„ç†ã€‚

**å…³é”®ä»£ç **:

    void LAppModel::LoadAssets(const Csm::csmChar* fileName) {
        // è§£ææ¨¡å‹æ–‡ä»¶è·¯å¾„
        std::filesystem::path p = std::filesystem::u8path(fileName);
        _modelHomeDir = p.parent_path().u8string().c_str();
        
        // è¯»å–å¹¶è§£æ.model3.jsonæ–‡ä»¶
        Csm::csmSizeInt size;
        Csm::csmByte* buffer = CreateBuffer(fileName, &size);
        _modelSetting = Csm::Model::CubismModelSettingJson::Create(buffer, size);
        DeleteBuffer(buffer, fileName);
        
        // è®¾ç½®æ¨¡å‹
        SetupModel(_modelSetting);
        
        // è®¾ç½®çº¹ç†
        SetupTextures();
        
        // é¢„åŠ è½½åŠ¨ä½œ
        PreloadMotionGroup(MotionGroupIdle);
    }
    
    void LAppModel::SetupModel(Csm::Model::ICubismModelSetting* setting) {
        // ä»æ¨¡å‹è®¾ç½®ä¸­åŠ è½½æ¨¡å‹æ•°æ®
        _modelJson = setting->GetModelFileName();
        std::string modelPath = _modelHomeDir + "/" + _modelJson;
        
        Csm::csmSizeInt size;
        Csm::csmByte* buffer = CreateBuffer(modelPath.c_str(), &size);
        LoadModel(buffer, size);
        DeleteBuffer(buffer, modelPath.c_str());
        
        // è®¾ç½®æ¨¡å‹å‚æ•°
        _model->SaveParameters();
        
        // åˆ›å»ºæ¸²æŸ“å™¨
        _renderer = new Csm::Rendering::CubismRenderer_OpenGLES2();
        _renderer->Initialize(_model);
    }
    
    void LAppModel::Update() {
        const Csm::csmFloat32 deltaTimeSeconds = LAppPal::GetDeltaTime();
        _userTimeSeconds += deltaTimeSeconds;
        
        // æ›´æ–°åŠ¨ä½œ
        _motionManager->UpdateMotion(_model, deltaTimeSeconds);
        
        // æ›´æ–°æ¨¡å‹å‚æ•°
        _model->Update();
    }
    
    void LAppModel::Draw() {
        // è®¾ç½®æŠ•å½±çŸ©é˜µ
        Csm::CubismMatrix44 projection;
        projection.Scale(1.0f, 1.0f);
        _renderer->SetMvpMatrix(&projection);
        
        // æ¸²æŸ“æ¨¡å‹
        _renderer->DrawModel();
    }
    

### 3.4 Live2DPlatformView.kt - Flutterå¹³å°è§†å›¾

**æ–‡ä»¶ä½ç½®**: `android/app/src/main/kotlin/com/hornhuang/tomato_plan/Live2DPlatformView.kt`

å®ç°Flutterçš„PlatformViewï¼Œåœ¨Flutterä¸­åµŒå…¥Live2Dæ¸²æŸ“ã€‚

**å…³é”®ä»£ç **:

    class Live2DPlatformView(context: Context, id: Int, creationParams: Map<String, Any>?)
        : PlatformView {
        
        private val glSurfaceView = GLSurfaceView(context)
        private val renderer = Live2DRenderer(context)
        
        init {
            glSurfaceView.setEGLContextClientVersion(2)
            glSurfaceView.setRenderer(renderer)
            glSurfaceView.renderMode = GLSurfaceView.RENDERMODE_CONTINUOUSLY
        }
        
        override fun getView(): View = glSurfaceView
        
        override fun dispose() {
            // æ¸…ç†èµ„æº
        }
    }
    
    class Live2DRenderer(private val context: Context) : GLSurfaceView.Renderer {
        lateinit var model: LAppModel
    
        override fun onSurfaceCreated(gl: GL10?, config: EGLConfig?) {
            // åˆå§‹åŒ–Live2D SDK
            Live2D_v3.init(context)
            
            // åˆ›å»ºæ¨¡å‹å®ä¾‹
            model = LAppModel().apply {
                // åŠ è½½æ¨¡å‹æ–‡ä»¶
                loadModelJson("assets://mianfeimox/llny.model3.json")
            }
        }
    
        override fun onSurfaceChanged(gl: GL10?, width: Int, height: Int) {
            // è°ƒæ•´æ¨¡å‹å°ºå¯¸
            model.resize(width, height)
        }
    
        override fun onDrawFrame(gl: GL10?) {
            // æ¸…ç©ºç¼“å†²åŒº
            Live2D_v3.clearBuffer(0f, 1f, 0f, 0f)
            
            // æ›´æ–°æ¨¡å‹çŠ¶æ€
            model.update()
            
            // è®¾ç½®å‚æ•°ï¼ˆä¾‹å¦‚çœ¨çœ¼ï¼‰
            model.setParameterValue("Param14", 1f)
            
            // ç»˜åˆ¶æ¨¡å‹
            model.draw()
        }
    }
    

4\. å®Œæ•´æµç¨‹è¯´æ˜
----------

### 4.1 åˆå§‹åŒ–æµç¨‹

    1. Flutterå¯åŠ¨
       â†“
    2. åˆ›å»ºLive2DPlatformView
       â†“
    3. GLSurfaceViewåˆ›å»ºOpenGL ES 2.0ä¸Šä¸‹æ–‡
       â†“
    4. onSurfaceCreatedå›è°ƒè§¦å‘
       â†“
    5. è°ƒç”¨Live2D_v3.init(context)
       â†“
    6. Csm_CubismFramework.initialize() åˆå§‹åŒ–Live2Dæ¡†æ¶
       â†“
    7. åˆ›å»ºLAppModelå®ä¾‹
       â†“
    8. è°ƒç”¨loadModelJsonåŠ è½½æ¨¡å‹
    

### 4.2 æ¨¡å‹åŠ è½½æµç¨‹

    1. loadModelJson("assets://mianfeimox/llny.model3.json")
       â†“
    2. JNIè°ƒç”¨: Java_com_hornhuang_tomato_1plan_Live2D_1v3_00024LAppModel_loadModelJson
       â†“
    3. LAppModel::LoadAssets(fileName)
       â†“
    4. è¯»å–.model3.jsonæ–‡ä»¶
       â†“
    5. è§£æJSONè·å–æ¨¡å‹æ–‡ä»¶è·¯å¾„ã€çº¹ç†ã€åŠ¨ä½œç­‰ä¿¡æ¯
       â†“
    6. SetupModel() - åŠ è½½.moc3æ¨¡å‹æ–‡ä»¶
       â†“
    7. SetupTextures() - åŠ è½½çº¹ç†å›¾ç‰‡
       â†“
    8. PreloadMotionGroup() - é¢„åŠ è½½åŠ¨ä½œæ–‡ä»¶
       â†“
    9. åˆ›å»ºCubismRendererå¹¶åˆå§‹åŒ–
    

### 4.3 æ¸²æŸ“å¾ªç¯æµç¨‹

    æ¯ä¸€å¸§:
    1. onDrawFrameå›è°ƒè§¦å‘
       â†“
    2. glClearæ¸…ç©ºé¢œè‰²ç¼“å†²åŒº
       â†“
    3. model.update()
       â†“
    4. _motionManager->UpdateMotion() - æ›´æ–°åŠ¨ä½œçŠ¶æ€
       â†“
    5. _model->Update() - æ›´æ–°æ¨¡å‹å‚æ•°
       â†“
    6. model.draw()
       â†“
    7. è®¾ç½®æŠ•å½±çŸ©é˜µ
       â†“
    8. _renderer->DrawModel() - æ¸²æŸ“æ¨¡å‹
       â†“
    9. OpenGLç»˜åˆ¶åˆ°å±å¹•
    

### 4.4 äº¤äº’å¤„ç†æµç¨‹

    ç”¨æˆ·è§¦æ‘¸:
    1. è§¦æ‘¸äº‹ä»¶ä¼ é€’åˆ°Live2DPlatformView
       â†“
    2. è®¡ç®—è§¦æ‘¸åæ ‡
       â†“
    3. model.hitTest(hitAreaName, x, y)
       â†“
    4. æ£€æµ‹æ˜¯å¦å‡»ä¸­å¯äº¤äº’åŒºåŸŸ
       â†“
    5. å¦‚æœå‡»ä¸­ï¼Œè§¦å‘ç›¸åº”åŠ¨ä½œ:
       - model.startMotion() - æ’­æ”¾åŠ¨ä½œ
       - model.setExpression() - è®¾ç½®è¡¨æƒ…
       - model.setParameterValue() - è®¾ç½®å‚æ•°
    

5\. å…³é”®æŠ€æœ¯ç‚¹
---------

### 5.1 OpenGLä¸Šä¸‹æ–‡ç®¡ç†

æ¯ä¸ªOpenGLä¸Šä¸‹æ–‡éœ€è¦ç‹¬ç«‹åˆå§‹åŒ–Live2D SDKï¼š

    override fun onSurfaceCreated(gl: GL10?, config: EGLConfig?) {
        // æ¯ä¸ªOpenGLä¸Šä¸‹æ–‡éƒ½éœ€è¦å•ç‹¬åˆå§‹åŒ–
        Live2D_v3.init(context)
        model = LAppModel()
    }
    

### 5.2 èµ„æºè·¯å¾„å¤„ç†

Android assetsè·¯å¾„éœ€è¦è½¬æ¢ä¸ºC++å¯è®¿é—®çš„è·¯å¾„ï¼š

    void LAppModel::LoadAssets(const Csm::csmChar* fileName) {
        // assets://è·¯å¾„è½¬æ¢ä¸ºå®é™…æ–‡ä»¶è·¯å¾„
        std::filesystem::path p = std::filesystem::u8path(fileName);
        _modelHomeDir = p.parent_path().u8string().c_str();
    }
    

### 5.3 åŠ¨ä½œç®¡ç†

åŠ¨ä½œé€šè¿‡ä¼˜å…ˆçº§ç³»ç»Ÿç®¡ç†ï¼š

    void LAppModel::StartMotion(const Csm::csmChar* group, Csm::csmInt32 no,
                                Csm::csmInt32 priority,
                                Csm::FinishedMotionCallback onFinishedMotionHandler) {
        if (priority == _priority) {
            _motionManager->SetReservePriority(priority);
        } else if (priority < _motionManager->GetReservePriority()) {
            return;
        }
        
        _motionManager->StartMotionPriority(
            _model,
            group,
            no,
            priority,
            onFinishedMotionHandler
        );
    }
    

### 5.4 å‚æ•°æ§åˆ¶

Live2Dæ¨¡å‹å‚æ•°å®æ—¶æ§åˆ¶ï¼š

    // è®¾ç½®å‚æ•°å€¼
    model.setParameterValue("ParamEyeLOpen", 0.5f)
    
    // å¢åŠ å‚æ•°å€¼
    model.addParameterValue("ParamAngleX", 0.1f)
    
    // è®¾ç½®éƒ¨ä»¶é€æ˜åº¦
    model.setPartsOpacity("PartArmL", 0.8f)
    

6\. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ
-------------

### 6.1 OpenGLä¸Šä¸‹æ–‡é”™è¯¯

**é—®é¢˜**: GL\_INVALID\_VALUE (0x501)é”™è¯¯

**åŸå› **: åœ¨ä¸åŒçš„OpenGLä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨åŒä¸€ä¸ªLive2Då®ä¾‹

**è§£å†³æ–¹æ¡ˆ**: æ¯ä¸ªOpenGLä¸Šä¸‹æ–‡ç‹¬ç«‹åˆå§‹åŒ–Live2D SDKå’Œæ¨¡å‹å®ä¾‹

### 6.2 æ¨¡å‹åŠ è½½å¤±è´¥

**é—®é¢˜**: æ¨¡å‹æ— æ³•æ˜¾ç¤ºæˆ–å´©æºƒ

**æ£€æŸ¥é¡¹**:

*   æ¨¡å‹æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
*   .model3.jsonæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
*   çº¹ç†æ–‡ä»¶æ˜¯å¦å­˜åœ¨
*   åŠ¨ä½œæ–‡ä»¶æ˜¯å¦å®Œæ•´

### 6.3 æ€§èƒ½ä¼˜åŒ–

**å»ºè®®**:

*   ä½¿ç”¨RENDERMODE\_WHEN\_DIRTYè€ŒéRENDERMODE\_CONTINUOUSLY
*   é¢„åŠ è½½å¸¸ç”¨åŠ¨ä½œ
*   åˆç†è®¾ç½®åŠ¨ä½œä¼˜å…ˆçº§
*   é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯æ¨¡å‹å®ä¾‹

7\. æ–‡ä»¶ç»“æ„
--------

    android/
    â”œâ”€â”€ app/
    â”‚   â”œâ”€â”€ src/
    â”‚   â”‚   â”œâ”€â”€ main/
    â”‚   â”‚   â”‚   â”œâ”€â”€ kotlin/com/hornhuang/tomato_plan/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Live2D_v3.java          # Java/Kotlinæ¥å£
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Live2DPlatformView.kt    # Flutterå¹³å°è§†å›¾
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MainActivity.kt         # ä¸»Activity
    â”‚   â”‚   â”‚   â”œâ”€â”€ cpp/
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ lapp_model.cpp          # JNIç»‘å®š
    â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ live2d.cpp              # Live2Dåˆå§‹åŒ–
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Main/src/
    â”‚   â”‚   â”‚   â”‚       â””â”€â”€ LAppModel.cpp       # æ¨¡å‹ç®¡ç†
    â”‚   â”‚   â”‚   â””â”€â”€ assets/
    â”‚   â”‚   â”‚       â””â”€â”€ mianfeimox/             # Live2Dæ¨¡å‹èµ„æº
    â”‚   â”‚   â”‚           â”œâ”€â”€ llny.model3.json
    â”‚   â”‚   â”‚           â”œâ”€â”€ llny.moc3
    â”‚   â”‚   â”‚           â”œâ”€â”€ textures/
    â”‚   â”‚   â”‚           â””â”€â”€ motions/
    

8\. æ‰©å±•åŠŸèƒ½
--------

### 8.1 æ·»åŠ äº¤äº’äº‹ä»¶

    override fun onTouchEvent(event: MotionEvent): Boolean {
        when (event.action) {
            MotionEvent.ACTION_DOWN -> {
                model.hitTest("Head", event.x, event.y)
            }
            MotionEvent.ACTION_MOVE -> {
                model.setDragging(event.x, event.y)
            }
            MotionEvent.ACTION_UP -> {
                model.setDragging(0f, 0f)
            }
        }
        return true
    }
    

### 8.2 æ’­æ”¾åŠ¨ä½œ

    // æ’­æ”¾æŒ‡å®šåŠ¨ä½œ
    model.startMotion("TapBody", 0, 3, 
        { group, no -> println("åŠ¨ä½œå¼€å§‹: $group, $no") },
        { self -> println("åŠ¨ä½œç»“æŸ") }
    )
    
    // è®¾ç½®è¡¨æƒ…
    model.setExpression("f01")
    

### 8.3 ç‰©ç†æ¨¡æ‹Ÿ

    // è®¾ç½®åŠ é€Ÿåº¦ï¼ˆç”¨äºç‰©ç†æ¨¡æ‹Ÿï¼‰
    model.setAcceleration(0.5f, 0.0f, 0.0f)
    

9\. æ€»ç»“
------

Live2D SDKåœ¨Android Flutteråº”ç”¨ä¸­çš„é›†æˆæ¶‰åŠå¤šä¸ªå±‚æ¬¡çš„åä½œï¼š

1.  **Flutterå±‚**: é€šè¿‡PlatformViewåµŒå…¥åŸç”Ÿè§†å›¾
2.  **Java/Kotlinå±‚**: æä¾›Live2D SDKçš„æ¥å£å°è£…
3.  **JNIå±‚**: å®ç°Javaä¸C++çš„è·¨è¯­è¨€è°ƒç”¨
4.  **C++å±‚**: å®ç°Live2Dæ¨¡å‹çš„æ ¸å¿ƒåŠŸèƒ½

å…³é”®è¦ç‚¹ï¼š

*   æ¯ä¸ªOpenGLä¸Šä¸‹æ–‡éœ€è¦ç‹¬ç«‹åˆå§‹åŒ–Live2D SDK
*   æ¨¡å‹åŠ è½½éµå¾ª: JSONè§£æ â†’ èµ„æºåŠ è½½ â†’ æ¸²æŸ“å™¨åˆå§‹åŒ–
*   æ¸²æŸ“å¾ªç¯: æ›´æ–°åŠ¨ä½œ â†’ æ›´æ–°æ¨¡å‹ â†’ ç»˜åˆ¶
*   äº¤äº’é€šè¿‡å‚æ•°æ§åˆ¶å’ŒåŠ¨ä½œæ’­æ”¾å®ç°

é€šè¿‡åˆç†ç®¡ç†OpenGLä¸Šä¸‹æ–‡å’Œèµ„æºç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥å®ç°ç¨³å®šé«˜æ•ˆçš„Live2Dæ¨¡å‹æ¸²æŸ“æ•ˆæœã€‚

ç¬¬äºŒç«  Flutterä¾§çš„æ¸²æŸ“ä¸å±•ç¤º
==================

Flutterè°ƒç”¨Android Nativeç»„ä»¶å±•ç¤ºLive2D - é—®é¢˜è§£å†³æ€»ç»“
==========================================

1\. Flutterè°ƒç”¨Android Nativeç»„ä»¶å±•ç¤ºLive2Dçš„å®Œæ•´æµç¨‹
------------------------------------------

### 1.1 æ•´ä½“æ¶æ„

    Flutterå±‚ (Dart)
        â†“ PlatformView
    Android Kotlinå±‚
        â†“ JNIè°ƒç”¨
    C++ Nativeå±‚
        â†“ Live2D SDK
    OpenGL ESæ¸²æŸ“
    

### 1.2 è¯¦ç»†è°ƒç”¨é“¾è·¯

#### ç¬¬ä¸€æ­¥ï¼šFlutterç«¯åˆ›å»ºPlatformView

    // åœ¨Flutterä»£ç ä¸­åˆ›å»ºLive2DView
    AndroidView(
      viewType: 'com.hornhuang.tomato_plan/live2d_view',
      creationParams: <String, dynamic>{},
      creationParamsCodec: const StandardMessageCodec(),
    )
    

#### ç¬¬äºŒæ­¥ï¼šMainActivityæ³¨å†ŒPlatformView

    // MainActivity.kt
    class MainActivity: FlutterActivity() {
        override fun configureFlutterEngine(flutterEngine: FlutterEngine) {
            super.configureFlutterEngine(flutterEngine)
            flutterEngine
                .platformViewsController
                .registry
                .registerViewFactory(
                    "com.hornhuang.tomato_plan/live2d_view",
                    Live2DPlatformViewFactory()
                )
        }
    }
    

#### ç¬¬ä¸‰æ­¥ï¼šLive2DPlatformViewFactoryåˆ›å»ºPlatformView

    class Live2DPlatformViewFactory : PlatformViewFactory(StandardMessageCodec.INSTANCE) {
        override fun create(context: Context, viewId: Int, args: Any?): PlatformView {
            return Live2DPlatformView(context, viewId, args as Map<String, Any>?)
        }
    }
    

#### ç¬¬å››æ­¥ï¼šLive2DPlatformViewåˆ›å»ºGLSurfaceViewå’Œæ¸²æŸ“å™¨

    class Live2DPlatformView(context: Context, id: Int, creationParams: Map<String, Any>?)
        : PlatformView {
        
        private val glSurfaceView = GLSurfaceView(context)
        private val renderer = Live2DRenderer(context)
        
        init {
            glSurfaceView.setEGLContextClientVersion(2)
            glSurfaceView.setRenderer(renderer)
            glSurfaceView.renderMode = GLSurfaceView.RENDERMODE_CONTINUOUSLY
        }
        
        override fun getView(): View = glSurfaceView
    }
    

#### ç¬¬äº”æ­¥ï¼šLive2DRendereråˆå§‹åŒ–Live2D SDK

    class Live2DRenderer(private val context: Context) : GLSurfaceView.Renderer {
        lateinit var model: LAppModel
    
        override fun onSurfaceCreated(gl: GL10?, config: EGLConfig?) {
            // åˆå§‹åŒ–Live2D SDK
            Live2D_v3.init(context)
            
            // åˆ›å»ºæ¨¡å‹å®ä¾‹
            model = LAppModel().apply {
                loadModelJson("assets://mianfeimox/llny.model3.json")
            }
        }
    
        override fun onSurfaceChanged(gl: GL10?, width: Int, height: Int) {
            model.resize(width, height)
        }
    
        override fun onDrawFrame(gl: GL10?) {
            Live2D_v3.clearBuffer(0f, 1f, 0f, 0f)
            model.update()
            model.setParameterValue("Param14", 1f)
            model.draw()
        }
    }
    

#### ç¬¬å…­æ­¥ï¼šJNIè°ƒç”¨C++å±‚

    // Live2D_v3.java
    public class LAppModel {
        private final long nativeModel;
    
        public native void loadModelJson(String fileName);
        public native void update();
        public native void draw();
    }
    

    // lapp_model.cpp
    extern "C" JNIEXPORT void JNICALL
    Java_com_hornhuang_tomato_1plan_Live2D_1v3_00024LAppModel_loadModelJson(JNIEnv *env, jobject thiz,
                                                               jstring file_name) {
        const char *json_file = env->GetStringUTFChars(file_name, nullptr);
        getModel(env, thiz)->LoadAssets(json_file);
        env->ReleaseStringUTFChars(file_name, json_file);
    }
    
    extern "C" JNIEXPORT void JNICALL
    Java_com_hornhuang_tomato_1plan_Live2D_1v3_00024LAppModel_draw(JNIEnv *env, jobject thiz) {
        getModel(env, thiz)->Draw();
    }
    

#### ç¬¬ä¸ƒæ­¥ï¼šC++å±‚åŠ è½½å’Œæ¸²æŸ“Live2Dæ¨¡å‹

    // LAppModel.cpp
    void LAppModel::LoadAssets(const Csm::csmChar* fileName) {
        // è§£æ.model3.jsonæ–‡ä»¶
        Csm::csmByte* buffer = CreateBuffer(fileName, &size);
        _modelSetting = Csm::Model::CubismModelSettingJson::Create(buffer, size);
        DeleteBuffer(buffer, fileName);
        
        // è®¾ç½®æ¨¡å‹å’Œçº¹ç†
        SetupModel(_modelSetting);
        SetupTextures();
        PreloadMotionGroup(MotionGroupIdle);
    }
    
    void LAppModel::Draw() {
        Csm::CubismMatrix44 projection;
        projection.Scale(1.0f, 1.0f);
        _renderer->SetMvpMatrix(&projection);
        _renderer->DrawModel();
    }
    

2\. é‡åˆ°çš„é—®é¢˜å’ŒBug
-------------

### é—®é¢˜1ï¼šPlatform Viewæœªæ³¨å†Œé”™è¯¯

#### é”™è¯¯ä¿¡æ¯

    Trying to create a platform view of unregistered type: com.hornhuang.tomato_plan/live2d_view
    

#### è§¦å‘åŸå› 

åˆ é™¤äº†NativeTextViewç›¸å…³æ–‡ä»¶åï¼ŒMainActivity.ktä¸­ä»ç„¶ä¿ç•™ç€NativeTextViewFactoryçš„æ³¨å†Œä»£ç ï¼Œä½†æ²¡æœ‰æ³¨å†ŒLive2DPlatformViewFactoryã€‚

#### è§£å†³æ–¹æ¡ˆ

1.  åˆ é™¤MainActivity.ktä¸­çš„NativeTextViewFactoryæ³¨å†Œä»£ç 
2.  æ·»åŠ Live2DPlatformViewFactoryçš„æ³¨å†Œ

    // MainActivity.kt
    class MainActivity: FlutterActivity() {
        override fun configureFlutterEngine(flutterEngine: FlutterEngine) {
            super.configureFlutterEngine(flutterEngine)
            flutterEngine
                .platformViewsController
                .registry
                .registerViewFactory(
                    "com.hornhuang.tomato_plan/live2d_view",
                    Live2DPlatformViewFactory()
                )
        }
    }
    

* * *

### é—®é¢˜2ï¼šç¼–è¯‘é”™è¯¯ - æœªè§£æçš„å¼•ç”¨

#### é”™è¯¯ä¿¡æ¯

    Unresolved reference: LAppModel
    Unresolved reference: drag
    Unresolved reference: touch
    Unresolved reference: release
    

#### è§¦å‘åŸå› 

Live2DPlatformView.ktä¸­ä½¿ç”¨äº†LAppModelç±»ï¼Œä½†æ²¡æœ‰å¯¼å…¥æ­£ç¡®çš„åŒ…ã€‚

#### è§£å†³æ–¹æ¡ˆ

åœ¨Live2DPlatformView.ktæ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯¼å…¥è¯­å¥ï¼š

    import com.hornhuang.tomato_plan.Live2D_v3.LAppModel
    

* * *

### é—®é¢˜3ï¼šLive2DActivityèƒ½æ˜¾ç¤ºï¼Œä½†Flutterçš„Live2DViewæ˜¾ç¤ºç©ºç™½ï¼ˆæ ¸å¿ƒé—®é¢˜ï¼‰

#### ç°è±¡æè¿°

*   æ‰“å¼€Live2DActivityï¼šLive2Dæ¨¡å‹æ­£å¸¸æ˜¾ç¤º
*   è¿”å›Flutteré¦–é¡µï¼šLive2DViewæ˜¾ç¤ºä¸€ç‰‡ç©ºç™½ï¼ˆç»¿è‰²èƒŒæ™¯ï¼‰
*   æ—¥å¿—ä¸­å‡ºç°OpenGLé”™è¯¯ï¼š`glGetError() returned error 0x501`

#### è§¦å‘åŸå› åˆ†æ

**æ ¹æœ¬åŸå› ï¼šOpenGLä¸Šä¸‹æ–‡å†²çª**

1.  **Live2DActivityå’ŒLive2DPlatformViewä½¿ç”¨ä¸åŒçš„OpenGLä¸Šä¸‹æ–‡**
    
    *   Live2DActivityæœ‰è‡ªå·±çš„GLSurfaceViewï¼Œåˆ›å»ºç‹¬ç«‹çš„OpenGLä¸Šä¸‹æ–‡
    *   Live2DPlatformViewä¹Ÿæœ‰è‡ªå·±çš„GLSurfaceViewï¼Œåˆ›å»ºå¦ä¸€ä¸ªç‹¬ç«‹çš„OpenGLä¸Šä¸‹æ–‡
2.  **Live2D SDKçš„åˆå§‹åŒ–é—®é¢˜**
    
    *   æœ€åˆçš„å®ç°ä¸­ï¼ŒLive2D\_v3.init()åœ¨MainActivityä¸­åªè°ƒç”¨ä¸€æ¬¡
    *   è¿™å¯¼è‡´Live2D SDKçš„é™æ€èµ„æºï¼ˆå¦‚ç€è‰²å™¨ç¨‹åºï¼‰åœ¨ç¬¬ä¸€ä¸ªOpenGLä¸Šä¸‹æ–‡ä¸­åˆ›å»º
    *   å½“åˆ‡æ¢åˆ°ç¬¬äºŒä¸ªOpenGLä¸Šä¸‹æ–‡æ—¶ï¼Œè¿™äº›èµ„æºæ— æ•ˆ
3.  **ç€è‰²å™¨ç¨‹åºçš„OpenGLä¸Šä¸‹æ–‡ç»‘å®š**
    
    *   OpenGLçš„ç€è‰²å™¨ç¨‹åºæ˜¯ä¸Šä¸‹æ–‡ç»‘å®šçš„
    *   åœ¨ä¸Šä¸‹æ–‡Aä¸­åˆ›å»ºçš„ç€è‰²å™¨ç¨‹åºåœ¨ä¸Šä¸‹æ–‡Bä¸­æ— æ³•ä½¿ç”¨
    *   CubismRendereråœ¨åˆ›å»ºæ—¶ä¼šç¼–è¯‘å’Œé“¾æ¥ç€è‰²å™¨ç¨‹åº
    *   è¿™äº›ç¨‹åºåªåœ¨åˆ›å»ºå®ƒä»¬çš„ä¸Šä¸‹æ–‡ä¸­æœ‰æ•ˆ
4.  **é”™è¯¯æµç¨‹**
    
        ç”¨æˆ·æ‰“å¼€Live2DActivity
        â†“
        Live2DActivityçš„OpenGLä¸Šä¸‹æ–‡åˆ›å»º
        â†“
        Live2D_v3.init() åœ¨MainActivityä¸­è°ƒç”¨ï¼ˆç¬¬ä¸€æ¬¡ï¼‰
        â†“
        ç€è‰²å™¨ç¨‹åºåœ¨Live2DActivityçš„ä¸Šä¸‹æ–‡ä¸­åˆ›å»º
        â†“
        Live2Dæ¨¡å‹æ­£å¸¸æ˜¾ç¤º
        
        ç”¨æˆ·è¿”å›Flutteré¦–é¡µ
        â†“
        Live2DPlatformViewçš„OpenGLä¸Šä¸‹æ–‡åˆ›å»º
        â†“
        Live2D_v3.init() æ£€æµ‹åˆ°å·²åˆå§‹åŒ–ï¼Œè·³è¿‡
        â†“
        Live2DPlatformViewå°è¯•ä½¿ç”¨Live2D SDK
        â†“
        å°è¯•ä½¿ç”¨åœ¨Live2DActivityä¸Šä¸‹æ–‡ä¸­åˆ›å»ºçš„ç€è‰²å™¨ç¨‹åº
        â†“
        OpenGLé”™è¯¯ 0x501 (GL_INVALID_VALUE)
        â†“
        æ¸²æŸ“å¤±è´¥ï¼Œæ˜¾ç¤ºç©ºç™½
        
    

#### è§£å†³æ–¹æ¡ˆ

**æ–¹æ¡ˆï¼šæ¯ä¸ªOpenGLä¸Šä¸‹æ–‡ç‹¬ç«‹åˆå§‹åŒ–Live2D SDK**

1.  **ä¿®æ”¹Live2D\_v3.javaï¼Œæ”¯æŒå¤šæ¬¡åˆå§‹åŒ–**

    public class Live2D_v3 {
        private static boolean initialized = false;
        private static Context context;
    
        public static void init(Context ctx) {
            if (!initialized) {
                context = ctx;
                Csm_CubismFramework.initialize();
                initialized = true;
            }
        }
    }
    

2.  **ä¿®æ”¹Live2DPlatformView.ktï¼Œåœ¨onSurfaceCreatedä¸­åˆå§‹åŒ–**

    class Live2DRenderer(private val context: Context) : GLSurfaceView.Renderer {
        lateinit var model: LAppModel
    
        override fun onSurfaceCreated(gl: GL10?, config: EGLConfig?) {
            // åœ¨æ¯ä¸ªOpenGLä¸Šä¸‹æ–‡ä¸­ç‹¬ç«‹åˆå§‹åŒ–Live2D SDK
            Live2D_v3.init(context)
            
            // åˆ›å»ºæ¨¡å‹å®ä¾‹
            model = LAppModel().apply {
                loadModelJson("assets://mianfeimox/llny.model3.json")
            }
        }
    
        override fun onSurfaceChanged(gl: GL10?, width: Int, height: Int) {
            model.resize(width, height)
        }
    
        override fun onDrawFrame(gl: GL10?) {
            Live2D_v3.clearBuffer(0f, 1f, 0f, 0f)
            model.update()
            model.setParameterValue("Param14", 1f)
            model.draw()
        }
    }
    

3.  **ä¿®æ”¹Live2DActivity.ktï¼Œåœ¨MyRendererä¸­åˆå§‹åŒ–**

    class Live2DActivity : AppCompatActivity() {
        private lateinit var glSurfaceView: GLSurfaceView
        private lateinit var renderer: MyRenderer
    
        override fun onCreate(savedInstanceState: Bundle?) {
            super.onCreate(savedInstanceState)
            setContentView(R.layout.activity_live2d)
            
            glSurfaceView = findViewById(R.id.glSurfaceView)
            renderer = MyRenderer(this)
            glSurfaceView.setEGLContextClientVersion(2)
            glSurfaceView.setRenderer(renderer)
        }
    }
    
    class MyRenderer(private val context: Context) : GLSurfaceView.Renderer {
        private lateinit var model: LAppModel
    
        override fun onSurfaceCreated(gl: GL10?, config: EGLConfig?) {
            // åœ¨Live2DActivityçš„OpenGLä¸Šä¸‹æ–‡ä¸­åˆå§‹åŒ–Live2D SDK
            Live2D_v3.init(context)
            
            model = LAppModel().apply {
                loadModelJson("assets://mianfeimox/llny.model3.json")
            }
        }
    
        override fun onSurfaceChanged(gl: GL10?, width: Int, height: Int) {
            model.resize(width, height)
        }
    
        override fun onDrawFrame(gl: GL10?) {
            Live2D_v3.clearBuffer(0f, 0f, 0f, 0f)
            model.update()
            model.setParameterValue("Param14", 1f)
            model.draw()
        }
    }
    

4.  **ç§»é™¤MainActivityä¸­çš„é›†ä¸­åˆå§‹åŒ–**

    // MainActivity.kt - ä¸å†åœ¨è¿™é‡Œåˆå§‹åŒ–Live2D
    class MainActivity: FlutterActivity() {
        override fun configureFlutterEngine(flutterEngine: FlutterEngine) {
            super.configureFlutterEngine(flutterEngine)
            flutterEngine
                .platformViewsController
                .registry
                .registerViewFactory(
                    "com.hornhuang.tomato_plan/live2d_view",
                    Live2DPlatformViewFactory()
                )
        }
    }
    

#### ä¿®å¤åçš„æµç¨‹

    ç”¨æˆ·æ‰“å¼€Live2DActivity
    â†“
    Live2DActivityçš„OpenGLä¸Šä¸‹æ–‡åˆ›å»º
    â†“
    MyRenderer.onSurfaceCreated() è°ƒç”¨
    â†“
    Live2D_v3.init() ç¬¬ä¸€æ¬¡åˆå§‹åŒ–
    â†“
    ç€è‰²å™¨ç¨‹åºåœ¨Live2DActivityçš„ä¸Šä¸‹æ–‡ä¸­åˆ›å»º
    â†“
    Live2Dæ¨¡å‹æ­£å¸¸æ˜¾ç¤º
    
    ç”¨æˆ·è¿”å›Flutteré¦–é¡µ
    â†“
    Live2DPlatformViewçš„OpenGLä¸Šä¸‹æ–‡åˆ›å»º
    â†“
    Live2DRenderer.onSurfaceCreated() è°ƒç”¨
    â†“
    Live2D_v3.init() æ£€æµ‹åˆ°å·²åˆå§‹åŒ–ï¼Œè·³è¿‡æ¡†æ¶åˆå§‹åŒ–
    â†“
    åˆ›å»ºæ–°çš„LAppModelå®ä¾‹
    â†“
    CubismRendereråœ¨Live2DPlatformViewçš„ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºæ–°çš„ç€è‰²å™¨ç¨‹åº
    â†“
    Live2Dæ¨¡å‹æ­£å¸¸æ˜¾ç¤º
    

3\. å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“
-----------

### 3.1 OpenGLä¸Šä¸‹æ–‡éš”ç¦»

*   æ¯ä¸ªGLSurfaceViewåˆ›å»ºç‹¬ç«‹çš„OpenGLä¸Šä¸‹æ–‡
*   OpenGLèµ„æºï¼ˆç€è‰²å™¨ç¨‹åºã€çº¹ç†ç­‰ï¼‰æ˜¯ä¸Šä¸‹æ–‡ç»‘å®šçš„
*   ä¸åŒä¸Šä¸‹æ–‡ä¹‹é—´ä¸èƒ½å…±äº«OpenGLèµ„æº

### 3.2 Live2D SDKçš„åˆå§‹åŒ–ç­–ç•¥

*   **æ¡†æ¶åˆå§‹åŒ–**ï¼ˆCsm\_CubismFramework.initialize()ï¼‰ï¼šåªéœ€ä¸€æ¬¡
*   **æ¸²æŸ“å™¨åˆå§‹åŒ–**ï¼ˆCubismRendererï¼‰ï¼šæ¯ä¸ªOpenGLä¸Šä¸‹æ–‡éœ€è¦ç‹¬ç«‹åˆ›å»º
*   **æ¨¡å‹å®ä¾‹**ï¼šæ¯ä¸ªOpenGLä¸Šä¸‹æ–‡éœ€è¦ç‹¬ç«‹çš„LAppModelå®ä¾‹

### 3.3 Flutter PlatformViewçš„ç”Ÿå‘½å‘¨æœŸ

*   PlatformViewåˆ›å»ºæ—¶ï¼ŒGLSurfaceViewä¹Ÿä¼šåˆ›å»º
*   GLSurfaceViewçš„onSurfaceCreatedåœ¨OpenGLä¸Šä¸‹æ–‡åˆ›å»ºæ—¶è°ƒç”¨
*   onSurfaceChangedåœ¨è§†å›¾å°ºå¯¸å˜åŒ–æ—¶è°ƒç”¨
*   onDrawFrameåœ¨æ¯ä¸€å¸§æ¸²æŸ“æ—¶è°ƒç”¨

4\. é—®é¢˜æ’æŸ¥è¿‡ç¨‹
----------

### 4.1 åˆæ­¥æ’æŸ¥

1.  æ£€æŸ¥Live2DActivityèƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œè¯´æ˜æ¨¡å‹æ–‡ä»¶å’ŒLive2D SDKæœ¬èº«æ²¡æœ‰é—®é¢˜
2.  æ£€æŸ¥Flutterçš„Live2DViewæ˜¾ç¤ºç»¿è‰²èƒŒæ™¯ï¼Œè¯´æ˜GLSurfaceViewæ­£å¸¸å·¥ä½œ
3.  æ—¥å¿—ä¸­å‡ºç°OpenGLé”™è¯¯ï¼ŒæŒ‡å‘æ¸²æŸ“é—®é¢˜

### 4.2 æ·±å…¥åˆ†æ

1.  åˆ†æLive2DActivityå’ŒLive2DPlatformViewçš„ä»£ç å·®å¼‚
2.  å‘ç°ä¸¤è€…éƒ½ä½¿ç”¨Live2D\_v3.init()ï¼Œä½†è°ƒç”¨ä½ç½®ä¸åŒ
3.  ç ”ç©¶OpenGLä¸Šä¸‹æ–‡çš„ç®¡ç†æœºåˆ¶
4.  ç¡®è®¤ç€è‰²å™¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ç»‘å®šç‰¹æ€§

### 4.3 éªŒè¯å‡è®¾

1.  åœ¨Live2DPlatformViewçš„onSurfaceCreatedä¸­æ·»åŠ æ—¥å¿—
2.  è§‚å¯ŸLive2D\_v3.init()çš„è°ƒç”¨æ—¶æœº
3.  ç¡®è®¤OpenGLé”™è¯¯çš„è§¦å‘æ—¶æœº
4.  éªŒè¯ç‹¬ç«‹åˆå§‹åŒ–æ–¹æ¡ˆçš„æœ‰æ•ˆæ€§

5\. ç»éªŒæ•™è®­
--------

### 5.1 OpenGLä¸Šä¸‹æ–‡ç®¡ç†

*   åœ¨Androidä¸­ä½¿ç”¨å¤šä¸ªGLSurfaceViewæ—¶ï¼Œè¦æ³¨æ„ä¸Šä¸‹æ–‡éš”ç¦»
*   OpenGLèµ„æºä¸èƒ½è·¨ä¸Šä¸‹æ–‡å…±äº«
*   æ¯ä¸ªä¸Šä¸‹æ–‡éœ€è¦ç‹¬ç«‹åˆå§‹åŒ–å’Œæ¸…ç†èµ„æº

### 5.2 Live2D SDKé›†æˆ

*   Live2D SDKçš„æ¡†æ¶åˆå§‹åŒ–å¯ä»¥å…¨å±€è¿›è¡Œ
*   ä½†æ¸²æŸ“ç›¸å…³çš„èµ„æºï¼ˆç€è‰²å™¨ç¨‹åºã€çº¹ç†ç­‰ï¼‰éœ€è¦æ¯ä¸ªä¸Šä¸‹æ–‡ç‹¬ç«‹åˆ›å»º
*   æ¨¡å‹å®ä¾‹ä¹Ÿåº”è¯¥æ¯ä¸ªä¸Šä¸‹æ–‡ç‹¬ç«‹åˆ›å»º

### 5.3 Flutter PlatformViewå¼€å‘

*   PlatformViewçš„ç”Ÿå‘½å‘¨æœŸä¸åŸç”ŸViewä¸€è‡´
*   éœ€è¦æ­£ç¡®å¤„ç†OpenGLä¸Šä¸‹æ–‡çš„åˆ›å»ºå’Œé”€æ¯
*   é¿å…åœ¨PlatformViewä¸­ä½¿ç”¨é™æ€çš„OpenGLèµ„æº

6\. æœ€ä½³å®è·µ
--------

### 6.1 åˆå§‹åŒ–æ¨¡å¼

    // æ¨èçš„åˆå§‹åŒ–æ¨¡å¼
    class MyRenderer(private val context: Context) : GLSurfaceView.Renderer {
        private lateinit var model: LAppModel
    
        override fun onSurfaceCreated(gl: GL10?, config: EGLConfig?) {
            // æ¯ä¸ªOpenGLä¸Šä¸‹æ–‡ç‹¬ç«‹åˆå§‹åŒ–
            Live2D_v3.init(context)
            
            // åˆ›å»ºç‹¬ç«‹çš„æ¨¡å‹å®ä¾‹
            model = LAppModel()
            model.loadModelJson("assets://model/xxx.model3.json")
        }
    
        override fun onSurfaceDestroyed(gl: GL10?) {
            // æ¸…ç†èµ„æº
            // æ³¨æ„ï¼šLive2D_v3.dispose()ä¸åº”è¯¥åœ¨è¿™é‡Œè°ƒç”¨
            // å› ä¸ºå¯èƒ½è¿˜æœ‰å…¶ä»–OpenGLä¸Šä¸‹æ–‡åœ¨ä½¿ç”¨
        }
    }
    

### 6.2 èµ„æºç®¡ç†

*   é¿å…åœ¨å¤šä¸ªOpenGLä¸Šä¸‹æ–‡ä¹‹é—´å…±äº«OpenGLèµ„æº
*   æ¯ä¸ªä¸Šä¸‹æ–‡ç‹¬ç«‹åˆ›å»ºå’Œç®¡ç†è‡ªå·±çš„èµ„æº
*   æ³¨æ„èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼Œé¿å…å†…å­˜æ³„æ¼

### 6.3 é”™è¯¯å¤„ç†

*   ä½¿ç”¨glGetError()æ£€æµ‹OpenGLé”™è¯¯
*   è®°å½•è¯¦ç»†çš„æ—¥å¿—ä»¥ä¾¿æ’æŸ¥é—®é¢˜
*   ç†è§£OpenGLé”™è¯¯ç çš„å«ä¹‰ï¼ˆå¦‚0x501 = GL\_INVALID\_VALUEï¼‰

7\. æ€»ç»“
------

é€šè¿‡è¿™æ¬¡é—®é¢˜æ’æŸ¥å’Œä¿®å¤ï¼Œæˆ‘ä»¬æ·±å…¥ç†è§£äº†ï¼š

1.  **Flutter PlatformViewçš„å·¥ä½œåŸç†**
2.  **OpenGLä¸Šä¸‹æ–‡çš„ç®¡ç†æœºåˆ¶**
3.  **Live2D SDKçš„æ­£ç¡®é›†æˆæ–¹å¼**
4.  **è·¨ä¸Šä¸‹æ–‡èµ„æºå…±äº«çš„é™åˆ¶**

æ ¸å¿ƒè§£å†³æ–¹æ¡ˆæ˜¯ï¼š**æ¯ä¸ªOpenGLä¸Šä¸‹æ–‡ç‹¬ç«‹åˆå§‹åŒ–Live2Dç›¸å…³çš„æ¸²æŸ“èµ„æº**ï¼Œç¡®ä¿ç€è‰²å™¨ç¨‹åºç­‰OpenGLèµ„æºåœ¨æ­£ç¡®çš„ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºå’Œä½¿ç”¨ã€‚

è¿™ä¸ªç»éªŒå¯¹äºå…¶ä»–éœ€è¦é›†æˆOpenGLæ¸²æŸ“çš„Flutteré¡¹ç›®ä¹Ÿå…·æœ‰å‚è€ƒä»·å€¼ã€‚