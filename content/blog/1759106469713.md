---
layout: post
title: 'ã€å…‰ç…§ã€‘[PBR][æ³•çº¿åˆ†å¸ƒ]GGXå®ç°æ–¹æ³•å¯¹æ¯”'
date: "2025-09-29T00:41:09Z"
---
ã€å…‰ç…§ã€‘\[PBR\]\[æ³•çº¿åˆ†å¸ƒ\]GGXå®ç°æ–¹æ³•å¯¹æ¯”
============================

![ã€å…‰ç…§ã€‘[PBR][æ³•çº¿åˆ†å¸ƒ]GGXå®ç°æ–¹æ³•å¯¹æ¯”](https://img2024.cnblogs.com/blog/3685400/202509/3685400-20250929082909055-1953213680.png) GGXæ˜¯Unity URPæ¸²æŸ“ç®¡çº¿ä¸­çš„æ ¸å¿ƒæ³•çº¿åˆ†å¸ƒå‡½æ•°ï¼Œç”±Walterç­‰äººåœ¨2007å¹´æå‡ºã€‚ç›¸æ¯”ä¼ ç»Ÿåˆ†å¸ƒå‡½æ•°ï¼ŒGGXå…·æœ‰é•¿å°¾ç‰¹æ€§ï¼Œèƒ½æ›´çœŸå®åœ°æ¨¡æ‹Ÿæè´¨é«˜å…‰è¡°å‡ï¼ŒåŒæ—¶ä¿è¯èƒ½é‡å®ˆæ’ã€‚URPé€šè¿‡BRDF.hlslå®ç°äº†GGXåˆ†å¸ƒåŠå…¶å„å‘å¼‚æ€§ç‰ˆæœ¬ï¼Œæ”¯æŒä»é”åˆ©é«˜å…‰åˆ°æŸ”å’Œæ•£å°„çš„å¹³æ»‘è¿‡æ¸¡ã€‚è™½ç„¶è®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼Œä½†URPé‡‡ç”¨é¢„ç§¯åˆ†ã€è¿‘ä¼¼è®¡ç®—ç­‰ä¼˜åŒ–æŠ€æœ¯ï¼Œä½¿å…¶åœ¨ç§»åŠ¨ç«¯ä¹Ÿèƒ½è‰¯å¥½è¿è¡Œã€‚GGXå·²æˆä¸ºç°ä»£PBRæ¸²æŸ“çš„é‡è¦æ ‡å‡†ï¼Œä¸ºæ¸¸æˆå¸¦æ¥æ›´çœŸå®çš„æè´¨è¡¨ç°ã€‚

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

**GGXçš„å…¨ç§°ä¸åŸºæœ¬æ¦‚å¿µ**
===============

â€Œ**GGXçš„å…¨ç§°**â€Œï¼šGround Glass X (æˆ– Generalized Trowbridge-Reitz Distribution)

â€Œ**é¦–æ¬¡æå‡º**â€Œï¼šWalterç­‰äººåœ¨2007å¹´å‘è¡¨çš„è®ºæ–‡ã€ŠMicrofacet Models for Refraction through Rough Surfacesã€‹ä¸­æå‡º

GGXæ˜¯ä¸€ç§â€Œ**æ³•çº¿åˆ†å¸ƒå‡½æ•°**â€Œ(Normal Distribution Function, NDF)ï¼Œç”¨äºæè¿°å¾®è¡¨é¢æ¨¡å‹ä¸­å¾®è§‚å‡ ä½•è¡¨é¢æ³•çº¿çš„æ¦‚ç‡åˆ†å¸ƒã€‚å®ƒæ˜¯Unity URPä¸­PBRæ¸²æŸ“çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œæ›¿ä»£äº†ä¼ ç»Ÿçš„Beckmannåˆ†å¸ƒã€‚

**GGXçš„æ•°å­¦åŸç†**
============

**æ ¸å¿ƒå…¬å¼**
--------

åœ¨Unity URPä¸­ï¼ŒGGXåˆ†å¸ƒçš„å®ç°åŸºäºä»¥ä¸‹å…¬å¼ï¼š

$D\_{GGX}(h)=\\frac{Î±\_g2}{Ï€\[(nâ‹…h)2(Î±\_g2âˆ’1)+1\]2}$

å…¶ä¸­ï¼š

*   hï¼šåŠè§’å‘é‡ï¼ˆå…‰çº¿æ–¹å‘ä¸è§†çº¿æ–¹å‘çš„ä¸­é—´å‘é‡ï¼‰
*   nï¼šè¡¨é¢æ³•çº¿
*   $Î±\_g$ï¼šç²—ç³™åº¦å‚æ•°ï¼ˆ$Î±\_g=roughness^2$ï¼‰

**Unity URPä¸­çš„ä»£ç å®ç°**
===================

åœ¨`Packages/com.unity.render-pipelines.universal/ShaderLibrary/BRDF.hlsl`ä¸­ï¼š

    hlsl
    // GGX/Trowbridge-Reitzåˆ†å¸ƒå‡½æ•°
    float D_GGX(float NdotH, float roughness)
    {
        float a = roughness * roughness;  // ç²—ç³™åº¦å¹³æ–¹
        float a2 = a * a;
        float NdotH2 = NdotH * NdotH;
    
        float denom = NdotH2 * (a2 - 1.0) + 1.0;
        denom = PI * denom * denom;
    
        return a2 / max(denom, 0.000001); // é¿å…é™¤é›¶é”™è¯¯
    }
    

**GGXçš„æ ¸å¿ƒç‰¹æ€§**
============

â€Œ**é•¿å°¾åˆ†å¸ƒç‰¹æ€§**â€Œ
------------

*   ç›¸æ¯”Beckmannåˆ†å¸ƒï¼ŒGGXå…·æœ‰æ›´é•¿çš„"å°¾å·´"
*   èƒ½æ›´å¥½åœ°æ¨¡æ‹ŸçœŸå®ä¸–ç•Œçš„æè´¨é«˜å…‰è¡°å‡
*   äº§ç”Ÿæ›´è‡ªç„¶çš„åå°„å…‰æ™•æ•ˆæœ

â€Œ**èƒ½é‡å®ˆæ’**â€Œ
----------

*   $âˆ«\_Î©D\_{GGX}(h)(nâ‹…h)dÏ‰=1$
*   ä¿è¯äº†å…‰çº¿èƒ½é‡åœ¨åå°„è¿‡ç¨‹ä¸­ä¸ä¼šæ— æ•…å¢åŠ æˆ–å‡å°‘
*   æ˜¯PBRæ¸²æŸ“çš„åŸºç¡€è¦æ±‚

â€Œ**å„å‘åŒæ€§/å„å‘å¼‚æ€§æ”¯æŒ**â€Œ
-----------------

    hlsl
    // URPä¸­å„å‘å¼‚æ€§GGXå®ç°
    float D_GGX_Anisotropic(float NdotH, float HdotX, float HdotY, float ax, float ay)
    {
        float denom = HdotX*HdotX/(ax*ax) + HdotY*HdotY/(ay*ay) + NdotH*NdotH;
        return 1.0 / (PI * ax * ay * denom * denom);
    }
    

**GGXä¸å…¶ä»–åˆ†å¸ƒå‡½æ•°å¯¹æ¯”**
================

ç‰¹æ€§

GGX

Beckmann

Blinn-Phong

â€Œ**çœŸå®åº¦**â€Œ

â˜…â˜…â˜…â˜…â˜†

â˜…â˜…â˜…â˜†â˜†

â˜…â˜…â˜†â˜†â˜†

â€Œ**æ€§èƒ½å¼€é”€**â€Œ

â˜…â˜…â˜†â˜†â˜†

â˜…â˜…â˜…â˜†â˜†

â˜…â˜†â˜†â˜†â˜†

â€Œ**é•¿å°¾è¡¨ç°**â€Œ

ä¼˜å¼‚

ä¸­ç­‰

è¾ƒå·®

â€Œ**ç§»åŠ¨ç«¯æ”¯æŒ**â€Œ

è‰¯å¥½

ä¸€èˆ¬

ä¼˜ç§€

â€Œ**URPé»˜è®¤**â€Œ

æ˜¯

å¦

ä»…åœ¨SimpleLitä¸­ä½¿ç”¨

**GGXåœ¨Unity URPä¸­çš„å®é™…åº”ç”¨**
=======================

**æè´¨ç²—ç³™åº¦æ˜ å°„**
-----------

    hlsl
    // ç²—ç³™åº¦å¤„ç†æµç¨‹
    float perceptualRoughness = PerceptualSmoothnessToPerceptualRoughness(smoothness);
    float roughness = PerceptualRoughnessToRoughness(perceptualRoughness);
    
    // åº”ç”¨çº¹ç†é‡‡æ ·
    roughness = roughness * _RoughnessMap.Sample(sampler_MainTex, uv).r;
    

**é«˜å…‰åå°„è®¡ç®—**
----------

    hlsl
    // BRDF.hlslä¸­çš„å®Œæ•´é•œé¢åå°„è®¡ç®—
    half3 BRDF_SpecularGGX(half3 F0, half roughness, half NdotH, half NdotL, half NdotV, half LdotH)
    {
        half D = D_GGX(NdotH, roughness); // GGXæ³•çº¿åˆ†å¸ƒ
        half V = V_SmithGGXCorrelated(NdotL, NdotV, roughness); // å‡ ä½•è¡°å‡
        half3 F = F_Schlick(LdotH, F0); // è²æ¶…å°”åå°„
    
        return (D * V) * F;
    }
    

**ç¯å¢ƒå…‰åå°„å¤„ç†**
-----------

    hlsl
    // ç¯å¢ƒBRDFè®¡ç®—ï¼ˆä½¿ç”¨GGXåˆ†å¸ƒï¼‰
    half2 envBRDF = tex2D(_BRDFLUT, float2(NdotV, roughness)).rg;
    half3 envSpecular = specularColor * envBRDF.x + envBRDF.y;
    

**GGXçš„è§†è§‰è¡¨ç°ç‰¹ç‚¹**
==============

â€Œ**ç²—ç³™æè´¨è¡¨ç°**â€Œ
------------

*   ä½ç²—ç³™åº¦ï¼šé”åˆ©çš„é«˜å…‰åå°„
*   ä¸­ç²—ç³™åº¦ï¼šæŸ”å’Œçš„æ•£å°„å…‰æ™•
*   é«˜ç²—ç³™åº¦ï¼šå‡åŒ€çš„æ¼«åå°„å¤–è§‚

â€Œ**è¾¹ç¼˜å“åº”**â€Œ
----------

*   åœ¨æè´¨è¾¹ç¼˜äº§ç”Ÿè‡ªç„¶çš„äº®åº¦è¡°å‡
*   æ¨¡æ‹ŸçœŸå®ç‰©ä½“çš„è²æ¶…å°”æ•ˆåº”

â€Œ**æè´¨è¿ç»­æ€§**â€Œ
-----------

*   ç²—ç³™åº¦å‚æ•°ä»0åˆ°1å˜åŒ–æ—¶è¡¨ç°å¹³æ»‘è¿‡æ¸¡
*   é¿å…ä¼ ç»Ÿæ¨¡å‹çš„çªå…€å˜åŒ–

**æ€§èƒ½ä¼˜åŒ–æŠ€å·§**
==========

â€Œ**è¿‘ä¼¼è®¡ç®—**â€Œ
----------

    hlsl
    // GGXçš„ç§»åŠ¨ç«¯è¿‘ä¼¼
    float D_GGX_Mobile(float NdotH, float roughness)
    {
        float a = roughness * roughness;
        float a2 = a * a;
        float d = NdotH * NdotH * (a2 - 1.0) + 1.0;
        return a2 / (d * d * PI);
    }
    

â€Œ**é¢„ç§¯åˆ†æŠ€æœ¯**â€Œ
-----------

*   URPä½¿ç”¨é¢„è®¡ç®—çš„BRDFæŸ¥æ‰¾çº¹ç†(\_BRDFLUT)
*   å°†å¤æ‚è®¡ç®—è½¬ç§»åˆ°é¢„å¤„ç†é˜¶æ®µ

â€Œ**åŠ¨æ€é™çº§**â€Œ
----------

    hlsl
    #if defined(SHADER_API_MOBILE)
       // ç§»åŠ¨ç«¯ç®€åŒ–ç‰ˆGGX
    #else
       // å®Œæ•´ç²¾åº¦GGX
    #endif
    

GGXåˆ†å¸ƒä½œä¸ºUnity URPä¸­PBRæ¸²æŸ“çš„æ ¸å¿ƒï¼Œé€šè¿‡å…¶ç‹¬ç‰¹çš„æ•°å­¦ç‰¹æ€§å’Œé•¿å°¾åˆ†å¸ƒï¼Œå®ç°äº†æ¯”ä¼ ç»Ÿæ¨¡å‹æ›´çœŸå®çš„æè´¨è¡¨ç°ã€‚è™½ç„¶è®¡ç®—å¤æ‚åº¦ç•¥é«˜ï¼Œä½†å…¶åœ¨è§†è§‰è´¨é‡å’Œç‰©ç†å‡†ç¡®æ€§ä¸Šçš„ä¼˜åŠ¿ä½¿å…¶æˆä¸ºç°ä»£å®æ—¶æ¸²æŸ“çš„æ ‡å‡†é€‰æ‹©ã€‚

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰