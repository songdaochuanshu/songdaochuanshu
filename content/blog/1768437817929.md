---
layout: post
title: 'Webå®‰å…¨æ¸…å•â€”â€”XSSã€CSRFã€SQLæ³¨å…¥ã€é˜²é‡æ”¾ä¸æ•æ„Ÿæ•°æ®ä¿æŠ¤çš„åˆ†å±‚ç­–ç•¥'
date: "2026-01-15T00:43:37Z"
---
Webå®‰å…¨æ¸…å•â€”â€”XSSã€CSRFã€SQLæ³¨å…¥ã€é˜²é‡æ”¾ä¸æ•æ„Ÿæ•°æ®ä¿æŠ¤çš„åˆ†å±‚ç­–ç•¥
=======================================

**å†™åœ¨å‰é¢ï¼Œæœ¬äººç›®å‰å¤„äºæ±‚èŒä¸­ï¼Œå¦‚æœ‰åˆé€‚å†…æ¨å²—ä½ï¼Œè¯·åŠ ï¼šlpshiyue æ„Ÿè°¢ã€‚åŒæ—¶è¿˜æœ›å¤§å®¶ä¸€é”®ä¸‰è¿ï¼Œèµšç‚¹å¥¶ç²‰é’±ã€‚**

> ç°ä»£Webå®‰å…¨é˜²å¾¡ä¸æ˜¯å•ç‚¹å·¥å…·çš„ç»„åˆï¼Œè€Œæ˜¯ä»æ¸²æŸ“å±‚åˆ°æ•°æ®å±‚çš„çºµæ·±é˜²å¾¡ä½“ç³»

åœ¨å»ºç«‹å®Œå–„çš„è®¤è¯æˆæƒä½“ç³»åï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨Webåº”ç”¨çš„åŸºç¡€å®‰å…¨é˜²çº¿ã€‚æ— è®ºæ˜¯ä¼ ç»ŸWebåº”ç”¨è¿˜æ˜¯ç°ä»£APIæœåŠ¡ï¼Œéƒ½é¢ä¸´ç€æ¥è‡ªå¤šå±‚é¢çš„å®‰å…¨å¨èƒã€‚æœ¬æ–‡å°†ç³»ç»Ÿé˜è¿°XSSã€CSRFã€SQLæ³¨å…¥ç­‰æ ¸å¿ƒæ”»å‡»çš„é˜²å¾¡ç­–ç•¥ï¼Œå¹¶æä¾›ä»å‰ç«¯åˆ°æ•°æ®åº“çš„å®Œæ•´å®‰å…¨æ¸…å•ã€‚

1 Webå®‰å…¨é˜²å¾¡çš„æ•´ä½“è§†è§’ï¼šçºµæ·±é˜²å¾¡æˆ˜ç•¥
---------------------

### 1.1 ç°ä»£Webå®‰å…¨çš„å±‚æ¬¡åŒ–é˜²å¾¡ç†å¿µ

Webå®‰å…¨æœ¬è´¨ä¸Šæ˜¯ä¸€åœº**æ”»é˜²ä¸å¯¹ç§°**çš„æˆ˜äº‰ã€‚æ”»å‡»è€…åªéœ€æ‰¾åˆ°ä¸€ä¸ªæ¼æ´å³å¯å®ç°å…¥ä¾µï¼Œè€Œé˜²å¾¡è€…éœ€è¦ä¿æŠ¤æ•´ä¸ªç³»ç»Ÿã€‚å› æ­¤ï¼Œ**çºµæ·±é˜²å¾¡**ï¼ˆDefense in Depthï¼‰æˆä¸ºç°ä»£Webå®‰å…¨çš„æ ¸å¿ƒç†å¿µã€‚

**çºµæ·±é˜²å¾¡çš„ä¸‰ä¸ªæ ¸å¿ƒå±‚é¢**ï¼š

*   **æ¸²æŸ“å±‚å®‰å…¨**ï¼šæµè§ˆå™¨ç¯å¢ƒä¸‹çš„XSSã€CSRFç­‰å®¢æˆ·ç«¯æ”»å‡»é˜²æŠ¤
*   **åº”ç”¨å±‚å®‰å…¨**ï¼šæœåŠ¡ç«¯é€»è¾‘å±‚é¢çš„SQLæ³¨å…¥ã€å‘½ä»¤æ³¨å…¥ç­‰æ¼æ´é˜²æŠ¤
*   **æ•°æ®å±‚å®‰å…¨**ï¼šæ•æ„Ÿæ•°æ®å­˜å‚¨ã€ä¼ è¾“è¿‡ç¨‹ä¸­çš„åŠ å¯†ä¿æŠ¤

### 1.2 å®‰å…¨è¾¹ç•Œçš„é‡æ–°å®šä¹‰

éšç€å‰åç«¯åˆ†ç¦»å’ŒAPIä¼˜å…ˆæ¶æ„çš„æ™®åŠï¼ŒWebå®‰å…¨çš„**æ”»å‡»é¢**å‘ç”Ÿäº†æ˜¾è‘—å˜åŒ–ã€‚ä¼ ç»Ÿä»¥æœåŠ¡å™¨ä¸ºä¸­å¿ƒçš„é˜²æŠ¤æ¨¡å¼éœ€è¦æ‰©å±•ä¸º**å…¨é“¾è·¯é˜²æŠ¤**ï¼š

    å®¢æˆ·ç«¯å®‰å…¨ â†’ ä¼ è¾“å®‰å…¨ â†’ æœåŠ¡ç«¯å®‰å…¨ â†’ æ•°æ®å­˜å‚¨å®‰å…¨
    

æ¯ä¸ªç¯èŠ‚éƒ½éœ€è¦ç‰¹å®šçš„é˜²æŠ¤ç­–ç•¥ï¼Œä¸”ç¯èŠ‚é—´éœ€è¦å®‰å…¨ååŒã€‚ä¾‹å¦‚ï¼ŒCSPï¼ˆå†…å®¹å®‰å…¨ç­–ç•¥ï¼‰éœ€è¦åœ¨HTTPå“åº”å¤´ä¸­è®¾ç½®ï¼Œä½†å½±å“çš„æ˜¯æµè§ˆå™¨ç«¯çš„èµ„æºåŠ è½½è¡Œä¸ºã€‚

2 XSSé˜²æŠ¤ï¼šä»è¾“å…¥åˆ°è¾“å‡ºçš„å…¨æµç¨‹æ§åˆ¶
--------------------

### 2.1 XSSæ”»å‡»çš„æœ¬è´¨ä¸å˜ç§

XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰çš„æ ¸å¿ƒé—®é¢˜æ˜¯**å°†ç”¨æˆ·è¾“å…¥é”™è¯¯åœ°æ‰§è¡Œä¸ºä»£ç **ã€‚æ ¹æ®æ”»å‡»æ‰‹æ³•çš„ä¸åŒï¼ŒXSSä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š

**åå°„å‹XSS**ï¼šæ¶æ„è„šæœ¬ä½œä¸ºè¯·æ±‚å‚æ•°å‘é€åˆ°æœåŠ¡å™¨ï¼Œå¹¶ç«‹å³è¿”å›æ‰§è¡Œã€‚å¸¸è§äºæœç´¢æ¡†ã€é”™è¯¯æ¶ˆæ¯é¡µé¢ã€‚

**å­˜å‚¨å‹XSS**ï¼šæ¶æ„è„šæœ¬è¢«æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œæ¯æ¬¡é¡µé¢è®¿é—®éƒ½ä¼šæ‰§è¡Œã€‚å¸¸è§äºè®ºå›è¯„è®ºã€ç”¨æˆ·åé¦ˆç­‰UGCå†…å®¹ã€‚

**DOMå‹XSS**ï¼šå®Œå…¨åœ¨æµè§ˆå™¨ç«¯å‘ç”Ÿï¼Œé€šè¿‡ä¿®æ”¹DOMæ ‘æ¥æ‰§è¡Œæ¶æ„è„šæœ¬ã€‚ä¸æ¶‰åŠæœåŠ¡å™¨ç«¯å‚ä¸ã€‚

### 2.2 å¤šå±‚æ¬¡XSSé˜²æŠ¤ç­–ç•¥

**è¾“å…¥éªŒè¯ä¸è¿‡æ»¤**æ˜¯Xé˜²æŠ¤çš„ç¬¬ä¸€é“é˜²çº¿ï¼Œä½†ä¸åº”æ˜¯å”¯ä¸€é˜²çº¿ã€‚

    // ä½¿ç”¨JSoupè¿›è¡ŒHTMLæ ‡ç­¾è¿‡æ»¤çš„ç¤ºä¾‹
    public class XssFilter {
        private static final Whitelist WHITELIST = Whitelist.basic();
        
        public static String clean(String input) {
            if (input == null) return "";
            return Jsoup.clean(input, WHITELIST);  // ä»…å…è®¸å®‰å…¨çš„HTMLæ ‡ç­¾
        }
    }
    

**è¾“å‡ºç¼–ç **æ˜¯æ›´å¯é çš„é˜²æŠ¤æ‰‹æ®µï¼Œç¡®ä¿æ•°æ®åœ¨æ¸²æŸ“æ—¶ä¸è¢«æ‰§è¡Œä¸ºä»£ç ã€‚

    <!-- åœ¨æ¨¡æ¿ä¸­è¿›è¡Œè¾“å‡ºç¼–ç  -->
    <div th:text="${userContent}"></div>  <!-- å®‰å…¨ï¼šThymeleafè‡ªåŠ¨ç¼–ç  -->
    <div>[[${userContent}]]</div>         <!-- å®‰å…¨ï¼šThymeleafç®€å†™è¯­æ³• -->
    
    <!-- å±é™©ï¼šç›´æ¥è¾“å‡ºæœªç¼–ç çš„å†…å®¹ -->
    <div th:utext="${userContent}"></div>  <!-- å¯èƒ½æ‰§è¡Œæ¶æ„è„šæœ¬ -->
    

**å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰** æä¾›äº†æœ€ç»ˆçš„é˜²çº¿ï¼Œé€šè¿‡ç™½åå•æ§åˆ¶èµ„æºåŠ è½½ã€‚

    Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted.cdn.com; style-src 'self' 'unsafe-inline';
    

### 2.3 ç°ä»£å‰ç«¯æ¡†æ¶çš„XSSé˜²æŠ¤

ç°ä»£å‰ç«¯æ¡†æ¶å¦‚Reactã€Vueç­‰æä¾›äº†**ä¸€å®šç¨‹åº¦çš„è‡ªåŠ¨é˜²æŠ¤**ï¼Œä½†ä»æœ‰æ³¨æ„äº‹é¡¹ï¼š

**Reactçš„è‡ªåŠ¨è½¬ä¹‰æœºåˆ¶**ï¼š

    // å®‰å…¨ï¼šReactä¼šè‡ªåŠ¨å¯¹å˜é‡è¿›è¡Œè½¬ä¹‰
    function Welcome(props) {
        return <h1>Hello, {props.username}</h1>;  // usernameä¸­çš„HTMLä¼šè¢«è½¬ä¹‰
    }
    
    // å±é™©ï¼šä½¿ç”¨dangerouslySetInnerHTMLç»•è¿‡é˜²æŠ¤
    function DangerousComponent({ content }) {
        return <div dangerouslySetInnerHTML={{ __html: content }} />;
    }
    

**Vueçš„ç±»ä¼¼æœºåˆ¶**ï¼š

    <!-- å®‰å…¨ï¼šVueè‡ªåŠ¨è½¬ä¹‰ -->
    <div>{{ userInput }}</div>
    
    <!-- å±é™©ï¼šä½¿ç”¨v-htmlæŒ‡ä»¤ -->
    <div v-html="userInput"></div>
    

3 CSRFé˜²æŠ¤ï¼šç¡®ä¿è¯·æ±‚çš„åˆæ³•æ€§éªŒè¯
-------------------

### 3.1 CSRFæ”»å‡»åŸç†ä¸å±å®³

CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰æ”»å‡»åˆ©ç”¨**æµè§ˆå™¨çš„åŒç«™Cookieå‘é€æœºåˆ¶**ï¼Œè¯±ä½¿ç”¨æˆ·åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å‘èµ·æ¶æ„è¯·æ±‚ã€‚

**å…¸å‹æ”»å‡»æµç¨‹**ï¼š

1.  ç”¨æˆ·ç™»å½•æ­£è§„ç½‘ç«™Aï¼Œè·å¾—è®¤è¯Cookie
2.  ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™Bï¼Œé¡µé¢ä¸­åŒ…å«å‘ç½‘ç«™Aå‘è¯·æ±‚çš„ä»£ç 
3.  æµè§ˆå™¨è‡ªåŠ¨æºå¸¦ç½‘ç«™Açš„Cookieå‘å‡ºè¯·æ±‚
4.  ç½‘ç«™Aè®¤ä¸ºè¿™æ˜¯ç”¨æˆ·çš„åˆæ³•æ“ä½œï¼Œæ‰§è¡Œæ¶æ„è¯·æ±‚

### 3.2 CSRFé˜²æŠ¤çš„ååŒç­–ç•¥

**CSRF Token**æ˜¯é˜²æŠ¤CSRFæœ€æœ‰æ•ˆçš„æ‰‹æ®µï¼Œè¦æ±‚æ¯ä¸ªè¯·æ±‚æºå¸¦ä¸å¯é¢„æµ‹çš„ä»¤ç‰Œã€‚

    // Spring Securityä¸­çš„CSRFé˜²æŠ¤é…ç½®
    @Configuration
    @EnableWebSecurity
    public class SecurityConfig extends WebSecurityConfigurerAdapter {
        @Override
        protected void configure(HttpSecurity http) throws Exception {
            http
                .csrf().csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse());
        }
    }
    
    // å‰ç«¯åœ¨è¯·æ±‚ä¸­æºå¸¦CSRF Token
    // <form>ä¸­è‡ªåŠ¨åŒ…å«ï¼š<input type="hidden" name="_csrf" th:value="${_csrf.token}">
    // AJAXè¯·æ±‚éœ€è¦æ‰‹åŠ¨è®¾ç½®å¤´ï¼šX-CSRF-TOKEN: tokenå€¼
    

**SameSite Cookieå±æ€§**ä»æµè§ˆå™¨å±‚é¢æä¾›é˜²æŠ¤ï¼Œé™åˆ¶ç¬¬ä¸‰æ–¹Cookieçš„ä½¿ç”¨ã€‚

    // è®¾ç½®SameSiteå±æ€§çš„Cookie
    Cookie sessionCookie = new Cookie("JSESSIONID", sessionId);
    sessionCookie.setSecure(true);  // ä»…HTTPSä¼ è¾“
    sessionCookie.setHttpOnly(true); // ç¦æ­¢JavaScriptè®¿é—®
    // è®¾ç½®SameSite=Strictï¼Œå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹ä½¿ç”¨
    response.addHeader("Set-Cookie", "JSESSIONID=" + sessionId + "; SameSite=Strict");
    

**å…³é”®æ“ä½œäºŒæ¬¡éªŒè¯**é’ˆå¯¹é‡è¦æ“ä½œï¼ˆå¦‚æ”¯ä»˜ã€ä¿®æ”¹å¯†ç ï¼‰è¦æ±‚é‡æ–°è®¤è¯ã€‚

4 SQLæ³¨å…¥é˜²æŠ¤ï¼šæ•°æ®å±‚è®¿é—®çš„å®‰å…¨è¾¹ç•Œ
--------------------

### 4.1 SQLæ³¨å…¥çš„æ¼”å˜ä¸å±å®³

SQLæ³¨å…¥ä¸ä»…ä»…æ˜¯ä¼ ç»Ÿçš„`' OR '1'='1`æ”»å‡»ï¼Œç°ä»£SQLæ³¨å…¥åŒ…æ‹¬**ç›²æ³¨ã€æ—¶é—´ç›²æ³¨ã€å †å æŸ¥è¯¢**ç­‰å¤æ‚å½¢å¼ã€‚

**SQLæ³¨å…¥çš„ä¸»è¦å±å®³**ï¼š

*   **æ•°æ®æ³„éœ²**ï¼šè·å–æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·å‡­è¯ã€ä¸ªäººæ•°æ®
*   **æ•°æ®ç¯¡æ”¹**ï¼šä¿®æ”¹ã€åˆ é™¤é‡è¦ä¸šåŠ¡æ•°æ®
*   **æƒé™æå‡**ï¼šè·å–æ•°æ®åº“ç®¡ç†å‘˜æƒé™
*   **æœåŠ¡å™¨æ²¦é™·**ï¼šé€šè¿‡æ•°æ®åº“æ‰§è¡Œç³»ç»Ÿå‘½ä»¤

### 4.2 æ ¹æœ¬æ€§è§£å†³æ–¹æ¡ˆï¼šå‚æ•°åŒ–æŸ¥è¯¢

**é¢„ç¼–è¯‘è¯­å¥ï¼ˆPreparedStatementï¼‰** é€šè¿‡å°†SQLä»£ç ä¸æ•°æ®åˆ†ç¦»ï¼Œä»æ ¹æœ¬ä¸Šæœç»æ³¨å…¥å¯èƒ½ã€‚

    // å±é™©ï¼šå­—ç¬¦ä¸²æ‹¼æ¥SQL
    String query = "SELECT * FROM users WHERE username = '" + username + "'";
    Statement stmt = connection.createStatement();
    ResultSet rs = stmt.executeQuery(query);
    
    // å®‰å…¨ï¼šä½¿ç”¨PreparedStatement
    String query = "SELECT * FROM users WHERE username = ?";
    PreparedStatement pstmt = connection.prepareStatement(query);
    pstmt.setString(1, username);  // å‚æ•°ä¼šè¢«æ­£ç¡®è½¬ä¹‰å’Œå¤„ç†
    ResultSet rs = pstmt.executeQuery();
    

**ORMæ¡†æ¶çš„å®‰å…¨ä½¿ç”¨**ï¼š

    // JPA/Hibernateå®‰å…¨ç”¨æ³•
    public interface UserRepository extends JpaRepository<User, Long> {
        // å®‰å…¨ï¼šä½¿ç”¨å‘½åå‚æ•°
        @Query("SELECT u FROM User u WHERE u.username = :username")
        User findByUsername(@Param("username") String username);
        
        // å±é™©ï¼šä½¿ç”¨åŸç”ŸSQLæ‹¼æ¥ï¼ˆä¸æ¨èï¼‰
        @Query(value = "SELECT * FROM users WHERE username = '" + ":username" + "'", nativeQuery = true)
        User findByUsernameUnsafe(@Param("username") String username);
    }
    

### 4.3 æ·±åº¦é˜²å¾¡ï¼šæœ€å°æƒé™åŸåˆ™

**æ•°æ®åº“ç”¨æˆ·æƒé™åˆ†ç¦»**æ˜¯å‡å°‘SQLæ³¨å…¥å±å®³çš„é‡è¦æªæ–½ï¼š

    -- åˆ›å»ºä»…å…·æœ‰æŸ¥è¯¢æƒé™çš„æ•°æ®åº“ç”¨æˆ·
    CREATE USER 'webapp'@'localhost' IDENTIFIED BY 'securepassword';
    GRANT SELECT ON app_db.* TO 'webapp'@'localhost';
    
    -- é‡è¦æ“ä½œä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ï¼Œä»…æˆæƒæ‰§è¡Œæƒé™
    GRANT EXECUTE ON PROCEDURE update_user_profile TO 'webapp'@'localhost';
    

5 é˜²é‡æ”¾æ”»å‡»ï¼šç¡®ä¿è¯·æ±‚çš„æ–°é²œæ€§
----------------

### 5.1 é‡æ”¾æ”»å‡»çš„åŸç†ä¸åœºæ™¯

é‡æ”¾æ”»å‡»æŒ‡æ”»å‡»è€…**æˆªè·åˆæ³•è¯·æ±‚å¹¶é‡å¤å‘é€**ï¼Œå¯¼è‡´éé¢„æœŸæ“ä½œã€‚å¸¸è§äºæ”¯ä»˜ã€é‡è¦çŠ¶æ€å˜æ›´ç­‰åœºæ™¯ã€‚

**é‡æ”¾æ”»å‡»çš„é˜²æŠ¤ç›®æ ‡**ï¼š

*   ç¡®ä¿è¯·æ±‚çš„**æ–°é²œæ€§**ï¼ˆä¸æ˜¯æ—§çš„é‡å¤è¯·æ±‚ï¼‰
*   ä¿è¯è¯·æ±‚çš„**å”¯ä¸€æ€§**ï¼ˆåŒä¸€è¯·æ±‚ä¸èƒ½æ‰§è¡Œä¸¤æ¬¡ï¼‰

### 5.2 åŸºäºNonceå’Œæ—¶é—´æˆ³çš„é˜²æŠ¤æ–¹æ¡ˆ

**Nonceï¼ˆä¸€æ¬¡æ€§æ•°å­—ï¼‰æ–¹æ¡ˆ**ç¡®ä¿æ¯ä¸ªè¯·æ±‚çš„å”¯ä¸€æ€§ã€‚

    @Service
    public class NonceService {
        @Autowired
        private RedisTemplate<String, String> redisTemplate;
        
        private static final long NONCE_TIMEOUT = 5 * 60; // 5åˆ†é’Ÿ
        
        public boolean validateNonce(String nonce, long timestamp) {
            // æ£€æŸ¥æ—¶é—´æˆ³æœ‰æ•ˆæ€§ï¼ˆé˜²æ­¢æ—¶é’Ÿåç§»æ”»å‡»ï¼‰
            long currentTime = System.currentTimeMillis() / 1000;
            if (Math.abs(currentTime - timestamp) > 300) { // 5åˆ†é’Ÿå®¹å¿
                return false;
            }
            
            // æ£€æŸ¥Nonceæ˜¯å¦å·²ä½¿ç”¨ï¼ˆRedisåŸå­æ“ä½œï¼‰
            String key = "nonce:" + nonce;
            return redisTemplate.opsForValue().setIfAbsent(key, "used", 
                Duration.ofSeconds(NONCE_TIMEOUT));
        }
    }
    

**ç­¾åæœºåˆ¶**é˜²æ­¢è¯·æ±‚è¢«ç¯¡æ”¹ï¼š

    public class SignatureUtils {
        public static String generateSignature(String data, String secret) {
            String message = data + secret;
            return DigestUtils.sha256Hex(message);
        }
        
        public static boolean validateSignature(String data, String signature, String secret) {
            String expected = generateSignature(data, secret);
            return MessageDigest.isEqual(expected.getBytes(), signature.getBytes());
        }
    }
    

6 æ•æ„Ÿæ•°æ®ä¿æŠ¤ï¼šå…¨ç”Ÿå‘½å‘¨æœŸå®‰å…¨
----------------

### 6.1 æ•°æ®ä¼ è¾“å®‰å…¨ï¼šTLSæœ€ä½³å®è·µ

**HTTPSé…ç½®ä¼˜åŒ–**ç¡®ä¿æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚

    # Nginx TLSä¼˜åŒ–é…ç½®
    server {
        listen 443 ssl http2;
        server_name example.com;
        
        # è¯ä¹¦é…ç½®
        ssl_certificate /path/to/fullchain.pem;
        ssl_certificate_key /path/to/privkey.pem;
        
        # åè®®å’Œå¯†ç å¥—ä»¶ä¼˜åŒ–
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;
        ssl_prefer_server_ciphers off;
        
        # HSTSå¼ºåˆ¶HTTPS
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
        
        # å®‰å…¨å¤´éƒ¨
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
    }
    

### 6.2 æ•æ„Ÿæ•°æ®å­˜å‚¨å®‰å…¨

**å¯†ç å“ˆå¸Œå¤„ç†**ä½¿ç”¨é€‚åˆçš„ç®—æ³•å’Œç›å€¼ã€‚

    @Service
    public class PasswordService {
        private final BCryptPasswordEncoder passwordEncoder = new BCryptPasswordEncoder();
        
        public String hashPassword(String rawPassword) {
            return passwordEncoder.encode(rawPassword);
        }
        
        public boolean matches(String rawPassword, String encodedPassword) {
            return passwordEncoder.matches(rawPassword, encodedPassword);
        }
    }
    

**å¯é€†åŠ å¯†æ•°æ®**ä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•ã€‚

    @Component
    public class AesEncryptionService {
        private static final String ALGORITHM = "AES/GCM/NoPadding";
        private final SecretKey secretKey;
        
        public AesEncryptionService(@Value("${encryption.key}") String base64Key) {
            byte[] keyBytes = Base64.getDecoder().decode(base64Key);
            this.secretKey = new SecretKeySpec(keyBytes, "AES");
        }
        
        public String encrypt(String data) throws GeneralSecurityException {
            Cipher cipher = Cipher.getInstance(ALGORITHM);
            cipher.init(Cipher.ENCRYPT_MODE, secretKey);
            
            byte[] encrypted = cipher.doFinal(data.getBytes(StandardCharsets.UTF_8));
            byte[] iv = cipher.getIV();
            
            // ç»„åˆIVå’ŒåŠ å¯†æ•°æ®
            byte[] result = new byte[iv.length + encrypted.length];
            System.arraycopy(iv, 0, result, 0, iv.length);
            System.arraycopy(encrypted, 0, result, iv.length, encrypted.length);
            
            return Base64.getEncoder().encodeToString(result);
        }
    }
    

7 å®‰å…¨å¤´éƒ¨é…ç½®ï¼šæµè§ˆå™¨ç«¯çš„å®‰å…¨åŠ å›º
------------------

### 7.1 å…³é”®å®‰å…¨å¤´éƒ¨åŠå…¶ä½œç”¨

**å®‰å…¨å¤´éƒ¨**ä¸ºæµè§ˆå™¨æä¾›é¢å¤–çš„å®‰å…¨æŒ‡ä»¤ï¼Œæ˜¯ç°ä»£Webåº”ç”¨çš„é‡è¦é˜²æŠ¤å±‚ã€‚

    # å®Œæ•´çš„å®‰å…¨å¤´éƒ¨é…ç½®
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';" always;
    

### 7.2 CSPçš„ç²¾ç»†æ§åˆ¶ç­–ç•¥

**å†…å®¹å®‰å…¨ç­–ç•¥**é€šè¿‡ç™½åå•æ§åˆ¶èµ„æºåŠ è½½ï¼Œæœ‰æ•ˆå‡ç¼“XSSæ”»å‡»ã€‚

    # ä¸¥æ ¼çš„CSPç­–ç•¥ç¤ºä¾‹
    Content-Security-Policy: 
      default-src 'none';
      script-src 'self' 'sha256-abc123...';
      style-src 'self' 'unsafe-inline';
      img-src 'self' data: https:;
      font-src 'self';
      connect-src 'self';
      frame-ancestors 'none';
      base-uri 'self';
      form-action 'self';
    

8 è‡ªåŠ¨åŒ–å®‰å…¨æ£€æµ‹ä¸ç›‘æ§
------------

### 8.1 å®‰å…¨å·¥å…·é›†æˆ

**SASTï¼ˆé™æ€åº”ç”¨å®‰å…¨æµ‹è¯•ï¼‰** åœ¨å¼€å‘é˜¶æ®µå‘ç°æ½œåœ¨æ¼æ´ã€‚

    # GitLab CIå®‰å…¨æ‰«æç¤ºä¾‹
    stages:
      - test
      - security
    
    sast:
      stage: security
      image: owasp/zap2docker-stable
      script:
        - zap-baseline.py -t https://${STAGING_URL} -r report.html
      artifacts:
        paths:
          - report.html
    

**ä¾èµ–é¡¹æ¼æ´æ‰«æ**åŠæ—¶å‘ç°ç¬¬ä¸‰æ–¹ç»„ä»¶é£é™©ã€‚

    <!-- OWASPä¾èµ–æ£€æŸ¥Mavenæ’ä»¶ -->
    <plugin>
        <groupId>org.owasp</groupId>
        <artifactId>dependency-check-maven</artifactId>
        <version>6.0.0</version>
        <executions>
            <execution>
                <goals>
                    <goal>check</goal>
                </goals>
            </execution>
        </executions>
    </plugin>
    

### 8.2 å®‰å…¨ç›‘æ§ä¸åº”æ€¥å“åº”

**å®‰å…¨äº‹ä»¶æ—¥å¿—è®°å½•**ä¸ºäº‹ä»¶è¿½æº¯æä¾›ä¾æ®ã€‚

    @Aspect
    @Component
    public class SecurityLoggingAspect {
        private static final Logger SECURITY_LOGGER = LoggerFactory.getLogger("SECURITY");
        
        @AfterReturning(pointcut = "execution(* com.example.controller.AuthController.login(..))", returning = "result")
        public void logLoginAttempt(JoinPoint joinPoint, Object result) {
            Object[] args = joinPoint.getArgs();
            String username = (String) args[0];
            String ip = getClientIP();
            
            SECURITY_LOGGER.info("ç™»å½•å°è¯•: ç”¨æˆ·={}, IP={}, ç»“æœ={}", 
                username, ip, ((LoginResult)result).isSuccess() ? "æˆåŠŸ" : "å¤±è´¥");
        }
    }
    

æ€»ç»“
--

Webå®‰å…¨æ˜¯ä¸€ä¸ªéœ€è¦**æŒç»­å…³æ³¨å’ŒæŠ•å…¥**çš„é¢†åŸŸã€‚æœ‰æ•ˆçš„å®‰å…¨é˜²æŠ¤ä¸æ˜¯å•ä¸€æŠ€æœ¯æˆ–å·¥å…·çš„åº”ç”¨ï¼Œè€Œæ˜¯**å¤šå±‚æ¬¡ã€å¤šç»´åº¦é˜²æŠ¤ç­–ç•¥çš„æœ‰æœºç»„åˆ**ã€‚

**çºµæ·±é˜²å¾¡çš„æ ¸å¿ƒåŸåˆ™**ï¼š

1.  **è¾“å…¥éªŒè¯**ï¼šæ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ä¸å¯ä¿¡ï¼Œå¿…é¡»ç»è¿‡ä¸¥æ ¼éªŒè¯
2.  **æœ€å°æƒé™**ï¼šæ¯ä¸ªç»„ä»¶åªæ‹¥æœ‰å®Œæˆå…¶åŠŸèƒ½æ‰€éœ€çš„æœ€å°æƒé™
3.  **é»˜è®¤æ‹’ç»**ï¼šç™½åå•ä¼˜äºé»‘åå•ï¼Œæ˜ç¡®å…è®¸è€Œéé»˜è®¤å…è®¸
4.  **å…¨é¢é˜²æŠ¤**ï¼šä»å®¢æˆ·ç«¯åˆ°æ•°æ®åº“ï¼Œæ¯ä¸ªç¯èŠ‚éƒ½éœ€è¦ç›¸åº”çš„é˜²æŠ¤æªæ–½
5.  **æŒç»­ç›‘æ§**ï¼šå®‰å…¨æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œéœ€è¦æŒç»­ç›‘æ§å’Œæ”¹è¿›

é€šè¿‡å®æ–½æœ¬æ–‡æä¾›çš„åˆ†å±‚é˜²æŠ¤ç­–ç•¥ï¼Œå¯ä»¥æ˜¾è‘—æå‡Webåº”ç”¨çš„å®‰å…¨æ€§ï¼Œä¸ºä¸šåŠ¡å‘å±•æä¾›å¯é çš„åŸºç¡€ä¿éšœã€‚

* * *

**ğŸ“š ä¸‹ç¯‡é¢„å‘Š**  
ã€Šå¥‘çº¦ä¼˜å…ˆä¸åä½œæ•ˆç‡â€”â€”æ¶ˆè´¹è€…é©±åŠ¨å¥‘çº¦æ€ç»´å¸¦æ¥çš„å›¢é˜Ÿæˆæœ¬ä¸‹é™ã€‹â€”â€” æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ï¼š

*   ğŸ“œ **å¥‘çº¦æµ‹è¯•æœ¬è´¨**ï¼šæ¶ˆè´¹è€…é©±åŠ¨å¥‘çº¦ï¼ˆCDCï¼‰å¦‚ä½•è§£è€¦å¾®æœåŠ¡é›†æˆä¾èµ–
*   ğŸ¤ **å›¢é˜Ÿåä½œä¼˜åŒ–**ï¼šå¥‘çº¦ä¼˜å…ˆå¼€å‘æ¨¡å¼å¦‚ä½•å‡å°‘è·¨å›¢é˜Ÿæ²Ÿé€šæˆæœ¬
*   ğŸ”§ **å®è·µè½åœ°è·¯å¾„**ï¼šPactç­‰å·¥å…·åœ¨æŒç»­é›†æˆä¸­çš„é…ç½®ä¸æ‰§è¡Œç­–ç•¥
*   ğŸ’° **æˆæœ¬æ•ˆç›Šåˆ†æ**ï¼šå¥‘çº¦æµ‹è¯•å¸¦æ¥çš„å¼€å‘æ•ˆç‡æå‡ä¸ç¼ºé™·é¢„é˜²æ”¶ç›Š
*   ğŸš€ **å¹³æ»‘è¿ç§»æ–¹æ¡ˆ**ï¼šä»ä¼ ç»Ÿé›†æˆæµ‹è¯•åˆ°å¥‘çº¦æµ‹è¯•çš„æ¸è¿›å¼è¿ç§»

**ç‚¹å‡»å…³æ³¨ï¼ŒæŒæ¡å¾®æœåŠ¡åä½œçš„æ•ˆç‡æå‡ä¹‹é“ï¼**

> **ä»Šæ—¥è¡ŒåŠ¨å»ºè®®**ï¼š
> 
> 1.  æ£€æŸ¥ç°æœ‰é¡¹ç›®çš„å®‰å…¨å¤´éƒ¨é…ç½®ï¼Œç¡®ä¿å…³é”®å¤´éƒ¨æ­£ç¡®è®¾ç½®
> 2.  å¯¹é‡è¦æ¥å£æ·»åŠ é˜²é‡æ”¾æœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯æ”¯ä»˜ã€çŠ¶æ€å˜æ›´ç­‰å…³é”®æ“ä½œ
> 3.  å»ºç«‹ä¾èµ–ç»„ä»¶æ¼æ´æ‰«ææµç¨‹ï¼Œé›†æˆåˆ°CI/CDæµæ°´çº¿
> 4.  å®¡æŸ¥æ•°æ®åŠ å¯†æ–¹æ¡ˆï¼Œç¡®ä¿æ•æ„Ÿä¿¡æ¯å¾—åˆ°é€‚å½“ä¿æŠ¤

ä¸ªäººå¾®ä¿¡ï¼šlpshiyue æ·»åŠ æš—å·ï¼šé“ç”Ÿä¸€  
æ¬¢è¿æœç´¢å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š åŸºç¡€è¿›é˜¶ï¼Œç¬¬ä¸€æ—¶é—´é˜…è¯»æœ€æ–°æ–‡ç« 