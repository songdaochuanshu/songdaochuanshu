---
layout: post
title: '开源EFCore 对比实体与实际数据库结构的工具-GZY.EFCoreCompare'
date: "2025-02-17T00:38:28Z"
---
开源EFCore 对比实体与实际数据库结构的工具-GZY.EFCoreCompare
==========================================

前言

**GZY.EFCoreCompare** 是一个用于 **对比数据库结构和 EF Core 代码中的 DbContext 的库**。

它基于 EF Core 的 **Scaffolding 机制**，生成 `DatabaseModel`（从数据库提取的模型）,

并与代码中的 `DbContext` 进行比对，从而找出两者之间的差异。

开源项目地址:[GZY.EFCoreCompare](https://github.com/l2999019/GZY.EFCoreCompare)

 欢迎start和提issues

主要用途

*   检查数据库与代码是否匹配
    ------------
    
    *   通过 EF Core Scaffolding 解析数据库结构（`DatabaseModel`）。
    *   读取代码中的 `DbContext` 及其 `EntityType` 实体定义。
    *   对比两者的字段、表、主键、索引等内容。
*   检测并生成对应的报表
    ----------
    
    *   发现 数据库中有但代码中没有的表（可能需要删除）。
    *   发现 代码中有但数据库中缺失的表或字段（可能需要添加）。
    *   发现 数据类型、索引、约束等的差异（可能需要修改）。
*   帮助团队进行数据库变更管理
    -------------
    

*   在开发过程中，避免数据库和代码模型不同步。
*   适用于 DBFirst 和 CodeFirst 的开发模式，确保两者一致。
*   可用于 自动化 CI/CD 流水线，在部署前发现问题。
*   可用于 部署/更新后判断数据库是否标准，在部署后发现客户或线上的问题。

对比流程

*   获取数据库结构
    -------
    
    *   使用 EF Core Scaffolding 解析数据库，并生成 `DatabaseModel`。
*   读取代码中的 `DbContext`
    ------------------
    
    *   解析代码中的 `DbContext` 及其实体。
*   比对两者的差异
    -------
    

*   找出 表、字段、类型、索引、主键、外键 等方面的不同。

*   提供UI查看界面与Execl报告
    ----------------
    

*   提供 UI查看界面，用于图形化查看差异。
*   生成 差异报告，供开发人员参考。

使用方式

###  1.直接使用 GZY.EFCoreCompare.Core 进行比对

[](https://github.com/l2999019/GZY.EFCoreCompare#1-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8-gzyefcorecomparecore-%E8%BF%9B%E8%A1%8C%E6%AF%94%E5%AF%B9)

　　直接在项目中通过Nuget引用`GZY.EFCoreCompare.Core`与对应数据库的驱动库,例:`GZY.EFCoreCompare.MySql` 库中，比对代码如下：

var compareEFcore= new CompareEFCore();
compareEFcore.CompareEfWithDbAsync(YourDbContext);

### 2\. 集成图形化UI到项目中,进行持久化比对

[](https://github.com/l2999019/GZY.EFCoreCompare#2-%E9%9B%86%E6%88%90%E5%9B%BE%E5%BD%A2%E5%8C%96ui%E5%88%B0%E9%A1%B9%E7%9B%AE%E4%B8%AD%E8%BF%9B%E8%A1%8C%E6%8C%81%E4%B9%85%E5%8C%96%E6%AF%94%E5%AF%B9)

*   在Web(MVC Raroz)或WebApi项目中通过Nuget引用**`GZY.EFCoreCompare.UI`**与对应的数据库驱动,例如:**`GZY.EFCoreCompare.MySql`**
*   在 Program或Startup中添加如下代码:

 builder.Services.AddDbContext<TestDbContext>(options =>
 {
     string connStr = "";
     options.UseMySql(connStr, new MySqlServerVersion(new Version(8, 0, 20)), builder => {
         builder.SchemaBehavior(MySqlSchemaBehavior.Ignore);
     });
 }); //注入EFDbContext
builder.Services.AddEFCoreCompareUI(new CompareEFCoreConfig { CaseComparer=StringComparer.CurrentCultureIgnoreCase}); //需放在AddDbContext之后
app.UseEFCoreCompareUI(); //添加UI界面

*   在游览器输入地址:`http://localhost:5130/DBCompareUI`, **`/DBCompareUI`**为UI的界面地址
    
*   **输入默认Basic校验账户,账户名:Admin 密码:123456**
*   点击开始对比,进行比对
    
*   效果如下图:
    

![](https://img2024.cnblogs.com/blog/653851/202502/653851-20250217083240239-1202946728.png)

![](https://img2024.cnblogs.com/blog/653851/202502/653851-20250217083312556-356497978.png)

作者：顾振印 出处：http://www.cnblogs.com/GuZhenYin/ 如果您觉得阅读本文对您有帮助，请点一下“推荐”按钮，您的“推荐”将是我最大的写作动力！本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面