---
layout: post
title: 'pnpm 10.14 支持JavaScript运行时的安装了'
date: "2025-08-04T00:52:07Z"
---
pnpm 10.14 支持JavaScript运行时的安装了
==============================

pnpm 10.14 支持JavaScript运行时的安装了

一、用corepack管理pnpm来支持运行时安装功能
===========================

在Node.js 25之前在里面集成了一个实验性的小工具：[corepack](https://github.com/nodejs/corepack)，用来管理包管理器的，比如yarn、pnpm。想要支持JavaScript运行时的安装，可以先启用corepack：

`corepack enable`

然后指定项目所在pnpm的版本：

`corepack prepare pnpm@9.15.4 --activate`

接下来，安装Node.js版本：

`pnpm env use --global 18`

现在，pnpm 10.14 支持JavaScript运行时的安装了。

二、pnpm 10.14的支持方法
=================

那我们在Monorepo项目中，要怎样配置呢？

具体配置步骤如下：

1.  在项目根目录的package.json中添加devEngines.runtimes，指定运行时Node.js版本的范围：

    // package.json
    {
      "devEngines": {
        "runtime": {
          "name": "node",
          "version": "^22.17.0",
          "onFail": "download" // we only support the "download" value for now
        }
      }
    }
    

2.  在子目录，也就是packages/app/package.json的配置是可以覆盖根目录配置的：

    // packages/app/package.json
    {
      "devEngines": {
        "runtime": {
          "name": "node",
              "version": "^18.20.8",
              "onFail": "download"
        }
      }
    }
    

3.  结合node的版本管理工具volta实现版本切换：

    {
      "volta": {
            "node": "18.20.8",
            "pnpm: "9.15.4"
      }
    }
    

当执行`pnpm install`时，如果你本地的开发环境的Node.js版本比如是16.x，而与项目所需要的版本是22.17。那么，就会通过你指定的版本范围去匹配：  

锁文件（lockfile）会保存运行时的版本，以及校验和（checksum)。这样，在本地运行时，也可以保证环境的一致性。

三、用Volta自动切换版本
==============

步骤的第3步，是由Volta通过`volta pin`命令在package.json中生成的volta字段。当进入项目的目录时，Volta自动切换到指定版本。不用像nvm那样手动操作了。

安装 Volta
--------

在终端输入命令：

`curl https://get.volta.sh | base`

就会下载安装了：  

指定Node的版本
---------

输入`volta pin node@22.17.0`  

就会在package.json中生成volta字段：  

pnpm校验devEngines版本
------------------

当执行`pnpm install`时，pnpm会去校验devEngines.runtime的版本，查下版本是否符合。如果符合，就会安装依赖。如果volta指定的版本低于`devEngines.runtime`要求的版本范围，pnpm就会警告版本不匹配。

完整的package.json配置：
------------------

    {
      "devEngines": {
        "runtime": {
          "name": "node",
          "version": "^22.17.0",
          "onFail": "download"
        }
      },
      "volta": {
        "node": "22.17.0"
      }
    }
    

四、总结
====

`devEngines.runtime`就是检查一下环境的兼容性，然后报个警给你而已。并没有执行版本切换，执行还需要volta这个“一次配置，全自动切换”的管理运行时版本的智能工具。