---
layout: post
title: 'ã€å¤§å‰ç«¯æ”»åŸç‹®ä¹‹è·¯ã€‘ç”¨ Typewriter-SSE å®ç°æ‰“å­—æœºæ•ˆæœ'
date: "2025-04-30T00:40:30Z"
---
ã€å¤§å‰ç«¯æ”»åŸç‹®ä¹‹è·¯ã€‘ç”¨ Typewriter-SSE å®ç°æ‰“å­—æœºæ•ˆæœ
==================================

åœ¨ç°ä»£ Web å¼€å‘ä¸­ï¼Œå®ç°åŠ¨æ€æ–‡æœ¬æ¸²æŸ“çš„éœ€æ±‚æ—¥ç›Šå¢å¤šã€‚æ— è®ºæ˜¯èŠå¤©åº”ç”¨ã€å®æ—¶é€šçŸ¥ï¼Œè¿˜æ˜¯äº¤äº’å¼ç•Œé¢ï¼Œæ‰“å­—æœºé£æ ¼çš„æ–‡æœ¬æ¸²æŸ“éƒ½èƒ½æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒã€‚æœ€è¿‘æ–°å†™äº†ä¸€ä¸ªå¼€æºçš„ NPM åŒ…â€”â€”Typewriter-SSEï¼Œå®ƒé€šè¿‡ Server-Sent Events (SSE) æŠ€æœ¯å®ç°äº†æµå¼æ–‡æœ¬ä¼ è¾“å’Œæ‰“å­—æœºæ•ˆæœæ¸²æŸ“ã€‚é¡¹ç›®ä»£ç å·²å¼€æºï¼Œå¯åœ¨ [GitHub](https://github.com/TJ666/typewriter-sse) æŸ¥çœ‹ã€‚æ•ˆæœè§ï¼š

![](https://img2024.cnblogs.com/blog/908144/202504/908144-20250429155644256-1145531194.gif)

ä¸€ã€SSE æŠ€æœ¯ç®€ä»‹
----------

Server-Sent Events (SSE) æ˜¯ä¸€ç§å…è®¸æœåŠ¡å™¨å‘æµè§ˆå™¨å•å‘æ¨é€æ•°æ®çš„æŠ€æœ¯ã€‚ä¸ä¼ ç»Ÿçš„è½®è¯¢æˆ– WebSocket ä¸åŒï¼ŒSSE åŸºäº HTTP åè®®ï¼Œä»…æ”¯æŒæ–‡æœ¬æ•°æ®ä¼ è¾“ï¼Œä¸”æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„è¿æ¥ä¿æŒå¼€å¯çŠ¶æ€ï¼Œç›´åˆ°æœåŠ¡å™¨å…³é—­è¿æ¥ã€‚SSE çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š

1.  å•å‘é€šä¿¡ï¼šä»…æ”¯æŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œé€‚åˆä¸éœ€è¦åŒå‘é€šä¿¡çš„åœºæ™¯ã€‚
    
2.  è½»é‡çº§ï¼šåŸºäº HTTP åè®®ï¼Œæ— éœ€é¢å¤–çš„ WebSocket åè®®æ”¯æŒã€‚
    
3.  è‡ªåŠ¨é‡è¿ï¼šæµè§ˆå™¨ä¼šè‡ªåŠ¨å¤„ç†è¿æ¥ä¸­æ–­åçš„é‡è¿é€»è¾‘ã€‚
    
4.  ç®€å•æ˜“ç”¨ï¼šé€šè¿‡ `EventSource` æ¥å£å³å¯åœ¨å®¢æˆ·ç«¯å®ç° SSE çš„æ¥æ”¶ã€‚
    

SSE çš„å…¸å‹åº”ç”¨åœºæ™¯åŒ…æ‹¬å®æ—¶é€šçŸ¥ã€åŠ¨æ€æ•°æ®æ›´æ–°ç­‰ï¼Œå°¤å…¶é€‚åˆéœ€è¦æœåŠ¡å™¨ä¸»åŠ¨æ¨é€æ•°æ®çš„åœºæ™¯ã€‚

Typewriter-SSE çš„å®ç°åŸç†
--------------------

Typewriter-SSE ç»“åˆäº† SSE æŠ€æœ¯å’Œå‰ç«¯åŠ¨ç”»ï¼Œå®ç°äº†æµå¼æ–‡æœ¬çš„æ‰“å­—æœºæ•ˆæœæ¸²æŸ“ã€‚å…¶æ ¸å¿ƒé€»è¾‘åŒ…æ‹¬ï¼š

1.  SSE æ•°æ®æ¥æ”¶ï¼šé€šè¿‡ `EventSource` æ¥å£è¿æ¥åˆ°æœåŠ¡å™¨ç«¯çš„ SSE ç«¯ç‚¹ï¼Œæ¥æ”¶æœåŠ¡å™¨æ¨é€çš„æ–‡æœ¬æ•°æ®ã€‚
    
2.  é€å­—æ¸²æŸ“ï¼šå°†æ¥æ”¶åˆ°çš„æ–‡æœ¬æ•°æ®é€å­—æ¸²æŸ“åˆ°æŒ‡å®šçš„å®¹å™¨ä¸­ï¼Œé€šè¿‡å®šæ—¶å™¨æ§åˆ¶æ¯ä¸ªå­—ç¬¦çš„æ¸²æŸ“é€Ÿåº¦ï¼Œæ¨¡æ‹Ÿæ‰“å­—æœºæ•ˆæœã€‚
    
3.  å…‰æ ‡åŠ¨ç”»ï¼šé€šè¿‡ CSS åŠ¨ç”»å®ç°å…‰æ ‡çš„é—ªçƒæ•ˆæœï¼Œå¢å¼ºè§†è§‰ä½“éªŒã€‚
    
4.  äº¤äº’æ§åˆ¶ï¼šæä¾›æš‚åœã€æ¢å¤ã€è·³è¿‡å’Œæ¸…ç©ºç­‰æ§åˆ¶æ–¹æ³•ï¼Œå…è®¸ç”¨æˆ·åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è¿›è¡Œæ“ä½œ
    

äºŒã€å¦‚ä½•å®‰è£…å’Œä½¿ç”¨ Typewriter-SSEï¼Ÿ
-------------------------

å®‰è£… Typewriter-SSE éå¸¸ç®€å•ï¼Œåªéœ€è¦é€šè¿‡ npm å‘½ä»¤å³å¯å®Œæˆï¼š

npm install typewriter-sseã€€

åœ¨é¡¹ç›®ä¸­ä½¿ç”¨

import TypewriterSSE from 'typewriter-sse';

const writer = new TypewriterSSE({
  container: '#output', // æŒ‡å®šæ–‡æœ¬æ¸²æŸ“çš„å®¹å™¨
  endpoint: '/sse?q=hello world', // SSE æœåŠ¡ç«¯çš„ URL
  cursor: {
    blink: true, // æ˜¯å¦è®©å…‰æ ‡é—ªçƒ
    color: '#0f0', // å…‰æ ‡é¢œè‰²
    char: '|' // å…‰æ ‡å­—ç¬¦
  },
  onComplete: () => console.log('Finished typing!') // æ–‡æœ¬æ¸²æŸ“å®Œæˆåçš„å›è°ƒå‡½æ•°
});

writer.start();

ä¸‰ã€ä¸»è¦åŠŸèƒ½å’Œé…ç½®é€‰é¡¹
-----------

### 1.Â æ‰“å­—æœºæ•ˆæœ

Typewriter-SSE çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†æ–‡æœ¬é€å­—æ¸²æŸ“åˆ°æŒ‡å®šçš„å®¹å™¨ä¸­ï¼Œæ¨¡æ‹Ÿæ‰“å­—æœºçš„æ•ˆæœã€‚ä½ å¯ä»¥é€šè¿‡ `typingSpeed` é€‰é¡¹æ¥æ§åˆ¶æ¯ä¸ªå­—ç¬¦çš„å»¶è¿Ÿæ—¶é—´ï¼Œä»è€Œè°ƒæ•´æ‰“å­—çš„é€Ÿåº¦ã€‚

### 2.Â SSE æ”¯æŒ

é€šè¿‡ SSE æŠ€æœ¯ï¼ŒTypewriter-SSE èƒ½å¤ŸåŠ¨æ€æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ–‡æœ¬æ•°æ®ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å°†æ–‡æœ¬åˆ†æ®µå‘é€åˆ°å®¢æˆ·ç«¯ï¼Œè€Œå®¢æˆ·ç«¯ä¼šé€å­—æ¸²æŸ“è¿™äº›æ–‡æœ¬ã€‚è¿™ç§æŠ€æœ¯ç‰¹åˆ«é€‚åˆå®ç°èŠå¤©æœºå™¨äººã€å®æ—¶é€šçŸ¥ç­‰åœºæ™¯ã€‚

### 3.Â å…‰æ ‡è‡ªå®šä¹‰

ä½ å¯ä»¥é€šè¿‡ `cursor` é€‰é¡¹æ¥è‡ªå®šä¹‰å…‰æ ‡çš„æ ·å¼ï¼ŒåŒ…æ‹¬æ˜¯å¦é—ªçƒã€é¢œè‰²å’Œå­—ç¬¦ã€‚è¿™è®©ä½ å¯ä»¥æ ¹æ®é¡¹ç›®çš„æ•´ä½“é£æ ¼æ¥è°ƒæ•´å…‰æ ‡çš„è§†è§‰æ•ˆæœã€‚

### 4.Â äº‹ä»¶å›è°ƒ

Typewriter-SSE æä¾›äº†å¤šç§äº‹ä»¶å›è°ƒå‡½æ•°ï¼Œä¾‹å¦‚ `onChar`ï¼ˆæ¯ä¸ªå­—ç¬¦æ¸²æŸ“æ—¶è§¦å‘ï¼‰å’Œ `onComplete`ï¼ˆæ–‡æœ¬æ¸²æŸ“å®Œæˆæ—¶è§¦å‘ï¼‰ã€‚è¿™äº›å›è°ƒå‡½æ•°å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶æ–‡æœ¬æ¸²æŸ“è¿‡ç¨‹ï¼Œå¹¶åœ¨åˆé€‚çš„æ—¶å€™æ‰§è¡Œå…¶ä»–é€»è¾‘ã€‚

### 5.Â æš‚åœã€æ¢å¤ã€è·³è¿‡å’Œæ¸…ç©º

Typewriter-SSE æä¾›äº†æš‚åœã€æ¢å¤ã€è·³è¿‡å’Œæ¸…ç©ºæ–‡æœ¬çš„æ§åˆ¶æ–¹æ³•ã€‚ä½ å¯ä»¥é€šè¿‡è¿™äº›æ–¹æ³•æ¥å®ç°æ›´å¤æ‚çš„äº¤äº’é€»è¾‘ï¼Œä¾‹å¦‚è®©ç”¨æˆ·æš‚åœæ–‡æœ¬æ¸²æŸ“ã€è·³è¿‡æœªæ¸²æŸ“çš„æ–‡æœ¬æˆ–æ¸…ç©ºå·²æ¸²æŸ“çš„æ–‡æœ¬ã€‚

å››ã€ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹
---------

ä¸ºäº†è®©å¤§å®¶æ›´å¥½åœ°ç†è§£ Typewriter-SSE çš„ä½¿ç”¨æ–¹æ³•ï¼Œæˆ‘å°†å±•ç¤ºä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ã€‚è¿™ä¸ªç¤ºä¾‹åŒ…æ‹¬ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯ä»£ç å’Œä¸€ä¸ªå®¢æˆ·ç«¯é¡µé¢ï¼Œç”¨äºæ¼”ç¤º Typewriter-SSE çš„æ•ˆæœã€‚

### 1.Â æœåŠ¡å™¨ç«¯ä»£ç 

è¿™æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„ç®€å•æœåŠ¡å™¨ä»£ç ï¼Œå®ƒé€šè¿‡ SSE æŠ€æœ¯å‘å®¢æˆ·ç«¯å‘é€åˆ†æ®µçš„æ–‡æœ¬æ•°æ®ã€‚

const express = require('express');
const path = require('path');
const app = express();
const PORT = 3000;

app.use(express.static(path.join(\_\_dirname, 'public')));

app.get('/sse', (req, res) => {
    res.setHeader('Content-Type', 'text/event-stream');
    res.setHeader('Cache-Control', 'no-cache');
    res.setHeader('Connection', 'keep-alive');

    const query = req.query.q || "ä½ æ²¡æœ‰è¾“å…¥ä»»ä½•å†…å®¹å“¦ï½";

    const paragraphs = \[
        \`ä½ è¾“å…¥çš„æ˜¯ã€Œ${query}ã€\`,
        \`è¿™æ˜¯æ®µæ¨¡æ‹Ÿçš„ç¬¬ä¸€ä¸ªå›å¤ ğŸŒŸ\`,
        \`æ¥ä¸‹æ¥æ˜¯ç¬¬äºŒæ®µå›å¤ ğŸš€\`,
        \`æœ€åä¸€æ®µå•¦ï¼Œæ¼”ç¤ºå®Œæ¯• ğŸ\`
    \];

    let pIndex = 0;
    let charIndex = 0;

    const interval = setInterval(() => {
        if (pIndex < paragraphs.length) {
            if (charIndex < paragraphs\[pIndex\].length) {
                res.write(\`data: ${paragraphs\[pIndex\]\[charIndex++\]}\\n\\n\`);
            } else {
                res.write(\`data: \\n\\n\`); // ç©ºè¡Œåˆ†æ®µ
                pIndex++;
                charIndex = 0;
            }
        } else {
            clearInterval(interval);
            res.write('event: done\\n');
            res.write('data: end\\n\\n');
            res.end();
        }
    }, 50);
});

app.listen(PORT, () => {
    console.log(\`Server running at http://localhost:${PORT}\`);
});

### 2.Â å®¢æˆ·ç«¯é¡µé¢

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ HTML é¡µé¢ï¼Œå®ƒä½¿ç”¨ Typewriter-SSE æ¥æ¸²æŸ“æ¥è‡ªæœåŠ¡å™¨çš„æ–‡æœ¬æ•°æ®ã€‚

<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>æ‰“å­—æœº + SSE + æ§åˆ¶é¢æ¿</title>
    <style>
        body {
            background: #111;
            color: #0f0;
            font-family: monospace;
            padding: 20px;
        }
        #output {
            white-space: pre-wrap;
            font-size: 1.2em;
            min-height: 100px;
            margin-top: 1em;
        }
        input\[type="text"\], button {
            padding: 8px;
            font-size: 1em;
            margin: 5px 5px 5px 0;
            background: #222;
            color: #0f0;
            border: 1px solid #0f0;
        }
        .controls {
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h2>æ‰“å­—æœºæ•ˆæœæ¼”ç¤º</h2>
    <input type="text" id="prompt" placeholder="è¯·è¾“å…¥..." />
    <div class="controls">
        <button id="send">å‘é€</button>
        <button id="pause">æš‚åœ</button>
        <button id="resume">ç»§ç»­</button>
        <button id="skip">è·³è¿‡</button>
        <button id="delete">æ¸…ç©ºè¾“å‡º</button>
    </div>
    <div id="output"></div>

    <script type="module">
        import TypewriterSSE from './typewriter-sse.js';

        let writer = null;

        document.getElementById('send').addEventListener('click', () => {
            const query = document.getElementById('prompt').value.trim();
            if (!query) return alert('è¯·è¾“å…¥å†…å®¹');
            if (writer) writer.stop();

            const output = document.getElementById('output');
            output.textContent = "";

            writer = new TypewriterSSE({
                container: output,
                endpoint: '/sse?q=' + encodeURIComponent(query),
                cursor: { blink: true, color: '#0f0', char: '|' },
                onComplete: () => console.log('è¾“å…¥å®Œæˆ')
            });
            writer.start();
        });

        document.getElementById('pause').addEventListener('click', () => {
            if (writer) writer.pause();
        });

        document.getElementById('resume').addEventListener('click', () => {
            if (writer) writer.resume();
        });

        document.getElementById('skip').addEventListener('click', () => {
            if (writer) writer.skip();
        });

        document.getElementById('delete').addEventListener('click', () => {
            if (writer) writer.deleteAll();
        });
    </script>

</body>
</html>

æ€»ç»“
--

Typewriter-SSE æ˜¯ä¸€ä¸ªåŸºäº SSE æŠ€æœ¯å®ç°çš„æµå¼æ–‡æœ¬æ¸²æŸ“åº“ï¼Œèƒ½å¤Ÿä¸º Web åº”ç”¨å¸¦æ¥åŠ¨æ€çš„æ‰“å­—æœºæ•ˆæœã€‚å®ƒä¸ä»…æ”¯æŒæµå¼æ–‡æœ¬ä¼ è¾“ï¼Œè¿˜æä¾›äº†ä¸°å¯Œçš„äº¤äº’æ§åˆ¶åŠŸèƒ½ã€‚å¦‚æœä½ å¯¹ Typewriter-SSE æ„Ÿå…´è¶£ï¼Œæˆ–è€…å¸Œæœ›äº†è§£æ›´å¤šå®ç°ç»†èŠ‚ï¼Œæ¬¢è¿è®¿é—® [GitHub ä»“åº“](https://github.com/TJ666/typewriter-sse)ã€‚

å°‘å£®ä¸åŠªåŠ›ï¼Œé•¿å¤§åƒæ¯›åˆ©~