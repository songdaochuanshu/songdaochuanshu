---
layout: post
title: 'ä»WebApiè¿ç§»åˆ°Minimal APIï¼Ÿæœ‰äº†è¿™ä¸ªç¥å™¨ï¼Œå°ç™½ä¹Ÿèƒ½10åˆ†é’Ÿæå®šï¼'
date: "2025-07-24T00:45:23Z"
---
ä»WebApiè¿ç§»åˆ°Minimal APIï¼Ÿæœ‰äº†è¿™ä¸ªç¥å™¨ï¼Œå°ç™½ä¹Ÿèƒ½10åˆ†é’Ÿæå®šï¼
========================================

> è¿˜åœ¨çº ç»“è¦ä¸è¦ä»ä¼ ç»ŸWebApiè¿ç§»åˆ°Minimal APIï¼Ÿæ‹…å¿ƒæ”¹ä»£ç æ”¹åˆ°ç§ƒå¤´ï¼Ÿåˆ«æ€•ï¼ä»Šå¤©ç»™ä½ å®‰åˆ©ä¸€ä¸ªé»‘ç§‘æŠ€â€”â€”**MiniController**ï¼Œè®©ä½ æ—¢èƒ½äº«å—Minimal APIçš„è½»é‡å¿«é€Ÿï¼Œåˆä¸ç”¨æ”¾å¼ƒWebApiçš„ä¼˜é›…å†™æ³•ï¼Œè¿ç§»è¿‡ç¨‹æ¯”æ³¡æ¯å’–å•¡è¿˜ç®€å•ï¼

å…ˆä¸Šé“¾æ¥ [https://github.com/fanslead/MiniController](https://github.com/fanslead/MiniController)

ğŸ§ ä¸ºå•¥è¦æŠ˜è…¾è¿ç§»ï¼Ÿ
-----------

å…ˆç»™å°ç™½ä»¬ç§‘æ™®ä¸‹ï¼šä¼ ç»ŸWebApiå’ŒMinimal APIå°±åƒè€å¼ç”µè„‘å’Œè½»è–„æœ¬â€”â€”å‰è€…åŠŸèƒ½å…¨ä½†ç¬¨é‡ï¼Œåè€…å°å·§å¿«ä½†æ“ä½œæ–¹å¼ä¸ä¸€æ ·ã€‚

åœºæ™¯

ä¼ ç»ŸWebApi

Minimal API

ä»£ç é‡

ä¸€å †æ¨¡æ¿ä»£ç 

ä¸€è¡Œé¡¶è¿‡å»åè¡Œ

å¯åŠ¨é€Ÿåº¦

è¾ƒæ…¢

é£å¿«ï¼ˆå°¤å…¶é€‚åˆå¾®æœåŠ¡ï¼‰

é¡¹ç›®ç»“æ„

å±‚å±‚æ–‡ä»¶å¤¹ï¼ˆControllersã€Models...ï¼‰

ä¸€ä¸ªProgram.csæå®šå¤§åŠ

ä½†ç›´æ¥è½¬Minimal APIåˆæ€•ä¸ä¹ æƒ¯ï¼Ÿ**MiniControllerå°±æ˜¯ä½ çš„è¿‡æ¸¡ç¥å™¨**ï¼

ğŸš€ è¿ç§»å‰çš„å‡†å¤‡ï¼š3æ­¥æå®šç¯å¢ƒ
----------------

1.  **å®‰è£…NuGetåŒ…**ï¼ˆå¤åˆ¶ç²˜è´´å°±è¡Œï¼‰ï¼š
    
        Install-Package MiniController
        Install-Package MiniController.Attributes
        
    
    ï¼ˆå¦‚æœç”¨.NET CLIå°±æ¢è¿™ä¸ªï¼‰ï¼š
    
        dotnet add package MiniController
        dotnet add package MiniController.Attributes
        
    
2.  **ç¡®è®¤é¡¹ç›®ç‰ˆæœ¬**ï¼šéœ€è¦ASP.NET Core 6.0ä»¥ä¸Šï¼ˆç°åœ¨æ–°å»ºçš„é¡¹ç›®åŸºæœ¬éƒ½æ˜¯å•¦ï¼‰ã€‚
    
3.  **å‡†å¤‡å¥½ä½ çš„WebApiæ§åˆ¶å™¨**ï¼šæ¯”å¦‚è¿™ç§ç†Ÿæ‚‰çš„ä»£ç ï¼š
    
        // ä¼ ç»ŸWebApiæ§åˆ¶å™¨
        [ApiController]
        [Route("api/[controller]")]
        public class UserController : ControllerBase
        {
            private readonly IUserService _userService;
        
            public UserController(IUserService userService)
            {
                _userService = userService;
            }
        
            [HttpGet("{id}")]
            public async Task<IActionResult> GetUser(int id)
            {
                var user = await _userService.GetById(id);
                return Ok(user);
            }
        }
        
    

âœ‚ï¸ å¼€å§‹è¿ç§»ï¼šæ”¹3å¤„ä»£ç å°±è¡Œï¼
----------------

### ç¬¬1æ­¥ï¼šæ¢ä¸ªç‰¹æ€§æ ‡ç­¾

æŠŠ`[ApiController]`å’Œ`[Route]`åˆ æ‰ï¼Œæ¢æˆ`[MiniController]`ï¼š

    // åŸæ¥çš„
    [ApiController]
    [Route("api/[controller]")]
    
    // æ¢æˆè¿™ä¸ª
    [MiniController("/api/[controller]")]  // è·¯ç”±è§„åˆ™ç›´æ¥ä¼ å‚æ•°
    

### ç¬¬2æ­¥ï¼šåˆ æ‰ControllerBaseç»§æ‰¿

Minimal APIä¸éœ€è¦ç»§æ‰¿å•¦ï¼Œç›´æ¥ç®€åŒ–ï¼š

    // åŸæ¥çš„
    public class UserController : ControllerBase
    
    // æ¢æˆè¿™ä¸ª
    public class UserController  // å»æ‰ç»§æ‰¿
    

### ç¬¬3æ­¥ï¼šè¿”å›å€¼æ”¹ä¸€ä¸‹ï¼ˆå¯é€‰ä½†æ¨èï¼‰

æŠŠ`IActionResult`æ¢æˆ`IResult`ï¼Œå†™æ³•æ›´ç®€æ´ï¼š

    // åŸæ¥çš„
    public async Task<IActionResult> GetUser(int id)
    {
        var user = await _userService.GetById(id);
        return Ok(user);
    }
    
    // æ¢æˆè¿™ä¸ªï¼ˆæ›´æ¸…çˆ½ï¼‰
    public async Task<IResult> GetUser(int id)
    {
        var user = await _userService.GetById(id);
        return Results.Ok(user);  // ç”¨Resultsé™æ€ç±»
    }
    

ğŸ¯ æ³¨å†ŒæœåŠ¡ï¼šåŠ 2è¡Œä»£ç æå®šå…¨å±€é…ç½®
-------------------

æ‰“å¼€Program.csï¼Œæ‰¾åˆ°`var app = builder.Build();`å‰åï¼ŒåŠ è¿™ä¸¤å¥ï¼š

    var builder = WebApplication.CreateBuilder(args);
    
    // 1. æ³¨å†ŒMiniControlleræœåŠ¡ï¼ˆä¾èµ–æ³¨å…¥ç”¨ï¼‰
    builder.Services.AddMiniControllers();
    
    var app = builder.Build();
    
    // 2. æ³¨å†Œæ‰€æœ‰ç«¯ç‚¹ï¼ˆæ›¿ä»£åŸæ¥çš„MapControllers()ï¼‰
    app.MapMiniController();
    
    app.Run();
    

æå®šï¼å°±è¿™ä¹ˆç®€å•ï¼Ÿå¯¹ï¼å› ä¸ºMiniControllerä¼šè‡ªåŠ¨å¸®ä½ ç”ŸæˆMinimal APIçš„è·¯ç”±ä»£ç ï¼Œä½ å®Œå…¨ä¸ç”¨æ‰‹åŠ¨å†™é‚£äº›`app.MapGet`ã€`app.MapPost`äº†ï¼

ğŸ§© é«˜çº§æŠ€å·§ï¼šä¿ç•™WebApiçš„å¥½ä¹ æƒ¯
--------------------

æ‹…å¿ƒè¿ç§»åä¸¢åŠŸèƒ½ï¼Ÿä¸å­˜åœ¨çš„ï¼è¿™äº›WebApiå¸¸ç”¨åŠŸèƒ½éƒ½æ”¯æŒï¼š

1.  **ä¾èµ–æ³¨å…¥**ï¼šæ„é€ å‡½æ•°æ³¨å…¥ç…§æ ·ç”¨
    
        public class UserController
        {
            private readonly IUserService _userService;
            
            // ç†Ÿæ‚‰çš„æ„é€ å‡½æ•°æ³¨å…¥
            public UserController(IUserService userService)
            {
                _userService = userService;
            }
        }
        
    
2.  **å‚æ•°ç»‘å®š**ï¼š`[FromRoute]`ã€`[FromBody]`è¿™äº›æ ‡ç­¾ç»§ç»­ç”¨
    
        [HttpPost]
        public IResult CreateUser([FromBody] CreateUserRequest request)
        {
            // å’Œä»¥å‰ä¸€æ ·ç”¨
        }
        
    
3.  **æˆæƒå’Œæ–‡æ¡£**ï¼š`[Authorize]`ã€`[ProducesResponseType]`éƒ½æ”¯æŒ
    
        [HttpGet("{id}")]
        [Authorize(Roles = "Admin")]
        [ProducesResponseType(typeof(User), 200)]
        [ProducesResponseType(404)]
        public IResult GetUser(int id)
        {
            // æƒé™å’Œæ–‡æ¡£ä¸€æ­¥åˆ°ä½
        }
        
    

â“ å¸¸è§é—®é¢˜ï¼šå°ç™½å¿…çœ‹
-----------

1.  **è¿ç§»åè·¯ç”±å˜äº†ï¼Ÿ**  
    ä¸ä¼šï¼`[MiniController("/api/[controller]")]`å’ŒåŸæ¥WebApiçš„`[Route("api/[controller]")]`æ•ˆæœä¸€æ ·ã€‚
    
2.  **é™æ€ç±»ä¹Ÿèƒ½æ”¯æŒï¼Ÿ**  
    å¯ä»¥ï¼ç®€å•æ¥å£ç›´æ¥ç”¨é™æ€ç±»ï¼Œè¿ä¾èµ–æ³¨å…¥éƒ½çœäº†ï¼ˆä¹Ÿæ”¯æŒæ–¹æ³•çº§åˆ«çš„ä¾èµ–æ³¨å…¥ï¼‰ï¼š
    
        [MiniController("/api/demo")]
        public static class DemoController
        {
            [HttpGet("hello")]
            public static IResult Hello() => Results.Ok("Hello World");
        }
        
    
3.  **Swaggerè¿˜èƒ½ç”¨å—ï¼Ÿ**  
    å®Œå…¨æ”¯æŒï¼å’Œä»¥å‰ä¸€æ ·åŠ `AddEndpointsApiExplorer()`å’Œ`AddSwaggerGen()`å°±è¡Œã€‚
    

ğŸ‰ æ€»ç»“ï¼šè¿™æ³¢è¿ç§»è¡€èµšä¸äº
--------------

ç”¨MiniControllerè¿ç§»åˆ°Minimal APIï¼Œä½ ä¼šå¾—åˆ°ï¼š

*   ä»£ç é‡å‡å°‘50%ä»¥ä¸Š
*   å¯åŠ¨é€Ÿåº¦æå‡ï¼ˆå°¤å…¶å¾®æœåŠ¡åœºæ™¯ï¼‰
*   ä¿ç•™WebApiçš„å¼€å‘ä¹ æƒ¯ï¼ˆä¸ç”¨é‡æ–°å­¦ï¼‰
*   è‡ªåŠ¨ç”Ÿæˆè§„èŒƒçš„è·¯ç”±ä»£ç ï¼ˆå°‘å†™bugï¼‰

è¿˜ç­‰å•¥ï¼Ÿèµ¶ç´§æ‹¿ä½ çš„é¡¹ç›®è¯•è¯•ï¼Œ10åˆ†é’Ÿå°±èƒ½ä½“éªŒé£ä¸€èˆ¬çš„æ„Ÿè§‰ï¼æœ‰é—®é¢˜å°±åœ¨è¯„è®ºåŒºé—®ï¼Œå°ç™½ä¹Ÿèƒ½è½»æ¾ä¸Šæ‰‹ï½