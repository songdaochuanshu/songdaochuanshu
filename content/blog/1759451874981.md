---
layout: post
title: 'ã€å…‰ç…§ã€‘[PBR][å‡ ä½•é®è”½]å®ç°æ–¹æ³•å¯¹æ¯”'
date: "2025-10-03T00:37:54Z"
---
ã€å…‰ç…§ã€‘\[PBR\]\[å‡ ä½•é®è”½\]å®ç°æ–¹æ³•å¯¹æ¯”
=========================

![ã€å…‰ç…§ã€‘[PBR][å‡ ä½•é®è”½]å®ç°æ–¹æ³•å¯¹æ¯”](https://img2024.cnblogs.com/blog/3685400/202510/3685400-20251001092918014-1714819226.png) æ‘˜è¦ï¼šæ–‡ç« ä»‹ç»äº†Unity URPæ¸²æŸ“ç®¡çº¿ä¸­çš„å‡ ä½•é®è”½(G)è®¡ç®—æµç¨‹ï¼Œé‡ç‚¹åˆ†æäº†å‡ ç§ä¸»æµå‡ ä½•é®è”½æ¨¡å‹çš„ç‰¹ç‚¹å’Œå®ç°æ–¹æ¡ˆã€‚URPé‡‡ç”¨Smith-Joint-Schlick-GGXæ¨¡å‹ï¼Œåœ¨ç‰©ç†å‡†ç¡®æ€§ã€è§†è§‰è´¨é‡å’Œæ€§èƒ½ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œæ—¢ä¿è¯äº†ä¸GGXæ³•çº¿åˆ†å¸ƒçš„ä¸€è‡´æ€§ï¼Œåˆé€šè¿‡ä¼˜åŒ–æŠ€æœ¯ï¼ˆå¦‚é¢„è®¡ç®—ã€æ•°å€¼ç¨³å®šæ€§å¤„ç†ï¼‰æå‡æ‰§è¡Œæ•ˆç‡ã€‚æ–‡ç« è¿˜å¯¹æ¯”äº†Cook-Torranceã€Smithå®Œæ•´ç‰ˆç­‰æ¨¡å‹çš„ä¼˜ç¼ºç‚¹ï¼Œè¯´æ˜URPé€‰æ‹©è¯¥æ–¹æ¡ˆçš„åŸå› ï¼ŒåŒ…æ‹¬æ»¡è¶³èƒ½é‡å®ˆæ’ã€ç§»åŠ¨ç«¯å‹å¥½ç­‰ç‰¹æ€§ï¼Œä¸ºæ¸¸æˆæ¸²æŸ“æä¾›äº†ä¼˜è´¨è§£å†³æ–¹æ¡ˆã€‚

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

**å‡ ä½•é®è”½çš„åŸºæœ¬æµç¨‹**
=============

å‡ ä½•é®è”½(G)åœ¨BRDFä¸­ç”¨äºæ¨¡æ‹Ÿå¾®è¡¨é¢é—´çš„è‡ªé˜´å½±å’Œé®è”½æ•ˆåº”ï¼Œå…¶è®¡ç®—æµç¨‹é€šå¸¸åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š

*   â€Œ**é®è”½é¡¹è®¡ç®—**â€Œï¼šå…‰çº¿å…¥å°„æ–¹å‘çš„é®æŒ¡æ¦‚ç‡
*   â€Œ**é˜´å½±é¡¹è®¡ç®—**â€Œï¼šè§†çº¿æ–¹å‘çš„é®æŒ¡æ¦‚ç‡
*   â€Œ**è”åˆè®¡ç®—**â€Œï¼šå°†ä¸¤è€…ç»“åˆå½¢æˆå®Œæ•´çš„å‡ ä½•å‡½æ•°

**ä¸»è¦å‡ ä½•é®è”½æ¨¡å‹**
============

**1\. Cook-Torranceæ¨¡å‹**
-----------------------

â€Œ**åŸç†**â€Œï¼š

*   åŸºäºVå½¢å¾®æ§½å‡è®¾
*   ä½¿ç”¨ç®€å•çš„minå‡½æ•°è®¡ç®—é®è”½å’Œé˜´å½±

â€Œ**å…¬å¼**â€Œï¼š

$G\_{Cook-Torrance}=minâ¡(1,\\frac{2(nâ‹…h)(nâ‹…v)}{vâ‹…h},\\frac{2(nâ‹…h)(nâ‹…l)}{vâ‹…h})$

â€Œ**ç‰¹ç‚¹**â€Œï¼š

*   è®¡ç®—ç®€å•ä½†ä¸å¤Ÿç²¾ç¡®
*   åœ¨æ å°„è§’è¡¨ç°ä¸ä½³

**2\. Smithæ¨¡å‹**
---------------

â€Œ**åŸç†**â€Œï¼š

*   å°†å‡ ä½•é¡¹åˆ†è§£ä¸ºç‹¬ç«‹çš„é®è”½å’Œé˜´å½±é¡¹
*   å‡è®¾å¾®è¡¨é¢é«˜åº¦æœä»ç»Ÿè®¡åˆ†å¸ƒ

â€Œ**å…¬å¼**â€Œï¼š

$G\_{Smith}=G\_1(v)â‹…G\_1(l)$

â€Œ**Unity URPé€‰æ‹©**â€Œï¼š

    hlsl
    // URPä¸­Smithè”åˆSchlick-GGXå®ç°
    float V_SmithGGX(float NdotL, float NdotV, float roughness)
    {
        float a = roughness;
        float a2 = a * a;
    
        float GGXV = NdotL * sqrt(NdotV * NdotV * (1.0 - a2) + a2);
        float GGXL = NdotV * sqrt(NdotL * NdotL * (1.0 - a2) + a2);
    
        return 0.5 / max((GGXV + GGXL), 0.000001);
    }
    

â€Œ**é€‰æ‹©åŸå› **â€Œï¼š

*   ä¸GGXæ³•çº¿åˆ†å¸ƒå®Œç¾åŒ¹é…
*   èƒ½é‡å®ˆæ’æ€§æ›´å¥½
*   è®¡ç®—æ•ˆç‡è¾ƒé«˜

**3\. Schlickè¿‘ä¼¼æ¨¡å‹**
-------------------

â€Œ**åŸç†**â€Œï¼š

*   å¯¹Smithæ¨¡å‹çš„å¿«é€Ÿè¿‘ä¼¼
*   ä½¿ç”¨æœ‰ç†å‡½æ•°æ›¿ä»£å¤æ‚è®¡ç®—

â€Œ**å…¬å¼**â€Œï¼š

$G\_{Schlick}(n,v)=\\frac{nâ‹…v}{(nâ‹…v)(1âˆ’k)+k},k=\\frac{(Î±+1)^2}8$

â€Œ**ç‰¹ç‚¹**â€Œï¼š

*   é€‚åˆç§»åŠ¨ç«¯ç­‰æ€§èƒ½å—é™å¹³å°
*   ç²¾åº¦ç•¥ä½äºå®Œæ•´Smithæ¨¡å‹

**4\. Kelemen-Szirmay-Kalosæ¨¡å‹**
-------------------------------

â€Œ**åŸç†**â€Œï¼š

*   åŸºäºå¾®è¡¨é¢æ–œç‡åˆ†å¸ƒ
*   ç‰¹åˆ«é€‚åˆå„å‘å¼‚æ€§æè´¨

â€Œ**å…¬å¼**â€Œï¼š

$G\_{KSK}=\\frac1{1+Î›(v)+Î›(l)}$

â€Œ**åº”ç”¨åœºæ™¯**â€Œï¼š

*   å¤´å‘ã€ç»‡ç‰©ç­‰ç‰¹æ®Šæè´¨æ¸²æŸ“

**Unity URPçš„å®ç°æ–¹æ¡ˆ**
==================

**é€‰æ‹©æ–¹æ¡ˆï¼šSmith-Joint-Schlick-GGX**
--------------------------------

â€Œ**å®ç°ä»£ç **â€Œï¼š

    hlsl
    // Packages/com.unity.render-pipelines.universal/ShaderLibrary/BRDF.hlsl
    float V_SmithJointGGX(float NdotL, float NdotV, float roughness)
    {
        float a2 = roughness * roughness;
        float lambdaV = NdotL * (NdotV * (1.0 - a2) + a2);
        float lambdaL = NdotV * (NdotL * (1.0 - a2) + a2);
    
        return 0.5 / (lambdaV + lambdaL + 1e-5f);
    }
    

â€Œ**é€‰æ‹©åŸå› **â€Œï¼š
-----------

*   â€Œ**ç‰©ç†å‡†ç¡®æ€§**â€Œï¼š
    *   ä¸GGX NDFä¿æŒæ•°å­¦ä¸€è‡´æ€§
    *   æ»¡è¶³èƒ½é‡å®ˆæ’å’Œäº’æ˜“æ€§
*   â€Œ**è§†è§‰è´¨é‡**â€Œï¼š
    *   åœ¨æ å°„è§’äº§ç”Ÿè‡ªç„¶çš„é˜´å½±è¡°å‡
    *   ç²—ç³™æè´¨è¡¨ç°æ›´çœŸå®
*   â€Œ**æ€§èƒ½å¹³è¡¡**â€Œï¼š
    *   ç›¸æ¯”å®Œæ•´Smithæ¨¡å‹å‡å°‘30%è®¡ç®—é‡
    *   ç§»åŠ¨ç«¯å‹å¥½(æ— å¤æ‚æ•°å­¦å‡½æ•°)
*   â€Œ**æè´¨ä¸€è‡´æ€§**â€Œï¼š
    *   ä¸é‡‘å±/ç²—ç³™åº¦å·¥ä½œæµå®Œç¾é…åˆ
    *   å‚æ•°å“åº”çº¿æ€§åº¦å¥½

**ä¼˜åŒ–æŠ€æœ¯**
--------

*   â€Œ**é¢„è®¡ç®—éƒ¨åˆ†é¡¹**â€Œï¼š
    
        hlsl
        // é¢„è®¡ç®—ç²—ç³™åº¦å¹³æ–¹
        float a2 = roughness * roughness;
        
    
*   â€Œ**æ•°å€¼ç¨³å®šæ€§å¤„ç†**â€Œï¼š
    
        hlsl
        // é¿å…é™¤é›¶é”™è¯¯
        return 0.5 / (lambdaV + lambdaL + 1e-5f);
        
    
*   â€Œ**ç§»åŠ¨ç«¯ç®€åŒ–ç‰ˆ**â€Œï¼š
    
        hlsl
        #if defined(SHADER_API_MOBILE)
            float V_SmithMobile(float NdotL, float NdotV, float roughness)
            {
                float a = roughness;
                float GGXV = NdotL * (NdotV * (1.0 - a) + a);
                float GGXL = NdotV * (NdotL * (1.0 - a) + a);
                return 0.5 / (GGXV + GGXL);
            }
        #endif
        
    

**å„æ¨¡å‹æ€§èƒ½å¯¹æ¯”**
===========

æ¨¡å‹

æŒ‡ä»¤æ•°

ç‰¹æ®Šå‡½æ•°

ç§»åŠ¨ç«¯é€‚ç”¨æ€§

è§†è§‰è´¨é‡

Cook-Torrance

8

æ— 

â˜…â˜…â˜…â˜…â˜†

â˜…â˜…â˜†â˜†â˜†

Smithå®Œæ•´ç‰ˆ

15+

sqrt

â˜…â˜…â˜†â˜†â˜†

â˜…â˜…â˜…â˜…â˜†

Smith-Schlick

10

æ— 

â˜…â˜…â˜…â˜…â˜†

â˜…â˜…â˜…â˜†â˜†

URPå®ç°

12

sqrt

â˜…â˜…â˜…â˜†â˜†

â˜…â˜…â˜…â˜…â˜†

Kelemen

18+

å¤æ‚è¿ç®—

â˜…â˜†â˜†â˜†â˜†

â˜…â˜…â˜…â˜…â˜…

Unity URPçš„é€‰æ‹©åœ¨è§†è§‰è´¨é‡å’Œè®¡ç®—å¼€é”€ä¹‹é—´å–å¾—äº†æœ€ä½³å¹³è¡¡ï¼Œç‰¹åˆ«æ˜¯è€ƒè™‘åˆ°ç°ä»£GPUçš„æ¶æ„ç‰¹æ€§(SIMDæ‰§è¡Œ)ï¼Œå³ä½¿åŒ…å«sqrtè¿ç®—ä¹Ÿä¸ä¼šé€ æˆæ˜¾è‘—æ€§èƒ½ç“¶é¢ˆã€‚

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰