---
layout: post
title: 'æŒæ¡Fetchä¸Flaskäº¤äº’ï¼šè®©å‰ç«¯è¡¨å•æäº¤æ›´ä¼˜é›…çš„åŠ¨æ€ä¹‹é“'
date: "2025-12-30T00:44:44Z"
---
æŒæ¡Fetchä¸Flaskäº¤äº’ï¼šè®©å‰ç«¯è¡¨å•æäº¤æ›´ä¼˜é›…çš„åŠ¨æ€ä¹‹é“
===============================

æœ¬æ–‡è¯¦ç»†è§£æäº†å‰ç«¯Fetch APIçš„å·¥ä½œåŸç†ä¸å¸¸è§ç”¨æ³•ï¼Œå¹¶é‡ç‚¹é˜è¿°äº†å…¶å¦‚ä½•ä¸Python Flaskåç«¯æ¡†æ¶ååŒå·¥ä½œã€‚é€šè¿‡ç™»å½•é‡å®šå‘ã€æ•°æ®åŠ¨æ€å¢åˆ æ”¹æŸ¥ç­‰å…·ä½“åœºæ™¯ï¼Œæ¼”ç¤ºäº†å¦‚ä½•å®ç°æ— åˆ·æ–°äº¤äº’ä½“éªŒã€‚æ–‡ç« æä¾›äº†å‰åç«¯é…å¥—çš„ä»£ç ç¤ºä¾‹ï¼Œè®²è§£äº†å¦‚ä½•å¤„ç†JSONã€æ–‡æœ¬ç­‰ä¸åŒæ ¼å¼çš„å“åº”ï¼Œä»¥åŠå¦‚ä½•æ ¹æ®å“åº”çŠ¶æ€æ›´æ–°ç”¨æˆ·ç•Œé¢ï¼Œä¸ºæ„å»ºç°ä»£Webåº”ç”¨æä¾›äº†å®ç”¨æŒ‡å—ã€‚

è¿˜åœ¨ä¸ºè¡¨å•æäº¤åé¡µé¢åˆ·æ–°çƒ¦æ¼ï¼Ÿä¸€æ–‡æå®šFetchä¸Flaskçš„æ— ç¼äº¤äº’
===================================

æœ¬æ–‡å¸¦ä½ æ·±å…¥ç†è§£ç°ä»£å‰ç«¯ Fetch API çš„å·¥ä½œåŸç†ï¼Œå¹¶æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•ä¸ Flask åç«¯ä¼˜é›…ç»“åˆï¼Œå®ç°æ— åˆ·æ–°ç™»å½•ã€æ•°æ®åŠ¨æ€å¢åˆ æ”¹æŸ¥ç­‰äº¤äº’ã€‚  
äº®ç‚¹åŒ…æ‹¬ï¼šFetch æ ¸å¿ƒåŸç†å‰–æã€ç™»å½•é‡å®šå‘çš„å¼‚æ­¥å¤„ç†ã€åˆ©ç”¨å“åº”çŠ¶æ€ç åŠ¨æ€æ›´æ–°UIã€ä»¥åŠå¦‚ä½•å¤„ç†JSON/æ–‡æœ¬ç­‰ä¸åŒæ ¼å¼çš„è¿”å›æ•°æ®ã€‚  
  
ä½ å°†å­¦åˆ°ï¼š  
\- Fetch API çš„â€œæ‰¿è¯ºâ€æœºåˆ¶ä¸åŸºç¡€ç”¨æ³•  
\- å¦‚ä½•ç”¨ Flask æ„å»º RESTful é£æ ¼çš„ API ç«¯ç‚¹  
\- ç™»å½•è¡¨å•æäº¤ï¼šå‘Šåˆ«ä¼ ç»Ÿè¡¨å•åˆ·æ–°ï¼Œå®ç°å¹³æ»‘è·³è½¬  
\- æ•°æ®æ“ä½œï¼šå‰ç«¯ä¸€ä¸ªè¯·æ±‚ï¼Œåç«¯å¤„ç†ï¼Œå‰ç«¯UIå³æ—¶å“åº”  
\- æ ¹æ®åç«¯è¿”å›çš„ä¸åŒæ•°æ®ç±»å‹ï¼ˆJSON/Textï¼‰è¿›è¡Œç²¾å‡†å¤„ç†

âœ¨ ç›®å½•
----

1\. åˆè¯†Fetchï¼šç°ä»£Webçš„é€šä¿¡ä¿¡ä½¿  
2\. ğŸ› ï¸ å®æˆ˜å‡†å¤‡ï¼šFlaskåç«¯çš„ç®€å•é…ç½®  
3\. ğŸ” åœºæ™¯ä¸€ï¼šç™»å½•è¡¨å•æäº¤ä¸é¡µé¢é‡å®šå‘  
4\. âœ¨ åœºæ™¯äºŒï¼šåŠ¨æ€æ–°å¢ä¸ä¿®æ”¹æ•°æ®  
5\. ğŸ“¦ åœºæ™¯ä¸‰ï¼šå¤„ç†ä¸åŒç±»å‹çš„å“åº”æ•°æ®  
6\. ğŸ’» å®Œæ•´ä»£ç å‚è€ƒä¸æ€»ç»“

1\. åˆè¯†Fetchï¼šç°ä»£Webçš„é€šä¿¡ä¿¡ä½¿
----------------------

`fetch()` æ˜¯æµè§ˆå™¨æä¾›çš„ã€åŸºäº **Promise** çš„ç°ä»£ç½‘ç»œè¯·æ±‚APIã€‚å®ƒå–ä»£äº†å¤è€çš„ XMLHttpRequestï¼Œè®©å¼‚æ­¥æ•°æ®è¯·æ±‚å˜å¾—æ¸…æ™°ã€ç®€æ´ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªä¸“ä¸šçš„â€œä¿¡ä½¿â€ã€‚

å®ƒçš„åŸºæœ¬å·¥ä½œæµç¨‹æ˜¯ï¼šä½ ç»™ä¿¡ä½¿ï¼ˆfetchï¼‰ä¸€ä¸ªåœ°å€ï¼ˆURLï¼‰å’ŒæŒ‡ç¤ºï¼ˆé…ç½®å¯¹è±¡ï¼‰ï¼Œå®ƒç«‹åˆ»è¿”å›ä¸€ä¸ªâ€œæ‰¿è¯ºæ”¶æ®â€ï¼ˆPromiseï¼‰ã€‚è¿™ä¸ªæ‰¿è¯ºæœ€ç»ˆä¼šå…‘ç°ä¸ºâ€œå“åº”åŒ…è£¹â€ï¼ˆResponseå¯¹è±¡ï¼‰ï¼Œä½ éœ€è¦æ‰“å¼€è¿™ä¸ªåŒ…è£¹ï¼ˆè°ƒç”¨å¦‚.json(), .text()ç­‰æ–¹æ³•ï¼‰æ‰èƒ½æ‹¿åˆ°é‡Œé¢çš„çœŸå®æ•°æ®ã€‚

    // ä¸€ä¸ªæœ€ç®€å•çš„GETè¯·æ±‚ç¤ºä¾‹
    fetch('/api/data')
      .then(response => response.json()) // æ‰“å¼€åŒ…è£¹ï¼Œè§£æJSONæ•°æ®
      .then(data => console.log(data))   // å¤„ç†çœŸå®æ•°æ®
      .catch(error => console.error('å‡ºé”™å•¦ï¼š', error)); // å¤„ç†é”™è¯¯

2\. ğŸ› ï¸ å®æˆ˜å‡†å¤‡ï¼šFlaskåç«¯çš„ç®€å•é…ç½®
-------------------------

ä¸ºäº†è®©å‰ç«¯Fetchèƒ½é¡ºåˆ©ä¸åç«¯â€œå¯¹è¯â€ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤„ç†JSONã€å¹¶èƒ½è¿›è¡Œè·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰çš„Flaskåº”ç”¨ã€‚é¦–å…ˆï¼Œå®‰è£…å¿…è¦åº“ï¼š

    pip install flask flask-cors

æ¥ç€ï¼Œæ­å»ºä¸€ä¸ªåŸºç¡€çš„åç«¯æœåŠ¡ï¼š

    from flask import Flask, request, jsonify
    from flask_cors import CORS
    
    app = Flask(__name__)
    CORS(app)  # å…è®¸å‰ç«¯è·¨åŸŸè¯·æ±‚ï¼Œå¼€å‘æ—¶éå¸¸æ–¹ä¾¿
    
    # æˆ‘ä»¬å°†åœ¨åç»­åœºæ™¯ä¸­é€æ­¥å¡«å……è¿™ä¸ªappçš„è·¯ç”±
    if __name__ == '__main__':
        app.run(debug=True)

3\. ğŸ” åœºæ™¯ä¸€ï¼šç™»å½•è¡¨å•æäº¤ä¸é¡µé¢é‡å®šå‘
-----------------------

ä¼ ç»Ÿè¡¨å•æäº¤ä¼šåˆ·æ–°é¡µé¢ï¼Œä½“éªŒå‰²è£‚ã€‚ä½¿ç”¨Fetchï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ— åˆ·æ–°ç™»å½•ï¼Œå¹¶æ ¹æ®åç«¯æŒ‡ä»¤è¿›è¡Œå‰ç«¯è·¯ç”±è·³è½¬ã€‚

**å‰ç«¯ (JavaScript)**ï¼šæ‹¦æˆªè¡¨å•æäº¤äº‹ä»¶ï¼Œä½¿ç”¨Fetchå‘é€æ•°æ®ã€‚

    document.getElementById('loginForm').addEventListener('submit', function(event) {
        event.preventDefault(); // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤è¡Œä¸º
    
        const formData = new FormData(this);
        // æˆ–è€…å°†æ•°æ®è½¬æ¢ä¸ºJSON: JSON.stringify(Object.fromEntries(formData))
    
        fetch('/api/login', {
            method: 'POST',
            body: formData, // å‘é€FormDataå¯¹è±¡
            // headers: { 'Content-Type': 'application/json' }, // å¦‚æœå‘é€JSONéœ€è®¾ç½®æ­¤header
        })
        .then(response => response.json()) // è§£æåç«¯è¿”å›çš„JSON
        .then(result => {
            if (result.success) {
                // ç™»å½•æˆåŠŸï¼Œä½¿ç”¨å‰ç«¯è·¯ç”±è·³è½¬ï¼Œè€Œéåç«¯é‡å®šå‘
                window.location.href = result.redirect_url || '/dashboard';
            } else {
                // ç™»å½•å¤±è´¥ï¼ŒåŠ¨æ€æ›´æ–°é¡µé¢ä¸Šçš„é”™è¯¯æç¤ºå…ƒç´ 
                document.getElementById('error-msg').textContent = result.message;
            }
        })
        .catch(error => console.error('Error:', error));
    });

**åç«¯ (Flask)**ï¼šéªŒè¯æ•°æ®ï¼Œè¿”å›åŒ…å«çŠ¶æ€å’ŒæŒ‡ä»¤çš„JSONï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›é‡å®šå‘çš„HTMLã€‚

    @app.route('/api/login', methods=['POST'])
    def login():
        username = request.form.get('username')
        password = request.form.get('password')
    
        # è¿™é‡Œåº”æ˜¯ä½ çš„éªŒè¯é€»è¾‘ï¼Œä¾‹å¦‚æŸ¥è¯¢æ•°æ®åº“
        if username == 'admin' and password == 'secret':
            # è¿”å›æˆåŠŸçŠ¶æ€å’Œå‰ç«¯è·³è½¬åœ°å€
            return jsonify({'success': True, 'redirect_url': '/dashboard'})
        else:
            # è¿”å›å¤±è´¥çŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯
            return jsonify({'success': False, 'message': 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯'}), 401

4\. âœ¨ åœºæ™¯äºŒï¼šåŠ¨æ€æ–°å¢ä¸ä¿®æ”¹æ•°æ®
-------------------

åœ¨ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæ–°å¢æˆ–ä¿®æ”¹ä¸€æ¡æ•°æ®åï¼Œæˆ‘ä»¬å¸Œæœ›åˆ—è¡¨èƒ½ç«‹å³æ›´æ–°ï¼Œè€Œæ— éœ€åˆ·æ–°æ•´ä¸ªé¡µé¢ã€‚

**æ ¸å¿ƒæ€è·¯**ï¼šFetchè¯·æ±‚æˆåŠŸåï¼Œåœ¨`.then()`ä¸­æ ¹æ®åç«¯è¿”å›çš„æœ€æ–°æ•°æ®ï¼Œç›´æ¥æ“ä½œDOMæ›´æ–°UIã€‚

    // å‡è®¾æœ‰ä¸€ä¸ªä¿å­˜æŒ‰é’®ï¼Œç”¨äºæäº¤æ–°å¢æˆ–ä¿®æ”¹çš„æ•°æ®
    saveButton.addEventListener('click', () => {
        const itemData = { title: 'æ–°é¡¹ç›®', status: 'active' };
    
        fetch('/api/items', {
            method: 'POST', // æ–°å¢ç”¨POSTï¼Œä¿®æ”¹å¯èƒ½æ˜¯PUTæˆ–PATCH
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(itemData)
        })
        .then(response => response.json())
        .then(newItem => {
            // å…³é”®æ­¥éª¤ï¼šè¯·æ±‚æˆåŠŸåï¼ŒåŠ¨æ€æ›´æ–°å‰ç«¯åˆ—è¡¨
            const itemList = document.getElementById('itemList');
            const newItemElement = document.createElement('li');
            newItemElement.id = `item-${newItem.id}`;
            newItemElement.innerHTML = `${newItem.title} ${newItem.status}`;
            itemList.appendChild(newItemElement);
    
            // æˆ–è€…ï¼Œå¦‚æœæ˜¯ä¿®æ”¹æ“ä½œï¼Œå¯ä»¥æ‰¾åˆ°å¯¹åº”çš„DOMå…ƒç´ æ›´æ–°å…¶å†…å®¹
            // const oldItemElement = document.getElementById(`item-${newItem.id}`);
            // oldItemElement.innerHTML = ...;
    
            alert('æ“ä½œæˆåŠŸï¼'); // æˆ–æ›´ä¼˜é›…çš„æç¤º
        });
    });

å¯¹åº”çš„Flaskåç«¯éœ€è¦è¿”å›åˆ›å»ºæˆ–æ›´æ–°åçš„å®Œæ•´æ•°æ®å¯¹è±¡ï¼Œä»¥ä¾¿å‰ç«¯ä½¿ç”¨ã€‚

5\. ğŸ“¦ åœºæ™¯ä¸‰ï¼šå¤„ç†ä¸åŒç±»å‹çš„å“åº”æ•°æ®
----------------------

åç«¯å¯èƒ½è¿”å›JSONï¼Œä¹Ÿå¯èƒ½è¿”å›çº¯æ–‡æœ¬æˆ–HTMLç‰‡æ®µã€‚Fetchçš„Responseå¯¹è±¡æä¾›äº†ä¸åŒçš„æ–¹æ³•æ¥å¤„ç†ã€‚

**å¤„ç†JSON (æœ€å¸¸ç”¨)**ï¼šå¦‚ä¸Šæ–‡æ‰€ç¤ºï¼Œä½¿ç”¨`response.json()`ã€‚

**å¤„ç†æ–‡æœ¬**ï¼šä¾‹å¦‚åç«¯è¿”å›ä¸€ä¸ªç®€å•çš„æˆåŠŸæ¶ˆæ¯æˆ–CSVæ•°æ®ã€‚

    fetch('/api/export')
      .then(response => response.text())
      .then(textData => {
        console.log(textData);
        // å¤„ç†æ–‡æœ¬æ•°æ®...
      });

**æ£€æŸ¥å“åº”çŠ¶æ€**ï¼šåœ¨è§£ææ•°æ®å‰ï¼Œå…ˆæ£€æŸ¥è¯·æ±‚æ˜¯å¦çœŸæ­£æˆåŠŸæ˜¯ä¸ªå¥½ä¹ æƒ¯ã€‚

    fetch('/api/some-data')
      .then(response => {
        if (!response.ok) { // æ£€æŸ¥HTTPçŠ¶æ€ç æ˜¯å¦åœ¨200-299ä¹‹é—´
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json(); // çŠ¶æ€æ­£å¸¸æ‰è§£æJSON
      })
      .then(data => /* å¤„ç†æ•°æ® */)
      .catch(error => /* å¤„ç†ç½‘ç»œé”™è¯¯æˆ–çŠ¶æ€ç é”™è¯¯ */);

6\. ğŸ’» å®Œæ•´ä»£ç å‚è€ƒä¸æ€»ç»“
----------------

ä¸‹é¢æ˜¯ä¸€ä¸ªæ•´åˆäº†ç™»å½•å’Œæ–°å¢é¡¹ç›®çš„è¶…ç®€æ˜“å®Œæ•´ç¤ºä¾‹ï¼š

    # app.py (Flaskåç«¯)
    from flask import Flask, request, jsonify
    from flask_cors import CORS
    
    app = Flask(__name__)
    CORS(app)
    items = [] # ç”¨ä¸€ä¸ªç®€æ˜“åˆ—è¡¨æ¨¡æ‹Ÿæ•°æ®åº“
    
    @app.route('/api/login', methods=['POST'])
    def login():
        data = request.get_json()
        if data.get('user') == 'demo':
            return jsonify({'success': True, 'token': 'fake-jwt-token'})
        return jsonify({'success': False}), 401
    
    @app.route('/api/items', methods=['GET', 'POST'])
    def handle_items():
        if request.method == 'GET':
            return jsonify(items)
        else: # POST
            new_item = request.get_json()
            new_item['id'] = len(items) + 1
            items.append(new_item)
            return jsonify(new_item), 201
    
    if __name__ == '__main__':
        app.run(debug=True)

    <!-- index.html (éƒ¨åˆ†å‰ç«¯) -->
    <script>
    // ç™»å½•
    fetch('/api/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({user: 'demo', pass: 'demo'})
    }).then(r => r.json()).then(console.log);
    
    // æ–°å¢é¡¹ç›®å¹¶æ›´æ–°åˆ—è¡¨
    fetch('/api/items', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name: 'New Task'})
    })
    .then(r => r.json())
    .then(newItem => {
        const list = document.getElementById('list');
        list.innerHTML += `<li>${newItem.id}: ${newItem.name}</li>`;
    });
    </script>

**æ€»ç»“ä¸€ä¸‹**ï¼šFetch + Flask çš„ç»„åˆï¼Œé€šè¿‡â€œè¯·æ±‚-å“åº”-JSONâ€çš„æ¨¡å¼ï¼Œå°†å‰åç«¯è§£è€¦ï¼Œè®©Webäº¤äº’å˜å¾—**æ›´åŠ åŠ¨æ€å’Œé«˜æ•ˆ**ã€‚  
å…³é”®åœ¨äºï¼šå‰ç«¯è´Ÿè´£äº¤äº’å’ŒUIæ›´æ–°ï¼Œåç«¯è´Ÿè´£æ•°æ®å’Œé€»è¾‘ï¼Œä¸¤è€…é€šè¿‡æ¸…æ™°çš„APIå¥‘çº¦è¿›è¡Œé€šä¿¡ã€‚

* * *

å–œæ¬¢æœ¬æ–‡ï¼Ÿä¸è¦é”™è¿‡âœ¨ï¼Œç‚¹èµğŸ‘æ”¶è—â­å…³æ³¨æˆ‘ğŸ‘†ï¼Œä¸€èµ·å­¦ä¹ æ›´å¤šæœ‰ç”¨çš„çŸ¥è¯†ï¼Œå®Œå–„ä½ æˆ‘çš„æŠ€èƒ½æ ‘ï¼ä¹Ÿè¯·è·¯è¿‡çš„å¤§ä½¬ç»™äº›å»ºè®®å’ŒæŒ‡æ•™ğŸ™ğŸ¶ï¼