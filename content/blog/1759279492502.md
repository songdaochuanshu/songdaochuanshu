---
layout: post
title: 'åŸºäºSpringAIæ„å»ºå¤§æ¨¡å‹åº”ç”¨'
date: "2025-10-01T00:44:52Z"
---
åŸºäºSpringAIæ„å»ºå¤§æ¨¡å‹åº”ç”¨
=================

1\. èƒŒæ™¯
======

åœ¨è¿™é‡Œï¼Œæˆ‘ä¸»è¦åˆ†äº«çš„æ˜¯åœ¨**åº”ç”¨**å±‚é¢å¤§æ¨¡å‹ç›¸å…³çš„æŠ€æœ¯ï¼Œå‡å¦‚ä½ å·²æœ‰ä¸€ä¸ªç°æˆçš„å¤§æ¨¡å‹æ¥å£ï¼Œæ— è®ºæ˜¯ç¬¦åˆOpenAIè§„èŒƒçš„ï¼Œè¿˜æ˜¯å„å®¶å…¬å¸ä¸€äº›è‡ªå·±çš„æ¥å£ï¼Œä¾‹å¦‚Geminiï¼ŒDeepseekï¼Œé€šä¹‰åƒé—®ï¼Œé—®å¿ƒä¸€è¨€ç­‰ï¼Œè®©ç”¨è¿™äº›å¤§æ¨¡å‹æ¥æ„å»ºä¸€äº›åº”ç”¨ï¼Œå¯ä»¥é€‰å–ä¸‹é¢çš„æ–¹æ¡ˆï¼š

1.  ä½¿ç”¨ä½ä»£ç å¤§æ¨¡å‹åº”ç”¨æ­å»ºå¹³å°ï¼Œä¾‹å¦‚[Coze](https://github.com/coze-dev/coze-studio?tab=readme-ov-file)ï¼Œ[Dify](https://github.com/langgenius/dify/)ï¼Œ [FastGPT](https://github.com/labring/FastGPT)ç­‰ï¼Œè¿™äº›å¹³å°å¸¦äº†æµç¨‹ç¼–æ’ï¼ŒçŸ¥è¯†åº“ï¼Œä¹Ÿå¾ˆæ–¹ä¾¿çš„å’Œå„ç§å¤§æ¨¡å‹å¯¹æ¥ï¼Œå‘é‡æ¨¡å‹ã€å‘é‡åº“ï¼Œæœ‰äº›è¿˜æœ‰äº†ç›‘æ§ç•Œé¢æˆ–è€…æ’ä»¶å¸‚åœºç­‰ï¼Œèƒ½æ»¡è¶³æˆ‘ä»¬çš„å¤§éƒ¨åˆ†éœ€æ±‚
2.  ä½¿ç”¨ç¼–ç¨‹çš„æ–¹å¼æ¥æ„å»ºåº”ç”¨ï¼Œè¿™ç§å¯ä»¥ä½¿ç”¨å…¬å¸ç°æœ‰çš„æŠ€æœ¯æ ˆï¼Œæä¾›æ›´ä¸ºçµæ´»çš„ä½¿ç”¨ï¼Œæ¥å…¥ç°æœ‰çš„ç³»ç»Ÿç­‰ï¼Œæˆ–è€…ä»æ›´é«˜å±‚é¢æ¥è¯´ï¼Œå®šåˆ¶è‡ªå·±çš„å¤§æ¨¡å‹åº”ç”¨è§„èŒƒï¼Œå®šåˆ¶å¤§æ¨¡å‹åº”ç”¨æ„å»ºå¹³å°ï¼Œæ¥å…¥å¹³å°ç­‰ï¼›ä¹Ÿå¯ä»¥æŠŠä¸Šé¢æ‰€è¯´çš„ä½ä»£ç å¹³å°çœ‹ä½œä¸ºè‡ªå»ºå¤§æ¨¡å‹åº”ç”¨ä½“ç³»çš„ä¸€éƒ¨åˆ†ï¼Œå³å¯ä»¥é€šè¿‡ä»£ç çš„æ–¹å¼çµæ´»å»æ„å»ºåº”ç”¨ï¼Œä¹Ÿé€šè¿‡å¹³å°æ›´é«˜æ•ˆçš„å»æ„å»ºåº”ç”¨

æˆ‘ä»¬åé¢è®²çš„ä¸»è¦æ˜¯ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œæˆ‘ä»¬é€‰å–ä¸€äº›ç°æœ‰çš„æ¡†æ¶æ¥å®ç°ï¼ŒPythonä¸»è¦[Langchain](https://github.com/langchain-ai/langchain)ç›¸å…³æŠ€æœ¯ï¼ŒJavaä¹Ÿæœ‰ä¸€ä¸ªå¯¹åº”çš„æ¡†æ¶[Langchain4j](https://github.com/langchain4j/langchain4j)ï¼Œä¹Ÿæœ‰[SpringAI](https://docs.spring.io/spring-ai/reference/index.html)

è¿™äº›æ¡†æ¶å¸®æˆ‘ä»¬åšäº†å¾ˆå¤šäº‹æƒ…ï¼š

1.  å°è£…ä¸€ä¸ªé€šç”¨çš„æ¨¡å‹è°ƒç”¨æ¥å£ï¼Œå±è”½äº†åº•å±‚ä¸åŒå…¬å¸å¤§æ¨¡å‹æ¥å£çš„å·®å¼‚
2.  ç®¡ç†äº†ä¼šè¯å’Œä¸Šä¸‹æ–‡ï¼Œä¼šè¯å°±æ˜¯å°†ç”¨æˆ·ä¹‹å‰é—®çš„é—®é¢˜å’Œç°åœ¨é—®çš„é—®é¢˜å…³è”èµ·æ¥
3.  ç»“æ„åŒ–è¾“å‡ºï¼Œå°†å¤§æ¨¡å‹çš„æ–‡æœ¬è¾“å‡ºè½¬ä¸ºç¨‹åºå¯ä»¥ä½¿ç”¨çš„ç»“æ„åŒ–å¯¹è±¡ï¼Œä¾‹å¦‚JSONå¯¹è±¡
4.  å·¥å…·/å‡½æ•°è°ƒç”¨
5.  å¯è§‚æµ‹æ€§
6.  æ¨¡å‹æ•ˆæœè¯„ä¼°

> ä¸€ä¸ªæ¡†æ¶[LiteLLM](https://github.com/BerriAI/litellm)ä¸“é—¨æŠŠä¸åŒå¤§æ¨¡å‹æ¥å£é€‚é…ä¸ºOpenAIæ ¼å¼çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§å±è”½å·®å¼‚çš„æ–¹å¼

2\. æ¶æ„
======

![](https://img2024.cnblogs.com/blog/2058002/202509/2058002-20250930114427258-998495645.jpg).png)

æ•´ä½“æ¶æ„å¦‚ä¸Šï¼Œä¸‹é¢ä¸»è¦ä»‹ç»éƒ¨åˆ†å®ç°

*   æ¨¡å‹æ¡†æ¶å±‚ï¼Œ[SpringAI](https://docs.spring.io/spring-ai/reference/index.html)ï¼ŒJavaå¤§æ¨¡å‹åº”ç”¨å¼€å‘æ¡†æ¶
*   æ¨¡å‹æ¨ç†èƒ½åŠ›ï¼Œ[Ollama](https://github.com/ollama/ollama)ï¼Œåˆ©ç”¨æœ¬åœ°CPUæˆ–GPUï¼Œå’Œç°æœ‰è®­ç»ƒæ¨¡å‹ï¼Œå®ç°æ¨¡å‹æ¨ç†èƒ½åŠ›ï¼Œä¾¿äºå¼€å‘ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦æ›¿æ¢
*   ç›‘æ§è¿½è¸ªï¼Œ[LangFuse](https://github.com/langfuse/langfuse)ï¼Œè¿½è¸ªå¤§æ¨¡å‹åº”ç”¨è¯·æ±‚ï¼Œä¾‹å¦‚è¾“å…¥è¾“å‡ºï¼Œè€—æ—¶ã€Tokenæ¶ˆè€—ç­‰

3\. å®ç°
======

3.1 å®‰è£…
------

Ollamaå’ŒLangFuseå‚ç…§æ–‡æ¡£å®‰è£…å’Œå¯åŠ¨

SpringAIé€šè¿‡pomå¯¼å…¥ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯¼å…¥äº†springboot ollamaã€opentelemetryç­‰ç›¸å…³åŒ…ï¼Œåè€…æ˜¯ä¸ºäº†æ¥å…¥LangFuse

    <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
        <modelVersion>4.0.0</modelVersion>
        <groupId>com.jd.jt</groupId>
        <artifactId>ai-base</artifactId>
        <version>1.0-SNAPSHOT</version>
        <name>Archetype - ai-base</name>
        <url>http://maven.apache.org</url>
        <parent>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-parent</artifactId>
            <version>3.4.3</version>
            <relativePath/> <!-- lookup parent from repository -->
        </parent>
        <properties>
            <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
            <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
            <maven.compiler.source>21</maven.compiler.source>
            <maven.compiler.target>21</maven.compiler.target>
        </properties>
        <dependencyManagement>
            <dependencies>
                <dependency>
                    <groupId>io.opentelemetry.instrumentation</groupId>
                    <artifactId>opentelemetry-instrumentation-bom</artifactId>
                    <version>2.17.0</version>
                    <type>pom</type>
                    <scope>import</scope>
                </dependency>
                <dependency>
                    <groupId>org.springframework.ai</groupId>
                    <artifactId>spring-ai-bom</artifactId>
                    <version>1.0.1</version>
                    <type>pom</type>
                    <scope>import</scope>
                </dependency>
            </dependencies>
        </dependencyManagement>
    
        <dependencies>
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter</artifactId>
            </dependency>
            <dependency>
                <groupId>org.springframework.ai</groupId>
                <artifactId>spring-ai-starter-model-ollama</artifactId>
            </dependency>
            <!-- Spring AI needs a reactive web server to run for some reason-->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-web</artifactId>
            </dependency>
            <dependency>
                <groupId>io.opentelemetry.instrumentation</groupId>
                <artifactId>opentelemetry-spring-boot-starter</artifactId>
            </dependency>
            <!-- Spring Boot Actuator for observability support -->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-actuator</artifactId>
            </dependency>
            <!-- Micrometer Observation -> OpenTelemetry bridge -->
            <dependency>
                <groupId>io.micrometer</groupId>
                <artifactId>micrometer-tracing-bridge-otel</artifactId>
            </dependency>
            <!-- OpenTelemetry OTLP exporter for traces -->
            <dependency>
                <groupId>io.opentelemetry</groupId>
                <artifactId>opentelemetry-exporter-otlp</artifactId>
            </dependency>
            <dependency>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
                <version>1.18.38</version>
            </dependency>
        </dependencies>
    </project>
    

3.2 èµ·æ­¥ç¤ºä¾‹
--------

    import lombok.extern.slf4j.Slf4j;
    import org.springframework.ai.chat.client.ChatClient;
    import org.springframework.http.MediaType;
    import org.springframework.web.bind.annotation.GetMapping;
    import org.springframework.web.bind.annotation.RequestParam;
    import org.springframework.web.bind.annotation.RestController;
    import reactor.core.publisher.Flux;
    
    @RestController
    @Slf4j
    class MyController {
    
        private final ChatClient chatClient;
    
        public MyController(ChatClient.Builder chatClientBuilder) {
            this.chatClient = chatClientBuilder.build();
        }
    
        @GetMapping(value = "/ai-stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
        Flux<String> generationStream(@RequestParam("userInput") String userInput) {
            return this.chatClient.prompt()
                    .user(userInput)
                    .stream()
                    .content();
        }
    
        @GetMapping("/ai")
        String generation(String userInput) {
            return this.chatClient.prompt()
                    .user(userInput)
                    .call()
                    .content();
        }
    

[application.properties](../../../Project/github/ai-base/src/main/resources/application.properties)

    spring.ai.ollama.chat.enabled=true
    spring.ai.model.chat=ollama
    spring.ai.ollama.chat.options.model=qwen3:8b
    spring.ai.chat.observations.include-prompt=true
    spring.ai.chat.observations.include-completion=true
    management.tracing.sampling.probability=1.0
    

æ‰§è¡Œå‘½ä»¤

    curl --location 'http://localhost:8080/ai?userInput=%E4%BD%A0%E5%A5%BD'
    
    <think>
    å—¯ï¼Œç”¨æˆ·å‘æ¥â€œä½ å¥½â€ï¼Œæˆ‘éœ€è¦ä»¥è‡ªç„¶çš„æ–¹å¼å›åº”ã€‚é¦–å…ˆï¼Œåº”è¯¥ç”¨ä¸­æ–‡å›å¤ï¼Œä¿æŒå‹å¥½å’Œäº²åˆ‡çš„è¯­æ°”ã€‚å¯ä»¥ç®€å•é—®å€™ï¼Œæ¯”å¦‚â€œä½ å¥½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿâ€è¿™æ ·æ—¢å›åº”äº†å¯¹æ–¹çš„é—®å€™ï¼Œåˆä¸»åŠ¨è¯¢é—®æ˜¯å¦éœ€è¦å¸®åŠ©ï¼Œç¬¦åˆæˆ‘çš„è®¾è®¡åŸåˆ™ã€‚åŒæ—¶ï¼Œè¦é¿å…ä½¿ç”¨å¤æ‚æˆ–ç”Ÿç¡¬çš„è¡¨è¾¾ï¼Œè®©å¯¹è¯æ˜¾å¾—è½»æ¾ã€‚å¦å¤–ï¼Œè€ƒè™‘åˆ°ç”¨æˆ·å¯èƒ½æœ‰å„ç§éœ€æ±‚ï¼Œä¿æŒå¼€æ”¾å¼çš„æé—®å¯ä»¥å¼•å¯¼ä»–ä»¬è¿›ä¸€æ­¥è¯´æ˜å…·ä½“é—®é¢˜ï¼Œè¿™æ ·æˆ‘æ‰èƒ½æ›´å¥½åœ°æä¾›å¸®åŠ©ã€‚ç¡®ä¿å›å¤ç®€æ´æ˜äº†ï¼Œç¬¦åˆæ—¥å¸¸äº¤æµçš„ä¹ æƒ¯ã€‚
    </think>
    
    ä½ å¥½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼ŸğŸ˜Š
    

3.3 æç¤ºè¯
-------

### 3.3.1 æç¤ºè¯æ¨¡æ¿

å°†å˜é‡åµŒå…¥æç¤ºè¯æ¨¡æ¿ä¸­ï¼ŒåŠ¨æ€ç”Ÿæˆæç¤ºè¯

    public String generateChildName() {
    
        PromptTemplate promptTemplate = new PromptTemplate("""
                ç”·æ–¹å§“ï¼š{maleName}
                å¥³æ–¹å§“ï¼š{femaleName}
                å¸®å­©å­èµ·å
                """);
    
        Prompt prompt = promptTemplate.create(Map.of("maleName", "å®‹", "femaleName", "åˆ˜"));
    
        return chatClient.prompt(prompt).call().content();
    }
    

æ‰§è¡Œå‘½ä»¤

    curl --location 'http://localhost:8080/get-name
    
    <think>
    å—¯ï¼Œç”¨æˆ·è®©æˆ‘å¸®å¿™ç»™å­©å­èµ·åï¼Œç”·æ–¹å§“å®‹ï¼Œå¥³æ–¹å§“åˆ˜ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦äº†è§£ç”¨æˆ·çš„éœ€æ±‚ã€‚ä»–ä»¬å¯èƒ½æƒ³è¦ä¸€ä¸ªç»“åˆåŒæ–¹å§“æ°çš„åå­—ï¼Œæˆ–è€…æ›´å€¾å‘äºå…¶ä¸­ä¸€ä¸ªå§“æ°ã€‚ä¸è¿‡é€šå¸¸åœ¨ä¸­å›½ï¼Œå­©å­è·Ÿçˆ¶å§“ï¼Œæ‰€ä»¥å¯èƒ½ä¸»è¦ç”¨å®‹å§“ï¼Œä½†æœ‰æ—¶å€™ä¹Ÿä¼šè€ƒè™‘åŒå§“æˆ–è€…ç»“åˆåŒæ–¹å§“æ°çš„å…ƒç´ ã€‚
    ...
    

æç¤ºè¯æ¨¡æ¿ä¹Ÿå¯ä»¥é€šè¿‡`Resource`çš„æ–¹å¼ä½¿ç”¨ï¼Œè¿™æ ·æç¤ºè¯å¯ä»¥å­˜åœ¨ä»»ä½•åœ°æ–¹äº†ï¼Œå·¥ç¨‹æ–‡ä»¶ã€æ•°æ®åº“ã€é…ç½®ä¸­å¿ƒç­‰ï¼ŒæŠŠæç¤ºè¯æ¨¡æ¿æ”¾åœ¨å¤–éƒ¨ï¼Œæ›´å®¹æ˜“ç®¡ç†å’Œå®æ—¶å˜æ›´ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹åº“æ¥å®ç°è¿™ä¸ªåŠŸèƒ½

### 3.3.2 æç¤ºè¯ç®¡ç†

æç¤ºè¯ç®¡ç†æ˜¯å°†æç¤ºè¯å•ç‹¬å­˜å‚¨åœ¨å·¥ç¨‹å¤–éƒ¨ï¼Œæä¾›ä¸€äº›æ˜“ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ç‰ˆæœ¬æ§åˆ¶ï¼Œæœç´¢æç¤ºè¯ç­‰ã€‚

æˆ‘ä»¬è¿™ç”¨äº†LangFuseï¼Œæ‰€ä»¥åªè¦æŠŠå®ƒæ¥å…¥æˆ‘ä»¬çš„é¡¹ç›®å³å¯

1.  åœ¨ç•Œé¢ä¸Šé¢åˆ›å»ºæç¤ºè¯æ¨¡æ¿ï¼Œå¹¶å‘å¸ƒ

![](https://img2024.cnblogs.com/blog/2058002/202509/2058002-20250930114427320-1433600510.png)

2.  åœ¨Javaé¡¹ç›®ä¸­æ¥å…¥ï¼Œå› ä¸ºLangFuseæ²¡æœ‰Javaçš„SDKï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨Apiçš„æ–¹å¼

              <dependency>
                  <groupId>com.github.lianjiatech</groupId>
                  <artifactId>retrofit-spring-boot-starter</artifactId>
                  <version>3.2.0</version>
              </dependency>
    

â€‹ åˆ›å»ºLangFuseClient Httpè¯·æ±‚Clientï¼Œæ”¹é€ ä¹‹å‰å†™generateChildNameæ–¹æ³•ï¼Œä»LangFuseè·å–æç¤ºè¯

    
    @RetrofitClient(baseUrl = "http://localhost:3000")
    public interface LangFuseClient {
    
        @GET("api/public/v2/prompts/{promptName}")
        @Headers("Authorization: Basic cGstbGYtNDFmZjZkYjItZWZjNC00YTg4LTkyNmItZmMxZDE1ZGUwNGNiOnNrLWxmLTYzN2RmMDE0LWVkZDItNDdhNi1iNmUwLTE0N2U2MjMyOWYyMQ==")
        LFPrompt getPrompts(@Path("promptName") String promptName);
    }
    
    
    public String generateChildName() {
    
            LFPrompt lfPrompt = langFuseClient.getPrompts("èµ·å");
            PromptTemplate promptTemplate = new PromptTemplate(lfPrompt.getPrompt());
    
            Prompt prompt = promptTemplate.create(Map.of("maleName", "å®‹", "femaleName", "åˆ˜"));
    
            return chatClient.prompt(prompt).call().content();
    }
    

3.  æ‰§è¡Œå‘½ä»¤ï¼ŒæŸ¥çœ‹ç»“æœ

      curl --location 'http://localhost:8080/get-name'
      
      <think>
      å—¯ï¼Œç”¨æˆ·è®©æˆ‘å¸®å¿™ç»™å­©å­èµ·åï¼Œç”·æ–¹å§“å®‹ï¼Œå¥³æ–¹å§“åˆ˜ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦ç¡®è®¤ç”¨æˆ·çš„éœ€æ±‚ã€‚ä»–ä»¬å¯èƒ½å¸Œæœ›åå­—ä¸­åŒ…å«åŒæ–¹çš„å§“æ°ï¼Œæˆ–è€…ç»“åˆä¸¤è€…çš„å…ƒç´ ã€‚ä¸è¿‡ï¼Œç”¨æˆ·æ²¡æœ‰æ˜ç¡®è¯´æ˜æ˜¯å¦è¦åŒå§“ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦è€ƒè™‘ä¸åŒçš„å¯èƒ½æ€§ã€‚
      
      æ¥ä¸‹æ¥ï¼Œæˆ‘å¾—è€ƒè™‘åå­—çš„å¯“æ„å’ŒéŸ³éŸµã€‚ä¸­æ–‡åå­—é€šå¸¸è®²ç©¶å¹³ä»„æ­é…ï¼Œè¯»èµ·æ¥é¡ºå£ï¼ŒåŒæ—¶è¦æœ‰å¥½çš„å¯“æ„ã€‚æ¯”å¦‚ï¼Œå®‹å’Œåˆ˜çš„ç»„åˆï¼Œå¯èƒ½éœ€è¦æ‰¾ä¸€ä¸ªå­—æ¥è¿æ¥ï¼Œæˆ–è€…ç”¨ä¸¤ä¸ªå­—åˆ†åˆ«ä»£è¡¨åŒæ–¹çš„å§“æ°ã€‚
      
      ç„¶åï¼Œç”¨æˆ·è¦æ±‚è¾“å‡ºåœ¨30ä¸ªå­—ä»¥å†…ï¼Œæ‰€ä»¥æ¯ä¸ªåå­—è¦ç®€æ´ã€‚å¯èƒ½éœ€è¦åˆ—å‡ºå¤šä¸ªé€‰é¡¹ï¼Œè®©ç”¨æˆ·æœ‰é€‰æ‹©çš„ä½™åœ°ã€‚åŒæ—¶ï¼Œè¦æ³¨æ„é¿å…ç”Ÿåƒ»å­—ï¼Œç¡®ä¿åå­—çš„æ˜“è¯»æ€§å’Œç¾è§‚æ€§ã€‚
      
    

### 3.3.3 æç¤ºè¯å·¥ç¨‹

æç¤ºè¯å·¥ç¨‹æ˜¯é€šè¿‡å…³æ³¨æç¤ºè¯å¼€å‘å’Œä¼˜åŒ–ï¼Œæå‡å¤§è¯­è¨€æ¨¡å‹å¤„ç†å¤æ‚ä»»åŠ¡åœºæ™¯çš„èƒ½åŠ›

å…·ä½“å¯ä»¥å‚è€ƒ[æç¤ºå·¥ç¨‹æŒ‡å—](https://www.promptingguide.ai/zh)

ä¸»è¦æ¶‰åŠäº†ï¼š

1.  æç¤ºè¯çš„åŸºæœ¬ç»“æ„ï¼Œä¾‹å¦‚åŒ…å«æŒ‡ä»¤ã€ä¸Šä¸‹æ–‡ï¼Œç”¨æˆ·è¾“å…¥ï¼Œè¾“å‡ºæŒ‡ç¤º
2.  é€šç”¨æŠ€å·§
3.  **æç¤ºè¯æŠ€æœ¯**ï¼Œé›¶æ ·æœ¬æç¤ºï¼Œå°‘æ ·æœ¬æç¤ºï¼Œé“¾å¼æ€è€ƒ

å¦‚æœæœ‰ç°æˆçš„æç¤ºè¯ï¼Œå¯ä»¥ç›´æ¥æ‹¿è¿‡æ¥ç”¨ï¼Œå¼€æºçš„æç¤ºè¯[awesome-chatgpt-prompts](https://github.com/f/awesome-chatgpt-prompts)ï¼Œå•†ä¸šçš„æç¤ºè¯[promptbase](https://promptbase.com/)ï¼Œè¿™æ ·çš„ç½‘ç«™å¾ˆå¤šï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨å¤§æ¨¡å‹æ¥ç”Ÿæˆæç¤ºè¯ï¼Œé€šå¸¸ä¼šæ¯”è‡ªå·±ä»å¤´å¼€å§‹å†™æ•ˆç‡ä¼šé«˜

3.4 ç»“æ„åŒ–è¾“å‡º
---------

å°†å¤§æ¨¡å‹çš„æ–‡æœ¬è¾“å‡ºè½¬åŒ–ä¸ºå›ºå®šç»“æ„

        public List<String> generateChildName() {
    
            LFPrompt lfPrompt = langFuseClient.getPrompts("èµ·å");
            PromptTemplate promptTemplate = new PromptTemplate(lfPrompt.getPrompt());
    
            Prompt prompt = promptTemplate.create(Map.of("maleName", "å®‹", "femaleName", "åˆ˜"));
    
    
            return chatClient.prompt(prompt).call().entity(new ListOutputConverter(new DefaultConversionService()));
        }
    

æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›ç»“æœå˜ä¸ºäº†æ•°ç»„æ ¼å¼ï¼Œä½†å¹¶ä¸å®Œç¾ï¼Œé€šè¿‡æç¤ºè¯å…³é—­thinkå†…å®¹åï¼Œæ ¼å¼ä¸Šé¢è¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜ï¼Œåç»­[SpringAIä¼šæ”¯æŒé€šè¿‡å‚æ•°çš„æ–¹å¼å…³é—­thinkè¿‡ç¨‹](https://github.com/spring-projects/spring-ai/pull/3386)

    curl --location 'http://localhost:8080/get-name'
    
    [
        "<think>\n\n</think>\n\nå®‹æ˜è½©",
        "å®‹å­æ¶µ",
        "å®‹æµ©ç„¶",
        "å®‹æ¢“ç¿",
        "å®‹ä¿Šç†™",
        "å®‹å¤©å®‡",
        "å®‹æµ©å®‡",
        "å®‹æ¢“è±ª",
        ...
    ]
    

å¯ä»¥ä»æç¤ºè¯ä¸­ï¼Œçœ‹åˆ°Spring AIä¸ºæˆ‘ä»¬åŠ äº†çº¦æŸè¾“å‡ºçš„æç¤ºè¯ï¼Œè¾“å‡ºç»“æœä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªæ ¼å¼ï¼Œè¿™ä¸ªæˆªå›¾æ˜¯LangFuseçš„ç›‘æ§çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚å¤§æ¨¡å‹çš„è®°å½•

![](https://img2024.cnblogs.com/blog/2058002/202509/2058002-20250930114427352-1003605449.png)![](https://img2024.cnblogs.com/blog/2058002/202509/2058002-20250930114427343-1799198171.png)

å¦å¤–å¯ä»¥å°†ç»“æœè½¬ä¸ºMapæˆ–è€…Javaçš„æŸä¸ªå…·ä½“Class

3.5 ä¼šè¯å’Œä¸Šä¸‹æ–‡
----------

åœ¨ä½¿ç”¨å¤§æ¨¡å‹åº”ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šæœ‰ä¸¤ç§æ¨¡å¼

1.  å•è½®å¯¹è¯ï¼Œä¹Ÿå°±æ˜¯ä¸€é—®ä¸€ç­”ï¼Œä¹‹å‰é—®è¿‡çš„é—®é¢˜ä¸ä¼šå†è€ƒè™‘
2.  å¤šè½®å¯¹è¯ï¼Œåœ¨æ•´ä¸ªå¯¹è¯å‘¨æœŸå‘¢ï¼Œå¤§æ¨¡å‹ä¼šå…³è”ä¹‹å‰çš„é—®é¢˜ï¼Œç»¼åˆä¹‹åç»™å‡ºå›å¤

è¦å®ç°å¤šè½®å¯¹è¯çš„åŠŸèƒ½ï¼Œå°±éœ€è¦æˆ‘ä»¬è®°å½•æ˜¯å¦æ˜¯ä¸€æ¬¡ä¼šè¯å’Œä¼šè¯æœŸé—´çš„ä¸Šä¸‹æ–‡ï¼Œå› ä¸ºå¤§æ¨¡å‹æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼Œå®ƒè‡ªå·±ä¸è®°å½•è¿™äº›å†…å®¹

    
    
    import org.springframework.ai.chat.client.ChatClient;
    import org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;
    import org.springframework.ai.chat.memory.ChatMemory;
    import org.springframework.ai.chat.memory.MessageWindowChatMemory;
    import org.springframework.ai.chat.prompt.Prompt;
    import org.springframework.ai.chat.prompt.PromptTemplate;
    import org.springframework.ai.converter.ListOutputConverter;
    import org.springframework.core.convert.support.DefaultConversionService;
    import org.springframework.stereotype.Service;
    
    import java.util.List;
    import java.util.Map;
    
    @Service
    public class ChatService {
    
        private final ChatClient chatClient;
    
    
    
        public ChatService(ChatClient.Builder chatClientBuilder) {
            ChatMemory chatMemory = MessageWindowChatMemory.builder().maxMessages(10).build();
    
            this.chatClient = chatClientBuilder
                    .defaultAdvisors(MessageChatMemoryAdvisor.builder(chatMemory).build())
                    .build();
        }
    
        public List<String> generateChildName(String conversationId, String surname, String gender) {
            // ç³»ç»Ÿæç¤ºè¯
            String systemMessage = "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„èµ·åä¸“å®¶ï¼Œæ“…é•¿æ ¹æ®ä¸­å›½ä¼ ç»Ÿæ–‡åŒ–å’Œç°ä»£å®¡ç¾ä¸ºå­©å­èµ·åã€‚è¯·ç¡®ä¿åå­—å¯“æ„ç¾å¥½ã€æœ—æœ—ä¸Šå£ã€‚";
    
            // ç”¨æˆ·æç¤ºè¯æ¨¡æ¿
            String userMessageTemplate = """
                    è¯·ä¸ºå§“{surname}çš„{gender}å­©å­èµ·åï¼Œè¦æ±‚ï¼š
                    1. è¾“å‡ºä¸è¶…è¿‡10ä¸ªåå­—
                    2. æ¯ä¸ªåå­—éƒ½è¦æœ‰å¯“æ„è¯´æ˜
                    3. åå­—è¦ç¬¦åˆç°ä»£å®¡ç¾""";
    
            PromptTemplate userPromptTemplate = new PromptTemplate(userMessageTemplate);
            Prompt userPrompt = userPromptTemplate.create(Map.of(
                    "surname", surname,
                    "gender", gender
            ));
    
            return chatClient
                    .prompt()
                    .system(systemMessage)  // ç³»ç»Ÿæç¤ºè¯
                    .user(userPrompt.getContents())  // ç”¨æˆ·æç¤ºè¯
                    .advisors(a -> a.param(ChatMemory.CONVERSATION_ID, conversationId))
                    .call()
                    .entity(new ListOutputConverter(new DefaultConversionService()));
        }
    
    
    }
    

å½“å‘äº†ä¸¤æ¬¡è¯·æ±‚ä¹‹åï¼Œä»å›å¤çš„å†…å®¹å¯ä»¥çœ‹çœ‹ï¼Œå¤§æ¨¡å‹çŸ¥é“é—®äº†ä¸¤æ¬¡

    ["<think>\nå¥½çš„ï¼Œç”¨æˆ·ä¹‹å‰è®©æˆ‘ä¸ºå§“å®‹çš„ç”·å­©èµ·åï¼Œç°åœ¨åˆå‘äº†ä¸€ä¸ªç±»ä¼¼çš„è¯·æ±‚ï¼Œä½†è¿™æ¬¡è¦æ±‚è¾“å‡ºæ ¼å¼æ˜¯é€—å·åˆ†éš”çš„åˆ—è¡¨ï¼Œæ²¡æœ‰å…¶ä»–æ–‡æœ¬ã€‚æˆ‘éœ€è¦ä»”ç»†åˆ†æç”¨æˆ·çš„éœ€æ±‚ã€‚\n\né¦–å…ˆï¼Œç”¨æˆ·å¯èƒ½æ˜¯åœ¨æµ‹è¯•æˆ‘æ˜¯å¦èƒ½æŒ‰ç…§æ–°çš„æ ¼å¼è¦æ±‚è¾“å‡ºï¼Œæˆ–è€…ä»–ä»¬éœ€è¦å°†åå­—ç›´æ¥ç”¨äºæŸä¸ªç³»ç»Ÿï¼Œæ¯”å¦‚æ³¨å†Œè¡¨å•æˆ–åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥éœ€è¦ç®€æ´çš„æ ¼å¼ã€‚ä¹‹å‰çš„å›å¤æ˜¯ä¸­æ–‡åå­—å’Œå¯“æ„ï¼Œç°åœ¨éœ€è¦è½¬æ¢ä¸ºåªåˆ—å‡ºåå­—ï¼Œç”¨é€—å·åˆ†éš”ã€‚\n\næ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦ç¡®ä¿æ¯ä¸ªåå­—éƒ½ç¬¦åˆç°ä»£å®¡ç¾ï¼ŒåŒæ—¶ä¿æŒå¯“æ„ç¾å¥½ã€‚ç”¨æˆ·ä¹‹å‰æä¾›çš„ä¾‹å­ä¸­æœ‰â€œå®‹å­å¢¨â€ã€â€œå®‹çŸ¥è¿œâ€ç­‰ï¼Œè¿™äº›åå­—éƒ½æ¯”è¾ƒæ–‡é›…ï¼Œç¬¦åˆä¼ ç»Ÿæ–‡åŒ–ï¼ŒåŒæ—¶åˆä¸å¤±ç°ä»£æ„Ÿã€‚æˆ‘éœ€è¦ä¿æŒè¿™ç§é£æ ¼ï¼Œé¿å…ç”Ÿåƒ»å­—ï¼Œç¡®ä¿åå­—æœ—æœ—ä¸Šå£ã€‚\n\nå¦å¤–ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›åå­—æœ‰ç‹¬ç‰¹çš„å¯“æ„ï¼ŒåŒæ—¶é¿å…é‡å¤ã€‚æ¯”å¦‚â€œå®‹æ˜è½©â€ä¸­çš„â€œæ˜â€è±¡å¾å…‰æ˜ï¼Œâ€œè½©â€æœ‰æ°”åº¦çš„æ„æ€ï¼Œè¿™æ ·çš„ç»„åˆæ—¢ä¼ ç»Ÿåˆç°ä»£ã€‚æˆ‘éœ€è¦æ£€æŸ¥æ¯ä¸ªåå­—çš„å¯“æ„æ˜¯å¦æ˜ç¡®ï¼Œå¹¶ä¸”æ²¡æœ‰é‡å¤çš„å­—ã€‚\n\nè¿˜è¦æ³¨æ„åå­—çš„ç»“æ„ï¼Œå§“æ°â€œå®‹â€æ˜¯å•å§“ï¼Œåå­—é€šå¸¸ä¸ºä¸¤ä¸ªå­—ï¼Œæ‰€ä»¥æ¯ä¸ªåå­—éƒ½æ˜¯ä¸¤ä¸ªå­—çš„ç»„åˆã€‚éœ€è¦ç¡®ä¿æ¯ä¸ªåå­—éƒ½ç¬¦åˆè¿™ä¸ªç»“æ„ï¼Œå¹¶ä¸”æ•´ä½“çœ‹èµ·æ¥åè°ƒã€‚\n\næœ€åï¼Œç”¨æˆ·è¦æ±‚ä¸è¶…è¿‡10ä¸ªåå­—ï¼Œæ‰€ä»¥æˆ‘è¦æ§åˆ¶æ•°é‡ï¼Œç¡®ä¿æ¯ä¸ªåå­—éƒ½ç»è¿‡ç­›é€‰ï¼Œç¬¦åˆæ‰€æœ‰è¦æ±‚ã€‚åŒæ—¶ï¼Œè¾“å‡ºæ ¼å¼å¿…é¡»ä¸¥æ ¼éµå¾ªé€—å·åˆ†éš”ï¼Œæ²¡æœ‰å…¶ä»–æ–‡å­—ï¼Œè¿™å¯èƒ½éœ€è¦åœ¨ç”Ÿæˆæ—¶ç‰¹åˆ«æ³¨æ„æ ¼å¼çš„æ­£ç¡®æ€§ï¼Œé¿å…ä»»ä½•å¤šä½™çš„å­—ç¬¦æˆ–ç©ºæ ¼ã€‚\n</think>\n\nå®‹çŸ¥è¿œ","å®‹äº‘èˆŸ","å®‹æ™¯è¡Œ","å®‹æ¸…æ™","å®‹ä¿®è¿œ","å®‹å¢¨è¨€","å®‹æ€€ç‘¾","å®‹æ‰¿æ³½","å®‹æ˜è½©","å®‹è‡´è¿œ"]
    

3.6 å·¥å…·/å‡½æ•°è°ƒç”¨
-----------

åˆ©ç”¨å¤–éƒ¨çš„å·¥å…·ï¼Œå‡½æ•°ç°æœ‰çš„èƒ½åŠ›ï¼ŒåŒæ—¶åˆ©ç”¨å¤§æ¨¡å‹çš„èƒ½åŠ›ï¼Œç»“åˆèµ·æ¥å®Œæˆå¤æ‚çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼š

1.  æŸäº›æ•°å­¦è®¡ç®—å‡½æ•°ï¼Œå¤©æ°”æŸ¥è¯¢æœåŠ¡ï¼Œä¸‹å•æœåŠ¡ï¼Œè®¢ç¥¨æœåŠ¡ï¼Œå‘é‚®ä»¶ç­‰ï¼Œåˆ©ç”¨è¿™äº›æœåŠ¡å¯ä»¥æ‰©å±•å¤§æ¨¡å‹çš„èƒ½åŠ›
2.  åˆä¾‹å¦‚é€šè¿‡æ•°æ®åº“æŸ¥è¯¢ä¿¡æ¯ï¼Œæ–‡æ¡£åº“æŸ¥è¯¢æ–‡æ¡£

å·¥å…·ç±»

    import org.springframework.ai.tool.annotation.Tool;
    
    public class TicketUtil {
    
        @Tool(description = "è¾“å…¥å‡ºå‘åœ°å’Œç›®çš„åœ°ï¼Œè´­ä¹°ç«è½¦ç¥¨")
        public static void buyTicket(String source, String target) {
    
            System.out.println("å·²è´­ä¹°" + source + "åˆ°" + target + "çš„ç¥¨");
        }
    }
    

å¤§æ¨¡å‹è¯·æ±‚æ—¶ï¼Œä½¿ç”¨toolæ–¹æ³•

    import com.jd.ai.util.TicketUtil;
    import org.springframework.ai.chat.client.ChatClient;
    import org.springframework.stereotype.Service;
    
    @Service
    public class TicketService {
    
        private final ChatClient chatClient;
    
    
        public TicketService(ChatClient.Builder chatClientBuilder) {
            this.chatClient = chatClientBuilder.build();
        }
    
        public String buyTicket() {
    
            return chatClient
                    .prompt("å¸®æˆ‘ä¹°åŒ—äº¬åˆ°æ™‹åŸçš„è½¦ç¥¨")
                    .tools(new TicketUtil())
                    .call()
                    .content();
    
        }
    
    
    }
    

    å¤§æ¨¡å‹å›å¤ï¼š
    å¥½çš„ï¼Œç”¨æˆ·è®©æˆ‘å¸®å¿™ä¹°åŒ—äº¬åˆ°æ™‹åŸçš„è½¦ç¥¨ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦ç¡®è®¤å‡ºå‘åœ°å’Œç›®çš„åœ°æ˜¯å¦æ­£ç¡®ã€‚ç”¨æˆ·å·²ç»æ˜ç¡®è¯´æ˜æ˜¯åŒ—äº¬åˆ°æ™‹åŸï¼Œæ‰€ä»¥ç›´æ¥è°ƒç”¨buyTicketå‡½æ•°ï¼Œå‚æ•°æ˜¯source:åŒ—äº¬ï¼Œtarget:æ™‹åŸã€‚æ²¡æœ‰å…¶ä»–å‚æ•°éœ€è¦å¤„ç†ï¼Œæ¯”å¦‚æ—¥æœŸæˆ–åº§ä½ç±»å‹ï¼Œæ‰€ä»¥ç›´æ¥ç”Ÿæˆå·¥å…·è°ƒç”¨ã€‚ç„¶åï¼Œç³»ç»Ÿè¿”å›â€œDoneâ€ï¼Œè¯´æ˜æ“ä½œæˆåŠŸã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘åº”è¯¥å‘Šè¯‰ç”¨æˆ·è´­ç¥¨æˆåŠŸï¼Œå¹¶è¯¢é—®æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥å¸®åŠ©ï¼Œæ¯”å¦‚ç¡®è®¤è½¦æ¬¡æˆ–åŠç†ä¹˜è½¦è¯ã€‚è¿™æ ·æ—¢å®Œæˆäº†è´­ç¥¨ï¼Œåˆæä¾›äº†åç»­æ”¯æŒï¼Œç¡®ä¿ç”¨æˆ·æ»¡æ„ã€‚ æ‚¨çš„åŒ—äº¬è‡³æ™‹åŸè½¦ç¥¨å·²æˆåŠŸè´­ä¹°ï¼è¯·é—®æ˜¯å¦éœ€è¦å¸®æ‚¨æŸ¥è¯¢å…·ä½“è½¦æ¬¡ä¿¡æ¯æˆ–åŠç†ä¹˜è½¦è¯ç›¸å…³æ‰‹ç»­å‘¢ï¼Ÿ
    
    æ§åˆ¶å°è¾“å‡ºï¼š
    å·²è´­ä¹°åŒ—äº¬åˆ°æ™‹åŸçš„ç¥¨
    

3.7 çŸ¥è¯†åº“å’ŒRAG
-----------

RAG(Retrieval Augmented Generation)æ˜¯æ£€ç´¢å¢å¼ºç”Ÿæˆï¼Œç®€å•æ¥è®²é€šè¿‡æå‰æ£€ç´¢ä¸€äº›çŸ¥è¯†ï¼Œå°†è¿™äº›çŸ¥è¯†å’Œç”¨æˆ·çš„é—®é¢˜ä¸€èµ·ç»™å¤§æ¨¡å‹ï¼Œä¼šæé«˜å¤§æ¨¡å‹å›å¤çš„è´¨é‡

### 3.7.1 çŸ¥è¯†åº“

å¯¹äºé€šè¿‡åˆ†è¯çš„æ£€ç´¢ç³»ç»Ÿæ¥è®²ï¼ŒçŸ¥è¯†åº“ä¸€èˆ¬æ˜¯é€šè¿‡è¯­ä¹‰æ¥æ£€ç´¢çš„ï¼Œè¦å®ç°è¯­ä¹‰æ£€ç´¢ï¼Œéœ€è¦å¯¹æ•°æ®åšå‘é‡åŒ–ï¼Œæ‰€ä»¥éœ€è¦å‘é‡æ¨¡å‹å’Œå‘é‡åº“

åœ¨è¿™é‡Œæˆ‘ä»¬ç”¨`SimpleVectorStore`æ¥åšå‘é‡åº“ï¼Œè¿™æ˜¯ä¸€ä¸ªå†…å­˜åº“

    import org.springframework.ai.embedding.EmbeddingModel;
    import org.springframework.ai.vectorstore.SimpleVectorStore;
    import org.springframework.ai.vectorstore.VectorStore;
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;
    
    @Configuration
    public class VectorStoreConfiguration {
        @Bean
        public VectorStore vectorStore(EmbeddingModel embeddingModel) {
            return SimpleVectorStore.builder(embeddingModel).build();
        }
    }
    

ä½¿ç”¨`mxbai-embed-large`ä½œä¸ºå‘é‡æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹ä¹Ÿä½¿ç”¨äº†ollamaçš„åŠŸèƒ½ï¼Œä¸”åœ¨SpringAIä¸­ä¸éœ€è¦é¢å¤–çš„é…ç½®å°±å¯ä»¥ä½¿ç”¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥[å‚ç…§æ–‡æ¡£](https://docs.spring.io/spring-ai/reference/api/embeddings/ollama-embeddings.html)åšä¸€äº›å®šåˆ¶é…ç½®ï¼Œè¿™é‡Œæˆ‘ä»¬å­˜äº†ä¸€äº›[è±†ç“£çš„ç”µå½±ä¿¡æ¯](https://douban.8610000.xyz/q.json)åˆ°é‡Œé¢

    import jakarta.annotation.PostConstruct;
    import org.springframework.ai.chat.client.ChatClient;
    import org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;
    import org.springframework.ai.chat.memory.ChatMemory;
    import org.springframework.ai.chat.memory.MessageWindowChatMemory;
    import org.springframework.ai.document.Document;
    import org.springframework.ai.reader.JsonReader;
    import org.springframework.ai.vectorstore.VectorStore;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.core.io.FileSystemResource;
    import org.springframework.stereotype.Service;
    
    import java.util.List;
    
    @Service
    public class MovieService {
    
    
        private final ChatClient chatClient;
    
        @Autowired
        VectorStore vectorStore;
    
    
        @PostConstruct
        void load() {
            String sourceFile = "/Users/songjiyang.3/Downloads/less_douban_movie.json";
            JsonReader jsonReader = new JsonReader(new FileSystemResource(sourceFile),
                    "title", "year", "id", "role_desc", "original_title");
            List<Document> documents = jsonReader.get();
            this.vectorStore.add(documents);
        }
    
        public MovieService(ChatClient.Builder chatClientBuilder) {
            ChatMemory chatMemory = MessageWindowChatMemory.builder().maxMessages(10).build();
    
            this.chatClient = chatClientBuilder
                    .defaultAdvisors(MessageChatMemoryAdvisor.builder(chatMemory).build())
                    .build();
        }
    
        public List<Document> search(String query) {
            return this.vectorStore.similaritySearch(query);
        }
    
    
    
      
    

ä¸‹é¢æ˜¯ä»å‘é‡åº“çš„æœç´¢ç»“æœï¼Œæœç´¢2013ä¼šå‡ºç°2013å¹´çš„ç”µå½±ï¼Œæœå–œå‰§ä¹Ÿå‡ºæ¥ä¸€äº›ç”µå½±ï¼Œä½†å¹¶ä¸æ˜¯ååˆ†å‡†ç¡®ï¼Œå› ä¸ºæˆ‘ä»¬è¿™åªå­˜äº†ç”µå½±çš„æ ‡é¢˜å’Œæ¼”å‘˜åç§°ï¼Œå¦‚æœåŠ å…¥ä¸€äº›å‰§æƒ…æ–‡æœ¬ï¼Œå¯èƒ½ä¼šåŒ¹é…å‡ºæ¥

    http://localhost:8080/search-movie?query=2013
    
    [{"id":"9eb7a024-e1aa-45ef-921b-f565b45b4fd0","text":"title: ææ€–ç›´æ’­\nyear: 2013\nid: 21360417\nrole_desc: é‡‘ç§‰ç¥ / æ²³æ­£å®‡ / æç’Ÿè£ / å…¨æ…§ç\noriginal_title: ë” í…ŒëŸ¬ ë¼ì´ë¸Œ\n","media":null,"metadata":{"distance":0.4173857673321675},"score":0.5826142326678325},{"id":"b6a81d8a-bc6f-4eb1-921a-6a130f12b3eb","text":"title: æœ¬å‘½å¹´\nyear: 1990\nid: 1296266\nrole_desc: è°¢é£ / è”¡é¸¿ç¿” / ç¨‹ç³ / å§œæ–‡\noriginal_title: \n","media":null,"metadata":{"distance":0.41915724341448546},"score":0.5808427565855145},{"id":"c5a67630-92ce-40b7-97c8-1ff989add62a","text":"title: ç´ åª›\nyear: 2013\nid: 21937452\nrole_desc: ææ¿¬ç›Š / è–›æ™¯æ±‚ / ä¸¥å¿—åª› / ææ¥\noriginal_title: ì†Œì›\n","media":null,"metadata":{"distance":0.4254743519837735},"score":0.5745256480162265},{"id":"d4d735e2-ac91-47e4-b241-dc7d86a32c6a","text":"title: 7å·æˆ¿çš„ç¤¼ç‰©\nyear: 2013\nid: 10777687\nrole_desc: æç„•åº† / æŸ³æ‰¿é¾™ / æœ´ä¿¡æƒ  / éƒ‘é•‡è£\noriginal_title: 7ë²ˆë°©ì˜ ì„ ë¬¼\n","media":null,"metadata":{"distance":0.4299756041030963},"score":0.5700243958969037}]
    
    
    http://localhost:8080/search-movie?query=å–œå‰§
    [{"id":"b8243634-9582-478f-ad61-69668af77d4d","text":"title: ç†”ç‚‰\nyear: 2011\nid: 5912992\nrole_desc: é»„ä¸œèµ« / å­”ä¾‘ / éƒ‘æœ‰ç¾ / é‡‘è´¤ç§€\noriginal_title: ë„ê°€ë‹ˆ\n","media":null,"metadata":{"distance":0.4354497256890415},"score":0.5645502743109585},{"id":"3a9d6a51-f99a-45cd-b6b3-36d868474b40","text":"title: æˆ‘èƒ½è¯´\nyear: 2017\nid: 27000061\nrole_desc: é‡‘ç‚«é”¡ / ç½—æ–‡å§¬ / æå¸å‹‹ / å»‰æƒ å…°\noriginal_title: ì•„ì´ ìº” ìŠ¤í”¼í¬\n","media":null,"metadata":{"distance":0.44649545952808223},"score":0.5535045404719178},{"id":"7b21368e-4a78-4561-aa9a-dc3287b66372","text":"title: å¯ç›çŒ«\nyear: 2009\nid: 2310047\nrole_desc: åˆç”°ç»éƒ / åˆç”°ç»éƒ\noriginal_title: ã“ã¾æ’®ã‚Šæ˜ ç”»ãƒ»ã“ã¾ã­ã“\n","media":null,"metadata":{"distance":0.44757831325045716},"score":0.5524216867495428},{"id":"14c92297-f014-4b9d-8613-cfcdf9b2578c","text":"title: çº¢é³‰é±¼\nyear: 2015\nid: 26266892\nrole_desc: é«˜ç•‘ç§€å¤ª / äºŒå®«å’Œä¹Ÿ / åŒ—é‡æ­¦ / å®«å·å¤§è¾…\noriginal_title: èµ¤ã‚ã ã‹\n","media":null,"metadata":{"distance":0.4475958034962455},"score":0.5524041965037545}]
    

### 3.7.2 RAG

æœ‰äº†çŸ¥è¯†åº“ä¹‹åï¼Œå¯ä»¥åœ¨æ­¤çš„åŸºç¡€ä¸Šé¢ï¼Œå¯¹å¤§æ¨¡å‹çš„é—®é¢˜åšå¢å¼ºæ£€ç´¢

        public String suggestKnow(String query){
            return chatClient.prompt()
                    .system("ä½ æ˜¯ä¸€ä¸ªç”µå½±æ¨èä¸“å®¶ï¼Œè¯·æ ¹æ®ç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢è¯å’ŒçŸ¥è¯†åº“ä¿¡æ¯ï¼Œæ¨èä¸€éƒ¨ç”µå½±ã€‚")
                    .advisors(new QuestionAnswerAdvisor(vectorStore))
                    .user(query)
                    .call()
                    .content();
        }
    
        public String suggest(String query){
            return chatClient.prompt()
                    .system("ä½ æ˜¯ä¸€ä¸ªç”µå½±æ¨èä¸“å®¶ï¼Œè¯·æ ¹æ®ç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢è¯ï¼Œæ¨èä¸€éƒ¨ç”µå½±ã€‚")
                    .user(query)
                    .call()
                    .content();
        }
    

æ¨èç»“æœï¼Œå¯ä»¥çœ‹åˆ°æœ‰æ— çŸ¥è¯†åº“çš„åŒºåˆ«ï¼Œä½†æ˜¯å› ä¸ºåœ¨è¿™ï¼Œè¿™ä¸ªçŸ¥è¯†åº“çš„è´¨é‡ä¸é«˜ï¼Œæ‰€ä»¥æ•´ä½“æ¥è®²ï¼Œæ— çŸ¥è¯†åº“åè€Œæ¨èçš„æ›´å¥½

    http://localhost:8080/suggest-movie?query=å–œå‰§
    
    å¥½çš„ï¼Œç”¨æˆ·æƒ³è¦æ¨èä¸€éƒ¨å–œå‰§ç”µå½±ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦ç¡®å®šç”¨æˆ·å¯èƒ½å–œæ¬¢çš„å–œå‰§ç±»å‹ï¼Œæ˜¯è½»æ¾å¹½é»˜çš„ï¼Œè¿˜æ˜¯å¸¦æœ‰è®½åˆºæˆ–å®¶åº­å…ƒç´ çš„ï¼Ÿä¸è¿‡ç”¨æˆ·åªæåˆ°â€œå–œå‰§â€è¿™ä¸ªè¯ï¼Œæ²¡æœ‰æ›´å¤šç»†èŠ‚ï¼Œæ‰€ä»¥æˆ‘å¾—é€‰ä¸€éƒ¨å¹¿å—å¥½è¯„ã€é€‚åˆå¤§å¤šæ•°äººçš„å–œå‰§ã€‚ è€ƒè™‘åˆ°ä¸åŒåœ°åŒºçš„è§‚ä¼—ï¼Œå¯èƒ½éœ€è¦æ¨èä¸€éƒ¨å›½é™…çŸ¥åçš„ç”µå½±ï¼Œæ¯”å¦‚ç¾å›½æˆ–æ¬§æ´²çš„ã€‚æ¯”å¦‚ã€Šç–¯ç‹‚çš„çŸ³å¤´ã€‹æ˜¯åè¯­ç‰‡ï¼Œå¯èƒ½ç”¨æˆ·å¯¹ä¸­å›½ç”µå½±æ„Ÿå…´è¶£ï¼Ÿæˆ–è€…é€‰ä¸€éƒ¨ç»å…¸çš„è€ç”µå½±ï¼Œæ¯”å¦‚ã€Šå¤§è¯è¥¿æ¸¸ã€‹ï¼Ÿä¸è¿‡ç”¨æˆ·å¯èƒ½æƒ³è¦æ›´ç°ä»£çš„ã€‚ å¦å¤–ï¼Œç”¨æˆ·å¯èƒ½å¸Œæœ›ç”µå½±æœ‰æ·±åº¦ï¼Œä¸åªæ˜¯å•çº¯çš„æç¬‘ï¼Œæ¯”å¦‚ã€Šæ­»äº¡è¯—ç¤¾ã€‹è™½ç„¶åå‰§æƒ…ï¼Œä½†ä¹Ÿæœ‰å¹½é»˜å…ƒç´ ï¼Ÿæˆ–è€…åƒã€Šä¼´æˆ‘åŒè¡Œã€‹è¿™æ ·çš„æˆé•¿å–œå‰§ï¼Ÿä¸è¿‡ç”¨æˆ·æ˜ç¡®è¦å–œå‰§ï¼Œå¯èƒ½æ›´å€¾å‘äºçº¯ç²¹æç¬‘çš„ã€‚ å†æƒ³æƒ³ï¼Œåƒã€Šç–¯ç‹‚åŠ¨ç‰©åŸã€‹è¿™æ ·çš„åŠ¨ç”»å–œå‰§ï¼Œé€‚åˆå„ä¸ªå¹´é¾„å±‚ï¼Œè€Œä¸”å£ç¢‘ä¸é”™ã€‚æˆ–è€…ã€Šè§¦ä¸å¯åŠã€‹è¿™æ ·çš„æ³•å¼å–œå‰§ï¼Œæ—¢æœ‰å¹½é»˜åˆæœ‰æ¸©æƒ…ã€‚æˆ–è€…ã€Šäººåœ¨å›§é€”ã€‹è¿™æ ·çš„åè¯­å–œå‰§ï¼Œæ¯”è¾ƒè´´è¿‘ç”Ÿæ´»ã€‚ ä¸è¿‡ç”¨æˆ·å¯èƒ½æ²¡æœ‰æ˜ç¡®åœ°åŒºåå¥½ï¼Œæ‰€ä»¥é€‰ä¸€éƒ¨å›½é™…è®¤å¯çš„ï¼Œæ¯”å¦‚ã€Šå¸ƒè¾¾ä½©æ–¯å¤§é¥­åº—ã€‹è™½ç„¶å¸¦ç‚¹æ–‡è‰ºï¼Œä½†ä¹Ÿæœ‰å–œå‰§å…ƒç´ ã€‚æˆ–è€…ã€Šé“¶æ²³æŠ¤å«é˜Ÿã€‹è¿™æ ·çš„è¶…çº§è‹±é›„å–œå‰§ï¼Œæ¯”è¾ƒå—æ¬¢è¿ã€‚ ç»¼åˆè€ƒè™‘ï¼Œå¯èƒ½é€‰ä¸€éƒ¨å¹¿ä¸ºäººçŸ¥ã€è¯„ä»·é«˜çš„ï¼Œæ¯”å¦‚ã€Šç–¯ç‹‚çš„çŸ³å¤´ã€‹ä½œä¸ºåè¯­ä»£è¡¨ï¼Œæˆ–è€…ã€Šä¼´æˆ‘åŒè¡Œã€‹ä½œä¸ºç»å…¸ã€‚ä¸è¿‡ç”¨æˆ·å¯èƒ½æƒ³è¦æ›´è¿‘æœŸçš„ï¼Œæ¯”å¦‚ã€Šäººç”Ÿé¥æ§å™¨ã€‹æˆ–è€…ã€Šç–¯ç‹‚åŠ¨ç‰©åŸã€‹ã€‚æˆ–è€…ã€Šå¤§ä¾¦æ¢ç¦å°”æ‘©æ–¯ã€‹è™½ç„¶ååŠ¨ä½œï¼Œä½†ä¹Ÿæœ‰å¹½é»˜ã€‚ å†æ£€æŸ¥ä¸€ä¸‹ï¼Œç”¨æˆ·å¯èƒ½éœ€è¦ä¸€éƒ¨é€‚åˆæ¨èç»™æœ‹å‹çš„ï¼Œæ‰€ä»¥é€‰ä¸€éƒ¨å£ç¢‘å¥½ã€æœ‰ç¬‘ç‚¹çš„ï¼Œæ¯”å¦‚ã€Šäººåœ¨å›§é€”ã€‹æˆ–è€…ã€Šç–¯ç‹‚çš„çŸ³å¤´ã€‹ã€‚æˆ–è€…ã€Šå¤§è¯è¥¿æ¸¸ã€‹ä½œä¸ºç»å…¸ï¼Œä½†å¯èƒ½ç”¨æˆ·å·²ç»çœ‹è¿‡ã€‚ æœ€ç»ˆå†³å®šæ¨èã€Šç–¯ç‹‚çš„çŸ³å¤´ã€‹ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€éƒ¨åè¯­å–œå‰§ï¼Œå‰§æƒ…ç´§å‡‘ï¼Œæœ‰åè½¬ï¼Œé€‚åˆå–œæ¬¢é»‘è‰²å¹½é»˜çš„è§‚ä¼—ã€‚åŒæ—¶ä¹Ÿèƒ½å±•ç¤ºä¸­å›½ç”µå½±çš„ç‰¹è‰²ï¼Œå¯èƒ½ç”¨æˆ·å¯¹è¿™æ–¹é¢æ„Ÿå…´è¶£ã€‚æˆ–è€…å†è€ƒè™‘å…¶ä»–é€‰é¡¹ï¼Œæ¯”å¦‚ã€Šè®©å­å¼¹é£ã€‹ä¹Ÿæ˜¯å¼ è‰ºè°‹çš„ï¼Œä½†æ›´åå‰§æƒ…ã€‚å¯èƒ½è¿˜æ˜¯ã€Šç–¯ç‹‚çš„çŸ³å¤´ã€‹æ›´åˆé€‚ã€‚ æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘æ¨èã€Šç–¯ç‹‚çš„çŸ³å¤´ã€‹ï¼ˆ2006å¹´ï¼Œä¸­å›½ï¼‰ã€‚è¿™éƒ¨ç”±å¾å³¥è‡ªç¼–è‡ªå¯¼è‡ªæ¼”çš„é»‘è‰²å¹½é»˜å–œå‰§ï¼Œä»¥é‡åº†ç«é”…åº—ä¸ºèƒŒæ™¯ï¼Œé€šè¿‡å¤šæ¡æ•…äº‹çº¿äº¤ç»‡å±•å¼€ã€‚å½±ç‰‡å°†æ±Ÿæ¹–æ©æ€¨ã€å•†æˆ˜åšå¼ˆä¸å¸‚äº•ç”Ÿæ´»å·§å¦™ç»“åˆï¼Œæ—¢æœ‰è’è¯çš„ç¬‘ç‚¹ï¼Œåˆæš—å«å¯¹äººæ€§çš„æ·±åˆ»å‰–æã€‚å…¶ç‹¬ç‰¹çš„å™äº‹ç»“æ„å’Œå¯¹å¸‚äº•æ–‡åŒ–çš„åˆ»ç”»ï¼Œä½¿å…¶æˆä¸ºåè¯­å–œå‰§ä¸­çš„ç»å…¸ä¹‹ä½œã€‚
    
    http://localhost:8080/suggest-movie-know?query=å–œå‰§
    å¥½çš„ï¼Œç”¨æˆ·ç°åœ¨è¦æ‰¾å–œå‰§ç±»çš„ç”µå½±æ¨èã€‚æˆ‘éœ€è¦æ ¹æ®æä¾›çš„çŸ¥è¯†åº“é‡Œçš„ä¿¡æ¯æ¥æ¨èã€‚é¦–å…ˆï¼Œæˆ‘è¦çœ‹ä¸€ä¸‹çŸ¥è¯†åº“é‡Œçš„ç”µå½±åˆ—è¡¨ï¼Œçœ‹çœ‹å“ªäº›æ˜¯å–œå‰§ç±»å‹ã€‚ çŸ¥è¯†åº“é‡Œçš„ç”µå½±æœ‰å››éƒ¨ï¼šç†”ç‚‰ï¼ˆ2011ï¼‰ã€æˆ‘èƒ½è¯´ï¼ˆ2017ï¼‰ã€å¯ç›çŒ«ï¼ˆ2009ï¼‰ã€çº¢é³‰é±¼ï¼ˆ2015ï¼‰ã€‚ä¸è¿‡ï¼Œè¿™äº›ç”µå½±çš„æè¿°é‡Œæ²¡æœ‰æ˜ç¡®æåˆ°ç±»å‹ï¼Œåªæœ‰è§’è‰²å’Œå¯¼æ¼”ç­‰ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œç†”ç‚‰å¯èƒ½æ˜¯ä¸€éƒ¨å‰§æƒ…ç‰‡æˆ–è€…ç¤¾ä¼šå‰§ï¼Œå› ä¸ºå®ƒçš„åŸåæ˜¯â€œé“åŠ å°¼â€ï¼Œå¯èƒ½æ¶‰åŠç¤¾ä¼šé—®é¢˜ã€‚æˆ‘èƒ½è¯´çš„æè¿°é‡Œä¹Ÿæ²¡æœ‰ç±»å‹ä¿¡æ¯ï¼Œä½†æ ¹æ®åå­—å¯èƒ½æ¶‰åŠè¯­è¨€æˆ–æ²Ÿé€šçš„ä¸»é¢˜ï¼Œå¯èƒ½ä¸æ˜¯å–œå‰§ã€‚å¯ç›çŒ«çš„åŸåæ˜¯â€œã“ã¾æ’®ã‚Šæ˜ ç”»ãƒ»ã“ã¾ã­ã“â€ï¼Œçœ‹èµ·æ¥åƒæ˜¯å…³äºçŒ«çš„ç”µå½±ï¼Œå¯èƒ½å¸¦æœ‰å¹½é»˜å…ƒç´ ï¼Œä½†ä¸ç¡®å®šæ˜¯å¦æ˜¯å–œå‰§ã€‚çº¢é³‰é±¼çš„åŸåæ˜¯â€œèµ¤ã‚ã ã‹â€ï¼Œå¯èƒ½å’Œé±¼ç±»æœ‰å…³ï¼Œä½†ç±»å‹ä¸æ˜ç¡®ã€‚ é—®é¢˜åœ¨äºï¼Œç”¨æˆ·è¦æ±‚æ¨èå–œå‰§ï¼Œä½†æä¾›çš„çŸ¥è¯†åº“ä¸­æ²¡æœ‰æ˜ç¡®è¯´æ˜ä»»ä½•ç”µå½±å±äºå–œå‰§ç±»å‹ã€‚å› æ­¤ï¼Œæ ¹æ®ç°æœ‰çš„ä¿¡æ¯ï¼Œæ— æ³•ç¡®å®šè¿™äº›ç”µå½±æ˜¯å¦ç¬¦åˆå–œå‰§çš„è¦æ±‚ã€‚è¿™æ—¶å€™åº”è¯¥å‘Šè¯‰ç”¨æˆ·ï¼Œæ ¹æ®æä¾›çš„èµ„æ–™ï¼Œæ— æ³•æ¨èå–œå‰§ç”µå½±ï¼Œå› ä¸ºæ²¡æœ‰ç›¸å…³ç±»å‹çš„ä¿¡æ¯ã€‚éœ€è¦ç¡®è®¤æ˜¯å¦æœ‰å…¶ä»–ä¿¡æ¯æˆ–è€…æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥è¡¥å……ã€‚ æ ¹æ®æä¾›çš„èµ„æ–™ï¼Œè¿™äº›ç”µå½±çš„æè¿°ä¸­æœªæ˜ç¡®æåŠå–œå‰§ç±»å‹ï¼Œå› æ­¤æ— æ³•ç›´æ¥æ¨èç¬¦åˆå–œå‰§åˆ†ç±»çš„å½±ç‰‡ã€‚å»ºè®®æä¾›æ›´å¤šå…³äºç”µå½±ç±»å‹çš„ç»†èŠ‚æˆ–è¡¥å……ä¿¡æ¯ä»¥ä¾¿æ›´ç²¾å‡†æ¨èã€‚
    

3.8 MCP
-------

MCP(Model Context Protocol )æ˜¯å¤§æ¨¡å‹åº”ç”¨å’Œå…¶ä»–èµ„æºæˆ–è€…å·¥å…·äº¤äº’çš„ä¸€ç§æ ‡å‡†åè®®ï¼Œåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯

### 3.8.1 MCPæœåŠ¡ç«¯

å¼•å…¥ä¾èµ–ï¼Œwebmvcè¿™ç§æ–¹å¼ä¼šæš´éœ²ä¸€ä¸ªhttpè·¯å¾„ï¼Œå…¶ä»–mcpå®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªè·¯å¾„æ¥è¿™ä¸ªæœåŠ¡ç«¯äº¤äº’ï¼Œè¿˜æœ‰å…¶ä»–æ–¹å¼æ¥å®ç°MCPæœåŠ¡ï¼Œä¾‹å¦‚STDIO

    <dependency>
                <groupId>org.springframework.ai</groupId>
                <artifactId>spring-ai-starter-mcp-server-webmvc</artifactId>
    </dependency>
    

åœ¨åŸå…ˆçš„ä¹°ç¥¨å·¥å…·ä¸Šé¢ï¼ŒåŠ ä¸€ä¸ªToolCallbackProviderï¼Œè¿™ä¸ªä¼šæŠŠå·¥å…·ç±»æš´éœ²å‡ºæ¥

    @Component
    public class TicketUtil {
    
        @Tool(description = "è¾“å…¥å‡ºå‘åœ°å’Œç›®çš„åœ°ï¼Œè´­ä¹°ç«è½¦ç¥¨")
        public static void buyTicket(String source, String target) {
    
            System.out.println("å·²è´­ä¹°" + source + "åˆ°" + target + "çš„ç¥¨");
        }
    
        @Bean
        public ToolCallbackProvider tools() {
            return MethodToolCallbackProvider.builder().toolObjects(this).build();
        }
    }
    

å¢åŠ é…ç½®

    spring.ai.mcp.server.name=webmvc-mcp-server
    spring.ai.mcp.server.version=1.0.0
    spring.ai.mcp.server.type=SYNC
    spring.ai.mcp.server.instructions=This server provides weather information tools and resources
    spring.ai.mcp.server.sse-message-endpoint=/mcp/messages
    spring.ai.mcp.server.capabilities.tool=true
    spring.ai.mcp.server.capabilities.resource=true
    spring.ai.mcp.server.capabilities.prompt=true
    spring.ai.mcp.server.capabilities.completion=true
    

ä½¿ç”¨MCPå®¢æˆ·ç«¯æ¥å…¥ï¼Œè¿™é‡Œä½¿ç”¨äº†[Cherry-Studio](https://docs.cherry-ai.com/)ï¼Œé¦–å…ˆåœ¨é‡Œé¢é…ç½®MCPæœåŠ¡

![](https://img2024.cnblogs.com/blog/2058002/202509/2058002-20250930114427350-1875598410.png)

![](https://img2024.cnblogs.com/blog/2058002/202509/2058002-20250930114427335-890890148.png)

ç„¶ååœ¨å¯¹è¯é—®ç­”ä¸­å‹¾é€‰MCPæœåŠ¡å¹¶æé—®ï¼Œå¯ä»¥çœ‹åˆ°MCPè°ƒç”¨  
![](https://img2024.cnblogs.com/blog/2058002/202509/2058002-20250930114427309-357377184.png)

### 3.8.2 MCPå®¢æˆ·ç«¯

MCPçš„å®¢æˆ·ç«¯å¯ä»¥æ˜¯ä¸€ä¸ªIDEï¼Œæˆ–è€…å¤§æ¨¡å‹å¯¹è¯å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ä¸Šé¢çš„Cherry-Studioï¼‰ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç¨‹åºï¼ŒSpringAIä¹Ÿæ”¯æŒå®ç°MCPå®¢æˆ·ç«¯

å¼•å…¥ä¾èµ–

        <dependency>
                <groupId>org.springframework.ai</groupId>
                <artifactId>spring-ai-starter-mcp-client</artifactId>
        </dependency>
    

SpirngBooté…ç½®

    spring.ai.ollama.chat.enabled=true
    spring.ai.model.chat=ollama
    spring.ai.ollama.chat.options.model=qwen3:8b
    spring.ai.chat.observations.include-prompt=true
    spring.ai.chat.observations.include-completion=true
    management.tracing.sampling.probability=1.0
    spring.ai.mcp.client.sse.connections.server1.url=http://localhost:8080
    server.port=8081  //æœ¬åœ°8080è¢«MCPæœåŠ¡ç«¯å ç”¨äº†
    

åœ¨æ¨¡å‹è°ƒç”¨ä¸­åŠ å…¥MCPæœåŠ¡ï¼Œæ³¨é‡Šçš„ä»£ç æ˜¯ä¸Šé¢ä½¿ç”¨æœ¬åœ°å·¥å…·çš„ä¾‹å­ï¼ŒMCPå¯ä»¥ç†è§£ä¸ºè¿œç¨‹æˆ–è€…å¤–éƒ¨çš„å·¥å…·ï¼ŒMCPæœåŠ¡ç«¯å°±æ˜¯åˆšåˆšåœ¨ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬è‡ªå·±å®ç°çš„æœåŠ¡ç«¯ï¼Œæˆ‘ä»¬é€šè¿‡é…ç½®çš„`http://localhost:8080`æ‰¾åˆ°äº†å®ƒï¼Œå¹¶äº†è§£äº†å®ƒæœ‰å“ªäº›å·¥å…·ï¼Œè¿™äº›éƒ½æ˜¯SpringAIå¸®æˆ‘ä»¬åšçš„

    import org.springframework.ai.chat.client.ChatClient;
    import org.springframework.ai.mcp.SyncMcpToolCallbackProvider;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Service;
    
    @Service
    public class TicketService {
    
        private final ChatClient chatClient;
        @Autowired
        private SyncMcpToolCallbackProvider toolCallbackProvider;
    
        public TicketService(ChatClient.Builder chatClientBuilder) {
            this.chatClient = chatClientBuilder.build();
        }
    
    
        public String buyTicketMCP() {
    
            return chatClient
                    .prompt("å¸®æˆ‘ä¹°åŒ—äº¬åˆ°æ™‹åŸçš„è½¦ç¥¨")
                    .toolCallbacks(toolCallbackProvider)
                    .call()
                    .content();
    
        }
      
    //    public String buyTicket() {
    //
    //        return chatClient
    //                .prompt("å¸®æˆ‘ä¹°åŒ—äº¬åˆ°æ™‹åŸçš„è½¦ç¥¨")
    //                .tools(new TicketUtil())
    //                .call()
    //                .content();
    //
    //    }
    
    }
    

ä½¿ç”¨å’Œç»“æœï¼Œå¯ä»¥çœ‹åˆ°å¤§æ¨¡å‹çš„æ€è€ƒè¿‡ç¨‹ä¸­æ˜¯ä½¿ç”¨äº†mcpæœåŠ¡çš„

    http://localhost:8081/buy-ticket-mcp?query=ä¹°åŒ—äº¬çš„æ™‹åŸçš„ç¥¨
    
    
    å¥½çš„ï¼Œç”¨æˆ·è®©æˆ‘å¸®å¿™ä¹°åŒ—äº¬åˆ°æ™‹åŸçš„è½¦ç¥¨ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦ç¡®è®¤ç”¨æˆ·çš„éœ€æ±‚æ˜¯å¦æ˜ç¡®ã€‚ç”¨æˆ·æåˆ°çš„å‡ºå‘åœ°æ˜¯åŒ—äº¬ï¼Œç›®çš„åœ°æ˜¯æ™‹åŸï¼Œè¿™ä¸¤ä¸ªåœ°ç‚¹éƒ½æ˜¯ä¸­å›½çš„åŸå¸‚ï¼Œä½†éœ€è¦ç¡®è®¤æ˜¯å¦æœ‰ç›´è¾¾çš„ç«è½¦çº¿è·¯ï¼Œæˆ–è€…æ˜¯å¦éœ€è¦ä¸­è½¬ã€‚ä¸è¿‡ï¼Œæ ¹æ®æä¾›çš„å·¥å…·å‡½æ•°ï¼Œä¼¼ä¹åªéœ€è¦è¾“å…¥å‡ºå‘åœ°å’Œç›®çš„åœ°å³å¯ï¼Œä¸éœ€è¦è€ƒè™‘å…¶ä»–å¤æ‚å› ç´ ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦æ£€æŸ¥å·¥å…·å‡½æ•°çš„å‚æ•°ã€‚å·¥å…·å‡½æ•°æ˜¯spring_ai_mcp_client_server1_buyTicketï¼Œå‚æ•°æ˜¯arg0å’Œarg1ï¼Œéƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ã€‚æ ¹æ®æè¿°ï¼Œarg0åº”è¯¥æ˜¯å‡ºå‘åœ°ï¼Œarg1æ˜¯ç›®çš„åœ°ã€‚å› æ­¤ï¼Œæ­£ç¡®çš„å‚æ•°åº”è¯¥æ˜¯arg0ä¸ºâ€œåŒ—äº¬â€ï¼Œarg1ä¸ºâ€œæ™‹åŸâ€ã€‚ ä¸è¿‡ï¼Œæˆ‘éœ€è¦ç¡®è®¤ç”¨æˆ·æ˜¯å¦å·²ç»æä¾›äº†è¶³å¤Ÿçš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œæ˜¯å¦æœ‰æŒ‡å®šæ—¥æœŸã€åº§ä½ç±»å‹æˆ–è€…è½¦æ¬¡åå¥½ï¼Ÿä½†ç”¨æˆ·çš„é—®é¢˜ä¸­æ²¡æœ‰æåˆ°è¿™äº›ç»†èŠ‚ï¼Œæ‰€ä»¥å¯èƒ½åªéœ€è¦å¤„ç†åŸºæœ¬çš„å‡ºå‘åœ°å’Œç›®çš„åœ°ã€‚å¦‚æœç”¨æˆ·åç»­æœ‰æ›´å¤šéœ€æ±‚ï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥è¯¢é—®ï¼Œä½†å½“å‰æƒ…å†µä¸‹ï¼Œå…ˆæŒ‰ç…§æä¾›çš„ä¸¤ä¸ªå‚æ•°å¤„ç†ã€‚ å¦å¤–ï¼Œè¦ç¡®ä¿è¾“å…¥çš„æ ¼å¼æ­£ç¡®ï¼Œæ˜¯å¦éœ€è¦ä½¿ç”¨å…¨ç§°è¿˜æ˜¯ç®€ç§°ï¼Ÿæ¯”å¦‚ï¼ŒåŒ—äº¬é€šå¸¸ç”¨â€œåŒ—äº¬â€è¡¨ç¤ºï¼Œæ™‹åŸä¹Ÿæ˜¯å…¨ç§°ã€‚æ‰€ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªåŸå¸‚åç§°ä½œä¸ºå‚æ•°åº”è¯¥æ˜¯æ­£ç¡®çš„ã€‚ æœ€åï¼Œç”Ÿæˆå¯¹åº”çš„å·¥å…·è°ƒç”¨ï¼Œå°†å‚æ•°å¡«å…¥å‡½æ•°ä¸­ï¼Œè¿”å›æ­£ç¡®çš„JSONç»“æ„ã€‚ç¡®ä¿æ²¡æœ‰æ‹¼å†™é”™è¯¯ï¼Œå‚æ•°é¡ºåºæ­£ç¡®ï¼Œarg0æ˜¯å‡ºå‘åœ°ï¼Œarg1æ˜¯ç›®çš„åœ°ã€‚è¿™æ ·ç”¨æˆ·çš„éœ€æ±‚å°±èƒ½è¢«æ­£ç¡®å¤„ç†äº†ã€‚ è½¦ç¥¨è´­ä¹°è¯·æ±‚å·²å¤„ç†ï¼ŒåŒ—äº¬è‡³æ™‹åŸçš„ç«è½¦ç¥¨å·²æˆåŠŸé¢„è®¢ã€‚è¯·æ³¨æ„æŸ¥æ”¶çŸ­ä¿¡é€šçŸ¥ï¼Œç¡®è®¤è½¦æ¬¡å’Œä¹˜è½¦æ—¶é—´ã€‚å¦‚æœ‰å…¶ä»–éœ€æ±‚ï¼Œè¯·éšæ—¶å‘ŠçŸ¥ã€‚
    

3.9 ç›‘æ§å’ŒæŒ‡æ ‡
---------

é€šè¿‡å¯¹å¤§æ¨¡å‹åº”ç”¨çš„ç›‘æ§ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å¥½å¤„ï¼š

1.  æ–¹ä¾¿è°ƒè¯•ã€å¼€å‘ï¼Œäº†è§£å¤§æ¨¡å‹åº”ç”¨å†…éƒ¨çš„æ‰§è¡Œæµç¨‹
2.  è€—æ—¶åˆ†æ
3.  Tokenæˆæœ¬åˆ†æ
4.  æ¨¡å‹è¯„ä¼°çš„å‰æ
5.  æ–¹ä¾¿æ’æŸ¥é—®é¢˜

è¿™é‡Œæˆ‘ä»¬ä¸»è¦ç”¨çš„æ˜¯[LangFuse](https://langfuse.com/docs/observability/overview)ï¼Œç°åœ¨SpringAIå·²ç»å¯ä»¥å¾ˆå¥½çš„å’ŒLangFuseé…åˆæ¥ç›‘æ§å¤§æ¨¡å‹è°ƒç”¨ï¼Œä½†ç›®å‰å¯¹äºå·¥å…·ã€MCPçš„è°ƒç”¨è¿˜æ¬ ç¼ºï¼Œéœ€è¦è‡ªå·±æ¥å®ç°

ä¸‹é¢æ˜¯ä¸€ä¸ªç›‘æ§çš„ç¤ºä¾‹ï¼Œå·¦è¾¹æ˜¯ä¸€ç³»åˆ—çš„è¯·æ±‚ï¼Œå³è¾¹æ˜¯æŸä¸€ä¸ªè¯·æ±‚çš„è¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°å„ä¸ªæ‰§è¡ŒèŠ‚ç‚¹ï¼Œå„ä¸ªèŠ‚ç‚¹å…¥å‚å’Œå‡ºå‚ç­‰

![](https://img2024.cnblogs.com/blog/2058002/202509/2058002-20250930114427496-440848542.png)

### 3.9.1 æ¥å…¥LangFuse

æ¥å…¥çš„ä¾èµ–å’Œé…ç½®å‚è€ƒ3.1

å¦å¤–éœ€è¦é…ç½®çš„ä¸€ä¸ªURLå’Œç§˜é’¥ï¼ŒURLæ˜¯LangFuseçš„å¯åŠ¨çš„åœ°å€ï¼Œç§˜é’¥éœ€è¦é€šè¿‡LangFuseç®¡ç†ç•Œé¢ç”Ÿæˆï¼Œé…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡

    OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:3000/api/public/otel;OTEL_EXPORTER_OTLP_HEADERS=Authorization\\=Basic cGstbGYtNGFhYjdhNWEtNThjYi00MWQ2LWIyODktY2M1MDgyMmNiMDliOnNrLWxmLWYxM2YzMmMzLTlkMzItNGE5My1iZmI0LTMxODFiOTE1Yzg2Yw\\=\\=
    

è¯¦æƒ…è§[LangFuseæ–‡æ¡£](https://langfuse.com/integrations/frameworks/spring-ai)

3.10 æ¨¡å‹è¯„ä¼°
---------

å¾ˆå¤šæ—¶å€™ï¼Œåœ¨å¼€å‘å¤§æ¨¡å‹åº”ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¸æ–­è°ƒæ•´æç¤ºè¯ï¼ŒçŸ¥è¯†åº“ï¼Œå·¥ä½œæµï¼Œå·¥å…·ï¼Œæ¨¡å‹ã€æ¨¡å‹å‚æ•°ç­‰ï¼Œè¿™äº›å†…å®¹çš„å˜æ›´ï¼Œéƒ½ä¼šå½±å“æœ€ç»ˆå¤§æ¨¡å‹çš„å›å¤è´¨é‡ï¼Œä¸ºäº†ä¿è¯å¤§æ¨¡å‹çš„å›å¤è´¨é‡æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‰€ä»¥éœ€è¦æœ‰æ¨¡å‹è¯„ä¼°è¿™ä¸ªç¯èŠ‚

ä¸‹é¢æ˜¯æ¨¡å‹è¯„ä¼°çš„ä¸€ä¸ªåŸºæœ¬æµç¨‹

1.  ç¦»çº¿è¯„ä¼°
    1.  å‡†å¤‡æ•°æ®é›†ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·çš„é—®é¢˜å’ŒæœŸæœ›çš„å›å¤
    2.  è¿è¡Œæ•°æ®é›†æµ‹è¯•
    3.  è¯„ä¼°ç”Ÿæˆçš„ç»“æœï¼Œå¯ä»¥äººå·¥/å¤§æ¨¡å‹/è‡ªå®šä¹‰çš„æ–¹å¼è¯„ä¼°
2.  åœ¨çº¿è¯„ä¼°ï¼Œåœ¨ç¦»çº¿è¯„ä¼°è¾¾åˆ°ä¸€ä¸ªå¯ä»¥ä¸Šçº¿çš„æ°´å¹³ä¹‹å
    1.  çº¿ä¸Šæ”¶é›†ç”¨æˆ·é—®é¢˜å’Œå®é™…çš„å›å¤
    2.  è¯„ä¼°ç”Ÿæˆçš„ç»“æœï¼Œå¯ä»¥äººå·¥/å¤§æ¨¡å‹/è‡ªå®šä¹‰çš„æ–¹å¼è¯„ä¼°ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç»“åˆç”¨æˆ·çš„åé¦ˆ
    3.  æ ¹æ®å®é™…çš„è¯„ä¼°æ•°æ®ï¼Œæ‰¾åˆ°ç°æœ‰æµç¨‹çš„é—®é¢˜ï¼Œæ›´æ–°åŸæœ‰æµç¨‹ï¼ŒåŒæ—¶å¡«åŠ æ–°çš„æµ‹è¯•é›†æ•°æ®

![](https://img2024.cnblogs.com/blog/2058002/202509/2058002-20250930114427345-1819600412.png)

LangFuseå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°ä¸Šé¢çš„è¯„ä¼°ï¼Œè¯¦æƒ…å¯ä»¥[å‚è€ƒæ–‡æ¡£](https://langfuse.com/docs/evaluation/overview)

3.11 å¤šæ¨¡æ€è°ƒç”¨
----------

æ›´æ¢ollamaæ”¯æŒå¤šæ¨¡æ€çš„æ¨¡å‹ï¼Œè¿™é€‰ç”¨äº†llama3.2-vision:11bï¼Œæ”¯æŒå›¾æ–‡

ä¿®æ”¹é…ç½®

    spring.ai.ollama.chat.options.model=llama3.2-vision:11b
    

å¤šæ¨¡æ€è°ƒç”¨

        public String multiModality() {
    
            return chatClient.prompt()
                    .system("ç»“æœå¿…é¡»ç”¨ä¸­æ–‡å›å¤")
                    .user(u -> u.text("è§£é‡Šå›¾ç‰‡çš„å†…å®¹")
                            .media(MimeTypeUtils.IMAGE_PNG, new FileSystemResource("/Users/songjiyang.3/Downloads/OIP-C.jpeg")))
                    .call()
                    .content();
        }
    

ç»“æœ

    è¯¥å›¾ç‰‡æ˜¾ç¤ºäº†ä¸€åªçŒ«çš„å¤´éƒ¨ï¼ŒçŒ«çš„å¤´éƒ¨è¢«ä¸€ä¸ªç™½è‰²æ¯›æ¯¯åŒ…è£¹èµ·æ¥ï¼ŒçŒ«çš„çœ¼ç›è¢«æ¯›æ¯¯çš„éƒ¨åˆ†é®ä½äº†ã€‚
    

3.12 æ’ä»¶ç®¡ç†
---------

æˆ‘ä»¬åœ¨æœ‰äº›å¼€æºçš„å¤§æ¨¡å‹å·¥å…·ä¸­ï¼Œä¼šçœ‹åˆ°[æ’ä»¶](https://www.coze.cn/open/docs/guides/plugin)ï¼Œæ’ä»¶æ˜¯ä¸€ä¸ªå·¥å…·é›†ï¼Œä¸€ä¸ªæ’ä»¶å†…å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå·¥å…·ï¼ˆAPIï¼‰

çœ‹èµ·æ¥åªæ˜¯æŠŠå¤šä¸ªå·¥å…·æ•´åˆèµ·æ¥ï¼Œä½†é…ç½®æ’ä»¶å¸‚åœºï¼Œå¯ä»¥è®©å·¥å…·å˜çš„åƒæ‰‹æœºAPPä¸€æ ·ï¼Œå®‰è£…å³å¯ä½¿ç”¨ï¼Œå¤§é‡ç°æˆçš„å·¥å…·å¯ä»¥ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼ˆå¯èƒ½éœ€è¦ä»˜è´¹ï¼‰

![](https://img2024.cnblogs.com/blog/2058002/202509/2058002-20250930114427270-2008474821.png)

å¯¹äºSaasæœåŠ¡è¿™ä¸ªéå¸¸å¥½ç”¨ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§å¼€æº

4\. æ€»ç»“
======

æœ¬æ–‡ä»‹ç»äº†ä½¿ç”¨SpringAI + Ollama + LangFuse æ„å»ºå¤§æ¨¡å‹åº”ç”¨ï¼ŒåŒ…æ‹¬æ•´ä½“çš„æ¶æ„ï¼Œå’Œä½¿ç”¨SpringAIæ„å»ºåº”ç”¨çš„å„ä¸ªç»†èŠ‚ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½ä¼šæ›´å¤æ‚

é€‚ç”¨äºä¼ä¸šçº§å®šåˆ¶å¼€å‘ã€å¤æ‚å¯¹è¯ç³»ç»Ÿã€RAGçŸ¥è¯†é—®ç­”

5\. æƒ³æ³•
======

å¤§æ¨¡å‹æŠ€æœ¯çš„åº•å±‚æ˜¯ç®—åŠ›ï¼Œç°åœ¨äº’è”ç½‘åº”ç”¨èƒ½ç»™ç”¨æˆ·å…è´¹ä½¿ç”¨çš„åŸå› æ˜¯å› ä¸ºæœåŠ¡å™¨ä»¥æä½çš„æˆæœ¬è¢«å¤§é‡ç”¨æˆ·å…±äº«ä½¿ç”¨ï¼Œè€Œå¤§é‡ç”¨æˆ·å¸¦æ¥çš„æµé‡çš„æ”¶ç›Šæ˜¯é«˜äºè¿™äº›æˆæœ¬çš„ï¼Œä¸€æ—¦æœåŠ¡å™¨çš„æˆæœ¬å˜é«˜ï¼Œå…¬å¸å°±æ˜¯ä½¿ç”¨æŸäº›æ‰‹æ®µï¼Œä¾‹å¦‚é™é€Ÿï¼Œè®¢é˜…çš„æ–¹å¼æ¥å¹³è¡¡æ”¯å‡ºã€‚

è€Œå¤§æ¨¡å‹çš„ä½¿ç”¨ä¾èµ–ç®—åŠ›ï¼Œé—®ä¸€ä¸ªé—®é¢˜çš„æˆæœ¬å¤§æ¦‚å¯ä»¥ä¼°è®¡å‡ºæ¥ï¼Œå¦‚ä¸‹è¡¨ï¼Œè™½ç„¶çœ‹èµ·æ¥æˆæœ¬ä¸é«˜ï¼Œä½†ç”¨æˆ·ä½“é‡ä¸€æ—¦èµ·æ¥ï¼Œç®—åŠ›æˆæœ¬éå¸¸é«˜ï¼Œç°åœ¨ä¹‹æ‰€ä»¥å¾ˆå¤šæ˜¯å…è´¹ä½¿ç”¨ï¼Œä¸€æ˜¯å› ä¸ºç°åœ¨è¿˜å¤„äºæŠ¢å å¸‚åœºé˜¶æ®µï¼ŒäºŒæ˜¯å› ä¸ºç”¨æˆ·çš„è¾“å…¥å¯ä»¥æˆæœ¬å¤§æ¨¡å‹çš„è®­ç»ƒæ•°æ®ã€‚

å‚å•†

å…è´¹æ”¿ç­–

ä¼ä¸šçº§APIä»·æ ¼ï¼ˆè¾“å…¥/è¾“å‡ºï¼‰

é€‚ç”¨åœºæ™¯

ç™¾åº¦æ–‡å¿ƒä¸€è¨€

å…¨åŠŸèƒ½å…è´¹

0.004/0.016å…ƒ/åƒtokensï¼ˆ4.5ï¼‰

ä¸ªäºº/ä¼ä¸šå…¨åœºæ™¯

é˜¿é‡Œé€šä¹‰åƒé—®

æ–°ç”¨æˆ·å…è´¹é¢åº¦

0.0003/0.0006å…ƒ/åƒtokensï¼ˆTurboï¼‰

æ€§ä»·æ¯”ä¼˜å…ˆçš„ä¼ä¸šåº”ç”¨

åä¸ºç›˜å¤

æ— å…è´¹é¢åº¦

æ¨ç†èµ„æº20å…ƒ/å°æ—¶èµ·

å·¥ä¸šçº§å¤æ‚ä»»åŠ¡

å­—èŠ‚è±†åŒ…

å®Œå…¨å…è´¹

æœªå…¬å¼€ï¼ˆå½“å‰å…è´¹ï¼‰

ä¸ªäººå­¦ä¹ ã€è½»é‡å¼€å‘

åŸºæœ¬ä¸Šæ˜¯ä¸å¯èƒ½å…è´¹ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œå¤§èƒ†çŒœæµ‹ä¸€ä¸‹ï¼Œåé¢ç®—åŠ›ä¼šå˜ä¸ºå®½å¸¦ï¼Œæµé‡è¿™æ ·çš„åŸºç¡€è®¾æ–½ï¼Œç”±ç”¨æˆ·è‡ªè¡Œè´­ä¹°ä½¿ç”¨æ¥æ»¡è¶³è‡ªå·±çš„éœ€æ±‚

6\. é™„å½•
======

ã€1ã€‘[SpringAIå®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-ai/reference/index.html)

ã€2ã€‘[LangFuseå®˜æ–¹æ–‡æ¡£](https://langfuse.com/docs)

ã€3ã€‘[Ollamaå®˜æ–¹æ–‡æ¡£](https://docs.ollama.com/)

ã€4ã€‘[CherryStudioå®˜ç½‘](https://www.cherry-ai.com/)

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š[songtianer](https://www.cnblogs.com/songjiyang/)ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/songjiyang/p/19120621](https://www.cnblogs.com/songjiyang/p/19120621)