---
layout: post
title: 'ã€å…‰ç…§ã€‘[æ¼«åå°„diffuse]ä»¥UnityURPä¸ºä¾‹'
date: "2025-09-19T00:39:16Z"
---
ã€å…‰ç…§ã€‘\[æ¼«åå°„diffuse\]ä»¥UnityURPä¸ºä¾‹
=============================

![ã€å…‰ç…§ã€‘[æ¼«åå°„diffuse]ä»¥UnityURPä¸ºä¾‹](https://img2024.cnblogs.com/blog/3685400/202509/3685400-20250918130059486-1113071645.png) è¿™ç¯‡æ–‡ç« ä»‹ç»äº†Unity URPæ¸²æŸ“ç®¡çº¿ä¸­æ¼«åå°„å…‰ç…§çš„å®ç°åŸç†å’Œæµç¨‹ã€‚ä¸»è¦å†…å®¹åŒ…æ‹¬ï¼š1. æ¼«åå°„éµå¾ªå…°ä¼¯ç‰¹å®šå¾‹ï¼Œé€šè¿‡æ³•çº¿å‡†å¤‡ã€å…‰æºæ–¹å‘è®¡ç®—ã€ç‚¹ç§¯è¿ç®—ç­‰æ­¥éª¤å®ç°ï¼›2. URPçš„å…·ä½“å®ç°ç»†èŠ‚ï¼Œå¦‚æ³•çº¿å¤„ç†ã€å…‰æºè®¡ç®—å’Œå¤šå…‰æºæ”¯æŒï¼›3. å…³é”®ä»£ç ç¤ºä¾‹ï¼ŒåŒ…æ‹¬æ¼«åå°„è®¡ç®—å’Œå®Œæ•´å…‰ç…§æµç¨‹ï¼›4. å¿«é€Ÿè°ƒç”¨æ–¹æ³•ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ç€è‰²å™¨å’ŒShaderGraphä¸¤ç§æ–¹å¼ï¼›5. URPé€‰æ‹©æ­¤æ–¹æ¡ˆçš„åŸå› ï¼Œå¦‚æ€§èƒ½ä¼˜åŒ–ã€ç‰©ç†ä¸€è‡´æ€§å’Œè·¨å¹³å°æ”¯æŒç­‰ã€‚æ–‡ç« æ—¨åœ¨å¸®åŠ©å¼€å‘è€…ç†è§£URPä¸­çš„æ¼«åå°„å®ç°åŸç†å’Œåº”ç”¨æ–¹æ³•ã€‚

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

**æ¼«åå°„åŸºæœ¬æµç¨‹**
===========

æ¼«åå°„éµå¾ªå…°ä¼¯ç‰¹å®šå¾‹(Lambert's Cosine Law)ï¼Œå…¶æ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š

*   â€Œ**æ³•çº¿å‡†å¤‡**â€Œï¼šè·å–è¡¨é¢æ³•çº¿å‘é‡(é€šå¸¸æ¥è‡ªé¡¶ç‚¹æ³•çº¿æˆ–æ³•çº¿è´´å›¾)
*   â€Œ**å…‰æºæ–¹å‘è®¡ç®—**â€Œï¼šç¡®å®šå…‰æºåˆ°è¡¨é¢ç‚¹çš„å•ä½æ–¹å‘å‘é‡
*   â€Œ**ç‚¹ç§¯è¿ç®—**â€Œï¼šè®¡ç®—æ³•çº¿å‘é‡ä¸å…‰æºæ–¹å‘çš„ç‚¹ç§¯(NÂ·L)
*   â€Œ**èƒ½é‡çº¦æŸ**â€Œï¼šä½¿ç”¨saturateå‡½æ•°å°†ç»“æœé™åˆ¶åœ¨\[0,1\]èŒƒå›´
*   â€Œ**é¢œè‰²æ··åˆ**â€Œï¼šå°†ç»“æœä¸å…‰æºé¢œè‰²å’Œè¡¨é¢åç…§ç‡(albedo)ç›¸ä¹˜

æ•°å­¦è¡¨è¾¾å¼ï¼š
------

$æ¼«åå°„ = å…‰æºé¢œè‰² Ã— è¡¨é¢åç…§ç‡ Ã— max(0, NÂ·L)$

**æ¼«åå°„åŸºæœ¬åŸç†**
===========

æ¼«åå°„éµå¾ªå…°ä¼¯ç‰¹å®šå¾‹(Lambert's Law)ï¼Œæè¿°å…‰çº¿åœ¨ç²—ç³™è¡¨é¢å‡åŒ€æ•£å°„çš„ç°è±¡ã€‚å…¶æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼š

*   å…‰çº¿å…¥å°„è§’åº¦å½±å“åå°„å¼ºåº¦
*   è¡¨é¢æ³•çº¿æ–¹å‘å†³å®šåå°„åˆ†å¸ƒ
*   ä¸è§‚å¯Ÿè§’åº¦æ— å…³çš„å„å‘åŒæ€§åå°„

å…°ä¼¯ç‰¹å®šå¾‹ Lambertâ€™s law
-------------------

$Cdiffuse=(Clight\*Mdiffuse)max(0,nÂ·Iï¼‰$

    fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal, worldLight));
    

åŠå…°ä¼¯ç‰¹
----

$Cdiffuse=(Clight\*Mdiffuse)(a(nÂ·I)+b)$

ç»å¤§å¤šæ•°aå’Œbéƒ½ä¸º0.5

$Cdiffuse=(Clight\*Mdiffuse)(0.5(nÂ·I)+0.5)$

**Unity URPä¸­çš„å®ç°ç»†èŠ‚**
===================

**æ ¸å¿ƒå®ç°ä½ç½®**
----------

URPä¸­çš„æ¼«åå°„è®¡ç®—ä¸»è¦åˆ†å¸ƒåœ¨ä»¥ä¸‹æ–‡ä»¶ï¼š

*   `Packages/com.unity.render-pipelines.universal/ShaderLibrary/Lighting.hlsl`

**å®ç°åŸç†**
--------

*   â€Œ**æ³•çº¿å¤„ç†**â€Œï¼š
    *   ä¸–ç•Œç©ºé—´æ³•çº¿è½¬æ¢
    *   æ³•çº¿è´´å›¾æ”¯æŒ
    *   åŒé¢æ¸²æŸ“å¤„ç†
*   â€Œ**å…‰æºè®¡ç®—**â€Œï¼š
    *   ä¸»å…‰æºæ–¹å‘è®¡ç®—
    *   é™„åŠ å…‰æºå¾ªç¯å¤„ç†
    *   ç‚¹å…‰æº/èšå…‰ç¯æ–¹å‘è®¡ç®—
*   â€Œ**æ¼«åå°„æ ¸å¿ƒ**â€Œï¼š
    *   ä½¿ç”¨halfç²¾åº¦ä¼˜åŒ–
    *   èƒ½é‡å®ˆæ’å¤„ç†
    *   å¤šå…‰æºå åŠ æ”¯æŒ

**å…³é”®ä»£ç å®ç°**
----------

*   **UnityURP\_æ¼«åå°„å®ç°**
    
        hlsl
        // ç®€åŒ–ç‰ˆLambertæ¼«åå°„å®ç°
        half3 DiffuseLighting(Light light, half3 normalWS, half3 albedo)
        {
            half NdotL = saturate(dot(normalize(normalWS), light.direction));
            return light.color * albedo * NdotL;
        }
        
        // å®Œæ•´å…‰ç…§è®¡ç®—å…¥å£
        half3 UniversalFragmentBlinnPhong(InputData inputData, SurfaceData surfaceData)
        {
            // åˆå§‹åŒ–å…‰ç…§ç»“æœ
            half3 color = surfaceData.emission;
            
            // ä¸»å…‰æºæ¼«åå°„è®¡ç®—
            Light mainLight = GetMainLight();
            color += DiffuseLighting(mainLight, inputData.normalWS, surfaceData.albedo);
            
            // é™„åŠ å…‰æºè®¡ç®—
            uint pixelLightCount = GetAdditionalLightsCount();
            for (uint lightIndex = 0; lightIndex < pixelLightCount; ++lightIndex)
            {
                Light light = GetAdditionalLight(lightIndex, inputData.positionWS);
                color += DiffuseLighting(light, inputData.normalWS, surfaceData.albedo);
            }
            
            return color;
        }
        
    

**å¿«é€Ÿè°ƒç”¨æ–¹æ³•**
==========

åœ¨URPç€è‰²å™¨ä¸­è°ƒç”¨æ¼«åå°„çš„æ ‡å‡†æ–¹å¼ï¼š

â€Œ**è‡ªå®šä¹‰ç€è‰²å™¨æ–¹å¼**â€Œï¼š
---------------

    hlsl
    // ç‰‡å…ƒç€è‰²å™¨ç¤ºä¾‹
    half4 frag(Varyings input) : SV_Target
    {
        // åˆå§‹åŒ–è¡¨é¢æ•°æ®
        SurfaceData surfaceData;
        InitializeStandardLitSurfaceData(input.uv, surfaceData);
    
        // å‡†å¤‡å…‰ç…§è¾“å…¥æ•°æ®
        InputData inputData;
        InitializeStandardLitInputData(input, surfaceData.normalTS, inputData);
    
        // è®¡ç®—æ¼«åå°„å…‰ç…§
        half4 color = UniversalFragmentBlinnPhong(inputData, surfaceData);
    
        return color;
    }
    

â€Œ**Shader Graphå¯è§†åŒ–æ–¹å¼**â€Œï¼š
------------------------

*   ä½¿ç”¨"Dot Product"èŠ‚ç‚¹è®¡ç®—NÂ·L
*   ä½¿ç”¨"Multiply"èŠ‚ç‚¹æ··åˆé¢œè‰²
*   è¿æ¥è‡³"Fragment"è¾“å‡ºçš„Base Coloré€šé“

**URPé€‰æ‹©æ­¤æ–¹æ¡ˆçš„åŸå› **
===============

â€Œ**æ€§èƒ½ä¼˜åŒ–**â€Œï¼š
-----------

*   ä½¿ç”¨halfç²¾åº¦è®¡ç®—
*   å†…ç½®å…‰ç…§å¾ªç¯ä¼˜åŒ–
*   æœ€å°åŒ–åˆ†æ”¯é¢„æµ‹

â€Œ**ç‰©ç†ä¸€è‡´æ€§**â€Œï¼š
------------

*   çº¿æ€§ç©ºé—´è®¡ç®—
*   æ­£ç¡®çš„å…‰ç…§è¡°å‡ï¼ˆé€šè¿‡é¢œè‰²ä¸è·ç¦»å’Œé˜´å½±è¡°å‡ç›¸ä¹˜åšåˆ°ï¼‰

â€Œ**æ‰©å±•æ€§**â€Œï¼š
----------

*   æ”¯æŒå¤šå…‰æºåœºæ™¯
*   ä¸PBRå·¥ä½œæµå…¼å®¹
*   å¯æ‰©å±•è‡ªå®šä¹‰å…‰ç…§æ¨¡å‹

â€Œ**è·¨å¹³å°æ”¯æŒ**â€Œï¼š
------------

*   é€‚é…ç§»åŠ¨ç«¯TBDRæ¶æ„
*   æ”¯æŒSRP Batcherä¼˜åŒ–
*   å…¼å®¹å„ç§æ¸²æŸ“è·¯å¾„

åœ¨URPä¸­ï¼Œè¿™ç§å®ç°æ–¹å¼æ—¢ä¿æŒäº†ç»å…¸å…‰ç…§æ¨¡å‹çš„ç›´è§‚æ€§ï¼Œåˆé€šè¿‡ç°ä»£æ¸²æŸ“ç®¡çº¿çš„ä¼˜åŒ–æ‰‹æ®µç¡®ä¿äº†é«˜æ€§èƒ½è¡¨ç°ï¼Œç‰¹åˆ«é€‚åˆéœ€è¦è·¨å¹³å°éƒ¨ç½²çš„é¡¹ç›®ã€‚

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰