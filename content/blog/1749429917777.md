---
layout: post
title: 'Javaé›†åˆæºç --ArrayListçš„å¯è§†åŒ–æ“ä½œè¿‡ç¨‹'
date: "2025-06-09T00:45:17Z"
---
Javaé›†åˆæºç --ArrayListçš„å¯è§†åŒ–æ“ä½œè¿‡ç¨‹
===========================

> å…³äºArrayListçš„å…ƒç´ æ’å…¥ã€æ£€ç´¢ã€ä¿®æ”¹ã€åˆ é™¤ã€æ‰©å®¹ç­‰å¯è§†åŒ–æ“ä½œè¿‡ç¨‹
> 
> è¿˜æœ‰å…³äºArrayListçš„è¿­ä»£å™¨ã€çº¿ç¨‹å®‰å…¨å’Œæ—¶é—´å¤æ‚åº¦

ğŸ“1. åº•å±‚æ•°æ®ç»“æ„
-----------

åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œå†…éƒ¨ç»´æŠ¤ä¸€ä¸ª`Object[]`æ•°ç»„ã€‚æœ¬è´¨æ˜¯**æ•°ç»„æ•°æ®ç»“æ„**ï¼Œåº•å±‚é€šè¿‡æ‹·è´æ‰©å®¹ä½¿å¾—æ•°ç»„å…·å¤‡äº†åŠ¨æ€å¢å¤§çš„ç‰¹æ€§ã€‚

**æ•°ç»„**æ‰€å…·å¤‡çš„ä¸€äº›**ç‰¹æ€§**ï¼Œ`ArrayList`ä¹ŸåŒæ ·å…·å¤‡ï¼Œæ¯”å¦‚ã€æ’å…¥å…ƒç´ çš„æœ‰åºæ€§ã€è®¿é—®å…ƒç´ çš„åœ°å€è®¡ç®—ç­‰ã€‚`ArrayList`ä¸æ™®é€šæ•°ç»„çš„æœ¬è´¨åŒºåˆ«å°±åœ¨äºå®ƒçš„åŠ¨æ€æ‰©å®¹ç‰¹æ€§ã€‚

**é›†åˆå†…å¯ä»¥ä¿å­˜ä»€ä¹ˆç±»å‹å…ƒç´ ï¼Ÿä¿å­˜çš„æ˜¯ä»€ä¹ˆï¼Ÿ** è¿™ç‚¹å¿…é¡»æ˜ç¡®çŸ¥é“**é›†åˆå¿…é¡»ä¿å­˜å¼•ç”¨ç±»å‹**çš„å…ƒç´ ï¼Œå¯¹äºåŸºæœ¬ç±»å‹æ˜¯æ— æ³•ä¿å­˜çš„ï¼Œæ¯”å¦‚ã€intã€longç±»å‹ï¼Œä½†å¯ä»¥ä¿æŒå¯¹åº”çš„åŸºæœ¬ç±»å‹çš„å°è£…ç±»ï¼Œæ¯”å¦‚ï¼Œ`Integer`ã€`Long`ã€‚é›†åˆå†…ä¿å­˜çš„æ˜¯**å¯¹è±¡çš„å¼•ç”¨**ï¼Œè€Œéå¯¹è±¡æœ¬èº«ã€‚

### 1.1. ArrayListçš„ç‰¹æ€§

æœ‰åº•å±‚æ•°æ®ç»“æ„æ‰€å†³å®šçš„ç‰¹æ€§

*   æ’å…¥å…ƒç´ çš„æœ‰åºæ€§ï¼Œè€Œéæ’åºï¼Œä¸ä¼šè‡ªåŠ¨æ ¹æ®å€¼æ’åºï¼›
    
*   å…ƒç´ è®¿é—®ï¼šé€šè¿‡æ•°ç»„â€œ**é¦–åœ°å€+ä¸‹æ ‡**â€æ¥è®¡ç®—å…ƒç´ çš„å­˜å‚¨åœ°å€ï¼Œå†é€šè¿‡å…ƒç´ åœ°å€**ç›´æ¥è®¿é—®**ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼›
    
*   **æ•°ç»„**ä¸€ä½†ç”³è¯·ç©ºé—´å°±ç¡®å®š**ä¸å¯å˜**ï¼Œæ‰€ä»¥ArrayListéœ€è¦åœ¨æ·»åŠ å…ƒç´ æ“ä½œæ—¶ï¼Œå®ç°**è‡ªåŠ¨æ‰©å®¹**ã€‚
    

### 1.2. å¦‚ä½•è®¾è®¡çš„æ•°æ®ç»“æ„

ä»¥ä¸‹æ˜¯`ArrayList`ç±»ç»“æ„ä¸å­—æ®µ

    public class ArrayList<E> extends AbstractList<E>
        implements List<E>, RandomAccess, Cloneable, Serializable {
        private static final long serialVersionUID = 8683452581122892189L;
    
        /** é»˜è®¤åˆå§‹å®¹é‡ */ 
        private static final int DEFAULT_CAPACITY = 10;
        /** ç©ºå®ä¾‹æ•°ç»„ï¼ˆæ— å»¶è¿Ÿæ‰©å®¹ï¼‰ */
        private static final Object[] EMPTY_ELEMENTDATA = {};
        /** é»˜è®¤æ„é€ åé¦–æ¬¡æ‰©å®¹ä½¿ç”¨çš„ç©ºæ•°ç»„ */
        private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};
        /** é˜ˆå€¼ï¼šæœ€å¤§æ•°ç»„å¤§å° */
        private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;
    
        /** çœŸæ­£å­˜å‚¨å…ƒç´ çš„æ•°ç»„ï¼›æ„é€ æ—¶æˆ–èµ‹äºˆ EMPTY_* å…±äº«æ•°ç»„ */
        transient Object[] elementData;
        /** å½“å‰å…ƒç´ ä¸ªæ•° */
        private int size;
        /** ç”¨äº Fail-Fast çš„ä¿®æ”¹è®¡æ•°å™¨ */
        protected transient int modCount;
        // â€¦
    }
    

çœŸæ­£å­˜å‚¨å…ƒç´ çš„æˆå‘˜å˜é‡`Object[] elementData`å’Œä¿å­˜æ•°ç»„å¤§å°çš„`size`ï¼Œå…¶å®ƒå­—æ®µå¤šåŠæœåŠ¡äº**åŠ¨æ€æ‰©å®¹**ã€‚

![image](https://img2024.cnblogs.com/blog/1209017/202506/1209017-20250608124810760-1826254169.jpg)

`MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8` ä¸ºä»€ä¹ˆå‡8ï¼Ÿå› ä¸ºæ•°ç»„å¤´éœ€è¦å ç”¨ä¸€äº›ç©ºé—´ï¼Œ8ä½åˆšå¥½ä¸€ä¸ªå­—èŠ‚ï¼Œæ•…æœ€å°å‡8ï¼Œä½¿å¾—ArrayListå°½å¯èƒ½å­˜å‚¨æ›´å¤šæ•°æ®ï¼Œä½†æ­£å¸¸å¼€å‘ä¸å¯èƒ½ä¿å­˜è¿™ä¹ˆå¤§æ•°æ®é›†åˆï¼Œ`Integer.MAX_VALUE`å¯ä»¥ä¿æŒåäº¿çº§äº†ï¼Œä½ å‡ä¸ª1024éƒ½æ²¡é—®é¢˜ã€‚

`modCount`ç”¨äºè®°å½•æ‰©å®¹æ¬¡æ•°ï¼Œåœ¨è¿­ä»£å™¨ä¸­è‹¥å­˜åœ¨å¹¶å‘ä¿®æ”¹ï¼Œåˆ™å¿«é€Ÿå¤±æ•ˆæŠ›å‡ºå¼‚å¸¸ã€‚

æˆ‘ä»¬ä»æœ¬è´¨å»å­¦ä¹ æŠ€æœ¯ï¼š**é›†åˆçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ**

é›†åˆçš„ä½œç”¨æ˜¯å°†æ•°æ®ä»¥ç‰¹å®šç»“æ„**å­˜å‚¨**åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”æ–¹ä¾¿å¼€å‘è€…è¿›è¡Œ**æ“ä½œ**ã€‚

*   **å­˜å‚¨**ï¼šå¼€è¾Ÿå†…å­˜ç©ºé—´ï¼Œå†™å…¥æ•°æ®ï¼›åœ¨Javaè¯­è¨€ä¸­æ— éœ€å¼€å‘è€…æ‰‹åŠ¨ç”³è¯·å†…å­˜ç©ºé—´ï¼Œåªéœ€è¦å…³æ³¨æ•°æ®å†™å…¥å³å¯ï¼›
    
*   **æ“ä½œ**ï¼šæ— éå°±æ˜¯**å¢åˆ æŸ¥æ”¹**ï¼Œåªä¸è¿‡ç°åœ¨æ“ä½œçš„æ˜¯å†…å­˜ä¸­çš„æ•°æ®ç½¢äº†ã€‚
    

ğŸš€2. å…ƒç´ æ’å…¥ï¼ˆå¢ï¼‰
------------

æ–¹æ³•åˆ†ç±»

`ArrayList` çš„ `add` æ–¹æ³•æœ‰ä¸¤ä¸ªé‡è½½ç‰ˆæœ¬ï¼Œå¯¹åº”ä¸åŒçš„ç”¨æ³•ï¼š

*   `add(E e)` â€”â€” **åœ¨æ•°ç»„æœ«å°¾æ’å…¥**ï¼›
    
*   `add(int index, E element)` â€”â€” **åœ¨æŒ‡å®šç´¢å¼•ä¸‹æ ‡æ’å…¥**ã€‚
    

### 2.1. åœ¨æ•°ç»„æœ«å°¾æ’å…¥

ä½¿ç”¨æ–¹æ³• `add(E e)`ï¼Œä»¥ä¸‹æ˜¯jdk8çš„æºç 

    public boolean add(E e) {
        ensureCapacityInternal(size + 1);
        elementData[size++] = e;
        return true;
    }
    

æ’å…¥æ•°æ®çš„è¿‡ç¨‹

1.  è°ƒç”¨ `ensureCapacityInternal` ç¡®ä¿æ•°ç»„è¶³å¤Ÿå¤§ï¼›
    
2.  å°†å…ƒç´ å†™å…¥ `elementData[size]`ï¼›
    
3.  `size++` å¹¶è¿”å›ã€‚
    

å¯è§†åŒ–æ„Ÿå—ä¸‹ï¼šæ— å‚æ„é€ åˆ›å»ºArrayListé›†åˆï¼Œç„¶åæ’å…¥äº”ä¸ªå…ƒç´ ï¼Œé¦–æ¬¡addéœ€è¦æ‰©å®¹æ•°ç»„ä¸º10ï¼ˆè¯¦ç»†çš„æ‰©å®¹æµç¨‹çœ‹åé¢ç« èŠ‚ï¼‰ï¼Œæ•ˆæœå¦‚å›¾

![image](https://img2024.cnblogs.com/blog/1209017/202506/1209017-20250608124826160-1842514666.gif)

### 2.2. æŒ‡å®šç´¢å¼•ä¸‹æ ‡æ’å…¥

ä½¿ç”¨æ–¹æ³•ï¼š `add(int index, E element)`

    public void add(int index, E element) {
        rangeCheckForAdd(index);
    
        ensureCapacityInternal(size + 1);  // Increments modCount!!
        System.arraycopy(elementData, index, elementData, index + 1,
                         size - index);
        elementData[index] = element;
        size++;
    }
    

æ’å…¥æ•°æ®çš„è¿‡ç¨‹

1.  æ£€æŸ¥æ˜¯å¦è¶Šç•Œï¼›
    
2.  è°ƒç”¨ `ensureCapacityInternal` ç¡®ä¿æ•°ç»„è¶³å¤Ÿå¤§ï¼›
    
3.  å°†åæ ‡`index`åçš„å…ƒç´ éƒ½å¾€åç§»åŠ¨ä¸€ä½ï¼›
    
4.  å°†å…ƒç´ å†™å…¥ `elementData[size]`ï¼›
    
5.  `size++` ã€‚
    

æ¼”ç¤ºåœ¨ç´¢å¼•ä¸‹æ ‡æ’å…¥å…ƒç´ ï¼Œæ•ˆæœå¦‚å›¾ï¼š

![image](https://img2024.cnblogs.com/blog/1209017/202506/1209017-20250608124841367-1862326572.gif)

### 2.3. ensureCapacityInternal ä¸ grow æ‰©å®¹æµç¨‹

ä¸ºäº†å¥½æŸ¥é˜…æºç ï¼Œç®€å•è°ƒæ•´äº†ä¸‹ï¼Œjdkæºç åŸºæœ¬å¦‚ä¸‹

    private void ensureCapacityInternal(int minCapacity) {
        if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
            // å»¶è¿Ÿåˆå§‹åŒ–ï¼šç¬¬ä¸€æ¬¡è°ƒç”¨ ensureCapacity æ—¶ï¼Œå°†å®¹é‡è‡³å°‘è®¾ç½®ä¸º DEFAULT_CAPACITYï¼ˆ10ï¼‰
            minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);
        }
        ensureExplicitCapacity(minCapacity);
    }
    
    private void ensureExplicitCapacity(int minCapacity) {
        modCount++; // ç”¨äºè¿­ä»£æ—¶å¿«é€Ÿå¤±è´¥
        if (minCapacity - elementData.length > 0)
            grow(minCapacity);
    }
    
    private void grow(int minCapacity) {
        // æ—§å®¹é‡
        int oldCapacity = elementData.length;
        // æ–°å®¹é‡ = æ—§å®¹é‡ + æ—§å®¹é‡>>1 ï¼ˆ1.5 å€æ‰©å®¹ï¼‰
        int newCapacity = oldCapacity + (oldCapacity >> 1);
        if (newCapacity - minCapacity < 0)
            newCapacity = minCapacity;
        // æœ€å¤§å®¹é‡æ£€æŸ¥ï¼ˆé˜²æ­¢æº¢å‡ºï¼‰
        if (newCapacity - MAX_ARRAY_SIZE > 0)
            newCapacity = hugeCapacity(minCapacity);
        elementData = Arrays.copyOf(elementData, newCapacity);
    }
    

*   **å»¶è¿Ÿåˆå§‹åŒ–**ï¼šæ— å‚æ„é€ å `elementData` å¼•ç”¨ä¸€ä¸ªé•¿åº¦ä¸º 0 çš„å…±äº«å¸¸é‡æ•°ç»„ã€‚
    
*   **modCount**ï¼šæ¯æ¬¡ç»“æ„ä¿®æ”¹ï¼ˆå¦‚æ‰©å®¹ã€å¢åˆ ï¼‰éƒ½ä¼šè‡ªå¢ï¼Œé…åˆè¿­ä»£å™¨æ£€æŸ¥å¹¶å‘ä¿®æ”¹ã€‚
    
*   **æ‰©å®¹ç­–ç•¥**ï¼š`oldCapacity + (oldCapacity >> 1)`ï¼Œå³ç§»ä¸€ä½ç­‰äºé™¤äº2ï¼Œæ‰€ä»¥`newCapacity`ä¸ºåŸæ¥çš„1.5 å€ï¼Œä»¥æƒè¡¡ç©ºé—´å’Œæ‹·è´æˆæœ¬ã€‚
    

`ArrayList`å¦‚æœä¸æŒ‡å®šå¤§å°åˆå§‹å¤§å°ä¸º0ï¼Œé¦–æ¬¡`add`æ‰è¿›è¡Œé¦–æ¬¡æ‰©å®¹ï¼Œæ‰©å®¹å¤§å°ä¸º10ï¼Œè¿™ä¸ªé»˜è®¤çš„åˆå§‹å®¹é‡`DEFAULT_CAPACITY`åœ¨é¦–å±‚æ’å…¥æ•°æ®æ‰ä¼šä½¿ç”¨åˆ°ã€‚æ•…æ­¤ï¼Œåœ¨åˆ›å»º`ArrayList`æ—¶æœ€å¥½æŒ‡å®šå¤§å°ï¼Œæœ€ä½³æƒ…å†µæ˜¯åˆ›å»ºæ—¶å°±çŸ¥é“é›†åˆçš„å¤§å°ã€‚

è¯¦ç»†å¯è§æ„é€ æ–¹æ³•æºç 

    public ArrayList(int initialCapacity) {
        if (initialCapacity > 0) {
            // æŒ‡å®šåˆå§‹å®¹é‡å¤§äº0æ—¶
            this.elementData = new Object[initialCapacity];
        } else if (initialCapacity == 0) {
            this.elementData = EMPTY_ELEMENTDATA;
        } else {
            throw new IllegalArgumentException("Illegal Capacity: "+
                                               initialCapacity);
        }
    }
    
    // æ— å‚æ„é€ æ–¹æ³•
    public ArrayList() {
        this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
    }
    

æ‰©å®¹å¯è§†åŒ–è¿‡ç¨‹ï¼šæ’å…¥ç¬¬11ä¸ªå…ƒç´ çš„æ‰©å®¹è¿‡ç¨‹

![image](https://img2024.cnblogs.com/blog/1209017/202506/1209017-20250608124859776-183520420.gif)

### 2.4. æ‰©å®¹æ—¶æ‰å¯¹modCount è‡ªå¢åˆç†å—ï¼Ÿ

ä¸åˆç†ã€‚å› ä¸ºä½ æ’å…¥æ–°çš„æ•°æ®æ²¡æœ‰æ‰©å®¹çš„æƒ…å†µä¸‹ï¼Œé›†åˆç”³è¯·çš„å†…å­˜ç©ºé—´ä¸å˜ï¼Œä½†æ˜¯é›†åˆä¿å­˜å…ƒç´ çš„å¤§å°å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™å’Œç§»é™¤å…ƒç´ ä¸€æ ·ï¼Œé›†åˆä¹Ÿæ˜¯å‘ç”Ÿäº†å˜åŒ–çš„ï¼Œæ‰€ä»¥åœ¨åç»­çš„jdkç‰ˆæœ¬ä¸­ï¼Œ`add`æ“ä½œåŠ å…¥äº†`modCount++;`ã€‚

ä»¥ä¸‹æ˜¯jdk11çš„`add`æºç ï¼šé¦–è¡Œå°±å¯¹`modCount`åšäº†è‡ªå¢

    public boolean add(E e) {
        modCount++;
        add(e, elementData, size);
        return true;
    }
    

### 2.5. å…è®¸nullå’Œå¯é‡å¤æ’å…¥ï¼Ÿ

`ArrayList`é›†åˆå†…ä¿å­˜çš„æ˜¯**å¯¹è±¡çš„å¼•ç”¨**ï¼Œåœ¨Javaè¯­è¨€ä¸­ï¼Œå¼•ç”¨æ˜¯å¯ä»¥æŒ‡å‘nullçš„ï¼Œæ•…`ArrayList`é›†åˆå¯ä»¥ä¿å­˜nullã€‚åœ¨å…ƒç´ æ’å…¥æ—¶å¹¶æ²¡æœ‰å¯¹å…ƒç´ è¿›è¡Œé‡å¤æ£€æŸ¥ï¼Œæ•…å¯ä»¥ä¿å­˜é‡å¤æ•°æ®ï¼ŒåŒ…æ‹¬é‡å¤çš„nullã€‚

`List` æ¥å£åœ¨ javadoc é‡Œå°±æ˜ç¡®è¯´äº†ï¼š

> å…è®¸æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬ `null`ï¼‰ï¼Œå…è®¸é‡å¤æ’å…¥ï¼›  
> å¦‚æœä½ éœ€è¦â€œå…ƒç´ å”¯ä¸€â€æˆ–â€œç¦æ­¢ç©ºå€¼â€ï¼ŒJava æä¾›äº†å…¶ä»–é›†åˆç±»å‹ï¼ˆå¦‚å®ç°äº† `Set` æ¥å£çš„ `HashSet`/`LinkedHashSet`/`TreeSet`ï¼Œæˆ–è€…åœ¨ Java 9+ å¯ä»¥ç”¨ `List.of(...)` æ„é€ çš„ä¸å¯ç©ºã€ä¸å¯å˜çš„åˆ—è¡¨ï¼‰

**å®ç°ç®€å•é«˜æ•ˆ**  
`ArrayList` åº•å±‚ç”¨ä¸€å—è¿ç»­çš„ `Object[]` æ•°ç»„å­˜å‚¨å…ƒç´ ï¼š

*   æ’å…¥ `null` åªä¸è¿‡æ˜¯å¾€æ•°ç»„é‡Œèµ‹ä¸€ä¸ª `null`ï¼Œè·Ÿå­˜ä»»ä½•å…¶ä»–å¯¹è±¡æ²¡åŒºåˆ«ï¼›
    
*   é‡å¤æ’å…¥åªæ˜¯æŠŠåŒä¸€ä¸ªå¼•ç”¨èµ‹ç»™ä¸åŒç´¢å¼•ï¼Œä¹Ÿæ²¡æœ‰é¢å¤–å¼€é”€ï¼›  
    å¦‚æœå¼ºè¡Œåœ¨ `add()` é‡Œåšâ€œéç©ºæ£€æŸ¥â€æˆ–â€œå»é‡â€ï¼Œä¸ä»…ä¼šå¢åŠ æ¯æ¬¡æ’å…¥çš„å¼€é”€ï¼Œè¿˜ä¼šç ´åå®ƒä½œä¸ºé€šç”¨ã€è½»é‡åˆ—è¡¨çš„è®¾è®¡åˆè¡·ã€‚
    

ğŸ“Œ3. ä¿®æ”¹å…ƒç´ ï¼ˆæ”¹ï¼‰
------------

æ ¹æ®æŒ‡å®šç´¢å¼•è¿›è¡Œè¦†ç›–`E set(int index, E element)`

    public E set(int index, E element) {
        rangeCheck(index);
    
        E oldValue = elementData(index);
        elementData[index] = element;
        return oldValue;
    }
    

è¿™ä¸ªå¾ˆç®€å•ï¼Œæ£€æŸ¥æ˜¯å¦è¶Šç•Œï¼Œæš‚å­˜æ—§å€¼ï¼Œè¦†ç›–æ•°ç»„å¯¹åº”ä¸‹æ ‡çš„å€¼ï¼Œè¿”å›æ—§å€¼ã€‚

ä¿®æ”¹ç´¢å¼•å…ƒç´ å¯è§†åŒ–è¿‡ç¨‹ï¼š

![image](https://img2024.cnblogs.com/blog/1209017/202506/1209017-20250608124757138-817042345.gif)

ğŸ“4. ç§»é™¤å…ƒç´ ï¼ˆåˆ ï¼‰
------------

æ–¹æ³•åˆ†ç±»

`ArrayList` çš„ `remove` æ–¹æ³•æœ‰ä¸¤ä¸ªé‡è½½ç‰ˆæœ¬ï¼Œå¯¹åº”ä¸åŒçš„ç”¨æ³•ï¼š

1.  `remove(int index)` â€”â€” **æŒ‰ç´¢å¼•åˆ é™¤**ï¼›
    
2.  `remove(Object o)` â€”â€” **æŒ‰å¯¹è±¡å€¼åˆ é™¤**ã€‚
    

### 4.1. æŒ‡å®šç´¢å¼•åˆ é™¤

ä½¿ç”¨åˆ°çš„æ–¹æ³•ï¼š`remove(int index)`

    public E remove(int index) {
        rangeCheck(index); // æ£€æŸ¥ç´¢å¼•æ˜¯å¦åˆæ³•
        modCount++;        // ä¿®æ”¹æ¬¡æ•°+1ï¼Œæ”¯æŒ fail-fast
        E oldValue = elementData(index); // è·å–æ—§å€¼
        int numMoved = size - index - 1;
        if (numMoved > 0)
            System.arraycopy(elementData, index + 1, elementData, index, numMoved);
        elementData[--size] = null; // clear to let GC do its work
        return oldValue;
    }
    

**åˆ†æ**ï¼š

*   ä½¿ç”¨ `System.arraycopy()` å°†åé¢æ‰€æœ‰å…ƒç´ å‘å‰ç§»åŠ¨ä¸€ä½ï¼›
    
*   æœ€åæƒ…å†µæ˜¯åˆ é™¤ç´¢å¼• 0ï¼Œç§»åŠ¨ n-1 ä¸ªå…ƒç´ ï¼›
    
*   ä¿®æ”¹ sizeï¼Œæ¸…é™¤æœ€åä¸€ä¸ªå…ƒç´ å¼•ç”¨ã€‚
    

åˆ é™¤ç´¢å¼•å…ƒç´ çš„å¯è§†åŒ–è¿‡ç¨‹ï¼š

![image](https://img2024.cnblogs.com/blog/1209017/202506/1209017-20250608124915189-1908897366.gif)

### 4.2. æŒ‰ç…§å¯¹è±¡å€¼åˆ é™¤

ä½¿ç”¨åˆ°çš„æ–¹æ³•ï¼š`remove(Object o)`

    public boolean remove(Object o) {
        if (o == null) {
            for (int index = 0; index < size; index++)
                if (elementData[index] == null) {
                    fastRemove(index);
                    return true;
                }
        } else {
            for (int index = 0; index < size; index++)
                if (o.equals(elementData[index])) {
                    fastRemove(index);
                    return true;
                }
        }
        return false;
    }
    

é…å¥—çš„ `fastRemove(int index)` å®ç°å¦‚ä¸‹ï¼š

    private void fastRemove(int index) {
        modCount++;
        int numMoved = size - index - 1;
        if (numMoved > 0)
            System.arraycopy(elementData, index + 1, elementData, index, numMoved);
        elementData[--size] = null;
    }
    

**åˆ†æ**ï¼š

*   å…ˆçº¿æ€§æŸ¥æ‰¾ç›®æ ‡å…ƒç´ ï¼Œæœ€å¤šæ¯”è¾ƒ `n` æ¬¡ï¼›
    
*   ç„¶åç§»é™¤å…ƒç´ ï¼Œæœ€å¤šç§»åŠ¨ `n-1` ä¸ªï¼›
    
*   æ‰€ä»¥æ€»æ“ä½œæ˜¯ä¸€æ¬¡â€œ**çº¿æ€§æŸ¥æ‰¾ + çº¿æ€§ç§»åŠ¨**â€ã€‚
    

é¿å…åœ¨å¤§åˆ—è¡¨ä¸­é¢‘ç¹åˆ é™¤ä¸­é—´å…ƒç´ ï¼ˆå°¤å…¶åœ¨å¾ªç¯ä¸­åˆ é™¤ï¼‰ï¼Œå¦åˆ™å®¹æ˜“é€€åŒ–ä¸º O(nÂ²)ã€‚

å¯¹æ¯”æŒ‰ç…§ç´¢å¼•åˆ é™¤ï¼Œå¤šäº†ä¸€æ­¥**å…ƒç´ æŸ¥æ‰¾å¯¹æ¯”**ï¼Œå…¶å®ƒåŸºæœ¬ä¸€è‡´ã€‚

æŒ‰ç…§å¯¹è±¡å€¼åˆ é™¤å…ƒç´ çš„å¯è§†åŒ–è¿‡ç¨‹ï¼š

![image](https://img2024.cnblogs.com/blog/1209017/202506/1209017-20250608124933157-80637064.gif)

ğŸ¯5. è·å–å’Œæ£€ç´¢å…ƒç´ ï¼ˆæŸ¥ï¼‰
---------------

### 5.1. è·å–å…ƒç´ 

æ ¹æ®ç´¢å¼•è·å–å…ƒç´ ï¼š`get(int index)`

    public E get(int index) {
        rangeCheck(index);
        return elementData(index);
    }
    

æ£€æŸ¥æ˜¯å¦è¶Šç•Œï¼Œç„¶åæ ¹æ®ä¸‹æ ‡ç´¢å¼•è·å–å…ƒç´ ã€‚

### 5.2. æ£€ç´¢å…ƒç´ 

åœ¨ `ArrayList` ä¸­ï¼Œ**æ£€ç´¢æŸä¸ªå…ƒç´ **ï¼ˆä¸æ˜¯é€šè¿‡ç´¢å¼•ï¼Œè€Œæ˜¯æŸ¥æ‰¾æŸä¸ªå€¼æ˜¯å¦å­˜åœ¨ï¼Œæˆ–å…¶ä½ç½®ï¼‰ä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•å®Œæˆï¼š

#### 1) åˆ¤æ–­æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ 

æ ¹æ®å¯¹è±¡å€¼åˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨ï¼š`contains(Object o)`

    public boolean contains(Object o) {
        return indexOf(o) >= 0;
    }
    

è¿™ä¸ªæ–¹æ³•å†…éƒ¨è°ƒç”¨äº† `indexOf` æ–¹æ³•ã€‚å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºåˆ—è¡¨ä¸­ã€‚

#### 2) è¿”å›å…ƒç´ é¦–æ¬¡å‡ºç°çš„ç´¢å¼•

æ ¹æ®å¯¹è±¡å€¼æ£€ç´¢é¦–æ¬¡å‡ºç°çš„ä½ç½®ï¼š`indexOf(Object o)`

è·ŸæŒ‰ç…§å¯¹è±¡å€¼åˆ é™¤çš„æ£€ç´¢è¿‡ç¨‹ä¸€è‡´ï¼Œå¯æŸ¥çœ‹ä¸Šé¢çš„å¯è§†åŒ–è¿‡ç¨‹åŠ¨å›¾ã€‚

    public int indexOf(Object o) {
        if (o == null) {
            for (int i = 0; i < size; i++)
                if (elementData[i] == null)
                    return i;
        } else {
            for (int i = 0; i < size; i++)
                if (o.equals(elementData[i]))
                    return i;
        }
        return -1;
    }
    

å¦‚æœæŸ¥æ‰¾çš„æ˜¯ `null`ï¼Œå°±ç”¨ `==` æ¯”è¾ƒï¼›å¦‚æœæ˜¯é `null` å¯¹è±¡ï¼Œåˆ™ç”¨ `equals()` æ–¹æ³•é€ä¸ªæ¯”è¾ƒã€‚ä»å¤´éå†ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ç´¢å¼•ã€‚

#### 3) è¿”å›å…ƒç´ æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•

æ ¹æ®å¯¹è±¡å€¼æ£€ç´¢æœ€åå‡ºç°çš„ä½ç½®ï¼š`lastIndexOf(Object o)`

    public int lastIndexOf(Object o) {
        if (o == null) {
            for (int i = size - 1; i >= 0; i--)
                if (elementData[i] == null)
                    return i;
        } else {
            for (int i = size - 1; i >= 0; i--)
                if (o.equals(elementData[i]))
                    return i;
        }
        return -1;
    }
    

ä¸ `indexOf` ç±»ä¼¼ï¼Œä½†ä»**å°¾éƒ¨å¼€å§‹**å‘å‰æŸ¥æ‰¾ã€‚

6\. ArrayList çš„è¿­ä»£å™¨ï¼ˆIteratorï¼‰
----------------------------

### 6.1. ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ

è¿­ä»£å™¨ï¼ˆ`Iterator`ï¼‰æ˜¯ Java é›†åˆæ¡†æ¶ä¸­ç”¨äºéå†é›†åˆå…ƒç´ çš„å·¥å…·ã€‚  
`ArrayList` æä¾›äº†ä¸¤ç§ä¸»è¦çš„è¿­ä»£æ–¹å¼ï¼š

*   `Iterator<E>`ï¼šåŸºç¡€çš„è¿­ä»£å™¨æ¥å£ï¼ˆåªæ”¯æŒå•å‘éå†ï¼‰
    
*   `ListIterator<E>`ï¼šæ˜¯ `Iterator` çš„å­æ¥å£ï¼Œ**æ”¯æŒåŒå‘éå†ã€ä¿®æ”¹å…ƒç´ ã€è·å–ç´¢å¼•ç­‰é«˜çº§åŠŸèƒ½**
    

### 6.2. iteratorè¿­ä»£å™¨

æºç ï¼ˆä½äº `ArrayList.java`ï¼‰ï¼š

    public Iterator<E> iterator() {
        return new Itr();
    }
    

è¿™ä¼šè¿”å›ä¸€ä¸ªå†…éƒ¨ç±» `Itr` çš„å®ä¾‹ã€‚

#### 1) Itr å†…éƒ¨ç±»çš„æ ¸å¿ƒæºç ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

    private class Itr implements Iterator<E> {
        int cursor = 0;       // ä¸‹ä¸€ä¸ªè¦è¿”å›çš„å…ƒç´ ç´¢å¼•
        int lastRet = -1;     // ä¸Šä¸€ä¸ªè¿”å›çš„å…ƒç´ ç´¢å¼•ï¼Œè‹¥æ²¡æœ‰åˆ™ä¸º -1
        int expectedModCount = modCount;  // ç”¨äºæ£€æµ‹å¹¶å‘ä¿®æ”¹
    
        public boolean hasNext() {
            return cursor != size;
        }
    
        public E next() {
            checkForComodification();
            int i = cursor;
            if (i >= size)
                throw new NoSuchElementException();
            cursor = i + 1;
            return (E) elementData[lastRet = i];
        }
    
        public void remove() {
            if (lastRet < 0)
                throw new IllegalStateException();
            checkForComodification();
    
            ArrayList.this.remove(lastRet);
            cursor = lastRet;
            lastRet = -1;
            expectedModCount = modCount;
        }
    
        final void checkForComodification() {
            if (modCount != expectedModCount)
                throw new ConcurrentModificationException();
        }
    }
    

#### 2) `modCount` ä¸å¹¶å‘ä¿®æ”¹æ£€æŸ¥ï¼ˆfail-fastï¼‰

*   `modCount` æ˜¯ `ArrayList` ä¸­ç”¨äºè®°å½•ç»“æ„æ€§ä¿®æ”¹ï¼ˆå¦‚æ·»åŠ ã€åˆ é™¤å…ƒç´ ï¼‰æ¬¡æ•°çš„å­—æ®µã€‚
    
*   è¿­ä»£å™¨åˆ›å»ºæ—¶ä¿å­˜äº†å½“å‰çš„ `modCount` åˆ° `expectedModCount`ã€‚
    
*   å¦‚æœåœ¨è¿­ä»£æœŸé—´é›†åˆå‘ç”Ÿç»“æ„æ€§ä¿®æ”¹ï¼Œ`modCount != expectedModCount`ï¼Œå°±ä¼šæŠ›å‡º `ConcurrentModificationException`ã€‚
    

è¿™å°±æ˜¯æ‰€è°“çš„ **fail-fastæœºåˆ¶**ã€‚

#### 3) ç¤ºä¾‹ä»£ç 

    List<String> list = new ArrayList<>();
    list.add("A");
    list.add("B");
    list.add("C");
    
    Iterator<String> it = list.iterator();
    while (it.hasNext()) {
        String s = it.next();
        System.out.println(s);
    }
    

### 6.3. ListIteratoræ›´å¼ºå¤§çš„åŒå‘è¿­ä»£å™¨

#### 1) å¢å¼ºç‰ˆè¿­ä»£å™¨ç®€è¿°

é€šè¿‡ `list.listIterator()` æˆ–è€…`listIterator(int index)`æ¥è·å–ï¼Œæœ¬è´¨éƒ½æ˜¯è¿”å›`new ListItr(index)`å¯¹è±¡ã€‚`ListItr`æ˜¯`Itr`çš„å­ç±»ï¼‰`private class ListItr extends Itr implements ListIterator<E>`ï¼Œæ˜¯å¢å¼ºç‰ˆè¿­ä»£å™¨ã€‚

    ListIterator<String> it = list.listIterator();
    while (it.hasNext()) {
        System.out.println(it.next());
    }
    while (it.hasPrevious()) {
        System.out.println(it.previous());
    }
    

é¢å¤–æ”¯æŒï¼š

*   `hasPrevious()`, `previous()`
    
*   `add(E e)`, `remove()`, `set(E e)`
    
*   `nextIndex()`, `previousIndex()`
    

#### 2) ç¤ºä¾‹ä»£ç 

ååºéå†æ¡ˆä¾‹

    import java.util.ArrayList;
    import java.util.List;
    import java.util.ListIterator;
    
    public class ListIteratorReverseDemo {
        public static void main(String[] args) {
            List<String> list = new ArrayList<>();
            list.add("Dog");
            list.add("Cat");
            list.add("Bird");
            list.add("Fish");
    
            System.out.println("åŸå§‹åˆ—è¡¨: " + list);
    
            ListIterator<String> iterator = list.listIterator(list.size()); // ä»æœ«å°¾å¼€å§‹
    
            while (iterator.hasPrevious()) {
                String animal = iterator.previous();
    
                // æ›¿æ¢å…ƒç´ 
                if (animal.equals("Cat")) {
                    iterator.set("Tiger"); // å°† Cat æ›¿æ¢ä¸º Tiger
                }
    
                // åˆ é™¤å…ƒç´ 
                if (animal.equals("Bird")) {
                    iterator.remove(); // åˆ é™¤ Bird
                }
    
                // åœ¨ Fish å‰æ’å…¥ä¸€ä¸ªå…ƒç´ 
                if (animal.equals("Fish")) {
                    iterator.add("Whale"); // æ’å…¥ Whaleï¼ˆåœ¨ Fish ä¹‹å‰ï¼‰
                }
            }
    
            System.out.println("ä¿®æ”¹åçš„åˆ—è¡¨: " + list);
        }
    }
    

### 6.4. æ—¶é—´å¤æ‚åº¦

*   æ¯ä¸ªè¿­ä»£å™¨çš„ `next()`ã€`hasNext()` æ“ä½œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ **O(1)**ã€‚
    
*   ä½†æ˜¯è‹¥åœ¨ `remove()` ä¸­è§¦å‘ `ArrayList` çš„ `remove(index)`ï¼Œé‚£æ˜¯ **O(n)**ï¼Œå› ä¸ºåé¢çš„å…ƒç´ è¦ç§»åŠ¨ã€‚
    

### 6.5. æ³¨æ„äº‹é¡¹

*   åœ¨ä½¿ç”¨ `for-each` æˆ– `iterator` éå†æ—¶ï¼Œ**ä¸è¦ç›´æ¥ä¿®æ”¹åŸå§‹é›†åˆ**ï¼ˆå¦‚è°ƒç”¨ `add()`ã€`remove()`ï¼‰ï¼Œå¦åˆ™ä¼šæŠ›å‡º `ConcurrentModificationException`ã€‚
    
*   å¦‚æœéœ€è¦åœ¨éå†ä¸­å®‰å…¨åœ°ä¿®æ”¹é›†åˆï¼Œå¯ä»¥ä½¿ç”¨ **`ListIterator` çš„ `remove()` æˆ– `add()` æ–¹æ³•**ï¼Œå®ƒæ˜¯æ”¯æŒä¿®æ”¹çš„ã€‚
    

7\. çº¿ç¨‹å®‰å…¨é—®é¢˜
----------

`ArrayList`æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚

ä¸¾ä¸ªä¾‹å­

    List<Integer> list = new ArrayList<>();
    
    Runnable task = () -> {
        for (int i = 0; i < 1000; i++) {
            list.add(i);  // éçº¿ç¨‹å®‰å…¨
        }
    };
    
    Thread t1 = new Thread(task);
    Thread t2 = new Thread(task);
    
    t1.start();
    t2.start();
    t1.join();
    t2.join();
    
    System.out.println("æœ€ç»ˆå¤§å°: " + list.size()); // ä¸ä¸€å®šæ˜¯ 2000
    

ä¸è¿‡åªæœ‰ `ArrayList` ä½œä¸º**å…±äº«å˜é‡**æ—¶ï¼Œæ‰éœ€è¦**è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜**ï¼Œå½“ `ArrayList` é›†åˆä½œä¸ºæ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ—¶ï¼Œæ— éœ€è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚

### è§£å†³å®‰å…¨é—®é¢˜çš„ä¸€äº›æ–¹æ³•

ç±»æ³¨é‡Šä¸­æ¨èæˆ‘ä»¬ä½¿ç”¨ `Collections#synchronizedList` æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ŒSynchronizedList æ˜¯é€šè¿‡åœ¨æ¯ä¸ªæ–¹æ³•ä¸Šé¢åŠ ä¸Šé”æ¥å®ç°ï¼Œè™½ç„¶å®ç°äº†çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½å¤§å¤§é™ä½ã€‚

ä½¿ç”¨æ–¹å¼

    List<Integer> syncList = Collections.synchronizedList(new ArrayList<>());
    // éå†æ—¶æ‰‹åŠ¨åŠ é”
    synchronized(syncList) {
        for (Integer i : syncList) {
            // å®‰å…¨éå†
        }
    }
    

ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªé›†åˆï¼š`CopyOnWriteArrayList`ï¼ˆæ¨èç”¨äºè¯»å¤šå†™å°‘ï¼‰

    List<String> cowList = new CopyOnWriteArrayList<>();
    

ç‰¹æ€§ï¼š

*   æ‰€æœ‰å†™æ“ä½œï¼ˆadd/remove/setï¼‰éƒ½ä¼šå¤åˆ¶ä¸€ä»½æ•°ç»„å†ä¿®æ”¹ï¼›
    
*   ä¸ä¼šæŠ›å‡º `ConcurrentModificationException`ï¼›
    
*   éå¸¸é€‚åˆ**è¯»å¤šå†™å°‘**çš„åœºæ™¯ã€‚
    

ç¼ºç‚¹ï¼š

*   å†™æ“ä½œå¼€é”€å¤§ï¼Œæ€§èƒ½æ¯” `ArrayList` å·®å¾ˆå¤šã€‚

8\. æ—¶é—´å¤æ‚åº¦æ±‡æ€»
-----------

æ“ä½œ

æ—¶é—´å¤æ‚åº¦

å¤‡æ³¨

æ’å…¥å…ƒç´ 

O(1)ï¼Œæ‰©å®¹**å•æ¬¡**ä¸º O(n)

`add(E)`

éšæœºæ’å…¥

O(n)ï¼Œå…ƒç´ æ‹·è´

`add(index,E)`

æŒ‡å®šç´¢å¼•åˆ é™¤

O(n)ï¼ŒæŒ‡å®šç´¢å¼•åˆ é™¤

`remove(index)`

æŒ‡å®šå¯¹è±¡å€¼åˆ é™¤

O(n)ï¼ŒæŸ¥æ‰¾ + ç§»åŠ¨

`remove(Object)`

æŒ‡å®šç´¢å¼•ä¿®æ”¹

O(1)

`set(index,E)`

è·å–å…ƒç´ 

O(1)

`get(index)`

æ£€ç´¢å…ƒç´ 

éƒ½ä¸º`O(n)`

`indexOf(Object)`/Â `lastIndexOf(Object)`

9\. æ€»ç»“
------

åœ¨ä½¿ç”¨ArrayListé›†åˆæ—¶ï¼Œéœ€è¦å…³æ³¨ä»¥ä¸‹ç‰¹æ€§ï¼šéšæœºè·å–/ä¿®æ”¹å¿«ã€æ’å…¥/åˆ é™¤æ…¢ã€æ‰©å®¹æ€§èƒ½é—®é¢˜ã€å¹¶å‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

å…³äºå…ƒç´ æ’å…¥ã€æ£€ç´¢ã€ä¿®æ”¹ã€åˆ é™¤ã€æ‰©å®¹è¿‡ç¨‹ç­‰æ“ä½œè¿‡ç¨‹ï¼Œå®Œæ•´çš„è§†é¢‘é“¾æ¥ï¼š[https://www.bilibili.com/video/BV1KET2zGEm4/](https://www.bilibili.com/video/BV1KET2zGEm4/)

![image](https://img2024.cnblogs.com/blog/1209017/202506/1209017-20250608124619317-1056953506.gif)

[æŒæ¡è®¾è®¡æ¨¡å¼çš„ä¸¤ä¸ªç§˜ç±](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247486720&idx=1&sn=739bdfc99dc52128f9d9eb31a70a4c03&scene=21#wechat_redirect)

æŸ¥çœ‹å¾€æœŸè®¾è®¡æ¨¡å¼æ–‡ç« çš„ï¼š[è®¾è®¡æ¨¡å¼](https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5NDM5NDM1NA==&action=getalbum&album_id=3572346739375538182#wechat_redirect)

[è¶…å®ç”¨çš„SpringAOPå®æˆ˜ä¹‹æ—¥å¿—è®°å½•](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247486066&idx=1&sn=e8c7423105ddd0562f50892010941efc&scene=21#wechat_redirect)

[2023å¹´ä¸‹åŠå¹´è½¯è€ƒè€ƒè¯•é‡ç£…æ¶ˆæ¯](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247485873&idx=1&sn=08b58de61c716e5c57ff2fddb947f0d8&scene=21#wechat_redirect)

[é€šè¿‡è½¯è€ƒåå´é¢†å–ä¸åˆ°å®ä½“è¯ä¹¦ï¼Ÿ](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247485909&idx=1&sn=e20f3b7b413310ca78f90c13305972ab&scene=21#wechat_redirect)

[è®¡ç®—æœºç®—æ³•è®¾è®¡ä¸åˆ†æï¼ˆç¬¬5ç‰ˆï¼‰](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247485802&idx=1&sn=863cf239124b98d39ec551b6cb67845c&scene=21#wechat_redirect)

[Javaå…¨æ ˆå­¦ä¹ è·¯çº¿ã€å­¦ä¹ èµ„æºå’Œé¢è¯•é¢˜ä¸€æ¡é¾™](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247485015&idx=1&sn=862bc2b379726b89cdb396ec0d325cc0&scene=21#wechat_redirect)

[è½¯è€ƒè¯ä¹¦=èŒç§°è¯ä¹¦ï¼Ÿ](http://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247485956&idx=1&sn=57407d9f7921254ba19ed70fa3bd6a2d&chksm=ec62ca99db15438f13f2cf96d17a3e282028fa7960af56126caec68fb6eafd46d6e04a10ad0c&scene=21#wechat_redirect)

[è½¯è€ƒä¸­çº§--è½¯ä»¶è®¾è®¡å¸ˆæ¯«æ— ä¿ç•™çš„å¤‡è€ƒåˆ†äº«](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247485837&idx=1&sn=b9b17dfd252882468b8eea31012df6fc&scene=21#wechat_redirect)

è§‰å¾—è¿˜ä¸é”™çš„ï¼Œä¸‰è¿æ”¯æŒï¼šç‚¹èµã€åˆ†äº«ã€æ¨èâ†“