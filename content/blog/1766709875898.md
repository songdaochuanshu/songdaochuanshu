---
layout: post
title: 'å‘Šåˆ«â€œè£¸å¥”â€ä»£ç ï¼šç”¨ Pydantic è®©ä½ çš„ Python æ•°æ®å›ºè‹¥é‡‘æ±¤'
date: "2025-12-26T00:44:35Z"
---
å‘Šåˆ«â€œè£¸å¥”â€ä»£ç ï¼šç”¨ Pydantic è®©ä½ çš„ Python æ•°æ®å›ºè‹¥é‡‘æ±¤
=====================================

### 1\. å¼•è¨€ï¼šç”±â€œä¿¡ä»»â€å¼•å‘çš„è¡€æ¡ˆ

ä½œä¸º Python å¼€å‘è€…ï¼Œä½ ä¸€å®šç»å†è¿‡è¿™æ ·çš„**è‡³æš—æ—¶åˆ»**ï¼š

ä½ æ­£åœ¨å†™ä¸€ä¸ªå¤„ç†åç«¯ API æ•°æ®çš„è„šæœ¬ã€‚åç«¯å‘Šè¯‰ä½ ï¼šâ€œæ”¾å¿ƒï¼Œæˆ‘ä¼šä¼ ç»™ä½ ä¸€ä¸ªåŒ…å«ç”¨æˆ· ID å’Œå¹´é¾„çš„ JSONã€‚â€ äºæ˜¯ä½ è‡ªä¿¡åœ°å†™ä¸‹ï¼š

Python

    def process_user(data):
        # ç›´æ¥è£¸è¯»å­—å…¸
        user_id = data['id'] 
        age = data['age'] + 1
        print(f"ç”¨æˆ· {user_id} æ˜å¹´ {age} å²")

ä»£ç ä¸Šçº¿ç¬¬ä¸€å¤©ï¼Œå´©æºƒäº†ã€‚

*   **æƒ…å†µ A**ï¼šåç«¯æ‰‹æ»‘ï¼Œä¼ å›äº† `{"id": "1001", "age": "25"}`ï¼ˆå…¨æ˜¯å­—ç¬¦ä¸²ï¼‰ã€‚ä½ çš„ä»£ç æŠ¥é”™ï¼š`TypeError`ï¼Œå› ä¸ºå­—ç¬¦ä¸²ä¸èƒ½åŠ  1ã€‚
    
*   **æƒ…å†µ B**ï¼šåç«¯æ”¹äº†é€»è¾‘ï¼Œ`age` å­—æ®µä¸¢å¤±äº†ã€‚ä½ çš„ä»£ç æŠ¥é”™ï¼š`KeyError: 'age'`ã€‚
    
*   **æƒ…å†µ C**ï¼š`id` å±…ç„¶æ˜¯ä¸ª `null`...
    

ä¸ºäº†é˜²å¾¡è¿™äº›æƒ…å†µï¼Œä½ çš„ä»£ç å˜æˆäº†è¿™æ ·ï¼š

Python

    if 'age' in data and data['age'] is not None and isinstance(data['age'], int):
        # ...æ— æ•°çš„ if-else é˜²å¾¡æ€§ä»£ç ...

è¿™ä¸ä»…ä¸‘é™‹ï¼Œè€Œä¸”éš¾ä»¥ç»´æŠ¤ã€‚**è¿™å°±æ˜¯â€œæ•°æ®è£¸å¥”â€çš„ä»£ä»·ã€‚**

**Pydantic çš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†ç»ˆç»“è¿™åœºå™©æ¢¦ã€‚** å®ƒåˆ©ç”¨ Python åŸç”Ÿçš„ç±»å‹æç¤ºï¼ˆType Hintsï¼‰ï¼Œåœ¨è¿è¡Œæ—¶å¸®ä½ è‡ªåŠ¨å®Œæˆ**æ•°æ®æ ¡éªŒï¼ˆValidationï¼‰å’Œç±»å‹è½¬æ¢ï¼ˆParsingï¼‰**ã€‚

### 2\. æ¦‚å¿µæ‹†è§£ï¼šå®ƒä¸ä»…ä»…æ˜¯æ ¡éªŒï¼Œå®ƒæ˜¯â€œæ™ºèƒ½æ¨¡å…·â€

å¾ˆå¤šæ–°æ‰‹è¯¯ä»¥ä¸º Pydantic åªæ˜¯ä¸€ä¸ªâ€œæŠ¥é”™æœºå™¨â€ï¼ˆä¸€æ—¦æ•°æ®ä¸å¯¹å°±æŠ¥é”™ï¼‰ã€‚å…¶å®ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ª\*\*â€œå…·æœ‰çº é”™èƒ½åŠ›çš„æ™ºèƒ½æ¨¡å…·â€\*\*ã€‚

#### ğŸ’¡ ç”Ÿæ´»åŒ–ç±»æ¯”ï¼šå·¥å‚æµæ°´çº¿ä¸Šçš„â€œæ™ºèƒ½æ•´å½¢æœºâ€

æƒ³è±¡ä½ åœ¨ç»è¥ä¸€å®¶åˆ¶ä½œ**ä¹é«˜ç§¯æœ¨**çš„å·¥å‚ã€‚

1.  **æ™®é€š Python å­—å…¸**å°±åƒä¸€ä¸ª**åƒåœ¾è¢‹**ã€‚ä½ å¯ä»¥å¾€é‡Œé¢æ‰”ä»»ä½•ä¸œè¥¿ï¼šæ­£æ–¹å½¢çš„ç§¯æœ¨ã€åœ†å½¢çš„çƒã€ç”šè‡³åŠä¸ªè‹¹æœã€‚å½“ä½ ä¼¸æ‰‹è¿›å»æ‹¿çš„æ—¶å€™ï¼Œä½ æ ¹æœ¬ä¸çŸ¥é“ä¼šæ‘¸åˆ°ä»€ä¹ˆã€‚
    
2.  **Pydantic æ¨¡å‹**å°±åƒä¸€ä¸ª**ç²¾å¯†é’¢æ¨¡å…·**ã€‚
    
    *   ä½ å®šä¹‰äº†è¿™ä¸ªæ¨¡å…·åªèƒ½ç”Ÿäº§â€œæ­£æ–¹å½¢â€çš„å¡‘æ–™ã€‚
        
    *   **è¾“å…¥ï¼ˆParsing/Coercionï¼‰**ï¼šå¦‚æœä½ å€’è¿›æ¥çš„æ˜¯æ¶²æ€å¡‘æ–™ï¼ˆåŸå§‹æ•°æ®ï¼‰ï¼Œæ¨¡å…·ä¼šæŠŠå®ƒå‹æˆæ­£æ–¹å½¢ã€‚å¦‚æœä½ å¡è¿›æ¥ä¸€ä¸ªç¨å¾®æœ‰ç‚¹æ­ªçš„è½¯æ³¥ï¼ˆæ¯”å¦‚å­—ç¬¦ä¸² `"123"`ï¼‰ï¼Œæ¨¡å…·ä¼šå°è¯•æŠŠå®ƒä¿®æ­£ä¸ºå®Œç¾çš„æ­£æ–¹å½¢ï¼ˆæ•´æ•° `123`ï¼‰ã€‚
        
    *   **æ‹’ç»ï¼ˆValidationï¼‰**ï¼šå¦‚æœä½ è¯•å›¾æŠŠä¸€å—çŸ³å¤´ï¼ˆå®Œå…¨ä¸å…¼å®¹çš„æ•°æ®ï¼‰å¡è¿›å»ï¼Œæ¨¡å…·ä¼šç«‹åˆ»å‘å‡ºçº¢è‰²è­¦æŠ¥ï¼ˆæŠ›å‡ºé”™è¯¯ï¼‰ï¼Œæ‹’ç»ç”Ÿäº§æ¬¡å“ã€‚
        

**æ ¸å¿ƒé€»è¾‘ï¼š** Pydantic å…³æ³¨çš„ä¸æ˜¯â€œæ•°æ®é•¿ä»€ä¹ˆæ ·â€ï¼Œè€Œæ˜¯â€œæ•°æ®**åº”è¯¥**é•¿ä»€ä¹ˆæ ·â€ã€‚

### 3\. åŠ¨æ‰‹å®æˆ˜ï¼šä» 0 åˆ° 1 æŒæ¡ Pydantic

è®©æˆ‘ä»¬æ‰”æ‰é‚£äº›å¤æ‚çš„ `if-else`ï¼Œçœ‹çœ‹ Pydantic å¦‚ä½•ä¼˜é›…åœ°å¤„ç†é—®é¢˜ã€‚

é¦–å…ˆå®‰è£…å®ƒï¼š `pip install pydantic`

#### 3.1 Hello Worldï¼šå®šä¹‰ä½ çš„ç¬¬ä¸€ä¸ªæ¨¡å‹

æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ª `User` æ¨¡å‹ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å†™çš„åªæ˜¯æ ‡å‡†çš„ Python ç±»ï¼Œå¹¶ä½¿ç”¨äº†ç±»å‹æç¤ºã€‚

Python

    from pydantic import BaseModel, ValidationError
    from typing import List, Optional
    
    # 1. å®šä¹‰æ¨¡å‹ï¼šç»§æ‰¿è‡ª BaseModel
    class User(BaseModel):
        id: int                # å¿…é¡»æ˜¯æ•´æ•°
        name: str = "Anonymous" # å­—ç¬¦ä¸²ï¼Œä¸”æœ‰é»˜è®¤å€¼
        tags: List[str]        # å¿…é¡»æ˜¯å­—ç¬¦ä¸²åˆ—è¡¨
        age: Optional[int] = None # å¯é€‰çš„æ•´æ•°ï¼Œé»˜è®¤ä¸º None
    
    # --- åœºæ™¯ä¸€ï¼šå®Œç¾æ•°æ® ---
    external_data = {
        "id": 123,
        "name": "Neo",
        "tags": ["admin", "editor"],
        "age": 30
    }
    
    user = User(**external_data)
    print(f"æˆåŠŸåˆ›å»º: {user.name} (ID: {user.id})")
    # è¾“å‡º: æˆåŠŸåˆ›å»º: Neo (ID: 123)

#### 3.2 ä»£ç è§£æï¼šç¥å¥‡çš„â€œè‡ªåŠ¨çº é”™â€

ç°åœ¨ï¼Œæˆ‘ä»¬ç»™å®ƒä¸€ç‚¹â€œè„æ•°æ®â€ï¼Œçœ‹çœ‹ Pydantic æ‰€è°“çš„ **Parsingï¼ˆè§£æ/å¼ºè½¬ï¼‰** èƒ½åŠ›ã€‚

Python

    # --- åœºæ™¯äºŒï¼šè„æ•°æ®æ¸…æ´— ---
    dirty_data = {
        "id": "456",          # æ³¨æ„ï¼šè¿™æ˜¯å­—ç¬¦ä¸² "456"
        "tags": [1, 2],       # æ³¨æ„ï¼šè¿™æ˜¯æ•´æ•°åˆ—è¡¨
        # name ç¼ºå¤±ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ "Anonymous"
        # age ç¼ºå¤±ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ None
    }
    
    try:
        user = User(**dirty_data)
        print("--- è‡ªåŠ¨ä¿®æ­£åçš„æ•°æ® ---")
        print(f"ID ç±»å‹: {type(user.id)} -> å€¼: {user.id}")
        print(f"Tags ç±»å‹: {type(user.tags[0])} -> å€¼: {user.tags}")
        print(f"Name: {user.name}")
        
    except ValidationError as e:
        print(e)

**è¿è¡Œç»“æœï¼š**

Plaintext

    --- è‡ªåŠ¨ä¿®æ­£åçš„æ•°æ® ---
    ID ç±»å‹: <class 'int'> -> å€¼: 456
    Tags ç±»å‹: <class 'str'> -> å€¼: ['1', '2']
    Name: Anonymous

**ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™ï¼Ÿ**

*   **`id`**: å°½ç®¡ä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸² `"456"`ï¼ŒPydantic çœ‹åˆ°æ¨¡å‹å®šä¹‰æ˜¯ `int`ï¼Œå®ƒè‡ªåŠ¨å¸®ä½ è½¬æˆäº†æ•´æ•° `456`ã€‚
    
*   **`tags`**: ä¼ å…¥çš„æ˜¯ `[1, 2]`ï¼Œæ¨¡å‹è¦æ±‚ `List[str]`ï¼Œå®ƒè‡ªåŠ¨æŠŠæ¯ä¸ªå…ƒç´ è½¬æˆäº†å­—ç¬¦ä¸² `['1', '2']`ã€‚
    
*   **çœå¿ƒ**: ä½ ä¸å†éœ€è¦å†™ä»£ç å»è½¬æ¢ç±»å‹ï¼ŒPydantic åœ¨å®ä¾‹åŒ–æ—¶å°±å¸®ä½ åšå¥½äº†ã€‚æ‹¿åˆ° `user` å¯¹è±¡çš„é‚£ä¸€åˆ»ï¼Œä½ å¯ä»¥ 100% ç¡®ä¿¡ `user.id` ç»å¯¹æ˜¯ä¸ªæ•´æ•°ã€‚
    

### 4\. è¿›é˜¶æ·±æ½œï¼šä¸ä»…ä»…æ˜¯ç±»å‹æ£€æŸ¥

Pydantic è¿˜æœ‰æ›´å¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œèƒ½è®©ä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¦‚é±¼å¾—æ°´ã€‚

#### 4.1 è¿™é‡Œçš„é™·é˜±ï¼šParsing vs Validation

æ–°æ‰‹æœ€å®¹æ˜“çŠ¯çš„é”™è¯¯æ˜¯è®¤ä¸º Pydantic ä¼šä¸¥æ ¼æ‹’ç»ç±»å‹ä¸ç¬¦çš„æ•°æ®ã€‚

*   **è¯¯åŒº**ï¼šä»¥ä¸ºä¼  `"123"` ç»™ `int` å­—æ®µä¼šæŠ¥é”™ã€‚
    
*   **çœŸç›¸**ï¼šPydantic ä¼š**ä¼˜å…ˆå°è¯•è½¬æ¢**ã€‚åªæœ‰æ— æ³•è½¬æ¢æ—¶ï¼ˆä¾‹å¦‚æŠŠ `"apple"` ä¼ ç»™ `int`ï¼‰ï¼Œæ‰ä¼šæŠ¥é”™ã€‚
    

#### 4.2 æœ€ä½³å®è·µï¼šä½¿ç”¨ `Field` å’Œ `Validator`

å¦‚æœæˆ‘ä»¬éœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œæ¯”å¦‚â€œå¹´é¾„å¿…é¡»å¤§äº 0â€æˆ–è€…â€œå¯†ç å¿…é¡»åŒ…å«å¤§å†™å­—æ¯â€ï¼Œå•çº¯çš„ç±»å‹æç¤ºå°±ä¸å¤Ÿäº†ã€‚

Python

    from pydantic import BaseModel, Field, field_validator
    
    class AdvancedUser(BaseModel):
        # ä½¿ç”¨ Field é™åˆ¶æ•°å€¼èŒƒå›´
        age: int = Field(gt=0, le=120, description="å¹´é¾„å¿…é¡»åœ¨ 0 åˆ° 120 ä¹‹é—´")
        
        password: str
    
        # è‡ªå®šä¹‰éªŒè¯å™¨ï¼šåƒå†™æ™®é€šå‡½æ•°ä¸€æ ·å†™æ ¡éªŒé€»è¾‘
        @field_validator('password')
        @classmethod
        def check_password_strength(cls, v: str) -> str:
            if len(v) < 8:
                raise ValueError('å¯†ç å¤ªçŸ­å•¦ï¼è‡³å°‘è¦ 8 ä½')
            if 'admin' in v:
                raise ValueError('å¯†ç ä¸èƒ½åŒ…å« admin')
            return v
    
    # æµ‹è¯•
    try:
        u = AdvancedUser(age=150, password="123")
    except ValidationError as e:
        print(e.json()) # Pydantic ä¼šè¿”å›éå¸¸è¯¦ç»†çš„ JSON æ ¼å¼é”™è¯¯æŠ¥å‘Š

**è¾“å‡ºçš„é”™è¯¯æŠ¥å‘Šæ¸…æ™°æ˜äº†ï¼š**

1.  `age`: Input should be less than or equal to 120
    
2.  `password`: å¯†ç å¤ªçŸ­å•¦ï¼è‡³å°‘è¦ 8 ä½
    

#### 4.3 å¯¼å‡ºæ•°æ®

å½“ä½ è¦æŠŠå¤„ç†å¥½çš„æ•°æ®å­˜å…¥æ•°æ®åº“æˆ–å‘å›å‰ç«¯æ—¶ï¼ŒPydantic æä¾›äº†æåº¦æ–¹ä¾¿çš„æ–¹æ³•ï¼š

Python

    # è½¬æˆå­—å…¸
    print(user.model_dump()) 
    # è½¬æˆ JSON å­—ç¬¦ä¸²
    print(user.model_dump_json())

### 5\. æ€»ç»“ä¸å»¶ä¼¸

**ä¸€å¥è¯æ€»ç»“ï¼š** Pydantic æ˜¯ Python ä¸–ç•Œçš„â€œå®‰æ£€å‘˜â€ï¼Œå®ƒåˆ©ç”¨ç±»å‹æç¤ºå°†ä¸å¯é çš„è¾“å…¥æ•°æ®æ¸…æ´—ä¸ºä¸¥æ ¼çš„ã€ç±»å‹å®‰å…¨çš„å¯¹è±¡ï¼Œè®©ä½ åœ¨åç»­å¼€å‘ä¸­å½»åº•å‘Šåˆ« `KeyError` å’Œç±»å‹æ··æ·†ã€‚

**ç»™ä½ çš„å°ä½œä¸šï¼š** æ—¢ç„¶ä½ å·²ç»æŒæ¡äº†åŸºç¡€ï¼Œè¯·å°è¯•å®šä¹‰ä¸€ä¸ª**åµŒå¥—æ¨¡å‹**ï¼š

1.  åˆ›å»ºä¸€ä¸ª `Address` æ¨¡å‹ï¼ˆåŒ…å« `city` å’Œ `zip_code`ï¼‰ã€‚
    
2.  åˆ›å»ºä¸€ä¸ª `Employee` æ¨¡å‹ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå­—æ®µ `address`ï¼Œç±»å‹æ˜¯ `Address`ã€‚
    
3.  å°è¯•ä¼ å…¥ä¸€ä¸ªåµŒå¥—çš„å­—å…¸æ•°æ®ï¼Œçœ‹çœ‹ Pydantic æ˜¯å¦èƒ½è‡ªåŠ¨è§£ææ·±å±‚çš„ç»“æ„ã€‚