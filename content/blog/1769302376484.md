---
layout: post
title: 'MAF快速入门（13）常见智能体编排模式'
date: "2026-01-25T00:52:56Z"
---
MAF快速入门（13）常见智能体编排模式
====================

![MAF快速入门（13）常见智能体编排模式](https://img2024.cnblogs.com/blog/381412/202601/381412-20260124195158983-724601081.png) 事实上，在构建AI应用解决业务问题时，单个Agent往往无法胜任所有任务，常常需要我们将多个Agent组合起来系统工作。而这种组合与协调的方式，就被称为 Agent Orchestration 即 Agent编排。MAF支持多种多Agent编排流程模式，每个模式都针对不同的协作方案而设计。

大家好，我是Edison。

最近我一直在跟着圣杰的《[.NET+AI智能体开发进阶](https://mp.weixin.qq.com/s?__biz=MzA4NzQzNTg4Ng==&mid=2651744458&idx=1&sn=139f7584e81aeecd0945133bdc2b4791&scene=21#wechat_redirect)》课程学习MAF开发多智能体工作流，我强烈推荐你也上车跟我一起出发！

[上一篇](https://www.cnblogs.com/edisontalk/p/-/quick-start-on-maf-chatper12)，我们学习了MAF中如何进行子工作流。本篇，我们来了解下在MAF中如何快速实现一些常见的智能体编排模式。

**1 智能体编排模式介绍**
===============

传统的单Agent系统在处理复杂多面任务的能力方面受到较多限制，因此我们会有多Agent编排协作完成任务的需求。

![image](https://img2024.cnblogs.com/blog/381412/202601/381412-20260124091613961-245103765.png)

事实上，在构建AI应用解决业务问题时，单个Agent往往无法胜任所有任务，常常需要我们将多个Agent组合起来系统工作。而这种组合与协调的方式，就被称为 **Agent Orchestration** 即 Agent编排。

MAF支持多种多Agent编排流程模式，每个模式都针对不同的协作方案而设计。这些模式作为框架的一部分提供出来，我们可以自己扩展。

在MAF中，常见的Agent编排模式如下：

*   Sequential 顺序编排：即各个Agent依次处理并传递给下一个Agent执行；
*   Concurrent 并发编排：即多个Agent并行处理同一个任务，然后汇聚结果；
*   Handoffs 移交编排：即每个Agent都可以将对话移交给另一个Agent，确保每个Agent处理任务的某个部分；
*   GroupChat 群聊编排：即多个Agent加入了同一个微信群，通过群聊对话形成一些决策；

对应到MAF中，AgentWorkflowBuilder 类提供了这些编排模式的具体实现，我们开发者可以直接使用对应的接口即可快速完成有一次编排 而无需 自行实现Edge连接。

**2 **智能体编排模式详解****
===================

### **2.1 顺序编排**

在顺序编排模式中，各个Agent被组成一个流程，每个Agent都会处理任务，并将执行结果输出传递给下一个待执行的Agent。可以看出，对于每个基于上一步骤构建的工作流（Workflow）来说，这是比较适合的模式。

![image](https://img2024.cnblogs.com/blog/381412/202601/381412-20260124091657384-365298595.png)

目前，像文档审阅、工作流、数据处理管道、多阶段推理等，是比较常见的应用场景。

下面的代码展示了在MAF中的顺序编排实现：

var analyst = new ChatClientAgent(...);
var writer = new ChatClientAgent(...);
var editor = new ChatClientAgent(...);
// Build a Workflow
var workflow = AgentWorkflowBuilder.BuildSequential(
    "content-team-workflow", 
    \[analyst, writer, editor\]);
// Test the Workflow
......

可以看到，通过BuildSequential方法即可快速完成一次顺序编排。

### 2.2 并发编排

并发模式使用多个Agent并行处理同一个任务，每个Agent都可以独立处理输入，并收集并聚合结果。

![image](https://img2024.cnblogs.com/blog/381412/202601/381412-20260124194638071-182220484.png)

此模式比较适合多种观点或解决方案很有价值的场景，比如集思广益、群体推理以及其他投票系统。

下面的代码展示了在MAF中的代码实现：

// Step1. Create Agents
var sensitiveWordAgent = new ChatClientAgent(...);
var adDetectionAgent = new ChatClientAgent(...);
var sentimentAgent = new ChatClientAgent(...);

// Step2. Build a Workflow
var workflow = AgentWorkflowBuilder.BuildConcurrent(
    agents: new\[\] { sensitiveWordAgent, adDetectionAgent, sentimentAgent },
    aggregator: auditAggregator
);

// Step3. Test the workflow
......

### 2.3 移交编排

在移交（也可以叫做交接）编排模式中，允许各个Agent根据上下文或用户请求相互转移控制权，每个Agent都可以通过适当的专业知识将对话“移交”给另一个Agent，确保每个Agent处理任务的某个指定部分。

![image](https://img2024.cnblogs.com/blog/381412/202601/381412-20260124194802065-1054226946.png)

这种模式非常适合于客户支持（客服）、专家系统或需要动态委派类型的任务场景。

下面的代码展示了在MAF的代码实现：

// Step1. Create Agents
var triageAgent = new ChatClientAgent(...);
var historyTutor = new ChatClientAgent(...);
var mathTutor = new ChatClientAgent(...);
// Step2. Build a Workflow
var workflow = AgentWorkflowBuilder.CreateHandoffBuilderWith(triageAgent)
    .WithHandoffs(triageAgent, \[mathTutor, historyTutor\]) // Triage can route to either specialist
    .WithHandoffs(\[mathTutor, historyTutor\], triageAgent) // Math or History tutor can return to triage
    .Build();
// Step3. Test the workflow
.....

### 2.4 群聊编排

在群聊编排模式中，各个Agent就像加入了一个微信群，由群管理员协调进行群聊对话。这种模式非常适合于模拟会议、辩论或协作解决问题的会议类型场景。

下图展示了一个讨论业务建议的用例，由一个Chat Manager负责主持对话，依次让三个参与对话的Agent进行建议发表。这个Chat Manager就像是群管理员，它不仅负责主持对话，也会在必要时引入人工干预。

![image](https://img2024.cnblogs.com/blog/381412/202601/381412-20260124194919639-675664209.png)

下面的代码展示了在MAF的代码实现：

// Step1. Create Agents
var researchAgent = new ChatClientAgent(...);
var writerAgent = new ChatClientAgent(...);
var criticAgent = new ChatClientAgent(...);
// Step2. Build a Workflow
var workflow = AgentWorkflowBuilder.CreateGroupChatBuilderWith(
  agents \=> new RoundRobinGropuChatManager(agents))
      .AddParticipants(researchAgent, writerAgent, criticAgent)
      .Build();
// Step3. Test the workflow
.....

**3 小结**
========

本文介绍了MAF中常见的Agent编排模式，并详细介绍了顺序编排、并发编排、移交编排 和 群聊编排 的适用场景 和 代码实现。

这几种模式的对比分析如下：

![image](https://img2024.cnblogs.com/blog/381412/202601/381412-20260124195004594-1977355623.png)

示例源码
====

GitHub: [https://github.com/EdisonTalk/MAFD](https://github.com/EdisonTalk/MAFD)

参考资料
====

圣杰，《[.NET + AI 智能体开发进阶](https://www.cnblogs.com/sheng-jie/p/19200934)》（推荐指数：★★★★★）

Microsoft Learn，《[Agent Framework Tutorials](https://learn.microsoft.com/en-us/agent-framework/overview/agent-framework-overview?wt.mc_id=MVP_397012)》

![](https://images.cnblogs.com/cnblogs_com/edisonchou/1647700/o_200902144330EdisonTalk-Footer.jpg)

作者：爱迪生

出处：[https://edisontalk.cnblogs.com](https://edisontalk.cnblogs.com "from")

本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文链接。

[![](http://service.t.sina.com.cn/widget/qmd/2068032061/d643d182/10.png)](https://weibo.com/u/2068032061?s=6uyXnP)