---
layout: post
title: 'ã€æ¸²æŸ“æµæ°´çº¿ã€‘[é€ç‰‡å…ƒé˜¶æ®µ]-[æ¨¡ç‰ˆæµ‹è¯•]ä»¥UnityURPä¸ºä¾‹'
date: "2025-08-23T00:39:21Z"
---
ã€æ¸²æŸ“æµæ°´çº¿ã€‘\[é€ç‰‡å…ƒé˜¶æ®µ\]-\[æ¨¡ç‰ˆæµ‹è¯•\]ä»¥UnityURPä¸ºä¾‹
====================================

![ã€æ¸²æŸ“æµæ°´çº¿ã€‘[é€ç‰‡å…ƒé˜¶æ®µ]-[æ¨¡ç‰ˆæµ‹è¯•]ä»¥UnityURPä¸ºä¾‹](https://img2024.cnblogs.com/blog/3685400/202508/3685400-20250822100603425-59860274.png) æœ¬æ–‡ä»‹ç»äº†Unity URPä¸­æ¨¡æ¿ç¼“å†²åŒºçš„ä½¿ç”¨ï¼Œé€šè¿‡8ä½æ•´æ•°/åƒç´ å®ç°ç²¾ç¡®åƒç´ æ§åˆ¶ã€‚è¯¦ç»†è§£æäº†æ¨¡æ¿æµ‹è¯•æµç¨‹ï¼šåŒ…æ‹¬ç¼“å†²åŒºåˆå§‹åŒ–ã€æµ‹è¯•é˜¶æ®µæ¯”è¾ƒå‡½æ•°ï¼ˆå¦‚Alwaysã€Equalç­‰ï¼‰å’Œç¼“å†²æ“ä½œï¼ˆå¦‚Replaceã€Incrç­‰ï¼‰ã€‚æä¾›äº†ä¸¤ä¸ªå®ç”¨æ¡ˆä¾‹ï¼š1ï¼‰ä½¿ç”¨æ¨¡æ¿ç¼“å†²åŒºå®ç°åŒºåŸŸé®ç½©æ•ˆæœï¼›2ï¼‰å®ç°è§’è‰²å¤–è½®å»“æè¾¹æ•ˆæœï¼Œå…¶ä¸­ç¬¬äºŒä¸ªæ¡ˆä¾‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡åŒPassï¼ˆè§’è‰²æ¸²æŸ“+è½®å»“æ‰©å±•ï¼‰é…åˆæ¨¡æ¿æµ‹è¯•å®ç°ä¸“ä¸šçº§æè¾¹æ•ˆæœã€‚æ–‡ç« é‡‡ç”¨Shaderä»£ç å’Œæ³¨é‡Šç»“åˆçš„æ–¹å¼ï¼Œæ¸…æ™°å‘ˆç°äº†URPç®¡çº¿ä¸­æ¨¡æ¿ç¼“å†²çš„æŠ€æœ¯å®ç°ç»†èŠ‚ã€‚

*   ç”¨äºç²¾ç¡®æ§åˆ¶åƒç´ ä¸¢å¼ƒçš„é€ç‰‡å…ƒæ“ä½œï¼Œé€šè¿‡æ¨¡æ¿ç¼“å†²åŒºï¼ˆ8ä½æ•´æ•°/åƒç´ ï¼‰å®ç°å¤æ‚é®ç½©æ•ˆæœã€‚
*   æ”¯æŒ8ç§æ¯”è¾ƒå‡½æ•°å’Œ6ç§ç¼“å†²æ“ä½œâ€Œ
*   å½“å‰æ¨¡ç‰ˆæ“ä½œï¼Œåªèƒ½åœ¨Shaderæ–‡ä»¶ä¸­ä¹¦å†™æ“ä½œï¼ŒShaderGraphä¸­æ— æ³•ç›´æ¥ä½¿ç”¨æ¨¡ç‰ˆæŒ‡ä»¤ã€‚

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

æ ¸å¿ƒé…ç½®é¢„è§ˆ
======

*   æ ¸å¿ƒé…ç½®æ‰€æœ‰é…ç½®åˆ—å‡ºï¼ˆéå…¨å¿…è¦ï¼‰ï¼š

    Stencil {
        Ref 2 // å¿…è¦æ¨¡ç‰ˆæ•°å€¼
        ReadMask 255
        WriteMask 255
        Comp Greater // å¿…è¦æ¯”è¾ƒæ“ä½œç¬¦
        Pass Replace // å¿…è¦é€šè¿‡åçš„æ“ä½œ
        Fail Keep
        ZFail DecrSat
    }
    

â€Œ**1\. æ ¸å¿ƒé…ç½®å‘½ä»¤**â€Œ
----------------

*   `Ref`ï¼šè®¾ç½®å‚è€ƒå€¼(0-255æ•´æ•°)ï¼Œç”¨äºä¸æ¨¡æ¿ç¼“å†²åŒºæ¯”è¾ƒ
*   `ReadMask`ï¼šè¯»å–æ©ç (0-255)ï¼ŒæŒ‰ä½ä¸æ“ä½œåæ¯”è¾ƒï¼ˆé»˜è®¤255ï¼‰
*   `WriteMask`ï¼šå†™å…¥æ©ç (0-255)ï¼Œæ§åˆ¶å¯ä¿®æ”¹çš„ç¼“å†²åŒºä½ï¼ˆé»˜è®¤255ï¼‰

â€Œ**2\. æ¯”è¾ƒå‡½æ•°å‘½ä»¤**â€Œ
----------------

`Comp`æ”¯æŒä»¥ä¸‹æšä¸¾å€¼ï¼š

*   `Always`/`Never`ï¼šå§‹ç»ˆé€šè¿‡/æ‹’ç»
*   `Less`/`Greater`ï¼šå°äº/å¤§äºæ—¶é€šè¿‡
*   `Equal`/`NotEqual`ï¼šç­‰äº/ä¸ç­‰äºæ—¶é€šè¿‡
*   `LessEqual`/`GreaterEqual`ï¼šå°äºç­‰äº/å¤§äºç­‰äºæ—¶é€šè¿‡

â€Œ**3\. æ“ä½œå‘½ä»¤**â€Œ
--------------

`Pass`/`Fail`/`ZFail`æ”¯æŒçš„æ“ä½œï¼š

*   `Keep`ï¼šä¿æŒåŸå€¼
*   `Zero`ï¼šç½®é›¶
*   `Replace`ï¼šç”¨Refå€¼æ›¿æ¢
*   `IncrSat`/`DecrSat`ï¼šé¥±å’Œå¢å‡ï¼ˆ0/255è¾¹ç•Œï¼‰
*   `IncrWrap`/`DecrWrap`ï¼šå¾ªç¯å¢å‡
*   `Invert`ï¼šæŒ‰ä½å–å

**æ¨¡æ¿æµ‹è¯•å…·ä½“è¿‡ç¨‹â€Œ**
=============

1.  â€Œ**ç¼“å†²åŒºåˆå§‹åŒ–**â€Œ
    
    *   æ¸…é™¤æ¨¡æ¿ç¼“å†²ï¼š`GL.Clear(ClearBufferMask.StencilBufferBit)`
    *   è®¾ç½®åˆå§‹å€¼ï¼š`GL.StencilMask(0xFF)`ï¼ˆé»˜è®¤å…¨255ï¼‰
2.  â€Œ**æµ‹è¯•é˜¶æ®µ-é€ç‰‡å…ƒ**â€Œ
    
        plaintext
        if (ç‰‡å…ƒæ¨¡æ¿å€¼ [æ¯”è¾ƒå‡½æ•°] å‚è€ƒå€¼) {
            æ‰§è¡Œé€šè¿‡æ“ä½œï¼ˆå¦‚ä¿ç•™åƒç´ ï¼‰
        } else {
            æ‰§è¡Œå¤±è´¥æ“ä½œï¼ˆå¦‚ä¸¢å¼ƒåƒç´ ï¼‰
        }
        
    
3.  â€Œ**ç¼“å†²æ›´æ–°**â€Œ
    
    *   æ ¹æ®æµ‹è¯•ç»“æœä¿®æ”¹æ¨¡æ¿ç¼“å†²å€¼ï¼ˆå¯é€‰ï¼‰

**â€Œæ¯”è¾ƒå‡½æ•°ï¼ˆStencilFuncï¼‰â€Œ**
=======================

å‡½æ•°

å«ä¹‰

OpenGLå¸¸é‡

`Never`

æ°¸è¿œä¸é€šè¿‡

`GL_NEVER`

`Always`

æ°¸è¿œé€šè¿‡

`GL_ALWAYS`

`Less`

æ¨¡æ¿å€¼ < å‚è€ƒå€¼

`GL_LESS`

`LEqual`

æ¨¡æ¿å€¼ â‰¤ å‚è€ƒå€¼

`GL_LEQUAL`

`Greater`

æ¨¡æ¿å€¼ > å‚è€ƒå€¼

`GL_GREATER`

`GEqual`

æ¨¡æ¿å€¼ â‰¥ å‚è€ƒå€¼

`GL_GEQUAL`

`Equal`

æ¨¡æ¿å€¼ == å‚è€ƒå€¼

`GL_EQUAL`

`NotEqual`

æ¨¡æ¿å€¼ != å‚è€ƒå€¼

`GL_NOTEQUAL`

**â€Œç¼“å†²æ“ä½œï¼ˆStencilOpï¼‰â€Œ**
=====================

æ“ä½œç»„åˆ

å«ä¹‰

`Keep`

ä¿æŒå½“å‰æ¨¡æ¿å€¼ä¸å˜ï¼ˆé»˜è®¤ï¼‰

`Zero`

å°†æ¨¡æ¿å€¼è®¾ä¸º0

`Replace`

ç”¨å‚è€ƒå€¼æ›¿æ¢æ¨¡æ¿å€¼

`Incr`/`IncrWrap`

æ¨¡æ¿å€¼+1ï¼ˆè¶…è¿‡255æ—¶ï¼Œå‰è€…æˆªæ–­åè€…å¾ªç¯ï¼‰

`Decr`/`DecrWrap`

æ¨¡æ¿å€¼-1ï¼ˆä½äº0æ—¶ï¼Œå‰è€…æˆªæ–­åè€…å¾ªç¯ï¼‰

`Invert`

æŒ‰ä½å–åï¼ˆ~æ“ä½œï¼‰

ç¤ºä¾‹1
===

*   é®ç½©åŒºåŸŸshader

    Shader "Custom/StencilMask" {
        SubShader {
            Tags { "Queue"="Geometry-1" } // ä¼˜å…ˆæ¸²æŸ“
            ColorMask 0 // ä¸å†™å…¥é¢œè‰²
            ZWrite Off
    
            Stencil {
                Ref 1
                Comp Always
                Pass Replace // å°†æ¨¡æ¿å€¼è®¾ä¸º1
            }
            Pass {} // ç©ºPassä»…ç”¨äºå†™å…¥æ¨¡æ¿
        }
    }
    

*   ç‰©ä½“æ¨¡ç‰ˆæµ‹è¯•shaderï¼Œè¯¥Shaderä»…åœ¨æ¨¡æ¿å€¼ä¸º1çš„åŒºåŸŸå†…æ¸²æŸ“ç‰©ä½“ã€‚

    Shader "Custom/StencilObject" {
        SubShader {
            Stencil {
                Ref 1
                Comp Equal // ä»…æ¸²æŸ“æ¨¡æ¿å€¼=1çš„åŒºåŸŸ
                Pass Keep
            }
            Pass {
                // æ­£å¸¸ç€è‰²ä»£ç ...
            }
        }
    }
    

ç¤ºä¾‹2 å¤–è½®å»“æè¾¹
=========

    Shader "Custom/StencilOutline" {
        Properties {
            _MainTex ("Base Texture", 2D) = "white" {}
            _OutlineColor ("Outline Color", Color) = (1,0,0,1)
            _OutlineWidth ("Outline Width", Range(0, 0.1)) = 0.05
        }
    
        SubShader {
            Tags { 
                "RenderPipeline"="UniversalRenderPipeline"
                "RenderType"="Opaque"
            }
    
            // Pass 1: æ­£å¸¸æ¸²æŸ“è§’è‰²å¹¶å†™å…¥æ¨¡æ¿
            Pass {
                Name "Character"
                Tags
                {
                    "LightMode" = "UniversalForward"
                } 
                Stencil {
                    Ref 1
                    Comp Always
                    Pass Replace
                    ZFail Keep
                }
    
                HLSLPROGRAM
                #pragma vertex vert
                #pragma fragment frag
                #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
    
                struct Attributes {
                    float4 positionOS : POSITION;
                    float2 uv : TEXCOORD0;
                };
    
                struct Varyings {
                    float4 positionCS : SV_POSITION;
                    float2 uv : TEXCOORD0;
                };
    
                TEXTURE2D(_MainTex);
                SAMPLER(sampler_MainTex);
    
                Varyings vert(Attributes IN) {
                    Varyings OUT;
                    OUT.positionCS = TransformObjectToHClip(IN.positionOS.xyz);
                    OUT.uv = IN.uv;
                    return OUT;
                }
    
                half4 frag(Varyings IN) : SV_Target {
                    return SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, IN.uv);
                }
                ENDHLSL
            }
    
            // Pass 2: æ¸²æŸ“è½®å»“
            Pass {
                Name "Outline"
                Cull Front
                Stencil {
                    Ref 1
                    Comp NotEqual
                    Pass Keep
                }
    
                HLSLPROGRAM
                #pragma vertex vert
                #pragma fragment frag
                #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
    
                struct Attributes {
                    float4 positionOS : POSITION;
                    float3 normalOS : NORMAL;
                };
    
                struct Varyings {
                    float4 positionCS : SV_POSITION;
                };
    
                CBUFFER_START(UnityPerMaterial)
                    float4 _OutlineColor;
                    float _OutlineWidth;
                CBUFFER_END
    
                Varyings vert(Attributes IN) {
                    Varyings OUT;
                    float3 posWS = TransformObjectToWorld(IN.positionOS.xyz * (1 + _OutlineWidth));
                    float3 normalWS = TransformObjectToWorldNormal(IN.normalOS);
                    // posWS += normalWS * _OutlineWidth; // æ²¿æ³•çº¿æ–¹å‘æ‰©å±•
                    OUT.positionCS = TransformWorldToHClip(posWS);
                    return OUT;
                }
    
                half4 frag(Varyings IN) : SV_Target {
                    return _OutlineColor;
                }
                ENDHLSL
            }
        }
    }
    

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰