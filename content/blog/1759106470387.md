---
layout: post
title: 'ã€å…‰ç…§ã€‘[PBR][é•œé¢åå°„]å®ç°æ–¹æ³•è§£æ'
date: "2025-09-29T00:41:10Z"
---
ã€å…‰ç…§ã€‘\[PBR\]\[é•œé¢åå°„\]å®ç°æ–¹æ³•è§£æ
=========================

![ã€å…‰ç…§ã€‘[PBR][é•œé¢åå°„]å®ç°æ–¹æ³•è§£æ](https://img2024.cnblogs.com/blog/3685400/202509/3685400-20250928105604192-1100893450.png) æœ¬æ–‡æ·±å…¥è§£æäº†Unity URPä¸­åŸºäºå¾®è¡¨é¢ç†è®ºçš„PBRæ¸²æŸ“å®ç°ã€‚å¾®è¡¨é¢ç†è®ºå°†å®è§‚è¡¨é¢è§†ä¸ºç”±æ— æ•°å¾®è§‚å‡ ä½•ç»†èŠ‚ç»„æˆçš„ç»“æ„ï¼Œé€šè¿‡Cook-Torrance BRDFæ–¹ç¨‹ç²¾ç¡®æ¨¡æ‹Ÿå…‰çº¿äº¤äº’ã€‚æ–‡ç« è¯¦ç»†ä»‹ç»äº†ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼šæ³•çº¿åˆ†å¸ƒå‡½æ•°ï¼ˆNDFï¼‰ä½¿ç”¨GGXåˆ†å¸ƒæè¿°å¾®è§‚æœå‘ï¼Œå‡ ä½•é®è”½å‡½æ•°æ¨¡æ‹Ÿè‡ªé˜´å½±æ•ˆåº”ï¼Œè²æ¶…å°”æ–¹ç¨‹å¤„ç†è§†è§’ç›¸å…³çš„åå°„å˜åŒ–ã€‚åŒæ—¶å¯¹æ¯”äº†ä¼ ç»Ÿå…‰ç…§æ¨¡å‹çš„å·®å¼‚ï¼Œå¹¶æä¾›äº†URPä¸­çš„ä¼˜åŒ–å®ç°æ–¹æ¡ˆï¼ŒåŒ…æ‹¬é‡è¦æ€§é‡‡æ ·ã€åˆ†å‰²è¿‘ä¼¼å’Œç§»åŠ¨ç«¯ä¼˜åŒ–æŠ€æœ¯ã€‚æœ€åç»™å‡ºæè´¨è®¾ç½®å’Œæ€§èƒ½ä¼˜åŒ–çš„å®ç”¨å»ºè®®ï¼Œå¸®åŠ©å¼€å‘è€…å®ç°æ›´çœŸå®çš„æ¸²æŸ“æ•ˆæœã€‚

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

**å¾®è¡¨é¢ç†è®ºçš„æ ¸å¿ƒæ¦‚å¿µ**
==============

å¾®è¡¨é¢ç†è®ºæ˜¯ä¸€ç§ç‰©ç†æ¸²æŸ“æ¨¡å‹ï¼Œå®ƒå°†å®è§‚è¡¨é¢è§†ä¸ºç”±æ— æ•°å¾®è§‚å‡ ä½•ç»†èŠ‚ï¼ˆå¾®è¡¨é¢ï¼‰ç»„æˆçš„å¤æ‚ç»“æ„ã€‚è¿™ä¸€ç†è®ºæ˜¯Unity URPä¸­PBRï¼ˆåŸºäºç‰©ç†çš„æ¸²æŸ“ï¼‰å®ç°çš„åŸºç¡€ã€‚

**åŸºæœ¬å‡è®¾**
--------

*   â€Œ**å¾®è§‚ç»“æ„**â€Œï¼š
    *   å®è§‚è¡¨é¢ç”±å¤§é‡éšæœºæ–¹å‘çš„å¾®è§‚å°å¹³é¢ç»„æˆ
    *   æ¯ä¸ªå¾®è¡¨é¢éƒ½æ˜¯å®Œç¾çš„é•œé¢åå°„ä½“
    *   å¾®è¡¨é¢å°ºåº¦å°äºå•ä¸ªåƒç´ ä½†å¤§äºå…‰æ³¢é•¿
*   â€Œ**å®è§‚è¡¨ç°**â€Œï¼š
    *   ç²—ç³™åº¦ï¼šæè¿°å¾®è¡¨é¢æ³•çº¿åˆ†å¸ƒçš„é›†ä¸­ç¨‹åº¦
    *   å…‰æ³½åº¦ï¼šåå°„æ–¹å‘çš„é›†ä¸­ç¨‹åº¦
    *   è²æ¶…å°”æ•ˆåº”ï¼šè§†è§’å˜åŒ–å¯¼è‡´çš„åå°„ç‡å˜åŒ–

**æ ¸å¿ƒæ–¹ç¨‹**
--------

å¾®è¡¨é¢ç†è®ºçš„æ ¸å¿ƒæ˜¯Cook-Torrance BRDFæ–¹ç¨‹ï¼š

$f\_r=\\frac{DFG}{4(Ï‰\_oâ‹…n)(Ï‰\_iâ‹…n)}$

*   å…¶ä¸­ï¼š
    *   Dï¼šæ³•çº¿åˆ†å¸ƒå‡½æ•°ï¼ˆNDFï¼‰
    *   Fï¼šè²æ¶…å°”æ–¹ç¨‹
    *   Gï¼šå‡ ä½•é®è”½å‡½æ•°
    *   $Ï‰\_i$ï¼šå…¥å°„å…‰æ–¹å‘
    *   $Ï‰\_o$ï¼šå‡ºå°„å…‰æ–¹å‘
    *   nï¼šè¡¨é¢æ³•çº¿

**Unity URPä¸­çš„å¾®è¡¨é¢å®ç°**
====================

**1\. æ³•çº¿åˆ†å¸ƒå‡½æ•°ï¼ˆNormal Distribution Function - NDFï¼‰**
--------------------------------------------------

â€Œ**ä½œç”¨**â€Œï¼šæè¿°å¾®è¡¨é¢æ³•çº¿æœå‘çš„æ¦‚ç‡åˆ†å¸ƒ

â€Œ**Unity URPå®ç°**â€Œï¼šTrowbridge-Reitz GGXåˆ†å¸ƒ

    hlsl
    // ä»£ç è·¯å¾„: Packages/com.unity.render-pipelines.universal/ShaderLibrary/BRDF.hlsl
    float D_GGX(float NdotH, float roughness)
    {
        float a = roughness * roughness;
        float a2 = a * a;
        float NdotH2 = NdotH * NdotH;
    
        float denom = NdotH2 * (a2 - 1.0) + 1.0;
        denom = PI * denom * denom;
    
        return a2 / max(denom, 0.000001); // é¿å…é™¤é›¶é”™è¯¯
    }
    

â€Œ**æ•°å­¦å…¬å¼**â€Œï¼š

$D\_{GGX}(h) = \\frac{\\alpha\_g2}{\\pi\[(nÂ·h)2(\\alpha\_g2-1)+1\]2}$

â€Œ**ç‰¹æ€§**â€Œï¼š

*   é«˜å…‰åŒºåŸŸéšç²—ç³™åº¦å¢åŠ è€Œæ‰©æ•£
*   èƒ½é‡å®ˆæ’ï¼Œä¿æŒäº®åº¦ä¸€è‡´
*   é•¿å°¾åˆ†å¸ƒï¼Œæ¨¡æ‹ŸçœŸå®è¡¨é¢æ•£å°„

**2\. å‡ ä½•é®è”½å‡½æ•°ï¼ˆGeometry Function - Gï¼‰**
-------------------------------------

â€Œ**ä½œç”¨**â€Œï¼šæ¨¡æ‹Ÿå¾®è¡¨é¢é—´çš„è‡ªé˜´å½±å’Œé®è”½æ•ˆåº”

â€Œ**Unity URPå®ç°**â€Œï¼šSmithè”åˆSchlick-GGXæ¨¡å‹

    hlsl
    // å‡ ä½•é®è”½é¡¹è®¡ç®—
    float V_SmithGGX(float NdotL, float NdotV, float roughness)
    {
        float a = roughness;
        float a2 = a * a;
    
        float GGXV = NdotL * sqrt(NdotV * NdotV * (1.0 - a2) + a2);
        float GGXL = NdotV * sqrt(NdotL * NdotL * (1.0 - a2) + a2);
    
        return 0.5 / max((GGXV + GGXL), 0.000001);
    }
    

â€Œ**æ•°å­¦å…¬å¼**â€Œï¼š

$G(n,v,l)=G\_1(n,v)â‹…G\_1(n,l)$

å…¶ä¸­ï¼š

$G\_1(n,v)=\\frac{nâ‹…v}{(nâ‹…v)(1âˆ’k)+k},k=\\frac{(Î±+1)}8$

â€Œ**ç‰¹æ€§**â€Œï¼š

*   ç²—ç³™è¡¨é¢è¾¹ç¼˜äº§ç”Ÿæ›´å¤šé˜´å½±
*   æ¨¡æ‹Ÿæ å°„è§’æ—¶çš„å…‰çº¿è¡°å‡
*   ä¿æŒèƒ½é‡å®ˆæ’

**3\. è²æ¶…å°”æ–¹ç¨‹ï¼ˆFresnel Equation - Fï¼‰**
-----------------------------------

â€Œ**ä½œç”¨**â€Œï¼šæè¿°ä¸åŒè§†è§’ä¸‹çš„åå°„ç‡å˜åŒ–

â€Œ**Unity URPå®ç°**â€Œï¼šSchlickè¿‘ä¼¼

    hlsl
    // è²æ¶…å°”é¡¹è®¡ç®—
    float3 F_Schlick(float cosTheta, float3 F0)
    {
        return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);
    }
    

â€Œ**æ•°å­¦å…¬å¼**â€Œï¼š

$F(v,h)=F\_0+(1âˆ’F\_0)(1âˆ’(vâ‹…h))^5$

â€Œ**ç‰¹æ€§**â€Œï¼š

*   F0_F_0Â æ˜¯0åº¦è§’çš„åŸºç¡€åå°„ç‡
*   æ å°„è§’åå°„ç‡æ¥è¿‘100%
*   é‡‘å±ä¸éé‡‘å±æè´¨åå°„ç‰¹æ€§ä¸åŒ

**URPä¸­çš„å®Œæ•´å¾®è¡¨é¢BRDFå®ç°**
====================

Unity URPä¸­çš„é•œé¢åå°„è®¡ç®—åœ¨`BRDF.hlsl`æ–‡ä»¶ä¸­å®ç°ï¼š

    hlsl
    // å®Œæ•´é•œé¢åå°„BRDFè®¡ç®—
    float3 BRDF_Specular(float3 F0, float roughness, float NdotH, float NdotL, float NdotV, float LdotH)
    {
        // 1. è®¡ç®—æ³•çº¿åˆ†å¸ƒ
        float D = D_GGX(NdotH, roughness);
    
        // 2. è®¡ç®—å‡ ä½•é®è”½
        float V = V_SmithGGX(NdotL, NdotV, roughness);
    
        // 3. è®¡ç®—è²æ¶…å°”åå°„
        float3 F = F_Schlick(LdotH, F0);
    
        // 4. ç»„åˆCook-Torrance BRDF
        return (D * V) * F;
    }
    

### **å®Œæ•´é•œé¢åå°„è°ƒç”¨é“¾**

*   â€Œ**æ•°æ®å‡†å¤‡é˜¶æ®µ**â€Œï¼š
    
        hlsl
        // è·å–å…‰çº¿æ•°æ®
        Light light = GetMainLight();
        float3 halfVec = normalize(light.direction + viewDir);
        
        // è®¡ç®—ä¸­é—´é‡
        float NdotV = saturate(dot(normalWS, viewDir));
        float NdotL = saturate(dot(normalWS, light.direction));
        float NdotH = saturate(dot(normalWS, halfVec));
        
    
*   â€Œ**BRDFè®¡ç®—é˜¶æ®µ**â€Œï¼š
    
        hlsl
        // è®¡ç®—ä¸‰é¡¹æ ¸å¿ƒå‚æ•°
        float D = D_GGX(NdotH, roughness);
        float G = G_Smith(NdotV, NdotL, roughness);
        float3 F = F_Schlick(max(dot(halfVec, viewDir), 0), F0);
        
        // æœ€ç»ˆé•œé¢åå°„
        float3 specular = (D * G * F) / (4 * NdotV * NdotL + 0.0001);
        
    

URP 2022 LTSç‰ˆæœ¬ä¸­ï¼Œé€šè¿‡`#define _SPECULARHIGHLIGHTS_OFF`å¯å…³é—­é«˜å…‰è®¡ç®—ã€‚å®é™…å¼€å‘æ—¶å»ºè®®é€šè¿‡`Smoothness`å‚æ•°ï¼ˆ0-1èŒƒå›´ï¼‰æ§åˆ¶é•œé¢åå°„å¼ºåº¦ï¼Œé‡‘å±æè´¨ä¼šè‡ªåŠ¨å¢å¼ºé«˜å…‰å“åº”ã€‚

**å¾®è¡¨é¢ç†è®ºä¸ä¼ ç»Ÿæ¨¡å‹çš„å¯¹æ¯”**
=================

ç‰¹æ€§

å¾®è¡¨é¢æ¨¡å‹

Phongæ¨¡å‹

Blinn-Phongæ¨¡å‹

ç‰©ç†åŸºç¡€

åŸºäºç‰©ç†

ç»éªŒæ¨¡å‹

ç»éªŒæ¨¡å‹

èƒ½é‡å®ˆæ’

æ˜¯

å¦

å¦

è§†è§’ä¾èµ–æ€§

ç²¾ç¡®æ¨¡æ‹Ÿ

è¿‘ä¼¼

è¿‘ä¼¼

æè´¨å‚æ•°

ç‰©ç†å±æ€§(é‡‘å±åº¦/ç²—ç³™åº¦)

å…‰æ³½åº¦

å…‰æ³½åº¦

è¾¹ç¼˜è¡¨ç°

ç²¾ç¡®è²æ¶…å°”

å›ºå®šåå°„ç‡

å›ºå®šåå°„ç‡

æ€§èƒ½å¼€é”€

è¾ƒé«˜

ä½

ä¸­ç­‰

**URPä¸­çš„ä¼˜åŒ–å®ç°**
=============

*   â€Œ**é‡è¦æ€§é‡‡æ ·**â€Œï¼šé€šè¿‡é¢„è®¡ç®—ç¯å¢ƒè´´å›¾ä¼˜åŒ–å®æ—¶è®¡ç®—
*   â€Œ**åˆ†å‰²å’Œè¿‘ä¼¼**â€Œï¼šå°†ç¯å¢ƒå…‰ç…§åˆ†è§£ä¸ºé¢„è¿‡æ»¤ç¯å¢ƒå’ŒBRDF LUT
*   â€Œ**ç§»åŠ¨ç«¯ä¼˜åŒ–**â€Œï¼šä½¿ç”¨ç®€åŒ–çš„IBLï¼ˆåŸºäºå›¾åƒçš„ç…§æ˜ï¼‰è®¡ç®—
*   â€Œ**LODæ§åˆ¶**â€Œï¼šæ ¹æ®è·ç¦»è‡ªåŠ¨é™ä½è®¡ç®—ç²¾åº¦

    hlsl
    // ç¯å¢ƒé•œé¢åå°„ä¼˜åŒ–å®ç°
    float3 EnvBRDFApprox(float3 specColor, float roughness, float NdotV)
    {
        // ä½¿ç”¨é¢„è®¡ç®—çš„LUTçº¹ç†
        float2 envBRDF = tex2D(_BRDFLUT, float2(NdotV, roughness)).rg;
        return specColor * envBRDF.r + envBRDF.g;
    }
    

**å®é™…åº”ç”¨å»ºè®®**
==========

â€Œ**æè´¨è®¾ç½®**â€Œï¼š
-----------

*   é‡‘å±åº¦ï¼šé‡‘å±è¡¨é¢æ¥è¿‘1.0ï¼Œéé‡‘å±æ¥è¿‘0.0
*   ç²—ç³™åº¦ï¼šå…‰æ»‘è¡¨é¢0.0-0.3ï¼Œç²—ç³™è¡¨é¢0.4-1.0

â€Œ**æ€§èƒ½ä¼˜åŒ–**â€Œï¼š
-----------

*   ç®€å•æè´¨ä½¿ç”¨SimpleLitç€è‰²å™¨
*   å¤æ‚åœºæ™¯é™ä½åå°„è´¨é‡

    csharp
    // URP Assetä¸­è°ƒæ•´åå°„è´¨é‡
    UniversalRenderPipelineAsset.asset â†’ Lighting â†’ Reflection Quality
    

â€Œ**è§†è§‰ä¼˜åŒ–**â€Œï¼š
-----------

*   ä½¿ç”¨é«˜è´¨é‡æ³•çº¿è´´å›¾å¢å¼ºå¾®è§‚ç»†èŠ‚
*   æ·»åŠ ç¯å¢ƒå…‰é®è”½è´´å›¾å¢å¼ºæ·±åº¦æ„Ÿ

å¾®è¡¨é¢ç†è®ºä¸ºUnity URPæä¾›äº†ç‰©ç†å‡†ç¡®çš„æ¸²æŸ“åŸºç¡€ï¼Œé€šè¿‡ç²¾ç¡®æ¨¡æ‹Ÿå…‰çº¿ä¸å¾®è§‚è¡¨é¢çš„ç›¸äº’ä½œç”¨ï¼Œå®ç°äº†åœ¨å„ç§æè´¨å’Œå…‰ç…§æ¡ä»¶ä¸‹çš„é€¼çœŸæ¸²æŸ“æ•ˆæœã€‚

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰