---
layout: post
title: 'Python Selenium æ¼«æ­¥æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç²¾é€š'
date: "2025-12-17T00:41:49Z"
---
Python Selenium æ¼«æ­¥æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç²¾é€š
===========================

Python Selenium å®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç²¾é€š
===========================

ğŸ“š ç›®å½•
-----

1.  ç¯å¢ƒå‡†å¤‡ä¸åŸºç¡€å…¥é—¨
2.  å…ƒç´ å®šä½ä¸äº¤äº’æ“ä½œ
3.  ç­‰å¾…æœºåˆ¶ä¸å¼‚å¸¸å¤„ç†
4.  é¢å‘å¯¹è±¡å°è£…ä¸æ¡†æ¶è®¾è®¡
5.  è¿›é˜¶æŠ€å·§ä¸æœ€ä½³å®è·µ
6.  æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§
7.  å®æˆ˜æ¡ˆä¾‹åˆ†æ

* * *

ç¯å¢ƒå‡†å¤‡ä¸åŸºç¡€å…¥é—¨
---------

### 1\. å®‰è£… Selenium ä¸æµè§ˆå™¨é©±åŠ¨

#### å®‰è£… Selenium

    # ä½¿ç”¨pipå®‰è£…æœ€æ–°ç‰ˆæœ¬pip install selenium# å®‰è£…ç‰¹å®šç‰ˆæœ¬pip install selenium==4.10.0# åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…(æ¨è)python -m venv selenium_envsourceÂ selenium_env/bin/activate Â # Linux/Macselenium_env\Scripts\activate.bat Â # Windowspip install selenium

#### å®‰è£…æµè§ˆå™¨é©±åŠ¨

ä»Selenium 4.0å¼€å§‹ï¼Œæä¾›äº†è‡ªåŠ¨ç®¡ç†é©±åŠ¨çš„åŠŸèƒ½ï¼Œä½†äº†è§£æ‰‹åŠ¨å®‰è£…æ–¹æ³•ä»ç„¶å¾ˆé‡è¦ï¼š

**Chromeæµè§ˆå™¨**:

*   è®¿é—® ChromeDriver ä¸‹è½½é¡µé¢
*   ä¸‹è½½ä¸æœ¬åœ°Chromeç‰ˆæœ¬åŒ¹é…çš„é©±åŠ¨ç¨‹åº
*   å°†é©±åŠ¨æ·»åŠ åˆ°ç³»ç»ŸPATHä¸­æˆ–åœ¨ä»£ç ä¸­æŒ‡å®šè·¯å¾„

**Firefoxæµè§ˆå™¨**:

*   è®¿é—® GeckoDriver ä¸‹è½½é¡µé¢
*   ä¸‹è½½é€‚ç”¨äºä½ æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬
*   å°†é©±åŠ¨æ·»åŠ åˆ°ç³»ç»ŸPATHä¸­æˆ–åœ¨ä»£ç ä¸­æŒ‡å®šè·¯å¾„

**Edgeæµè§ˆå™¨**:

*   è®¿é—® Microsoft Edge Driver ä¸‹è½½é¡µé¢
*   ä¸‹è½½ä¸æœ¬åœ°Edgeç‰ˆæœ¬åŒ¹é…çš„é©±åŠ¨ç¨‹åº

**Safariæµè§ˆå™¨**:

*   Safarié©±åŠ¨å·²å†…ç½®äºmacOSä¸­
*   éœ€è¦åœ¨Safariæµè§ˆå™¨ä¸­å¯ç”¨å¼€å‘è€…æ¨¡å¼

### 2\. Selenium 4.x æ–°ç‰¹æ€§

Selenium 4.xå¼•å…¥äº†è®¸å¤šé‡è¦çš„æ”¹è¿›å’Œæ–°åŠŸèƒ½ï¼š

*   **ç›¸å¯¹å®šä½å™¨**ï¼šå…è®¸åŸºäºå…¶ä»–å…ƒç´ çš„ä½ç½®æ¥æŸ¥æ‰¾å…ƒç´ 
*   **Serviceå¯¹è±¡**ï¼šç”¨äºæ›´å¥½åœ°ç®¡ç†é©±åŠ¨ç¨‹åºæœåŠ¡
*   **WebDriver Manager**ï¼šè‡ªåŠ¨ç®¡ç†é©±åŠ¨ç¨‹åºçš„ä¸‹è½½å’Œè®¾ç½®
*   **CDP(Chrome DevTools Protocol)æ”¯æŒ**ï¼šå…è®¸è®¿é—®æµè§ˆå™¨ç‰¹å®šçš„åŠŸèƒ½

### 3\. WebDriveråˆå§‹åŒ–æ–¹æ³•

#### ä½¿ç”¨Selenium Manager(æ¨èï¼ŒSelenium 4.x)

    fromÂ seleniumÂ importÂ webdriverfromÂ selenium.webdriver.chrome.serviceÂ importÂ Service# è‡ªåŠ¨ç®¡ç†é©±åŠ¨driver = webdriver.Chrome()

#### ä¼ ç»Ÿæ–¹æ³•(æŒ‡å®šé©±åŠ¨è·¯å¾„)

    fromÂ seleniumÂ importÂ webdriverfromÂ selenium.webdriver.chrome.serviceÂ importÂ Service# æŒ‡å®šé©±åŠ¨è·¯å¾„service = Service(executable_path='/path/to/chromedriver')driver = webdriver.Chrome(service=service)

#### é…ç½®æµè§ˆå™¨é€‰é¡¹

    fromÂ seleniumÂ importÂ webdriverfromÂ selenium.webdriver.chrome.optionsÂ importÂ Options# åˆ›å»ºChromeé€‰é¡¹å¯¹è±¡chrome_options = Options()chrome_options.add_argument("--headless") Â # æ— å¤´æ¨¡å¼chrome_options.add_argument("--window-size=1920,1080") Â # è®¾ç½®çª—å£å¤§å°chrome_options.add_argument("--disable-gpu") Â # ç¦ç”¨GPUåŠ é€Ÿchrome_options.add_argument("--disable-extensions") Â # ç¦ç”¨æ‰©å±•chrome_options.add_argument("--proxy-server='direct://'") Â # ä»£ç†è®¾ç½®chrome_options.add_argument("--proxy-bypass-list=*") Â # ç»•è¿‡ä»£ç†chrome_options.add_argument("--start-maximized") Â # å¯åŠ¨æ—¶æœ€å¤§åŒ–çª—å£chrome_options.add_experimental_option("prefs", {Â  Â Â "download.default_directory":Â "/path/to/download/directory", Â # è®¾ç½®ä¸‹è½½ç›®å½•Â  Â Â "download.prompt_for_download":Â False, Â # ç¦ç”¨ä¸‹è½½æç¤ºÂ  Â Â "download.directory_upgrade":Â True,Â  Â Â "safebrowsing.enabled":Â True})# åˆå§‹åŒ–WebDriverdriver = webdriver.Chrome(options=chrome_options)

### 4\. åŸºç¡€æµè§ˆå™¨æ“ä½œ

    fromÂ seleniumÂ importÂ webdriver# åˆå§‹åŒ–WebDriverdriver = webdriver.Chrome()# çª—å£æ“ä½œdriver.maximize_window() Â # æœ€å¤§åŒ–çª—å£driver.set_window_size(1920,Â 1080) Â # è®¾ç½®çª—å£å¤§å°driver.set_window_position(0,Â 0) Â # è®¾ç½®çª—å£ä½ç½®# å¯¼èˆªæ“ä½œdriver.get('https://www.example.com') Â # æ‰“å¼€URLdriver.back() Â # åé€€driver.forward() Â # å‰è¿›driver.refresh() Â # åˆ·æ–°é¡µé¢# é¡µé¢ä¿¡æ¯title = driver.title Â # è·å–é¡µé¢æ ‡é¢˜url = driver.current_url Â # è·å–å½“å‰URLpage_source = driver.page_source Â # è·å–é¡µé¢æºä»£ç # Cookieæ“ä½œdriver.add_cookie({"name":Â "key",Â "value":Â "value"}) Â # æ·»åŠ Cookiecookies = driver.get_cookies() Â # è·å–æ‰€æœ‰Cookiesdriver.delete_cookie("key") Â # åˆ é™¤ç‰¹å®šCookiedriver.delete_all_cookies() Â # åˆ é™¤æ‰€æœ‰Cookies# å…³é—­æ“ä½œdriver.close() Â # å…³é—­å½“å‰æ ‡ç­¾é¡µdriver.quit() Â # å…³é—­æµè§ˆå™¨ï¼Œé‡Šæ”¾èµ„æº

### 5\. å¸¸è§æµè§ˆå™¨é…ç½®

#### æ— å¤´æ¨¡å¼(Headless)

    fromÂ seleniumÂ importÂ webdriverfromÂ selenium.webdriver.chrome.optionsÂ importÂ Optionschrome_options = Options()chrome_options.add_argument("--headless")driver = webdriver.Chrome(options=chrome_options)

#### ä½¿ç”¨ä»£ç†

    fromÂ seleniumÂ importÂ webdriverfromÂ selenium.webdriver.chrome.optionsÂ importÂ Optionschrome_options = Options()chrome_options.add_argument('--proxy-server=http://proxyserver:port')driver = webdriver.Chrome(options=chrome_options)

#### ç¦ç”¨å›¾ç‰‡åŠ è½½(æé«˜æ€§èƒ½)

    fromÂ seleniumÂ importÂ webdriverfromÂ selenium.webdriver.chrome.optionsÂ importÂ Optionschrome_options = Options()prefs = {"profile.managed_default_content_settings.images":Â 2}chrome_options.add_experimental_option("prefs", prefs)driver = webdriver.Chrome(options=chrome_options)

* * *

å…ƒç´ å®šä½ä¸äº¤äº’æ“ä½œ
---------

### 1\. å…ƒç´ å®šä½åŸºç¡€

Seleniumæä¾›äº†å¤šç§å®šä½å…ƒç´ çš„æ–¹æ³•ï¼Œæ¯ç§éƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯ï¼š

    fromÂ seleniumÂ importÂ webdriverfromÂ selenium.webdriver.common.byÂ importÂ Bydriver = webdriver.Chrome()driver.get("https://www.example.com")# 1. é€šè¿‡IDå®šä½(æœ€æ¨èï¼Œé«˜æ•ˆä¸”å”¯ä¸€)element = driver.find_element(By.ID,Â "login-button")# 2. é€šè¿‡Nameå±æ€§å®šä½element = driver.find_element(By.NAME,Â "username")# 3. é€šè¿‡Class Nameå®šä½(ä¸å”¯ä¸€æ—¶è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…å…ƒç´ )element = driver.find_element(By.CLASS_NAME,Â "login-form")# 4. é€šè¿‡Tag Nameå®šä½element = driver.find_element(By.TAG_NAME,Â "button")# 5. é€šè¿‡Link Textå®šä½(å®Œå…¨åŒ¹é…)element = driver.find_element(By.LINK_TEXT,Â "Forgot Password?")# 6. é€šè¿‡Partial Link Textå®šä½(éƒ¨åˆ†åŒ¹é…)element = driver.find_element(By.PARTIAL_LINK_TEXT,Â "Forgot")# 7. é€šè¿‡CSSé€‰æ‹©å™¨å®šä½(å¼ºå¤§ä¸”çµæ´»)element = driver.find_element(By.CSS_SELECTOR,Â "#login-form .submit-button")# 8. é€šè¿‡XPathå®šä½(æœ€å¼ºå¤§ä½†å¯èƒ½è¾ƒæ…¢)element = driver.find_element(By.XPATH,Â "//div[@id='login-form']//button")

### 2\. é«˜çº§å®šä½ç­–ç•¥

#### XPathè¿›é˜¶ç”¨æ³•

    # ç»å¯¹è·¯å¾„(ä»æ ¹èŠ‚ç‚¹å¼€å§‹)element = driver.find_element(By.XPATH,Â "/html/body/div/form/input")# ç›¸å¯¹è·¯å¾„(ä»ä»»æ„èŠ‚ç‚¹å¼€å§‹)element = driver.find_element(By.XPATH,Â "//input[@name='username']")# ä½¿ç”¨contains()å‡½æ•°element = driver.find_element(By.XPATH,Â "//button[contains(@class, 'login')]")# ä½¿ç”¨text()å‡½æ•°element = driver.find_element(By.XPATH,Â "//a[text()='Forgot Password?']")element = driver.find_element(By.XPATH,Â "//a[contains(text(), 'Forgot')]")# ä½¿ç”¨ANDå’ŒORæ“ä½œç¬¦element = driver.find_element(By.XPATH,Â "//input[@type='text' and @name='username']")element = driver.find_element(By.XPATH,Â "//button[@type='submit' or @type='button']")# é€šè¿‡çˆ¶å­å…³ç³»å®šä½element = driver.find_element(By.XPATH,Â "//form[@id='login-form']/input")parent = driver.find_element(By.XPATH,Â "//input[@id='username']/..")# é€šè¿‡å…„å¼Ÿå…³ç³»å®šä½element = driver.find_element(By.XPATH,Â "//input[@id='username']/following-sibling::input")element = driver.find_element(By.XPATH,Â "//input[@id='password']/preceding-sibling::input")# æŒ‰ç´¢å¼•å®šä½element = driver.find_element(By.XPATH,Â "(//input[@type='text'])[2]")# ä½¿ç”¨è½´(axes)element = driver.find_element(By.XPATH,Â "//input[@id='username']/ancestor::form")element = driver.find_element(By.XPATH,Â "//form/descendant::input")

#### CSSé€‰æ‹©å™¨è¿›é˜¶ç”¨æ³•

    # åŸºæœ¬é€‰æ‹©å™¨element = driver.find_element(By.CSS_SELECTOR,Â "#login-button") Â # IDé€‰æ‹©å™¨element = driver.find_element(By.CSS_SELECTOR,Â ".login-form") Â  Â # Classé€‰æ‹©å™¨element = driver.find_element(By.CSS_SELECTOR,Â "input") Â  Â  Â  Â  Â # æ ‡ç­¾é€‰æ‹©å™¨# å±æ€§é€‰æ‹©å™¨element = driver.find_element(By.CSS_SELECTOR,Â "input[name='username']")element = driver.find_element(By.CSS_SELECTOR,Â "input[name^='user']") Â # ä»¥userå¼€å¤´element = driver.find_element(By.CSS_SELECTOR,Â "input[name$='name']") Â # ä»¥nameç»“å°¾element = driver.find_element(By.CSS_SELECTOR,Â "input[name*='erna']") Â # åŒ…å«erna# ç»„åˆé€‰æ‹©å™¨element = driver.find_element(By.CSS_SELECTOR,Â "form input[type='text']")element = driver.find_element(By.CSS_SELECTOR,Â "form > input") Â # ç›´æ¥å­å…ƒç´ element = driver.find_element(By.CSS_SELECTOR,Â "label + input") Â # ç´§é‚»å…„å¼Ÿå…ƒç´ element = driver.find_element(By.CSS_SELECTOR,Â "label ~ input") Â # é€šç”¨å…„å¼Ÿå…ƒç´ # ä¼ªç±»é€‰æ‹©å™¨element = driver.find_element(By.CSS_SELECTOR,Â "input:first-child")element = driver.find_element(By.CSS_SELECTOR,Â "input:last-child")element = driver.find_element(By.CSS_SELECTOR,Â "input:nth-child(2)")

#### ç›¸å¯¹å®šä½å™¨(Selenium 4.xæ–°ç‰¹æ€§)

    fromÂ selenium.webdriver.support.relative_locatorÂ importÂ locate_with# è·å–å‚è€ƒå…ƒç´ username_field = driver.find_element(By.ID,Â "username")# ä½¿ç”¨ç›¸å¯¹å®šä½å™¨password_field = driver.find_element(locate_with(By.TAG_NAME,Â "input").below(username_field))login_button = driver.find_element(locate_with(By.TAG_NAME,Â "button").below(password_field))remember_me = driver.find_element(locate_with(By.TAG_NAME,Â "input").to_right_of(password_field))forgot_password = driver.find_element(locate_with(By.TAG_NAME,Â "a").above(login_button))

### 3\. æŸ¥æ‰¾å¤šä¸ªå…ƒç´ 

    # æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ elements = driver.find_elements(By.CSS_SELECTOR,Â ".product-item")# éå†å…ƒç´ åˆ—è¡¨forÂ elementÂ inÂ elements:Â  Â  name = element.find_element(By.CLASS_NAME,Â "product-name").textÂ  Â  price = element.find_element(By.CLASS_NAME,Â "product-price").textÂ  Â  print(f"äº§å“åç§°:Â {name}, ä»·æ ¼:Â {price}")

### 4\. å…ƒç´ äº¤äº’æ“ä½œ

    # è¾“å…¥æ“ä½œelement.send_keys("test@example.com") Â # è¾“å…¥æ–‡æœ¬element.send_keys(Keys.CONTROL,Â 'a') Â Â # é”®ç›˜ç»„åˆé”®(å…¨é€‰)element.send_keys(Keys.BACK_SPACE) Â  Â Â # é€€æ ¼é”®# ç‚¹å‡»æ“ä½œelement.click() Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â # ç‚¹å‡»å…ƒç´ element.submit() Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â # æäº¤è¡¨å•(é€‚ç”¨äºè¡¨å•å…ƒç´ å†…)# æ¸…é™¤æ“ä½œelement.clear() Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â # æ¸…é™¤æ–‡æœ¬è¾“å…¥æ¡†# è·å–å…ƒç´ å±æ€§å’ŒçŠ¶æ€value = element.get_attribute("value") Â # è·å–å±æ€§å€¼text = element.text Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â # è·å–å…ƒç´ æ–‡æœ¬å†…å®¹tag = element.tag_name Â  Â  Â  Â  Â  Â  Â  Â  Â # è·å–æ ‡ç­¾åsize = element.size Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â # è·å–å…ƒç´ å¤§å°location = element.location Â  Â  Â  Â  Â  Â Â # è·å–å…ƒç´ ä½ç½®is_enabled = element.is_enabled() Â  Â  Â Â # å…ƒç´ æ˜¯å¦å¯ç”¨is_selected = element.is_selected() Â  Â Â # å…ƒç´ æ˜¯å¦é€‰ä¸­(å¤é€‰æ¡†ã€å•é€‰æŒ‰é’®ç­‰)is_displayed = element.is_displayed() Â Â # å…ƒç´ æ˜¯å¦å¯è§# ç‰¹æ®Šå…ƒç´ æ“ä½œ# ä¸‹æ‹‰èœå•fromÂ selenium.webdriver.support.selectÂ importÂ Selectselect = Select(driver.find_element(By.ID,Â "dropdown"))select.select_by_visible_text("Option 1") Â # é€šè¿‡æ–‡æœ¬é€‰æ‹©select.select_by_value("option1") Â  Â  Â  Â Â # é€šè¿‡å€¼é€‰æ‹©select.select_by_index(1) Â  Â  Â  Â  Â  Â  Â  Â Â # é€šè¿‡ç´¢å¼•é€‰æ‹©options = select.options Â  Â  Â  Â  Â  Â  Â  Â  Â # è·å–æ‰€æœ‰é€‰é¡¹first_option = select.first_selected_option Â # è·å–å½“å‰é€‰ä¸­é€‰é¡¹select.deselect_all() Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â # å–æ¶ˆæ‰€æœ‰é€‰æ‹©(å¤šé€‰ä¸‹æ‹‰æ¡†)# å¤é€‰æ¡†å’Œå•é€‰æŒ‰é’®checkbox = driver.find_element(By.ID,Â "checkbox")ifnotÂ checkbox.is_selected():Â  Â  checkbox.click()

### 5\. å…ƒç´ æŸ¥æ‰¾æœ€ä½³å®è·µ

1.  **æ€§èƒ½ä¼˜åŒ–é¡ºåº**ï¼šID > Name > CSS > XPath
2.  **é¿å…ä½¿ç”¨**ï¼š

*   ç»å¯¹XPathè·¯å¾„(å®¹æ˜“å¤±æ•ˆ)
*   åŸºäºè§†è§‰ä½ç½®çš„é€‰æ‹©å™¨
*   å¤šçº§åµŒå¥—CSSé€‰æ‹©å™¨

4.  **æ¨èä½¿ç”¨**ï¼š

*   æœ‰æ„ä¹‰çš„IDå’Œåç§°å±æ€§
*   æ•°æ®æµ‹è¯•å±æ€§(å¦‚`data-testid`)
*   çŸ­è€Œæ˜ç¡®çš„CSSé€‰æ‹©å™¨

6.  **å»ºè®®æ·»åŠ **ï¼š

*   é¡µé¢åŠ è½½å’Œå…ƒç´ çš„ç­‰å¾…æœºåˆ¶
*   æŸ¥æ‰¾å…ƒç´ çš„è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
*   è¯¦ç»†çš„é”™è¯¯å¤„ç†æœºåˆ¶

* * *

ç­‰å¾…æœºåˆ¶ä¸å¼‚å¸¸å¤„ç†
---------

### 1\. ç­‰å¾…ç­–ç•¥

åœ¨Webè‡ªåŠ¨åŒ–ä¸­ï¼Œé¡µé¢åŠ è½½å’Œå…ƒç´ æ¸²æŸ“éœ€è¦æ—¶é—´ï¼Œç­‰å¾…æœºåˆ¶è‡³å…³é‡è¦ã€‚

#### éšå¼ç­‰å¾…(Implicit Wait)

    # è®¾ç½®éšå¼ç­‰å¾…æ—¶é—´(å…¨å±€è®¾ç½®)driver.implicitly_wait(10) Â # ç­‰å¾…æœ€å¤š10ç§’ç›´åˆ°å…ƒç´ å‡ºç°

éšå¼ç­‰å¾…ä¼šåœ¨æŸ¥æ‰¾å…ƒç´ æ—¶è‡ªåŠ¨ç­‰å¾…ä¸€æ®µæ—¶é—´ç›´åˆ°å…ƒç´ å‡ºç°ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æœªæ‰¾åˆ°å…ƒç´ ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

#### æ˜¾å¼ç­‰å¾…(Explicit Wait)

    fromÂ selenium.webdriver.support.uiÂ importÂ WebDriverWaitfromÂ selenium.webdriver.supportÂ importÂ expected_conditionsÂ asÂ EC# ç­‰å¾…å…ƒç´ å¯è§element = WebDriverWait(driver,Â 10).until(Â  Â  EC.visibility_of_element_located((By.ID,Â "element_id")))# ç­‰å¾…å…ƒç´ å¯ç‚¹å‡»element = WebDriverWait(driver,Â 10).until(Â  Â  EC.element_to_be_clickable((By.ID,Â "button_id")))# ç­‰å¾…é¡µé¢æ ‡é¢˜åŒ…å«ç‰¹å®šæ–‡æœ¬WebDriverWait(driver,Â 10).until(Â  Â  EC.title_contains("Home Page"))# ç­‰å¾…å…ƒç´ æ¶ˆå¤±WebDriverWait(driver,Â 10).until(Â  Â  EC.invisibility_of_element_located((By.CLASS_NAME,Â "loading")))# ç­‰å¾…è­¦å‘Šæ¡†å‡ºç°WebDriverWait(driver,Â 10).until(Â  Â  EC.alert_is_present())# ç­‰å¾…å…ƒç´ çš„æ–‡æœ¬å†…å®¹æ»¡è¶³æ¡ä»¶WebDriverWait(driver,Â 10).until(Â  Â  EC.text_to_be_present_in_element((By.ID,Â "status"),Â "Success"))# ç­‰å¾…å…ƒç´ çš„å±æ€§å€¼æ»¡è¶³æ¡ä»¶WebDriverWait(driver,Â 10).until(Â  Â  EC.text_to_be_present_in_element_attribute((By.ID,Â "input"),Â "value",Â "text"))

#### è‡ªå®šä¹‰ç­‰å¾…æ¡ä»¶

    fromÂ selenium.webdriver.support.uiÂ importÂ WebDriverWait# è‡ªå®šä¹‰ç­‰å¾…æ¡ä»¶defÂ element_has_class(element, class_name):Â  Â Â returnÂ class_nameÂ inÂ element.get_attribute("class").split()# ä½¿ç”¨è‡ªå®šä¹‰ç­‰å¾…æ¡ä»¶element = driver.find_element(By.ID,Â "myElement")WebDriverWait(driver,Â 10).until(lambdaÂ driver: element_has_class(element,Â "active"))

#### æµç•…ç­‰å¾…(FluentWait)

    fromÂ selenium.webdriver.support.uiÂ importÂ WebDriverWaitfromÂ selenium.common.exceptionsÂ importÂ NoSuchElementException, StaleElementReferenceException# åˆ›å»ºFluentWaitå®ä¾‹wait = WebDriverWait(Â  Â  driver,Â  Â  timeout=30,Â  Â  poll_frequency=2, Â # æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡Â  Â  ignored_exceptions=[NoSuchElementException, StaleElementReferenceException])# ä½¿ç”¨FluentWaitelement = wait.until(EC.element_to_be_clickable((By.ID,Â "myElement")))

### 2\. å¼‚å¸¸å¤„ç†

Seleniumæ“ä½œå¯èƒ½ä¼šè§¦å‘å„ç§å¼‚å¸¸ï¼Œåˆç†çš„å¼‚å¸¸å¤„ç†å¯ä»¥æé«˜è„šæœ¬çš„å¥å£®æ€§ã€‚

#### å¸¸è§å¼‚å¸¸ç±»å‹

    fromÂ selenium.common.exceptionsÂ importÂ (Â  Â  NoSuchElementException, Â # å…ƒç´ æœªæ‰¾åˆ°Â  Â  TimeoutException, Â  Â  Â  Â # ç­‰å¾…è¶…æ—¶Â  Â  ElementNotVisibleException, Â # å…ƒç´ ä¸å¯è§Â  Â  ElementNotInteractableException, Â # å…ƒç´ ä¸å¯äº¤äº’Â  Â  StaleElementReferenceException, Â # å…ƒç´ å·²è¿‡æ—¶(DOMå·²æ›´æ–°)Â  Â  WebDriverException, Â  Â  Â # WebDriveré€šç”¨å¼‚å¸¸Â  Â  InvalidSelectorException, Â # æ— æ•ˆçš„é€‰æ‹©å™¨Â  Â  UnexpectedAlertPresentException, Â # æ„å¤–çš„è­¦å‘Šæ¡†Â  Â  NoAlertPresentException, Â # æ²¡æœ‰è­¦å‘Šæ¡†Â  Â  SessionNotCreatedException, Â # ä¼šè¯åˆ›å»ºå¤±è´¥Â  Â  ElementClickInterceptedException Â # å…ƒç´ ç‚¹å‡»è¢«æ‹¦æˆª)

#### åŸºæœ¬å¼‚å¸¸å¤„ç†

    try:Â  Â  element = driver.find_element(By.ID,Â "non_existent_element")Â  Â  element.click()exceptÂ NoSuchElementException:Â  Â  print("å…ƒç´ æœªæ‰¾åˆ°")exceptÂ ElementNotInteractableException:Â  Â  print("å…ƒç´ ä¸å¯äº¤äº’")exceptÂ ExceptionÂ asÂ e:Â  Â  print(f"å‘ç”Ÿå…¶ä»–å¼‚å¸¸:Â {e}")

#### é‡è¯•æœºåˆ¶

    defÂ retry_click(driver, by, value, max_attempts=3, wait_time=1):Â  Â Â """Â  Â  å°è¯•å¤šæ¬¡ç‚¹å‡»å…ƒç´ Â  Â  """Â  Â Â fromÂ timeÂ importÂ sleepÂ  Â Â Â  Â Â forÂ attemptÂ inÂ range(max_attempts):Â  Â  Â  Â Â try:Â  Â  Â  Â  Â  Â  element = driver.find_element(by, value)Â  Â  Â  Â  Â  Â  element.click()Â  Â  Â  Â  Â  Â Â returnTrueÂ  Â  Â  Â Â exceptÂ (NoSuchElementException, ElementNotInteractableException,Â Â  Â  Â  Â  Â  Â  Â  Â  ElementClickInterceptedException, StaleElementReferenceException)Â asÂ e:Â  Â  Â  Â  Â  Â Â ifÂ attempt == max_attempts -Â 1:Â  Â  Â  Â  Â  Â  Â  Â  print(f"æ— æ³•ç‚¹å‡»å…ƒç´ ï¼Œé”™è¯¯:Â {e}")Â  Â  Â  Â  Â  Â  Â  Â Â returnFalseÂ  Â  Â  Â  Â  Â  sleep(wait_time)Â  Â Â returnFalse

#### å¤„ç†StaleElementReferenceException

    defÂ get_fresh_element(driver, by, value):Â  Â Â """Â  Â  è·å–ä¸€ä¸ªæ–°é²œçš„å…ƒç´ å¼•ç”¨ï¼Œé¿å…StaleElementReferenceExceptionÂ  Â  """Â  Â Â try:Â  Â  Â  Â Â returnÂ driver.find_element(by, value)Â  Â Â exceptÂ StaleElementReferenceException:Â  Â  Â  Â Â # é‡æ–°æŸ¥æ‰¾å…ƒç´ Â  Â  Â  Â Â returnÂ driver.find_element(by, value)

#### ä½¿ç”¨è£…é¥°å™¨å¤„ç†å¼‚å¸¸

    importÂ functoolsfromÂ timeÂ importÂ sleepdefÂ retry(max_attempts=3, wait_time=1):Â  Â Â """Â  Â  å‡½æ•°é‡è¯•è£…é¥°å™¨Â  Â  """Â  Â Â defÂ decorator(func):Â  Â  Â  Â  @functools.wraps(func)Â  Â  Â  Â Â defÂ wrapper(*args, **kwargs):Â  Â  Â  Â  Â  Â Â forÂ attemptÂ inÂ range(max_attempts):Â  Â  Â  Â  Â  Â  Â  Â Â try:Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â returnÂ func(*args, **kwargs)Â  Â  Â  Â  Â  Â  Â  Â Â exceptÂ (NoSuchElementException, ElementNotInteractableException,Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  StaleElementReferenceException)Â asÂ e:Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â ifÂ attempt == max_attempts -Â 1:Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â raiseÂ eÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  sleep(wait_time)Â  Â  Â  Â Â returnÂ wrapperÂ  Â Â returnÂ decorator# ä½¿ç”¨è£…é¥°å™¨@retry(max_attempts=5, wait_time=2)defÂ click_element(driver, by, value):Â  Â  driver.find_element(by, value).click()

### 3\. ç­‰å¾…ç­–ç•¥æœ€ä½³å®è·µ

1.  **é¿å…ä½¿ç”¨`time.sleep()`**ï¼šä¸çµæ´»ä¸”ä½æ•ˆ
2.  **ä¼˜å…ˆä½¿ç”¨æ˜¾å¼ç­‰å¾…**ï¼šæ›´ç²¾ç¡®ï¼Œå¯æ§æ€§æ›´å¼º
3.  **ç»“åˆä½¿ç”¨éšå¼ç­‰å¾…å’Œæ˜¾å¼ç­‰å¾…**ï¼šéšå¼ç­‰å¾…ä½œä¸ºå…¨å±€ä¿æŠ¤ï¼Œæ˜¾å¼ç­‰å¾…é’ˆå¯¹ç‰¹å®šåœºæ™¯
4.  **è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´**ï¼šä¸è¦è¿‡é•¿æˆ–è¿‡çŸ­
5.  **æ•è·å¹¶å¤„ç†è¶…æ—¶å¼‚å¸¸**ï¼šæä¾›é€‚å½“çš„æ¢å¤æœºåˆ¶æˆ–ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
6.  **ä¸ºä¸åŒç½‘ç»œç¯å¢ƒè°ƒæ•´ç­‰å¾…ç­–ç•¥**ï¼šå¯é…ç½®çš„è¶…æ—¶å‚æ•°

* * *

é¢å‘å¯¹è±¡å°è£…ä¸æ¡†æ¶è®¾è®¡
-----------

### 1\. é¡µé¢å¯¹è±¡æ¨¡å‹(Page Object Model, POM)

é¡µé¢å¯¹è±¡æ¨¡å‹æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå°†é¡µé¢çš„å…ƒç´ å’Œæ“ä½œå°è£…åœ¨ç±»ä¸­ï¼Œä½¿æµ‹è¯•ä»£ç æ›´åŠ æ¸…æ™°å’Œå¯ç»´æŠ¤ã€‚

#### åŸºæœ¬POMç»“æ„

    classÂ BasePage:Â  Â Â """Â  Â  æ‰€æœ‰é¡µé¢çš„åŸºç±»Â  Â  """Â  Â Â defÂ __init__(self, driver):Â  Â  Â  Â  self.driver = driverÂ  Â Â Â  Â Â defÂ find_element(self, locator):Â  Â  Â  Â Â returnÂ self.driver.find_element(*locator)Â  Â Â Â  Â Â defÂ find_elements(self, locator):Â  Â  Â  Â Â returnÂ self.driver.find_elements(*locator)Â  Â Â Â  Â Â defÂ click(self, locator):Â  Â  Â  Â  self.find_element(locator).click()Â  Â Â Â  Â Â defÂ input_text(self, locator, text):Â  Â  Â  Â  element = self.find_element(locator)Â  Â  Â  Â  element.clear()Â  Â  Â  Â  element.send_keys(text)Â  Â Â Â  Â Â defÂ get_text(self, locator):Â  Â  Â  Â Â returnÂ self.find_element(locator).textÂ  Â Â Â  Â Â defÂ is_element_present(self, locator):Â  Â  Â  Â Â try:Â  Â  Â  Â  Â  Â  self.find_element(locator)Â  Â  Â  Â  Â  Â Â returnTrueÂ  Â  Â  Â Â exceptÂ NoSuchElementException:Â  Â  Â  Â  Â  Â Â returnFalseÂ  Â Â Â  Â Â defÂ wait_for_element(self, locator, timeout=10):Â  Â  Â  Â Â try:Â  Â  Â  Â  Â  Â  WebDriverWait(self.driver, timeout).until(Â  Â  Â  Â  Â  Â  Â  Â  EC.presence_of_element_located(locator)Â  Â  Â  Â  Â  Â  )Â  Â  Â  Â  Â  Â Â returnTrueÂ  Â  Â  Â Â exceptÂ TimeoutException:Â  Â  Â  Â  Â  Â Â returnFalseclassÂ LoginPage(BasePage):Â  Â Â """Â  Â  ç™»å½•é¡µé¢å¯¹è±¡Â  Â  """Â  Â Â # é¡µé¢å…ƒç´ å®šä½å™¨Â  Â  _username_field = (By.ID,Â "username")Â  Â  _password_field = (By.ID,Â "password")Â  Â  _login_button = (By.ID,Â "login_button")Â  Â  _error_message = (By.CLASS_NAME,Â "error-message")Â  Â Â Â  Â Â defÂ __init__(self, driver):Â  Â  Â  Â  super().__init__(driver)Â  Â  Â  Â  self.driver.get("https://example.com/login")Â  Â Â Â  Â Â defÂ enter_username(self, username):Â  Â  Â  Â  self.input_text(self._username_field, username)Â  Â  Â  Â Â returnÂ selfÂ  Â Â Â  Â Â defÂ enter_password(self, password):Â  Â  Â  Â  self.input_text(self._password_field, password)Â  Â  Â  Â Â returnÂ selfÂ  Â Â Â  Â Â defÂ click_login(self):Â  Â  Â  Â  self.click(self._login_button)Â  Â  Â  Â Â # æ ¹æ®ç™»å½•ç»“æœè¿”å›ä¸åŒçš„é¡µé¢å¯¹è±¡Â  Â  Â  Â Â if"dashboard"inÂ self.driver.current_url:Â  Â  Â  Â  Â  Â Â returnÂ DashboardPage(self.driver)Â  Â  Â  Â Â returnÂ selfÂ  Â Â Â  Â Â defÂ login(self, username, password):Â  Â  Â  Â  self.enter_username(username)Â  Â  Â  Â  self.enter_password(password)Â  Â  Â  Â Â returnÂ self.click_login()Â  Â Â Â  Â Â defÂ get_error_message(self):Â  Â  Â  Â Â ifÂ self.is_element_present(self._error_message):Â  Â  Â  Â  Â  Â Â returnÂ self.get_text(self._error_message)Â  Â  Â  Â Â return""classÂ DashboardPage(BasePage):Â  Â Â """Â  Â  ä»ªè¡¨ç›˜é¡µé¢å¯¹è±¡Â  Â  """Â  Â  _welcome_message = (By.ID,Â "welcome")Â  Â  _logout_button = (By.ID,Â "logout")Â  Â Â Â  Â Â defÂ is_loaded(self):Â  Â  Â  Â Â returnÂ self.wait_for_element(self._welcome_message)Â  Â Â Â  Â Â defÂ get_welcome_message(self):Â  Â  Â  Â Â returnÂ self.get_text(self._welcome_message)Â  Â Â Â  Â Â defÂ logout(self):Â  Â  Â  Â  self.click(self._logout_button)Â  Â  Â  Â Â returnÂ LoginPage(self.driver)

#### ä½¿ç”¨POMè¿›è¡Œæµ‹è¯•

    defÂ test_login_success():Â  Â  driver = webdriver.Chrome()Â  Â Â try:Â  Â  Â  Â  login_page = LoginPage(driver)Â  Â  Â  Â  dashboard_page = login_page.login("valid_user",Â "valid_password")Â  Â  Â  Â Â Â  Â  Â  Â Â assertÂ dashboard_page.is_loaded()Â  Â  Â  Â Â assert"Welcome"inÂ dashboard_page.get_welcome_message()Â  Â Â finally:Â  Â  Â  Â  driver.quit()defÂ test_login_failure():Â  Â  driver = webdriver.Chrome()Â  Â Â try:Â  Â  Â  Â  login_page = LoginPage(driver)Â  Â  Â  Â  result_page = login_page.login("invalid_user",Â "invalid_password")Â  Â  Â  Â Â Â  Â  Â  Â Â assertÂ isinstance(result_page, LoginPage)Â  Â  Â  Â Â assert"Invalid credentials"inÂ result_page.get_error_message()Â  Â Â finally:Â  Â  Â  Â  driver.quit()

### 2\. æµ‹è¯•æ¡†æ¶é›†æˆ

#### ä¸unittesté›†æˆ

    importÂ unittestfromÂ seleniumÂ importÂ webdriverfromÂ selenium.webdriver.chrome.serviceÂ importÂ ServicefromÂ webdriver_manager.chromeÂ importÂ ChromeDriverManagerclassÂ TestLogin(unittest.TestCase):Â  Â Â defÂ setUp(self):Â  Â  Â  Â  self.driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()))Â  Â  Â  Â  self.driver.maximize_window()Â  Â  Â  Â  self.login_page = LoginPage(self.driver)Â  Â Â Â  Â Â defÂ tearDown(self):Â  Â  Â  Â  self.driver.quit()Â  Â Â Â  Â Â defÂ test_valid_login(self):Â  Â  Â  Â  dashboard_page = self.login_page.login("valid_user",Â "valid_password")Â  Â  Â  Â  self.assertTrue(dashboard_page.is_loaded())Â  Â  Â  Â  self.assertIn("Welcome", dashboard_page.get_welcome_message())Â  Â Â Â  Â Â defÂ test_invalid_login(self):Â  Â  Â  Â  result_page = self.login_page.login("invalid_user",Â "invalid_password")Â  Â  Â  Â  self.assertIsInstance(result_page, LoginPage)Â  Â  Â  Â  self.assertIn("Invalid credentials", result_page.get_error_message())ifÂ __name__ ==Â "__main__":Â  Â  unittest.main()

#### ä¸pytesté›†æˆ

    importÂ pytestfromÂ seleniumÂ importÂ webdriverfromÂ selenium.webdriver.chrome.serviceÂ importÂ ServicefromÂ webdriver_manager.chromeÂ importÂ ChromeDriverManager@pytest.fixturedefÂ driver():Â  Â Â # è®¾ç½®Â  Â  driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()))Â  Â  driver.maximize_window()Â  Â Â yieldÂ driverÂ  Â Â # æ¸…ç†Â  Â  driver.quit()@pytest.fixturedefÂ login_page(driver):Â  Â Â returnÂ LoginPage(driver)defÂ test_valid_login(login_page):Â  Â  dashboard_page = login_page.login("valid_user",Â "valid_password")Â  Â Â assertÂ dashboard_page.is_loaded()Â  Â Â assert"Welcome"inÂ dashboard_page.get_welcome_message()defÂ test_invalid_login(login_page):Â  Â  result_page = login_page.login("invalid_user",Â "invalid_password")Â  Â Â assertÂ isinstance(result_page, LoginPage)Â  Â Â assert"Invalid credentials"inÂ result_page.get_error_message()

#### ä¸Behave(BDD)é›†æˆ

    # features/login.featureFeature: User LoginÂ  As a userÂ  I want to be able to login to the applicationÂ  So that I can access my accountÂ  Scenario: Successful loginÂ withÂ valid credentialsÂ  Â  Given the userÂ isÂ on the login pageÂ  Â  When the user entersÂ "valid_user"asÂ usernameÂ  Â  And the user entersÂ "valid_password"asÂ passwordÂ  Â  And the user clicks the login buttonÂ  Â  Then the user should be redirected to the dashboardÂ  Â  And the dashboard should display a welcome messageÂ  Scenario: Failed loginÂ withÂ invalid credentialsÂ  Â  Given the userÂ isÂ on the login pageÂ  Â  When the user entersÂ "invalid_user"asÂ usernameÂ  Â  And the user entersÂ "invalid_password"asÂ passwordÂ  Â  And the user clicks the login buttonÂ  Â  Then the user should remain on the login pageÂ  Â  And an error message should be displayed

    # steps/login_steps.pyfromÂ behaveÂ importÂ given, when, thenfromÂ pages.login_pageÂ importÂ LoginPagefromÂ pages.dashboard_pageÂ importÂ DashboardPage@given('the user is on the login page')defÂ step_impl(context):Â  Â  context.login_page = LoginPage(context.driver)@when('the user enters "{username}" as username')defÂ step_impl(context, username):Â  Â  context.login_page.enter_username(username)@when('the user enters "{password}" as password')defÂ step_impl(context, password):Â  Â  context.login_page.enter_password(password)@when('the user clicks the login button')defÂ step_impl(context):Â  Â  context.result_page = context.login_page.click_login()@then('the user should be redirected to the dashboard')defÂ step_impl(context):Â  Â Â assertÂ isinstance(context.result_page, DashboardPage)@then('the dashboard should display a welcome message')defÂ step_impl(context):Â  Â Â assert"Welcome"inÂ context.result_page.get_welcome_message()@then('the user should remain on the login page')defÂ step_impl(context):Â  Â Â assertÂ isinstance(context.result_page, LoginPage)@then('an error message should be displayed')defÂ step_impl(context):Â  Â Â assert"Invalid credentials"inÂ context.result_page.get_error_message()

### 3\. é«˜çº§æ¡†æ¶è®¾è®¡æ¨¡å¼

#### å·¥å‚æ¨¡å¼

    classÂ PageFactory:Â  Â Â """Â  Â  é¡µé¢å¯¹è±¡å·¥å‚ç±»Â  Â  """Â  Â  @staticmethodÂ  Â Â defÂ get_page(page_name, driver):Â  Â  Â  Â  pages = {Â  Â  Â  Â  Â  Â Â "login": LoginPage,Â  Â  Â  Â  Â  Â Â "dashboard": DashboardPage,Â  Â  Â  Â  Â  Â Â "profile": ProfilePage,Â  Â  Â  Â  Â  Â Â "settings": SettingsPageÂ  Â  Â  Â  }Â  Â  Â  Â Â Â  Â  Â  Â Â ifÂ page_name.lower()Â notinÂ pages:Â  Â  Â  Â  Â  Â Â raiseÂ ValueError(f"ä¸æ”¯æŒçš„é¡µé¢:Â {page_name}")Â  Â  Â  Â Â Â  Â  Â  Â Â returnÂ pages[page_name.lower()](driver)

#### å•ä¾‹æ¨¡å¼(é©±åŠ¨ç®¡ç†å™¨)

    classÂ WebDriverManager:Â  Â Â """Â  Â  WebDriverç®¡ç†å™¨(å•ä¾‹æ¨¡å¼)Â  Â  """Â  Â  _instance =Â NoneÂ  Â Â Â  Â Â defÂ __new__(cls):Â  Â  Â  Â Â ifÂ cls._instanceÂ isNone:Â  Â  Â  Â  Â  Â  cls._instance = super(WebDriverManager, cls).__new__(cls)Â  Â  Â  Â  Â  Â  cls._instance.driver =Â NoneÂ  Â  Â  Â Â returnÂ cls._instanceÂ  Â Â Â  Â Â defÂ get_driver(self, browser="chrome"):Â  Â  Â  Â Â ifÂ self.driverÂ isNone:Â  Â  Â  Â  Â  Â Â ifÂ browser.lower() ==Â "chrome":Â  Â  Â  Â  Â  Â  Â  Â  self.driver = webdriver.Chrome()Â  Â  Â  Â  Â  Â Â elifÂ browser.lower() ==Â "firefox":Â  Â  Â  Â  Â  Â  Â  Â  self.driver = webdriver.Firefox()Â  Â  Â  Â  Â  Â Â else:Â  Â  Â  Â  Â  Â  Â  Â Â raiseÂ ValueError(f"ä¸æ”¯æŒçš„æµè§ˆå™¨:Â {browser}")Â  Â  Â  Â  Â  Â Â Â  Â  Â  Â  Â  Â  self.driver.maximize_window()Â  Â  Â  Â  Â  Â  self.driver.implicitly_wait(10)Â  Â  Â  Â Â Â  Â  Â  Â Â returnÂ self.driverÂ  Â Â Â  Â Â defÂ quit(self):Â  Â  Â  Â Â ifÂ self.driver:Â  Â  Â  Â  Â  Â  self.driver.quit()Â  Â  Â  Â  Â  Â  self.driver =Â None

#### ç­–ç•¥æ¨¡å¼(ç­‰å¾…ç­–ç•¥)

    fromÂ abcÂ importÂ ABC, abstractmethodclassÂ WaitStrategy(ABC):Â  Â Â """Â  Â  ç­‰å¾…ç­–ç•¥åŸºç±»Â  Â  """Â  Â  @abstractmethodÂ  Â Â defÂ wait_for(self, driver, locator):Â  Â  Â  Â Â passclassÂ VisibilityStrategy(WaitStrategy):Â  Â Â """Â  Â  ç­‰å¾…å…ƒç´ å¯è§ç­–ç•¥Â  Â  """Â  Â Â defÂ wait_for(self, driver, locator, timeout=10):Â  Â  Â  Â Â returnÂ WebDriverWait(driver, timeout).until(Â  Â  Â  Â  Â  Â  EC.visibility_of_element_located(locator)Â  Â  Â  Â  )classÂ ClickableStrategy(WaitStrategy):Â  Â Â """Â  Â  ç­‰å¾…å…ƒç´ å¯ç‚¹å‡»ç­–ç•¥Â  Â  """Â  Â Â defÂ wait_for(self, driver, locator, timeout=10):Â  Â  Â  Â Â returnÂ WebDriverWait(driver, timeout).until(Â  Â  Â  Â  Â  Â  EC.element_to_be_clickable(locator)Â  Â  Â  Â  )classÂ PresenceStrategy(WaitStrategy):Â  Â Â """Â  Â  ç­‰å¾…å…ƒç´ å­˜åœ¨ç­–ç•¥Â  Â  """Â  Â Â defÂ wait_for(self, driver, locator, timeout=10):Â  Â  Â  Â Â returnÂ WebDriverWait(driver, timeout).until(Â  Â  Â  Â  Â  Â  EC.presence_of_element_located(locator)Â  Â  Â  Â  )# ä½¿ç”¨ç­–ç•¥æ¨¡å¼çš„é«˜çº§é¡µé¢åŸºç±»classÂ AdvancedBasePage:Â  Â Â defÂ __init__(self, driver):Â  Â  Â  Â  self.driver = driverÂ  Â  Â  Â  self.wait_strategies = {Â  Â  Â  Â  Â  Â Â "visible": VisibilityStrategy(),Â  Â  Â  Â  Â  Â Â "clickable": ClickableStrategy(),Â  Â  Â  Â  Â  Â Â "present": PresenceStrategy()Â  Â  Â  Â  }Â  Â Â Â  Â Â defÂ find_element(self, locator, strategy="present"):Â  Â  Â  Â Â returnÂ self.wait_strategies[strategy].wait_for(self.driver, locator)

### 4\. é…ç½®ä¸æ—¥å¿—ç®¡ç†

#### é…ç½®ç®¡ç†

    importÂ jsonimportÂ osclassÂ ConfigManager:Â  Â Â """Â  Â  é…ç½®ç®¡ç†å™¨Â  Â  """Â  Â  _instance =Â NoneÂ  Â Â Â  Â Â defÂ __new__(cls):Â  Â  Â  Â Â ifÂ cls._instanceÂ isNone:Â  Â  Â  Â  Â  Â  cls._instance = super(ConfigManager, cls).__new__(cls)Â  Â  Â  Â  Â  Â  cls._instance.config = {}Â  Â  Â  Â  Â  Â  cls._instance.load_config()Â  Â  Â  Â Â returnÂ cls._instanceÂ  Â Â Â  Â Â defÂ load_config(self, config_file="config.json"):Â  Â  Â  Â Â ifÂ os.path.exists(config_file):Â  Â  Â  Â  Â  Â Â withÂ open(config_file,Â "r")Â asÂ f:Â  Â  Â  Â  Â  Â  Â  Â  self.config = json.load(f)Â  Â  Â  Â Â else:Â  Â  Â  Â  Â  Â Â # é»˜è®¤é…ç½®Â  Â  Â  Â  Â  Â  self.config = {Â  Â  Â  Â  Â  Â  Â  Â Â "browser":Â "chrome",Â  Â  Â  Â  Â  Â  Â  Â Â "implicit_wait":Â 10,Â  Â  Â  Â  Â  Â  Â  Â Â "explicit_wait":Â 20,Â  Â  Â  Â  Â  Â  Â  Â Â "base_url":Â "https://example.com",Â  Â  Â  Â  Â  Â  Â  Â Â "headless":Â False,Â  Â  Â  Â  Â  Â  Â  Â Â "screenshots_dir":Â "screenshots",Â  Â  Â  Â  Â  Â  Â  Â Â "logs_dir":Â "logs"Â  Â  Â  Â  Â  Â  }Â  Â Â Â  Â Â defÂ get(self, key, default=None):Â  Â  Â  Â Â returnÂ self.config.get(key, default)

#### æ—¥å¿—ç®¡ç†

    importÂ loggingimportÂ osfromÂ datetimeÂ importÂ datetimeclassÂ LogManager:Â  Â Â """Â  Â  æ—¥å¿—ç®¡ç†å™¨Â  Â  """Â  Â  _instance =Â NoneÂ  Â Â Â  Â Â defÂ __new__(cls):Â  Â  Â  Â Â ifÂ cls._instanceÂ isNone:Â  Â  Â  Â  Â  Â  cls._instance = super(LogManager, cls).__new__(cls)Â  Â  Â  Â  Â  Â  cls._instance.setup_logger()Â  Â  Â  Â Â returnÂ cls._instanceÂ  Â Â Â  Â Â defÂ setup_logger(self):Â  Â  Â  Â  config = ConfigManager().get("logs", {})Â  Â  Â  Â  logs_dir = config.get("dir",Â "logs")Â  Â  Â  Â  log_level = config.get("level",Â "INFO")Â  Â  Â  Â Â Â  Â  Â  Â Â ifnotÂ os.path.exists(logs_dir):Â  Â  Â  Â  Â  Â  os.makedirs(logs_dir)Â  Â  Â  Â Â Â  Â  Â  Â  log_file = os.path.join(logs_dir,Â f"test_{datetime.now().strftime('%Y%m%d_%H%M%S')}.log")Â  Â  Â  Â Â Â  Â  Â  Â Â # è®¾ç½®æ—¥å¿—çº§åˆ«æ˜ å°„Â  Â  Â  Â  level_map = {Â  Â  Â  Â  Â  Â Â "DEBUG": logging.DEBUG,Â  Â  Â  Â  Â  Â Â "INFO": logging.INFO,Â  Â  Â  Â  Â  Â Â "WARNING": logging.WARNING,Â  Â  Â  Â  Â  Â Â "ERROR": logging.ERROR,Â  Â  Â  Â  Â  Â Â "CRITICAL": logging.CRITICALÂ  Â  Â  Â  }Â  Â  Â  Â Â Â  Â  Â  Â Â # è®¾ç½®æ ¹æ—¥å¿—è®°å½•å™¨Â  Â  Â  Â  self.logger = logging.getLogger("selenium_framework")Â  Â  Â  Â  self.logger.setLevel(level_map.get(log_level.upper(), logging.INFO))Â  Â  Â  Â Â Â  Â  Â  Â Â # æ–‡ä»¶å¤„ç†å™¨Â  Â  Â  Â  file_handler = logging.FileHandler(log_file)Â  Â  Â  Â  file_handler.setLevel(level_map.get(log_level.upper(), logging.INFO))Â  Â  Â  Â Â Â  Â  Â  Â Â # æ§åˆ¶å°å¤„ç†å™¨Â  Â  Â  Â  console_handler = logging.StreamHandler()Â  Â  Â  Â  console_handler.setLevel(level_map.get(log_level.upper(), logging.INFO))Â  Â  Â  Â Â Â  Â  Â  Â Â # æ—¥å¿—æ ¼å¼Â  Â  Â  Â  formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')Â  Â  Â  Â  file_handler.setFormatter(formatter)Â  Â  Â  Â  console_handler.setFormatter(formatter)Â  Â  Â  Â Â Â  Â  Â  Â Â # æ·»åŠ å¤„ç†å™¨Â  Â  Â  Â  self.logger.addHandler(file_handler)Â  Â  Â  Â  self.logger.addHandler(console_handler)Â  Â Â Â  Â Â defÂ get_logger(self):Â  Â  Â  Â Â returnÂ self.logger

* * *

è¿›é˜¶æŠ€å·§ä¸æœ€ä½³å®è·µ
---------

### 1\. é«˜çº§äº¤äº’æ“ä½œ

#### ActionChainsé«˜çº§æ“ä½œ

    fromÂ selenium.webdriver.common.action_chainsÂ importÂ ActionChainsfromÂ selenium.webdriver.common.keysÂ importÂ Keys# åŸºæœ¬é¼ æ ‡æ“ä½œdefÂ perform_hover(driver, element):Â  Â Â """æ‰§è¡Œæ‚¬åœæ“ä½œ"""Â  Â  ActionChains(driver).move_to_element(element).perform()defÂ perform_right_click(driver, element):Â  Â Â """æ‰§è¡Œå³é”®ç‚¹å‡»æ“ä½œ"""Â  Â  ActionChains(driver).context_click(element).perform()defÂ perform_double_click(driver, element):Â  Â Â """æ‰§è¡ŒåŒå‡»æ“ä½œ"""Â  Â  ActionChains(driver).double_click(element).perform()defÂ perform_drag_and_drop(driver, source_element, target_element):Â  Â Â """æ‰§è¡Œæ‹–æ”¾æ“ä½œ"""Â  Â  ActionChains(driver).drag_and_drop(source_element, target_element).perform()defÂ perform_drag_and_drop_by_offset(driver, element, x_offset, y_offset):Â  Â Â """æ‰§è¡Œåç§»æ‹–æ”¾æ“ä½œ"""Â  Â  ActionChains(driver).drag_and_drop_by_offset(element, x_offset, y_offset).perform()# ç»„åˆé”®ç›˜æ“ä½œdefÂ perform_ctrl_click(driver, element):Â  Â Â """æ‰§è¡ŒCtrl+ç‚¹å‡»æ“ä½œ(å¤šé€‰)"""Â  Â  ActionChains(driver).key_down(Keys.CONTROL).click(element).key_up(Keys.CONTROL).perform()defÂ perform_shift_click(driver, element):Â  Â Â """æ‰§è¡ŒShift+ç‚¹å‡»æ“ä½œ(èŒƒå›´é€‰æ‹©)"""Â  Â  ActionChains(driver).key_down(Keys.SHIFT).click(element).key_up(Keys.SHIFT).perform()defÂ perform_select_all(driver):Â  Â Â """æ‰§è¡Œå…¨é€‰æ“ä½œ(Ctrl+A)"""Â  Â  ActionChains(driver).key_down(Keys.CONTROL).send_keys('a').key_up(Keys.CONTROL).perform()defÂ perform_copy(driver):Â  Â Â """æ‰§è¡Œå¤åˆ¶æ“ä½œ(Ctrl+C)"""Â  Â  ActionChains(driver).key_down(Keys.CONTROL).send_keys('c').key_up(Keys.CONTROL).perform()defÂ perform_paste(driver):Â  Â Â """æ‰§è¡Œç²˜è´´æ“ä½œ(Ctrl+V)"""Â  Â  ActionChains(driver).key_down(Keys.CONTROL).send_keys('v').key_up(Keys.CONTROL).perform()# é“¾å¼ç»„åˆæ“ä½œdefÂ perform_complex_action(driver, element1, element2):Â  Â Â """æ‰§è¡Œå¤æ‚ç»„åˆæ“ä½œ"""Â  Â  ActionChains(driver)\Â  Â  Â  Â  .move_to_element(element1)\Â  Â  Â  Â  .pause(1) Â # æš‚åœ1ç§’Â  Â  Â  Â  .click()\Â  Â  Â  Â  .move_to_element(element2)\Â  Â  Â  Â  .click()\Â  Â  Â  Â  .perform()

#### å¤„ç†JavaScriptäº‹ä»¶

  

    defÂ trigger_js_event(driver, element, event_name):Â  Â Â """è§¦å‘JavaScriptäº‹ä»¶"""Â  Â  js_code =Â f"arguments[0].dispatchEvent(new Event('{event_name}'));"Â  Â  driver.execute_script(js_code, element)defÂ focus_element(driver, element):Â  Â Â """ä½¿å…ƒç´ è·å–ç„¦ç‚¹"""Â  Â  driver.execute_script("arguments[0].focus();", element)defÂ blur_element(driver, element):Â  Â Â """ä½¿å…ƒç´ å¤±å»ç„¦ç‚¹"""Â  Â  driver.execute_script("arguments[0].blur();", element)defÂ scroll_to_element(driver, element):Â  Â Â """æ»šåŠ¨åˆ°å…ƒç´ ä½ç½®"""Â  Â  driver.execute_script("arguments[0].scrollIntoView({behavior: 'smooth', block: 'center'});", element)defÂ scroll_to_top(driver):Â  Â Â """æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨"""Â  Â  driver.execute_script("window.scrollTo(0, 0);")defÂ scroll_to_bottom(driver):Â  Â Â """æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨"""Â  Â  driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")

### 2\. çª—å£ä¸æ ‡ç­¾é¡µç®¡ç†

    defÂ switch_to_window_by_title(driver, title):Â  Â Â """åˆ‡æ¢åˆ°æŒ‡å®šæ ‡é¢˜çš„çª—å£"""Â  Â  current_window = driver.current_window_handleÂ  Â Â forÂ windowÂ inÂ driver.window_handles:Â  Â  Â  Â  driver.switch_to.window(window)Â  Â  Â  Â Â ifÂ titleÂ inÂ driver.title:Â  Â  Â  Â  Â  Â Â returnTrueÂ  Â Â # å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…æ ‡é¢˜çš„çª—å£ï¼Œåˆ‡å›åŸçª—å£Â  Â  driver.switch_to.window(current_window)Â  Â Â returnFalsedefÂ switch_to_window_by_url(driver, url_part):Â  Â Â """åˆ‡æ¢åˆ°URLåŒ…å«æŒ‡å®šéƒ¨åˆ†çš„çª—å£"""Â  Â  current_window = driver.current_window_handleÂ  Â Â forÂ windowÂ inÂ driver.window_handles:Â  Â  Â  Â  driver.switch_to.window(window)Â  Â  Â  Â Â ifÂ url_partÂ inÂ driver.current_url:Â  Â  Â  Â  Â  Â Â returnTrueÂ  Â Â # å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…URLçš„çª—å£ï¼Œåˆ‡å›åŸçª—å£Â  Â  driver.switch_to.window(current_window)Â  Â Â returnFalsedefÂ close_all_windows_except_current(driver):Â  Â Â """å…³é—­é™¤å½“å‰çª—å£å¤–çš„æ‰€æœ‰çª—å£"""Â  Â  current_window = driver.current_window_handleÂ  Â Â forÂ windowÂ inÂ driver.window_handles:Â  Â  Â  Â Â ifÂ window != current_window:Â  Â  Â  Â  Â  Â  driver.switch_to.window(window)Â  Â  Â  Â  Â  Â  driver.close()Â  Â  driver.switch_to.window(current_window)defÂ open_new_tab(driver, url=None):Â  Â Â """æ‰“å¼€æ–°æ ‡ç­¾é¡µ"""Â  Â  driver.execute_script("window.open();")Â  Â  driver.switch_to.window(driver.window_handles[-1])Â  Â Â ifÂ url:Â  Â  Â  Â  driver.get(url)defÂ handle_popup_window(driver, action="accept"):Â  Â Â """å¤„ç†å¼¹å‡ºçª—å£"""Â  Â Â try:Â  Â  Â  Â Â ifÂ action.lower() ==Â "accept":Â  Â  Â  Â  Â  Â  driver.switch_to.alert.accept()Â  Â  Â  Â Â elifÂ action.lower() ==Â "dismiss":Â  Â  Â  Â  Â  Â  driver.switch_to.alert.dismiss()Â  Â  Â  Â Â elifÂ action.lower() ==Â "text":Â  Â  Â  Â  Â  Â Â returnÂ driver.switch_to.alert.textÂ  Â  Â  Â Â else:Â  Â  Â  Â  Â  Â Â raiseÂ ValueError(f"ä¸æ”¯æŒçš„æ“ä½œ:Â {action}")Â  Â  Â  Â Â returnTrueÂ  Â Â except:Â  Â  Â  Â Â returnFalse

### 3\. iframeå¤„ç†

    defÂ switch_to_frame_by_index(driver, index):Â  Â Â """é€šè¿‡ç´¢å¼•åˆ‡æ¢åˆ°iframe"""Â  Â Â try:Â  Â  Â  Â  driver.switch_to.frame(index)Â  Â  Â  Â Â returnTrueÂ  Â Â except:Â  Â  Â  Â Â returnFalsedefÂ switch_to_frame_by_name_or_id(driver, name_or_id):Â  Â Â """é€šè¿‡åç§°æˆ–IDåˆ‡æ¢åˆ°iframe"""Â  Â Â try:Â  Â  Â  Â  driver.switch_to.frame(name_or_id)Â  Â  Â  Â Â returnTrueÂ  Â Â except:Â  Â  Â  Â Â returnFalsedefÂ switch_to_frame_by_element(driver, element):Â  Â Â """é€šè¿‡å…ƒç´ åˆ‡æ¢åˆ°iframe"""Â  Â Â try:Â  Â  Â  Â  driver.switch_to.frame(element)Â  Â  Â  Â Â returnTrueÂ  Â Â except:Â  Â  Â  Â Â returnFalsedefÂ switch_to_parent_frame(driver):Â  Â Â """åˆ‡æ¢åˆ°çˆ¶iframe"""Â  Â Â try:Â  Â  Â  Â  driver.switch_to.parent_frame()Â  Â  Â  Â Â returnTrueÂ  Â Â except:Â  Â  Â  Â Â returnFalsedefÂ switch_to_default_content(driver):Â  Â Â """åˆ‡æ¢åˆ°ä¸»æ–‡æ¡£"""Â  Â Â try:Â  Â  Â  Â  driver.switch_to.default_content()Â  Â  Â  Â Â returnTrueÂ  Â Â except:Â  Â  Â  Â Â returnFalsedefÂ get_iframe_count(driver):Â  Â Â """è·å–é¡µé¢ä¸­iframeçš„æ•°é‡"""Â  Â Â returnÂ len(driver.find_elements(By.TAG_NAME,Â "iframe"))defÂ execute_in_iframe(driver, iframe_locator, action_func):Â  Â Â """åœ¨iframeä¸­æ‰§è¡Œæ“ä½œ"""Â  Â  driver.switch_to.frame(driver.find_element(*iframe_locator))Â  Â Â try:Â  Â  Â  Â  result = action_func(driver)Â  Â  Â  Â Â returnÂ resultÂ  Â Â finally:Â  Â  Â  Â  driver.switch_to.default_content()

### 4\. æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½

#### æ–‡ä»¶ä¸Šä¼ 

    defÂ upload_file(driver, file_input_locator, file_path):Â  Â Â """Â  Â  ä¸Šä¼ æ–‡ä»¶(é€‚ç”¨äº<input type="file">å…ƒç´ )Â  Â  """Â  Â Â try:Â  Â  Â  Â  file_input = driver.find_element(*file_input_locator)Â  Â  Â  Â  file_input.send_keys(file_path)Â  Â  Â  Â Â returnTrueÂ  Â Â exceptÂ ExceptionÂ asÂ e:Â  Â  Â  Â  print(f"æ–‡ä»¶ä¸Šä¼ å¤±è´¥:Â {e}")Â  Â  Â  Â Â returnFalsedefÂ upload_file_without_input(driver, upload_button_locator, file_path):Â  Â Â """Â  Â  ä¸Šä¼ æ–‡ä»¶(é€‚ç”¨äºæ²¡æœ‰å¯è§<input type="file">çš„æƒ…å†µ)Â  Â  ä½¿ç”¨JSåˆ›å»ºä¸€ä¸ªéšè—çš„æ–‡ä»¶è¾“å…¥å…ƒç´ Â  Â  """Â  Â Â try:Â  Â  Â  Â Â # åˆ›å»ºä¸€ä¸ªéšè—çš„æ–‡ä»¶è¾“å…¥å…ƒç´ Â  Â  Â  Â  js_script =Â """Â  Â  Â  Â  const input = document.createElement('input');Â  Â  Â  Â  input.type = 'file';Â  Â  Â  Â  input.style.display = 'none';Â  Â  Â  Â  input.id = 'hidden-file-input';Â  Â  Â  Â  document.body.appendChild(input);Â  Â  Â  Â  return input;Â  Â  Â  Â  """Â  Â  Â  Â  file_input = driver.execute_script(js_script)Â  Â  Â  Â Â Â  Â  Â  Â Â # è®¾ç½®æ–‡ä»¶è·¯å¾„Â  Â  Â  Â  file_input.send_keys(file_path)Â  Â  Â  Â Â Â  Â  Â  Â Â # è§¦å‘ä¸Šä¼ æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶Â  Â  Â  Â  upload_button = driver.find_element(*upload_button_locator)Â  Â  Â  Â  driver.execute_script("arguments[0].click();", upload_button)Â  Â  Â  Â Â Â  Â  Â  Â Â # ç§»é™¤éšè—çš„æ–‡ä»¶è¾“å…¥å…ƒç´ Â  Â  Â  Â  driver.execute_script("document.getElementById('hidden-file-input').remove();")Â  Â  Â  Â Â Â  Â  Â  Â Â returnTrueÂ  Â Â exceptÂ ExceptionÂ asÂ e:Â  Â  Â  Â  print(f"æ–‡ä»¶ä¸Šä¼ å¤±è´¥:Â {e}")Â  Â  Â  Â Â returnFalse

#### æ–‡ä»¶ä¸‹è½½

    importÂ osimportÂ timefromÂ pathlibÂ importÂ PathdefÂ setup_chrome_download_path(download_dir):Â  Â Â """Â  Â  è®¾ç½®Chromeæµè§ˆå™¨çš„ä¸‹è½½è·¯å¾„Â  Â  """Â  Â  options = webdriver.ChromeOptions()Â  Â  prefs = {Â  Â  Â  Â Â "download.default_directory": download_dir,Â  Â  Â  Â Â "download.prompt_for_download":Â False,Â  Â  Â  Â Â "download.directory_upgrade":Â True,Â  Â  Â  Â Â "safebrowsing.enabled":Â TrueÂ  Â  }Â  Â  options.add_experimental_option("prefs", prefs)Â  Â Â returnÂ optionsdefÂ wait_for_download_to_complete(download_dir, timeout=60, check_interval=1):Â  Â Â """Â  Â  ç­‰å¾…ä¸‹è½½å®ŒæˆÂ  Â  """Â  Â  start_time = time.time()Â  Â Â whileÂ time.time() - start_time < timeout:Â  Â  Â  Â Â # æ£€æŸ¥æ˜¯å¦æœ‰éƒ¨åˆ†ä¸‹è½½çš„æ–‡ä»¶(.crdownload, .partç­‰)Â  Â  Â  Â  downloading_files = list(Path(download_dir).glob("*.crdownload")) + list(Path(download_dir).glob("*.part"))Â  Â  Â  Â Â ifnotÂ downloading_files:Â  Â  Â  Â  Â  Â Â # æ‰¾å‡ºæœ€è¿‘ä¸‹è½½çš„æ–‡ä»¶Â  Â  Â  Â  Â  Â  downloaded_files = list(Path(download_dir).glob("*"))Â  Â  Â  Â  Â  Â Â ifÂ downloaded_files:Â  Â  Â  Â  Â  Â  Â  Â  downloaded_files.sort(key=lambdaÂ x: x.stat().st_mtime, reverse=True)Â  Â  Â  Â  Â  Â  Â  Â Â returnÂ str(downloaded_files[0])Â  Â  Â  Â  time.sleep(check_interval)Â  Â Â raiseÂ TimeoutError("æ–‡ä»¶ä¸‹è½½è¶…æ—¶")defÂ download_file(driver, download_button_locator, download_dir, timeout=60):Â  Â Â """Â  Â  ä¸‹è½½æ–‡ä»¶Â  Â  """Â  Â Â try:Â  Â  Â  Â Â # ç¡®ä¿ä¸‹è½½ç›®å½•å­˜åœ¨Â  Â  Â  Â  os.makedirs(download_dir, exist_ok=True)Â  Â  Â  Â Â Â  Â  Â  Â Â # ç‚¹å‡»ä¸‹è½½æŒ‰é’®Â  Â  Â  Â  download_button = driver.find_element(*download_button_locator)Â  Â  Â  Â  download_button.click()Â  Â  Â  Â Â Â  Â  Â  Â Â # ç­‰å¾…ä¸‹è½½å®ŒæˆÂ  Â  Â  Â  downloaded_file = wait_for_download_to_complete(download_dir, timeout)Â  Â  Â  Â Â returnÂ downloaded_fileÂ  Â Â exceptÂ ExceptionÂ asÂ e:Â  Â  Â  Â  print(f"æ–‡ä»¶ä¸‹è½½å¤±è´¥:Â {e}")Â  Â  Â  Â Â returnNone

### 5\. æˆªå›¾ä¸æ—¥å¿—

    importÂ osimportÂ timefromÂ datetimeÂ importÂ datetimedefÂ take_screenshot(driver, directory="screenshots", filename=None):Â  Â Â """Â  Â  æˆªå–å±å¹•æˆªå›¾Â  Â  """Â  Â Â try:Â  Â  Â  Â Â # ç¡®ä¿ç›®å½•å­˜åœ¨Â  Â  Â  Â  os.makedirs(directory, exist_ok=True)Â  Â  Â  Â Â Â  Â  Â  Â Â # å¦‚æœæœªæŒ‡å®šæ–‡ä»¶åï¼Œä½¿ç”¨æ—¶é—´æˆ³ç”ŸæˆÂ  Â  Â  Â Â ifnotÂ filename:Â  Â  Â  Â  Â  Â  timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")Â  Â  Â  Â  Â  Â  filename =Â f"screenshot_{timestamp}.png"Â  Â  Â  Â Â Â  Â  Â  Â Â # æ‹¼æ¥å®Œæ•´è·¯å¾„Â  Â  Â  Â  file_path = os.path.join(directory, filename)Â  Â  Â  Â Â Â  Â  Â  Â Â # æˆªå›¾Â  Â  Â  Â  driver.save_screenshot(file_path)Â  Â  Â  Â Â returnÂ file_pathÂ  Â Â exceptÂ ExceptionÂ asÂ e:Â  Â  Â  Â  print(f"æˆªå›¾å¤±è´¥:Â {e}")Â  Â  Â  Â Â returnNonedefÂ take_element_screenshot(driver, element, directory="screenshots", filename=None):Â  Â Â """Â  Â  æˆªå–å…ƒç´ æˆªå›¾Â  Â  """Â  Â Â try:Â  Â  Â  Â Â # ç¡®ä¿ç›®å½•å­˜åœ¨Â  Â  Â  Â  os.makedirs(directory, exist_ok=True)Â  Â  Â  Â Â Â  Â  Â  Â Â # å¦‚æœæœªæŒ‡å®šæ–‡ä»¶åï¼Œä½¿ç”¨æ—¶é—´æˆ³ç”ŸæˆÂ  Â  Â  Â Â ifnotÂ filename:Â  Â  Â  Â  Â  Â  timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")Â  Â  Â  Â  Â  Â  filename =Â f"element_screenshot_{timestamp}.png"Â  Â  Â  Â Â Â  Â  Â  Â Â # æ‹¼æ¥å®Œæ•´è·¯å¾„Â  Â  Â  Â  file_path = os.path.join(directory, filename)Â  Â  Â  Â Â Â  Â  Â  Â Â # æˆªå–å…ƒç´ æˆªå›¾Â  Â  Â  Â  element.screenshot(file_path)Â  Â  Â  Â Â returnÂ file_pathÂ  Â Â exceptÂ ExceptionÂ asÂ e:Â  Â  Â  Â  print(f"å…ƒç´ æˆªå›¾å¤±è´¥:Â {e}")Â  Â  Â  Â Â returnNonedefÂ screenshot_on_failure(func):Â  Â Â """Â  Â  å¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾çš„è£…é¥°å™¨Â  Â  """Â  Â Â defÂ wrapper(*args, **kwargs):Â  Â  Â  Â Â try:Â  Â  Â  Â  Â  Â Â returnÂ func(*args, **kwargs)Â  Â  Â  Â Â exceptÂ ExceptionÂ asÂ e:Â  Â  Â  Â  Â  Â Â # å‡è®¾ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯selfï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯driverÂ  Â  Â  Â  Â  Â  driver = args[1]Â ifÂ len(args) >Â 1elseNoneÂ  Â  Â  Â  Â  Â Â ifÂ driver:Â  Â  Â  Â  Â  Â  Â  Â  timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")Â  Â  Â  Â  Â  Â  Â  Â  filename =Â f"failure_{func.__name__}_{timestamp}.png"Â  Â  Â  Â  Â  Â  Â  Â  take_screenshot(driver, filename=filename)Â  Â  Â  Â  Â  Â Â raiseÂ eÂ  Â Â returnÂ wrapper

### 6\. é«˜çº§æ–­è¨€ä¸éªŒè¯

    defÂ verify_element_text(driver, locator, expected_text, contains=False):Â  Â Â """Â  Â  éªŒè¯å…ƒç´ æ–‡æœ¬Â  Â  """Â  Â Â try:Â  Â  Â  Â  element = driver.find_element(*locator)Â  Â  Â  Â  actual_text = element.textÂ  Â  Â  Â Â ifÂ contains:Â  Â  Â  Â  Â  Â Â assertÂ expected_textÂ inÂ actual_text,Â f"æœŸæœ›æ–‡æœ¬åŒ…å«'{expected_text}'ï¼Œå®é™…æ–‡æœ¬ä¸º'{actual_text}'"Â  Â  Â  Â Â else:Â  Â  Â  Â  Â  Â Â assertÂ actual_text == expected_text,Â f"æœŸæœ›æ–‡æœ¬ä¸º'{expected_text}'ï¼Œå®é™…æ–‡æœ¬ä¸º'{actual_text}'"Â  Â  Â  Â Â returnTrueÂ  Â Â exceptÂ AssertionErrorÂ asÂ e:Â  Â  Â  Â  print(f"éªŒè¯å¤±è´¥:Â {e}")Â  Â  Â  Â Â returnFalsedefÂ verify_element_attribute(driver, locator, attribute, expected_value, contains=False):Â  Â Â """Â  Â  éªŒè¯å…ƒç´ å±æ€§Â  Â  """Â  Â Â try:Â  Â  Â  Â  element = driver.find_element(*locator)Â  Â  Â  Â  actual_value = element.get_attribute(attribute)Â  Â  Â  Â Â ifÂ contains:Â  Â  Â  Â  Â  Â Â assertÂ expected_valueÂ inÂ actual_value,Â f"æœŸæœ›å±æ€§'{attribute}'åŒ…å«'{expected_value}'ï¼Œå®é™…å€¼ä¸º'{actual_value}'"Â  Â  Â  Â Â else:Â  Â  Â  Â  Â  Â Â assertÂ actual_value == expected_value,Â f"æœŸæœ›å±æ€§'{attribute}'ä¸º'{expected_value}'ï¼Œå®é™…å€¼ä¸º'{actual_value}'"Â  Â  Â  Â Â returnTrueÂ  Â Â exceptÂ AssertionErrorÂ asÂ e:Â  Â  Â  Â  print(f"éªŒè¯å¤±è´¥:Â {e}")Â  Â  Â  Â Â returnFalsedefÂ verify_element_visible(driver, locator, timeout=10):Â  Â Â """Â  Â  éªŒè¯å…ƒç´ å¯è§Â  Â  """Â  Â Â try:Â  Â  Â  Â  WebDriverWait(driver, timeout).until(EC.visibility_of_element_located(locator))Â  Â  Â  Â Â returnTrueÂ  Â Â exceptÂ TimeoutException:Â  Â  Â  Â  print(f"å…ƒç´ åœ¨{timeout}ç§’å†…æœªå¯è§:Â {locator}")Â  Â  Â  Â Â returnFalsedefÂ verify_element_not_visible(driver, locator, timeout=10):Â  Â Â """Â  Â  éªŒè¯å…ƒç´ ä¸å¯è§Â  Â  """Â  Â Â try:Â  Â  Â  Â  WebDriverWait(driver, timeout).until(EC.invisibility_of_element_located(locator))Â  Â  Â  Â Â returnTrueÂ  Â Â exceptÂ TimeoutException:Â  Â  Â  Â  print(f"å…ƒç´ åœ¨{timeout}ç§’å†…ä»ç„¶å¯è§:Â {locator}")Â  Â  Â  Â Â returnFalsedefÂ verify_url(driver, expected_url, contains=False, timeout=10):Â  Â Â """Â  Â  éªŒè¯URLÂ  Â  """Â  Â Â try:Â  Â  Â  Â Â ifÂ contains:Â  Â  Â  Â  Â  Â  WebDriverWait(driver, timeout).until(lambdaÂ d: expected_urlÂ inÂ d.current_url)Â  Â  Â  Â Â else:Â  Â  Â  Â  Â  Â  WebDriverWait(driver, timeout).until(lambdaÂ d: d.current_url == expected_url)Â  Â  Â  Â Â returnTrueÂ  Â Â exceptÂ TimeoutException:Â  Â  Â  Â  print(f"URLéªŒè¯å¤±è´¥ï¼ŒæœŸæœ›URL{''Â ifÂ containsÂ elseÂ 'ä¸º'}{expected_url}ï¼Œå®é™…URLä¸º{driver.current_url}")Â  Â  Â  Â Â returnFalsedefÂ verify_title(driver, expected_title, contains=False, timeout=10):Â  Â Â """Â  Â  éªŒè¯é¡µé¢æ ‡é¢˜Â  Â  """Â  Â Â try:Â  Â  Â  Â Â ifÂ contains:Â  Â  Â  Â  Â  Â  WebDriverWait(driver, timeout).until(lambdaÂ d: expected_titleÂ inÂ d.title)Â  Â  Â  Â Â else:Â  Â  Â  Â  Â  Â  WebDriverWait(driver, timeout).until(lambdaÂ d: d.title == expected_title)Â  Â  Â  Â Â returnTrueÂ  Â Â exceptÂ TimeoutException:Â  Â  Â  Â  print(f"æ ‡é¢˜éªŒè¯å¤±è´¥ï¼ŒæœŸæœ›æ ‡é¢˜{''Â ifÂ containsÂ elseÂ 'ä¸º'}{expected_title}ï¼Œå®é™…æ ‡é¢˜ä¸º{driver.title}")Â  Â  Â  Â Â returnFalse

* * *

æ€§èƒ½ä¼˜åŒ–ä¸è°ƒè¯•æŠ€å·§
---------

### 1\. æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–

#### æµ‹é‡é¡µé¢åŠ è½½æ—¶é—´

    defÂ measure_page_load_time(driver, url):Â  Â Â """Â  Â  æµ‹é‡é¡µé¢åŠ è½½æ—¶é—´Â  Â  """Â  Â  start_time = time.time()Â  Â  driver.get(url)Â  Â Â Â  Â Â # ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½Â  Â  WebDriverWait(driver,Â 60).until(Â  Â  Â  Â Â lambdaÂ d: d.execute_script("return document.readyState") ==Â "complete"Â  Â  )Â  Â Â Â  Â  end_time = time.time()Â  Â  load_time = end_time - start_timeÂ  Â Â Â  Â Â returnÂ load_time

#### ä½¿ç”¨Performance APIè·å–è¯¦ç»†æ€§èƒ½æ•°æ®

    defÂ get_performance_metrics(driver):Â  Â Â """Â  Â  è·å–æµè§ˆå™¨æ€§èƒ½æŒ‡æ ‡Â  Â  """Â  Â Â # ä½¿ç”¨Navigation Timing APIÂ  Â  navigation_timing = driver.execute_script("""Â  Â  Â  Â  var performance = window.performance;Â  Â  Â  Â  var timingObj = performance.timing;Â  Â  Â  Â  var loadTime = timingObj.loadEventEnd - timingObj.navigationStart;Â  Â  Â  Â  var dnsTime = timingObj.domainLookupEnd - timingObj.domainLookupStart;Â  Â  Â  Â  var tcpTime = timingObj.connectEnd - timingObj.connectStart;Â  Â  Â  Â  var serverTime = timingObj.responseEnd - timingObj.requestStart;Â  Â  Â  Â  var domTime = timingObj.domComplete - timingObj.domLoading;Â  Â  Â  Â Â Â  Â  Â  Â  return {Â  Â  Â  Â  Â  Â  'loadTime': loadTime,Â  Â  Â  Â  Â  Â  'dnsTime': dnsTime,Â  Â  Â  Â  Â  Â  'tcpTime': tcpTime,Â  Â  Â  Â  Â  Â  'serverTime': serverTime,Â  Â  Â  Â  Â  Â  'domTime': domTime,Â  Â  Â  Â  Â  Â  'firstPaint': timingObj.responseStart - timingObj.navigationStart,Â  Â  Â  Â  Â  Â  'ttfb': timingObj.responseStart - timingObj.requestStartÂ  Â  Â  Â  };Â  Â  """)Â  Â Â Â  Â Â returnÂ navigation_timingdefÂ get_resource_timing(driver):Â  Â Â """Â  Â  è·å–èµ„æºåŠ è½½æ—¶é—´Â  Â  """Â  Â  resources = driver.execute_script("""Â  Â  Â  Â  var resources = window.performance.getEntriesByType('resource');Â  Â  Â  Â  return resources.map(function(resource) {Â  Â  Â  Â  Â  Â  return {Â  Â  Â  Â  Â  Â  Â  Â  'name': resource.name,Â  Â  Â  Â  Â  Â  Â  Â  'startTime': resource.startTime,Â  Â  Â  Â  Â  Â  Â  Â  'duration': resource.duration,Â  Â  Â  Â  Â  Â  Â  Â  'initiatorType': resource.initiatorType,Â  Â  Â  Â  Â  Â  Â  Â  'size': resource.transferSizeÂ  Â  Â  Â  Â  Â  };Â  Â  Â  Â  });Â  Â  """)Â  Â Â Â  Â Â returnÂ resources

#### ä¼˜åŒ–æ‰§è¡Œé€Ÿåº¦

    defÂ optimize_chrome_for_performance():Â  Â Â """Â  Â  ä¼˜åŒ–Chromeæµè§ˆå™¨ä»¥æé«˜æ€§èƒ½Â  Â  """Â  Â  options = webdriver.ChromeOptions()Â  Â Â Â  Â Â # ç¦ç”¨ä¸å¿…è¦çš„æµè§ˆå™¨åŠŸèƒ½Â  Â  options.add_argument("--disable-extensions")Â  Â  options.add_argument("--disable-gpu")Â  Â  options.add_argument("--disable-dev-shm-usage")Â  Â  options.add_argument("--disable-browser-side-navigation")Â  Â  options.add_argument("--disable-infobars")Â  Â  options.add_argument("--disable-notifications")Â  Â  options.add_argument("--disable-popup-blocking")Â  Â Â Â  Â Â # å‡å°‘å†…å­˜ä½¿ç”¨Â  Â  options.add_argument("--disable-features=site-per-process")Â  Â  options.add_argument("--process-per-site")Â  Â Â Â  Â Â # ç¦ç”¨å›¾ç‰‡åŠ è½½ä»¥æé«˜é€Ÿåº¦Â  Â  prefs = {Â  Â  Â  Â Â "profile.managed_default_content_settings.images":Â 2,Â  Â  Â  Â Â "profile.default_content_setting_values.notifications":Â 2,Â  Â  Â  Â Â "profile.default_content_setting_values.geolocation":Â 2Â  Â  }Â  Â  options.add_experimental_option("prefs", prefs)Â  Â Â Â  Â Â # ä½¿ç”¨æ— å¤´æ¨¡å¼Â  Â  options.add_argument("--headless")Â  Â Â Â  Â Â returnÂ options

### 2\. é«˜çº§è°ƒè¯•æŠ€å·§

#### è·å–æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—

    defÂ get_browser_logs(driver):Â  Â Â """Â  Â  è·å–æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—Â  Â  """Â  Â  logs = driver.get_log('browser')Â  Â Â returnÂ logsdefÂ print_browser_logs(driver):Â  Â Â """Â  Â  æ‰“å°æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—Â  Â  """Â  Â  logs = driver.get_log('browser')Â  Â Â forÂ logÂ inÂ logs:Â  Â  Â  Â  print(f"[{log['level']}]Â {log['message']}")