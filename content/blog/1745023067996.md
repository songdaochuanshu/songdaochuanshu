---
layout: post
title: 'å¾®ä¿¡å°ç¨‹åº/H5 è°ƒèµ·ç¡®è®¤æ”¶æ¬¾ç•Œé¢'
date: "2025-04-19T00:37:47Z"
---
å¾®ä¿¡å°ç¨‹åº/H5 è°ƒèµ·ç¡®è®¤æ”¶æ¬¾ç•Œé¢
=================

ğŸ§¾ å¾®ä¿¡å°ç¨‹åº/H5 è°ƒèµ·ç¡®è®¤æ”¶æ¬¾ç•Œé¢è¯¦è§£ï¼ˆé™„ä»£ç +å¹³å°å…¼å®¹å¤„ç†ï¼‰
----------------------------------

> åœºæ™¯ï¼šç”¨æˆ·ç‚¹å‡»ã€Œæ”¶æ¬¾ã€æŒ‰é’®åï¼Œç³»ç»Ÿè°ƒèµ·å¾®ä¿¡æ”¶æ¬¾ç»„ä»¶ï¼Œç”¨æˆ·ç¡®è®¤åå®Œæˆè½¬è´¦æˆ–æ”¶æ¬¾æµç¨‹ã€‚è¯¥èƒ½åŠ›å¹¿æ³›ç”¨äºç°é‡‘è¥é”€ã€äºŒæ‰‹äº¤æ˜“ã€ä½£é‡‘æŠ¥é…¬ã€ä¼ä¸šèµ”ä»˜ç­‰ä¸šåŠ¡åœºæ™¯ä¸­ã€‚

[å…·ä½“è§å®˜æ–¹æ–‡æ¡£](https://pay.weixin.qq.com/doc/v3/merchant/4012711988)
---------------------------------------------------------------

ğŸ’¡ èƒŒæ™¯
-----

å¾®ä¿¡å®˜æ–¹åœ¨å‰ä¿©æœˆæ›´æ–°äº† **requestMerchantTransfer** æ¥å£ï¼Œå…è®¸**å¾®ä¿¡å°ç¨‹åº**ä¸**H5 é¡µé¢**è°ƒèµ·ä¸€ä¸ªç”¨æˆ·ç¡®è®¤æ”¶æ¬¾çš„ç•Œé¢ï¼Œç”¨æˆ·åœ¨å®Œæˆç¡®è®¤åå³å¯å®Œæˆè½¬è´¦ã€‚

è¯¥ API å¯ç”¨äºå®ç°ï¼š

*   å•†æˆ·å¯¹ç”¨æˆ·æ‰“æ¬¾æ—¶è®©ç”¨æˆ·ç¡®è®¤ï¼ˆå¹³å°ä»£å‘ï¼‰
*   ç”¨æˆ·å‘å¦ä¸€ä¸ªç”¨æˆ·ç¡®è®¤æ”¶æ¬¾ï¼ˆç‚¹å¯¹ç‚¹æ”¶æ¬¾ï¼‰
*   é’±åŒ…æç°ç±»åº”ç”¨ï¼ˆå…ˆå±•ç¤ºè½¬è´¦è¯¦æƒ… â†’ ç”¨æˆ·åŒæ„ â†’ å‘èµ·æ‰“æ¬¾ï¼‰  
    ...

* * *

âš™ï¸ ä½¿ç”¨å‰æ
-------

### âœ… ç”³è¯·å‰æï¼š

*   éœ€è¦å¼€é€šå¾®ä¿¡æ”¯ä»˜å•†æˆ·å¹³å°çš„ **å•†å®¶è½¬è´¦åˆ°é›¶é’±** äº§å“æƒé™ï¼›
*   ç»‘å®šåˆ°å°ç¨‹åºæˆ–å…¬ä¼—å·ï¼›
*   éœ€è¦è®¾ç½® `mchId`ï¼ˆå•†æˆ·å·ï¼‰ã€`appId`ï¼ˆå½“å‰å°ç¨‹åº/å…¬ä¼—å·çš„ appidï¼‰ã€`package`ï¼ˆè®¢å•è¯¦æƒ…åŒ…ï¼‰ã€‚

* * *

ğŸ”„ æ”¯æŒçš„å¹³å°ï¼š
---------

å¹³å°

æ˜¯å¦æ”¯æŒ

è°ƒç”¨æ–¹å¼è¯´æ˜

å°ç¨‹åºç«¯

âœ… æ”¯æŒ

åŸç”Ÿ API `wx.requestMerchantTransfer`

å¾®ä¿¡å†… H5

âœ… æ”¯æŒ

é€šè¿‡ `WeixinJSBridge.invoke()` è°ƒç”¨

å¤–éƒ¨æµè§ˆå™¨

âŒ ä¸æ”¯æŒ

å¿…é¡»åœ¨å¾®ä¿¡å†…æ‰“å¼€ç½‘é¡µ

PC ç«¯å¾®ä¿¡

âŒ ä¸æ”¯æŒ

ä»…æ”¯æŒæ‰‹æœºå¾®ä¿¡ç«¯

> å¦å¤–å®˜æ–¹æç¤ºï¼šä½ç‰ˆæœ¬å¾®ä¿¡å®¢æˆ·ç«¯ã€ä½ç‰ˆæœ¬å°ç¨‹åºåŸºç¡€åº“ å‡ä¸æ”¯æŒ requestMerchantTransfer æ–¹æ³•ï¼Œéœ€åšå¥½å…¼å®¹æ€§å¤„ç†ã€‚

[APP å¦è§å®˜æ–¹æ–‡æ¡£ï¼Œæœ‰ Android å’Œ iOSï¼Œè¿™é‡Œä¸åšè¯¦ç»†è¯´æ˜](https://pay.weixin.qq.com/doc/v3/merchant/4012719576)

* * *

ğŸ”§ æ ¸å¿ƒä»£ç å®ç°
---------

ä»¥ä¸‹ä½¿ç”¨ uniapp ä¸ºå…¼å®¹å°ç¨‹åº + å¾®ä¿¡ H5 ä¸¤ç«¯çš„å®Œæ•´è°ƒç”¨æ–¹å¼ï¼ˆå¤åˆ¶åæ›´æ¢å‚æ•°å³å¯ä½¿ç”¨ï¼‰ï¼š

    getMoney(item) {
      const that = this;
      // åˆ¤æ–­å¹³å°  ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼ˆ// #ifdef MP-WEIXIN    // #endifï¼‰
      if (app.globalData.platform === 'wx') {
        // âœ… å°ç¨‹åºç«¯è°ƒç”¨æ–¹å¼
        wx.requestMerchantTransfer({
          mchId: item.mchid, // å•†æˆ·å·ï¼Œç”±å¾®ä¿¡æ”¯ä»˜ç”Ÿæˆå¹¶ä¸‹å‘
          appId: item.appid, // å•†æˆ·ç»‘å®šçš„AppIDï¼ˆä¼ä¸šå·corpidå³ä¸ºæ­¤AppIDï¼‰ï¼Œç”±å¾®ä¿¡ç”Ÿæˆï¼Œå¯åœ¨å…¬ä¼—å·åå°æŸ¥çœ‹
          package: item.package_info,  // å¯¹åº”å‘èµ·è½¬è´¦æ¥å£åº”ç­”å‚æ•°ä¸­çš„ package_infoï¼ˆä»…å½“è½¬è´¦å•æ®çŠ¶æ€ä¸ºWAIT_USER_CONFIRM: å¾…æ”¶æ¬¾ç”¨æˆ·ç¡®è®¤æ—¶æ‰è¿”å›ï¼‰ï¼Œç”¨äºå”¤èµ·ç”¨æˆ·ç¡®è®¤æ”¶æ¬¾é¡µé¢ã€‚
          success(res) {
            console.log('ç”¨æˆ·ç¡®è®¤æ”¶æ¬¾æˆåŠŸ', res);
            uni.showToast({
              title: 'æ”¶æ¬¾æˆåŠŸ',
              icon: 'success'
            });
            that.getdata(false, 1); // åˆ·æ–°æ•°æ®
          },
          fail(res) {
            console.error('ç”¨æˆ·ç¡®è®¤æ”¶æ¬¾å¤±è´¥', res);
            uni.showToast({
              title: 'æ”¶æ¬¾å¤±è´¥',
              icon: 'error'
            });
          },
          complete(res) {
            console.log('è¯·æ±‚å®Œæˆ', res);
          }
        });
      } else if (app.globalData.platform === 'h5') {   // ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼ˆ// #ifdef H5   // #endifï¼‰
        // âœ… H5è°ƒç”¨æ–¹å¼ï¼ˆç¡®ä¿åœ¨å¾®ä¿¡ç¯å¢ƒä¸­ï¼‰
        wx.ready(function() {
          wx.checkJsApi({
            jsApiList: ['requestMerchantTransfer'],
            success: function(res) {
              if (res.checkResult['requestMerchantTransfer']) {
                // H5ç«¯é€šè¿‡ WeixinJSBridge è°ƒç”¨
                WeixinJSBridge.invoke('requestMerchantTransfer', {
                  mchId: item.mchid,
                  appId: item.appid,
                  package: item.package_info,
                }, function(res) {
                  if (res.err_msg === 'requestMerchantTransfer:ok') {
                    uni.showToast({
                      title: 'æ”¶æ¬¾æˆåŠŸ',
                      icon: 'success'
                    });
                    that.getdata();  // åˆ·æ–°æ•°æ®
                  } else {
                    console.warn('ç”¨æˆ·å–æ¶ˆæˆ–æ”¶æ¬¾å¤±è´¥', res);
                  }
                });
              } else {
                alert('ä½ çš„å¾®ä¿¡ç‰ˆæœ¬è¿‡ä½ï¼Œè¯·æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬ã€‚');
              }
            }
          });
        });
      }
    }
    

* * *

ğŸ” è§£è¯»ï¼ˆå…³é”®ç‚¹è¯´æ˜ï¼‰
------------

å‚æ•°/é€»è¾‘

å«ä¹‰/è¯´æ˜

`mchId`

å¾®ä¿¡å•†æˆ·å¹³å°ä¸‹çš„å•†æˆ·å·

`appId`

å°ç¨‹åºæˆ–å…¬ä¼—å·çš„ AppID

`package`

å¾®ä¿¡æ”¯ä»˜å¹³å°è¿”å›çš„æ‰“æ¬¾è¯¦æƒ…ï¼ˆç»è¿‡åŠ å¯†ï¼‰

`wx.requestMerchantTransfer`

å°ç¨‹åºç«¯å†…ç½® APIï¼Œå‘èµ·è½¬è´¦ç¡®è®¤æµç¨‹

`WeixinJSBridge.invoke()`

å¾®ä¿¡ H5 ç«¯çš„ JS æ¡¥è°ƒç”¨ï¼Œç”¨äºå”¤èµ·æ”¯ä»˜ã€æ”¶æ¬¾ç­‰ç•Œé¢

`checkJsApi()`

æ£€æŸ¥å½“å‰å¾®ä¿¡ç‰ˆæœ¬æ˜¯å¦æ”¯æŒè¯¥ JS API

`err_msg: ok`

è¡¨ç¤ºç”¨æˆ·ç¡®è®¤äº†æ”¶æ¬¾ï¼Œæ‰ä¼šæ‰§è¡ŒæˆåŠŸé€»è¾‘

* * *

âš ï¸ å¸¸è§é—®é¢˜ & è¸©å‘æç¤º
--------------

*   **å°ç¨‹åºå†…è¯·ç¡®ä¿ AppID å·²é…ç½®è½¬è´¦æƒé™**ï¼Œå¦åˆ™ä¼šæŠ¥ã€Œæ— æƒé™ã€ï¼›
*   **H5 è°ƒç”¨å¿…é¡»åœ¨ `wx.ready()` ä¸­è¿›è¡Œï¼Œä¸”å‰ææ˜¯å…ˆæ³¨å…¥ JS-SDK ç­¾å**ï¼›
*   **å¾®ä¿¡ç‰ˆæœ¬ä½äº 7.0.20 å¯èƒ½ä¸æ”¯æŒè¯¥èƒ½åŠ›**ï¼›
*   **è¯·å‹¿åœ¨éå¾®ä¿¡æµè§ˆå™¨ä¸­æµ‹è¯• H5 ç«¯ï¼ŒWeixinJSBridge æ— æ³•æ³¨å…¥**ï¼›
*   **package å‚æ•°è¦ä»åç«¯è·å–ï¼Œä¸”åŠ¡å¿…æ³¨æ„åŠ å¯†ä¸ç­¾åæ ¡éªŒ**ï¼›

* * *

ğŸ“š å‚è€ƒé“¾æ¥ï¼š  
[å¾®ä¿¡å¼€æ”¾æ–‡æ¡£ï¼šrequestMerchantTransfer](https://pay.weixin.qq.com/doc/v3/merchant/4012716430)