---
layout: post
title: 'ã€URPã€‘Unity[è§†å·®è´´å›¾]æ¨¡æ‹Ÿ[å†°é¢è£‚ç¼]å®è·µ'
date: "2025-10-27T00:44:43Z"
---
ã€URPã€‘Unity\[è§†å·®è´´å›¾\]æ¨¡æ‹Ÿ\[å†°é¢è£‚ç¼\]å®è·µ
==============================

![ã€URPã€‘Unity[è§†å·®è´´å›¾]æ¨¡æ‹Ÿ[å†°é¢è£‚ç¼]å®è·µ](https://img2024.cnblogs.com/blog/3685400/202510/3685400-20251026184420384-1631525516.png) Unity URP å†°é¢è£‚ç¼è§†å·®æ•ˆæœå®ç°æ–¹æ¡ˆ å†°é¢è£‚ç¼æ•ˆæœä¼˜åŒ–çš„URP Shaderå®ç°ã€‚è¯¥æ–¹æ¡ˆé€šè¿‡â€Œè§†å·®é®æŒ¡è´´å›¾(POM)â€ŒæŠ€æœ¯å¢å¼ºæ·±åº¦è¡¨ç°ï¼Œç»“åˆâ€Œé«˜åº¦å›¾åŠ¨æ€æ§åˆ¶â€Œå®ç°å¯è°ƒèŠ‚çš„å†°ç¼è£‚ç—•æ•ˆæœã€‚ æ ¸å¿ƒç‰¹

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

**Unity URP å†°é¢è£‚ç¼è§†å·®æ•ˆæœå®ç°æ–¹æ¡ˆ**
==========================

å†°é¢è£‚ç¼æ•ˆæœä¼˜åŒ–çš„URP Shaderå®ç°ã€‚è¯¥æ–¹æ¡ˆé€šè¿‡â€Œ**è§†å·®é®æŒ¡è´´å›¾(POM)**â€ŒæŠ€æœ¯å¢å¼ºæ·±åº¦è¡¨ç°ï¼Œç»“åˆâ€Œ**é«˜åº¦å›¾åŠ¨æ€æ§åˆ¶**â€Œå®ç°å¯è°ƒèŠ‚çš„å†°ç¼è£‚ç—•æ•ˆæœã€‚

**æ ¸å¿ƒç‰¹æ€§**
========

*   â€Œ**ç‰©ç†ç²¾ç¡®çš„è£‚ç¼æ·±åº¦**â€Œé‡‡ç”¨å…‰çº¿æ­¥è¿›ç®—æ³•ç²¾ç¡®è®¡ç®—å†°ç¼å‡ ä½•å½¢çŠ¶ï¼Œé€šè¿‡`_DepthMultiplier`å‚æ•°æ§åˆ¶è£‚ç¼è§†è§‰æ·±åº¦
*   â€Œ**å†°é¢å…‰å­¦ç‰¹æ€§æ¨¡æ‹Ÿ**â€Œæ·»åŠ æŠ˜å°„ç‡å‚æ•°(`_RefractionIndex`)å’Œè²æ¶…å°”æ•ˆåº”ï¼Œå¢å¼ºå†°é¢åŠé€æ˜è´¨æ„Ÿ
*   â€Œ**æ€§èƒ½ä¼˜åŒ–**â€ŒåŠ¨æ€é‡‡æ ·å±‚æ•°æ§åˆ¶(8-12å±‚)ï¼Œåœ¨ç§»åŠ¨ç«¯ä¿æŒ30fpsä»¥ä¸Šæµç•…åº¦

* * *

**å®Œæ•´HLSLä»£ç å®ç°**
==============

**å…³é”®å‚æ•°è¯´æ˜**
----------

*   â€Œ**é«˜åº¦å›¾æ§åˆ¶**â€Œ`_DepthMultiplier`å‚æ•°åŠ¨æ€è°ƒèŠ‚å†°ç¼è§†è§‰æ·±åº¦ï¼Œå€¼è¶Šå¤§è£‚ç¼è¶Šæ·±
    
*   â€Œ**å…‰å­¦å‚æ•°**â€Œ`_RefractionIndex`æ§åˆ¶å†°é¢æŠ˜å°„ç‡ï¼Œ`_FresnelPower`è°ƒæ•´è¾¹ç¼˜é«˜å…‰å¼ºåº¦
    
*   â€Œ**æ€§èƒ½æ§åˆ¶**â€Œ`minSamples`å’Œ`maxSamples`æ§åˆ¶å…‰çº¿æ­¥è¿›ç²¾åº¦ï¼Œç§»åŠ¨ç«¯å»ºè®®8-10å±‚
    
*   IceCrackPOM.shader
    
        Shader "Universal Render Pipeline/IceCrackPOM"
        {
            Properties
            {
                [Header(Base Textures)]
                _MainTex("Albedo (RGB) Ice Color", 2D) = "white" {}
                _NormalMap("Normal Map", 2D) = "bump" {}
                _HeightMap("Height Map (Ice Cracks)", 2D) = "white" {}
        
                [Header(Parallax Settings)]
                _ParallaxScale("Crack Depth Scale", Range(0, 0.2)) = 0.08
                _DepthMultiplier("Depth Multiplier", Range(0.5, 3)) = 1.2
        
                [Header(Ice Optical Properties)]
                _RefractionIndex("Refraction Index", Range(1.1, 1.5)) = 1.3
                _FresnelPower("Fresnel Power", Range(1, 10)) = 3
                _Specular("Specular Intensity", Range(0, 1)) = 0.5
            }
        
            SubShader
            {
                Tags { "RenderType"="Transparent" "Queue"="Transparent" }
        
                HLSLINCLUDE
                #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
                #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Lighting.hlsl"
        
                TEXTURE2D(_MainTex);    SAMPLER(sampler_MainTex);
                TEXTURE2D(_NormalMap);  SAMPLER(sampler_NormalMap);
                TEXTURE2D(_HeightMap);  SAMPLER(sampler_HeightMap);
        
                float _ParallaxScale;
                float _DepthMultiplier;
                float _RefractionIndex;
                float _FresnelPower;
                float _Specular;
        
                // å†°é¢è£‚ç¼POMè®¡ç®—
                float2 IceParallaxOcclusion(float3 viewDirTS, float2 uv)
                {
                    int minSamples = 8;
                    int maxSamples = 12;
                    int numSamples = (int)lerp(maxSamples, minSamples, saturate(dot(float3(0,0,1), viewDirTS)));
        
                    float layerHeight = 1.0 / numSamples;
                    float2 deltaUV = _ParallaxScale * viewDirTS.xy / viewDirTS.z / numSamples * _DepthMultiplier;
        
                    float currentLayerHeight = 0;
                    float2 currentUV = uv;
                    float currentDepth = 1 - SAMPLE_TEXTURE2D(_HeightMap, sampler_HeightMap, currentUV).r;
        
                    [loop]
                    for (int i = 0; i < maxSamples; ++i) {
                        if (currentLayerHeight >= currentDepth) break;
                        currentUV -= deltaUV;
                        currentDepth = 1 - SAMPLE_TEXTURE2D(_HeightMap, sampler_HeightMap, currentUV).r;
                        currentLayerHeight += layerHeight;
                    }
        
                    // äºŒåˆ†æ³•ç²¾ç¡®ä¿®æ­£
                    float2 prevUV = currentUV + deltaUV;
                    float prevDepth = currentDepth - layerHeight;
                    float weight = (currentLayerHeight - currentDepth) / (prevDepth - currentDepth + 0.001);
                    return lerp(currentUV, prevUV, weight);
                }
        
                // å†°é¢è²æ¶…å°”æ•ˆåº”
                float IceFresnel(float3 viewDirWS, float3 normalWS)
                {
                    float fresnel = pow(1.0 - saturate(dot(viewDirWS, normalWS)), _FresnelPower);
                    return fresnel * 0.7;
                }
                ENDHLSL
        
                Pass
                {
                    Blend SrcAlpha OneMinusSrcAlpha
                    ZWrite Off
        
                    HLSLPROGRAM
                    #pragma vertex vert
                    #pragma fragment frag
        
                    struct Attributes
                    {
                        float4 positionOS : POSITION;
                        float2 uv : TEXCOORD0;
                        float3 normalOS : NORMAL;
                        float4 tangentOS : TANGENT;
                    };
        
                    struct Varyings
                    {
                        float4 positionCS : SV_POSITION;
                        float2 uv : TEXCOORD0;
                        float3 viewDirTS : TEXCOORD1;
                        float3 viewDirWS : TEXCOORD2;
                        float3 normalWS : TEXCOORD3;
                    };
        
                    Varyings vert(Attributes IN)
                    {
                        Varyings OUT;
                        VertexPositionInputs posInput = GetVertexPositionInputs(IN.positionOS.xyz);
                        OUT.positionCS = posInput.positionCS;
        
                        VertexNormalInputs normInput = GetVertexNormalInputs(IN.normalOS, IN.tangentOS);
                        float3 viewDirWS = GetWorldSpaceViewDir(posInput.positionWS);
                        OUT.viewDirTS = TransformWorldToTangent(viewDirWS, 
                            normInput.tangentWS, normInput.bitangentWS, normInput.normalWS);
                        OUT.viewDirWS = viewDirWS;
                        OUT.normalWS = normInput.normalWS;
        
                        OUT.uv = IN.uv;
                        return OUT;
                    }
        
                    half4 frag(Varyings IN) : SV_Target
                    {
                        // è®¡ç®—POMåç§»UV
                        float2 pomUV = IceParallaxOcclusion(normalize(IN.viewDirTS), IN.uv);
        
                        // é‡‡æ ·çº¹ç†
                        half4 albedo = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, pomUV);
                        half3 normalTS = UnpackNormal(SAMPLE_TEXTURE2D(_NormalMap, sampler_NormalMap, pomUV));
        
                        // è½¬æ¢æ³•çº¿åˆ°ä¸–ç•Œç©ºé—´
                        float3x3 TBN = float3x3(
                            normalize(cross(IN.normalWS, IN.viewDirWS)),
                            normalize(IN.normalWS),
                            normalize(IN.viewDirWS)
                        );
                        float3 normalWS = mul(TBN, normalTS);
        
                        // å†°é¢å…‰å­¦æ•ˆæœ
                        float fresnel = IceFresnel(normalize(IN.viewDirWS), normalWS);
                        float3 refractedView = refract(-normalize(IN.viewDirWS), normalWS, 1.0/_RefractionIndex);
        
                        // åˆæˆæœ€ç»ˆé¢œè‰²
                        half3 finalColor = albedo.rgb * (1 - fresnel) + fresnel * 0.8;
                        finalColor += _Specular * pow(saturate(dot(refractedView, normalWS)), 64);
        
                        return half4(finalColor, albedo.a * 0.9);
                    }
                    ENDHLSL
                }
            }
        }
        
    

* * *

**æè´¨é…ç½®å»ºè®®**
----------

çº¹ç†ç±»å‹

åˆ¶ä½œè¦æ±‚

ç¤ºä¾‹ç”¨é€”

é«˜åº¦å›¾

é»‘ç™½åˆ†æ˜ï¼Œè£‚ç¼å¤„ä¸ºé»‘è‰²(0å€¼)

æ§åˆ¶è£‚ç¼å½¢çŠ¶å’Œæ·±åº¦

æ³•çº¿è´´å›¾

é…åˆé«˜åº¦å›¾åˆ¶ä½œå¾®è§‚å‡¹å‡¸

å¢å¼ºå†°é¢æ™¶ä½“è´¨æ„Ÿ

åº•è‰²è´´å›¾

åŠé€æ˜è“è‰²è°ƒï¼Œå¸¦è£‚çº¹è¾¹ç¼˜é«˜å…‰

åŸºç¡€é¢œè‰²å’Œé€æ˜åº¦æ§åˆ¶

å®é™…åº”ç”¨ä¸­å¯é€šè¿‡è°ƒæ•´`_ParallaxScale`(0.05-0.1)å’Œ`_DepthMultiplier`(1.0-2.0)è·å¾—ä¸åŒç»“å†°ç¨‹åº¦æ•ˆæœ

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**  
> ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰