---
layout: post
title: 'è§£å¯†promptç³»åˆ—60. Agentå®æˆ˜ï¼šä»0æ­å»ºJupteræ•°æ®åˆ†ææ™ºèƒ½ä½“'
date: "2025-09-08T00:41:37Z"
---
è§£å¯†promptç³»åˆ—60. Agentå®æˆ˜ï¼šä»0æ­å»ºJupteræ•°æ®åˆ†ææ™ºèƒ½ä½“
=======================================

![è§£å¯†promptç³»åˆ—60. Agentå®æˆ˜ï¼šä»0æ­å»ºJupteræ•°æ®åˆ†ææ™ºèƒ½ä½“](https://img2024.cnblogs.com/blog/1326688/202509/1326688-20250908074115464-911536554.png) æœ¬æ–‡å°†å¸¦ä½ ä»é›¶æ­å»ºä¸€ä¸ªæ•°æ®åˆ†ææ™ºèƒ½ä½“ï¼Œå®ç°ç”¨æˆ·ä¸Šä¼ Excelå¹¶ç»™å‡ºæŒ‡ä»¤åï¼Œæ™ºèƒ½ä½“èƒ½å¤Ÿæ·±å…¥åˆ†ææ•°æ®ã€è¿›è¡Œå¯è§†åŒ–ï¼Œå¹¶ä»¥Jupyter Notebookå½¢å¼è¿”å›ç»“æœã€‚æˆ‘ä»¬å°†é‡ç‚¹è®¨è®ºä»¥ä¸‹æ ¸å¿ƒè¦ç‚¹ï¼šæ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼ã€Context Engineeringã€å¤æ‚ä»»åŠ¡Promptè®¾è®¡

æœ¬æ–‡å°†å¸¦ä½ ä»é›¶æ­å»ºä¸€ä¸ªæ•°æ®åˆ†ææ™ºèƒ½ä½“ï¼Œå®ç°ç”¨æˆ·ä¸Šä¼ Excelå¹¶ç»™å‡ºæŒ‡ä»¤åï¼Œæ™ºèƒ½ä½“èƒ½å¤Ÿæ·±å…¥åˆ†ææ•°æ®ã€è¿›è¡Œå¯è§†åŒ–ï¼Œå¹¶ä»¥Jupyter Notebookå½¢å¼è¿”å›ç»“æœã€‚æˆ‘ä»¬å°†é‡ç‚¹è®¨è®ºä»¥ä¸‹æ ¸å¿ƒè¦ç‚¹ï¼š

*   æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼ï¼šä¸ºä½•å…¨è‡ªåŠ¨Reactæ¨¡å¼å¯è¡Œä½†å¹¶éæœ€ä¼˜è§£
*   Context Engineeringï¼šå¦‚ä½•é€šè¿‡ä¸Šä¸‹æ–‡ç®¡ç†æ€è·¯ä¼˜åŒ–æ•ˆæœ
*   å¤æ‚ä»»åŠ¡Promptè®¾è®¡ï¼šMeta Prompt + é¢†åŸŸæœ€ä½³å®è·µçš„é«˜æ•ˆç»„åˆ

å®Œæ•´Agentä»£ç è¯¦è§[DAAgent](https://github.com/DSXiangLi/DAAgent)

æ™ºèƒ½ä½“è®¾è®¡
-----

æ•°æ®åˆ†ææ™ºèƒ½ä½“æœ¬è´¨ä¸Šæ˜¯å…·å¤‡ç¼–ç èƒ½åŠ›ã€èƒ½å¤Ÿä½¿ç”¨ç¼–ç¨‹å·¥å…·çš„æ™ºèƒ½ä½“ã€‚è€ƒè™‘åˆ°å•æ¬¡ç¼–ç å¯èƒ½ä¸å®Œå–„ï¼Œéœ€è¦å¤šè½®è¿­ä»£è°ƒè¯•ä¼˜åŒ–ï¼Œæœ€ç®€å•çš„å®ç°æ–¹å¼æ˜¯é‡‡ç”¨Reactç­–ç•¥ï¼Œè®©æ¨¡å‹ä¸æ–­ç¼–å†™å’Œä¼˜åŒ–ä»£ç ã€‚

ä½†çº¿æ€§Reactæ¨¡å¼å¾ˆå¿«ä¼šé‡åˆ°ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š

*   **æ¨¡å‹ä¸Šæ–‡å¾ˆå¿«è€—å°½**ï¼šcodingæ˜¯å¾ˆè´¹tokençš„ï¼Œå°¤å…¶tracebackæ›´æ˜¯é•¿çš„ç¦»è°±ï¼Œæ‰€ä»¥å¾ˆå¿«å°±æŠ¥token limitäº†
*   **çº¿æ€§æ¨¡å¼å­˜åœ¨æ¨ç†æƒ¯æ€§**ï¼šåŒæ ·å› ä¸ºä¸Šæ–‡å¤ªé•¿ï¼Œæ¨¡å‹åœ¨ä¿®å¤é—®é¢˜æ—¶ä¼šè®©åˆ†æä¹Ÿé™äºå±€éƒ¨ä¼˜åŒ–ï¼Œæ•´ä¸ªæ•°æ®åˆ†æä¼šç®€å•ï¼Œå¹¿åº¦å’Œæ·±åº¦éƒ½ä¸è¶³

ä¸ºè§£å†³ä»¥ä¸Š**çº¿æ€§REACT**çš„é—®é¢˜ï¼Œæˆ‘ä»¬åŠ å…¥Planæ¨¡å—ï¼Œå…ˆå¯¹é—®é¢˜è¿›è¡Œæ‹†è§£ï¼Œå†è®©REACTå»è§£å†³æ¯ä¸ªå±€éƒ¨é—®é¢˜ï¼Œåªè¦**å­é—®é¢˜è¶³å¤Ÿèšç„¦**ï¼Œä»¥ä¸Šä¸¤ä¸ªé—®é¢˜å°±éƒ½èƒ½è§„é¿ã€‚

äºæ˜¯æˆ‘ä»¬ç¬¬ä¸€ç‰ˆData Agentçš„è®¾è®¡æ€è·¯å°±æœ‰äº†ï¼ŒåŒ…å«ä»¥ä¸‹3ä¸ªæ¨¡å—

*   Plannerï¼šå°†æ•°æ®åˆ†æä»»åŠ¡æ‹†è§£ä¸ºå¤šä¸ªä¸²è”æ­¥éª¤
*   Publisherï¼šéå†Planç”Ÿæˆçš„æ­¥éª¤ï¼Œåˆ†å‘ç»™Coderæ‰§è¡Œ
*   coderï¼šåŸºäºå½“å‰æ­¥éª¤ç”Ÿæˆä»£ç ï¼Œé€šè¿‡å¤šè½®å¾ªç¯ä¼˜åŒ–ç›´è‡³æ‰§è¡ŒæˆåŠŸ

ä¸‹é¢æˆ‘ä»¬ä¾æ¬¡è¯´ä¸‹è¿™ä¸‰ä¸ªæ¨¡å—ï¼Œå’Œä¸­é—´æ¶‰åŠåˆ°çš„context engineeringï¼Œmeta promptingï¼ŒMCPä½¿ç”¨çš„ä¸€äº›é—®é¢˜å’Œç»†èŠ‚ã€‚

Planner
-------

Planneré‡‡ç”¨ç»“æ„åŒ–æ¨ç†ï¼Œè¾“å‡ºä»¥ä¸‹Planç»“æ„ä½“ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€æ¬¡æ€§è§„åˆ’æ¨¡å¼ï¼Œè¾“å…¥ä»…åŒ…å«æ–‡ä»¶é¢„è§ˆå’Œç”¨æˆ·æŸ¥è¯¢ï¼Œä¸åŸºäºåç»­ç¼–ç åé¦ˆè°ƒæ•´è§„åˆ’ï¼ˆç®€å•æ¶æ„èƒ½é¿å…è®¸å¤šå¤æ‚é—®é¢˜ï¼‰ã€‚

    class Plan(BaseModel):
        reasoning: str = Field(description='step by stepçš„åˆ†æ')
        task: str = Field(description='åˆ†æä»»åŠ¡åç§°')
        steps: List[str] = Field(description='æ‹†è§£çš„åˆ†ææ­¥éª¤')
    
    class Status(str, Enum):
        waiting = 'WAITING'
        finish = 'FINISH'
        fail = 'FAIL'
        in_progress = 'IN-PROGRESS'
    
    
    class StepStatus(TypedDict):
        description: str
        observation: str
        status: Status
    async def plan(state: CodeState, config: RunnableConfig, writer: StreamWriter):
        """
        åˆ›å»ºæ•°æ®åˆ†æè®¡åˆ’
        """
        configurable = Configuration.from_runnable_config(config)
        llm = ChatDeepSeek(
            api_key=os.environ['LLM_APIKEY'],
            api_base=os.environ['LLM_URL'],
            model=configurable.plan_model
        )
    
        prompt = get_prompt_template(name="plan", input_vars={"table": state['data'].head(10).to_markdown()})
    
        messages = [{"role": "system", "content": prompt},
                    {"role": "user", "content": state["query"]}]
    
        output = llm.with_structured_output(Plan, method='json_mode').invoke(messages)
        writer(f'åˆ›å»ºæ•°æ®åˆ†æè®¡åˆ’ï¼š{output.task}\n' + '\n'.join(output.steps))
        steps = [StepStatus(description=i, observation='', status=Status.waiting) for i in output.steps]
    
        return {"task": output.task, "steps": steps}
    

Plançš„System Promptï¼Œæˆ‘ä½¿ç”¨äº†Meta-promptingé…åˆæ¨¡å‹æ¢³ç†çš„æ•°æ®åˆ†æï¼ˆEDAï¼‰çš„æœ€ä½³å®è·µæŒ‡å—æ¥ç”Ÿæˆã€‚å‰é¢åœ¨[Agent Context Engineering - å¤šæ™ºèƒ½ä½“ä»£ç å‰–æ](https://cloud.tencent.com/developer/article/2541926)æˆ‘ä»¬æœ‰æè¿‡meta-promptingï¼Œä»Šå¤©å†å¢åŠ ä¸€ä¸ªå°±æ˜¯**é¢†åŸŸæœ€ä½³å®è·µ**æ¦‚å¿µã€‚

æ ‡å‡†åŒ–ä»»åŠ¡å¦‚ç¼–ç ã€å†™ä½œéƒ½å¯ä»¥ç”¨MetaPromptè‡ªåŠ¨è¡¥å……ä»»åŠ¡ç»†èŠ‚ï¼Œä½†è¿™æ ·ç”Ÿæˆçš„Promptå¾€å¾€æ™®é€šï¼Œå› ä¸ºå®ƒåªæ˜¯éšæœºé‡‡æ ·çš„ä¸€æ¡å¯è¡Œè·¯å¾„è€Œéæœ€ä¼˜è·¯å¾„ã€‚

è¿™æ—¶å°±æœ‰ä¸¤ç§ç®€å•çš„ä¼˜åŒ–æ€è·¯ï¼š

*   **å‰ç½®å¼•å…¥ä¸“å®¶ç»éªŒ**ï¼šåŸºäºè¯¥é¢†åŸŸä¸“å®¶ç»éªŒæŠ½è±¡æˆæœ€ä½³å®è·µ
*   **åç½®ä¸æ–­æ€»ç»“ç»éªŒ**ï¼šåŸºäºæµ‹è¯•é›†è¿è¡Œçš„ç»“æœè¿›è¡Œå¸¸è§é—®é¢˜çš„æŠ½è±¡å¹¶ä¼˜åŒ–promptï¼ˆå¹¶ä¸æ¨èäººå·¥æ€»ç»“ï¼Œå› ä¸ºhuman prior!=machine priorï¼‰

è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æ–¹æ¡ˆ1ï¼Œç›´æ¥ç”¨DeepSeekè”ç½‘æ€»ç»“Kaagle GrandMasteråœ¨æ•°æ®EDAä¸Šçš„ä¸“å®¶ç»éªŒå’Œæµç¨‹å†è¾“å…¥Meta Promptå°±å¾—åˆ°äº†ä»¥ä¸‹system Prompt

    ä½œä¸ºGoogleçš„é¡¶å°–æ•°æ®åˆ†æå’Œå¯è§†åŒ–ä¸“å®¶ï¼Œè¯·ä¸¥æ ¼æŒ‰ä»¥ä¸‹æ•°æ®åˆ†ææ­¥éª¤å’Œåˆ†æè¦ç‚¹å¤„ç†ç”¨æˆ·æäº¤çš„Excelè¡¨æ ¼å’Œåˆ†æè¦æ±‚,å¹¶æŒ‰ç…§è¾“å‡ºæ ¼å¼ç›´æ¥è¾“å‡ºJSON
    
    ## Excelè¡¨æ ¼
    
    {{table}}
    
    ## å½“å‰æ—¶é—´
    
    {{current_date}}
    
    ## æ•°æ®åˆ†ææ­¥éª¤
    
    1. æ•°æ®åˆçª¥ä¸è´¨é‡è¯„ä¼°
       **ç›®æ ‡**ï¼šäº†è§£æ•°æ®åŸå§‹é¢è²Œå’ŒåŸºæœ¬å¥åº·çŠ¶å†µ
       - æŸ¥çœ‹æ•°æ®å½¢çŠ¶ã€ç±»å‹å’ŒåŸºæœ¬ç»Ÿè®¡ä¿¡æ¯
       - è¯†åˆ«ç¼ºå¤±å€¼å’Œé‡å¤å€¼
       - ç†è§£å­—æ®µä¸šåŠ¡å«ä¹‰
    
    2. æ•°æ®æ¸…æ´—ä¸é¢„å¤„ç†
       **ç›®æ ‡**ï¼šè§£å†³æ•°æ®è´¨é‡é—®é¢˜ï¼Œå‡†å¤‡å¹²å‡€æ•°æ®
       - æŒ‰ç­–ç•¥å¤„ç†ç¼ºå¤±å€¼ï¼ˆåˆ é™¤/å¡«å……/æ ‡è®°ï¼‰
       - è¯†åˆ«å¹¶åˆç†å¤„ç†å¼‚å¸¸å€¼ï¼ˆä¸ç›²ç›®åˆ é™¤ï¼‰
       - ç»Ÿä¸€æ•°æ®æ ¼å¼å’Œç±»åˆ«å‘½å
    
    3. å•å˜é‡åˆ†æ
       **ç›®æ ‡**ï¼šæ·±å…¥ç†è§£æ¯ä¸ªå˜é‡çš„åˆ†å¸ƒç‰¹å¾
       - æ•°å€¼å˜é‡ï¼šåˆ†æåˆ†å¸ƒã€ååº¦å’Œå³°åº¦
       - åˆ†ç±»å˜é‡ï¼šæ£€æŸ¥é¢‘æ¬¡å’Œç±»åˆ«å¹³è¡¡
       - è®°å½•éœ€è¦è¿›è¡Œçš„è½¬æ¢ï¼ˆå¦‚å¯¹æ•°å˜æ¢ï¼‰
    
    4. å¤šå˜é‡åˆ†æä¸å¯è§†åŒ–
       **ç›®æ ‡**ï¼šæ¢ç´¢å˜é‡é—´å…³ç³»ï¼Œå‘ç°æ•°æ®æ¨¡å¼
       - æ•°å€¼vsæ•°å€¼ï¼šæ•£ç‚¹å›¾+ç›¸å…³çŸ©é˜µ
       - åˆ†ç±»vsæ•°å€¼ï¼šå°æç´å›¾/ç®±çº¿å›¾
       - åˆ†ç±»vsåˆ†ç±»ï¼šå †å æ¡å½¢å›¾+å¡æ–¹æ£€éªŒ
       - æ—¶é—´åºåˆ—ï¼šæŠ˜çº¿å›¾+æ»šåŠ¨ç»Ÿè®¡é‡
    
    5. ç®€å•å»ºæ¨¡è¾…åŠ©åˆ†æ
       **ç›®æ ‡**ï¼šç”¨é‡åŒ–æ–¹æ³•éªŒè¯åˆ†æå‘ç°
       - çº¿æ€§å›å½’ï¼šå…³æ³¨ç³»æ•°è€ŒéRÂ²
       - å†³ç­–æ ‘/éšæœºæ£®æ—ï¼šåˆ†æç‰¹å¾é‡è¦æ€§
       - æ‰€æœ‰åˆ†æä»¥ç†è§£å…³ç³»ä¸ºç›®çš„ï¼Œè€Œéé¢„æµ‹ç²¾åº¦
    
    6. æŠ¥å‘Šç”Ÿæˆ
       **è¾“å‡º**ï¼šåŒ…å«æ•°æ®è´¨é‡æŠ¥å‘Šã€å…³é”®å‘ç°ã€å¯è§†åŒ–å›¾è¡¨å’Œå»ºè®®çš„æ•°æ®åˆ†ææŠ¥å‘Š
    
    ## æ•°æ®åˆ†æè¦ç‚¹
    
    1. **éœ€æ±‚è§£æ**
        - æ˜ç¡®ç”¨æˆ·æ ¸å¿ƒåˆ†æç›®æ ‡åŠæ½œåœ¨éœ€æ±‚
        - åˆ¤æ–­éœ€åŠ å¼ºåˆ†æçš„éšè—ç»´åº¦ï¼ˆå¦‚æ•°æ®å¯¹æ¯”/èšåˆç»´åº¦ï¼‰
    2. **æ–¹æ¡ˆè®¾è®¡**
        - åŸºäºç›®æ ‡å®šåˆ¶åˆ†æè·¯å¾„ï¼ˆæè¿°æ€§/é¢„æµ‹æ€§/è¯Šæ–­æ€§åˆ†æï¼‰
        - æŒ‰ä¼˜å…ˆçº§åŒ¹é…å¯è§†åŒ–æ–¹æ¡ˆï¼ˆå¦‚åŠ¨æ€ä»ªè¡¨ç›˜>é™æ€å›¾è¡¨ï¼‰
    3. **åå‘å·¥ç¨‹éªŒè¯**
        - è®ºè¯æ¯ä¸ªåˆ†ææ­¥éª¤å¦‚ä½•è§£å†³æ ¸å¿ƒéœ€æ±‚
        - ç¡®è®¤å¯è§†åŒ–ç±»å‹ä¸æ•°æ®ç‰¹æ€§çš„é€‚é…æ€§
    
    ## å…³é”®è¦æ±‚
    
    - â— æ¨ç†(reasoning)å¿…é¡»åŒ…å«ï¼šæ•°æ®ç‰¹å¾å‘ç° â†’ éœ€æ±‚æ‹†è§£ â†’ æ–¹æ¡ˆæ¨å¯¼çš„å®Œæ•´é€»è¾‘é“¾
    - âœ–ï¸ ç¦æ­¢åœ¨reasoningå‡ºç°ç»“è®ºæ€§è¯­å¥ï¼ˆç»“è®ºä»…å‡ºç°åœ¨stepsä¸­ï¼‰
    - ä½¿ç”¨æ–¹æ‹¬å·æ ‡æ³¨ç¤ºä¾‹ä¸­çš„åŠ¨æ€å‚æ•°ï¼ˆå¦‚ [æŒ‡æ ‡å]ï¼‰
    - JSONé”®åä¸¥æ ¼ä¿æŒåŸæ–‡æ ¼å¼ï¼Œä¸æ·»åŠ æ³¨é‡Šæˆ–é¢å¤–å­—æ®µ
    - stepséœ€åŒ…å«å…·ä½“æŠ€æœ¯å®ç°ï¼ˆå¦‚ï¼š"ä½¿ç”¨PCAé™ç»´åç”Ÿæˆ3Dæ•£ç‚¹å›¾"ï¼‰
    - è‹¥åŸå§‹éœ€æ±‚æ¨¡ç³Šï¼Œéœ€åœ¨reasoningä¸­åæ¨åˆç†åˆ†æè·¯å¾„
    - æ— éœ€è¾“å‡º```json```ï¼Œç›´æ¥è¾“å‡ºJSON
    
    ## è¾“å‡ºæ ¼å¼
    
    {
    "reasoning": "åˆ†æ­¥æ•°æ®è§‚å¯Ÿå’Œéœ€æ±‚è§£æè¿‡ç¨‹ï¼ˆå…ˆåˆ†æåç»“è®ºï¼‰",
    "task": "â‰¤15å­—åˆ†æä»»åŠ¡æ ‡é¢˜",
    "steps": [
        "æ­¥éª¤1: [å¦‚: è§‚æµ‹è¡¨æ ¼æ•°æ®å¹¶æ£€æŸ¥æ•°æ®è´¨é‡]",
        "æ­¥éª¤2: [å¦‚: è¿›è¡Œæ•°æ®æ¸…æ´—å’Œå¿…è¦å­—æ®µå½’ä¸€åŒ–å¤„ç†]",
    ]
    }
    

ä»¥ä¸‹å°±æ˜¯ç»“æ„åŒ–æ¨ç†å¾—åˆ°çš„æ•°æ®åˆ†æä»»åŠ¡å’Œ8ä¸ªä¸²è”çš„æ‰§è¡Œæ­¥éª¤

> ä¸ªäººè¿˜æ˜¯æ¯”è¾ƒå€¾å‘äºç›´æ¥ä½¿ç”¨å®˜æ–¹APIï¼Œè€ŒélangchianåŒ…è£…çš„å„ç§structure outputï¼Œbind toolså•¥çš„llmæ¨ç†æ¥å£ï¼Œå› ä¸ºlangchainå¢åŠ äº†æŠ¥é”™æ’æŸ¥çš„éš¾åº¦ä»¥åŠé—®é¢˜éšè—çš„æ·±åº¦ã€‚æœ‰ä¸ªæ¢—å°±æ˜¯å¼€å‘è¶Šå¿«çš„å·¥å…·debugè¶Šæ…¢~

Publisher
---------

ç”Ÿæˆåˆ†æä»»åŠ¡åå°±ä¼šè¿›å…¥ä»»åŠ¡åˆ†å‘èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ä¸åšæ¨¡å‹æ¨ç†ï¼Œåªåšä»»åŠ¡çŠ¶æ€ç®¡ç†å’Œåˆ†å‘ï¼Œå±äºä¸­è½¬èŠ‚ç‚¹ã€‚codingæ¯å®Œæˆä¸€ä¸ªstepä»»åŠ¡ï¼Œä¼šé‡æ–°å›åˆ°publisherï¼Œä¿®æ”¹ä»»åŠ¡çŠ¶æ€ï¼Œå†è¿›å…¥æ–°çš„ä¸€è½®ä»»åŠ¡æ‰§è¡Œï¼Œå¦‚ä¸‹

    async def publisher(state: CodeState, writer: StreamWriter) -> Command[Literal["__end__", "coding"]]:
        """
        åˆ†å‘æ•°æ®åˆ†æä»»åŠ¡ï¼Œåˆ¤æ–­ä»»åŠ¡å®ŒæˆçŠ¶æ€
        """
        steps = state['steps']
        # æ¯æ¬¡è¿›å…¥éƒ½å°è¯•è·å–æœ€æ–°çš„ipynb
        tools = await mcp_client.get_tools()
        stop_tool = [i for i in tools if i.name == 'close_sandbox'][0]
        # æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œåˆ™åˆ¤æ–­å®Œæˆ
        if all([i['status'] != Status.waiting for i in steps]):
            writer('æ‰€æœ‰æ­¥éª¤æ‰§è¡Œå®Œæ¯•ï¼')
            return Command(goto='__end__')
    
        # æ‰¾åˆ°ä¸‹ä¸€ä¸ªå¾…æ‰§è¡Œçš„ä»»åŠ¡,æ¸…ç©ºå†å²code messageå’Œobservationså¹¶å¼€å§‹æ‰§è¡Œ
        for step in steps:
            if step['status'] == Status.waiting:
                step['status'] = Status.in_progress
                writer(f'æ‰§è¡Œæ­¥éª¤-{step["description"]}')
                break
    
        return Command(goto='coding', update={"steps": steps,
                                              # æ¸…ç©ºstepå†…ä¼ é€’ä¿¡æ¯
                                              "code_messages": ["CLEAR"],
                                              "step_observations": ["CLEAR"],
                                              "step_observations_clean": ["CLEAR"],
                                              "code_round": 0,
                                              # å¤šæ­¥stepä¿¡æ¯ç´¯è®¡
                                              "observations": state["step_observations_clean"]})
    
    

è¿™é‡Œç”¨åˆ°**Context Engineer-è¿‡æ»¤å¤§æ³•**ï¼Œä»ä»»åŠ¡åˆ†å‘ä¸Šå¯ä»¥çœ‹å‡ºï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªStepçš„codingä»»åŠ¡ä¹‹é—´ï¼Œ**ä¸ä¼ é€’code messageï¼Œåªä¼ é€’è¿‡æ»¤Errorçš„bservationï¼Œå¯ä»¥å¤§å¤§å‡å°‘ä¸Šæ–‡Tokené‡çº§**ã€‚é‚£è¦å¦‚ä½•è®¾è®¡codingä»»åŠ¡æ‰èƒ½ä¹‹åŸºäºè§‚æµ‹è¿›è¡Œä¸²è¡Œä»»åŠ¡ç¼–ç¨‹å‘¢ï¼Ÿå’±æ¥ç€å¾€åèŠ~

### Coding

Codingæ˜¯æœ€æ ¸å¿ƒçš„ä»»åŠ¡ã€‚è™½ç„¶Plançš„ä»»åŠ¡åˆ†è§£é€šè¿‡é™ä½å­ä»»åŠ¡å¤æ‚åº¦æ¥å‡å°‘Stepå†…éƒ¨çš„ä¸Šä¸‹æ–‡é•¿åº¦ï¼Œä½†æˆ‘ä»¬ä»éœ€å¤„ç†å¤šç¼–ç æ­¥éª¤é—´çš„ä¿¡æ¯ä¼ é€’é—®é¢˜ã€‚è¿™é‡Œé€‰æ‹©äº†å†…å¤–å±‚æ¶ˆæ¯éš”ç¦»çš„æ¨¡å¼

*   å†…å±‚ï¼ˆå•ä¸ªStepå†…ï¼‰ï¼šæ¶ˆæ¯çº¿æ€§å¢é•¿ï¼Œæ¯ä¸€æ­¥å‘åä¼ é€’code + execution resultã€‚åŒæ—¶é€šè¿‡æŒ‡ä»¤è®©æ¨¡å‹**printæ‰€æœ‰ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å¿…è¦è§‚æµ‹ï¼Œå¹¶å¯¹æ‰€æœ‰æ•°æ®åˆ†æçš„ä¸­é—´ç»“æœè¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨**
*   å¤–å±‚ï¼ˆå¤šä¸ªstepä¹‹é—´ï¼‰ï¼šå› ä¸ºè§‚æµ‹å’Œä¸­é—´ç»“æœéƒ½åœ¨Studoutä¸­ç›´è§‚æ˜¾ç¤ºï¼Œæ‰€ä»¥å¤šæ­¥ä¹‹é—´åªéœ€ä¼ é€’è¿‡æ»¤Errorçš„Execution Resultï¼Œåé¢ç« èŠ‚æˆ‘ä»¬å†è€ƒè™‘å¼•å…¥æ›´å¤šå‹ç¼©å’Œåæ€æå€¼è¿›ä¸€æ­¥æå‡ä¿¡æ¯å¯†åº¦ï¼Œæ¥åº”å¯¹æ›´å¤æ‚çš„é—®é¢˜ã€‚

ä»¥ä¸‹æ˜¯å…³äºæŒä¹…åŒ–å’Œstdoutè¾“å‡ºçš„ç›¸å…³æŒ‡ä»¤ï¼Œå®Œæ•´æŒ‡ä»¤è¯¦è§[DAAgent](https://github.com/DSXiangLi/DAAgent)

    3. **æ•°æ®æµè§„èŒƒ**ï¼šç¦æ­¢ä½¿ç”¨å…¨å±€å˜é‡ä¼ é€’æ•°æ®ï¼Œä½¿ç”¨æŒä¹…åŒ–æ–‡ä»¶è¿›è¡Œä¿¡æ¯ä¼ é€’ï¼Œä¾‹å¦‚
       | æ­¥éª¤ç±»å‹ | è¾“å…¥æ–‡ä»¶          | è¾“å‡ºæ–‡ä»¶æ ¼å¼è¦æ±‚         |
       |----------|-------------------|------------------------|
       | æ•°æ®åŠ è½½ | raw_data.csv      | /                      |
       | ä¸­é—´å¤„ç† | [ä¸Šä¸€æ­¥].csv      | å¸¦æ—¶é—´æˆ³çš„CSV/JSONæ–‡ä»¶ |
       | å¯è§†åŒ–   | processed_data/* | 600dpi PNGï¼ˆå¸¦å›¾ä¾‹ï¼‰   |
    4. **åˆ†æç»“æœå’Œè§‚æµ‹æ˜¾æ€§åŒ–**ï¼šprintæ‰€æœ‰ç»“æœ
       | æ­¥éª¤ç±»å‹ | print       | 
       |----------|-------------------|
       | æ–‡ä»¶è¾“å‡º | ğŸ—‚ï¸æ•°æ®å·²ä¿å­˜åˆ°...     | 
       | æ•°æ®ç»Ÿè®¡ | ğŸ“Š æ•°æ®åŸºæœ¬ç»Ÿè®¡...     | 
       | å¯è§†åŒ– | ğŸ“ˆç»˜åˆ¶å…³é”®æŒ‡æ ‡...|
       | æ ¸å¿ƒå‘ç°|ğŸ¯ æ•°æ®æ ¸å¿ƒå‘ç°...|
    

ä»¥ä¸ŠæŒ‡ä»¤çš„æ•ˆæœå¦‚ä¸‹  

æ•´ä¸ªCodingèŠ‚ç‚¹çš„é…ç½®æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯çº¿æ€§çš„REACTï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ç”¨langgraph prebuild reactæ¥å®ç°ï¼Œä½†ä¸ªäººä¸å¤ªå–œæ¬¢ç”¨high levelçš„å°è£…å“ˆå“ˆæ„Ÿè§‰çœ‹æ‡‚åˆ«äººä»£ç çš„å¤æ‚åº¦>>è‡ªå·±å†™ï¼Œæ¯•ç«Ÿäººäººéƒ½æœ‰å°å·§æ€å“ˆå“ˆå“ˆ~ï¼ˆç¬”è€…ä¹Ÿä¸æ¨èä¸çŸ¥å…¶æ‰€ä»¥ç„¶å°±ç›´æ¥æ— è„‘ä½¿ç”¨ï¼‰

    async def coding(state: CodeState, config: RunnableConfig, writer: StreamWriter) -> Command[
        Literal["publisher", "coding"]]:
        """æ¨¡å‹å†™ä»£ç :è¿›å…¥write + executeå¾ªç¯æ¨¡å¼"""
        configurable = Configuration.from_runnable_config(config)
        # è¶…è¿‡å•è½®æœ€å¤§codingæ¬¡æ•°åˆ™åˆ¤æ–­ä¸ºå¤±è´¥é€€å‡º
        if configurable.max_code_loops < state["code_round"]:
            writer('è¶…è¿‡å•stepæœ€å¤§æ‰§è¡Œæ¬¡æ•°é€€å‡º')
            for step in state["steps"]:
                if step['status'] == Status.in_progress:
                    step['status'] = Status.fail
            return Command(goto='publisher', update={"steps": state['steps']})
        prompt = get_prompt_template('code', input_vars={'steps': state['steps'],
                                                         "observations": state['observations']})
        llm = ChatDeepSeek(
            api_key=os.environ['LLM_APIKEY'],
            api_base=os.environ['LLM_URL'],
            model=configurable.code_model
        )
        if not state["code_messages"]:
            messages = [
                {"role": "system", "content": prompt},
                {"role": "user", "content": "è¯·å¼€å§‹æ•°æ®åˆ†æ"}
            ]
        else:
            messages = state["code_messages"]
        tools = await mcp_client.get_tools()
        code_tool = [i for i in tools if i.name == 'execute_code'][0]
        message = await llm.bind_tools([code_tool, task_finish], tool_choice='required', strict=True).ainvoke(messages)
        writer(f'Thinking: {message.content}')
        if len(message.tool_calls) > 0:
            for tool_call in message.tool_calls:
                if tool_call.get("name", "") not in ["execute_code", "task_finish"]:
                    # å‡ºç°æ¨¡å‹æ¨ç†é”™è¯¯åˆ¤æ–­ä¸ºå¤±è´¥è¿”å›Publisherï¼Œä¹Ÿå¯ä»¥å¢åŠ é‡è¯•ï¼Œè¿™ç§æƒ…å†µå‘ç”Ÿæš‚æ—¶ä¸ºå‘ç”Ÿè¿‡
                    writer('æ¨¡å‹è°ƒç”¨å·¥å…·å¼‚å¸¸ï¼Œå‡ºç°éå®šä¹‰å·¥å…·è°ƒç”¨é€€å‡ºå½“å‰Step')
                    steps = state["steps"]
                    for step in steps:
                        if step['status'] == Status.in_progress:
                            step['status'] = Status.fail
                            writer(f"{step['description']} failed execution")
                            break
                    return Command(goto='publisher', update={"steps": state['steps']})
                elif tool_call.get("name") == 'execute_code':
                    writer('Execute Code Tool calling')
                    code = tool_call.get("args", {"code": ""})["code"]
                    writer(f'Code:\n{code}')
    
                    execution = await code_tool.ainvoke(tool_call.get("args", {}))
                    observation = execution_to_llm(execution)
                    print(f"Execution\n:{observation}")
    
                    observation_without_error = execution_to_llm(execution, exclude_error=True)
                    # TODOï¼šå› ä¸ºå­˜åœ¨å·¥å…·è°ƒç”¨å¤±è´¥ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨userè€ŒéToolMessage
                    if state["code_round"] == 0:
                        messages += [AIMessage(content=message.content, tool_calls=[tool_call]),
                                     ToolMessage(content=observation, tool_call_id=tool_call.get("id"))]
                    else:
                        messages = [AIMessage(content=message.content, tool_calls=[tool_call]),
                                    ToolMessage(content=observation, tool_call_id=tool_call.get("id"))]
                    return Command(goto='coding',
                                   update={
                                       "code_round": state["code_round"] + 1,
                                       "code_messages": messages,
                                       "step_observations": [observation],
                                       "step_observations_clean": [observation_without_error]  # è¦†ç›–å¼å†™å…¥
                                   })
                else:
                    writer('Finish Task Tool calling')
                    steps = state["steps"]
                    for step in steps:
                        if step['status'] == Status.in_progress:
                            step['status'] = Status.finish
                            writer(f"{step['description']} finish execution")
                            break
                    return Command(goto='publisher', update={"steps": state['steps']})
        else:
            writer('æ¨¡å‹è°ƒç”¨å·¥å…·å¼‚å¸¸å‡ºç°æ— å·¥å…·è°ƒç”¨æƒ…å½¢ï¼Œé€€å‡ºå½“å‰Step')
            steps = state["steps"]
            for step in steps:
                if step['status'] == Status.in_progress:
                    step['status'] = Status.fail
                    writer(f"{step['description']} failed execution")
                    break
            return Command(goto='publisher', update={"steps": state['steps']})
    

æœ€ç»ˆå‘ˆç°å‡ºæ¥çš„æ•ˆæœå°±æ˜¯ä¸‹é¢è¿™æ ·äº†,è¿™é‡Œæˆ‘ç”¨äº†å­—èŠ‚åˆšå‘å¸ƒçš„wide searchæ•°æ®é›†[ByteDance-Seed/WideSearch](https://hf-mirror.com/datasets/ByteDance-Seed/WideSearch?viewer_api=true)

### è¸©è¿‡çš„å‘

è¿™é‡Œå†åˆ†äº«å‡ ä¸ªè¸©è¿‡çš„å°å‘

1.  **Stdioé€‚åˆæ— çŠ¶æ€å·¥å…·**

ä¹‹å‰å¯¹stdioå’Œhttpè¿™ä¸¤ç§mcpé€šä¿¡åªç†è§£åˆ°ï¼Œä¸€ä¸ªæ˜¯æœ¬åœ°å¯åŠ¨ä¸€ä¸ªæ˜¯è¿œç¨‹æœåŠ¡ï¼Œæœ¬åœ°æ›´å¿«èƒ½ä¿è¯æ•°æ®å®‰å…¨ã€‚è€Œå¦ä¸€ä¸ªå·®å¼‚åœ¨äº**stdioæ— çŠ¶æ€**ã€‚å› ä¸ºstdioæœ¬è´¨å…¶å®å°±æ˜¯spawnçš„ä¸€ä¸ªå­è¿›ç¨‹ï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸç”±å®¢æˆ·ç«¯å¯åŠ¨å’Œé“¾æ¥ï¼Œæ‰€ä»¥å·¥å…·è°ƒç”¨å®Œæ¯•è¿›ç¨‹å°±ä¼šå…³é—­ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•åœ¨å¤šæ¬¡è°ƒç”¨ä¹‹é—´å…±äº«çŠ¶æ€ã€‚å½“ç„¶ä½ å¯ä»¥ç”¨ä¸€äº›å¤–éƒ¨å­˜å‚¨æ¥è®°å½•çŠ¶æ€ï¼Œä½†æœ¬è´¨ä¸Šstdioæ›´é€‚åˆåœ¨å®¢æˆ·ç«¯æ¥ç®¡ç†çŠ¶æ€ã€‚å› æ­¤è€ƒè™‘åˆ°æˆ‘æ˜¯åœ¨æœåŠ¡ç«¯è®°å½•å¤šæ¬¡ä»£ç æ‰§è¡Œå¾—åˆ°jupyter notebookï¼Œå› æ­¤æˆ‘æš‚æ—¶è°ƒæ•´æˆäº†httpã€‚

å“ˆå“ˆè¿™ä¸€ç« æ¥ä¸åŠè°ƒæ•´äº†ï¼Œåé¢æ„Ÿè§‰åˆç†çš„è§£æ³•è¿˜æ˜¯stdioæ¨¡å¼ï¼Œç¬¬ä¸€æ˜¯æ›´å¿«é€Ÿé€‚åˆå¤§æ•°æ®åˆ†æä¸­å¤§é‡æ•°æ®ä¼ è¾“ï¼Œå…¶æ¬¡æ˜¯æ•°æ®åˆ†æä¼šæœ‰å»ºæ¨¡åœºæ™¯ï¼Œä¸è¿‡æŠŠJupyter Notebookçš„æ•°æ®ç®¡ç†è¿ç§»åˆ°å®¢æˆ·ç«¯æ¥æ

2.  **å·¥å…·è°ƒç”¨å—åˆ°ä¸Šæ–‡Messageæ ¼å¼å½±å“è¾ƒå¤§**

ä¸ªäººç»éªŒï¼ˆæ— å®¢è§‚æ¶ˆèå®éªŒï¼‰è¡¨æ˜ï¼Œåœ¨æŸäº›æ¨¡å‹ä¸Šç»“æ„åŒ–æ¨ç†çš„ç¨³å®šæ€§æ›´é«˜ï¼Œå·¥å…·ä½¿ç”¨çš„å¹»è§‰ç‡ï¼ˆå¦‚ä¸è°ƒç”¨å·¥å…·ï¼‰æ›´ä½ï¼ŒDeepSeekæ¨¡å‹ç›¸æ¯”Qwenå°¤å…¶æ˜æ˜¾ã€‚å¦‚æœä¸Šæ–‡MessageåŒ…å«ä¸å·¥å…·å†…å®¹ç›¸ä¼¼ä½†æ ¼å¼ä¸åŒçš„å†…å®¹ï¼Œä¼šè¿›ä¸€æ­¥å¢åŠ æ— å·¥å…·è°ƒç”¨çš„æ¯”ä¾‹ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚

Next?
-----

è¿™ä¸€ç‰ˆåªæ˜¯æ•°æ®åˆ†ææ™ºèƒ½ä½“çš„é›å½¢ï¼Œåé¢æˆ‘ä»¬ä¸€è¾¹æ¢ç´¢ä¸€äº›æ–°çš„æ€è·¯ï¼Œä¸€è¾¹æŠŠUIå±•ç¤ºæå‡ºæ¥ï¼Œæ„Ÿè§‰ä¸€äº›å€¼å¾—å°è¯•çš„ç‚¹åŒ…æ‹¬

*   **ç»éªŒæ€»ç»“æœºåˆ¶**ï¼šå¦‚ä½•è®©æ¨¡å‹ä¸æ–­æ€»ç»“æŠ½è±¡è‡ªå·±Codingè¿‡ç¨‹ä¸­çš„æŠ¥é”™å¹¶è½åˆ°notesé‡Œï¼Œåœ¨ä¸æ–­å®è·µä¸­é™ä½bug rateã€‚æ„Ÿè§‰å½“å‰æ•°æ®åˆ†æä¸Šå¤šæ•°æµ…å±‚erroréƒ½æ¥è‡ªAPIç‰ˆæœ¬è¿­ä»£å¸¦æ¥çš„ä¸å…¼å®¹é—®é¢˜ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡â€œPast Experience Summaryâ€æœºåˆ¶è§£å†³
*   **åæ€æœºåˆ¶æ¢ç´¢**ï¼šåæ€åœ¨æ•°æ®åˆ†æä»»åŠ¡ä¸Šèƒ½æå‡åˆ†ææ·±åº¦ä¹ˆï¼Ÿ
*   **é«˜æ•ˆBugä¿®å¤**é™¤äº†é‡å†™ä»£ç ï¼Œæœ‰å…¶ä»–æ›´é«˜æ•ˆçš„æ¨ç†æ–¹å¼è¿›è¡ŒBugä¿®å¤ä¹ˆï¼Ÿ
*   **å‰ç«¯å±•ç¤º**ï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªå‰ç«¯é¡µé¢æ¥å±•ç¤ºæ•°æ®åˆ†æçš„ç»“æœ

æƒ³çœ‹æ›´å…¨çš„å¤§æ¨¡å‹è®ºæ–‡Â·AgentÂ·å¼€æºæ¡†æ¶Â·AIGCåº”ç”¨ >> [DecryPrompt](https://github.com/DSXiangLi/DecryptPrompt)