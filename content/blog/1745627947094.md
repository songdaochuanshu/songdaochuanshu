---
layout: post
title: 'Windows上，10分钟构建一个本地知识库'
date: "2025-04-26T00:39:07Z"
---
Windows上，10分钟构建一个本地知识库
======================

这篇文章是我约新书《RAG应用实战》的一个样章，基于阿里云代码构建的一个本地RAG服务。  
**本地模型看代码注释，需要替换几行代码。**

阅读本章时，已默认安装你的个人电脑上安装了Python 3.6-3.12中的一个版本、以及PyCharm和conda。以及按照第三章示例，已经在阿里云创建了大模型的API-key。  
（1）现在让我们下载阿里云百炼平台提供的一个RAG运行包。地址如下：  
[https://help-static-aliyun-doc.aliyuncs.com/file-manage-files/zh-CN/20250414/odwvrb/local\_rag.zip](https://help-static-aliyun-doc.aliyuncs.com/file-manage-files/zh-CN/20250414/odwvrb/local_rag.zip)  
下载之后解压，使用Pycharm打开此文件夹，如图4-1所示。  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425153915320-378746620.png)  
`图4-1 创建local_rag项目`

（2）然后选择“File>>Settings”，打开Interpreter选项，创建一个基于conda的虚拟空间local\_rag，如图4-2所示。  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425153937601-784724518.png)  
`图4-2 设置local_rag虚拟空间`

（3）打开conda的promot（如图4-3所示），切换Python的当前环境为local\_rag。  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425153954190-1617319572.png)  
`图4-3 打开conda的promot`

（4）打开conda的promot后，输入命令conda env list，遍历当前的虚拟空间（如图4-4所示），\*号表示当前使用的虚拟空间，输入命令conda activate local\_rag，切换Python的当前环境为local\_rag。  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154005758-657921318.png)  
`图4-4 遍历`

（5）安装依赖包，执行命令，如图4-5所示。命令如下：  
`C:\Users\Administrator>pip install -r C:\PycharmProjects\local_rag\requirements.txt`

路径 C:\\PycharmProjects\\local\_rag\\ 需要换成自己的代码目录。requirements.txt文件中存放了运行local\_rag项目所使用的依赖包，内容如下：

      gradio==4.32.0
      faiss-cpu==1.8.0.post1
      dashscope==1.20.4
      openai==1.55.3
      httpx==0.27.0
      llama-index-vector-stores-faiss==0.1.2
      llama-index-embeddings-dashscope==0.1.4
      llama-index-readers-file==0.1.33
      matplotlib==3.9.3
      docx2txt==0.8
      openpyxl==3.1.5
      llama-index-core==0.10.67
      uvicorn==0.30.6
      fastapi==0.112.0
      llama-index-postprocessor-dashscope-rerank-custom==0.1.0
      simplejson==3.19.3
      pydantic==2.10.6
    

安装成功提示如下：  
Successful1y insta11ed a1tair-5.5.0 dashscope-1.20.4 docx2txt-0.8 faiss-cpu-1.8.0.post1 fastapi-0.112.0 gradio-4.32.0 ……省略  
图4-5 安装依赖

（6）设置阿里云百炼平台的API-KEY，如图4-6所示，命令如下：  
`setx DASHSCOPE_API_KEY sk-d179938b99184627a9a4e8618fc7224a`  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154026795-1925047411.png)  
图4-6 设置API-KEY

此key在代码文件chat.py中111行，如图4-7所示。  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154036550-781388287.png)  
图4-7 使用API-KEY

查看API-KEY设置是否成功，如图4-8所示，命令如下：  
`echo %DASHSCOPE_API_KEY%`  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154056641-1060424079.png)  
图4-8 查看API-KEY

（7）东风具备，现在让我们运行下main.py，右键点击main.py，选择Run’main’，如图4-9所示。  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154106510-1837966535.png)  
图4-9 运行主类

（8）查看运行时提示，需要升级gradio ，如图4-10。  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154115465-667330823.png)  
图4-10 运行主类

这里IDE终端提示当前使用的 gradio 版本为 4.32.0，而最新版本为 4.44.1，建议升级到最新版本。  
虽然提示不是错误，但是不升级没法运行，所以还是升级下。

（9）打开cmd，使用uvicorn运行main.py，先查看uvicorn版本，如图4-11所示，命令如下：  
`pip show uvicorn`  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154153707-1026623524.png)  
图4-11 运行主类

（10）版本是0.30.6，没啥问题，切换到工程目录，运行打开LOCAL\_RAG主页，如图4-12所示，命令如下：  
`uvicorn main:app --port 7866`  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154203080-1433197621.png)  
图4-12 启动local\_rag服务

（11）为了简化每次打开cmd输入命令，我们打开local\_rag目录，新建一个run.bat批处理文件，将运行命令保存到bat文件中，如图4-13所示。  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154211420-421215442.png)  
图4-13 启动local\_rag服务

（12）打开浏览器，推荐edge、chrome浏览器，输入地址http://127.0.0.1:7866/，打开本地RAG主页，如图4-14所示。  
![](https://img2024.cnblogs.com/blog/1349401/202504/1349401-20250425154221294-582090037.png)  
图4-14 local\_rag主页

注意：我这里用的Python版本是3.12。如果打开页面报错DLL load failed while importing \_cext，额外运行命令：pip install msvc-runtime ，之后后再运行应用。

![](https://images.cnblogs.com/cnblogs_com/yaomaomao/1499288/o_191118063357gzh12cm.jpg)

作者：[妖生](https://www.cnblogs.com/yaomaomao/)

出处：[https://www.cnblogs.com/yaomaomao/](https://www.cnblogs.com/yaomaomao/)

<<<<我的公众号：姚毛毛的博客

Linux常用工具站：[https://www.linuxido.com](https://www.linuxido.com)

本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利.

如果喜欢本文就点个【推荐】吧。