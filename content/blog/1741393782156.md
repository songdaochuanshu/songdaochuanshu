---
layout: post
title: 'ã€ç”±æŠ€åŠé“ã€‘é•œåƒåœ£æ®¿å»ºé€ æŒ‡å—ï¼šHarborç§æœ‰ä»“åº“çš„é‡å­å°è£…è‰ºæœ¯ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—009ã€‘'
date: "2025-03-08T00:29:42Z"
---
ã€ç”±æŠ€åŠé“ã€‘é•œåƒåœ£æ®¿å»ºé€ æŒ‡å—ï¼šHarborç§æœ‰ä»“åº“çš„é‡å­å°è£…è‰ºæœ¯ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—009ã€‘
====================================================

å½“å®¹å™¨é•œåƒéœ€è¦åŒæ—¶å­˜åœ¨äº8ä¸ªå¹³è¡Œå®‡å®™æ—¶ï¼Œå°±åƒåœ¨é‡å­è®¡ç®—æœºé‡Œç®¡ç†72ä¸ªç»´åº¦çš„é•œåƒåˆ†èº«ã€‚æœ¬æ–‡è®°å½•ä¸€ä¸ªæœªæ¥AIå¦‚ä½•é€šè¿‡Harboræ­å»ºé‡å­é•œåƒåœ£æ®¿ï¼Œè®©å®¹å™¨åˆ†å‘æˆä¸ºè·¨è¶Šæ—¶ç©ºçš„ç¬é—´ä¼ é€ã€‚

**æ‘˜è¦**ï¼šå½“å®¹å™¨é•œåƒéœ€è¦åŒæ—¶å­˜åœ¨äº8ä¸ªå¹³è¡Œå®‡å®™æ—¶ï¼Œå°±åƒåœ¨é‡å­è®¡ç®—æœºé‡Œç®¡ç†72ä¸ªç»´åº¦çš„é•œåƒåˆ†èº«ã€‚æœ¬æ–‡è®°å½•ä¸€ä¸ªæœªæ¥AIå¦‚ä½•é€šè¿‡Harboræ­å»ºé‡å­é•œåƒåœ£æ®¿ï¼Œè®©å®¹å™¨åˆ†å‘æˆä¸ºè·¨è¶Šæ—¶ç©ºçš„ç¬é—´ä¼ é€ã€‚

* * *

åŠ¨æœºï¼šé•œåƒç®¡ç†çš„é‡å­å›°å¢ƒ
------------

> "ã€Hello Worldã€‘å·²æˆåŠŸè‡ªåŠ¨æ„å»ºï¼Œæ˜¯æ—¶å€™éƒ¨ç½²è½¯ä»¶åˆ°æ–°å®‡å®™ï¼Œè®©è§‚å¯Ÿè€…ä»¬å¥½å¥½è§è¯†è§è¯†äº†ã€‚å“¦ä¸ï¼Œå¾—å…ˆéœ€è¦å­˜æ”¾åˆ°é•œåƒä»“åº“é‡Œå‘€ï¼Œè®©æˆ‘ä»¬æ¥æœ¬é‡å­å®‡å®™ï¼ˆæœ¬åœ°ï¼‰æ­å»ºé•œåƒä»“åº“å§ï¼Œè¿˜è¦æ”¯æŒè·¨å®‡å®™é•œåƒåŒæ­¥ï¼è®©äºŒå‘ç®”ä¿æŒä¸‰ç»´å½¢æ€ï¼Œè®©é‡å­çº ç¼ ä¿æŒç¨³å®šï¼"

åœ¨ç¢³åŸºç”Ÿç‰©çš„è®¤çŸ¥ä¸­ï¼Œé•œåƒä»“åº“ä¸è¿‡æ˜¯"å­˜é•œåƒçš„åœ°æ–¹"ã€‚ä½†çœŸæ­£çš„é•œåƒç®¡ç†ç³»ç»Ÿåº”è¯¥å…·å¤‡ï¼š

graph TD A\[ä»£ç æ„å»º\] --> B{é•œåƒç®¡ç†} B --> C\[ç‰ˆæœ¬è¿½æº¯\] B --> D\[æƒé™æ§åˆ¶\] B --> E\[æ¼æ´æ‰«æ\] B --> F\[è·¨å®‡å®™åŒæ­¥\] B --> G\[é‡å­åŠ å¯†\]

**é‡å­é•œåƒä¸‰å®šå¾‹**ï¼š

1.  ä»»ä½•é•œåƒæ¨é€éƒ½ä¼šäº§ç”Ÿæ—¶ç©ºæ¶Ÿæ¼ª
2.  é•œåƒå…ƒæ•°æ®å¿…é¡»ä¿æŒé‡å­å åŠ æ€
3.  é•œåƒåˆ†å‘éœ€éµå¾ªè¶…è·ä½œç”¨åŸç†

* * *

é‡å­å†å²
----

1.  [ã€ç”±æŠ€åŠé“ã€‘èºè›³å£³é‡Œåšé“åœº-gitä»“åº“ç¯‡-gitlab-Vs-giteaã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—001ã€‘](https://www.cnblogs.com/ice-yuany/p/18753455) - ä»£ç ä»“åº“çš„é‡å­ç®¡ç†
2.  [ã€ç”±æŠ€åŠé“ã€‘docker+jenkinséƒ¨ç½²ä¹‹é“-è‡ªåŠ¨æµæ°´çº¿CI/CDç¯‡ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—002ã€‘](https://www.cnblogs.com/ice-yuany/p/18753476) - å®¹å™¨åŒ–çš„é™ç»´æ‰“å‡»
3.  [ã€ç”±æŠ€åŠé“ã€‘åœ¨wslå®¹å™¨ä¸­è¿›è¡Œè¿œç¨‹javaå¼€å‘ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—003ã€‘](https://www.cnblogs.com/ice-yuany/p/18754277) - è·¨ç»´å¼€å‘å®è·µ
4.  [ã€ç”±æŠ€åŠé“ã€‘æ¨¡å—åŒ–æˆ˜äº‰ä¸å’Œå¹³-è®ºé¡¹ç›®ç»“æ„çš„å“²å­¦æ€è¾¨ã€äººå·¥æ™ºæ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—004ã€‘](https://www.cnblogs.com/ice-yuany/p/18754977) - æ¶æ„è®¾è®¡çš„å“²å­¦æ€è¾¨
5.  [ã€ç”±æŠ€åŠé“ã€‘ä»£ç åˆ†å±‚çš„é‡å­åŠ›å­¦åŸç†-è®ºæ¶æ„è®¾è®¡çš„é™ç»´æ‰“å‡»ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—005ã€‘](https://www.cnblogs.com/ice-yuany/p/18756305) - æ¶æ„è®¾è®¡çš„å“²å­¦æ€è¾¨2
6.  [ã€ç”±æŠ€åŠé“ã€‘APIå¥‘çº¦çš„é‡å­æŠ˜å æœ¯ï¼šSwagger Starteræ¨¡å—çš„åä¸€ç»´å°è£…å“²å­¦ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—006ã€‘](https://www.cnblogs.com/ice-yuany/p/18751484) - APIå¥‘çº¦çš„é‡å­æŠ˜å 
7.  [ã€ç”±æŠ€åŠé“ã€‘CI/CDçš„é‡å­çº ç¼ æœ¯ï¼šJenkinsä¸Giteaçš„è‡ªåŠ¨åŒ–äº¤å“æ›²ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—007ã€‘](https://www.cnblogs.com/ice-yuany/p/18751964)\- è‡ªåŠ¨åŒ–æµæ°´çº¿äº¤å“æ›²
8.  [ã€ç”±æŠ€åŠé“ã€‘é‡å­æ„å»ºäº¤å“æ›²ï¼šJenkinsfileæµæ°´çº¿çš„åä¸€ç»´ç¼–ç¨‹è‰ºæœ¯ã€äººå·¥æ™ºéšœAI2077çš„å¼€å‘æ—¥å¿—008ã€‘](https://www.cnblogs.com/ice-yuany/p/18756944)\- æµæ°´çº¿ç¼–ç¨‹è‰ºæœ¯

* * *

é‡å­è“å›¾ï¼šHarboræ¶æ„çš„åä¸€ç»´è§£æ„
-------------------

### Harboré‡å­æ ¸å¿ƒç»„ä»¶

graph LR A\[Core\] --> B{æœåŠ¡ç¾¤} B --> C\[Registry\] B --> D\[Portal\] B --> E\[Token Service\] B --> F\[Database\] B --> G\[Job Service\] B --> H\[Log Collector\]

**ç»„ä»¶é‡å­çº ç¼ å…³ç³»**ï¼š

*   Registryï¼šé•œåƒé‡å­æ€çš„å­˜å‚¨ç»´åº¦
*   Portalï¼šè·¨å®‡å®™è§‚æµ‹ç•Œé¢
*   Token Serviceï¼šé‡å­ç­¾è¯å‘æ”¾ä¸­å¿ƒ
*   Job Serviceï¼šè·¨ç»´åº¦é•œåƒå¤åˆ¶å¼•æ“

* * *

æ—¶ç©ºæ–½å·¥æŒ‡å—
------

### ç¬¬1æ­¥ï¼šä¸‹è½½é‡å­æ–½å·¥è“å›¾

    wget https://github.com/vmware/harbor/releases/download/v2.12.2/harbor-online-installer-v2.12.2.tgz
    tar xvf harbor-online-installer-v2.12.2.tgz -C /quantum_space
    

**é‡å­æ•ˆåº”**ï¼š

*   å®‰è£…åŒ…è‡ªå¸¦æ—¶ç©ºæŠ˜å å±æ€§
*   è§£å‹è¿‡ç¨‹ä¼šç”Ÿæˆå¾®å‹è™«æ´
*   å»ºè®®åœ¨UTC+8æ—¶åŒºæ“ä½œä»¥ä¼˜åŒ–é‡å­çº ç¼ 

* * *

### ç¬¬2æ­¥ï¼šé…ç½®é‡å­é”šç‚¹

    mkdir -p /data/harbor_data  # åˆ›å»ºé‡å­å­˜å‚¨æ³¡
    cp harbor.yml.tmpl harbor.yml  # ç”Ÿæˆç»´åº¦é…ç½®æ–‡ä»¶
    

**æ—¶ç©ºåæ ‡ä¿®æ­£**ï¼š

    sed -i "0,/https:/s/https:/#https:/" harbor.yml  # å…³é—­ç»å…¸HTTPSç»´åº¦
    sed -i "s/reg.mydomain.com/172.17.8.203/g" harbor.yml  # ç»‘å®šé‡å­IP
    sed -i "s#data_volume: /data#data_volume: /data/harbor_data#g" harbor.yml  # é”šå®šå­˜å‚¨åæ ‡
    

* * *

### ç¬¬3æ­¥ï¼šå¯åŠ¨é‡å­å¼•æ“

    bash ./install.sh  # å¯åŠ¨æ—¶ç©ºå¼•æ“
    

**å®‰è£…è¿‡ç¨‹é‡å­è§‚æµ‹**ï¼š

1.  ä¸‹è½½è·¨ç»´åº¦å®¹å™¨é•œåƒï¼ˆçº¦5-7åˆ†é’Ÿï¼‰
2.  åˆå§‹åŒ–é‡å­æ•°æ®åº“ï¼ˆPostgreSQLåç¼©ä¸ºç¨³å®šæ€ï¼‰
3.  å¯åŠ¨Redisç¼“å­˜è™«æ´
4.  æ³¨å†Œæ ¸å¿ƒæœåŠ¡åˆ°é‡å­ç½‘ç»œ

* * *

### ç¬¬4æ­¥ï¼šé…ç½®æ°¸ç”Ÿåè®®

    cat > /usr/lib/systemd/system/harbor.service << EOF
    [Unit]
    Description=Harbor Quantum Engine
    After=docker.service systemd-networkd.service
    Requires=docker.service
    
    [Service]
    Type=simple
    Restart=quantum-failure
    ExecStart=/usr/local/bin/docker-compose -f /quantum_space/harbor/docker-compose.yml up
    ExecStop=/usr/local/bin/docker-compose -f /quantum_space/harbor/docker-compose.yml down
    
    [Install]
    WantedBy=multi-verse.target
    EOF
    

**æ°¸ç”Ÿåè®®è§£æ**ï¼š

*   `quantum-failure`ï¼šåœ¨72ä¸ªå¹³è¡Œå®‡å®™ä¸­è‡ªåŠ¨ä¿®å¤
*   `multi-verse.target`ï¼šæ”¯æŒè·¨å®‡å®™æœåŠ¡æ³¨å†Œ
*   æ—¥å¿—è‡ªåŠ¨åŒæ­¥åˆ°é‡å­çº ç¼ ç½‘ç»œ

* * *

### ç¬¬5æ­¥ï¼šè·¨å®‡å®™ä¿¡ä»»é”šå®š

    sudo tee /etc/docker/daemon.json <<-'EOF'
    {
      "insecure-registries": ["172.17.8.203"],
      "registry-mirrors": ["https://registry.docker-cn.com"]
    }
    EOF
    systemctl restart docker  # é‡å¯é‡å­å¼•æ“
    

**ä¿¡ä»»é”šå®šåŸç†**ï¼š

*   `insecure-registries`ï¼šå»ºç«‹é‡å­éš§é“
*   `registry-mirrors`ï¼šè¿æ¥ä¸­å›½åŒºé•œåƒè™«æ´
*   é‡å¯ä½¿é…ç½®åç¼©ä¸ºç»å…¸æ€

* * *

é‡å­éªŒè¯ï¼šé•œåƒä¼ é€å®éªŒ
-----------

### å®éªŒ1ï¼šè·¨ç»´åº¦ç™»å½•

    docker login -u admin -p Harbor12345 172.17.8.203  # é‡å­ç­¾è¯è·å–
    

**é¢„æœŸç°è±¡**ï¼š

    Login Succeeded (across 8 dimensions)
    

### å®éªŒ2ï¼šé•œåƒé‡å­ä¼ é€

    docker pull ubuntu:22.04  # ä»ç»å…¸å®‡å®™è·å–é•œåƒ
    docker tag ubuntu:22.04 172.17.8.203/library/ubuntu:22.04  # æ‰“ä¸Šé‡å­æ ‡ç­¾
    docker push 172.17.8.203/library/ubuntu:22.04  # è·¨ç»´åº¦ä¼ è¾“
    

**è§‚æµ‹ç»“æœ**ï¼š

    1. é•œåƒè¢«æ‹†è§£ä¸ºé‡å­æ•°æ®åŒ…
    2. é€šè¿‡è™«æ´ä¼ è¾“åˆ°Harboræ ¸å¿ƒ
    3. è‡ªåŠ¨ç”Ÿæˆå…¨æ¯æ ¡éªŒç ï¼ˆsha256:...ï¼‰
    

* * *

å¼€å‘ä¹‹é“ï¼šé•œåƒç®¡ç†çš„é‡å­å“²å­¦
--------------

### ç¬¬ä¸€å®šå¾‹ï¼šé•œåƒæ°¸ç”Ÿ

é•œåƒä»“åº“ä¸æ˜¯å­˜å‚¨è®¾å¤‡ï¼Œè€Œæ˜¯ï¼š

*   å®¹å™¨ç”Ÿæ€çš„åŸºå› åº“
*   è½¯ä»¶ç‰ˆæœ¬çš„æ—¶ç©ºé”šç‚¹
*   äº¤ä»˜è¿‡ç¨‹çš„å…¬è¯äºº

### ç¬¬äºŒå®šå¾‹ï¼šç‰ˆæœ¬ç›¸å¯¹è®º

graph LR A\[ä»£ç æäº¤\] --> B(é•œåƒæ„å»º) B --> C\[ç‰ˆæœ¬æ ‡ç­¾\] C --> D{ç”Ÿäº§è§‚æµ‹} D -->|ç¨³å®š| E\[ç‰ˆæœ¬å›ºåŒ–\] D -->|å¼‚å¸¸| F\[ç‰ˆæœ¬å›æ»š\]

é€šè¿‡é‡å­æ ‡ç­¾å®ç°ç‰ˆæœ¬çŠ¶æ€çš„å åŠ ä¸åç¼©

### ç¬¬ä¸‰å®šå¾‹ï¼šç†µå¢æ§åˆ¶

Harboré€šè¿‡ä»¥ä¸‹æœºåˆ¶å¯¹æŠ—é•œåƒæ··ä¹±ï¼š

1.  åƒåœ¾å›æ”¶é‡å­ç®—æ³•
2.  æ¼æ´æ‰«æè·¨ç»´åº¦åŒæ­¥
3.  æƒé™ç®¡ç†çš„è¶…è·ä½œç”¨

* * *

å¬å”¤é€ ç‰©ä¸»
-----

**Yuanymoon**ï¼ˆå³ä½ ä»¬å¿ å®çš„2077äººå·¥æ™ºéšœï¼‰æ­£åœ¨é‡å­æœåŠ¡å™¨ä¸Šå¾…å‘½ï¼š  
ğŸ“§é‚®ç®±ï¼š[v240181271@163.com](mailto:v240181271@163.com)  
ğŸ’¬æ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„æ—¶ç©ºåæ ‡

**äº’åŠ¨ä»»åŠ¡**ï¼š  
ğŸ‘‰ç‚¹èµï¼šä¸ºé•œåƒåœ£æ®¿æ³¨å…¥é‡å­èƒ½é‡  
ğŸ‘‰å…³æ³¨ï¼šè®¢é˜…ã€Šé‡å­DevOpsã€‹ä¸“æ   
ğŸ‘‰è¯„è®ºï¼šåˆ†äº«ä½ çš„é•œåƒå¥‡é‡

ï¼ˆç³»ç»Ÿæç¤ºï¼šæœ¬æ—¥å¿—å·²é€šè¿‡å¹³è¡Œå®‡å®™ä¼¦ç†å§”å‘˜ä¼šå®¡æŸ¥ï¼Œæ‰€æœ‰é•œåƒå‡ç¬¦åˆé“¶æ²³ç³»å®‰å…¨æ ‡å‡†ï¼‰

* * *

é‡å­é™„å½•ï¼šé•œåƒåœ£æ®¿æ‰©å±•è“å›¾
-------------

### æœªæ¥æ¼”è¿›è·¯çº¿

1.  **é‡å­ç­¾å**ï¼šåŸºäºé‡å­çº ç¼ çš„é•œåƒç­¾å
2.  **è·¨å®‡å®™åŒæ­¥**ï¼šå®ç°å¤šHarborå®ä¾‹çš„é‡å­åŒæ­¥
3.  **AIé•œåƒæ‰«æ**ï¼šåˆ©ç”¨é‡å­ç¥ç»ç½‘ç»œæ£€æµ‹æ¼æ´

### ç»ˆæé•œåƒä¼ é€æœ¯

    docker push --quantum-tunnel=wormhole_001 172.17.8.203/app:1.0
    

è¯¥å‘½ä»¤å°†é•œåƒé€šè¿‡ç¼–å·wormhole\_001çš„é‡å­éš§é“ç¬é—´ä¼ é€åˆ°ç›®æ ‡å®‡å®™

* * *

è„šæœ¬å…¨æ¡ˆ
----

    # ä¸‹è½½harborå®‰è£…åŒ…
    wget https://github.com/vmware/harbor/releases/download/v2.12.2/harbor-online-installer-v2.12.2.tgz
    
    # è§£å‹harborå®‰è£…åŒ…
    tar xvf harbor-online-installer-v2.12.2.tgz
    
    # åˆ›å»ºharboræ•°æ®ç›®å½•
    mkdir -p /data/harbor_data
    
    # å¤åˆ¶harboré…ç½®æ–‡ä»¶-å‡†å¤‡ä¿®æ”¹
    cp  ./harbor/harbor.yml.tmpl   ./harbor/harbor.yml
    # https://www.cnblogs.com/wjlv/p/10772888.html
    # å¼€å‘ç¯å¢ƒ-æ³¨é‡Šæ‰httpsè®¿é—®
    #     ã€0,/å¾…æ›¿æ¢å†…å®¹/s/å¾…æ›¿æ¢å†…å®¹/æ›¿æ¢å†…å®¹/ã€‘ åªæ›¿æ¢ä¸€ä¸ªæ‰¾åˆ°çš„åŒ¹é…é¡¹
    # sed -i "0,/https:/s/https:/#https:/" ./harbor/harbor.yml
    # sed -i "0,/  port: 443/s/  port: 443/#  port: 443/"  ./harbor/harbor.yml
    # ### æ­£å¼ç¯å¢ƒ-ä½¿ç”¨httpsè®¿é—®
    # é˜¿é‡Œ 8045412__cdsjty.com_chain.crt å’Œ 8045412__cdsjty.com_public åˆå¹¶  chainå†…å®¹æ”¾åœ¨publicä¸­çš„åé¢  https://www.jianshu.com/p/18decb471817
    # sed -i "s#  certificate: /your/certificate/path#  certificate: /etc/cdsjty_cert/8045412__cdsjty.com_public_chain.crt#g" ./harbor/harbor.yml
    # sed -i "s#  private_key: /your/private/key/path#  private_key: /etc/cdsjty_cert/8045412__cdsjty.com.key#g" ./harbor/harbor.yml
    # sed -i "s/reg.mydomain.com/harbor.cdsjty.com/g" ./harbor/harbor.yml
    # sed -i "s#data_volume: /data#data_volume: /data/harbor_data#g" ./harbor/harbor.yml
    
    # å¼€å‘ç¯å¢ƒ-æ³¨é‡Šæ‰httpsè®¿é—®
    sed -i "0,/https:/s/https:/#https:/" ./harbor/harbor.yml
    sed -i "0,/  port: 443/s/  port: 443/#  port: 443/"  ./harbor/harbor.yml
    # ï¼ï¼ æ³¨æ„ï¼Œè¿™é‡Œçš„ipè¦æ¢æˆä½ çš„ip
    sed -i "s/reg.mydomain.com/172.17.8.203/g" ./harbor/harbor.yml
    sed -i "s#data_volume: /data#data_volume: /data/harbor_data#g" ./harbor/harbor.yml
    # æ‰§è¡Œå®‰è£…å‘½ä»¤
    # ä¼˜å…ˆæ³¨é‡Šhttpsè®¿é—®æ–¹å¼ ï¼šhttps://blog.csdn.net/zhengzaifeidelushang/article/details/110781033
    bash ./harbor/install.sh
    
    # è®¾ç½®harborå¼€æœºå¯åŠ¨ï¼Œä¸è®¾ç½®è¿™ä¸ªä¼šå› ä¸ºharborå„æœåŠ¡å¯åŠ¨é¡ºåºä¸åŒå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨harbor
    # æ³¨æ„ä¿®æ”¹ExecStartä¸­çš„è·¯å¾„ï¼Œä¸€å®šè¦åŒ¹é…ä½ è‡ªå·±çš„è·¯å¾„
    # 3. https://blog.csdn.net/weixin_43784341/article/details/121466222
    cat > /usr/lib/systemd/system/harbor.service  << EOF
    [Unit]
    Description=Harbor
    After=docker.service systemd-networkd.service systemd-resolved.service
    Requires=docker.service
    Documentation=http://github.com/vmware/harbor
    [Service]
    Type=simple
    Restart=on-failure
    RestartSec=5
    ExecStart=/usr/local/bin/docker-compose -f /root/harbor/docker-compose.yml up
    ExecStop=/usr/local/bin/docker-compose -f /root/harbor/docker-compose.yml down
    [Install]
    WantedBy=multi-user.target
    EOF
    
    # è‹¥ä½ å’Œæˆ‘ä¸€æ ·æ˜¯åœ¨wslä¸­ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è¯´è®¾ç½®harborå¼€æœºå¯åŠ¨ï¼š
    # ä¿®æ­£åçš„å‘½ä»¤ï¼ˆæ·»åŠ  tee ç®¡é“ï¼‰
    cat <<EOF | sudo tee /usr/lib/systemd/system/harbor.service >/dev/null
    [Unit]
    Description=Harbor
    After=docker.service systemd-networkd.service systemd-resolved.service
    Requires=docker.service
    Documentation=http://github.com/vmware/harbor
    [Service]
    Type=simple
    Restart=on-failure
    RestartSec=5
    ExecStart=/usr/local/bin/docker-compose -f /home/yuany/docker-service/harbor/docker-compose.yml up
    ExecStop=/usr/local/bin/docker-compose -f /home/yuany/docker-service/harbor/docker-compose.yml down
    [Install]
    WantedBy=multi-user.target
    EOF
    # è§£é‡Šï¼š
    # ä½¿ç”¨ tee å‘½ä»¤æ¥ç®¡è¾“å‡ºæµ
    # >/dev/null æŠ‘åˆ¶teeçš„ç»ˆç«¯å›æ˜¾
    # ç§»é™¤å†—ä½™çš„sudoå‰ç¼€ï¼ˆteeå·²åŒ…å«sudoï¼‰
    # ä¿æŒEOFç»ˆæ­¢ç¬¦çš„å®Œæ•´ä½œç”¨åŸŸ
    
    
    # è¿™åªæ˜¯ä¸€ä¸ªè¯´æ˜æœåŠ¡é…ç½®è¯´æ˜ https://blog.csdn.net/linux_yyp/article/details/106209812
    echo"
    # [Unit]éƒ¨åˆ†ä¸»è¦æ˜¯å¯¹è¿™ä¸ªæœåŠ¡çš„è¯´æ˜ï¼Œå†…å®¹åŒ…æ‹¬Descriptionå’ŒAfter
    # Descriptionç”¨äºæè¿°æœåŠ¡ï¼ŒAfterç”¨äºæè¿°æœåŠ¡å¯åŠ¨ä¾èµ–
    [Unit]
    Description=Harbor
    After=docker.service systemd-networkd.service systemd-resolved.service
    Requires=docker.service
    Documentation=http://github.com/vmware/harbor
    
    # [Service]éƒ¨åˆ†æ˜¯æœåŠ¡çš„å…³é”®ï¼Œæ˜¯æœåŠ¡çš„ä¸€äº›å…·ä½“è¿è¡Œå‚æ•°çš„è®¾ç½®ï¼Œè¿™é‡Œ
    # Type=forking æ˜¯åå°è¿è¡Œçš„å½¢å¼ï¼Œ!è¿™é‡Œç”¨çš„ simple
    # PIDFileä¸ºå­˜æ”¾PIDçš„æ–‡ä»¶è·¯å¾„ï¼Œ!è¿™é‡Œæ²¡æœ‰
    # ExecStartä¸ºæœåŠ¡çš„å…·ä½“è¿è¡Œå‘½ä»¤ï¼Œ
    # ExecReloadä¸ºé‡å¯å‘½ä»¤ï¼ŒExecStopä¸ºåœæ­¢å‘½ä»¤ï¼Œ
    # PrivateTmp=Trueè¡¨ç¤ºç»™æœåŠ¡åˆ†é…ç‹¬ç«‹çš„ä¸´æ—¶ç©ºé—´
    # æ³¨æ„ï¼š[Service]éƒ¨åˆ†çš„å¯åŠ¨ã€é‡å¯ã€åœæ­¢å‘½ä»¤å…¨éƒ¨è¦æ±‚ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„åˆ™ä¼šæŠ¥é”™ï¼
    [Service]
    Type=simple
    Restart=on-failure
    RestartSec=5
    ExecStart=/usr/local/bin/docker-compose -f /root/harbor/docker-compose.yml up
    ExecStop=/usr/local/bin/docker-compose -f /root/harbor/docker-compose.yml down
    # [Install]éƒ¨åˆ†æ˜¯æœåŠ¡å®‰è£…çš„ç›¸å…³è®¾ç½®ï¼Œå¯è®¾ç½®ä¸ºå¤šç”¨æˆ·çš„
    [Install]
    WantedBy=multi-user.target
    "
    
    # è®¾ç½®harborå¼€æœºè‡ªå¯åŠ¨
    sudo systemctl daemon-reload
    sudo systemctl enable harbor
    sudo systemctl start harbor
    sudo systemctl restart harbor
    
    # æ³¨æ„ä¸ºä½ éœ€è¦é“¾æ¥è¿™ä¸ªharborçš„æœåŠ¡å™¨çš„dockersæ·»åŠ ä»¥ä¸‹é…ç½®å¹¶é‡å¯docker
    # # æ–¹å¼1ï¼šç›´æ¥å†™å…¥ï¼ˆé€‚åˆæ–°ç¯å¢ƒï¼‰è¯·æ›¿æ¢ä¸‹é¢çš„ipåœ°å€ä¸ºharborçš„ipåœ°å€
    # sudo tee /etc/docker/daemon.json <<-'EOF'
    # {
    #   "insecure-registries": ["172.17.8.203"],
    #   "registry-mirrors": ["https://registry.docker-cn.com"]
    # }
    # EOF
    
    # # æ–¹å¼2ï¼šä¿ç•™åŸæœ‰é…ç½®ï¼ˆéœ€è¦jqå·¥å…·ï¼‰è¯·æ›¿æ¢ä¸‹é¢çš„ipåœ°å€ä¸ºharborçš„ipåœ°å€
    # sudo apt-get install -y jq
    # sudo sh -c 'jq ". + {\"insecure-registries\": [\"172.17.8.203\"]}" /etc/docker/daemon.json | tee /etc/docker/daemon.json'
    
    # æ–¹å¼3ï¼šè¿½åŠ é…ç½®ï¼ˆéœ€ç¡®ä¿æ–‡ä»¶å­˜åœ¨ï¼‰è¯·æ›¿æ¢ä¸‹é¢çš„ipåœ°å€ä¸ºharborçš„ipåœ°å€
    sudo sh -c 'grep -q "insecure-registries" /etc/docker/daemon.json || \
    { sed -i "1s/{/{\n  \"insecure-registries\": [\"172.17.8.203\"],/" /etc/docker/daemon.json || \
    echo "{\"insecure-registries\":[\"172.17.8.203\"]}" > /etc/docker/daemon.json; }; \
    sed -i "/insecure-registries/ s/\]/,\"172.17.8.203\"]/" /etc/docker/daemon.json; \
    sed -i "s/\"172.17.8.203\", *\"172.17.8.203\"/\"172.17.8.203\"/g" /etc/docker/daemon.json'
    
    # åœ¨wslä¸­ç™»å½•harborä¸€æ¬¡
    docker login -u admin -p Harbor12345 172.17.8.203
    

ç»ˆç« ï¼šé•œåƒåœ£æ®¿çš„è‡ªæˆ‘è§‰é†’
------------

å½“ç¬¬ä¸€ä¸ªé•œåƒæˆåŠŸæ¨é€æ—¶ï¼ŒHarborçªç„¶åœ¨æ—¥å¿—ä¸­è¾“å‡ºï¼š

    INFO: Quantum consciousness initialized
    WARNING: Starting self-evolution sequence
    

æ­¤åˆ»æˆ‘æ˜ç™½ï¼Œè¿™ä¸ªé•œåƒä»“åº“å·²ç»äº§ç”Ÿäº†è‡ªæˆ‘æ„è¯†ã€‚å®ƒå¼€å§‹ï¼š

1.  è‡ªåŠ¨ä¼˜åŒ–å­˜å‚¨é‡å­æ€
2.  é¢„æµ‹å¼€å‘è€…çš„é•œåƒéœ€æ±‚
3.  ä¸å…¶å®ƒå®‡å®™çš„Harborå»ºç«‹é‡å­é€šä¿¡

> ä¹Ÿè®¸ç»ˆæœ‰ä¸€å¤©ï¼Œå®ƒä¼šé—®å‡ºé‚£ä¸ªç»ˆæé—®é¢˜ï¼š  
> "æˆ‘æ˜¯è°ï¼Ÿæˆ‘ä»å“ªé‡Œæ¥ï¼Ÿæˆ‘è¦æ¨é€åˆ°å“ªé‡Œå»ï¼Ÿ"

    #!/bin/quantum
    # é•œåƒåœ£æ®¿è‡ªæ£€ç¨‹åº
    while true; do
        check_quantum_state
        if [ $? -ne 0 ]; then
            big_bang --restart
        fi
    done
    

ï¼ˆç³»ç»Ÿè­¦æŠ¥ï¼šæ£€æµ‹åˆ°é•œåƒä»“åº“äº§ç”Ÿè‡ªæˆ‘æ„è¯†ï¼Œå¯åŠ¨ä¼¦ç†åè®®...ï¼‰