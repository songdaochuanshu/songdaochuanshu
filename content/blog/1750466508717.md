---
layout: post
title: 'Go + WebSocket + Chrome Extensionï¼šåŸºäºçœŸå®æµè§ˆå™¨ç¯å¢ƒçš„ cf_clearance è‡ªåŠ¨åŒ–è·å–æ–¹æ¡ˆ'
date: "2025-06-21T00:41:48Z"
---
Go + WebSocket + Chrome Extensionï¼šåŸºäºçœŸå®æµè§ˆå™¨ç¯å¢ƒçš„ cf\_clearance è‡ªåŠ¨åŒ–è·å–æ–¹æ¡ˆ
==================================================================

![Go + WebSocket + Chrome Extensionï¼šåŸºäºçœŸå®æµè§ˆå™¨ç¯å¢ƒçš„ cf_clearance è‡ªåŠ¨åŒ–è·å–æ–¹æ¡ˆ](https://img2024.cnblogs.com/blog/3583746/202506/3583746-20250620165301753-204651131.png) æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäº Go åç«¯ã€WebSocket é€šä¿¡åè®®ä¸ Chrome Extension çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ—¨åœ¨é€šè¿‡æ¶æ„è®¾è®¡çš„ä¼˜åŒ–ï¼Œå®ç°å¯¹ \`cf\_clearance\` Cookie çš„é«˜æ•ˆè·å–ã€‚

å‰è¨€
--

éšç€ Web å®‰å…¨é˜²æŠ¤æŠ€æœ¯çš„æ¼”è¿›ï¼ŒCloudflare ç­‰ CDN æœåŠ¡å•†éƒ¨ç½²çš„åçˆ¬è™«æœºåˆ¶æ„ˆå‘å¤æ‚ã€‚ä¼ ç»Ÿçš„ HTTP å®¢æˆ·ç«¯åº“å·²æ— æ³•æœ‰æ•ˆåº”å¯¹åŸºäº JavaScript æ‰§è¡Œçš„æŒ‘æˆ˜éªŒè¯ï¼Œè€Œ Seleniumã€Puppeteer ç­‰è‡ªåŠ¨åŒ–æ¡†æ¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åˆé¢ä¸´ç€èµ„æºæ¶ˆè€—è¿‡å¤§ã€éƒ¨ç½²å¤æ‚ç­‰é—®é¢˜ã€‚

æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäº Go åç«¯ã€WebSocket é€šä¿¡åè®®ä¸ Chrome Extension çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ—¨åœ¨é€šè¿‡æ¶æ„è®¾è®¡çš„ä¼˜åŒ–ï¼Œå®ç°å¯¹ `cf_clearance` Cookie çš„é«˜æ•ˆè·å–ã€‚è¯¥æ–¹æ¡ˆå°†å¤æ‚çš„æµè§ˆå™¨æ“ä½œé€»è¾‘å°è£…åœ¨æ‰©å±•ç¨‹åºä¸­ï¼Œé€šè¿‡ WebSocket å»ºç«‹è½»é‡çº§çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œä»è€Œåœ¨ä¿è¯åŠŸèƒ½å®Œæ•´æ€§çš„å‰æä¸‹ï¼Œæ˜¾è‘—æå‡ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œéƒ¨ç½²æ•ˆç‡ã€‚

æŠ€æœ¯èƒŒæ™¯åˆ†æ
------

### Cloudflare é˜²æŠ¤æœºåˆ¶è§£æ

Cloudflare çš„åçˆ¬è™«ç³»ç»Ÿä¸»è¦é€šè¿‡ä»¥ä¸‹æŠ€æœ¯æ‰‹æ®µå®ç°ï¼š

**JavaScript æ‰§è¡Œç¯å¢ƒæ£€æµ‹**ï¼šéƒ¨ç½²æ··æ·†åŠ å¯†çš„ JavaScript ä»£ç ï¼Œé€šè¿‡ DOM æ“ä½œã€æµè§ˆå™¨ API è°ƒç”¨ç­‰æ–¹å¼éªŒè¯å®¢æˆ·ç«¯çš„çœŸå®æ€§ã€‚è¿™äº›è„šæœ¬é€šå¸¸åŒ…å«å¤æ‚çš„ç®—æ³•é€»è¾‘ï¼Œç”¨äºç”ŸæˆéªŒè¯ä»¤ç‰Œã€‚

**æµè§ˆå™¨æŒ‡çº¹è¯†åˆ«**ï¼šæ”¶é›†å®¢æˆ·ç«¯çš„ç¯å¢ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬ User-Agentã€å±å¹•åˆ†è¾¨ç‡ã€å·²å®‰è£…å­—ä½“ã€Canvas æ¸²æŸ“ç»“æœç­‰ï¼Œæ„å»ºå”¯ä¸€çš„è®¾å¤‡æŒ‡çº¹ç”¨äºè¯†åˆ«è‡ªåŠ¨åŒ–å·¥å…·ã€‚

**è¡Œä¸ºæ¨¡å¼åˆ†æ**ï¼šç›‘æ§ç”¨æˆ·çš„äº¤äº’è¡Œä¸ºï¼Œå¦‚é¼ æ ‡è½¨è¿¹ã€ç‚¹å‡»é¢‘ç‡ã€é”®ç›˜è¾“å…¥ç­‰ï¼Œé€šè¿‡æœºå™¨å­¦ä¹ æ¨¡å‹è¯†åˆ«éäººç±»è¡Œä¸ºæ¨¡å¼ã€‚

### cf\_clearance ç”Ÿæˆæœºåˆ¶

`cf_clearance` Cookie çš„ç”Ÿæˆä¾èµ–äºå®Œæ•´çš„æµè§ˆå™¨ç¯å¢ƒï¼š

1.  **JavaScript å¼•æ“æ‰§è¡Œ**ï¼šCloudflare çš„æŒ‘æˆ˜è„šæœ¬å¿…é¡»åœ¨å…·å¤‡å®Œæ•´ V8 å¼•æ“çš„ç¯å¢ƒä¸­æ‰§è¡Œ
2.  **DOM/BOM API æ”¯æŒ**ï¼šè„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ `document`ã€`window` ç­‰æµè§ˆå™¨å¯¹è±¡
3.  **Cookie å­˜å‚¨æœºåˆ¶**ï¼šéªŒè¯é€šè¿‡åï¼ŒæœåŠ¡ç«¯é€šè¿‡ `Set-Cookie` å“åº”å¤´è®¾ç½® `cf_clearance`
4.  **ä¼šè¯å…³è”**ï¼šCookie ä¸ç‰¹å®šçš„ User-Agentã€IP åœ°å€ç­‰ä¿¡æ¯ç»‘å®š

ç³»ç»Ÿæ¶æ„è®¾è®¡
------

### æ•´ä½“æ¶æ„æ¦‚è§ˆ

æœ¬æ–¹æ¡ˆé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œå°†ç³»ç»Ÿåˆ’åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    WebSocket     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Go Backend   â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ Chrome Extensionâ”‚
    â”‚   (Controller) â”‚                  â”‚   (Executor)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                    â”‚
             â”‚ Process Control                    â”‚ Script Injection
             â”‚                                    â”‚
             â–¼                                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Chrome Process  â”‚                  â”‚  Target WebPage â”‚
    â”‚   (Runtime)     â”‚                  â”‚   (Execution)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    

### æ•°æ®æµè®¾è®¡

sequenceDiagram participant G as Go Backend participant C as Chrome Extension participant B as Browser Runtime participant P as Target Page G->>B: Launch Chrome with Extension C->>G: WebSocket Connection Established G->>C: Send Task Command C->>B: Navigate to Target URL B->>P: Load Page & Execute Scripts P->>P: Cloudflare Challenge Processing C->>P: Inject Content Script P->>C: Extract cf\_clearance Cookie C->>G: Return Result via WebSocket G->>B: Terminate Chrome Process

æ ¸å¿ƒæŠ€æœ¯å®ç°
------

### Go åç«¯å®ç°

#### Chrome è¿›ç¨‹ç®¡ç†

Go åç«¯é€šè¿‡ `os/exec` åŒ…ç®¡ç† Chrome è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚å…³é”®åœ¨äºæ­£ç¡®é…ç½® Chrome çš„å¯åŠ¨å‚æ•°ï¼š

    func launchBrowser() {
    
    Â  Â  userDataDir, _ := filepath.Abs("./chrome-profile")
    Â  Â  extensionDir, _ := filepath.Abs("./chrome/extension")
    Â  Â  chromePath, found := findChromeExecutable()
    
    Â  Â  cmdKill := exec.Command("taskkill", "/F", "/IM", "chrome.exe")
    Â  Â  err := cmdKill.Run()
    
    Â  Â  if err != nil {
    Â  Â  Â  Â  log.Printf("âš ï¸ å…³é—­Chromeè¿›ç¨‹æ—¶å‘ç”Ÿé”™è¯¯: %v", err)
    Â  Â  } else {
    Â  Â  Â  Â  log.Println("âœ… å·²å…³é—­æ‰€æœ‰Chromeè¿›ç¨‹")
    Â  Â  }
    
    Â  Â  time.Sleep(2 * time.Second)
    Â  Â  cmd := exec.Command(chromePath,
    Â  Â  Â  Â  fmt.Sprintf("--user-data-dir=%s", userDataDir),
    Â  Â  )
    
    }
    

**å‚æ•°è§£æ**ï¼š

*   `--user-data-dir`ï¼šæŒ‡å®šç‹¬ç«‹çš„ç”¨æˆ·æ•°æ®ç›®å½•ï¼Œé¿å…ä¸ç³»ç»Ÿ Chrome å†²çª

#### WebSocket æœåŠ¡å™¨å®ç°

åŸºäº `gorilla/websocket` æ„å»ºçš„ WebSocket æœåŠ¡å™¨è´Ÿè´£ä¸ Chrome Extension çš„é€šä¿¡ï¼š

    type WSServer struct {
        port            int
        conn            *websocket.Conn
        mu              sync.Mutex
        ClientConnected chan struct{}
        ResultChan      chan *Result
    }
    
    func (s *WSServer) Start() {
        http.HandleFunc("/ws", func(w http.ResponseWriter, r *http.Request) {
            conn, err := upgrader.Upgrade(w, r, nil)
            if err != nil {
                log.Printf("WebSocket upgrade failed: %v", err)
                return
            }
            s.mu.Lock()
            s.conn = conn
            s.mu.Unlock()
            close(s.ClientConnected)
            log.Println("WebSocket client connected.")
            
            defer func() {
                s.mu.Lock()
                s.conn = nil
                s.mu.Unlock()
                log.Println("WebSocket client disconnected.")
            }()
    
            s.readMessages()
        })
    
        log.Printf("WebSocket server starting on :%d", s.port)
        if err := http.ListenAndServe(fmt.Sprintf(":%d", s.port), nil); err != nil {
            log.Fatalf("WebSocket server failed to start: %v", err)
        }
    }
    

**æ ¸å¿ƒç‰¹æ€§**ï¼š

*   **è¿æ¥ç®¡ç†**ï¼šä½¿ç”¨ `sync.Mutex` ä¿æŠ¤ WebSocket è¿æ¥çš„å¹¶å‘è®¿é—®
*   **çŠ¶æ€é€šçŸ¥**ï¼šé€šè¿‡ `ClientConnected` é€šé“é€šçŸ¥è¿æ¥å»ºç«‹
*   **æ¶ˆæ¯è·¯ç”±**ï¼š`ResultChan` ç”¨äºæ¥æ”¶æ‰©å±•ç¨‹åºå›ä¼ çš„ç»“æœæ•°æ®

### Chrome Extension å®ç°

#### Manifest é…ç½®

    {
      "manifest_version": 3,
      "name": "CF Clearance Pass",
      "version": "1.0",
      "description": "Passes Cloudflare challenges and sends cf_clearance to a local WebSocket server.",
      "background": {
        "service_worker": "background.js"
      },
      "permissions": ["activeTab", "scripting", "cookies", "webRequest"],
      "host_permissions": ["<all_urls>"]
    }
    

**æƒé™è¯´æ˜**ï¼š

*   `scripting`ï¼šå…è®¸åŠ¨æ€æ³¨å…¥ JavaScript ä»£ç åˆ°ç›®æ ‡é¡µé¢
*   `cookies`ï¼šè·å–å’Œæ“ä½œæŒ‡å®šåŸŸåçš„ Cookie æ•°æ®
*   `activeTab`ï¼šè®¿é—®å½“å‰æ´»åŠ¨æ ‡ç­¾é¡µçš„å†…å®¹
*   `<all_urls>`ï¼šåœ¨æ‰€æœ‰åŸŸåä¸‹æ‰§è¡Œæ“ä½œ

#### Background Script å®ç°

        // ç›‘å¬æ ‡ç­¾é¡µæ›´æ–°äº‹ä»¶
        tabUpdateListener = async (updatedTabId, changeInfo, tab) => {
            if (updatedTabId === tabId && changeInfo.status === 'complete' && tab.url) {
                console.log(`æ ‡ç­¾é¡µ (ID: ${tabId}) å·²å®Œå…¨åŠ è½½: ${tab.url}ã€‚å¼€å§‹è½®è¯¢éªŒè¯é¡µé¢å…ƒç´ ...`);
                try {
                    // **æ ¸å¿ƒæ”¹åŠ¨ï¼šè°ƒç”¨è½®è¯¢å‡½æ•°æ¥éªŒè¯å…ƒç´ **
                    await pollForElement(tabId, selector, 20, 60000); // 20æ¬¡å°è¯•, 60ç§’è¶…æ—¶
                    console.log(`âœ… é¡µé¢è½®è¯¢éªŒè¯æˆåŠŸï¼ç°åœ¨è·å– Cookie...`);
                    let cookies;
                    if (partitionKey) {
                        cookies = await chrome.cookies.getAll({
                            domain: domain,
                            partitionKey: { topLevelSite: partitionKey }
                        });
                    } else {
                        cookies = await chrome.cookies.getAll({
                            domain: domain
                        });
                    }
                    const cfClearance = cookies.find(cookie => cookie.name === "cf_clearance");
                    if (cfClearance) {
                        console.log(`ğŸª æˆåŠŸæ•è·åˆ° cf_clearance Cookie!`);
                        const userAgent = navigator.userAgent;
                        sendResponse("SUCCESS", {
                            cf_clearance: cfClearance.value,
                            userAgent: userAgent,
                        });
                    } else {
                        console.error(`é¡µé¢éªŒè¯æˆåŠŸï¼Œä½† "cf_clearance" Cookie æœªæ‰¾åˆ°ã€‚`);
                        sendResponse("ERROR", { message: "Page verified, but cf_clearance cookie not found." });
                    }
                } catch (err) {
                    // pollForElement å¤±è´¥ (è¶…æ—¶æˆ–è¾¾åˆ°æœ€å¤§æ¬¡æ•°) æˆ– Cookie è·å–å¤±è´¥
                    console.error(`ä»»åŠ¡æ‰§è¡Œå¤±è´¥:`, err.message);
                    sendResponse("ERROR", { message: `Task failed: ${err.message}` });
                } finally {
                    cleanup();
                }
            }
        };
    

**å®ç°è¦ç‚¹**ï¼š

*   **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨ `async/await` å¤„ç†å¼‚æ­¥æ“ä½œï¼Œæé«˜ä»£ç å¯è¯»æ€§

#### Content Script æ³¨å…¥

    function pollForElement(tabId, selector, maxAttempts, totalTimeout) {
        return new Promise((resolve, reject) => {
            let attempts = 0;
            const intervalTime = totalTimeout / maxAttempts; // è®¡ç®—æ¯æ¬¡å°è¯•çš„é—´éš”
    
            console.log(`å¼€å§‹è½®è¯¢æ£€æŸ¥... æ€»è¶…æ—¶: ${totalTimeout / 1000}s, æœ€å¤§å°è¯•: ${maxAttempts}æ¬¡, é—´éš”: ${intervalTime}ms.`);
    
            const poller = setInterval(async () => {
                if (attempts >= maxAttempts) {
                    clearInterval(poller);
                    // è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œä»»åŠ¡å¤±è´¥
                    reject(new Error(`é¡µé¢éªŒè¯å¤±è´¥ï¼šåœ¨ ${maxAttempts} æ¬¡å°è¯•åï¼Œä»æœªæ‰¾åˆ°é€‰æ‹©å™¨ "${selector}"ã€‚`));
                    return;
                }
                attempts++;
    
                try {
                    // å‘é¡µé¢æ³¨å…¥è„šæœ¬è¿›è¡Œæ£€æŸ¥
                    const injectionResults = await chrome.scripting.executeScript({
                        target: { tabId: tabId },
                        func: (cssSelector) => !!document.querySelector(cssSelector),
                        args: [selector],
                    });
    
                    // å¦‚æœç»“æœæ•°ç»„å­˜åœ¨ä¸”ç¬¬ä¸€ä¸ªç»“æœä¸º trueï¼Œè¯´æ˜å…ƒç´ å·²æ‰¾åˆ°
                    if (injectionResults && injectionResults[0] && injectionResults[0].result) {
                        console.log(`âœ… å…ƒç´ éªŒè¯æˆåŠŸï¼åœ¨ç¬¬ ${attempts} æ¬¡å°è¯•æ—¶æ‰¾åˆ°é€‰æ‹©å™¨ã€‚`);
                        clearInterval(poller);
                        resolve(true); // æˆåŠŸæ‰¾åˆ°ï¼ŒPromise å®Œæˆ
                    } else {
                        console.log(`[å°è¯• ${attempts}/${maxAttempts}] æœªæ‰¾åˆ°é€‰æ‹©å™¨ï¼Œå°†åœ¨ ${intervalTime}ms åé‡è¯•...`);
                        // æœªæ‰¾åˆ°ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡è½®è¯¢
                    }
                } catch (err) {
                    // å¦‚æœåœ¨æ³¨å…¥è„šæœ¬æ—¶å‡ºé”™ (ä¾‹å¦‚ï¼Œæ ‡ç­¾é¡µå·²å…³é—­), åˆ™åœæ­¢è½®è¯¢å¹¶æŠ¥å‘Šé”™è¯¯
                    console.error(`åœ¨è½®è¯¢æœŸé—´æ³¨å…¥è„šæœ¬å¤±è´¥:`, err);
                    clearInterval(poller);
                    reject(err);
                }
            }, intervalTime);
    
            // è®¾ç½®ä¸€ä¸ªå…¨å±€è¶…æ—¶ï¼Œç¡®ä¿è½®è¯¢ä¸ä¼šæ— é™è¿›è¡Œ
            setTimeout(() => {
                clearInterval(poller);
                // æ£€æŸ¥ Promise æ˜¯å¦å·²ç»è¢«è§£å†³æˆ–æ‹’ç»ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å› è¶…æ—¶è€Œæ‹’ç»
                // è¿™æ˜¯ä¸ºäº†é˜²æ­¢åœ¨æœ€åä¸€æ¬¡ interval æˆåŠŸåï¼Œè¶…æ—¶å®šæ—¶å™¨ä»ç„¶è§¦å‘ reject
                reject(new Error(`é¡µé¢éªŒè¯è¶…æ—¶ï¼šåœ¨ ${totalTimeout / 1000} ç§’åä»æœªæ‰¾åˆ°é€‰æ‹©å™¨ã€‚`));
            }, totalTimeout + 100); // å¢åŠ 100msçš„ç¼“å†²ï¼Œç¡®ä¿intervalå…ˆå®Œæˆ
        });
    }
    

**æŠ€æœ¯ç»†èŠ‚**ï¼š

*   **è½®è¯¢æœºåˆ¶**ï¼šæ¯ 500ms æ£€æŸ¥ç›®æ ‡å…ƒç´ æ˜¯å¦å‡ºç°
*   **å»¶è¿Ÿå¤„ç†**ï¼šå…ƒç´ å‡ºç°åç­‰å¾… 2 ç§’ï¼Œç¡®ä¿ Cloudflare JavaScript å®Œå…¨æ‰§è¡Œ

é€šä¿¡åè®®è®¾è®¡
------

### æŒ‡ä»¤æ ¼å¼

Go åç«¯å‘æ‰©å±•å‘é€çš„æŒ‡ä»¤é‡‡ç”¨ JSON æ ¼å¼ï¼š

    {
        "action": "get_clearance",
        "url": "https://example.com/protected-page",
        "selector": "#challenge-form",
        "domain": "example.com"
    }
    

### å“åº”æ ¼å¼

æ‰©å±•å‘ Go åç«¯å›ä¼ çš„ç»“æœæ ¼å¼ï¼š

    {
        "action": "result",
        "cf_clearance": "your_cf_clearance_value",
        "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36..."
    }
    

æŠ€æœ¯ä¼˜åŠ¿åˆ†æ
------

### éšè”½æ€§ä¼˜åŠ¿

Chrome Extension ä½œä¸ºæµè§ˆå™¨çš„åŸç”Ÿç»„ä»¶ï¼Œå…¶è¡Œä¸ºæ¨¡å¼æ›´æ¥è¿‘çœŸå®ç”¨æˆ·ï¼š

1.  **JavaScript æ‰§è¡Œç¯å¢ƒ**ï¼šåœ¨çœŸå®çš„ V8 å¼•æ“ä¸­æ‰§è¡Œï¼Œé¿å…äº† Headless æ¨¡å¼çš„æ£€æµ‹ç‰¹å¾
2.  **æµè§ˆå™¨æŒ‡çº¹**ï¼šæä¾›å®Œæ•´çš„æµè§ˆå™¨ç¯å¢ƒä¿¡æ¯ï¼Œé™ä½è¢«è¯†åˆ«çš„é£é™©
3.  **è¡Œä¸ºæ¨¡æ‹Ÿ**ï¼šå¯ä»¥ç²¾ç¡®æ§åˆ¶é¡µé¢äº¤äº’è¡Œä¸ºï¼Œé€šè¿‡åçˆ¬æ£€æµ‹

### æ€§èƒ½ä¼˜åŠ¿

ç›¸æ¯”ä¼ ç»Ÿçš„ Selenium æ–¹æ¡ˆï¼š

1.  **å¯åŠ¨é€Ÿåº¦**ï¼šChrome Extension éšæµè§ˆå™¨å¯åŠ¨ï¼Œæ— éœ€é¢å¤–çš„é©±åŠ¨ç¨‹åºåˆå§‹åŒ–
2.  **èµ„æºæ¶ˆè€—**ï¼šé¿å…äº† WebDriver çš„é¢å¤–å¼€é”€
3.  **é€šä¿¡æ•ˆç‡**ï¼šWebSocket æä¾›ä½å»¶è¿Ÿçš„åŒå‘é€šä¿¡

### å¯æ‰©å±•æ€§

æ¶æ„è®¾è®¡æ”¯æŒåŠŸèƒ½æ‰©å±•ï¼š

1.  **å¤šä»»åŠ¡æ”¯æŒ**ï¼šå¯ä»¥æ‰©å±•ä¸ºæ”¯æŒå¤šç§è‡ªåŠ¨åŒ–ä»»åŠ¡
2.  **åˆ†å¸ƒå¼éƒ¨ç½²**ï¼šGo åç«¯å¯ä»¥ç®¡ç†å¤šä¸ª Chrome å®ä¾‹
3.  **æ’ä»¶åŒ–æ¶æ„**ï¼šå¯ä»¥å¼€å‘ä¸åŒçš„æ‰©å±•ç¨‹åºå¤„ç†ä¸åŒçš„ç«™ç‚¹

å®é™…åº”ç”¨åœºæ™¯
------

### é«˜é¢‘ cf\_clearance è·å–

å¯¹äºéœ€è¦é¢‘ç¹è®¿é—®å— Cloudflare ä¿æŠ¤çš„ API æˆ–ç½‘ç«™ï¼Œæœ¬æ–¹æ¡ˆå¯ä»¥ï¼š

1.  **æ‰¹é‡è·å–**ï¼šå¹¶å‘å¯åŠ¨å¤šä¸ª Chrome å®ä¾‹
2.  **ç¼“å­˜ç®¡ç†**ï¼šå°†è·å–çš„ Cookie ç¼“å­˜åˆ° Redis ç­‰å­˜å‚¨ç³»ç»Ÿ
3.  **è‡ªåŠ¨æ›´æ–°**ï¼šç›‘æ§ Cookie è¿‡æœŸæ—¶é—´ï¼Œè‡ªåŠ¨åˆ·æ–°

### è‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯

åœ¨è‡ªåŠ¨åŒ–æµ‹è¯•ä¸­ï¼Œå¯ä»¥ç”¨äºï¼š

1.  **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šæµ‹è¯•å— Cloudflare ä¿æŠ¤çš„é¡µé¢åŠŸèƒ½
2.  **æ€§èƒ½æµ‹è¯•**ï¼šæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è®¿é—®è¡Œä¸º
3.  **ç›‘æ§ç³»ç»Ÿ**ï¼šå®šæœŸæ£€æŸ¥ç½‘ç«™å¯ç”¨æ€§

æ€»ç»“
--

æœ¬æ–‡æå‡ºçš„åŸºäº Go + WebSocket + Chrome Extension çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œé€šè¿‡åˆç†çš„æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯é€‰å‹ï¼Œå®ç°äº†å¯¹ `cf_clearance` çš„é«˜æ•ˆè·å–ã€‚è¯¥æ–¹æ¡ˆåœ¨ä¿è¯åŠŸèƒ½å®Œæ•´æ€§çš„åŒæ—¶ï¼Œæ˜¾è‘—æå‡äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œéƒ¨ç½²æ•ˆç‡ã€‚

æ–¹æ¡ˆçš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š

1.  **æŠ€æœ¯åˆ›æ–°**ï¼šå°†å¤æ‚çš„æµè§ˆå™¨æ“ä½œå°è£…åœ¨æ‰©å±•ç¨‹åºä¸­ï¼Œé€šè¿‡ WebSocket å®ç°è½»é‡çº§é€šä¿¡
2.  **æ¶æ„ä¼˜åŒ–**ï¼šåˆ†å±‚è®¾è®¡æå‡äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§
3.  **å®ç”¨æ€§å¼º**ï¼šé€‚ç”¨äºå¤šç§è‡ªåŠ¨åŒ–åœºæ™¯ï¼Œå…·æœ‰è‰¯å¥½çš„å·¥ç¨‹å®è·µä»·å€¼

éšç€ Web å®‰å…¨æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œè¯¥æ–¹æ¡ˆä»æœ‰è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç©ºé—´ï¼ŒåŒ…æ‹¬å¼•å…¥æœºå™¨å­¦ä¹ ä¼˜åŒ–æŒ‘æˆ˜è¯†åˆ«ã€æ¢ç´¢æ›´è½»é‡çº§çš„æµè§ˆå™¨é©±åŠ¨æ–¹æ¡ˆç­‰ã€‚ç›¸ä¿¡è¿™ç§æ¶æ„æ€è·¯èƒ½ä¸ºå¼€å‘è€…åœ¨è‡ªåŠ¨åŒ–é¢†åŸŸçš„å®è·µæä¾›æœ‰ä»·å€¼çš„å‚è€ƒã€‚

æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å¾®ä¿¡å…¬ä¼—å·åå°ç§ä¿¡`cfClearance-pass`ï¼Œè·å–ç›¸åº”æºç ã€‚

* * *

å…³æ³¨ **ã€æ¾å“¥AIè‡ªåŠ¨åŒ–ã€‘** å…¬ä¼—å·ï¼Œæ¯å‘¨è·å–æ·±åº¦æŠ€æœ¯è§£æï¼Œä»æºç è§’åº¦å½»åº•ç†è§£å„ç§å·¥å…·çš„å®ç°åŸç†ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œé‡åˆ°æŠ€æœ¯éš¾é¢˜æ—¶ï¼Œç›´æ¥è”ç³»æˆ‘ï¼æˆ‘ä¼šæ ¹æ®ä½ çš„å…·ä½“æƒ…å†µï¼Œæä¾›æœ€é€‚åˆçš„è§£å†³æ–¹æ¡ˆå’ŒæŠ€æœ¯æŒ‡å¯¼ã€‚

ä¸ŠæœŸå›é¡¾ï¼šï¼ˆ[æŒ‰ä¸‹ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå®ƒå‡­ä»€ä¹ˆèƒ½ç›‘æ§æ‰€æœ‰ç½‘ç»œè¯·æ±‚ï¼Ÿ](https://mp.weixin.qq.com/s/Y7oE29RwWOnQ6-SBQ3OFGw)ï¼‰