---
layout: post
title: 'åŸºäºPythonçš„FastAPIåç«¯å¼€å‘æ¡†æ¶å¦‚ä½•ä½¿ç”¨PyInstaller è¿›è¡Œæ‰“åŒ…ä¸éƒ¨ç½²'
date: "2025-10-12T00:41:23Z"
---
åŸºäºPythonçš„FastAPIåç«¯å¼€å‘æ¡†æ¶å¦‚ä½•ä½¿ç”¨PyInstaller è¿›è¡Œæ‰“åŒ…ä¸éƒ¨ç½²
---------------------------------------------

æˆ‘åœ¨éšç¬”ã€ŠWxPythonè·¨å¹³å°å¼€å‘æ¡†æ¶ä¹‹ä½¿ç”¨PyInstaller è¿›è¡Œæ‰“åŒ…å¤„ç†ã€‹ä¸­ä»‹ç»è¿‡å¦‚ä½•ä½¿ç”¨PyInstaller è¿›è¡Œæ‰“åŒ…å¤„ç†çš„ä¸€äº›è¿‡ç¨‹å’Œäº‹é¡¹ã€‚æˆ‘ä»¬åŸºäºPythonçš„FastAPIåç«¯åº”ç”¨ï¼Œåœ¨å®é™…å¼€å‘çš„æ—¶å€™ï¼Œç›´æ¥è¿è¡Œmain.py è¿›è¡Œè°ƒè¯•å³å¯ï¼Œä½†æ˜¯éƒ¨ç½²çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠå®ƒä»¬è¿›è¡Œæ‰“åŒ…å¤„ç†ï¼Œè¿™é‡Œé¦–é€‰PyInstaller è¿›è¡Œæ‰“åŒ…ã€‚æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† å¦‚ä½•ä½¿ç”¨ PyInstaller å¯¹åŸºäº Python çš„ FastAPI åç«¯é¡¹ç›®è¿›è¡Œæ‰“åŒ…ä¸éƒ¨ç½²ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨ç›®æ ‡ç¯å¢ƒä¸­ä»¥ç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶çš„å½¢å¼è¿è¡Œï¼Œæ— éœ€å®‰è£… Python è§£é‡Šå™¨æˆ–é¢å¤–ä¾èµ–ã€‚æ–‡ç« é¢å‘å¸Œæœ›å°† FastAPI æœåŠ¡æ‰“åŒ…ä¸ºç‹¬ç«‹è¿è¡ŒæœåŠ¡çš„å¼€å‘è€…ï¼Œç‰¹åˆ«é€‚ç”¨äºä¼ä¸šå†…éƒ¨ç³»ç»Ÿæˆ–éœ€è¦ç®€åŒ–éƒ¨ç½²çš„åœºæ™¯ã€‚

æˆ‘åœ¨éšç¬”ã€ŠWxPythonè·¨å¹³å°å¼€å‘æ¡†æ¶ä¹‹ä½¿ç”¨PyInstaller è¿›è¡Œæ‰“åŒ…å¤„ç†ã€‹ä¸­ä»‹ç»è¿‡å¦‚ä½•ä½¿ç”¨PyInstaller è¿›è¡Œæ‰“åŒ…å¤„ç†çš„ä¸€äº›è¿‡ç¨‹å’Œäº‹é¡¹ã€‚æˆ‘ä»¬åŸºäºPythonçš„FastAPIåç«¯åº”ç”¨ï¼Œåœ¨å®é™…å¼€å‘çš„æ—¶å€™ï¼Œç›´æ¥è¿è¡Œmain.py è¿›è¡Œè°ƒè¯•å³å¯ï¼Œä½†æ˜¯éƒ¨ç½²çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠå®ƒä»¬è¿›è¡Œæ‰“åŒ…å¤„ç†ï¼Œè¿™é‡Œé¦–é€‰PyInstaller è¿›è¡Œæ‰“åŒ…ã€‚æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† **å¦‚ä½•ä½¿ç”¨ PyInstaller å¯¹åŸºäº Python çš„ FastAPI åç«¯é¡¹ç›®è¿›è¡Œæ‰“åŒ…ä¸éƒ¨ç½²**ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨ç›®æ ‡ç¯å¢ƒä¸­ä»¥ç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶çš„å½¢å¼è¿è¡Œï¼Œæ— éœ€å®‰è£… Python è§£é‡Šå™¨æˆ–é¢å¤–ä¾èµ–ã€‚æ–‡ç« é¢å‘å¸Œæœ›å°† FastAPI æœåŠ¡æ‰“åŒ…ä¸ºç‹¬ç«‹è¿è¡ŒæœåŠ¡çš„å¼€å‘è€…ï¼Œç‰¹åˆ«é€‚ç”¨äºä¼ä¸šå†…éƒ¨ç³»ç»Ÿæˆ–éœ€è¦ç®€åŒ–éƒ¨ç½²çš„åœºæ™¯ã€‚

#### ä¸€ã€èƒŒæ™¯ä¸ç›®æ ‡

*   è¯´æ˜ä¸ºä»€ä¹ˆéœ€è¦å°† FastAPI é¡¹ç›®æ‰“åŒ…ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚
    
*   å¯¹æ¯”ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼ï¼ˆå¦‚ `uvicorn main:app`ï¼‰ä¸ PyInstaller æ‰“åŒ…æ–¹å¼çš„åŒºåˆ«ã€‚
    
*   é€‚ç”¨åœºæ™¯ï¼šä¼ä¸šå†…ç½‘éƒ¨ç½²ã€Windows æœåŠ¡ã€æ—  Python ç¯å¢ƒçš„æœåŠ¡å™¨ç­‰ã€‚
    

#### äºŒã€ç¯å¢ƒå‡†å¤‡

*   Python ç‰ˆæœ¬è¦æ±‚ï¼ˆæ¨è Python 3.12.4+ï¼‰ã€‚
    
*   FastAPI ä¸ä¾èµ–ï¼ˆ`fastapi`, `uvicorn`, `pydantic`, `sqlalchemy`, ç­‰ï¼‰ã€‚
    
*   å®‰è£… PyInstallerï¼š
    

pip install pyinstaller

#### ä¸‰ã€FastAPI é¡¹ç›®ç»“æ„ç¤ºä¾‹

å±•ç¤ºä¸€ä¸ªå…¸å‹çš„ FastAPI é¡¹ç›®ç»“æ„ï¼š

project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ services/
â”‚   â””â”€â”€ \_\_init\_\_.py
â”œâ”€â”€ requirements.txt

å¹¶è¯´æ˜ `main.py` ä¸­å¦‚ä½•å¯åŠ¨æœåŠ¡ï¼Œä¾‹å¦‚ï¼š

import uvicorn
from app.main import app

if \_\_name\_\_ == "\_\_main\_\_":
    uvicorn.run(app, host\="0.0.0.0", port=8000)

#### å››ã€ä½¿ç”¨ PyInstaller æ‰“åŒ…

PyInstalleræ˜¯ç›®å‰æœ€æµè¡Œçš„Pythonæ‰“åŒ…å·¥å…·ä¹‹ä¸€ã€‚å®ƒå¯ä»¥å°†Pythonè„šæœ¬æ‰“åŒ…æˆç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¯æŒWindowsã€Linuxå’ŒmacOSå¹³å°ã€‚

PyInstaller æœ‰ä¸°å¯Œçš„æ–‡æ¡£ï¼Œæä¾›äº†è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œå¸¸è§é—®é¢˜è§£ç­”ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹é“¾æ¥è®¿é—®ï¼š

*   PyInstaller å®˜æ–¹æ–‡æ¡£ï¼š[https://pyinstaller.readthedocs.io](https://pyinstaller.readthedocs.io/)
*   GitHub ä»£ç åº“ï¼š[https://github.com/pyinstaller/pyinstaller](https://github.com/pyinstaller/pyinstaller)

è¿™äº›æ–‡æ¡£å’Œèµ„æºèƒ½å¸®åŠ©ä½ æ·±å…¥äº†è§£ PyInstaller çš„ä½¿ç”¨æ–¹å¼ï¼Œå¹¶è§£å†³åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚

æ‰“åŒ…åçš„å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥åœ¨æ²¡æœ‰ Python ç¯å¢ƒçš„æœºå™¨ä¸Šè¿è¡Œã€‚PyInstaller ä¼šè‡ªåŠ¨åˆ†æç¨‹åºçš„ä¾èµ–å…³ç³»ï¼Œå¹¶å°†æ‰€æœ‰å¿…è¦çš„åº“å’Œèµ„æºæ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚

æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼ŒPyInstaller ä¼šç”Ÿæˆä¸€ä¸ªÂ `.spec`Â æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº† PyInstaller çš„é…ç½®ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«äº†æ„å»ºè¿‡ç¨‹çš„æ‰€æœ‰é…ç½®ä¿¡æ¯ã€‚ä½ å¯ä»¥ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶æ¥å®šåˆ¶æ‰“åŒ…è¿‡ç¨‹ã€‚

å¦‚æœæˆ‘ä»¬æ‰§è¡Œä¸‹é¢ä»£ç 

pyinstaller main.py

æˆ–è€…æŒ‡å®šæ›´å¤šçš„å‚æ•°çš„ä»£ç 

pyinstaller --onefile --icon=your\_icon.ico main.py

PyInstaller éƒ½ä¼šç”Ÿæˆä¸€ä¸ªÂ `.spec`Â æ–‡ä»¶ï¼Œç„¶åå¯ä»¥ç¼–è¾‘Â `main.spec`Â æ–‡ä»¶ï¼Œä»¥ä¾¿è¿›è¡Œæ›´å¥½çš„æ§åˆ¶ç®¡ç†æ‰“åŒ…æ–‡ä»¶ã€‚

è™½ç„¶åŸåˆ™ä¸Š.specæ–‡ä»¶æ”¯æŒè·¨å¹³å°çš„é…ç½®ï¼Œä¸è¿‡æˆ‘ä»¬åœ¨å®é™…ä¸­å¾€å¾€æ ¹æ®ä¸åŒçš„å¹³å°é…ç½®ç‰¹å®šçš„.specæ–‡ä»¶ã€‚

ä½ å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹Â `.spec`Â æ–‡ä»¶æ¥æ·»åŠ èµ„æºæ–‡ä»¶ã€ä¿®æ”¹å¯¼å…¥æ¨¡å—ã€å®šåˆ¶è¾“å‡ºè·¯å¾„ç­‰ã€‚

ä½ å¯ä»¥é€šè¿‡ç¼–è¾‘`.spec`Â æ–‡ä»¶ï¼Œåœ¨EXEã€COLLECTå’ŒBUNDLEå—ä¸‹æ·»åŠ ä¸€ä¸ª`name=`Â ï¼Œä¸º_PyInstaller_æä¾›ä¸€ä¸ªæ›´å¥½çš„åå­—ï¼Œä»¥ä¾¿ä¸ºåº”ç”¨ç¨‹åºï¼ˆå’Œ`dist`Â æ–‡ä»¶å¤¹ï¼‰ä½¿ç”¨ã€‚

EXEä¸‹çš„åå­—æ˜¯_å¯æ‰§è¡Œæ–‡ä»¶_çš„åå­—ï¼ŒBUNDLEä¸‹çš„åå­—æ˜¯åº”ç”¨ç¨‹åºåŒ…çš„åå­—ã€‚

import sys
import os
from pathlib import Path

# æœ¬æ–‡ä»¶ç”¨äºWindowå¹³å°ä¸‹æ‰“åŒ…æ•´ä¸ªé¡¹ç›®ï¼Œç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„exeæ–‡ä»¶ï¼Œä¾èµ–æ–‡ä»¶æ¾æ•£ç»„åˆ
# æ‰§è¡Œå‘½ä»¤ï¼špyinstaller main\_my.spec
# æ‰“åŒ…åç”Ÿæˆæ–‡ä»¶ï¼šdist\\fastapi\_app\\fastapi\_app.exe
# è¿è¡Œåï¼Œä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ª dist æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ fastapi\_app.exe æ–‡ä»¶ï¼Œåœ¨å‘½ä»¤è¡Œçª—å£è¿è¡Œè¯¥æ–‡ä»¶å³å¯å¯åŠ¨æœåŠ¡ã€‚

if sys.platform == "win32":
    icon \= "app/images/app.ico"
elif sys.platform == "darwin":
    icon \= "app/images/app.icns"

block\_cipher \= None

# å¯¼å…¥ PyInstaller æ¨¡å—
from PyInstaller.building.build\_main import Analysis
from PyInstaller.building.build\_main import PYZ
from PyInstaller.building.build\_main import EXE
from PyInstaller.building.build\_main import COLLECT

# Analysis: PyInstaller Analysis object
a = Analysis(
    \["app/main.py"\],
    pathex\=\[\],
    binaries\=\[\],
    **datas**\=\[
        ("app/uvicorn\_config.json", "app"),
        ("app/.env", "."),
        ("app/images/\*", "app/images"),
        ("app/templates/\*", "app/templates"),
        ("app/uploadfiles/\*", "app/uploadfiles"),
        ("app/logs/\*", "app/logs"),
    \],
    **hiddenimports**\=\[
         "uvicorn", "fastapi", "pydantic", "aiomysql", 'asyncio',   # ç¡®ä¿ä¾èµ–è¢«æ­£ç¡®åŒ…å«
    \],
    hookspath\=\[\],
    hooksconfig\={},
    runtime\_hooks\=\[\],
    excludes\=\[\],
    win\_no\_prefer\_redirects\=False,
    win\_private\_assemblies\=False,
    cipher\=block\_cipher,
    noarchive\=False,
    optimize\=0,
)

# PYZ: PyInstaller PYZ object
pyz = PYZ(a.pure, a.zipped\_data, cipher=block\_cipher)

ä¿®æ”¹å®Œæˆåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥é‡æ–°æ‰“åŒ…ï¼š

pyinstaller main\_my.spec

å¦‚æœæˆ‘ä»¬æƒ³åœ¨Windowså¹³å°ç”Ÿæˆçš„distç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ªå¯åŠ¨exeï¼Œå’Œå…¶ä»–ç›¸å…³çš„Libä¾èµ–åº“ç›®å½•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€‚å½“è°ƒæ•´ä¸‹.specæ–‡ä»¶ï¼Œè®©å®ƒå¯ä»¥ç”Ÿæˆæ¾æ•£ç»“æ„çš„æ–‡ä»¶ç›®å½•åŒ…ã€‚

exe = EXE(
    pyz,
    a.scripts,
    \[\],
    **exclude\_binaries****\=****True,**
    name\="fastapi\_app",
    debug\=False,
    bootloader\_ignore\_signals\=False,
    strip\=False,
    upx\=True,
    upx\_exclude\=\[\],
    runtime\_tmpdir\=None,
    console\=True,          # True = æœ‰æ§åˆ¶å°è¾“å‡ºï¼ˆè°ƒè¯•æ–¹ä¾¿ï¼‰ï¼ŒFalse = é™é»˜è¿è¡Œ
    onefile=False,  # <-- Falseå–æ¶ˆã€Trueä½¿ç”¨ onefile æ¨¡å¼
    icon=icon,  # <-- å›¾æ ‡è·¯å¾„
    disable\_windowed\_traceback=False,
    argv\_emulation\=False,
    target\_arch\=None,
    codesign\_identity\=None,
    entitlements\_file\=None,
)

coll \= COLLECT(
    exe,
    **a.binaries,
    a.zipfiles,
    a.datas,**
    strip\=False,
    upx\=True,
    name\='fastapi\_app'
)

ç›¸å½“äºä¹‹å‰åœ¨exeåŒ…ä¸­çš„a.binaries å’Œ a.datasä»EXE æ„é€ å‡½æ•°ä¸­ç§»åˆ°äº†Collectçš„æ„é€ å‡½æ•°é‡Œé¢äº†ã€‚è¿™æ ·ä¼šç”Ÿæˆä¸‹é¢çš„ç›®å½•ç»“æ„ã€‚

![image](https://img2024.cnblogs.com/blog/8867/202510/8867-20251011105724278-1565882326.png)

å…¶ä¸­\_internalç›®å½•åŒ…å«ç¨‹åºçš„ç›¸å…³ä¾èµ–åŒ…å’Œæ–‡ä»¶èµ„æºã€‚

![image](https://img2024.cnblogs.com/blog/8867/202510/8867-20251011105858942-106096974.png)

ç”±äºæ‰“åŒ…çš„.specæ–‡ä»¶æŒ‡å®šçš„ç›®å½•ç»“æ„ä¸ºæ¾æ•£ç»“æ„ï¼ˆä½¿ç”¨äº†COLLECTæ„é€ ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥çœ‹åˆ° \_internal / appç›®å½•ä¸‹æœ‰ä¸‹é¢çš„ç›®å½•ç»“æ„ã€‚

![image](https://img2024.cnblogs.com/blog/8867/202510/8867-20251011113400548-169982050.png)

ä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢é€šè¿‡Â Analysis æ¨¡å—æŒ‡å®šçš„datasé›†åˆè·¯å¾„çš„å†…å®¹ã€‚

**è§£å†³å¸¸è§é—®é¢˜**

*   **ç¼ºå°‘ä¾èµ–åº“**ï¼šå¦‚æœæ‰“åŒ…åè¿è¡Œæ—¶å‡ºç°ç¼ºå°‘æ¨¡å—çš„é”™è¯¯ï¼Œå¯ä»¥å°è¯•å°†ç¼ºå°‘çš„æ¨¡å—åŠ å…¥åˆ°Â `hiddenimports`Â ä¸­ï¼Œæˆ–è€…é€šè¿‡Â `--hidden-import`Â é€‰é¡¹æŒ‡å®šï¼š
    
*   **å¤§æ–‡ä»¶**ï¼šå¦‚æœä½¿ç”¨Â `--onefile`Â æ—¶æ‰“åŒ…åçš„æ–‡ä»¶å¤ªå¤§ï¼Œè€ƒè™‘ä½¿ç”¨Â `--onedir`Â æˆ–é€šè¿‡å‹ç¼©æ–‡ä»¶ç­‰æ–¹æ³•è¿›è¡Œä¼˜åŒ–ã€‚
*   **å¤„ç†èµ„æºæ–‡ä»¶ï¼š**å¦‚æœä½ çš„åº”ç”¨ç¨‹åºåŒ…å«é Python ä»£ç çš„èµ„æºï¼ˆå¦‚å›¾åƒã€é…ç½®æ–‡ä»¶ã€æ•°æ®æ–‡ä»¶ç­‰ï¼‰ï¼Œä½ éœ€è¦é€šè¿‡Â `--add-data`Â é€‰é¡¹æŒ‡å®šèµ„æºæ–‡ä»¶çš„è·¯å¾„ï¼Œæˆ–è€…åœ¨Â `.spec`Â æ–‡ä»¶ä¸­ä¿®æ”¹Â `datas`Â é€‰é¡¹ã€‚
*   **åŠ¨æ€é“¾æ¥åº“**ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºä¾èµ–äºç‰¹å®šçš„åŠ¨æ€é“¾æ¥åº“ï¼ˆå¦‚ DLL æ–‡ä»¶æˆ–Â `.so`Â æ–‡ä»¶ï¼‰ï¼Œä½ éœ€è¦å°†è¿™äº›åº“åŒ…å«åˆ°æ‰“åŒ…ä¸­ã€‚å¯ä»¥åœ¨Â `.spec`Â æ–‡ä»¶çš„Â `binaries`Â é€‰é¡¹ä¸­æŒ‡å®šï¼š
    
*   **å¤šå¹³å°æ”¯æŒï¼š**PyInstaller æ”¯æŒ Windowsã€Linux å’Œ macOS ç­‰å¤šä¸ªå¹³å°ï¼Œä½†éœ€è¦åœ¨ç›¸åº”çš„å¹³å°ä¸Šæ‰“åŒ…ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ è¦ä¸º Windows ç”¨æˆ·åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæœ€å¥½åœ¨ Windows ä¸Šè¿è¡Œ PyInstaller æ¥ç”Ÿæˆ Windows çš„Â `.exe`Â æ–‡ä»¶ã€‚å¦‚æœåœ¨ macOS ä¸Šæ‰“åŒ…ï¼Œç”Ÿæˆçš„æ–‡ä»¶åªèƒ½åœ¨ macOS ä¸Šè¿è¡Œã€‚
    

åœ¨ä½¿ç”¨Â **PyInstaller**Â æ‰“åŒ… FastAPIï¼ˆæˆ–å…¶ä»– Python åº”ç”¨ï¼‰æ—¶ï¼Œä¸¤ä¸ªæœ€å¸¸è§ã€æœ€å®¹æ˜“æ··æ·†çš„å‚æ•°å°±æ˜¯ï¼š

*   `--add-data`ï¼ˆæˆ–Â `.spec`Â æ–‡ä»¶ä¸­çš„Â `datas`ï¼‰
    
*   `--hidden-import`ï¼ˆæˆ–Â `.spec`Â æ–‡ä»¶ä¸­çš„Â `hiddenimports`ï¼‰
    

å½“ PyInstaller æ‰“åŒ…æ—¶ï¼Œå®ƒé»˜è®¤åªä¼šåˆ†æ Python ä»£ç çš„ä¾èµ–æ¨¡å—ï¼Œè€Œä¸ä¼šè‡ªåŠ¨åŒ…å«å›¾ç‰‡ã€HTML æ¨¡æ¿ã€é…ç½®æ–‡ä»¶ç­‰é™æ€èµ„æºã€‚  
è¿™æ—¶ï¼Œå°±éœ€è¦ç”¨Â `--add-data`ï¼ˆæˆ–åœ¨Â `.spec`Â æ–‡ä»¶çš„Â `datas`Â ä¸­å®šä¹‰ï¼‰å‘Šè¯‰å®ƒè¦é¢å¤–æ‰“åŒ…å“ªäº›æ–‡ä»¶æˆ–ç›®å½•ã€‚

è¿™é‡Œä¸ä»‹ç»å‘½ä»¤è¡Œçš„æ–¹å¼ï¼Œåªä»‹ç»`.spec` æ–‡ä»¶å†™æ³•ï¼š

![image](https://img2024.cnblogs.com/blog/8867/202510/8867-20251011110706258-1292089188.png)

PyInstaller åœ¨æ‰“åŒ…æ—¶ï¼Œä¼šåˆ†æä½ çš„ Python æºä»£ç ï¼ˆASTï¼‰æ¥åˆ¤æ–­ä½¿ç”¨äº†å“ªäº›æ¨¡å—ã€‚ä½†æœ‰äº›æ¨¡å—æ˜¯**åŠ¨æ€å¯¼å…¥çš„**ï¼ˆä¾‹å¦‚é€šè¿‡ `importlib` æˆ–å­—ç¬¦ä¸²å¯¼å…¥ï¼‰ï¼Œå®ƒå°±å¯èƒ½æ¼æ‰ã€‚

è§£å†³åŠæ³•ï¼šç”¨ `--hidden-import`Â æˆ–è€….specæ–‡ä»¶ä¸­æŒ‡å®šÂ hiddenimports é›†åˆï¼Œå‘Šè¯‰ PyInstaller æŠŠè¿™äº›æ¨¡å—ä¹Ÿæ‰“åŒ…è¿›å»ï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚

æ€»ç»“èµ·æ¥å°±æ˜¯ï¼š

*   `datas` = â€œæˆ‘è¿˜æœ‰é¢å¤–çš„æ–‡ä»¶è¦å¸¦ä¸Šâ€ã€‚
    
*   `hiddenimports` = â€œæˆ‘è¿˜æœ‰é¢å¤–çš„æ¨¡å—è¦å¸¦ä¸Šâ€ã€‚
    

#### äº”ã€FastAPI é¡¹ç›®æ‰“åŒ…çš„å¤„ç†

å‰é¢ä»‹ç»äº†ä¸€ä¸ªç®€å•çš„fastapiçš„é¡¹ç›®ç»“æ„å’Œå¯åŠ¨ï¼Œä¸€èˆ¬æˆ‘ä»¬åœ¨å¼€å‘çš„æ—¶å€™ï¼Œå¯åŠ¨fastapiï¼Œç›´æ¥è°ƒç”¨pythonè§£æå™¨è¿è¡Œmain.pyæ–‡ä»¶å³å¯å¯åŠ¨ï¼Œå¸¸è§„æ¥è¯´ï¼Œmain.pyçš„å¯åŠ¨éƒ¨åˆ†å‡½æ•°ä»£ç å¦‚ä¸‹ã€‚

if \_\_name\_\_ == "\_\_main\_\_":

    # æ—¥å¿—é…ç½®è·¯å¾„
    config\_path = resource\_path("app/uvicorn\_config.json")
    # è¿è¡Œ uvicorn
    try:
        config \= uvicorn.Config(
            app \= socket\_app,
            reload\=True,
            host\=settings.SERVER\_IP,
            log\_config \= config\_config,  # æ—¥å¿—é…ç½®
        )
        server \= uvicorn.Server(config)
        server.run()
    except Exception as e:
        raise e

ä¸Šé¢å°±æ˜¯æˆ‘å®é™…é¡¹ç›®ç®€åŒ–ç‰ˆæœ¬çš„main.pyå‡½æ•°çš„å¯åŠ¨å†…å®¹ï¼Œæ­£å¸¸å¼€å‘ç¯å¢ƒï¼Œæµ‹è¯•æ˜¯æ­£å¸¸çš„ã€‚ä½†æ˜¯é€šè¿‡pyinstallæ‰“åŒ…å®Œæˆï¼Œå¹¶è¿è¡Œfastapi\_app.exeçš„æ—¶å€™ï¼Œæç¤ºæ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶uvicorn\_config.jsonã€‚

FileNotFoundError: \[Errno 2\] No such file or directory: 'app/uvicorn\_config.json'

è¿™ä¸ªåŸå› æ˜¯æ‰“åŒ…åæ‰§è¡Œexeæ–‡ä»¶çš„å½“å‰è·¯å¾„æ”¹å˜äº†ï¼Œæ‰“åŒ…è¿›å»çš„ exe å¹¶æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚é¦–å…ˆï¼šä¿®æ”¹ `.spec` æ–‡ä»¶ï¼Œç¡®ä¿æ–‡ä»¶è¢«æ‰“åŒ…è¿›å»ï¼Œåœ¨ `datas` é‡ŒåŠ è¿™ä¸€è¡Œ ğŸ‘‡  
ï¼ˆå‡è®¾æ–‡ä»¶è·¯å¾„æ˜¯ `app/uvicorn_config.json`ï¼‰

datas = \[
    **(****"app/uvicorn\_config.json", "app"****),**
    ("app/templates/\*", "app/templates"),
    ("app/static/\*", "app/static"),
    ("app/images/\*", "app/images"),
\]

è¿™ä¸€æ­¥ç¡®ä¿ exe ä¸­ç¡®å®åŒ…å«äº†ä½ çš„ `uvicorn_config.json` æ–‡ä»¶ã€‚

å…¶æ¬¡ï¼šåœ¨ `main.py` ä¸­ä½¿ç”¨é€šç”¨çš„è·¯å¾„å‡½æ•°resource\_pathï¼š

def resource\_path(relative\_path: str) -> str:
    """
    è·å–èµ„æºæ–‡ä»¶çœŸå®è·¯å¾„ï¼Œæ”¯æŒï¼š
    - å¼€å‘æ¨¡å¼
    - PyInstaller onefile æ¨¡å¼
    - PyInstaller COLLECT (\_internal) æ¨¡å¼
    """

    if hasattr(sys, '\_MEIPASS'): # onefile æ¨¡å¼
        # exe è§£å‹ä¸´æ—¶ç›®å½•
        base\_path = sys.\_MEIPASS
    else:
        # åœ¨æ¾æ•£æ¨¡å¼ä¸‹ï¼Œ\_internal ç›®å½•æ‰æ˜¯çœŸæ­£çš„æ•°æ®å­˜æ”¾å¤„
        base\_path = os.path.dirname(sys.executable) # exe æ‰€åœ¨ç›®å½•
        internal\_path = os.path.join(base\_path, "\_internal")
        if os.path.exists(internal\_path):# æ¾æ•£æ‰“åŒ…ç›®å½•
            base\_path = internal\_path
        else:
            # ç›´æ¥å¼€å‘è¿è¡Œæ—¶
            base\_path = os.path.abspath(".")
    return os.path.join(base\_path, relative\_path)

ç„¶åä¿®æ”¹ä½ çš„ `uvicorn.Config` ä»£ç 

æ›¿æ¢ç¡¬ç¼–ç è·¯å¾„ä¸ºï¼š

import uvicorn

config\_path \= resource\_path("app/uvicorn\_config.json")

config \= uvicorn.Config(
    app\=socket\_app,
    host\=settings.SERVER\_IP,
    port\=settings.SERVER\_PORT,
    log\_config\=config\_path,  # âœ… åŠ¨æ€è·å–æ­£ç¡®è·¯å¾„
)

server \= uvicorn.Server(config)
server.run()

ä¸Šé¢å¯åŠ¨åï¼Œfastapi é…ç½®æ–‡ä»¶å®šä½åˆ°äº†ï¼Œä½†æ˜¯å¯èƒ½è¿˜ä¼šäº§ç”Ÿæ–°çš„é—®é¢˜

ä½ å¯èƒ½ä¼šå‘ç°Â app/uvicorn\_config.json é‡Œé¢é…ç½®çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„å’Œå®é™…ä¸å¯¹ã€‚

![image](https://img2024.cnblogs.com/blog/8867/202510/8867-20251011111940199-65656164.png)

FileNotFoundError: \[Errno 2\] No such file or directory: '.../app/logs/log.log'

Uvicorn åœ¨åŠ è½½ `uvicorn_config.json` æ—¶çš„æ—¥å¿—è·¯å¾„æ˜¯ **ç›¸å¯¹è¿›ç¨‹å·¥ä½œç›®å½•**ï¼Œ  
è€Œä¸æ˜¯ç›¸å¯¹ `uvicorn_config.json` æ–‡ä»¶æœ¬èº«çš„è·¯å¾„ â€”â€”  
è¿™æ­£æ˜¯ä¸ºä»€ä¹ˆä½ é…ç½® `"filename": "app/logs/log.log"` ä»ç„¶æŠ¥é”™çš„æ ¹æœ¬åŸå› ã€‚

**æˆ‘ä»¬éœ€è¦ï¼Œåœ¨è¿è¡Œå‰åŠ¨æ€ä¿®æ­£ log\_config.json å†…éƒ¨çš„è·¯å¾„**

æˆ‘ä»¬åœ¨åŠ è½½ JSON åï¼ŒåŠ¨æ€ä¿®æ”¹å…¶ä¸­ `"filename"` å­—æ®µçš„è·¯å¾„ä¸ºæ‰“åŒ…åæ­£ç¡®çš„ç»å¯¹è·¯å¾„ã€‚

ä¿®æ­£ä»£ç åå¦‚ä¸‹æ‰€ç¤ºã€‚

if \_\_name\_\_ == "\_\_main\_\_":

    # åŠ¨æ€è§£ææ—¥å¿—é…ç½®è·¯å¾„
    config\_path = resource\_path("app/uvicorn\_config.json")
    
    # åŠ è½½å¹¶ä¿®æ”¹æ—¥å¿—é…ç½®ï¼Œä¸»è¦å¯¹æ—¥å¿—æ–‡ä»¶è·¯å¾„è¿›è¡Œä¿®æ­£
    with open(config\_path, "r", encoding="utf-8") as f:
        log\_config \= json.load(f)

    # æ‰¾åˆ°å…¶ä¸­çš„ file handlerï¼Œæ”¹å†™ filename ä¸ºç»å¯¹è·¯å¾„
    for handler in log\_config.get("handlers", {}).values():
        if "filename" in handler:
            log\_file \= handler\["filename"\]
            **abs\_log\_path** **\=** **resource\_path(log\_file)**
            os.makedirs(os.path.dirname(abs\_log\_path), exist\_ok\=True)
            handler\["filename"\] = **abs\_log\_path **  # æ›¿æ¢ä¸ºç»å¯¹è·¯å¾„

    # è¿è¡Œ uvicornï¼ˆä¼ å…¥å·²ä¿®æ”¹çš„ log\_config dictï¼‰
    try:
        config \= uvicorn.Config(
            app \= socket\_app,
            reload\=True,
            host\=settings.SERVER\_IP,
            log\_config \= log\_config,  # æ—¥å¿—é…ç½®,ä¿®æ­£æ–¹å¼è§ä¸Š
        )

        server \= uvicorn.Server(config)
        server.run()
    except Exception as e:
        raise e

è‡³æ­¤ï¼Œæ‰€æœ‰é—®é¢˜éƒ½é¡ºåˆ©è§£å†³ï¼Œèƒ½å¤Ÿæ­£å¸¸è¿è¡Œèµ·æ¥äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹FastAPIé¡ºåˆ©å¯åŠ¨åçš„æ•ˆæœã€‚å¤åˆ¶æ¾æ•£æ–‡ä»¶å¤¹åˆ°æœåŠ¡å™¨ä¸ŠåŒå‡»è¿è¡Œå³å¯ï¼Œéœ€è¦ä¹Ÿå¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶.envå®ç°ç›¸å…³ä¿®æ”¹ã€‚

![image](https://img2024.cnblogs.com/blog/8867/202510/8867-20251011115335366-103340111.png)

âœ…Â å¦‚æœè¿è¡Œæ‰“åŒ…çš„exe æç¤ºMissing command.Â 

å…¶å®æ˜¯ `uvicorn` çš„æç¤ºï¼Œä¸æ˜¯ PyInstaller æœ¬èº«çš„æŠ¥é”™ã€‚å¯èƒ½æ˜¯ä½ çš„appè®¾ç½®ä¸Šçš„é—®é¢˜ï¼Œä½ åœ¨ `main.py` é‡Œå¯èƒ½ç”¨äº†è¿™ç§å¯åŠ¨æ–¹å¼ï¼š

uvicorn.run("app.main:app", host="0.0.0.0", port=8000)

è§£å†³æ–¹æ³• æ”¹æˆç›´æ¥ä¼ å…¥ app å¯¹è±¡ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²è·¯å¾„ï¼š

    # âœ… æ”¹æˆç›´æ¥ä¼  app å¯¹è±¡
    uvicorn.run(app, host="0.0.0.0", port=8000)

è¿™æ · `uvicorn` å°±ä¸ä¼šå»æ‰¾å­—ç¬¦ä¸²å½¢å¼çš„ `module:app`ï¼Œè€Œæ˜¯ç›´æ¥è¿è¡Œä½ ä¼ è¿›å»çš„ `FastAPI` å®ä¾‹ã€‚ æ‰“åŒ…åçš„ exe å°±èƒ½æ­£å¸¸è¿è¡Œã€‚

âœ… å¦‚æœæç¤ºNo module named 'aiomysql'

è¿™ä¸ªé—®é¢˜å…¶å®æ˜¯ **PyInstaller æ²¡æœ‰æŠŠ `aiomysql` æ‰“åŒ…è¿›å»**ï¼Œå› ä¸ºå®ƒæ˜¯åŠ¨æ€å¯¼å…¥çš„ï¼ŒPyInstaller é™æ€åˆ†æä¸åˆ°ã€‚

æ–¹æ³• Aï¼šå‘½ä»¤è¡Œæ·»åŠ  hidden-import

pyinstaller --onefile --name fastapi\_app --hidden-import aiomysql app/main.py

æ–¹æ³• Bï¼šåœ¨ `.spec` æ–‡ä»¶é‡ŒåŠ  `hiddenimports`

æ‰¾åˆ° `.spec` æ–‡ä»¶é‡Œçš„ `Analysis`ï¼Œæ”¹æˆï¼š

a = Analysis(
    \['app/main.py'\],
    pathex\=\[\],
    binaries\=\[\],
    datas\=datas,
    hiddenimports\=\[
        "uvicorn",
        "fastapi",
        "pydantic",
        "aiomysql"   # ğŸ‘ˆ åŠ ä¸Šè¿™é‡Œ
    \],
    hookspath\=\[\],
    runtime\_hooks\=\[\],
    excludes\=\[\],
    win\_no\_prefer\_redirects\=False,
    win\_private\_assemblies\=False,
    cipher\=block\_cipher,
    noarchive\=False,
)

FastAPI + æ•°æ®åº“å¸¸ç”¨ä¾èµ–å¾ˆå¤šï¼ˆå¦‚ `sqlalchemy[asyncio]`ã€`asyncpg`ã€`aiomysql` ç­‰ï¼‰ï¼Œæœ‰äº›ä¹Ÿå¯èƒ½è¢«æ¼æ‰ã€‚åšæ³•åŒæ ·ï¼š**æŠŠç¼ºå¤±çš„åº“åŠ åˆ° hidden-import**ã€‚

hiddenimports=\[
    "uvicorn",
    "fastapi",
    "pydantic",
    "aiomysql",
    "asyncpg",
    "sqlalchemy.ext.asyncio",
\]

`âœ… Dataå†…å®¹çš„å†™æ³•`

`("app/images/*", "app/images")`

ä¼šæŠŠ `app/images` ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ **æ”¾åˆ° exe è§£å‹åçš„ç›®å½•é‡Œ**ï¼Œè·¯å¾„æ˜¯ `app/images/...`

å¦‚æœä»£ç é‡Œæ˜¯è¿™æ ·å†™çš„ï¼š

open("app/images/logo.png", "rb")

å°±èƒ½æ‰¾åˆ°ï¼Œä¹Ÿå°±æ˜¯å§‹ç»ˆä¿æŒç›¸å¯¹ç›®å½•çš„æ­£ç¡®æ€§ã€‚

![](http://www.cnblogs.com/Images/OutliningIndicators/None.gif) ä¸“æ³¨äºä»£ç ç”Ÿæˆå·¥å…·ã€.Net/Python æ¡†æ¶æ¶æ„åŠè½¯ä»¶å¼€å‘ï¼Œä»¥åŠå„ç§Vue.jsçš„å‰ç«¯æŠ€æœ¯åº”ç”¨ã€‚è‘—æœ‰Winformå¼€å‘æ¡†æ¶/æ··åˆå¼å¼€å‘æ¡†æ¶ã€å¾®ä¿¡å¼€å‘æ¡†æ¶ã€Bootstrapå¼€å‘æ¡†æ¶ã€ABPå¼€å‘æ¡†æ¶ã€SqlSugarå¼€å‘æ¡†æ¶ã€Pythonå¼€å‘æ¡†æ¶ç­‰æ¡†æ¶äº§å“ã€‚  
Â Â è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼šæ’°å†™äººï¼šä¼åèªÂ Â [http://www.iqidi.com](http://www.iqidi.com/)Â Â Â Â Â 

posted on 2025-10-11 11:56Â  [ä¼åèª](https://www.cnblogs.com/wuhuacong)Â  é˜…è¯»(219)Â  è¯„è®º(0)Â  Â  [æ”¶è—](javascript:void\(0\))Â  [ä¸¾æŠ¥](javascript:void\(0\))