---
layout: post
title: 'Spring Bootæ•´åˆSentinelä¹‹QPSé™æµ'
date: "2025-12-28T00:52:01Z"
---
Spring Bootæ•´åˆSentinelä¹‹QPSé™æµ
===========================

ä»‹ç»Spring Boot 4 å¦‚ä½•é›†æˆæµé‡æ²»ç†ç¥å™¨Sentinelå®ç°QPSé™æµã€‚

**æ‘˜è¦** ä»‹ç»Spring Boot 4 å¦‚ä½•é›†æˆæµé‡æ²»ç†ç¥å™¨Sentinelå®ç°QPSé™æµã€‚

ç›®å½•

*   [Sentinelç®€ä»‹](#sentinelç®€ä»‹)
*   [å¯åŠ¨ Sentinel æ§åˆ¶å°](#å¯åŠ¨-sentinel-æ§åˆ¶å°)
    *   [ä¸‹è½½sentinel](#ä¸‹è½½sentinel)
    *   [è®¿é—® Sentinel æ§åˆ¶å°](#è®¿é—®-sentinel-æ§åˆ¶å°)
*   [æ³¨è§£@SentinelResourceä½¿ç”¨æ–¹æ³•](#æ³¨è§£sentinelresourceä½¿ç”¨æ–¹æ³•)
*   [ç”¨@SentinelResourceé™æµ](#ç”¨sentinelresourceé™æµ)
*   [ç»Ÿä¸€å¤„ç†Sentinelå¼‚å¸¸|done](#ç»Ÿä¸€å¤„ç†sentinelå¼‚å¸¸done)
*   [ç»“æŸè¯­](#ç»“æŸè¯­)
*   [Reference](#reference)

### Sentinelç®€ä»‹

â€ƒâ€ƒä»€ä¹ˆæ˜¯Sentinelï¼Ÿéšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel æ˜¯é¢å‘åˆ†å¸ƒå¼ã€å¤šè¯­è¨€å¼‚æ„åŒ–æœåŠ¡æ¶æ„çš„æµé‡æ²»ç†ç»„ä»¶ï¼Œä¸»è¦ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡è·¯ç”±/è°ƒåº¦ã€æµé‡æ§åˆ¶ã€æµé‡æ•´å½¢ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè‡ªé€‚åº”è¿‡è½½ä¿æŠ¤/å®ä¾‹æ‘˜é™¤ã€çƒ­ç‚¹æµé‡é˜²æŠ¤ç­‰å¤šä¸ªç»´åº¦æ¥å¸®åŠ©å¼€å‘è€…ä¿éšœå¾®æœåŠ¡çš„ç¨³å®šæ€§ã€‚

â€ƒâ€ƒåŒä¸€ä¸ªèµ„æºå¯ä»¥åˆ›å»ºå¤šæ¡é™æµè§„åˆ™ã€‚Sentinelåº•å±‚ä¸­çš„ FlowSlot ä¼šå¯¹è¯¥èµ„æºçš„æ‰€æœ‰é™æµè§„åˆ™ä¾æ¬¡éå†ï¼Œç›´åˆ°æœ‰è§„åˆ™è§¦å‘é™æµæˆ–è€…æ‰€æœ‰è§„åˆ™éå†å®Œæ¯•ã€‚

â€ƒâ€ƒåœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šç›´æ¥å†™ç±»ä¼¼ã€ŠSpring Bootæ•´åˆSentinelä¹‹æµé‡æ§åˆ¶å…¥é—¨ã€‹ä¸­é‚£æ®µé™æµå…¥é—¨æ¼”ç¤ºä»£ç ï¼Œé€šå¸¸éœ€è¦å°†Sentinelé›†æˆåˆ°åº”ç”¨æ¡†æ¶ä¸­ã€‚æœ¬æ–‡ä»¥ã€Š[ä¸€æ­¥æ­¥æ­å»ºJDK 21 Spring Booté¡¹ç›®](https://www.cnblogs.com/east7/p/19309056)ã€‹æ­å»ºçš„Spring Booté¡¹ç›®ä¸ºåŸºç¡€ï¼Œå±•ç¤ºå¦‚ä½•å°†Sentinelé›†æˆåˆ°Spring Booté¡¹ç›®ä¸­ï¼Œå¹¶åŸºäºæ³¨è§£ **@SentinelResource** è¿›è¡Œé™æµã€‚demoä¸­åªä»‹ç»äº†qpsé™æµç­–ç•¥ï¼Œå®ƒæœ‰å¤šç§ç­–ç•¥å¤‡é€‰ï¼Œè¯·æ ¹æ®ä¸šåŠ¡éœ€è¦è‡ªè¡Œé€‰å®šã€‚

### å¯åŠ¨ Sentinel æ§åˆ¶å°

â€ƒâ€ƒSentinel çš„ä½¿ç”¨å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š

*   æ§åˆ¶å°ï¼ˆDashboardï¼‰ï¼šæ§åˆ¶å°ä¸»è¦è´Ÿè´£ç®¡ç†è§„åˆ™æ¨é€ã€ç›‘æ§ã€é›†ç¾¤é™æµã€åˆ†é…ç®¡ç†ã€æœºå™¨å‘ç°ç­‰ã€‚
    
*   æ ¸å¿ƒåº“ï¼ˆJava å®¢æˆ·ç«¯ï¼‰ï¼šä¸ä¾èµ–ä»»ä½•æ¡†æ¶/åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäº Java 7 åŠä»¥ä¸Šç‰ˆæœ¬çš„è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒã€‚
    

#### ä¸‹è½½sentinel

â€ƒâ€ƒä»[sentinelæ§åˆ¶å°ä¼ é€é—¨](https://github.com/alibaba/Sentinel/releases)ä¸‹è½½éœ€è¦çš„sentinel jarã€‚

![image](https://img2024.cnblogs.com/blog/1208468/202512/1208468-20251227204633642-1887509880.png)

â€ƒâ€ƒæˆ‘ä¸‹è½½äº†å½“å‰æœ€æ–°ç‰ˆ**v1.8.9**ã€‚ä¸‹è½½ååœ¨Mac ç»ˆç«¯è¿›å…¥jaråŒ…å­˜æ”¾ç›®å½•åï¼Œæ‰§è¡Œå‘½ä»¤ `java -Dserver.port=8080 -jar sentinel-dashboard-1.8.9.jar` å³å¯å¯åŠ¨æ§åˆ¶å°ã€‚é»˜è®¤ç«¯å£æ˜¯8080ï¼Œä¸ºäº†é¿å…ç«¯å£å¥½å†²çªï¼Œå¯ä»¥è®¾ç½®ä¸ºè¯¸å¦‚9000ç­‰ã€‚

![image](https://img2024.cnblogs.com/blog/1208468/202512/1208468-20251227204655238-251711394.png)

#### è®¿é—® Sentinel æ§åˆ¶å°

â€ƒâ€ƒ åœ¨æµè§ˆå™¨è®¿é—®sentinelæ§åˆ¶å°åœ°å€`http://localhost:8080`æˆ–è€…`http://127.0.0.1:8080/`å³å¯è¿›å…¥å¦‚ä¸‹ç™»å½•é¡µé¢ï¼Œé»˜è®¤è´¦å·å¯†ç éƒ½æ˜¯ **sentinel**ã€‚æ­å–œä½ ï¼æ­¤æ—¶æ­¤åˆ»sentinelä¸‹è½½è¿è¡ŒæˆåŠŸã€‚

![image](https://img2024.cnblogs.com/blog/1208468/202512/1208468-20251227204748437-1017331740.png)

â€ƒâ€ƒSentinel å¼€æºæ§åˆ¶å°æ”¯æŒå®æ—¶ç›‘æ§å’Œè§„åˆ™ç®¡ç†ã€‚æ¥å…¥æ§åˆ¶å°çš„æ­¥éª¤å¦‚ä¸‹ï¼š

    spring.cloud.sentinel.transport.dashboard=localhost:8080
    spring.cloud.sentinel.transport.heartbeat-interval-ms=500
    spring.cloud.sentinel.eager=true
    

â€ƒâ€ƒé…ç½® `heartbeat-interval-ms` ç”¨äºæŒ‡å®šåº”ç”¨ä¸ Sentinel æ§åˆ¶å°ä¹‹é—´çš„å¿ƒè·³ä¸ŠæŠ¥é—´éš”ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚é…ç½®ä¸º 500 è¡¨ç¤º  
ğŸ‘‰ åº”ç”¨æ¯ 500msï¼ˆ0.5 ç§’ï¼‰ å‘ Sentinel Dashboard å‘é€ä¸€æ¬¡å¿ƒè·³ï¼Œç”¨äºä¸ŠæŠ¥å®ä¾‹å­˜æ´»çŠ¶æ€å’ŒåŸºç¡€è¿è¡Œä¿¡æ¯ã€‚  
åº”ç”¨å¯åŠ¨æ—¶ ç«‹å³åˆå§‹åŒ– Sentinel æ ¸å¿ƒç»„ä»¶å¹¶å‘æ§åˆ¶å°å‘èµ·è¿æ¥ï¼Œè€Œä¸æ˜¯ç­‰åˆ°ç¬¬ä¸€æ¬¡æµé‡è¿›å…¥æ—¶å†åˆå§‹åŒ–ã€‚

â€ƒâ€ƒé…ç½® `spring.cloud.sentinel.eager=true`è¡¨ç¤ºåº”ç”¨å¯åŠ¨æ—¶ ç«‹å³åˆå§‹åŒ– Sentinel æ ¸å¿ƒç»„ä»¶å¹¶å‘æ§åˆ¶å°å‘èµ·è¿æ¥ï¼Œè€Œä¸æ˜¯ç­‰åˆ°æµé‡ç¬¬ä¸€æ¬¡è¿›å…¥æ—¶å†åˆå§‹åŒ–ã€‚ä¸¤è€…ç»„åˆä½¿ç”¨çš„æ•´ä½“ä¸šåŠ¡å«ä¹‰ï¼š

âœ… Sentinel åœ¨åº”ç”¨å¯åŠ¨é˜¶æ®µå³å®Œæˆåˆå§‹åŒ–ï¼ŒæœåŠ¡ä¸€ä¸Šçº¿å°±å—åˆ°é™æµä¸ç†”æ–­ä¿æŠ¤ï¼›  
âœ… åº”ç”¨ä¸æ§åˆ¶å°ä¹‹é—´ä¿æŒé«˜é¢‘å¿ƒè·³ï¼ŒåŒæ­¥å®ä¾‹çŠ¶æ€æ›´åŠæ—¶ï¼›  
âœ… æ›´æœ‰åˆ©äºç¨³å®šæ€§ç›‘æ§ã€è§„åˆ™æ¨é€å’Œå¿«é€Ÿé—®é¢˜é¢„è­¦ï¼›

### æ³¨è§£@SentinelResourceä½¿ç”¨æ–¹æ³•

â€ƒâ€ƒç®€å•ä»‹ç»ä¸‹æ³¨è§£@SentinelResourceä¸­å„ä¸ªå±æ€§ï¼š

*   value - æŒ‡å®šèµ„æºçš„åç§°
*   blockHandler - æœåŠ¡é™æµåä¼šæŠ›å‡ºBlockExceptionå¼‚å¸¸ï¼Œæ­¤å±æ€§ç”¨æ¥æŒ‡å®šä¸€ä¸ªå‡½æ•°(æ–¹æ³•)æ¥å¤„ç†BlockExceptionå¼‚å¸¸çš„ã€‚
    *   æ³¨æ„: è¿™ä¸ªæ–¹æ³•å¿…é¡»æ˜¯publicçš„,ä¸”è¿”å›ç±»å‹éœ€è¦ä¸åŸæ–¹æ³•ç›¸åŒ¹é…ï¼Œå‚æ•°ç±»å‹é»˜è®¤ä¸åŸæ–¹æ³•ä¸€è‡´ï¼Œä¸”æœ€ååŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œç±»å‹ä¸ºBlockException
*   blockHandlerClass - è‹¥å±æ€§blockHandleræŒ‡å®šçš„å‡½æ•°ä¸åŸæ–¹æ³•ä¸åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œåˆ™éœ€è¦ä½¿ç”¨è¯¥å±æ€§æŒ‡å®šæ‰€åœ¨çš„ç±»
    *   æ³¨æ„:å¿…é¡»é…åˆblockHandlerå±æ€§ä¸€èµ·ä½¿ç”¨,ä¸”blockHandlerå±æ€§æŒ‡å®šçš„æ–¹æ³•å¿…é¡»ä¸ºstaticé™æ€å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æ
*   fallback - ç”¨äºæŠ›å‡ºå¼‚å¸¸æ—¶,æ‰§è¡Œå¤„ç†é€»è¾‘ï¼Œå¯ä»¥é’ˆå¯¹æ‰€æœ‰ç±»å‹çš„å¼‚å¸¸è¿›è¡Œå¤„ç†
    *   æ³¨æ„:Sentinel 1.6.0 ä¹‹å‰ï¼Œfallbackå‡½æ•°åªé’ˆå¯¹é™çº§å¼‚å¸¸(DegradeException)è¿›è¡Œå¤„ç†ï¼Œä¸èƒ½å¤„ç†ä¸šåŠ¡å¼‚å¸¸
    *   è¿”å›å€¼ç±»å‹å¿…é¡»ä¸åŸå‡½æ•°ä¸€è‡´,ä¸”æ–¹æ³•å‚æ•°ä¹Ÿè¦ä¸åŸå‡½æ•°ä¸€è‡´,å¯ä»¥åœ¨æœ€ååŠ ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œç±»å‹ä¸ºThrowableç±»å‹
*   fallbackClass - è‹¥å±æ€§fallbackæŒ‡å®šçš„å‡½æ•°ä¸åŸæ–¹æ³•ä¸åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œåˆ™éœ€è¦ä½¿ç”¨è¯¥å±æ€§æŒ‡å®šæ‰€åœ¨çš„ç±»
    *   æ³¨æ„:å¿…é¡»é…åˆfallbackå±æ€§ä¸€èµ·ä½¿ç”¨ï¼Œä¸”fallbackå±æ€§æŒ‡å®šçš„æ–¹æ³•å¿…é¡»ä¸ºstaticé™æ€å‡½æ•°ï¼Œå¦åˆ™æ— æ³•è§£æ
*   defaultFallback - é»˜è®¤çš„fallbackå‡½æ•°åç§°ï¼Œç”¨äºé€šç”¨çš„fallbacké€»è¾‘
*   exceptionsToIgnore - ç”¨äºæŒ‡å®šå“ªäº›å¼‚å¸¸è¢«æ’é™¤æ‰ï¼Œä¸ä¼šè®¡å…¥å¼‚å¸¸ç»Ÿè®¡ä¸­ï¼Œä¹Ÿä¸ä¼šè¿›å…¥fallbacké€»è¾‘ä¸­ï¼Œè€Œæ˜¯ä¼šåŸæ ·æŠ›å‡º

### ç”¨@SentinelResourceé™æµ

â€ƒâ€ƒpomé…ç½®å¦‚ä¸‹ï¼š

    <?xml version="1.0" encoding="UTF-8"?>
    <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
        <modelVersion>4.0.0</modelVersion>
        <parent>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-parent</artifactId>
            <version>4.0.0</version>
            <relativePath/> 
        </parent>
        <groupId>com.cactus</groupId>
        <artifactId>wiener</artifactId>
        <version>0.0.1-SNAPSHOT</version>
        <name>wiener</name>
        <description>wiener</description>
        <properties>
            <java.version>21</java.version>
            <sentinel.version>1.8.9</sentinel.version>
        </properties>
        <dependencies>
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-web</artifactId>
            </dependency>
            <dependency>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
                <version>1.18.42</version>
            </dependency>
            <!-- Sentinelæ ¸å¿ƒæœåŠ¡ -->
            <dependency>
                <groupId>com.alibaba.csp</groupId>
                <artifactId>sentinel-core</artifactId>
                <version>${sentinel.version}</version>
            </dependency>
    
            <!-- Sentinelæœ¬åœ°åº”ç”¨æ¥å…¥æ§åˆ¶å°ï¼Œç‰ˆæœ¬éœ€è¦ä¸æ§åˆ¶å°ä¿æŒä¸€è‡´ -->
            <dependency>
                <groupId>com.alibaba.csp</groupId>
                <artifactId>sentinel-transport-simple-http</artifactId>
                <version>${sentinel.version}</version>
            </dependency>
    
            <!-- Sentinelæä¾›æ³¨è§£æ— ä¾µå…¥å®šä¹‰èµ„æº https://mvnrepository.com/artifact/com.alibaba.csp/sentinel-annotation-aspectj -->
            <dependency>
                <groupId>com.alibaba.csp</groupId>
                <artifactId>sentinel-annotation-aspectj</artifactId>
                <version>${sentinel.version}</version>
            </dependency>
        </dependencies>
        <!-- å¦‚æœå¸Œæœ›åœ¨é¡¹ç›®çº§åˆ«ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒï¼Œå°±æ·»åŠ alimaven -->
        <repositories>
            <repository>
                <id>alimaven</id>
                <name>aliyun maven</name>
                <url>https://maven.aliyun.com/repository/central</url>
            </repository>
        </repositories>
    </project>
    

â€ƒâ€ƒå…ˆå®šä¹‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹`getFlow1`ï¼ŒéªŒè¯æ³¨è§£ `@SentinelResource`é™æµæ˜¯å¦ç”Ÿæ•ˆï¼š

    @RestController
    @RequestMapping("/sentinel")
    public class SentinelTestController {
        /**
         * åªæ·»åŠ blockHandlerå±æ€§ æŒ‡å®šgetFlowBlockHandleræ–¹æ³•å¤„ç†å¼‚å¸¸
         */
        @GetMapping(value = "getFlow1")
        @SentinelResource(value = SentinelRuleConfig.RESOURCE_QPS_LIMIT, blockHandler = "getFlowBlockHandler")
        public String getFlow1() {
            // è¿”å›å€¼
            return "æµé‡æ­£å¸¸";
        }
        /**
         * getFlow1 å¤„ç†å¼‚å¸¸é€»è¾‘
         */
        public String getFlowBlockHandler(BlockException ex) {
            log.info("è§¦å‘é™æµ");
            if (ex instanceof FlowException) {
                return "getFlow1é™æµ-æµæ§";
            } else if (ex instanceof DegradeException) {
                return "getFlow1é™æµ-é™çº§";
            }
            return "getFlow1é™æµ";
        }
    }
    

â€ƒâ€ƒå…¶ä¸­ï¼Œ`@SentinelResource(value = SentinelRuleConfig.RESOURCE_QPS_LIMIT, blockHandler = "getFlowBlockHandler")`è¡¨ç¤ºå¯¹å‡½æ•° getFlow1 è¿›è¡Œé™æµç›‘æ§ï¼Œèµ„æºåæ˜¯my\_resourceã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™ä»£ç æˆ–ä½¿ç”¨ Sentinel æ§åˆ¶å°æ¥**è®¾ç½®è§„åˆ™**ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå®šä¹‰é™æµQPS=3çš„Javaä»£ç ç‰‡æ®µï¼š

    import com.alibaba.csp.sentinel.slots.block.RuleConstant;
    import com.alibaba.csp.sentinel.slots.block.flow.FlowRule;
    import com.alibaba.csp.sentinel.slots.block.flow.FlowRuleManager;
    import java.util.ArrayList;
    import java.util.List;
    /**
     * @Author Wiener
     * @Date 2025-12-11
     * @Description: è®¾ç½®é™æµè§„åˆ™
     */
    public class FlowRules {
        /**
         * å…¥é—¨ç‰ˆé™æµè§„åˆ™
         * @param resourceName
         */
        public static void initFlowRules(String resourceName) {
            List<FlowRule> rules = new ArrayList<>();
            FlowRule rule = new FlowRule();
            rule.setResource(resourceName);
            rule.setGrade(RuleConstant.FLOW_GRADE_QPS);
            rule.setCount(3); // è®¾ç½® QPS ä¸º 3
            rules.add(rule);
            FlowRuleManager.loadRules(rules);
        }
    }
    

â€ƒâ€ƒå…¶ä¸­ï¼Œresourceè¡¨ç¤ºèµ„æºåï¼Œgradeè¡¨ç¤ºé™çº§ç­–ç•¥ã€‚

    import com.alibaba.csp.sentinel.annotation.aspectj.SentinelResourceAspect;
    import org.springframework.beans.factory.InitializingBean;
    import org.springframework.context.annotation.Bean;
    import org.springframework.context.annotation.Configuration;
    
    /**
     * @Author Wiener
     * @Description: åŠ è½½å…¨å±€é™æµé…ç½®ç±»
     */
    @Configuration
    public class SentinelRuleConfig implements InitializingBean {
        public final static String RESOURCE_QPS_LIMIT = "my_resource";
        @Bean
        public SentinelResourceAspect sentinelResourceAspect(){
            return new SentinelResourceAspect();
        }
        @Override
        public void afterPropertiesSet() {
            FlowRules.initFlowRules(RESOURCE_QPS_LIMIT);
        }
    }
    

â€ƒâ€ƒç±»SentinelResourceAspectæ˜¯è®© @SentinelResource ä»â€œæ³¨è§£è£…é¥°å“â€å˜æˆâ€œçœŸæ­£é™æµç†”æ–­å…¥å£â€çš„å…³é”®å¼•æ“ã€‚å¦‚æœæ²¡æœ‰å®ƒï¼Œ@SentinelResource åªæ˜¯ä¸ªæ™®é€šæ³¨è§£ï¼Œä¸ä¼šåšä»»ä½•é™æµã€ç†”æ–­æˆ–è€…é™çº§å¤„ç†ï¼Œä½¿å¾—Sentinel åªæ˜¯â€œåº“â€ï¼›å¦‚æœæœ‰äº†å®ƒï¼ŒSentinel æ‰æ˜¯æµé‡â€œæ²»ç†å·¥å…·â€ã€‚

â€ƒâ€ƒæ£€æŸ¥æ•ˆæœã€‚åœ¨ Spring Boot åº”ç”¨å¯åŠ¨ä¹‹å‰ï¼Œä»ä¸‹å›¾ä¸­ **Modify options** æ‰¾åˆ° **Add VM options**è®¾ç½®JVM å¯åŠ¨å‚æ•°ï¼š

![image](https://img2024.cnblogs.com/blog/1208468/202512/1208468-20251227204830587-941087640.png)

    -Dcsp.sentinel.dashboard.server=127.0.0.1:8080 -Dproject.name=wiener
    

â€ƒâ€ƒæœ¬ç¤ºä¾‹æ˜¯ç”¨äºç»™æœåŠ¡æ‰“å¼€é™æµå’Œç›‘æ§èƒ½åŠ›çš„å¯åŠ¨é…ç½®ã€‚å®ƒé€šè¿‡ JVM å¯åŠ¨å‚æ•°ä¸º Spring Boot æœ¬åœ°æœåŠ¡æ³¨å…¥ Sentinel é…ç½®ï¼Œ`-Dcsp.sentinel.dashboard.server` æŒ‡å®šæ§åˆ¶å°åœ°å€ï¼ˆ127.0.0.1:8080ï¼‰ï¼Œ`-Dproject.name` äºå®šä¹‰å½“å‰ Spring Boot åº”ç”¨åœ¨ Sentinel ä¸­çš„å”¯ä¸€æ ‡è¯†åç§°ï¼ˆæŒ‡å®šåº”ç”¨åä¸º wienerï¼‰ã€‚æ§åˆ¶å°é€šè¿‡è¯¥åç§°åŒºåˆ†ä¸åŒæœåŠ¡å®ä¾‹ï¼Œå¹¶æŒ‰åº”ç”¨ç»´åº¦è¿›è¡ŒæŒ‡æ ‡ç»Ÿè®¡å’Œæµæ§è§„åˆ™ç®¡ç†ã€‚é€šè¿‡ä¸Šè¿° JVM å¯åŠ¨å‚æ•°ï¼ŒSpring Boot åº”ç”¨å³å¯å®Œæˆä¸ Sentinel æ§åˆ¶å°çš„é›†æˆï¼Œå®ç°æœåŠ¡è¿è¡ŒçŠ¶æ€å¯è§†åŒ–å’Œæµé‡æ²»ç†èƒ½åŠ›ã€‚

â€ƒâ€ƒåœ¨æœåŠ¡å¯åŠ¨åï¼Œå¤šæ¬¡è®¿é—®æ¥å£ /getFlow1 åå¯ä»¥çœ‹åˆ°ä¸‹å›¾æ‰€ç¤ºç›‘æ§æ•°æ®ï¼š

![image](https://img2024.cnblogs.com/blog/1208468/202512/1208468-20251227204845513-520055544.png)

ä»æµæ§è§„åˆ™é¡µé¢å¯ä»¥æŸ¥åˆ°æœåŠ¡ç«¯é€šè¿‡ä»£ç é…ç½®çš„é™æµé˜ˆå€¼ï¼š

![image](https://img2024.cnblogs.com/blog/1208468/202512/1208468-20251227204857710-526351230.png)

â€ƒâ€ƒæˆ‘æŠŠQPSé˜ˆå€¼æ”¹ä¸º1å†åˆ·æ–°Apiï¼Œé™æµæ•ˆæœå¦‚ä¸‹ï¼š

![image](https://img2024.cnblogs.com/blog/1208468/202512/1208468-20251227204908389-1499915667.png)

å›¾ä¸­ã€é€šè¿‡QPSã€‘ä¸º1ï¼Œè¯´æ˜æ§åˆ¶å°é…ç½®çš„é™æµè§„åˆ™å·²ç»ä¸‹å‘åˆ°æœåŠ¡ç«¯ã€‚è‡³æ­¤ï¼Œå·²ç»å®ŒæˆSpring Bootæ•´åˆSentinel æ³¨è§£@SentinelResourceè¿›è¡Œé™æµå¹¶ä»æ§åˆ¶å°æŸ¥çœ‹é™æµæ•ˆæœã€‚

### ç»Ÿä¸€å¤„ç†Sentinelå¼‚å¸¸|done

â€ƒâ€ƒSentinel æ”¯æŒä»¥ä¸‹å‡ ç§è§„åˆ™ï¼šæµé‡æ§åˆ¶è§„åˆ™ã€ç†”æ–­é™çº§è§„åˆ™ã€ç³»ç»Ÿä¿æŠ¤è§„åˆ™ã€æ¥æºè®¿é—®æ§åˆ¶è§„åˆ™å’Œçƒ­ç‚¹å‚æ•°è§„åˆ™ã€‚å…¶æ‰€æœ‰è§„åˆ™éƒ½å¯ä»¥åœ¨å†…å­˜æ€ä¸­åŠ¨æ€åœ°æŸ¥è¯¢åŠä¿®æ”¹ï¼Œä¿®æ”¹ä¹‹åç«‹å³ç”Ÿæ•ˆã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè§¦å‘ä¸Šè¿°è§„åˆ™æ—¶ï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸åˆ°è°ƒç”¨æ–¹ã€‚å¦‚æœè¦è‡ªå®šä¹‰å¼‚å¸¸çš„è¿”å›ç»“æœï¼Œéœ€è¦å®ç°BlockExceptionHandleræ¥å£ï¼š

    public interface BlockExceptionHandler {
        /**
         * å¤„ç†è¯·æ±‚è¢«é™æµã€é™çº§ã€æˆæƒæ‹¦æˆªæ—¶æŠ›å‡ºçš„å¼‚å¸¸ï¼šBlockException
         */
        void handle(HttpServletRequest request, HttpServletResponse response, BlockException e) throws Exception;
    }
    

â€ƒâ€ƒBlockExceptionåŒ…å«å¾ˆå¤šä¸ªå­ç±»ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„é™æµåœºæ™¯ï¼š

å¼‚å¸¸

è¯´æ˜

FlowException

é™æµå¼‚å¸¸

ParamFlowException

çƒ­ç‚¹å‚æ•°é™æµçš„å¼‚å¸¸

DegradeExceptionn

ç†”æ–­é™çº§å¼‚å¸¸

AuthorityExceptionn

æˆæƒè§„åˆ™å¼‚å¸¸

SystemBlockException

ç³»ç»Ÿä¿æŠ¤è§„åˆ™å¼‚å¸¸

â€ƒâ€ƒæ³¨æ„ï¼Œå®ç°BlockExceptionHandleræ¥å£çš„ç±»å¿…é¡»ç”¨@Componentæ³¨è§£æ³¨å…¥åˆ°Spring Bootä¸­ã€‚ç»Ÿä¸€å¤„ç†Sentinelå¼‚å¸¸çš„ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

    @Component
    public class SentinelExceptionHandler implements BlockExceptionHandler {
        @Override
        public void handle(HttpServletRequest request, HttpServletResponse response, BlockException e) throws Exception {
            String msg = "æœªçŸ¥å¼‚å¸¸";
            int status = 429;// è¯·æ±‚è¿‡å¤š
            //å¼‚å¸¸å¤„ç†é€»è¾‘ï¼šæ ¹æ®eå¼‚å¸¸çš„ç±»å‹åˆ¤æ–­æ˜¯è§¦å‘äº†é™æµè¿˜æ˜¯é™çº§ç­‰ï¼Œè¿›ä¸€æ­¥åšå‡ºä¸åŒçš„å¤„ç†é€»è¾‘
    
            if (e instanceof FlowException) {
                msg = "è¯·æ±‚è¢«é™æµ";
            } else if (e instanceof ParamFlowException) {
                msg = "è¯·æ±‚è¢«çƒ­ç‚¹å‚æ•°é™æµ";
            } else if (e instanceof DegradeException) {
                msg = "è¯·æ±‚è¢«ç†”æ–­é™çº§";
            } else if (e instanceof AuthorityException) {
                msg = "æ²¡æœ‰è®¿é—®æƒé™";
                status = 401;
            }
    
            response.setContentType("application/json;charset=utf-8");
            response.setStatus(status);
            response.getWriter().write(msg);
            response.getWriter().println("{\"msg\":\""+msg+"\", \"status\":" + status + "}");
        }
    }
    

### ç»“æŸè¯­

â€ƒâ€ƒä»¥ä¸Šå°±æ˜¯è¿™ç¯‡æ–‡ç« çš„å…¨éƒ¨å†…å®¹äº†ï¼Œå¸Œæœ›æœ¬æ–‡å¯¹é“å‹çš„å­¦ä¹ æˆ–è€…å·¥ä½œèƒ½å¸¦æ¥ä¸€å®šçš„å¸®åŠ©ï¼Œå¦‚æœ‰ç–‘é—®è¯·ç•™è¨€äº¤æµã€‚[Wiener](https://www.cnblogs.com/east7/)åœ¨æ­¤ç¥å„ä½ç”Ÿæ´»æ„‰å¿«ï¼å·¥ä½œé¡ºåˆ©ï¼

### Reference

*   [https://github.com/alibaba/Sentinel/wiki/How-to-Use](https://github.com/alibaba/Sentinel/wiki/How-to-Use)
*   [https://sentinelguard.io/zh-cn/docs/introduction.html](https://sentinelguard.io/zh-cn/docs/introduction.html)

.tipTitle { width:210px; text-align: left; font-size: 25px; } .wechat { width: 180px; height: 180px; } .zsdiv { display: flex } .aTip { font-size: 18px; font-family:"æ¥·ä½“","æ¥·ä½“\_GB2312"; } .tipRight { padding: 1px 0px 0px 0px } .tipwechat { width: 32px; height: 32px; border: medium none; box-shadow: none; margin-left: 5px; vertical-align: middle; }

* * *

â€ƒâ€ƒè¯»åæœ‰æ”¶è·ï¼Œå°ç¤¼ç‰©èµ°ä¸€èµ°ï¼Œè¯·ä½œè€…å–å’–å•¡ã€‚

â€ƒâ€ƒ![](https://common.cnblogs.com/images/wechat.png)Buy me a coffee. â˜•Get red packets.

![](https://files.cnblogs.com/files/east7/tip7.ico) ![](https://blog-static.cnblogs.com/files/east7/11.ico)

ä½œè€…ï¼š[æ¥¼å…°èƒ¡æ¨](https://www.cnblogs.com/east7/)

é“¾æ¥ï¼š[https://www.cnblogs.com/east7/p/19409978](https://www.cnblogs.com/east7/p/19409978)

æœ¬æ–‡ç‰ˆæƒå½’ä½œè€…å’Œåšå®¢å›­å…±æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼Œå¹¶ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œå¦åˆ™ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©ã€‚