---
layout: post
title: 'å¦‚ä½•æ¸…ç†è¯¯æäº¤åˆ°gitçš„å†å²å¤§æ–‡ä»¶ï¼Ÿ'
date: "2025-05-13T00:41:33Z"
---
å¦‚ä½•æ¸…ç†è¯¯æäº¤åˆ°gitçš„å†å²å¤§æ–‡ä»¶ï¼Ÿ
==================

å‰è¨€
--

å“ˆå–½ï¼å¥½ä¹…ä¸è§~

æœ€è¿‘åœ¨æ€è€ƒè½¬å‹çš„äº‹æƒ…ï¼Œå¥½ä¹…æ²¡æœ‰æ›´æ–°æ–‡ç« äº†

ä¸è¿‡çœ‹åˆ°æˆ‘ä¹‹å‰å¼€å‘çš„è§†é¢‘å‰ªè¾‘å·¥å…· [Clipify](https://blog.deali.cn/Blog/Post/6a903b1c6fb2487f) æ”¶è·äº†ä¸å°‘ star ï¼Œè®©æˆ‘æƒ³èµ·ä¹‹å‰ç”»çš„é¥¼ä¼¼ä¹æ‰å®ç°äº†ä¸€ç‚¹ç‚¹ï¼Œæ‰€ä»¥åˆ©ç”¨äº†å‘¨æœ«çš„ç©ºé—²æ—¶é—´ç»™ Clipify é¡¹ç›®é‡æ„äº†ä¸€ä¸‹ç•Œé¢ä»¥åŠå¼€å‘ä¸€äº›æ–°åŠŸèƒ½ã€‚

ä¸­é€”æ„è¯†åˆ°ç°åœ¨ä½¿ç”¨çš„ WinForms + Blazor æŠ€æœ¯æ ˆï¼Œå°±åƒé©¬æ‹‰ç«è½¦ï¼Œæœ‰ç§è’¸æ±½æœ‹å…‹çš„å¤å¤æ„Ÿï¼Œè™½ç„¶ä½¿ç”¨å‰ç«¯æŠ€æœ¯å¼€å‘çš„ç•Œé¢å¾ˆå¥½çœ‹ï¼Œä½† WinForms ä¸èƒ½è·¨å¹³å°ç»ˆç©¶ä¸æ˜¯é•¿ä¹…ä¹‹è®¡ã€‚

äºæ˜¯æˆ‘ä¾¿ç€æ‰‹å°è¯•è¿ç§»åˆ° MAUIï¼Œè™½ç„¶è¿˜ä¸èƒ½æ”¯æŒ Linuxï¼Œè‡³å°‘ Mac è¿˜æ˜¯å¯ä»¥çš„ï¼Œä¹Ÿç®—æ˜¯è·¨å¹³å°äº†å§â€¦

ç„¶è€Œæˆ‘è¿˜æ²¡æŠŠé¡¹ç›®è·‘èµ·æ¥å‘¢ï¼Œä¸€ä¸å°å¿ƒæŠŠä¸€å †é™æ€èµ„æºç»™æäº¤è¿›å»äº†

å°±æ˜¯ä¸‹é¢è¿™äº›æ–‡ä»¶

    Clipify.Maui/wwwroot/lib/
    Clipify.Maui/wwwroot/css/*.min.css
    Clipify.Maui/wwwroot/temp/
    

è¿™ä¸‹ `git push` è¶…çº§æ…¢ï¼Œè€Œä¸”ä¼šå ç”¨å¤§é‡ç©ºé—´

è¿˜å¥½æœ€ç»ˆåœ¨å¤§æ¨¡å‹çˆ·çˆ·çš„å¸®åŠ©ä¸‹è§£å†³äº†è¿™ä¸ªé—®é¢˜

ä¸è¿‡æˆ‘æƒ³æ€»ä¸èƒ½è€æ˜¯å»æ‰“æ‰°å¤§æ¨¡å‹çˆ·çˆ·å•Šï¼Œé—®é¢˜è§£å†³äº†è¿˜æ˜¯å¾—è®°å½•ä¸€ä¸‹ï¼Œä»¥åé‡åˆ°ç±»ä¼¼çš„æƒ…å†µä¹Ÿå¥½å¤„ç†ã€‚

ä½¿ç”¨gitåŸç”Ÿå‘½ä»¤
---------

è¿™ä¸ªé—®é¢˜å…¶å®è€ç”Ÿå¸¸è°ˆäº†

ç½‘ä¸Šèƒ½æŸ¥åˆ°çš„å¾ˆå¤šæ–‡ç« éƒ½ä¼šå‘Šè¯‰ä½ å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤è§£å†³

    git rm -r --cached Clipify.Maui/wwwroot/lib
    git rm --cached Clipify.Maui/wwwroot/css/*.min.css
    git rm -r --cached Clipify.Maui/wwwroot/temp
    

è¿™äº›å‘½ä»¤ä¼šç§»é™¤å·²æäº¤çš„æ–‡ä»¶ï¼Œä½†**ä¸ä¼šåˆ é™¤æœ¬åœ°æ–‡ä»¶**

ä½†æˆ‘è¿™æ ·åšäº†ä¹‹åè¿˜æ˜¯ä¸è¡Œï¼Œgit push çš„æ—¶å€™è¿˜æ˜¯å¾ˆæ…¢

åˆ†æåŸå› 
----

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆ `git rm --cached` æ²¡ç”¨å‘¢ï¼Ÿ

åŸå› æ˜¯ `git rm --cached` åªä¼šä»å½“å‰ commitï¼ˆå·¥ä½œåŒºï¼‰ä¸­ç§»é™¤æŒ‡å®šæ–‡ä»¶çš„ Git è·Ÿè¸ªï¼Œå®ƒä¸ä¼šä¿®æ”¹è¿‡å»çš„æäº¤è®°å½•

**å®ƒè§£å†³çš„æ˜¯ã€Œç°åœ¨å¼€å§‹ä¸è¦å†è·Ÿè¸ªã€çš„é—®é¢˜ï¼Œ** ä½†å†å²ä¸Šå®ƒå·²ç»è·Ÿè¸ªè¿‡çš„æ–‡ä»¶ï¼ŒGit è¿˜ä¼šä¸€ç›´ä¿ç•™åœ¨å¯¹è±¡æ•°æ®åº“ï¼ˆ`.git/objects`ï¼‰é‡Œ

æˆ‘åœ¨å‰é¢å‡ ä¸ª commit å·²ç»æŠŠ Clipify.Maui/wwwroot/lib è¿™ç±»æ–‡ä»¶å¤¹æäº¤è¿›å»äº†

æ‰€ä»¥è¿™ä¸ªå‘½ä»¤å¯¹äºè¿™ä¸ªåœºæ™¯æ¥è¯´æ˜¯æ²¡ç”¨çš„ğŸ˜‚

ç®€å•æ¥è¯´ï¼ŒGit æ˜¯ä¸ªç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œå®ƒ**ä¸ä¼šå¿˜è®°**ä½ å†å²ä¸Šåšè¿‡çš„æäº¤ï¼Œå“ªæ€•ç°åœ¨ `git rm --cached` ç§»é™¤äº† `lib/` æ–‡ä»¶å¤¹

Git ä»ç„¶è®°å¾—ä¹‹å‰åœ¨ç¬¬ N æ¬¡ commit æ—¶æ›¾ç»åŠ å…¥è¿‡å®ƒï¼Œæ‰€ä»¥ `.git` ç›®å½•ä¾ç„¶ä¿å­˜äº†é‚£äº› **å¤§ blob æ–‡ä»¶**ï¼Œ`push` æ—¶ç…§æ ·è¦ä¼ ã€‚

è§£å†³æ–¹æ³•
----

é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿ

ä»¥å‰çœ‹åˆ°çš„æ–¹æ³•æ˜¯ç¼–å†™è„šæœ¬ï¼Œå¾ªç¯ä»æ¯ä¸ª commit é‡Œåˆ é™¤å·²æäº¤çš„æ–‡ä»¶

ç°åœ¨ä¸ç”¨è¿™ä¹ˆéº»çƒ¦äº†ï¼Œæœ‰äº† git-filter-repo å·¥å…·ï¼Œè¿™æ˜¯ä¸€ä¸ª python å†™çš„å¯ä»¥ç”¨æ¥é‡å†™ git å†å²è®°å½•çš„å·¥å…·

[https://github.com/newren/git-filter-repo](https://github.com/newren/git-filter-repo)

æ„Ÿè°¢ scoop ï¼Œè®©æˆ‘åœ¨ Windows ä¸Šä¹Ÿèƒ½è·å¾—ç±»ä¼¼ Linux/MacOS ç±»ä¼¼çš„è½¯ä»¶å®‰è£…ä½“éªŒ

    # å®‰è£… Git Filter Repo
    brew install git-filter-repo  # macOS
    scoop install git-filter-repo # Windows
    # æˆ–è€…ç”¨ Python å®‰è£…
    pip install git-filter-repo
    

ä½¿ç”¨æ–¹æ³•

    git filter-repo --path Clipify.Maui/wwwroot/lib/ --invert-paths --force
    

è¿™ä¸ªå‘½ä»¤ä¼š**å½»åº•åˆ é™¤å†å²ä¸­æ‰€æœ‰ä¸è¯¥è·¯å¾„ç›¸å…³çš„æ–‡ä»¶å’Œæäº¤è®°å½•**

**é‡å†™æ•´ä¸ª Git æäº¤å†å²**ä¹‹åï¼Œ**ä»“åº“å¤§å°ä¼šæ˜æ˜¾å‡å°**ï¼Œ`git push` æ›´å¿«ï¼Œ**å†å²æäº¤ä¸­æŒ‡å®šæ–‡ä»¶å°†å®Œå…¨ç§»é™¤**ã€‚å¯èƒ½éœ€è¦ä½¿ç”¨ `--force` å¼ºåˆ¶æ¨é€ä»£ç ã€‚

ç»è¿‡è¿™ä¸€é€šæ“ä½œä¹‹åï¼Œæˆ‘å†ä½¿ç”¨ git push æäº¤æ˜æ˜¾å¿«äº†å¾ˆå¤šã€‚

æ‹“å±•ï¼šå¦‚ä½•åˆ†ægitæäº¤å†å²é‡Œçš„å¤§æ–‡ä»¶
-------------------

ç”¨ \[`git rev-list` + `git verify-pack`\] å¯ä»¥æ‰¾å‡º Git æäº¤å†å²ä¸­çš„**å¤§å¯¹è±¡ï¼ˆå¤§æ–‡ä»¶ï¼‰**

ä¸è¿‡ git åŸç”Ÿçš„å‘½ä»¤æ¯”è¾ƒå¤æ‚

æˆ‘è¿˜æ˜¯é€‰æ‹©å€ŸåŠ©å·¥å…·çš„åŠ›é‡ï¼Œè¿™æ¬¡æ˜¯ git-sizer å·¥å…·

[git-sizer](https://github.com/github/git-sizer)æ˜¯ GitHub å®˜æ–¹å‡ºçš„å·¥å…·ï¼Œç”¨äºåˆ†æ Git ä»“åº“å¤§å°ã€æäº¤ä½“ç§¯ç­‰é—®é¢˜ã€‚

    brew install git-sizer
    # or
    scoop install git-sizer
    # or
    cargo install git-sizer
    

> PSï¼šå†æ¬¡æ„Ÿè°¢ scoop ï¼

ç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ `git-sizer` å³å¯

è¿™ä¸ªå·¥å…·ä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š

*   æœ€å¤§çš„æäº¤
*   æœ€å¤§çš„ blobï¼ˆæ–‡ä»¶å†…å®¹ï¼‰
*   æœ€å¤§çš„ç›®å½•
*   å«å¤§æ–‡ä»¶çš„åˆ†æ”¯
*   æ˜¯å¦å­˜åœ¨å†å²ä¸­éšè—çš„è‚¥èƒ–å¯¹è±¡ï¼ˆhidden bloatsï¼‰

æˆ‘ä½¿ç”¨è¿™ä¸ªå·¥å…·ç”Ÿæˆçš„ç»“æœæ˜¯è¿™æ ·

    Processing blobs: 2448                        
    Processing trees: 218                        
    Processing commits: 42                        
    Matching commits to trees: 42                        
    Processing annotated tags: 0                        
    Processing references: 3                        
    | Name                         | Value     | Level of concern               |
    | ---------------------------- | --------- | ------------------------------ |
    | Biggest objects              |           |                                |
    | * Trees                      |           |                                |
    |   * Maximum entries      [1] |  1.40 k   | *                              |
    
    [1]  77b7ff2aa0456193bee83eebe9dfb76ebd4f35ac (2d9cc135f1aff0863ce2ef8ceff3cbf6984ee499:Clipify.Maui/wwwroot/lib/font-awesome/svgs/solid)
    

è¿™æ ·å°±èƒ½å¾ˆæ–¹ä¾¿å®šä½åˆ°æœ€å¤§çš„æ–‡ä»¶ï¼Œç»™ git ä»“åº“ç˜¦èº«~

å¾®ä¿¡å…¬ä¼—å·ï¼šã€Œç¨‹åºè®¾è®¡å®éªŒå®¤ã€ ä¸“æ³¨äºäº’è”ç½‘çƒ­é—¨æ–°æŠ€æœ¯æ¢ç´¢ä¸å›¢é˜Ÿæ•æ·å¼€å‘å®è·µï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡ã€æœºå™¨å­¦ä¹ ä¸æ•°æ®åˆ†æç®—æ³•ã€ç§»åŠ¨ç«¯å¼€å‘ã€Linuxã€Webå‰åç«¯å¼€å‘ç­‰ï¼Œæ¬¢è¿ä¸€èµ·æ¢è®¨æŠ€æœ¯ï¼Œåˆ†äº«å­¦ä¹ å®è·µç»éªŒã€‚