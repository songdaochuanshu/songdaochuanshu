---
layout: post
title: 'ã€URPã€‘Unity[åå¤„ç†]é€šé“æ··åˆChannelMixer'
date: "2025-11-02T00:44:14Z"
---
ã€URPã€‘Unity\[åå¤„ç†\]é€šé“æ··åˆChannelMixer
=================================

![ã€URPã€‘Unity[åå¤„ç†]é€šé“æ··åˆChannelMixer](https://img2024.cnblogs.com/blog/3685400/202511/3685400-20251101192935771-1590385672.png) ChannelMixeræ˜¯Unity URPåå¤„ç†ç³»ç»Ÿä¸­ç”¨äºé¢œè‰²é€šé“æ··åˆçš„æ ¸å¿ƒæ•ˆæœç»„ä»¶ï¼Œä¸»è¦ç”¨äºè°ƒæ•´RGBé€šé“çš„æ··åˆæ¯”ä¾‹ä»¥å®ç°ç‰¹å®šçš„è‰²å½©åˆ†çº§æ•ˆæœã€‚å…¶å‘å±•å†å²å¯è¿½æº¯è‡³å½±è§†è¡Œä¸šçš„ä¼ ç»Ÿè°ƒè‰²æŠ€æœ¯ï¼Œåè¢«æ•´åˆåˆ°U

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ChannelMixeræ˜¯Unity URPåå¤„ç†ç³»ç»Ÿä¸­ç”¨äºé¢œè‰²é€šé“æ··åˆçš„æ ¸å¿ƒæ•ˆæœç»„ä»¶ï¼Œä¸»è¦ç”¨äºè°ƒæ•´RGBé€šé“çš„æ··åˆæ¯”ä¾‹ä»¥å®ç°ç‰¹å®šçš„è‰²å½©åˆ†çº§æ•ˆæœã€‚å…¶å‘å±•å†å²å¯è¿½æº¯è‡³å½±è§†è¡Œä¸šçš„ä¼ ç»Ÿè°ƒè‰²æŠ€æœ¯ï¼Œåè¢«æ•´åˆåˆ°Unityçš„Post Processing Stackä¸­ï¼Œå¹¶éšç€URPçš„æ¼”è¿›æˆä¸ºVolumeæ¡†æ¶ä¸‹çš„æ ‡å‡†åŒ–æ¨¡å—

**æ ¸å¿ƒåŠŸèƒ½ä¸å‚æ•°**
===========

â€Œ**é€šé“æ··åˆåŸç†**â€Œ
------------

é€šè¿‡ä¿®æ”¹è¾“å…¥é¢œè‰²é€šé“ï¼ˆRed/Green/Blueï¼‰å¯¹è¾“å‡ºé€šé“çš„è´¡çŒ®æƒé‡ï¼Œå®ç°å¦‚å•è‰²ä¿ç•™ã€è‰²è°ƒåç§»ç­‰æ•ˆæœã€‚ä¾‹å¦‚å¢åŠ ç»¿è‰²é€šé“å¯¹çº¢è‰²è¾“å‡ºçš„å½±å“ä¼šä½¿ç»¿è‰²åŒºåŸŸåçº¢ã€‚

ChannelMixeråœ¨Unity URPåå¤„ç†ä¸­çš„åº•å±‚åŸç†åŸºäºé¢œè‰²é€šé“çš„çº¿æ€§ä»£æ•°å˜æ¢ï¼Œé€šè¿‡å¯¹RGBé€šé“çš„æƒé‡çŸ©é˜µè¿ç®—å®ç°è‰²å½©é‡æ„.

> è¾“å‡ºé€šé“ = (R Ã— Ræƒé‡) + (G Ã— Gæƒé‡) + (B Ã— Bæƒé‡) + å¸¸æ•°åç§»

è¯¥è®¡ç®—åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­é€åƒç´ æ‰§è¡Œï¼Œé€šè¿‡çŸ©é˜µä¹˜æ³•å®ç°é¢œè‰²ç©ºé—´è½¬æ¢.

### **æ•°å­¦åŸç†åˆ†è§£**

*   â€Œ**é€šé“å˜æ¢çŸ©é˜µ**
    *   æ¯ä¸ªè¾“å‡ºé€šé“ç”±3Ã—4å˜æ¢çŸ©é˜µæ§åˆ¶ï¼ˆåŒ…å«å¸¸æ•°é¡¹ï¼‰ï¼Œä¾‹å¦‚çº¢è‰²è¾“å‡ºé€šé“è®¡ç®—ä¸ºï¼š
    *   $R\_{out}=R\_{in}\\times M\_{00}+G\_{in}\\times M\_{01}+B\_{in}\\times M\_{02}+M\_{03}$
    *   å…¶ä¸­M\_03ä¸ºå¸¸æ•°åç§»é‡ã€‚
*   â€Œ**äº®åº¦ä¿æŒæœºåˆ¶**â€Œ
    *   å½“å¯ç”¨Preserve Luminosityæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å½’ä¸€åŒ–æƒé‡ç³»æ•°ï¼Œç¡®ä¿æ»¡è¶³ï¼š
    *   $M\_{00}+M\_{01}+M\_{02}=1.0$
    *   é˜²æ­¢ç”»é¢è¿‡æ›æˆ–æ¬ æ›

### **URPå®ç°ç¤ºä¾‹ å…³é”®å®ç°è§£æ**

*   â€Œ**çŸ©é˜µè¿ç®—é˜¶æ®µ**â€Œ
    
    ç‰‡å…ƒç€è‰²å™¨é€šè¿‡`dot(col.rgb, _RedOut.xyz)`å®ç°å‘é‡ç‚¹ä¹˜ï¼Œç­‰æ•ˆäºçŸ©é˜µä¹˜æ³•ã€‚ä¾‹å¦‚è®¾ç½®`_RedOut=(0.5,0.3,0.2)`æ—¶ï¼Œæ–°çº¢è‰²é€šé“å€¼ä¸ºåŸRGBé€šé“çš„50%+30%+20%æ··åˆã€‚
    
*   â€Œ**åŠ¨æ€å‚æ•°ä¼ é€’**â€Œ
    
    URPé€šè¿‡Volumeç»„ä»¶å°†å‚æ•°æ‰“åŒ…ä¸ºVector4ï¼ˆxyzä¸ºRGBæƒé‡ï¼Œwä¸ºå¸¸æ•°åç§»ï¼‰ï¼Œæ¯å¸§æ›´æ–°è‡³Shaderã€‚ä¾‹å¦‚ç”µå½±çº§è°ƒè‰²å¸¸ç”¨é…ç½®ï¼š
    
        csharp
        _RedOut = new Vector4(0.8f, 0.1f, 0.1f, 0);// å¼ºåŒ–çº¢è‰²ä¸»åŸºè°ƒ
        _GreenOut = new Vector4(0f, 1.2f, -0.2f, 0);// å¢å¼ºç»¿è‰²å¹¶æŠ‘åˆ¶è“è‰²
        
    
*   â€Œ**åå¤„ç†ç®¡çº¿é›†æˆ**â€Œ
    
    RendererFeatureåœ¨`BeforeRenderingPostProcessing`äº‹ä»¶ç‚¹æ’å…¥é€šé“æ··åˆæ“ä½œï¼Œé€šè¿‡åŒæ¬¡Blité¿å…ç›´æ¥ä¿®æ”¹æºçº¹ç†ã€‚ä¸´æ—¶æ¸²æŸ“ç›®æ ‡`_TempChannelMixerTexture`ç¡®ä¿æ··åˆè¿‡ç¨‹å¯é€†.
    
*   ChannelMixer.shader
    
        Shader "PostProcessing/ChannelMixer" {
        Properties {
        _MainTex ("Texture", 2D) = "white" {}
        _RedOut ("Red Output", Vector) = (1,0,0,0)
        _GreenOut ("Green Output", Vector) = (0,1,0,0)
        _BlueOut ("Blue Output", Vector) = (0,0,1,0)
        }
        SubShader {
        HLSLPROGRAM
        #pragma only_renderers d3d11
        #pragma exclude_renderers gles
        #pragma target 5.0
        #pragma multi_compile_postprocess
            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/PostProcessing.hlsl"
        
            TEXTURE2D(_MainTex);
            SAMPLER(sampler_MainTex);
            float4 _RedOut;
            float4 _GreenOut;
            float4 _BlueOut;
        
            struct v2f {
                float2 uv : TEXCOORD0;
                float4 vertex : SV_POSITION;
            };
        
            v2f vert(appdata v) {
                v2f o;
                o.vertex = TransformWorldToClipPos(v.vertex);
                o.uv = v.uv;
                return o;
            }
        
            float4 frag(v2f i) : SV_Target {
                float4 col = SAMPLE_TEXTURE2D(_MainTex, sampler_MainTex, i.uv);
                float3 result;
                result.r = dot(col.rgb, _RedOut.xyz) + _RedOut.w;
                result.g = dot(col.rgb, _GreenOut.xyz) + _GreenOut.w;
                result.b = dot(col.rgb, _BlueOut.xyz) + _BlueOut.w;
                return float4(result, col.a);
            }
            ENDHLSL
        }
        }
        
    
*   ChannelMixerRendererFeature.cs
    
        using UnityEngine;
        using UnityEngine.Rendering;
        using UnityEngine.Rendering.Universal;
        
        public class ChannelMixerRendererFeature : ScriptableRendererFeature {
            class CustomRenderPass : ScriptableRenderPass {
                Material _material;
                RenderTargetHandle _tempTexture;
        
                public CustomRenderPass(Material material) {
                    _material = material;
                    _tempTexture.Init("_TempChannelMixerTexture");
                }
        
                public override void Execute(ScriptableRenderContext context, ref RenderingData data) {
                    CommandBuffer cmd = CommandBufferPool.Get("Channel Mixer");
                    RenderTextureDescriptor desc = data.cameraData.cameraTargetDescriptor;
        
                    cmd.GetTemporaryRT(_tempTexture.id, desc);
                    Blit(cmd, source: "_CameraColorTexture", dest: _tempTexture.id, _material);
                    Blit(cmd, source: _tempTexture.id, dest: "_CameraColorTexture");
        
                    cmd.ReleaseTemporaryRT(_tempTexture.id);
                    context.ExecuteCommandBuffer(cmd);
                    CommandBufferPool.Release(cmd);
                }
            }
        
            [System.Serializable]
            public class Settings {
                public Material material;
            }
        
            public Settings settings = new Settings();
            CustomRenderPass _scriptablePass;
        
            public override void Create() {
                _scriptablePass = new CustomRenderPass(settings.material);
                _scriptablePass.renderPassEvent = RenderPassEvent.BeforeRenderingPostProcessing;
            }
        
            public override void AddRenderPasses(ScriptableRenderer renderer, ref RenderingData data) {
                renderer.EnqueuePass(_scriptablePass);
            }
        }
        
    

â€Œ**å‚æ•°è¯´æ˜**â€Œ
----------

*   â€Œ**Output Channel**â€Œï¼šé€‰æ‹©è¦è°ƒæ•´çš„ç›®æ ‡é€šé“ï¼ˆRed/Green/Blueï¼‰
*   â€Œ**Red/Green/Blue Contribution**â€Œï¼šå„è¾“å…¥é€šé“å¯¹å½“å‰è¾“å‡ºé€šé“çš„å½±å“æƒé‡ï¼ˆèŒƒå›´-2åˆ°2ï¼‰
*   â€Œ**Preserve Luminosity**â€Œï¼šä¿æŒæ•´ä½“äº®åº¦ä¸å˜ï¼Œé¿å…è¿‡åº¦æ›å…‰ã€‚

**å®ç°æµç¨‹ç¤ºä¾‹**
==========

ChannelMixerExample.cs
----------------------

    using UnityEngine;
    using UnityEngine.Rendering;
    using UnityEngine.Rendering.Universal;
    
    public class ChannelMixerExample : VolumeComponent, IPostProcessComponent {
        public Vector3Parameter redOut = new(new Vector3(1, 0, 0));
        public Vector3Parameter greenOut = new(new Vector3(0, 1, 0)); 
        public Vector3Parameter blueOut = new(new Vector3(0, 0, 1));
    
        public bool IsActive() => true;
        public bool IsTileCompatible() => false;
    }
    

ChannelMixerRenderPass.cs
-------------------------

    using UnityEngine;
    using UnityEngine.Rendering;
    using UnityEngine.Rendering.Universal;
    
    public class ChannelMixerRenderPass : ScriptableRenderPass {
        private Material _material;
        private ChannelMixerExample _volume;
    
        public override void Execute(ScriptableRenderContext context, ref RenderingData data) {
            _volume = VolumeManager.instance.stack.GetComponent<ChannelMixerExample>();
            if (_volume == null) return;
    
            var cmd = CommandBufferPool.Get("ChannelMixer");
            _material.SetVector("_RedOut", _volume.redOut.value);
            _material.SetVector("_GreenOut", _volume.greenOut.value);
            _material.SetVector("_BlueOut", _volume.blueOut.value);
            Blit(cmd, ref data, _material, 0);
            context.ExecuteCommandBuffer(cmd);
        }
    }
    

**å®é™…åº”ç”¨æ¡ˆä¾‹**
==========

â€Œ**ç”µå½±æ„Ÿè°ƒè‰²**â€Œ
-----------

å°†è“è‰²é€šé“æ³¨å…¥çº¢è‰²è¾“å‡ºï¼ˆå¦‚è®¾ç½®RedOutä¸º(0.8, 0, 0.2)ï¼‰ï¼Œå¯åˆ›é€ ç±»ä¼¼ã€Šé»‘å®¢å¸å›½ã€‹çš„é’è‰²é˜´å½±æ•ˆæœã€‚

â€Œ**é£æ ¼åŒ–æ¸²æŸ“**â€Œ
-----------

é€šè¿‡åè½¬ç»¿è‰²é€šé“è´¡çŒ®ï¼ˆGreenOutè®¾ä¸º(-0.5, 1, 0)ï¼‰ï¼Œå®ç°èµ›åšæœ‹å…‹é£æ ¼çš„è‰²å½©åç§»ã€‚

â€Œ**é»‘ç™½æ»¤é•œ**â€Œ
----------

ç»Ÿä¸€å„é€šé“æƒé‡ï¼ˆå¦‚RedOut=(0.3,0.6,0.1)ï¼‰å¯ç”Ÿæˆé«˜è´¨é‡ç°åº¦å›¾åƒï¼Œæ¯”ç›´æ¥å»é¥±å’Œåº¦æ›´å¯æ§ã€‚

**èƒ¶ç‰‡æ¨¡æ‹Ÿ**â€Œ
---------

*   è®¾ç½®`BlueOut=(0,0,0.9,0.1)`ä½¿è“è‰²é€šé“è½»å¾®å‹ç¼©ï¼Œæ¨¡æ‹ŸæŸ¯è¾¾èƒ¶ç‰‡ç‰¹æ€§

â€Œ**è‰²ç›²è¾…åŠ©**â€Œ
----------

*   å°†çº¢è‰²é€šé“æ³¨å…¥ç»¿è‰²è¾“å‡ºï¼ˆ`GreenOut=(0.5,0.5,0,0)`ï¼‰æå‡çº¢ç»¿è‰²ç›²è¾¨è¯†åº¦

â€Œ**é£æ ¼åŒ–æ¸²æŸ“**â€Œ
-----------

*   è´Ÿå€¼æƒé‡åˆ›é€ äº’è¡¥è‰²æ•ˆæœï¼Œå¦‚`RedOut=(1, -0.2, 0, 0)`äº§ç”Ÿèµ›åšæœ‹å…‹è‰²è°ƒ

**æ“ä½œæ­¥éª¤**
--------

*   åœ¨Volumeä¸­æ·»åŠ Channel Mixeræ•ˆæœ
*   è°ƒæ•´ç›®æ ‡é€šé“çš„RGBæƒé‡ä¸‰è§’æ»‘å—
*   å¯ç”¨Preserve Luminosityé¿å…è¿‡æ›

è¯¥æŠ€æœ¯ç°å·²æˆä¸ºURPæ ‡å‡†ç®¡çº¿çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡Volumeç³»ç»Ÿå®ç°éç ´åæ€§è°ƒæ•´ï¼Œæ¯”ä¼ ç»ŸShaderæ–¹æ¡ˆæ›´æ˜“é›†æˆåˆ°ç¾æœ¯å·¥ä½œæµä¸­

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**  
> ï¼ˆæ¬¢è¿_ç‚¹èµç•™è¨€_æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰