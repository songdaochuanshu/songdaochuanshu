---
layout: post
title: 'ã€æ¸²æŸ“æµæ°´çº¿ã€‘[å‡ ä½•é˜¶æ®µ]-[æ›²é¢ç»†åˆ†]ä»¥UnityURPä¸ºä¾‹'
date: "2025-08-14T00:43:09Z"
---
ã€æ¸²æŸ“æµæ°´çº¿ã€‘\[å‡ ä½•é˜¶æ®µ\]-\[æ›²é¢ç»†åˆ†\]ä»¥UnityURPä¸ºä¾‹
===================================

![ã€æ¸²æŸ“æµæ°´çº¿ã€‘[å‡ ä½•é˜¶æ®µ]-[æ›²é¢ç»†åˆ†]ä»¥UnityURPä¸ºä¾‹](https://img2024.cnblogs.com/blog/3685400/202508/3685400-20250813121315216-901546302.png) æœ¬æ–‡ä»‹ç»äº†ç»†åˆ†ç€è‰²å™¨çš„æ ¸å¿ƒåŸç†ä¸å®ç°æ–¹æ³•ã€‚ç»†åˆ†ç€è‰²å™¨åˆ†ä¸ºæ›²é¢ç»†åˆ†ç€è‰²å™¨å’Œç»†åˆ†è®¡ç®—ç€è‰²å™¨ï¼Œä¸»è¦ç”¨äºåŠ¨æ€å¢åŠ æ¨¡å‹ç»†èŠ‚ï¼Œæå‡è‰åœ°ã€åœ°å½¢ç­‰åœºæ™¯çš„æ¸²æŸ“æ•ˆæœã€‚æ–‡ç« è¯¦ç»†è§£æäº†ç»†åˆ†è¿‡ç¨‹çš„ä¸‰ä¸ªé˜¶æ®µï¼šHull Shaderå®šä¹‰ç»†åˆ†å› å­ï¼ŒTessellation Primitive Generatoræ‰§è¡Œç¡¬ä»¶çº§ç»†åˆ†æ“ä½œï¼ŒDomain Shaderå®Œæˆé¡¶ç‚¹ç©ºé—´è½¬æ¢ã€‚é‡ç‚¹é˜è¿°äº†Delaunayä¸‰è§’å‰–åˆ†åŸåˆ™åœ¨URPä¸­çš„å®ç°ï¼ŒåŒ…æ‹¬ç©ºåœ†ç‰¹æ€§å’Œå±€éƒ¨ä¼˜åŒ–æ–¹æ³•ã€‚æœ€åæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„URPç»†åˆ†ç€è‰²å™¨ç¤ºä¾‹ï¼Œå±•ç¤ºäº†åŠ¨æ€ç»†åˆ†æ§åˆ¶ã€é¡¶ç‚¹ä½ç§»ç­‰å…³é”®æŠ€æœ¯ï¼Œå¹¶

*   **ç»†åˆ†ç€è‰²å™¨åˆ†ä¸º**ï¼šæ›²é¢ç»†åˆ†ç€è‰²å™¨ï¼ˆUnityåœ¨æŒ‡å®šå¹³å°ç¡¬ä»¶æ”¯æŒï¼‰ã€ç»†åˆ†è®¡ç®—ç€è‰²å™¨ã€‚ä½¿ç”¨ç‰‡é¢æ¥æè¿°ä¸€ä¸ªç‰©ä½“å½¢çŠ¶ï¼Œå¹¶å¢åŠ é¡¶ç‚¹å’Œç‰‡é¢æ•°é‡ï¼Œä½¿æ¨¡å‹å¤–è§‚å¼€èµ·æ¥æ›´å¹³æ»‘ã€‚
*   â€Œ**ä½œç”¨**â€Œï¼šåŠ¨æ€ç»†åˆ†ä¸‰è§’é¢ç‰‡ï¼Œæå‡æ¨¡å‹ç»†èŠ‚ï¼ˆå¦‚è‰åœ°ã€åœ°å½¢æ¸²æŸ“ï¼‰ï¼Œä¼˜åŒ–å¤§åœºæ™¯æ€§èƒ½ â€Œã€‚
*   è¿™æ˜¯ä¸€ä¸ªâ€Œ**å¯é€‰**â€Œé˜¶æ®µã€‚å®ƒåœ¨é¡¶ç‚¹ç€è‰²å™¨ä¹‹åè¿è¡Œï¼Œè´Ÿè´£æ ¹æ®è®¾å®šçš„ç»†åˆ†å› å­ (Tessellation Factor) å°†è¾“å…¥çš„å›¾å…ƒï¼ˆé€šå¸¸æ˜¯ä¸‰è§’å½¢é¢ç‰‡ï¼‰åŠ¨æ€ç»†åˆ†ä¸ºæ›´å°çš„ä¸‰è§’é¢ç‰‡ï¼Œç”Ÿæˆæ›´å¤šé¡¶ç‚¹ã€‚â€Œ

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ä¸‰ä¸ªå­é˜¶æ®µï¼š
======

Hull Shaderï¼šå®šä¹‰æ¯æ¡è¾¹å’Œå†…éƒ¨åˆ†å‰²å› å­ï¼ˆTessellation Factorï¼‰ã€‚â€Œ
-----------------------------------------------

*   æ¥æ”¶åŸå§‹æ§åˆ¶ç‚¹æ•°æ®å¹¶å®šä¹‰ç»†åˆ†å› å­(Tessellation Factor)
*   é€šè¿‡`patch constant function`è®¡ç®—æ¯æ¡è¾¹å’Œå†…éƒ¨çš„ç»†åˆ†ç­‰çº§
*   æ”¯æŒåˆ†æ•°ç»†åˆ†æ¨¡å¼(fractional\_odd/fractional\_even)å®ç°å¹³æ»‘è¿‡æ¸¡

### **ç›®æ ‡**â€Œï¼š

*   å®šä¹‰åŸå§‹æ§åˆ¶ç‚¹æ•°æ®å¹¶è®¡ç®—ç»†åˆ†å› å­(Tessellation Factor)
*   ç¡®å®šæ¯ä¸ªpatchçš„è¾¹å’Œå†…éƒ¨ç»†åˆ†ç­‰çº§

### â€Œ**è¾“å…¥è¾“å‡º**â€Œï¼š

*   è¾“å…¥ï¼šåŸå§‹æ§åˆ¶ç‚¹æ•°æ®ï¼ˆä½ç½®ã€æ³•çº¿ã€UVç­‰ï¼‰
*   è¾“å‡ºï¼š
    *   ç»†åˆ†å› å­ï¼ˆ`SV_TessFactor`æ ‡è®°è¾¹ï¼Œ`SV_InsideTessFactor`æ ‡è®°å†…éƒ¨ï¼‰
    *   å¤„ç†åçš„æ§åˆ¶ç‚¹æ•°æ®ï¼ˆé€šè¿‡`INTERNALTESSPOS`è¯­ä¹‰æ ‡è®°ï¼‰

### â€Œ**å®ç°å…³é”®**â€Œï¼š

    hlsl
    struct TessFactors {
        float edge[3] : SV_TessFactor; // ä¸‰æ¡è¾¹çš„ç»†åˆ†å› å­
        float inside : SV_InsideTessFactor; // å†…éƒ¨ç»†åˆ†å› å­
    };
    

â€Œ**Tessellation Primitive Generator å›ºå®šåŠŸèƒ½**â€Œï¼šç¡¬ä»¶æ ¹æ® Hull Shader è¾“å‡ºçš„å› å­å®é™…æ‰§è¡Œç»†åˆ†æ“ä½œã€‚â€Œ
----------------------------------------------------------------------------

*   GPUå›ºå®šåŠŸèƒ½é˜¶æ®µï¼Œæ ¹æ®Hull Shaderè¾“å‡ºçš„ç»†åˆ†å› å­ç”Ÿæˆæ–°é¡¶ç‚¹æ‹“æ‰‘

### **ç›®æ ‡**â€Œï¼š

*   æ ¹æ®Hull Shaderè¾“å‡ºçš„ç»†åˆ†å› å­ç”Ÿæˆæ–°é¡¶ç‚¹æ‹“æ‰‘
*   å°†åŸå§‹patchç»†åˆ†ä¸ºæ›´å¯†é›†çš„ä¸‰è§’ç½‘æ ¼

### â€Œ**è¾“å…¥è¾“å‡º**â€Œï¼š

*   **è¾“å…¥ï¼šHull Shaderè¾“å‡ºçš„ç»†åˆ†å› å­å’Œæ§åˆ¶ç‚¹**
    
        hlsl
        
        // æ¥è‡ªHull Shaderçš„è¾“å‡º
        struct TessControlPoint {
            float4 positionOS : INTERNALTESSPOS;
            float3 normalOS : NORMAL;
            float2 uv : TEXCOORD0;
        };
        
        // ç»†åˆ†å› å­å®šä¹‰
        struct TessFactors {
            float edge[3] : SV_TessFactor; // æ¯æ¡è¾¹çš„ç»†åˆ†ç­‰çº§
            float inside : SV_InsideTessFactor; // å†…éƒ¨ç»†åˆ†ç­‰çº§
        };
        
    
*   **è¾“å‡ºï¼šç»†åˆ†åçš„é¡¶ç‚¹UVåæ ‡å’Œæ‹“æ‰‘å…³ç³»**
    
    *   ç”Ÿæˆçš„é‡å¿ƒåæ ‡æ•°æ®ï¼š
        
            hlsl
            float3 baryCoords : SV_DomainLocation; // æ–°é¡¶ç‚¹çš„é‡å¿ƒåæ ‡
            
        
    *   è¾“å‡ºæ‹“æ‰‘ç±»å‹ç”±Hull Shaderçš„`[outputtopology]`å±æ€§å®šä¹‰ï¼ˆå¦‚triangle\_cwï¼‰
        

### â€Œ**ç‰¹æ€§**â€Œï¼š

*   GPUè‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€å¼€å‘è€…ç¼–ç 
*   æ”¯æŒåˆ†æ•°ç»†åˆ†æ¨¡å¼å®ç°å¹³æ»‘è¿‡æ¸¡

**å®ç°åŸç†**
--------

### â€Œ**ç»†åˆ†ç®—æ³•**â€Œ

*   å¯¹åŸå§‹ä¸‰è§’é¢ç‰‡è¿›è¡Œé€’å½’ç»†åˆ†ï¼Œé‡‡ç”¨Delaunayä¸‰è§’å‰–åˆ†åŸåˆ™
    
    GPUä½¿ç”¨çš„Delaunayä¸‰è§’å‰–åˆ†åŸåˆ™æ˜¯ä¸€ç§ä¼˜åŒ–ç½‘æ ¼æ‹“æ‰‘çš„æ•°å­¦æ–¹æ³•
    
    *   â€Œ**Delaunayä¸‰è§’å‰–åˆ†åŸåˆ™**â€Œ
        
        1.  â€Œ**ç©ºåœ†ç‰¹æ€§**â€Œï¼šä»»æ„ä¸‰è§’å½¢çš„å¤–æ¥åœ†å†…ä¸åŒ…å«å…¶ä»–é¡¶ç‚¹
        2.  â€Œ**æœ€å¤§åŒ–æœ€å°è§’**â€Œï¼šé¿å…å‡ºç°å°–é”ä¸‰è§’å½¢ï¼Œæé«˜ç½‘æ ¼è´¨é‡
        3.  â€Œ**å±€éƒ¨ä¼˜åŒ–**â€Œï¼šé€šè¿‡è¾¹ç¿»è½¬(edge flip)é€æ­¥ä¼˜åŒ–ä¸‰è§’ç½‘æ ¼
    *   â€Œ**URPä¸­çš„å®ç°ç‰¹ç‚¹**â€Œï¼š
        
        1.  åœ¨Tessellation Primitive Generatoré˜¶æ®µè‡ªåŠ¨åº”ç”¨
        2.  å¯¹ç»†åˆ†åçš„æ–°é¡¶ç‚¹è¿›è¡Œæ‹“æ‰‘ä¼˜åŒ–
        3.  ä¿æŒä¸åŸç½‘æ ¼çš„å¹³æ»‘è¿‡æ¸¡
    *   â€Œ**å…·ä½“ç¤ºä¾‹**â€Œï¼š
        
        åŸå§‹ä¸‰è§’é¢ç‰‡ï¼ˆæ§åˆ¶ç‚¹A/B/Cï¼‰ç»è¿‡ç»†åˆ†åï¼š
        
        *   è®¡ç®—ç»†åˆ†å› å­ä¸º3æ—¶ï¼š
        
            åŸå§‹ä¸‰è§’å½¢ï¼š A
                        / \
                       C---B
            
            ç»†åˆ†åæ‹“æ‰‘ï¼š
                  A
                 /|\
                / | \
               C--D--B
                \ | /
                 \|/
                  E
            
        
        *   å…¶ä¸­D/Eæ˜¯æ–°ç”Ÿæˆçš„é¡¶ç‚¹ï¼Œæ‰€æœ‰ä¸‰è§’å½¢éƒ½æ»¡è¶³ï¼š
            *   âˆ ADB + âˆ AEB â‰ˆ 180Â°
            *   å¤–æ¥åœ†ä¸åŒ…å«å…¶ä»–é¡¶ç‚¹
    *   â€Œ**URPä¸­çš„å®é™…åº”ç”¨**â€Œï¼š
        
        1.  å½“ä½¿ç”¨`[partitioning("fractional_odd")]`æ—¶ï¼š
            *   ä¼šåœ¨è¿‡æ¸¡åŒºåŸŸè‡ªåŠ¨åº”ç”¨Delaunayä¼˜åŒ–
            *   ç¡®ä¿ä¸åŒç»†åˆ†ç­‰çº§é—´çš„å¹³æ»‘è¿æ¥
        2.  ä½ç§»è´´å›¾å¤„ç†æ—¶ï¼š
            *   æ–°é¡¶ç‚¹æ ¹æ®Delaunayè§„åˆ™åˆ†å¸ƒ
            *   ä½ç§»åçš„æ³•çº¿è®¡ç®—æ›´å‡†ç¡®
    *   è¿™ç§å‰–åˆ†æ–¹å¼ä½¿å¾—ï¼š
        
        *   ç»†åˆ†åçš„ç½‘æ ¼æ›´é€‚åº”æ›²é¢å˜å½¢
        *   é¿å…æ¸²æŸ“æ—¶çš„è¤¶çš±ç°è±¡
        *   æå‡ä½ç§»è´´å›¾çš„è§†è§‰æ•ˆæœ
*   æ ¹æ®åˆ†æ•°ç»†åˆ†æ¨¡å¼ï¼ˆfractional\_odd/evenï¼‰å¤„ç†è¿‡æ¸¡åŒºåŸŸ
    

### â€Œåæ ‡è½¬æ¢ $Pnew=P0â‹…u+P1â‹…v+P2â‹…w$

*   å°†å‚æ•°ç©ºé—´åæ ‡(u,v,w)è½¬æ¢ä¸ºæ–°çš„é¡¶ç‚¹ä½ç½®

### **æ€§èƒ½ä¼˜åŒ–**â€Œ

*   é‡‡ç”¨å¹¶è¡Œè®¡ç®—å¤„ç†å¤šä¸ªpatch
*   è‡ªåŠ¨å‰”é™¤å±å¹•ç©ºé—´ä¸å¯è§çš„ç»†åˆ†ç»“æœ

â€Œ**Domain Shader**â€Œï¼š
--------------------

å°†ç»†åˆ†åä½äº**é‡å¿ƒåæ ‡ç³»**(_é‡å¿ƒåæ ‡å†…å®¹åç»­å•å¼€ä¸€ç¯‡è®²è§£_)ä¸­çš„æ–°é¡¶ç‚¹ä½ç½®è½¬æ¢åˆ°ç›®æ ‡ç©ºé—´ï¼ˆå¦‚ä¸–ç•Œç©ºé—´æˆ–è£å‰ªç©ºé—´ï¼‰ã€‚â€Œ

*   å°†ç»†åˆ†åçš„UVåæ ‡æ˜ å°„åˆ°3Dç©ºé—´
*   æ‰§è¡Œé¡¶ç‚¹ä½ç§»ç­‰åæœŸå¤„ç†

### **ç›®æ ‡**â€Œï¼š

*   å°†ç»†åˆ†åçš„UVåæ ‡æ˜ å°„åˆ°3Dç©ºé—´
*   æ‰§è¡Œé¡¶ç‚¹ä½ç§»ç­‰åæœŸå¤„ç†

### â€Œ**è¾“å…¥è¾“å‡º**â€Œï¼š

*   è¾“å…¥ï¼šç»†åˆ†åçš„UVåæ ‡å’ŒåŸå§‹æ§åˆ¶ç‚¹æ•°æ®
*   è¾“å‡ºï¼šæœ€ç»ˆé¡¶ç‚¹ä½ç½®ï¼ˆ`SV_POSITION`ï¼‰å’Œå…¶ä»–é¡¶ç‚¹å±æ€§

### â€Œ**å®ç°ç¤ºä¾‹**â€Œï¼š

    hlsl
    [domain("tri")] // å£°æ˜å¤„ç†ä¸‰è§’å½¢patch
    Varyings domain(TessFactors factors, OutputPatch<DomainAttributes, 3> patch, float3 baryCoords : SV_DomainLocation) {
        Varyings OUT;
        // æ’å€¼è®¡ç®—æ–°é¡¶ç‚¹å±æ€§
        OUT.positionWS = TransformObjectToWorld(patch[0].positionOS * baryCoords.x + ...);
        return OUT;
    }
    

### â€Œ**åŠ¨æ€æ§åˆ¶æŠ€å·§**â€Œï¼š

*   é€šè¿‡æ‘„åƒæœºè·ç¦»è°ƒæ•´ç»†åˆ†å› å­ï¼š
    
        hlsl
        float CalcTessFactor(float3 worldPos) {
            return lerp(_MaxTess, _MinTess, saturate(distance(_WorldSpaceCameraPos, worldPos) / _TessRange));
        }
        
    
*   ç»“åˆé«˜åº¦å›¾å®ç°ä½ç§»æ•ˆæœ
    

â€Œé…ç½®ï¼š
====

*   éœ€æ˜¾å¼å¯ç”¨ï¼ˆHLSL ä¸­å£°æ˜Â `hull`Â å’ŒÂ `domain`Â å‡½æ•°ï¼‰ã€‚
*   å¿…é¡»å£°æ˜`#pragma target 4.6`ä»¥å¯ç”¨DX11/OpenGL Coreç‰¹æ€§3
*   éœ€æ‰‹åŠ¨å®ç°Hull/Domain Shaderï¼ŒURPä¸æä¾›è¡¨é¢ç€è‰²å™¨çš„ç®€åŒ–å†™æ³•
*   å»ºè®®ç»“åˆæ‘„åƒæœºè·ç¦»åŠ¨æ€æ§åˆ¶ç»†åˆ†å› å­ä»¥ä¼˜åŒ–æ€§èƒ½

URPä¸­çš„å…·ä½“å®ç°æ­¥éª¤ï¼š
============

å£°æ˜ç¼–è¯‘ç›®æ ‡ä¸º4.6ä»¥ä¸Šï¼š
-------------

    hlsl
    #pragma target 4.6
    

å®šä¹‰ä¸‰ä¸ªå…³é”®ç¨‹åºï¼š
---------

    hlsl
    #pragma vertex BeforeTessVert
    #pragma hull HullProgram
    #pragma domain DomainProgram
    

æ§åˆ¶ç‚¹æ•°æ®ç»“æ„éœ€åŒ…å«é¡¶ç‚¹ä½ç½®ã€æ³•çº¿ç­‰åŸºç¡€å±æ€§
----------------------

### â€ŒåŠ¨æ€ç»†åˆ†æ§åˆ¶æ ·ä¾‹ï¼š

*   é€šè¿‡è·ç¦»æˆ–å±å¹•ç©ºé—´å°ºå¯¸è‡ªåŠ¨è°ƒæ•´ç»†åˆ†å› å­ï¼š

    hlsl
    // æ ¹æ®æ‘„åƒæœºè·ç¦»åŠ¨æ€è®¡ç®—ç»†åˆ†å› å­
    float CalcTessFactor(float3 worldPos) {
        float dist = distance(_WorldSpaceCameraPos, worldPos);
        return lerp(_MaxTess, _MinTess, saturate(dist / _TessRange));
    }
    

### å¸¸è§åº”ç”¨åœºæ™¯ï¼š

*   åœ°å½¢åŠ¨æ€LODï¼šæ ¹æ®è§†è§’è·ç¦»ç»†åˆ†åœ°é¢ç½‘æ ¼3
*   æ›²é¢å¹³æ»‘ï¼šå°†ä½æ¨¡è½¬æ¢ä¸ºé«˜æ¨¡æ›²é¢2
*   åŠ¨æ€ä½ç§»ï¼šç»“åˆé«˜åº¦å›¾å®ç°å®æ—¶å‡¹å‡¸æ•ˆæœ6

### â€Œæ³¨æ„äº‹é¡¹ï¼š

*   ä»…æ”¯æŒDX11/OpenGL Coreç­‰ç°ä»£å›¾å½¢API6
*   ç»†åˆ†è¿‡åº¦ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œéœ€åˆç†è®¾ç½®ä¸Šé™5
*   URPä¸­éœ€æ‰‹åŠ¨å®ç°Hull/Domain Shaderï¼Œä¸åŒäºå†…ç½®ç®¡çº¿çš„è¡¨é¢ç€è‰²å™¨ç®€åŒ–å†™æ³•

**Unity URPä¸­å®Œæ•´çš„æ›²é¢ç»†åˆ†ç€è‰²å™¨ç¤ºä¾‹ï¼ŒåŒ…å«é¡¶ç‚¹ä½ç§»æ•ˆæœå’ŒåŠ¨æ€ç»†åˆ†æ§åˆ¶**
------------------------------------------

**ç¤ºä¾‹å®ç°åŠŸèƒ½ï¼š**
-----------

*   åŠ¨æ€ç»†åˆ†æ§åˆ¶ï¼šæ ¹æ®æ‘„åƒæœºè·ç¦»è‡ªåŠ¨è°ƒæ•´ç»†åˆ†å› å­
*   é¡¶ç‚¹ä½ç§»æ•ˆæœï¼šé€šè¿‡é«˜åº¦å›¾(\_DispTex)é©±åŠ¨é¡¶ç‚¹åç§»
*   åˆ†æ•°ç»†åˆ†æ¨¡å¼ï¼šä½¿ç”¨fractional\_oddå®ç°å¹³æ»‘è¿‡æ¸¡
*   å®Œæ•´æ¸²æŸ“ç®¡çº¿ï¼šåŒ…å«é¡¶ç‚¹/ç»†åˆ†/ç‰‡å…ƒå…¨é˜¶æ®µå¤„ç†
*   URPå…¼å®¹æ€§ï¼šä½¿ç”¨URPçš„ShaderLibraryæ ¸å¿ƒå‡½æ•°

**ä½¿ç”¨è¯´æ˜ï¼š**
---------

*   åˆ›å»ºæè´¨çƒå¹¶åº”ç”¨æ­¤ç€è‰²å™¨
*   ä¸º\_DispTexæŒ‡å®šé«˜åº¦å›¾çº¹ç†
*   è°ƒæ•´\_TessFactoræ§åˆ¶ç»†åˆ†å¯†åº¦
*   é€šè¿‡\_Displacementå‚æ•°æ§åˆ¶ä½ç§»å¼ºåº¦

**TessellationExample.shader**
------------------------------

    // HLSL
    Shader "Custom/TessellationExample"
    {
        Properties
        {
            _MainTex ("Base Texture", 2D) = "white" {}
            _TessFactor ("Tessellation Factor", Range(1, 64)) = 4
            _Displacement ("Displacement", Range(0, 1.0)) = 0.3
            _DispTex ("Displacement Texture", 2D) = "gray" {}
        }
    
        SubShader
        {
            Tags { "RenderPipeline"="UniversalPipeline" }
    
            HLSLINCLUDE
            #include "Packages/com.unity.render-pipelines.universal/ShaderLibrary/Core.hlsl"
    
            struct Attributes
            {
                float4 positionOS : POSITION;
                float3 normalOS : NORMAL;
                float2 uv : TEXCOORD0;
            };
    
            struct TessControlPoint
            {
                float4 positionOS : INTERNALTESSPOS;
                float3 normalOS : NORMAL;
                float2 uv : TEXCOORD0;
            };
    
            struct TessFactors
            {
                float edge[3] : SV_TessFactor;
                float inside : SV_InsideTessFactor;
            };
    
            struct DomainOutput
            {
                float4 positionCS : SV_POSITION;
                float2 uv : TEXCOORD0;
                float3 normalWS : NORMAL;
            };
            ENDHLSL
    
            Pass
            {
                Name "ForwardLit"
                Tags { "LightMode"="UniversalForward" }
    
                HLSLPROGRAM
                #pragma vertex vert
                #pragma hull hull
                #pragma domain domain
                #pragma fragment frag
                #pragma target 4.6
    
                sampler2D _MainTex;
                sampler2D _DispTex;
                float _TessFactor;
                float _Displacement;
    
                TessControlPoint vert(Attributes v)
                {
                    TessControlPoint o;
                    o.positionOS = v.positionOS;
                    o.normalOS = v.normalOS;
                    o.uv = v.uv;
                    return o;
                }
    
                [domain("tri")]
                [partitioning("fractional_odd")]
                [outputtopology("triangle_cw")]
                [outputcontrolpoints(3)]
                [patchconstantfunc("patchConstantFunc")]
                TessControlPoint hull(InputPatch<TessControlPoint, 3> patch, uint id : SV_OutputControlPointID)
                {
                    return patch[id];
                }
    
                TessFactors patchConstantFunc(InputPatch<TessControlPoint, 3> patch)
                {
                    TessFactors f;
                    float avgTess = _TessFactor * (1 - saturate(length(_WorldSpaceCameraPos - TransformObjectToWorld(patch[0].positionOS.xyz)) / 20));
                    f.edge[0] = f.edge[1] = f.edge[2] = avgTess;
                    f.inside = avgTess;
                    return f;
                }
    
                [domain("tri")]
                DomainOutput domain(TessFactors factors, OutputPatch<TessControlPoint, 3> patch, float3 baryCoords : SV_DomainLocation)
                {
                    DomainOutput o;
                    
                    // æ’å€¼è®¡ç®—åŸºç¡€å±æ€§
                    float3 positionOS = patch[0].positionOS.xyz * baryCoords.x + 
                                       patch[1].positionOS.xyz * baryCoords.y + 
                                       patch[2].positionOS.xyz * baryCoords.z;
                    
                    float2 uv = patch[0].uv * baryCoords.x + 
                                patch[1].uv * baryCoords.y + 
                                patch[2].uv * baryCoords.z;
                    
                    // ä»é«˜åº¦å›¾è·å–ä½ç§»å€¼
                    float disp = tex2Dlod(_DispTex, float4(uv, 0, 0)).r * _Displacement;
                    positionOS += normalize(patch[0].normalOS) * disp;
                    
                    // è½¬æ¢åˆ°è£å‰ªç©ºé—´
                    o.positionCS = TransformObjectToHClip(positionOS);
                    o.uv = uv;
                    o.normalWS = TransformObjectToWorldNormal(patch[0].normalOS);
                    return o;
                }
    
                half4 frag(DomainOutput i) : SV_Target
                {
                    half4 col = tex2D(_MainTex, i.uv);
                    return col;
                }
                ENDHLSL
            }
        }
    }
    

* * *

> [ã€ä»UnityURPå¼€å§‹æ¢ç´¢æ¸¸æˆæ¸²æŸ“ã€‘](https://blog.csdn.net/chenghai37/category_13021255.html?fromshare=blogcolumn&sharetype=blogcolumn&sharerId=13021255&sharerefer=PC&sharesource=chenghai37&sharefrom=from_link)**ä¸“æ -ç›´è¾¾**

ï¼ˆæ¬¢è¿ç‚¹èµç•™è¨€æ¢è®¨ï¼Œæ›´å¤šäººåŠ å…¥è¿›æ¥èƒ½æ›´åŠ å®Œå–„è¿™ä¸ªæ¢ç´¢çš„è¿‡ç¨‹ï¼ŒğŸ™ï¼‰