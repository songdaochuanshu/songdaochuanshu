---
layout: post
title: '麒麟系统离线安装docker和docker-compose'
date: "2025-11-28T00:40:55Z"
---
麒麟系统离线安装docker和docker-compose
=============================

最近需要在麒麟系统安装emqx，由于emqx没有麒麟系统的安装包且源码编译依赖版本较难管理，因此采用docker容器化部署，现在回忆总结一下docker和docker-compose的离线安装步骤。  
这里是麒麟系统docker离线部署教程回忆版：[https://www.cnblogs.com/scales123/p/19279440](https://www.cnblogs.com/scales123/p/19279440)

1 准备工作
======

我安装的操作系统是麒麟V4及V10，aarch64架构

1.1 查看操作系统
----------

    // 查看系统版本
    uname -a
    // 查看系统架构
    uname -m
    

1.2 下载安装包
---------

我使用的docker版本是：docker-20.10.7.tgz，docker-compose版本是v2.17.2，我整理的下载资源：通过网盘分享的文件：docker\_20.10.17安装包.rar  
链接: [https://pan.baidu.com/s/1LbFJDHMTcpblSUAiMpfteQ?pwd=1234](https://pan.baidu.com/s/1LbFJDHMTcpblSUAiMpfteQ?pwd=1234) 提取码: 1234  
选择aarch64架构  
  
选择对应的版本  
docker：[https://download.docker.com/linux/static/stable/aarch64/](https://download.docker.com/linux/static/stable/aarch64/)  
  
dcoker-compose: [https://github.com/docker/compose/releases](https://github.com/docker/compose/releases)  
找到docker的对应版本，在Assets里选择相应架构的安装包  

1.3 准备docker.service文件
----------------------

    docker.service
      
    [Unit]
    Description=Docker Application Container Engine
    Documentation=https://docs.docker.com
    After=network-online.target firewalld.service
    Wants=network-online.target
    
    [Service]
    Type=notify
    # the default is not to use systemd for cgroups because the delegate issues still
    # exists and systemd currently does not support the cgroup feature set required
    # for containers run by docker
    ExecStart=/usr/bin/dockerd
    ExecReload=/bin/kill -s HUP $MAINPID
    # Having non-zero Limit*s causes performance problems due to accounting overhead
    # in the kernel. We recommend using cgroups to do container-local accounting.
    LimitNOFILE=infinity
    LimitNPROC=infinity
    LimitCORE=infinity
    # Uncomment TasksMax if your systemd version supports it.
    # Only systemd 226 and above support this version.
    #TasksMax=infinity
    TimeoutStartSec=0
    # set delegate yes so that systemd does not reset the cgroups of docker containers
    Delegate=yes
    # kill only the docker process, not all processes in the cgroup
    KillMode=process
    # restart the docker process if it exits prematurely
    Restart=on-failure
    StartLimitBurst=3
    StartLimitInterval=60s
    
    [Install]
    WantedBy=multi-user.target
    

3 安装docker和docker-compose
=========================

以下命令逐步执行

    // 将安装包存放到/opt/docker
    scp -r 本地存放目录 用户名@remote_host:/opt/docker
    
    // 进入安装文件存放目录
    cd /opt/docker
    
    // 解压 docker 到当前目录
    tar -xvf docker-20.10.7.tgz
    
    // 将 docker 文件移动到 /usr/bin 目录下
    cp -p docker/* /usr/bin
    
    // 将 docker-compose 文件复制到 /usr/local/bin/ 目录下，并重命名为 docker-compose
    cp docker-compose-linux-aarch64 /usr/local/bin/docker-compose
    
    // 设置 docker-compose 文件权限
    chmod +x /usr/local/bin/docker-compose
    
    // 将 docker.service 移到 /etc/systemd/system/ 目录
    cp docker.service /etc/systemd/system/
    
    // 设置 docker.service 文件权限
    chmod +x /etc/systemd/system/docker.service
    
    // 重新加载配置文件
    systemctl daemon-reload
    
    // 启动docker
    systemctl start docker
    
    // 设置 docker 开机自启
    systemctl enable docker.service
    
    // 验证docker是否安装成功
    docker -v
    
    // 验证docker-compose是否安装成功
    docker-compose -v
    

4 docker常用命令
============

4.1 镜像相关命令
----------

创建容器的基础。

命令

说明

`docker images`

列出本地所有镜像

`docker search <镜像名>`

从 Docker Hub 搜索镜像

`docker pull <镜像名>[:标签]`

下载镜像（不指定标签则默认为 `latest`）

`docker rmi <镜像ID或名>`

删除**一个**本地镜像

`docker rmi $(docker images -q)`

删除**所有**本地镜像

`docker image prune`

删除所有未被使用的镜像（悬空镜像）

`docker build -t <镜像名>[:标签] .`

根据当前目录的 Dockerfile 构建镜像

`docker history <镜像名>`

查看镜像的构建历史层

`docker tag <旧镜像名> <新镜像名>`

给镜像打一个新的标签

**示例：**

    docker pull nginx:alpine
    docker images
    docker rmi 5dbe117b5cf4
    docker build -t my-app:v1 .
    

4.2 容器生命周期管理
------------

用于创建、启动、停止、删除容器。

命令

说明

`docker run [选项] <镜像名>`

**创建并启动**一个新容器

`docker create <镜像名>`

只创建容器，但不启动

`docker start <容器ID或名>`

启动一个已存在的容器

`docker stop <容器ID或名>`

**优雅地停止**一个运行中的容器

`docker restart <容器ID或名>`

重启容器

`docker kill <容器ID或名>`

**强制立即停止**一个容器

`docker pause <容器ID或名>`

暂停容器内的所有进程

`docker unpause <容器ID或名>`

恢复容器内被暂停的进程

`docker rm <容器ID或名>`

删除**一个已停止**的容器

`docker rm $(docker ps -aq)`

删除**所有已停止**的容器

`docker container prune`

删除所有已停止的容器

**`docker run` 常用选项：**

*   `-d`：后台运行（守护进程）
*   `-it`：交互模式运行（通常与 `/bin/bash` 结合）
*   `--name`：为容器指定一个名称
*   `-p <主机端口>:<容器端口>`：映射端口
*   `-v <主机目录>:<容器目录>`：挂载数据卷
*   `--rm`：容器退出时自动删除（用于测试）
*   `-e`：设置环境变量

**示例：**

    # 后台运行一个名为 my-nginx 的容器，并映射端口
    docker run -d --name my-nginx -p 80:80 nginx
    
    # 交互式运行一个 Ubuntu 容器，并进入其终端
    docker run -it ubuntu /bin/bash
    
    # 运行一个一次性容器，退出后自动删除
    docker run --rm -it alpine /bin/sh
    

4.3 容器信息查看与操作
-------------

用于查看和与正在运行的容器交互。

命令

说明

`docker ps`

列出**正在运行**的容器

`docker ps -a`

列出**所有**容器（包括已停止的）

`docker logs <容器ID或名>`

查看容器的日志输出

`docker logs -f <容器ID或名>`

**实时跟踪**（Follow）容器日志

`docker exec -it <容器ID或名> <命令>`

在**正在运行**的容器中执行命令

`docker attach <容器ID或名>`

连接到正在运行的容器的主进程（不推荐，容易导致容器停止）

`docker top <容器ID或名>`

查看容器内运行的进程

`docker inspect <容器ID或名>`

查看容器的底层详细信息（JSON格式）

`docker stats`

动态显示所有容器的资源使用情况（CPU、内存等）

`docker diff <容器ID或名>`

检查容器文件系统相对于镜像的更改

**示例：**

    docker ps -a
    docker logs -f my-nginx
    docker exec -it my-nginx /bin/bash  # 进入容器的 Shell
    docker inspect my-nginx | grep IPAddress  # 查看容器的 IP 地址
    

4.4 数据卷与网络管理
------------

用于管理容器的持久化数据和网络连接。

命令

说明

`docker volume ls`

列出所有数据卷

`docker volume create <卷名>`

创建一个数据卷

`docker volume inspect <卷名>`

查看数据卷的详细信息

`docker volume rm <卷名>`

删除一个数据卷

`docker volume prune`

删除所有未被使用的数据卷

`docker network ls`

列出所有网络

`docker network create <网络名>`

创建一个自定义网络

`docker network connect <网络名> <容器名>`

将容器连接到指定网络

`docker network inspect <网络名>`

查看网络的详细信息

**示例：**

    # 创建一个数据卷，并运行一个使用该卷的容器
    docker volume create my-data
    docker run -v my-data:/data --name data-container alpine
    
    # 创建一个自定义的桥接网络，让容器间可以通过容器名通信
    docker network create my-app-network
    docker run -d --name mysql --network my-app-network mysql
    docker run -d --name webapp --network my-app-network my-web-app
    

* * *

4.5 Docker Compose 常用命令
-----------------------

用于管理和运行多容器应用。

命令

说明

`docker-compose up`

创建并启动所有服务（在前台运行）

`docker-compose up -d`

创建并启动所有服务（在后台运行）

`docker-compose down`

**停止并删除**所有容器、网络

`docker-compose stop`

停止所有服务，但不删除容器

`docker-compose start`

启动已存在的服务

`docker-compose restart`

重启所有服务

`docker-compose ps`

列出 Compose 文件定义的所有容器

`docker-compose logs`

查看所有服务的日志

`docker-compose logs -f <服务名>`

实时跟踪特定服务的日志

`docker-compose exec <服务名> <命令>`

在指定的服务容器中执行命令

`docker-compose build`

构建或重新构建服务镜像

`docker-compose pull`

下载服务镜像

5 参考
====

> [https://blog.csdn.net/qq\_23845083/article/details/130768859](https://blog.csdn.net/qq_23845083/article/details/130768859)