---
layout: post
title: 'PriorityQueue æ•°æ®ç»“æ„åº•å±‚åŸç†ã€æºç å®ç°å¯è§†åŒ–åˆ†æåŠåº”ç”¨å®æˆ˜'
date: "2025-09-01T00:49:24Z"
---
PriorityQueue æ•°æ®ç»“æ„åº•å±‚åŸç†ã€æºç å®ç°å¯è§†åŒ–åˆ†æåŠåº”ç”¨å®æˆ˜
=====================================

> æœ¬æ–‡å°†ä»**æ•°æ®ç»“æ„åº•å±‚åŸç† + æºç å®ç° + åº”ç”¨å®æˆ˜**ä¸‰æ–¹é¢æ·±å…¥å‰–æ `PriorityQueue`ï¼Œè®©ä½ çœŸæ­£æŒæ¡ä¼˜å…ˆé˜Ÿåˆ—çš„åº•å±‚é€»è¾‘åŠå…¶åº”ç”¨ã€‚
> 
> æºç å¯è§†åŒ–è§†é¢‘ï¼š[https://www.bilibili.com/video/BV12Ha5zjEcS/](https://www.bilibili.com/video/BV12Ha5zjEcS/)

åœ¨ç©æ¸¸æˆçš„æ—¶å€™ï¼Œå‘ç°éœ€è¦è´­ä¹°çš„è£…å¤‡å¾ˆå¤šï¼Œè€Œä¸”ä¸åŒçš„è‹±é›„éœ€è¦è´­ä¹°çš„è£…å¤‡è¿˜ä¸ä¸€æ ·ï¼Œæ‰“æ¸¸æˆçš„æ—¶å€™éœ€è¦æ›´å¤šç²¾åŠ›å»å…³æ³¨ä¹°ä»€ä¹ˆè£…å¤‡æ‰è¡Œã€‚è¿™å¤šå°‘å½±å“æ¸¸æˆä½“éªŒï¼Œç‰¹åˆ«æ˜¯æˆ‘è¿™ç§å°ç™½ï¼Œæ‰“å¼€è£…å¤‡æ æŒ‘äº†åŠå¤©æ²¡æ‰¾åˆ°è‡ªå·±è¦ä¹°çš„ï¼Œç„¶åå°±å˜äº†^ã€‚æ¸¸æˆéš¾åº¦å¤ªå¤§ï¼ˆä½“éªŒå¤ªå·®ï¼‰ç©ä¸æ¥ï¼Œå¸è½½äº†å§ã€‚

å¦‚æœå¼€å§‹æ¸¸æˆå‰å°±å…ˆé…ç½®å¥½æˆ‘è¦ç©çš„è‹±é›„çš„è£…å¤‡è´­ä¹°é¡ºåºï¼Œé‚£å²‚ä¸ç¾å“‰ã€‚æ‰“æ¸¸æˆçš„æ—¶å€™ï¼Œæ¸¸æˆè‡ªåŠ¨æç¤ºä½ è¦è´­ä¹°çš„è£…å¤‡ï¼Œç›´åˆ°ä½ å…¨éƒ¨è£…å¤‡éƒ½ä¹°å¥½äº†ã€‚

é€šè¿‡`PriorityQueue`ä¾¿å¯è½»æ¾å®ç°ä¸Šé¢æƒ³è¦çš„åŠŸèƒ½ã€‚

> å¼€å§‹æ¸¸æˆå‰**é…ç½®è£…å¤‡ä¼˜å…ˆçº§**çš„è¿‡ç¨‹ä¸ºï¼š**å…¥é˜Ÿæ“ä½œ**è¿‡ç¨‹ï¼›
> 
> æ‰“æ¸¸æˆæç¤º**è´­ä¹°è£…å¤‡é¡ºåº**çš„è¿‡ç¨‹ä¸ºï¼š**å‡ºé˜Ÿæ“ä½œ**è¿‡ç¨‹ã€‚

æ–‡ä¸­å®æˆ˜éƒ¨åˆ†ä¼šè®²åˆ°è¿™ä¸ªæ¡ˆä¾‹å¦‚ä½•å®ç°ï¼Œæˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„æ˜¯ä»€ä¹ˆå¼€å§‹ã€‚

ğŸš€ 1. æ¦‚è¿°
--------

### 1.1. PriorityQueue æ˜¯ä»€ä¹ˆï¼Ÿ

`PriorityQueue` æ˜¯ä¸€ä¸ª **ä¼˜å…ˆçº§çš„é˜Ÿåˆ—**ï¼Œå…ƒç´ æŒ‰**ä¼˜å…ˆçº§**ä»å°åˆ°å¤§**æ’åˆ—**ï¼ˆé»˜è®¤ä½¿ç”¨è‡ªç„¶é¡ºåºï¼Œä¹Ÿå¯ä»¥ä¼ å…¥æ¯”è¾ƒå™¨ Comparatorï¼‰ã€‚

å®ƒ**å¹¶ä¸ä¿è¯ FIFO é¡ºåº**ï¼Œä¹Ÿ**ä¸ä¿è¯æ•´ä¸ªé˜Ÿåˆ—æœ‰åº**ï¼Œè€Œæ˜¯æ¯æ¬¡å‡ºé˜Ÿæ—¶è¿”å›å½“å‰ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚è¯´ç™½äº†ï¼Œä»…ä¿è¯æ¯æ¬¡å‡ºé˜Ÿçš„å…ƒç´ æ˜¯æœ€å¤§å€¼æˆ–æœ€å°å€¼ï¼Œé»˜è®¤æ˜¯æœ€å°å€¼ã€‚

### 1.2. åº•å±‚æ•°æ®ç»“æ„

`PriorityQueue` ä½¿ç”¨ä¸€ä¸ª**åŠ¨æ€æ•°ç»„**æ¥ç»´æŠ¤æ•°æ®ï¼Œåº•å±‚å¤„ç†é€»è¾‘ä¸º**äºŒå‰å †**ï¼Œé»˜è®¤ä¸º**å°é¡¶å †**ã€‚

å­¦ä¹ `PriorityQueue`åº•å±‚åŸç†ï¼Œå°±æ˜¯å­¦ä¹ æ€ä¹ˆ**åº”ç”¨äºŒå‰å †å®ç°ä¼˜å…ˆé˜Ÿåˆ—**ã€‚

äºŒå‰å †ä¸ºå®Œå…¨äºŒå‰æ ‘ï¼ŒæŒ‰ç…§**ä»ä¸Šåˆ°ä¸‹ã€ä»å·¦åˆ°å³**çš„é¡ºåºè¿›è¡Œå…¥å †ï¼Œå¹¶ä¸”ä»…æœ‰æœ€åº•å±‚å¯èƒ½æ²¡æœ‰å¡«æ»¡ã€‚

å‡è®¾å½“å‰å †å¦‚ä¸‹ï¼ˆ`PriorityQueue` æ•°ç»„ä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ï¼š

![PriorityQueueå±‚æ¬¡éå†](https://img2024.cnblogs.com/blog/1209017/202508/1209017-20250831230417102-1258248651.jpg)

åœ¨æ•°ç»„ä¸­çš„ä¿å­˜é¡ºåºä¸ºäºŒå‰æ ‘çš„**å±‚åºéå†**é¡ºåºï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä»ä¸Šåˆ°ä¸‹ã€ä»å·¦åˆ°å³ä¸€ä¸ªä¸ªéå†ã€‚

æ‰€ä»¥åœ¨æ•°ç»„è¡¨ç¤ºä¸ºï¼š`[1, 3, 5, 7, 9]`

### 1.3. äºŒå‰å †çš„è§„å¾‹

è¿™äº›è§„å¾‹å°†å†³å®šä½ çš„ä»£ç æ€ä¹ˆå»å®ç°ã€‚

`PriorityQueue`çš„ä¸‹æ ‡`i`æ˜¯ä»`0` å¼€å§‹è®¡ç®—çš„ï¼Œä»¥ä¸‹å…¬å¼ä¹Ÿæ˜¯åŸºäº`i=0`æ‰æˆç«‹çš„ã€‚

**è§„å¾‹1ï¼Œæ ¹æ®çˆ¶èŠ‚ç‚¹è®¡ç®—å­èŠ‚ç‚¹**ï¼šçˆ¶èŠ‚ç‚¹ä¸‹æ ‡ `i`ï¼Œé‚£ä¹ˆå·¦å­èŠ‚ç‚¹å°±ä¸º `2*i+1`ï¼Œå³å­èŠ‚ç‚¹ä¸º `2*i+2`ã€‚

åè¿‡æ¥ï¼Œå¦‚æœå·¦å­èŠ‚ç‚¹ä¸º`i`ï¼Œé‚£ä¹ˆçˆ¶èŠ‚ç‚¹ä¸º`(i-1)/2`ï¼›å¦‚æœå³å­èŠ‚ç‚¹ä¸º`i`ï¼Œé‚£ä¹ˆçˆ¶èŠ‚ç‚¹ä¸º`(i-2)/2`;

è®¡ç®—çˆ¶ç»“ç‚¹ä¸€å®šè¦ä¸¤ä¸ªå…¬å¼ï¼Ÿï¼Ÿ

å·¦å³èŠ‚ç‚¹ç›¸å·®`1`ï¼Œå¿…ç„¶ä¼šæœ‰ä¸€ä¸ªæ˜¯**ä¸èƒ½æ•´é™¤**ã€‚

æ¯”å¦‚ï¼šå·¦èŠ‚ç‚¹`i=1`,é‚£ä¹ˆå³èŠ‚ç‚¹å¿…ä¸º`i=2`ï¼Œçˆ¶èŠ‚ç‚¹ä¸º`0`ã€‚

å¦‚æœä½¿ç”¨å…¬å¼`(i-1)/2`ï¼Œé‚£ä¹ˆå·¦èŠ‚ç‚¹è®¡ç®—ç»“æœä¸º`0`ï¼Œå³èŠ‚ç‚¹è®¡ç®—ä¸º`0.5`ï¼Œåªéœ€è¦å‘ä¸‹å–æ•´å³å¯ã€‚

å¦‚æœä½¿ç”¨å…¬å¼`(i-2)/2`ï¼Œé‚£ä¹ˆå·¦èŠ‚ç‚¹è®¡ç®—ç»“æœä¸º`-0.5`ï¼Œå³èŠ‚ç‚¹è®¡ç®—ä¸º`0`ï¼Œå‘ç°æ€ä¹ˆå–æ•´éƒ½ä¸å¯ä»¥ã€‚

**è§„å¾‹2ï¼Œæ ¹æ®å­èŠ‚ç‚¹è®¡ç®—çˆ¶èŠ‚ç‚¹**ï¼šä½¿ç”¨å…¬å¼`(i-1)/2`è®¡ç®—å¹¶å‘ä¸‹å–æ•´å³å¯ã€‚

**è§„å¾‹3**ï¼Œ**å°é¡¶å †/æœ€å°å †**çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ¯”å®ƒçš„å­èŠ‚ç‚¹å°ï¼›**å¤§é¡¶å †/æœ€å¤§å †**çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ¯”å®ƒçš„å­èŠ‚ç‚¹å¤§ã€‚

![PriorityQueueè§„å¾‹](https://img2024.cnblogs.com/blog/1209017/202508/1209017-20250831230432496-1008503043.jpg)

âš™ï¸ 2. å…¥é˜Ÿç›¸å…³æ“ä½œ
------------

ä¸Šé¢çš„è§„å¾‹å¦‚æœæ˜ç™½äº†ï¼Œé‚£ä¸‹é¢çš„æºç å°±å¾ˆå¥½æ˜ç™½äº†ã€‚

### 2.1. å…¥é˜Ÿæ“ä½œ

å…ˆæ˜ç¡®çŸ¥é“ï¼Œæ’å…¥èŠ‚ç‚¹çš„å…¥å †é¡ºåºæ˜¯æŒ‰ç…§å±‚åºéå†**ä»ä¸Šåˆ°ä¸‹ã€ä»å·¦åˆ°å³**ï¼Œå°±åƒä½ å†™ä½œæ–‡ä¸€æ ·ä»å·¦åˆ°å³â¡ï¼Œä»ä¸Šåˆ°ä¸‹â¬‡åœ°ç¼–å†™ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡éƒ½æ”¾åœ¨æ•°ç»„å…ƒç´ çš„æœ«ç«¯ã€‚

å†ç»“åˆå°é¡¶å †è§„å¾‹å’ŒäºŒå‰å †çš„è®¡ç®—å…¬å¼ï¼š**ç”±å­å¾—çˆ¶**çš„ç®€å•è®¡ç®—å…¬å¼ã€‚

æ¶‰åŠçš„å…³é”®æºç ï¼š`offer(e)` å’Œ `siftUp`ã€‚

    // å…¥é˜Ÿæ“ä½œ
    public boolean offer(E e) {
    	if (e == null)
    		throw new NullPointerException();
    	modCount++;
    	int i = size;
        // å®¹é‡æ»¡åæ‰æ‰©å®¹
    	if (i >= queue.length)
    		grow(i + 1);
    	size = i + 1;
    	if (i == 0)
    		queue[0] = e;
    	else
    		siftUp(i, e);
    	return true;
    }
    // siftUp ä¸Šæµ®
    private void siftUp(int k, E x) {
    	if (comparator != null)
    		// ä½¿ç”¨äº†è‡ªå®šä¹‰æ¯”è¾ƒå™¨
    		siftUpUsingComparator(k, x);
    	else
    		// ä½¿ç”¨ç±»ä¸­çš„æ¯”è¾ƒå™¨
    		siftUpComparable(k, x);
    }
    // siftUp æºç é€»è¾‘ï¼ˆæœ‰ Comparator æ—¶ï¼‰
    private void siftUpUsingComparator(int k, E x) {
    	while (k > 0) {
    		// ç”±å­èŠ‚ç‚¹ è®¡ç®—å‡º çˆ¶èŠ‚ç‚¹æ•°ç»„ç´¢å¼•
    		int parent = (k - 1) >>> 1;
    		// è·å–çˆ¶èŠ‚ç‚¹å¯¹è±¡
    		Object e = queue[parent];
    		// æ¯”è¾ƒå¤§å°ï¼šå„¿å­>=çˆ¶äº² å°±æ²¡å¾—ç©äº†
    		if (comparator.compare(x, (E) e) >= 0)
    			break;
    		// å„¿å­ä½ä½è¿˜å°ï¼Œç»§ç»­ä¸Šä½ï¼ŒæŠŠè€çˆ¶äº²æ¢ä¸‹å»
    		queue[k] = e;
    		// æ›´æ–°ç´¢å¼•ï¼Œç»§ç»­æ¯”è¾ƒ
    		k = parent;
    	}
    	// æœ€ç»ˆçœ‹å®åŠ›ä¸Šä½åˆ° k ä½ç½®ï¼Œåå¥½
    	queue[k] = x;
    }
    

ä½¿ç”¨äº†**è§„å¾‹2**ï¼ˆå…¬å¼`(i-1)/2`è®¡ç®—ï¼Œå¹¶å‘ä¸‹å–æ•´ï¼‰ï¼Œæ ¹æ®å­èŠ‚ç‚¹è®¡ç®—çˆ¶èŠ‚ç‚¹ç´¢å¼•ã€‚

ä½†æºç çš„è®¡ç®—å…¬å¼ä¸ºï¼š`parent = (k - 1) >>> 1`ã€‚

æºç é‡‡ç”¨**æ— ç¬¦å·å³ç§»ä¸€ä½**ï¼Œç›¸å½“äº**é™¤äº2**ï¼Œä½†ä½ç§»è¿ç®—ä½™æ•°ä¸ä¼šè¢«ä¿å­˜ï¼Œä¹Ÿå°±æ— éœ€å‘ä¸‹å–æ•´

æ¯”å¦‚ï¼š`k=4`ï¼Œé‚£ä¹ˆ`k-1=3`ï¼Œ3 çš„äºŒè¿›åˆ¶ä¸º`11`ï¼Œå³ç§»ä¸€ä½å˜ä¸º`1`ã€‚

**ä½ç§»è¿ç®—åªä¼šæœ‰æ•´æ•°éƒ¨åˆ†å‚ä¸è¿ç®—ï¼Œç»“æœä¹Ÿåªä¼šæœ‰æ•´æ•°éƒ¨åˆ†ã€‚**

**å…¥é˜Ÿæ“ä½œåŠ¨å›¾**ï¼š

![å…¥é˜Ÿæ“ä½œ](https://img2024.cnblogs.com/blog/1209017/202508/1209017-20250831230453973-1911214891.gif)

### 2.2. æ‰©å®¹æ“ä½œ

åº•å±‚æ•°æ®ç»“æ„ä¸ºæ•°ç»„ï¼Œæ‰©å®¹æ“ä½œè·Ÿ`ArrayList` åŸºæœ¬ä¸€è‡´ã€‚

æ‰©å®¹æ“ä½œå¾ˆç®€å•ï¼Œä¸»è¦åˆ†ä¸ºä¸¤æ­¥ï¼š**è®¡ç®—æ–°å®¹é‡**å’Œ**å…ƒç´ æ‹·è´**ã€‚

`Priority`å’Œ`ArrayList`çš„æ‰©å®¹ä¸»è¦åŒºåˆ«ä¸ºï¼šå®¹é‡è®¡ç®—æœ‰ä¸€ç‚¹ç‚¹å·®å¼‚ã€‚

åœ¨å®¹é‡å°äº64å‰ï¼Œ`Priority` æ‰©å®¹çš„æ–°å®¹é‡ä¸ºï¼š**ç¿»å€+2**ï¼›åé¢çš„æ‰©å®¹éƒ½ä¸€è‡´ä¸ºï¼š**å¢åŠ  50%å®¹é‡**ã€‚å¢é•¿é‡ = `oldCapacity >> 1`ï¼Œå³ `oldCapacity/2`ï¼ˆå‘ä¸‹å–æ•´ï¼‰ã€‚

å…·ä½“æºç å¦‚ä¸‹ï¼š

    // æ‰©å®¹
    private void grow(int minCapacity) {
    	int oldCapacity = queue.length;
    	// è®¡ç®—æ–°å®¹é‡
    	int newCapacity = oldCapacity + ((oldCapacity < 64) ?
    									 (oldCapacity + 2) :
    									 (oldCapacity >> 1));
    	// é˜²æ­¢æº¢å‡º
    	if (newCapacity - MAX_ARRAY_SIZE > 0)
    		newCapacity = hugeCapacity(minCapacity);
    	// æ‹·è´å…ƒç´ åˆ°æ–°æ•°ç»„
    	queue = Arrays.copyOf(queue, newCapacity);
    }
    // é˜²æ­¢æº¢å‡º
    private static int hugeCapacity(int minCapacity) {
    	if (minCapacity < 0) // overflow
    		throw new OutOfMemoryError();
    	return (minCapacity > MAX_ARRAY_SIZE) ?
    		Integer.MAX_VALUE :
    		MAX_ARRAY_SIZE;
    }
    

ğŸ—‘ 3. å‡ºé˜Ÿæ“ä½œ
----------

å‡ºé˜Ÿæ“ä½œåˆ†ä¸ºä¸‰æ­¥ï¼š**å–**å †é¡¶ï¼Œ**æ›¿**å †é¡¶ï¼Œæ²‰å †é¡¶

**å–å‡º**å †çš„æ ¹èŠ‚ç‚¹--**å †é¡¶**ï¼Œå³æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›

ç„¶åç”¨æœ€åä¸€ä¸ªèŠ‚ç‚¹**æ›¿ä»£å †é¡¶**ï¼›

å †é¡¶ä¸‹æ²‰æ“ä½œï¼Œæœ€åå–å·¦å³å­èŠ‚ç‚¹æœ€å°çš„è·Ÿçˆ¶èŠ‚ç‚¹æ¯”è¾ƒï¼Œçˆ¶å¤§äºå­ï¼Œåˆ™äº¤æ¢èŠ‚ç‚¹ï¼Œå®Œæˆå †é¡¶ä¸‹æ²‰ã€‚

å…·ä½“æºç å¦‚ä¸‹ï¼š

    // å‡ºé˜Ÿæ“ä½œ
    public E poll() {
    	if (size == 0)
    		return null;
    	int s = --size;
    	modCount++;
    	// å–å‡ºå †é¡¶
    	E result = (E) queue[0];
    	// ç”¨æœ€åä¸€ä¸ªå…ƒç´ æ›¿ä»£å †é¡¶
    	E x = (E) queue[s];
    	// ç§»é™¤æœ€åä¸€ä¸ªèŠ‚ç‚¹
    	queue[s] = null;
    	if (s != 0)
    		// æ›¿ä»£å †é¡¶èŠ‚ç‚¹ä¸‹æ²‰
    		siftDown(0, x);
    	return result;
    }
    // ä¸‹æ²‰æ¢å¤å †ç»“æ„
    private void siftDown(int k, E x) {
    	if (comparator != null)
    		siftDownUsingComparator(k, x);
    	else
    		siftDownComparable(k, x);
    }
    // ä¸‹æ²‰è°ƒæ•´æ¢å¤å †ç»“æ„
    private void siftDownUsingComparator(int k, E x) {
    	// å¤§å°é™¤äº2ï¼Œhalf ä¸ºç¬¬ä¸€ä¸ª å¶ å­ èŠ‚ç‚¹
    	int half = size >>> 1;
    	// k ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œæ‰éœ€è¦ä¸Šæµ®
    	while (k < half) {
    		// ç”±çˆ¶å¾—å­ï¼šæ­¤ä¸ºå·¦èŠ‚ç‚¹å…¬å¼
    		int child = (k << 1) + 1;
    		Object c = queue[child];
    		// å·¦åŠ ä¸€ï¼Œå¾—å³èŠ‚ç‚¹ç´¢å¼•
    		int right = child + 1;
    		// å·¦å³èŠ‚ç‚¹æ¯”è¾ƒï¼Œå–å°çš„èŠ‚ç‚¹
    		if (right < size &&
    			comparator.compare((E) c, (E) queue[right]) > 0)
    			c = queue[child = right];
    		// å°å„¿å­å’Œå†’ç‰Œé¡¶æ›¿çš„çˆ¶äº²æ¯”è¾ƒ
    		if (comparator.compare(x, (E) c) <= 0)
    			break;
    		// ä¸‹æ²‰äº¤æ¢
    		queue[k] = c;
    		k = child;
    	}
    	// ä¿å­˜åˆ°åˆé€‚çš„ä½ç½®
    	queue[k] = x;
    }
    

PriorityQueue å°±æ˜¯é€šè¿‡å‡ºé˜Ÿçš„æ–¹å¼å®ç°ä¼˜å…ˆçº§çš„ã€‚å®ƒå¯ä»¥åªå‡ºé˜Ÿä¸€éƒ¨åˆ†ï¼Œå®Œæˆéƒ¨åˆ†ä¼˜å…ˆçº§æ“ä½œï¼›ä¹Ÿå¯ä»¥å…¨éƒ¨éƒ½å‡ºé˜Ÿï¼Œæ­¤æ—¶å‡ºé˜Ÿç»“æœä¾¿æ˜¯å †æ’åºç»“æœã€‚

è®¤çœŸçœ‹ä¸‹æºç ï¼Œæœ‰æ²¡æœ‰å‘ç°ä»€ä¹ˆç«¯å€ªï¼Ÿï¼Ÿ

**ä¸ºä»€ä¹ˆå¾ªç¯æ¡ä»¶æ˜¯`while (k < half)` ï¼Ÿ**

å› ä¸ºæ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½æ²¡æœ‰å­©å­ï¼Œä¹Ÿå°±æ²¡æœ‰å¯ä»¥åœ¨ä¸‹æ²‰å¯è¯´äº†ã€‚

**å‡ºé˜Ÿæ“ä½œåŠ¨å›¾**ï¼š

![å‡ºé˜Ÿæ“ä½œ](https://img2024.cnblogs.com/blog/1209017/202508/1209017-20250831230533424-560852651.gif)

ğŸ—ï¸ 4. æ‰¹é‡å»ºå †ï¼ˆheapifyï¼‰
--------------------

ç°åœ¨æœ‰nä¸ªå…ƒç´ ï¼Œé€šè¿‡å…¥é˜Ÿæ“ä½œï¼Œä¸€ä¸ªä¸ªæ”¾å…¥æ•°ç»„ä¸­ï¼Œå•ä¸ªå…ƒç´ æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º`O(logn)`ï¼Œn ä¸ªå…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å°±å˜ä¸º`O(n*logn)`ã€‚

ç°åœ¨æœ‰ä¸ªæ›´é«˜æ•ˆçš„æ–¹å¼ï¼š**æ‰¹é‡å»ºå †**ã€‚å½“å·²æœ‰ä¸€æ•´ä¸ªæ•°ç»„æ—¶ï¼Œé‡‡ç”¨ä¸€æ¬¡å»ºå †ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º`O(n)`

æ‰¹é‡å»ºå †å°±åƒç›–æˆ¿å­ä¸€æ ·ï¼Œä»åœ°åŸºå¼€å§‹ï¼Œä¸€å±‚ä¸€å±‚çš„æ­å»ºå¥½ã€‚

æ‰¹é‡å»ºå †çš„**æ•´ä½“è¿‡ç¨‹**ï¼šè‡ªåº•å‘ä¸Šã€é€å±‚å»ºå †

**è¯¦ç»†çš„å¤„ç†è¿‡ç¨‹**ä¸ºï¼š

1.  å…ˆå°†å…ƒç´ ç›´æ¥å…¨éƒ¨æ‹·è´åˆ°æ•°ç»„
2.  å†ä»æœ€åä¸€ä¸ª**éå¶å­èŠ‚ç‚¹**å¼€å§‹é€†å±‚åºéå†å»ºå †ï¼Œ
3.  å¯¹æ¯ä¸ªå­æ ‘çš„å †é¡¶èŠ‚ç‚¹åšä¸‹æ²‰æ“ä½œï¼Œä¿è¯å…¶å­æ ‘æ»¡è¶³å°é¡¶å †ç‰¹æ€§

å½“é€šè¿‡å¸¦åˆå§‹é›†åˆçš„æ„é€ å™¨åˆ›å»º `PriorityQueue` æ—¶ï¼Œä¼šæ‰§è¡Œä¸€æ¬¡ **æ‰¹é‡å»ºå †**ï¼Œå…¶æ ¸å¿ƒä»£ç åœ¨æ„é€ å™¨æœ«å°¾è°ƒç”¨ï¼š

    public PriorityQueue(Collection<? extends E> c) {
        // â€¦ å°† c.toArray() å¡«å……åˆ° queue[]
        this.size = queue.length;
        heapify();
    }
    

### 4.1. heapify æºç é€»è¾‘

    private void heapify() {
        int n = size;
        // ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å‘ä¸‹è°ƒæ•´
        for (int i = (n >>> 1) - 1; i >= 0; i--) {
            siftDown(i, (E) queue[i]);
        }
    }
    

è¿™æºç å¯èƒ½çœ‹å¾—æœ‰ç‚¹è´¹åŠ²ï¼Œè¿™æ ·å¯èƒ½æ¸…æ™°ç‚¹

    private void heapify() {
        // æ‰¾åˆ°æœ€åä¸€ä¸ªéå¶èŠ‚ç‚¹
        int lastParent = (size >>> 1) - 1;
        // ä»è¿™ä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œå¾€å‰éå†åˆ°æ ¹èŠ‚ç‚¹
        for (int i = lastParent; i >= 0; i--) {
            // æŠŠ queue[i] â€œä¸‹æ²‰â€åˆ°å®ƒåœ¨å­æ ‘ä¸­æ­£ç¡®çš„ä½ç½®
            siftDown(i, (E) queue[i]);
        }
    }
    

**å¼€å§‹ä½ç½®**ï¼šç”±å®Œå…¨äºŒå‰æ ‘äºŒå‰å †çš„ç‰¹æ€§ï¼Œå¯çŸ¥æœ€åä¸€ä¸ª**éå¶å­èŠ‚ç‚¹**ä¸‹æ ‡ä¸º `(size >>> 1) - 1`ï¼Œè¿™ä¸ªç´¢å¼•å¾€åçš„èŠ‚ç‚¹éƒ½æ˜¯å¶å­èŠ‚ç‚¹ï¼Œæ— éœ€è°ƒæ•´ã€‚

**å»ºå †è¿‡ç¨‹**ï¼šå¯¹æ¯ä¸ªèŠ‚ç‚¹è°ƒç”¨ `siftDown`ï¼Œä¿è¯å…¶å­æ ‘æ»¡è¶³æœ€å°å †æ€§è´¨

**å»ºå †ç´¢å¼•é¡ºåºå›¾**ï¼š

![PriorityQueueå»ºå †ç´¢å¼•ç§»åŠ¨é¡ºåº](https://img2024.cnblogs.com/blog/1209017/202508/1209017-20250831230555083-1490702394.jpg)

é»„è‰²ä¸‰è§’å½¢å†…åªéœ€è¦ä¸€æ¬¡è°ƒå¹³å°±å¯å®Œæˆï¼Œç„¶åç»§ç»­**å¾€ä¸Šé€å±‚è°ƒæ•´**ï¼š

![PriorityQueueå»ºå †è°ƒå¹³1](https://img2024.cnblogs.com/blog/1209017/202508/1209017-20250831230604715-200444042.jpg)

æœ€åè°ƒæ•´å®Œæˆï¼š

![PriorityQueueå»ºå †è°ƒå¹³2](https://img2024.cnblogs.com/blog/1209017/202508/1209017-20250831230614037-1132620840.jpg)

**æ•´ä¸ªå»ºå †è¿‡ç¨‹**ä¸ºï¼šä»æœ€åéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œ**è‡ªåº•å‘ä¸Šï¼Œé€ä¸ªä¸‹æ²‰è°ƒæ•´**ï¼Œç›´åˆ°å †é¡¶ã€‚

**æ‰¹é‡å»ºå †å¯è§†åŒ–**ï¼š

![æ‰¹é‡å»ºå †æ“ä½œ](https://img2024.cnblogs.com/blog/1209017/202508/1209017-20250831230640052-1719357637.gif)

å“ªå¯ä¸å¯ä»¥**ä»å †é¡¶å¼€å§‹**è°ƒæ•´ï¼Œè‡ªé¡¶å‘ä¸‹ï¼Œé€å±‚ä¸‹æ²‰è°ƒæ•´ï¼Ÿ

### 4.2. ä¸ºä»€ä¹ˆè‡ªåº•å‘ä¸Šæ›´å¿«ï¼Ÿ

å¦‚æœé‡‡ç”¨**ä»å †é¡¶å¼€å§‹**è°ƒæ•´ï¼Œè‡ªé¡¶å‘ä¸‹ï¼Œé€å±‚ä¸‹æ²‰è°ƒæ•´ä¼šæ€æ ·ï¼Ÿ

#### 4.2.1. ä¸ºä»€ä¹ˆé€‰æ‹©è‡ªåº•å‘ä¸Šã€é€å±‚ä¸‹æ²‰ï¼Ÿ

âŒ**ä»å †é¡¶å¼€å§‹**è°ƒæ•´ï¼Œè‡ªé¡¶å‘ä¸‹ï¼Œé€å±‚ä¸‹æ²‰è°ƒæ•´ã€‚å½“ä½ åœ¨ `i=0`ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰åš `siftDown` æ—¶ï¼Œ**å·¦å³å­æ ‘å°šæœªè°ƒæ•´ï¼Œå®ƒä»¬å¯èƒ½ä¸æ˜¯å †**ã€‚å°½ç®¡ä¸Šå±‚èŠ‚ç‚¹è°ƒæ•´å¥½äº†ï¼Œä¹‹åå†å»è°ƒæ•´ä¸‹å±‚èŠ‚ç‚¹æ—¶ï¼Œåˆå¯èƒ½ä¼šç ´åä½ å…ˆå‰åœ¨ä¸Šå±‚å»ºç«‹çš„å †åºæ€§ï¼Œæœ€ç»ˆå¾ˆå¯èƒ½å¾—åˆ°ä¸€ä¸ªä¸åˆæ³•çš„å †ã€‚å¦‚æœè¦ç¡®ä¿æ¯å±‚éƒ½åˆæ³•ï¼Œé‚£å°±å¾—**é‡å¤è®¡ç®—**ä¸Šå±‚å·²ç»è°ƒæ•´å¥½çš„å †ï¼Œé‡å¤è®¡ç®—å¯¼è‡´æ€§èƒ½ä½ä¸‹ã€‚

âœ…é¡ºç€ä¸è¡Œåªèƒ½â€œé€†å¤©è€Œè¡Œâ€ï¼Œ**è‡ªåº•å‘ä¸Šã€é€å±‚å»ºå †**ã€‚ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹å»ºå †ï¼Œé‚£å®ƒçš„å·¦å³å­©å­å¿…ä¸ºå¶å­èŠ‚ç‚¹ï¼Œå¶å­èŠ‚ç‚¹ç›¸å½“äºå·²ç»å»ºå¥½çš„å †ã€‚é€å±‚å¾€ä¸Šï¼Œå½“ä½ åœ¨çˆ¶èŠ‚ç‚¹ `i` ä¸Šè°ƒç”¨ `siftDown` æ—¶ï¼Œå®ƒçš„å·¦å³å­æ ‘éƒ½å·²ç»æ˜¯å †äº†ï¼ˆå› ä¸ºä½ å…ˆå¤„ç†å¥½æ›´æ·±å±‚çš„èŠ‚ç‚¹ï¼‰ã€‚è¿™æ ·ï¼Œå•æ¬¡ `siftDown` åªéœ€è¦æŠŠç¬¬ `i` ä¸ªèŠ‚ç‚¹â€œæ’å…¥â€åˆ°ä¸€ä¸ªå·²ç»æ˜¯å †çš„å­æ ‘é‡Œï¼Œæœ€ç»ˆæ•´æ£µæ ‘å°±æˆä¸ºå †ã€‚

> ç›¸å½“äºå·²ç»è®¡ç®—å¥½çš„ç»“æœï¼Œå¯ä»¥åº”ç”¨åˆ°åé¢çš„è®¡ç®—ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„é‡å¤è®¡ç®—ï¼Œå¤§å¤§æé«˜å»ºå †æ€§èƒ½ã€‚
> 
> åœ¨çº¿æ€§æ—¶é—´å†…ã€ä¸€æ­¥åˆ°ä½åœ°æŠŠæ•°ç»„â€œå †åŒ–â€

#### 4.2.2. è®¡ç®—å»ºå †æ—¶é—´å¤æ‚åº¦

**å»ºå †æ€»å·¥ä½œé‡åˆ†æè®¡ç®—ï¼š**

åœ¨æ‰¹é‡ heapify ä¸­ï¼Œåªæœ‰**éå¶èŠ‚ç‚¹**ä¼šæ‰§è¡Œä¸‹æ²‰ã€‚å®Œç¾äºŒå‰æ ‘ä¸Šå…±æœ‰çº¦ `n/2` ä¸ªéå¶èŠ‚ç‚¹ã€‚

é‚£ä¹ˆï¼Œå¯ä»¥ä¸‹æ²‰è‡³å°‘ **1 å±‚** çš„èŠ‚ç‚¹æœ€å¤šæœ‰å¤šå°‘å‘¢ï¼Ÿ

> æœ€å¤šæ˜¯æ‰€æœ‰éå¶èŠ‚ç‚¹éƒ½å¯ä»¥ä¸‹æ²‰1å±‚ï¼Œä¸€å…±`â‰¤ n/2`æ¬¡å•æ­¥ä¸‹æ²‰

å¯ä»¥ä¸‹æ²‰è‡³å°‘ **2 å±‚** çš„èŠ‚ç‚¹æœ€å¤šæœ‰å¤šå°‘ï¼Ÿ

> åªæœ‰è·å¶å­æ·±åº¦ â‰¥2 çš„èŠ‚ç‚¹ï¼Œä¸€å…± `â‰¤n/4`æ¬¡å•æ­¥ä¸‹æ²‰

å¯ä»¥ä¸‹æ²‰è‡³å°‘ **3 å±‚** çš„èŠ‚ç‚¹æ•°æœ€å¤šæœ‰å¤šå°‘ï¼Ÿ

> åªæœ‰è·å¶å­æ·±åº¦ â‰¥3 çš„èŠ‚ç‚¹ï¼Œä¸€å…± `â‰¤n/8`æ¬¡å•æ­¥ä¸‹æ²‰

...

ä¸€ç›´åˆ°å †é¡¶ï¼Œå¯èƒ½çš„æœ€å¤§ä¸‹æ²‰æ·±åº¦kå±‚ï¼Œä¸€å…± `â‰¤n/2^k`æ¬¡å•æ­¥ä¸‹æ²‰

**æ€»å•æ­¥ä¸‹æ²‰æ•°**  
æŠŠâ€œä¸‹æ²‰è‡³å°‘ k å±‚â€çš„æ‰€æœ‰å•æ­¥åŠ èµ·æ¥ï¼Œå°±æ˜¯ä¸‹æ²‰æ€»æ¬¡æ•°

![æ—¶é—´å¤æ‚åº¦è®¡ç®—](https://img2024.cnblogs.com/blog/1209017/202508/1209017-20250831230951593-1228154433.jpg)

**å…ƒç´ æ‹·è´ï¼š** å°†æ•´ä¸ªæ•°ç»„å…ƒç´ ç›´æ¥æ‹·è´åˆ°å†…éƒ¨ `queue` æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦`O(n)`ï¼›

**æœ€ç»ˆæ€»å·¥ä½œé‡**\=å…ƒç´ æ‹·è´ + å»ºå †çš„æ—¶é—´å¤æ‚åº¦=`O(n) + O(n) = O(n)`

**æ‰¹é‡å»ºå †æ—¶é—´å¤æ‚åº¦è®¡ç®—å¯è§†åŒ–ï¼š**

![æ‰¹é‡å»ºå †æ—¶é—´å¤æ‚åº¦è®¡ç®—](https://img2024.cnblogs.com/blog/1209017/202508/1209017-20250831230810145-1196529873.gif)

å¯¹æ¯”å…¥é˜Ÿå’Œå»ºå †çš„æ—¶é—´å¤æ‚åº¦ï¼š

æ–¹æ³•

æ—¶é—´å¤æ‚åº¦

ä½•æ—¶ä½¿ç”¨

**å…¥é˜Ÿï¼‹siftUp**

O(nâ€¯logâ€¯n)

åŠ¨æ€åœ°ä¸€ä¸ªä¸ªæ’å…¥å…ƒç´ 

**ä¸€æ¬¡æ€§ heapifyï¼‹siftDown**

O(n)

å·²æœ‰ä¸€æ•´ä¸ªæ•°ç»„ï¼Œä¸€æ¬¡å»ºå †

ğŸ’¡ 5. åº”ç”¨å®æˆ˜
----------

### 5.1. å°é¡¶å †

é»˜è®¤å°±æ˜¯å°é¡¶å †

    PriorityQueue<String> priorityQueue = new PriorityQueue<>();
    priorityQueue.offer("1");
    priorityQueue.offer("5");
    priorityQueue.offer("3");
    priorityQueue.offer("7");
    priorityQueue.offer("9");
    
    System.out.println(priorityQueue);
    
    priorityQueue.poll();
    
    System.out.println(priorityQueue);
    

æµ‹è¯•ç»“æœï¼š

    [1, 5, 3, 7, 9]
    [3, 5, 9, 7]
    

### 5.2. å¤§é¡¶å †

æƒ³å®ç°æœ€å¤§å †ï¼Ÿä¼ å…¥ Comparator å³å¯ï¼š

    PriorityQueue<String> maxHeap = new PriorityQueue<>(Comparator.reverseOrder());
    maxHeap.offer("1");
    maxHeap.offer("5");
    maxHeap.offer("3");
    maxHeap.offer("7");
    maxHeap.offer("9");
    System.out.println(maxHeap);
    
    maxHeap.poll();
    
    System.out.println(maxHeap);
    

æµ‹è¯•ç»“æœ

    [9, 7, 3, 1, 5]
    [7, 5, 3, 1]
    

### 5.3. æ¯”è¾ƒå™¨

å †å†…å…ƒç´ ä¸ºè‡ªå®šä¹‰å¯¹è±¡`Person`ï¼Œå®ç° **é»˜è®¤æŒ‰å¹´é¾„é™åº** æ’åºï¼ˆå³å¹´é¾„è¶Šå¤§ä¼˜å…ˆï¼‰

å…·ä½“æºç å¦‚ä¸‹ï¼š

    public class Person implements Comparable<Person>{
        private String name;
        private Integer age;
    
        public String getName() {
            return name;
        }
    
        public void setName(String name) {
            this.name = name;
        }
    
        public Integer getAge() {
            return age;
        }
    
        public void setAge(Integer age) {
            this.age = age;
        }
    
        public Person(String name, Integer age) {
            this.name = name;
            this.age = age;
        }
        @Override
        public int compareTo(Person other) {
    //        return this.age.compareTo(other.age);  // å°é¡¶å †ï¼šæŒ‰å¹´é¾„å‡åº
            // å¤§é¡¶å †ï¼šé™åºï¼šå¹´é¾„å¤§çš„æ’å‰é¢
            return other.age.compareTo(this.age);
        }
    
        @Override
        public String toString() {
            return name + " (" + age + ")";
        }
    
        public static void main(String[] args) {
            PriorityQueue<Person> personPriorityQueue = new PriorityQueue<>();
            personPriorityQueue.offer(new Person("å¼ ä¸‰",28));
            personPriorityQueue.offer(new Person("æå››",21));
            personPriorityQueue.offer(new Person("æ¸Šæ¸Ÿå²³",18));
            personPriorityQueue.offer(new Person("å’¿å‘€å‘€",19));
            System.out.println(personPriorityQueue);
        }
    
    }
    

æ‰§è¡Œç»“æœï¼š

    [å¼ ä¸‰ (28), æå›› (21), æ¸Šæ¸Ÿå²³ (18), å’¿å‘€å‘€ (19)]
    

åŒæ ·å¯ä»¥å¯¹å®ƒåš**å–å**æ“ä½œï¼Œ**å˜ä¸ºå°é¡¶å †**ï¼Œä»å°åˆ°å¤§çš„å¹´é¾„æ’åº

    PriorityQueue<Person> personPriorityQueue = new PriorityQueue<>(Comparator.reverseOrder());
    personPriorityQueue.offer(new Person("å¼ ä¸‰",28));
    personPriorityQueue.offer(new Person("æå››",21));
    personPriorityQueue.offer(new Person("æ¸Šæ¸Ÿå²³",18));
    personPriorityQueue.offer(new Person("å’¿å‘€å‘€",19));
    System.out.println(personPriorityQueue);
    

æ‰§è¡Œç»“æœï¼š

    [æ¸Šæ¸Ÿå²³ (18), å’¿å‘€å‘€ (19), æå›› (21), å¼ ä¸‰ (28)]
    

### 5.4. æ‰¾å‡ºå¹´é¾„æœ€å¤§çš„å‰ K ä¸ªäºº

æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªå…¸å‹çš„ **Top-K æœ€å¤§å¹´é¾„çš„ Person** é—®é¢˜ã€‚

**å®ç°æ€è·¯**ï¼š

ä½¿ç”¨ `PriorityQueue<Person>`ï¼Œä¿å­˜å †é¡¶ä¸ºå½“å‰ç¬¬ K å¤§çš„å…ƒç´ ï¼Œå¤§å°ä¸º Kï¼›

éå†æ‰€æœ‰å…ƒç´ ï¼šå¦‚æœå †æœªæ»¡ï¼šåŠ å…¥ï¼›å¦‚æœå †æ»¡ï¼Œä¸”å½“å‰å…ƒç´ å¹´é¾„å¤§äºå †é¡¶ï¼šæ›¿æ¢å †é¡¶ï¼›

æœ€ç»ˆå †ä¸­å°±æ˜¯ Top-K æœ€å¤§å¹´é¾„çš„ Personã€‚

å…·ä½“æºç å¦‚ä¸‹ï¼š

    public class TopKDemo {
        /**
         * è·å–æ•°ç»„ä¸­ å‰ K ä¸ªæœ€å°æˆ–æœ€å¤§çš„å…ƒç´ 
         *  è¿™é‡Œå®ç°çš„æ˜¯ å‰ K ä¸ªå¹´é¾„å¤§çš„
         */
        public static List<Person> getTopKByAge(List<Person> people, int k) {
            if (people == null)
                throw new RuntimeException("å®¶é‡Œæ²¡æœ‰äºº");
            // å°é¡¶å †ï¼šå †é¡¶æ˜¯å½“å‰ Top-K é‡Œæœ€å°å¹´é¾„çš„ï¼Œå› ä¸ºPersonç±»æ˜¯æ­£åºæ’åº
            PriorityQueue<Person> minHeap = new PriorityQueue<>(k);
    
            for (Person p : people) {
                if (minHeap.size() < k) {
                    minHeap.offer(p);
                }
                // å †æ»¡ K ä¸ªå…ƒç´ åï¼Œå–å †é¡¶åˆ¤æ–­å…ƒç´ å¤§å°
                else if (p.compareTo(minHeap.peek())>0) {
                    minHeap.poll();
                    minHeap.offer(p);
                }
            }
            // è½¬æ¢å› List
            List<Person> result = new ArrayList<>(minHeap);
            return result;
        }
    
        public static void main(String[] args) {
            // æµ‹è¯•æ•°æ®
            List<Person> people = Arrays.asList(
                    new Person("å¼ ä¸‰", 28),
                    new Person("æå››", 21),
                    new Person("æ¸Šæ¸Ÿå²³", 18),
                    new Person("å’¿å‘€å‘€", 19),
                    new Person("ç‹äº”", 33),
                    new Person("è€å…­", 33)
            );
    
            int k = 3;
            List<Person> topK = getTopKByAge(people, k);
            System.out.println("Top " + k + " æœ€è€çš„äºº:");
            topK.forEach(System.out::println);
        }
    }
    

æ‰§è¡Œç»“æœ

    Top 3 æœ€è€çš„äºº:
    å¼ ä¸‰ (28)
    ç‹äº” (33)
    è€å…­ (33)
    

è¿™é‡Œå®¹æ˜“æé”™çš„ç‚¹æ˜¯ï¼šå¤§é¡¶å †å’Œå°é¡¶å †çš„é€‰æ‹©ä¸Šã€‚

> å–å‰Kä¸ªæœ€å¤§å…ƒç´ ï¼Œå¾—é€‰ç”¨å°é¡¶å †ï¼Œè¿™æ ·æ‰èƒ½ç¡®ä¿æ¯æ¬¡æ¯”è¾ƒå¤§å°æ—¶ï¼Œéƒ½æ˜¯å’Œå †å†…æœ€å°çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå–å‡ºæœ€å°çš„ï¼Œç•™ä¸‹æœ€å¤§çš„å…ƒç´ åœ¨å †å†…ã€‚

`PriorityQueue` é€‚ç”¨äºï¼šå–æ•°ç»„å‰ K ä¸ªæœ€å°æˆ–æœ€å¤§çš„å…ƒç´ 

### 5.5. è´­ä¹°æ¸¸æˆè£…å¤‡é—®é¢˜

å…ˆå®šä¹‰ä¸€ä¸ªè´­ä¹°è£…å¤‡çš„é…ç½®å¯¹è±¡ï¼Œç”¨æ¥**ä¿æŒé…ç½®ä¼˜å…ˆçº§ä¿¡æ¯**ï¼Œè§„å®š`priority` æ•°å­—è¶Šå°ä¼˜å…ˆè´­ä¹°ã€‚

    public class EquipmentItem implements Comparable<EquipmentItem> {
        private final String name;
        private final int priority; // æ•°å­—è¶Šå°ä¼˜å…ˆè´­ä¹°
    
        public EquipmentItem(String name, int priority) {
            this.name = name;
            this.priority = priority;
        }
    
        public String getName() {
            return name;
        }
    
        @Override
        public int compareTo(EquipmentItem other) {
            return Integer.compare(this.priority, other.priority);
        }
    
        @Override
        public String toString() {
            return String.format("%s (priority=%d)", name, priority);
        }
    }
    

æ¥ç€å®Œæˆ**ç®¡ç†å•ä¸ªè‹±é›„çš„è£…å¤‡è´­ä¹°é¡ºåº**

    /**
     * ç®¡ç†å•ä¸ªè‹±é›„çš„è£…å¤‡è´­ä¹°é¡ºåº
     */
    public class HeroEquipmentPlan {
        private final String heroName;
        private final PriorityQueue<EquipmentItem> planQueue = new PriorityQueue<>();
    
        public HeroEquipmentPlan(String heroName) {
            this.heroName = heroName;
        }
    
        /**
         * é¢„å…ˆè®¾ç½®ä¸€ç³»åˆ—è£…å¤‡åŠå…¶ä¼˜å…ˆçº§
         */
        public void addItem(String itemName, int priority) {
            planQueue.offer(new EquipmentItem(itemName, priority));
            System.out.println("æ·»åŠ è£…å¤‡åˆ°è´­ä¹°è®¡åˆ’: " + itemName + "ï¼Œä¼˜å…ˆçº§ä¸ºï¼š" + priority);
        }
    
        /**
         * è·å–ä¸‹ä¸€ä¸ªæœ€ä¼˜å…ˆè´­ä¹°çš„è£…å¤‡
         */
        public EquipmentItem getNextItem() {
            EquipmentItem next = planQueue.poll();
            if (next == null) {
                System.out.println("å…¨éƒ¨è´­ä¹°å®Œæˆï¼š" + heroName);
            } else {
                System.out.println("ä¸‹ä¸€ä¸ªè´­ä¹°é¡¹ï¼š" + heroName + ": " + next);
            }
            return next;
        }
    
        /**
         * æŸ¥çœ‹å½“å‰è´­ä¹°è®¡åˆ’ï¼ˆä¸ç§»é™¤ï¼‰
         */
        public void previewPlan() {
            System.out.println("å½“å‰è´­ä¹°è®¡åˆ’ï¼š" + heroName + ":");
            planQueue.stream()
                    .sorted()
                    .forEach(item -> System.out.println("  - " + item));
        }
    
    }
    

æµ‹è¯•è£…å¤‡è´­ä¹°é¡ºåºé…ç½®ï¼Œå†è¿›è¡Œè£…å¤‡è´­ä¹°

    public class Demo{
        public static void main(String[] args) {
            // æ¸¸æˆå¼€å§‹å‰ï¼šä¸ºè‹±é›„è®¾ç½®è´­ä¹°ä¼˜å…ˆçº§
            HeroEquipmentPlan plan = new HeroEquipmentPlan("æˆ˜å£«");
            plan.addItem("é•¿å‰‘", 1);
            plan.addItem("æŠ¤ç”²", 2);
            plan.addItem("é´å­", 3);
            plan.addItem("æš´å‡»æ‰‹å¥—", 4);
            plan.addItem("å·¨äººè…°å¸¦", 5);
    
            // å¼€å±€é¢„è§ˆ
            plan.previewPlan();
    
            // æ¸¸æˆä¸­ï¼šå½“æœ‰è¶³å¤Ÿé‡‘å¸æ—¶ï¼Œä¾æ¬¡è´­ä¹°ä¸‹ä¸€ä¸ªè£…å¤‡
            EquipmentItem next;
            while ((next = plan.getNextItem()) != null) {
                // åœ¨è¿™é‡Œè°ƒç”¨æ¸¸æˆè´­ä¹°æ¥å£æˆ–æé†’ç©å®¶ï¼š
                // buyItem(next.getName());
                // æ¨¡æ‹Ÿè´­ä¹°é—´éš”
                try {
                    Thread.sleep(2000);
                } catch (InterruptedException ignored) {}
            }
    
            System.out.println("è´­ä¹°è®¡åˆ’å·²å®Œæˆï¼Œç¥æ¸¸æˆæ„‰å¿«ï¼");
        }
    }
    

**æµ‹è¯•ç»“æœ**:

    æ·»åŠ è£…å¤‡åˆ°è´­ä¹°è®¡åˆ’: é•¿å‰‘ï¼Œä¼˜å…ˆçº§ä¸ºï¼š1
    æ·»åŠ è£…å¤‡åˆ°è´­ä¹°è®¡åˆ’: æŠ¤ç”²ï¼Œä¼˜å…ˆçº§ä¸ºï¼š2
    æ·»åŠ è£…å¤‡åˆ°è´­ä¹°è®¡åˆ’: é´å­ï¼Œä¼˜å…ˆçº§ä¸ºï¼š3
    æ·»åŠ è£…å¤‡åˆ°è´­ä¹°è®¡åˆ’: æš´å‡»æ‰‹å¥—ï¼Œä¼˜å…ˆçº§ä¸ºï¼š4
    æ·»åŠ è£…å¤‡åˆ°è´­ä¹°è®¡åˆ’: å·¨äººè…°å¸¦ï¼Œä¼˜å…ˆçº§ä¸ºï¼š5
    å½“å‰è´­ä¹°è®¡åˆ’ï¼šæˆ˜å£«:
      - é•¿å‰‘ (priority=1)
      - æŠ¤ç”² (priority=2)
      - é´å­ (priority=3)
      - æš´å‡»æ‰‹å¥— (priority=4)
      - å·¨äººè…°å¸¦ (priority=5)
    ä¸‹ä¸€ä¸ªè´­ä¹°é¡¹ï¼šæˆ˜å£«: é•¿å‰‘ (priority=1)
    ä¸‹ä¸€ä¸ªè´­ä¹°é¡¹ï¼šæˆ˜å£«: æŠ¤ç”² (priority=2)
    ä¸‹ä¸€ä¸ªè´­ä¹°é¡¹ï¼šæˆ˜å£«: é´å­ (priority=3)
    ä¸‹ä¸€ä¸ªè´­ä¹°é¡¹ï¼šæˆ˜å£«: æš´å‡»æ‰‹å¥— (priority=4)
    ä¸‹ä¸€ä¸ªè´­ä¹°é¡¹ï¼šæˆ˜å£«: å·¨äººè…°å¸¦ (priority=5)
    å…¨éƒ¨è´­ä¹°å®Œæˆï¼šæˆ˜å£«
    è´­ä¹°è®¡åˆ’å·²å®Œæˆï¼Œç¥æ¸¸æˆæ„‰å¿«ï¼
    

`PriorityQueue` é€‚ç”¨äºï¼šç®¡ç†ä¼˜å…ˆçº§ä»»åŠ¡è°ƒåº¦

ğŸ“ˆ 6. æ±‡æ€»
--------

### 6.1. æ—¶é—´å¤æ‚åº¦æ±‡æ€»

æ“ä½œ

æ—¶é—´å¤æ‚åº¦

å…¥é˜Ÿ offer()

O(log n)

å‡ºé˜Ÿ poll()

O(log n)

è®¿é—® peek()

O(1)

å»ºå † heapify

O(n)

å¾ªç¯å…¥é˜Ÿå¼å»ºå †

O(n log n)

### 6.2. å¸¸è§è¯¯åŒº

è¯¯åŒº

æ­£è§£

`PriorityQueue` æ˜¯ FIFOï¼ŸâŒ

âœ… å®ƒé»˜è®¤æ˜¯æœ€å°å †ï¼Œä¼˜å…ˆå‡ºæœ€å°å…ƒç´ 

åˆ é™¤å…ƒç´ å¿«ï¼ŸâŒ

âœ… ä»…å †é¡¶æ˜¯ O(logâ€¯n)ï¼Œä»»æ„åˆ é™¤æ˜¯ O(n)

æ”¯æŒ null å…ƒç´ ï¼ŸâŒ

âœ… ä¸å…è®¸æ’å…¥ nullï¼Œä¼šæŠ›å¼‚å¸¸

æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼ŸâŒ

âœ… éœ€è¦æ‰‹åŠ¨åŠ é”æˆ–ä½¿ç”¨çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬`PriorityBlockingQueue`

ğŸ“š 7. æ€»ç»“
--------

äºŒå‰å †å°±å››å¥è¯ï¼š**æœ‰æ‰¹é‡é€‰æ‰¹é‡ï¼Œæ²¡æ‰¹é‡é€ä¸ªå»ºï¼›è·å–æœ€ä¼˜æ•°å€¼ï¼Œé‡å»ºåˆæ³•å †å½¢**ã€‚

PriorityQueue ä¼˜å…ˆé˜Ÿåˆ—å’Œæ™®é€šçš„äºŒå‰å †ä¸€æ ·ï¼Œä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šåˆå»ºå †ã€å–æœ€å€¼ã€é‡å»ºå †ã€‚å…¶ä¸­å»ºå †åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šé€ä¸ªå…¥é˜Ÿå»ºå †å’Œæ‰¹é‡å»ºå †ã€‚

`PriorityQueue` æ˜¯å»ºç«‹åœ¨**å°é¡¶å †ç»“æ„**ä¸Šçš„éçº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„ä¸ºæ•°ç»„ï¼Œæ ¸å¿ƒå¤„ç†é€»è¾‘ä¸º**äºŒå‰å †**ï¼Œé€šè¿‡ `siftUp` å’Œ `siftDown` åŠ¨æ€ç»´æŠ¤å †ç»“æ„ï¼Œé»˜è®¤æœ€å°å †ï¼Œä½†å¯ä»¥é€šè¿‡ Comparator çµæ´»å®šåˆ¶ã€‚

é€‚åˆ**ä¼˜å…ˆçº§ä»»åŠ¡è°ƒåº¦**ã€**åŠ¨æ€æœ€å€¼ç»´æŠ¤**ã€**Top-K**ç­‰åœºæ™¯ã€‚æ³¨æ„çº¿ç¨‹å®‰å…¨ä¸è¿­ä»£é¡ºåºçš„é—®é¢˜ï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹ä½¿ç”¨ `PriorityBlockingQueue`ã€‚

å¾€æœŸæ¨è
----

åˆ†ç±»

å¾€æœŸæ–‡ç« 

Javaé›†åˆåº•å±‚åŸç†å¯è§†åŒ–

[Java é›†åˆ--å¿«é€ŸæŒæ¡æ¶µç›–ä¸‰å¤§åœºæ™¯å®ç°çš„Seté›†åˆåº•å±‚åŸç†](https://mp.weixin.qq.com/s/lUWM-NBvg-xne4GdbyaysA)  
[ArrayDequeåŒç«¯é˜Ÿåˆ—--åº•å±‚åŸç†å¯è§†åŒ–](https://mp.weixin.qq.com/s/jKt7IidUNDh8N0INrqsV3A)  
[â€œå­å¼¹å¼¹å¤¹â€è£…å¼¹å’Œå‡ºå¼¹çš„æŠ½è±¡åŸç†å®æˆ˜ï¼šæŒæ¡æ ˆçš„åŸç†ä¸å®æˆ˜](https://mp.weixin.qq.com/s/KmMhSDt4DH98-pHFFkXWgg)  
[TreeMapé›†åˆ--åº•å±‚åŸç†ã€æºç é˜…è¯»åŠå®ƒåœ¨Javaé›†åˆæ¡†æ¶ä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿ](https://mp.weixin.qq.com/s/sHl-skrq5zIZihtcxfQE4g)  
[LinkedHashMapé›†åˆ--åŸç†å¯è§†åŒ–](https://mp.weixin.qq.com/s/bLNWiluCExxzsEcrPYZtBg)  
[HashMapé›†åˆ--åŸºæœ¬æ“ä½œæµç¨‹çš„æºç å¯è§†åŒ–](https://mp.weixin.qq.com/s/cbXqfEhKBn-fbR-7laMnKQ)  
[Javaé›†åˆ--HashMapåº•å±‚åŸç†å¯è§†åŒ–ï¼Œç§’æ‡‚æ‰©å®¹ã€é“¾åŒ–ã€æ ‘åŒ–](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247486835&idx=1&sn=9f61a14e91141059c95efa300266f87e&scene=21#wechat_redirect)  
[Javaé›†åˆ--ä»æœ¬è´¨å‡ºå‘ç†è§£HashMap](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247486816&idx=1&sn=81e12bd3920c4ca68afd659e93d62a41&scene=21#wechat_redirect)  
[Javaé›†åˆ--LinkedListæºç å¯è§†åŒ–](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247486793&idx=1&sn=b738749f16e5fcdad26e3874fc388444&scene=21#wechat_redirect)  
[Javaé›†åˆæºç --ArrayListçš„å¯è§†åŒ–æ“ä½œè¿‡ç¨‹](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247486763&idx=1&sn=214926d8cfaba2cada66106f26918764&scene=21#wechat_redirect)

è®¾è®¡æ¨¡å¼ç§˜ç±  
ï¼ˆå·²å…¨éƒ¨å¼€æºï¼‰

[æŒæ¡è®¾è®¡æ¨¡å¼çš„ä¸¤ä¸ªç§˜ç±](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247486720&idx=1&sn=739bdfc99dc52128f9d9eb31a70a4c03&scene=21#wechat_redirect)  
å¾€æœŸè®¾è®¡æ¨¡å¼æ–‡ç« çš„ï¼š[è®¾è®¡æ¨¡å¼](https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5NDM5NDM1NA==&action=getalbum&album_id=3572346739375538182#wechat_redirect)

è½¯ä»¶è®¾è®¡å¸ˆ

[è½¯è€ƒä¸­çº§--è½¯ä»¶è®¾è®¡å¸ˆæ¯«æ— ä¿ç•™çš„å¤‡è€ƒåˆ†äº«](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247485837&idx=1&sn=b9b17dfd252882468b8eea31012df6fc&scene=21#wechat_redirect)  
[è½¯ä»¶è®¾è®¡å¸ˆ--æ¡ˆä¾‹åˆ†æé¢˜è½»æ¾ä¸Šåˆ†ï¼Œè§£å†³ä½ çš„å¤‡è€ƒçƒ¦æ¼](https://mp.weixin.qq.com/s/_W7XYiZEzx3gP2IPKxEkSQ)  
[é€šè¿‡è½¯è€ƒåå´é¢†å–ä¸åˆ°å®ä½“è¯ä¹¦ï¼Ÿ](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247485909&idx=1&sn=e20f3b7b413310ca78f90c13305972ab&scene=21#wechat_redirect)  
[2023å¹´ä¸‹åŠå¹´è½¯è€ƒè€ƒè¯•é‡ç£…æ¶ˆæ¯](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247485873&idx=1&sn=08b58de61c716e5c57ff2fddb947f0d8&scene=21#wechat_redirect)

Javaå­¦ä¹ è·¯çº¿  
å’Œç›¸åº”èµ„æº

[Javaå…¨æ ˆå­¦ä¹ è·¯çº¿ã€å­¦ä¹ èµ„æºå’Œé¢è¯•é¢˜ä¸€æ¡é¾™](https://mp.weixin.qq.com/s?__biz=MzI5NDM5NDM1NA==&mid=2247485015&idx=1&sn=862bc2b379726b89cdb396ec0d325cc0&scene=21#wechat_redirect)

åŸåˆ›ä¸æ˜“ï¼Œè§‰å¾—è¿˜ä¸é”™çš„ï¼Œä¸‰è¿æ”¯æŒï¼šç‚¹èµã€åˆ†äº«ã€æ¨èâ†“