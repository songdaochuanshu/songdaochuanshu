---
layout: post
title: '5.A.swift ä½¿ç”¨æŒ‡å—'
date: "2025-10-27T00:44:43Z"
---
5.A.swift ä½¿ç”¨æŒ‡å—
==============

Aquarius å¼€å‘æ¡†æ¶æ—¨åœ¨å¸®åŠ©ç‹¬ç«‹å¼€å‘è€…å’Œä¸­å°å‹å›¢é˜Ÿï¼Œå®Œæˆ iOS App çš„å¿«é€Ÿå®ç°ä¸è¿­ä»£ã€‚ä½¿ç”¨æ¡†æ¶å¼€å‘å°†ç»™ä½ å¸¦æ¥ç®€å•ã€é«˜æ•ˆã€æ˜“ç»´æŠ¤çš„ç¼–ç¨‹ä½“éªŒã€‚

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Kå“¥ã€‚ä¸€åç‹¬ç«‹å¼€å‘è€…ï¼ŒåŒæ—¶ä¹Ÿæ˜¯Swiftå¼€å‘æ¡†æ¶ã€**Aquarius**ã€‘çš„ä½œè€…ï¼Œ**æ‚¦è®°**å’Œ**çˆ±å¯»è½¦**appçš„å¼€å‘è€…ã€‚

**Aquarius**å¼€å‘æ¡†æ¶æ—¨åœ¨å¸®åŠ©ç‹¬ç«‹å¼€å‘è€…å’Œä¸­å°å‹å›¢é˜Ÿï¼Œå®ŒæˆiOS Appçš„å¿«é€Ÿå®ç°ä¸è¿­ä»£ã€‚ä½¿ç”¨æ¡†æ¶å¼€å‘å°†ç»™ä½ å¸¦æ¥ç®€å•ã€é«˜æ•ˆã€æ˜“ç»´æŠ¤çš„ç¼–ç¨‹ä½“éªŒã€‚

* * *

> Aquarius æ˜¯ä¸€ä¸ªä¸º Swift å¼€å‘è€…æ‰“é€ çš„é«˜æ•ˆã€è½»é‡çº§å¼€å‘æ¡†æ¶ï¼Œè‡´åŠ›äºæä¾›ç®€æ´ç»Ÿä¸€çš„ API è®¾è®¡ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ„å»ºé«˜è´¨é‡çš„ iOS åº”ç”¨ã€‚æœ¬æ–‡å°†é‡ç‚¹ä»‹ç»å…¶æ ¸å¿ƒå·¥å…·é›† `A.swift` çš„ä½¿ç”¨æ–¹æ³•ã€‚

Aquarius æ¡†æ¶ä¸­çš„ `A.swift`ï¼ˆç®€ç§° `A`ï¼‰æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å·¥å…·ç®±ï¼Œå®ƒå°†å¸¸ç”¨çš„å¼€å‘åŠŸèƒ½å°è£…ä¸ºé™æ€æ–¹æ³•ï¼Œè¦†ç›–äº† UI æ„å»ºã€é¢œè‰²å›¾ç‰‡ã€æ•°æ®å­˜å‚¨ã€æ–‡ä»¶æ“ä½œã€äº‹ä»¶ç®¡ç†ã€æ—¥å¿—ã€å†…è´­ç­‰é«˜é¢‘åœºæ™¯ã€‚ä½¿ç”¨ `A`ï¼Œå¼€å‘è€…å¯ä»¥å‘Šåˆ«ç¹ççš„åº•å±‚è°ƒç”¨ï¼Œå¤§å¹…æå‡å¼€å‘æ•ˆç‡ä¸ä»£ç æ•´æ´åº¦ã€‚

ä¸€ã€A.swift æ˜¯ä»€ä¹ˆï¼Ÿ
--------------

`A` æ˜¯ Aquarius æ¡†æ¶ä¸­çš„æ ¸å¿ƒä¾¿æ·å±‚ï¼Œä»¥å‘½åç©ºé—´ï¼ˆNamespaceï¼‰çš„å½¢å¼ç»„ç»‡ä»£ç ï¼Œæä¾›äº†ä¸€ç³»åˆ—é™æ€å±æ€§å’Œæ–¹æ³•ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿé€šè¿‡ç±»ä¼¼ `A.ui`ã€`A.color`ã€`A.file` è¿™æ ·çš„è¯­æ³•å¿«é€Ÿè°ƒç”¨åŠŸèƒ½æ¨¡å—ã€‚

å…¶ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š

*   **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰åŠŸèƒ½é€šè¿‡ `A` è®¿é—®ï¼Œé™ä½è®°å¿†æˆæœ¬
*   **ç±»å‹å®‰å…¨**ï¼šå¤šæ•°æ¥å£è®¾è®¡ä¸ºç±»å‹å®‰å…¨æˆ–å¯é€‰å€¼ï¼Œé¿å…éšæ€§å´©æºƒ
*   **åŠŸèƒ½å®Œå¤‡**ï¼šæ¶µç›– UIã€ä¸»é¢˜ã€å­˜å‚¨ã€ç³»ç»Ÿäº¤äº’ã€æ—¥å¿—ã€æ”¯ä»˜ç­‰å¸¸ç”¨åœºæ™¯
*   **ç°ä»£å¹¶å‘æ”¯æŒ**ï¼šå¦‚ IAP æ¨¡å—ä½¿ç”¨ `async/await` å°è£…ï¼Œé€‚é… Swift å¹¶å‘ç¼–ç¨‹

äºŒã€æ ¸å¿ƒæ¨¡å—æ¦‚è§ˆ
--------

ä¸‹é¢æˆ‘ä»¬ç®€è¦ä»‹ç» `A` ä¸­å¸¸ç”¨çš„å­æ¨¡å—åŠå…¶å…¸å‹ç”¨é€”ï¼š

æ¨¡å—å

åŠŸèƒ½è¯´æ˜

`A.ui`

å¿«é€Ÿåˆ›å»ºå¸¸ç”¨ UI æ§ä»¶

`A.color` / `A.image`

ä¸»é¢˜è‰²ã€ç³»ç»Ÿå›¾æ ‡ä¸å›¾ç‰‡å·¥å…·

`A.userDefaults(_:)`

UserDefaults ä¾¿æ·å°è£…ï¼Œæ”¯æŒ App Group

`A.file`

æ–‡ä»¶è·¯å¾„ã€ç›®å½•ä¸æ–‡ä»¶æ“ä½œ

`A.calendarEvent`

æ—¥å†äº‹ä»¶ç®¡ç†ï¼ˆåŸºäº EventKitï¼‰

`A.log`

åˆ†çº§æ—¥å¿—è¾“å‡ºï¼Œæ”¯æŒ emoji æ ‡è¯†

`A.iap`

å†…è´­æµç¨‹å°è£…ï¼ŒåŸºäº StoreKit ç°ä»£ API

ä¸‰ã€å®æˆ˜æ¼”ç¤ºï¼šæ„Ÿå—ç¼–ç æ•ˆç‡çš„é£è·ƒ
----------------

### 3.1 å¿«é€Ÿåˆ›å»ºå¹¶æ·»åŠ æŒ‰é’®

**ä¼ ç»Ÿæ–¹å¼**ï¼š

    let button = UIButton(type: .system)
    button.addTarget(self, action: #selector(submitTapped), for: .touchUpInside)
    

**ä½¿ç”¨A.swift**ï¼š

    let button = A.ui.button
    button.addTouchUpInsideBlock { [weak self] control in
        ...
    }
    let label = A.ui.label
    let imageView = A.ui.imageView
    let tableView = A.ui.tableView
    ...
    

å‘Šåˆ«ä¸åŒUIæ§ä»¶åˆ›å»ºæ–¹å¼çš„ä¸åŒï¼Œç»Ÿä¸€UIæ§ä»¶åˆ›å»ºæ–¹å¼ã€‚

### 3.2 ä½¿ç”¨ä¸»é¢˜è‰²ä¸ç³»ç»Ÿå›¾æ ‡

    view.backgroundColor = A.color.blackColor
    imageView.image = A.image.systemImage(systemName: "star.fill")
    

ç»Ÿä¸€ç®¡ç†é¢œè‰²ä¸å›¾æ ‡ï¼Œè½»æ¾é€‚é…æš—é»‘æ¨¡å¼ä¸ä¸»é¢˜åˆ‡æ¢ã€‚

### 3.3 è¯»å†™ UserDefaults

    //å†™å…¥
    A.userDefaults("group.com.jzx.app").forKey("username")
    A.userDefaults("group.com.jzx.app").setValue("å¼ ä¸‰", forKey: "username")
    //è¯»å–
    let name: String? = A.userDefaults("group.com.jzx.app").getStringValue("username")
    

æ”¯æŒ App Groupï¼Œå¹¶æä¾›ç±»å‹å®‰å…¨çš„è¯»å–æ¥å£ã€‚

### 3.4 æ–‡ä»¶æ“ä½œ

    let path = A.file.pathFromDocuments("data/user.json")
    if !A.file.isExist(path) {
        try? A.file.createFolder(at: "data")
    }
    // å†™å…¥æ–‡ä»¶...
    

å°è£…å¸¸ç”¨æ–‡ä»¶æ“ä½œæ–¹æ³•ï¼Œæå‡ä»£ç å¯è¯»æ€§ã€‚

### 3.5 åˆ›å»ºæ—¥å†äº‹ä»¶

    A.calendarEvent.add(title: "å‘å¸ƒä¼š", startDate: start, endDate: end) { result in
        switch result {
        case .success(let id): A.log.info("åˆ›å»ºæˆåŠŸï¼š\(id)")
        case .failure(let err): A.log.error("åˆ›å»ºå¤±è´¥ï¼š\(err)")
        }
    }
    

è‡ªåŠ¨å¤„ç†æƒé™ç”³è¯·ä¸äº‹ä»¶æ·»åŠ ï¼Œå›è°ƒæ¸…æ™°ã€‚

### 3.6 åˆ†çº§æ—¥å¿—

    A.log.debug("ç”¨æˆ·ç‚¹å‡»æŒ‰é’®")
    A.log.warning("ç½‘ç»œè¯·æ±‚è¶…æ—¶")
    A.log.error("è§£æå¤±è´¥ï¼š\(error)")
    

æ—¥å¿—è‡ªå¸¦ emoji å’Œç­‰çº§æ ‡è¯†ï¼Œè°ƒè¯•æ›´ç›´è§‚ã€‚

### 3.7 å‘èµ·å†…è´­

    Task {
        do {
            let products = try await A.iap.fetchProducts(["com.jzx.pro"])
            if let product = products.first {
                try await A.iap.purchase(product: product)
                A.log.info("è´­ä¹°æˆåŠŸ")
            }
        } catch {
            A.log.error("è´­ä¹°å¤±è´¥ï¼š\(error)")
        }
    }
    

åŸºäºç°ä»£ StoreKit APIï¼Œæ”¯æŒ async/awaitï¼Œé€»è¾‘æ¸…æ™°ã€‚

å››ã€æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹
-----------

### 4.1 é”™è¯¯å¤„ç†è¦åˆ°ä½

`A` ä¸­å¤šæ•°å¯èƒ½å‡ºé”™çš„æ“ä½œéƒ½ä¼šé€šè¿‡ `Result`ã€`throws` æˆ–å¯é€‰å€¼æ¥è¡¨ç¤ºå¤±è´¥ï¼Œè¯·åŠ¡å¿…å¤„ç†è¿™äº›æƒ…å†µï¼Œé¿å…ç›´æ¥ä½¿ç”¨ `try!` æˆ–å¼ºåˆ¶è§£åŒ…ã€‚

### 4.2 æƒé™ç®¡ç†ä¸èƒ½å¿˜

å¦‚ä½¿ç”¨ `A.calendarEvent` æˆ– `A.reminderEvent`ï¼Œè¯·ç¡®ä¿å·²åœ¨ `Info.plist` ä¸­æ·»åŠ ç›¸åº”æƒé™è¯´æ˜ï¼Œå¹¶åœ¨ä½¿ç”¨å‰æ£€æŸ¥æˆæƒçŠ¶æ€ã€‚

### 4.3 çº¿ç¨‹å®‰å…¨éœ€æ³¨æ„

æ¶‰åŠ UI æ›´æ–°çš„æ“ä½œè¯·ç¡®ä¿åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œã€‚`A.iap` ç­‰å¼‚æ­¥æ–¹æ³•å·²è‡ªåŠ¨å¤„ç†çº¿ç¨‹åˆ‡æ¢ï¼Œä½†ä»å»ºè®®ä½¿ç”¨ `MainActor` æˆ– `DispatchQueue.main` æ›´æ–°ç•Œé¢ã€‚

### 4.4 ç»“åˆ MVVM æ¶æ„

ä½ å¯ä»¥åœ¨ ViewModel ä¸­ç›´æ¥ä½¿ç”¨ `A.file`ã€`A.userDefaults`ã€`A.iap` ç­‰æ¨¡å—ï¼Œå°†å¹³å°ç›¸å…³ä»£ç ä¸ UI é€»è¾‘åˆ†ç¦»ï¼š

    class SettingViewModel {
        func clearCache() {
            let cachePath = A.file.pathFromCaches("")
            try? A.file.removeItem(cachePath)
        }
    }
    

äº”ã€æ€»ç»“
----

`A.swift` ä½œä¸º Aquarius æ¡†æ¶ä¸­çš„"ç‘å£«å†›åˆ€"ï¼Œæå¤§åœ°ç®€åŒ–äº† iOS å¼€å‘ä¸­å¸¸è§çš„ä»»åŠ¡æµç¨‹ã€‚æ— è®ºæ˜¯åˆ›å»ºç•Œé¢ã€ç®¡ç†æ•°æ®ã€è®°å½•æ—¥å¿—ï¼Œè¿˜æ˜¯å¤„ç†å†…è´­å’Œç³»ç»Ÿäº‹ä»¶ï¼Œ`A` éƒ½æä¾›äº†ç®€æ´è€Œå¼ºå¤§çš„æ¥å£ã€‚

å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªèƒ½æå‡å¼€å‘æ•ˆç‡ã€å‡å°‘æ ·æ¿ä»£ç çš„ Swift å·¥å…·é›†ï¼Œä¸å¦¨è¯•è¯• Aquarius æ¡†æ¶ä¸­çš„ `A.swift`ã€‚

* * *

**ç«‹å³ä½“éªŒAquariusï¼š**

**ç¬¬ä¸€æ­¥ï¼šæ¢ç´¢èµ„æº**

*   **â­ Star & Fork æ¡†æ¶æºç **ï¼š [GitHub - JZXStudio/Aquarius](https://github.com/JZXStudio/Aquarius) - æ”¯æŒé¡¹ç›®å‘å±•
*   **â­ Star & Fork æ¡†æ¶æ–‡æ¡£**ï¼š [ZRead - JZXStudio/Aquarius](https://zread.ai/JZXStudio/Aquarius) - é¡¹ç›®ä»‹ç»æ–‡æ¡£ï¼Œæ·±å…¥äº†è§£æ¡†æ¶
*   **â­ Star & Fork æ‚¦è®°æºç **ï¼š [GitHub - JZXStudio/yuenote](https://github.com/JZXStudio/yuenote) - å®Œæ•´æ¡ˆä¾‹ï¼Œæ·±å…¥äº†è§£æ¡†æ¶ä½¿ç”¨æ–¹å¼

**ç¬¬äºŒæ­¥ï¼šä½“éªŒæ•ˆæœ**

*   **ğŸ“± ä¸‹è½½ç¤ºä¾‹APP**ï¼š [æ‚¦è®°](https://apps.apple.com/cn/app/%E6%82%A6%E8%AE%B0-%E6%84%89%E6%82%A6%E8%AE%B0%E5%BD%95-%E5%BF%AB%E4%B9%90%E7%94%9F%E6%B4%BB/id6739872794) | [çˆ±å¯»è½¦](https://apps.apple.com/cn/app/%E7%88%B1%E5%AF%BB%E8%BD%A6-%E6%89%BE%E8%BD%A6-%E5%81%9C%E8%BD%A6-%E5%81%A5%E5%BF%98%E7%97%87-%E5%81%9C%E8%BD%A6%E8%B4%B9%E7%94%A8%E6%8F%90%E9%86%92/id6747658196) - æ„Ÿå—çœŸå®é¡¹ç›®ä¸­çš„æµç•…ä½“éªŒ

**ç¬¬ä¸‰æ­¥ï¼šæ²Ÿé€šäº¤æµ**

*   ğŸ’¬ **æäº¤Issue**ï¼š [GitHub Issues](https://github.com/JZXStudio/Aquarius/issues) - åé¦ˆé—®é¢˜æˆ–å»ºè®®
*   **ğŸ’Œ è”ç³»ä¸åé¦ˆ**ï¼š [studio\_jzx@163.com](mailto:studio_jzx@163.com) - ç›´æ¥äº¤æµå¼€å‘å¿ƒå¾—