function u(){function i(e){return e=encodeURI(e),document.getElementById(e).querySelector(".leancloud-visitors-count")}function p(e){let r=document.querySelector(".leancloud_visitors"),n=decodeURI(r.id),t=r.dataset.flagTitle;e("get",`/classes/Counter?where=${encodeURIComponent(JSON.stringify({url:n}))}`).then(o=>o.json()).then(({results:o})=>{if(o.length>0){let s=o[0];i(n).innerText=s.time+1,e("put",`/classes/Counter/${s.objectId}`,{time:{__op:"Increment",amount:1}}).catch(l=>{console.error("Failed to save visitor count",l)})}else e("post","/classes/Counter",{title:t,url:n,time:1}).then(s=>s.json()).then(()=>{i(n).innerText=1}).catch(s=>{console.error("Failed to create",s)})}).catch(o=>{console.error("LeanCloud Counter Error",o)})}function h(e){let n=[...document.querySelectorAll(".leancloud_visitors")].map(t=>decodeURI(t.id));e("get",`/classes/Counter?where=${encodeURIComponent(JSON.stringify({url:{$in:n}}))}`).then(t=>t.json()).then(({results:t})=>{for(let o of n){let s=t.find(l=>l.url===o);i(o).innerText=s?s.time:0}}).catch(t=>{console.error("LeanCloud Counter Error",t)})}let{app_id:c,app_key:f,server_url:m}=CONFIG.leancloudVisitors;function a(e){let r=(n,t,o)=>fetch(`${e}/1.1${t}`,{method:n,headers:{"X-LC-Id":c,"X-LC-Key":f,"Content-Type":"application/json"},body:JSON.stringify(o)});CONFIG.page.isPost?p(r):document.querySelectorAll(".post-title-link").length>=1&&h(r)}let d=c.slice(-9)==="-MdYXbMMI"?`https://${c.slice(0,8).toLowerCase()}.api.lncldglobal.com`:m;d?a(d):fetch(`https://app-router.leancloud.cn/2/route?appId=${c}`).then(e=>e.json()).then(({api_server:e})=>{a(`https://${e}`)})}document.addEventListener("DOMContentLoaded",u);document.addEventListener("pjax:success",u);
