---
layout: post
title: "ã€Java8æ–°ç‰¹æ€§ã€‘- Streamæµ"
date: "2022-10-09T20:23:33.799Z"
---
ã€Java8æ–°ç‰¹æ€§ã€‘- Streamæµ
===================

streamæ˜¯java8æ–°å‡ºçš„æŠ½è±¡æ¦‚å¿µï¼Œä»–å¯ä»¥è®©ä½ æ ¹æ®ä½ æœŸæœ›çš„æ–¹å¼æ¥å¤„ç†é›†åˆæ•°æ®ï¼Œèƒ½å¤Ÿè½»æ¾çš„æ‰§è¡Œå¤æ‚çš„æŸ¥æ‰¾ã€è¿‡æ»¤å’Œæ˜ å°„æ•°æ®ç­‰æ“ä½œã€‚Stream ä½¿ç”¨ä¸€ç§ç±»ä¼¼ç”¨ SQL è¯­å¥ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®çš„ç›´è§‚æ–¹å¼æ¥æä¾›ä¸€ç§å¯¹ Java é›†åˆè¿ç®—å’Œè¡¨è¾¾çš„é«˜é˜¶æŠ½è±¡ã€‚

Java8æ–°ç‰¹æ€§ - Streamæµçš„åº”ç”¨
=====================

> ğŸ˜„ç”Ÿå‘½ä¸æ¯ï¼Œå†™ä½œä¸æ­¢  
> ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°  
> ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·  
> ğŸ† [ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº](https://blog.csdn.net/qq_43843951) [@æ€’æ”¾å§å¾·å¾·](https://www.cnblogs.com/lyd-code/)  
> ğŸŒåˆ†äº«å­¦ä¹ å¿ƒå¾—ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ æˆé•¿ï¼

![streamæµ.jpg](https://ucc.alicdn.com/pic/developer-ecology/8c8df97430904b36b83acbf77111144f.jpg)

ç®€ä»‹
--

streamæ˜¯java8æ–°å‡ºçš„æŠ½è±¡æ¦‚å¿µï¼Œä»–å¯ä»¥è®©ä½ æ ¹æ®ä½ æœŸæœ›çš„æ–¹å¼æ¥å¤„ç†é›†åˆæ•°æ®ï¼Œèƒ½å¤Ÿè½»æ¾çš„æ‰§è¡Œå¤æ‚çš„æŸ¥æ‰¾ã€è¿‡æ»¤å’Œæ˜ å°„æ•°æ®ç­‰æ“ä½œã€‚Stream ä½¿ç”¨ä¸€ç§ç±»ä¼¼ç”¨ SQL è¯­å¥ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®çš„ç›´è§‚æ–¹å¼æ¥æä¾›ä¸€ç§å¯¹ Java é›†åˆè¿ç®—å’Œè¡¨è¾¾çš„é«˜é˜¶æŠ½è±¡ã€‚  
Stream APIå¯ä»¥æå¤§æé«˜Javaç¨‹åºå‘˜çš„ç”Ÿäº§åŠ›ï¼Œè®©ç¨‹åºå‘˜å†™å‡ºé«˜æ•ˆç‡ã€å¹²å‡€ã€ç®€æ´çš„ä»£ç ã€‚è¿™ç§é£æ ¼å°†è¦å¤„ç†çš„å…ƒç´ é›†åˆçœ‹ä½œä¸€ç§æµï¼Œ æµåœ¨ç®¡é“ä¸­ä¼ è¾“ï¼Œ å¹¶ä¸”å¯ä»¥åœ¨ç®¡é“çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œå¤„ç†ï¼Œ æ¯”å¦‚ç­›é€‰ï¼Œ æ’åºï¼Œèšåˆç­‰ã€‚  
å…ƒç´ æµåœ¨ç®¡é“ä¸­ç»è¿‡ä¸­é—´æ“ä½œï¼ˆintermediate operationï¼‰çš„å¤„ç†ï¼Œæœ€åç”±æœ€ç»ˆæ“ä½œ(terminal operation)å¾—åˆ°å‰é¢å¤„ç†çš„ç»“æœã€‚  
å¯¹äºä¸€ä¸ªé›†åˆï¼Œé¦–å…ˆéœ€è¦è½¬æˆstreamæµï¼Œå¯ä»¥ä½¿ç”¨ä¸­é—´æ“ä½œï¼ˆfilterè¿‡æ»¤å™¨ã€distinctå»é‡ã€sortedæ’åºç­‰ï¼‰ï¼Œä½†æ˜¯æœ€åæ˜¯ç”±ç»ˆæ­¢æ“ä½œç»“æŸï¼ˆforEachéå†ã€collectè½¬æ¢ã€minï¼Œmaxæœ€å°æœ€å¤§ç­‰ï¼‰ã€‚

Streamæµçš„ä½¿ç”¨
----------

### ç”Ÿæˆæµ

åœ¨ Java 8 ä¸­, é›†åˆæ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³•æ¥ç”Ÿæˆæµï¼š

*   stream() âˆ’ ä¸ºé›†åˆåˆ›å»ºä¸²è¡Œæµï¼Œä¹Ÿå°±æ˜¯é‡‡ç”¨å•çº¿ç¨‹æ‰§è¡Œ
*   parallelStream() âˆ’ ä¸ºé›†åˆåˆ›å»ºå¹¶è¡Œæµï¼Œä¹Ÿå°±æ˜¯é‡‡ç”¨å¤šçº¿ç¨‹æ‰§è¡Œ  
    ä¸²è¡Œæµï¼šå•çº¿ç¨‹çš„æ–¹å¼æ“ä½œï¼Œ æ•°æ®é‡æ¯”è¾ƒå°‘çš„æ—¶å€™ä½¿ç”¨  
    å¹¶è¡Œæµï¼šå¤šçº¿ç¨‹æ–¹å¼æ“ä½œï¼Œæ•°æ®é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ä½¿ç”¨  
    ä¸»è¦åŸç†æ˜¯ï¼šå°†ä¸€ä¸ªå¤§çš„ä»»åŠ¡æ‹†åˆ†nå¤šä¸ªå°çš„å­ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œ  
    æœ€ååœ¨ç»Ÿè®¡ç»“æœï¼Œæœ‰å¯èƒ½ä¼šéå¸¸æ¶ˆè€—cpuçš„èµ„æºï¼Œç¡®å®å¯ä»¥  
    æé«˜æ•ˆç‡ï¼Œä½†æ˜¯åœ¨æ•°æ®é‡ä¸å¤šçš„æ—¶å€™å°±ä¸è¦ä½¿ç”¨å¹¶è¡Œæµã€‚

### Streamå°†listè½¬æ¢ä¸ºSet

é¦–å…ˆå°†listè½¬æˆstreamæµï¼Œåœ¨é€šè¿‡collect(Collectors.toSet())çš„æ–¹æ³•å¾—åˆ°seté›†åˆã€‚ä½†æ˜¯ï¼Œç›´æ¥è¿™ä¹ˆæ“ä½œï¼Œseté›†åˆæ˜¯æ— æ³•å»é‡çš„ã€‚é¦–å…ˆéœ€è¦äº†è§£ä¸€ä¸‹setçš„åº•å±‚æ˜¯å¦‚ä½•é˜²æ­¢é‡å¤çš„keyçš„ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“setåº•å±‚ä¾èµ–mapé˜²æ­¢é‡å¤çš„keyï¼Œmapé›†åˆåº•å±‚ä¾é equalsæ¯”è¾ƒé˜²æ­¢é‡å¤çš„keyã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨å®ä½“ç±»å‹ä¸­å»é‡å†™equalså’Œhashcodeçš„æ–¹æ³•ã€‚  
å®ä½“ç±»ï¼š

    package com.jdk8.demo.lambda.entity;
    
    import java.util.HashMap;
    
    /**
     * @author: lyd
     * @description: å®ä½“
     * @Date: 2022/10/5
     */
    public class Student {
        private String name;
        private Integer score;
    
        // ... çœç•¥getã€setã€æ„é€ æ–¹æ³•
    
        @Override
        public boolean equals(Object obj) {
            if (obj instanceof Student) {
                return name.equals(((Student) obj).name) && score == ((Student) obj).score;
            }
            return false;
        }
    
        @Override
        public int hashCode() {
            return score.hashCode();
        }
    }
    

æµ‹è¯•ä»£ç 

    public static void main(String[] args) {
        // Streamå°†listè½¬æ¢ä¸ºSet
        ArrayList<Student> students = new ArrayList<>();
        students.add(new Student("lyd", 99));
        students.add(new Student("lkj", 55));
        students.add(new Student("llm", 67));
        students.add(new Student("lss", 87));
        students.add(new Student("lss", 87));
        /**
         * setåº•å±‚ä¾èµ–mapé˜²æ­¢é‡å¤çš„keyï¼Œmapé›†åˆåº•å±‚ä¾é equalsæ¯”è¾ƒé˜²æ­¢é‡å¤çš„key
         */
        Stream<Student> stream = students.stream();
        Set<Student> collect = stream.collect(Collectors.toSet());
        Iterator<Student> iterator = collect.iterator();
        while (iterator.hasNext()) {
            Student next = iterator.next();
            System.out.println(next.getName() + " -> " + next.getScore());
        }
    }
    

ç»“æœï¼š  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/671c0cf6d4dc417c8a6ad656af917e87.png)

### Streamå°†listè½¬æ¢ä¸ºMap

listé›†åˆè½¬æˆstreamæµä¹‹åï¼Œé€šè¿‡<R, A> R collect(Collector<? super T, A, R> collector)ï¼Œåœ¨é€šè¿‡

    Collector<T, ?, Map<K,U>> toMap(Function<? super T, ? extends K> keyMapper,
                                    Function<? super T, ? extends U> valueMapper) {
        return toMap(keyMapper, valueMapper, throwingMerger(), HashMap::new);
    }
    

æ¥å£°æ˜keyå’Œvalueã€‚å¦‚ä¸‹ä»£ç ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œstream.collect(Collectors.toMap(key, value))ï¼Œkeyå’Œvalueéƒ½æ˜¯é€šè¿‡new Function<T, K>ï¼Œå¯¹äºkeyï¼šTæŒ‡çš„æ˜¯Steamæµçš„ç±»å‹(æ—¢Student)ï¼Œè€ŒKä»£è¡¨çš„æ˜¯mapä¸­çš„keyå€¼ï¼Œå› æ­¤è¿™é‡Œæ˜¯Stringç±»å‹çš„ï¼Œåœ¨applyæ–¹æ³•ä¸­å»è¿”å›keyå€¼ï¼Œé€šè¿‡studentçš„åå­—æ¥æœ€ä¸ºkeyï¼Œå› æ­¤è¿™é‡Œè¿”å›student.getName()ã€‚è€Œç¬¬äºŒä¸ªä½œä¸ºmapçš„valueï¼Œæ•´ä½“æ“ä½œä¹Ÿæ˜¯è·Ÿkeyå·®ä¸å¤šï¼Œä¸»è¦è¿˜æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œvalueå­˜çš„æ˜¯studentï¼Œå› æ­¤éœ€è¦ä½¿ç”¨Studentç±»å‹ã€‚

    Map<String, Student> map = stream.collect(Collectors.toMap(new Function<Student, String>() {
        @Override
        public String apply(Student student) {
            return student.getName();
        }
    }, new Function<Student, Student>() {
        @Override
        public Student apply(Student student) {
            return student;
        }
    }));
    

æœ€åéƒ½å¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼æ¥

    public static void main(String[] args) {
        // Streamå°†listè½¬æ¢ä¸ºMap
        ArrayList<Student> students = new ArrayList<>();
        students.add(new Student("lyd", 99));
        students.add(new Student("lkj", 55));
        students.add(new Student("llm", 67));
        students.add(new Student("lss", 87));
        Stream<Student> stream = students.stream();
        Map<String, Student> map = stream.collect(Collectors.toMap(student -> student.getName(), student -> student));
        map.forEach((key, value) -> System.out.println("key: " + key + " -> value: " + value));
    }
    

ç»“æœ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/c2282104994d4b86a24b03569a608f5d.png)

### Streamä½¿ç”¨Reduceæ±‚å’Œ

é€šè¿‡ä½¿ç”¨streamçš„reduceæ–¹æ³•ï¼Œåœ¨é‡Œé¢å»new BinaryOperatorï¼Œä»£ç å¦‚ä¸‹

    public static void main(String[] args) {
        // Streamä½¿ç”¨Reduceæ±‚å’Œ
        ArrayList<Student> students = new ArrayList<>();
        students.add(new Student("lyd", 99));
        students.add(new Student("lkj", 55));
        students.add(new Student("llm", 67));
        students.add(new Student("lss", 87));
        Stream<Student> stream = students.stream();
        Optional<Student> sum = stream.reduce((student, student2) -> {
            Student sum1 = new Student("sum", student.getScore() + student2.getScore());
            return sum1;
        });
        System.out.println(sum.get().getName() + " : " + sum.get().getScore());
    }
    

ç»“æœ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/2abd8445a7b7485181ec74adbcbbbab9.png)

### Streamä½¿ç”¨Maxå’ŒMin

å®é™…ä¸Šå°±æ˜¯é€šè¿‡åŒ¿åå†…éƒ¨ç±»new Comparator()å®ç°public int compare(Student o1, Student o2)æ¯”è¾ƒæ–¹æ³•ã€‚

    public static void main(String[] args) {
        // StreamMaxå’ŒMin
        ArrayList<Student> students = new ArrayList<>();
        students.add(new Student("lyd", 99));
        students.add(new Student("lkj", 55));
        students.add(new Student("llm", 67));
        students.add(new Student("lss", 87));
        Stream<Student> stream = students.stream();
        Optional<Student> max = stream.max((o1, o2) -> o1.getScore() - o2.getScore());
        System.out.println(max.get().getScore());
    
        Stream<Student> stream2 = students.stream();
        Optional<Student> min = stream2.min((o1, o2) -> o1.getScore() - o2.getScore());
        // å¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•å…¥æ›´åŠ ç®€ä¾¿
        // Optional<Student> min = stream2.min(Comparator.comparingInt(Student::getScore));
        System.out.println(min.get().getScore());
    }
    

ç»“æœ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/c2035b93eef54d5caa4fa90f3587547d.png)

### Streamä¸­MatchåŒ¹é…

*   anyMatchè¡¨ç¤ºï¼Œåˆ¤æ–­çš„æ¡ä»¶é‡Œï¼Œä»»æ„ä¸€ä¸ªå…ƒç´ æˆåŠŸï¼Œè¿”å›true
*   allMatchè¡¨ç¤ºï¼Œåˆ¤æ–­æ¡ä»¶é‡Œçš„å…ƒç´ ï¼Œæ‰€æœ‰çš„éƒ½æ˜¯ï¼Œè¿”å›true
*   noneMatchè·ŸallMatchç›¸åï¼Œåˆ¤æ–­æ¡ä»¶é‡Œçš„å…ƒç´ ï¼Œæ‰€æœ‰çš„éƒ½ä¸æ˜¯ï¼Œè¿”å›true

    public static void main(String[] args) {
        ArrayList<Student> students = new ArrayList<>();
        students.add(new Student("lyd", 99));
        students.add(new Student("lkj", 55));
        students.add(new Student("llm", 67));
        students.add(new Student("lss", 87));
        Stream<Student> stream = students.stream();
        boolean allMatch = stream.allMatch(student -> student.getScore() > 60);
        System.out.println("allMatch: " + allMatch);
    
        Stream<Student> stream2 = students.stream();
        boolean anyMatch = stream2.anyMatch(student -> student.getScore() > 60);
        System.out.println("anyMatch: " + anyMatch);
    
        Stream<Student> stream3 = students.stream();
        boolean noneMatch = stream3.noneMatch(student -> student.getScore() > 60);
        System.out.println("noneMatch: " + noneMatch);
    }
    

ç»“æœ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/deee2a2d5fe0468c8b0a05b154016a55.png)

### Streamçš„è¿‡æ»¤ä¸éå†

streamçš„è¿‡æ»¤æ˜¯é€šè¿‡filteræ–¹æ³•ï¼Œé€šè¿‡å®ç°åŒ¿åå†…éƒ¨ç±»new Predicate()çš„testæ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨é“¾å¼ç¼–ç¨‹ï¼ŒæŒç»­è¿‡æ»¤å¹¶ä¸”éå†ï¼Œå› ä¸ºè¿‡æ»¤ä¸æ˜¯ç»ˆæ­¢è¿ç®—ã€‚ç„¶è€ŒforEachæ˜¯å®ç°åŒ¿åå†…éƒ¨ç±»new Consumer()çš„acceptæ–¹æ³•ã€‚å¯ä»¥é€šè¿‡newçš„æ–¹å¼åœ¨é€šè¿‡ideaæ¥ç”Ÿæˆlambdaè¡¨è¾¾å¼ã€‚

    public static void main(String[] args) {
        ArrayList<Student> students = new ArrayList<>();
        students.add(new Student("lyd", 99));
        students.add(new Student("lkj", 55));
        students.add(new Student("llm", 67));
        students.add(new Student("lss", 87));
        Stream<Student> stream = students.stream();
        stream.filter(student -> student.getName() != null)
                .filter(student -> student.getScore() > 70)
                .forEach(student -> System.out.println("name: " + student.getName() + " score: " + student.getScore()));
    }
    

ç»“æœ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/e78e08fe256e4c449bec6c369c14890e.png)

### Streamçš„æ’åº

ä¸ä»…Arraysä»¥åŠæ•°ç»„èƒ½å¤Ÿå®ç°æ’åºç”šè‡³æ˜¯é‡å†™æ’åºè§„åˆ™ï¼ŒStreamæµä¹Ÿæ˜¯æä¾›äº†ç›¸åº”çš„æ–¹æ³•ã€‚é€šè¿‡å®ç°åŒ¿åå†…éƒ¨ç±»Comparatorçš„compareæ–¹æ³•ã€‚

    public static void main(String[] args) {
        ArrayList<Student> students = new ArrayList<>();
        students.add(new Student("lyd", 99));
        students.add(new Student("lkj", 55));
        students.add(new Student("llm", 67));
        students.add(new Student("lss", 87));
        Stream<Student> stream = students.stream();
        stream.sorted(new Comparator<Student>() {
            @Override
            public int compare(Student o1, Student o2) {
                return o1.getScore() - o2.getScore();
            }
        }).forEach(new Consumer<Student>() {
            @Override
            public void accept(Student student) {
                System.out.println("name: " + student.getName() + " score: " + student.getScore());
            }
        });
        /*lambda*/
        stream.sorted((o1, o2) -> o1.getScore() - o2.getScore())
                .forEach(student -> System.out.println("name: " + student.getName() + " score: " + student.getScore()));
        /*æ–¹æ³•å¼•å…¥*/
        stream.sorted(Comparator.comparingInt(Student::getScore))
                .forEach(student -> System.out.println("name: " + student.getName() + " score: " + student.getScore()));
    }
    

ç»“æœ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/0dd9972009054bc38aec4b94a6e29c5c.png)

### Streamçš„limitä¸skip

åœ¨SQLä¸­å¯ä»¥é€šè¿‡limitè¿›è¡Œåˆ†é¡µæ•°æ®çš„è·å–ï¼Œåœ¨java8çš„streamæµä¸­ï¼Œlimitæ˜¯è·å–é›†åˆä¸­çš„å‰å‡ ä¸ªå€¼ï¼Œè€Œskipæ˜¯è·³è¿‡å‡ ä¸ªå…ƒç´ ã€‚å½“æˆ‘ä»¬éœ€è¦è·å–ç¬¬äºŒåˆ°ç¬¬ä¸‰ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡skip(1)åœ¨é€šè¿‡limit(2)è·å–ã€‚

    public static void main(String[] args) {
        ArrayList<Student> students = new ArrayList<>();
        students.add(new Student("lyd", 99));
        students.add(new Student("lkj", 55));
        students.add(new Student("llm", 67));
        students.add(new Student("lss", 87));
        Stream<Student> stream = students.stream();
        stream.skip(1).limit(2).forEach(student -> System.out.println("name: " + student.getName() + " score: " + student.getScore()));
    }
    

ç»“æœ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/c9a21c8f9a37424a85ffa93a2f227807.png)

å·¥ä½œç¹å¿™ä¹Ÿéœ€è¦å­¦ä¹ ã€‚  
ğŸ‘åˆ›ä½œä¸æ˜“ï¼Œå¦‚æœ‰é”™è¯¯è¯·æŒ‡æ­£ï¼Œæ„Ÿè°¢è§‚çœ‹ï¼è®°å¾—ç‚¹èµå“¦ï¼ğŸ‘