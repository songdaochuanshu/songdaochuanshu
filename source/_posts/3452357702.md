---
layout: post
title: "git回滚操作系列"
date: "2022-11-22T08:26:17.620Z"
---
git回滚操作系列
=========

git回滚操作系列
---------

### 准备工作

*   本地环境
*   线上环境
*   分支 master

### 场景1

> 线上环境回滚，同步线上与本地操作

*   线上环境当前与本地一致  
    ![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122151244399-1016841979.png)  
    ![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122151258268-963876560.png)
*   先把线上回滚至早期

    获取提交日志
    [root@root]# git log 
    

![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122151528154-2014776501.png)

    回滚到指定版本
    [root@root]# git reset --hard e6d68bc72be4d364fa37af95d2d3693dc06ccecf
    

![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122151642514-511739095.png)

*   回到本地代码可发现，git pull了之后本地分支的代码没有变化，这是因为线上的分支只是回滚了，但是没有推送到远程分支，只是在线上的本地分支有修改，这个时候需求去线上推送到远程分支  
    ![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122151746866-124705155.png)
*   线上环境推送远程分支  
    ![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122151930116-589244854.png)  
    此时可以发现只是通过git push推送的分支并不能直接推送到远程分支，原因是因为当前分支因为回滚了操作属于旧分支，而远程分支是比较新的，所以需要强制推送

    [root@root]# git push -f
    

![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122152345037-1216326080.png)

*   回到本地环境拉取代码  
    ![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122152447286-330941089.png)  
    此时还是没有变化，需要在本地强制拉取

    git fetch --all
    git reset --hard origin/master
    

![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122152625110-1173564986.png)

* * *

### 场景2

> 本地回滚代码，同步线上与本地操作  
> ![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122152901384-1142321557.png)  
> ![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122152922366-167154340.png)

*   本地回滚代码

    回滚到指定版本
    git reset --hard e6d68bc72be4d364fa37af95d2d3693dc06ccecf
    

![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122153009076-175055058.png)

*   本地强制提交

    git push -f 
    

![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122153058004-745257449.png)

*   线上拉取  
    ![](https://img2022.cnblogs.com/blog/1072214/202211/1072214-20221122153148538-688200450.png)

* * *