---
layout: post
title: "å¤šçº¿ç¨‹03ï¼šğŸ“•çº¿ç¨‹ä¼ å‚è¯¦è§£"
date: "2022-05-11T10:22:29.283Z"
---
å¤šçº¿ç¨‹03ï¼šğŸ“•çº¿ç¨‹ä¼ å‚è¯¦è§£
==============

ğŸ“•çº¿ç¨‹ä¼ å‚è¯¦è§£
========

ä¸€ã€ä¼ é€’ä¸´æ—¶å¯¹è±¡ä½œä¸ºçº¿ç¨‹å‚æ•°
--------------

### 1.1è¦é¿å…çš„é™·é˜±

ç›´æ¥çœ‹ä»£ç ï¼š

    #include <iostream>
    #include <thread>
    using namespace std;
    
    void myPrint(const int &i, char* pmybuf)
    {
    	//å¦‚æœçº¿ç¨‹ä»ä¸»çº¿ç¨‹detachäº†
    	// ####1.iä¸æ˜¯mvarçœŸæ­£çš„å¼•ç”¨ï¼Œå®é™…ä¸Šè¿˜æ˜¯å€¼ä¼ é€’ï¼ˆé€šè¿‡æŸ¥çœ‹åœ°å€äº†è§£åˆ°ï¼‰ï¼Œå³ä½¿ä¸»çº¿ç¨‹è¿è¡Œå®Œæ¯•äº†ï¼Œå­çº¿ç¨‹ç”¨iä»ç„¶æ˜¯å®‰å…¨çš„ï¼Œä½†ä»ä¸æ¨èä¼ é€’å¼•ç”¨ ï¼ï¼ï¼ï¼
        //å®é™…ä¸Šï¼Œä½¿ç”¨joinä¼ å…¥çš„ä¹Ÿæ˜¯å‡å¼•ç”¨ï¼
    	// æ¨èæ”¹ä¸ºconst int i ï¼ï¼ï¼
    	cout << i << endl;
    	//è€ŒæŒ‡é’ˆpmybufè¿˜æ˜¯æŒ‡å‘åŸæ¥çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™ä¹ˆå†™æ˜¯ä¸å®‰å…¨çš„
    	cout << pmybuf << endl;
    }
    
    int main()
    {
    	int mvar = 1;
    	int& mvary = mvar;
    	char mybuf[] = "this is a test";
    	thread myThread(myPrint, mvar, mybuf);//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°åï¼Œåä¸¤ä¸ªå‚æ•°æ˜¯è¦ä¼ å…¥å‡½æ•°çš„å‚æ•°
    	myThread.join();
    	//myThread.detach();
    	
    	cout << "Hello World!" << endl;
        return 0;
    }
    

### 1.2è¦é¿å…çš„é™·é˜±

çœ‹ä»£ç ï¼š

    #include <iostream>
    #include <thread>
    #include <string>
    using namespace std;
    
    void myPrint(const int i, const string& pmybuf)
    {
    	cout << i << endl;
    	cout << pmybuf << endl;
    }
    
    int main()
    {
    	int mvar = 1;
    	int& mvary = mvar;
    	char mybuf[] = "this is a test";
    	//å¦‚æœdetachäº†ï¼Œè¿™æ ·ä»ç„¶æ˜¯ä¸å®‰å…¨çš„
    	//#####2.å› ä¸ºå­˜åœ¨ä¸»çº¿ç¨‹è¿è¡Œå®Œäº†ï¼Œmybufè¢«å›æ”¶äº†ï¼Œç³»ç»Ÿæ‰è¿›è¡Œmybuféšå¼ç±»å‹è½¬æ¢æˆstringï¼ï¼ï¼
    	//æ¨èå…ˆåˆ›å»ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡thread myThread(myPrint, mvar, string(mybuf));å°±ç»å¯¹å®‰å…¨äº†ï¼Œè¿™æ ·å°±ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­å®Œæˆstringç±»å‹æ„é€ å’Œå‚æ•°çš„æ‹·è´æ„é€ ï¼ï¼ï¼ï¼ˆå¯é€šè¿‡è‡ªå·±æ„é€ ç±»ï¼ŒåŠ å…¥çº¿ç¨‹ä¸­æ¥æµ‹è¯•ä¸€ä¸‹ï¼‰ï¼›
    	thread myThread(myPrint, mvar, mybuf);
    	myThread.join();
    	//myThread.detach();
    
    	cout << "Hello World!" << endl;
        return 0;
    }
    

### 1.3æ€»ç»“

*   **å¦‚æœä¼ é€’intè¿™ç§ç®€å•ç±»å‹ï¼Œæ¨èä½¿ç”¨å€¼ä¼ é€’ï¼Œä¸è¦ç”¨å¼•ç”¨**
*   **å¦‚æœä¼ é€’ç±»å¯¹è±¡ï¼Œé¿å…ä½¿ç”¨éšå¼ç±»å‹è½¬æ¢ï¼Œå…¨éƒ¨éƒ½æ˜¯åˆ›å»ºçº¿ç¨‹è¿™ä¸€è¡Œå°±åˆ›å»ºå‡ºä¸´æ—¶å¯¹è±¡ï¼Œç„¶ååœ¨å‡½æ•°å‚æ•°é‡Œï¼Œç”¨å¼•ç”¨æ¥æ¥ï¼Œå¦åˆ™è¿˜ä¼šåˆ›å»ºå‡ºä¸€ä¸ªå¯¹è±¡**
*   **ç»ˆæç»“è®ºï¼šå»ºè®®ä¸ä½¿ç”¨detach**

**äºŒã€ä¸´æ—¶å¯¹è±¡ä½œä¸ºçº¿ç¨‹å‚æ•°ç»§ç»­è®²**
-------------------

### 2.1 çº¿ç¨‹idæ¦‚å¿µ

*   idæ˜¯ä¸ªæ•°å­—ï¼Œæ¯ä¸ªçº¿ç¨‹ï¼ˆä¸ç®¡æ˜¯ä¸»çº¿ç¨‹è¿˜æ˜¯å­çº¿ç¨‹ï¼‰å®é™…ä¸Šéƒ½å¯¹åº”ç€ä¸€ä¸ªæ•°å­—ï¼Œè€Œä¸”æ¯ä¸ªçº¿ç¨‹å¯¹åº”çš„è¿™ä¸ªæ•°å­—éƒ½ä¸ä¸€æ ·
*   çº¿ç¨‹idå¯ä»¥ç”¨C++æ ‡å‡†åº“é‡Œçš„å‡½æ•°æ¥è·å–ã€‚std::this\_thread::get\_id()æ¥è·å–

### 2.2 ä¸´æ—¶å¯¹è±¡æ„é€ æ—¶æœºåˆ†æ

ä¸ºä»€ä¹ˆéœ€è¦åœ¨åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™å°±åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Ÿä¸èƒ½éšå¼ç±»å‹è½¬æ¢å‘¢ï¼Ÿ

â‘ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹éšå¼ç±»å‹è½¬æ¢ï¼š

    #include <iostream>
    
    using namespace std;
    #include<thread>
    
    class A
    {
    public:
    	int _ma;
    	A(int ma) : _ma(ma) { cout << "æ„é€ å‡½æ•°A()" << " å¯¹è±¡åœ°å€ï¼š" << this << " çº¿ç¨‹PIDï¼š" << std::this_thread::get_id() << endl; }
    	~A() { cout << "ææ„å‡½æ•°~A()" << " å¯¹è±¡åœ°å€ï¼š" << this << " çº¿ç¨‹PIDï¼š" << std::this_thread::get_id() << endl; }
    	A(const A& a) : _ma(a._ma) { cout << "æ‹·è´æ„é€ å‡½æ•°A(const A &a)" << " å¯¹è±¡åœ°å€ï¼š" << this << " çº¿ç¨‹PIDï¼š" << std::this_thread::get_id() << endl; }
    };
    
    void myprint2(const A& a)
    {
    	cout << "å¯¹è±¡åœ°å€ï¼š" << &a << " å­çº¿ç¨‹PID:" << std::this_thread::get_id() << endl;
    }
    
    int main()
    {
    	cout << "çº¿ç¨‹PID:" << std::this_thread::get_id() << endl;
    	int temp = 1;
    	thread mytobj(myprint2, temp);//éšå¼ç±»å‹è½¬æ¢
    	
    	//ä¸»çº¿ç¨‹ç­‰å­çº¿ç¨‹
    	mytobj.join();
    
    	//ä¸»çº¿ç¨‹å­çº¿ç¨‹åˆ†ç¦»
    	//mytobj.detach();
    	return 0;
    }
    

ç»“æœï¼š

![image-20220408213627472](https://cdn.jsdelivr.net/gh/little-boy-David/blog-img/images202205111735910.png)

å¯ä»¥çœ‹å‡ºï¼š**å­˜åœ¨è‡´å‘½é—®é¢˜ï¼šç«Ÿç„¶æ˜¯åœ¨å­çº¿ç¨‹ä¸­åˆ›é€ Aç±»å¯¹è±¡ï¼Œå­çº¿ç¨‹å‡½æ•°ä¸­çš„å¼•ç”¨èµ·æ•ˆæœ**ã€‚è¿™è¯´æ˜ï¼šå¦‚æœæˆ‘ä»¬é‡‡ç”¨detachæ–¹å¼åˆ†ç¦»äº†ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ï¼Œä¸€æ—¦ä¸»çº¿ç¨‹æ¯”å­çº¿ç¨‹å‚æ•°éšå¼è½¬æ¢å‰ç»“æŸäº†ï¼Œé‚£ä¹ˆå­çº¿ç¨‹å°†ä¼šäº§ç”Ÿä¸å¯é¢„ä¼°çš„ç»“æœã€‚

â‘¡æˆ‘ä»¬åœ¨æ¥çœ‹çœ‹åˆ›å»ºä¸´æ—¶å¯¹è±¡çš„æ–¹å¼ï¼š

ä¿®æ”¹ä¸Šé¢çš„`thread mytobj(myprint2, temp);`ï¼Œæ”¹ä¸ºï¼š`thread mytobj(myprint2, A(temp));`

ç”¨joinå’Œdetachæ–¹å¼ï¼Œéƒ½å¾—ç»“æœï¼š

![image-20220408224558374](https://cdn.jsdelivr.net/gh/little-boy-David/blog-img/images202205111735415.png)

å¯ä»¥çœ‹å‡ºï¼š**æ‰€æœ‰Aç±»å¯¹è±¡éƒ½åœ¨ä¸»å‡½æ•°ä¸­æ„é€ ï¼Œå­çº¿ç¨‹å‡½æ•°ä¸­çš„å¼•ç”¨ä¸èµ·æ•ˆæœã€‚** è¿™è¯´æ˜ï¼šåœ¨é‡‡ç”¨detachåˆ†ç¦»äº†ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ï¼Œéœ€è¦ä¼ å…¥ä¸´æ—¶å¯¹è±¡ã€‚

è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœå­çº¿ç¨‹å‡½æ•°ä¸­ä¸ç”¨&ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ

![image-20220408225417849](https://cdn.jsdelivr.net/gh/little-boy-David/blog-img/images202205111735433.png)

ä¼šæ¯”åŠ å¼•ç”¨å¤šäº†ä¸€æ¬¡å­çº¿ç¨‹å†…çš„æ‹·è´æ„é€ ï¼æµªè´¹å†…å­˜ï¼Œ**ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä¸åŒçš„ç¼–è¯‘å™¨æˆ–å¹³å°ï¼Œå¯¹äºthreadå‡½æ•°å¤„ç†çš„æ–¹å¼æ˜¯ä¸ä¸€æ ·**ï¼Œå¯ä»¥ç”¨è¿™å¥—ä»£ç åŒºLinuxçœ‹çœ‹ã€‚ï¼ˆå¯¹è±¡ä¼˜åŒ–é—®é¢˜ï¼‰

**ä¸‰ã€ä¼ é€’ç±»å¯¹è±¡ã€æ™ºèƒ½æŒ‡é’ˆä½œä¸ºçº¿ç¨‹å‚æ•°**
----------------------

### 3.1ä¼ é€’ç±»å¯¹è±¡ä½œä¸ºçº¿ç¨‹å‚æ•°

è¦åŸºäºä¸Šé¢çš„ä¸´æ—¶å¯¹è±¡ä½œä¸ºçº¿ç¨‹å‚æ•°ï¼Œå­çº¿ç¨‹é‡Œé¢æ”¹å¯¹è±¡çš„å€¼ä¼šæ”¹å˜ä¸»çº¿ç¨‹å¯¹è±¡çš„å€¼å—ï¼Ÿç»§ç»­å†™ä»£ç ï¼š

    #include <iostream>
    #include <thread>
    using namespace std;
    
    class A {
    public:
    	mutable int m_i; //è®°ä½ï¼ï¼ï¼ï¼šå¸¦æœ‰mutableå…³é”®å­—,m_iå³ä½¿å®åœ¨constä¸­ä¹Ÿå¯ä»¥è¢«ä¿®æ”¹
    	A(int i) :m_i(i) {}
    };
    
    void myPrint(const A& pmybuf)
    {
    	pmybuf.m_i = 199;
    	cout << "å­çº¿ç¨‹myPrintçš„å‚æ•°åœ°å€æ˜¯" << &pmybuf << "thread = " << std::this_thread::get_id() << endl;
    }
    
    int main()
    {
    	A myObj(10);
    	//myPrint(const A& pmybuf)ä¸­å¼•ç”¨ä¸èƒ½å»æ‰ï¼Œå¦‚æœå»æ‰ä¼šå¤šåˆ›å»ºä¸€ä¸ªå¯¹è±¡
    	//constä¹Ÿä¸èƒ½å»æ‰ï¼Œå»æ‰ä¼šå‡ºé”™ï¼Œå¯èƒ½å‡ºç°æ— æ³•æ¥å—å³å€¼æƒ…å†µï¼ˆä¼ å…¥ä¸´æ—¶å¯¹è±¡ï¼‰
        
    	//å³ä½¿æ˜¯ä¼ é€’çš„constå¼•ç”¨ï¼Œä½†åœ¨å­çº¿ç¨‹ä¸­è¿˜æ˜¯ä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°æ„é€ ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œ
    	//å› ä¸ºä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ä¸­å¯¹è±¡ä¸åŒï¼Œæ‰€ä»¥åœ¨å­çº¿ç¨‹ä¸­ä¿®æ”¹m_içš„å€¼ä¸ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹
    	thread myThread(myPrint, myObj);
    	myThread.join();
    	//myThread.detach();
    
    	cout << "Hello World!" << endl;
        
    }
    
    //å¦‚æœå¸Œæœ›å­çº¿ç¨‹ä¸­ä¿®æ”¹m_içš„å€¼å½±å“åˆ°ä¸»çº¿ç¨‹ï¼Œå¯ä»¥ç”¨thread myThread(myPrint, std::ref(myObj));è¿™æ ·constå°±æ˜¯çœŸçš„å¼•ç”¨äº†ï¼ŒmyPrintå®šä¹‰ä¸­çš„constå°±å¯ä»¥å»æ‰äº†ï¼Œç±»Aå®šä¹‰ä¸­çš„mutableä¹Ÿå¯ä»¥å»æ‰äº†ï¼Œå› ä¸ºä¼ å…¥çš„å°±æ˜¯ä¸»çº¿ç¨‹çš„å¯¹è±¡
    
    

3.2æ™ºèƒ½æŒ‡é’ˆä½œä¸ºçº¿ç¨‹å‚æ•°

    #include <iostream>
    #include <thread>
    #include <memory>
    using namespace std;
    
    void myPrint(unique_ptr<int> ptn)
    {
    	cout << "thread = " << std::this_thread::get_id() << endl;
    }
    
    int main()
    {
    	unique_ptr<int> up(new int(10));
    	//ç‹¬å å¼æŒ‡é’ˆåªèƒ½é€šè¿‡std::move()æ‰å¯ä»¥ä¼ é€’ç»™å¦ä¸€ä¸ªæŒ‡é’ˆ
    	//ä¼ é€’åupå°±æŒ‡å‘ç©ºï¼Œæ–°çš„ptnæŒ‡å‘åŸæ¥çš„å†…å­˜
    	//æ‰€ä»¥è¿™æ—¶å°±ä¸èƒ½ç”¨detachäº†ï¼Œå› ä¸ºå¦‚æœç”¨detachï¼Œä¸»çº¿ç¨‹å…ˆæ‰§è¡Œå®Œï¼Œnew int(10)å±äºä¸»çº¿ç¨‹ä¸­çš„æ³„æ¼èµ„æºï¼ŒptnæŒ‡å‘çš„å¯¹è±¡å°±è¢«é‡Šæ”¾äº†ï¼
    	thread myThread(myPrint, std::move(up));
    	myThread.join();
    	//myThread.detach();
    
    	return 0;
    }
    //è¿™å—å¿˜è®°äº†å¯ä»¥å»çœ‹çœ‹æ™ºèƒ½æŒ‡é’ˆï¼›
    

**å››ã€ç”¨æˆå‘˜å‡½æ•°æŒ‡é’ˆåšçº¿ç¨‹å‡½æ•°**
------------------

    #include <iostream>
    
    using namespace std;
    #include<thread>
    
    class A
    {
    public:
    	int _ma;
    	A(int ma) : _ma(ma) { cout << "æ„é€ å‡½æ•°A()" << " å¯¹è±¡åœ°å€ï¼š" << this << " çº¿ç¨‹PIDï¼š" << std::this_thread::get_id() << endl; }
    	~A() { cout << "ææ„å‡½æ•°~A()" << " å¯¹è±¡åœ°å€ï¼š" << this << " çº¿ç¨‹PIDï¼š" << std::this_thread::get_id() << endl; }
    	A(const A& a) : _ma(a._ma) { cout << "æ‹·è´æ„é€ å‡½æ•°A(const A &a)" << " å¯¹è±¡åœ°å€ï¼š" << this << " çº¿ç¨‹PIDï¼š" << std::this_thread::get_id() << endl; }
    	
    	void thread_work(int num) // å­çº¿ç¨‹ä»»åŠ¡
    	{
    		cout << "å­çº¿ç¨‹æ‰§è¡Œ" << " å­çº¿ç¨‹PID:" << std::this_thread::get_id() << endl;
    	}
    };
    
    int main()
    {
    	cout << "ä¸»çº¿ç¨‹PID:" << std::this_thread::get_id() << endl;
    	A myobj(10);
    	thread mytobj(&A::thread_work, myobj, 15); //ä¼ å…¥ æˆå‘˜å‡½æ•° + ç±»å¯¹è±¡ + æˆå‘˜å‡½æ•°çš„å‚æ•°å€¼ï¼›
    	
    	//ä¸»çº¿ç¨‹ç­‰å­çº¿ç¨‹
    	mytobj.join();
    
    	//ä¸»çº¿ç¨‹å­çº¿ç¨‹åˆ†ç¦»
    	//mytobj.detach();
    	return 0;
    }
    

joinã€detachéƒ½æ²¡æœ‰é—®é¢˜ï¼š

![image-20220408233057606](https://cdn.jsdelivr.net/gh/little-boy-David/blog-img/images202205111736559.png)

å¯ä»¥çœ‹å‡º:ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‹·è´æ„é€ ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ä¼ ç»™å­çº¿ç¨‹ï¼Œç”±å­çº¿ç¨‹æŒæ§è¯¥å¯¹è±¡ææ„é‡Šæ”¾