---
layout: post
title: "Notion-douanï¼šæ­å»ºè‡ªå·±çš„é˜…è¯»æ¸…å•"
date: "2022-03-29T20:18:35.336Z"
---
Notion-douanï¼šæ­å»ºè‡ªå·±çš„é˜…è¯»æ¸…å•
======================

å‰è¨€
--

äº¤å®Œè®ºæ–‡ç›²å®¡ç¨¿ï¼Œç»ˆäºä»æ¥è¿‘ä¸€å¹´çš„å®ä¹ ã€ç§‹æ‹›å’Œè®ºæ–‡çš„å¿™ç¢Œä¸­é—²ä¸‹æ¥ã€‚

åœ¨å¤ç›˜ç§‹æ‹›çš„æ—¶å€™å‘ç°è‡ªå·±è™½ç„¶çœ‹è¿‡ä¸å°‘ä¹¦ï¼Œä½†ç¼ºå°‘æ•´ç†å’Œæ€è€ƒï¼Œæ‰€ä»¥æƒ³è¶è¿™ä¸ªæœºä¼šæ¢³ç†ä¸€ä¸‹è‡ªå·±çš„é˜…è¯»ä¹ æƒ¯ï¼Œå¸Œæœ›ä»¥åå†è¯»æ–°çš„ä¸œè¥¿å¯ä»¥æ›´ç³»ç»Ÿé«˜æ•ˆã€‚ä½†æ˜¯æ‰‹åŠ¨è¾“å…¥å›¾ä¹¦ä¿¡æ¯å®åœ¨å¤ªæ…¢äº†ã€‚ç»è¿‡ä¸€ç•ªè°ƒç ”ï¼Œæˆ‘å‘ç°æœ‰æ’ä»¶[Notion Plus](https://www.notion.so/NotionPlus-71508def3f5045a2a4d68909cf0727fe)å¯ä»¥å¯¼å‡ºè±†ç“£å›¾ä¹¦åˆ—è¡¨ï¼Œä½†ä¼¼ä¹ç¼ºå°‘ç»´æŠ¤ï¼ˆæˆ‘æ²¡è¯•ï¼‰ï¼Œä»¥åŠæˆ‘è‡ªå·±æƒ³ä½“éªŒä¸€ä¸‹Notion APIï¼Œå°±åŠ¨äº†å†™ä¸€ä¸ªå°ç¨‹åºçš„å¿µå¤´ã€‚åœ¨è¿™é‡ŒæŠŠæ­å»ºè¿‡ç¨‹åˆ†äº«ç»™å¤§å®¶ï¼Œå…¨å½“æŠ›ç –å¼•ç‰ã€‚

**ä½¿ç”¨åœºæ™¯ ï¼š** å°†å•æœ¬å›¾ä¹¦ä¿¡æ¯ä»è±†ç“£å¯¼å…¥åˆ°Notion database

åˆ›å»ºNotionæœºå™¨äºº
-----------

æƒ³è¦åˆ©ç”¨Notionæä¾›çš„APIå¯¹è‡ªå·±WorkSpaceä¸­çš„blockè¿›è¡Œæ“ä½œçš„è¯ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºæœºå™¨äººï¼ˆ**integration**ï¼‰ï¼Œå¹¶ä¸ºæœºå™¨äººæˆäºˆæ‰€éœ€è¦æ“ä½œçš„blockæ“ä½œæƒé™ã€‚åœ¨ [æˆ‘çš„æœºå™¨äºº](https://www.notion.so/my-integrations) é¡µé¢å¯ä»¥å¿«é€Ÿåˆ›å»ºæœºå™¨äººã€‚

![åˆ›å»ºæ–°çš„æœºå™¨äºº](https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/yLAFzC.png)

åˆ›å»ºæ–°çš„æœºå™¨äºº

å¡«å®Œä¿¡æ¯ç‚¹å‡»åˆ›å»ºä¹‹åï¼Œç³»ç»Ÿè·³è½¬åˆ°æ–°çš„é¡µé¢ã€‚é¡µé¢æœ€ä¸Šæ–¹ç»™å‡ºäº†è¿™ä¸ªæœºå™¨äººçš„Secrets ( å°±æ˜¯ Bearer token)ï¼Œç‚¹å‡»Showå¯ä»¥æŸ¥çœ‹å’Œå¤åˆ¶ã€‚è¿™ä¸ªtokenä¼šä¸€ç›´åœ¨è¿™ä¸ªé¡µé¢ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒå¿˜è®°ã€‚

![Secrets](https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/xaXYfH.png)

åˆ›å»ºæ•°æ®è¡¨å¹¶é‚€è¯·æœºå™¨äºº
-----------

Notion å…¶å®æ˜¯æä¾›äº†åˆ›å»ºDatabaseçš„APIçš„ï¼Œä½†æˆ‘ä¹‹å‰å…¶å®å·²ç»æ‰‹åŠ¨åˆ›å»ºè¿‡äº†ï¼Œæ‰€ä»¥è¿™é‡Œå°±å·æ‡’æ²¡å†™ä»£ç ã€‚æˆ‘çš„æ•°æ®è¡¨é•¿è¿™ä¸ªæ ·å­ï¼š

![è®¾è®¡æ•°æ®è¡¨](https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/gHRFuy.png)

### è®¾è®¡æ•°æ®è¡¨

æƒ³å·æ‡’çš„åŒå­¦å¯ä»¥ç›´æ¥ç”¨æˆ‘çš„æ¨¡æ¿ï¼š[é˜…è¯»æ¸…å•](https://cetus.notion.site/Notion-douban-b9e99802b4be4e38b94aa2235997913c)

åšå¥½æ•°æ®è¡¨ä¹‹åéœ€è¦é‚€è¯·æœºå™¨äººï¼Œå¹¶æˆæƒï¼š

![é‚€è¯·æœºå™¨äºº](https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/cPykwB.png)

è·å–è±†ç“£è¯»ä¹¦æ•°æ®
--------

Notion APIæä¾›çš„æ˜¯åŸºäºRESTfulæ¶æ„çš„æ¥å£ï¼Œè™½ç„¶å®˜æ–¹æ–‡æ¡£æä¾›çš„æ˜¯JavaScriptæ ·ä¾‹ï¼Œä½†æˆ‘è‡ªå·±å†™Pythonæ¯”è¾ƒå¤šï¼Œæ‰€ä»¥è¿˜æ˜¯ç”¨Pythonè¿›è¡Œå¼€å‘ï¼Œè¿˜æœ‰ä¸€ä¸ªåŸå› å°±æ˜¯Pythonçˆ¬å–è±†ç“£æ•°æ®ä¼šæ›´åŠ å®¹æ˜“ã€‚

    def getInfo(url):
        header={
                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
                'Accept-Encoding': 'gzip, deflate, sdch',
                'Accept-Language': 'zh-CN,zh;q=0.8',
                'Connection': 'keep-alive',
                'User-Agent': 'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.235'
            }
    
        r = requests.get(url=url, headers=header)
        soup = BeautifulSoup(r.text, 'lxml')
        # get info
        info = {}
        info['title'] = soup.h1.span.text
        infos = soup.find(id='info').find_all('span',attrs={'class':'pl'})
        
        for i in infos:
            if i.text.strip() == 'ä½œè€…':
                info['ä½œè€…'] = i.next_sibling.next_sibling.text
            elif i.text == 'å‡ºç‰ˆç¤¾:':
                info['å‡ºç‰ˆç¤¾'] = i.next_sibling.next_sibling.text
            else:
                info[i.text.strip().strip(':')] = i.next_sibling.text.strip()
    
        info['score'] = soup.find(class_='rating_num').text.strip()
        info['cover'] = soup.find(class_='nbg')['href'].strip()
    
        return info
    

è·å–æ•°æ®çš„ç¨‹åºéå¸¸ç®€å•ï¼Œrequestså‘é€è¯·æ±‚ï¼ŒBeautifulSoupè§£æhtmlã€‚è¿™ä¸ªå‡½æ•°éœ€è¦çš„å‚æ•°urlå°±æ˜¯è±†ç“£è¯»ä¹¦æŸæœ¬ä¹¦è¯¦æƒ…é¡µé¢çš„é“¾æ¥ï¼Œå¦‚ï¼š

![https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/N93e7t.png](https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/N93e7t.png)

æ•°æ®å†™å…¥Notion
----------

åˆ°è¿™ä¸€æ­¥å…¶å®æ‰å¼€å§‹ç”¨Notion APIï¼Œç®€å•æ¥è¯´å°±æ˜¯æ„é€ è¯·æ±‚ï¼ŒPOSTåˆ°æŒ‡å®šçš„APIå°±å¯ä»¥æ–°å»ºä¸€æ¡è®°å½•äº†ã€‚å…¶ä¸­ï¼Œæ„é€ è¯·æ±‚çš„å…³é”®åœ¨äºæ„é€ å„å­—æ®µï¼ˆPropertyï¼‰ã€‚Notionä¸­å„ç±»Propertyçš„valueså¯ä»¥ä»[property-value-object](https://developers.notion.com/reference/property-value-object) ä¸­æ‰¾åˆ°è¯¦ç»†ä¿¡æ¯ã€‚æ¯”å¦‚Databaseçš„Nameå­—æ®µå±äºTitle propertyï¼Œæ„é€ æ–¹å¼å¦‚ä¸‹ï¼š

    {
      "Name": {
        "title": [
          {
            "type": "text",
            "text": {
              "content": "The title"
            }
          }
        ]
      }
    }
    

è¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œå°±æ˜¯å¯ä»¥å…ˆé€šè¿‡ç¨‹åºæŸ¥è¯¢æŒ‡å®šé¡µé¢ä¸­å„å­—æ®µçš„å€¼æ¥è·å–é¡µé¢ç»“æ„ï¼Œç„¶åç›´æ¥ä¿®æ”¹ç›¸åº”çš„å€¼å°±å¯ä»¥äº†ã€‚æŸ¥è¯¢æŒ‡å®šé¡µé¢çš„å­—æ®µç»“æ„ï¼Œå¯ä»¥æ„é€ å¦‚ä¸‹è¯·æ±‚ï¼š

    import requests
    token = '***'
    database_id = '***'
    r = requests.request(
        "POST",
        "https://api.notion.com/v1/databases/" + database_id + "/query",
        headers={"Authorization": "Bearer " + token, "Notion-Version": "2022-02-22"},
    )
    print(r.text)
    

å…¶ä¸­ï¼Œtoken å°±æ˜¯ä¸Šæ–‡åˆ›å»ºæœºå™¨äººæ—¶Notionè‡ªåŠ¨åˆ†é…çš„Secrets ï¼Œdatabase\_id å°±æ˜¯éœ€è¦æŸ¥è¯¢çš„é¡µé¢çš„idï¼Œé¡µé¢çš„idå¯ä»¥ç›´æ¥ä»é“¾æ¥ä¸­æ‰¾åˆ°,ä¸‹å¦‚çº¢æ¡†ä¸­çš„ä¸€ä¸²ï¼ˆä» / åˆ° ï¼Ÿä¸­é—´ ï¼‰å°±æ˜¯idã€‚

![https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/DZlBeA.png](https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/DZlBeA.png)

ğŸ’¡ è¿™ä¸ªé¡µé¢é“¾æ¥ä¸€å®šæ˜¯æ•°æ®è¡¨çš„é¡µé¢ï¼Œå¦‚æœæ•°æ®è¡¨åµŒåœ¨å…¶ä»–é¡µé¢ä¸­ï¼Œå¯ä»¥ç‚¹å‡»æ•°æ®è¡¨å³ä¸Šæ–¹Open as a full page

æˆ‘æˆªå–äº†æŸ¥è¯¢è¯·æ±‚è¿”å›å€¼çš„å‡ ä¸ªPropertyï¼š

    "é¡µæ•°": {
        "id": "U_TO",
        "type": "number",
        "number": 528
    },
    "ä¹¦å": {
        "id": "title",
        "type": "title",
        "title": [
            {
                "type": "text",
                "text": {
                    "content": "åˆ‡å°”è¯ºè´åˆ©çš„åˆå¤œ",
                    "link": null
                },
                "annotations": {
                    "bold": false,
                    "italic": false,
                    "strikethrough": false,
                    "underline": false,
                    "code": false,
                    "color": "default"
                },
                "plain_text": "åˆ‡å°”è¯ºè´åˆ©çš„åˆå¤œ",
                "href": null
            }
        ]
    }ï¼Œ
    "å°é¢": {
        "id": "jZol",
        "type": "files",
        "files": [
            {
                "name": "https://img1.doubanio.com/view/subject/l/public/s33836089.jpg",
                "type": "external",
                "external": {
                    "url": "https://img1.doubanio.com/view/subject/l/public/s33836089.jpg"
                }
            }
        ]
    },
    

æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†å¯¹åº”çš„å€¼æ›¿æ¢æˆæˆ‘ä»¬ä¹‹å‰è·å–åˆ°çš„ä¿¡æ¯ã€‚è¿™é‡Œé¢æœ‰å¾ˆå¤šå­—æ®µæ˜¯æˆ‘ä»¬ä¸éœ€è¦çš„ï¼Œæ¯”å¦‚â€œidâ€ï¼Œæˆ–è€…"annotations" ã€‚Notionä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨è¡¥å…¨ã€‚

ğŸ’¡ éœ€è¦æ³¨æ„çš„æ˜¯filesç±»å‹çš„porpertyï¼Œå®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„æ ·ä¾‹ä¸­externalå­—æ®µæ˜¯"external": "\[https://website.domain/images/space.png\](https://website.domain/images/space.png)"ï¼Œä½†è¿™æ ·æ„å»ºçš„è¯åé¢å‘é€æ–°å»ºè¯·æ±‚ä¼šè¿”å›400ï¼Œä»ä¸Šé¢æŸ¥è¯¢è¯·æ±‚çš„è¿”å›å€¼å¯ä»¥çœ‹åˆ°ï¼Œexternalåé¢æ¥çš„æ˜¯ä¸€ä¸ªobjectï¼Œä¹Ÿå°±æ˜¯è¦å†™æˆ"external": {"url":"\[https://website.domain/images/space.png\](https://website.domain/images/space.png)â€ }

æˆ‘æ„å»ºçš„å®Œæ•´çš„Propertyå¦‚ä¸‹ï¼š

    body = {
          "parent": { "type": "database_id", "database_id":  database_id},
          "properties": {
              "ä¹¦å": {
                  "type": "title",
                  "title": [{"type": "text", "text": {"content": info.get("title",' ')}}]
              },
              "è±†ç“£é“¾æ¥": {
                  "url": url
              },
              "ISBN": {
                  "type": "rich_text", 
                  "rich_text": [{"type": "text", "text": {"content": info.get("ISBN",'')}}]
              },
              "é¡µæ•°": {
                  "number": int(info.get("é¡µæ•°",0))
              },
              "å‡ºç‰ˆç¤¾": {
                  "type": "rich_text",
                  "rich_text": [{"type": "text", "text": {"content": info.get("å‡ºç‰ˆç¤¾",' ')}}]
              },
              "è¯„åˆ†": {
                  "number": float(info["score"])
              },
              "ä½œè€…": {
                  "type": "rich_text",
                  "rich_text": [{"type": "text", "text": {"content": info.get('ä½œè€…','')}}]
              },
              "æ ‡ç­¾": {
                  "type": "multi_select",
                  "multi_select": [{"name": info.get('tag')}]
              },
              "å°é¢": {
                  "files": [
                      {
                          "type": "external",
                          "name": info['cover'],
                          "external": {"url": info['cover']}
                      }
                  ]
              },
              "çŠ¶æ€": {
                  "type": "select",
                  "select": {
                      "name": info.get('status'),
                  }
              },
          },
      }
    

ä¹‹åå°†è¿™ä¸ªBodyä½œä¸ºè¯·æ±‚çš„ä¸»ä½“å‘é€åˆ°ç›¸åº”çš„Notion APIå°±å¯ä»¥åœ¨æˆ‘ä»¬çš„æ•°æ®è¡¨ä¸­æ·»åŠ ä¸€æ¡æ–°çš„è®°å½•å•¦ã€‚

    re = requests.request(
            "POST",
            "https://api.notion.com/v1/pages",
            json= body,
            headers={"Authorization": "Bearer " + token, "Notion-Version": "2022-02-22"},
    
        )
    

å®Œæ•´ä»£ç å¯ä»¥ä»æˆ‘çš„Githubè·å¾—ï¼š[Notion\_douban](https://github.com/lyh081/Notion_douban)

æ•ˆæœ
--

æœ€ç»ˆçš„æ•ˆæœå¦‚ä¸‹ï¼š

![https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/QGNrnx.png](https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/QGNrnx.png)

è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªGallery Viewï¼š

![https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/rremvg.png](https://cetus-img.oss-cn-beijing.aliyuncs.com/uPic/2022_03/rremvg.png)