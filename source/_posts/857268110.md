---
layout: post
title: "并发编程之临界区\阻塞\非阻塞\死锁\饥饿\活锁"
date: "2022-05-11T01:49:42.746Z"
---
并发编程之临界区\\阻塞\\非阻塞\\死锁\\饥饿\\活锁
=============================

本文介绍并发编程中的若干概念，实际上在笔者之前的文章中，已经介绍过很多概念。比如：并发与并行、同步与异步、锁与信号量等等。参考[《并发编程专栏》](https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU0NDU5MTk1MQ==&action=getalbum&album_id=1576334194996232194#wechat_redirect)，本文计息介绍一些相对深入一些的概念

一、临界区
-----

为了方便大家理解，我们先看下面的这样一张图，我们可以把房子看作一个进程，每个房子里面的住户及其活动看作一个线程，饮水机、健身器材、厕所都属于共享资源。**这里的共享资源实际就是临界区的概念**，临界区的资源在同一时间只能被一个线程(住户)使用，所以一旦临界资源被占用，其他的线程(住户)能做的就只有等待。

![](https://img2022.cnblogs.com/other/1815316/202205/1815316-20220511081832927-1816061239.png)

比如，在一个出租房内，住户A占用了厕所，在他使用厕所的这段时间内厕所这个资源就是他独占的。如果住户B此时也想上厕所，就只能等待住户A上完厕所之后才可以继续使用该资源。

二、阻塞和非阻塞
--------

了解了临界区的概念之后，阻塞概念就好理解了。一个线程先占用了临界区的资源，此时如果其他的线程想使用临界区资源就必须等待。**这种占用临界区资源，阻塞其他线程继续执行的情况就是线程阻塞**（Blocking）。

然而**说到非阻塞，一般说的就是是否对当前线程自己产生阻塞**，比如：

*   我执行一个任务，比如使用饮水机接水。我拿了一个杯子接水，而我必须在饮水机前面等着水接完，这种就是阻塞式线程。
*   如果我拿了杯子接水，把杯子放到饮水机下面，饮水机会在杯子接满水之后，自动对我发出异步通知(比如声音告警)。我**可以在此期间做其他的事情，这种就是非阻塞式线程（Non-Blocking）**。非阻塞式线程，从编程的角度一般都是通过回调函数，或者响应式编程(Reactive programming)实现的。

三、死锁、饥饿和活锁
----------

*   死锁：我们来看上面的这张图，在十字路口A车道的A1车像转向B车道，但B车道入口被B1车占用；在十字路口B车道的B1车像转向C车道，但C车道入口被C1车占用；在十字路口C车道的C1车像转向D车道，但D车道入口被D1车占用；在十字路口D车道的D1车像转向A车道，但A车道入口被A1车占用；也就是说：**线程因为资源竞争，彼此需要资源又都无法释放，导致线程无法获取下一步执行所需的资源，导致死锁产生。**

![](https://img2022.cnblogs.com/other/1815316/202205/1815316-20220511081833342-1795042443.png)

*   饥饿：举个例子农民给小鸡喂食，如果有五只鸡每次都刚好给五只鸡的饲料量。无法避免的是有的鸡吃的量超过规划量，最总导致某一只鸡无法吃到足够的饲料。由于它无法迟到足够的饲料，它就比较瘦弱，抢食的能力弱。恶性循环，最终很可能被饿死。具体到编程层面，就是**某一线程A的优先级比较低，然后优先级高的线程又经常占用资源不释放，线程A长期无法得到有效执行，处于饥饿状态**。极端情况下，可能被饿死。
    
*   活锁：相对于死锁和饥饿，活锁是一种相对好的状态。大家在生活中肯定遇到过这样一种情况，你在楼梯拐角遇到一个同事，空间有限所以二人茬住了。**你向左移动，你的同事也向左移动；你向右移动，你的同事也向右移动；所以你们两个人都无法向前移动，这就是一个典型的活锁**。因为人是高智慧的动物，又都懂得礼让，所以对于人来说活锁的问题很好解决，只要其中一个人原地不动，另一个人动一下就过去了。但是多线程面对活锁的时候就没有那么智能了，有可能出现不断地释放资源(向左移)、占用资源(向右移)的循环中，即使最终活锁被解开，其资源开销及时间成本都是很大的。
    

欢迎关注我的博客，更多精品知识合集
-----------------

本文转载注明出处（必须带连接，不能只转文字）：[字母哥博客](http://www.zimug.com) - zimug.com

**觉得对您有帮助的话，帮我点赞、分享！您的支持是我不竭的创作动力！**。另外，笔者最近一段时间输出了如下的精品内容，期待您的关注。

*   [《kafka修炼之道》](https://www.kancloud.cn/hanxt/kafka/content)
*   [《手摸手教你学Spring Boot2.0》](https://www.kancloud.cn/hanxt/springboot2/content)
*   [《Spring Security-JWT-OAuth2一本通》](https://www.kancloud.cn/hanxt/springsecurity/content)
*   [《实战前后端分离RBAC权限管理系统》](https://www.kancloud.cn/hanxt/vue-spring/content)
*   [《实战SpringCloud微服务从青铜到王者》](https://www.kancloud.cn/hanxt/springcloud/content)