---
layout: post
title: "测试平台系列(97) 完善执行case部分"
date: "2022-06-12T19:13:54.857Z"
---
测试平台系列(97) 完善执行case部分
=====================

> 大家好~我是`米洛`！  
>   
> 我正在从0到1打造一个开源的接口测试平台, 也在编写一套与之对应的`教程`，希望大家多多支持。  
>   
> 欢迎关注我的公众号`米洛的测开日记`，获取最新文章教程!

### 回顾

上一节我们讨论了`怎么结束一个异步任务`，我们还没有完全运用到项目之中。不过没关系，我们还有更紧要的事情要做:

**由于之前完成了数据驱动，导致我们执行case的时候需要带上环境数据了，所以之前的在线执行case功能已经不能继续用了。**

![](https://img2022.cnblogs.com/blog/726435/202206/726435-20220612231445423-1327599645.png)

会出现上述问题，我们需要改造下前后端。

### 先看看疗效

![](https://img2022.cnblogs.com/blog/726435/202206/726435-20220612231446721-346314374.png)

**执行单个case的时候必须选择环境。**

![](https://img2022.cnblogs.com/blog/726435/202206/726435-20220612231446706-435107786.png)

多选的时候也会出现环境。

![](https://img2022.cnblogs.com/blog/726435/202206/726435-20220612231445340-807126513.png)

执行2条数据后，会出现简单的测试报告。

### 改造后端

我们是支持批量case和单个case执行的，由于历史原因我们封装了2个接口:

*   `/request/run`
    
*   `/request/run/multiple`
    
    我们看下对应的方法:
    

![](https://img2022.cnblogs.com/blog/726435/202206/726435-20220612231449242-1602793670.png)

**由于批量执行，会生成一个测试报告，在测试计划部分我们已经支持了环境，所以我们把前端参数传入即可。**

run方法，由于我们支持了`数据驱动`，所以一个case会有多条数据的结果。这把err的判断需要去掉，因为错误信息已经在`result`里面了，不能因为有一条数据出错就停止其他数据。

最后我们需要把测试数据和`测试结果`对应起来，所以我们建立了一个ans的字典，用于存放`测试数据`和测试结果的映射。

![](https://img2022.cnblogs.com/blog/726435/202206/726435-20220612231446804-445704393.png)

### 改造前端

*   需要改变TestResult组件
    
    当传入map的时候（说明是单条case多条数据，渲染出N个tab）
    
*   改变执行和执行用例按钮
    
    使得按钮变为下拉菜单类型，并把env参数带入。
    
*   页面里面的执行按钮也需要修改
    

![](https://img2022.cnblogs.com/blog/726435/202206/726435-20220612231448795-734196719.png)

这样我们就把对应的执行功能给做好了，大家就可以在`编辑case`页面进行测试了。

* * *

今天的内容就介绍到了这里，咱们下期再见。