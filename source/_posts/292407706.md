---
layout: post
title: "SpringBootå®˜æ–¹æ”¯æŒä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œè½»é‡çº§ç”¨èµ·æ¥ä¹ŸæŒºé¦™ï¼"
date: "2022-06-08T04:31:59.222Z"
---
SpringBootå®˜æ–¹æ”¯æŒä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œè½»é‡çº§ç”¨èµ·æ¥ä¹ŸæŒºé¦™ï¼
===============================

SpringBootå®˜æ–¹æ”¯æŒä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œè½»é‡çº§ç”¨èµ·æ¥ä¹ŸæŒºé¦™ï¼

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯äºŒå“¥å‘€ã€‚å®šæ—¶ä»»åŠ¡çš„åº”ç”¨åœºæ™¯å…¶å®è›®å¸¸è§çš„ï¼Œæ¯”å¦‚è¯´ï¼š

*   æ•°æ®å¤‡ä»½
*   è®¢å•æœªæ”¯ä»˜åˆ™è‡ªåŠ¨å–æ¶ˆ
*   å®šæ—¶çˆ¬å–æ•°æ®
*   å®šæ—¶æ¨é€ä¿¡æ¯
*   å®šæ—¶å‘å¸ƒæ–‡ç« 
*   ç­‰ç­‰ï¼ˆæƒ³ä¸å‡ºæ¥äº†ï¼Œåªèƒ½ç­‰ç­‰æ¥å‡‘ï¼ŒğŸ˜†ï¼Œåæ­£åªè¦ç­‰çš„éƒ½éœ€è¦å®šæ—¶ï¼Œæ€ä¹ˆæ ·ï¼Œè¿™æ³¢åœ†åœºå¯ä»¥å§ï¼‰

ç¼–ç¨‹å–µğŸ±å®æˆ˜é¡¹ç›®é‡Œéœ€è¦åšä¸€ä¸ªå®šæ—¶å‘å¸ƒæ–‡ç« çš„åŠŸèƒ½ï¼Œä¸€å¼€å§‹æˆ‘æƒ³ç”¨ Spring Taskï¼Œäºæ˜¯ç ”ç©¶äº†ä¸€ç•ªï¼Œå‘ç° Spring Task ç”¨èµ·æ¥ç¡®å®ç®€å•ï¼Œä½†å¯¹äºå¤æ‚ä¸šåŠ¡å´ä¹Ÿæ— èƒ½ä¸ºåŠ›ã€‚

äºæ˜¯æˆ‘å°±æŠŠæ³¨æ„åŠ›æ”¾åˆ°äº† Quartz ä¸Šé¢ï¼Œè¿™æ˜¯ä¸€æ¬¾è€è€Œå¼¥åšçš„å¼€æºä»»åŠ¡è°ƒåº¦æ¡†æ¶ã€‚

![](https://img-blog.csdnimg.cn/img_convert/9d274ad030893093d7a2208b778fa521.png)

è®°å¾—æˆ‘åœ¨ 14 å¹´å¼€å‘å¤§å®—æœŸè´§äº¤æ˜“å¹³å°çš„æ—¶å€™å°±ç”¨åˆ°äº†å®ƒï¼Œæ¯å¤©å‡Œæ™¨å®šæ—¶éœ€è¦ç»Ÿè®¡ä¸€æ³¢äº¤æ˜“æ•°æ®ï¼Œç”Ÿæˆæ—¥æŠ¥æŠ¥è¡¨ï¼Œå½“æ—¶é…åˆ Cron è¡¨è¾¾å¼ç”¨çš„ã€‚

å¯æƒœåæ¥å¹³å°ç¨³å®šäº†ï¼Œæ–°çš„æ”¿ç­–å‡ºæ¥äº†ï¼Œç›´æ¥æŠŠå¤§å®—æœŸè´§äº¤æ˜“ç­äº†ã€‚äºæ˜¯æˆ‘å‘è´¢çš„æœºä¼šä¹Ÿéšç€ç ´ç­äº†ã€‚æƒ³æƒ³éƒ½è§‰å¾—å¯æƒœï¼Œå“ˆå“ˆå“ˆã€‚

![](https://img-blog.csdnimg.cn/img_convert/f99b003d588e853951bb5da25c35c5f3.png)

æ—¶å…‰èè‹’ï¼ŒQuartz å‘å±•åˆ°ç°åœ¨ï¼Œå·²ç»å¯ä»¥å’Œ Spring Boot é¡¹ç›®æ— ç¼è¡”æ¥äº†ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥å®æˆ˜ä¸€æŠŠã€‚

### Timer

JDK 1.3 å°±å¼€å§‹æ”¯æŒçš„ä¸€ç§å®šæ—¶ä»»åŠ¡çš„å®ç°æ–¹å¼ã€‚å†…éƒ¨é€šè¿‡ TaskQueue çš„ç±»æ¥å­˜æ”¾å®šæ—¶ä»»åŠ¡ï¼Œç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†ç¼ºé™·æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚è¯´ä¸€ä¸ª Timer å°±ä¼šèµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œä»»åŠ¡å¤šäº†æ€§èƒ½å°±éå¸¸å·®ï¼Œå†æ¯”å¦‚è¯´å¦‚æœæ‰§è¡Œä»»åŠ¡æœŸé—´æŸä¸ª TimerTask è€—æ—¶æ¯”è¾ƒä¹…ï¼Œå°±ä¼šå½±å“å…¶ä»–ä»»åŠ¡çš„è°ƒåº¦ã€‚

    @Slf4j
    public class TimerDemo {
        public static void main(String[] args) {
            TimerTask task = new TimerTask() {
                @Override
                public void run() {
                    log.debug("å½“å‰æ—¶é—´{}çº¿ç¨‹åç§°{}", DateTime.now(),
                            Thread.currentThread().getName());
                }
            };
            log.debug("å½“å‰æ—¶é—´{}çº¿ç¨‹åç§°{}", DateTime.now(),
                    Thread.currentThread().getName());
            Timer timer = new Timer("TimerDemo");
            timer.schedule(task,1000L);
        }
    }
    

ä»£ç è·‘èµ·æ¥åçš„æ—¥å¿—å¦‚ä¸‹æ‰€ç¤ºï¼š

    13:11:45.268 [main] DEBUG top.springtask.TimerDemo - å½“å‰æ—¶é—´2022-04-27 13:11:45çº¿ç¨‹åç§°main
    13:11:46.280 [TimerDemo] DEBUG top.springtask.TimerDemo - å½“å‰æ—¶é—´2022-04-27 13:11:46çº¿ç¨‹åç§°TimerDemo
    

### ScheduledThreadPoolExecutor

JDK 1.5 å¼€å§‹æä¾›çš„çš„å®šæ—¶ä»»åŠ¡ï¼Œå®ƒç»§æ‰¿äº† ThreadPoolExecutorï¼Œå®ç°äº† ScheduledExecutorService æ¥å£ï¼Œæ‰€ä»¥æ”¯æŒå¹¶å‘åœºæ™¯ä¸‹çš„ä»»åŠ¡æ‰§è¡Œã€‚åŒæ—¶ï¼Œä¼˜åŒ–äº† Timer çš„ç¼ºé™·ã€‚ä¸è¿‡ï¼Œç”±äºä½¿ç”¨äº†é˜Ÿåˆ—æ¥å®ç°å®šæ—¶å™¨ï¼Œå°±æœ‰å‡ºå…¥é˜Ÿåˆ—ã€è°ƒæ•´å †ç­‰æ“ä½œï¼Œæ‰€ä»¥å®šæ—¶ä¸æ˜¯éå¸¸éå¸¸å‡†ç¡®ï¼ˆå¹æ¯›æ±‚ç–µï¼‰ã€‚

    @Slf4j
    public class ScheduledThreadPoolExecutorDemo {
        public static void main(String[] args) throws InterruptedException {
            TimerTask task = new TimerTask() {
                @Override
                public void run() {
                    log.debug("å½“å‰æ—¶é—´{}çº¿ç¨‹åç§°{}", DateTime.now(),
                            Thread.currentThread().getName());
                }
            };
    
            log.debug("å½“å‰æ—¶é—´{}çº¿ç¨‹åç§°{}", DateTime.now(),
                    Thread.currentThread().getName());
            ScheduledExecutorService executorService = Executors.newScheduledThreadPool(3);
            executorService.scheduleAtFixedRate(task, 1000L,1000L, TimeUnit.MILLISECONDS);
            Thread.sleep(1000+1000*4);
            executorService.shutdown();
        }
    }
    

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

    14:43:41.740 [main] DEBUG top.springtask.ScheduledThreadPoolExecutorDemo - å½“å‰æ—¶é—´2022-04-27 14:43:41çº¿ç¨‹åç§°main
    14:43:42.752 [pool-1-thread-1] DEBUG top.springtask.ScheduledThreadPoolExecutorDemo - å½“å‰æ—¶é—´2022-04-27 14:43:42çº¿ç¨‹åç§°pool-1-thread-1
    14:43:43.748 [pool-1-thread-1] DEBUG top.springtask.ScheduledThreadPoolExecutorDemo - å½“å‰æ—¶é—´2022-04-27 14:43:43çº¿ç¨‹åç§°pool-1-thread-1
    14:43:44.749 [pool-1-thread-2] DEBUG top.springtask.ScheduledThreadPoolExecutorDemo - å½“å‰æ—¶é—´2022-04-27 14:43:44çº¿ç¨‹åç§°pool-1-thread-2
    14:43:45.749 [pool-1-thread-2] DEBUG top.springtask.ScheduledThreadPoolExecutorDemo - å½“å‰æ—¶é—´2022-04-27 14:43:45çº¿ç¨‹åç§°pool-1-thread-2
    14:43:46.749 [pool-1-thread-2] DEBUG top.springtask.ScheduledThreadPoolExecutorDemo - å½“å‰æ—¶é—´2022-04-27 14:43:46çº¿ç¨‹åç§°pool-1-thread-2
    

### Spring Task

Spring Task æ˜¯ Spring æä¾›çš„è½»é‡çº§å®šæ—¶ä»»åŠ¡å·¥å…·ï¼Œä¹Ÿå°±æ„å‘³ç€ä¸éœ€è¦å†æ·»åŠ ç¬¬ä¸‰æ–¹ä¾èµ–äº†ï¼Œç›¸æ¯”å…¶ä»–ç¬¬ä¸‰æ–¹ç±»åº“æ›´åŠ æ–¹ä¾¿æ˜“ç”¨ã€‚

å¥½åƒå…³äº Spring Taskï¼Œæ²¡æœ‰å…¶ä»–åºŸè¯å¯è¯´äº†ï¼Œæˆ‘ä»¬æ¥ç›´æ¥ä¸Šæ‰‹ã€‚

ç¬¬ä¸€æ­¥ï¼Œæ–°å»ºé…ç½®ç±» SpringTaskConfigï¼Œå¹¶æ·»åŠ  @EnableSchedulingæ³¨è§£å¼€å¯ Spring Taskã€‚

    @Configuration
    @EnableScheduling
    public class SpringTaskConfig {
    }
    

å½“ç„¶äº†ï¼Œä¹Ÿå¯ä»¥ä¸æ–°å»ºè¿™ä¸ªé…ç½®ç±»ï¼Œç›´æ¥åœ¨ä¸»ç±»ä¸Šæ·»åŠ  @EnableScheduling æ³¨è§£ã€‚

    @SpringBootApplication
    @EnableScheduling
    public class CodingmoreSpringtaskApplication {
    
    	public static void main(String[] args) {
    		SpringApplication.run(CodingmoreSpringtaskApplication.class, args);
    	}
    
    }
    

ç¬¬äºŒæ­¥ï¼Œæ–°å»ºå®šæ—¶ä»»åŠ¡ç±» CronTaskï¼Œä½¿ç”¨ @Scheduled æ³¨è§£æ³¨å†Œ Cron è¡¨è¾¾å¼æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚

    @Slf4j
    @Component
    public class CronTask {
        @Scheduled(cron = "0/1 * * ? * ?")
        public void cron() {
            log.info("å®šæ—¶æ‰§è¡Œï¼Œæ—¶é—´{}", DateUtil.now());
        }
    }
    

å¯åŠ¨æœåŠ¡å™¨ç«¯ï¼Œå‘ç°æ¯éš”ä¸€ç§’é’Ÿä¼šæ‰“å°ä¸€æ¬¡æ—¥å¿—ï¼Œè¯æ˜ Spring Task çš„ cron è¡¨è¾¾å¼å½¢å¼å·²ç»èµ·æ•ˆäº†ã€‚

![](https://img-blog.csdnimg.cn/img_convert/904100a8b601305738f7329584ea3e96.png)

é»˜è®¤æƒ…å†µä¸‹ï¼Œ@Scheduled åˆ›å»ºçš„çº¿ç¨‹æ± å¤§å°ä¸º 1ï¼Œå¦‚æœæƒ³å¢åŠ çº¿ç¨‹æ± å¤§å°çš„è¯ï¼Œå¯ä»¥è®© SpringTaskConfig ç±»å®ç° SchedulingConfigurer æ¥å£ï¼Œé€šè¿‡ setPoolSize å¢åŠ çº¿ç¨‹æ± å¤§å°ã€‚

    @Configuration
    @EnableScheduling
    public class SpringTaskConfig implements SchedulingConfigurer {
        @Override
        public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {
            ThreadPoolTaskScheduler threadPoolTaskScheduler = new ThreadPoolTaskScheduler();
    
            threadPoolTaskScheduler.setPoolSize(10);
            threadPoolTaskScheduler.setThreadNamePrefix("my-scheduled-task-pool-");
            threadPoolTaskScheduler.initialize();
    
            taskRegistrar.setTaskScheduler(threadPoolTaskScheduler);
        }
    }
    

æœåŠ¡çƒ­éƒ¨ç½²å®Œæˆåï¼Œä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°è¿™æ ·çš„ä¿¡æ¯ï¼š

![](https://img-blog.csdnimg.cn/img_convert/9d79786d25083d874783b795bc9f0c6b.png)

å¯ä»¥ç¡®è®¤è‡ªå®šä¹‰çº¿ç¨‹æ± å¤§å°å·²ç»ç”Ÿæ•ˆäº†ï¼Œæœ‰çš„ä»»åŠ¡ç”¨çš„æ˜¯çº¿ç¨‹led-task-pool-3ï¼Œæœ‰çš„æ˜¯çº¿ç¨‹led-task-pool-7ï¼Œè·‘æ—¶é—´é•¿äº†ï¼Œå¯ä»¥å‘ç° led-task-pool-1 åˆ° led-task-pool-10 çš„éƒ½æœ‰ã€‚

![](https://img-blog.csdnimg.cn/img_convert/6bb3d0534a27d93839f462363975d3be.png)

Spring Task é™¤äº†æ”¯æŒ Cron è¡¨è¾¾å¼ï¼Œè¿˜æœ‰ fixedRateï¼ˆå›ºå®šé€Ÿç‡æ‰§è¡Œï¼‰ã€fixedDelayï¼ˆå›ºå®šå»¶è¿Ÿæ‰§è¡Œï¼‰ã€initialDelayï¼ˆåˆå§‹å»¶è¿Ÿï¼‰ä¸‰ç§ç”¨æ³•ã€‚

    /**
     * fixedRateï¼šå›ºå®šé€Ÿç‡æ‰§è¡Œã€‚æ¯5ç§’æ‰§è¡Œä¸€æ¬¡ã€‚
     */
    @Scheduled(fixedRate = 5000)
    public void reportCurrentTimeWithFixedRate() {
        log.info("Current Thread : {}", Thread.currentThread().getName());
        log.info("Fixed Rate Task : The time is now {}", DateUtil.now());
    }
    
    /**
     * fixedDelayï¼šå›ºå®šå»¶è¿Ÿæ‰§è¡Œã€‚è·ç¦»ä¸Šä¸€æ¬¡è°ƒç”¨æˆåŠŸå2ç§’æ‰æ‰§ã€‚
     */
    @Scheduled(fixedDelay = 2000)
    public void reportCurrentTimeWithFixedDelay() {
        try {
            TimeUnit.SECONDS.sleep(3);
            log.info("Fixed Delay Task : The time is now {}",DateUtil.now());
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
    
    /**
     * initialDelay:åˆå§‹å»¶è¿Ÿã€‚ä»»åŠ¡çš„ç¬¬ä¸€æ¬¡æ‰§è¡Œå°†å»¶è¿Ÿ5ç§’ï¼Œç„¶åå°†ä»¥5ç§’çš„å›ºå®šé—´éš”æ‰§è¡Œã€‚
     */
    @Scheduled(initialDelay = 5000, fixedRate = 5000)
    public void reportCurrentTimeWithInitialDelay() {
        log.info("Fixed Rate Task with Initial Delay : The time is now {}", DateUtil.now());
    }
    

ä¸è¿‡ï¼ŒfixedRate æœ‰ä¸ªå‘ï¼Œå‡å¦‚æŸä¸ªæ–¹æ³•çš„å®šæ—¶å™¨è®¾å®šçš„å›ºå®šé€Ÿç‡æ˜¯æ¯5ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™ä¸ªæ–¹æ³•ç°åœ¨è¦æ‰§è¡Œä¸‹é¢å››ä¸ªä»»åŠ¡ï¼Œå››ä¸ªä»»åŠ¡çš„è€—æ—¶æ˜¯ï¼š6sã€6sã€ 2sã€ 3sï¼Œä»»åŠ¡ä¼šå¦‚ä½•æ‰§è¡Œå‘¢ï¼ˆå•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼‰ï¼Ÿ

    2022-04-27 15:25:52.400  INFO 4343 --- [led-task-pool-1] c.codingmore.component.PublishPostTask   : Fixed Rate Task : The time is now 2022-04-27 15:25:52
    2022-04-27 15:25:58.401  INFO 4343 --- [led-task-pool-1] c.codingmore.component.PublishPostTask   : Fixed Rate Task : The time is now 2022-04-27 15:25:58
    2022-04-27 15:26:00.407  INFO 4343 --- [led-task-pool-1] c.codingmore.component.PublishPostTask   : Fixed Rate Task : The time is now 2022-04-27 15:26:00
    2022-04-27 15:26:04.318  INFO 4343 --- [led-task-pool-1] c.codingmore.component.PublishPostTask   : Fixed Rate Task : The time is now 2022-04-27 15:26:04
    

ç¬¬ä¸€ä¸ªä»»åŠ¡å¼€å§‹çš„ç›¸å¯¹æ—¶é—´æ˜¯ç¬¬ 0 ç§’ï¼Œä½†ç”±äºæ‰§è¡Œäº† 6 ç§’ï¼Œæ‰€ä»¥åŸæ¥åº”è¯¥æ˜¯ç¬¬ 5 ç§’æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå»¶è¿Ÿåˆ°ç¬¬ 6 ç§’æ‰å¼€å§‹æ‰§è¡Œï¼Œç¬¬ä¸‰ä¸ªä»»åŠ¡å»¶è¿Ÿäº† 12 ç§’ï¼ŒåŸæœ¬åº”è¯¥æ˜¯ç¬¬ 10 ç§’æ‰§è¡Œï¼Œç¬¬ä¸‰ä¸ªä»»åŠ¡æ²¡æœ‰å»¶è¿Ÿï¼Œæ­£å¸¸ 15 ç§’åæ‰§è¡Œã€‚

å‡å¦‚æˆ‘ä»¬ä½¿ç”¨ @EnableAsync æ³¨è§£å¼€å¯å¤šçº¿ç¨‹ç¯å¢ƒçš„è¯ï¼Œç»“æœä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ

    2022-04-27 15:33:01.385  INFO 4421 --- [led-task-pool-1] c.codingmore.component.PublishPostTask   : Fixed Rate Task : The time is now 2022-04-27 15:33:01
    2022-04-27 15:33:07.390  INFO 4421 --- [led-task-pool-1] c.codingmore.component.PublishPostTask   : Fixed Rate Task : The time is now 2022-04-27 15:33:07
    2022-04-27 15:33:09.391  INFO 4421 --- [led-task-pool-1] c.codingmore.component.PublishPostTask   : Fixed Rate Task : The time is now 2022-04-27 15:33:09
    2022-04-27 15:33:13.295  INFO 4421 --- [led-task-pool-1] c.codingmore.component.PublishPostTask   : Fixed Rate Task : The time is now 2022-04-27 15:33:13
    

### å…³äº Cron è¡¨è¾¾å¼

è¿™é‡Œé¡ºå¸¦æ™®åŠä¸€ä¸‹ Cron è¡¨è¾¾å¼ï¼Œåœ¨å®šæ—¶ä»»åŠ¡ä¸­ä¼šç»å¸¸ä¼šé‡åˆ°ã€‚Cron è¿™ä¸ªè¯æ¥æºäºå¸Œè…Šè¯­ chronosï¼ŒåŸæ„ä¹Ÿå°±æ˜¯æ—¶é—´ã€‚

Cron è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå«æœ‰æ—¶é—´æ„ä¹‰çš„å­—ç¬¦ä¸²ï¼Œä»¥ 5 ä¸ªç©ºæ ¼éš”å¼€ï¼Œåˆ†æˆ 6 ä¸ªæ—¶é—´å…ƒç´ ã€‚ä¸¾å‡ ä¸ªä¾‹å­å°±ä¸€ç›®äº†ç„¶äº†ã€‚

ç¤ºä¾‹

è¯´æ˜

`0 15 10 ? * *`

æ¯å¤©ä¸Šåˆ10:15æ‰§è¡Œä»»åŠ¡

`0 0 10,14,16 * * ?`

æ¯å¤©10 ç‚¹ã€14 ç‚¹ã€16 ç‚¹æ‰§è¡Œä»»åŠ¡

`0 0 12 ? * 3`

æ¯ä¸ªæ˜ŸæœŸä¸‰ä¸­åˆ 12 ç‚¹æ‰§è¡Œä»»åŠ¡

`0 15 10 15 * ?`

æ¯æœˆ 15 æ—¥ä¸Šåˆ 10 ç‚¹ 15 æ‰§è¡Œä»»åŠ¡

Cron çš„è¯­æ³•æ ¼å¼å¯ä»¥æ€»ç»“ä¸ºï¼š

> Seconds Minutes Hours DayofMonth Month DayofWeek

æ¯ä¸ªæ—¶é—´å…ƒç´ çš„å–å€¼èŒƒå›´ï¼Œä»¥åŠå¯å‡ºç°çš„ç‰¹æ®Šå­—ç¬¦å¦‚ä¸‹æ‰€ç¤ºã€‚

æ—¶é—´å…ƒç´ 

å–å€¼èŒƒå›´

å¯å‡ºç°çš„ç‰¹æ®Šå­—ç¬¦

ç§’

`[0,59]`

`*,-/`

åˆ†é’Ÿ

`[0,59]`

`*,-/`

å°æ—¶

`[0,59]`

`*,-/`

æ—¥æœŸ

`[0,31]`

`*,-/?LW`

æœˆä»½

`[1,12]`

`*,-/`

æ˜ŸæœŸ

`[1,7]`

`*,-/?L#`

ç‰¹æ®Šå­—ç¬¦çš„å«ä¹‰å’Œç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºã€‚

ç‰¹æ®Šå­—ç¬¦

å«ä¹‰

ç¤ºä¾‹

`*`

æ‰€æœ‰å¯èƒ½çš„å€¼

å¾ˆå¥½ç†è§£ï¼ŒæœˆåŸŸä¸­ä¸ºæ¯ä¸ªæœˆï¼Œæ˜ŸæœŸåŸŸä¸­æ¯ä¸ªæ˜ŸæœŸå‡ 

`,`

æšä¸¾çš„å€¼

å¾ˆå¥½ç†è§£ï¼Œå°æ—¶åŸŸä¸­ `10,14,16`ï¼Œå°±è¡¨ç¤ºè¿™å‡ ä¸ªå°æ—¶å¯é€‰

`-`

èŒƒå›´

å¾ˆå¥½ç†è§£ï¼Œåˆ†é’ŸåŸŸä¸­ `10-19`ï¼Œå°±è¡¨ç¤º 10-19 åˆ†é’Ÿæ¯éš”ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡

`/`

æŒ‡å®šæ•°å€¼çš„å¢é‡

å¾ˆå¥½ç†è§£ï¼Œåˆ†é’ŸåŸŸä¸­ `0/15`ï¼Œå°±è¡¨ç¤ºæ¯éš” 15 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡

`?`

ä¸æŒ‡å®šå€¼

å¾ˆå¥½ç†è§£ï¼Œæ—¥æœŸåŸŸæŒ‡å®šäº†æ˜ŸæœŸåŸŸå°±ä¸èƒ½æŒ‡å®šå€¼ï¼Œåä¹‹äº¦ç„¶ï¼Œå› ä¸ºæ—¥æœŸåŸŸå’Œæ˜ŸæœŸåŸŸå±äºå†²çªå…³ç³»

`L`

å•è¯ Last çš„é¦–å­—æ¯

å¾ˆå¥½ç†è§£ï¼Œæ—¥æœŸåŸŸå’Œæ˜ŸæœŸåŸŸæ”¯æŒï¼Œè¡¨ç¤ºæœˆçš„æœ€åä¸€å¤©æˆ–è€…æ˜ŸæœŸçš„æœ€åä¸€å¤©

`W`

é™¤å‘¨æœ«ä»¥å¤–çš„å·¥ä½œæ—¥

å¾ˆå¥½ç†è§£ï¼Œä»…æ—¥æœŸåŸŸæ”¯æŒ

`#`

æ¯ä¸ªæœˆçš„ç¬¬å‡ ä¸ªæ˜ŸæœŸå‡ 

å¾ˆå¥½ç†è§£ï¼Œä»…æ˜ŸæœŸåŸŸæ”¯æŒï¼Œ`4#2`è¡¨ç¤ºæŸæœˆçš„ç¬¬äºŒä¸ªæ˜ŸæœŸå››

### å…³äº Quartz

Quartz æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„å¼€æºçš„ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼Œåœ¨ GitHub ä¸Šå·²ç»ç´¯è®¡æœ‰ 5k+ çš„ star äº†ã€‚å°åˆ°å•æœºåº”ç”¨ï¼Œå¤§åˆ°åˆ†å¸ƒå¼ï¼Œéƒ½å¯ä»¥æ•´åˆ Quartzã€‚

![](https://img-blog.csdnimg.cn/img_convert/8793ee521817cd85265ead50b65b220c.png)

åœ¨ä½¿ç”¨ Quartz ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ¥ææ¸…æ¥š 4 ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š

*   Jobï¼šä»»åŠ¡ï¼Œè¦æ‰§è¡Œçš„å…·ä½“å†…å®¹ã€‚
*   JobDetailï¼šä»»åŠ¡è¯¦æƒ…ï¼ŒJob æ˜¯å®ƒè¦æ‰§è¡Œçš„å†…å®¹ï¼ŒåŒæ—¶åŒ…å«äº†è¿™ä¸ªä»»åŠ¡è°ƒåº¦çš„ç­–ç•¥å’Œæ–¹æ¡ˆã€‚
*   Triggerï¼šè§¦å‘å™¨ï¼Œå¯ä»¥é€šè¿‡ Cron è¡¨è¾¾å¼æ¥æŒ‡å®šä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´ã€‚
*   Schedulerï¼šè°ƒåº¦å™¨ï¼Œå¯ä»¥æ³¨å†Œå¤šä¸ª JobDetail å’Œ Triggerï¼Œç”¨æ¥è°ƒåº¦ã€æš‚åœå’Œåˆ é™¤ä»»åŠ¡ã€‚

### æ•´åˆ Quartz

Quartz å­˜å‚¨ä»»åŠ¡çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä½¿ç”¨å†…å­˜ï¼Œå¦å¤–ä¸€ç§æ˜¯ä½¿ç”¨æ•°æ®åº“ã€‚å†…å­˜åœ¨ç¨‹åºé‡å¯åå°±ä¸¢å¤±äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™æ¬¡ä½¿ç”¨æ•°æ®åº“çš„æ–¹å¼æ¥è¿›è¡Œä»»åŠ¡çš„æŒä¹…åŒ–ã€‚

ç¬¬ä¸€æ­¥ï¼Œåœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ  Quartz çš„ starterã€‚

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-quartz</artifactId>
        <version>2.6.7</version>
    </dependency>
    

ç¬¬äºŒæ­¥ï¼Œåœ¨ application.yml æ·»åŠ  Quartz ç›¸å…³é…ç½®ï¼Œé…ç½®è¯´æ˜ç›´æ¥çœ‹æ³¨é‡Šã€‚

    spring:
      quartz:
        job-store-type: jdbc # é»˜è®¤ä¸ºå†…å­˜ memory çš„æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ•°æ®åº“çš„å½¢å¼
        wait-for-jobs-to-complete-on-shutdown: true # å…³é—­æ—¶ç­‰å¾…ä»»åŠ¡å®Œæˆ
        overwrite-existing-jobs: true # å¯ä»¥è¦†ç›–å·²æœ‰çš„ä»»åŠ¡
        jdbc:
          initialize-schema: never # æ˜¯å¦è‡ªåŠ¨ä½¿ç”¨ SQL åˆå§‹åŒ– Quartz è¡¨ç»“æ„
        properties: # quartzåŸç”Ÿé…ç½®
          org:
            quartz:
              scheduler:
                instanceName: scheduler # è°ƒåº¦å™¨å®ä¾‹åç§°
                instanceId: AUTO # è°ƒåº¦å™¨å®ä¾‹IDè‡ªåŠ¨ç”Ÿæˆ
              # JobStore ç›¸å…³é…ç½®
              jobStore:
                class: org.quartz.impl.jdbcjobstore.JobStoreTX # JobStore å®ç°ç±»
                driverDelegateClass: org.quartz.impl.jdbcjobstore.StdJDBCDelegate # ä½¿ç”¨å®Œå…¨å…¼å®¹JDBCçš„é©±åŠ¨
                tablePrefix: QRTZ_ # Quartz è¡¨å‰ç¼€
                useProperties: false # æ˜¯å¦å°†JobDataMapä¸­çš„å±æ€§è½¬ä¸ºå­—ç¬¦ä¸²å­˜å‚¨
              # çº¿ç¨‹æ± ç›¸å…³é…ç½®
              threadPool:
                threadCount: 25 # çº¿ç¨‹æ± å¤§å°ã€‚é»˜è®¤ä¸º 10 ã€‚
                threadPriority: 5 # çº¿ç¨‹ä¼˜å…ˆçº§
                class: org.quartz.simpl.SimpleThreadPool # æŒ‡å®šçº¿ç¨‹æ± å®ç°ç±»ï¼Œå¯¹è°ƒåº¦å™¨æä¾›å›ºå®šå¤§å°çš„çº¿ç¨‹æ± 
    

Quartz é»˜è®¤ä½¿ç”¨çš„æ˜¯å†…å­˜çš„æ–¹å¼æ¥å­˜å‚¨ä»»åŠ¡ï¼Œä¸ºäº†æŒä¹…åŒ–ï¼Œæˆ‘ä»¬è¿™é‡Œæ”¹ä¸º JDBC çš„å½¢å¼ï¼Œå¹¶ä¸”æŒ‡å®š `spring.quartz.jdbc.initialize-schema=never`ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨åˆ›å»ºæ•°æ®è¡¨ã€‚å› ä¸ºè¯¥å€¼çš„å¦å¤–ä¸¤ä¸ªé€‰é¡¹ALWAYSå’ŒEMBEDDEDéƒ½ä¸å¤ªç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼š

*   ALWAYSï¼šæ¯æ¬¡éƒ½åˆå§‹åŒ–
*   EMBEDDEDï¼šåªåˆå§‹åŒ–åµŒå…¥å¼æ•°æ®åº“ï¼Œæ¯”å¦‚è¯´ H2ã€HSQL

é‚£æ‰‹åŠ¨åˆ›å»ºæ•°æ®è¡¨çš„ SQL è¯­å¥å»å“ªé‡Œæ‰¾å‘¢ï¼Ÿ

> GitHub åœ°å€ï¼š[https://github.com/quartz-scheduler/quartz/tree/master/quartz-core/src/main/resources/org/quartz/impl/jdbcjobstore](https://github.com/quartz-scheduler/quartz/tree/master/quartz-core/src/main/resources/org/quartz/impl/jdbcjobstore)

ä¸ºäº†æ–¹ä¾¿å°ä¼™ä¼´ä»¬ä¸‹è½½ï¼Œæˆ‘æŠŠå®ƒæ”¾åœ¨äº†æœ¬æ•™ç¨‹çš„æºç é‡Œé¢äº†ï¼š

![](https://img-blog.csdnimg.cn/img_convert/9c7899faccd503ddbf7ddc51c2f397a9.png)

å¦‚æœä½¿ç”¨ Intellij IDEA æ——èˆ°ç‰ˆçš„è¯ï¼Œé¦–æ¬¡æ‰“å¼€ SQL æ–‡ä»¶çš„æ—¶å€™ä¼šæç¤ºä½ æŒ‡å®šæ•°æ®æºã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘é…ç½®äº†æœ¬åœ°çš„ MySQL æ•°æ®åº“ï¼Œå¯¼å…¥æˆåŠŸåå¯ä»¥åœ¨æ•°æ®åº“ä¸­æŸ¥çœ‹åˆ°ä»¥ä¸‹æ•°æ®è¡¨ï¼š

![](https://img-blog.csdnimg.cn/img_convert/fe6c102272214127d383d29632ba2330.png)

Quartzæ•°æ®åº“æ ¸å¿ƒè¡¨å¦‚ä¸‹ï¼š

Table Name

Description

QRTZ\_CALENDARS

å­˜å‚¨Quartzçš„Calendarä¿¡æ¯

QRTZ\_CRON\_TRIGGERS

å­˜å‚¨CronTriggerï¼ŒåŒ…æ‹¬Cronè¡¨è¾¾å¼å’Œæ—¶åŒºä¿¡æ¯

QRTZ\_FIRED\_TRIGGERS

å­˜å‚¨ä¸å·²è§¦å‘çš„Triggerç›¸å…³çš„çŠ¶æ€ä¿¡æ¯ï¼Œä»¥åŠç›¸è”Jobçš„æ‰§è¡Œä¿¡æ¯

QRTZ\_PAUSED\_TRIGGER\_GRPS

å­˜å‚¨å·²æš‚åœçš„Triggerç»„çš„ä¿¡æ¯

QRTZ\_SCHEDULER\_STATE

å­˜å‚¨å°‘é‡çš„æœ‰å…³Schedulerçš„çŠ¶æ€ä¿¡æ¯ï¼Œå’Œåˆ«çš„Schedulerå®ä¾‹

QRTZ\_LOCKS

å­˜å‚¨ç¨‹åºçš„æ‚²è§‚é”çš„ä¿¡æ¯

QRTZ\_JOB\_DETAILS

å­˜å‚¨æ¯ä¸€ä¸ªå·²é…ç½®çš„Jobçš„è¯¦ç»†ä¿¡æ¯

QRTZ\_JOB\_LISTENERS

å­˜å‚¨æœ‰å…³å·²é…ç½®çš„JobListenerçš„ä¿¡æ¯

QRTZ\_SIMPLE\_TRIGGERS

å­˜å‚¨ç®€å•çš„Triggerï¼ŒåŒ…æ‹¬é‡å¤æ¬¡æ•°ã€é—´éš”ã€ä»¥åŠå·²è§¦çš„æ¬¡æ•°

QRTZ\_BLOG\_TRIGGERS

Triggerä½œä¸ºBlobç±»å‹å­˜å‚¨

QRTZ\_TRIGGER\_LISTENERS

å­˜å‚¨å·²é…ç½®çš„TriggerListenerçš„ä¿¡æ¯

QRTZ\_TRIGGERS

å­˜å‚¨å·²é…ç½®çš„Triggerçš„ä¿¡æ¯

å‰©ä¸‹çš„å°±æ˜¯å¯¹ Quartz çš„ schedulerã€jobStore å’Œ threadPool é…ç½®ã€‚

ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºä»»åŠ¡è°ƒåº¦çš„æ¥å£ IScheduleServiceï¼Œå®šä¹‰ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯é€šè¿‡ Cron è¡¨è¾¾å¼æ¥è°ƒåº¦ä»»åŠ¡ã€æŒ‡å®šæ—¶é—´æ¥è°ƒåº¦ä»»åŠ¡ï¼Œä»¥åŠå–æ¶ˆä»»åŠ¡ã€‚

    public interface IScheduleService {
        /**
         * é€šè¿‡ Cron è¡¨è¾¾å¼æ¥è°ƒåº¦ä»»åŠ¡
         */
        String scheduleJob(Class<? extends Job> jobBeanClass, String cron, String data);
    
        /**
         * æŒ‡å®šæ—¶é—´æ¥è°ƒåº¦ä»»åŠ¡
         */
        String scheduleFixTimeJob(Class<? extends Job> jobBeanClass, Date startTime, String data);
    
        /**
         * å–æ¶ˆå®šæ—¶ä»»åŠ¡
         */
        Boolean cancelScheduleJob(String jobName);
    }
    

ç¬¬å››æ­¥ï¼Œåˆ›å»ºä»»åŠ¡è°ƒåº¦ä¸šåŠ¡å®ç°ç±» ScheduleServiceImplï¼Œé€šè¿‡Schedulerã€CronTriggerã€JobDetailçš„APIæ¥å®ç°å¯¹åº”çš„æ–¹æ³•ã€‚

    @Slf4j
    @Service
    public class ScheduleServiceImpl implements IScheduleService {
        private String defaultGroup = "default_group";
    
        @Autowired
        private Scheduler scheduler;
        @Override
        public String scheduleJob(Class<? extends Job> jobBeanClass, String cron, String data) {
            String jobName = UUID.fastUUID().toString();
            JobDetail jobDetail = JobBuilder.newJob(jobBeanClass)
                    .withIdentity(jobName, defaultGroup)
                    .usingJobData("data", data)
                    .build();
            //åˆ›å»ºè§¦å‘å™¨ï¼ŒæŒ‡å®šä»»åŠ¡æ‰§è¡Œæ—¶é—´
            CronTrigger cronTrigger = TriggerBuilder.newTrigger()
                    .withIdentity(jobName, defaultGroup)
                    .withSchedule(CronScheduleBuilder.cronSchedule(cron))
                    .build();
            // è°ƒåº¦å™¨è¿›è¡Œä»»åŠ¡è°ƒåº¦
            try {
                scheduler.scheduleJob(jobDetail, cronTrigger);
            } catch (SchedulerException e) {
                log.error("ä»»åŠ¡è°ƒåº¦æ‰§è¡Œå¤±è´¥{}", e.getMessage());
            }
            return jobName;
        }
    
        @Override
        public String scheduleFixTimeJob(Class<? extends Job> jobBeanClass, Date startTime, String data) {
            //æ—¥æœŸè½¬CRONè¡¨è¾¾å¼
            String startCron = String.format("%d %d %d %d %d ? %d",
                    DateUtil.second(startTime),
                    DateUtil.minute(startTime),
                    DateUtil.hour(startTime, true),
                    DateUtil.dayOfMonth(startTime),
                    DateUtil.month(startTime) + 1,
                    DateUtil.year(startTime));
            return scheduleJob(jobBeanClass, startCron, data);
        }
    
        @Override
        public Boolean cancelScheduleJob(String jobName) {
            boolean success = false;
            try {
                // æš‚åœè§¦å‘å™¨
                scheduler.pauseTrigger(new TriggerKey(jobName, defaultGroup));
                // ç§»é™¤è§¦å‘å™¨ä¸­çš„ä»»åŠ¡
                scheduler.unscheduleJob(new TriggerKey(jobName, defaultGroup));
                // åˆ é™¤ä»»åŠ¡
                scheduler.deleteJob(new JobKey(jobName, defaultGroup));
                success = true;
            } catch (SchedulerException e) {
                log.error("ä»»åŠ¡å–æ¶ˆå¤±è´¥{}", e.getMessage());
            }
            return success;
        }
    }
    

ç¬¬äº”æ­¥ï¼Œå®šä¹‰å¥½è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç»§æ‰¿ QuartzJobBean ç±»ï¼Œå®ç°  
executeInternal æ–¹æ³•ï¼Œè¿™é‡Œåªå®šä¹‰ä¸€ä¸ªå®šæ—¶å‘å¸ƒæ–‡ç« çš„ä»»åŠ¡ã€‚

    @Slf4j
    @Component
    public class PublishPostJob extends QuartzJobBean {
        @Autowired
        private IScheduleService scheduleService;
        @Autowired
        private IPostsService postsService;
    
        @Override
        protected void executeInternal(JobExecutionContext jobExecutionContext) throws JobExecutionException {
            Trigger trigger = jobExecutionContext.getTrigger();
            JobDetail jobDetail = jobExecutionContext.getJobDetail();
            JobDataMap jobDataMap = jobDetail.getJobDataMap();
            Long data = jobDataMap.getLong("data");
            log.debug("å®šæ—¶å‘å¸ƒæ–‡ç« æ“ä½œï¼š{}",data);
    
            // è·å–æ–‡ç« çš„ IDåè·å–æ–‡ç« ï¼Œæ›´æ–°æ–‡ç« ä¸ºå‘å¸ƒçš„çŠ¶æ€ï¼Œè¿˜æœ‰å‘å¸ƒçš„æ—¶é—´
            boolean success = postsService.updatePostByScheduler(data);
    
            //å®Œæˆååˆ é™¤è§¦å‘å™¨å’Œä»»åŠ¡
            if (success) {
                log.debug("å®šæ—¶ä»»åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œå¼€å§‹æ¸…é™¤å®šæ—¶ä»»åŠ¡");
                scheduleService.cancelScheduleJob(trigger.getKey().getName());
            }
        }
    }
    

ç¬¬å…­æ­¥ï¼Œå‘å¸ƒæ–‡ç« çš„æ¥å£é‡Œ PostsServiceImpl æ·»åŠ å®šæ—¶å‘å¸ƒçš„ä»»åŠ¡è°ƒåº¦æ–¹æ³•ã€‚

    @Service
    public class PostsServiceImpl extends ServiceImpl<PostsMapper, Posts> implements IPostsService {
    
        private void handleScheduledAfter(Posts posts) {
            // æ–‡ç« å·²ç»ä¿å­˜ä¸ºè‰ç¨¿äº†ï¼Œå¹¶ä¸”æ‹¿åˆ°äº†æ–‡ç«  ID
            // è°ƒç”¨å®šæ—¶ä»»åŠ¡
            String jobName = scheduleService.scheduleFixTimeJob(PublishPostJob.class, posts.getPostDate(), posts.getPostsId().toString());
            LOGGER.debug("å®šæ—¶ä»»åŠ¡{}å¼€å§‹æ‰§è¡Œ", jobName);
        }
    
    }
    

å¥½ï¼Œæˆ‘ä»¬ç°åœ¨å¯åŠ¨æœåŠ¡ï¼Œé€šè¿‡Swagger æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæ³¨æ„è®¾ç½®æ–‡ç« çš„å®šæ—¶å‘å¸ƒæ—¶é—´ã€‚

![](https://img-blog.csdnimg.cn/img_convert/88c408ba9518bba244e4851536a809a8.png)

æŸ¥çœ‹ Quartz çš„æ•°æ®è¡¨ qrtz\_cron\_triggersï¼Œå‘ç°ä»»åŠ¡å·²ç»æ·»åŠ è¿›æ¥äº†ã€‚

![](https://img-blog.csdnimg.cn/img_convert/f7ed1e108f56d186a92ddbce00b6c480.png)

qrtz\_job\_details è¡¨é‡Œä¹Ÿå¯ä»¥æŸ¥çœ‹å…·ä½“çš„ä»»åŠ¡è¯¦æƒ…ã€‚

![](https://img-blog.csdnimg.cn/img_convert/9a49e83bb5d5f0a073d2d5e2c6356207.png)

æ–‡ç« å®šæ—¶å‘å¸ƒçš„æ—¶é—´åˆ°äº†ä¹‹åï¼Œåœ¨æ—¥å¿—é‡Œä¹Ÿå¯ä»¥çœ‹åˆ° Quartz çš„æ‰§è¡Œæ—¥å¿—ã€‚

![](https://img-blog.csdnimg.cn/img_convert/27683a96bb1f78b6282e9ba4bf46b3c3.png)

å†æ¬¡æŸ¥çœ‹ Quartz æ•°æ®è¡¨ qrtz\_cron\_triggers å’Œ qrtz\_job\_details çš„æ—¶å€™ï¼Œä¹Ÿä¼šå‘ç°å®šæ—¶ä»»åŠ¡å·²ç»æ¸…é™¤äº†ã€‚

æ•´ä½“ä¸Šæ¥è¯´ï¼ŒSpring Boot æ•´åˆ Quartzè¿˜æ˜¯éå¸¸ä¸æ»‘çš„ï¼Œé…ç½®å°‘ï¼Œæ­¥éª¤æ¸…æ™°ï¼Œæ¯” Spring Task æ›´å¼ºå¤§ï¼Œæ—¢èƒ½é’ˆå¯¹å†…å­˜ä¹Ÿèƒ½æŒä¹…åŒ–ï¼Œæ‰€ä»¥å¤§å®¶åœ¨é‡åˆ°å®šæ—¶ä»»åŠ¡çš„æ—¶å€™å®Œå…¨å¯ä»¥å°è¯•ä¸€æŠŠã€‚

å®Œæ•´çš„åŠŸèƒ½åœ¨ç¼–ç¨‹å–µå®æˆ˜é¡¹ç›®ä¸­å·²ç»å®ç°äº†ï¼Œå¯ä»¥æŠŠç¼–ç¨‹å–µå¯¼å…¥åˆ°æœ¬åœ°å°è¯•ä¸€ä¸‹ã€‚

### ä¸šåŠ¡æ¢³ç†

ç®€å•æ¥æ¢³ç†ä¸€ä¸‹ç¼–ç¨‹å–µå®šæ—¶å‘å¸ƒæ–‡ç« çš„ä¸šåŠ¡ã€‚

1ï¼‰ç”¨æˆ·åœ¨å‘å¸ƒæ–‡ç« çš„æ—¶å€™å¯ä»¥é€‰æ‹©å®šæ—¶å‘å¸ƒï¼Œå¦‚æœé€‰æ‹©å®šæ—¶å‘å¸ƒï¼Œé‚£ä¹ˆå°±è¦è®¾ç½®å®šæ—¶å‘å¸ƒçš„æ—¶é—´ï¼Œæš‚æ—¶è§„å®šè‡³å°‘ååˆ†é’Ÿä»¥åå¯ä»¥å®šæ—¶ã€‚

2ï¼‰å½“ç®¡ç†ç«¯ç”¨æˆ·é€‰æ‹©äº†å®šæ—¶å‘å¸ƒï¼Œé‚£ä¹ˆåœ¨ä¿å­˜æ–‡ç« çš„æ—¶å€™ï¼Œæ–‡ç« çŠ¶æ€è¦å…ˆè®¾ç½®ä¸ºè‰ç¨¿çŠ¶æ€ï¼Œå¯¹å‰ç«¯ç”¨æˆ·æ˜¯ä¸å¯è§çš„çŠ¶æ€ã€‚

3ï¼‰ä¿å­˜æ–‡ç« çš„æ—¶å€™é€šçŸ¥ Quartzï¼Œæˆ‘æœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œä½ éœ€è¦åœ¨æŸä¸ªè§„å®šçš„æ—¶é—´å»æ‰§è¡Œã€‚

    scheduleService.scheduleFixTimeJob(PublishPostJob.class, posts.getPostDate(), posts.getPostsId().toString());
    

4ï¼‰Quartz æ”¶åˆ°è¿™ä¸ªé€šçŸ¥åï¼Œå°±ä¼šåœ¨æ•°æ®åº“ä¸­å†™å…¥ä»»åŠ¡ï¼Œå…·ä½“çš„ä»»åŠ¡æ˜¯åˆ°æŒ‡å®šæ—¶é—´æŠŠæ–‡ç« ä»è‰ç¨¿çš„çŠ¶æ€è½¬ä¸ºå‘å¸ƒçŠ¶æ€ï¼Œè¿™æ—¶å€™ï¼Œå‰ç«¯ç”¨æˆ·å°±å¯ä»¥çœ‹å¾—è§æ–‡ç« äº†ã€‚

    // è·å–æ–‡ç« çš„ IDåè·å–æ–‡ç« ï¼Œæ›´æ–°æ–‡ç« ä¸ºå‘å¸ƒçš„çŠ¶æ€ï¼Œè¿˜æœ‰å‘å¸ƒçš„æ—¶é—´
    boolean success = postsService.updatePostByScheduler(data);
    

åŒæ—¶ï¼Œå°†ä»»åŠ¡æ¸…é™¤ã€‚

    // æš‚åœè§¦å‘å™¨
    scheduler.pauseTrigger(new TriggerKey(jobName, defaultGroup));
    // ç§»é™¤è§¦å‘å™¨ä¸­çš„ä»»åŠ¡
    scheduler.unscheduleJob(new TriggerKey(jobName, defaultGroup));
    // åˆ é™¤ä»»åŠ¡
    scheduler.deleteJob(new JobKey(jobName, defaultGroup));
    

æ•´ä¸ªè¿‡ç¨‹å°±å®Œæˆäº†ã€‚Quartz æ˜¯å¦‚ä½•å®ç°å®šæ—¶å‘å¸ƒæ–‡ç« çš„å‘¢ï¼Ÿå…¶å®ä¹Ÿæ˜¯é€šè¿‡ Cron è¡¨è¾¾å¼ã€‚

    CronTrigger cronTrigger = TriggerBuilder.newTrigger()
                    .withIdentity(jobName, defaultGroup)
                    .withSchedule(CronScheduleBuilder.cronSchedule(cron))
                    .build();
    

ä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªæŒ‡å®šæ—¶é—´åï¼Œé€šè¿‡è®¡ç®—ï¼Œè®¡ç®—å‡º Cron è¡¨è¾¾å¼ã€‚

    String startCron = String.format("%d %d %d %d %d ? %d",
                    DateUtil.second(startTime),
                    DateUtil.minute(startTime),
                    DateUtil.hour(startTime, true),
                    DateUtil.dayOfMonth(startTime),
                    DateUtil.month(startTime) + 1,
                    DateUtil.year(startTime));
    

åœ¨ Quartz ä¸­ï¼Œæœ‰ä¸¤ç±»çº¿ç¨‹ï¼šSchedulerè°ƒåº¦çº¿ç¨‹å’Œä»»åŠ¡æ‰§è¡Œçº¿ç¨‹ã€‚

*   _ä»»åŠ¡æ‰§è¡Œçº¿ç¨‹_ï¼šQuartzä¸ä¼šåœ¨ä¸»çº¿ç¨‹(QuartzSchedulerThread)ä¸­å¤„ç†ç”¨æˆ·çš„Jobã€‚QuartzæŠŠçº¿ç¨‹ç®¡ç†çš„èŒè´£å§”æ‰˜ç»™ThreadPoolï¼Œä¸€èˆ¬çš„è®¾ç½®ä½¿ç”¨SimpleThreadPoolã€‚SimpleThreadPoolåˆ›å»ºäº†ä¸€å®šæ•°é‡çš„WorkerThreadå®ä¾‹æ¥ä½¿å¾—Jobèƒ½å¤Ÿåœ¨çº¿ç¨‹ä¸­è¿›è¡Œå¤„ç†ã€‚WorkerThreadæ˜¯å®šä¹‰åœ¨SimpleThreadPoolç±»ä¸­çš„å†…éƒ¨ç±»ï¼Œå®ƒå®è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚
*   _QuartzSchedulerThreadè°ƒåº¦ä¸»çº¿ç¨‹_ï¼šQuartzSchedulerè¢«åˆ›å»ºæ—¶åˆ›å»ºä¸€ä¸ªQuartzSchedulerThreadå®ä¾‹ã€‚

### æºç è·¯å¾„

> *   ç¼–ç¨‹å–µï¼š[https://github.com/itwanger/coding-more](https://github.com/itwanger/coding-more)
> *   codingmore-springtaskï¼š[https://github.com/itwanger/codingmore-learning](https://github.com/itwanger/codingmore-learning/tree/main/codingmore-springtask)
> *   codingmore-quartzï¼š[https://github.com/itwanger/codingmore-learning](https://github.com/itwanger/codingmore-learning/tree/main/codingmore-quartz)

**æœ¬æ–‡å·²æ”¶å½•åˆ° GitHub ä¸Šæ˜Ÿæ ‡ 2.4k+ çš„å¼€æºä¸“æ ã€ŠJava ç¨‹åºå‘˜è¿›é˜¶ä¹‹è·¯ã€‹ï¼Œæ®è¯´æ¯ä¸€ä¸ªä¼˜ç§€çš„ Java ç¨‹åºå‘˜éƒ½å–œæ¬¢å¥¹ï¼Œé£è¶£å¹½é»˜ã€é€šä¿—æ˜“æ‡‚ã€‚å†…å®¹åŒ…æ‹¬ Java åŸºç¡€ã€Java å¹¶å‘ç¼–ç¨‹ã€Java è™šæ‹Ÿæœºã€Java ä¼ä¸šçº§å¼€å‘ã€Java é¢è¯•ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚å­¦ Javaï¼Œå°±è®¤å‡† Java ç¨‹åºå‘˜è¿›é˜¶ä¹‹è·¯**ğŸ˜„ã€‚

[https://github.com/itwanger/toBeBetterJavaer](https://github.com/itwanger/toBeBetterJavaer)

star äº†è¿™ä¸ªä»“åº“å°±ç­‰äºä½ æ‹¥æœ‰äº†æˆä¸ºäº†ä¸€åä¼˜ç§€ Java å·¥ç¨‹å¸ˆçš„æ½œåŠ›ã€‚è¯¥å¼€æºä»“åº“æœ€è¿‘åˆä¸Š GitHub trending æ¦œå•äº†ï¼Œçœ‹æ¥æ˜¯å¤§å®¶éƒ½éå¸¸è®¤å¯å‘€ï¼

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/e22f8536873b4f57a41804ea376810f3.png)

_æ²¡æœ‰ä»€ä¹ˆä½¿æˆ‘åœç•™â€”â€”é™¤äº†ç›®çš„ï¼Œçºµç„¶å²¸æ—æœ‰ç«ç‘°ã€æœ‰ç»¿è«ã€æœ‰å®é™çš„æ¸¯æ¹¾ï¼Œæˆ‘æ˜¯ä¸ç³»ä¹‹èˆŸ_ã€‚

![](https://img-blog.csdnimg.cn/img_convert/29e81f023caee3bdfdb6698a3ad2178f.png)