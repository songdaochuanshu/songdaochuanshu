---
layout: post
title: "åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªä½“éªŒ-skywalkingå…¥é—¨ä½¿ç”¨"
date: "2022-09-13T21:19:05.176Z"
---
åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªä½“éªŒ-skywalkingå…¥é—¨ä½¿ç”¨

![åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªä½“éªŒ-skywalkingå…¥é—¨ä½¿ç”¨](https://img2022.cnblogs.com/blog/2784584/202209/2784584-20220913235359004-1459235547.png) æ—å‹ï¼Œä½ çš„çº¿ä¸ŠæœåŠ¡æ˜¯ä¸æ˜¯å¶å°”æ¥ä¸ªè¶…æ—¶ï¼Œæˆ–è€…çªç„¶æŠ–åŠ¨ä¸€ä¸‹ï¼Œé€ æˆç”¨æˆ·ä¸€å †åé¦ˆæŠ•è¯‰ã€‚ç„¶åä½ è´¹äº†ä¹ç‰›äºŒè™ä¹‹åŠ›ï¼ŒæŸ¥äº†ä¸€åœˆåœˆä»£ç å’Œæ—¥å¿—æ‰æ€»ç®—å®šä½åˆ°é—®é¢˜åŸå› äº†ã€‚ä½•ä¸äº†è§£ä¸€ä¸‹åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªæŠ€æœ¯å‘¢~

èƒŒæ™¯
==

æ—å‹ï¼Œä½ çš„çº¿ä¸ŠæœåŠ¡æ˜¯ä¸æ˜¯å¶å°”æ¥ä¸ªè¶…æ—¶ï¼Œæˆ–è€…çªç„¶æŠ–åŠ¨ä¸€ä¸‹ï¼Œé€ æˆç”¨æˆ·ä¸€å †åé¦ˆæŠ•è¯‰ã€‚ç„¶åä½ è´¹äº†ä¹ç‰›äºŒè™ä¹‹åŠ›ï¼ŒæŸ¥äº†ä¸€åœˆåœˆä»£ç å’Œæ—¥å¿—æ‰æ€»ç®—å®šä½åˆ°é—®é¢˜åŸå› äº†ã€‚æˆ–è€…å…¬å¸å†…éƒ¨æœ‰é“¾è·¯è¿½è¸ªç³»ç»Ÿï¼Œè™½ç„¶å¯ä»¥å¾ˆè½»æ¾åœ°é€šè¿‡ç›‘æ§åˆ¤æ–­é—®é¢˜å‡ºç°çš„åŸå› ï¼Œä½†æ˜¯å¯¹å…¶ä¸­çš„é€»è¾‘å®Œå…¨æ‘¸ä¸ç€å¤´è„‘ã€‚åªèƒ½ä¸Šç½‘æœç´¢ä¸€ç•ªã€‚

æ—å‹ï¼Œskywalkingåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªæ¡†æ¶äº†è§£ä¸€ä¸‹ã€‚

æœ‰çš„æ—å‹ä¼šæœ‰ç–‘æƒ‘ï¼Œæˆ‘çš„Spring Boot å°±æ˜¯ä¸€ä¸ªå•ä½“åº”ç”¨ä¹ˆï¼Œä¸éœ€è¦é“¾è·¯è¿½è¸ªï¼Ÿæœ‰é—®é¢˜ç›´æ¥ç¿»æ—¥å¿—å°±è¡Œäº†ï¼Œä½†æ˜¯å³ä½¿æ˜¯ä¸€ä¸ª Spring Boot å•ä½“åº”ç”¨ï¼Œä¹Ÿä¼šå’Œä»¥ä¸‹æœåŠ¡æ‰“äº¤é“ï¼š

*   å…³ç³»æ•°æ®åº“ï¼Œä¾‹å¦‚è¯´ MySQLã€PostgreSQL ç­‰ç­‰ã€‚
*   ç¼“å­˜æ•°æ®åº“ï¼Œä¾‹å¦‚è¯´ Redisã€Memcached ç­‰ç­‰ã€‚
*   å¤–éƒ¨ä¸‰æ–¹æœåŠ¡ï¼Œä¾‹å¦‚è¯´å¾®ä¿¡å…¬ä¼—å·ã€å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€çŸ­ä¿¡å¹³å°ç­‰ç­‰

å¯è§ï¼Œä»…ä»…ä¸€ä¸ª Spring Boot å•ä½“åº”ç”¨ï¼Œå°±å·²ç»æ¶‰åŠåˆ°åˆ†å¸ƒåœ¨**ä¸åŒè¿›ç¨‹**ä¸­çš„æœåŠ¡äº†ã€‚æ­¤æ—¶ï¼Œå°±éå¸¸æœ‰å¿…è¦ç”¨ä¸Šskywalkingã€‚ä¾‹å¦‚è¯´ï¼Œçº¿ä¸ŠæŸä¸ª æ¥å£è®¿é—®éå¸¸æ…¢ï¼Œç”¨SkyWalking å¯ä»¥å®šä½æ˜¯MySQL æŸ¥è¯¢æ¯”è¾ƒæ…¢å‘¢ï¼Œè¿˜æ˜¯è°ƒç”¨çš„ç¬¬ä¸‰æ–¹æœåŠ¡æ¯”è¾ƒæ…¢ã€‚

è€Œåœ¨åˆ†å¸ƒå¼æœåŠ¡ä¸­ï¼Œå„ä¸ªå¤§å‚å†…éƒ¨ç³»ç»Ÿæˆç™¾ä¸Šåƒçš„ï¼Œé“¾è·¯å…³ç³»æ›´åŠ å¤æ‚ã€‚æ¯”å¦‚ä½ åœ¨å¤–å–å¹³å°ä¸Šçš„ä¸€ä¸ªç‚¹å‡»è¯·æ±‚å¯èƒ½è·¨äº†å†…éƒ¨å‡ åä¸ªJavaåº”ç”¨äº†ï¼Œåœ¨è¿™ä¹ˆé•¿çš„é“¾è·¯é‡Œå»æ’æŸ¥é—®é¢˜ï¼Œæ²¡æœ‰å¥½ä½¿çš„å·¥å…·æ€ä¹ˆè¡Œå‘¢ã€‚å¦‚å›¾æ˜¯å½“å‰åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç°çŠ¶ï¼Œå›¾ç‰‡æ¥æºï¼š**é¹°çœ¼ä¸‹çš„æ·˜å®åˆ†å¸ƒå¼è°ƒç”¨è·Ÿè¸ªç³»ç»Ÿä»‹ç»**

![](https://img-blog.csdnimg.cn/02a3e37b91f94e67878213faa1634a5f.png)

æ ¹æ®ä¸Šå›¾ï¼Œæˆ‘ä»¬è®¾æƒ³ï¼š

1.ç³»ç»Ÿä¸­æœ‰å¯èƒ½æ¯å¤©éƒ½åœ¨å¢åŠ æ–°æœåŠ¡æˆ–åˆ é™¤æ—§æœåŠ¡ï¼Œä¹Ÿå¯èƒ½è¿›è¡Œå‡çº§ï¼Œå½“ç³»ç»Ÿå‡ºç°é”™è¯¯ï¼Œæˆ‘ä»¬å¦‚ä½•å®šä½é—®é¢˜ï¼Ÿ

2.å½“ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œå“åº”ç¼“æ…¢ï¼Œæ€ä¹ˆå®šä½é—®é¢˜ï¼Ÿ

3.æœåŠ¡å¯èƒ½ç”±ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å¼€å‘ï¼Œ1ã€2 å®šä½é—®é¢˜çš„æ–¹å¼ï¼Œæ˜¯å¦é€‚åˆæ‰€æœ‰ç¼–ç¨‹è¯­è¨€ï¼Ÿ

Skywalkingæ¡†æ¶
============

1.ä»‹ç»
----

SkyWalking æ˜¯ä»€ä¹ˆï¼Ÿ

> å®˜æ–¹ç½‘å€ [http://skywalking.apache.org/](http://skywalking.apache.org/)
> 
> skywalkingæ˜¯ä¸€ä¸ªä¼˜ç§€çš„å›½äº§å¼€æºæ¡†æ¶ï¼Œ2015å¹´ç”±ä¸ªäººå´æ™Ÿï¼ˆåä¸ºå¼€å‘è€…ï¼‰å¼€æº ï¼Œ **2017**å¹´åŠ å…¥[Apache](https://so.csdn.net/so/search?q=Apache&spm=1001.2101.3001.7020)å­µåŒ–å™¨ã€‚çŸ­çŸ­ä¸¤å¹´å°±è¢«Apacheæ”¶å…¥éº¾ä¸‹ï¼Œå®åŠ›å¯è§ä¸€æ–‘ã€‚
> 
> åˆ†å¸ƒå¼ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºæ€§èƒ½ç›‘è§†å·¥å…·ï¼Œä¸“ä¸ºå¾®æœåŠ¡ã€äº‘åŸç”Ÿæ¶æ„å’ŒåŸºäºå®¹å™¨ï¼ˆDockerã€K8sã€Mesosï¼‰æ¶æ„è€Œè®¾è®¡ã€‚
> 
> æä¾›åˆ†å¸ƒå¼è¿½è¸ªã€æœåŠ¡ç½‘æ ¼é¥æµ‹åˆ†æã€åº¦é‡èšåˆå’Œå¯è§†åŒ–ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚
> 
> ä»£ç æ— ä¾µå…¥ï¼Œé€šä¿¡æ–¹å¼é‡‡ç”¨GRPCï¼Œå®ç°æ–¹å¼æ˜¯javaæ¢é’ˆï¼Œæ”¯æŒå‘Šè­¦ï¼ŒJVMç›‘æ§ï¼Œæ”¯æŒå…¨å±€è°ƒç”¨ç»Ÿè®¡ç­‰ç­‰

skywalkingçš„æ¶æ„å‚è€ƒäº†è°·æ­Œçš„Dapperæ¡†æ¶çš„è®ºæ–‡ï¼ŒDapperå¹¶æ²¡æœ‰å¼€æºï¼Œåªç»™äº†ç¯‡è®ºæ–‡ï¼Œæ„Ÿå…´è¶£ä½†åˆä¸å–œè‹±æ–‡æ–‡æ¡£çš„æ—å‹å¯ä»¥çœ‹çœ‹è®ºæ–‡çš„ä¸­æ–‡ç¿»è¯‘[Dapperï¼Œå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„è·Ÿè¸ªç³»ç»Ÿ](https://www.iocoder.cn/Fight/Dapper-translation//)

æ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š

![](https://img-blog.csdnimg.cn/90071f4de56a4334b5ac91535419d717.png)

*   **Tracing Metrics Logging** ï¼šè´Ÿè´£ä»åº”ç”¨ä¸­ï¼Œæ”¶é›†é“¾è·¯ä¿¡æ¯ï¼Œå‘é€ç»™ SkyWalking OAP æœåŠ¡å™¨ã€‚ç›®å‰æ”¯æŒ SkyWalkingã€Zikpinã€Jaeger ç­‰æä¾›çš„ Tracing æ•°æ®ä¿¡æ¯ã€‚Javaåº”ç”¨é€šå¸¸ä½¿ç”¨SkyWalking Agent æ”¶é›†æ•°æ®
*   **SkyWalking OAP** ï¼šskywalkingæœåŠ¡ç«¯ï¼ˆTransport layerï¼ŒReceiver clusterï¼ŒAggregator clusterï¼‰è´Ÿè´£æ¥æ”¶ Agent å‘é€çš„ Tracing æ•°æ®ä¿¡æ¯ï¼Œç„¶åè¿›è¡Œåˆ†æï¼Œå­˜å‚¨åˆ°å¤–éƒ¨å­˜å‚¨å™¨( Storage )ï¼Œæœ€ç»ˆæä¾›æŸ¥è¯¢åŠŸèƒ½ã€‚
*   **Storage option** ï¼šTracing æ•°æ®å­˜å‚¨ã€‚ç›®å‰æ”¯æŒ ESã€H2 å¤šç§å­˜å‚¨å™¨ã€‚æˆ‘ä»¬ç”¨ESå­˜å‚¨å³å¯ ã€‚
*   **GUI** ï¼šè´Ÿè´£æä¾›å¯è§†åŒ–æ§å°ï¼ŒæŸ¥çœ‹é“¾è·¯ç­‰
*   **Alarm**ï¼šæä¾›å‘Šè­¦åŠŸèƒ½ï¼Œè¿™é‡Œä¸å±•ç¤ºè®²

2.Dockeræ–¹å¼æ­å»ºSkywalkingç¯å¢ƒ
------------------------

ä¸ºäº†å¿«é€Ÿæ­å»ºç¯å¢ƒï¼Œé¿å…å„ç§ç³»ç»Ÿã€é…ç½®ç¯å¢ƒä¸åŒé€ æˆè¸©å‘çš„æƒ…å†µã€‚æˆ‘ä»¬ç”¨dockerç›´æ¥åˆ›å»ºElasticSearchã€Skywalking-OAPã€Skywalking-UIä»¥åŠESçš„ç®¡ç†å·¥å…·Kibanaã€‚è¿™æ ·ä¸€å¥—è¿è¡Œç¯å¢ƒç›´æ¥å°±èƒ½ç”¨äº†ã€‚è¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å¹²

æ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š

![](https://img-blog.csdnimg.cn/98cb996f1ed44ae888aabf093a0b9acc.png)

ç”¨åˆ°çš„å·¥å…·ç‰ˆæœ¬å·å¦‚ä¸‹è¡¨ï¼š

å·¥å…·

ç‰ˆæœ¬å·

ElasticSearch

7.14.2

Kibana

7.14.2

skywalking-oap-server

9.1.0

skywalking-ui

9.1.0

å…¶ä¸­skywalkingçš„docker-compos.ymlè¿è¡Œè„šæœ¬å¯ä»¥ä»å®˜æ–¹çš„Githubä¸Šè·å–[apache/skywalking/docker](https://github.com/apache/skywalking/blob/master/docker/docker-compose.yml)

è„šæœ¬éœ€è¦ä¿®æ”¹ï¼Œç›´æ¥å‚è€ƒæˆ‘çš„å°±è¡Œï¼Œä¸æ‡‚çš„å‚æ•°éƒ½æœ‰å…·ä½“è¯´æ˜ï¼š

    version: '3'
    services:
      elasticsearch:
        image: docker.elastic.co/elasticsearch/elasticsearch:7.14.2
        container_name: elasticsearch
        ports:
          - 9200:9200
          - 9300:9300
        environment:
          - "cluster.name=elasticsearch"
          - "bootstrap.memory_lock=true"
          - "ES_JAVA_OPTS=-Xms256m -Xmx512m"
          - "discovery.type=single-node"
     
      kibana:
        image: docker.elastic.co/kibana/kibana:7.14.2
        container_name: kibana
        depends_on:
          - elasticsearch
        ports:
          - 5601:5601
        environment:
          # IPåœ°å€ä¸ºè¿è¡Œç”µè„‘çš„IPåœ°å€ï¼ŒMacä¸Šé€šè¿‡ ifconfig en0 å‘½ä»¤è·å–
          - "elasticsearch.hosts=http://192.168.1.5:9200" 
    
      skywalking-oap:
        image: apache/skywalking-oap-server:9.1.0
        container_name: skywalking-oap
        depends_on:
          - elasticsearch
        ports:
          - "11800:11800"
          - "12800:12800"
        healthcheck:
          test: [ "CMD-SHELL", "/skywalking/bin/swctl ch" ]
          interval: 30s
          timeout: 10s
          retries: 3
          start_period: 10s
        environment:
          TZ: Asia/Shanghai
          SW_STORAGE: elasticsearch
          SW_STORAGE_ES_CLUSTER_NODES: elasticsearch:9200
          SW_HEALTH_CHECKER: default
          SW_TELEMETRY: prometheus
    
      skywalking-ui:
        image: apache/skywalking-ui:9.1.0
        container_name: skywalking-ui
        depends_on:
          - skywalking-oap
        links:
          - skywalking-oap
        ports:
         # UIç•Œé¢ç¨‹åºå ç”¨çš„ç«¯å£
          - "8080:8080"
        environment:
          TZ: Asia/Shanghai
          # IPåœ°å€ä¸ºè¿è¡Œç”µè„‘çš„IPåœ°å€ï¼ŒMacä¸Šé€šè¿‡ ifconfig en0 å‘½ä»¤è·å–
          SW_OAP_ADDRESS: http://192.168.1.8:12800
    
    

### 2.1 Dockeré•œåƒåŠ é€Ÿ

æŒ‰ä¸Šè¿°é…å¥½docker-compose.ymlæ–‡ä»¶åï¼Œå‘½ä»¤è¡Œåˆ°æ‰€åœ¨ç›®å½•ä¸‹æ‰§è¡Œ`docker-compose up`å¯ä»¥æ‹‰èµ·é•œåƒï¼Œç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ä¼šä¸‹è½½é•œåƒï¼Œdockeré»˜è®¤çš„é•œåƒä»“åº“åœ¨å›½å¤–ï¼Œæ‰€ä»¥ä¸‹è½½é€Ÿåº¦å’Œèœ—ç‰›ä¸€æ ·æ…¢ã€‚ä¸ºäº†åŠ é€Ÿä¸‹è½½ï¼Œéœ€è¦é…ç½®å›½å†…çš„dockeré•œåƒ

è·å–å›½å†…dockeré•œåƒåº“åœ°å€çš„æ–¹æ³•ï¼š

1.  é˜¿é‡Œäº‘å®˜æ–¹é•œåƒåŠ é€Ÿï¼Œè·å–åŠ é€Ÿå™¨åœ°å€æ–‡æ¡£ï¼š[é˜¿é‡Œäº‘å®˜æ–¹é•œåƒåŠ é€Ÿ](https://help.aliyun.com/document_detail/60750.html)
2.  ç½‘ä¸Šæœç´¢dockeré•œåƒåŠ é€Ÿï¼Œä¸‹é¢æ˜¯æµ‹è¿‡æœ‰æ•ˆçš„å…¬å…±é•œåƒåº“
    *   **ç½‘æ˜“äº‘ [https://hub-mirror.c.163.com](https://link.zhihu.com/?target=https%3A//hub-mirror.c.163.com/)**
    *   **ç™¾åº¦äº‘ [https://mirror.baidubce.com](https://link.zhihu.com/?target=https%3A//mirror.baidubce.com/)**

é…ç½®æ–¹æ³•ï¼š

Dockeræ¡Œé¢ç‰ˆ`Preference` -> `Docker Engine` åœ¨Jsoné…ç½®é‡ŒåŠ ä¸Šï¼ŒåŠ å¥½ä¹‹åé‡å¯Dockerï¼Œç„¶åå†é‡æ–°æ‹‰é•œåƒï¼Œé€Ÿåº¦ç«‹é©¬å¿«å¾—é£èµ·ğŸš€ğŸš€ğŸš€

      # æŒ‰éœ€åŠ ä¸Šå¤šä¸ªé•œåƒåº“åœ°å€
      "registry-mirrors": [
    		"https://hub-mirror.c.163.com",
        "https://mirror.baidubce.com"
      ]
    
    

![](https://img-blog.csdnimg.cn/8681a81647994991a4373de43cf52755.png)

### 2.2 Skywalking UIç•Œé¢

dockerå¯åŠ¨åï¼ŒSkywalkingç¬¬ä¸€æ¬¡è¿è¡Œä¼šè‡ªè¡Œåœ¨ESé‡Œåˆ›å»ºç´¢å¼•ï¼Œè¿è¡Œæ—¥å¿—æ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸäº†ï¼Œæµè§ˆå™¨æ‰“å¼€`http://127.0.0.1:8080/`å¯ä»¥çœ‹åˆ°Skywalking çš„ç•Œé¢

![](https://img-blog.csdnimg.cn/1bea5f42ca22437abe014a2b59a18689.png)

### 2.3 Skywalking agentä½¿ç”¨

æ•°æ®çš„é‡‡é›†é€šè¿‡agentï¼ŒJavaåº”ç”¨å¯åŠ¨æ—¶é€šè¿‡`-javaagent`å‚æ•°é…ç½®Skywalking agentã€‚åœ¨IDEAä¸­è¿è¡Œæ—¶ï¼Œåœ¨å¯åŠ¨å‚æ•°vm ä¸­é…ç½®å³å¯ã€‚

**Skywalking Agentä¸‹è½½**

å®˜ç½‘ä¸Šä¸‹è½½Java agentå‹ç¼©åŒ…[Skywalking Agentä¸‹è½½](https://skywalking.apache.org/downloads/)ï¼Œå½“å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯`v8.12.0`ï¼Œä¸‹è½½åˆ°è‡ªå·±ç”µè„‘ä¸Šæ‰¾ä¸ªä½ç½®è§£å‹ã€‚æˆ‘çš„æ˜¯æ”¾åœ¨`/Users/longbig/opt/`ç›®å½•ä¸‹

**shellè„šæœ¬æ–¹å¼**

    # é…ç½®agentåœ°å€ï¼ŒagentæœåŠ¡åï¼Œskywalking-oap collectoråœ°å€(æ³¨æ„IPåœ°å€ï¼Œå› ä¸ºæˆ‘æ˜¯dockerè¿è¡Œ,éœ€è¦ä½¿ç”¨æœ¬æœºçš„å±€åŸŸç½‘IP)
    export JAVA_AGENT=-javaagent:/Users/yuyunlong/opt/skywalking-agent/skywalking-agent.jar=agent.service_name=multi_function,collector.backend_service=192.168.1.8:11800
    
    # jarå¯åŠ¨
    java -jar $JAVA_AGENT application.jar
    

**IDEAè¿è¡Œæ–¹å¼**

åœ¨ä½ éœ€è¦è¿è¡Œçš„springbootåº”ç”¨çš„VM optionsé‡ŒåŠ ä¸Šä¸Šé¢çš„å‚æ•°ï¼Œå¯åŠ¨å³å¯

![](https://img-blog.csdnimg.cn/17866231755c405c8f32bddac79a613a.png)

å¯åŠ¨å®Œä¹‹åéšä¾¿è°ƒç”¨å‡ ä¸ªæ¥å£è¯•è¯•ï¼Œç„¶åå†åœ¨Skywalkingçš„ç•Œé¢æŸ¥çœ‹æ•ˆæœ

### 2.3 è¿½è¸ªæ•°æ®

ä¸‹é¢æ˜¯æˆ‘çš„æœåŠ¡çš„æ‹“æ‰‘å›¾ï¼ŒæœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»å¯ä»¥çœ‹çš„éå¸¸æ¸…æ¥šï¼Œå¦‚æœæ—å‹çš„åº”ç”¨æ¯”è¾ƒå¤šçš„è¯ï¼Œèƒ½é“ºæ»¡æ•´ä¸ªå±å¹•çš„

![](https://img-blog.csdnimg.cn/3423b3c625e941bcb33ef8c5c98b20e7.png)

åˆ°æ­¤Skywalkingçš„æ­å»ºå°±å®Œæˆäº†

3\. Skywalkingé›†æˆLogbackå®ç°Traceæ—¥å¿—æ‰“å°
----------------------------------

åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œï¼Œæˆ‘ä»¬ç”¨äº†ä¸ªç®€é™‹çš„æ–¹æ³•å®ç°äº†traceIdçš„ä¼ é€’[å…¨é“¾è·¯è¿½è¸ªä½“éªŒâ€”TraceIdçš„ç”Ÿæˆ](https://blog.csdn.net/qq_36624086/article/details/126555862)ï¼Œç°åœ¨æˆ‘ä»¬ç”¨ä¸ŠSkywalkingæ¡†æ¶æ¥æ‰“å°traceId

åŠ ä¸ŠMavenä¾èµ–

            <!-- SkyWalking å¯¹ Logback çš„é›†æˆ -->
            <dependency>
                <groupId>org.apache.skywalking</groupId>
                <artifactId>apm-toolkit-logback-1.x</artifactId>
                <version>8.10.0</version>
            </dependency>
    
            <dependency>
                <groupId>org.apache.skywalking</groupId>
                <artifactId>apm-toolkit-trace</artifactId>
                <version>8.10.0</version>
            </dependency>
    

logback-spring.xmlæ–‡ä»¶ä¿®æ”¹å†…å®¹ï¼š

ä¸»è¦ä¿®æ”¹2ä¸ªåœ°æ–¹

*   CONSOLE\_LOG\_PATTERN é‡ŒåŠ ä¸Š`%tid`ï¼Œé…ç½®traceIdå ä½ç¬¦
*   layouté€šè¿‡TraceIdPatternLogbackLayout å®ç°å¯¹`%tid`æ›¿æ¢ä¸ºSkywalking TraceId

        <!-- å½©è‰²æ—¥å¿— -->
        <!-- å½©è‰²æ—¥å¿—ä¾èµ–çš„æ¸²æŸ“ç±» -->
        <conversionRule conversionWord="clr" converterClass="org.springframework.boot.logging.logback.ColorConverter" />
        <conversionRule conversionWord="wex" converterClass="org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter" />
        <conversionRule conversionWord="wEx" converterClass="org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter" />
        <!-- å½©è‰²æ—¥å¿—æ ¼å¼ -->
        <property name="CONSOLE_LOG_PATTERN" value="${CONSOLE_LOG_PATTERN:-%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} [%tid] %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}"/>
    
    <!--è¾“å‡ºåˆ°æ§åˆ¶å°-->
        <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
            <!--æ­¤æ—¥å¿—appenderæ˜¯ä¸ºå¼€å‘ä½¿ç”¨ï¼Œåªé…ç½®æœ€åº•çº§åˆ«ï¼Œæ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çº§åˆ«æ˜¯å¤§äºæˆ–ç­‰äºæ­¤çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯-->
            <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
                <level>info</level>
            </filter>
            <encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder">
                <layout class="org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout">
                    <Pattern>${CONSOLE_LOG_PATTERN}</Pattern>
                </layout>
                <!-- è®¾ç½®å­—ç¬¦é›† -->
                <charset>UTF-8</charset>
            </encoder>
        </appender>
    

**ç®€å•æµ‹è¯•çœ‹çœ‹**

éšä¾¿å†™äº†ä¸ªæ¢æ´»æ¥å£ï¼Œçœ‹çœ‹æ¥å£è€—æ—¶å’Œæ—¥å¿—æ‰“å°æ•ˆæœ

æœåŠ¡æ—¥å¿—æ‰“å°ï¼š

![](https://img-blog.csdnimg.cn/299fa40ed05f4b608fcd09c2f4ddc47d.png)

ç•Œé¢traceIdæœç´¢

![](https://img-blog.csdnimg.cn/8ee8a17432d9476ba49be43e8312233c.png)

å°ç»“
--

æœ¬ç¯‡æ–‡ç« è®²äº†ä¸ºä»€ä¹ˆç”¨åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªä»¥åŠSkywalkingæ¡†æ¶çš„ä½¿ç”¨ï¼Œæ˜¯å¯¹ä¸Šä¸€ç¯‡æœ€ç®€é™‹traceIdä½¿ç”¨çš„è¿›é˜¶ç‰ˆã€‚å­¦ä¸œè¥¿å°±æ˜¯è¦æ—¥æ‹±ä¸€å’ï¼Œé‡å˜å¼•èµ·è´¨å˜ã€‚æˆ‘æ˜¯`å·ç¦åŒå­¦`ï¼Œä¸€ä¸ªåœ¨ç¦æŠ¥å‚ä¿®ç¦æŠ¥ä¸­çš„å°ç¤¾ç•œå“¦~