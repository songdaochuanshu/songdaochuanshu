---
layout: post
title: "全网显示 IP 归属地，这背后的技术你知道吗？"
date: "2022-05-08T04:25:38.882Z"
---
全网显示 IP 归属地，这背后的技术你知道吗？
=======================

![](https://shuyi-tech-blog.oss-cn-shenzhen.aliyuncs.com/halo_blog_system_file/16519110498873.jpg)

为了进一步规范国内的网络舆论，国家规定了各互联网平台都需要显示 IP 归属地信息。微博、抖音、公众号等多个平台纷纷上线了 IP 归属地功能，这标志着国内言论的进一步规范化。但互联网平台商们是怎么通过 IP 定位到我们所属地区的？这背后的原理是什么？IP 归属地背后又有哪些实际的应用？今天我们就来聊聊 IP 归属地背后的技术原理。

如何通过 IP 找到地址？
-------------

在我们印象中，我们都知道可以通过 IP 地址找到某个人。但当我们细想一下，我们会发现其实 IP 地址与地理位置并不是直接相关的。那我们到底是如何通过 IP 地址找到地址的呢？答案是：通过自治系统（Autonomous System）。

互联网是由不同网络组成的网络，自治系统是组成 Internet 的大型网络，连接到 Internet 的每台计算机或设备都连接到一个 AS。而每一个自治系统都会有一个编码，我们称之为 ASN。

![](https://shuyi-tech-blog.oss-cn-shenzhen.aliyuncs.com/halo_blog_system_file/16519112009977.jpg)

可以认为 AS 类似于一个城镇的邮局。邮件从一个邮局到另一个邮局，直到到达正确的城镇为止，然后该城镇的邮局将在该城镇内传递邮件。每个 AS 都控制一组特定的 IP 地址，就像每个镇的邮局负责将邮件传递到该镇内的所有地址一样。通常，每个 AS 由单个大型组织（例如 Internet 服务提供商（ISP）、大型企业技术公司、大学或政府机构）运营。

到这里，我们可以捋清楚这样一个逻辑关系：`IP地址 -> 地址块 -> 自治网络编码（ASN） -> 组织 -> 国家`。通过 IP 地址，我们就可以定位到一个大致的地理位置，例如：北京朝阳区、深圳南山区等。例如我现在的 IP 地址就归属于编码为 `AS4xxx` 这个自治网络，通过这个 ASN 可以知道位置在中国深圳，这个 ASN 编码所属的组织为 `中国电信`。

![](https://shuyi-tech-blog.oss-cn-shenzhen.aliyuncs.com/halo_blog_system_file/16519084933019.jpg)

但是通过 ASN 也只能是找到县级或者区级的地理位置，再细的位置就找不到了。但怎么有些时候同学说：他被查水表了，直接定位到某个单元某一户呢？其实原理也很简单！上面我们说到可以根据 IP 地址定位到 ASN 所属组织，而 ASN 所属组织在进行 IP 地址分配的时候，都是会进行 IP 地址分配记录的。某个 IP 地址分配给了谁，都记录得一清二楚。因此警察叔叔想找你喝茶，那还不是一抓一个准。但要提示一下的是，并不是谁都有那个权限去运营商查询这些数据。所以那些说可以爬着网线找到你的人，基本上可以忽略，都是在吓唬你。只有警察叔叔立案，并且出示相关手续之后才可以进行数据查询。

IP 地址的隐私问题
----------

那是不是只有运营商才能查到某个人的住址信息呢？在大数据时代的今天，各种互联网应用搜集了大量的数据信息，它们其实也可以根据这些信息，推断出某个人的大致地址位置。例如百度地图会一直用 App SDK 以及网页的方式记录 IP 和地址位置的关联，并允许反向查询，也就是可以根据 IP 地址反向查询到某个位置，这个数据精度可能精确到几百米。

其实不止国内的公司会这么做，其实国外的公司同样也会这么做，就比如 Google 也做了。只是国外对这方面控制得非常严格，因此它们会比较明确地披露所使用的用户隐私数据，并且还提供了对应功能可以让用户关闭。

![](https://shuyi-tech-blog.oss-cn-shenzhen.aliyuncs.com/halo_blog_system_file/16519100570578.jpg)

有朋友说了，那我可以用 VPN 改变 IP，那是不是某些 App 就不知道我的精确位置了呀？其实并不是的，因为你的邻居可以出卖了你。某些 App 发现，邻居周围的 WIFI、蓝牙等和你的非常像。而且当某个 WiFi 信号消失时，邻居那边的也同步消失了。那么他们就可以猜测，你隐藏了自己的真实 IP，你的地理位置和邻居的非常近。这就是大数据时代背景下的应用。

因此，当某些设备弹出提示「是否允许扫描本地设备」时，你就要谨慎选择了。如果不是内网 NAS 或者投屏类的，基本上没有必要允许这个操作，这个操作都是在盗取你的个人隐私信息。如果你允许了这个操作，那他就会开始扫描整个局域网的设备信息，然后记录下来。最终，其会将你的 IP 地址、手机 IMEI、WiFi 等信息汇总起来，从而做一些商业化的信息，例如 —— 你在电脑上搜了下房子这个关键词，等会你刷手机抖音就会给你推送房地产广告。

![连接本地网络设备](https://shuyi-tech-blog.oss-cn-shenzhen.aliyuncs.com/halo_blog_system_file/16519107277276.jpg)

说白了，「查找并连接到本地网络上的设备」的使用为跨平台广告提供了方便，而从个人信息保护和隐私保护体验的角度来讲，这种对设备的监控、跟踪可能会给用户带来担忧。

参考资料
----

*   [什么是自治系统？| 什么是 ASN？ | Cloudflare](https://www.cloudflare.com/zh-cn/learning/network-layer/what-is-an-autonomous-system/)
*   [IP 地址能精确到什么地步，如何保护隐私？ - Luv Letter的回答 - 知乎](https://www.zhihu.com/question/378858233/answer/1090480642)
*   [IP 地址能精确到什么地步，如何保护隐私？ - Happy Ennding的回答 - 知乎](https://www.zhihu.com/question/378858233/answer/1092144083)

![扫描关注微信公众号](https://www.cnblogs.com/images/cnblogs_com/chanshuyi/583347/o_chenshuyi_focus_guide.jpg)