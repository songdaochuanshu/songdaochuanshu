---
layout: post
title: "è¯´ä¸€ä¸‹ ArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿ"
date: "2022-11-22T11:15:40.430Z"
---
è¯´ä¸€ä¸‹ ArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿ
===============================

> **æœ¬æ–‡å·²æ”¶å½•åˆ° [AndroidFamily](https://github.com/pengxurui/AndroidFamily)ï¼ŒæŠ€æœ¯å’ŒèŒåœºé—®é¢˜ï¼Œè¯·å…³æ³¨å…¬ä¼—å· \[å½­æ—­é”\] æé—®ã€‚**

å‰è¨€
--

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°å½­ã€‚

[åœ¨ä¸Šä¸€ç¯‡æ–‡ç« é‡Œ](https://juejin.cn/post/7161731329078329381)ï¼Œæˆ‘ä»¬èŠåˆ°äº†åŸºäºåŠ¨æ€æ•°ç»„ ArrayList çº¿æ€§è¡¨ï¼Œä»Šå¤©æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸ªåŸºäºé“¾è¡¨çš„çº¿æ€§è¡¨ â€”â€” LinkedListã€‚

* * *

å°å½­çš„ Android äº¤æµç¾¤ 02 ç¾¤å·²ç»å»ºç«‹å•¦ï¼Œæ‰«ææ–‡æœ«äºŒç»´ç è¿›å…¥~

* * *

**æ€ç»´å¯¼å›¾ï¼š**

![](https://files.mdnice.com/user/3257/59ee3ba4-1d73-4d38-8085-1579f45806b9.png)

* * *

1\. LinkedList çš„ç‰¹ç‚¹
------------------

### 1.1 è¯´ä¸€ä¸‹ ArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿ

*   **1ã€æ•°æ®ç»“æ„ï¼š** åœ¨æ•°æ®ç»“æ„ä¸Šï¼ŒArrayList å’Œ LinkedList éƒ½æ˜¯ â€œçº¿æ€§è¡¨â€ï¼Œéƒ½ç»§æ‰¿äº Java çš„ `List` æ¥å£ã€‚å¦å¤– LinkedList è¿˜å®ç°äº† Java çš„ `Deque` æ¥å£ï¼Œæ˜¯åŸºäºé“¾è¡¨çš„æ ˆæˆ–é˜Ÿåˆ—ï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯ `ArrayDeque` åŸºäºæ•°ç»„çš„æ ˆæˆ–é˜Ÿåˆ—ï¼›
*   **2ã€çº¿ç¨‹å®‰å…¨ï¼š** ArrayList å’Œ LinkedList éƒ½ä¸è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œä¸ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›
*   **3ã€åº•å±‚å®ç°ï¼š** åœ¨åº•å±‚å®ç°ä¸Šï¼ŒArrayList æ˜¯åŸºäºåŠ¨æ€æ•°ç»„çš„ï¼Œè€Œ LinkedList æ˜¯åŸºäºåŒå‘é“¾è¡¨çš„ã€‚äº‹å®ä¸Šï¼Œå®ƒä»¬å¾ˆå¤šç‰¹æ€§çš„åŒºåˆ«éƒ½æ˜¯å› ä¸ºåº•å±‚å®ç°ä¸åŒå¼•èµ·çš„ã€‚æ¯”å¦‚è¯´ï¼š
    *   **åœ¨éå†é€Ÿåº¦ä¸Šï¼š** æ•°ç»„æ˜¯ä¸€å—è¿ç»­å†…å­˜ç©ºé—´ï¼ŒåŸºäºå±€éƒ¨æ€§åŸç†èƒ½å¤Ÿæ›´å¥½åœ°å‘½ä¸­ CPU ç¼“å­˜è¡Œï¼Œè€Œé“¾è¡¨æ˜¯ç¦»æ•£çš„å†…å­˜ç©ºé—´å¯¹ç¼“å­˜è¡Œä¸å‹å¥½ï¼›
    *   **åœ¨è®¿é—®é€Ÿåº¦ä¸Šï¼š** æ•°ç»„æ˜¯ä¸€å—è¿ç»­å†…å­˜ç©ºé—´ï¼Œæ”¯æŒ O(1) æ—¶é—´å¤æ‚åº¦éšæœºè®¿é—®ï¼Œè€Œé“¾è¡¨éœ€è¦ O(n) æ—¶é—´å¤æ‚åº¦æŸ¥æ‰¾å…ƒç´ ï¼›
    *   **åœ¨æ·»åŠ å’Œåˆ é™¤æ“ä½œä¸Šï¼š** å¦‚æœæ˜¯åœ¨æ•°ç»„çš„æœ«å°¾æ“ä½œåªéœ€è¦ O(1) æ—¶é—´å¤æ‚åº¦ï¼Œä½†åœ¨æ•°ç»„ä¸­é—´æ“ä½œéœ€è¦æ¬è¿å…ƒç´ ï¼Œæ‰€ä»¥éœ€è¦ O(n)æ—¶é—´å¤æ‚åº¦ï¼Œè€Œé“¾è¡¨çš„åˆ é™¤æ“ä½œæœ¬èº«åªæ˜¯ä¿®æ”¹å¼•ç”¨æŒ‡å‘ï¼Œåªéœ€è¦ O(1) æ—¶é—´å¤æ‚åº¦ï¼ˆå¦‚æœè€ƒè™‘æŸ¥è¯¢è¢«åˆ é™¤èŠ‚ç‚¹çš„æ—¶é—´ï¼Œå¤æ‚åº¦åˆ†æä¸Šä¾ç„¶æ˜¯ O(n)ï¼Œåœ¨å·¥ç¨‹åˆ†æä¸Šè¿˜æ˜¯æ¯”æ•°ç»„å¿«ï¼‰ï¼›
    *   **é¢å¤–å†…å­˜æ¶ˆè€—ä¸Šï¼š** ArrayList åœ¨æ•°ç»„çš„å°¾éƒ¨å¢åŠ äº†é—²ç½®ä½ç½®ï¼Œè€Œ LinkedList åœ¨èŠ‚ç‚¹ä¸Šå¢åŠ äº†å‰é©±å’Œåç»§æŒ‡é’ˆã€‚

### 1.2 LinkedList çš„å¤šé¢äººç”Ÿ

åœ¨æ•°æ®ç»“æ„ä¸Šï¼ŒLinkedList ä¸ä»…å®ç°äº†ä¸ ArrayList ç›¸åŒçš„ List æ¥å£ï¼Œè¿˜å®ç°äº† Deque æ¥å£ï¼ˆç»§æ‰¿äº Queue æ¥å£ï¼‰ã€‚

Deque æ¥å£è¡¨ç¤ºä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼ˆDouble Ended Queueï¼‰ï¼Œå…è®¸åœ¨é˜Ÿåˆ—çš„é¦–å°¾ä¸¤ç«¯æ“ä½œï¼Œæ‰€ä»¥æ—¢èƒ½å®ç°é˜Ÿåˆ—è¡Œä¸ºï¼Œä¹Ÿèƒ½å®ç°æ ˆè¡Œä¸ºã€‚

**Queue æ¥å£ï¼š**

æ‹’ç»ç­–ç•¥

æŠ›å¼‚å¸¸

è¿”å›ç‰¹æ®Šå€¼

å…¥é˜Ÿï¼ˆé˜Ÿå°¾ï¼‰

add(e)

offer(e)

å‡ºé˜Ÿï¼ˆé˜Ÿå¤´ï¼‰

remove()

poll()

è§‚å¯Ÿï¼ˆé˜Ÿå¤´ï¼‰

element()

peek()

Queue çš„ API å¯ä»¥åˆ†ä¸º 2 ç±»ï¼ŒåŒºåˆ«åœ¨äºæ–¹æ³•çš„æ‹’ç»ç­–ç•¥ä¸Šï¼š

*   æŠ›å¼‚å¸¸ï¼š
    
    *   å‘ç©ºé˜Ÿåˆ—å–æ•°æ®ï¼Œä¼šæŠ›å‡º NoSuchElementException å¼‚å¸¸ï¼›
    *   å‘å®¹é‡æ»¡çš„é˜Ÿåˆ—åŠ æ•°æ®ï¼Œä¼šæŠ›å‡º IllegalStateException å¼‚å¸¸ã€‚
*   è¿”å›ç‰¹æ®Šå€¼ï¼š
    
    *   å‘ç©ºé˜Ÿåˆ—å–æ•°æ®ï¼Œä¼šè¿”å› nullï¼›
    *   å‘å®¹é‡æ»¡çš„é˜Ÿåˆ—åŠ æ•°æ®ï¼Œä¼šè¿”å› falseã€‚

**Deque æ¥å£ï¼š**

Java æ²¡æœ‰æä¾›æ ‡å‡†çš„æ ˆæ¥å£ï¼ˆå¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆä¸æä¾›ï¼‰ï¼Œè€Œæ˜¯æ”¾åœ¨ Deque æ¥å£ä¸­ï¼š

æ‹’ç»ç­–ç•¥

æŠ›å¼‚å¸¸

ç­‰ä»·äº

å…¥æ ˆ

push(e)

addFirst(e)

å‡ºæ ˆ

pop()

removeFirst()

è§‚å¯Ÿï¼ˆæ ˆé¡¶ï¼‰

peek()

peekFirst()

é™¤äº†æ ‡å‡†çš„é˜Ÿåˆ—å’Œæ ˆè¡Œä¸ºï¼ŒDeque æ¥å£è¿˜æä¾›äº† 12 ä¸ªåœ¨ä¸¤ç«¯æ“ä½œçš„æ–¹æ³•ï¼š

æ‹’ç»ç­–ç•¥

æŠ›å¼‚å¸¸

è¿”å›å€¼

å¢åŠ 

addFirst(e)/ addLast(e)

offerFirst(e)/ offerLast(e)

åˆ é™¤

removeFirst()/ removeLast()

pollFirst()/ pollLast()

è§‚å¯Ÿ

getFirst()/ getLast()

peekFirst()/ peekLast()

* * *

2\. LinkedList æºç åˆ†æ
-------------------

è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬æ¥åˆ†æ LinkedList ä¸­ä¸»è¦æµç¨‹çš„æºç ã€‚

### 2.1 LinkedList çš„å±æ€§

*   LinkedList åº•å±‚æ˜¯ä¸€ä¸ª Node åŒå‘é“¾è¡¨ï¼ŒNode èŠ‚ç‚¹ä¸­ä¼šæŒæœ‰æ•°æ® E ä»¥åŠ prev ä¸next ä¸¤ä¸ªæŒ‡é’ˆï¼›
*   LinkedList ç”¨ `first` å’Œ `last` æŒ‡é’ˆæŒ‡å‘é“¾è¡¨çš„å¤´å°¾æŒ‡é’ˆã€‚

LinkedList çš„å±æ€§å¾ˆå¥½ç†è§£çš„ï¼Œä¸å‡ºæ„å¤–çš„è¯åˆæœ‰å°æœ‹å‹å‡ºæ¥ä¸¾æ‰‹æé—®äº†ï¼š

*   **ğŸ™‹ğŸ»â€â™€ï¸Â ç–‘é—® 1ï¼šä¸ºä»€ä¹ˆå­—æ®µéƒ½ä¸å£°æ˜ `private` å…³é”®å­—ï¼Ÿ**

è¿™ä¸ªé—®é¢˜ç›´æ¥å›ç­”å§ã€‚æˆ‘çš„ç†è§£æ˜¯ï¼šå› ä¸ºå†…éƒ¨ç±»åœ¨ç¼–è¯‘åä¼šç”Ÿæˆç‹¬ç«‹çš„ Class æ–‡ä»¶ï¼Œå¦‚æœå¤–éƒ¨ç±»çš„å­—æ®µæ˜¯ private ç±»å‹ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±éœ€è¦é€šè¿‡æ–¹æ³•è°ƒç”¨ï¼Œè€Œ non-private å­—æ®µå°±å¯ä»¥ç›´æ¥è®¿é—®å­—æ®µã€‚

*   **ğŸ™‹ğŸ»â€â™€ï¸Â ç–‘é—® 2ï¼šä¸ºä»€ä¹ˆå­—æ®µéƒ½å£°æ˜ `transient` å…³é”®å­—ï¼Ÿ**

è¿™ä¸ªé—®é¢˜æˆ‘ä»¬åœ¨åˆ†ææºç çš„è¿‡ç¨‹ä¸­å›ç­”ã€‚

ç–‘é—®æ¯” ArrayList å°‘å¾ˆå¤šï¼ŒLinkedList çœŸé¦™ï¼ˆè¿˜æ˜¯åˆ«é«˜å…´å¾—å¤ªæ—©å§ï¼‰ã€‚

    public class LinkedList<E>
        extends AbstractSequentialList<E>
        implements List<E>, Deque<E>, Cloneable, java.io.Serializable {
    
        // ç–‘é—® 1ï¼šä¸ºä»€ä¹ˆå­—æ®µéƒ½ä¸å£°æ˜ private å…³é”®å­—ï¼Ÿ
        // ç–‘é—® 2ï¼šä¸ºä»€ä¹ˆå­—æ®µéƒ½å£°æ˜ transient å…³é”®å­—ï¼Ÿ
        // å…ƒç´ ä¸ªæ•°
        transient int size = 0;
    
        // å¤´æŒ‡é’ˆ
        transient Node<E> first;
    
        // å°¾æŒ‡é’ˆ
        transient Node<E> last;
    
        // é“¾è¡¨èŠ‚ç‚¹
        private static class Node<E> {
            // èŠ‚ç‚¹æ•°æ®
            // ï¼ˆç±»å‹æ“¦é™¤åï¼šObject item;ï¼‰
            E item;
            // å‰é©±æŒ‡é’ˆ
            Node<E> next;
            // åç»§æŒ‡é’ˆ
            Node<E> prev;
    
            Node(Node<E> prev, E element, Node<E> next) {
                this.item = element;
                this.next = next;
                this.prev = prev;
            }
        }
    }
    

### 2.2 LinkedList çš„æ„é€ æ–¹æ³•

LinkedList æœ‰ 2 ä¸ªæ„é€ æ–¹æ³•ï¼š

*   **1ã€æ— å‚æ„é€ æ–¹æ³•ï¼š** no-opï¼›
*   **2ã€å¸¦é›†åˆçš„æ„é€ ï¼š** åœ¨é“¾è¡¨æœ«å°¾æ·»åŠ æ•´ä¸ªé›†åˆï¼Œå†…éƒ¨è°ƒç”¨äº† addAll æ–¹æ³•å°†æ•´ä¸ªé›†åˆæ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾ã€‚

    // æ— å‚æ„é€ æ–¹æ³•
    public LinkedList() {
    }
    
    // å¸¦é›†åˆçš„æ„é€ æ–¹æ³•
    public LinkedList(Collection<? extends E> c) {
        this();
        addAll(c);
    }
    
    // åœ¨é“¾è¡¨å°¾éƒ¨æ·»åŠ é›†åˆ
    public boolean addAll(Collection<? extends E> c) {
        // ç´¢å¼•ä¸º sizeï¼Œç­‰äºåœ¨é“¾è¡¨å°¾éƒ¨æ·»åŠ 
        return addAll(size, c);
    }
    

### 2.3 LinkedList çš„æ·»åŠ æ–¹æ³•

LinkedList æä¾›äº†éå¸¸å¤šçš„ `addXXX` æ–¹æ³•ï¼Œå†…éƒ¨éƒ½æ˜¯è°ƒç”¨ä¸€ç³»åˆ— `linkFirst`ã€`linkLast` æˆ– `linkBefore` å®Œæˆçš„ã€‚å¦‚æœåœ¨é“¾è¡¨ä¸­é—´æ·»åŠ èŠ‚ç‚¹æ—¶ï¼Œä¼šç”¨åˆ° node(index) æ–¹æ³•æŸ¥è¯¢æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹ã€‚

å…¶å®ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ‰€æœ‰æ·»åŠ çš„é€»è¾‘éƒ½å¯ä»¥ç”¨ 6 ä¸ªæ­¥éª¤æ¦‚æ‹¬ï¼š

*   **æ­¥éª¤ 1ï¼š** æ‰¾åˆ°æ’å…¥ä½ç½®çš„åç»§èŠ‚ç‚¹ï¼ˆåœ¨å¤´éƒ¨æ’å…¥å°±æ˜¯ firstï¼Œåœ¨å°¾éƒ¨æ’å…¥å°±æ˜¯ nullï¼‰ï¼›
*   **æ­¥éª¤ 2ï¼š** æ„é€ æ–°èŠ‚ç‚¹ï¼›
*   **æ­¥éª¤ 3ï¼š** å°†æ–°èŠ‚ç‚¹çš„ prev æŒ‡é’ˆæŒ‡å‘å‰é©±èŠ‚ç‚¹ï¼ˆåœ¨å¤´éƒ¨æ’å…¥å°±æ˜¯ nullï¼Œåœ¨å°¾éƒ¨æ’å…¥å°±æ˜¯ lastï¼‰ï¼›
*   **æ­¥éª¤ 4ï¼š** å°†æ–°èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘åç»§èŠ‚ç‚¹ï¼ˆåœ¨å¤´éƒ¨æ’å…¥å°±æ˜¯ firstï¼Œåœ¨å°¾éƒ¨æ’å…¥å°±æ˜¯ nullï¼‰ï¼›
*   **æ­¥éª¤ 5ï¼š** å°†å‰é©±èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹ï¼ˆåœ¨å¤´éƒ¨æ’å…¥æ²¡æœ‰è¿™ä¸ªæ­¥éª¤ï¼‰ï¼›
*   **æ­¥éª¤ 6ï¼š** å°†åç»§èŠ‚ç‚¹çš„ prev æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹ï¼ˆåœ¨å°¾éƒ¨æ’å…¥æ²¡æœ‰è¿™ä¸ªæ­¥éª¤ï¼‰ã€‚

åˆ†æä¸€ä¸‹æ·»åŠ æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼ŒåŒºåˆ†åœ¨é“¾è¡¨ä¸¤ç«¯æˆ–ä¸­é—´æ·»åŠ å…ƒç´ çš„æƒ…å†µå…±ï¼š

*   **å¦‚æœæ˜¯åœ¨é“¾è¡¨é¦–å°¾ä¸¤ç«¯æ·»åŠ ï¼š** åªéœ€è¦ O(1) æ—¶é—´å¤æ‚åº¦ï¼›
*   **å¦‚æœåœ¨é“¾è¡¨ä¸­é—´æ·»åŠ ï¼š** ç”±äºéœ€è¦å®šä½åˆ°æ·»åŠ ä½ç½®çš„å‰é©±å’Œåç»§èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦ O(n) æ—¶é—´å¤æ‚åº¦ã€‚å¦‚æœäº‹å…ˆå·²ç»è·å¾—äº†æ·»åŠ ä½ç½®çš„èŠ‚ç‚¹ï¼Œå°±åªéœ€è¦ O(1) æ—¶é—´å¤æ‚åº¦ã€‚

`æ·»åŠ æ–¹æ³•`

    public void addFirst(E e) {
        linkFirst(e);
    }
    
    public void addLast(E e) {
        linkLast(e);
    }
    
    public boolean add(E e) {
        linkLast(e);
        return true;
    }
    
    public void add(int index, E element) {
        checkPositionIndex(index);
        if (index == size)
            // åœ¨å°¾éƒ¨æ·»åŠ 
            linkLast(element);
        else
            // åœ¨æŒ‡å®šä½ç½®æ·»åŠ 
            linkBefore(element, node(index));
    }
    
    public boolean addAll(Collection<? extends E> c) {
        return addAll(size, c);
    }
    
    // åœ¨é“¾è¡¨å¤´éƒ¨æ·»åŠ 
    private void linkFirst(E e) {
        // 1. æ‰¾åˆ°æ’å…¥ä½ç½®çš„åç»§èŠ‚ç‚¹ï¼ˆfirstï¼‰
        final Node<E> f = first;
        // 2. æ„é€ æ–°èŠ‚ç‚¹
        // 3. å°†æ–°èŠ‚ç‚¹çš„ prev æŒ‡é’ˆæŒ‡å‘å‰é©±èŠ‚ç‚¹ï¼ˆnullï¼‰
        // 4. å°†æ–°èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘åç»§èŠ‚ç‚¹ï¼ˆfï¼‰
        // 5. å°†å‰é©±èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹ï¼ˆå‰é©±èŠ‚ç‚¹æ˜¯ nullï¼Œæ‰€ä»¥æ²¡æœ‰è¿™ä¸ªæ­¥éª¤ï¼‰
        final Node<E> newNode = new Node<>(null, e, f);
        // ä¿®æ”¹ first æŒ‡é’ˆ
        first = newNode;
        if (f == null)
            // f ä¸º null è¯´æ˜é¦–ä¸ªæ·»åŠ çš„å…ƒç´ ï¼Œéœ€è¦ä¿®æ”¹ last æŒ‡é’ˆ
            last = newNode;
        else
            // 6. å°†åç»§èŠ‚ç‚¹çš„ prev æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹
            f.prev = newNode;
        size++;
        modCount++;
    }
    
    // åœ¨é“¾è¡¨å°¾éƒ¨æ·»åŠ 
    void linkLast(E e) {
        final Node<E> l = last;
        // 1. æ‰¾åˆ°æ’å…¥ä½ç½®çš„åç»§èŠ‚ç‚¹ï¼ˆnullï¼‰
        // 2. æ„é€ æ–°èŠ‚ç‚¹
        // 3. å°†æ–°èŠ‚ç‚¹çš„ prev æŒ‡é’ˆæŒ‡å‘å‰é©±èŠ‚ç‚¹ï¼ˆlï¼‰
        // 4. å°†æ–°èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘åç»§èŠ‚ç‚¹ï¼ˆnullï¼‰
        final Node<E> newNode = new Node<>(l, e, null);
        // ä¿®æ”¹ last æŒ‡é’ˆ
        last = newNode;
        if (l == null)
            // l ä¸º null è¯´æ˜é¦–ä¸ªæ·»åŠ çš„å…ƒç´ ï¼Œéœ€è¦ä¿®æ”¹ first æŒ‡é’ˆ
            first = newNode;
        else
            // 5. å°†å‰é©±èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹
            l.next = newNode;
        // 6. å°†åç»§èŠ‚ç‚¹çš„ prev æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹ï¼ˆåç»§èŠ‚ç‚¹æ˜¯ nullï¼Œæ‰€ä»¥æ²¡æœ‰è¿™ä¸ªæ­¥éª¤ï¼‰
        size++;
        modCount++;
    }
    
    // åœ¨æŒ‡å®šèŠ‚ç‚¹å‰æ·»åŠ 
    // 1. æ‰¾åˆ°æ’å…¥ä½ç½®çš„åç»§èŠ‚ç‚¹
    void linkBefore(E e, Node<E> succ) {
        final Node<E> pred = succ.prev;
        // 2. æ„é€ æ–°èŠ‚ç‚¹
        // 3. å°†æ–°èŠ‚ç‚¹çš„ prev æŒ‡é’ˆæŒ‡å‘å‰é©±èŠ‚ç‚¹ï¼ˆpredï¼‰
        // 4. å°†æ–°èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘åç»§èŠ‚ç‚¹ï¼ˆsuccï¼‰
        final Node<E> newNode = new Node<>(pred, e, succ);
        succ.prev = newNode;
        if (pred == null)
            first = newNode;
        else
            // 5. å°†å‰é©±èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹
            pred.next = newNode;
        size++;
        modCount++;
    }
    
    // åœ¨æŒ‡å®šä½ç½®æ·»åŠ æ•´ä¸ªé›†åˆå…ƒç´ 
    // index ä¸º 0ï¼šåœ¨é“¾è¡¨å¤´éƒ¨æ·»åŠ 
    // index ä¸º sizeï¼šåœ¨é“¾è¡¨å°¾éƒ¨æ·»åŠ 
    public boolean addAll(int index, Collection<? extends E> c) {
        checkPositionIndex(index);
        // äº‹å®ä¸Šï¼Œc.toArray() çš„å®é™…ç±»å‹ä¸ä¸€å®šæ˜¯ Object[]ï¼Œæœ‰å¯èƒ½æ˜¯ String[] ç­‰
        // ä¸è¿‡ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ Nodeä¸­çš„item æ‰¿æ¥çš„ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒ ArrayList ä¸­çš„ ArrayStoreException é—®é¢˜
        Object[] a = c.toArray();
        // æ·»åŠ çš„æ•°ç»„ä¸ºç©ºï¼Œè·³è¿‡
        int numNew = a.length;
        if (numNew == 0)
            return false;
    
        // 1. æ‰¾åˆ°æ’å…¥ä½ç½®çš„åç»§èŠ‚ç‚¹
        // predï¼šæ’å…¥ä½ç½®çš„å‰é©±èŠ‚ç‚¹
        // succï¼šæ’å…¥ä½ç½®çš„åç»§èŠ‚ç‚¹
        Node<E> pred, succ;
        if (index == size) {
            succ = null;
            pred = last;
        } else {
            // æ‰¾åˆ° index ä½ç½®åŸæœ¬çš„èŠ‚ç‚¹ï¼Œæ’å…¥åå˜æˆåç»§èŠ‚ç‚¹
            succ = node(index);
            pred = succ.prev;
        }
        // æ’å…¥é›†åˆå…ƒç´ 
        for (Object o : a) {
            E e = (E) o;
            // 2. æ„é€ æ–°èŠ‚ç‚¹
            // 3. å°†æ–°èŠ‚ç‚¹çš„ prev æŒ‡é’ˆæŒ‡å‘å‰é©±èŠ‚ç‚¹
            Node<E> newNode = new Node<>(pred, e, null);
            if (pred == null)
                // pred ä¸º null è¯´æ˜æ˜¯åœ¨å¤´éƒ¨æ’å…¥ï¼Œéœ€è¦ä¿®æ”¹ first æŒ‡é’ˆ
                first = newNode;
            else
                // 5. å°†å‰é©±èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹
                pred.next = newNode;
            // ä¿®æ”¹å‰é©±æŒ‡é’ˆ
            pred = newNode;
        }
    
        if (succ == null) {
            // succ ä¸º null è¯´æ˜æ˜¯åœ¨å°¾éƒ¨æ’å…¥ï¼Œéœ€è¦ä¿®æ”¹ last æŒ‡é’ˆ
            last = pred;
        } else {
            // 4. å°†æ–°èŠ‚ç‚¹çš„ next æŒ‡é’ˆæŒ‡å‘åç»§èŠ‚ç‚¹
            pred.next = succ;
            // 6. å°†åç»§èŠ‚ç‚¹çš„ prev æŒ‡é’ˆæŒ‡å‘æ–°èŠ‚ç‚¹
            succ.prev = pred;
        }
        // æ•°é‡å¢åŠ  numNew
        size += numNew;
        modCount++;
        return true;
    }
    
    // å°† LinkedList è½¬åŒ–ä¸º Object æ•°ç»„
    public Object[] toArray() {
        Object[] result = new Object[size];
        int i = 0;
        for (Node<E> x = first; x != null; x = x.next)
            result[i++] = x.item;
        return result;
    }
    

åœ¨é“¾è¡¨ä¸­é—´æ·»åŠ èŠ‚ç‚¹æ—¶ï¼Œä¼šç”¨åˆ° node(index) æ–¹æ³•æŸ¥è¯¢æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹ã€‚å¯ä»¥çœ‹åˆ°ç»´æŒ first å’Œ last å¤´å°¾èŠ‚ç‚¹çš„ä½œç”¨åˆå‘æŒ¥å‡ºæ¥äº†ï¼š

*   å¦‚æœç´¢å¼•ä½ç½®å°äº size/2ï¼Œåˆ™ä»å¤´èŠ‚ç‚¹å¼€å§‹æ‰¾ï¼›
*   å¦‚æœç´¢å¼•ä½ç½®å¤§äº size/2ï¼Œåˆ™ä»å°¾èŠ‚ç‚¹å¼€å§‹æ‰¾ã€‚

è™½ç„¶ï¼Œæˆ‘ä»¬ä»å¤æ‚åº¦åˆ†æçš„è§’åº¦çœ‹ï¼Œä»å“ªä¸ªæ–¹å‘æŸ¥è¯¢æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(n)ã€‚ä½†ä»å·¥ç¨‹åˆ†æçš„è§’åº¦çœ‹è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œä»æ›´é è¿‘ç›®æ ‡èŠ‚ç‚¹çš„ä½ç½®å¼€å§‹æŸ¥è¯¢ï¼Œå®é™…æ‰§è¡Œçš„æ—¶é—´ä¼šæ›´çŸ­ã€‚

`æŸ¥è¯¢æŒ‡å®šä½ç½®èŠ‚ç‚¹`

    // å¯»æ‰¾æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦ï¼šO(n)
    Node<E> node(int index) {
        if (index < (size >> 1)) {
            // å¦‚æœç´¢å¼•ä½ç½®å°äº size/2ï¼Œåˆ™ä»å¤´èŠ‚ç‚¹å¼€å§‹æ‰¾
            Node<E> x = first;
            for (int i = 0; i < index; i++)
                x = x.next;
            return x;
        } else {
            // å¦‚æœç´¢å¼•ä½ç½®å¤§äº size/2ï¼Œåˆ™ä»å°¾èŠ‚ç‚¹å¼€å§‹æ‰¾
            Node<E> x = last;
            for (int i = size - 1; i > index; i--)
                x = x.prev;
            return x;
        }
    }
    

LinkedList çš„åˆ é™¤æ–¹æ³•å…¶å®å°±æ˜¯æ·»åŠ æ–¹æ³•çš„é€†è¿ç®—ï¼Œæˆ‘ä»¬å°±ä¸é‡å¤åˆ†æäº†ã€‚

    // åˆ é™¤å¤´éƒ¨å…ƒç´ 
    public E removeFirst() {
        final Node<E> f = first;
        if (f == null)
            throw new NoSuchElementException();
        return unlinkFirst(f);
    }
    
    // åˆ é™¤å°¾éƒ¨å…ƒç´ 
    public E removeLast() {
        final Node<E> l = last;
        if (l == null)
            throw new NoSuchElementException();
        return unlinkLast(l);
    }
    
    // åˆ é™¤æŒ‡å®šå…ƒç´ 
    public E remove(int index) {
        checkElementIndex(index);
        return unlink(node(index));
    }
    

* * *

### 2.4 LinkedList çš„è¿­ä»£å™¨

Java çš„ foreach æ˜¯è¯­æ³•ç³–ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯é‡‡ç”¨ iterator çš„æ–¹å¼ã€‚ç”±äº LinkedList æœ¬èº«å°±æ˜¯åŒå‘çš„ï¼Œæ‰€ä»¥ LinkedList åªæä¾›äº† 1 ä¸ªè¿­ä»£å™¨ï¼š

*   **ListIterator listIterator()ï¼š** åŒå‘è¿­ä»£å™¨

ä¸å…¶ä»–å®¹å™¨ç±»ä¸€æ ·ï¼ŒLinkedList çš„è¿­ä»£å™¨ä¸­éƒ½æœ‰ fail-fast æœºåˆ¶ã€‚å¦‚æœåœ¨è¿­ä»£çš„è¿‡ç¨‹ä¸­å‘ç° expectedModCount å˜åŒ–ï¼Œè¯´æ˜æ•°æ®è¢«ä¿®æ”¹ï¼Œæ­¤æ—¶å°±ä¼šæå‰æŠ›å‡º `ConcurrentModificationException` å¼‚å¸¸ï¼ˆå½“ç„¶ä¹Ÿä¸ä¸€å®šæ˜¯è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼‰ã€‚

    public ListIterator<E> listIterator(int index) {
        checkPositionIndex(index);
        return new ListItr(index);
    }
    
    // éé™æ€å†…éƒ¨ç±»
    private class ListItr implements ListIterator<E> {
        private Node<E> lastReturned;
        private Node<E> next;
        private int nextIndex;
        // åˆ›å»ºè¿­ä»£å™¨æ—¶ä¼šè®°å½•å¤–éƒ¨ç±»çš„ modCount
        private int expectedModCount = modCount;
    
        ListItr(int index) {
            next = (index == size) ? null : node(index);
            nextIndex = index;
        }
    
        public E next() {
            // æ›´æ–° expectedModCount
            checkForComodification();
            ...
        }
        ...
    }
    

### 2.5 LinkedList çš„åºåˆ—åŒ–è¿‡ç¨‹

*   **ğŸ™‹ğŸ»â€â™€ï¸Â ç–‘é—® 2ï¼šä¸ºä»€ä¹ˆå­—æ®µéƒ½å£°æ˜ `transient` å…³é”®å­—ï¼Ÿ**

LinkedList é‡å†™äº† JDK åºåˆ—åŒ–çš„é€»è¾‘ï¼Œä¸åºåˆ—åŒ–é“¾è¡¨èŠ‚ç‚¹ï¼Œè€Œåªæ˜¯åºåˆ—åŒ–é“¾è¡¨èŠ‚ç‚¹ä¸­çš„æœ‰æ•ˆæ•°æ®ï¼Œè¿™æ ·åºåˆ—åŒ–äº§ç‰©çš„å¤§å°å°±æœ‰æ‰€é™ä½ã€‚åœ¨ååºåˆ—æ—¶ï¼Œåªéœ€è¦æŒ‰ç…§å¯¹è±¡é¡ºåºä¾æ¬¡æ·»åŠ åˆ°é“¾è¡¨çš„æœ«å°¾ï¼Œå°±èƒ½æ¢å¤é“¾è¡¨çš„é¡ºåºã€‚

    // åºåˆ—åŒ–å’Œååºåˆ—åŒ–åªè€ƒè™‘æœ‰æ•ˆæ•°æ®
    
    // åºåˆ—åŒ–è¿‡ç¨‹
    private void writeObject(java.io.ObjectOutputStream s)
        throws java.io.IOException {
        // Write out any hidden serialization magic
        s.defaultWriteObject();
    
        // å†™å…¥é“¾è¡¨é•¿åº¦
        s.writeInt(size);
    
        // å†™å…¥èŠ‚ç‚¹ä¸Šçš„æœ‰æ•ˆæ•°æ®
        for (Node<E> x = first; x != null; x = x.next)
            s.writeObject(x.item);
    }
    
    // ååºåˆ—åŒ–è¿‡ç¨‹
    private void readObject(java.io.ObjectInputStream s)
        throws java.io.IOException, ClassNotFoundException {
        // Read in any hidden serialization magic
        s.defaultReadObject();
    
        // è¯»å–é“¾è¡¨é•¿åº¦
        int size = s.readInt();
    		
        // è¯»å–æœ‰æ•ˆå…ƒç´ å¹¶ç”¨ linkLast æ·»åŠ åˆ°é“¾è¡¨å°¾éƒ¨
        for (int i = 0; i < size; i++)
            linkLast((E)s.readObject());
    }
    

### 2.6 LinkedList çš„ clone() è¿‡ç¨‹

LinkedList ä¸­çš„ first å’Œ last æŒ‡é’ˆæ˜¯å¼•ç”¨ç±»å‹ï¼Œå› æ­¤åœ¨ clone() ä¸­éœ€è¦å®ç°æ·±æ‹·è´ã€‚å¦åˆ™ï¼Œå…‹éš†åä¸¤ä¸ª LinkedList å¯¹è±¡ä¼šç›¸äº’å½±å“ï¼š

    private LinkedList<E> superClone() {
        try {
            return (LinkedList<E>) super.clone();
        } catch (CloneNotSupportedException e) {
            throw new InternalError(e);
        }
    }
    
    public Object clone() {
        LinkedList<E> clone = superClone();
    
        // Put clone into "virgin" state
        clone.first = clone.last = null;
        clone.size = 0;
        clone.modCount = 0;
    
        // å°†åŸé“¾è¡¨ä¸­çš„æ•°æ®ä¾æ¬¡æ·»åŠ åˆ°æ–°ç«‹æ¡ˆè¡¨ä¸­
        for (Node<E> x = first; x != null; x = x.next)
            clone.add(x.item);
    
        return clone;
    }
    

### 2.7 LinkedList å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ï¼Ÿ

æœ‰ 5 ç§æ–¹å¼ï¼š

*   **æ–¹æ³• 1 - ä½¿ç”¨ Collections.synchronizedList åŒ…è£…ç±»ï¼š** åŸç†ä¹Ÿæ˜¯åœ¨æ‰€æœ‰æ–¹æ³•ä¸Šå¢åŠ  synchronized å…³é”®å­—ï¼›
*   **æ–¹æ³• 2 - ä½¿ç”¨ ConcurrentLinkedQueue å®¹å™¨ç±»ï¼š** åŸºäº CAS æ— é”å®ç°çš„çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—ï¼›
*   **æ–¹æ³• 3 - ä½¿ç”¨ LinkedBlockingQueue å®¹å™¨ï¼š** åŸºäºåŠ é”çš„é˜»å¡é˜Ÿåˆ—ï¼Œé€‚åˆäºå¸¦é˜»å¡æ“ä½œçš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼›
*   **æ–¹æ³• 4 - ä½¿ç”¨ LinkedBlockingDeque å®¹å™¨ï¼š** åŸºäºåŠ é”çš„é˜»å¡åŒç«¯é˜Ÿåˆ—ï¼Œé€‚åˆäºå¸¦é˜»å¡æ“ä½œçš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼›
*   **æ–¹æ³• 5 - ä½¿ç”¨ ConcurrentLinkedDeque å®¹å™¨ç±»ï¼š** åŸºäº CAS æ— é”å®ç°çš„çº¿ç¨‹å®‰å…¨åŒç«¯é˜Ÿåˆ—ã€‚

* * *

3\. æ€»ç»“
------

*   1ã€LinkedList æ˜¯åŸºäºé“¾è¡¨çš„çº¿æ€§è¡¨ï¼ŒåŒæ—¶å…·å¤‡ Listã€Queue å’Œ Stack çš„è¡Œä¸ºï¼›
    
*   2ã€åœ¨æŸ¥è¯¢æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹æ—¶ï¼Œå¦‚æœç´¢å¼•ä½ç½®å°äº size/2ï¼Œåˆ™ä»å¤´èŠ‚ç‚¹å¼€å§‹æ‰¾ï¼Œå¦åˆ™ä»å°¾èŠ‚ç‚¹å¼€å§‹æ‰¾ï¼›
    
*   3ã€LinkedList é‡å†™äº†åºåˆ—åŒ–è¿‡ç¨‹ï¼Œåªå¤„ç†é“¾è¡¨èŠ‚ç‚¹ä¸­æœ‰æ•ˆçš„å…ƒç´ ï¼›
    
*   4ã€LinkedList å’Œ ArrayList éƒ½ä¸è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œä¸ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚
    

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬æåˆ°äº† List çš„æ•°ç»„å®ç° ArrayListï¼Œè€Œ LinkedList ä¸ä»…æ˜¯ List çš„é“¾è¡¨å®ç°ï¼ŒåŒæ—¶è¿˜æ˜¯ Queue å’Œ Stack çš„é“¾è¡¨å®ç°ã€‚é‚£ä¹ˆï¼Œåœ¨ Java ä¸­çš„ Queue å’Œ Stack çš„æ•°ç»„å®ç°æ˜¯ä»€ä¹ˆå‘¢ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨ä¸‹ç¯‡æ–‡ç« è®¨è®ºï¼Œè¯·å…³æ³¨ã€‚

* * *

å°å½­çš„ Android äº¤æµç¾¤ 02 ç¾¤
--------------------

![](https://files.mdnice.com/user/3257/c99a7ebd-78c5-4556-b594-86e77a20eee9.png)

* * *

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7db0e43b744943f685ad1e3627f1ceb1~tplv-k3u1fbpfcp-watermark.image?)