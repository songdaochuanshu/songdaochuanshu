---
layout: post
title: "ASP.NET Core WebApiè¿”å›ç»“æœç»Ÿä¸€åŒ…è£…å®è·µ"
date: "2022-04-11T03:09:29.721Z"
---
ASP.NET Core WebApiè¿”å›ç»“æœç»Ÿä¸€åŒ…è£…å®è·µ
=============================

### å‰è¨€

Â Â Â Â è¿‘æœŸåœ¨é‡æ–°æ­å»ºä¸€å¥—åŸºäºASP.NET Core WebAPIçš„æ¡†æ¶ï¼Œè¿™å…¶ä¸­ç¡®å®å¸¦æ¥äº†ä¸å°‘çš„æ”¶è·ï¼Œæ¯•ç«Ÿå½“ä½ æƒ³æ­å»ºä¸€å¥—æ¡†æ¶çš„æ—¶å€™ï¼Œä½ æ€»ä¼šä¸è‡ªè§‰çš„å»æƒ³ï¼Œå¦‚ä½•è®©è¿™å¥—æ¡†æ¶å˜å¾—æ›´å®Œå–„ä¸€ç‚¹æ›´å¥½ç”¨ä¸€ç‚¹ã€‚å…¶ä¸­åœ¨å…³äºWebApiç»Ÿä¸€ç»“æœè¿”å›çš„æ—¶å€™ï¼Œè®©æˆ‘ä¹Ÿæœ‰äº†æ›´ä¸€æ­¥çš„æ€è€ƒï¼Œé¦–å…ˆæ˜¯å¦‚ä½•èƒ½æ›´å¥½çš„é™åˆ¶è¿”å›ç»Ÿä¸€çš„æ ¼å¼ï¼Œå…¶æ¬¡æ˜¯å…³äºç»“æœçš„åŒ…è£…ä¸€å®šæ˜¯æ›´ç®€å•æ›´å¼ºå¤§ã€‚åœ¨ä¸æ–­çš„æ€è€ƒå’Œå®Œå–„ä¸­ï¼Œç»ˆäºæœ‰äº†åˆæ­¥çš„æˆæœï¼Œä¾¿åˆ†äº«å‡ºæ¥ï¼Œå­¦æ— æ­¢å¢ƒæ€è€ƒä¾¿æ— æ­¢å¢ƒï¼Œå¸Œæœ›ä»¥æ­¤èƒ½ä¸å›å…±å‹‰ã€‚

### ç»Ÿä¸€ç»“æœç±»å°è£…

Â Â Â Â é¦–å…ˆå¦‚æœè®©è¿”å›çš„ç»“æœæ ¼å¼ç»Ÿä¸€ï¼Œå°±å¾—æœ‰ä¸€ä¸ªç»Ÿä¸€çš„åŒ…è£…ç±»å»åŒ…è£…æ‰€æœ‰çš„è¿”å›ç»“æœï¼Œå› ä¸ºè¿”å›çš„å…·ä½“æ•°æ®è™½ç„¶æ ¼å¼ä¸€è‡´ï¼Œä½†æ˜¯å…·ä½“çš„å€¼çš„ç±»å‹æ˜¯ä¸ç¡®å®šçš„ï¼Œå› æ­¤æˆ‘ä»¬è¿™é‡Œéœ€è¦å®šä¹‰ä¸ªæ³›å‹ç±»ã€‚å½“ç„¶å¦‚æœä½ ä¸é€‰æ‹©æ³›å‹ç±»çš„è¯ç”¨dynamicæˆ–è€…objectç±»å‹ä¹Ÿæ˜¯å¯ä»¥çš„,ä½†æ˜¯è¿™æ ·çš„è¯å¯èƒ½ä¼šå¸¦æ¥ä¸¤ç‚¹ä¸è¶³

*   ä¸€æ˜¯å¯èƒ½ä¼šå­˜åœ¨è£…ç®±æ‹†ç®±çš„æ“ä½œã€‚
*   äºŒæ˜¯å¦‚æœå¼•å…¥swaggerçš„è¯æ˜¯æ²¡åŠæ³•ç”Ÿæˆè¿”å›çš„ç±»å‹çš„ï¼Œå› ä¸ºdynamicæˆ–objectç±»å‹éƒ½æ˜¯æ‰§è¡Œå…·ä½“çš„actionæ—¶æ‰èƒ½ç¡®å®šè¿”å›ç±»å‹çš„ï¼Œä½†æ˜¯swaggerçš„ç»“æ„æ˜¯é¦–æ¬¡è¿è¡Œçš„æ—¶å€™å°±è·å–åˆ°çš„ï¼Œå› æ­¤æ— æ³•æ„ŸçŸ¥å…·ä½“ç±»å‹ã€‚

#### å®šä¹‰åŒ…è£…ç±»

ä¸Šé¢æˆ‘ä»¬ä¹Ÿè¯´äº†å…³äºå®šä¹‰æ³›å‹ç±»çš„ä¼˜åŠ¿ï¼Œè¿™é‡Œå°±è¯ä¸å¤šè¯´æ¥ç›´æ¥å°è£…ä¸€ä¸ªç»“æœè¿”å›çš„åŒ…è£…ç±»

    public class ResponseResult<T>
    {
        /// <summary>
        /// çŠ¶æ€ç»“æœ
        /// </summary>
        public ResultStatus Status { get; set; } = ResultStatus.Success;
    
        private string? _msg;
    
        /// <summary>
        /// æ¶ˆæ¯æè¿°
        /// </summary>
        public string? Message
        {
            get
            {
                // å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰çš„ç»“æœæè¿°ï¼Œåˆ™å¯ä»¥è·å–å½“å‰çŠ¶æ€çš„æè¿°
                return !string.IsNullOrEmpty(_msg) ? _msg : EnumHelper.GetDescription(Status);
            }
            set
            {
                _msg = value;
            }
        }
    
        /// <summary>
        /// è¿”å›ç»“æœ
        /// </summary>
        public T Data { get; set; }
    }
    

å…¶ä¸­è¿™é‡Œçš„`ResultStatus`æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œç”¨äºå®šä¹‰å…·ä½“çš„è¿”å›çŠ¶æ€ç ï¼Œç”¨äºåˆ¤æ–­è¿”å›çš„ç»“æœæ˜¯æ­£å¸¸è¿˜æ˜¯å¼‚å¸¸æˆ–è€…å…¶ä»–ï¼Œæˆ‘è¿™é‡Œåªæ˜¯ç®€å•çš„å®šä¹‰äº†ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹ï¼Œæœ‰éœ€è¦çš„è¯ä¹Ÿå¯ä»¥è‡ªè¡Œæ‰©å±•

    public enum ResultStatus
    {
        [Description("è¯·æ±‚æˆåŠŸ")]
        Success = 1,
        [Description("è¯·æ±‚å¤±è´¥")]
        Fail = 0,
        [Description("è¯·æ±‚å¼‚å¸¸")]
        Error = -1
    }
    

è¿™ç§æƒ…å†µä¸‹å®šä¹‰æšä¸¾ç±»å‹å¹¶ä¸”ç»“åˆå®ƒçš„`DescriptionAttribute`çš„ç‰¹æ€§å»æè¿°æšä¸¾çš„å«ä¹‰æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œé¦–å…ˆå®ƒå¯ä»¥ç»Ÿä¸€ç®¡ç†æ¯ä¸ªçŠ¶æ€çš„å«ä¹‰ï¼Œå…¶æ¬¡æ˜¯æ›´æ–¹ä¾¿çš„è·å–æ¯ä¸ªçŠ¶æ€å¯¹åº”çš„æè¿°ã€‚è¿™æ ·çš„è¯å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰çš„ç»“æœæè¿°ï¼Œåˆ™å¯ä»¥è·å–å½“å‰çŠ¶æ€çš„æè¿°æ¥å……å½“é»˜è®¤å€¼çš„æƒ…å†µã€‚è¿™ä¸ªæ—¶å€™åœ¨å†™å…·ä½“actionçš„æ—¶å€™ä¼šæ˜¯ä»¥ä¸‹çš„æ•ˆæœ

    [HttpGet("GetWeatherForecast")]
    public ResponseResult<IEnumerable<WeatherForecast>> GetAll()
    {
        var datas = Enumerable.Range(1, 5).Select(index => new WeatherForecast
        {
            Date = DateTime.Now.AddDays(index),
            TemperatureC = Random.Shared.Next(-20, 55),
            Summary = Summaries[Random.Shared.Next(Summaries.Length)]
        });
        return new ResponseResult<IEnumerable<WeatherForecast>> {  Data = datas };
    }
    

è¿™æ ·çš„è¯æ¯æ¬¡ç¼–å†™actionçš„æ—¶å€™éƒ½å¯ä»¥è¿”å›ä¸€ä¸ª`ResponseResult<T>`çš„ç»“æœäº†ï¼Œè¿™é‡Œå°±ä½“ç°å‡ºäº†ä½¿ç”¨æšä¸¾å®šä¹‰çŠ¶æ€ç çš„ä¼˜åŠ¿äº†ï¼Œç›¸å½“ä¸€éƒ¨åˆ†åœºæ™¯æˆ‘ä»¬å¯ä»¥çœç•¥äº†çŠ¶æ€ç ç”šè‡³æ˜¯æ¶ˆæ¯çš„ç¼–å†™ï¼Œæ¯•ç«Ÿå¾ˆå¤šæ—¶å€™åœ¨ä¿éšœåŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œä»£ç è¿˜æ˜¯è¶Šç®€ä»‹è¶Šå¥½çš„ï¼Œæ›´ä½•å†µæ˜¯ä¸€äº›é«˜é¢‘æ“ä½œå‘¢ã€‚

#### å‡çº§ä¸€ä¸‹æ“ä½œ

ä¸Šé¢è™½ç„¶æˆ‘ä»¬å®šä¹‰äº†`ResponseResult<T>`æ¥ç»Ÿä¸€åŒ…è£…è¿”å›ç»“æœï¼Œä½†æ˜¯æ¯æ¬¡è¿˜å¾—newä¸€ä¸‹ï¼Œåœ¨æ— ç–‘æ˜¯ä¸å¤ªæ–¹ä¾¿çš„ï¼Œè€Œä¸”è¿˜è¦æ¯æ¬¡éƒ½è¿˜å¾—ç»™å±æ€§èµ‹å€¼å•¥çš„ï¼Œä¹Ÿæ˜¯å¤Ÿéº»çƒ¦çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±æƒ³ï¼Œå¦‚æœèƒ½æœ‰ç›¸å…³çš„è¾…åŠ©æ–¹æ³•å»ç®€åŒ–æ“ä½œå°±å¥½äº†ï¼Œæ–¹æ³•ä¸ç”¨å¤ªå¤šèƒ½æ»¡è¶³åœºæ™¯å°±å¥½ï¼Œä¹Ÿå°±æ˜¯å¤Ÿç”¨å°±å¥½ï¼Œæœ€ä¸»è¦çš„æ˜¯èƒ½æ”¯æŒæ‰©å±•å°±å¯ä»¥ã€‚å› æ­¤ï¼Œè¿›ä¸€æ­¥å‡çº§ä¸€ä¸‹ç»“æœåŒ…è£…ç±»ï¼Œæ¥ç®€åŒ–ä¸€ä¸‹æ“ä½œ

    public class ResponseResult<T>
    {
        /// <summary>
        /// çŠ¶æ€ç»“æœ
        /// </summary>
        public ResultStatus Status { get; set; } = ResultStatus.Success;
    
        private string? _msg;
    
        /// <summary>
        /// æ¶ˆæ¯æè¿°
        /// </summary>
        public string? Message
        {
            get
            {
                return !string.IsNullOrEmpty(_msg) ? _msg : EnumHelper.GetDescription(Status);
            }
            set
            {
                _msg = value;
            }
        }
    
        /// <summary>
        /// è¿”å›ç»“æœ
        /// </summary>
        public T Data { get; set; }
    
        /// <summary>
        /// æˆåŠŸçŠ¶æ€è¿”å›ç»“æœ
        /// </summary>
        /// <param name="result">è¿”å›çš„æ•°æ®</param>
        /// <returns></returns>
        public static ResponseResult<T> SuccessResult(T data)
        {
            return new ResponseResult<T> { Status = ResultStatus.Success, Data = data };
        }
    
        /// <summary>
        /// å¤±è´¥çŠ¶æ€è¿”å›ç»“æœ
        /// </summary>
        /// <param name="code">çŠ¶æ€ç </param>
        /// <param name="msg">å¤±è´¥ä¿¡æ¯</param>
        /// <returns></returns>
        public static ResponseResult<T> FailResult(string? msg = null)
        {
            return new ResponseResult<T> { Status = ResultStatus.Fail, Message = msg };
        }
    
        /// <summary>
        /// å¼‚å¸¸çŠ¶æ€è¿”å›ç»“æœ
        /// </summary>
        /// <param name="code">çŠ¶æ€ç </param>
        /// <param name="msg">å¼‚å¸¸ä¿¡æ¯</param>
        /// <returns></returns>
        public static ResponseResult<T> ErrorResult(string? msg = null)
        {
            return new ResponseResult<T> { Status = ResultStatus.Error, Message = msg };
        }
    
        /// <summary>
        /// è‡ªå®šä¹‰çŠ¶æ€è¿”å›ç»“æœ
        /// </summary>
        /// <param name="status"></param>
        /// <param name="result"></param>
        /// <returns></returns>
        public static ResponseResult<T> Result(ResultStatus status, T data, string? msg = null)
        {
            return new ResponseResult<T> { Status = status, Data = data, Message = msg };
        }
    }
    

è¿™é‡Œè¿›ä¸€æ­¥å°è£…äº†å‡ ä¸ªæ–¹æ³•ï¼Œè‡³äºå…·ä½“å°è£…å‡ ä¸ªè¿™ç§æ–¹æ³•ï¼Œè¿˜æ˜¯é‚£å¥è¯å¤Ÿç”¨å°±å¥½ï¼Œè¿™é‡Œæˆ‘å°è£…äº†å‡ ä¸ªå¸¸ç”¨çš„æ“ä½œï¼ŒæˆåŠŸçŠ¶æ€ã€å¤±è´¥çŠ¶æ€ã€å¼‚å¸¸çŠ¶æ€ã€æœ€å®Œå…¨çŠ¶æ€ï¼Œè¿™å‡ ç§çŠ¶æ€åŸºæœ¬ä¸Šå¯ä»¥æ»¡è¶³å¤§å¤šæ•°çš„åœºæ™¯ï¼Œä¸å¤Ÿçš„è¯å¯ä»¥è‡ªè¡Œè¿›è¡Œè¿›ä¸€æ­¥çš„å¤šå°è£…å‡ ä¸ªæ–¹æ³•ã€‚è¿™æ ·çš„è¯åœ¨actionä½¿ç”¨çš„æ—¶å€™å°±ä¼šç®€åŒ–å¾ˆå¤š,çœå»äº†æ‰‹åŠ¨å±æ€§èµ‹å€¼

    [HttpGet("GetWeatherForecast")]
    public ResponseResult<IEnumerable<WeatherForecast>> GetAll()
    {
        var datas = Enumerable.Range(1, 5).Select(index => new WeatherForecast
        {
            Date = DateTime.Now.AddDays(index),
            TemperatureC = Random.Shared.Next(-20, 55),
            Summary = Summaries[Random.Shared.Next(Summaries.Length)]
        });
        return ResponseResult<IEnumerable<WeatherForecast>>.SuccessResult(datas);
    }
    

#### è¿›ä¸€æ­¥å®Œå–„

ä¸Šé¢æˆ‘ä»¬é€šè¿‡å®Œå–„`ResponseResult<T>`ç±»çš„å°è£…ï¼Œç¡®å®åœ¨æŸäº›ç¨‹åº¦ä¸ŠèŠ‚çœäº†ä¸€éƒ¨åˆ†æ“ä½œï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ç‚¹ç¾ä¸­ä¸è¶³ï¼Œé‚£å°±æ˜¯æ¯æ¬¡è¿”å›ç»“æœçš„æ—¶å€™ï¼Œè™½ç„¶å®šä¹‰äº†å‡ ä¸ªå¸¸ç”¨çš„é™æ€æ–¹æ³•å»æ“ä½œè¿”å›ç»“æœï¼Œä½†æ˜¯æ¯æ¬¡è¿˜å¾—é€šè¿‡æ‰‹åŠ¨å»æŠŠ`ResponseResult<T>`ç±»ç»™è¯·å‡ºæ¥æ‰èƒ½ä½¿ç”¨ï¼Œç°åœ¨å‘¢æƒ³åœ¨æ“ä½œè¿”å›ç»“æœçš„æ—¶å€™ä¸æƒ³çœ‹åˆ°å®ƒäº†ã€‚è¿™ä¸ªå‘¢ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©å¾®è½¯é’ˆå¯¹MVCçš„Controllerçš„å°è£…è¿›ä¸€æ­¥å¾—åˆ°ä¸€ä¸ªæ€è·¯ï¼Œé‚£å°±æ˜¯å®šä¹‰ä¸€ä¸ªåŸºç±»çš„Controllerï¼Œæˆ‘ä»¬åœ¨ControlleråŸºç±»ä¸­ï¼ŒæŠŠå¸¸ç”¨çš„è¿”å›ç»“æœå°è£…ä¸€äº›æ–¹æ³•ï¼Œè¿™æ ·åœ¨Controllerçš„å­ç±»ä¸­å‘¢å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œè€Œä¸éœ€è¦å…³æ³¨å¦‚ä½•å»ç¼–å†™æ–¹æ³•çš„è¿”å›ç±»å‹äº†ï¼Œè¯ä¸å¤šè¯´åŠ¨æ‰‹æŠŠControlleråŸºç±»å°è£…èµ·æ¥

    [ApiController]
    [Route("api/[controller]")]
    public class ApiControllerBase : ControllerBase
    {
        /// <summary>
        /// æˆåŠŸçŠ¶æ€è¿”å›ç»“æœ
        /// </summary>
        /// <param name="result">è¿”å›çš„æ•°æ®</param>
        /// <returns></returns>
        protected ResponseResult<T> SuccessResult<T>(T result)
        {
            return ResponseResult<T>.SuccessResult(result);
        }
    
        /// <summary>
        /// å¤±è´¥çŠ¶æ€è¿”å›ç»“æœ
        /// </summary>
        /// <param name="code">çŠ¶æ€ç </param>
        /// <param name="msg">å¤±è´¥ä¿¡æ¯</param>
        /// <returns></returns>
        protected ResponseResult<T> FailResult<T>(string? msg = null)
        {
            return ResponseResult<T>.FailResult(msg);
        }
    
        /// <summary>
        /// å¼‚å¸¸çŠ¶æ€è¿”å›ç»“æœ
        /// </summary>
        /// <param name="code">çŠ¶æ€ç </param>
        /// <param name="msg">å¼‚å¸¸ä¿¡æ¯</param>
        /// <returns></returns>
        protected ResponseResult<T> ErrorResult<T>(string? msg = null)
        {
            return ResponseResult<T>.ErrorResult(msg);
        }
    
        /// <summary>
        /// è‡ªå®šä¹‰çŠ¶æ€è¿”å›ç»“æœ
        /// </summary>
        /// <param name="status"></param>
        /// <param name="result"></param>
        /// <returns></returns>
        protected ResponseResult<T> Result<T>(ResultStatus status, T result, string? msg = null)
        {
            return ResponseResult<T>.Result(status, result, msg);
        }
    }
    

æœ‰äº†è¿™ä¹ˆä¸€ä¸ªå¤§ç¥çš„è¾…åŠ©ï¼Œä¸€åˆ‡ä¼¼ä¹åˆå‘ç€ç¾å¥½è¿›å‘äº†ä¸€æ­¥ï¼Œè¿™æ ·çš„è¯æ¯æ¬¡æˆ‘ä»¬è‡ªå®šä¹‰çš„Controllerå¯ä»¥ç»§æ‰¿`ApiControllerBase`ç±»ï¼Œä»è€Œä½¿ç”¨é‡Œé¢çš„ç®€åŒ–æ“ä½œã€‚æ‰€ä»¥å†å†™èµ·æ¥ä»£ç ï¼Œå¤§æ¦‚æ˜¯è¿™ä¹ˆä¸€ä¸ªæ•ˆæœ

    public class WeatherForecastController : ApiControllerBase
    {
        private static readonly string[] Summaries = new[]
        {
           "Freezing", "Bracing", "Chilly", "Cool", "Mild", "Warm", "Balmy", "Hot", "Sweltering", "Scorching"
        };
    
        [HttpGet("GetWeatherForecast")]
        public ResponseResult<IEnumerable<WeatherForecast>> GetAll()
        {
            var datas = Enumerable.Range(1, 5).Select(index => new WeatherForecast
            {
                Date = DateTime.Now.AddDays(index),
                TemperatureC = Random.Shared.Next(-20, 55),
                Summary = Summaries[Random.Shared.Next(Summaries.Length)]
            });
            return SuccessResult(datas);
        }
    }
    

è¿™ä¸ªæ—¶å€™ç¡®å®å˜å¾—å¾ˆç¾å¥½äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰é€ƒè„±ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯æˆ‘è¿˜æ˜¯å¾—é€šè¿‡ç‰¹å®šçš„æ–¹æ³•æ¥å¾—åˆ°ä¸€ä¸ª`ResponseResult<T>`ç±»å‹çš„è¿”å›ç»“æœï¼ŒåŒ…æ‹¬æˆ‘ä»¬ç»™`ResponseResult<T>`ç±»å°è£…é™æ€æ–¹æ³•ï¼Œæˆ–è€…ç”šè‡³æ˜¯å®šä¹‰`ApiControllerBase`åŸºç±»ï¼Œéƒ½æ˜¯ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–è¿™ä¸ªæ“ä½œã€‚ç°åœ¨å‘¢æˆ‘æƒ³å‘Šåˆ«è¿™ä¸ªé™åˆ¶ï¼Œæˆ‘èƒ½ä¸èƒ½æŠŠè¿”å›çš„ç»“æœç›´æ¥å°±é»˜è®¤çš„è½¬åŒ–æˆ`ResponseResult<T>`ç±»å‹çš„ç»“æœå‘¢ï¼Ÿå½“ç„¶å¯ä»¥ï¼Œè¿™ä¹Ÿæ˜¯é€šè¿‡ASP.NET Coreçš„å°è£…æ€è·¯ä¸­å¾—åˆ°çš„å¯å‘ï¼Œå€ŸåŠ©`implicit`è‡ªåŠ¨å®Œæˆéšå¼è½¬æ¢ï¼Œè¿™ä¸ªåœ¨ASP.NET Coreçš„`ActionResult<T>`ç±»ä¸­ä¹Ÿæœ‰ä½“ç°

    public static implicit operator ActionResult<TValue>(TValue value)
    {
        return new ActionResult<TValue>(value);
    }
    

é€šè¿‡è¿™ä¸ªæ€è·¯æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å®Œå–„`ResponseResult<T>`ç±»çš„å®ç°æ–¹å¼ï¼Œç»™å®ƒæ·»åŠ ä¸€ä¸ªéšå¼è½¬æ¢çš„æ“ä½œï¼Œä»…ä»…å®šä¹‰ä¸€ä¸ªæ–¹æ³•å³å¯ï¼Œåœ¨`ResponseResult<T>`ç±»ä¸­ç»§ç»­å®Œå–„

    /// <summary>
    /// éšå¼å°†Tè½¬åŒ–ä¸ºResponseResult<T>
    /// </summary>
    /// <param name="value"></param>
    public static implicit operator ResponseResult<T>(T value)
    {
        return new ResponseResult<T> { Data = value };
    }
    

è¿™ç§å¯¹äºç»å¤§éƒ¨åˆ†è¿”å›æˆåŠŸç»“æœçš„æ—¶å€™æä¾›äº†éå¸¸ç®€åŒ–çš„æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœä½ å†å»ä½¿ç”¨actionçš„æ—¶å€™å°±å¯ä»¥è¿›ä¸€æ­¥æ¥ç®€åŒ–è¿”å›å€¼çš„æ“ä½œäº†

    [HttpGet("GetWeatherForecast")]
    public ResponseResult<IEnumerable<WeatherForecast>> GetAll()
    {
        var datas = Enumerable.Range(1, 5).Select(index => new WeatherForecast
        {
            Date = DateTime.Now.AddDays(index),
            TemperatureC = Random.Shared.Next(-20, 55),
            Summary = Summaries[Random.Shared.Next(Summaries.Length)]
        });
        return datas.ToList();
    }
    

å› ä¸ºæˆ‘ä»¬å®šä¹‰äº†`T`åˆ°`ResponseResult<T>`çš„éšå¼è½¬æ¢ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¿”å›ç»“æœäº†ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨å¯¹ç»“æœè¿”å›å€¼è¿›è¡ŒåŒ…è£…ã€‚

### æ¼ç½‘ä¹‹é±¼å¤„ç†

åœ¨ä¸Šé¢æˆ‘ä»¬ä¸ºäº†å°½é‡ç®€åŒ–actionè¿”å›`ResponseResult<T>`çš„ç»Ÿä¸€è¿”å›ç»“æ„çš„å°è£…ï¼Œå·²ç»å¯¹`ResponseResult<T>`ç±»è¿›è¡Œäº†è®¸å¤šçš„å°è£…ï¼Œå¹¶ä¸”è¿˜é€šè¿‡å°è£…`ApiControllerBase`åŸºç±»è¿›ä¸€æ­¥ç®€åŒ–è¿™ä¸€æ“ä½œï¼Œä½†æ˜¯ç»ˆç©¶è¿˜æ˜¯é¿å…ä¸äº†ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯å¾ˆå¤šæ—¶å€™å¯èƒ½æƒ³ä¸èµ·æ¥å¯¹actionçš„è¿”å›å€¼å»åŠ `ResponseResult<T>`ç±»å‹çš„è¿”å›å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹‹å‰çš„æ‰€æœ‰å°è£…éƒ½å¾—å»ºç«‹åœ¨å¿…é¡»è¦å£°æ˜`ResponseResult<T>`ç±»å‹çš„è¿”å›å€¼çš„åŸºç¡€ä¸Šæ‰è¡Œï¼Œå¦åˆ™å°±ä¸å­˜åœ¨ç»Ÿä¸€è¿”å›æ ¼å¼è¿™ä¸€è¯´æ³•äº†ã€‚æ‰€ä»¥é’ˆå¯¹è¿™äº›æ¼ç½‘ä¹‹é±¼ï¼Œæˆ‘ä»¬å¿…é¡»è¦æœ‰ç»Ÿä¸€çš„æ‹¦æˆªæœºåˆ¶ï¼Œè¿™æ ·æ‰èƒ½æ›´å®Œæ•´çš„é’ˆå¯¹è¿”å›ç»“æœè¿›è¡Œå¤„ç†ï¼Œé’ˆå¯¹è¿™ç§å¯¹actionè¿”å›å€¼çš„æ“ä½œï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯å®šä¹‰`è¿‡æ»¤å™¨`è¿›è¡Œå¤„ç†ï¼Œå› æ­¤ç¬”è€…é’ˆå¯¹è¿™ä¸€ç°è±¡å°è£…äº†ä¸€ä¸ªç»Ÿä¸€åŒ…è£…ç»“æœçš„è¿‡æ»¤å™¨ï¼Œå®ç°å¦‚ä¸‹

    public class ResultWrapperFilter : ActionFilterAttribute
    {
        public override void OnResultExecuting(ResultExecutingContext context)
        {
            var controllerActionDescriptor = context.ActionDescriptor as ControllerActionDescriptor;
            var actionWrapper = controllerActionDescriptor?.MethodInfo.GetCustomAttributes(typeof(NoWrapperAttribute), false).FirstOrDefault();
            var controllerWrapper = controllerActionDescriptor?.ControllerTypeInfo.GetCustomAttributes(typeof(NoWrapperAttribute), false).FirstOrDefault();
            //å¦‚æœåŒ…å«NoWrapperAttributeåˆ™è¯´æ˜ä¸éœ€è¦å¯¹è¿”å›ç»“æœè¿›è¡ŒåŒ…è£…ï¼Œç›´æ¥è¿”å›åŸå§‹å€¼
            if (actionWrapper != null || controllerWrapper != null)
            {
                return;
            }
    
            //æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œå…·ä½“å®ç°
            var rspResult = new ResponseResult<object>();
            if (context.Result is ObjectResult)
            {
                var objectResult = context.Result as ObjectResult;
                if (objectResult?.Value == null)
                {
                    rspResult.Status = ResultStatus.Fail;
                    rspResult.Message = "æœªæ‰¾åˆ°èµ„æº";
                    context.Result = new ObjectResult(rspResult);
                }
                else
                {
                    //å¦‚æœè¿”å›ç»“æœå·²ç»æ˜¯ResponseResult<T>ç±»å‹çš„åˆ™ä¸éœ€è¦è¿›è¡Œå†æ¬¡åŒ…è£…äº†
                    if (objectResult.DeclaredType.IsGenericType && objectResult.DeclaredType?.GetGenericTypeDefinition() == typeof(ResponseResult<>))
                    {
                        return;
                    }
                    rspResult.Data = objectResult.Value;
                    context.Result = new ObjectResult(rspResult);
                }
                return;
            }
        }
    }
    

åœ¨ä½¿ç”¨WebAPIçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„actionç»å¤§éƒ¨åˆ†æ˜¯ç›´æ¥è¿”å›`ViewModel`æˆ–`Dto`è€Œå¹¶æ²¡æœ‰è¿”å›`ActionResult`ç±»å‹ç›¸å…³ï¼Œä½†æ˜¯æ— å¦¨ï¼Œè¿™ä¸ªæ—¶å€™MVCçš„åº•å±‚æ“ä½œä¼šä¸ºæˆ‘ä»¬å°†è¿™äº›è‡ªå®šä¹‰çš„ç±»å‹åŒ…è£…æˆ`ObjectResult`ç±»å‹çš„ï¼Œå› æ­¤æˆ‘ä»¬çš„`ResultWrapperFilter`è¿‡æ»¤å™¨ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸€æœºåˆ¶è¿›è¡Œæ“ä½œçš„ã€‚è¿™é‡Œæœ‰ä¸¤ç‚¹éœ€è¦è€ƒè™‘çš„

*   é¦–å…ˆæ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»è¦å…è®¸å¹¶éæ‰€æœ‰çš„è¿”å›ç»“æœéƒ½è¦è¿›è¡Œ`ResponseResult<T>`çš„åŒ…è£…ï¼Œä¸ºäº†æ»¡è¶³è¿™ä¸€éœ€æ±‚æˆ‘ä»¬è¿˜å®šä¹‰äº†`NoWrapperAttribute`æ¥å®ç°è¿™ä¸€æ•ˆæœï¼Œåªè¦Controlleræˆ–Actionæœ‰`NoWrapperAttribute`çš„ä¿®é¥°åˆ™ä¸å¯¹è¿”å›ç»“æœè¿›è¡Œä»»ä½•å¤„ç†ã€‚
*   å…¶æ¬¡æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„Actionä¸Šçš„è¿”å›ç±»å‹å·²ç»æ˜¯`ResponseResult<T>`ç±»å‹çš„ï¼Œåˆ™ä¹Ÿä¸éœ€è¦å¯¹è¿”å›ç»“æœè¿›è¡Œå†æ¬¡çš„åŒ…è£…ã€‚

å…³äº`ResultWrapperFilter`çš„å®šä¹‰å…¶å®å¾ˆç®€å•ï¼Œå› ä¸ºåœ¨è¿™é‡Œå®ƒåªæ˜¯èµ·åˆ°äº†ä¸€ä¸ªæ ‡è®°çš„ä½œç”¨

    [AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, AllowMultiple = false, Inherited = false)]
    public class NoWrapperAttribute:Attribute
    {
    }
    

åˆ°äº†è¿™é‡Œï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„æƒ…å†µéœ€è¦æ³¨æ„ï¼Œé‚£å°±æ˜¯å½“ç¨‹åºå‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸Šé¢çš„è¿™äº›æœºåˆ¶ä¹Ÿæ˜¯æ²¡æœ‰åŠæ³•ç”Ÿæ•ˆçš„ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰ä¸€ä¸ªé’ˆå¯¹å…¨å±€å¼‚å¸¸å¤„ç†çš„æ‹¦æˆªæœºåˆ¶ï¼ŒåŒæ ·æ˜¯å¯ä»¥ä½¿ç”¨ç»Ÿä¸€å¼‚å¸¸å¤„ç†è¿‡æ»¤å™¨è¿›è¡Œæ“ä½œï¼Œå®ç°å¦‚ä¸‹

    public class GlobalExceptionFilter : IExceptionFilter
    {
        private readonly ILogger<GlobalExceptionFilter> _logger;
        public GlobalExceptionFilter(ILogger<GlobalExceptionFilter> logger)
        {
            _logger = logger;
        }
    
        public void OnException(ExceptionContext context)
        {
            //å¼‚å¸¸è¿”å›ç»“æœåŒ…è£…
            var rspResult = ResponseResult<object>.ErrorResult(context.Exception.Message);
            //æ—¥å¿—è®°å½•
            _logger.LogError(context.Exception, context.Exception.Message);
            context.ExceptionHandled = true;
            context.Result = new InternalServerErrorObjectResult(rspResult);
        }
    
        public class InternalServerErrorObjectResult : ObjectResult
        {
            public InternalServerErrorObjectResult(object value) : base(value)
            {
                StatusCode = StatusCodes.Status500InternalServerError;
            }
        }
    }
    

å†™å®Œè¿‡æ»¤å™¨äº†ï¼Œåƒä¸‡ä¸èƒ½å¿˜äº†å…¨å±€æ³¨å†Œä¸€ä¸‹ï¼Œå¦åˆ™å®ƒä¹Ÿå°±åªèƒ½çœ‹çœ‹äº†ï¼Œä¸ä¼šèµ·åˆ°ä»»ä½•æ•ˆæœ

    builder.Services.AddControllers(options =>
    {
        options.Filters.Add<ResultWrapperFilter>();
        options.Filters.Add<GlobalExceptionFilter>();
    });
    

### æ¼ç½‘ä¹‹é±¼å¦ä¸€ç§å¤„ç†

å½“ç„¶é’ˆå¯¹ä¸Šé¢ä¸¤ç§é’ˆå¯¹æ¼ç½‘ä¹‹é±¼çš„å¤„ç†ï¼Œåœ¨ASP.NET Coreä¸Šè¿˜å¯ä»¥é€šè¿‡ä¸­é—´ä»¶çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œè‡³äºè¿‡æ»¤å™¨å’Œä¸­é—´ä»¶æœ‰ä½•ä¸åŒï¼Œç›¸ä¿¡å¤§å®¶å·²ç»éå¸¸æ¸…æ¥šäº†ï¼Œæ ¸å¿ƒä¸åŒæ€»ç»“èµ·æ¥å°±ä¸€å¥è¯`äºŒè€…çš„å¤„ç†é˜¶æ®µä¸åŒï¼Œå³é’ˆå¯¹ç®¡é“çš„ç”Ÿå‘½å‘¨æœŸå¤„ç†æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸­é—´ä»¶å¯ä»¥å¤„ç†ä»»ä½•ç”Ÿå‘½å‘¨æœŸåœ¨å®ƒä¹‹åçš„åœºæ™¯ï¼Œä½†æ˜¯è¿‡æ»¤å™¨åªç®¡ç†Controllerè¿™ä¸€å—çš„ä¸€äº©ä¸‰åˆ†åœ°`ä½†æ˜¯é’ˆå¯¹ç»“æœåŒ…è£…è¿™ä¸€åœºæ™¯ï¼Œç¬”è€…è§‰å¾—ä½¿ç”¨è¿‡æ»¤å™¨çš„æ–¹å¼æ›´å®¹æ˜“å¤„ç†ä¸€ç‚¹ï¼Œå› ä¸ºæ¯•ç«Ÿæˆ‘ä»¬æ˜¯è¦æ“ä½œActionçš„è¿”å›ç»“æœï¼Œé€šè¿‡è¿‡æ»¤å™¨ä¸­æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‹¿åˆ°è¿”å›ç»“æœçš„å€¼ã€‚ä½†æ˜¯è¿™ä¸ªæ“ä½œå¦‚æœåœ¨ä¸­é—´ä»¶é‡Œè¿›è¡Œæ“ä½œçš„è¯ï¼Œåªèƒ½é€šè¿‡è¯»å–`Response.Body`è¿›è¡Œæ“ä½œäº†ï¼Œç¬”è€…è¿™é‡Œä¹Ÿå°è£…äº†ä¸€ä¸ªæ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤º

    public static IApplicationBuilder UseResultWrapper(this IApplicationBuilder app)
    {
            var serializerOptions = app.ApplicationServices.GetRequiredService<IOptions<JsonOptions>>().Value.JsonSerializerOptions;
            serializerOptions.Encoder = JavaScriptEncoder.UnsafeRelaxedJsonEscaping;
            return app.Use(async (context, next) =>
            {
                var originalResponseBody = context.Response.Body;
                try
                {
                    //å› ä¸ºResponse.Bodyæ²¡åŠæ³•è¿›è¡Œç›´æ¥è¯»å–ï¼Œæ‰€ä»¥éœ€è¦ç‰¹æ®Šæ“ä½œä¸€ä¸‹
                    using var swapStream = new MemoryStream();
                    context.Response.Body = swapStream;
                    await next();
                    //åˆ¤æ–­æ˜¯å¦å‡ºç°äº†å¼‚å¸¸çŠ¶æ€ç ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
                    if (context.Response.StatusCode == StatusCodes.Status500InternalServerError)
                    {
                        context.Response.Body.Seek(0, SeekOrigin.Begin);
                        await swapStream.CopyToAsync(originalResponseBody);
                        return;
                    }
                    var endpoint = context.Features.Get<IEndpointFeature>()?.Endpoint;
                    if (endpoint != null)
                    {
                        //åªé’ˆå¯¹application/jsonç»“æœè¿›è¡Œå¤„ç†
                        if (context.Response.ContentType.ToLower().Contains("application/json"))
                        {
                            //åˆ¤æ–­ç»ˆç»“ç‚¹æ˜¯å¦åŒ…å«NoWrapperAttribute
                            NoWrapperAttribute noWrapper = endpoint.Metadata.GetMetadata<NoWrapperAttribute>();
                            if (noWrapper != null)
                            {
                                context.Response.Body.Seek(0, SeekOrigin.Begin);
                                await swapStream.CopyToAsync(originalResponseBody);
                                return;
                            }
                            //è·å–Actionçš„è¿”å›ç±»å‹
                            var controllerActionDescriptor = context.GetEndpoint()?.Metadata.GetMetadata<ControllerActionDescriptor>();
                            if (controllerActionDescriptor != null)
                            {
                                //æ³›å‹çš„ç‰¹æ®Šå¤„ç†
                                var returnType = controllerActionDescriptor.MethodInfo.ReturnType;
                                if (returnType.IsGenericType && (returnType.GetGenericTypeDefinition() == typeof(Task<>) || returnType.GetGenericTypeDefinition() == typeof(ValueTask<>)))
                                {
                                    returnType = returnType.GetGenericArguments()[0];
                                }
                                //å¦‚æœç»ˆç»“ç‚¹å·²ç»æ˜¯ResponseResult<T>åˆ™ä¸è¿›è¡ŒåŒ…è£…å¤„ç†
                                if (returnType.IsGenericType && returnType.GetGenericTypeDefinition() == typeof(ResponseResult<>))
                                {
                                    context.Response.Body.Seek(0, SeekOrigin.Begin);
                                    await swapStream.CopyToAsync(originalResponseBody);
                                    return;
                                }
                                context.Response.Body.Seek(0, SeekOrigin.Begin);
                                //ååºåˆ—åŒ–å¾—åˆ°åŸå§‹ç»“æœ
                                var result = await JsonSerializer.DeserializeAsync(context.Response.Body, returnType, serializerOptions);
                                //å¯¹åŸå§‹ç»“æœè¿›è¡ŒåŒ…è£…
                                var bytes = JsonSerializer.SerializeToUtf8Bytes(ResponseResult<object>.SuccessResult(result), serializerOptions);
                                new MemoryStream(bytes).CopyTo(originalResponseBody);
                                return;
                            }
                        }
                    }
                    context.Response.Body.Seek(0, SeekOrigin.Begin);
                    await swapStream.CopyToAsync(originalResponseBody);
                }
                finally
                {
                    //å°†åŸå§‹çš„Bodyå½’è¿˜å›æ¥
                    context.Response.Body = originalResponseBody;
                }
            });
        }
    }
    

ç›¸ä¿¡é€šè¿‡ä¸Šé¢çš„å¤„ç†ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´å®¹æ˜“çš„çœ‹å‡ºæ¥ï¼Œè°æ›´å®¹æ˜“çš„å¯¹ç»Ÿä¸€ç»“æœè¿›è¡ŒåŒ…è£…å¤„ç†äº†ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ˜¯é’ˆå¯¹Actionçš„è¿”å›ç»“æœè¿›è¡Œå¤„ç†ï¼Œè€Œè¿‡æ»¤å™¨æ˜¾ç„¶å°±æ˜¯ä¸ºé’ˆå¯¹Controllerå’ŒActionçš„å¤„ç†è€Œç”Ÿçš„ã€‚ä½†æ˜¯é€šè¿‡ä¸­é—´ä»¶çš„æ–¹å¼èƒ½æ›´å®Œæ•´çš„é’ˆå¯¹ç»“æœè¿›è¡Œå¤„ç†ï¼Œå› ä¸ºè®¸å¤šæ—¶å€™æˆ‘ä»¬å¯èƒ½æ˜¯åœ¨è‡ªå®šä¹‰çš„ä¸­é—´ä»¶é‡Œç›´æ¥æ‹¦æˆªè¯·æ±‚å¹¶è¿”å›ï¼Œä½†æ˜¯æ ¹æ®äºŒå…«åŸåˆ™è¿™ç§æƒ…å†µç›¸å¯¹äºActionçš„è¿”å›å€¼æ¯•ç«Ÿæ˜¯å°‘æ•°ï¼Œæœ‰è¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥`ResponseResult<T>`å°è£…çš„æ–¹æ³•è¿›è¡Œè¿”å›æ“ä½œï¼Œä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ä½†æ˜¯è¿™ä¸ªæ—¶å€™å‘¢ï¼Œå…³äºå¼‚å¸¸å¤„ç†æˆ‘ä»¬é€šè¿‡å…¨å±€å¼‚å¸¸å¤„ç†ä¸­é—´ä»¶ï¼Œåˆ™èƒ½æ›´å¤šçš„å¤„ç†æ›´å¤šçš„åœºæ™¯ï¼Œä¸”æ²¡æœ‰å‰¯ä½œç”¨ï¼Œçœ‹ä¸€ä¸‹å®ƒçš„å®šä¹‰

    public static IApplicationBuilder UseException(this IApplicationBuilder app)
    {
        return app.UseExceptionHandler(configure =>
        {
            configure.Run(async context =>
            {
                var exceptionHandlerPathFeature = context.Features.Get<IExceptionHandlerPathFeature>();
                var ex = exceptionHandlerPathFeature?.Error;
                if (ex != null)
                {
                    var _logger = context.RequestServices.GetService<ILogger<IExceptionHandlerPathFeature>>();
                    var rspResult = ResponseResult<object>.ErrorResult(ex.Message);
                    _logger?.LogError(ex, message: ex.Message);
                    context.Response.StatusCode = StatusCodes.Status500InternalServerError;
                    context.Response.ContentType = "application/json;charset=utf-8";
                    await context.Response.WriteAsync(rspResult.SerializeObject());
                }
            });
        });
    }
    

ä½¿ç”¨å…¨å±€å¼‚å¸¸æ¢³ç†ä¸­é—´ä»¶æ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„ï¼Œä¸»è¦å› ä¸ºåœ¨å¼‚å¸¸å¤„ç†çš„æ—¶å€™æˆ‘ä»¬ä¸éœ€è¦è¯»å–`Response.Body`è¿›è¡Œè¯»å–æ“ä½œçš„ï¼Œæ‰€ä»¥è‡³äºæ˜¯é€‰æ‹©å¼‚å¸¸å¤„ç†ä¸­é—´ä»¶è¿˜æ˜¯è¿‡æ»¤å™¨ï¼Œå¤§å®¶å¯ä»¥é’ˆå¯¹è‡ªå·±çš„å®é™…åœºæ™¯è¿›è¡Œé€‰æ‹©ï¼Œä¸¤ç§æ–¹å¼éƒ½æ˜¯å¯ä»¥çš„ã€‚

### æ€»ç»“

Â Â Â Â æœ¬æ–‡ä¸»è¦æ˜¯å±•ç¤ºäº†é’ˆå¯¹ASP.NET Core WeApiç»“æœç»Ÿä¸€è¿”å›æ ¼å¼çš„ç›¸å…³æ“ä½œï¼Œé€šè¿‡ç¤ºä¾‹æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„å±•ç¤ºäº†å®Œæˆè¿™ä¸€ç›®æ ‡çš„ä¸æ–­å‡çº§çš„å®ç°ï¼Œè™½ç„¶æ•´ä½“çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å´æ‰¿è½½ç€ç¬”è€…ä¸€æ¬¡åˆä¸€æ¬¡çš„æ€è€ƒå‡çº§ã€‚æ¯æ¬¡å®ç°å®Œä¸€ä¸ªé˜¶æ®µï¼Œéƒ½ä¼šå»æƒ³æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼å»å®Œå–„å®ƒã€‚è¿™å…¶ä¸­è¿˜æœ‰ä¸€äº›æ€è·¯æ¥è‡ªå¾®è½¯æºç ä¸ºæˆ‘ä»¬æä¾›çš„æ€è·¯ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™è¿˜æ˜¯å»ºè®®å¤§å®¶å»çœ‹ä¸€çœ‹æºç çš„ï¼Œå¯ä»¥åœ¨å¾ˆå¤šæ—¶å€™ä¸ºæˆ‘ä»¬æä¾›ä¸€ç§è§£å†³é—®é¢˜çš„æ€è·¯ã€‚æ­£å¦‚æˆ‘çœ‹åˆ°çš„ä¸€å¥è¯ï¼Œè¯»æºç ä¹Ÿæ˜¯ä¸€ç§å›´åŸï¼Œå¤–é¢çš„äººä¸æƒ³è¿›å»ï¼Œé‡Œé¢çš„äººä¸æƒ³å‡ºæ¥ã€‚å¦‚æœå¤§å®¶æœ‰æ›´å¥½çš„å®ç°æ–¹å¼ï¼Œæ¬¢è¿ä¸€èµ·è®¨è®ºã€‚æ›¾ç»çš„æ—¶å€™æˆ‘ä¼šä¸ºè‡ªå·±å­¦åˆ°äº†ä¸€ä¸ªæ–°çš„æŠ€èƒ½è€Œæ„Ÿåˆ°é«˜å…´ï¼Œåˆ°äº†åæ¥æˆ‘ä¼šå¯¹æœ‰ä¸€ä¸ªå¥½çš„æ€è·¯ï¼Œæˆ–è€…å¥½çš„è§£å†³é—®é¢˜çš„æ–¹æ³•è€Œæ„Ÿåˆ°é«˜å…´ã€‚è¯»ä¸‡å·ä¹¦å¾ˆé‡è¦ï¼Œè¡Œä¸‡é‡Œè·¯åŒæ ·é‡è¦ï¼Œè¯»ä¹¦æ˜¯æ²‰æ·€ï¼Œè¡Œè·¯æ˜¯å®è·µï¼Œç»“åˆåˆ°ä¸€èµ·æ‰èƒ½æ›´å¥½çš„ä¿ƒè¿›ï¼Œè€Œä¸æ˜¯åªé€‰æ‹©ä¸€ç§ã€‚  
  

ğŸ‘‡æ¬¢è¿æ‰«ç å…³æ³¨æˆ‘çš„å…¬ä¼—å·ğŸ‘‡ ![](https://img2020.cnblogs.com/blog/2042116/202006/2042116-20200622133425514-1420050576.png)