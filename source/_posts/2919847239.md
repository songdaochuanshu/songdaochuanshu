---
layout: post
title: "å¤šçº¿ç¨‹07ï¼šasyncã€futureã€packaged_taskã€promise"
date: "2022-05-14T21:16:42.283Z"
---
å¤šçº¿ç¨‹07ï¼šasyncã€futureã€packaged\_taskã€promise
=========================================

ğŸ“•asyncã€futureã€packaged\_taskã€promise
=====================================

æœ¬èŠ‚å†…å®¹éœ€è¦åŒ…å«å¤´æ–‡ä»¶ï¼š`#include <future>`

ä¸€ã€std::asyncã€ std::future åˆ›å»ºåå°ä»»åŠ¡å¹¶è¿”å›å€¼
------------------------------------

â‘ ï¼šå¯ç”¨async

*   **std::asyncæ˜¯ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ï¼Œç”¨æ¥å¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œ**å¯åŠ¨èµ·æ¥ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ä¹‹åï¼Œ**å®ƒè¿”å›ä¸€ä¸ªstd::futureå¯¹è±¡ï¼Œ**è¿™ä¸ªå¯¹è±¡æ˜¯ä¸ªç±»æ¨¡æ¿ã€‚
*   â€œå¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡â€ï¼šå°±æ˜¯è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶å¼€å§‹ æ‰§è¡Œå¯¹åº”çš„çº¿ç¨‹å…¥å£å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªstd::futureå¯¹è±¡ï¼Œè¿™ä¸ªstd::futureå¯¹è±¡ä¸­å°±å«æœ‰çº¿ç¨‹å…¥å£å‡½æ•°æ‰€è¿”å›çš„ç»“æœï¼Œ**æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨futureå¯¹è±¡çš„æˆå‘˜å‡½æ•°get()æ¥è·å–ç»“æœã€‚**
*   â€œfutureâ€å°†æ¥çš„æ„æ€ï¼Œä¹Ÿæœ‰äººç§°å‘¼**std::futureæä¾›äº†ä¸€ç§è®¿é—®å¼‚æ­¥æ“ä½œç»“æœçš„æœºåˆ¶**ï¼Œå°±æ˜¯è¯´è¿™ä¸ªç»“æœä½ å¯èƒ½æ²¡åŠæ³•é©¬ä¸Šæ‹¿åˆ°ï¼Œä½†æ˜¯åœ¨ä¸ä¹…çš„å°†æ¥ï¼Œè¿™ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•çš„æ—¶å€™ï¼Œä½ å°±èƒ½å¤Ÿæ‹¿åˆ°ç»“æœäº†ï¼Œæ‰€ä»¥ï¼Œå¤§å®¶è¿™ä¹ˆç†è§£ï¼š**futureä¸­ä¿å­˜ç€ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼æ˜¯åœ¨å°†æ¥çš„æŸä¸ªæ—¶åˆ»èƒ½å¤Ÿæ‹¿åˆ°**ã€‚
*   std::futureå¯¹è±¡çš„**get()æˆå‘˜å‡½æ•°**ä¼šç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»“æŸå¹¶è¿”å›ç»“æœï¼Œæ‹¿ä¸åˆ°ç»“æœå®ƒå°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œæ„Ÿè§‰æœ‰ç‚¹åƒjoin()ã€‚ä½†æ˜¯ï¼Œå®ƒæ˜¯å¯ä»¥è·å–ç»“æœçš„ã€‚**å¹¶ä¸”è®°å¾—ä¸€ä¸ªfutureåªèƒ½è°ƒç”¨ä¸€æ¬¡getï¼ˆæ— è®ºå“ªé‡Œï¼Œéƒ½ä¼šå°†æ•°æ®è½¬ç§»ï¼‰**ï¼Œè°ƒç”¨ä¸¤æ¬¡ç¨‹åºä¼šå´©æºƒã€‚
*   std::futureå¯¹è±¡çš„**wait()æˆå‘˜å‡½æ•°**ï¼Œç”¨äºç­‰å¾…çº¿ç¨‹è¿”å›ï¼Œæœ¬èº«å¹¶ä¸è¿”å›ç»“æœï¼Œè¿™ä¸ªæ•ˆæœå’Œ std::thread çš„join()æ›´åƒã€‚æ²¡æœ‰åªèƒ½è°ƒç”¨ä¸€æ¬¡é™åˆ¶ï¼Œä½†æ˜¯è°ƒç”¨å¤šä¹Ÿæ²¡æœ‰æ•ˆæœã€‚
*   å¦‚æœä¸è°ƒç”¨futureçš„get()æˆå‘˜å‡½æ•°å’Œwait()æˆå‘˜å‡½æ•°ï¼Œç¨‹åºä¹Ÿä¼šåœ¨ä¸»å‡½æ•°returnå¤„ä¸€ç›´ç­‰å¾…è°ƒç”¨å­çº¿ç¨‹ç»“æŸï¼›

çœ‹ä¾‹å­ï¼š

    #include <iostream>
    #include <future>
    using namespace std;
    class A {
    public:
    	int mythread(int data) {
    		cout << data << endl;
    		return data * 2;
    	}
    };
     
     
    int mythread() {
    	cout << "mythread() start" << "threadid = " << std::this_thread::get_id() << endl;
    	std::chrono::milliseconds dura(5000);//ç¡5ç§’
    	std::this_thread::sleep_for(dura);
    	cout << "mythread() end" << "threadid = " << std::this_thread::get_id() << endl;
    	return 5;
    }
     
     
    int main() {
    	A a;
    	int tmp = 12;
    	cout << "main" << "threadid = " << std::this_thread::get_id() << endl;
    	std::future<int> result1 = std::async(mythread);
    	cout << "continue........" << endl;
    	cout << result1.get() << endl; //å¡åœ¨è¿™é‡Œç­‰å¾…mythread()æ‰§è¡Œå®Œæ¯•ï¼Œæ‹¿åˆ°ç»“æœ
    	
    	//ç±»æˆå‘˜å‡½æ•°
    	std::future<int> result2 = std::async(&A::mythread, &a, tmp); //ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯¹è±¡å¼•ç”¨æ‰èƒ½ä¿è¯çº¿ç¨‹é‡Œæ‰§è¡Œçš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡
    	//cout << result2.get() << endl;//get()åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œresult2ä¸å†æœ‰ç»“æœå€¼ï¼Œè½¬ç§»çš„æ˜¯å­˜çš„æ•°æ®ç±»å‹ï¼Œè¿™é‡Œæ˜¯intï¼
       //æˆ–è€…result2.wait();
    	cout << "finish all" << endl;
    	return 0;
    }
    
    

â‘¡ï¼šstd::asyncçš„ç¬¬ä¸€ä¸ªå‚æ•°

*   å‚æ•°ï¼šstd::launch::deferred: **è¡¨ç¤ºçº¿ç¨‹å…¥å£å‡½æ•°è°ƒç”¨è¢«å»¶è¿Ÿåˆ°std::futureçš„wait()æˆ–è€…get()å‡½æ•°è°ƒç”¨æ—¶æ‰æ‰§è¡Œï¼›** **é‚£å¦‚æœwait()æˆ–è€…get()æ²¡è°ƒç”¨ï¼Œé‚£ä¹ˆçº¿ç¨‹æ²¡æ‰§è¡Œï¼çº¿ç¨‹æ²¡æœ‰åˆ›å»ºï¼æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨çš„çº¿ç¨‹å…¥å£å‡½æ•°ï¼**

    #include <iostream>
    #include <future>
    using namespace std;
     
    int mythread() {
    	cout << "mythread() start" << "threadid = " << std::this_thread::get_id() << endl;
    	std::chrono::milliseconds dura(5000);
    	std::this_thread::sleep_for(dura);
    	cout << "mythread() end" << "threadid = " << std::this_thread::get_id() << endl;
    	return 5;
    }
     
     
    int main() {
    	cout << "main" << "threadid = " << std::this_thread::get_id() << endl;
    	std::future<int> result1 = std::async(std::launch::deferred ,mythread);
    	cout << "continue........" << endl;
    	cout << result1.get() << endl; //å¡åœ¨è¿™é‡Œç­‰å¾…mythread()æ‰§è¡Œå®Œæ¯•ï¼Œæ‹¿åˆ°ç»“æœ
    	cout << "finish all" << endl;
    	return 0;
    }
    

![image-20220418110151080](https://cdn.jsdelivr.net/gh/little-boy-David/blog-img/images202205150013553.png)

*   å‚æ•°ï¼šstd::launch::async:åœ¨è°ƒç”¨asyncå‡½æ•°çš„æ—¶å€™å°±å¼€å§‹åˆ›å»ºçº¿ç¨‹ï¼›ä¼šå¼ºåˆ¶std::asyncåˆ›å»ºæ–°çº¿ç¨‹ï¼Œå’Œthreadä¸€æ ·ã€‚
*   å¸¦ä¸Šä¸¤ä¸ªå‚æ•°ï¼šstd::launch::async |std::launch::deferred è¿™é‡Œè¿™ä¸ª |ï¼šä»¥ä¸ºè¿™è°ƒç”¨asyncçš„è¡Œä¸ºå¯èƒ½æ˜¯ **åˆ›å»ºæ–°çº¿ç¨‹å¹¶ç«‹å³æ‰§è¡Œï¼Œæˆ–è€…æ²¡æœ‰åˆ›å»ºæ–°çº¿ç¨‹å¹¶ä¸”å»¶è¿Ÿè°ƒç”¨result.get()æ‰å¼€å§‹æ‰§è¡Œä»»åŠ¡å…¥å£å‡½æ•°ï¼Œä¸¤è€…å±…å…¶ä¸€ã€‚**ï¼ˆç³»ç»Ÿä¼šè‡ªè¡Œå†³å®šæ˜¯å¼‚æ­¥ï¼ˆåˆ›å»ºæ–°çº¿ç¨‹ï¼‰è¿˜æ˜¯åŒæ­¥ï¼ˆä¸åˆ›å»ºæ–°çº¿ç¨‹ï¼‰æ–¹å¼è¿è¡Œï¼‰ï¼Œé»˜è®¤å€¼å°±æ˜¯è¿™ä¸ªï¼

äºŒã€std::package\_task
--------------------

*   ç›®çš„å°±æ˜¯ï¼šæ‰“åŒ…ä»»åŠ¡ï¼ŒæŠŠä»»åŠ¡åŒ…è£…èµ·æ¥
*   std::packaged\_taskæ˜¯ä¸ªæ¨¡æ¿ç±»ï¼Œå®ƒçš„æ¨¡æ¿å‚æ•°æ˜¯å„ç§å¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°ï¼Œå‡½æ•°æŒ‡é’ˆï¼Œlambdaè¡¨è¾¾å¼ï¼Œbindåˆ›å»ºçš„å¯¹è±¡ï¼Œä»¥åŠé‡è½½äº†å‡½æ•°è°ƒç”¨ç¬¦çš„ç±»,æœ‰ç‚¹åƒfunctionï¼‰ï¼›é€šè¿‡std::packaged\_taskæ¥æŠŠå„ç§å¯è°ƒç”¨å¯¹è±¡åŒ…è£…èµ·æ¥ï¼Œæ–¹ä¾¿å°†æ¥ä½œä¸ºçº¿ç¨‹å…¥å£å‡½æ•°æ¥è°ƒç”¨ã€‚
*   **packaged\_taskåŒ…è£…èµ·æ¥çš„å¯è°ƒç”¨å¯¹è±¡è¿˜å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œ**æ‰€ä»¥ä»è¿™ä¸ªè§’åº¦æ¥è®²ï¼Œpackaged\_taskå¯¹è±¡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ã€‚
*   çœ‹ä¾‹å­ï¼š

    //å¯è°ƒç”¨å¯¹è±¡æ˜¯æ™®é€šå‡½æ•°
    #include <thread>
    #include <iostream>
    #include <future>
    using namespace std;
     
    int mythread(int mypar) {
    	cout << mypar << endl;
    	cout << "mythread() start" << "threadid = " << std::this_thread::get_id() << endl;
    	std::chrono::milliseconds dura(5000);
    	std::this_thread::sleep_for(dura);
    	cout << "mythread() end" << "threadid = " << std::this_thread::get_id() << endl;
    	return 5;
    }
     
    int main() {
    	cout << "main" << "threadid = " << std::this_thread::get_id() << endl;
    	//æˆ‘ä»¬æŠŠå‡½æ•°mythreadé€šè¿‡packaged_taskåŒ…è£…èµ·æ¥
        //å‚æ•°æ˜¯ä¸€ä¸ªintï¼Œè¿”å›å€¼ç±»å‹æ˜¯int
        std::packaged_task<int(int)> mypt(mythread);
    	std::thread t1(std::ref(mypt), 1);//ä¼ å…¥çœŸå¼•ç”¨ï¼ä¸å¯ä»¥ç”¨detachæ¨¡å¼
    	t1.join();
    	std::future<int> result = mypt.get_future(); 
    	//std::futureå¯¹è±¡é‡ŒåŒ…å«æœ‰çº¿ç¨‹å…¥å£å‡½æ•°çš„è¿”å›ç»“æœï¼Œè¿™é‡Œresultä¿å­˜mythreadè¿”å›çš„ç»“æœã€‚
    	cout << result.get() << endl;
       
    	return 0;
    }
    
    

    //å¯è°ƒç”¨å¯¹è±¡æ˜¯lambdaè¡¨è¾¾å¼
    int main() {
    	cout << "main" << "threadid = " << std::this_thread::get_id() << endl;
        
    	std::packaged_task<int(int)> mypt([](int mypar) {
    		cout << mypar << endl;
    		cout << "mythread() start" << " threadid = " << std::this_thread::get_id() << endl;
    		std::chrono::milliseconds dura(5000);
    		std::this_thread::sleep_for(dura);
    		cout << "mythread() end" << " threadid = " << std::this_thread::get_id() << endl;
    		return 5;
    	}); 
    	
    	std::thread t1(std::ref(mypt), 1);//ä¼ çœŸå¼•ç”¨ï¼Œå› ä¸ºæ˜¯packege_task,myptåªèƒ½å†è¢«è°ƒç”¨ä¸€æ¬¡
    	t1.join();
    	std::future<int> result = mypt.get_future(); 
    	
    	cout << result.get() << endl;
     
    	cout << "finish overhead" << endl;
    	return 0;
    }
    

![image-20220418112915922](https://cdn.jsdelivr.net/gh/little-boy-David/blog-img/images202205150013851.png)

    //è°ƒç”¨å¯¹è±¡æ˜¯lambdaè¡¨è¾¾å¼ï¼Œç›´æ¥è°ƒç”¨
    int main() {
    	cout << "main" << "threadid = " << std::this_thread::get_id() << endl;
        
    	std::packaged_task<int(int)> mypt([](int mypar) {
    		cout << mypar << endl;
    		cout << "mythread() start" << " threadid = " << std::this_thread::get_id() << endl;
    		std::chrono::milliseconds dura(5000);
    		std::this_thread::sleep_for(dura);
    		cout << "mythread() end" << " threadid = " << std::this_thread::get_id() << endl;
    		return 5;
    	}); 
        
    	mypt(1);//ä¹Ÿå¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¸­ç›´æ¥è°ƒç”¨ï¼Œè¿™æ ·å°±å’Œfunctionçš„æ•ˆæœä¸€æ ·ï¼Œä½†æ˜¯åªèƒ½è°ƒç”¨ä¸€æ¬¡
    	std::future<int> result = mypt.get_future(); 
    	cout << result.get() << endl;
     
    	cout << "finish overhead" << endl;
    	return 0;
    }
    

![image-20220418113609731](https://cdn.jsdelivr.net/gh/little-boy-David/blog-img/images202205150013131.png)

tip:[äº†è§£ref](https://blog.csdn.net/leapmotion/article/details/120338292)

ä¸‰ã€promise
---------

*   std::promise ç±»æ¨¡æ¿ï¼Œ**æˆ‘ä»¬èƒ½å¤Ÿåœ¨æŸä¸ªçº¿ç¨‹ä¸­ç»™å®ƒèµ‹å€¼ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­æŠŠè¿™ä¸ªå€¼å–å‡ºæ¥ç”¨;**
    
*   æ€»ç»“ï¼š**é€šè¿‡promiseä¿å­˜ä¸€ä¸ªå€¼ï¼Œåœ¨å°†æ¥æŸæ—¶åˆ»æˆ‘ä»¬é€šè¿‡æŠŠä¸€ä¸ªfutureç»‘å®šåˆ°è¿™ä¸ªpromiseä¸Šæ¥å¾—åˆ°è¿™ä¸ªç»‘å®šçš„å€¼ï¼›**
    

    #include<iostream>
    #include<thread>
    #include<mutex>
    #include<future>
     
    using namespace std;
     
    void mythread(std::promise<int>&tmpp, int calc)
    {
    	//åšä¸€ç³»åˆ—å¤æ‚çš„æ“ä½œ
    	calc++;
    	calc *= 10;
     
    	//åšå…¶ä»–è¿ç®—ï¼Œæ¯”å¦‚æ•´æ•´èŠ±è´¹äº†5ç§’é’Ÿ
    	std::chrono::milliseconds dura(5000); //å®šä¸€ä¸ª5ç§’çš„æ—¶é—´
    	std::this_thread::sleep_for(dura);  //ä¼‘æ¯ä¸€å®šæ—¶å¸¸
     
    	int result = calc; //ä¿å­˜ç»“æœ
    	tmpp.set_value(result);  //####1.ç»“æœä¿å­˜åˆ°äº†tmppè¿™ä¸ªpromiseå¯¹è±¡ä¸­
    } 
     
    void mythread2(std::future<int> &tmpf) 
    {
    	auto result = tmpf.get();
    	cout <<"mythread result = " << result<<endl;
    }
     
    int main()
    {
    	std::promise<int> myprom; //å£°æ˜ä¸€ä¸ªstd::promiseå¯¹è±¡myprom,ä¿å­˜çš„å€¼ç±»å‹ä¸ºint;
    	std::thread t1(mythread,std::ref(myprom),180);
    	t1.join();
     
    	//è·å–ç»“æœå€¼
    	std::future<int> fu1 = myprom.get_future();//####2.promiseä¸futureç»‘å®šï¼Œç”¨äºè·å–çº¿ç¨‹è¿”å›å€¼
     
    	std::thread t2(mythread2,std::ref(fu1));
    	t2.join(); //ç­‰mythread2æ‰§è¡Œå®Œæ¯•
     
    	cout << "finish all"  << endl;
     	
        //fu1ä¸å†æœ‰ç”¨ï¼Œå·²ç»ä¸ºç©ºï¼›å·²ç»å…¨éƒ¨ä¼ å…¥mythread2çš„tmpfä¸­ï¼Œä½†æ˜¯mypromè¿˜å­˜ç€å€¼1810ï¼›
    	return 0;
    }
    
    //å¯¹äºrefï¼Œpackage_taskã€futureéƒ½ä¼šç§»åŠ¨ååŸæœ¬çš„å˜é‡å°±æ²¡æœ‰å†…å®¹äº†ï¼Œå¯¹äºpromiseï¼Œå´è¿˜æœ‰ï¼Œè¦æ¢ç´¢ä¸€ä¸‹
    

[å†äº†è§£async\\future\\ç­‰](https://blog.csdn.net/weiwei9363/article/details/106418146)

å››ã€std::asynæ·±å…¥ç†è§£
---------------

### **4.1 std::asyncå‚æ•°è¯¦è¿°**

*   å»¶è¿Ÿè°ƒç”¨å‚æ•° std::launch::deferredã€å»¶è¿Ÿè°ƒç”¨ã€‘ï¼Œstd::launch::asyncã€å¼ºåˆ¶åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‘ï¼›
    
*   **std::async()æˆ‘ä»¬ä¸€èˆ¬ä¸å«åˆ›å»ºçº¿ç¨‹ï¼ˆä»–èƒ½å¤Ÿåˆ›å»ºçº¿ç¨‹ï¼‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬å«å®ƒåˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡**ã€‚std::asyncå’Œstd::threadæœ€æ˜æ˜¾çš„ä¸åŒï¼š**å°±æ˜¯ async æœ‰æ—¶å€™å¹¶ä¸åˆ›å»ºæ–°çº¿ç¨‹**ã€‚
    

â‘ å¦‚æœç”¨std::launch::deferred æ¥è°ƒç”¨asyncï¼Ÿ

å»¶è¿Ÿåˆ°è°ƒç”¨ get() æˆ–è€… wait() æ—¶æ‰§è¡Œï¼Œå¦‚æœä¸è°ƒç”¨å°±ä¸ä¼šæ‰§è¡Œ

â‘¡å¦‚æœç”¨std::launch::asyncæ¥è°ƒç”¨asyncï¼Ÿ

å¼ºåˆ¶è¿™ä¸ªå¼‚æ­¥ä»»åŠ¡åœ¨æ–°çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œè¿™æ„å‘³ç€ï¼Œç³»ç»Ÿå¿…é¡»è¦åˆ›å»ºå‡ºæ–°çº¿ç¨‹æ¥è¿è¡Œå…¥å£å‡½æ•°ã€‚

â‘¢å¦‚æœåŒæ—¶ç”¨ std::launch::async | std::launch::deferred

è¿™é‡Œè¿™ä¸ª | æ„å‘³ç€asyncçš„è¡Œä¸ºå¯èƒ½æ˜¯ std::launch::async åˆ›å»ºæ–°çº¿ç¨‹ç«‹å³æ‰§è¡Œï¼Œ ä¹Ÿå¯èƒ½æ˜¯ std::launch::deferred æ²¡æœ‰åˆ›å»ºæ–°çº¿ç¨‹å¹¶ä¸”å»¶è¿Ÿåˆ°è°ƒç”¨get()æ‰§è¡Œï¼Œç”±ç³»ç»Ÿæ ¹æ®å®é™…æƒ…å†µæ¥å†³å®šé‡‡å–å“ªç§æ–¹æ¡ˆ

â‘£ä¸å¸¦é¢å¤–å‚æ•° std::async(mythread)ï¼Œåªç»™async ä¸€ä¸ªå…¥å£å‡½æ•°åï¼Œæ­¤æ—¶çš„ç³»ç»Ÿç»™çš„é»˜è®¤å€¼æ˜¯ std::launch::async | std::launch::deferred å’Œ â‘¢ ä¸€æ ·ï¼Œæœ‰ç³»ç»Ÿè‡ªè¡Œå†³å®šå¼‚æ­¥è¿˜æ˜¯åŒæ­¥è¿è¡Œã€‚

### 4.2 std::asyncå’Œstd::thread()åŒºåˆ«

*   **std::thread()å¦‚æœç³»ç»Ÿèµ„æºç´§å¼ å¯èƒ½å‡ºç°åˆ›å»ºçº¿ç¨‹å¤±è´¥çš„æƒ…å†µï¼Œå¦‚æœåˆ›å»ºçº¿ç¨‹å¤±è´¥é‚£ä¹ˆç¨‹åºå°±å¯èƒ½å´©æºƒï¼Œè€Œä¸”ä¸å®¹æ˜“æ‹¿åˆ°å‡½æ•°è¿”å›å€¼ï¼ˆä¸æ˜¯æ‹¿ä¸åˆ°ï¼‰**
*   **std::async()åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ã€‚å¯èƒ½åˆ›å»ºçº¿ç¨‹ä¹Ÿå¯èƒ½ä¸åˆ›å»ºçº¿ç¨‹ï¼Œå¹¶ä¸”å®¹æ˜“æ‹¿åˆ°çº¿ç¨‹å…¥å£å‡½æ•°çš„è¿”å›å€¼ï¼›**

ç”±äºç³»ç»Ÿèµ„æºé™åˆ¶ï¼š  
â‘ å¦‚æœç”¨std::threadåˆ›å»ºçš„çº¿ç¨‹å¤ªå¤šï¼Œåˆ™å¯èƒ½åˆ›å»ºå¤±è´¥ï¼Œç³»ç»ŸæŠ¥å‘Šå¼‚å¸¸ï¼Œå´©æºƒã€‚

â‘¡å¦‚æœç”¨std::asyncï¼Œä¸€èˆ¬å°±ä¸ä¼šæŠ¥å¼‚å¸¸ï¼Œå› ä¸ºå¦‚æœç³»ç»Ÿèµ„æºç´§å¼ ï¼Œæ— æ³•åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ï¼Œasyncä¸åŠ é¢å¤–å‚æ•°çš„è°ƒç”¨æ–¹å¼å°±ä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹ã€‚è€Œæ˜¯åœ¨åç»­è°ƒç”¨get()è¯·æ±‚ç»“æœæ—¶æ‰§è¡Œåœ¨è¿™ä¸ªè°ƒç”¨get()çš„çº¿ç¨‹ä¸Šã€‚

å¦‚æœä½ å¼ºåˆ¶asyncä¸€å®šè¦åˆ›å»ºæ–°çº¿ç¨‹å°±è¦ä½¿ç”¨ std::launch::async æ ‡è®°ã€‚æ‰¿å—çš„ä»£ä»·æ˜¯ï¼Œç³»ç»Ÿèµ„æºç´§å¼ æ—¶å¯èƒ½å´©æºƒã€‚

â‘¢æ ¹æ®ç»éªŒï¼Œ**ä¸€ä¸ªç¨‹åºä¸­çº¿ç¨‹æ•°é‡ ä¸å®œè¶…è¿‡100~200** ã€‚

### 4.3 asyncä¸ç¡®å®šæ€§é—®é¢˜çš„è§£å†³

è®©ç³»ç»Ÿè‡ªè¡Œå†³å®šæ˜¯å¦åˆ›å»ºçº¿ç¨‹ï¼š`std::future<int> result = std::async(mythread);`é—®é¢˜ç„¦ç‚¹åœ¨äºè¿™ä¸ªå†™æ³•ï¼Œä»»åŠ¡åˆ°åº•æœ‰æ²¡æœ‰è¢«æ¨è¿Ÿæ‰§è¡Œï¼

å¦‚ä½•åˆ¤æ–­ï¼š**é€šè¿‡futureä¸­wait\_for()æ–¹æ³•çš„è¿”å›å€¼**ï¼›è¯¦æƒ…çœ‹ä¸‹ä¸€èŠ‚å†…å®¹

å¤šé˜…è¯»é«˜æ‰‹ä»£ç ï¼Œå¤šç§¯ç´¯ï¼Œæå‡è‡ªå·±æŠ€æœ¯ï¼