---
layout: post
title: "记一次性能测试中，因为自己设置问题，导致测试结果偏差"
date: "2022-12-10T15:15:42.860Z"
---
记一次性能测试中，因为自己设置问题，导致测试结果偏差
==========================

### 前言

这个性能测试真的感觉做了好久，一直都没有一个好的结果。

**为什么要记录，因为想让自己以后不再犯类似错误！**

### 要知道的几个知识点

你看完，肯定会感谢我的，建议收藏！

**关于系统支持并发数计算：**

**1、使用系统用户数量\*(5%~20%)：**

比如用户数为200人，平均取最大用户数为80用户左右，参考维基百科，可以自行查找

**2、按照经典公式计算：**

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/afa3f54f2fac499ba5bc30af197ea588~tplv-k3u1fbpfcp-watermark.image?)

平均每天大约200人使用系统8小时，从登录到退出平均时间为4小时，那么

平均并发用户数为：C = 200_4/8 = 100  
并发用户数峰值为：C‘ = 100 + 3_根号100 =130

参考自网络，感兴趣自己去查即可。

### 关于测试策略调整

*   连接及相应超时设置为3分钟
*   `submit`与`save`取样器之间间隔30秒
*   取消设置`KeepAlive`

### 测试过程

因为测试结果一直很不理想，导致整体进度很慢，多方尝试，现把尝试方案及测试过程记录如下，以便他人参考和自己学习记录，尝试方案如下：

#### 1、客户端设置keep-alive，默认连接、响应超时，单服务

**得出结论：**

经常出现数据库死锁、`service not started`，页面无法登陆

#### 2、客户端设置keep-alive，默认连接、响应超时设置3分钟，单服务

经常出现数据库死锁、`service not started`，页面无法登陆

#### 3、客户端取消设置keep-alive，默认连接、响应超时设置3分钟，submit与save取样器间隔1分钟，3服务

0报错，吞吐量6.1/sec，成功率100%。

#### 4、客户端取消设置keep-alive，默认连接、响应超时设置3分钟，submit与save取样器间隔1分钟，单服务

0报错，吞吐量5.5/sec，成功率100%。

整个过程很曲折，好在遇到比较有耐心和超强的技术解决问题，也让我在这次测试中学习很多。

### 总结：

**关于Keep-Alive设置对结果影响：**

1.  设置Keep-Alive可以避免连接建立和释放的开销，但Tcp连接容易导致系统资源无效占用，浪费系统资源。
2.  去掉 KeepAlive可以模拟多用户访问时每次请求是从不同源端新建请求连接，能更有效模拟真实测试压力，适用于真实用户直接访问的服务接口和页面压测。
3.  在HTTP 1.1版本后，默认开启Keep-Alive模式，可以加入 Connection: close才关闭连接，当然也可以设置Keep-Alive模式的属性，例如 Keep-Alive: timeout=5, max=100，表示这个TCP通道可以保持5秒，max=100，表示这个长连接最多接收100次请求就断开。（来自网络参考）

**优秀不够，你是否无可替代**

**软件测试交流QQ群：721256703，期待你的加入！！**

**欢迎关注我的微信公众号：软件测试君**

![](https://www.cnblogs.com/images/cnblogs_com/longronglang/1061549/o_QQ%E6%88%AA%E5%9B%BE20190728134401.jpg)