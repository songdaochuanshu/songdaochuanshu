---
layout: post
title: "可视化规则引擎"
date: "2022-11-22T18:23:18.966Z"
---
可视化规则引擎

**什么是规则引擎？**

> **引用[痴者工良](https://www.cnblogs.com/whuanle/)的翻译： https://www.cnblogs.com/whuanle/p/16830333.html**

　　在企业项目中，关键或核心部分总是业务逻辑或业务规则，也就是 CRUD，这些系统都有一个共同的特征是，某个模块中的一些或许多规则或策略总会发生变化，例如购物网站的顾客折扣、物流企业的运价计算等。随着这些变化而来的是大量的重复工作，如果系统没有足够的抽象，那么每当增加一种规则时，开发者需要在规则、回归测试、性能测试等方面的变化中编写代码。

　　市面上规则引擎有很多，如：RulesEngine、GRule、liteFlow……

　　但我都不喜欢，以下有几点原因：

　　　　1、没有可视化编辑；

　　　　2、不能倒推数量；

　　　　3、不能复原计算逻辑；

　　　　4、文档不全或学习成本高。

**为何我执着这几点呢？**

**一、可视化编辑的优点**

　　可视化编辑可以看成一张思维导图，每个节点都能有下一个节点，并且节点上都有条件公式，这样就成了一个完整规则。普通人都看懂各个节点的关系。

 ![](https://img2022.cnblogs.com/blog/1085980/202211/1085980-20221122222310565-1838727863.png)

        还可以导出图片，与业务人员进行沟通讨论。

**二、倒推生产数量**

       在制造业内，如纸箱制造，纸很容易损坏，要生产1000只，就要倒推工序，每个工序需要多少材料。而市面上的规则引擎都不能满足。

**三、可视化复原计算逻辑过程**

       当价格计算特别复杂，客服过来让开发人员来解释这件商品为何这么低的价格时，作为开发人员，研究的是代码，又不研究价格，那怎么办？只得进行调试，一步步调试，查到原因来跟客服沟通。如果这种情况过多，开发就完全成为客服的工具人了。

       有些项目会使用计算引擎，这种情况下，调试复原计算逻辑中，老难了。让人头痛的是无效断点。价格计算逻辑特别复杂时，通常公式套另一个公式，或者一个公式套着三四个公式，又因加了缓存数据加快运行速度这个逻辑，我们查了一个公式，用了一个断点，结果跑到另一个公式的条件检测上去了。当我们又想查另一个公式时，结果发现值已缓存，跳不进去了，被迫得进行第二次调试。

 　　所以**可视化复原很重要！！！**

        有可视化复原计算逻辑过程，我们可以快速判断规则节点运行是否正确：

 ![](https://img2022.cnblogs.com/blog/1085980/202211/1085980-20221122222344792-1437435474.png)

 　　方便查询下一公式计算过程，以及可以看到哪个节点设置了这个公式

 ![](https://img2022.cnblogs.com/blog/1085980/202211/1085980-20221122222355593-589866588.png)

 　　当我们双击计算名称，我们还能看到判断条件，以及不符合条件。

 ![](https://img2022.cnblogs.com/blog/1085980/202211/1085980-20221122222408545-754311216.png)

        我们双击节点也能看到节点的判断条件，及不符合条件。

 ![](https://img2022.cnblogs.com/blog/1085980/202211/1085980-20221122222416799-1819189497.png)

**写一个规则引擎需要哪些组件？**

 　　规则引擎核心组件有图形编辑器、代码编辑器、计算引擎。

 　　图形编辑器推荐X6，开源免费，体积小

 　　代码编辑器推荐ACE，开源免费，体积小，能与antlr4结合，提示错误信息。

 　　计算引擎推荐ToolGood.Algorithm，开源免费，功能强大，支持EXCEL函数。

 　　繁杂的计算引擎推荐Jint，开源免费，补充繁杂的计算过程。

 　　注：ToolGood.Algorithm需要魔改，因为原版支持自定义函数，因为自定义函数名是不确定的，错误的公式就会检测不出来。

 　　注2：用python写测试代码真的很爽。。。

**后话：**

　　我认为规则引擎分两种：

　　第一种是用于执行的规则引擎，推荐运行后返回状态码，程序再依据状态码执行下一步，这种有一个好处，可以复原执行逻辑过程。

　　第二种是用于计算公式的规则引引擎，如计算价格之类的，规则走通后，计算价格。

 ------------------------------------------------------------------------------------------------------------------------------------------

检验下载，百度网盘：https://pan.baidu.com/s/138R4d172-drb731GoTI6Vg?password=92i2

注：百度网盘内的不是最新的，且不要用于正式环境

posted on 2022-11-22 22:58  [ToolGood](https://www.cnblogs.com/toolgood/)  阅读(61)  评论(0)  [编辑](https://i.cnblogs.com/EditPosts.aspx?postid=16916825)  [收藏](javascript:void(0))  [举报](javascript:void(0))