---
layout: post
title: "5 åˆ†é’Ÿæ•™ä½ å¿«é€ŸæŒæ¡ GitHub Actions è‡ªåŠ¨éƒ¨ç½²åšå®¢"
date: "2022-04-27T03:44:52.279Z"
---
5 åˆ†é’Ÿæ•™ä½ å¿«é€ŸæŒæ¡ GitHub Actions è‡ªåŠ¨éƒ¨ç½²åšå®¢
================================

![5 åˆ†é’Ÿæ•™ä½ å¿«é€ŸæŒæ¡ GitHub Actions è‡ªåŠ¨éƒ¨ç½²åšå®¢](https://img2022.cnblogs.com/blog/1782151/202204/1782151-20220427065943010-1537887094.png) è‡ªä» GitHub å®£å¸ƒ GitHub Actions åœ¨å¹³å°ä¸Šå¯¹æ‰€æœ‰å¼€å‘äººå‘˜å’Œå­˜å‚¨åº“å¯ç”¨ä»¥æ¥ï¼ŒGitHub Actions è¶Šæ¥è¶Šå—æ¬¢è¿ã€‚å¾ˆå¤šç¬¬ä¸‰æ–¹å¹³å°åœ¨ç”Ÿæ€ç³»ç»Ÿä¸­æœ‰é€Ÿåº¦ç­‰é™åˆ¶ï¼Œå°†è¿›ä¸€æ­¥æ¨åŠ¨å¼€å‘äººå‘˜å°†ä»–ä»¬çš„è½¯ä»¶è‡ªåŠ¨åŒ–è¿ç§»åˆ° GitHub Actionsã€‚

è‡ªä» GitHub å®£å¸ƒ GitHub Actions åœ¨å¹³å°ä¸Šå¯¹æ‰€æœ‰å¼€å‘äººå‘˜å’Œå­˜å‚¨åº“å¯ç”¨ä»¥æ¥ï¼ŒGitHub Actions è¶Šæ¥è¶Šå—æ¬¢è¿ã€‚å¾ˆå¤šç¬¬ä¸‰æ–¹å¹³å°åœ¨ç”Ÿæ€ç³»ç»Ÿä¸­æœ‰é€Ÿåº¦ç­‰é™åˆ¶ï¼Œå°†è¿›ä¸€æ­¥æ¨åŠ¨å¼€å‘äººå‘˜å°†ä»–ä»¬çš„è½¯ä»¶è‡ªåŠ¨åŒ–è¿ç§»åˆ° GitHub Actionsã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³å‘ä½ å±•ç¤ºæˆ‘å¦‚ä½•ä½¿ç”¨ GitHub Actions å‘å¸ƒæˆ‘åœ¨å¼€æºé¡¹ç›®ä¸­ç»´æŠ¤çš„ npm åŒ…ã€‚å¦‚æœä½ éµå¾ªç”± GitHub æ‹‰å–è¯·æ±‚å·¥ä½œæµç¨‹ç»„æˆçš„ GitHub æµç¨‹ï¼Œé‚£ä¹ˆè¿™å°†è¿›ä¸€æ­¥ç»Ÿä¸€å›¢é˜Ÿå’Œç¤¾åŒºè´¡çŒ®è€…çš„å·¥ä½œæµç¨‹çš„å’Œæå‡ä»–ä»¬çš„ä½“éªŒã€‚

GitHub Actions
==============

GitHub Actions æ˜¯ GitHub å¼€å‘çš„ä¸€é¡¹æŠ€æœ¯ï¼Œæ—¨åœ¨ä¸ºå¼€å‘äººå‘˜æä¾›ä¸€ç§å›´ç»•æŒç»­é›†æˆè‡ªåŠ¨åŒ–å…¶å·¥ä½œæµç¨‹çš„æ–¹æ³•â€”â€”å¸®åŠ©ä»–ä»¬æ„å»ºã€éƒ¨ç½²ã€å®‰æ’é‡å¤æ€§ä»»åŠ¡ç­‰ã€‚GitHub Actions åŸç”Ÿå¯ç”¨å¹¶é›†æˆåˆ° GitHub å­˜å‚¨åº“ä¸­ï¼Œå¹¶å…·æœ‰æ¥è‡ªç¤¾åŒºè´¡çŒ®è€…çš„è®¸å¤šå¯é‡ç”¨å·¥ä½œæµï¼Œä¾‹å¦‚å‘å¸ƒ npm åŒ…ã€å‘å¸ƒ docker å›¾åƒã€è¿è¡Œå®‰å…¨æµ‹è¯•ç­‰ç­‰ã€‚

Github Action æœ¬è´¨å°±æ˜¯ Github æ¨å‡ºçš„æŒç»­é›†æˆå·¥å…·, æ¯æ¬¡æäº¤ä»£ç åˆ° Github çš„ä»“åº“åï¼ŒGithub éƒ½ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼ˆä¾‹å¦‚ Mac / Windows / Linuxï¼‰ï¼Œæ¥æ‰§è¡Œä¸€æ®µæˆ–å¤šæ®µæŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼š

    npm install
    npm run build
    

æˆ‘ä»¬é›†æˆ Github Action çš„åšæ³•ï¼Œå°±æ˜¯åœ¨æˆ‘ä»¬ä»“åº“çš„æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª .github æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ”¾ä¸€ä¸ª `*.yaml` æ–‡ä»¶, è¿™ä¸ª Yaml æ–‡ä»¶å°±æ˜¯æˆ‘ä»¬é…ç½® Github Action æ‰€ç”¨çš„æ–‡ä»¶ã€‚

Github Action çš„ä½¿ç”¨é™åˆ¶
===================

*   æ¯ä¸ª Workflow ä¸­çš„ job æœ€å¤šå¯ä»¥æ‰§è¡Œ 6 ä¸ªå°æ—¶
*   æ¯ä¸ª Workflow æœ€å¤šå¯ä»¥æ‰§è¡Œ 72 å°æ—¶
*   æ¯ä¸ª Workflow ä¸­çš„ job æœ€å¤šå¯ä»¥æ’é˜Ÿ 24 å°æ—¶
*   åœ¨ä¸€ä¸ªå­˜å‚¨åº“æ‰€æœ‰ Action ä¸­ï¼Œä¸€ä¸ªå°æ—¶æœ€å¤šå¯ä»¥æ‰§è¡Œ 1000 ä¸ª API è¯·æ±‚
*   å¹¶å‘å·¥ä½œæ•°ï¼šLinuxï¼š20ï¼ŒMacï¼š5

ä»€ä¹ˆæ˜¯ GitHub Workflowï¼Ÿ
====================

GitHub å·¥ä½œæµæ˜¯ä¸€ç»„åŸºäºè§¦å‘å™¨æˆ–åŸºäº cron çš„è®¡åˆ’è¿è¡Œçš„ job ä½œä¸šã€‚ä½œä¸šç”±ç»„æˆè‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ç»„æˆã€‚æˆ‘ä»¬é€šè¿‡åˆ›å»º YAML æ–‡ä»¶æ¥åˆ›å»º Workflow é…ç½®ã€‚

ä»é›¶æ­å»º Npm åŒ…æŒç»­é›†æˆ
==============

åœ¨äº†è§£äº†åŸºæœ¬çš„çŸ¥è¯†ä¹‹åï¼Œæˆ‘å°†é€šè¿‡ä¸€ä¸ªå®é™…çš„é¡¹ç›®æ¥å¸¦å¤§å®¶å¿«é€Ÿä¸Šæ‰‹ Github Actionï¼Œæœ€ç»ˆå®ç°çš„ç›®æ ‡: å½“æˆ‘ä»¬å°†ä»£ç æ¨é€åˆ° github ä¸Šå, é€šè¿‡ Github Action è‡ªåŠ¨æ‰“åŒ…é¡¹ç›®ï¼Œå¹¶ä¸€é”®å‘å¸ƒåˆ° npm ä¸Šå’Œå‘å¸ƒä¸€ä¸ª Github Page ç½‘ç«™ã€‚

![](https://img2022.cnblogs.com/blog/1782151/202204/1782151-20220427065439913-175564082.png)

è·å– Npm Access Token
-------------------

è¦æƒ³è®© Github Action èƒ½æœ‰æƒåˆ©å‘å¸ƒæŒ‡å®šçš„ npm åŒ…, éœ€è¦è·å– npm çš„ é€šè¡Œè¯. è¿™ä¸ªé€šè¡Œè¯å°±æ˜¯ npm token, æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç™»å…¥ npm å®˜ç½‘, ç”Ÿæˆä¸€ä¸ª tokenã€‚

![](https://img2022.cnblogs.com/blog/1782151/202204/1782151-20220427065454571-585070640.png)

è·å– Personal Access Token
------------------------

ç‚¹å‡» Generate new token ç”Ÿæˆä¸€ä¸ªæ–°çš„ token å¹¶å¤åˆ¶ï¼Œéœ€è¦æ³¨æ„çš„äº‹ï¼Œè¿™ä¸ª Personal Access Token è·Ÿä¸Šé¢ Npm Access Token ä¸€æ ·åªä¼šåœ¨ç”ŸæˆæˆåŠŸçš„æ—¶å€™å±•ç¤ºï¼Œä¸€æ—¦é€€å‡ºå°±æ— æ³•å†æŸ¥çœ‹ï¼Œæ‰€ä»¥è¦è®°å¾—ä¿å­˜ã€‚

![](https://img2022.cnblogs.com/blog/1782151/202204/1782151-20220427065513649-273687465.png)

è®¾ç½® Github Secret
----------------

æˆ‘ä»¬åœ¨æ‹¿åˆ° npm token å, æ‰“å¼€å¯¹åº”é¡¹ç›®çš„ Github ä»“åº“, åˆ‡æ¢åˆ° settings é¢æ¿, æ‰¾åˆ° secrets å­èœå•, åˆ›å»ºä¸€ä¸ªæ–°çš„ secret, å°† npm token å¤åˆ¶åˆ°å†…å®¹åŒºå¹¶å‘½å

![](https://img2022.cnblogs.com/blog/1782151/202204/1782151-20220427065533271-21931311.png)

å¡«å†™ Name å’Œ Value å­—æ®µï¼ŒName ä¸º ACCESS\_TOKEN å’Œ NODE\_AUTH\_TOKENï¼ŒValue ä¸ºåˆšåˆšä¿å­˜çš„ Personal Access Token å’Œ Npm Access Token å€¼ã€‚

Token Name

Key

Vale

Personal Access Token

ACCESS\_TOKEN

${{ secrets.ACCESS\_TOKEN }}

Npm Access Token

NODE\_AUTH\_TOKEN

${{secrets.NPM\_TOKEN}}

ä½¿ç”¨ Workflows æ¨¡æ¿
---------------

æˆ‘ä»¬åˆ‡æ¢åˆ° actions é¢æ¿å¯ä»¥çœ‹åˆ°å¾ˆå¤š workflows æ¨¡ç‰ˆï¼Œæˆ‘ä»¬é€‰æ‹©å¦‚ä¸‹æ¨¡ç‰ˆ:

![](https://img2022.cnblogs.com/blog/1782151/202204/1782151-20220427065552589-308341056.png)

å½“ç„¶å¦‚æœå±æ€§ yaml é…ç½®çš„ä¹Ÿå¯ä»¥è‡ªå·±åˆ›å»ºä¸€ä¸ª workflow ä¾›ä»–äººä½¿ç”¨ã€‚

æˆ‘ä»¬ç‚¹å‡»å®‰è£…æŒ‰é’®ä¹‹åä¼šè·³è½¬åˆ°ç¼–è¾‘ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç‚¹å‡»å³ä¸Šæ”¾çš„æäº¤æŒ‰é’®:

![](https://img2022.cnblogs.com/blog/1782151/202204/1782151-20220427065607471-440759586.png)

æ­¤æ—¶å°±åˆ›å»ºäº†ä¸€ä¸ª workflowã€‚

é…ç½® workflows
------------

è¿™é‡Œæˆ‘åˆ—ä¸€ä¸‹ github-actions-tutorial çš„ workflowï¼š

    name: Node.js Package
    
    # è§¦å‘å·¥ä½œæµç¨‹çš„äº‹ä»¶
    on:
      push:
        branches:
          - main
          - "releases/**"
          - dev
    
    # æŒ‰é¡ºåºè¿è¡Œä½œä¸š
    jobs:
      publish-gpr:
        # æŒ‡å®šçš„è¿è¡Œå™¨ç¯å¢ƒ
        runs-on: ubuntu-latest
        # è®¾ç½® node ç‰ˆæœ¬
        strategy:
          matrix:
            node-version: [16]
        steps:
          # æ‹‰å– github ä»“åº“ä»£ç 
          - uses: actions/checkout@v3
          # è®¾å®š node ç¯å¢ƒ
          - uses: actions/setup-node@v3
            with:
              node-version: ${{ matrix.node-version }}
              # è®¾ç½®å‘åŒ… npm åœ°å€ä»“åº“
              registry-url: https://registry.npmjs.org
          # å®‰è£…ä¾èµ–ï¼Œç›¸å½“äº npm ci
          - name: Install dependencies ğŸ“¦ï¸
            run: npm install
          # æ‰§è¡Œæ„å»ºæ­¥éª¤
          - name: æ„å»º
            run: |
              npm run build
          # æ‰§è¡Œéƒ¨ç½²
          - name: éƒ¨ç½²
            # è¿™ä¸ª action ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨æ¨é€ä»£ç åˆ°æŒ‡å®šåˆ†æ”¯
            uses: JamesIves/github-pages-deploy-action@releases/v3
            with:
              # æŒ‡å®šå¯†é’¥ï¼Œå³åœ¨ç¬¬ä¸€æ­¥ä¸­è®¾ç½®çš„
              ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
              # æŒ‡å®šæ¨é€åˆ°çš„è¿œç¨‹åˆ†æ”¯
              BRANCH: pages
              # æŒ‡å®šæ„å»ºä¹‹åçš„äº§ç‰©è¦æ¨é€å“ªä¸ªç›®å½•çš„ä»£ç 
              FOLDER: build
          - run: npm publish
            env:
              # åˆšåˆšè®¾ç½®çš„ NPM_TOKEN
              NODE_AUTH_TOKEN: ${{secrets.NPM_TOKEN}}
    

å…¶ä¸­æœ‰å‡ ä¸ªæœ¯è¯­å’Œå¤§å®¶ä»‹ç»ä¸€ä¸‹:

*   name Workflow çš„åç§°ï¼ŒGithub åœ¨å­˜å‚¨åº“çš„ Action é¡µé¢ä¸Šæ˜¾ç¤º Workflow çš„åç§°
*   on è§¦å‘ Workflow æ‰§è¡Œçš„ event åç§°ï¼Œæ¯”å¦‚ on: push(å•ä¸ªäº‹ä»¶)ï¼Œon: push, workflow\_dispatch(å¤šä¸ªäº‹ä»¶)
*   jobs ä¸€ä¸ª Workflow ç”±ä¸€ä¸ªæˆ–å¤šä¸ª jobs æ„æˆï¼Œå«ä¹‰æ˜¯ä¸€æ¬¡æŒç»­é›†æˆçš„è¿è¡Œï¼Œå¯ä»¥å®Œæˆå¤šä¸ªä»»åŠ¡
*   steps æ¯ä¸ª job ç”±å¤šä¸ª step æ„æˆï¼Œå®ƒä¼šä»ä¸Šè‡³ä¸‹ä¾æ¬¡æ‰§è¡Œ
*   env ç¯å¢ƒå˜é‡, secrets.NPM\_TOKEN å°±æ˜¯æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„ secret

æäº¤æµ‹è¯•
====

æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹é¡¹ç›®çš„ä»£ç , ç„¶åæ‰§è¡Œ:

    git add .
    git commit -m ':new: your first commit'
    git push
    

æäº¤æˆåŠŸä¹‹åæˆ‘ä»¬æ‰“å¼€é¡¹ç›®çš„ github action é¢æ¿:

![](https://img2022.cnblogs.com/blog/1782151/202204/1782151-20220427065630167-83399573.png)

ç‚¹å¼€å¯¹åº” Github ä»“åº“çš„ Actions é€‰é¡¹å¡å°±å¯ä»¥çœ‹åˆ°æ¯æ­¥çš„æ„å»ºè¿‡ç¨‹ã€‚å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨ \*.yml ä¸­çš„å®šä¹‰çš„ push äº‹ä»¶è¢«è§¦å‘ï¼Œæ‰§è¡Œäº† jobs ä¸­çš„æ‰€æœ‰æ­¥éª¤ï¼Œæ‰“åŒ…å¹¶å°†æ‰“åŒ…ååˆ° build æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹æ¨é€åˆ°äº† github ä»“åº“çš„ pages åˆ†æ”¯ã€‚

å½“ job é€‰é¡¹å®Œæˆçš„æ—¶å€™ï¼Œè¿›å…¥ä»“åº“çš„ Settings => Pages èœå•ä¸‹ï¼Œå°† Source Branch å­—æ®µè®¾ç½®ä¸º pagesï¼Œæ–‡ä»¶å¤¹é€‰æ‹© root æ ¹ç›®å½•å°±å¥½ï¼š

![](https://img2022.cnblogs.com/blog/1782151/202204/1782151-20220427065645458-1218658568.png)

ç‚¹å‡» Save æŒ‰é’®ç¨ç­‰ç‰‡åˆ»ï¼Œç­‰åˆ°ä¸Šé¢å‡ºç°é€šçŸ¥è¡¨ç¤ºå·²ç»æ„å»ºæˆåŠŸã€‚ç‚¹å‡»é“¾æ¥è¿›å…¥å³å¯çœ‹åˆ°è‡ªåŠ¨æ„å»ºå®Œæˆçš„åº”ç”¨äº†ï¼Œä»æ­¤ä»¥åï¼Œä½ åªéœ€è¦æ¨é€åˆ° yml æ–‡ä»¶ä¸­æŒ‡å®šçš„åˆ†æ”¯ï¼Œå°±å¯ä»¥è‡ªåŠ¨è§¦å‘æ„å»ºï¼Œè‡ªåŠ¨æ›´æ–°ä½ çš„ç½‘ç«™äº†ã€‚

æŸ¥çœ‹å‘å¸ƒçš„ NPM åŒ…å’Œç½‘ç«™
==============

*   [æŸ¥çœ‹å·¥ä½œæµæ–‡ä»¶](./.github/workflows/ci.yml) å’Œ [å·²å‘å¸ƒç½‘ç«™](https://wscats.github.io/github-actions-tutorial)
*   [æŸ¥çœ‹å‘å¸ƒçš„ Npm åŒ…](https://www.npmjs.com/package/github-actions-tutorial)

å‚è€ƒæ–‡æ¡£
====

*   [GitHub Actions/å·¥ä½œæµç¨‹è¯­æ³•](https://docs.github.com/cn/actions/using-workflows/workflow-syntax-for-github-actions)
*   [ä½¿ç”¨ Github Actions å®ç°å‰ç«¯åº”ç”¨éƒ¨ç½²åŠ npm åŒ…å‘å¸ƒè‡ªåŠ¨åŒ–](https://lexmin0412.github.io/blog/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/%E4%BD%BF%E7%94%A8Github%20Actions%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE.html#_1-%E8%8E%B7%E5%8F%96-personal-access-token-%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%88%B0%E4%BB%93%E5%BA%93%E4%B8%AD)
*   [5 åˆ†é’Ÿæ•™ä½ å¿«é€ŸæŒæ¡ Github Action æŒç»­é›†æˆ](https://cloud.tencent.com/developer/article/1941220)

å¦‚æœæ–‡ç« å’Œç¬”è®°èƒ½å¸¦æ‚¨ä¸€ä¸å¸®åŠ©æˆ–è€…å¯å‘ï¼Œè¯·ä¸è¦åå•¬ä½ çš„èµå’Œæ”¶è—ï¼Œä½ çš„è‚¯å®šæ˜¯æˆ‘å‰è¿›çš„æœ€å¤§åŠ¨åŠ›ğŸ˜

é™„ç¬”è®°é“¾æ¥ï¼Œé˜…è¯»å¾€æœŸæ›´å¤šä¼˜è´¨æ–‡ç« å¯ç§»æ­¥æŸ¥çœ‹ï¼Œå–œæ¬¢çš„å¯ä»¥ç»™æˆ‘ç‚¹èµé¼“åŠ±å“¦ï¼š  
[https://github.com/Wscats/github-actions-tutorial](https://github.com/Wscats/github-actions-tutorial)

æ›´å¤šå†…å®¹è¯·å…³æ³¨ï¼šhttps://github.com/Wscats