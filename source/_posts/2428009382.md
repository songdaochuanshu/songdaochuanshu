---
layout: post
title: "dolphinschedulerç®€å•ä»»åŠ¡å®šä¹‰åŠå¤æ‚çš„è·¨èŠ‚ç‚¹ä¼ å‚"
date: "2022-07-08T18:23:23.661Z"
---
dolphinschedulerç®€å•ä»»åŠ¡å®šä¹‰åŠå¤æ‚çš„è·¨èŠ‚ç‚¹ä¼ å‚
===============================

dolphinschedulerç®€å•ä»»åŠ¡å®šä¹‰åŠè·¨èŠ‚ç‚¹ä¼ å‚
----------------------------

è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ [https://www.cnblogs.com/funnyzpc/p/16395094.html](https://www.cnblogs.com/funnyzpc/p/16395094.html)

### å†™åœ¨å‰é¢

`dolphinscheduler`æ˜¯ä¸€æ¬¾éå¸¸ä¸é”™çš„è°ƒåº¦å·¥å…·ï¼Œæœ¬æ–‡æˆ‘å°±ç®€ç§°dså•¦ï¼Œå¯å•æœºå¯é›†ç¾¤å¯å®¹å™¨ï¼Œå¯è°ƒåº¦`sql`ã€`å­˜å‚¨è¿‡ç¨‹`ã€`http`ã€`å¤§æ•°æ®`ï¼Œä¹Ÿå¯ä½¿ç”¨`shell`ã€`python`ã€`java`ã€`flink`ç­‰è¯­è¨€åŠå·¥å…·ï¼ŒåŠŸèƒ½å¼ºå¤§ç±»å‹ä¸°å¯Œï¼Œé€‚åˆå„ç±»è°ƒåº¦å‹ä»»åŠ¡ï¼Œç¤¾åŒºåŠé¡¹ç›®ä¹Ÿååˆ†æ´»è·ƒï¼Œç°åœ¨[github](https://github.com/apache/dolphinscheduler)ä¸­å·²æœ‰8.2kçš„starğŸ‘  
æ‰€ä»¥ï¼Œæœ¬ç¯‡åšæ–‡å¼€å§‹ä¼šé€æ­¥è®²ä¸€äº›dsç›¸å…³çš„ä¸œè¥¿ï¼Œä¹ŸæœŸå¾…å„ä½åŒè¡Œèƒ½æ¥è§¦åˆ°æ­¤å¹¶èƒ½å®é™…è§£å†³ä¸€äº›ç”Ÿäº§ä¸Šçš„é—®é¢˜ï½ğŸ˜

### ä¸€.å‡†å¤‡å·¥ä½œ

    é˜…è¯»æœ¬åšæ–‡å‰å»ºè®®æ‚¨å…ˆé˜…è¯»ä¸‹å®˜æ–¹çš„æ–‡æ¡£[https://dolphinscheduler.apache.org/zh-cn/docs/latest/user_doc/guide/parameter/context.html)(https://dolphinscheduler.apache.org/zh-cn/docs/latest/user_doc/guide/parameter/context.html)ï¼ˆè™½ç„¶ä¹Ÿä¼šç¢°åˆ°ä¸€äº›å‘ğŸ˜‚ï¼‰
    è¿™é‡Œï¼Œå…ˆå‡†å¤‡ä¸‹sqlè¡¨èµ„æºï¼Œä»¥ä¸‹ä¸º`postgresql`çš„`sql`è„šæœ¬:
    

ï¼ˆè¡¨ç»“æ„ï¼‰

    
    CREATE TABLE dolphinscheduler.tmp (
    	id int4 NOT NULL,
    	"name" varchar(50) NULL,
    	"label" varchar(50) NULL,
    	update_time timestamp NULL,
    	score int4 NULL,
    	CONSTRAINT tmp_pkey PRIMARY KEY (id)
    );
    

ï¼ˆè¡¨æ•°æ®ï¼‰

    INSERT INTO tmp (id,"name","label",update_time,score) VALUES
    	 (3,'äºŒç‹—å­','','2022-07-06 21:49:26.872',NULL),
    	 (2,'é©¬äº‘äº‘','',NULL,NULL),
    	 (1,'ææ€','','2022-07-05 19:54:31.880',85);
    

å› ä¸ºä¸ªäººä½¿ç”¨çš„`postgresql`çš„æ•°æ®åº“ï¼Œå¦‚æœæ‚¨æ˜¯`mysql`æˆ–è€…å…¶ä»–æ•°æ®çš„ç”¨æˆ·ï¼Œè¯·è‡ªè¡Œæ›´æ”¹ä»¥ä¸Šè¡¨å’Œæ•°æ®å¹¶æ·»åŠ åˆ°åº“ä¸­å³å¯  
è¡¨åŠæ•°æ®å…¥åº“ï¼Œè¯·å°†tmpæ‰€å±çš„åº“é…ç½®åˆ° `dsåå°`\->`æ•°æ®æºä¸­å¿ƒ`\->`åˆ›å»ºæ•°æ®æº` ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„é…ç½®ï¼Œè®°ä½ï¼Œè¿™é‡Œé¢çš„æ‰€æœ‰æ•°æ®åº“é…ç½®å‡éµå®ˆæ‰€å±æ•°æ®åº“ç±»å‹çš„`jdbc`çš„`driver`çš„é…ç½®å‚æ•°ï¼Œé…ç½®å®Œæˆä¹Ÿä¼šåœ¨dsçš„æ•°æ®åº“ç”Ÿæˆä¸€æ¡`jdbc`çš„è¿æ¥åœ°å€ï¼Œè¿™ç‚¹è¦æ˜ç™½ï½  
![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707215521638-1299391700.png)

### äºŒ.ç®€å•çš„é¡¹ç›®åˆ›å»ºåŠè¯´æ˜

    å› ä¸º`ds`çš„ä»»åŠ¡æ˜¯é…ç½®åœ¨é¡¹ç›®ä¸‹é¢ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å¾—æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œè¿™æ ·ï¼š`dsåå°`->`é¡¹ç›®ç®¡ç†`->`åˆ›å»ºé¡¹ç›®`ï¼Œè¿™æ˜¯æˆ‘åˆ›å»ºçš„ï¼Œè¯·çœ‹ï¼š
    

![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707220358155-1354523703.png)

å‡†å¤‡å®Œé¡¹ç›®ä¹‹åï¼Œé¼ æ ‡ç‚¹è¿›å»ï¼Œå¹¶è¿›å…¥åˆ° `å·¥ä½œæµå®šä¹‰`èœå• é¡µé¢ï¼Œå¦‚ä¸‹å›¾ï¼š  
![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707220558630-395503237.png)

å…ˆç®€å•åˆ°è§£é‡Šä¸‹`ds`çš„ä¸€ç‚¹å„¿åŸºæœ¬ç»“æ„ï¼Œé¦–å…ˆï¼Œ`ds`ä¸€èˆ¬éƒ¨ç½²åœ¨`linux`æœåŠ¡å™¨ä¸‹ï¼Œåˆ›å»ºä»»åŠ¡çš„ç”¨æˆ·éœ€è¦åœ¨`adminè´¦æˆ·`ä¸‹åˆ›å»ºï¼Œé‡è¦çš„æ˜¯åˆ›å»ºçš„æ¯ä¸ªå·¥ä½œè´¦æˆ·éœ€è¦ä¸æ“ä½œç³»ç»Ÿç”¨æˆ·ä¸€ä¸€å¯¹åº”ï¼Œæ¯”å¦‚ä½ åˆ›å»ºäº†ä¸€ä¸ª test çš„dsè´¦æˆ·ï¼Œé‚£dsæ‰€åœ¨çš„æœåŠ¡å™¨ä¹Ÿå¿…é¡»æœ‰ä¸€ä¸ªtestçš„è´¦æˆ·æ‰å¯è¡Œï¼Œè¿™æ˜¯`ds`çš„è§„åˆ™ï¼Œæˆ‘æ²¡æ³•è§£é‡Šä¸ºä»€ä¹ˆã€‚  
æ¯ä¸ªç”¨æˆ·ä¸‹(é™¤äº†adminå¤–ï¼‰æ‰€èƒ½åˆ›å»ºçš„è°ƒåº¦ä»»åŠ¡å‡åœ¨å„è‡ªåˆ›å»ºçš„é¡¹ç›®ä¸‹ï¼Œæ¯ä¸ªé¡¹ç›®åˆåˆ†ä¸ºå¤šä¸ªä»»åŠ¡(å·¥ä½œæµå®šä¹‰),ä¸€ä¸ªä»»åŠ¡ä¸‹åˆå¯åˆ†ä¸ºå¤šä¸ªä»»åŠ¡èŠ‚ç‚¹ï¼Œä¸‹å›¾ä¸ºä»»åŠ¡å®šä¹‰ï¼š  
![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707221126031-808334809.png)  
ok,å¦‚æœå·²ç»å‡†å¤‡å¥½ä»¥ä¸Šæ­¥éª¤ï¼Œä¸‹é¢å¼€å§‹å®šä¹‰ä¸€ä¸ªç®€å•çš„è°ƒåº¦ä»»åŠ¡ï¼Œç»§ç»­å“ˆï½

### ä¸‰.ç®€å•çš„å‚æ•°ä¼ é€’

å…ˆçœ‹è¡¨ï¼š  
![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707215732456-1084095369.png)  
æˆ‘ä»¬å…ˆåšä¸ªç®€å•çš„ï¼Œæ¯”å¦‚å›¾ä¸­ï¼Œå¦‚æœäºŒç‹—å­çš„æœ¬åå«ï¼šææ€ï¼Œéœ€è¦æˆ‘ä»¬å–`id=1`çš„`name`æ”¾åˆ°`id=3`çš„`label`ä¸­ï¼Œå¹¶ä¸”æ›´æ–°`update_time`

*   1.è¿™é‡Œç¬¬ä¸€æ­¥ åœ¨å·¥ä½œæµå®šä¹‰åˆ—è¡¨ï¼Œç‚¹å‡» `åˆ›å»ºå·¥ä½œæµ` å°±è¿›å…¥ä¸€ä¸ªå…·ä½“çš„ä»»åŠ¡(å·¥ä½œæµ)çš„å®šä¹‰,åŒæ—¶æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯`sqlä»»åŠ¡`ï¼Œæ‰€ä»¥å°±éœ€è¦ä»å·¦ä¾§æ‹–åŠ¨ä¸€ä¸ª`sqlä»»åŠ¡`åˆ°ç”»å¸ƒä¸­(å³ä¾§ç©ºç™½å¤„)ï¼š  
    ![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707222141038-1783829749.png)  
    å› ä¸ºæ‹–åŠ¨`sqlä»»åŠ¡`åˆ°ç”»å¸ƒä¼šè‡ªåŠ¨å¼¹å‡ºèŠ‚ç‚¹å®šä¹‰ï¼Œä¸Šå›¾ä¸ºå½“å‰èŠ‚ç‚¹çš„ä¸€ä¸ªå®šä¹‰ï¼Œé‡ç‚¹æ˜¯ï¼š`æ•°æ®æº`ã€`sqlç±»å‹`ã€`sqlè¯­å¥`ï¼Œå¦‚å®˜æ–¹æ‰€è¯´ï¼Œå¦‚æœå°†`name`ä¼ é€’åˆ°ä¸‹æ¸¸ï¼Œåˆ™éœ€è¦åœ¨è‡ªå®šä¹‰å‚æ•°é‡å®šä¹‰è¿™ä¸ª`name`ä¸º`out`æ–¹å‘ `ç±»å‹`ä¸º`varchar`ã€‚
    
*   2.å› ä¸ºä¼ é€’åˆ°å‚æ•°éœ€è¦å†™å…¥åˆ°è¡¨ï¼Œè¿™é‡Œæˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹è´Ÿè´£æ¥æ”¶ä¸Šæ¸¸ä¼ é€’åˆ°`name`ï¼Œæ‰§è¡Œ`update`æ—¶ä½¿ç”¨è¿™ä¸ª`name`ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„å®šä¹‰ï¼š  
    ![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707225105519-1768344082.png)  
    çœ‹åˆ°æ²¡ï¼Œè¿™é‡Œä¸ä»…ä»…è¦æ³¨æ„`sqlç±»å‹`(`sqlç±»å‹`ä¸`sqlè¯­å¥`æ˜¯`ä¸€ä¸€å¯¹åº”`çš„ï¼Œç±»å‹ä¸èƒ½é”™) ï¼Œè¿˜æœ‰å°±æ˜¯å‰ç½®ä»»åŠ¡ä¸€å®šè¦é€‰ä¸­(ä¸Šé¢å®šä¹‰çš„)`node1`èŠ‚ç‚¹ã€‚  
    å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å½“å‰ä»»åŠ¡æ˜¯ä¸Šä¸‹æ¸¸ä¼ å‚ï¼Œæ‰€ä»¥åœ¨`node2`ä¸­æ˜¯ç›´æ¥ä½¿ç”¨`node1`ä¸­å®šä¹‰çš„`name`è¿™ä¸ªå‚æ•°å“ˆ
    
*   3.å®šä¹‰å®Œæˆå½“å‰ä»»åŠ¡å°±éœ€è¦ä¿å­˜ï¼šç‚¹å³ä¸Šè§’ä¿å­˜ï¼Œå¡«å†™å¹¶ä¿å­˜åç‚¹å…³é—­ä»¥é€€å‡ºå®šä¹‰ï¼š  
    ![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707223821227-1869298353.png)
    
*   4.å› ä¸ºå®šä¹‰çš„ä»»åŠ¡éœ€è¦ä¸Šçº¿äº†æ‰å¯æ‰§è¡Œï¼Œæ‰€ä»¥ï¼Œåœ¨å·¥ä½œæµå®šä¹‰åˆ—è¡¨å…ˆç‚¹è¯¥ä»»åŠ¡çš„`é»„è‰²æŒ‰é’®`(ä»»åŠ¡ä¸Šçº¿)ï¼Œç„¶åæ‰æ˜¯ç‚¹`ç»¿è‰²æŒ‰é’®`(æ‰§è¡Œä»»åŠ¡)ï¼š  
    ![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707224054859-137107161.png)
    
*   5.ä»»åŠ¡æ‰§è¡ŒæˆåŠŸä¸å¦ï¼Œå…·ä½“å¾—çœ‹ä»»åŠ¡å®ä¾‹ï¼Œè¿™æ˜¯æ‰§è¡Œ`node2èŠ‚ç‚¹`çš„æ—¥å¿—ï¼š  
    ![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707225213545-1617828046.png)
    
    é¡ºå¸¦å†çœ‹çœ‹æ•°æ®åº“è¡¨æ˜¯å¦çœŸå®æˆåŠŸï¼š  
    ![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707225249129-438164926.png)
    
    å®Œç¾ğŸ˜Š
    

### å››.å¤æ‚çš„è·¨èŠ‚ç‚¹ä¼ å‚

é¦–å…ˆçœ‹è¡¨ï¼š  
![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707225419495-498573059.png)  
æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šå¯ä»¥çœ‹åˆ°`ææ€`çš„`score`æ˜¯`85`ï¼Œæ ¹æ®`score`åº”è¯¥è¢«è¯„ä¸º `B`(>=90çš„ä¸ºA)å¹¶å†™å…¥åˆ°`label`å­—æ®µï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Œå¦‚æœè¿™ä¸ªåˆ†æ•°æ˜¯90åˆ†åˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Œå¦‚æœæ ¹æœ¬æ²¡æœ‰score(åˆ†å€¼) è¿™ä¸ªä»»åŠ¡æ˜¯ä¸æ˜¯å°±ä¸éœ€è¦æ›´æ–°ææ€çš„label(è¯„åˆ†)å‘¢ï¼Ÿ  
å¯¹äºä¸Šé¢é—®é¢˜å¯ä»¥æœ‰ä¸€äº›åé—¨çš„è§£å†³æ–¹æ³•ï¼Œæ¯”å¦‚åœ¨`sql`ä¸­å¡ä¸€ä¸ª`å¼‚å¸¸å€¼`ï¼Œè¿™æ ·çœ‹ä¼¼ä¸é”™ï¼Œä¸è¿‡ä½œä¸ºè°ƒåº¦å·¥å…·å»ºè®®è¿˜æ˜¯åœ¨`conditionèŠ‚ç‚¹`æˆ–è€…`switchèŠ‚ç‚¹`å¤„ç†æ˜¯æœ€å¥½çš„ï¼Œä¸è¿‡å°±ç›®å‰æˆ‘ç”¨çš„`2.0.5`ç‰ˆæœ¬çš„`ds`å¯¹äºè¿™ä¸¤ç±»ä»»åŠ¡èŠ‚ç‚¹æ˜¯`æ²¡æ³•æ¥æ”¶å‚æ•°`çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªé—æ†¾ï¼›é‚~ä¸ªäººè§‰å¾—è¾ƒå¥½çš„æ–¹å¼æ˜¯åœ¨å†™å…¥èŠ‚ç‚¹ä¹‹å‰å¢åŠ ä¸€ä¸ª`åˆ¤æ–­èŠ‚ç‚¹`ï¼Œå°†é”™è¯¯æŠ›å‡º(æ²¡æœ‰scoreçš„ï¼‰æœ€å¥½ï½ï¼Œå¯¹äºæ­¤ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ª`shellçš„ä¸­é—´èŠ‚ç‚¹`ã€‚  
ä¸‹é¢æ˜¯æˆ‘å®šä¹‰çš„ä¸‰ä¸ªèŠ‚ç‚¹ï¼š

*   node1èŠ‚ç‚¹å®šä¹‰ï¼š  
    ![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707230606125-199028968.png)
    
*   node2èŠ‚ç‚¹å®šä¹‰ï¼š  
    ![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707230707540-1857391333.png)
    

(è„šæœ¬å†…å®¹)

    #!/bin/bash
    echo "=====>input param start<====="
    echo "id=${id}"
    echo "score=${score}"
    echo "=====>input param end<====="
    
    id=${id}
    echo '${setValue(id2='$id')}'
    
    if [ "${score}" -ge "90" ];then
    	echo '${setValue(label2=level A)}'
    	echo "level A"
    elif [ "${score}" -ge "80" ];then
    	echo '${setValue(label2=level B)}'
    	echo "level B"
    elif [ "${score}" -ge "60" ];then
    	echo '${setValue(label2=level C)}'
    	echo "level C"
    elif [ "${score}" -ge "0" ];then
    	echo '${setValue(label2=F!)}'
    	echo "F!"
    else
    	echo "NO score ,please check!"
        exit 1
    fi
    

*   `node3èŠ‚ç‚¹`å®šä¹‰ï¼š  
    ![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707230836378-1614084387.png)
    
*   çœ‹ä¸€çœ¼ç»“æœğŸ¤“ï¼š  
    ![](https://img2022.cnblogs.com/blog/1161789/202207/1161789-20220707231029842-1430668027.png)
    

### äº”.ä¸­é—´çš„å‘

å¯¹äºå¤æ‚èŠ‚ç‚¹ä¼ å‚æ•°ä¹Ÿç¢°åˆ°ä¸€äº›å‘ï¼Œè¿™äº›å‘å¤§æ¦‚æœ‰è¿™äº›ï¼š

*   1.å¯¹äº`shell`è„šæœ¬ä¸ç†Ÿæ‚‰çš„ï¼Œåˆ¤æ–­èŠ‚ç‚¹å…¶å®è¿˜æ˜¯æœ‰ä¸€äº›éš¾åº¦çš„ï¼Œè¿™æ˜¯å¾ˆé‡è¦çš„ä¸€ç‚¹
*   2.`node2`(åˆ¤æ–­èŠ‚ç‚¹)ä¸èƒ½æœ‰é‡å¤çš„å‚æ•°ï¼Œä¸ç®¡å±€éƒ¨çš„è¿˜æ˜¯`node1`(ä¸Šä¸€çº§)ä¼ é€’è¿‡æ¥çš„ï¼Œå‡`ä¸èƒ½é‡å¤`
*   3.å› ä¸ºåœ¨`node2`(åˆ¤æ–­èŠ‚ç‚¹)éœ€è¦å°†`id`ä»¥åŠ`label`ç»§ç»­å¾€ä¸‹ä¼ (to `node3`),è¿™æ—¶å€™å°±éœ€è¦ç»™`id`ä»¥åŠ`label`å®šä¹‰ä¸€ä¸ªæ˜ å°„çš„`out`å˜é‡(`id2`ã€`label2`)
*   4.`node2`ä¸­`é‡æ–°è®¾ç½®å‚æ•°éº»çƒ¦`ï¼Œéœ€è¦åœ¨`shell`ä¸­é‡æ–°å®šä¹‰å˜é‡(`id2`ã€`label2`),åŒæ—¶éœ€è¦åœ¨`shellä»»åŠ¡`å†…ä½¿ç”¨æ‹¼æ¥çš„æ–¹å¼èµ‹å€¼(å¦‚ï¼š`echo '${setValue(id2='$id')}'`)
*   5.`sqlç±»å‹`ä»¥åŠä¸åŒèŠ‚ç‚¹ä¸‹ä¸åŒå‚æ•°æ—¶å¸¸æé”™ï¼Œä¸æ˜¯ä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥æ¥æ”¶`ä¸Šçº§èŠ‚ç‚¹`å‚æ•°ï¼Œä»¥åŠ`å±€éƒ¨å˜é‡`ä¸`ä¼ é€’å˜é‡`ä»¥åŠ`å…¨å±€å˜é‡`ä¼˜å…ˆçº§åŒºåˆ«åŠå¯èƒ½é€ æˆå†²çª
*   6.ds`åˆ—è¡¨ä¼ å‚`(2.0æ˜¯ä¸å¯ä»¥çš„)å¾ˆ`é¸¡è‚‹`,å¯¹äº`åˆ—è¡¨ä¼ å‚`åˆä¸èƒ½åœ¨ä¸‹ä¸€çº§èŠ‚ç‚¹åš`å¾ªç¯èµ‹å€¼`ï¼Œè¿™ç‚¹å¯¹äºdsæ˜¯æœ‰æ”¹è¿›çš„ç©ºé—´çš„
*   7.ç­‰ç­‰...

> å¯¹äº`ds`è¿˜æœ‰å¾ˆå¤šå¯æ‰©å±•çš„åœ°æ–¹(å› ä¸ºå®é™…éœ€è¦)ï¼Œæ‰€ä»¥æˆ‘å°±åšäº†ä¸€äº›äºŒæ¬¡å¼€å‘ğŸ˜‚ï¼Œåé¢ä¼šèŠ...å¤§å®¶æœŸå¾…å“ŸğŸ˜š

funnyzpc@gmail.com