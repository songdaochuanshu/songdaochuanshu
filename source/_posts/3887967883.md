---
layout: post
title: "Tomcatæ·±å…¥æµ…å‡ºâ€”â€”Filterä¸Listener(äº”)"
date: "2022-07-10T12:31:52.515Z"
---
Tomcatæ·±å…¥æµ…å‡ºâ€”â€”Filterä¸Listener(äº”)
==============================

æœ¬æ–‡ä»‹ç»äº†Filterè¿‡æ»¤å™¨çš„ä½œç”¨ã€ç”¨é€”ã€ä»¥åŠå®ƒçš„è®¾è®¡æ¨¡å¼ã€‚åŒæ—¶ä¹Ÿä»‹ç»äº†ä¸¤ç§Listenerç›‘å¬å™¨

ä¸€ã€Filterè¿‡æ»¤å™¨
===========

1.1 Filterè¿‡æ»¤å™¨çš„ä½¿ç”¨
----------------

*   è¿™æ˜¯è¿‡æ»¤å™¨æ¥å£çš„æ–¹æ³•

    public interface Filter {
        default void init(FilterConfig filterConfig) throws ServletException {
        }
    
        void doFilter(ServletRequest var1, ServletResponse var2, FilterChain var3) throws IOException, ServletException;
    
        default void destroy() {
        }
    }
    

*   ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½åœ¨è¿‡æ»¤å™¨ä¸­æ·»åŠ å…¬å…±çš„ä»£ç 
*   ä¾‹å¦‚æˆ‘ä»¬ç»å¸¸è®¾ç½®å­—ç¬¦ç¼–ç utf-8ï¼Œä¸ºäº†å‡å°‘é‡å¤çš„æ“ä½œï¼Œæˆ‘ä»¬ç›´æ¥åœ¨è¿‡æ»¤å™¨ä¸­è®¾ç½®å³å¯ã€‚

    @WebFilter("/*")
    public class MyFilter implements Filter {
    
        @Override
        public void init(FilterConfig filterConfig) throws ServletException {
            //åœ¨Filterå¯¹è±¡ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºçš„æ—¶å€™è°ƒç”¨ï¼Œå¹¶ä¸”åªè°ƒç”¨ä¸€æ¬¡
        }
    
        @Override
        public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
            //doFilter()åªè¦ç”¨æˆ·å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œåˆ™æ‰§è¡Œä¸€æ¬¡ï¼Œå‘é€Næ¬¡ï¼Œåˆ™æ‰§è¡ŒNæ¬¡ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ç¼–å†™è¿‡æ»¤è§„åˆ™
            System.out.println("doFilteræ–¹æ³•ï¼Œå‰1");
            //è§£å†³è·¨åŸŸé—®é¢˜
            HttpServletResponse resp = (HttpServletResponse) servletResponse;
            resp.setHeader("Access-Control-Allow-Origin", "*");
            resp.setHeader("Access-Control-Allow-Headers", "*");
            resp.setHeader("Access-Control-Allow-Method", "*");
    
            //æ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå¦‚æœè¯´ä¸‹ä¸€ä¸ªä¸æ˜¯è¿‡æ»¤å™¨ï¼Œåˆ™ä¼šæ‰§è¡Œservlet
            filterChain.doFilter(servletRequest,servletResponse);
            System.out.println("doFilteræ–¹æ³•ï¼Œå1");
        }
    
    
        @Override
        public void destroy() {
            //åœ¨Filterå¯¹è±¡è¢«é‡Šæ”¾/é”€æ¯ä¹‹å‰è°ƒç”¨ï¼Œå¹¶ä¸”åªè°ƒç”¨ä¸€æ¬¡
            System.out.println("destroyæ–¹æ³•");
        }
    }
    

*   initæ–¹æ³•ï¼šåœ¨Filterå¯¹è±¡ç¬¬ä¸€æ¬¡è¢«åˆ›å»ºçš„æ—¶å€™è°ƒç”¨ï¼Œå¹¶ä¸”åªè°ƒç”¨ä¸€æ¬¡
    
*   doFilteræ–¹æ³•ï¼šåªè¦ç”¨æˆ·å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œåˆ™æ‰§è¡Œä¸€æ¬¡ï¼Œå‘é€Næ¬¡ï¼Œåˆ™æ‰§è¡ŒNæ¬¡ã€‚**åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ç¼–å†™è¿‡æ»¤è§„åˆ™**
    
*   destroyæ–¹æ³•ï¼šåœ¨Filterå¯¹è±¡è¢«é‡Šæ”¾/é”€æ¯ä¹‹å‰è°ƒç”¨ï¼Œå¹¶ä¸”åªè°ƒç”¨ä¸€æ¬¡
    
*   `filterChain.doFilter(request, response);`æ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå¦‚æœä¸‹ä¸€ä¸ªä¸æ˜¯è¿‡æ»¤å™¨ï¼Œåˆ™æ‰§è¡ŒServlet
    

**ç›®æ ‡Servletæ˜¯å¦æ‰§è¡Œå–å†³äºä¸¤ä¸ªæ¡ä»¶ï¼š**

*   è¿‡æ»¤å™¨ä¸­æ˜¯å¦ç¼–å†™äº†`filterChain.doFilter(request, response);`
*   ç”¨æˆ·å‘çš„è¯·æ±‚è·¯å¾„æ˜¯å¦å’ŒServletçš„è¯·æ±‚è·¯å¾„ä¸€è‡´

* * *

**æ³¨æ„ï¼š**

*   Filterçš„ä¼˜å…ˆçº§å¤©ç”Ÿå°±æ¯”Servleté«˜
*   ä½¿ç”¨@WebFilterçš„æ—¶å€™ï¼ŒFilteræ‰§è¡Œé¡ºåºæ ¹æ®ç±»åé¡ºåºæ‰§è¡Œã€‚
*   Filterçš„ç”Ÿå‘½å‘¨æœŸä¸Servletä¸€æ ·ï¼Œä½†æ˜¯Filterä¼šåœ¨æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™å°±é»˜è®¤åˆ›å»ºå¯¹è±¡ï¼Œè€ŒServletå´éœ€è¦é…ç½®æ‰å¯ä»¥ã€‚
*   å¦‚æœåœ¨web.xmlä¸­é…ç½®ä¸¤ä¸ªæˆ–è€…å¤šä¸ªè¿‡æ»¤å™¨æ—¶ï¼Œæ‰§è¡Œé¡ºåºæ ¹æ®`<filter-mapping>`çš„å…ˆåã€‚

1.2 Filterçš„è´£ä»»é“¾è®¾è®¡æ¨¡å¼
------------------

*   æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¸¤ä¸ªè¿‡æ»¤å™¨çš„è¿è¡Œè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„

![](https://img2022.cnblogs.com/blog/2816773/202207/2816773-20220710192456604-1361959399.png)

![](https://img2022.cnblogs.com/blog/2816773/202207/2816773-20220710192537440-1730529621.png)

*   Filterè¿‡æ»¤å™¨çš„doFilteræ–¹æ³•ï¼Œæ‰§è¡Œé¡ºåºéµå¾ªçš„æ˜¯æ ˆç»“æ„ï¼Œä½†æ˜¯è¿‡æ»¤å™¨æœ¬èº«çš„ç”Ÿå‘½å‘¨æœŸå°±å’Œé˜Ÿåˆ—å·®ä¸å¤šå§ã€‚
*   å…¶å®doFilteræ–¹æ³•ï¼Œå°±æ˜¯ä¸€ç§è´£ä»»é“¾è®¾è®¡æ¨¡å¼ï¼

    //æ¨¡ä»¿æ ˆ
    //æ¨¡ä»¿Filterè®¾è®¡æ¨¡å¼
    //ç¼ºç‚¹ï¼šåœ¨ç¼–è¯‘é˜¶æ®µå·²ç»å®Œå…¨ç¡®å®šäº†è°ƒç”¨å…³ç³»
    //å¦‚æœæƒ³è¦æ”¹å˜è°ƒç”¨é¡ºåºï¼Œå¿…é¡»è¦ä¿®æ”¹javaä»£ç 
    //è¿èƒŒäº†OCPåŸåˆ™ï¼ˆå¼€é—­åŸåˆ™ï¼‰
    public class Test {
        public static void main(String[] args) {
            System.out.println("mainæ–¹æ³•æ‰§è¡Œ");
            m1();
            System.out.println("mainæ‰§è¡Œå®Œæ¯•");
        }
        public static void m1() {
            System.out.println("m1æ–¹æ³•æ‰§è¡Œ");
            m2();
            System.out.println("m1æ‰§è¡Œå®Œæ¯•");
        }
        public static void m2() {
            System.out.println("m2æ–¹æ³•æ‰§è¡Œ");
            m3();
            System.out.println("m2æ‰§è¡Œå®Œæ¯•");
        }
        public static void m3() {
            System.out.println("ç›®æ ‡æ­£åœ¨æ‰§è¡Œä¸­");
        }
    }
    

![](https://img2022.cnblogs.com/blog/2816773/202207/2816773-20220710192833385-141157157.png)

*   è¿™æ˜¯æ‰§è¡Œçš„ç»“æœï¼Œæ˜¯ä¸æ˜¯å’ŒFilterä¸€æ ·~~~ğŸ‡

äºŒã€Listenerç›‘å¬å™¨
=============

*   ç›‘å¬å™¨é¡¾åæ€ä¹‰ï¼šèµ·åˆ°äº†ç›‘å¬çš„ä½œç”¨ï¼Œæˆ‘æƒ³å¤§å®¶åœ¨javaGUIéƒ¨åˆ†ä¹Ÿäº†è§£è¿‡å§ã€‚
*   ç›‘å¬å™¨å¯ä»¥ç›‘æµ‹æˆ‘ä»¬ç½‘ç«™æ—¶æ—¶çš„åœ¨çº¿äººæ•°ç­‰ç­‰
*   ç›‘å¬å™¨åŠ ä¸Š@WebListeneræ³¨è§£æˆ–è€…åœ¨web.xmlä¸­é…ç½®ä¸€ä¸‹å³å¯ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬ç¨‹åºå‘˜å»è°ƒç”¨
*   ä¸‹é¢æ˜¯ä¸€ä¸ªsessionç›‘å¬å™¨

    @WebListener
    public class MyListener01 implements HttpSessionAttributeListener {
    
        //ç›‘å¬sessionè¡Œä¸ºçš„ç›‘å¬å™¨
        @Override
        public void attributeAdded(HttpSessionBindingEvent se) {
            System.out.println("add");
        }
    
        @Override
        public void attributeRemoved(HttpSessionBindingEvent se) {
            System.out.println("removed");
        }
    
        @Override
        public void attributeReplaced(HttpSessionBindingEvent se) {
            System.out.println("replaced");
        }
    }
    

*   ä¸‹é¢æ˜¯ç›‘å¬æ•´ä¸ªServletç”Ÿå‘½å‘¨æœŸçš„ç›‘å¬å™¨

    @WebListener
    public class MyListener implements ServletContextListener {
    
        //ç›‘å¬æ•´ä¸ªservletç”Ÿå‘½å‘¨æœŸçš„ç›‘å¬å™¨
        @Override
        public void contextInitialized(ServletContextEvent sce) {
            System.out.println("contextInitialized");
        }
    
        @Override
        public void contextDestroyed(ServletContextEvent sce) {
            System.out.println("contextDestroyed");
        }
    }
    

*   æ„Ÿè§‰ç”¨é€”ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæˆ‘äº†è§£çš„ä¹Ÿæ¯”è¾ƒå°‘ï¼Œå°±å…ˆä»‹ç»è¿™ä¹ˆå¤šï¼Œæ„Ÿè°¢ä½ çš„è®¤çœŸé˜…è¯»ğŸš€

ä¸‰ã€ç»“å°¾
====

*   å¯¹äº**Tomcatçš„Servlet**å†…å®¹å°±æ€»ç»“è¿™ä¹ˆå¤šï¼Œè‹¥æƒ³æ·±å…¥å­¦ä¹ ç­‰å¾…åç»­æ›´æ–°ã€‚
*   æˆ‘å°†ä¼šç»§ç»­æ›´æ–°å…³äº**Javaæ–¹å‘**çš„å­¦ä¹ çŸ¥è¯†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å…³æ³¨ä¸€ä¸‹ã€‚
*   æ–‡ç« å†™å¾—æ¯”è¾ƒèµ°å¿ƒï¼Œç”¨äº†å¾ˆé•¿æ—¶é—´ï¼Œç»å¯¹**ä¸æ˜¯copy**è¿‡æ¥çš„ï¼
*   **å°Šé‡**æ¯ä¸€ä½å­¦ä¹ çŸ¥è¯†çš„äººï¼ŒåŒæ—¶ä¹Ÿ**å°Šé‡**æ¯ä¸€ä½åˆ†äº«çŸ¥è¯†çš„äººã€‚
*   ğŸ˜ä½ çš„**ç‚¹èµä¸å…³æ³¨**ï¼Œæ˜¯æˆ‘åŠªåŠ›å‰è¡Œçš„æ— é™åŠ¨åŠ›ã€‚ğŸ¤©