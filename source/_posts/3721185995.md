---
layout: post
title: "è§£è¯»JVMçº§åˆ«æœ¬åœ°ç¼“å­˜Caffeineé’å‡ºäºè“çš„è¦è¯€3 â€”â€” è®²é€Caffeineçš„æ•°æ®é©±é€æ·˜æ±°æœºåˆ¶ä¸ç”¨æ³•"
date: "2022-12-23T05:14:46.624Z"
---
è§£è¯»JVMçº§åˆ«æœ¬åœ°ç¼“å­˜Caffeineé’å‡ºäºè“çš„è¦è¯€3 â€”â€” è®²é€Caffeineçš„æ•°æ®é©±é€æ·˜æ±°æœºåˆ¶ä¸ç”¨æ³•
=====================================================

ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬èŠäº†Caffeineçš„åŒæ­¥ã€å¼‚æ­¥çš„æ•°æ®å›æºæ–¹å¼ã€‚æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬å†ä¸€èµ·ç ”è®¨ä¸‹ç»Caffeineæ”¹è‰¯è¿‡çš„å¼‚æ­¥æ•°æ®é©±é€å¤„ç†å®ç°ï¼Œä»¥åŠCaffeineæ”¯æŒçš„å¤šç§ä¸åŒçš„æ•°æ®æ·˜æ±°é©±é€æœºåˆ¶å’Œå¯¹åº”çš„å®é™…ä½¿ç”¨ã€‚

![](https://pics.codingcoder.cn/pics/202210050807355.png)

å¤§å®¶å¥½ï¼Œåˆè§é¢äº†ã€‚

* * *

> æœ¬æ–‡æ˜¯ç¬”è€…ä½œä¸ºæ˜é‡‘æŠ€æœ¯ç¤¾åŒºç­¾çº¦ä½œè€…çš„èº«ä»½è¾“å‡ºçš„ç¼“å­˜ä¸“æ ç³»åˆ—å†…å®¹ï¼Œå°†ä¼šé€šè¿‡ç³»åˆ—ä¸“é¢˜ï¼Œè®²æ¸…æ¥šç¼“å­˜çš„æ–¹æ–¹é¢é¢ã€‚å¦‚æœæ„Ÿå…´è¶£ï¼Œæ¬¢è¿å…³æ³¨ä»¥è·å–åç»­æ›´æ–°ã€‚

* * *

ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬èŠäº†ä¸‹**Caffeine**çš„åŒæ­¥ã€å¼‚æ­¥çš„æ•°æ®å›æºæ–¹å¼ã€‚æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬å†ä¸€èµ·ç ”è®¨ä¸‹Caffeineçš„å¤šç§ä¸åŒçš„æ•°æ®**æ·˜æ±°é©±é€æœºåˆ¶**ï¼Œä»¥åŠå¯¹åº”çš„å®é™…ä½¿ç”¨ã€‚

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

Caffeineçš„å¼‚æ­¥æ·˜æ±°æ¸…ç†æœºåˆ¶
-----------------

åœ¨æƒ°æ€§åˆ é™¤å®ç°æœºåˆ¶è¿™è¾¹ï¼ŒCaffeineåšäº†ä¸€äº›æ”¹è¿›ä¼˜åŒ–ä»¥æå‡åœ¨å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚æˆ‘ä»¬å¯ä»¥å’ŒGuava Cacheçš„åŸºäºå®¹é‡å¤§å°çš„æ·˜æ±°å¤„ç†åšä¸ªå¯¹æ¯”ã€‚

å½“é™åˆ¶äº†`Guava Cache`æœ€å¤§å®¹é‡ä¹‹åï¼Œæœ‰æ–°çš„è®°å½•å†™å…¥è¶…è¿‡äº†æ€»å¤§å°ï¼Œä¼šç†è§£è§¦å‘æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Œç„¶åè…¾å‡ºç©ºé—´ç»™æ–°çš„è®°å½•å†™å…¥ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ®µé€»è¾‘ï¼š

    public static void main(String[] args) {
        Cache<String, String> cache = CacheBuilder.newBuilder()
                .maximumSize(1)
                .removalListener(notification -> System.out.println(notification.getKey() + "è¢«ç§»é™¤ï¼ŒåŸå› ï¼š" + notification.getCause()))
                .build();
        cache.put("key1", "value1");
        System.out.println("key1å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š" + cache.asMap().keySet());
        cache.put("key2", "value1");
        System.out.println("key2å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š" + cache.asMap().keySet());
    }
    

å…¶è¿è¡Œåçš„ç»“æœæ˜¾ç¤ºå¦‚ä¸‹ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºï¼Œè¶…å‡ºå®¹é‡ä¹‹åç»§ç»­å†™å…¥ï¼Œä¼šåœ¨**å†™å…¥å‰å…ˆæ‰§è¡Œç¼“å­˜ç§»é™¤**æ“ä½œã€‚

    key1å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š[key1]
    key1è¢«ç§»é™¤ï¼ŒåŸå› ï¼šSIZE
    key2å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š[key2]
    

åŒæ ·åœ°ï¼Œæˆ‘ä»¬çœ‹ä¸‹ä½¿ç”¨`Caffeine`å®ç°ä¸€ä¸ªé™åˆ¶å®¹é‡å¤§å°çš„ç¼“å­˜å¯¹è±¡çš„å¤„ç†è¡¨ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š

    public static void main(String[] args) {
        Cache<String, String> cache = Caffeine.newBuilder()
                .maximumSize(1)
                .removalListener((key, value, cause) -> System.out.println(key + "è¢«ç§»é™¤ï¼ŒåŸå› ï¼š" + cause))
                .build();
        cache.put("key1", "value1");
        System.out.println("key1å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š" + cache.asMap().keySet());
        cache.put("key2", "value1");
        System.out.println("key2å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š" + cache.asMap().keySet());
    }
    

è¿è¡Œè¿™æ®µä»£ç ï¼Œä¼šå‘ç°Caffeineçš„å®¹é‡é™åˆ¶åŠŸèƒ½ä¼¼ä¹â€œ**å¤±çµ**â€äº†ï¼ä»è¾“å‡ºç»“æœçœ‹**å¹¶æ²¡æœ‰é™åˆ¶ä½**ï¼š

    key1å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š[key1]
    key2å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š[key1, key2]
    

ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ

`Caffeine`ä¸ºäº†æå‡è¯»å†™æ“ä½œçš„å¹¶å‘æ•ˆç‡è€Œå°†æ•°æ®æ·˜æ±°æ¸…ç†æ“ä½œæ”¹ä¸ºäº†**å¼‚æ­¥å¤„ç†**ï¼Œè€Œå¼‚æ­¥å¤„ç†æ—¶ä¼šæœ‰å¾®å°çš„å»¶æ—¶ï¼Œç”±æ­¤å¯¼è‡´äº†ä¸Šè¿°çœ‹åˆ°çš„å®¹é‡æ§åˆ¶â€œå¤±çµâ€ç°è±¡ã€‚ä¸ºäº†è¯å®è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯¹ä¸Šè¿°çš„æµ‹è¯•ä»£ç ç¨ä½œä¿®æ”¹ï¼Œæ‰“å°ä¸‹è°ƒç”¨çº¿ç¨‹ä¸æ•°æ®æ·˜æ±°æ¸…ç†çº¿ç¨‹çš„çº¿ç¨‹IDï¼Œå¹¶ä¸”æœ€åæ·»åŠ ä¸€ä¸ªsleepç­‰å¾…æ“ä½œï¼š

    public static void main(String[] args) throws Exception {
        System.out.println("å½“å‰ä¸»çº¿ç¨‹ï¼š" + Thread.currentThread().getId());
        Cache<String, String> cache = Caffeine.newBuilder()
                .maximumSize(1)
                .removalListener((key, value, cause) ->
                        System.out.println("æ•°æ®æ·˜æ±°æ‰§è¡Œçº¿ç¨‹ï¼š" + Thread.currentThread().getId()
                                + "ï¼Œ" + key + "è¢«ç§»é™¤ï¼ŒåŸå› ï¼š" + cause))
                .build();
        cache.put("key1", "value1");
        System.out.println("key1å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š" + cache.asMap().keySe());
        cache.put("key2", "value1");
        Thread.sleep(1000L); // ç­‰å¾…ä¸€æ®µæ—¶é—´æ—¶é—´ï¼Œç­‰å¾…å¼‚æ­¥æ¸…ç†æ“ä½œå®Œæˆ
        System.out.println("key2å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š" + cache.asMap().keySet());
    }
    

å†æ¬¡æ‰§è¡Œä¸Šè¿°æµ‹è¯•ä»£ç ï¼Œå‘ç°ç»“æœå˜çš„ç¬¦åˆé¢„æœŸäº†ï¼Œä¹Ÿå¯ä»¥çœ‹å‡ºCaffeineçš„ç¡®æ˜¯å¦èµ·äº†**ç‹¬ç«‹çº¿ç¨‹**å»æ‰§è¡Œ_æ•°æ®æ·˜æ±°_æ“ä½œçš„ã€‚

    å½“å‰ä¸»çº¿ç¨‹ï¼š1
    key1å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š[key1]
    æ•°æ®æ·˜æ±°æ‰§è¡Œçº¿ç¨‹ï¼š13ï¼Œkey1è¢«ç§»é™¤ï¼ŒåŸå› ï¼šSIZE
    key2å†™å…¥åï¼Œå½“å‰ç¼“å­˜å†…çš„keysï¼š[key2]
    

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

æ·±æ‰’ä¸€ä¸‹æºç çš„å®ç°ï¼Œå¯ä»¥å‘ç°`Caffeine`åœ¨è¯»å†™æ“ä½œæ—¶ä¼šä½¿ç”¨**ç‹¬ç«‹çº¿ç¨‹**æ± æ‰§è¡Œå¯¹åº”çš„æ¸…ç†ä»»åŠ¡ï¼Œå¦‚ä¸‹å›¾ä¸­çš„è°ƒç”¨é“¾æ‰§è¡Œé“¾è·¯ â€”â€” è¿™ä¹Ÿè¯å®äº†ä¸Šé¢æˆ‘ä»¬çš„åˆ†æã€‚

![](https://pics.codingcoder.cn/pics/202211131502827.png)

æ‰€ä»¥ï¼Œä¸¥æ ¼æ„ä¹‰æ¥è¯´ï¼ŒCaffeineçš„å¤§å°å®¹é‡é™åˆ¶å¹¶ä¸èƒ½å¤Ÿä¿è¯å®Œå…¨ç²¾å‡†çš„å°äºè®¾å®šçš„å€¼ï¼Œä¼šå­˜åœ¨**çŸ­æš‚çš„è¯¯å·®**ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªä»¥_é«˜å¹¶å‘ååé‡_ä¸ºä¼˜å…ˆè€ƒé‡ç‚¹çš„ç»„ä»¶è€Œè¨€ï¼Œè¿™ä¸€ç‚¹ç‚¹çš„è¯¯å·®ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œå¦‚æœé˜…è¯»æºç ä»”ç»†ç‚¹çš„å°ä¼™ä¼´å…¶å®ä¹Ÿå¯ä»¥å‘ç°åœ¨å¾ˆå¤šåœºæ™¯çš„æ³¨é‡Šä¸­ï¼ŒCaffeineä¹Ÿéƒ½ä¼šæœ‰æ˜ç¡®çš„è¯´æ˜ã€‚æ¯”å¦‚çœ‹ä¸‹é¢è¿™æ®µä»æºç ä¸­æ‘˜æŠ„çš„æè¿°ï¼Œå°±æ¸…æ™°çš„å†™ç€â€œ**å¦‚æœæœ‰åŒæ­¥æ‰§è¡Œçš„æ’å…¥æˆ–è€…ç§»é™¤æ“ä½œï¼Œå®é™…çš„å…ƒç´ æ•°é‡å¯èƒ½ä¼šå‡ºç°å·®å¼‚**â€ã€‚

    public interface Cache<K, V> {
        /**
         * Returns the approximate number of entries in this cache. The value returned is an estimate; the
         * actual count may differ if there are concurrent insertions or removals, or if some entries are
         * pending removal due to expiration or weak/soft reference collection. In the case of stale
         * entries this inaccuracy can be mitigated by performing a {@link #cleanUp()} first.
         *
         * @return the estimated number of mappings
         */
        @NonNegative
        long estimatedSize();
    
      // çœç•¥å…¶ä½™å†…å®¹...
    }
    

åŒæ ·é“ç†ï¼Œä¸ç®¡æ˜¯åŸºäºå¤§å°ã€è¿˜æ˜¯åŸºäºè¿‡æœŸæ—¶é—´æˆ–åŸºäºå¼•ç”¨çš„æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Œç”±äºæ•°æ®æ·˜æ±°å¤„ç†æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œéƒ½ä¼šå­˜åœ¨**çŸ­æš‚**çš„**ä¸å¤Ÿç²¾ç¡®**çš„æƒ…å†µã€‚

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

å¤šç§æ·˜æ±°æœºåˆ¶
------

ä¸Šé¢æåˆ°å¹¶æ¼”ç¤ºäº†CaffeineåŸºäºæ•´ä½“å®¹é‡è¿›è¡Œçš„æ•°æ®é©±é€ç­–ç•¥ã€‚é™¤äº†åŸºäºå®¹é‡å¤§å°ä¹‹å¤–ï¼ŒCaffeineè¿˜æ”¯æŒåŸºäºæ—¶é—´ä¸åŸºäºå¼•ç”¨ç­‰æ–¹å¼æ¥è¿›è¡Œæ•°æ®é©±é€å¤„ç†ã€‚

### åŸºäºæ—¶é—´

Caffineæ”¯æŒ**åŸºäºæ—¶é—´**è¿›è¡Œæ•°æ®çš„æ·˜æ±°é©±é€å¤„ç†ã€‚è¿™éƒ¨åˆ†çš„èƒ½åŠ›ä¸Guava Cacheç›¸åŒï¼Œæ”¯æŒæ ¹æ®è®°å½•**åˆ›å»ºæ—¶é—´**ä»¥åŠ**è®¿é—®æ—¶é—´**ä¸¤ä¸ªç»´åº¦è¿›è¡Œå¤„ç†ã€‚

æ•°æ®çš„è¿‡æœŸæ—¶é—´åœ¨åˆ›å»ºç¼“å­˜å¯¹è±¡çš„æ—¶å€™è¿›è¡ŒæŒ‡å®šï¼ŒCaffeineåœ¨åˆ›å»ºç¼“å­˜å¯¹è±¡çš„æ—¶å€™æä¾›äº†`3ç§`è®¾å®šè¿‡æœŸç­–ç•¥çš„æ–¹æ³•ã€‚

æ–¹å¼

å…·ä½“è¯´æ˜

expireAfterWrite

åŸºäºåˆ›å»ºæ—¶é—´è¿›è¡Œè¿‡æœŸå¤„ç†

expireAfterAccess

åŸºäºæœ€åè®¿é—®æ—¶é—´è¿›è¡Œè¿‡æœŸå¤„ç†

expireAfter

åŸºäº**ä¸ªæ€§åŒ–å®šåˆ¶**çš„é€»è¾‘æ¥å®ç°è¿‡æœŸå¤„ç†ï¼ˆå¯ä»¥å®šåˆ¶åŸºäº`æ–°å¢`ã€`è¯»å–`ã€`æ›´æ–°`ç­‰åœºæ™¯çš„è¿‡æœŸç­–ç•¥ï¼Œç”šè‡³æ”¯æŒä¸º_ä¸åŒè®°å½•æŒ‡å®šä¸åŒè¿‡æœŸæ—¶é—´_ï¼‰

ä¸‹é¢é€ä¸ªçœ‹ä¸‹ã€‚

#### expireAfterWrite

`expireAfterWrite`ç”¨äºæŒ‡å®šæ•°æ®åˆ›å»ºä¹‹åå¤šä¹…ä¼šè¿‡æœŸï¼Œä½¿ç”¨æ–¹å¼ä¸¾ä¾‹å¦‚ä¸‹ï¼š

    Cache<String, User> userCache = 
        Caffeine.newBuilder()
            .expireAfterWrite(1, TimeUnit.SECONDS)
            .build();
    userCache.put("123", new User("123", "å¼ ä¸‰"))ï¼›
    

å½“è®°å½•è¢«å†™å…¥ç¼“å­˜ä¹‹åè¾¾åˆ°æŒ‡å®šçš„æ—¶é—´ä¹‹åï¼Œå°±ä¼šè¢«è¿‡æœŸæ·˜æ±°ï¼ˆ**æƒ°æ€§åˆ é™¤**ï¼Œå¹¶ä¸ä¼šç«‹å³ä»å†…å­˜ä¸­ç§»é™¤ï¼Œè€Œæ˜¯åœ¨ä¸‹ä¸€æ¬¡æ“ä½œçš„æ—¶å€™è§¦å‘æ¸…ç†æ“ä½œï¼‰ã€‚

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

#### expireAfterAccess

`expireAfterAccess`ç”¨äºæŒ‡å®šç¼“å­˜è®°å½•å¤šä¹…æ²¡æœ‰è¢«è®¿é—®ä¹‹åå°±ä¼šè¿‡æœŸã€‚ä½¿ç”¨æ–¹å¼ä¸expireAfterWriteç±»ä¼¼ï¼š

    Cache<String, User> userCache = 
        Caffeine.newBuilder()
            .expireAfterAccess(1, TimeUnit.SECONDS)
            .build();
        userCache.get("123", s -> userDao.getUser(s));
    

è¿™ç§æ˜¯åŸºäºæœ€åä¸€æ¬¡è®¿é—®æ—¶é—´æ¥è®¡ç®—æ•°æ®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœä¸€ä¸ªæ•°æ®ä¸€ç›´è¢«è®¿é—®ï¼Œåˆ™å…¶å°±ä¸ä¼šè¿‡æœŸã€‚æ¯”è¾ƒé€‚ç”¨äº**çƒ­ç‚¹æ•°æ®**çš„å­˜å‚¨åœºæ™¯ï¼Œå¯ä»¥ä¿è¯è¾ƒé«˜çš„ç¼“å­˜å‘½ä¸­ç‡ã€‚åŒæ ·åœ°ï¼Œæ•°æ®è¿‡æœŸæ—¶ä¹Ÿä¸ä¼šè¢«ç«‹å³ä»å†…å­˜ä¸­ç§»é™¤ï¼Œè€Œæ˜¯åŸºäº**æƒ°æ€§åˆ é™¤**æœºåˆ¶è¿›è¡Œå¤„ç†ã€‚

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

#### expireAfter

ä¸Šé¢ä¸¤ç§è®¾å®šè¿‡æœŸæ—¶é—´çš„ç­–ç•¥ä¸Guava Cacheæ˜¯ç›¸ä¼¼çš„ã€‚ä¸ºäº†æä¾›æ›´ä¸ºçµæ´»çš„è¿‡æœŸæ—¶é—´è®¾å®šèƒ½åŠ›ï¼ŒCaffeineæä¾›äº†ä¸€ç§å…¨æ–°çš„çš„è¿‡æœŸæ—¶é—´è®¾å®šæ–¹å¼ï¼Œä¹Ÿå³è¿™é‡Œè¦ä»‹ç»çš„`expireAfter`æ–¹æ³•ã€‚å…¶æ”¯æŒä¼ å…¥ä¸€ä¸ªè‡ªå®šä¹‰çš„`Expiry`å¯¹è±¡ï¼Œè‡ªè¡Œå®ç°æ•°æ®çš„è¿‡æœŸç­–ç•¥ï¼Œç”šè‡³æ˜¯é’ˆå¯¹ä¸åŒçš„è®°å½•æ¥å®šåˆ¶ä¸åŒçš„è¿‡æœŸæ—¶é—´ã€‚

å…ˆçœ‹ä¸‹Expiryæ¥å£ä¸­éœ€è¦å®ç°çš„ä¸‰ä¸ªæ–¹æ³•ï¼š

æ–¹æ³•åç§°

å«ä¹‰è¯´æ˜

expireAfterCreate

æŒ‡å®šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä»è®°å½•åˆ›å»ºçš„æ—¶å€™å¼€å§‹è®¡æ—¶ï¼Œè¶…è¿‡æŒ‡å®šçš„æ—¶é—´ä¹‹åå°±è¿‡æœŸæ·˜æ±°ï¼Œæ•ˆæœç±»ä¼¼`expireAfterWrite`ï¼Œä½†æ˜¯æ”¯æŒ**æ›´çµæ´»**çš„å®šåˆ¶é€»è¾‘ã€‚

expireAfterUpdate

æŒ‡å®šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä»è®°å½•æœ€åä¸€æ¬¡è¢«æ›´æ–°çš„æ—¶å€™å¼€å§‹è®¡æ—¶ï¼Œè¶…è¿‡æŒ‡å®šçš„æ—¶é—´ä¹‹åå°±è¿‡æœŸã€‚æ¯æ¬¡æ‰§è¡Œ**æ›´æ–°æ“ä½œ**ä¹‹åï¼Œéƒ½ä¼šé‡æ–°è®¡ç®—è¿‡æœŸæ—¶é—´ã€‚

expireAfterRead

æŒ‡å®šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä»è®°å½•æœ€åä¸€æ¬¡è¢«è®¿é—®çš„æ—¶å€™å¼€å§‹è®¡æ—¶ï¼Œè¶…è¿‡æŒ‡å®šæ—¶é—´ä¹‹åå°±è¿‡æœŸã€‚æ•ˆæœç±»ä¼¼`expireAfterAccess`ï¼Œä½†æ˜¯æ”¯æŒ**æ›´é«˜çº§**çš„å®šåˆ¶é€»è¾‘ã€‚

æ¯”å¦‚ä¸‹é¢çš„ä»£ç ä¸­ï¼Œå®šåˆ¶äº†`expireAfterCreate`æ–¹æ³•çš„é€»è¾‘ï¼Œæ ¹æ®ç¼“å­˜keyæ¥å†³å®šè¿‡æœŸæ—¶é—´ï¼Œå¦‚æœkeyä»¥å­—æ¯Aå¼€å¤´åˆ™è®¾å®š1sè¿‡æœŸï¼Œå¦åˆ™è®¾å®š2sè¿‡æœŸï¼š

    public static void main(String[] args) {
        try {
            LoadingCache<String, User> userCache = Caffeine.newBuilder()
                    .removalListener((key, value, cause) -> {
                        System.out.println(key + "ç§»é™¤ï¼ŒåŸå› ï¼š" + cause);
                    })
                    .expireAfter(new Expiry<String, User>() {
                        @Override
                        public long expireAfterCreate(@NonNull String key, @NonNullUser value, long currentTime) {
                            if (key.startsWith("A")) {
                                return TimeUnit.SECONDS.toNanos(1);
                            } else {
                                return TimeUnit.SECONDS.toNanos(2);
                            }
                        }
                        @Override
                        public long expireAfterUpdate(@NonNull String key, @NonNullUser value, long currentTime,
                                                      @NonNegative longcurrentDuration) {
                            return Long.MAX_VALUE;
                        }
                        @Override
                        public long expireAfterRead(@NonNull String key, @NonNull Uservalue, long currentTime,
                                                    @NonNegative long currentDuration){
                            return Long.MAX_VALUE;
                        }
                    })
                    .build(key -> userDao.getUser(key));
            userCache.put("123", new User("123", "123"));
            userCache.put("A123", new User("A123", "A123"));
            Thread.sleep(1100L);
            System.out.println(userCache.get("123"));
            System.out.println(userCache.get("A123"));
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    

æ‰§è¡Œä»£ç è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥å‘ç°ï¼Œ**ä¸åŒçš„keyæ‹¥æœ‰äº†ä¸åŒçš„è¿‡æœŸæ—¶é—´**ï¼š

    User(userName=123, userId=123, departmentId=null)
    A123ç§»é™¤ï¼ŒåŸå› ï¼šEXPIRED
    User(userName=A123, userId=A123, departmentId=null)
    

é™¤äº†æ ¹æ®`key`æ¥å®šåˆ¶ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå¯ä»¥æ ¹æ®`value`çš„å†…å®¹æ¥æŒ‡å®šä¸åŒçš„è¿‡æœŸæ—¶é—´ç­–ç•¥ã€‚ä¹Ÿå¯ä»¥åŒæ—¶å®šåˆ¶ä¸Šè¿°ä¸‰ä¸ªæ–¹æ³•ï¼Œæ­é…æ¥å®ç°æ›´å¤æ‚çš„è¿‡æœŸç­–ç•¥ã€‚

æŒ‰ç…§è¿™ç§æ–¹å¼æ¥å®šæ—¶è¿‡æœŸæ—¶é—´çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœä¸éœ€è¦è®¾å®šæŸä¸€ç»´åº¦çš„è¿‡æœŸç­–ç•¥çš„æ—¶å€™ï¼Œéœ€è¦å°†å¯¹åº”å®ç°æ–¹æ³•çš„è¿”å›å€¼è®¾ç½®ä¸ºä¸€ä¸ªéå¸¸å¤§çš„æ•°å€¼ï¼Œæ¯”å¦‚å¯ä»¥åƒä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ä¸€æ ·ï¼ŒæŒ‡å®šä¸º`Long.MAX_VALUE`å€¼ã€‚

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

### åŸºäºå¤§å°

é™¤äº†å‰é¢æåˆ°çš„åŸºäºè®¿é—®æ—¶é—´æˆ–è€…åˆ›å»ºæ—¶é—´æ¥æ‰§è¡Œæ•°æ®è¿‡æœŸæ·˜æ±°çš„æ–¹å¼ä¹‹å¤–ï¼ŒCaffeineè¿˜æ”¯æŒé’ˆå¯¹ç¼“å­˜**æ€»ä½“å®¹é‡**å¤§å°è¿›è¡Œé™åˆ¶ï¼Œå¦‚æœå®¹é‡æ»¡çš„æ—¶å€™ï¼ŒåŸºäº`W-TinyLFU`ç®—æ³•ï¼Œæ·˜æ±°æœ€ä¸å¸¸è¢«ä½¿ç”¨çš„æ•°æ®ï¼Œè…¾å‡ºç©ºé—´ç»™æ–°çš„è®°å½•å†™å…¥ã€‚

Caffeineæ”¯æŒæŒ‰ç…§`Size`ï¼ˆè®°å½•æ¡æ•°ï¼‰æˆ–è€…æŒ‰ç…§W`eighter`ï¼ˆè®°å½•æƒé‡ï¼‰å€¼è¿›è¡Œæ€»ä½“å®¹é‡çš„é™åˆ¶ã€‚å…³äºSizeå’ŒWeighterçš„åŒºåˆ«ï¼Œä¹‹å‰çš„æ–‡ç« ä¸­æœ‰ä»‹ç»è¿‡ï¼Œå¦‚æœä¸æ¸…æ¥šçš„å°ä¼™ä¼´ä»¬å¯ä»¥æŸ¥çœ‹ä¸‹ã€Š[é‡æ–°è®¤è¯†ä¸‹JVMçº§åˆ«çš„æœ¬åœ°ç¼“å­˜æ¡†æ¶Guava Cache(2)â€”â€”æ·±å…¥è§£è¯»å…¶å®¹é‡é™åˆ¶ä¸æ•°æ®æ·˜æ±°ç­–ç•¥](https://juejin.cn/post/7161187654057328647#heading-1)ã€‹ã€‚

#### maximumSize

åœ¨åˆ›å»ºCaffeineç¼“å­˜å¯¹è±¡çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡`maximumSize`æ¥æŒ‡å®šå…è®¸ç¼“å­˜çš„æœ€å¤§æ¡æ•°ã€‚

æ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š

    Cache<Integer, String> cache = Caffeine.newBuilder()
            .maximumSize(1000L) // é™åˆ¶æœ€å¤§ç¼“å­˜æ¡æ•°
            .build();
    

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

#### maximumWeight

åœ¨åˆ›å»ºCaffeineç¼“å­˜å¯¹è±¡çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡`maximumWeight`ä¸`weighter`ç»„åˆçš„æ–¹å¼ï¼ŒæŒ‡å®šæŒ‰ç…§æƒé‡è¿›è¡Œé™åˆ¶ç¼“å­˜æ€»å®¹é‡ã€‚æ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²valueå€¼çš„ç¼“å­˜åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å­—ç¬¦ä¸²çš„é•¿åº¦æ¥è®¡ç®—æƒé‡å€¼ï¼Œæœ€åæ ¹æ®æ€»æƒé‡å¤§å°æ¥é™åˆ¶å®¹é‡ã€‚

ä»£ç ç¤ºæ„å¦‚ä¸‹ï¼š

    Cache<Integer, String> cache = Caffeine.newBuilder()
            .maximumWeight(1000L) // é™åˆ¶æœ€å¤§æƒé‡å€¼
            .weigher((key, value) -> (String.valueOf(value).length() / 1000) + 1)
            .build();
    

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

#### ä½¿ç”¨æ³¨æ„ç‚¹

éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šå¦‚æœåˆ›å»ºçš„æ—¶å€™æŒ‡å®šäº†`weighter`ï¼Œåˆ™å¿…é¡»åŒæ—¶æŒ‡å®š`maximumWeight`å€¼ï¼Œå¦‚æœä¸æŒ‡å®šã€æˆ–è€…æŒ‡å®šäº†maximumSizeï¼Œä¼š**æŠ¥é”™**ï¼ˆè¿™ä¸€ç‚¹ä¸Guava Cacheä¸€è‡´ï¼‰ï¼š

    java.lang.IllegalStateException: weigher requires maximumWeight
    	at com.github.benmanes.caffeine.cache.Caffeine.requireState(Caffeine.java:201)
    	at com.github.benmanes.caffeine.cache.Caffeine.requireWeightWithWeigher(Caffeine.java:1215)
    	at com.github.benmanes.caffeine.cache.Caffeine.build(Caffeine.java:1099)
    	at com.veezean.skills.cache.caffeine.CaffeineCacheService.main(CaffeineCacheService.java:254)
    

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

### åŸºäºå¼•ç”¨

åŸºäºå¼•ç”¨å›æ”¶çš„ç­–ç•¥ï¼Œæ ¸å¿ƒæ˜¯åˆ©ç”¨`JVM`è™šæ‹Ÿæœºçš„**GCæœºåˆ¶**æ¥è¾¾åˆ°æ•°æ®æ¸…ç†çš„ç›®çš„ã€‚å½“ä¸€ä¸ªå¯¹è±¡ä¸å†è¢«å¼•ç”¨çš„æ—¶å€™ï¼ŒJVMä¼šé€‰æ‹©åœ¨é€‚å½“çš„æ—¶å€™å°†å…¶å›æ”¶ã€‚Caffeineæ”¯æŒ`ä¸‰ç§`ä¸åŒçš„åŸºäºå¼•ç”¨çš„å›æ”¶æ–¹æ³•ï¼š

æ–¹æ³•

å…·ä½“è¯´æ˜

weakKeys

é‡‡ç”¨`å¼±å¼•ç”¨`æ–¹å¼å­˜å‚¨keyå€¼å†…å®¹ï¼Œå½“keyå¯¹è±¡ä¸å†è¢«å¼•ç”¨çš„æ—¶å€™ï¼Œç”±**GC**è¿›è¡Œå›æ”¶

weakValues

é‡‡ç”¨`å¼±å¼•ç”¨`æ–¹å¼å­˜å‚¨valueå€¼å†…å®¹ï¼Œå½“valueå¯¹è±¡ä¸å†è¢«å¼•ç”¨çš„æ—¶å€™ï¼Œç”±**GC**è¿›è¡Œå›æ”¶

softValues

é‡‡ç”¨`è½¯å¼•ç”¨`æ–¹å¼å­˜å‚¨valueå€¼å†…å®¹ï¼Œå½“å†…å­˜å®¹é‡æ»¡æ—¶åŸºäº**LRU**ç­–ç•¥è¿›è¡Œå›æ”¶

ä¸‹é¢é€ä¸ªä»‹ç»ä¸‹ã€‚

#### weakKeys

é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºå‡ºä¸€ä¸ªCaffeineç¼“å­˜å¯¹è±¡å¹¶å†™å…¥`key-value`æ˜ å°„æ•°æ®æ—¶ï¼Œkeyå’Œvalueéƒ½æ˜¯ä»¥**å¼ºå¼•ç”¨**çš„æ–¹å¼å­˜å‚¨çš„ã€‚è€Œä½¿ç”¨`weakKeys`å¯ä»¥æŒ‡å®šå°†ç¼“å­˜ä¸­çš„keyå€¼ä»¥**å¼±å¼•ç”¨**ï¼ˆWeakReferenceï¼‰çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¦‚æœç¨‹åºè¿è¡Œæ—¶æ²¡æœ‰å…¶å®ƒåœ°æ–¹ä½¿ç”¨æˆ–è€…ä¾èµ–æ­¤ç¼“å­˜å€¼çš„æ—¶å€™ï¼Œè¯¥æ¡è®°å½•å°±å¯èƒ½ä¼šè¢«`GCå›æ”¶`æ‰ã€‚

     LoadingCache<String,  User> loadingCache = Caffeine.newBuilder()
                    .weakKeys()
                    .build(key -> userDao.getUser(key));
    

å°ä¼™ä¼´ä»¬åº”è¯¥éƒ½æœ‰ä¸ªåŸºæœ¬çš„è®¤çŸ¥ï¼Œå°±æ˜¯ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œæ¯”è¾ƒæ˜¯å¦ç›¸ç­‰çš„æ—¶å€™ï¼Œè¦ä½¿ç”¨`equals`æ–¹æ³•è€Œé`==`ã€‚è€Œä¸”å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¼šä¸»åŠ¨å»è¦†å†™`hashCode`æ–¹æ³•ä¸`equals`æ–¹æ³•æ¥æŒ‡å®šä¸¤ä¸ªå¯¹è±¡çš„ç›¸ç­‰åˆ¤æ–­é€»è¾‘ã€‚ä½†æ˜¯åŸºäºå¼•ç”¨çš„æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Œå…³æ³¨çš„æ˜¯å¼•ç”¨åœ°å€å€¼è€Œéå®é™…å†…å®¹å€¼ï¼Œä¹Ÿå³ä¸€æ—¦ä½¿ç”¨**weakKeys**æŒ‡å®šäº†åŸºäºå¼•ç”¨æ–¹å¼å›æ”¶ï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„æ—¶å€™å°†åªèƒ½æ˜¯ä½¿ç”¨åŒä¸€ä¸ªkeyå¯¹è±¡ï¼ˆå†…å­˜åœ°å€ç›¸åŒï¼‰æ‰èƒ½å¤ŸæŸ¥è¯¢åˆ°æ•°æ®ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹æŸ¥è¯¢çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯`==`åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€ä¸ªkeyã€‚

çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š

    public static void main(String[] args) {
        Cache<String, String> cache = Caffeine.newBuilder()
                .weakKeys()
                .build();
        String key1 = "123";
        cache.put(key1, "value1");
        System.out.println(cache.getIfPresent(key1));
        String key2 = new String("123");
        System.out.println("key1.equals(key2) ï¼š " + key1.equals(key2));
        System.out.println("key1==key2 ï¼š " + (key1==key2));
        System.out.println(cache.getIfPresent(key2));
    }
    

æ‰§è¡Œä¹‹åï¼Œä¼šå‘ç°ä½¿ç”¨å­˜å…¥æ—¶çš„key1è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™æ˜¯å¯ä»¥æŸ¥è¯¢åˆ°æ•°æ®çš„ï¼Œè€Œä½¿ç”¨key2å»æŸ¥è¯¢çš„æ—¶å€™å¹¶æ²¡æœ‰æŸ¥è¯¢åˆ°è®°å½•ï¼Œè™½ç„¶key1ä¸key2çš„å€¼éƒ½æ˜¯å­—ç¬¦ä¸²123ï¼

    value1
    key1.equals(key2) ï¼š true
    key1==key2 ï¼š false
    null
    

åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿™ä¸€ç‚¹åŠ¡å¿…éœ€è¦æ³¨æ„ï¼Œå¯¹äºæ–°æ‰‹è€Œè¨€ï¼Œ**å¾ˆå®¹æ˜“è¸©è¿›å‘é‡Œ**ã€‚

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

#### weakValues

ä¸weakKeysç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºç¼“å­˜å¯¹è±¡çš„æ—¶å€™ä½¿ç”¨`weakValues`æŒ‡å®šå°†valueå€¼ä»¥**å¼±å¼•ç”¨**çš„æ–¹å¼å­˜å‚¨åˆ°ç¼“å­˜ä¸­ã€‚è¿™æ ·å½“è¿™æ¡ç¼“å­˜è®°å½•çš„å¯¹è±¡ä¸å†è¢«å¼•ç”¨ä¾èµ–çš„æ—¶å€™ï¼Œå°±ä¼šè¢«JVMåœ¨é€‚å½“çš„æ—¶å€™å›æ”¶é‡Šæ”¾æ‰ã€‚

     LoadingCache<String,  User> loadingCache = Caffeine.newBuilder()
                    .weakValues()
                    .build(key -> userDao.getUser(key));
    

å®é™…ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„`weakValues`**ä¸æ”¯æŒ**åœ¨`AsyncLoadingCache`ä¸­ä½¿ç”¨ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š

    public static void main(String[] args) {
        AsyncLoadingCache<String, User> cache = Caffeine.newBuilder()
                .weakValues()
                .buildAsync(key -> userDao.getUser(key));
    }
    

å¯åŠ¨è¿è¡Œçš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™ï¼š

    Exception in thread "main" java.lang.IllegalStateException: Weak or soft values cannot be combined with AsyncLoadingCache
    	at com.github.benmanes.caffeine.cache.Caffeine.requireState(Caffeine.java:201)
    	at com.github.benmanes.caffeine.cache.Caffeine.buildAsync(Caffeine.java:1192)
    	at com.github.benmanes.caffeine.cache.Caffeine.buildAsync(Caffeine.java:1167)
    	at com.veezean.skills.cache.caffeine.CaffeineCacheService.main(CaffeineCacheService.java:297)
    

å½“ç„¶å’¯ï¼Œå¾ˆå¤šæ—¶å€™ä¹Ÿå¯ä»¥å°†`weakKeys`ä¸`weakValues`ç»„åˆèµ·æ¥ä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥è·å¾—åˆ°ä¸¤ç§èƒ½åŠ›çš„ç»¼åˆåŠ æˆã€‚

     LoadingCache<String,  User> loadingCache = Caffeine.newBuilder()
                    .weakKeys()
                    .weakValues()
                    .build(key -> userDao.getUser(key));
    

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

#### softValues

`softValues`æ˜¯æŒ‡å°†ç¼“å­˜å†…å®¹å€¼ä»¥**è½¯å¼•ç”¨**çš„æ–¹å¼å­˜å‚¨åœ¨ç¼“å­˜å®¹å™¨ä¸­ï¼Œå½“**å†…å­˜å®¹é‡æ»¡**çš„æ—¶å€™Caffeineä¼šä»¥`LRU`ï¼ˆleast-recently-usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰é¡ºåºè¿›è¡Œæ•°æ®æ·˜æ±°å›æ”¶ã€‚å¯¹æ¯”ä¸‹å…¶ä¸weakValuesçš„å·®å¼‚ï¼š

æ–¹å¼

å…·ä½“æè¿°

weakValues

**å¼±å¼•ç”¨**æ–¹å¼å­˜å‚¨ï¼Œä¸€æ—¦ä¸å†è¢«å¼•ç”¨ï¼Œåˆ™ä¼šè¢«GCå›æ”¶

softValues

**è½¯å¼•ç”¨**æ–¹å¼å­˜å‚¨ï¼Œä¸ä¼šè¢«GCå›æ”¶ï¼Œä½†æ˜¯åœ¨å†…å­˜å®¹é‡æ»¡çš„æ—¶å€™ï¼Œä¼šåŸºäº**LRUç­–ç•¥**æ•°æ®å›æ”¶

å…·ä½“ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨åˆ›å»ºç¼“å­˜å¯¹è±¡çš„æ—¶å€™è¿›è¡ŒæŒ‡å®šåŸºäºè½¯å¼•ç”¨æ–¹å¼æ•°æ®æ·˜æ±°ï¼š

     LoadingCache<String,  User> loadingCache = Caffeine.newBuilder()
                    .softValues()
                    .build(key -> userDao.getUser(key));
    

ä¸weakValuesä¸€æ ·ï¼Œéœ€è¦æ³¨æ„`softValues`ä¹Ÿ**ä¸æ”¯æŒ**åœ¨`AsyncLoadingCache`ä¸­ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„`softValues`ä¸`weakValues`ä¸¤è€…ä¹Ÿ**ä¸å¯ä»¥**ä¸€èµ·ä½¿ç”¨ã€‚

    public static void main(String[] args) {
        LoadingCache<String, User> cache = Caffeine.newBuilder()
                .weakKeys()
                .weakValues()
                .softValues()
                .build(key -> userDao.getUser(key));
    }
    

å¯åŠ¨è¿è¡Œçš„æ—¶å€™ï¼Œä¹Ÿä¼šæŠ¥é”™ï¼š

    Exception in thread "main" java.lang.IllegalStateException: Value strength was already set to WEAK
    	at com.github.benmanes.caffeine.cache.Caffeine.requireState(Caffeine.java:201)
    	at com.github.benmanes.caffeine.cache.Caffeine.softValues(Caffeine.java:572)
    	at com.veezean.skills.cache.caffeine.CaffeineCacheService.main(CaffeineCacheService.java:297)
    

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

å°ç»“å›é¡¾
----

å¥½å•¦ï¼Œå…³äº`Caffeine Cache`çš„**æ•°æ®æ·˜æ±°é©±é€ç­–ç•¥**çš„å®ç°åŸç†ä¸ä½¿ç”¨æ–¹å¼çš„é˜è¿°ï¼Œå°±ä»‹ç»åˆ°è¿™é‡Œäº†ã€‚è‡³æ­¤å‘¢ï¼Œå…³äºCaffeineç›¸å…³çš„å†…å®¹å°±å…¨éƒ¨ç»“æŸäº†ï¼Œé€šè¿‡ä¸Caffeineç›¸å…³çš„è¿™ä¸‰ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä»‹ç»å®Œäº†Caffeineçš„æ•´ä½“æƒ…å†µã€ä¸Guava Cacheç›¸æ¯”çš„æ”¹è¿›ç‚¹ã€Caffeineçš„é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä»¥åŠCaffeineåœ¨æ•°æ®å›æºã€æ•°æ®é©±é€ç­‰æ–¹é¢çš„å±•å¼€æ¢è®¨ã€‚å…³äº`Caffeine Cache`ï¼Œä½ æ˜¯å¦æœ‰è‡ªå·±çš„ä¸€äº›æƒ³æ³•ä¸è§è§£å‘¢ï¼Ÿæ¬¢è¿è¯„è®ºåŒºä¸€èµ·äº¤æµä¸‹ï¼ŒæœŸå¾…å’Œå„ä½å°ä¼™ä¼´ä»¬ä¸€èµ·åˆ‡ç£‹ã€å…±åŒæˆé•¿ã€‚

> è¯´èµ·JAVAçš„æœ¬åœ°ç¼“å­˜ï¼Œé™¤äº†æ­¤å‰æåŠçš„Guava Cacheå’Œè¿™é‡Œä»‹ç»çš„Caffeineï¼Œè¿˜æœ‰ä¸€ä¸ªåŒæ ·æ— æ³•è¢«å¿½è§†çš„å­˜åœ¨ â€”â€” Ehcacheï¼ä½œä¸ºè¢«Hibernateé€‰ä¸­çš„é»˜è®¤ç¼“å­˜å®ç°æ¡†æ¶ï¼Œå®ƒç©¶ç«Ÿæœ‰ä»€ä¹ˆé­…åŠ›ï¼Ÿå®ƒä¸Caffeineåˆæœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿæ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°±ä¸€èµ·æ¥è®¤è¯†ä¸‹Ehcacheï¼Œå°è¯•æ‰¾å¯»å‡ºç­”æ¡ˆã€‚

ğŸ“£ **è¡¥å……è¯´æ˜1** ï¼š

> æœ¬æ–‡å±äºã€Š[æ·±å…¥ç†è§£ç¼“å­˜åŸç†ä¸å®æˆ˜è®¾è®¡](https://juejin.cn/column/7140852038258147358)ã€‹ç³»åˆ—ä¸“æ çš„å†…å®¹ä¹‹ä¸€ã€‚è¯¥ä¸“æ å›´ç»•ç¼“å­˜è¿™ä¸ªå®å¤§å‘½é¢˜è¿›è¡Œå±•å¼€é˜è¿°ï¼Œå…¨æ–¹ä½ã€ç³»ç»Ÿæ€§åœ°æ·±åº¦å‰–æå„ç§ç¼“å­˜å®ç°ç­–ç•¥ä¸åŸç†ã€ä»¥åŠç¼“å­˜çš„å„ç§ç”¨æ³•ã€å„ç§é—®é¢˜åº”å¯¹ç­–ç•¥ï¼Œå¹¶ä¸€èµ·æ¢è®¨ä¸‹ç¼“å­˜è®¾è®¡çš„å“²å­¦ã€‚
> 
> å¦‚æœæœ‰å…´è¶£ï¼Œä¹Ÿæ¬¢è¿å…³æ³¨æ­¤ä¸“æ ã€‚

ğŸ“£ **è¡¥å……è¯´æ˜2** ï¼š

*   å…³äºæœ¬æ–‡ä¸­æ¶‰åŠçš„**æ¼”ç¤ºä»£ç **çš„å®Œæ•´ç¤ºä¾‹ï¼Œæˆ‘å·²ç»æ•´ç†å¹¶æäº¤åˆ°githubä¸­ï¼Œå¦‚æœæ‚¨æœ‰éœ€è¦ï¼Œå¯ä»¥è‡ªå–ï¼š[https://github.com/veezean/JavaBasicSkills](https://github.com/veezean/JavaBasicSkills)

![](https://pics.codingcoder.cn/pics/202207102124124.gif)

**æˆ‘æ˜¯æ‚Ÿé“ï¼ŒèŠæŠ€æœ¯ã€åˆä¸ä»…ä»…èŠæŠ€æœ¯~**

å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œè¯·**ç‚¹èµ + å…³æ³¨**è®©æˆ‘æ„Ÿå—åˆ°æ‚¨çš„æ”¯æŒã€‚ä¹Ÿå¯ä»¥å…³æ³¨ä¸‹æˆ‘çš„å…¬ä¼—å·ã€æ¶æ„æ‚Ÿé“ã€‘ï¼Œè·å–æ›´åŠæ—¶çš„æ›´æ–°ã€‚

æœŸå¾…ä¸ä½ ä¸€èµ·æ¢è®¨ï¼Œä¸€èµ·æˆé•¿ä¸ºæ›´å¥½çš„è‡ªå·±ã€‚

![](https://pics.codingcoder.cn/pics/202207091317876.png)

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š[æ¶æ„æ‚Ÿé“](https://www.cnblogs.com/softwarearch/)ï¼Œæ¬¢è¿å…³æ³¨å…¬ä¼—å·\[æ¶æ„æ‚Ÿé“\]æŒç»­è·å–æ›´å¤šå¹²è´§ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/softwarearch/p/16927947.html](https://www.cnblogs.com/softwarearch/p/16927947.html)