---
layout: post
title: "Vuexæé€Ÿå…¥é—¨"
date: "2022-12-14T08:21:47.140Z"
---
Vuexæé€Ÿå…¥é—¨
========

![Vuexæé€Ÿå…¥é—¨](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119185851204-602572957.png) Vuexå°±æ˜¯é¢å‘Vueçš„çŠ¶æ€ç®¡ç†ç»„ä»¶ï¼Œé‡‡ç”¨é›†ä¸­å¼å­˜å‚¨+ç®¡ç†åº”ç”¨çš„æ‰€æœ‰å…±äº«çŠ¶æ€ã€‚ç›®çš„æ˜¯è§£å†³å¤æ‚ç³»ç»Ÿä¸­ä¸åŒæ¨¡å—ã€çˆ¶å­æ¨¡å—ä¹‹é—´çš„é€šä¿¡é—®é¢˜ã€‚

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119185924135-1147197796.png)

01ã€ä»€ä¹ˆæ˜¯Vuexï¼Ÿ
===========

1.1ã€ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†ï¼Ÿ
--------------

åœ¨å¤æ‚çš„ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠç³»ç»ŸæŒ‰ç…§ä¸šåŠ¡é€»è¾‘æ‹†åˆ†ä¸ºå¤šä¸ªå±‚æ¬¡ã€å¤šä¸ªæ¨¡å—ï¼Œé‡‡ç”¨ç»„ä»¶å¼çš„å¼€å‘æ–¹å¼ã€‚è€Œæ­¤æ—¶ä¸åŒæ¨¡å—ã€çˆ¶å­æ¨¡å—ä¹‹é—´çš„é€šä¿¡å°±æˆäº†ä¸€ä¸ªé—®é¢˜ã€‚

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119185923960-1681952687.png)

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æœ‰äº†**çŠ¶æ€ç®¡ç†**ï¼Œæ ¸å¿ƒæ¦‚å¿µå°±æ˜¯æŠŠå¤§å®¶å…±äº«çš„çŠ¶æ€ï¼ˆæ•°æ®ï¼‰æŠ½å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªå…¨å±€å…±äº«çš„ä»“åº“é‡Œï¼ŒæŒ‰ç…§ä¸€å®šçº¦å®š**ç»Ÿä¸€ç®¡ç†**ï¼Œè®©çŠ¶æ€çš„å˜åŒ–å¯é¢„æµ‹ã€‚è¿™å°±æœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š

*   **ç»Ÿä¸€å­˜å‚¨**ï¼šå…±äº«çš„çŠ¶æ€ç»Ÿä¸€å­˜å‚¨ï¼Œå…¨å±€å…±äº«ã€‚
*   **å¯é¢„æµ‹**ï¼šå…±äº«çš„çŠ¶æ€ä¸å¯éšæ„ä¿®æ”¹ï¼Œéœ€è¦æŒ‰ç…§çº¦å®šçš„è§„åˆ™ä¿®æ”¹ï¼Œæ‰èƒ½ç›‘æµ‹çŠ¶æ€å˜æ›´ã€é€šçŸ¥æ›´æ–°ã€‚

1.2ã€Vuexç®€ä»‹
----------

**Vuex** å°±æ˜¯é¢å‘Vueçš„çŠ¶æ€ç®¡ç†ç»„ä»¶ï¼Œé‡‡ç”¨é›†ä¸­å¼å­˜å‚¨+ç®¡ç†åº”ç”¨çš„æ‰€æœ‰å…±äº«çŠ¶æ€ã€‚Vuexåªèƒ½åœ¨Vueä¸­ä½¿ç”¨ï¼Œæ·±åº¦ä½¿ç”¨äº†Vueçš„èƒ½åŠ›ï¼Œå¦‚ç”¨Vueæ¥å®ç°`state`çš„å“åº”å¼ç‰¹æ€§ã€‚

*   `Vue2.*` ç‰ˆæœ¬ â–¶ å¯¹åº” `Vuex3.*` ç‰ˆæœ¬ï¼Œ[Vuex3.\* ä¸­æ–‡æ–‡æ¡£](https://v3.vuex.vuejs.org/zh/)
*   `Vue3.*` ç‰ˆæœ¬ â–¶ å¯¹åº” `Vuex4.*` ç‰ˆæœ¬ï¼Œ[Vuex4.\* ä¸­æ–‡æ–‡æ¡£](https://vuex.vuejs.org/zh/)

ç®€å•æ¥è¯´ï¼Œå°±æ˜¯Vuexæœ‰ä¸€ä¸ªå…¨å±€å…¬å…±çš„`store`ï¼ˆç±»ä¼¼Vueé‡Œçš„`data`ï¼‰ï¼Œä½œä¸ºå…¬å…±æ•°æ®ä»“åº“ï¼Œä¿å­˜äº†å¤§å®¶å…±äº«çš„çŠ¶æ€ï¼ˆæ•°æ®ï¼‰ã€‚è¿™ä¸ªæ•°æ®ä»“åº“`store`å®ç°äº†æ•°æ®å“åº”ã€è‡ªåŠ¨é€šçŸ¥æ›´æ–°ï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“å®ç°äº†å„ä¸ªç»„ä»¶é—´çš„æ•°æ®é€šä¿¡äº†ã€‚

å…¶å®ï¼Œå¯¹äºç®€å•çš„åº”ç”¨ä¸ä¸€å®šéœ€è¦Vuexï¼Œä¸è¿‡Vuexæ–‡ä»¶å¹¶ä¸å¤§ï¼ˆgzipå‹ç¼©å10Kå·¦å³ï¼‰ã€‚

![image](https://img2023.cnblogs.com/blog/151257/202212/151257-20221214104335365-652123579.png)

Vuexä¸»è¦ç‰¹ç‚¹å°±æ˜¯ï¼šå•å‘æ•°æ®æµ+å•ä¸€æ•°æ®æºã€‚

*   **state**ï¼šå­˜å‚¨æ•°æ®ä»“åº“ï¼Œç±»ä¼¼Vueçš„`data`ï¼Œä¹Ÿæ˜¯å“åº”å¼çš„ï¼Œå˜æ›´åä¼šè‡ªåŠ¨é€šçŸ¥Viewã€‚
*   **views**ï¼šç»„ä»¶è§†å›¾ï¼Œå°±æ˜¯ä½¿ç”¨`state`çš„Vueç»„ä»¶ã€‚
*   **actions**ï¼šæ›´æ–°stateçŠ¶æ€ï¼Œä¸ºäº†è§„èŒƒç®¡ç†ï¼Œstateä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œå¿…é¡»é€šè¿‡`action`è¿›è¡Œæäº¤ã€‚Vuexä¸­åˆ†ä¸ºåŒæ­¥Mutationã€å’Œå¼‚æ­¥Actionã€‚

* * *

02ã€å®‰è£…ä½¿ç”¨
=======

*   é€šè¿‡`<script>`æ ‡ç­¾ç›´æ¥å¼•ç”¨`vuex.js`ï¼š

    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/vuex@3/dist/vuex.js"></script>
    // æ³¨å†Œæ’ä»¶
    Vue.use(Vuex);
    

*   é€šè¿‡ `vue-cli` è„šæ‰‹æ¶æ­å»ºvueçš„å¼€å‘æ¡†æ¶ï¼Œé›†æˆäº†vuexç»„ä»¶ã€‚
*   æ³¨å†Œæ’ä»¶ï¼š`Vue.use(Vuex)`

> è°ƒè¯•å·²ç»è¢«é›†æˆåœ¨äº†Vueçš„è°ƒè¯•å·¥å…·**Devtools**ä¸­äº†ã€‚

* * *

03ã€Vuex3å…¥é—¨
==========

3.1ã€Vuexé€‰é¡¹&å®ä¾‹
-------------

**Storeæ„é€ å™¨é€‰é¡¹**

**æè¿°**

**state**

Vuex store å®ä¾‹çš„æ ¹ state å¯¹è±¡

**mutations**

æ³¨å†Œ **mutation**ï¼Œå°±æ˜¯ä¿®æ”¹æ•°æ®çš„æ–¹æ³•ï¼Œå‚æ•°ä¸º`state`ã€‚ä¸æ”¯æŒå¼‚æ­¥ï¼Œé€šè¿‡`store.commit(name)`è°ƒç”¨

**actions**

æ³¨å†Œ **action**ï¼Œå‚æ•°ä¸º`context`ï¼ŒåŒ`store`å®ä¾‹ï¼Œä½†ä¸æ˜¯å¥¹ã€‚**æ”¯æŒå¼‚æ­¥**ï¼Œé€šè¿‡`store.dispatch(name)`è°ƒç”¨

**getters**

æ³¨å†Œ **getter**ï¼Œ`{ [key: string]: Function }`ï¼Œå‚æ•°ä¸º`state`ï¼Œå®šä¹‰ã€ä½¿ç”¨åŒè®¡ç®—å±æ€§

**modules**

å­æ¨¡å—çš„å¯¹è±¡ï¼Œåˆ†å‰²ç®¡ç†storeï¼Œ{ **key**(moduleName) : {state, namespaced?, mutations?, actions? ... }}

strict

æ˜¯å¦ä¸¥æ ¼æ¨¡å¼ï¼Œé»˜è®¤falseï¼Œtrue=ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä»»ä½• mutation å¤„ç†å‡½æ•°ä»¥å¤–ä¿®æ”¹state éƒ½ä¼šæŠ›å‡ºé”™è¯¯ã€‚

  

**âœ…storeå®ä¾‹å±æ€§**

**æè¿°**

**state**

æ•°æ®æº`state`æ ¹å¯¹è±¡

**getters**

æ‰€æœ‰æ³¨å†Œçš„`getter`

**âœ…store å®ä¾‹æ–¹æ³•**

  

**commit**(name, arg?, options?)

æäº¤ `mutation` æ‰§è¡Œç”³è¯·ï¼Œ`name`ä¸º`mutation`æ³¨å†Œçš„æ–¹æ³•å

**dispatch**(name, arg?, options?)

æäº¤ `action` æ‰§è¡Œç”³è¯·ï¼Œ`name`ä¸º`action`æ³¨å†Œçš„æ–¹æ³•å

**replaceState**(state: Object)

æ›¿æ¢ `store` çš„æ ¹çŠ¶æ€ï¼Œç”¨äºåˆå¹¶çŠ¶æ€ï¼Œå¦‚åŠ è½½æŒä¹…åŒ–çš„`state`æ•°æ®ã€‚

watch(fn, callback)

å“åº”å¼åœ°ä¾¦å¬ fn çš„è¿”å›å€¼ï¼Œå½“å€¼æ”¹å˜æ—¶è°ƒç”¨å›è°ƒå‡½æ•°

subscribe(handler, option?)

è®¢é˜… store çš„ mutationï¼Œæ¯ä¸€ä¸ªmutationæ‰§è¡Œå®Œè°ƒç”¨

subscribeAction(handler, option?)

è®¢é˜… store çš„ action

registerModule(path, module)

æ³¨å†Œä¸€ä¸ªåŠ¨æ€æ¨¡å—

unregisterModule(path)

å¸è½½ä¸€ä¸ªåŠ¨æ€æ¨¡å—

hasModule(path)

æ£€æŸ¥æ¨¡å—æ˜¯å¦ä»¥æ³¨å†Œ

hotUpdate(newOptions: Object)

çƒ­æ›¿æ¢æ–°çš„ action å’Œ mutation

    const store = new Vuex.Store({
        strict:false,
        state: {  //å®šä¹‰æ•°æ®ç»“æ„-æ•°æ®ä»“åº“
            points: 1000,
            user: { id: '001', name: 'sam' }
        },
        mutations: {  //ä¿®æ”¹æ•°æ®çš„æ–¹æ³•
            setUser(state, obj) {
                state.user.id = obj.uid;
                state.user.name = obj.uname;
            },
        },
        actions: {  //ä¿®æ”¹æ•°æ®çš„æ–¹æ³•-å¼‚æ­¥
            set(context, obj) { context.commit('setUser', obj) }
        },
        getters: {  //è·å–æ•°æ®çš„è®¡ç®—å±æ€§
            userExist(state) { return state.user.id != ''; }
        }
    })
    //æäº¤æ•°æ®ä¿®æ”¹
    store.commit('setUser',{uid:'007',uname:'zhangsan'});
    console.log(store.state.user); //id : "007" name : "zhangsan"
    console.log(store.getters.userExist); //true
    

3.2ã€Vuexæ ¸å¿ƒæµç¨‹
------------

**Vuexæ ¸å¿ƒæ¦‚å¿µ**ï¼š

*   **ğŸ”¹Store å•ä¸€çŠ¶æ€æ ‘**ï¼šä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªStoreå®ä¾‹ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰ï¼ŒStoreåŒ…å«äº†`state`ã€`actions`ã€`mutations`ã€`getter`ã€`modules`ã€‚ä¸€èˆ¬ä¼šåœ¨æ ¹Vueæ³¨å†Œ`store`å®ä¾‹ï¼Œè¿™æ ·ç»„ä»¶å†…æ‰€æœ‰åœ°æ–¹éƒ½å¯ä»¥ `this.$store` è®¿é—®äº†ã€‚
*   **ğŸ”¸State æ•°æ®æº**ï¼šå®ç°äº†å“åº”å¼ç›‘å¬ï¼Œå¯ç”¨`mapState`è¾…åŠ©å‡½æ•°åŒ…è£…ä¸ºè®¡ç®—å±æ€§è®¿é—®ã€‚
*   **ğŸ”¹Getter è®¿é—®å±æ€§**ï¼šè¿”å›å¯¹`state`çŠ¶æ€æ•°æ®è¿›è¡ŒåŠ å·¥åçš„ç»“æœï¼Œç±»ä¼¼Vueä¸­çš„è®¡ç®—å±æ€§ã€è¿‡æ»¤å™¨ï¼ŒåŒºåˆ«å°±æ˜¯è¿™æ˜¯å…¨å±€å…±äº«çš„ã€‚
*   **ğŸ”¸Mutation ä¿®æ”¹æ•°æ®**ï¼šVuexä¸­ç”¨äºä¿®æ”¹çŠ¶æ€æ•°æ®çš„ä¸»è¦æ–¹å¼ï¼Œæ˜¯å”¯ä¸€ä¿®æ”¹`state`æ•°æ®çš„åˆç†é€”å¾„äº†ã€‚é€šè¿‡`store.commit()` è°ƒç”¨`mutation`ã€‚ï¼ˆmutation /mjuËËˆteÉªÊƒ(É™)n/ æ”¹å˜ï¼‰
*   **ğŸ”¹Action å¼‚æ­¥æ“ä½œ**ï¼šç±»ä¼¼Vueçš„`methods`ï¼Œæ”¯æŒå¼‚æ­¥æ“ä½œã€‚é€šè¿‡`store.dispatch()`è°ƒç”¨ï¼Œå®é™…ä¿®æ”¹æ•°æ®ä¹Ÿæ˜¯è¦è°ƒç”¨`mutation`çš„ã€‚Action å¯ç”¨æ¥å‘èµ·å¼‚æ­¥ajaxè¯·æ±‚è·å–å¤„ç† stateçš„æ•°æ®ï¼Œè¿™æ˜¯å’Œmutationæœ€å¤§çš„ä¸åŒäº†ã€‚
*   **ğŸ”¹Module æ¨¡å—**ï¼šå½“Storeå¾ˆå¤æ‚æ—¶ï¼Œç”¨Moduleæ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡å—ç®¡ç†ï¼Œæ¯ä¸ªæ¨¡å—é‡Œæœ‰è‡ªå·±çš„`state`ã€`actions`ã€`mutations`ã€`getter`ã€`modules`ã€‚

![image](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119190338810-30140375.png)

**ğŸ”¸åŸºæœ¬æµç¨‹**ï¼š

â¶ **å®šä¹‰æ•°æ® state**ï¼Œå’Œdataä¸€æ ·ï¼Œé¢„å…ˆå®šä¹‰å¥½æ•°æ®ç»“æ„ï¼Œä»¥åŠæ•°æ®æ›´æ–°çš„`mutation`æ–¹æ³•ã€‚

â· **ä½¿ç”¨æ•°æ® state**

*   åœ¨æ ¹ç»„ä»¶æ³¨å…¥`store`å®ä¾‹ï¼Œç»„ä»¶å†…æ‰€æœ‰åœ°æ–¹ï¼ˆåŒ…æ‹¬åä»£ç»„ä»¶ï¼‰éƒ½å¯ä»¥ `this.$store` è®¿é—®äº†ã€‚
*   é€šè¿‡è®¡ç®—å±æ€§`computed`åŒ…è£…æ‰€éœ€çš„ `state`æ•°æ®ã€‚å¦‚æœ`state`æ•°æ®éœ€è¦åŒå‘ç»‘å®šåˆ°è¡¨å•å…ƒç´ ï¼Œåˆ™éœ€è¦ç”¨è®¡ç®—å±æ€§å®ç°getã€setæ¥ä»£ç†å®ç°ã€‚
*   é€šè¿‡æ–¹æ³•`methods`åŒ…è£…æ•°æ®çš„æ›´æ–°`store.mutation`ã€‚
*   åœ¨`View`ä¸Šç»‘å®šä½¿ç”¨ï¼Œå¯ä»¥ç»‘å®šåŒ…è£…åçš„è®¡ç®—å±æ€§ã€æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç»‘å®šæ³¨å…¥çš„`$store`ã€‚

â¸ è§¦å‘æ›´æ–°ï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦æ›´æ–°stateæ•°æ®ã€‚

*   store.**commit**(name, arg?, options?)
*   store.**dispatch**(name, arg?, options?)

â¹ æ­£å¼ä¿®æ”¹`state`æ•°æ®ï¼Œå¹¶è§¦å‘ View è‡ªåŠ¨æ›´æ–°ã€‚

    <div id="app">
        <button @click="login">ç™»å½•</button>
        <p>ç”¨æˆ·ï¼š{{$store.state.user.name}}({{$store.state.user.id}})</p>
        <p v-text="`ç”¨æˆ·ï¼š${$store.state.user.name}ï¼ˆ${$store.state.user.id}ï¼‰`"></p>
    </div>
    <script>
        // æ³¨å†Œæ’ä»¶
        Vue.use(Vuex);
        //ç”³æ˜å…¨å±€store
        const store = new Vuex.Store({
            state: { user: { id: '', name: '' } },
            mutations: { setUser(state, obj) { state.user.id = obj.uid; state.user.name = obj.uname; }, },
            getters: { userExist(state) { return state.user.id != ''; } }
        })
        //æ ¹Vue 
        let app = new Vue({
            el: '#app',
            data: {},
            store: store, Â //åœ¨æ ¹ç»„ä»¶æ³¨å…¥storeå®ä¾‹ï¼Œç»„ä»¶å†…æ‰€æœ‰åœ°æ–¹éƒ½å¯ä»¥ this.$store é€šè¿‡è®¿é—®äº†
            methods: {
                login() { this.$store.commit('setUser',{ uid: '007', uname: 'zhangsan' }) }
            }
        })
    </script>
    

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119185924040-896033461.png)

3.3ã€åˆ›å»º**Vuex()-**è´­ç‰©è½¦æ¡ˆä¾‹
----------------------

1.  æ³¨å†Œæ’ä»¶ï¼š`Vue.use(Vuex)`
2.  åˆ›å»ºå…¨å±€å…±äº«çš„`Store`å®ä¾‹ï¼Œå¹¶é…ç½®æ•°æ®ã€æ–¹æ³•ã€‚
3.  æ³¨å…¥`store`ï¼Œåœ¨æ ¹Vueç»„ä»¶ä¸Šæ³¨å…¥storeå®ä¾‹ã€‚
4.  æ„‰å¿«çš„ä½¿ç”¨äº†ã€‚

    <script>
        // æ³¨å†Œæ’ä»¶
        Vue.use(Vuex);
        //ç”³æ˜å…¨å±€store
        const store = new Vuex.Store({
            state: { cart: ['æ±½è½¦01', 'è‹¹æœ', 'æ¢¨å­'] },
            mutations: {
                add(state, item) { state.cart.push(item); },
                delete(state, index) { state.cart.splice(index,1) }
            },
            actions: { add(context, item) { context.commit('add', item) } },
            getters: { cartTotal(state) { return state.cart.length; } }
        })
    </script>
    
    <div id="app1">
        <p>è´­ç‰©è½¦ï¼ˆ{{this.$store.getters.cartTotal}}ï¼‰ï¼ˆç›´æ¥ç»‘å®šï¼‰</p>	
        <p>è´­ç‰©è½¦ï¼ˆ{{cartTotal}}ï¼‰ <button @click="add">æ·»åŠ å•†å“</button></p>
        <cart-box></cart-box>
    </div>
    <template id="cardBoxTemplate">  <!--è´­ç‰©åˆ—è¡¨æ¨¡æ¿-->
        <ul>
            <li v-for="(item,index) in cartList">{{item}} <button v-on:click="deleteItem(index)">åˆ é™¤</button></li>
        </ul>
    </template>
    <script>
        let app1 = new Vue({
            el: "#app1",
            data: {},
            store: store,  //åœ¨æ ¹ç»„ä»¶æ³¨å…¥storeå®ä¾‹ï¼Œç»„ä»¶å†…æ‰€æœ‰åœ°æ–¹éƒ½å¯ä»¥ this.$store è®¿é—®äº†
            computed: {
                cartTotal: function () { return this.$store.getters.cartTotal; }
            },
            methods: { add: function (item) { this.$store.dispatch('add', "è¥¿ç“œ") } },
            components: {  //è´­ç‰©è½¦ç»„ä»¶
                'cart-box': {
                    computed: { cartList() { return this.$store.state.cart; } },
                    template: '#cardBoxTemplate',
                    methods: { deleteItem: function (index) { this.$store.commit("delete", index); } }
                }
            }
        })
    </script>
    

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119185924026-1625720004.png)

3.4ã€...mapStateè¯­æ³•ç³–
------------------

`mpaState`æ˜¯`state`çš„ä¸€ç§Vuexæä¾›çš„ â€œè¯­æ³•ç³–â€ï¼Œä¸»è¦ä½œç”¨æ˜¯ç®€åŒ–ä»£ç ã€‚æ¯”å¦‚å½“`state`æœ‰å¤šä¸ªçŠ¶æ€å±æ€§ï¼Œåœ¨ç»„ä»¶ä¸­éƒ½è¦ç”¨å°±å¾—ä¸€ä¸ªä¸€ä¸ªåŒ…è£…ï¼Œä»£ç å†—ä½™ã€‚è¿™æ—¶ï¼Œ`mapState`å°±å¯ä»¥ç®€åŒ–è¿™ä¸ªé‡å¤ã€æ— èŠçš„ä»£ç äº†ã€‚

    <script>
        let app1 = new Vue({
        el: "#app1",
        data: {},
        store: store,
    
        computed: {  //åšä¸€ä¸ªç®€å•åŒ…è£…ï¼Œä½¿ç”¨æ—¶æ›´æ–¹ä¾¿
            card() { return $store.state.card; },
            user() { return $store.state.user; }
        },
        computed: Vuex.mapState(['card', 'user']), //ç›´æ¥èµ‹å€¼ï¼Œæ•ˆæœåŒä¸Šï¼Œç®€åŒ–äº†åŒ…è£…ä»£ç†ä»£ç 
        computed: {
            cartTotal: function () { return this.$store.getters.cartTotal; },
            //å±•å¼€è¿ç®—ç¬¦å±•å¼€
            ...Vuex.mapState({
                'cart': 'cart',  //è®¡ç®—å±æ€§åç§°ï¼šstateçŠ¶æ€åç§°
                currentUserId: 'user',
            }),
            ...Vuex.mapState(['cart', 'user'])  //æ›´ç®€æ´çš„å†™æ³•
        },
    })
    </script>
    

*   **mpaState()** æ˜¯Vuexæä¾›ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå¸®åŠ©ç”Ÿæˆè®¡ç®—å±æ€§ã€‚è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆç»“æ„åŒè®¡ç®—å±æ€§`computed`ï¼‰ã€‚

`mapState(namespace?: string, map: Array<string> | Object<string | function>): Object`

*   **...mapState**ï¼Œä¸‰ä¸ªç‚¹`...`æ˜¯ES6çš„å±•å¼€è¿ç®—ç¬¦ï¼ŒæŠŠå¯¹è±¡å±•å¼€æ··å…¥å½“å‰ç¯å¢ƒã€‚

> å…¶ä»–è¿˜æœ‰ mapGettersã€mapActionsã€mapMutations éƒ½æ˜¯ç±»ä¼¼ä½œç”¨å’Œç”¨æ³•ã€‚

3.5ã€Moduleæ¨¡å—åŒ–
-------------

å½“å…±äº«çš„æ•°æ®å’Œæ“ä½œå¤ªå¤šæ—¶ï¼Œå°±éœ€è¦åˆ†æ¨¡å—ç®¡ç†äº†ï¼Œå¦‚ä¸‹æ¨¡å—ç¤ºä¾‹ã€‚

    const moduleA = {
        state: { ... },
        mutations: { ... },
        actions: { ... },
        getters: { ... }
    }
    
    const moduleB = {
        state: { ... },
        mutations: { ... },
        actions: { ... }
    }
    
    const store = new Vuex.Store({
        modules: {
            a: moduleA,
            b: moduleB
        }
    })
    
    store.state.a // -> moduleA çš„çŠ¶æ€
    store.state.b // -> moduleB çš„çŠ¶æ€
    

æ¯ä¸ªæ¨¡å— [**module**](https://v3.vuex.vuejs.org/zh/guide/modules.html) éƒ½åŒ…å«å®Œæ•´çš„`store`ç»“æ„ã€‚

> **moduleå®šä¹‰ç»“æ„**ï¼š`{ key(moduleName) : {state, namespaced?, mutations?, actions?, getters? modules? }}`

*   **key**ï¼šå°±æ˜¯æ¨¡å—çš„åç§°ï¼Œä¹Ÿæ˜¯æ¨¡å—çš„å‘½åç©ºé—´ã€‚
*   **value**ï¼Œå°±æ˜¯ä¸€ä¸ªå’Œ`store`ç»“æ„ç›¸åŒçš„å¯¹è±¡ï¼Œå­˜æ”¾æ¨¡å—çš„`store`ä¿¡æ¯ã€‚æ¨¡å—é‡Œæ–¹æ³•çš„å‚æ•°`state`ã€`context`éƒ½æ˜¯å‘½åç©ºé—´å†…çš„å±€éƒ¨å¯¹è±¡ã€‚

æ¨¡å—åŒ–çš„é¡¹ç›®ç»“æ„ï¼š

    â”œâ”€â”€ index.html
    â”œâ”€â”€ main.js
    â”œâ”€â”€ api
    â”‚   â””â”€â”€ ... # æŠ½å–å‡ºAPIè¯·æ±‚
    â”œâ”€â”€ components
    â”‚   â”œâ”€â”€ App.vue
    â”‚   â””â”€â”€ ...
    â””â”€â”€ store
        â”œâ”€â”€ index.js          # æˆ‘ä»¬ç»„è£…æ¨¡å—å¹¶å¯¼å‡º store çš„åœ°æ–¹
        â”œâ”€â”€ actions.js        # æ ¹çº§åˆ«çš„ action
        â”œâ”€â”€ mutations.js      # æ ¹çº§åˆ«çš„ mutation
        â””â”€â”€ modules
            â”œâ”€â”€ cart.js       # è´­ç‰©è½¦æ¨¡å—
            â””â”€â”€ products.js   # äº§å“æ¨¡å—
    

* * *

04ã€Vuex4åŒºåˆ«
==========

å‡ ä¹æ‰€æœ‰çš„ `Vuex 4` API éƒ½ä¸ `Vuex 3` ä¿æŒä¸å˜ï¼Œæœ‰å°‘é‡å·®å¼‚ã€‚

*   åˆ›å»ºæ–¹å¼ä¸åŒï¼ŒVuex4 ä½¿ç”¨ `createStore({})` å‡½æ•°åˆ›å»º`store`å¯¹è±¡ï¼Œä¹‹å‰çš„æ–¹å¼ä¾ç„¶æ”¯æŒã€‚
*   å®‰è£…æ–¹å¼ï¼Œ`app.use(store)`ï¼Œå·²ç»æ³¨å…¥äº†`store`å®ä¾‹ï¼Œä¸ç”¨å†æ³¨å†Œ`store`å®ä¾‹äº†ã€‚
*   æ‰“åŒ…äº§ç‰©å·²ç»ä¸ Vue 3 é…å¥—ã€‚
*   æ–°ç‰¹æ€§ï¼š`useStore`ç»„åˆå¼å‡½æ•°ã€‚//TODO

* * *

05ã€ä¸€äº›é—®é¢˜
=======

â“Vuexçš„æŒä¹…åŒ–ï¼Ÿ
----------

å¦‚æœç”¨æˆ·åˆ·æ–°é¡µé¢ï¼Œå¯¼è‡´é¡µé¢çš„å„ç§å®ä¾‹é‡æ–°åˆå§‹åŒ–ï¼Œä¹‹å‰çš„å…¨å±€çŠ¶æ€å°±ä¼šä¸¢å¤±ã€‚è§£å†³æ–¹æ³•å°±æ˜¯æŠŠ`state`æ•°æ®ä»“åº“å­˜èµ·æ¥ï¼Œå½“åˆ·æ–°é¡µé¢çš„æ—¶å€™è¯»å–å‡ºæ¥ï¼Œå¦‚æœå…³é—­é¡µé¢å°±ä¸ç”¨ç®¡äº†ã€‚

1.  **æŒä¹…åŒ–**`state`ï¼šåœ¨é¡µé¢åˆ·æ–°æ—¶çš„ `beforeunload`äº‹ä»¶ä¸­ä¿å­˜`state`åˆ°`sessionStorage`é‡Œã€‚`sessionStorage`åˆ·æ–°é¡µé¢ä¸ä¼šä¸¢å¤±ï¼Œå…³é—­æ‰æ¸…é™¤ã€‚
2.  **åŠ è½½**`state`ï¼šVue `create`ä¸­åŠ è½½æŒä¹…åŒ–çš„stateï¼Œå¹¶æ¸…é™¤æŒä¹…åŒ–çš„`state`æ•°æ®ã€‚

    created: function () {
        window.addEventListener('beforeunload', () => {
            sessionStorage.setItem('vstore', JSON.stringify(this.$store.state));
        });
        try {
            const vstore = sessionStorage.getItem('vstore')
            if (vstore)
                this.$store.replaceState(Object.assign({}, this.$store.state, JSON.parse(vstore)));
        }
        catch (ex) { console.log(ex) }
        sessionStorage.removeItem('vstore');
    }
    

* * *

> **Â©ï¸ç‰ˆæƒç”³æ˜**ï¼šç‰ˆæƒæ‰€æœ‰@å®‰æœ¨å¤•ï¼Œæœ¬æ–‡å†…å®¹ä»…ä¾›å­¦ä¹ ï¼Œæ¬¢è¿æŒ‡æ­£ã€äº¤æµï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼[_åŸæ–‡ç¼–è¾‘åœ°å€-è¯­é›€_](https://www.yuque.com/kanding/ktech/otll9x)