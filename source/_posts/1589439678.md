---
layout: post
title: "明解STM32—GPIO理论基础知识篇之八种工作模式"
date: "2023-03-10T01:17:47.758Z"
---
明解STM32—GPIO理论基础知识篇之八种工作模式
==========================

![明解STM32—GPIO理论基础知识篇之八种工作模式](https://img2023.cnblogs.com/blog/2999540/202303/2999540-20230309212151592-994165777.png) 详细介绍STM32 GPIO所有工作模式的运行原理

一、引言
====

        在之前围绕STM32的GPIO的基本结构进行了介绍，图1为STM32的5V容忍的GPIO口内部基本结构图，图2为GPIO的基本结构中各个模块部分的概述。

        阅读GPIO基本结构的内容能够对GPIO的工作模式有更深的了解。正是由于GPIO的结构中包含了多样性的电路和模块，因此进行合理的配置组合，就可以使得GPIO应用在不同的工作模式下进行工作。![](https://img-blog.csdnimg.cn/img_convert/14984808cbdb957a74f4b6bda14dc8c2.png)​

![](https://img2023.cnblogs.com/blog/2999540/202303/2999540-20230309211325601-3644147.gif "点击并拖拽以移动")图1 STM32的5V容忍的GPIO内部基本结构

![](https://img2023.cnblogs.com/blog/2999540/202303/2999540-20230309211551494-2082265428.png)

图2 GPIO基本结构包含的功能概述

* * *

**二、工作模式概述**
============

        图3为STM32的GPIO工作模式概述图，从图中可以看出，GPIO端口的静态特征就是指芯片可供你选择的该GPIO的配置，只有通过对使用的GPIO端口进行合理的配置，那么才可以让GPIO处于某一种工作模式下实现合理的动态工作运行。

        下一节我们就结合GPIO的基本结构来对不同工作模式下端口的特征及运行方式进行进一步的分析。

![](https://img2023.cnblogs.com/blog/2999540/202303/2999540-20230309211650405-127128950.png)

图3 GPIO工作模式概述

* * *

**三、工作模式详述**
============

        接下来就对STM32的GPIO总共8种工作模式进行一个详细的介绍。

**（1）、普通IO推挽输出**
----------------

        图4是普通IO推挽输出。普通IO口推挽输出就是，对输出数据寄存器进行置0或置1操作，然后通过输出控制缓冲器对双MOS电路进行控制。IO电平输出的双MOS电路通路同时由PMOS和NMOS组成，当输出控制端输出为1时，上方PMOS导通，下方NMOS截止，电流方向为VDD->PMOS->输出端，对外部引脚输出高电平；当输出控制端输出为0时，上方PMOS截止，下方NMOS导通， 电流方向为VSS->NMOS->输出端，对外输出低电平。此时对输入数据寄存器的读访问可得到I/O状态。

        GPIO配置成输出模式时，可使用上拉、下拉或悬空模式。但此时由于输出模式时引脚电平连接到输出数据寄存器，而输出数据寄存器对应引脚的位为0，即引脚初始化后默认输出低电平，所以在这种情况下，上拉只能起到小幅提高输出电流能力，但不会影响引脚的默认状态。

![](https://img-blog.csdnimg.cn/img_convert/1740e309740aa3a9a832b17e08a234de.png)​图4 普通IO推挽输出

**（2）、普通IO开漏输出**
----------------

        图5是普通IO开漏输出。普通IO开漏输出，就是在输出控制时，不使用双MOS电路中的PMOS，因此无法输出高电平，只有在输出低电平时，NMOS生效。开漏输出时，只有NMOS工作，这样输出数据寄存器可控制I/O输出高阻态或低电平。如果要输出高电平，则需要在芯片内部配置上拉电阻（弱上拉）或者在芯片IO外部连接上拉电阻。此时对输入数据寄存器的读访问可得到I/O状态。

        使用开漏输出时，可以实现以下功能：

        1）提高IO驱动能力。MCU的IO口对外驱动的能力很小，即使使用芯片内部的上拉电阻，由于内部上拉阻值很大，驱动能力也有限。因此使用开漏输出时，可以在IO口外部连接上拉电阻，此时驱动电流芯片由外部上拉电阻电源提供，这样提高驱动和带负载能力。

        2）电平转换。如MCU只能对外输出3.3v，但由于GPIO管脚是5v容忍的，输出高电平可以通过外部电源提供，外部电源如果是5v。此时可以对外输出5v。

        3）线与。多个开漏的引脚可以直接并在一起使用，统一接一个合适的上拉电阻，就可以实现“逻辑与”关系，即当所有引脚均输出高电平时，输出才为高电平，若任一引脚输出低电平，则输出低电平。​

![](https://img2023.cnblogs.com/blog/2999540/202303/2999540-20230309211740666-953589411.png)

图5 普通IO开漏输出

**（3）、复用功能推挽输出**
----------------

        图6是复用功能推挽输出。GPIO不仅仅可以用作普通的 IO 口输出，还可以作为芯片上其他外设的特殊功能引脚，有些引脚可能可以用作多种不同功能，这种就叫做GPIO的复用，具体用作哪种功能，需要根据使用进行相应的配置。使用成复用功能时，GPIO就不会经过输出数据寄存器输出，而是直接通过芯片上的具体外设功能电路输出到输出控制缓冲器。此时通过读输入数据寄存器可获取I/O实际状态，但一般直接用外设的寄存器来获取该数据信号。

        使用GPIO复用功能时，当配置成推挽输出，这样片上外设就可以输出高电平或者低电平，例如将GPIO配置成串口USART输出TXD管脚。

        需要注意的是，如果需要实现DAC模拟输出，那么也需要将管脚配置成复用功能，但是此时作为“模拟输出”功能，DAC的模拟信号输出就不经过双MOS管结构了，在GPIO结构框图的右下角处，模拟信号直接输出到引脚。

        用于复用功能时，可使用上拉、下拉或者浮空模式。在这种情况下，初始化后引脚默认输出低电平，上拉只起到小幅提高输出电流能力，并不会影响引脚的默认状态。

![](https://img-blog.csdnimg.cn/img_convert/7e5e921cc0c0801a50b90a8aeed4f1c2.png)​

图6 复用功能推挽输出

**（4）、复用功能开漏输出**
----------------

        图7是复用功能开漏输出。复用功能开漏输出时，GPIO就不会经过输出数据寄存器输出，而是直接通过芯片上的具体外设功能电路输出到输出控制缓冲器。此时通过读输入数据寄存器可获取I/O实际状态，但一般直接用外设的寄存器来获取该数据信号。

        复用开漏输出的功能和普通IO开漏输出功能一致，因此GPIO用作复用功能管脚如果要输出高电平，则需要在芯片内部配置上拉电阻（弱上拉）或者在芯片IO外部连接上拉电阻。例如将GPIO配置成I2C信号线的时钟管脚SCL和数据管脚SDA。

​

![](https://img2023.cnblogs.com/blog/2999540/202303/2999540-20230309211325601-3644147.gif "点击并拖拽以移动")![](https://img2023.cnblogs.com/blog/2999540/202303/2999540-20230309211820791-1678359295.png)

图7 复用功能开漏输出

**（5）、带上拉输入**
-------------

        图8为GPIO带上拉电阻输入，需要将端口配置为独立的上拉电阻。可以看到，输入路径经过施密特触发器后，当端口配置为普通IO输入时，该输入路径进入到输入数据寄存器，因此就可以通过输入数据寄存器读取IO口的电平状态，例如将IO口连接按键，读取外部按键的电平状态；当端口配置成复用功能时，输入路径会直接连接到芯片上具体的外设中去，例如将端口配置成串口USART，那么该IO口就是串口的接收RXD管脚。

        输入上拉模式下，GPIO端口悬空无输入信号时，输入端的电平可以默认保持在高电平；而当输入信号低电平时，IO口读取的电平就是低电平；当输入信号高电平时，IO口读取的电平自然就是高电平。

![](https://img-blog.csdnimg.cn/img_convert/d41a728e0f9d13889c7dd9ea5bdb4a51.png)​图8 GPIO带上拉输入

**（6）、带下拉输入**
-------------

        图9为GPIO带下拉电阻输入，需要将端口配置为独立的下拉电阻。可以看到，输入路径经过施密特触发器后，当端口配置为普通IO输入时，该输入路径进入到输入数据寄存器，因此就可以通过输入数据寄存器读取IO口的电平状态，例如将IO口连接按键，读取外部按键的电平状态；当端口配置成复用功能时，输入路径会直接连接到芯片上具体的外设中去，例如将端口配置成串口USART，那么该IO口就是串口的接收RXD管脚。

        输入下拉模式下，GPIO端口悬空无输入信号时，输入端的电平可以默认保持在低电平；而当输入信号高电平时，IO口读取的电平就是高电平；当输入信号低电平时，IO口读取的电平自然就是低电平。

![](https://img-blog.csdnimg.cn/img_convert/94613f47baf7b2c52004fa6f73d9b85a.png)​

图9 GPIO带下拉输入

**（7）、浮空输入**
------------

        图10为GPIO浮空输入。输入浮空模式下，指的是该IO口既不配置接上拉电阻也不配置接下拉电阻。如果该引脚悬空的情况无信号输入时，该端口的电平是不确定的。当有电平信号进入IO时，IO电平状态是完全由外部输入决定，MCU复位上电后，默认为浮空输入模式。

![](https://img-blog.csdnimg.cn/img_convert/914fca89575ed77336db5cec8a99b8d7.png)​

图10 GPIO浮空输入

**（8）、模拟输入**
------------

        图11为GPIO模拟输入。当 STM32需要进行 AD( 模数 ) 转换采样时，需要把引脚设置为模拟输入模式，模拟输入模式下，不需要连接上拉和下拉电阻，因为GPIO用于模拟功能时，引脚的上、下拉电阻是不起作用的。这个时候即使在配置了上拉或下拉电阻，也不会影响到模拟信号的输入。

        同时输入信号不再经过TTL施密特触发器，可将外部电压信号直接输入到内部的ADC 外设中去。因为经过施密特触发器后信号只有0、1两种状态，所以ADC外设要采集到原始的、连续变化的模拟信号，信号源输入必须在施密特触发器之前。

        需要注意到的是，由于模拟输入不接上下拉电阻，也不经过输入的TTL施密特触发器，同时不像输出功能需要经过输出控制缓冲器，因此在芯片上少连接了很多器件，当芯片有不用的管脚时，可以考虑配置成模拟输入以节省功耗。

![](https://img-blog.csdnimg.cn/img_convert/ec66e967aa1c194d79c961d25ab2f6c2.png)​

图11 模拟输入

* * *

**四、总结**
========

        本篇在STM32的GPIO的基本结构的基础上，进一步对GPIO的各种工作模式进行介绍，为GPIO选择不同的模式配置就可以让GPIO在实际使用运行过程中扮演不同的角色，在下一篇将继续介绍GPIO基础知识篇之寄存器原理。

* * *

**更多技术内容和书籍资料获取，入群技术交流敬请关注“明解嵌入式”**

**![](https://img2023.cnblogs.com/blog/2999540/202303/2999540-20230309212104154-731261031.png)**

​

本文来自博客园，作者：[Sharemaker](https://www.cnblogs.com/Sharemaker/)，转载请注明原文链接：[https://www.cnblogs.com/Sharemaker/p/17201471.html](https://www.cnblogs.com/Sharemaker/p/17201471.html)