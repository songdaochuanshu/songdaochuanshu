---
layout: post
title: "ä¼ å‚base64æ—¶çš„+å·å˜ç©ºæ ¼é—®é¢˜"
date: "2023-03-26T01:13:35.050Z"
---
ä¼ å‚base64æ—¶çš„+å·å˜ç©ºæ ¼é—®é¢˜
=================

> åŸåˆ›ï¼šæ‰£é’‰æ—¥è®°ï¼ˆå¾®ä¿¡å…¬ä¼—å·IDï¼šcodelogsï¼‰ï¼Œæ¬¢è¿åˆ†äº«ï¼Œéå…¬ä¼—å·è½¬è½½ä¿ç•™æ­¤å£°æ˜ã€‚

### é—®é¢˜å‘ç”Ÿ

ä¸Šä¸Šå‘¨ï¼Œçœ‹åˆ°ä¸€ä½è€å“¥æ‰¾æˆ‘ä»¬ç»„åŒäº‹è”è°ƒæ¥å£ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œä¸¤äººåä¸€èµ·æäº†å¿«1ä¸ªå°æ—¶ï¼Œçœ‹èµ·æ¥å¥½åƒæœ‰ç‚¹å¤æ‚ã€‚

çªç„¶ï¼Œè€å“¥å‘å‡ºä¸€å£°å§æ§½ï¼Œ"æˆ‘ä¼ å‚é‡Œçš„+å·ï¼Œåˆ°ä½ è¿™æ€ä¹ˆå˜æˆäº†ç©ºæ ¼ï¼"ï¼Œè¿™ä¸ªå£°éŸ³å¾ˆå¤§ï¼Œæˆ‘æ˜æ˜¾çš„å¬åˆ°äº†ï¼Œå¾ˆå¿«ï¼Œæˆ‘å°±å¤§æ¦‚Getåˆ°äº†ä»–ä»¬çš„é—®é¢˜ç‚¹ã€‚

æˆ‘çŒœæµ‹ä»–ä»¬é‡åˆ°çš„é—®é¢˜å¤§æ¦‚å¦‚ä¸‹ï¼š

1.  æˆ‘ä»¬çš„æ¥å£åè®®ä¸Šï¼Œéƒ½ä¼šå°†è¯·æ±‚æ•°æ®åšä¸€æ¬¡base64ç¼–ç ï¼Œç„¶åæ”¾åˆ°dataå‚æ•°ä¸Šã€‚
2.  ç„¶åæŸäº›æ•°æ®åšbase64ç¼–ç åæœ‰`+`ï¼Œå¦‚`{"notes":"ä»£ç "}`base64ç¼–ç ä¸º`eyJub3RlcyI6IuS7o+eggSJ9Cg==`ã€‚
3.  ç„¶åç›´æ¥æ‹¼åˆ°dataå‚æ•°ä¸Šï¼Œå³`data=eyJub3RlcyI6IuS7o+eggSJ9Cg==`ï¼Œç»„ç»‡æˆhttpè¯·æ±‚å‘å‡ºã€‚

å¦‚æœå†™æˆç­‰ä»·çš„curlï¼Œå°±æ˜¯è¿™æ ·ï¼š

    $ curl http://localhost:8080/send -d 'data=eyJub3RlcyI6IuS7o+eggSJ9Cg=='
    

å†™ä¸ªæµ‹è¯•æ¥å£è°ƒè¯•ä¸‹çœ‹çœ‹ï¼Œå¦‚ä¸‹ï¼š  
![bug](https://img2023.cnblogs.com/blog/2792815/202303/2792815-20230325192743936-546569445.png)  
è¿™å°±æ˜¯ä»–ä»¬é‡åˆ°çš„é—®é¢˜ï¼Œ`+`ä¼šå˜æˆç©ºæ ¼ï¼Œè¿™ä¸ªå‘å…¶å®è›®å®¹æ˜“è¸©åˆ°ï¼Œæˆ‘è‡ªå·±åˆšå·¥ä½œæ—¶å°±è¸©åˆ°è¿‡è¿™ä¸ªå‘ï¼Œä¹Ÿå¤šæ¬¡çœ‹åˆ°æˆ–å¬åˆ°åˆ«äººåŒè¸©æ­¤å‘ğŸ¤£

### é—®é¢˜åŸå› 

è¿™ä¸ªé—®é¢˜å’Œurlencodeç¼–ç æœ‰å…³ï¼Œurlencodeç¼–ç ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé™¤å­—æ¯ã€æ•°å­—å’Œ`*`ï¼Œ`.`ï¼Œ`-`å’Œ`_`è¿™äº›å­—èŠ‚åŸæ ·è¾“å‡ºå¤–ï¼Œå…¶å®ƒå­—èŠ‚éƒ½ä¼šç¼–ç ä¸º`%XX`(16è¿›åˆ¶)çš„å½¢å¼ã€‚  
![urlencode](https://img2023.cnblogs.com/blog/2792815/202303/2792815-20230325192744046-1500661614.png)

ä½†æœ‰ä¸€ä¸ªç‰¹ä¾‹ï¼Œå¦‚ä¸‹ï¼š

    String enc = URLEncoder.encode(" ", "UTF-8");
    System.out.println(enc);   // è¾“å‡º+å·
    
    String dec = URLDecoder.decode("+", "UTF-8");
    System.out.println(dec);   // è¾“å‡ºç©ºæ ¼
    

ç‰¹ä¾‹å°±æ˜¯ç©ºæ ¼ä¼šè¢«ç¼–ç ä¸º`+`å·ï¼Œåä¹‹ï¼Œ`+`å·ä¼šè¢«è§£ç ä¸ºç©ºæ ¼ï¼

> æ³¨ï¼šåœ¨æ–°çš„RFC 2396è§„èŒƒä¸­ï¼Œç©ºæ ¼å…¶å®ä¹Ÿå¯ä»¥ç¼–ç æˆ%20ï¼Œè€Œè§£ç æ—¶ï¼Œ`+`å·ä¸%20éƒ½ä¼šè¢«è§£ç ä¸ºç©ºæ ¼ã€‚

å›æƒ³ä¸Šé¢çš„åœºæ™¯ï¼Œå¦‚æœå°†å¸¦æœ‰`+`å·çš„base64å­—ç¬¦ä¸²ï¼ŒåŸå°ä¸åŠ¨çš„å°è£…åˆ°data=ä¸­ï¼Œå†å‘é€ç»™Tomcatç­‰WebæœåŠ¡å™¨ï¼Œè‹¥Tomcatä¾§åšä¸€æ¬¡urldecodeè§£ç ï¼Œ`+`æ˜¯ä¸æ˜¯å°±å˜æˆç©ºæ ¼äº†ğŸ˜

è€ŒTomcatç¡®å®ä¼šåšurldecodeè§£ç è¿™æ ·çš„æ“ä½œï¼Œå½“è°ƒç”¨æ–¹çš„Content-Typeä¸º`application/x-www-form-urlencoded`æ—¶ï¼Œè¿™é‡ŒçŸ¥é“æœ‰è¿™ç§æ“ä½œå³å¯ï¼Œæƒ³äº†è§£ç»†èŠ‚å¯çœ‹çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç«  [ç”±x-www-form-urlencodedå¼•å‘çš„æ¥å£å¯¹æ¥å¤±è´¥](https://mp.weixin.qq.com/s/lTznRb5zvnZspml2EgOTaw)

### è§£å†³é—®é¢˜

è§£å†³è¿™ç§é—®é¢˜ï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š

1.  è°ƒç”¨æ–¹å¯¹å‚æ•°åšurlencodeç¼–ç ã€‚

æŒ‰è§„èŒƒæ¥çœ‹ï¼Œå½“Content-Typeä¸º`application/x-www-form-urlencoded`æ—¶ï¼Œè°ƒç”¨æ–¹æ˜¯å¿…é¡»å¯¹å‚æ•°åä¸å‚æ•°å€¼åšurlencodeçš„ï¼Œjavaå®ç°å¦‚ä¸‹ï¼š

    String base64Str = Base64.getEncoder().encodeToString(data);
    String requestStr = "data=" + URLEncoder.encode(base64Str, "UTF-8");
    

è¿™é‡Œåšäº†urlencodeåï¼Œ`+`ä¼šè¢«ç¼–ç ä¸º`%2B`ï¼Œå†ç”±æœåŠ¡ç«¯è§£ç ï¼Œå°±ä¼šå˜æˆåŸæ ·çš„`+`å·ã€‚

> æ³¨ï¼šå¦‚æœæ˜¯ä½¿ç”¨apacheçš„HttpClientï¼Œå¯è€ƒè™‘ä½¿ç”¨`UrlEncodedFormEntity`ï¼Œå®ƒä¼šè‡ªåŠ¨åšè¿™ä¸ªäº‹æƒ…ã€‚

2.  ä½¿ç”¨urlsafeç‰ˆæœ¬çš„base64ã€‚

æ™®é€šçš„base64ä¸èƒ½ç›´æ¥ä½œä¸ºå‚æ•°å€¼ï¼Œå› ä¸ºå®ƒå¯èƒ½åŒ…å«`+`ã€`/`è¿™ä¸¤ä¸ªurlä¸å®‰å…¨çš„å­—ç¬¦ï¼Œæ‰€ä»¥base64æœ‰ä¸ªå˜ç§å«urlBase64ï¼Œå®ƒå°†`+`ã€`/`æ›¿æ¢æˆäº†urlå®‰å…¨çš„`-`ã€`_`ï¼Œjavaå®ç°å¦‚ä¸‹ï¼š

    String urlBase64Str = Base64.getUrlEncoder().encodeToString(data);
    String requestStr = "data=" + urlBase64Str;
    

å…³äºbase64ã€urlencodeç¼–ç ï¼Œä¹‹å‰ä¹Ÿä¸“é—¨å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼Œæ„Ÿå…´è¶£å¯è¿›ä¸€æ­¥é˜…è¯» [hex,base64,urlencodeç¼–ç æ–¹æ¡ˆå¯¹æ¯”](https://mp.weixin.qq.com/s/pWdEYzyvWDQCTIVJ2ArMoQ)