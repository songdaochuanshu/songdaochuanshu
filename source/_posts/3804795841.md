---
layout: post
title: "vue-routerè·¯ç”±ä¹‹è·¯-æç®€æ•™ç¨‹"
date: "2022-12-15T06:20:59.049Z"
---
vue-routerè·¯ç”±ä¹‹è·¯-æç®€æ•™ç¨‹
===================

![vue-routerè·¯ç”±ä¹‹è·¯-æç®€æ•™ç¨‹](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195054313-2084649809.png) ä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±ï¼Ÿå‰ç«¯è·¯ç”±çš„ä¸€ä¸ªå¤§èƒŒæ™¯å°±æ˜¯å½“ä¸‹æµè¡Œçš„å•é¡µåº”ç”¨SPAï¼Œä¸€äº›ä¸»æµçš„å‰ç«¯æ¡†æ¶ï¼Œå¦‚vueã€reactã€angularéƒ½å±äºSPAï¼Œé‚£ä»€ä¹ˆæ˜¯SPAå‘¢ï¼Ÿå¦‚ä½•ä½¿ç”¨å‰ç«¯è·¯ç”±vue-routerå‘¢ï¼Ÿ

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195111300-1360550100.png)

01ã€ä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±ï¼Ÿ
===========

å‰ç«¯è·¯ç”±çš„ä¸€ä¸ªå¤§èƒŒæ™¯å°±æ˜¯å½“ä¸‹æµè¡Œçš„å•é¡µåº”ç”¨SPAï¼Œä¸€äº›ä¸»æµçš„å‰ç«¯æ¡†æ¶ï¼Œå¦‚vueã€reactã€angularéƒ½å±äºSPAï¼Œé‚£ä»€ä¹ˆæ˜¯SPAå‘¢ï¼Ÿ

1.1ã€SPA
-------

**SPA**ï¼ˆsingle-page applicationï¼‰å•é¡µé¢åº”ç”¨ï¼Œå°±æ˜¯æµè§ˆå™¨åªåŠ è½½äº†ä¸€ä¸ªURLåœ°å€ï¼Œä¸€ä¸ªé¡µé¢ï¼Œåº”ç”¨çš„æ‰€æœ‰åŠŸèƒ½ã€äº¤äº’éƒ½åœ¨è¿™ä¸ªé¡µé¢å†…è¿›è¡Œã€‚è€Œå®ç°å•é¡µé¢åº”ç”¨çš„åŸºç¡€å°±æ˜¯`ajax`ï¼Œé€šè¿‡å¼‚æ­¥è¯·æ±‚åŠ¨æ€çš„åˆ‡æ¢é¡µé¢å†…å®¹ã€å®ç°äº¤äº’ï¼Œé¡µé¢æ•´ä½“æ²¡æœ‰åˆ·æ–°ã€‚è¿™é¿å…äº†é¡µé¢URLè·³è½¬ï¼Œç”¨æˆ·ä½“éªŒä¹Ÿä¸ä¼šä¸­æ–­ï¼Œå°±åƒåŸç”Ÿåº”ç”¨ä¸€æ ·ï¼Œä½“éªŒæ¯”è¾ƒå¥½ã€‚è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿåœ¨ä½¿ç”¨SPAï¼Œå°¤å…¶æ˜¯WebAppä¸­ä½¿ç”¨å¹¿æ³›ã€‚

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195111344-797209773.png)

ä¸`SPA`å•é¡µåº”ç”¨å¯¹åº”çš„å°±æ˜¯å¤šé¡µåº”ç”¨`MPA`ï¼Œå½“ç„¶ä¸¤è€…ä¸æ˜¯éæ­¤å³å½¼çš„ï¼Œä¸»è¦åŸºäºä¸šåŠ¡éœ€æ±‚ï¼Œæ˜¯å¯ä»¥å…±å­˜çš„ã€‚

**åŒºåˆ«**

**å•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰**

**å¤šé¡µé¢åº”ç”¨ï¼ˆMPAï¼‰**

**é¡µé¢ç»„æˆ**

ä¸€ä¸ªä¸»é¡µï¼ŒåŒ…å«å¤šä¸ªé¡µé¢ç‰‡æ®µ

å¤šä¸ªä¸»é¡µé¢

**åˆ·æ–°æ–¹å¼**

å±€éƒ¨åˆ·æ–°

æ•´é¡µåˆ·æ–°

**urlæ¨¡å¼**

`hash`å“ˆå¸Œæ¨¡å¼ ã€`history`å†å²æ¨¡å¼

`history`å†å²æ¨¡å¼

**SEOæœç´¢å¼•æ“ä¼˜åŒ–**

éš¾å®ç°ï¼Œé‡‡ç”¨é¡µé¢é™æ€åŒ–æ–¹å¼ä¼˜åŒ–

å®¹æ˜“å®ç°

**æ•°æ®ä¼ é€’**

åŒä¸€åº”ç”¨å†…ï¼Œå®¹æ˜“

é€šè¿‡urlã€cookieã€localStorageç­‰ä¼ é€’ï¼Œå¤æ‚

**æ¸²æŸ“æ€§èƒ½**

é¦–æ¬¡åŠ è½½èµ„æºå¤šç¨æ…¢ï¼Œåˆ‡æ¢å¿«ï¼Œä½“éªŒè‰¯å¥½

åˆ‡æ¢åŠ è½½èµ„æºï¼Œé€Ÿåº¦æ…¢ï¼Œç”¨æˆ·ä½“éªŒå·®

**è½¬åœºåŠ¨ç”»**

å®¹æ˜“å®ç°

å¥½åƒå®ç°ä¸äº†

**ç»´æŠ¤æˆæœ¬**

ç›¸å¯¹å®¹æ˜“

ç›¸å¯¹å¤æ‚

SPAçš„ä¸»è¦è¡¨ç°å°±æ˜¯**æ›´æ–°è§†å›¾**è€Œä¸é‡æ–°è¯·æ±‚é¡µé¢ï¼Œè¦å®ç°å‰ç«¯çš„é¡µé¢çš„è‡ªä¸»è·¯ç”±æ§åˆ¶ï¼Œè€Œä¸ä¼šåˆ·æ–°é¡µé¢ï¼Œæ¶‰åŠä¸¤ç§ä¸»æµçš„æŠ€æœ¯ï¼š`hash`æ¨¡å¼ã€`history`æ¨¡å¼ï¼Œè¿™ç®—æ˜¯å‰ç«¯è·¯ç”±çš„æ ¸å¿ƒåŸç†ï¼Œç®€å•äº†è§£ä¸€ä¸‹å§ï¼

1.2ã€#hashè·¯ç”±åŸç†
-------------

**`hash`**ï¼ˆ /hÃ¦Êƒ/ ï¼‰æ˜¯URLåœ°å€ä¸­#å·åé¢çš„å†…å®¹ï¼ˆåŒ…æ‹¬#ï¼‰ï¼ŒåŸæœ¬çš„ä½œç”¨æ˜¯ç”¨äºHTMLé¡µé¢å†…éƒ¨å®šä½çš„æç‚¹ï¼Œæç‚¹çš„å˜åŒ–ä¸ä¼šå¯¼è‡´é¡µé¢é‡æ–°åŠ è½½ã€‚HTTPè¯·æ±‚ä¸­ä¹Ÿä¸ä¼šå¸¦#ï¼Œæ‰€ä»¥åˆ·æ–°ä¹Ÿä¸å½±å“ï¼Œè¿™æ˜¯æµè§ˆå™¨ç«¯çš„æœ¬åœ°è¡Œä¸ºã€‚

*   **é¡µé¢ä¸åˆ·æ–°ï¼š**`hash`çš„å˜åŒ–ä¸ä¼šåˆ·æ–°é¡µé¢ï¼Œåªä¼šè§¦å‘æµè§ˆå™¨å®šä½é”šç‚¹ï¼Œè¿™æ˜¯`hash`å®ç°å‰ç«¯è·¯ç”±çš„åŸºæœ¬åŸç†ã€‚
*   **è·å–** **`hash`**ï¼š`window.location.hash`
*   **`hash`** **å˜æ›´äº‹ä»¶**ï¼š`window.hashchange`ç›‘å¬`hash`å˜åŒ–ã€‚
*   ä¸åŒçš„`hash`ä¼šè¿›å…¥æµè§ˆå™¨å†å²è®°å½•ã€‚

> [http://www.xxx.cn/#/about](http://www.xxx.cn/#/about)  
> [http://www.xxx.cn/#/pro-info-list](http://www.xxx.cn/#/pro-info-list)

æ‰€ä»¥ï¼Œå®ç°è¿‡ç¨‹å°±æ¯”è¾ƒç®€å•äº†ï¼

â¶ **ç›‘æµ‹hashå˜åŒ–**ï¼šé€šè¿‡`hashchange`äº‹ä»¶ç›‘æµ‹`hash`å˜åŒ– ã€‚

â· **åŠ è½½èµ„æº**ï¼šæ ¹æ®`hash`å€¼åŒ¹é…ä¸åŒèµ„æºè¿›è¡ŒåŠ è½½ã€åˆ‡æ¢ï¼Œåœ¨Vueä¸­åˆ‡æ¢çš„å…¶å®å°±æ˜¯ä¸åŒçš„ç»„ä»¶ã€‚

![image](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195611184-1364578814.png)

ğŸŒ°hash-ç®€æ˜“è·¯ç”±ç¤ºä¾‹ï¼š[codepen](https://codepen.io/kanding/pen/XWqaKgY)

    <div id="app2">
        <ul id="nav" v-once>
            <li v-for="item in navs" v-if="item.title"><a v-bind:href="'#/'+item.url">{{item.title}}</a></li>
        </ul>
        <div id="main">
            <keep-alive>
                <component v-bind:is="currentComponent"></component>
            </keep-alive>
        </div>
    </div>
    <script>
        //components
        const NotFound = { template: '<p>404ï¼Page not found</p>' };
        const Home = { template: '<p>é¦–é¡µ<br>Home page</p>' };
        const Product = { template: '<p>äº§å“é¡µé¢<br>Product page<br><input></p>' };
        const About = { template: '<p>å…³äºæˆ‘ä»¬<br>About page</p>' };
        //å¯¼èˆªè·¯ç”±æ•°æ®
        function Route(title, url, name, component) {
            this.title = title; this.url = url; this.component = component; this.name = name;
        }
        let routes = [
            new Route("é¦–é¡µ", "home", 'home', Home), new Route("å•†å“", "protect", 'protect', Product),
            new Route("æ‹›è˜", "hr", null, null), new Route("å…³äº", "about", 'about', About),
            new Route(null, "not-found", 'not-found', NotFound)];
        let components = {};
        routes.forEach(item => { components[item.name] = item.component });
        //app
        let app2 = new Vue({
            el: "#app2",
            data: { currentRoute: window.location.hash, navs: Object.freeze(routes) },
            computed: {
                currentComponent: function () {
                    const com = this.navs.filter(item => '#/' + item.url === this.currentRoute)[0];
                    if (com && com.component) {
                        document.title = com.title;
                        return com.name;
                    }
                    return 'not-found';
                }
            },
            components: components,
            created: function () {
                window.addEventListener("hashchange", () => {
                    this.currentRoute = window.location.hash;
                });
            }
        });
    </script>
    

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195111306-1352891914.png)

1.3ã€historyè·¯ç”±åŸç†
---------------

[**history**](https://developer.mozilla.org/zh-CN/docs/Web/API/History) æ˜¯å†å²å¯¹è±¡ï¼Œå­˜æ”¾å½“å‰æ–‡æ¡£é¡µé¢ï¼ˆæˆ–æ¡†æ¶ï¼‰çš„ä¼šè¯å†å²è®°å½•ï¼ˆä¸æ˜¯æµè§ˆå™¨çš„æ‰€æœ‰å†å²è®°å½•ï¼‰ã€‚

**history å±æ€§/æ–¹æ³•**

**æè¿°**

length

ä¼šè¯å†å²åˆ—è¡¨çš„è®°å½•æ•°é‡

**state**

è¡¨ç¤ºå†å²å †æ ˆé¡¶éƒ¨è®°å½•çš„çŠ¶æ€å€¼ï¼Œå¯ä»¥æ˜¯ä»»æ„å¯åºåˆ—åŒ–JavaScriptå¯¹è±¡ï¼Œé™åˆ¶ä¸º2MB

**pushState**(stateObj, title\[, url\])

å‘å½“å‰ä¼šè¯çš„å†å²å †æ ˆä¸­æ·»åŠ ä¸€æ¡è®°å½•

**replaceState**(stateObj, title\[, url\])

ä¿®æ”¹ history å¯¹è±¡çš„å½“å‰ï¼ˆæ ˆé¡¶ï¼‰è®°å½•

**back**()

è¿”å›åˆ°ï¼ˆå†å²åˆ—è¡¨ä¸­ï¼‰ä¸Šä¸€ä¸ªURLåœ°å€ã€‚

**forward**()

å‰è¿›ï¼ŒåŠ è½½ï¼ˆå†å²åˆ—è¡¨ä¸­ï¼‰ä¸‹ä¸€ä¸ªURLåœ°å€

**go**(number)

åŠ è½½æŒ‡å®š**ç›¸å¯¹å½“å‰ç½‘é¡µ**ç´¢å¼•ä½ç½®çš„å†å²åˆ—è¡¨URLåœ°å€ï¼Œgo(-1)ç­‰åŒäºback()

**`pushState`**ã€**`replaceState`** æ˜¯HTML5åœ¨`history`ä¸Šæ–°å¢çš„APIï¼Œç”¨æ¥æ–°å¢ã€ä¿®æ”¹å½“å‰æ–‡æ¡£çš„å†å²è®°å½•ï¼Œè¿™ä¸¤ä¸ªAPIå°±æ˜¯ç”¨æ¥å®ç°SPAå•é¡µåº”ç”¨å‰ç«¯è·¯ç”±çš„å…³é”®ã€‚ä»–ä»¬çš„å‚æ•°ç›¸åŒï¼š`(stateObj, title[, url])`

*   **state**ï¼šä¸€ä¸ªå…³è”å†å²ä¼šè¯è®°å½•çš„çŠ¶æ€å¯¹è±¡ï¼Œä¸»è¦ä½œç”¨æ˜¯åœ¨è§¦å‘ `popstate`äº‹ä»¶æ—¶ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä¸éœ€è¦å¯ä»¥ä¸ºnullï¼Œé€šè¿‡`history.state`å¯ä»¥è·å–åˆ°å½“å‰ä¼šè¯çš„`state`ã€‚
*   **title**ï¼šæ–°é¡µé¢çš„æ ‡é¢˜ï¼Œå¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½æ²¡æœ‰ç®¡ä»–ï¼Œå¯ä»¥ç©ºç€ã€‚
*   **url**ï¼šç½‘å€ï¼Œå¯ä»¥ç›¸å¯¹ã€ç»å¯¹åœ°å€ï¼Œä½†ä¸å¯è·¨åŸŸã€‚**è¿™ä¸ª`url`ä¼šæ›´æ–°åˆ°æµè§ˆå™¨åœ°å€æ ï¼Œä½†å¹¶ä¸ä¼šåŠ è½½è¯¥`url`åœ°å€ï¼Œä¹Ÿä¸æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œé¡µé¢ä¹Ÿä¸ä¼šåˆ·æ–°**ï¼å¯¹ï¼Œè¦çš„å°±æ˜¯ä½ ä¸åˆ·æ–°ã€‚

åŸºäºè¿™ä¸¤ä¸ªAPIçš„ç‰¹æ€§æ¥å®ç°å‰ç«¯è·¯ç”±ã€‚ç”¨ `pushState`è¿˜æ˜¯ `replaceState`å‘¢ï¼Ÿä¸¤è€…ä½œç”¨ä¸€æ ·çš„ï¼Œå”¯ä¸€çš„ä¸åŒå°±æ˜¯`pushState`ä¼šäº§ç”Ÿå†å²è®°å½•ï¼Œå¯ç”¨äºå‰è¿›ã€åé€€ã€‚

â‘  **ç›‘æµ‹urlåœ°å€å˜åŒ–**ï¼Œ

*   **`popstate`** **äº‹ä»¶**ï¼šå½“`state`å˜åŒ–æ—¶è§¦å‘è¯¥äº‹ä»¶ï¼Œåœ¨äº‹ä»¶ä¸­è·å–å½“å‰`url`åœ°å€ã€‚pushStateã€replaceStateå¹¶ä¸ä¼šè§¦å‘`popstate`äº‹ä»¶ï¼Œå‰è¿›ã€åé€€ã€è·³è½¬æ‰ä¼šè§¦å‘ã€‚
*   **ç‚¹å‡»äº‹ä»¶**ï¼šç»‘å®šå¯¼èˆªæŒ‰é’®çš„`click`äº‹ä»¶ï¼Œ`pushState()`æ›´æ–°`url`ã€‚

â‘¡ **åŠ è½½èµ„æº**ï¼šæ ¹æ®`url`å€¼åŒ¹é…ä¸åŒèµ„æºè¿›è¡ŒåŠ è½½ã€åˆ‡æ¢ã€‚

> **ğŸ“¢æ³¨æ„**ï¼Œé¡µé¢ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™ï¼Œä¸ä¼šè§¦å‘**`popstate`**äº‹ä»¶ã€‚

history-ç®€æ˜“è·¯ç”±ç¤ºä¾‹ï¼š[codepen](https://codepen.io/kanding/pen/yLjoJXz)

    <div id="app3">
        <ul id="nav" v-once>
            <li v-for="item in navs" v-if="item.title">
                <a href="#" v-on:click.prevent="navClick(item)">{{item.title}}</a></li>
        </ul>
        <div id="main">
            <keep-alive>
                <component v-bind:is="currentComponent"></component>
            </keep-alive>
        </div>
    </div>
    <script>
        //components
        const NotFound = { template: '<p>404ï¼Page not found</p>' };
        const Home = { template: '<p>é¦–é¡µ<br>Home page</p>' };
        const Product = { template: '<p>äº§å“é¡µé¢<br>Product page<br><input></p>' };
        const About = { template: '<p>å…³äºæˆ‘ä»¬<br>About page</p>' };
        //å¯¼èˆªè·¯ç”±æ•°æ®
        function Route(title, url, name, component) {
            this.title = title; this.url = url; this.component = component; this.name = name;
        }
        let routes = [
            new Route("é¦–é¡µ", "home", 'home', Home), new Route("å•†å“", "protect", 'protect', Product),
            new Route("æ‹›è˜", "hr", null, null), new Route("å…³äº", "about", 'about', About),
            new Route(null, "not-found", 'not-found', NotFound)];
        let components = {};
        routes.forEach(item => { components[item.name] = item.component });
    
        //æ‹¦æˆªhistory.pushStateï¼Œè§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚ä¸æ‹¦æˆªæ¢å…¶ä»–æ–¹å¼ä¹Ÿå¯ä»¥ï¼Œæ¯”å¦‚ç‚¹å‡»äº‹ä»¶é‡Œã€‚
        history.pushState = (function (type) {
            let origin = history[type];  //ç”¨é—­åŒ…æ¥å­˜å‚¨åŸæ¥çš„æ–¹æ³•
            return function () {
                let out = origin.apply(this, arguments);
                let event = new Event(type);   //è§¦å‘ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶pushState
                event.arguments = arguments;
                window.dispatchEvent(event);
                return out;
            }
        })('pushState');
        //app
        let app3 = new Vue({
            el: "#app3",
            data: { currentRoute: history.state?.url, navs: Object.freeze(routes) },
            computed: {
                currentComponent: function () {
                    const com = this.navs.filter(item => item.url === this.currentRoute)[0];
                    if (com && com.component) {
                        document.title = com.title;
                        return com.name;
                    }
                    return 'not-found';
                }
            },
            components: components,
            methods: {
                navClick: function (route) {
                    history.pushState({ url: route.url }, null, route.url);
                }
            },
            created: function () {
                window.addEventListener("popstate", () => {
                    this.currentRoute = history.state?.url;  //ä¹Ÿå¯ä»¥ç”¨location.pathnameè·å–å‰ç«¯url
                });
                window.addEventListener("pushState", () => { //ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶pushState
                    this.currentRoute = history.state?.url;
                });
            }
        })
    </script>
    

> ğŸ“¢ **åˆ·æ–°é¡µé¢**æ—¶ä¼šé‡æ–°åŠ è½½å½“å‰ï¼ˆæœ¬åœ°è·¯ç”±çš„ï¼‰`url`åœ°å€ï¼Œå¯èƒ½å°±404äº†ï¼Œè¿™å°±éœ€è¦æœåŠ¡ç«¯æ”¯æŒï¼Œä¿®æ”¹ä¸‹nginxä»£ç†ä¹Ÿæ˜¯å¯ä»¥è§£å†³çš„ã€‚  
> â—**historyä¸hashçš„ä¸»è¦åŒºåˆ«**ï¼Œå°±æ˜¯ä¸ä¼šå‡ºç°ä¸€ä¸ª`#`ï¼Œçœ‹ä¸Šå»æ›´åŠ ç¾è§‚ï¼Ÿå¥½åƒä¹Ÿæ²¡å•¥åŒºåˆ«å§ï¼

* * *

02ã€å¼€å§‹vue-router
===============

2.1ã€ç®€ä»‹
------

Vue Routeræ˜¯Vueå®˜æ–¹æ¨å‡ºçš„è·¯ç”±ç»„ä»¶ï¼Œä¸Vueæ·±åº¦é›†æˆï¼Œæ”¯æŒ`hash`ã€`history`ä¸¤ç§æ¨¡å¼ã€‚

*   `Vue2.*` ç‰ˆæœ¬ â–¶ å¯¹åº” `vue-router3.*`ç‰ˆæœ¬ï¼Œ[vue-router3.\* ä¸­æ–‡æ–‡æ¡£](https://v3.router.vuejs.org/zh/installation.html)
*   `Vue3.*` ç‰ˆæœ¬ â–¶ å¯¹åº” `vue-router4.*`ç‰ˆæœ¬ï¼Œ[vue-router4.\* ä¸­æ–‡æ–‡æ¡£](https://router.vuejs.org/zh/introduction.html)

2.2ã€å®‰è£…ä½¿ç”¨
--------

*   é€šè¿‡`<script>`æ ‡ç­¾ç›´æ¥å¼•ç”¨`vue-router.js`ï¼š

    <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/vue-router@3/dist/vue-router.js"></script>
    // æ³¨å†Œæ’ä»¶
    Vue.use(VueRouter);
    

*   é€šè¿‡ `vue-cli` è„šæ‰‹æ¶æ­å»º`vue`çš„å¼€å‘æ¡†æ¶ï¼Œé›†æˆäº†`vue-router`ç»„ä»¶ã€‚
*   æ³¨å†Œæ’ä»¶ï¼š`Vue.use(VueRouter)`

* * *

03ã€vue-router3å…¥é—¨
================

3.1ã€Routeré€‰é¡¹
------------

âœ”ï¸[Router**é€‰é¡¹**](https://v3.router.vuejs.org/zh/api/#router-%E6%9E%84%E5%BB%BA%E9%80%89%E9%A1%B9)

**æè¿°**

**routes**

è·¯ç”±è®°å½•é…ç½®ä¿¡æ¯ï¼Œ`Array<RouteConfig>`

mode

è·¯ç”±æ¨¡å¼ï¼Œé»˜è®¤`hash`ï¼Œé€‰é¡¹ï¼š`hash`ã€`history`ã€abstractï¼ˆNodeJSç¯å¢ƒï¼‰

base

urlçš„åŸºæœ¬è·¯å¾„ï¼Œ`"/app/"`ï¼Œåªæœ‰historyæ¨¡å¼æœ‰æ•ˆï¼Ÿ

**linkActiveClass**

`<route-link>`æ¿€æ´»çš„`class`åç§°ï¼Œé»˜è®¤å€¼ä¸º`router-link-active`

linkExactActiveClass

ç²¾ç¡®åŒ¹é…æ¿€æ´»çš„`class`ï¼Œé»˜è®¤å€¼ä¸º`router-link-exact-active` ( exact /ÉªÉ¡ËˆzÃ¦kt/ ç²¾ç¡®)

scrollBehavior

è·¯ç”±åˆ‡æ¢å®Œæˆåçš„**æ»šåŠ¨è¡Œä¸ºå›è°ƒ**ï¼Œå‡½æ•° `Func(to, from, savedPosition)`

parseQuery/stringifyQuery

è‡ªå®šä¹‰æŸ¥è¯¢å­—ç¬¦ä¸²çš„è§£æ/åè§£æå‡½æ•°

    //åˆ›å»ºè·¯ç”±å™¨
    let vrouter = new VueRouter({ routes: vroutes, mode: 'hash', base: '/vsystem/' });
    

âœ”ï¸**routes.route**`RouteConfig`

åˆå§‹åŒ–æ—¶é…ç½®ç”¨çš„**è·¯ç”±è®°å½•**`RouteConfig` ï¼Œåœ¨åç»­ä»£ç ä¸­ä½¿ç”¨çš„ä¸º**è·¯ç”±å¯¹è±¡**

**path**

è·¯ç”±urlè·¯å¾„ `path: '/user'`

**component**

Component ç»„ä»¶ï¼Œå¯ç”¨å‡½æ•°æ–¹å¼`import`æ‡’åŠ è½½ç»„ä»¶ï¼Œæé«˜åˆå§‹åŒ–çš„æ€§èƒ½

components

å‘½åè§†å›¾ç»„ä»¶ï¼Œå½“æœ‰å¤šä¸ªå‘½åè§†å›¾`<router-view>`æ—¶ï¼Œä¹Ÿè¦é…ç½®å¯¹åº”çš„ç»„ä»¶

name

ç»™è·¯ç”±å–ä¸ªåå­—ï¼Œè‡ªå·±ç”¨ï¼Œæ²¡å…¶ä»–ç”¨é€”ï¼Œå¯ä½œä¸ºæ˜¾ç¤ºçš„ä¸­æ–‡æ ‡é¢˜

redirect

é‡å®šå‘è·¯ç”±ï¼Œé‡å®šå‘åˆ°å¦å¤–çš„pathã€routeã€‚å¦‚æœå¸¦æœ‰queryä¼šè§£æè·¯ç”±å‡ºé”™ï¼Ÿ

alias

pathçš„åˆ«åï¼Œå¯ä¸€ä¸ªæˆ–å¤šä¸ª(æ•°ç»„`Array<string>`)åˆ«åï¼Œæ¸²æŸ“ç»„ä»¶ä¸€æ ·

parent

çˆ¶çº§è·¯ç”±ï¼Œæ ¹çº§çš„`parent`ä¸º`undefined`

**children**

å­è·¯ç”±`Array<RouteConfig>`ï¼Œç»„ä»¶å†…ç”¨`<router-view>`ç»„ä»¶ä½œä¸ºåµŒå¥—ç»„ä»¶çš„å®¹å™¨

**props**

ç”¨äºç»™Vueç»„ä»¶å‚æ•°`Props`ä¼ å€¼ï¼šboolean | Object | Function  
\- **true**ï¼šè‡ªåŠ¨ä¼ é€’åŠ¨æ€è·¯å¾„å‚`route.params`ï¼›  
\- **å¯¹è±¡ï¼Œå‡½æ•°**ï¼šæŠŠå®ƒä»¬çš„ç»“æœèµ‹å€¼ç»™ç»„ä»¶propså‚æ•°(æŒ‰key)  

**beforeEnter**(to, from, next)

æ‰§è¡Œè·¯ç”±å‰çš„ä¸€ä¸ªé’©å­ï¼Œç§æœ‰çš„é’©å­ï¼Œç›®çš„åŒå…¨å±€çš„å®ˆå«é’©å­`beforeEach`

**meta**

è·¯ç”±å…ƒä¿¡æ¯ï¼Œè‡ªå®šä¹‰çš„ä¸ªæ€§åŒ–é…ç½®ï¼Œåœ¨è·¯ç”±é’©å­ä¸­å¯ä»¥è®¿é—®å¤„ç†ã€‚`meta:{title:'æ³¨å†Œ'}`

  

âœ”ï¸è¿è¡Œæ€çš„ $`route`è·¯ç”±å¯¹è±¡

ç»„ä»¶å†…`this.$route`è®¿é—®ï¼Œé’©å­å‡½æ•°ã€å¯¼èˆªå‡½æ•°ä¸­çš„toã€fromã€locationéƒ½æ˜¯æ­¤è·¯ç”±å¯¹è±¡

**path**

è·¯ç”±urlè·¯å¾„

fullPath

è§£æåçš„å®Œæ•´urlï¼ŒåŒ…å«query

**params**

å­˜æ”¾åŠ¨æ€è·¯å¾„å‚æ•°ï¼Œ{key:value }å¯¹è±¡ï¼Œç»„ä»¶å†…ä½¿ç”¨`this.$route.params.id`

query

urlæŸ¥è¯¢å‚æ•°ï¼Œ{key:value }å¯¹è±¡

hash

å½“å‰è·¯ç”±çš„å“ˆå¸Œ`hash`å€¼

name

è·¯ç”±åç§°

**meta**

å…ƒæ•°æ®è®°å½•

matched

åŒ¹é…åˆ°çš„è·¯ç”±è®°å½•åˆ—è¡¨

    interface RouteConfig = {
        path: string,
        component?: Component,
        name?: string, // å‘½åè·¯ç”±
        components?: { [name: string]: Component }, // å‘½åè§†å›¾ç»„ä»¶
        redirect?: string | Location | Function,
        props?: boolean | Object | Function,
        alias?: string | Array<string>,
        children?: Array<RouteConfig>, // åµŒå¥—è·¯ç”±
        beforeEnter?: (to: Route, from: Route, next: Function) => void,
        meta?: any,
        // 2.6.0+
        caseSensitive?: boolean, // åŒ¹é…è§„åˆ™æ˜¯å¦å¤§å°å†™æ•æ„Ÿï¼Ÿ(é»˜è®¤å€¼ï¼šfalse)
        pathToRegexpOptions?: Object // ç¼–è¯‘æ­£åˆ™çš„é€‰é¡¹
    }
    //$routeè·¯ç”±å¯¹è±¡
    {
        name: "user-box", // è·¯ç”±åç§°
        fullPath: "/user/21/vip?key=admin",
        hash: "", // å½“å‰è·¯ç”±çš„å“ˆå¸Œ
        matched: [{â€¦ }],
        meta: {},
        params: { id: '21', type: 'vip' },
        path: "/user/21/vip",
        query: { key: 'admin' }
    }
    

ğŸŒ°ç®€å•çš„ç¤ºä¾‹ï¼š

    <style>
        .router-link-active{ background-color: rgb(168, 240, 140); }
        .nav-item{ margin: 0 10px; }
    </style>
    <div id="app">
        <router-link v-for="r in this.$router.options.routes" :to="r.path" class="nav-item">{{r.name}}</router-link>
        <router-view></router-view> <!-- æ˜¾ç¤ºè·¯ç”±ç»„ä»¶è§†å›¾çš„å®¹å™¨ï¼Œå…¶å®æ˜¯å°±æ˜¯ä¸€ä¸ªåŠ¨æ€ç»„ä»¶ -->
    </div>
    <script>
        //è·¯ç”±é…ç½®RouteConfig
        let vroutes = [
            { path: '/user', name: 'ç”¨æˆ·ç®¡ç†', component: { template: '<div>user component</div>' } },
            { path: '/login', name: 'ç™»å½•', component: { template: '<div>login component</div>' } }];
        //åˆ›å»ºè·¯ç”±å™¨
        let vrouter = new VueRouter({ routes: vroutes, mode: 'hash', base: '/vsystem/' });
        //app
        let app = new Vue({
            el:"#app",
            router: vrouter,
        })
    </script>
    

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195111356-483991825.png)

3.2ã€routerå®ä¾‹-åˆ›å»ºRouter()
-----------------------

âœ”ï¸routerå®ä¾‹-**å±æ€§**

**æè¿°**

appã€apps

Vueæ ¹å®ä¾‹ï¼Œæ‰€æœ‰appså®ä¾‹

options

å‚æ•°é€‰é¡¹

currentRoute

å½“å‰æ¿€æ´»çš„è·¯ç”±ä¿¡æ¯å¯¹è±¡

mode

è·¯ç”±æ¨¡å¼ï¼š"hash" | "history" | "abstract"

START\_LOCATION

åˆå§‹å¯¼èˆªçš„è·¯ç”±åœ°å€ï¼Œrouteå¯¹è±¡

âœ”ï¸Routerå®ä¾‹-**æ–¹æ³•**

**æè¿°**

å…¨å±€çš„å¯¼èˆªå®ˆå«

beforeEachã€beforeResolveã€afterEach

[ç¼–ç¨‹å¼å¯¼èˆª](#ZCJbQ)

push(route)ã€replace(route)ã€go(index)ã€back()ã€forward()

resolve()

â“è§£æç›®æ ‡ä½ç½®

**addRoute**(parent?, RouteConfig)

æ·»åŠ è·¯ç”±è®°å½•ã€å­è·¯ç”±ï¼Œè¿˜æœ‰æ‰¹é‡æ·»åŠ çš„`addRoutes(routes)`

**getRoutes**()

è·å–æ‰€æœ‰æ´»è·ƒçš„è·¯ç”±è®°å½•åˆ—è¡¨ `Array<RouteConfig>`

onReady(callback,errorback)

å®Œæˆåˆå§‹åŒ–åè°ƒç”¨ï¼Œåˆå§‹åŒ–é”™è¯¯åˆ™è°ƒç”¨errorback

onError(callback)

è·¯ç”±è¿‡ç¨‹ä¸­å‡ºé”™æ—¶è§¦å‘ï¼Œç®—æ˜¯ä¸€ä¸ªå…¨å±€è·¯ç”±å¼‚å¸¸æ•è·

1.  æ³¨å†Œæ’ä»¶ï¼š`Vue.use(VueRouter)`
2.  åˆ›å»ºå…¨å±€å…±äº«çš„`router`è·¯ç”±å™¨å®ä¾‹ï¼Œå¹¶é…ç½®è·¯ç”±è®°å½•ã€‚
3.  æ³¨å…¥`router`ï¼Œåœ¨æ ¹Vueç»„ä»¶ä¸Šæ³¨å…¥`router`å®ä¾‹ï¼Œç„¶åæ‰€æœ‰åœ°æ–¹éƒ½å¯ä»¥ç”¨ `this.$router`è®¿é—®äº†.
4.  ç”¨`<router-link>`æ˜¾ç¤ºè·¯ç”±å¯¼èˆªï¼Œ`<router-view>`æ˜¾ç¤ºç»„ä»¶è§†å›¾ã€‚
5.  æ„‰å¿«çš„ä½¿ç”¨äº†ï¼Œåœ¨Vueç»„ä»¶ä¸­è®¿é—®è·¯ç”±çš„å‡ ç§é€”å¾„ï¼š
    *   `this.$router`ï¼ŒVueä¸­ä»»æ„åœ°æ–¹å¯ä»¥è®¿é—®çš„è·¯ç”±å™¨ã€‚
    *   `this.$route`ï¼Œç»„ä»¶æ‰€å±çš„`route`è·¯ç”±å¯¹è±¡ã€‚

ğŸŒ°åˆ›å»ºä¸€ä¸ªè·¯ç”±ï¼š

    <style>
        #app4 a { margin: 0 5px; }
        .router-link-active { background-color: blueviolet; color: #FFF; }
    </style>
    <div id="app4">
        <p>{{$router.mode}}-->{{$router.currentRoute.name}}</p>
        <div>
            <router-link to="/user/001">ç”¨æˆ·001</router-link>
            <router-link to="/login">ç™»å½•</router-link>
            <a href="#" @click.prevent="$router.push('/user/002')">a-ç”¨æˆ·0002</a>
        </div>
        <hr>
        <router-view></router-view>
    </div>
    <script>
        // æ³¨å†Œæ’ä»¶
        Vue.use(VueRouter);
        let isAuthenticated = true;
        //ç»„ä»¶
        const UserBox = { Prop: ['userId'], template: '<p>ç”¨æˆ·ä¿¡æ¯ï¼š{{$route.params}}</p>' };
        const Login = { template: '<p>ç”¨æˆ·ç™»å½•ï¼š<br>ç”¨æˆ·åï¼š<input></p>' };
        //è·¯ç”±é…ç½®
        let vroutes = [
            { path: '/user/:userId', name: 'ç”¨æˆ·ç®¡ç†', component: UserBox },
            { path: '/login', name: 'ç™»å½•', component: Login, meta: { type: 'vip' } },
            { path: '/*', redirect: '/login' }];
        //åˆ›å»ºè·¯ç”±å™¨
        let vrouter = new VueRouter({ routes: vroutes, mode: 'hash', base: '/vsystem/' });
        //è·¯ç”±å™¨çš„é’©å­ï¼šåšä¸€ä¸ªç™»å½•æƒé™éªŒè¯ï¼Œå¹¶æ›´æ–°æ–‡æ¡£æ ‡é¢˜
        vrouter.beforeEach((to, from, next) => {
            if (to.name !== 'Login' && !isAuthenticated) next({ name: 'Login' });
            else next();
            document.title = to.name;
        });
        //app
        let app4 = new Vue({
            el: "#app4",
            router: vrouter,   //æ³¨å…¥è·¯ç”±å™¨ï¼Œå†…éƒ¨é€šè¿‡ this.$router è®¿é—®
        })
    </script>
    

![1.gif](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195111356-1687077990.gif)

3.3ã€pathè·¯å¾„:string
-----------------

`path`ä¸ºè·¯ç”±çš„åœ°å€ï¼Œå½“æµè§ˆå™¨`url`åœ°å€ä¸`path`åŒ¹é…æ—¶ï¼Œå°±ä¼šæ¿€æ´»å½“å‰routeè·¯ç”±å¯¹è±¡ï¼Œå¹¶æ˜¾ç¤ºå™¨å¯¹åº”ç»„ä»¶`component/components`ã€‚

    let u1 = { path: '/home', component: Home };
    let u2 = { path: '/about', component: About };
    let u3 = { path: '/user/register', component: Register };
    let u3 = { path: '/*', component: NotFound404 };
    //åŠ¨æ€è·¯å¾„
    let u1 = { path: '/user/:id/:type', component: UserBox }
    //åŒ¹é…çš„è·¯å¾„
    <router-link to="/user/1/vip">ç”¨æˆ·1</router-link>
    

ğŸ”¸**`:`** **åŠ¨æ€è·¯å¾„å‚æ•°**ï¼š`path`ä¸­å¯ä»¥è®¾ç½®åŠ¨æ€å‚æ•°ï¼Œå†’å·`:`å¼€å¤´ï¼Œåé¢çš„ä¸ºå‚æ•°ï¼Œæ”¯æŒå¤šä¸ªé¡ºåºç»„è£…ï¼š`path:'/path/:å‚æ•°1/:å‚æ•°2'`ã€‚è¿™é‡Œçš„å‚æ•°æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

*   å‚æ•°éƒ½ä¼šè¢«æ”¾åˆ°åˆ°è·¯ç”±å¯¹è±¡`$route.params`ä¸­ã€‚
*   ç»„ä»¶å†…éƒ¨ç›´æ¥ä½¿ç”¨ï¼š`$route.params.id`ã€‚
*   é€šè¿‡å‚æ•°ä¸“é€’ï¼Œè®¾ç½®è·¯ç”±è®°å½•`props:true`ï¼Œå‚æ•°å€¼`$route.params`ä¼šä¼ é€’ç»™ç»„ä»¶çš„å‚æ•°`Props`ã€‚

ğŸ”¸`*`**é€šé…ç¬¦**ï¼š`*`é€šé…ç¬¦åŒ¹é…ä»»æ„å­—ç¬¦ï¼Œå¯æ”¾åˆ°æœ€åé¢åŒ¹é…404ï¼Œæˆ–é‡å®šå‘åˆ°é»˜è®¤è·¯ç”±ã€‚v4ç‰ˆæœ¬é‡Œåˆ äº†ï¼Œæ”¹ç”¨æ­£åˆ™ã€‚

ğŸ”¸**ä¼˜å…ˆçº§**ï¼šå¦‚æœç›¸åŒçš„pathï¼ŒåŒ¹é…å“ªä¸ªå‘¢ï¼ŸæŒ‰ç…§ä»£ç çš„é¡ºåºï¼Œå…ˆåˆ°å…ˆå¾—ã€‚

3.4ã€router-link/router-view
---------------------------

*   **`<router-link>`**ï¼š**è·¯ç”±å¯¼èˆªç»„ä»¶**ï¼Œç»‘å®šè·¯ç”±é…ç½®ï¼Œæ‰§è¡Œè·¯ç”±è·³è½¬ã€‚`<router-link>`ä¹Ÿæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå®é™…æ˜¯ä¸€ä¸ª`<a>`å…ƒç´ ã€‚
*   **`<router-view>`**ï¼š**è·¯ç”±è§†å›¾ç»„ä»¶**ï¼Œç”¨æ¥æ˜¾ç¤ºæ¸²æŸ“åŒ¹é…çš„è§†å›¾ç»„ä»¶ï¼Œå†…éƒ¨æ˜¯ä¸€ä¸ªVueåŠ¨æ€ç»„ä»¶ã€‚å¦‚æœéœ€è¦åŠ¨ç”»å’Œç¼“å­˜ï¼Œå¯ä»¥å¤–é¢åµŒå¥—`<transition>`ã€`<keep-alive>`ä½¿ç”¨ã€‚

âœ”ï¸`<router-link>`

**æè¿°**

**to**

pathï¼Œè·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œå­—ç¬¦ä¸²ã€è·¯ç”±å¯¹è±¡ã€‚

replace

é»˜è®¤`false`\=`push`ï¼Œæ‰§è¡Œå¯¼èˆªæ˜¯ç”¨`replace`ï¼Œè¿˜æ˜¯`push`ï¼Œå¯¹åº”`history`çš„ä¸¤ä¸ªApi

appendâ“

æ˜¯å¦æ·»åŠ åŸºè·¯å¾„`base`ï¼Œé»˜è®¤`false`

**tag**

æœ€ç»ˆæ¸²æŸ“çš„çš„æ ‡ç­¾ï¼Œé»˜è®¤`a`ã€‚_v4ä¸­åˆ æ‰äº†ï¼Œç”¨v-slotå®ç°è‡ªå®šä¹‰_

active-class

æ¿€æ´»çš„ç±»classå

exact

æ˜¯å¦ç²¾ç¡®åŒ¹é…è¿æ¥åœ°å€ï¼Œé»˜è®¤falseã€‚å°±æ˜¯è¯´é»˜è®¤æ˜¯æ¨¡ç³ŠåŒ¹é…è¿æ¥åœ°å€çš„ï¼Œåªè¦åŒ…å«å°±æ¿€æ´»äº†

event

è§¦å‘è·¯ç”±çš„äº‹ä»¶ç±»å‹ï¼Œé»˜è®¤`click`ã€‚ä¸æ€ä¹ˆå¸¸ç”¨ï¼Œv4ç‰ˆæœ¬ä¸­åˆ æ‰äº†

[v-slot](https://v3.router.vuejs.org/zh/api/#v-slot-api-3-1-0-%E6%96%B0%E5%A2%9E)

ä½œç”¨åŸŸæ’æ§½ï¼Œç”¨æ¥æ¥æ”¶æš´éœ²å‡ºæ¥çš„æ•°æ®ï¼Œ`<router-link>`æ”¯æŒæ’æ§½

âœ”ï¸`<router-view>`

name

å‘½åè§†å›¾ï¼Œå½“æœ‰å¤šä¸ªå°±éœ€è¦åå­—äº†ï¼Œå¦‚åˆ‡æ¢æ¡†æ¶å¸ƒå±€ã€‚åœ¨è·¯ç”±è®°å½•`components`ä¸­é…ç½®æ˜ å°„å…³ç³»

    <style>
        #app a{ margin: 0 10px; }
        .router-link-active { background-color: rgb(168, 240, 140); }
        /* åŠ¨ç”»css */
        .v-enter, .v-leave-to { opacity: 0; }
        .v-enter { transform: translateX(30px); }
        .v-enter-active, v-leave-active { transition: all 1s; }
    </style>
    <div id="app">
        <div>
            <h4>router-link</h4>
            <router-link to='/user/1/vip'>ç”¨æˆ·ç®¡ç†1</router-link>
            <router-link to='/login'>ç™»å½•</router-link>
            <!-- urlå˜äº†ï¼Œä½†æ²¡æœ‰è§¦å‘è·¯ç”± -->
            <a href="#user/2/vvip">a-ç”¨æˆ·2</a> 
            <a href="#" @click.prevent="$router.push('/user/003/vvip')">a-ç”¨æˆ·3</a>
        </div>
        <div>
            <h4>v-forç»‘å®š</h4>
            <router-link v-for="r in this.$router.options.routes" :to="r.path">{{r.name}}</router-link>
        </div><hr>
        <transition>
            <keep-alive>
                <router-view style="margin:10px"></router-view>
            </keep-alive>
        </transition>
    </div>
    <script>
        //è·¯ç”±é…ç½®RouteConfig
        let vroutes = [
            { path: '/user/:id/:type', name: 'ç”¨æˆ·ç®¡ç†', component: { template: '<div>user component{{$route.params}}</div>' } },
            { path: '/login', name: 'ç™»å½•', component: { template: '<div>login component<br><input></div>' } }];
        //åˆ›å»ºè·¯ç”±å™¨
        let vrouter = new VueRouter({ routes: vroutes, mode: 'hash', base: '/vsystem/' });
        //app
        let app = new Vue({
            el: "#app",
            router: vrouter,
        })
    </script>
    

![1.gif](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195111309-549281270.gif)

> ğŸ“¢ å½“`<router-link>`éœ€è¦ç›‘å¬åŸç”Ÿäº‹ä»¶æ—¶ï¼Œè¦åŠ ä¸ŠåŸç”Ÿä¿®é¥°ç¬¦`@click.native="nav_click"`

3.5ã€ç¼–ç¨‹å¼å¯¼èˆª
---------

é™¤äº†ä½¿ç”¨ç”³æ˜å¼å¯¼èˆª`<router-link>`ç»„ä»¶ï¼Œä¹Ÿå¯ä¹Ÿä½¿ç”¨ç¼–ç¨‹å¼çš„å¯¼èˆªæ–¹æ³•è‡ªå®šä¹‰å®ç°å¯¼èˆªï¼Œå°±æ˜¯è°ƒç”¨routeræä¾›çš„å¯¼èˆªæ–¹æ³•ã€‚

**routerå®ä¾‹-å¯¼èˆªæ–¹æ³•**

**push**(location, onComplete?, onAbort?)

`location`å¯ä»¥æ˜¯urlå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥æ˜¯routeå¯¹è±¡

**replace**(location, onComplete?, onAbort?)

åŒä¸Šï¼Œä¸ä¼šæ·»åŠ `history`è®°å½•ï¼Œ

go(index)ã€back()ã€forward()

å’Œæµè§ˆå™¨çš„historyæ“ä½œä¸€æ ·çš„ï¼Œå†å²é¡µé¢é‡Œè·³è½¬

  

*   å‚æ•°locationï¼ˆrouteå¯¹è±¡ï¼‰å¦‚æœä½¿ç”¨äº†`path`ï¼Œåˆ™ä¼šå¿½ç•¥`params` ï¼ˆparam /ËˆpÃ¦rÉ™m/ å‚æ•°ï¼‰ã€‚
*   å›è°ƒ onComplete?ã€onAbort?ï¼Œåœ¨ 3.1.0+ï¼Œ**pushã€replaceæ”¯æŒäº†**Promiseï¼Œä¼šè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œå¯é“¾å¼è°ƒç”¨äº†ï¼š

`this.$router.push('/user').then(onComplete).catch(onAbort)`

    <div>
      <h4>aæ ‡ç­¾ï¼Œç¼–ç¨‹å¼å¯¼èˆª</h4>
      <a href="#" @click.prevent="$router.push({path:'user/21/vip',query:{key:'admin'}})">ç”¨æˆ·1</a>
      <a href="#" @click.prevent="navClick">clickç™»å½•</a>
      <a @.prevent href="#/login?key=hello">åŸç”Ÿa</a>
      <br>
      <a href="#" @click.prevent="$router.back()">åé€€</a>
      <a href="#" @click.prevent="$router.forward()">å‰è¿›</a>
    </div>
    <script>
      let app = new Vue({
        el: "#app",
        router: router,
        methods: {
          navClick() {
            if (this.$router.currentRoute.path == '/login')
              return;
            this.$router.push('/login', null, () => { });  //æä¾›ä¸€ä¸ªç©ºçš„onAbort
            this.$router.replace('/login');
            this.$router.push('/user').then(onComplete).catch(onAbort); //promiseæ–¹å¼ä½¿ç”¨
            //è®¾ç½®äº†pathï¼Œparamsçš„è®¾ç½®å°±å¿½ç•¥äº†
            this.$router.push({ path: '/login', query: { key: 'admin' }, params: { id: 100 } });
            //ä¹Ÿå¯ä»¥ç”¨nameè¿›è¡Œå¯¼èˆªã€‚æ³¨æ„åé¢çš„catchï¼Œå› ä¸ºpushã€replaceéƒ½æ˜¯ç”¨promiseæ‰§è¡Œçš„
            this.$router.push({ name: 'ç™»å½•', query: { key: 'admin' }, params: { id: 12 } }).catch(s => { });
          }
        }
      })
    </script>
    

> **âš ï¸ è¿™é‡Œé‡åˆ°ä¸€ä¸ªå°é—®é¢˜**ï¼Œå°±æ˜¯é€šè¿‡ç¼–ç¨‹äº‹ä»¶å¯¼èˆªçš„`<a>`é“¾æ¥é‡å¤ç‚¹å‡»æŠ¥é”™ï¼šNavigationDuplicated

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195111350-1697417141.png)

åŸæ¥æ˜¯`vue-router`çš„ä¸€ä¸ªé—®é¢˜ï¼Œ`3.*`ç‰ˆæœ¬ä¸­å¼•å…¥äº†promiseæ—¶ä¹Ÿå¼•å…¥äº†è¿™ä¸ªbugï¼Œå¦‚æœè·¯ç”±æ²¡å˜åŒ–ï¼ˆé‡å¤ï¼‰å°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸çš„`promise`ã€‚`v4.*`ç‰ˆæœ¬éƒ½å‡ºæ¥äº†ï¼Œè¿™ä¸ªbugè¿˜æ²¡ä¿®å¤ï¼`<router-link>`æ­£å¸¸ï¼Œåªæœ‰å¯¼èˆªç¼–ç¨‹æ‰ä¼šã€‚

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195111356-2101099798.png)

**ğŸŸ¢è§£å†³æ–¹æ³•**ï¼š

> 1.  åˆ¤æ–­ä¸€ä¸‹å½“å‰è·¯ç”±æ˜¯å¦å·²å­˜åœ¨ã€‚
> 2.  æä¾›ä¸€ä¸ªç©ºçš„`onAbort`å›è°ƒï¼Œæˆ–è€…`promise`çš„æ–¹å¼æ•è·å¼‚å¸¸ã€‚
> 3.  æ”¹é€ ä¸€ä¸‹`VueRouter.prototype`çš„`push`æ–¹æ³•ã€‚

3.6ã€å¯¼èˆªå®ˆå«-é’©å­
-----------

åœ¨å¯¼èˆªè¿‡ç¨‹ä¸­æä¾›å¤šç§å®ˆå«ï¼ˆé’©å­å‡½æ•°ï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŠ¨æ€`path`å‚æ•°ã€`<keep-alive>`éƒ½ä¼šå¤ç”¨ç»„ä»¶ï¼Œæ­¤æ—¶ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå°±ä¸å®Œæ•´äº†ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©åˆé€‚çš„åœ°æ–¹ã€‚

âœ”ï¸routerå®ä¾‹-**å…¨å±€é’©å­å®ˆå«**

**æè¿°**

**beforeEach**(to, from, next)

å¯¼èˆªæ‰§è¡Œå‰ï¼Œå¯é€šè¿‡`next`å–æ¶ˆã€‚å¯ç”¨æ¥éªŒè¯ç™»é™†æƒé™ï¼Œå¦‚æœæ²¡è®¤è¯åˆ™è·³è½¬åˆ°ç™»é™†

**beforeResolve**(to, from, next)

`beforeEach`æ‰§è¡Œåï¼Œä¹Ÿæ˜¯å‰ç½®å®ˆå«

**afterEach**(to, from)

å¯¼èˆªå·²ç»ç¦»å¼€æ—¶è§¦å‘ï¼Œè¿™é‡Œæ²¡æœ‰nextï¼ˆä¸å¯å–æ¶ˆè·¯ç”±ï¼‰ï¼Œå› ä¸ºå·²ç»ç¦»å¼€äº†

âœ”ï¸**è·¯ç”±é…ç½®è®°å½•**route-çš„ç‹¬æœ‰é’©å­

**beforeEnter**(to, from, next)

æ‰§è¡Œè·¯ç”±å‰è°ƒç”¨

âœ”ï¸**Vueç»„ä»¶**ä¸­æ–°å¢çš„-é’©å­å®ˆå«

Vueç»„ä»¶çš„é’©å­

**beforeRouteEnter**(to, from, next)

è¿›å…¥å‰ï¼šç»„ä»¶è·¯ç”±è¢«confirmedï¼ˆå·²ç¡®è®¤ï¼‰å‰ï¼Œç»„ä»¶è¿˜æ²¡åˆ›å»ºï¼Œä¸èƒ½è·å–`this`

**beforeRouteUpdate**(to, from, next)

åªæœ‰åŠ¨æ€`path`å‚æ•°å¤ç”¨ç»„ä»¶æ—¶æ‰è§¦å‘ï¼Œæ›´æ–°å½“å‰è·¯ç”±ã€‚

**beforeRouteLeave**(to, from, next)

è·¯ç”±å°†è¦ç¦»å¼€è¯¥ç»„ä»¶å‰è§¦å‘ï¼Œ`this`å¯ç”¨ï¼Œ`next(false)`å¯å–æ¶ˆã€‚

**ğŸ”¸é’©å­çš„å‚æ•°**ï¼š**`(to, from, next)`**

*   **`to: Route`**ï¼šç›®æ ‡è·¯ç”±å¯¹è±¡ã€‚
*   **`from: Route`**ï¼šå½“å‰å¯¼èˆªè·¯ç”±å¯¹è±¡ï¼Œä¹Ÿæ˜¯è¦ç¦»å¼€çš„ã€‚
*   **`next: Function`**ï¼šæœ¬æ¬¡è·¯ç”±æ€ä¹ˆæ‰§è¡Œï¼Ÿå†…ç½®çš„å›è°ƒï¼Œå¿…é¡»è°ƒç”¨ã€‚
    *   `nex()/next(true)`ï¼šå…è®¸æ‰§è¡Œï¼Œå¹¶ç»§ç»­ï¼Œå…¨éƒ¨é’©å­æ‰§è¡Œå®Œæ¯•ï¼Œå¯¼èˆªçŠ¶æ€ä¸ºconfirmedï¼ˆå·²ç¡®è®¤ï¼‰ã€‚
    *   `next(false)`ï¼šğŸš«**ä¸æ‰§è¡Œ**ï¼Œä¸­æ–­å½“å‰å¯¼èˆªï¼Œé‡ç½®å¯¼èˆªåˆ°fromã€‚
    *   `next({route})`ï¼šâ—ä¸­æ–­å½“å‰å¯¼èˆªï¼Œå¹¶è¿›è¡Œä¸€ä¸ªæ–°çš„å¯¼èˆªåˆ°`route`ã€‚
    *   `ç‰¹æ®Šnext(callback)`ï¼š`beforeRouteEnter`çš„`next`æ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå‚æ•°ä¸ºç»„ä»¶`vm`ï¼Œå¯ç”¨æ¥è¯·æ±‚ä¸€äº›ajaxæ•°æ®ï¼Œå›è°ƒä¼šåœ¨ç»„ä»¶åˆ›å»ºåè°ƒç”¨ã€‚

ğŸŸ¢å¯¼èˆªå®ˆå«-é’©å­çš„ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾ï¼Œ_å®ˆå«é’©å­æµ‹è¯•ä»£ç ï¼š_ [_CodePen_](https://codepen.io/kanding/pen/rNvzLwv)

![image](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119201043674-1774877662.png)

**ğŸ”¸ä½¿ç”¨æ„è§**ï¼š

*   å¦‚æœåªæ˜¯å¯¹**è·¯ç”±**åšæ ¡éªŒæˆ–é€»è¾‘å¤„ç†ï¼Œå»ºè®®ç”¨è·¯ç”±çš„å…¨å±€é’©å­å®ˆå«`beforeEach`ï¼Œè‹¥åªæ˜¯é’ˆå¯¹æŸä¸ªç‰¹å®šè·¯ç”±ï¼Œåˆ™ç”¨è·¯ç”±è®°å½•çš„ç‹¬æœ‰é’©å­`beforeEnter`ã€‚
*   å¦‚æœæ˜¯éœ€è¦åŸºäºç»„ä»¶åšä¸€äº›æ“ä½œï¼Œå¦‚æ•°æ®åŠ è½½ã€æœªä¿å­˜æç¤ºï¼Œåˆ™ç”¨Vueç»„ä»¶çš„è·¯ç”±å®ˆå«é’©å­ã€‚
*   åœ¨å¤ç”¨ç»„ä»¶æ—¶ï¼Œé€šè¿‡`watch`ç›‘æµ‹è·¯ç”±å¯¹è±¡`$route`çš„å˜åŒ–ä¹Ÿæ˜¯ä¸€ä¸ªé€”å¾„ã€‚

* * *

04ã€vue-router4 åŒºåˆ«
=================

*   **å‡½æ•°åˆ›å»º**ï¼š**createRouter**({ })ï¼Œæ²¡æœ‰ä¹‹å‰çš„ç±»åˆ›å»ºäº†ã€‚
*   **modeè·¯ç”±æ¨¡å¼**ï¼šmodeæ²¡äº†ï¼Œå˜æˆäº†å‡½æ•°åˆ›å»º`history`ï¼š`createWebHistory()`ã€`createWebHashHistory()`ã€‚

    const router = createRouter({
        history:createWebHashHistory() / createWebHashHistory(),
        routes: [],
    })
    

*   **`base`**æ”¾åˆ°äº†ä¸Šé¢çš„åˆ›å»ºå‡½æ•°å‚æ•°é‡Œã€‚
*   å®ä¾‹å‡½æ•°`router.onReady()` æ”¹ä¸º **`IsReady()`**ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª**`Promise`**ã€‚
*   `<router-view>` æ”¯æŒäº†æ’æ§½`v-slot`ï¼Œæ”¯æŒå°±ç®—äº†ï¼Œå…³é”®æ˜¯å½±å“æœ‰ç‚¹å¤§ã€‚
    *   `<keep-alive>` å’Œ `<transition>` åªèƒ½é€šè¿‡æ’æ§½åµŒå…¥åˆ°`<router-view>`é‡Œé¢ï¼Œä¸åƒä¹‹å‰æ˜¯æ”¾åˆ°å¤–é¢çš„ã€‚
    *   `<router-view>` ç»„ä»¶çš„æ¨¡æ¿ä¹Ÿåªèƒ½é€šè¿‡`v-slot` \+ åŠ¨æ€ç»„ä»¶æ¥å®ç°äº†ã€‚

    <router-view v-slot="{ Component }">
        <transition>
            <keep-alive>
                <component :is="Component" />
            </keep-alive>
        </transition>
    </router-view>
    

*   `<router-link>`çš„`tag` æ²¡äº†ï¼Œé€šè¿‡æ’æ§½å®ç°ã€‚
*   æ‰€æœ‰çš„å¯¼èˆªç°åœ¨éƒ½æ˜¯å¼‚æ­¥çš„ã€‚

05ã€å…¶ä»–é—®é¢˜
=======

**â“å¦‚ä½•æ„å»ºå¤šçº§èœå•çš„å¯¼èˆªï¼ŸåŸºæœ¬æ€è·¯ï¼š**

*   é¦–å…ˆæ˜¯è·¯ç”±èœå•æ•°æ®ï¼Œåº”è¯¥æ˜¯åå°æ•°æ®åº“ç»Ÿä¸€ç®¡ç†ï¼ŒåŒ…æ‹¬èœå•åç§°ã€ç¼–ç ã€å›¾æ ‡ã€è·¯å¾„pathã€ä¸Šä¸‹çº§ç»“æ„ä¿¡æ¯ç­‰ç­‰ã€‚
*   **èœå•æ˜¯å¤šçº§çš„**ï¼Œè¿™ç”±åŠŸèƒ½æ¶æ„æ¥å†³å®šï¼Œ**è·¯ç”±è¿˜æ˜¯ä¸€çº§çš„**ï¼Œå› ä¸ºè§†å›¾åŒºåŸŸæ˜¯ä¸€è‡´çš„ã€‚soï¼Œä»ä¸Šè¿°æ•°æ®ä¸­æ„å»º2ä»½æ•°æ®ï¼Œä¸€ä»½å®ç°å¤šçº§Domèœå•ï¼Œå¦å¤–ä¸€ä»½æ„å»ºè·¯ç”±é…ç½®æ•°æ®ã€‚

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195111368-256294224.png)

**â“å¤šæ ‡ç­¾æ€ä¹ˆå®ç°ï¼Œå¯ä»¥ç®¡ç†ä½¿ç”¨å¤šä¸ªæ ‡ç­¾ï¼ŸåŸºæœ¬æ€è·¯ï¼š**

*   é¦–å…ˆè¦è®°å½•æ‰“å¼€çš„è·¯ç”±ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡è·¯ç”±å®ˆå«æ‹¦æˆªç›‘æµ‹ã€‚
*   ç”¨ä¸€ä¸ªæ ‡ç­¾æ æ¥æ˜¾ç¤ºè¿™äº›æ‰“å¼€çš„è·¯ç”±ä¿¡æ¯ï¼Œè‡ªå·±å®ç°åˆ‡æ¢è·¯ç”±å³å¯ã€‚
*   èœå•ã€æ ‡ç­¾ç›¸äº’è”åŠ¨ï¼Œæ ‡ç­¾åˆ é™¤æ—¶éœ€æŒ‰ç…§ä¸€å®šè§„åˆ™è·¯ç”±åˆ°ä¸‹ä¸€ä¸ªæ ‡ç­¾ä¸Šã€‚
*   åˆ·æ–°ä¿å­˜è§†å›¾çŠ¶æ€ï¼švuexå­˜å‚¨èœå•ã€æ ‡ç­¾æ˜¾ç¤ºçŠ¶æ€ã€‚

![image.png](https://img2022.cnblogs.com/blog/151257/202211/151257-20221119195111364-929114601.png)

* * *

> **Â©ï¸ç‰ˆæƒç”³æ˜**ï¼šç‰ˆæƒæ‰€æœ‰@å®‰æœ¨å¤•ï¼Œæœ¬æ–‡å†…å®¹ä»…ä¾›å­¦ä¹ ï¼Œæ¬¢è¿æŒ‡æ­£ã€äº¤æµï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼[_åŸæ–‡ç¼–è¾‘åœ°å€-è¯­é›€_](https://www.yuque.com/kanding/ktech/gawgqn)