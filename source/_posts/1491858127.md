---
layout: post
title: "Vben Admin æºç å­¦ä¹ :é¡¹ç›®åˆå§‹åŒ–"
date: "2022-05-30T13:42:01.587Z"
---
Vben Admin æºç å­¦ä¹ :é¡¹ç›®åˆå§‹åŒ–
---------------------

2022-05-30 15:10Â  [Anduril](https://www.cnblogs.com/anduril/)Â  é˜…è¯»(136)Â  è¯„è®º(0)Â  [ç¼–è¾‘](https://i.cnblogs.com/EditPosts.aspx?postid=16326845)Â  [æ”¶è—](javascript:void(0))Â  [ä¸¾æŠ¥](javascript:void(0))

![Vben Admin æºç å­¦ä¹ :é¡¹ç›®åˆå§‹åŒ–](https://img2022.cnblogs.com/blog/754488/202205/754488-20220530150942766-1089366373.png) Vue-Vben æ˜¯ä¸€ä¸ªå…è´¹å¼€æºçš„ä¸­åå°æ¨¡ç‰ˆã€‚æœ¬æ–‡å¯¹é¡¹ç›®ä»£ç è¿›è¡Œæ·±å…¥åˆ†æ ï¼Œè€å¿ƒè¯»å®Œï¼Œç›¸ä¿¡æ‚¨ä¼šæœ‰æ‰€æ”¶è·ã€‚

0x00 å‰è¨€
=======

[Vue-Vben-Admin](https://github.com/vbenjs/vue-vben-admin) æ˜¯ä¸€ä¸ªå…è´¹å¼€æºçš„ä¸­åå°æ¨¡ç‰ˆã€‚ä½¿ç”¨äº†æœ€æ–°çš„`vue3`,`vite2`,`TypeScript`ç­‰ä¸»æµæŠ€æœ¯å¼€å‘ï¼Œå¼€ç®±å³ç”¨çš„ä¸­åå°å‰ç«¯è§£å†³æ–¹æ¡ˆè€ƒã€‚

æœ¬ç³»åˆ—æœ¬ç€å­¦ä¹ å‚è€ƒçš„ç›®çš„ï¼Œå¯¹é¡¹ç›®ä»£ç è¿›è¡Œæ·±å…¥åˆ†æ ï¼Œè€å¿ƒè¯»å®Œï¼Œç›¸ä¿¡æ‚¨ä¼šæœ‰æ‰€æ”¶è·ã€‚

> æœ¬ç³»åˆ—éœ€è¦ä¸€å®šçš„é¡¹ç›®ä½¿ç”¨ç»éªŒï¼Œå»ºè®®å…ˆé˜…è¯»é¡¹ç›®çš„ [ä¸­æ–‡æ–‡æ¡£](https://vvbin.cn/doc-next/guide/introduction.html) ï¼Œä¼šå¯¹ç†è§£éå¸¸æœ‰å¸®åŠ©ã€‚

0x.01 ğŸ“ç›®å½•è¯´æ˜
============

é¡¹ç›®ä¸»è¦ç›®å½•ç»“æ„åŠè¯´æ˜ï¼Œæ¥ä¸‹æ¥å°†ä¸€ä¸€æ·±å…¥åˆ†æä»‹ç»ã€‚

    .
    â”œâ”€â”€ build # æ‰“åŒ…è„šæœ¬ç›¸å…³
    â”œâ”€â”€ mock # mockæ–‡ä»¶å¤¹
    â”œâ”€â”€ public # å…¬å…±é™æ€èµ„æºç›®å½•
    â”œâ”€â”€ src # ä¸»ç›®å½•
    â”‚   â”œâ”€â”€ api # æ¥å£æ–‡ä»¶
    â”‚   â”œâ”€â”€ assets # èµ„æºæ–‡ä»¶
    â”‚   â”œâ”€â”€ components # å…¬å…±ç»„ä»¶
    â”‚   â”œâ”€â”€ design # æ ·å¼æ–‡ä»¶
    â”‚   â”œâ”€â”€ directives # æŒ‡ä»¤
    â”‚   â”œâ”€â”€ enums # æšä¸¾/å¸¸é‡
    â”‚   â”œâ”€â”€ hooks # hook
    â”‚   â”œâ”€â”€ layouts # å¸ƒå±€æ–‡ä»¶
    â”‚   â”œâ”€â”€ locales # å¤šè¯­è¨€
    â”‚   â”œâ”€â”€ logics # é€»è¾‘
    â”‚   â”œâ”€â”€ main.ts # ä¸»å…¥å£
    â”‚   â”œâ”€â”€ router # è·¯ç”±é…ç½®
    â”‚   â”œâ”€â”€ settings # é¡¹ç›®é…ç½®
    â”‚   â”œâ”€â”€ store # æ•°æ®ä»“åº“
    â”‚   â”œâ”€â”€ utils # å·¥å…·ç±»
    â”‚   â””â”€â”€ views # é¡µé¢
    â”œâ”€â”€ test # æµ‹è¯•
    â”œâ”€â”€ types # ç±»å‹æ–‡ä»¶
    â”œâ”€â”€ vite.config.ts # viteé…ç½®æ–‡ä»¶
    â””â”€â”€ windi.config.ts # windcssé…ç½®æ–‡ä»¶
    

0x.02 ğŸ“ƒ ç³»ç»Ÿä¸»å…¥å£
==============

æ–‡ä»¶ `src/main.ts` ä½œä¸ºç³»ç»Ÿä¸»å…¥å£ï¼Œä¸»è¦è¿›è¡Œé¡¹ç›®åˆå§‹åŒ–æ“ä½œã€‚

åœ¨å…¥å£æ–‡ä»¶ä¸­å¼•å…¥`windicss`ï¼Œè¿™æ ·é¡¹ç›®ä¸­å°±å¯ä»¥ä½¿ç”¨ \[ç±»å®ç”¨ç¨‹åº\] æˆ– \[CSS æŒ‡ä»¤\]ã€‚  
åŒæ—¶å¼•å…¥é¡¹ç›®ä¸­ä½¿ç”¨çš„é€šç”¨æ ·å¼ï¼Œéƒ½å­˜æ”¾äºÂ `src/design/` ä¸‹é¢ï¼Œé»˜è®¤ä½¿ç”¨ less ä½œä¸ºé¢„å¤„ç†è¯­è¨€ã€‚

    import 'virtual:windi-base.css';
    import 'virtual:windi-components.css';
    import '/@/design/index.less';
    import 'virtual:windi-utilities.css';
    // Register icon sprite
    import 'virtual:svg-icons-register';
    

> windcss ç›®å‰ä¼šé€ æˆæœ¬åœ°å¼€å‘å†…å­˜æº¢å‡ºï¼Œæ‰€ä»¥åç»­å¯èƒ½ä¼šè€ƒè™‘åˆ‡æ¢åˆ° TailwindCss ã€‚

æ¥ä¸‹æ¥æ‰§è¡Œ `bootstrap` æ–¹æ³•åˆ›å»ºé¡¹ç›®å®åˆ—ã€‚

    import App from './App.vue';
    import { createApp } from 'vue';
    import { initAppConfigStore } from '/@/logics/initAppConfig';
    import { setupErrorHandle } from '/@/logics/error-handle';
    import { router, setupRouter } from '/@/router';
    import { setupRouterGuard } from '/@/router/guard';
    import { setupStore } from '/@/store';
    import { setupGlobDirectives } from '/@/directives';
    import { setupI18n } from '/@/locales/setupI18n';
    import { registerGlobComp } from '/@/components/registerGlobComp';
    
    // é¡¹ç›®çš„åˆå§‹åŒ–é…ç½®
    async function bootstrap() {
      // åˆ›å»ºåº”ç”¨å®ä¾‹
      const app = createApp(App);
      // é…ç½®å­˜å‚¨ä½¿ç”¨Pinia
      setupStore(app);
      // åˆå§‹åŒ–å†…éƒ¨ç³»ç»Ÿé…ç½®
      initAppConfigStore();
      // æ³¨å†Œå…¨å±€ç»„ä»¶
      registerGlobComp(app);
      // å¤šè¯­è¨€é…ç½®
      await setupI18n(app);
      // é…ç½®è·¯ç”±
      setupRouter(app);
      // è·¯ç”±å®ˆå«ã€æƒé™åˆ¤æ–­ã€åˆå§‹åŒ–ç¼“å­˜æ•°æ®
      setupRouterGuard(router);
      // æ³¨å†Œå…¨å±€æŒ‡ä»¤
      setupGlobDirectives(app);
      // é…ç½®å…¨å±€é”™è¯¯å¤„ç†
      setupErrorHandle(app);
      ...    
      
      app.mount('#app');
    }
    bootstrap();
    
    

`bootstrap()` æ‰§è¡Œæ—¶è°ƒç”¨äº†å¾ˆå¤šæ–¹æ³•ç”¨äºåˆå§‹åŒ–æ“ä½œï¼ŒåŒ…æ‹¬é…ç½®å­˜å‚¨ã€åŠ è½½ç³»ç»Ÿé…ç½®æ³¨å†Œã€æ³¨å†Œå…¨å±€ç»„ä»¶ã€å¤šè¯­è¨€é…ç½®ã€è·¯ç”±é…ç½®ã€è·¯ç”±å®ˆå«ã€æƒé™è¿‡æ»¤ã€æ³¨å†Œå…¨å±€æŒ‡ä»¤ç­‰ã€‚æ¥ä¸‹æ¥å°†å¿«é€Ÿæ¦‚è§ˆä¸‹å„æ–¹æ³•ï¼š

setupStore
----------

`src\store\index.ts` æ–‡ä»¶ä¸­å£°æ˜ `setupStore` æ–¹æ³•ï¼Œç”¨äºå°†åˆ›å»ºä¸€ä¸ª pinia æ ¹å­˜å‚¨å¹¶æ³¨å†Œåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚

    ...
    import { createPinia } from 'pinia'; 
    // åˆ›å»ºä¸€ä¸ª piniaï¼ˆæ ¹å­˜å‚¨ï¼‰
    const store = createPinia(); 
    export function setupStore(app: App<Element>) {
      // æ³¨å†Œåˆ°åº”ç”¨ç¨‹åº
      app.use(store);
    }
    

initAppConfigStore
------------------

`src\logics\initAppConfig.ts` æ–‡ä»¶ä¸­å£°æ˜ `initAppConfigStore` æ–¹æ³•ï¼Œç”¨äºåŠ è½½å¹¶å­˜å‚¨ å›½é™…åŒ–ã€ä¸»é¢˜é£æ ¼ã€é¡¹ç›®é…ç½®ã€é¡µé¢åŠ è½½ã€é¡µé¢çŠ¶æ€ã€é¡¶æ é…ç½®ã€èœå•é…ç½®ç­‰é¡¹ç›®ä¿¡æ¯ã€‚

    export function initAppConfigStore() {
      const localeStore = useLocaleStore(); // å¤šè¯­è¨€å›½é™…åŒ–
      const appStore = useAppStore(); // åº”ç”¨çŠ¶æ€(ä¸»é¢˜é£æ ¼ã€é¡¹ç›®é…ç½®ã€é¡µé¢åŠ è½½ã€é¡µé¢çŠ¶æ€ç­‰ç­‰)
      // é¡¹ç›®é…ç½® (ä¸»é¢˜é¢œè‰²ã€ä¸»é¢˜æ¨¡å¼ã€é¡¶æ é…ç½®ã€èœå•é…ç½®)
      let projCfg: ProjectConfig = Persistent.getLocal(PROJ_CFG_KEY) as ProjectConfig;
      projCfg = deepMerge(projectSetting, projCfg || {});
      ...
     
      // å­˜å‚¨é¡¹ç›®é…ç½®
      appStore.setProjectConfig(projCfg);
    
      // init dark mode  åˆå§‹åŒ–æš—é»‘æ¨¡å¼
      updateDarkTheme(darkMode);
      if (darkMode === ThemeEnum.DARK) {
         ...
      } else {
        ...
      }
      // init store  åˆå§‹åŒ–å›½é™…åŒ–å¤šè¯­è¨€
      localeStore.initLocale();
    
      // æ¸…ç†è¿‡æœŸçš„ç¼“å­˜
      setTimeout(() => {
        clearObsoleteStorage();
      }, 16);
    }
    
    

registerGlobComp
----------------

`src\components\registerGlobComp.ts`æ–‡ä»¶ä¸­å£°æ˜ `registerGlobComp` æ–¹æ³•,å…¨å±€æ³¨å†Œ antdvçš„Inputã€Layoutç»„ä»¶å’Œæ‰‹å†™çš„Buttonç»„ä»¶

    import { Button } from './Button';
    import { Input, Layout } from 'ant-design-vue';
    
    export function registerGlobComp(app: App) {
      // æ³¨å†Œ antdvçš„Inputã€Layoutç»„ä»¶å’Œæ‰‹å†™çš„Buttonç»„ä»¶
      app.use(Input).use(Button).use(Layout);
    }
    

setupI18n
---------

`src\locales\setupI18n.ts` æ–‡ä»¶ä¸­å£°æ˜ `setupI18n` æ–¹æ³•,åˆå§‹åŒ–å›½é™…åŒ–æ’ä»¶ `vue-i18n` å®ä¾‹å¹¶æ³¨å†Œåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚

    // å›½é™…åŒ–æ’ä»¶ vue-i18n é…ç½®é¡¹
    async function createI18nOptions(): Promise<I18nOptions> {
      const localeStore = useLocaleStoreWithOut(); // å›½é™…åŒ–æœ¬åœ°å­˜å‚¨
      const locale = localeStore.getLocale; // è¯­è¨€ç¯å¢ƒ/å½“å‰è¯­è¨€
      const defaultLocal = await import(`./lang/${locale}.ts`); // ä»æœåŠ¡å™¨ç«¯è·å–è¯­è¨€ç¿»è¯‘æ–‡ä»¶
      const message = defaultLocal.default?.message ?? {}; // æœ¬åœ°åŒ–çš„è¯­è¨€ç¯å¢ƒä¿¡æ¯
      ...
    
      return {
        legacy: false,
        locale, // è¯­è¨€ç¯å¢ƒ
        fallbackLocale: fallback, // é¢„è®¾çš„è¯­è¨€ç¯å¢ƒ
        // æœ¬åœ°åŒ–çš„è¯­è¨€ç¯å¢ƒä¿¡æ¯
        messages: {
          [locale]: message,
        },
        availableLocales: availableLocales, // ä»¥è¯æ³•é¡ºåºæ’åˆ—çš„ messages ä¸­çš„å¯ç”¨è¯­è¨€ç¯å¢ƒåˆ—è¡¨
        sync: true, // æ˜¯å¦å°†æ ¹çº§åˆ«è¯­è¨€ç¯å¢ƒä¸ç»„ä»¶æœ¬åœ°åŒ–è¯­è¨€ç¯å¢ƒåŒæ­¥ã€‚ å¦‚æœä¸º falseï¼Œåˆ™æ— è®ºæ ¹çº§åˆ«è¯­è¨€ç¯å¢ƒå¦‚ä½•ï¼Œéƒ½è¦ä¸ºæ¯ä¸ªç»„ä»¶è¯­è¨€ç¯å¢ƒè¿›è¡Œæœ¬åœ°åŒ–ã€‚
        silentTranslationWarn: true, // true - warning off  æ˜¯å¦å–æ¶ˆæœ¬åœ°åŒ–å¤±è´¥æ—¶è¾“å‡ºçš„è­¦å‘Šã€‚å¦‚æœä¸º trueï¼Œåˆ™ç¦æ­¢æœ¬åœ°åŒ–å¤±è´¥è­¦å‘Šã€‚
        missingWarn: false,
        silentFallbackWarn: true, // æ˜¯å¦åœ¨å›é€€åˆ° fallbackLocale æˆ– root æ—¶å–æ¶ˆè­¦å‘Šã€‚å¦‚æœä¸º trueï¼Œåˆ™ä»…åœ¨æ ¹æœ¬æ²¡æœ‰å¯ç”¨çš„è½¬æ¢æ—¶ç”Ÿæˆè­¦å‘Šï¼Œè€Œä¸æ˜¯åœ¨å›é€€æ—¶ã€‚
      };
    }
    
    // åˆå§‹åŒ–å›½é™…åŒ–å®ä¾‹
    export async function setupI18n(app: App) {
      // è·å–å›½é™…åŒ–æ’ä»¶ vue-i18n é…ç½®é¡¹
      const options = await createI18nOptions();
      i18n = createI18n(options) as I18n;
      app.use(i18n);
    }
    

setupRouter
-----------

`src\router\index.ts` æ–‡ä»¶ä¸­å£°æ˜ `setupRouter` æ–¹æ³•,åˆ›å»ºè·¯ç”±å®ä¾‹,åŠ è½½åˆå§‹è·¯ç”±åˆ—è¡¨ï¼Œæ³¨å†Œåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚

    // app router  åˆ›å»ºè·¯ç”±å®ä¾‹
    export const router = createRouter({
      history: createWebHashHistory(import.meta.env.VITE_PUBLIC_PATH), // åŸºäº hash çš„å†å²è®°å½•
      routes: basicRoutes as unknown as RouteRecordRaw[], // æ·»åŠ åˆ°è·¯ç”±çš„åˆå§‹è·¯ç”±åˆ—è¡¨ 
      scrollBehavior: () => ({ left: 0, top: 0 }), // åœ¨é¡µé¢ä¹‹é—´å¯¼èˆªæ—¶æ§åˆ¶æ»šåŠ¨çš„å‡½æ•°
    });
    
    
    // æ³¨å†Œè·¯ç”±
    export function setupRouter(app: App<Element>) {
      app.use(router);
    }
    
    

setupRouterGuard
----------------

`src\router\guard\index.ts` æ–‡ä»¶ä¸­å£°æ˜ `setupRouterGuard` æ–¹æ³•,åˆ›å»ºäº†å¤„ç†é¡µé¢åŠ è½½çŠ¶æ€ã€è·¯ç”±åˆ‡æ¢ã€é¡µé¢é¡¶éƒ¨è¿›åº¦æ¡ã€æƒé™éªŒè¯ã€èœå•åŠç³»ç»ŸçŠ¶æ€ç­‰å®ˆå«ã€‚

    export function setupRouterGuard(router: Router) {
      createPageGuard(router); // å¤„ç†é¡µé¢çŠ¶æ€
      createPageLoadingGuard(router); // å¤„ç†é¡µé¢åŠ è½½çŠ¶æ€
      createHttpGuard(router); // è·¯ç”±åˆ‡æ¢æ—¶å…³é—­å½“å‰é¡µé¢å®Œæˆè¯·æ±‚
      createScrollGuard(router); // è·¯ç”±åˆ‡æ¢å›åˆ°é¡¶éƒ¨
      createMessageGuard(router); // è·¯ç”±åˆ‡æ¢æ—¶å…³é—­æ¶ˆæ¯å®ä¾‹
      createProgressGuard(router); // é¡µé¢é¡¶éƒ¨è¿›åº¦æ¡
      createPermissionGuard(router); // è·¯ç”±åˆ‡æ¢æ—¶æƒé™éªŒè¯
      createParamMenuGuard(router); // èœå•å®ˆå«  
      createStateGuard(router); // ç³»ç»ŸçŠ¶æ€å®ˆå«- å½“ç”¨æˆ·æœªç™»å½•æ—¶ï¼Œè¿›å…¥ç™»å½•é¡µé¢å¹¶æ¸…é™¤å­˜å‚¨ä¸­çš„è®¤è¯ä¿¡æ¯
    }
    

setupErrorHandle
----------------

`src\logics\error-handle\index.ts` æ–‡ä»¶ä¸­å£°æ˜ `setupErrorHandle` æ–¹æ³•,é…ç½®å…¨å±€é”™è¯¯å¤„ç†ï¼Œç”¨äºç›‘æ§Vueå¼‚å¸¸ã€è„šæœ¬é”™è¯¯ã€promise å¼‚å¸¸ã€ é™æ€èµ„æºå¼‚å¸¸ç­‰ã€‚

    /**
     * Configure global error handling  é…ç½®å…¨å±€é”™è¯¯å¤„ç†
     * @param app
     */
    export function setupErrorHandle(app: App) {
      const { useErrorHandle } = projectSetting;
      if (!useErrorHandle) {
        return;
      }
      // Vue exception monitoring; Vueå¼‚å¸¸ç›‘æ§
      app.config.errorHandler = vueErrorHandler;
    
      // script error   è„šæœ¬é”™è¯¯ç›‘æ§
      window.onerror = scriptErrorHandler;
    
      //  promise exception  promise å¼‚å¸¸ç›‘æ§
      registerPromiseErrorHandler();
    
      // Static resource exception  é™æ€èµ„æºå¼‚å¸¸ç›‘æ§
      registerResourceErrorHandler();
    }
    

* * *

ğŸ‘‹ğŸ‘‹ æœ¬æ–‡ä¸»è¦æ¦‚è¿°äº†é¡¹ç›®å®ä¾‹åˆ›å»ºæ—¶åˆå§‹åŒ–çš„æµç¨‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†é€ä¸€åˆ†ææ¯ä¸ªæ¨¡å—çš„åŠŸèƒ½ã€‚

ä½œè€…ï¼š[Anduril](http://www.cnblogs.com/anduril/)  
  
ç®€ä¹¦ä¼ é€é—¨ï¼š[ç®€ä¹¦/Anduril](https://www.jianshu.com/u/Sw64xD)  
  
æ˜é‡‘ä¼ é€é—¨ï¼š[æ˜é‡‘/Andurils](https://juejin.cn/user/272334612084702)  
  
ä¸ªäººå°ç«™ï¼š[anduril.cn](http://anduril.cn/)  
  
æŠ€æœ¯åªæœ‰ä¸æ²‰æµ¸å…¶ä¸­æ‰èƒ½å¯¹å…¶æ›´åŠ å…¬æ­£çœ‹å¾…ï¼ æ²¡äº†ç‹‚çƒ­å’Œæµ®èºï¼Œå»ä½“ä¼šä¸‹å¼€æºä¸‹çš„è¯­æ³•é­…åŠ›ï¼è¿™é‡Œæ²¡æœ‰æŠ€æœ¯å®—æ•™çš„ç‹‚çƒ­å’Œé„™å¤·ï¼Œæ²¡æœ‰ç–¯ç‹‚çš„ä¸ªäººå´‡æ‹œï¼Œåªæ˜¯ä¸€ä¸ªæŠ€æœ¯äººæ¢ç´¢ä¹‹è·¯ä¸Šå¯¹äºç¾ä¸½ä¸ä¸‘é™‹çš„éšç¬”å’Œæ„Ÿæ‚Ÿï¼  
  
æœ¬æ–‡ç‰ˆæƒå½’ä½œè€…å’Œåšå®¢å›­å…±æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œä¸”åœ¨æ–‡ç« é¡µé¢æ˜æ˜¾ä½ç½®ç»™å‡ºåŸæ–‡è¿æ¥ï¼Œå¦åˆ™ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©ã€‚

*   åˆ†ç±» [0x02.FrontEnd](https://www.cnblogs.com/anduril/category/729635.html)
*   æ ‡ç­¾ [vue](https://www.cnblogs.com/anduril/tag/vue/) , [vben-admin](https://www.cnblogs.com/anduril/tag/vben-admin/)