---
layout: post
title: "ä¸€æ–‡ææ‡‚â”‚ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿå¦‚ä½•è§£å†³è·¨åŸŸï¼Ÿ"
date: "2022-07-15T06:23:20.354Z"
---
ä¸€æ–‡ææ‡‚â”‚ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿå¦‚ä½•è§£å†³è·¨åŸŸï¼Ÿ
==================

![ä¸€æ–‡ææ‡‚â”‚ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿå¦‚ä½•è§£å†³è·¨åŸŸï¼Ÿ](https://img2022.cnblogs.com/blog/2894189/202207/2894189-20220715140934379-2089266579.png) è§£å†³å¥½è·¨åŸŸï¼Œè®©æˆ‘ä»¬æ„‰å¿«çš„å¼€å‘å§

> ç›®å½•
> 
> *   [ğŸˆ ä»€ä¹ˆæ˜¯è·¨åŸŸ](#-ä»€ä¹ˆæ˜¯è·¨åŸŸ)
> *   [ğŸˆ è·¨åŸŸåœºæ™¯](#-è·¨åŸŸåœºæ™¯)
> *   [ğŸˆ è§£å†³è·¨åŸŸçš„å››ç§æ–¹å¼](#-è§£å†³è·¨åŸŸçš„å››ç§æ–¹å¼)

ğŸˆ ä»€ä¹ˆæ˜¯è·¨åŸŸ
--------

*   **åŸŸï¼š** æ˜¯æŒ‡æµè§ˆå™¨ä¸èƒ½æ‰§è¡Œå…¶ä»–ç½‘ç«™çš„è„šæœ¬
*   **è·¨åŸŸï¼š** å®ƒæ˜¯ç”±æµè§ˆå™¨çš„ **åŒæºç­–ç•¥** é€ æˆçš„,æ˜¯æµè§ˆå™¨å¯¹ `JavaScript` å®æ–½çš„å®‰å…¨é™åˆ¶ï¼Œæ‰€è°“åŒæºï¼ˆå³æŒ‡åœ¨åŒä¸€ä¸ªåŸŸï¼‰å°±æ˜¯ä¸¤ä¸ªé¡µé¢å…·æœ‰ç›¸åŒçš„åè®® `protocol`ï¼Œä¸»æœº `host` å’Œç«¯å£å· `port` åˆ™å°±ä¼šé€ æˆ **è·¨åŸŸ**

![](https://img2022.cnblogs.com/blog/2894189/202207/2894189-20220715140831350-577924459.jpg)

åŸŸåç»„æˆ

ğŸˆ è·¨åŸŸåœºæ™¯
-------

*   åœºæ™¯çš„è·¨åŸŸåœºæ™¯æœ‰å“ªäº›ï¼Œè¯·å‚è€ƒä¸‹è¡¨

å½“å‰url

è¯·æ±‚url

æ˜¯å¦è·¨åŸŸ

åŸå› 

`http://www.autofelix.cn`

`http://www.autofelix.cn/api.php`

**å¦**

åè®®/åŸŸå/ç«¯å£éƒ½ç›¸åŒ

`http://www.autofelix.cn`

`https://www.autofelix.cn/api.php`

**æ˜¯**

åè®®ä¸åŒ

`http://www.autofelix.cn`

`http://www.rabbit.cn`

**æ˜¯**

ä¸»åŸŸåä¸åŒ

`http://www.autofelix.cn`

`http://api.autofelix.cn`

**æ˜¯**

å­åŸŸåä¸åŒ

`http://www.autofelix.cn:80`

`http://www.autofelix.cn:8080`

**æ˜¯**

ç«¯å£ä¸åŒ

ğŸˆ è§£å†³è·¨åŸŸçš„å››ç§æ–¹å¼
------------

*   **nginxçš„åå‘ä»£ç†**
*   ä½¿ç”¨ `nginx` åå‘ä»£ç†å®ç°è·¨åŸŸï¼Œæ˜¯æœ€ç®€å•çš„è·¨åŸŸæ–¹å¼
*   åªéœ€è¦ä¿®æ”¹ `nginx` çš„é…ç½®å³å¯è§£å†³è·¨åŸŸé—®é¢˜ï¼Œæ”¯æŒæ‰€æœ‰æµè§ˆå™¨ï¼Œæ”¯æŒ`session`ï¼Œä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“æœåŠ¡å™¨æ€§èƒ½

    // nginxé…ç½®
    server {
        listen       81;
        server_name  www.domain1.com;
        location / {
            proxy_pass   http://www.domain2.com:8080;  #åå‘ä»£ç†
            proxy_cookie_domain www.domain2.com www.domain1.com; #ä¿®æ”¹cookieé‡ŒåŸŸå
            index  index.html index.htm;
     
            # å½“ç”¨webpack-dev-serverç­‰ä¸­é—´ä»¶ä»£ç†æ¥å£è®¿é—®nignxæ—¶ï¼Œæ­¤æ—¶æ— æµè§ˆå™¨å‚ä¸ï¼Œæ•…æ²¡æœ‰åŒæºé™åˆ¶ï¼Œä¸‹é¢çš„è·¨åŸŸé…ç½®å¯ä¸å¯ç”¨
            add_header Access-Control-Allow-Origin http://www.domain1.com;  #å½“å‰ç«¯åªè·¨åŸŸä¸å¸¦cookieæ—¶ï¼Œå¯ä¸º*
            add_header Access-Control-Allow-Credentials true;
        }
    }
    

*   **jsonpè¯·æ±‚**
*   `jsonp` æ˜¯æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯è·¨æºé€šä¿¡çš„å¸¸ç”¨æ–¹æ³•ã€‚æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ç®€å•é€‚ç”¨ï¼Œå…¼å®¹æ€§å¥½ `å…¼å®¹ä½ç‰ˆæœ¬IE`ï¼Œç¼ºç‚¹æ˜¯åªæ”¯æŒ `get` è¯·æ±‚ï¼Œä¸æ”¯æŒ `post` è¯·æ±‚
*   åŸç†æ—¶ç½‘é¡µé€šè¿‡æ·»åŠ ä¸€ä¸ª `<script>` å…ƒç´ ï¼Œå‘æœåŠ¡å™¨è¯·æ±‚ `json` æ•°æ®ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œå°†æ•°æ®æ”¾åœ¨ä¸€ä¸ªæŒ‡å®šåå­—çš„å›è°ƒå‡½æ•°çš„å‚æ•°ä½ç½®ä¼ å›æ¥

    //jqueryå®ç°
    <script>
    $.getJSON('http://autofelix.com/api.php&callback=?', function(res) {
         // å¤„ç†è·å¾—çš„æ•°æ®
         console.log(res)
    });
    </script>
    

*   **åç«¯è¯­è¨€ä»£ç†**
*   å¯ä»¥é€šè¿‡ä¸€ç§æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„è¯­è¨€ä¸­è½¬ä¸€ä¸‹ï¼Œé€šè¿‡åç«¯è¯­è¨€å»è¯·æ±‚èµ„æºï¼Œç„¶åå†è¿”å›æ•°æ®
*   æ¯”å¦‚ `http://www.autofelix.cn` éœ€è¦è°ƒç”¨ `http://api.autofelix.cn/userinfo` å»è·å–ç”¨æˆ·æ•°æ®ï¼Œå› ä¸ºå­åŸŸåä¸åŒï¼Œä¼šæœ‰è·¨åŸŸé™åˆ¶
*   å¯ä»¥å…ˆè¯·æ±‚ `http://www.autofelix.cn` ä¸‹çš„ `php` æ–‡ä»¶ï¼Œæ¯”å¦‚ `http://www.autofelix.cn/api.php`ï¼Œç„¶åå†é€šè¿‡è¯¥ `php` æ–‡ä»¶è¿”å›æ•°æ®

    // api.php æ–‡ä»¶ä¸­çš„ä»£ç 
    public function getCurl($url, $timeout = 5)
    {
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_HEADER, 0);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_TIMEOUT, $timeout);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE);
        $result = curl_exec($ch);
        curl_close($ch);
    
        return $result;
    }
    
    $result = getCurl('http://api.autofelix.cn/userinfo');
    
    return $result;
    

*   **åç«¯è¯­è¨€çš„è®¾ç½®**
*   ä¸»è¦é€šè¿‡åç«¯è¯­è¨€ä¸»åŠ¨è®¾ç½®è·¨åŸŸè¯·æ±‚ï¼Œè¿™é‡Œä»¥ `php` ä½œä¸ºæ¡ˆä¾‹

    // å…è®¸æ‰€æœ‰åŸŸåè®¿é—®
    header('Access-Control-Allow-Origin: *');
    // å…è®¸å•ä¸ªåŸŸåè®¿é—®
    header('Access-Control-Allow-Origin: https://autofelix.com');
    // å…è®¸å¤šä¸ªè‡ªå®šä¹‰åŸŸåè®¿é—®
    static public $originarr = [
       'https://autofelix.com',
       'https://baidu.com',
       'https://csdn.net',
    ];
    
    // è·å–å½“å‰è·¨åŸŸåŸŸå
    $origin = isset($_SERVER['HTTP_ORIGIN']) ? $_SERVER['HTTP_ORIGIN'] : '';
    if (in_array($origin, self::$originarr)) {
        // å…è®¸ $originarr æ•°ç»„å†…çš„ åŸŸåè·¨åŸŸè®¿é—®
        header('Access-Control-Allow-Origin:' . $origin);
        // å“åº”ç±»å‹
        header('Access-Control-Allow-Methods:POST,GET');
        // å¸¦ cookie çš„è·¨åŸŸè®¿é—®
        header('Access-Control-Allow-Credentials: true');
        // å“åº”å¤´è®¾ç½®
        header('Access-Control-Allow-Headers:x-requested-with,Content-Type,X-CSRF-Token');
    }