---
layout: post
title: "[react] ä»€ä¹ˆæ˜¯è™šæ‹Ÿdomï¼Ÿè™šæ‹Ÿdomæ¯”æ“ä½œåŸç”Ÿdomè¦å¿«å—ï¼Ÿè™šæ‹Ÿdomæ˜¯å¦‚ä½•è½¬å˜æˆçœŸå®domå¹¶æ¸²æŸ“åˆ°é¡µé¢çš„?"
date: "2022-06-09T11:15:10.476Z"
---
\[react\] ä»€ä¹ˆæ˜¯è™šæ‹Ÿdomï¼Ÿè™šæ‹Ÿdomæ¯”æ“ä½œåŸç”Ÿdomè¦å¿«å—ï¼Ÿè™šæ‹Ÿdomæ˜¯å¦‚ä½•è½¬å˜æˆçœŸå®domå¹¶æ¸²æŸ“åˆ°é¡µé¢çš„?
------------------------------------------------------------

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163742187-416297054.png)

å£¹ â€ å¼•
=====

è™šæ‹Ÿ`DOM`ï¼ˆVirtual DOMï¼‰åœ¨å‰ç«¯é¢†åŸŸä¹Ÿç®—æ˜¯è€ç”Ÿå¸¸è°ˆçš„è¯é¢˜äº†ï¼Œè‹¥ä½ äº†è§£è¿‡`vue`æˆ–è€…`react`ä¸€å®šé¿ä¸å¼€è¿™ä¸ªè¯é¢˜ï¼Œå› æ­¤è™šæ‹Ÿ`DOM`ä¹Ÿç®—æ˜¯é¢è¯•ä¸­å¸¸é—®çš„ä¸€ä¸ªç‚¹ï¼Œé‚£ä¹ˆé€šè¿‡æœ¬æ–‡ï¼Œä½ å°†äº†è§£åˆ°å¦‚ä¸‹å‡ ç‚¹ï¼š

*   è™šæ‹Ÿ`DOM`ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿ
*   è™šæ‹Ÿ`DOM`çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
*   è™šæ‹Ÿ`DOM`çš„æ€§èƒ½æ¯”æ“ä½œåŸç”Ÿ`DOM`è¦å¿«å—ï¼Ÿ
*   `react`ä¸­çš„è™šæ‹Ÿ`DOM`æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Ÿ
*   `react`æ˜¯å¦‚ä½•å°†è™šæ‹Ÿ`DOM`è½¬å˜æˆçœŸå®`dom`çš„ï¼Ÿ

é˜…è¯»å‰å»ºè®®ä¸æé†’ï¼š

*   æœ¬ç¯‡æ–‡ç« å¯èƒ½æ¯”è¾ƒé•¿ï¼Œå»ºè®®æŒ‘ä¸€ä¸ªç©ºé—²çš„æ—¶é—´æ®µé˜…è¯»ï¼Œè¿˜è¯·ä¿æŒè€å¿ƒï¼Œæˆ‘å°†ä»¥é€šä¿—æ˜“æ‡‚çš„å£å»å¸¦ä½ äº†è§£è¿™äº›é—®é¢˜ã€‚
*   æœ¬æ–‡æºç åˆ†æéƒ¨åˆ†`react`ç‰ˆæœ¬ä¸º`17.0.2`ï¼Œæ— é¡»æ‹…å¿ƒä½ç‰ˆæœ¬æºç åˆ†æå¯¹ä½ ä¹‹åé¢è¯•å¸®åŠ©ä¸å¤§çš„é—®é¢˜ã€‚
*   å¦‚æœå¯ä»¥ï¼Œæ³¡ä¸Šä¸€æ¯æ€§æ¸©çš„èŒ¶æˆ–è€…å’–å•¡ï¼Œä¿æŒä¸€ä¸ªèˆ’æœçš„å§¿åŠ¿ä¼šè®©ä½ é˜…è¯»æ›´åŠ æ„‰å¿«ã€‚

é‚£ä¹ˆæœ¬æ–‡å¼€å§‹ã€‚

è´° â€ åœ¨è™šæ‹Ÿdomä¹‹å‰
============

åœ¨èŠè™šæ‹Ÿ`DOM`ä¹‹å‰ï¼Œæˆ‘è¿˜æ˜¯æƒ³å…ˆèŠèŠåœ¨æ²¡æœ‰è™šæ‹Ÿ`DOM`æ¦‚å¿µçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•æ›´æ–°é¡µé¢çš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘å°†å…ˆå¼•å‡ºå‰ç«¯æ¡†æ¶ï¼ˆåº“ï¼‰çš„å‘å±•å²ï¼Œé€šè¿‡è¿™ä¸ªå˜è¿è¿‡ç¨‹ä¹Ÿä¾¿äºå¤§å®¶ç†è§£è™šæ‹Ÿdomçš„å‡ºç°åˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚

### è´° â€ å£¹ çŸ³å™¨æ—¶ä»£jqery

å…¶å®åœ¨15å¹´ä»¥åŠæ›´æ—©ä¹‹å‰ï¼Œå‰ç«¯é¢è¯•æ¶‰åŠåˆ°æ€§èƒ½ä¼˜åŒ–é—®é¢˜ï¼Œå¾€å¾€éƒ½ä¼šæåˆ°**å°½å¯èƒ½å°‘çš„æ“ä½œ`DOM`**è¿™ä¸€ç‚¹ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåœ¨åŸç”ŸJSçš„å¹´ä»£ï¼Œå‰ç«¯é¡¹ç›®æ–‡ä»¶éƒ½æ˜ç¡®åˆ†ä¸º`htmlã€js`ä¸`css`ä¸‰ç§ï¼Œæˆ‘ä»¬åœ¨`js`ä¸­è·å–`DOM`ï¼Œå¹¶ä¸ºå…¶ç»‘å®šäº‹ä»¶ï¼Œé€šè¿‡**äº‹ä»¶ç›‘å¬**æ„ŸçŸ¥ç”¨æˆ·åœ¨UIå±‚çš„æ“ä½œï¼Œå¹¶éšä¹‹æ›´æ–°`DOM`ï¼Œä»è€Œè¾¾åˆ°é¡µé¢äº¤äº’çš„ç›®çš„ï¼š

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163746500-534884916.png)

è€Œåœ¨åé¢ï¼Œ`jqery`çš„å‡ºç°æå¤§ç®€åŒ–äº†å¼€å‘è€…æ“ä½œ`DOM`çš„æˆæœ¬ï¼ŒæŠ¹å¹³äº†å½“æ—¶ä¸åŒæµè§ˆå™¨æ“ä½œ`DOM`çš„`API`å·®å¼‚ï¼Œä¸ºå½“æ—¶è‹¦äº`ie`ä»¥åŠä¸åŒæµè§ˆå™¨è‡ªç ”`API`çš„å¼€å‘è€…è§£å†³äº†ä¸å°‘å…¼å®¹æ€§é—®é¢˜ï¼Œå½“ç„¶`JQ`ä¹Ÿå¹¶æœªæ”¹å˜å¼€å‘è€…åœ¨`JS`å±‚ç›´æ¥æ“ä½œ`DOM`è¿™ä¸€ç°çŠ¶ã€‚

é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¯´è¦å°½å¯èƒ½å°‘çš„æ“ä½œ`DOM`å‘¢ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°é‡ç»˜ä¸å›æµä¸¤ä¸ªæ¦‚å¿µï¼Œæ¯”å¦‚å•çº¯ä¿®æ”¹é¢œè‰²å°±ä¼šå¼•å‘é‡ç»˜ï¼Œåˆ é™¤æˆ–æ–°å¢ä¸€ä¸ª`DOM`èŠ‚ç‚¹å°±ä¼šå¼•å‘å›æµå’Œé‡ç»˜ï¼Œç”¨æˆ·è™½ç„¶æ— æ³•æ„ŸçŸ¥è¿™ä¸ªè¿‡ç¨‹ï¼Œä½†å¯¹äºæµè§ˆå™¨è€Œè¨€ä¹Ÿå­˜åœ¨æ¶ˆè€—æ€§èƒ½ã€‚æ‰€ä»¥é’ˆå¯¹äºå›æµï¼Œåœ¨æ­¤ä¹‹ååˆæå‡ºäº†`DocumentFragment`æ–‡æ¡£å¯¹è±¡ä»¥ä¼˜åŒ–å¤šæ¬¡æ“ä½œ`DOM`çš„æ–¹æ¡ˆã€‚ç®€å•ç†è§£å°±æ˜¯ï¼Œå‡å¦‚æˆ‘è¦ä¾æ¬¡æ›¿æ¢äº”ä¸ª`li`èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª`DocumentFragment`å¯¹è±¡ä¿å­˜è¿™äº”ä¸ªèŠ‚ç‚¹ï¼Œç„¶åä¸€æ¬¡æ€§æ›¿æ¢ã€‚

å…³äºèŠ‚æµä¸é‡ç»˜ï¼Œè‹¥æœ‰å…´è¶£å¯è¯»è¯»åšä¸»[é¡µé¢ä¼˜åŒ–ï¼Œè°ˆè°ˆé‡ç»˜(repaint)å’Œå›æµ(reflow)](https://www.cnblogs.com/echolun/p/10105223.html)ä¸€æ–‡ã€‚

å…³äº`DocumentFragment`å¯è¯»è¯»åšä¸»[é¡µé¢ä¼˜åŒ–ï¼ŒDocumentFragmentå¯¹è±¡è¯¦è§£](https://www.cnblogs.com/echolun/p/10098752.html)ä¸€æ–‡ã€‚

è¿™äº›éƒ½æ˜¯æ—¶ä»£çš„çœ¼æ³ªï¼Œç°åœ¨åº”è¯¥å¾ˆå°‘ä¼šæœ‰äººæåŠï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚

### è´° â€ è´° é’é“œæ—¶ä»£angularjs

åœ¨`JQ`ä¹‹åï¼Œ`angularjs`ï¼ˆè¿™é‡ŒæŒ‡angularjs1è€Œéangularï¼‰æ¨ªç©ºå‡ºä¸–ï¼Œä¸€æ‹›åŒå‘ç»‘å®šåœ¨å½“æ—¶æ›´æ˜¯æƒŠä¸ºå¤©äººï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œ`angularjs`çš„æ¨¡æ¿è¯­æ³•ä¹Ÿæ ¼å¤–æƒŠè‰³ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰ä¸æ•°æ®æŒ‚é’©çš„èŠ‚ç‚¹é€šè¿‡`{{}}`åŒ…è£¹ï¼ˆvueåœ¨æ—©æœŸè®¾è®¡ä¸Šå¤§é‡å€Ÿé‰´äº†angularjsï¼‰ï¼Œæ¯”å¦‚ï¼š

    <span>{{vm.name}}</span>
    

ä¹‹å `view` è§†å›¾å±‚å°±è‡ªåŠ¨ä¸ `Model` æ•°æ®å±‚è¿›è¡ŒæŒ‚é’©ï¼ˆMVCé‚£ä¸€å¥—ï¼‰ï¼Œåªè¦ `Model` å±‚æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œ`view` å±‚ä¾¿è‡ªåŠ¨æ›´æ–°ã€‚`angularjs` çš„è¿™ç§åšæ³•ï¼Œå½»åº•å°†å¼€å‘è€…ä»æ“ä½œ `DOM` ä¸Šè§£æ”¾äº†å‡ºæ¥ï¼ˆä¸ºjqæ²¡è½åŸ‹ä¸‹ä¼ç¬”ï¼‰ï¼Œè‡ªæ­¤ä¹‹åå¼€å‘è€…åªç”¨ä¸“æ³¨ `Model` å±‚çš„æ•°æ®åŠ å·¥ä»¥åŠä¸šåŠ¡å¤„ç†ï¼Œè‡³äºé¡µé¢å¦‚ä½•æ¸²æŸ“å…¨æƒäº¤ç»™ `angularjs` åº•å±‚å¤„ç†å³å¥½äº†ã€‚

ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`angularjs` åœ¨å½“æ—¶å¹¶æ²¡æœ‰è™šæ‹Ÿ`dom`çš„æ¦‚å¿µï¼Œé‚£å®ƒæ˜¯æ€ä¹ˆåšæ„ŸçŸ¥æ•°æ®å±‚å˜åŒ–ä»¥åŠæ›´æ–°è§†å›¾å±‚çš„å‘¢ï¼Ÿ`angularjs`æœ‰ä¸€å¥—è„æ£€æµ‹æœºåˆ¶`$digest`ï¼Œ`html`ä¸­å‡¡æ˜¯ä½¿ç”¨äº†æ¨¡æ¿è¯­æ³•`{{}}`æˆ–è€…`ng-bind`æŒ‡ä»¤çš„éƒ¨åˆ†ï¼Œéƒ½ä¼šè¢«åŠ å…¥åˆ°è„æ£€æµ‹çš„`warchers`åˆ—è¡¨ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¹‹ååªè¦ç”¨æˆ·é€šè¿‡`ng-clickï¼ˆä¸ä¼ ç»Ÿclickä¸åŒï¼Œå†…ç½®ç»‘å®šäº†è§¦å‘è„æ£€æµ‹çš„æœºåˆ¶ï¼‰`ç­‰æ–¹æ³•æ”¹å˜äº†`Model`çš„æ•°æ®ï¼Œ`angularjs`å°±ä¼šä»é¡¶å±‚`rootScope`å‘ä¸‹é€’å½’ï¼Œä¾æ¬¡è®¿é—®æ¯ä¸ªå­`scope`ä¸­çš„`warchers`åˆ—è¡¨ï¼Œå¹¶å¯¹å…¶ä¸­ç›‘å¬çš„éƒ¨åˆ†åšæ–°æ—§å¯¹æ¯”ï¼Œå¦‚æœä¸åŒåˆ™è¿›è¡Œæ•°æ®æ›¿æ¢ï¼Œä»¥åŠ`DOM`å±‚çš„æ›´æ–°ã€‚

ä½†æ˜¯ä½ è¦æƒ³æƒ³ï¼Œä¸€ä¸ªåº”ç”¨é‚£ä¹ˆå¤§çš„ç»“æ„ï¼Œåªè¦æŸä¸€ä¸ªæ•°æ®å˜åŒ–äº†å°±å¾—ä»é¡¶å±‚å‘ä¸‹å¯¹æ¯”Nä¸ªå­ `scope` ä¸­ `warchers` ä¸‹çš„æ‰€æœ‰ç›‘å¬å¯¹è±¡ï¼Œå…¨é‡å¯¹æ¯”çš„æ€§èƒ½æœ‰å¤šå·®å¯æƒ³è€ŒçŸ¥ï¼Œ`angularjs` è‡ªèº«ä¹Ÿæ„è¯†åˆ°äº†è¿™ç‚¹ï¼Œæ‰€ä»¥ä¹‹åç›´æ¥æ”¾å¼ƒäº† `angularjs` çš„ç»´æŠ¤è½¬è€Œæ–°å¼€äº† `angular` é¡¹ç›®ã€‚

å¯¹äº `angularjs` è„æ£€æµ‹æ„Ÿå…´è¶£å¯ä»¥è¯»è¯»åšä¸»[æ·±å…¥äº†è§£angularjsä¸­çš„ğ‘‘ğ‘–ğ‘”ğ‘’ğ‘ ğ‘¡ä¸applyæ–¹æ³•ï¼Œä»åŒºåˆ«èŠåˆ°ä½¿ç”¨ä¼˜åŒ–](https://www.cnblogs.com/echolun/p/11988597.html)ä¸€æ–‡ï¼ŒåŒæ ·æ˜¯æ—¶ä»£çš„çœ¼æ³ªäº†ã€‚

### è´° â€ å é“å™¨æ—¶ä»£reactä¸vue

å¦‚æœä» `angularjs` è½¬åˆ° `vue` ï¼Œä½ ä¼šå‘ç°æ—©æœŸ`vue`çš„æ¨¡æ¿è¯­æ³•ã€æŒ‡ä»¤ï¼ŒåŒå‘ç»‘å®šç­‰å¾ˆå¤šçµæ„Ÿå…¶å®éƒ½å€Ÿé‰´äº†`angularjs`ï¼Œä½†åœ¨æ›´æ–°æœºåˆ¶ä¸Šï¼Œ`vue` å¹¶ä¸æ˜¯ä¸€ä¸ªæ”¹åŠ¨ç‰µåŠ¨å…¨èº«ï¼Œè€Œæ˜¯ç»„ä»¶å‡ç‹¬ç«‹æ›´æ–°ã€‚`react` ä¸ `vue` ä¸€æ ·ç›¸å¯¹ `angularjs` ä¹Ÿæ˜¯å±€éƒ¨æ›´æ–°ï¼Œåªæ˜¯ `react` ä¸­çš„å±€éƒ¨æ˜¯ä»¥å½“å‰ç»„ä»¶ä¸ºæ ¹ä»¥åŠä¹‹ä¸‹çš„æ‰€æœ‰å­ç»„ä»¶ã€‚

æ‰“ä¸ªæ¯”æ–¹ï¼Œå¦‚æœç»„ä»¶ `A` çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆ `A` çš„æ‰€æœ‰å­ç»„ä»¶é»˜è®¤éƒ½ä¼šè§¦å‘æ›´æ–°ï¼Œå³ä½¿å­ç»„ä»¶çš„`props`æœªå‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥å¯¹äº`react`æˆ‘ä»¬éœ€è¦ä½¿ç”¨ `PureComponent`ã€`shouldComponentUpdate` ä»¥åŠ `memo` æ¥é¿å…è¿™ç§åœºæ™¯ä¸‹çš„å¤šä½™æ¸²æŸ“ã€‚è€Œåœ¨æ›´æ–°ä½“ç³»ä¸­ï¼Œ`react` ä¸ `vue` éƒ½å¼•å…¥äº†è™šæ‹Ÿ `DOM` çš„æ¦‚å¿µï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯æœ¬æ–‡éœ€è¦æ¢è®¨çš„é‡ç‚¹ã€‚

æˆ‘ä»¬å…ˆæ€»ç»“ä¸‹ä¸Šè¿°çš„è§‚ç‚¹ï¼š

`js` å’Œ `jq`ï¼šç ”å‘åœ¨ä¸“æ³¨ä¸šåŠ¡çš„åŒæ—¶ï¼Œè¿˜è¦äº²è‡ªæ“ä½œ `dom`ã€‚

`angularjsç‰ˆæœ¬1`ï¼šå°†ç ”å‘ä»æ“ä½œ `dom` ä¸­è§£è„±äº†å‡ºæ¥ï¼Œæ›´æ–° `dom` äº¤ç”± `angularjs` åº•å±‚å®ç°ï¼Œè¿™ä¸€å¥—æœºåˆ¶ç”±è„æ£€æµ‹æœºåˆ¶æ‰€æ”¯æ’‘ã€‚

`react/vue`ï¼šåŒæ ·ç”±åº•å±‚æ›´æ–° `dom`ï¼Œåªæ˜¯åœ¨æ­¤ä¹‹å‰å¤šäº†è™šæ‹Ÿ`dom`çš„å¯¹æ¯”ï¼Œå…ˆå¯¹æ¯”å†æ›´æ–°ï¼Œä»¥æ­¤è¾¾åˆ°æœ€å°æ›´æ–°ç›®çš„ã€‚

æ‰€ä»¥ç›¸å¯¹ä¼ ç»Ÿæ›´æ–° `dom` çš„ç­–ç•¥ï¼Œè™šæ‹Ÿ`dom`çš„æ›´æ–°å¦‚ä¸‹ï¼š

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163749516-249351160.png)

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ç«™åœ¨å®è§‚çš„è§’åº¦è§£é‡Šäº†å‰ç«¯æ¡†æ¶çš„å˜è¿ï¼Œä»¥åŠæœ‰è™šæ‹Ÿ`dom`å‰åæˆ‘ä»¬å¦‚ä½•æ›´æ–°`dom`ï¼Œä¹Ÿè®¸åˆ°è¿™é‡Œä½ çš„è„‘ä¸­éšçº¦å¯¹äºè™šæ‹Ÿ`dom`æœ‰äº†ä¸€ä¸æ„Ÿæ‚Ÿï¼Œä½†åˆä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œè™šæ‹Ÿ`dom`åˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œåˆ«ç€æ€¥ï¼Œæ¥ä¸‹æ¥æ‰æ˜¯è™šæ‹Ÿ`dom`çš„æ­£é¤ï¼Œæˆ‘ä»¬æ¥ç€èŠã€‚

å â€ ä»€ä¹ˆæ˜¯è™šæ‹ŸDOMï¼Ÿ
=============

æœ¬æ–‡å°†é»˜è®¤ä½ æœ‰ `react` æˆ–è€… `vue` çš„å¼€å‘ç»å†ï¼Œå½“ç„¶æœ¬æ–‡å‡ºå‘ç‚¹è¿˜æ˜¯ä»¥`react`ä¸ºä¸»ã€‚

ç†Ÿæ‚‰ `react` çš„åŒå­¦å¯¹äº `React.createElement` æ–¹æ³•ä¸€å®šä¸ä¼šé™Œç”Ÿï¼Œå®ƒç”¨äºåˆ›å»º`reactNode`ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š

    /*
    * component ç»„ä»¶åï¼Œä¸€ä¸ªæ ‡ç­¾ä¹Ÿå¯ä»¥ç†è§£æˆä¸€ä¸ªæœ€åŸºç¡€çš„ç»„ä»¶
    * props å½“å‰ç»„ä»¶çš„å±æ€§ï¼Œæ¯”å¦‚classï¼Œæˆ–è€…å…¶å®ƒå±æ€§
    * children ç»„ä»¶çš„å­ç»„ä»¶ï¼Œå°±åƒæ ‡ç­¾å¥—æ ‡ç­¾
    */
    React.createElement(component, props, ...children)
    

æ¯”å¦‚æˆ‘ä»¬å®šä¸€ä¸ªæœ€ç®€å•çš„`html`ç‰‡æ®µï¼š

    <span className='span'>hello echo</span>
    

ç”¨`React.createElement`è¡¨ç¤ºå¦‚ä¸‹ï¼š

    React.createElement('div', {className:'span'}, 'hello echo');
    

è¿™æ ·çœ‹å¥½åƒä¹Ÿæ²¡ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ˜¯å‡å®šæˆ‘ä»¬`dom`å­˜åœ¨åµŒå¥—å…³ç³»ï¼š

    <span className='span'>
      <span>
        hello echo
      </span>
    </span>
    

ç”¨`React.createElement`è¡¨ç¤ºå°±ç›¸å¯¹æ¯”è¾ƒéº»çƒ¦äº†ï¼Œä½ éœ€è¦åœ¨`createElement`ä¸­ä¸æ–­åµŒå¥—ï¼š

    React.createElement('span', {className:'span'}, React.createElement("span", null, "hello echo"));
    

è¿™è¿˜ä»…ä»…æ˜¯ä¸¤å±‚åµŒå¥—ï¼Œå®é™…å¼€å‘ä¸­`dom`ç»“æ„å¾€å¾€è¦å¤æ‚çš„å¤šï¼Œå› æ­¤`react`ä¸­æˆ‘ä»¬å¸¸å¸¸æ¨èç›´æ¥ä½¿ç”¨`jsx`æ–‡ä»¶å®šä¹‰ä¸šåŠ¡é€»è¾‘ä»¥åŠ`html`ç‰‡æ®µã€‚

æˆ‘ä»¬å¯ä»¥å°†`jsx`ä¸­å®šä¹‰çš„`html`æ¨¡æ¿ç†è§£æˆ`React.createElement`çš„è¯­æ³•ç³–ï¼Œå®ƒæ–¹ä¾¿äº†å¼€å‘è€…ä»¥`html`çš„ä¹ æƒ¯å»å®šä¹‰`reactNode`ç‰‡æ®µï¼Œè€Œåœ¨ç¼–è¯‘ä¹‹åï¼Œè¿™äº›`reactNode`æœ¬è´¨ä¸Šè¿˜æ˜¯ä¼šè¢«è½¬å˜æˆ`React.createElement`æ‰€åˆ›å»ºçš„å¯¹è±¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç†è§£ä¸ºï¼š

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163751367-120912735.png)

ä¸ºæ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥å°†`React.createElement`åˆ›å»ºå¯¹è±¡ç»“æ„æŠ½è±¡ä¸ºï¼š

    const VitrualDom = {
      type: 'span',
      props: {
        className: 'span'
      },
      children: [{
        type: 'span',
        props: {},
        children: 'hello echo'
      }]
    }
    

è¯´åˆ°åº•ï¼Œè¿™ä¸ªå°±æ˜¯ä¼ é€’ç»™`React.createElement`çš„ç»“æ„ï¼Œè€Œ`React.createElement`æ¥æ”¶åç”Ÿæˆçš„æ•°æ®ï¼Œå…¶å®æ‰æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„è™šæ‹Ÿ`dom`ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•å®šä¸€ä¸ª`react`ç»„ä»¶ï¼Œæ¥æŸ¥çœ‹è™šæ‹Ÿ`dom`çœŸæ­£çš„ç»“æ„ï¼š

    class C extends React.PureComponent {
      render() {
        console.log(this.props.children);
        return <div>{this.props.children}</div>;
      }
    }
    
    class P extends Component {
      render() {
        return (
          <C>
            <span className="span">
              <span>hello echo</span>
            </span>
          </C>
        );
      }
    }
    

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163753123-1673233804.png)

é‚£ä¹ˆåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ææ¸…æ¥šäº†è™šæ‹Ÿ`DOM`ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œæ‰€è°“è™šæ‹Ÿ`DOM`å…¶å®åªæ˜¯ä¸€ä¸ªåŒ…å«äº†æ ‡ç­¾ç±»å‹`type`ï¼Œå±æ€§`props`ä»¥åŠå®ƒåŒ…å«å­å…ƒç´ `children`çš„å¯¹è±¡ã€‚

è‚† â€ è™šæ‹ŸDOMçš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ
================

### è‚† â€ å£¹ é”€æ¯é‡å»ºä¸å±€éƒ¨æ›´æ–°

åœ¨æåŠè™šæ‹Ÿ`DOM`çš„ä¼˜åŠ¿ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠ›å¼€ä»€ä¹ˆè™šæ‹Ÿ`DOM`ä»¥åŠä»€ä¹ˆ`MVC`æ€æƒ³ï¼Œå›æƒ³ä¸‹åœ¨çº¯ `js` æˆ–è€… `jq` å¼€å‘è§’åº¦ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•è¿æ¥`UI`å’Œæ•°æ®å±‚çš„ã€‚å…¶å®åœ¨16å¹´ä¹‹å‰ï¼Œåšä¸»æ‰€ç»å†çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œ`UI`å’Œæ•°æ®å¤„ç†éƒ½æ˜¯å¼ºè€¦åˆï¼Œæ¯”å¦‚æˆ‘ä»¬é¡µé¢æ¸²æŸ“å®Œæˆï¼Œä½¿ç”¨`onload`è¿›è¡Œç›‘å¬ï¼Œç„¶åå‘èµ·`ajax`è¯·æ±‚ï¼Œå¹¶åœ¨å›è°ƒä¸­åŠ å·¥æ•°æ®ï¼Œä»¥åŠåœ¨æ­¤ç”Ÿæˆ`DOM`ç‰‡æ®µï¼Œå¹¶å°†å…¶æ›¿æ¢åˆ°éœ€è¦æ›´æ–°çš„åœ°æ–¹ã€‚

æ‰“ä¸ªæ¯”æ–¹ï¼Œåç«¯è¿”å›äº†ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨`userList`ï¼š

    const userList = [
      'echo',
      'å¬é£æ˜¯é£',
      'æ—¶é—´è·³è·ƒ'
    ]
    

å‰ç«¯åœ¨è¯·æ±‚å®Œæˆï¼Œäºæ˜¯åœ¨`ajax`å›è°ƒä¸­è¿›è¡Œ`dom`ç‰‡æ®µç”Ÿæˆä»¥åŠæ›¿æ¢å·¥ä½œï¼Œæ¯”å¦‚ï¼š

    <ul id='userList'></ul>
    

    const ulDom = document.querySelector('#userList');
    // ç”Ÿæˆä»£ç ç‰‡æ®µ
    const fragment = document.createDocumentFragment();
    
    for (let i = 0; i < userList.length; i++) {
      const liDom = document.createElement("li");
      liDom.innerHTML = userList[i];
      // ä¾æ¬¡ç”Ÿæˆliï¼Œå¹¶åŠ å…¥åˆ°ä»£ç ç‰‡æ®µ
      fragment.appendChild(liDom);
    }
    
    // æœ€ç»ˆå°†ä»£ç ç‰‡æ®µå¡å…¥åˆ°ul
    ulDom.appendChild(fragment);
    

æ‰€ä»¥ä¸ç®¡æ˜¯é¡µé¢åˆå§‹åŒ–ï¼Œè¿˜æ˜¯ä¹‹åç”¨æˆ·é€šè¿‡äº‹ä»¶å‘èµ·è¯·æ±‚æ›´æ–°äº†ç”¨æˆ·æ•°æ®ï¼Œåˆ°å¤´æ¥è¿˜æ˜¯éƒ½æ˜¯è°ƒç”¨ä¸Šé¢ç”Ÿæˆ`li`çš„è¿™æ®µé€»è¾‘ã€‚åœ¨å½“æ—¶èƒ½æƒ³ç€æŠŠè¿™æ®µé€»è¾‘å¤ç”¨æˆä¸€ä¸ªæ–¹æ³•ï¼Œå†è€ƒè™‘ç”¨ä¸Š`createDocumentFragment`å‡å°‘æ“ä½œ`dom`çš„æ¬¡æ•°ï¼Œèƒ½åšåˆ°è¿™äº›ï¼Œè¿™åœ¨å½“æ—¶éƒ½æ˜¯èƒ½å°å¹ä¸€æ³¢çš„äº†....

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163755826-280069838.png)

æ‰€ä»¥ä½ ä¼šå‘ç°ï¼Œåœ¨åŸç”Ÿ`js`çš„è§’åº¦ï¼Œæ ¹æœ¬æ²¡æœ‰æ‰€è°“çš„`dom`å¯¹æ¯”ï¼Œéƒ½æ˜¯é‡æ–°åˆ›å»ºï¼Œå› ä¸ºåœ¨å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»**æ˜ç¡®çŸ¥é“äº†å“ªéƒ¨åˆ†æ˜¯é™æ€é¡µé¢ï¼Œå“ªéƒ¨åˆ†éœ€è¦ç»“åˆæ•°æ®è¿›è¡ŒåŠ¨æ€å±•ç¤º**ã€‚é‚£ä¹ˆåªéœ€è¦å°†éœ€è¦åŠ¨æ€ç”Ÿæˆçš„`dom`çš„é€»è¾‘æå‰å°è£…æˆæ–¹æ³•ï¼Œç„¶ååœ¨ä¸åŒæ—¶æœŸå»è°ƒç”¨ï¼Œè¿™åœ¨å½“å¹´å·²ç»æ˜¯éå¸¸ä¸é”™çš„å¤ç”¨äº†ï¼ˆç»„ä»¶çš„å‰ç”Ÿï¼‰ã€‚

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå‡å®šç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªç±»ä¼¼`form`è¡¨å•çš„å±•ç¤ºåŠŸèƒ½ï¼Œç‚¹å‡»ä¸åŒç”¨æˆ·ï¼Œè¡¨å•å°±ä¼šå±•ç¤ºç”¨æˆ·åï¼Œå¹´é¾„ç­‰ä¸€ç³»åˆ—ä¿¡æ¯ï¼š

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163757491-1310501744.png)

ç”¨`js`å†™æ€ä¹ˆåšï¼Ÿè¿˜æ˜¯ä¸€æ ·çš„ï¼Œç‚¹å‡»ä¸åŒç”¨æˆ·ï¼Œè‚¯å®šä¼šå¾—åˆ°ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯å¯¹è±¡ï¼Œæˆ‘ä»¬æ ¹æ®è¿™ä¸ªå¯¹è±¡åŠ¨æ€ç”Ÿæˆå¤šä¸ªä¿¡æ¯å±•ç¤ºçš„`input`ç­‰ç›¸å…³`dom`ï¼Œç„¶åå¡å…¥åˆ°`form`è¡¨å•ä¸­ï¼Œæ‰€ä»¥æ¯æ¬¡ç‚¹å‡»ï¼Œè¿™ä¸ª`form`å…¶å®éƒ½ç­‰åŒäº**å®Œå…¨é‡å»º**äº†ã€‚

å‡å®šç°åœ¨æˆ‘ä»¬ä¸å¸Œæœ›å®Œæ•´é‡å»ºè¿™ä¸ªç»“æ„ï¼Œè€Œæ˜¯å¸Œæœ›åšå‰å`dom`èŠ‚ç‚¹å¯¹æ¯”ï¼Œæ¯”å¦‚`input`çš„`value`å‰åä¸ä¸€æ ·ï¼ŒæŸä¸ª`style`é¢œè‰²ä¸åŒï¼Œæˆ‘ä»¬å•ç‚¹æ›´æ–°è¿™ä¸ªå±æ€§ï¼Œæ¯”è¾ƒç¬¨æ‹™çš„æƒ³æ³•è‚¯å®šè¿˜æ˜¯å¾—ç”Ÿæˆä¸€ä»½æ–°`dom`ç‰‡æ®µï¼Œç„¶åé€’å½’å¯¹æ¯”ä¸¤ä¸ªç»“æ„ï¼Œä¸”å±æ€§ä¸€ä¸€å¯¹æ¯”ï¼Œåªæœ‰ä¸åŒçš„éƒ¨åˆ†æˆ‘ä»¬æ‰éœ€è¦æ›´æ–°ã€‚ä½†ä»…ä»…é€šè¿‡ä¸‹é¢è¿™æ®µä»£ç ï¼Œä½ å°±èƒ½é¢„æƒ³åˆ°è¿™ä¸ªåšæ³•çš„æ€§èƒ½æœ‰å¤šç³Ÿç³•äº†ï¼š

    // ä¸€ä¸ªlièŠ‚ç‚¹è‡ªå¸¦çš„å±æ€§å°±æœ‰307ä¸ª
    const liDom = document.createElement("li");
    let num = 0;
    for (let key in liDom) {
      num += 1;
    }
    console.log(num); // 307
    

æˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªæœ€åŸºæœ¬çš„`li`èŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡éå†ä¾æ¬¡è®¿é—®èŠ‚ç‚¹çš„å±æ€§ï¼Œç»è¿‡ç»Ÿè®¡å‘ç°`li`å•å±æ€§å°±`307`ä¸ªï¼Œè€Œè¿™ä»…ä»…æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚

åœ¨å‰é¢æˆ‘ä»¬ä¹Ÿæåˆ°è¿‡ï¼Œä¸ç®¡æ˜¯`jq`å°è£…ï¼Œè¿˜æ˜¯`react vue`çš„æ¨¡æ¿è¯­æ³•ï¼Œå®ƒçš„å‰æä¸€å®šæ˜¯ç ”å‘è‡ªå·±æå‰çŸ¥é“äº†å“ªéƒ¨åˆ†å†…å®¹æœªæ¥æ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰è¦åŠ¨æ€å°è£…ï¼Œæ‰éœ€è¦ä½¿ç”¨`{}`è¿›è¡ŒåŒ…è£¹ï¼Œé‚£æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬å°±å¯¹æ¯”**æœªæ¥å¯èƒ½ä¼šå˜çš„éƒ¨åˆ†**ä¸æ˜¯æ›´å¥½å—ï¼Ÿ

è€Œå›åˆ°ä¸Šæ–‡æˆ‘ä»¬å¯¹äºè™šæ‹Ÿç»“æ„çš„æŠ½è±¡ï¼Œå¯¹äº`react`è€Œè¨€ï¼Œ`props`æ˜¯å¯å˜çš„ï¼Œ`child`æ˜¯å¯å˜çš„ï¼Œ`state`ä¹Ÿæ˜¯å¯å˜çš„ï¼Œè€Œè¿™äº›å±æ€§æ°å¥½éƒ½åœ¨è™šæ‹Ÿ`dom`ä¸­å‡æœ‰å‘ˆç°ã€‚

æ‰€ä»¥åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è§£é‡Šäº†è™šæ‹Ÿ`dom`çš„ç¬¬ä¸€ä¸ªä¼˜åŠ¿ï¼Œç«™åœ¨å¯¹æ¯”æ›´æ–°çš„è§’åº¦ï¼Œè™šæ‹Ÿ`dom`èƒ½èšç„¦äºéœ€è¦å¯¹æ¯”ä»€ä¹ˆï¼Œç›¸å¯¹åŸç”Ÿ`dom`å®ƒæä¾›æ›´é«˜æ•ˆçš„å¯¹æ¯”å¯è¡Œæ€§ã€‚

### è‚† â€ è´° æ›´ä½³çš„å…¼å®¹æ€§

æˆ‘ä»¬åœ¨ä¸Šæ–‡æåˆ°ï¼Œ`reactä¸babel`å°†`jsx`è½¬æˆäº†`js`å¯¹è±¡ï¼ˆè™šæ‹Ÿdomï¼‰ï¼Œä¹‹ååˆé€šè¿‡`render`ç”Ÿæˆ`dom`ï¼Œé‚£ä¸ºå•¥è¿˜è¦è½¬æˆ`js`è€Œä¸æ˜¯ç›´æ¥ç”Ÿæˆ`dom`å‘¢ï¼Œå› ä¸ºåœ¨è¿™ä¸ªä¸­é—´`react`è¿˜éœ€è¦åš`diff`å¯¹æ¯”ï¼Œå…¼å®¹å¤„ç†ï¼Œä»¥åŠè·¨å¹³å°çš„è€ƒè™‘ï¼Œæˆ‘ä»¬å…ˆè¯´å…¼å®¹å¤„ç†ã€‚

å‡†ç¡®æ¥è¯´ï¼Œè™šæ‹Ÿ`dom`åªæ˜¯`react`ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œè¦çœŸæ­£ä½“ç°è™šæ‹Ÿ`dom`çš„ä»·å€¼ï¼Œè‚¯å®šå¾—ç»“åˆ`react`ä¸­çš„å…¶å®ƒè®¾è®¡æ¥ä¸€èµ·è®²ï¼Œå…¶ä¸­ä¸€ç‚¹å°±æ˜¯ç»“åˆåˆæˆäº‹ä»¶æ‰€ä½“ç°çš„å¼ºå¤§çš„å…¼å®¹æ€§ã€‚

æˆ‘ä»¬åœ¨ä»‹ç»`jq`æ—¶å¼ºè°ƒäº†å®ƒåœ¨æ“ä½œ`dom`çš„ä¾¿æ·ï¼Œä»¥åŠå„ç±»`api`å…¼å®¹æ€§ä¸Šçš„è´¡çŒ®ï¼Œè€Œ`react`ä¸­ä½¿ç”¨äº†è™šæ‹Ÿ`dom`ä¹Ÿåšäº†å¤§é‡çš„å…¼å®¹ã€‚

æ‰“ä¸ªæ¯”æ–¹ï¼ŒåŸç”Ÿçš„`input`æœ‰`change`äº‹ä»¶ï¼Œæ™®é€šçš„`div`æ€»æ²¡æœ‰`onchange`äº‹ä»¶å§ï¼Ÿä¸ç®¡ä½ æœ‰æ²¡æœ‰ç•™æ„ï¼Œå…¶å®`dom`å’Œäº‹ä»¶åœ¨åº•å±‚å·²ç»åšäº†å¼ºå…³è”ï¼Œä¸åŒçš„`dom`èƒ½è§¦å‘çš„äº‹ä»¶ï¼Œæµè§ˆå™¨åœ¨ä¸€å¼€å§‹å°±å·²ç»å®šä¹‰å¥½äº†ï¼Œè€Œä¸”ä½ æ ¹æœ¬æ”¹ä¸äº†ã€‚

ä½†æ˜¯è™šæ‹Ÿ`dom`å°±ä¸åŒäº†ï¼Œè™šæ‹Ÿ`dom`ä¸€æ–¹é¢æ¨¡ä»¿äº†åŸç”Ÿ`dom`çš„è¡Œä¸ºï¼Œå…¶æ¬¡åœ¨äº‹ä»¶æ–¹é¢ä¹Ÿåšäº†åˆæˆäº‹ä»¶ä¸åŸç”Ÿäº‹ä»¶çš„æ˜ å°„å…³ç³»ï¼Œæ¯”å¦‚ï¼š

    {
      onClick: ['click'],
      onChange: ['blur', 'change', 'click', 'focus', 'input', 'keydown', 'keyup', 'selectionchange']
    }
    

`react`æš´éœ²ç»™æˆ‘ä»¬çš„åˆæˆäº‹ä»¶ï¼Œå…¶å®åœ¨åº•å±‚ä¼šå…³è”åˆ°å¤šä¸ªåŸç”Ÿäº‹ä»¶ï¼Œé€šè¿‡è¿™ç§åšæ³•æŠ¹å¹³äº†ä¸åŒæµè§ˆå™¨ä¹‹é—´çš„`api`å·®å¼‚ï¼Œä¹Ÿå¸¦æ¥äº†æ›´å¼ºå¤§çš„äº‹ä»¶ç³»ç»Ÿã€‚

è‹¥å¯¹äºåˆæˆäº‹ä»¶è‹¥æ„Ÿå…´è¶£ï¼Œå¯ä»¥é˜…è¯»åšä¸» [å…«åƒå­—é•¿æ–‡æ·±å…¥äº†è§£reactåˆæˆäº‹ä»¶åº•å±‚åŸç†ï¼ŒåŸç”Ÿäº‹ä»¶ä¸­é˜»æ­¢å†’æ³¡æ˜¯å¦ä¼šé˜»å¡åˆæˆäº‹ä»¶ï¼Ÿ](https://www.cnblogs.com/echolun/p/15518631.html)ä¸€æ–‡ã€‚

### è‚† â€ å æ¸²æŸ“ä¼˜åŒ–

æˆ‘ä»¬çŸ¥é“`react`éµå¾ª`UI = Render(state)`ï¼Œåªè¦`state`å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆ`render`å°±ä¼šé‡æ–°è§¦å‘ï¼Œä»¥è¾¾åˆ°æ›´æ–°`ui`å±‚çš„æ•ˆæœã€‚è€Œæ›´æ”¹`state`ä¾èµ–äº†`setState`ï¼Œå¤§å®¶éƒ½çŸ¥é“`setState`å¯¹äº`state`æ›´æ–°çš„è¡Œä¸ºå…¶å®æ˜¯å¼‚æ­¥çš„ï¼Œå‡è®¾æˆ‘ä»¬åœ¨ä¸€æ¬¡äº‹ä»¶ä¸­æ›´æ”¹äº†å¤šæ¬¡`state`ï¼Œä½ ä¼šå‘ç°é¡µé¢ä¹Ÿä»…ä¼šæ¸²æŸ“ä¸€æ¬¡ã€‚

è€Œå‡å®šæˆ‘ä»¬æ˜¯ç›´æ¥æ“ä½œ`dom`ï¼Œé‚£è¿˜æœ‰å“ªé—¨å­çš„å¼‚æ­¥å’Œæ¸²æŸ“ç­‰å¾…ï¼Œå½“ä½ `append`å®Œä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œé¡µé¢æ—©æ¸²æŸ“å®Œäº†ã€‚æ‰€ä»¥è™šæ‹Ÿ`dom`çš„å¯¹æ¯”æå‰ï¼Œä»¥åŠ`setState`çš„å¼‚æ­¥å¤„ç†ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯åœ¨åƒå°½å¯èƒ½å°‘çš„æ“ä½œ`dom`é è¿‘ã€‚

è‹¥å¯¹äº`setState`æƒ³æœ‰æ›´æ·±å…¥çš„äº†è§£ï¼Œå¯ä»¥é˜…è¯»åšä¸»è¿™ä¸¤ç¯‡æ–‡ç« ï¼š

[reactä¸­çš„setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿreactä¸ºä»€ä¹ˆè¦å°†å…¶è®¾è®¡æˆå¼‚æ­¥ï¼Ÿ](https://www.cnblogs.com/echolun/p/15510770.html)

[react èŠèŠsetStateå¼‚æ­¥èƒŒåçš„åŸç†ï¼Œreactå¦‚ä½•æ„ŸçŸ¥setStateä¸‹çš„åŒæ­¥ä¸å¼‚æ­¥ï¼Ÿ](https://www.cnblogs.com/echolun/p/15549746.html)

### è‚† â€ è‚† è·¨å¹³å°èƒ½åŠ›

åŒç†ï¼Œä¹‹æ‰€ä»¥åŠ å…¥è™šæ‹Ÿ`dom`è¿™ä¸ªä¸­é—´å±‚ï¼Œé™¤äº†è§£å†³éƒ¨åˆ†æ€§èƒ½é—®é¢˜ï¼ŒåŠ å¼ºå…¼å®¹æ€§ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸ªç›®çš„æ˜¯å°†`dom`çš„æ›´æ–°æŠ½ç¦»æˆä¸€ä¸ªå…¬å…±å±‚ï¼Œåˆ«å¿˜äº†`react`é™¤äº†åšé¡µé¢å¼•ç”¨å¤–ï¼Œ`react`è¿˜æ”¯æŒä½¿ç”¨`React Native`åšåŸç”Ÿ`app`ã€‚æ‰€ä»¥é’ˆå¯¹åŒä¸€å¥—è™šæ‹Ÿ`dom`ä½“ç³»ï¼Œ`react`åªæ˜¯åœ¨æœ€ç»ˆå°†ä½“ç°åœ¨äº†ä¸åŒçš„å¹³å°ä¸Šè€Œå·²ã€‚

ä¼ â€ è™šæ‹ŸDOMæ¯”åŸç”Ÿå¿«å—ï¼Ÿ
===============

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒèŠäº†è¿™ä¹ˆä¹…çš„è™šæ‹Ÿ`dom`ï¼Œè™šæ‹Ÿ`dom`æ€§èƒ½çœŸçš„æ¯”æ“ä½œåŸç”Ÿ`dom`è¦æ›´å¿«å—ï¼Ÿå¾ˆé—æ†¾çš„è¯´ï¼Œå¹¶ä¸æ˜¯ï¼Œæˆ–è€…è¯´ä¸åº”è¯¥è¿™æ ·ç²—æš´çš„å»å¯¹æ¯”ã€‚

æˆ‘ä»¬åœ¨å‰é¢è™½ç„¶å¯¹æ¯”äº†è™šæ‹Ÿ`dom`å±æ€§ä»¥åŠåŸç”Ÿ`dom`çš„å±æ€§é‡çº§ï¼Œä½†äº‹å®ä¸Šæˆ‘ä»¬å¹¶ä¸ä¼šå¯¹åŸç”Ÿ`dom`å±æ€§è¿›è¡Œé€’å½’å¯¹æ¯”ï¼Œè€Œæ˜¯ç›´æ¥æ“ä½œ`dom`ã€‚è€Œä¸”ç«™åœ¨`react`è§’åº¦ï¼Œå³ä¾¿ç»å†äº†`diff`ç®—æ³•ä»¥åŠä¸€ç³»åˆ—çš„ä¼˜åŒ–ï¼Œ`react`åˆ°å¤´æ¥è¿˜æ˜¯è¦æ“ä½œåŸç”Ÿ`dom`ï¼Œåªæ˜¯å¯¹äºç ”å‘æ¥è®²ä¸ç”¨å…³æ³¨è¿™ä¸€æ­¥ç½¢äº†ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œç°åœ¨è¦æ›¿æ¢`p`æ ‡ç­¾çš„å†…å®¹ï¼Œç”¨åŸç”Ÿå°±æ˜¯ç›´æ¥ä¿®æ”¹`innerHTML`å±æ€§ï¼Œå¯¹äº`react`è€Œè¨€å®ƒéœ€è¦å…ˆç”Ÿæˆè™šæ‹Ÿ`dom`ï¼Œç„¶åæ–°æ—§`diff`æ‰¾å‡ºå˜åŒ–çš„éƒ¨åˆ†ï¼Œæœ€åæ‰ä¿®æ”¹åŸç”Ÿ`dom`ï¼Œå•è®ºè¿™ä¸ªä¾‹å­ï¼Œä¸€å®šæ˜¯åŸç”Ÿå¿«ã€‚

ä½†æˆ‘ä»¬æ—¢ç„¶è¯´è™šæ‹Ÿ`dom`ï¼Œå°±ä¸€å®šå¾—ç»“åˆ`react`çš„ä½¿å‘½æ¥è§£é‡Šï¼Œè™šæ‹Ÿ`dom`çš„æ ¸å¿ƒç›®çš„æ˜¯**æ¨¡æ‹Ÿäº†åŸç”Ÿ`dom`å¤§éƒ¨åˆ†ç‰¹æ€§ï¼Œè®©ç ”å‘é«˜æ•ˆæ— ç—›å†™`html`çš„åŒæ—¶ï¼Œè¿˜è¾¾åˆ°äº†å•ç‚¹åˆ·æ–°è€Œä¸æ˜¯æ•´ä¸ªæ›¿æ¢ï¼ˆå‰é¢è¡¨å•æ›¿æ¢çš„ä¾‹å­ï¼‰ï¼Œæœ€é‡è¦çš„ï¼Œå®ƒä¹Ÿå°†ç ”å‘ä»ç¹ççš„`dom`æ“ä½œä¸­è§£æ”¾äº†å‡ºæ¥**ã€‚

æ€»ç»“æ¥è¯´ï¼Œå•è®ºä¿®æ”¹ä¸€ä¸ª`dom`èŠ‚ç‚¹çš„æ€§èƒ½ï¼Œä¸ç®¡`react`è¿˜æ˜¯`vue`äº¦æˆ–æ˜¯`angular`ï¼Œä¸€å®šæ˜¯åŸç”Ÿæœ€å¿«ï¼Œä½†è™šæ‹Ÿ`dom`æœ‰åŸç”Ÿ`dom`æ¯”ä¸äº†çš„ä»·å€¼ï¼Œèµ·ç `react`è¿™äº›æ¡†æ¶èƒ½è®©ç ”å‘æ›´ä¸“æ³¨ä¸šåŠ¡ä»¥åŠæ•°æ®å¤„ç†ï¼Œè€Œä¸æ˜¯é™·å…¥ç¹ççš„`dom`å¢åˆ æ”¹æŸ¥ä¸­ã€‚

é™† â€ è™šæ‹ŸDOMçš„å®ç°åŸç†
==============

æ–‡ç« å¼€å¤´çš„äº”ä¸ªé—®é¢˜åˆ°è¿™é‡Œå·²ç»è§£é‡Šäº†ä¸‰ä¸ªï¼Œè¿˜å‰©ä¸¤ä¸ªé—®é¢˜å‡ä¸æºç æœ‰ä¸€å®šå…³ç³»ï¼Œè™½ç„¶ç•¥æ˜¾æ¯ç‡¥ä½†æˆ‘ä¼šç²¾ç®€ç»™å¤§å®¶é˜è¿°è¿™ä¸ªè¿‡ç¨‹ï¼Œå¦å¤–ï¼Œä¸ºäº†è®©çŸ¥è¯†é‡ä¸ä¼šæ˜¾å¾—æ ¼å¤–åºå¤§ï¼Œæœ¬æ–‡å°†ä¸ä¼šé˜è¿°`diff`ç®—æ³•ä¸`fiber`éƒ¨åˆ†ï¼Œè¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹æˆ‘ä¼šå¦èµ·æ–‡ç« å•ç‹¬ä»‹ç»ï¼Œæ•¬è¯·æœŸå¾…ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œæ¥ä¸‹æ¥ä¸¤ä¸ªé—®é¢˜çš„æºç ï¼Œæˆ‘å°†å‡ä»¥`react17.0.2`æºç ä¸ºå‡†ï¼Œæ‰€ä»¥å¤§å®¶ä¹Ÿä¸ç”¨æ‹…å¿ƒç‰ˆæœ¬å·®å¼‚ï¼Œä¼šä¸ä¼šæœ‰ç†è§£äº†ç”¨ä¸ä¸Šçš„é—®é¢˜ï¼Œè€Œä¸”ç›®å‰ç”¨`react 18`çš„å…¬å¸ä¹Ÿä¸ä¼šå¾ˆå¤šã€‚

æˆ‘ä»¬å…ˆè§£é‡Šè™šæ‹Ÿ`dom`çš„åˆ›å»ºè¿‡ç¨‹ï¼Œè¦èŠè¿™ä¸ªé‚£å¿…ç„¶é€ƒä¸å¼€`React.createElement`æ–¹æ³•ï¼Œ[githubæºç ](https://github.com/facebook/react/blob/bcbeb52bf36c6f5ecdad46a48e87cf4354c5a64f/packages/react/src/ReactElement.js#L362)ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼ˆæˆ‘åˆ é™¤äº†`dev`ç¯å¢ƒç‰¹æœ‰çš„é€»è¾‘ï¼‰ï¼š

    /**
     * åˆ›å»ºå¹¶è¿”å›ç»™å®šç±»å‹çš„æ–°ReactElementã€‚
     * See https://reactjs.org/docs/react-api.html#createelement
     */
    function createElement(type, config, children) {
      let propName;
    
      // åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„propså¯¹è±¡
      const props = {};
    
      let key = null;
      let ref = null;
      let self = null;
      let source = null;
    
      // æœ‰ä¼ é€’è‡ªå®šä¹‰å±æ€§è¿›æ¥å—ï¼Ÿæœ‰çš„è¯å°±å°è¯•è·å–refä¸key
      if (config != null) {
        if (hasValidRef(config)) {
          ref = config.ref;
        }
        if (hasValidKey(config)) {
          key = '' + config.key;
        }
    
        // ä¿å­˜selfå’Œsource
        self = config.__self === undefined ? null : config.__self;
        source = config.__source === undefined ? null : config.__source;
    
        // å‰©ä¸‹çš„å±æ€§éƒ½æ·»åŠ åˆ°ä¸€ä¸ªæ–°çš„propså±æ€§ä¸­ã€‚æ³¨æ„æ˜¯configè‡ªèº«çš„å±æ€§
        for (propName in config) {
          if (
            hasOwnProperty.call(config, propName) &&
            !RESERVED_PROPS.hasOwnProperty(propName)
          ) {
            props[propName] = config[propName];
          }
        }
      }
    
      // å¤„ç†å­å…ƒç´ ï¼Œé»˜è®¤å‚æ•°ç¬¬äºŒä¸ªä¹‹åéƒ½æ˜¯å­å…ƒç´ 
      const childrenLength = arguments.length - 2;
      // å¦‚æœå­å…ƒç´ åªæœ‰ä¸€ä¸ªï¼Œç›´æ¥èµ‹å€¼
      if (childrenLength === 1) {
        props.children = children;
      } else if (childrenLength > 1) {
        // å¦‚æœæ˜¯å¤šä¸ªï¼Œè½¬æˆæ•°ç»„å†èµ‹äºˆç»™props
        const childArray = Array(childrenLength);
        for (let i = 0; i < childrenLength; i++) {
          childArray[i] = arguments[i + 2];
        }
        props.children = childArray;
      }
    
      // å¤„ç†é»˜è®¤propsï¼Œä¸ä¸€å®šæœ‰ï¼Œæœ‰æ‰ä¼šéå†èµ‹å€¼
      if (type && type.defaultProps) {
        const defaultProps = type.defaultProps;
        for (propName in defaultProps) {
          // é»˜è®¤å€¼åªå¤„ç†å€¼ä¸æ˜¯undefinedçš„å±æ€§
          if (props[propName] === undefined) {
            props[propName] = defaultProps[propName];
          }
        }
      }
    
      // è°ƒç”¨çœŸæ­£çš„Reactå…ƒç´ åˆ›å»ºæ–¹æ³•
      return ReactElement(type, key, ref, self, source, ReactCurrentOwner.current, props);
    }
    

ä»£ç çœ‹ç€å¥½åƒæœ‰ç‚¹å¤šï¼Œä½†å…¶å®ä¸€å…±å°±åªåšäº†ä¸¤ä»¶äº‹ï¼š

*   æ ¹æ®`createElement`æ‰€æ¥æ”¶å‚æ•°`config`åšæ•°æ®åŠ å·¥ä¸èµ‹å€¼ã€‚
*   åŠ å·¥å®Œæ•°æ®åè°ƒç”¨çœŸæ­£çš„è™šæ‹Ÿ`dom`åˆ›å»º`API ReactElement`ã€‚

è€Œæ•°æ®åŠ å·¥éƒ¨åˆ†å¯åˆ†ä¸ºä¸‰æ­¥ï¼Œå¤§å®¶å¯ä»¥å¯¹åº”ä¸Šé¢ä»£ç ç†è§£ï¼Œå…¶å®æ³¨é‡Šå†™çš„ä¹Ÿå¾ˆæ¸…æ™°äº†ï¼š

*   ç¬¬ä¸€æ­¥ï¼Œåˆ¤æ–­`config`æœ‰æ²¡æœ‰ä¼ ï¼Œä¸ä¸º`null`å°±åšå¤„ç†ï¼Œæ­¥éª¤åˆ†ä¸º
    *   åˆ¤æ–­`ref`ã€`key`ï¼Œ`__self`ã€`__source`è¿™äº›æ˜¯å¦å­˜åœ¨æˆ–è€…æœ‰æ•ˆï¼Œæ»¡è¶³æ¡ä»¶å°±åˆ†åˆ«èµ‹å€¼ç»™å‰é¢æ–°å»ºçš„å˜é‡ã€‚
    *   éå†`config`ï¼Œå¹¶å°†`config`è‡ªèº«çš„å±æ€§ä¾æ¬¡èµ‹å€¼ç»™å‰é¢æ–°å»º`props`ã€‚
*   ç¬¬äºŒæ­¥ï¼Œå¤„ç†å­å…ƒç´ ã€‚é»˜è®¤ä»ç¬¬ä¸‰ä¸ªå‚æ•°å¼€å§‹éƒ½æ˜¯å­å…ƒç´ ã€‚
    *   å¦‚æœå­å…ƒç´ åªæœ‰ä¸€ä¸ªï¼Œç›´æ¥èµ‹å€¼ç»™`props.children`ã€‚
    *   å¦‚æœå­å…ƒç´ æœ‰å¤šä¸ªï¼Œè½¬æˆæ•°ç»„åå†èµ‹å€¼ç»™`props.children`ã€‚
*   ç¬¬ä¸‰æ­¥ï¼Œå¤„ç†é»˜è®¤å±æ€§`defaultProps`ï¼Œä¸€ä¸ªçº¯ç²¹çš„æ ‡ç­¾ä¹Ÿå¯ä»¥ç†è§£æˆä¸€ä¸ªæœ€æœ€æœ€åŸºç¡€çš„ç»„ä»¶ï¼Œè€Œç»„ä»¶æ”¯æŒ `defaultProps`ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥åˆ¤æ–­æœ‰æ²¡æœ‰`defaultProps`ï¼Œå¦‚æœæœ‰åŒæ ·éå†ï¼Œå¹¶å°†å€¼ä¸ä¸º`undefined`çš„éƒ¨åˆ†éƒ½æ‹·è´åˆ°`props`å¯¹è±¡ä¸Šã€‚

è‡³æ­¤ï¼Œç¬¬ä¸€å¤§æ­¥å…¨éƒ¨åšå®Œï¼Œç´§æ¥ç€è°ƒç”¨`ReactElement`ï¼Œæˆ‘ä»¬æ¥ç€çœ‹è¿™ä¸€å—çš„æºç ï¼ŒåŒæ ·æˆ‘åˆ æ‰`dev`éƒ¨åˆ†çš„é€»è¾‘ï¼Œç„¶åä½ ä¼šå‘ç°å°±è¿™ä¹ˆä¸€ç‚¹ä»£ç ï¼Œ[githubæºç ](https://github.com/facebook/react/blob/bcbeb52bf36c6f5ecdad46a48e87cf4354c5a64f/packages/react/src/ReactElement.js#L148)ï¼š

    const ReactElement = function (type, key, ref, self, source, owner, props) {
      const element = {
        // è¿™ä¸ªæ ‡ç­¾å…è®¸æˆ‘ä»¬å°†å…¶æ ‡è¯†ä¸ºå”¯ä¸€çš„React Element
        $$typeof: REACT_ELEMENT_TYPE,
        // å…ƒç´ çš„å†…ç½®å±æ€§
        type: type,
        key: key,
        ref: ref,
        props: props,
        // è®°å½•è´Ÿè´£åˆ›å»ºæ­¤å…ƒç´ çš„ç»„ä»¶ã€‚
        _owner: owner,
      };
      return element;
    };
    

è¿™ä¸ªæ–¹æ³•å•¥ä¹Ÿæ²¡å¹²ï¼Œå•çº¯æ¥å—æˆ‘ä»¬åœ¨ä¸Šä¸ªæ–¹æ³•åŠ å·¥åçš„æ•°æ®ï¼Œå¹¶å°†å…¶ç»„è£…æˆäº†ä¸€ä¸ª`element`å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰æ–‡æ‰€è¯´çš„è™šæ‹Ÿ`dom`ã€‚

ä¸è¿‡é’ˆå¯¹è¿™ä¸ªè™šæ‹Ÿ`dom`ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ`$$typeof: REACT_ELEMENT_TYPE`æ‹§å‡ºæ¥å•ç‹¬è®²è®²ã€‚æˆ‘ä»¬å¯ä»¥çœ‹çœ‹å®ƒçš„å…·ä½“å®ç°ï¼š

    // The Symbol used to tag the ReactElement-like types.
    export const REACT_ELEMENT_TYPE = Symbol.for('react.element');
    

å¤§å®¶åœ¨æŸ¥çœ‹è™šæ‹Ÿ`dom`æ—¶åº”è¯¥éƒ½æœ‰å‘ç°å®ƒçš„`$$typeof`å®šä¹‰ä¸º`Symbol(react.element)`ï¼Œè€Œ`Symbol`ä¸€å¤§ç‰¹æ€§å°±æ˜¯æ ‡è¯†å”¯ä¸€æ€§ï¼Œå³ä¾¿ä¸¤ä¸ªçœ‹ç€ä¸€æ¨¡ä¸€æ ·çš„`Symbol`ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šç›¸ç­‰ã€‚è€Œ`react`ä¹‹æ‰€ä»¥è¿™æ ·åšï¼Œæœ¬è´¨ä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢`xss`æ”»å‡»ï¼Œé˜²æ­¢å¤–éƒ¨ä¼ªé€ è™šæ‹Ÿ`dom`ç»“æ„ã€‚

å…¶æ¬¡ï¼Œå¦‚æœå¤§å®¶æœ‰åœ¨å¼€å‘ä¸­ç•™æ„ï¼Œè™šæ‹Ÿ`dom`çš„ä¸å…è®¸ä¿®æ”¹ï¼Œå“ªæ€•ä½ ä¸ºè¿™ä¸ªå¯¹è±¡æ–°å¢å±æ€§ä¹Ÿä¸å¯ä»¥ï¼Œè¿™æ˜¯å› ä¸ºåœ¨`ReactElement`æ–¹æ³•çœç•¥çš„`dev`ä»£ç ä¸­ï¼Œ`react`ä½¿ç”¨`Object.freeze`å†»ç»“äº†è™šæ‹Ÿ`dom`ä½¿å…¶æ— æ³•ä¿®æ”¹ã€‚ä½†å®é™…ä¸Šæˆ‘ä»¬ç¡®å®æœ‰ä¸ºè™šæ‹Ÿ`dom`æ·»åŠ å±æ€§çš„åœºæ™¯ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜æ—¶æˆ‘ä»¬å¯ä»¥å€Ÿç”¨é¡¶å±‚`React.cloneElement()`æ–¹æ³•ï¼Œå®ƒä¼šä»¥ä½ ä¼ é€’çš„è™šæ‹Ÿ`dom`ä¸ºæ¨¡æ¿å…‹éš†å¹¶è¿”å›ä¸€ä¸ªæ–°çš„è™šæ‹Ÿ`dom`å¯¹è±¡ï¼ŒåŒæ—¶è¿™ä¸ªè¿‡ç¨‹ä¸­ä½ å¯ä»¥ä¸ºå…¶æ·»åŠ æ–°çš„`config`ï¼Œå…·ä½“ç”¨æ³•å¯è§ [React.cloneElement](https://zh-hans.reactjs.org/docs/react-api.html#cloneelement)ã€‚

å…¶æ¬¡ï¼Œå¦‚æœå½“å‰ç¯å¢ƒä¸æ”¯æŒ`Symbol`æ—¶ï¼Œ`REACT_ELEMENT_TYPE`çš„å€¼ä¸º`0xeac7`ã€‚

    var REACT_ELEMENT_TYPE = 0xeac7;
    

ä¸ºä»€ä¹ˆæ˜¯`0xeac7`å‘¢ï¼Ÿå®˜æ–¹ç­”å¤æ˜¯ï¼Œå› ä¸ºå®ƒçœ‹èµ·æ¥åƒ`React`....å¥½äº†ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œï¼Œå…³äºå¦‚ä½•ç”Ÿæˆè™šæ‹Ÿ`dom`çš„æºç åˆ†æç»“æŸã€‚

æŸ’ â€ reactä¸­è™šæ‹Ÿdomæ˜¯å¦‚ä½•è½¬å˜æˆçœŸå®domçš„
===========================

ç»ˆäºï¼Œæˆ‘ä»¬æ¥åˆ°äº†æœ¬æ–‡çš„æœ€åä¸€ä¸ªé—®é¢˜ï¼Œè¦æƒ³ææ¸…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„å…³æ³¨ç‚¹è‡ªç„¶æ˜¯`ReactDOM.render`æ–¹æ³•äº†ï¼Œè¿™ä¸ªéƒ¨åˆ†æ¯”è¾ƒéº»çƒ¦ï¼Œå¤§å®¶è·Ÿç€æˆ‘çš„æ€è·¯èµ°å°±è¡Œã€‚ï¼ˆæœ‰å…´è¶£å¯ä»¥ç›´æ¥æŠŠ`react`è„šæ‰‹æ¶é¡¹ç›®è·‘èµ·æ¥ï¼Œå†™ä¸€ä¸ªæœ€åŸºæœ¬çš„ç»„ä»¶ï¼Œç„¶åå»`react-dom.development.js`æ–‡ä»¶æ–­ç‚¹ä¹Ÿå¯ä»¥ï¼‰ã€‚

    // æˆ‘ä¸ºäº†æ–¹ä¾¿æ–­ç‚¹ï¼Œå®šä¹‰äº†ä¸€ä¸ªclassç»„ä»¶P
    class P extends Component {
      state = {
        name: 1,
      };
      handleClick = () => {};
      render() {
        return <span onClick={this.handleClick}>111</span>;
      }
    }
    ReactDOM.render(<P />, document.getElementById("root"));
    

é¦–å…ˆæˆ‘ä»¬æ¥åˆ°`render`æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š

    function render(element, container, callback) {
    	// æˆ‘åˆ é™¤äº†å¯¹äºcontaineræ˜¯å¦åˆæ³•çš„æ•ˆéªŒé€»è¾‘
      return legacyRenderSubtreeIntoContainer(null, element, container, false, callback);
    }
    

`render`åšçš„äº‹æƒ…å…¶å®å¾ˆç®€å•ï¼ŒéªŒè¯`container`æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„`dom`å°±ä¼šæŠ›é”™ï¼Œæ ¸å¿ƒé€»è¾‘çœ‹æ ·å­éƒ½åœ¨`legacyRenderSubtreeIntoContainer`ä¸­ï¼Œæ ¹æ®å‘½åå¯ä»¥æ¨æµ‹æ˜¯å°†ç»„ä»¶å­æ ‘éƒ½æ¸²æŸ“åˆ°å®¹å™¨å…ƒç´ ä¸­ã€‚

    // åŒæ ·ï¼Œæˆ‘åˆ é™¤äº†éƒ¨åˆ†å¯¹ä¸»é€»è¾‘ç†è§£æ²¡å•¥å½±å“çš„ä»£ç 
    function legacyRenderSubtreeIntoContainer(parentComponent, children, container, forceHydrate, callback) {
      var root = container._reactRootContainer;
      var fiberRoot;
    	// æœ‰fiberçš„rootèŠ‚ç‚¹å—ï¼Ÿæ²¡æœ‰å°±æ–°å»º
      if (!root) {
        root = container._reactRootContainer = legacyCreateRootFromDOMContainer(container, forceHydrate);
        fiberRoot = root._internalRoot;
        unbatchedUpdates(function () {
          // æ ¸å¿ƒå…³æ³¨è¿™é‡Œ
          updateContainer(children, fiberRoot, parentComponent, callback);
        });
      } else {
        fiberRoot = root._internalRoot;
    
        updateContainer(children, fiberRoot, parentComponent, callback);
      }
      return getPublicRootInstance(fiberRoot);
    }
    

å› ä¸º`react 16`å¼•å…¥äº†`fiber`çš„æ¦‚å¿µï¼Œæ‰€ä»¥åç»­å…¶å®å¾ˆå¤šä»£ç å°±æ˜¯åœ¨åˆ›å»º`fiber`èŠ‚ç‚¹ï¼Œ`legacyRenderSubtreeIntoContainer`ä¸€æ ·ï¼Œå®ƒä¸€å¼€å§‹åˆ¤æ–­æœ‰æ²¡æœ‰`root`èŠ‚ç‚¹ï¼ˆä¸€ä¸ªfiberå¯¹è±¡ï¼‰ï¼Œå¾ˆæ˜¾ç„¶æˆ‘ä»¬åˆæ¬¡æ¸²æŸ“èµ°äº†æ–°å»ºé€»è¾‘ï¼Œä½†ä¸ç®¡æ˜¯ä¸æ˜¯æ–°å»ºï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨`updateContainer`æ–¹æ³•ã€‚ä½†æ­¤æ–¹æ³•æ²¡æœ‰å¤ªå¤šæˆ‘ä»¬éœ€è¦å…³æ³¨çš„é€»è¾‘ï¼Œä¸€ç›´å¾€ä¸‹èµ°ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°ä¸€ä¸ªå¾ˆé‡è¦çš„`beginWork`ï¼ˆå¼€å§‹å¹²æ­£äº‹ï¼‰æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š

    function beginWork(current, workInProgress, renderLanes) {
    	// åˆ é™¤éƒ¨åˆ†æ— å½±å“çš„ä»£ç 
      workInProgress.lanes = NoLanes;
    
      switch (workInProgress.tag) {
        // æ¨¡ç³Šå®šä¹‰çš„ç»„ä»¶
        case IndeterminateComponent:
          {
            return mountIndeterminateComponent(current, workInProgress, workInProgress.type, renderLanes);
          }
    		// å‡½æ•°ç»„ä»¶
        case FunctionComponent:
          {
            var _Component = workInProgress.type;
            var unresolvedProps = workInProgress.pendingProps;
            var resolvedProps = workInProgress.elementType === _Component ? unresolvedProps : resolveDefaultProps(_Component, unresolvedProps);
            return updateFunctionComponent(current, workInProgress, _Component, resolvedProps, renderLanes);
          }
    		// classç»„ä»¶
        case ClassComponent:
          {
            var _Component2 = workInProgress.type;
            var _unresolvedProps = workInProgress.pendingProps;
    
            var _resolvedProps = workInProgress.elementType === _Component2 ? _unresolvedProps : resolveDefaultProps(_Component2, _unresolvedProps);
    
            return updateClassComponent(current, workInProgress, _Component2, _resolvedProps, renderLanes);
          }
        case HostRoot:
          return updateHostRoot(current, workInProgress, renderLanes);
      }
    }
    

`beginWork`æ–¹æ³•åšäº†å¾ˆé‡è¦çš„ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯æ ¹æ®ä½ `render`æ¥æ”¶çš„ç»„ä»¶ç±»å‹ï¼Œæ¥æ‰§è¡Œä¸åŒçš„ç»„ä»¶æ›´æ–°çš„æ–¹æ³•ï¼Œæ¯•ç«Ÿæˆ‘ä»¬å¯èƒ½ç»™`render`ä¼ é€’ä¸€ä¸ªæ™®é€šæ ‡ç­¾ï¼Œä¹Ÿå¯èƒ½æ˜¯å‡½æ•°ç»„ä»¶æˆ–è€…`Class`ç»„ä»¶ï¼Œäº¦æˆ–æ˜¯`hooks`çš„`memo`ç»„ä»¶ç­‰ç­‰ã€‚

æ¯”å¦‚æˆ‘æ­¤æ—¶å®šä¹‰çš„`P`æ˜¯`class`ç»„ä»¶ï¼Œäºæ˜¯èµ°äº†`ClassComponent`è·¯çº¿ï¼Œç´§æ¥ç€è°ƒç”¨`updateClassComponent`æ›´æ–°ç»„ä»¶ã€‚

    function updateClassComponent(current, workInProgress, Component, nextProps, renderLanes) {
      // åˆ é™¤äº†æ·»åŠ contextéƒ¨åˆ†çš„é€»è¾‘
    	// è·å–ç»„ä»¶å®ä¾‹
      var instance = workInProgress.stateNode;
      var shouldUpdate;
    	// å¦‚æœæ²¡æœ‰å®ä¾‹ï¼Œé‚£å°±å¾—åˆ›å»ºå®ä¾‹
      if (instance === null) {
        if (current !== null) {
          current.alternate = null;
          workInProgress.alternate = null;
    
          workInProgress.flags |= Placement;
        }
        // å…¨ä½“ç›®å…‰å‘æˆ‘çœ‹é½ï¼Œçœ‹æˆ‘çœ‹æˆ‘ï¼Œè¿™é‡Œnew Classåˆ›å»ºç»„ä»¶å®ä¾‹
        constructClassInstance(workInProgress, Component, nextProps);
        // æŒ‚è½½ç»„ä»¶å®ä¾‹
        mountClassInstance(workInProgress, Component, nextProps, renderLanes);
        shouldUpdate = true;
      } else if (current === null) {
        shouldUpdate = resumeMountClassInstance(workInProgress, Component, nextProps, renderLanes);
      } else {
        shouldUpdate = updateClassInstance(current, workInProgress, Component, nextProps, renderLanes);
      }
      // Classç»„ä»¶çš„æ”¶å°¾å·¥ä½œ
      var nextUnitOfWork = finishClassComponent(current, workInProgress, Component, shouldUpdate, hasContext, renderLanes);
    }
    

åœ¨çœ‹è¿™æ®µä»£ç å‰ï¼Œæˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥æå‰æƒ³è±¡ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œæ¯”å¦‚`Class`ç»„ä»¶ä½ ä¸€å®šæ˜¯å¾—`new`æ‰èƒ½å¾—åˆ°ä¸€ä¸ªå®ä¾‹ï¼Œåªæœ‰æ‹¿åˆ°å®ä¾‹åæ‰èƒ½è°ƒç”¨å…¶`render`æ–¹æ³•ï¼Œæ‹¿åˆ°å…¶è™šæ‹Ÿ`dom`ç»“æ„ï¼Œä¹‹åå†æ ¹æ®ç»“æ„åˆ›å»ºçœŸå®`dom`ï¼Œæ·»åŠ å±æ€§ï¼Œæœ€ååŠ å…¥åˆ°é¡µé¢ã€‚

æ‰€ä»¥åœ¨`updateClassComponent`ä¸­ï¼Œé¦–å…ˆä¼šå¯¹ç»„ä»¶åš`context`ç›¸å…³çš„å¤„ç†ï¼Œè¿™éƒ¨åˆ†ä»£ç æˆ‘åˆ æ‰äº†ï¼Œå…¶ä½™ï¼Œåˆ¤æ–­å½“å‰ç»„ä»¶æ˜¯å¦æœ‰å®ä¾‹ï¼Œå¦‚æœæœ‰å°±å»æ›´æ–°å®ä¾‹ï¼Œå¦‚æœæ²¡æœ‰é‚£å°±åˆ›å»ºå®ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬èšç„¦åˆ°`constructClassInstance`ä¸`mountClassInstanceã€finishClassComponent`ä¸‰ä¸ªæ–¹æ³•ï¼Œçœ‹å‘½åå°±èƒ½çŒœåˆ°ï¼Œå‰è€…ä¸€å®šæ˜¯åˆ›é€ å®ä¾‹ï¼Œåè€…æ˜¯åº”è¯¥æ˜¯æŒ‚è½½å®ä¾‹å‰çš„ä¸€äº›å¤„ç†ï¼Œå…ˆçœ‹ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼š

    function constructClassInstance(workInProgress, ctor, props) {
    	// åˆ é™¤äº†å¯¹ç»„ä»¶contextè¿›ä¸€æ­¥åŠ å·¥çš„é€»è¾‘
    	// ....
      
      // çœ‹æˆ‘çœ‹æˆ‘ï¼Œæˆ‘å®£å¸ƒä¸ªäº‹ï¼Œè¿™é‡Œåˆ›å»ºäº†ç»„ä»¶å®ä¾‹
      // éªŒè¯äº†å‰é¢çš„æ¨æµ‹ï¼Œè¿™é‡Œnewäº†æˆ‘ä»¬çš„ç»„ä»¶ï¼Œå¹¶ä¸”ä¼ é€’äº†å½“å‰ç»„ä»¶çš„propsä»¥åŠå‰é¢ä»£ç åŠ å·¥çš„context
      var instance = new ctor(props, context);
      var state = workInProgress.memoizedState = instance.state !== null && instance.state !== undefined ? instance.state : null;
      adoptClassInstance(workInProgress, instance);
    
      // åˆ é™¤äº†å¯¹äºç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°çš„å¤„ç†ï¼Œæ¯”å¦‚å¾ˆå¤šå³å°†è¢«åºŸå¼ƒçš„é’©å­ï¼Œåœ¨è¿™é‡Œéƒ½ä¼šè¢«æ·»åŠ  UNSAFE_ å‰ç¼€
      //.....
    
      return instance;
    }
    

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163759405-1233473738.png)

`constructClassInstance`æ­£å¦‚æˆ‘ä»¬æ¨æµ‹çš„ä¸€æ ·ï¼Œè¿™é‡Œé€šè¿‡`new ctor(props, context)`åˆ›å»ºäº†ç»„ä»¶å®ä¾‹ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œ`react`åç»­ç‰ˆæœ¬å·²å°†éƒ¨åˆ†å£°æ˜å‘¨æœŸé’©å­æ ‡è®°ä¸ºä¸å®‰å…¨ï¼Œå¯¹äºé’©å­å‘½åçš„åŠ å·¥ä¹Ÿåœ¨æ­¤æ–¹æ³•ä¸­ã€‚

ç´§æ¥ç€ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªç»„ä»¶å®ä¾‹ï¼Œæ¥ç€çœ‹`mountClassInstance`æ–¹æ³•ï¼š

    function mountClassInstance(workInProgress, ctor, newProps, renderLanes) {
    	// æ­¤æ–¹æ³•ä¸»è¦æ˜¯å¯¹constructClassInstanceåˆ›å»ºçš„å®ä¾‹è¿›è¡Œæ•°æ®ç»„è£…ï¼Œä¸ºå…¶èµ‹äºˆprops,stateç­‰ä¸€ç³»åˆ—å±æ€§
      var instance = workInProgress.stateNode;
      instance.props = newProps;
      instance.state = workInProgress.memoizedState;
      instance.refs = emptyRefsObject;
      initializeUpdateQueue(workInProgress);
      
      // åˆ é™¤äº†éƒ¨åˆ†ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¯¹äºinstanceçš„ç‰¹æ®Šå¤„ç†é€»è¾‘
    }
    

è™½ç„¶å‘½åæ˜¯æŒ‚è½½ï¼Œä½†å…¶å®ç¦»çœŸæ­£çš„æŒ‚è½½è¿˜è¿œå¾—å¾ˆï¼Œæœ¬æ–¹æ³•å…¶å®æ˜¯ä¸º`constructClassInstance`åˆ›å»ºçš„ç»„ä»¶å®ä¾‹åšæ•°æ®åŠ å·¥ï¼Œä¸ºå…¶èµ‹äºˆ`props state`ç­‰ä¸€ç³»åˆ—å±æ€§ã€‚

åœ¨ä¸Šæ–‡ä»£ç ä¸­ï¼Œå…¶å®è¿˜æœ‰ä¸ª`finishClassComponent`æ–¹æ³•ï¼Œæ­¤æ–¹æ³•åœ¨ç»„ä»¶è‡ªèº«éƒ½å‡†å¤‡å®Œå–„åè°ƒç”¨ï¼Œæˆ‘ä»¬æœŸå¾…å·²ä¹…çš„`render`æ–¹æ³•å¤„ç†å°±åœ¨é‡Œé¢ï¼š

    function finishClassComponent(current, workInProgress, Component, shouldUpdate, hasContext, renderLanes) {
      var instance = workInProgress.stateNode;
      ReactCurrentOwner$1.current = workInProgress;
      var nextChildren;
      if (didCaptureError && typeof Component.getDerivedStateFromError !== 'function') {
    			// ...
      } else {
        {
          setIsRendering(true);
          // å…³æ³¨ç‚¹åœ¨è¿™ï¼Œé€šè¿‡è°ƒç”¨ç»„ä»¶å®ä¾‹çš„renderæ–¹æ³•ï¼Œå¾—åˆ°å†…éƒ¨çš„å…ƒç´ 
          nextChildren = instance.render();
          setIsRendering(false);
        }
      } 
      workInProgress.memoizedState = instance.state;
      return workInProgress.child;
    }
    

åœ¨æ­¤æ–¹æ³•å†…éƒ¨ï¼Œæˆ‘ä»¬é€šè¿‡è·å–ä¹‹å‰åˆ›å»ºçš„ç»„ä»¶å®ä¾‹ï¼Œç„¶åè°ƒç”¨äº†å®ƒçš„`render`æ–¹æ³•ï¼Œäºæ˜¯æˆåŠŸæ‰§è¡Œäº†æˆ‘ä»¬ç»„ä»¶`P`çš„`render`æ–¹æ³•ï¼š

    render() {
      return <span onClick={this.handleClick}>111</span>;
    }
    

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`render`è¿”å›çš„å…¶å®æ˜¯ä¸€ä¸ª`jsx`çš„æ¨¡æ¿è¯­æ³•ï¼Œåœ¨çœŸæ­£`return`ä¹‹å‰ï¼Œ`react`è¿˜ä¼šå†æ¬¡è°ƒç”¨ç”Ÿæˆè™šæ‹Ÿ`dom`çš„é€»è¾‘ä¹Ÿå°±æ˜¯`ReactElement`æ–¹æ³•ï¼Œå°†`span`è¿™ä¸€æ®µè½¬å˜æˆè™šæ‹Ÿ`dom`ã€‚

è€Œå¯¹äº`react`è€Œè¨€ï¼Œå¾ˆæ˜æ˜¾è™šæ‹Ÿ`dom`çš„`span`ä¹Ÿå¯èƒ½ç†è§£æˆä¸€ä¸ªæœ€æœ€æœ€åŸºç¡€çš„ç»„ä»¶ï¼Œæ‰€ä»¥å®ƒä¼šé‡èµ°`beginWork`è¿™æ¡è·¯çº¿ï¼Œåªæ˜¯åˆ°äº†ç»„ä»¶åˆ†ç±»æ—¶ï¼Œè¿™ä¸€æ¬¡ä¼šèµ°`HostComponent`è·¯çº¿ï¼Œç„¶åè§¦å‘`updateHostComponent`æ–¹æ³•ï¼Œæˆ‘ä»¬ç›´æ¥è·³è¿‡ç›¸åŒçš„æµç¨‹ï¼Œä¹‹åå°±ä¼šèµ°åˆ°`completeWork`æ–¹æ³•ã€‚

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¾‹å­`P`ç»„ä»¶è™šæ‹Ÿ`dom`éƒ½å‡†å¤‡å®Œæ¯•ï¼Œç°åœ¨è¦åšçš„æ˜¯å¯¹äº`è™šæ‹Ÿ`domè¿™ç§æœ€åŸºç¡€çš„ç»„ä»¶åšè½¬æˆçœŸå®`dom`çš„æ“ä½œï¼Œè§å¦‚ä¸‹ä»£ç ï¼š

    function completeWork(current, workInProgress, renderLanes) {
      var newProps = workInProgress.pendingProps;
    	// æ ¹æ®tagç±»å‹åšä¸åŒçš„å¤„ç†
      switch (workInProgress.tag) {
        // æ ‡ç­¾ç±»çš„åŸºç¡€ç»„ä»¶èµ°è¿™æ¡è·¯
        case HostComponent:
          {
            popHostContext(workInProgress);
            var rootContainerInstance = getRootHostContainer();
            var type = workInProgress.type;
    
            if (current !== null && workInProgress.stateNode != null) {
              // ...
            } else {
              // ...
              } else {
                // å…³æ³¨ç‚¹1ï¼šåˆ›å»ºè™šæ‹Ÿdomçš„å®ä¾‹
                var instance = createInstance(type, newProps, rootContainerInstance, currentHostContext, workInProgress);
                appendAllChildren(instance, workInProgress, false, false);
                workInProgress.stateNode = instance; // Certain renderers require commit-time effects for initial mount.
                // å…³æ³¨ç‚¹2ï¼šåˆå§‹åŒ–å®ä¾‹çš„å­å…ƒç´ 
                if (finalizeInitialChildren(instance, type, newProps, rootContainerInstance)) {
                  markUpdate(workInProgress);
                }
              }
            }
          }
      }
    }
    

å¯ä»¥çŒœåˆ°ï¼Œè™½ç„¶åŒæ ·è¿˜æ˜¯è°ƒç”¨`createInstance`ç”Ÿæˆå®ä¾‹ï¼Œä½†ç›®å‰å’±ä»¬çš„ç»„ä»¶æ˜¯ä¸ªè™šæ‹Ÿ`dom`å¯¹è±¡å•Šï¼Œä¸€ä¸ªæ™®é€šçš„`span`æ ‡ç­¾ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ä¸€å®šä¼šåˆ›å»ºæœ€åŸºæœ¬çš„`span`èŠ‚ç‚¹ï¼Œä»£ç å¦‚ä¸‹ï¼š

    function createInstance(type, props, rootContainerInstance, hostContext, internalInstanceHandle) {
    	// æ ¹æ®spanåˆ›å»ºèŠ‚ç‚¹ï¼Œè°ƒç”¨createElementæ–¹æ³•
      var domElement = createElement(type, props, rootContainerInstance, parentNamespace);
      precacheFiberNode(internalInstanceHandle, domElement);
      // å°†è™šæ‹Ÿdom spançš„å±æ€§æ·»åŠ åˆ°spanèŠ‚ç‚¹ä¸Š
      updateFiberProps(domElement, props);
      return domElement;
    }
    
    // createElementå…·ä½“å®ç°
    function createElement(type, props, rootContainerElement, parentNamespace) {
      var isCustomComponentTag; 
      var ownerDocument = getOwnerDocumentFromRootContainer(rootContainerElement);
      var domElement;
      var namespaceURI = parentNamespace;
    
      if (namespaceURI === HTML_NAMESPACE$1) {
        if (type === 'script') {
          var div = ownerDocument.createElement('div');
          div.innerHTML = '<script><' + '/script>';
          var firstChild = div.firstChild;
          domElement = div.removeChild(firstChild);
        } else if (typeof props.is === 'string') {
          domElement = ownerDocument.createElement(type, {
            is: props.is
          });
        } else {
          // åœ¨è¿™é‡Œï¼ŒçœŸå®dom spanèŠ‚ç‚¹åˆ›å»ºå®Œæ¯•
          domElement = ownerDocument.createElement(type); 
          if (type === 'select') {
            var node = domElement;
    
            if (props.multiple) {
              node.multiple = true;
            } else if (props.size) {
              node.size = props.size;
            }
          }
        }
      } else {
        domElement = ownerDocument.createElementNS(namespaceURI, type);
      }
      return domElement;
    }
    

åœ¨`createElement`æ–¹æ³•ä¸­ï¼Œ`react`ä¼šæ ¹æ®ä½ çš„æ ‡ç­¾ç±»å‹æ¥å†³å®šæ€ä¹ˆåˆ›å»º`dom`ï¼Œæ¯”å¦‚å¦‚æœä½ æ˜¯`script`ï¼Œé‚£å°±åˆ›å»ºä¸€ä¸ª`div`ç”¨äºåŒ…è£¹ä¸€ä¸ª`script`æ ‡ç­¾ã€‚è€Œæˆ‘ä»¬çš„`span`å¾ˆæ˜¾ç„¶å°±æ˜¯é€šè¿‡`ownerDocument.createElement(type)`åˆ›å»ºï¼Œå¦‚ä¸‹å›¾ï¼š

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163800478-710099574.png)

åˆ›å»ºå®Œæˆåï¼Œæ­¤æ—¶çš„`span`èŠ‚ç‚¹è¿˜æ˜¯ä¸€ä¸ªå•¥éƒ½æ²¡æœ‰çš„ç©º`span`ï¼Œæ‰€ä»¥é€šè¿‡`updateFiberProps`å°†è¿˜æœªåŠ å·¥çš„`span`çš„å­èŠ‚ç‚¹ä»¥åŠå…¶å®ƒå±æ€§å¼ºè¡Œèµ‹äºˆç»™`span`ï¼Œåœ¨ä¹‹åä¼šè¿›ä¸€æ­¥åŠ å·¥ï¼Œä¹‹åè¿”å›æˆ‘ä»¬çš„`span`ï¼š

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163801822-1266371902.png)

ç„¶åæ¥åˆ°`finalizeInitialChildren`æ–¹æ³•ï¼Œè¿™é‡Œå¼€å§‹å¯¹åˆ›å»ºçš„`span`èŠ‚ç‚¹çš„å­å…ƒç´ è¿›ä¸€æ­¥åŠ å·¥ï¼Œå…¶å®å°±æ˜¯æ–‡æœ¬`111`ï¼Œ

    function finalizeInitialChildren(domElement, type, props, rootContainerInstance, hostContext) {
      // å®é™…è§¦å‘çš„å…¶å®æ˜¯è¿™ä¸ª
      setInitialProperties(domElement, type, props, rootContainerInstance);
      return shouldAutoFocusHostComponent(type, props);
    }
    
    // è·³è¿‡å¯¹äºéƒ¨åˆ†ï¼Œæ¥ç€çœ‹ setInitialDOMProperties
    function setInitialProperties(domElement, tag, rawProps, rootContainerElement) {
      var props;
    
      switch (tag) {
    		// ...
        default:
          props = rawProps;
      }
    	// éªŒè¯propsåˆæ³•æ€§
      assertValidProps(tag, props);
      // æ­£å¼è®¾ç½®props
      setInitialDOMProperties(tag, domElement, rootContainerElement, props, isCustomComponentTag);
      }
    }
    

åˆæ˜¯ä¸€ç³»åˆ—çš„è·³è½¬ï¼Œä¸º`dom`è®¾ç½®å±æ€§çš„é€»è¾‘ç°åœ¨åˆèšç„¦åœ¨äº†`setInitialDOMProperties`ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä»£ç ï¼š

    function setInitialDOMProperties(tag, domElement, rootContainerElement, nextProps, isCustomComponentTag) {
      for (var propKey in nextProps) {
        // éå†æ‰€æœ‰å±æ€§ï¼Œåªè¦è¿™ä¸ªå±æ€§ä¸æ˜¯åŸå‹å±æ€§ï¼Œé‚£å°±å¼€å§‹æ­£å¼å¤„ç†
        if (!nextProps.hasOwnProperty(propKey)) {
          continue;
        }
    
        var nextProp = nextProps[propKey];
    		// å¦‚æœå±æ€§æ˜¯æ ·å¼ï¼Œé‚£å°±é€šè¿‡setValueForStylesä¸ºdomè®¾ç½®æ ·å¼
        if (propKey === STYLE) {
          {
            if (nextProp) {
              Object.freeze(nextProp);
            }
          }
          setValueForStyles(domElement, nextProp);
        } else if (propKey === DANGEROUSLY_SET_INNER_HTML) {
    
        } else if (propKey === CHILDREN) {
          if (typeof nextProp === 'string') {
            var canSetTextContent = tag !== 'textarea' || nextProp !== '';
            if (canSetTextContent) {
              // è®¾ç½®æ–‡æœ¬å±æ€§
              setTextContent(domElement, nextProp);
            }
          } else if (typeof nextProp === 'number') {
            setTextContent(domElement, '' + nextProp);
          }
        } else if (propKey === SUPPRESS_CONTENT_EDITABLE_WARNING || propKey === SUPPRESS_HYDRATION_WARNING) ; else if (propKey === AUTOFOCUS) ; else if (registrationNameDependencies.hasOwnProperty(propKey)) {
          if (nextProp != null) {
            if ( typeof nextProp !== 'function') {
              warnForInvalidEventListener(propKey, nextProp);
            }
    
            if (propKey === 'onScroll') {
              listenToNonDelegatedEvent('scroll', domElement);
            }
          }
        } else if (nextProp != null) {
          setValueForProperty(domElement, propKey, nextProp, isCustomComponentTag);
        }
      }
    }
    

è¿™æ®µä»£ç çœ‹ç€æœ‰ç‚¹é•¿ï¼Œå…¶å®åšçš„äº‹æƒ…éå¸¸çš„æ¸…æ™°ï¼Œéå†`span`ç›®å‰çš„`props`ï¼Œå¦‚æœ`props`çš„`key`æ˜¯`style`ï¼Œé‚£å°±é€šè¿‡`setValueForStyles`ä¸ºå½“å‰çœŸå®`dom`ä¸€ä¸€è®¾ç½®æ ·å¼ï¼Œå¦‚æœ`key`æ˜¯`children`ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬è™šæ‹Ÿ`dom`çš„`111`æ˜¯æ”¾åœ¨`children`å±æ€§ä¸­çš„ï¼Œå¤–åŠ ä¸Šå¦‚æœè¿™ä¸ª`children`ç±»å‹è¿˜æ˜¯`string`ï¼Œé‚£å°±é€šè¿‡`setTextContent`ä¸º`dom`æ·»åŠ æ–‡æœ¬ä¿¡æ¯ã€‚

è¿™é‡Œç»™å¤§å®¶å±•ç¤ºä¸ºçœŸå®`dom`è®¾ç½®`style`ä»¥åŠè®¾ç½®`innerHTML`çš„æºç ï¼š

    // ä¸ºçœŸå®domæ·»åŠ æ ·å¼çš„é€»è¾‘
    function setValueForStyles(node, styles) {
      // è·å–çœŸæ˜¯domçš„styleå¯¹è±¡ï¼Œåé¢å°±éå†styleså¯¹è±¡ï¼Œä¾æ¬¡è¦†ç›–
      var style = node.style;
      for (var styleName in styles) {
        if (!styles.hasOwnProperty(styleName)) {
          continue;
        }
        var isCustomProperty = styleName.indexOf('--') === 0;
        {
          if (!isCustomProperty) {
            warnValidStyle$1(styleName, styles[styleName]);
          }
        }
        // è·å–æ ·å¼çš„å€¼
        var styleValue = dangerousStyleValue(styleName, styles[styleName], isCustomProperty);
        if (styleName === 'float') {
          styleName = 'cssFloat';
        }
    		// æœ€ç»ˆè¦†ç›–nodeèŠ‚ç‚¹åŸæœ¬çš„å€¼
        if (isCustomProperty) {
          style.setProperty(styleName, styleValue);
        } else {
          style[styleName] = styleValue;
        }
      }
    }
    
    // ä¸ºçœŸå®domæ·»åŠ innerHTMLçš„é€»è¾‘
    var setTextContent = function (node, text) {
      if (text) {
        var firstChild = node.firstChild;
    
        if (firstChild && firstChild === node.lastChild && firstChild.nodeType === TEXT_NODE) {
          firstChild.nodeValue = text;
          return;
        }
      }
      // ä¸ºçœŸå®domè®¾ç½®æ–‡æœ¬ä¿¡æ¯
      node.textContent = text;
    };
    

é‚£ä¹ˆåˆ°è¿™é‡Œï¼Œå…¶å®æˆ‘ä»¬çš„ç»„ä»¶`P`å·²ç»å‡†å¤‡å®Œæ¯•ï¼ŒåŒ…æ‹¬çœŸå®`dom`ä¹Ÿéƒ½åˆ›å»ºå¥½äº†ï¼Œå°±ç­‰æ’å…¥åˆ°é¡µé¢äº†ï¼Œé‚£è¿™äº›`dom`ä»€ä¹ˆæ—¶å€™æ’å…¥åˆ°é¡µé¢çš„å‘¢ï¼Ÿåé¢æˆ‘åˆè·Ÿäº†ä¸‹è°ƒç”¨æ ˆï¼Œæ ¹æ®æˆ‘é¡µé¢å•¥æ—¶å€™ç»˜åˆ¶çš„`111`ä¸€æ­¥æ­¥æ–­ç‚¹ç¼©å°èŒƒå›´ï¼Œæœ€ç»ˆå®šä½åˆ°äº†`insertOrAppendPlacementNodeIntoContainer`æ–¹æ³•ï¼Œç›´è¯‘è¿‡æ¥å°±æ˜¯å°†èŠ‚ç‚¹æ’å…¥æˆ–è€…è¿½åŠ åˆ°å®¹å™¨èŠ‚ç‚¹ä¸­ï¼š

    function insertOrAppendPlacementNodeIntoContainer(node, before, parent) {
      var tag = node.tag;
      var isHost = tag === HostComponent || tag === HostText;
      if (isHost || enableFundamentalAPI ) {
        var stateNode = isHost ? node.stateNode : node.stateNode.instance;
        if (before) {
          // åœ¨å®¹å™¨èŠ‚ç‚¹å‰æ’å…¥
          insertInContainerBefore(parent, stateNode, before);
        } else {
          // åœ¨å®¹å™¨èŠ‚ç‚¹åè¿½åŠ 
          appendChildToContainer(parent, stateNode);
        }
      } else if (tag === HostPortal) ; else {
        var child = node.child;
    		// åªè¦å­èŠ‚ç‚¹ä¸ä¸ºnullï¼Œç»§ç»­é€’å½’è°ƒç”¨
        if (child !== null) {
          insertOrAppendPlacementNodeIntoContainer(child, before, parent);
          var sibling = child.sibling;
    			// åªè¦å…„å¼ŸèŠ‚ç‚¹ä¸ä¸ºnullï¼Œç»§ç»­é€’å½’è°ƒç”¨
          while (sibling !== null) {
            insertOrAppendPlacementNodeIntoContainer(sibling, before, parent);
            sibling = sibling.sibling;
          }
        }
      }
    }
    

åœ¨`insertOrAppendPlacementNodeIntoContainer`ä¸­ï¼Œ`react`ä¼šæ ¹æ®å½“å‰èŠ‚ç‚¹æ˜¯å¦æœ‰å­èŠ‚ç‚¹ï¼Œæˆ–è€…å…„å¼ŸèŠ‚ç‚¹è¿›è¡Œé€’å½’è°ƒç”¨ï¼Œç„¶ååˆ†åˆ«æ ¹æ®`insertInContainerBefore`ä¸`appendChildToContainer`åšæœ€ç»ˆçš„èŠ‚ç‚¹æ’å…¥é¡µé¢æ“ä½œï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹çœ‹`appendChildToContainer`çš„å®ç°ï¼š

    function appendChildToContainer(container, child) {
      var parentNode;
    
      if (container.nodeType === COMMENT_NODE) {
        parentNode = container.parentNode;
        parentNode.insertBefore(child, container);
      } else {
        parentNode = container;
        // å°†å­èŠ‚ç‚¹æ’å…¥åˆ°çˆ¶èŠ‚ç‚¹ä¸­
        parentNode.appendChild(child);
      var reactRootContainer = container._reactRootContainer;
    
      if ((reactRootContainer === null || reactRootContainer === undefined) && parentNode.onclick === null) {
        // TODO: This cast may not be sound for SVG, MathML or custom elements.
        trapClickOnNonInteractiveElement(parentNode);
      }
    }
    

ç”±äºæˆ‘ä»¬å®šä¹‰çš„ç»„ä»¶éå¸¸ç®€å•ï¼Œ`P`ç»„ä»¶åªæœ‰ä¸€ä¸ª`span`æ ‡ç­¾ï¼Œæ‰€ä»¥è¿™é‡Œçš„`parentNode`å…¶å®å°±æ˜¯å®¹å™¨æ ¹èŠ‚ç‚¹ï¼Œå½“æ‰§è¡Œå®Œ`parentNode.appendChild(child)`ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢å°±å‡ºç°äº†`111`äº†ã€‚

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163803240-717628951.png)

è‡³æ­¤ï¼Œç»„ä»¶çš„è™šæ‹Ÿ`dom`ç”Ÿæˆï¼ŒçœŸå®`dom`çš„åˆ›å»ºï¼ŒåŠ å·¥ä»¥åŠæ¸²æŸ“å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚

å¯èƒ½å¤§å®¶å¯¹äºè¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒè¿·ç³Šï¼Œæˆ‘å¤§è‡´ç”»ä¸ªå›¾æè¿°ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163805896-567787527.png)

è€Œ`react`æ˜¯æ€ä¹ˆçŸ¥é“è°æ˜¯è°çš„å­èŠ‚ç‚¹ï¼Œè°æ˜¯è°çš„çˆ¶èŠ‚ç‚¹ï¼Œè¿™ä¸ªå°±éœ€è¦äº†è§£`fiber`å¯¹è±¡äº†ï¼Œå…¶å®æˆ‘ä»¬åœ¨åˆ›å»ºå®ŒçœŸå®`dom`åï¼Œå®ƒè¿˜æ˜¯ä¼šè¢«åŠ å·¥æˆä¸€ä¸ª`fiber`èŠ‚ç‚¹ï¼Œè€Œæ­¤èŠ‚ç‚¹ä¸­é€šè¿‡`child`å¯ä»¥è®¿é—®åˆ°è‡ªå·±çš„å­èŠ‚ç‚¹ï¼Œé€šè¿‡`sibling`è·å–è‡ªå·±çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œæœ€åé€šè¿‡`return`å±æ€§è·å–è‡ªå·±çš„çˆ¶èŠ‚ç‚¹ï¼Œé€šè¿‡è¿™äº›å±æ€§ä¸ºæ„å»º`dom`æ ‘æä¾›äº†æ”¯æ’‘ï¼Œå½“ç„¶`fiber`æˆ‘ä¼šå¦å¼€ä¸€ç¯‡æ–‡ç« æ¥è§£é‡Šï¼Œè¿™é‡Œä¸æ€¥ã€‚

å‰æ–‡ï¼Œæˆ‘ä»¬éªŒè¯äº†`Class`ç»„ä»¶æ˜¯é€šè¿‡`new`å¾—åˆ°ç»„ä»¶å®ä¾‹ï¼Œç„¶åå¼€å±•åç»­æ“ä½œï¼Œé‚£å¯¹äºå‡½æ•°ç»„ä»¶ï¼Œæ˜¯ä¸æ˜¯ç›´æ¥è°ƒç”¨æ‹¿åˆ°å­ç»„ä»¶å‘¢ï¼Ÿè¿™é‡Œæˆ‘ç®€å•è·Ÿäº†ä¸‹æºç ï¼Œå‘ç°äº†å¦‚ä¸‹ä»£ç ï¼š

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163807783-2045803986.png)

    function renderWithHooks(current, workInProgress, Component, props, secondArg, nextRenderLanes) {
      // ....
      var children = Component(props, secondArg);
    }
    

å¯ä»¥å‘ç°ç¡®å®å¦‚æ­¤ï¼Œæ‹¿åˆ°å­èŠ‚ç‚¹ï¼Œç„¶ååç»­è¿˜æ˜¯è·Ÿä¹‹å‰ä¸€æ ·ï¼Œå°†è™šæ‹Ÿ`dom`è½¬å˜æˆçœŸå®`dom`ï¼Œä»¥åŠåç»­çš„ä¸€ç³»åˆ—æ“ä½œã€‚

ä¸è¿‡æœ‰ç‚¹æ„å¤–çš„æ˜¯ï¼Œæˆ‘ä»¥ä¸ºæˆ‘å®šä¹‰çš„å‡½æ•°ç»„ä»¶åœ¨åˆ¤æ–­ç»„ä»¶ç±»å‹æ—¶ï¼Œä¼šèµ°`case FunctionComponent`åˆ†æ”¯è·¯çº¿ï¼Œç»“æœå®ƒèµ°çš„`case IndeterminateComponent`ï¼Œä¹Ÿå°±æ˜¯æ¨¡ç³Šå®šä¹‰çš„ç»„ä»¶ï¼Œä¸è¿‡å½±å“ä¸å¤§ï¼Œè¿˜æ˜¯ç¬¦åˆæˆ‘ä»¬çš„æ¨æµ‹ã€‚

å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘å·²ç»å†™äº†ä¸€ä¸‡å­—ï¼Œå…³äºè™šæ‹Ÿ`dom`å¦‚ä½•è½¬å˜æˆçœŸå®`dom`ä¹Ÿä»‹ç»å®Œæ¯•äº†ã€‚

æŒ â€ æˆ‘æ˜¯å¦‚ä½•é˜…è¯»æºç çš„
=============

åœ¨æ–‡ç« ç»“æŸå‰ï¼Œæˆ‘é¡ºå¸¦åˆ†äº«ä¸‹æˆ‘æ˜¯å¦‚ä½•é˜…è¯»`react`æºç çš„ï¼Œæœ¬æ¥åœ¨å†™è¿™ç¯‡æ–‡ç« å‰ï¼Œæˆ‘ä¹Ÿæƒ³ç€è¦ä¸æŸ¥æŸ¥èµ„æ–™ï¼Œçœ‹çœ‹å¤§å®¶éƒ½æ˜¯æ€ä¹ˆå†™çš„ï¼Œç»“æœéƒ¨åˆ†é«˜èµçš„æ–‡ç« åŸºæœ¬å‘å¸ƒæ—¶é—´éƒ½åœ¨`19`å¹´ï¼Œé‚£æ—¶å€™çš„`react`ç‰ˆæœ¬åŸºæœ¬éƒ½æ˜¯`15`ï¼Œè¿`fiber`çš„æ¦‚å¿µéƒ½æ²¡æœ‰ï¼Œæ— å¥ˆä¹‹ä¸‹æˆ‘åªèƒ½è‡ªå·±æ¥å°è¯•è¯»æºç å¹¶è§£å†³æˆ‘è‡ªå·±æå‡ºçš„é—®é¢˜ã€‚å¦‚æœå°†æºç é˜…è¯»ç†è§£æˆä¸€æ¬¡æ¢é™©ï¼Œæˆ‘æ˜¯è¿™æ ·åšçš„ã€‚

### æŒ â€ ç¡®å®šé˜…è¯»å‰çš„ç›®æ ‡

`react`çš„æºç æ¯”è¾ƒå¤šï¼Œä¸€ä¸ª`react`ä¸€ä¸ª`react-dom`åŠ èµ·æ¥ä»£ç é‡éƒ½å‡ ä¸‡è¡Œäº†ï¼Œæ‰€ä»¥åœ¨è¯»ä¹‹å‰ï¼Œä¸€å®šè¦ææ¸…æ¥šè‡ªå·±çš„ç›®æ ‡ï¼Œè¿™æ ·ä½ ä¹Ÿèƒ½å°‘å—ä¸é‡è¦é€»è¾‘çš„å¹²æ‰°ï¼Œæ¯”å¦‚æˆ‘åœ¨é˜…è¯»ä¹‹å‰åˆæ­¥å®šä¸‹çš„ç›®æ ‡æ˜¯ï¼š

*   è™šæ‹Ÿ`dom`æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Ÿ
*   å‡½æ•°ç»„ä»¶å’Œ`class`ç»„ä»¶æ¸²æŸ“æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
*   ä¸ºå•¥æˆ‘ä¹‹å‰å°è¯•ç›´æ¥ä¿®æ”¹è™šæ‹Ÿ`dom`ï¼Œæ·»åŠ å±æ€§æ²¡æˆåŠŸï¼ˆå¯¹åº”åé¢typeof Symbolçš„è§£é‡Šï¼‰
*   è™šæ‹Ÿ`dom`æ˜¯æ€ä¹ˆè½¬å˜æˆçœŸå®`dom`çš„ï¼Ÿ
*   å•¥æ—¶å€™æ‰æŠŠçœŸå®`dom`æ’å…¥åˆ°é¡µé¢ï¼Ÿ
*   ...

æ¸…æ™°äº†ç›®æ ‡ï¼Œé‚£å°±å¯ä»¥æ‰¾åˆ°èµ·ç‚¹å¼€å§‹çœ‹äº†ï¼Œæˆ‘è¦çœ‹æ¸²æŸ“ï¼Œé‚£è‡ªç„¶çœ‹`render`ï¼Œä½†æ¥ä¸‹æ¥å°±éº»çƒ¦äº†ï¼Œå¦‚æœä½ è·Ÿç€`render`ä¸€æ­¥æ­¥å¾€ä¸‹èµ°ï¼Œé‚£ä¼°è®¡ä½ çœ‹ä¸äº†äº”åˆ†é’Ÿï¼Œåº”è¯¥å°±æ²¡è€å¿ƒçœ‹äº†ï¼Œå› ä¸ºè¿™é‡Œé¢å­˜åœ¨å¤§é‡ä½ æ ¹æœ¬çœ‹ä¸æ‡‚ï¼Œæˆ–è€…å¯¹ä½ å¸®åŠ©ä¸å¤§çš„ä»£ç ï¼Œé‚£ä¹ˆæˆ‘æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ

### æŒ â€ ä»¥ç‚¹æˆçº¿

æˆ‘è¦çœ‹è™šæ‹Ÿ`dom`è½¬å˜çœŸå®`dom`ï¼Œ`react`åˆ°å¤´æ¥è¿˜æ˜¯è¦æ“ä½œçœŸå®`dom`ï¼Œé‚£å®ƒå°±ä¸€å®šå¾—é€šè¿‡åŸç”Ÿçš„`createElement`æ¥åˆ›å»º`dom`èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥åœ¨æºç ä¸­æœ`createElement`ï¼Œç„¶åçœ‹çœ‹è¿™äº›å‘½åå‡ºç°çš„ä¸Šä¸‹æ–‡ï¼Œæ ¹æ®è¯­å¢ƒå¤§è‡´æ¨æ–­æ˜¯å¦æ˜¯è‡ªå·±æƒ³è¦çš„ï¼Œä¸ç¡®å®šä¹Ÿå¯ä»¥æ‰“ä¸ªæ–­ç‚¹ã€‚

å“ï¼Œç„¶åæˆ‘å°±å‘ç°æˆ‘æˆåŠŸæ‰¾åˆ°`function createElement`æ–¹æ³•ï¼Œè€Œä¸”å®ƒè¿˜çœŸæ˜¯æˆ‘æƒ³è¦çš„æ–¹æ³•ï¼Œä½†æ˜¯å‘¢ï¼Œæ­¤æ—¶é€»è¾‘è·ç¦»`render`å¯è°“æ˜¯åä¸‡å…«åƒé‡Œï¼Œè¿™ä¸­é—´ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè¿™æ—¶å€™å°±å¯ä»¥æ ¹æ®æ‰§è¡Œæ ˆè¿›è¡Œæ¢³ç†ï¼š

![](https://img2022.cnblogs.com/blog/1213309/202206/1213309-20220609163809448-1216463734.jpg)

æ¯”å¦‚ä¸Šå›¾å°±æ˜¯æˆ‘å®šä½åˆ°ç»™çœŸå®`dom`æ·»åŠ å±æ€§çš„æ–¹æ³•ï¼Œç„¶åæˆ‘æ ¹æ®è°ƒç”¨æ ˆå‘½åï¼Œå¤§è‡´çŸ¥é“å®ƒåœ¨å¹²å˜›ï¼ŒåŒæ—¶æ’é™¤é‚£äº›æ²¡æ„ä¹‰çš„å‡½æ•°çš„å¹²æ‰°ï¼Œä»ç»ˆç‚¹åå‘èµ°å›èµ·ç‚¹ï¼Œçœ‹çœ‹è¿™ä¸€è·¯`react`æ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚

åŒç†ï¼Œæˆ‘åœ¨æ‰¾æœ€å`react`å°†çœŸå®`dom`æ’å…¥åˆ°é¡µé¢çš„é€»è¾‘æ—¶ï¼Œæˆ‘å‘ç°æˆ‘è·Ÿä¸ä¸‹å»äº†ï¼Œå› ä¸ºæ–­ç‚¹ä¹±è·³ï¼Œäºæ˜¯æˆ‘å°±çœ‹é¡µé¢æ¸²æŸ“`111`çš„æ—¶æœºï¼Œç„¶ååˆç•¥æ–­ç‚¹ï¼Œå¦‚æœè¿™ä¸ªæ–­ç‚¹è¿˜æ²¡èµ°åˆ°`111`å·²ç»æ¸²æŸ“äº†ï¼Œè¯´æ˜è¿™ä¸ªæ“ä½œåœ¨ä¹‹å‰ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ä¸æ–­ç¼©å°èŒƒå›´èŒƒå›´ï¼Œæœ€ç»ˆå®šä½åˆ°äº†`insertOrAppendPlacementNodeIntoContainer`æ–¹æ³•ï¼Œä¹Ÿè§£å¼€äº†æˆ‘å‰é¢çš„ç–‘æƒ‘ã€‚

### æŒ â€ ä»¥çº¿æˆé¢

é€šè¿‡ä»¥ç‚¹è¿çº¿çš„æ–¹å¼ï¼Œä½ èƒ½éå¸¸å¿«çš„ç†æ¸…ä¸€å°æ®µä¸€å°æ®µçš„é€»è¾‘ï¼Œè€Œè¿™äº›é€»è¾‘çš„äº¤å‰ï¼Œé˜…è¯»å‰çš„ç›®æ ‡å°±é€æ¸æ¸…æ™°äº†ã€‚æ¯”å¦‚æˆ‘åœ¨æ¢³ç†äº†`Class`ç»„ä»¶åï¼Œæˆ‘å°±åœ¨æƒ³ï¼Œå‡½æ•°ç»„ä»¶åˆæ˜¯æ€ä¹ˆæ¸²æŸ“çš„ï¼Ÿäºæ˜¯éå¸¸å¿«çš„å®šä½åˆ°äº†å‡½æ•°ç»„ä»¶æ¸²æŸ“å­èŠ‚ç‚¹çš„é€»è¾‘ã€‚

æˆ‘ä»¬å¯ä»¥æŠŠæºç ç†è§£æˆå¤œæ™šçš„æ˜Ÿç©ºï¼Œå°æ—¶å€™æ€»æ˜¯å–œæ¬¢é€‰å‡ ä¸ªç‚¹ç»ƒæˆçº¿ï¼Œå†ç”¨çº¿è¿æˆå›¾æ¡ˆï¼Œä»€ä¹ˆåŒ—ææ˜Ÿç»‡å¥³æ˜Ÿï¼Œä¸å°±æ˜¯è¿™æ ·ç”»å‡ºæ¥çš„å—ï¼Œè€Œç°åœ¨åªæ˜¯å°†è¿™ç§åšæ³•æŠ•å°„åˆ°äº†æºç é˜…è¯»ä¸­ç½¢äº†ã€‚

ç– â€ æ€»
=====

å†™åˆ°è¿™å·²ç»ä¸€ä¸‡ä¸€åƒå­—ï¼Œå·®ä¸å¤šä¸€ç¯‡è®ºæ–‡çš„é•¿åº¦äº†ã€‚è€Œè¿™ç¯‡æ–‡ç« ï¼Œä»æŸ¥èµ„æ–™ï¼Œè¯»æºç åˆ°å†™ä½œç»“æŸï¼Œä¹Ÿå·®ä¸å¤šç”¨äº†æˆ‘ä¸€å‘¨çš„é›¶ç¢æ—¶é—´ã€‚ä¸€å¼€å§‹åªæ˜¯æƒ³å†™å†™æ¦‚å¿µï¼Œå†™ç€å†™ç€å¯¹è‡ªå·±è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼Œäºæ˜¯ä¸€ç¯‡æ–‡ç« å†™å¾—åœä¸ä¸‹æ¥äº†ï¼Œä¸è¿‡å¥½åœ¨ç»ˆäºå†™åˆ°äº†å°¾å£°ï¼Œæˆ‘ä¹Ÿæ¾äº†å£æ°”äº†ï¼ˆä¸‹ä¸€ç¯‡`fiber`æ„Ÿè§‰ä¹Ÿå¾ˆéš¾å—çš„æ ·å­ï¼‰ã€‚

é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬ä»‹ç»äº†è™šæ‹Ÿ`dom`çš„æ¦‚å¿µï¼Œäº†è§£äº†ç©¶ç«Ÿä»€ä¹ˆæ˜¯è™šæ‹Ÿ`dom`ã€‚ç»“åˆæ–‡ç« å¼€å¤´æ¡†æ¶å‘å±•å²ï¼Œæˆ‘ä»¬ä¹Ÿè§£é‡Šäº†è™šæ‹Ÿ`dom`å­˜åœ¨çš„ä»·å€¼ä»¥åŠå®ƒæ‰€å…·å¤‡çš„ä¼˜åŠ¿ï¼Œè€Œä¸”æ¡†æ¶ä¹‹é—´ä¹Ÿä¸åº”è¯¥ç›²ç›®çš„å»å¯¹æ¯”ã€‚åœ¨æ–‡ç« ååŠæ®µï¼Œæˆ‘ä»¬ä»‹ç»äº†`React.createElement`ä¸`ReactDOM.render`çš„æºç ï¼Œç†è§£äº†è™šæ‹Ÿ`dom`çš„åˆ›å»ºè¿‡ç¨‹ï¼Œä»¥åŠ`react`æ˜¯å¦‚ä½•å°†è™šæ‹Ÿ`dom`è½¬å˜æˆçœŸå®`dom`çš„ï¼Œå¦‚æœæœ‰æ—¶é—´ï¼Œæˆ‘ä¹Ÿæ¨èå¤§å®¶è‡ªè¡Œæ–­ç‚¹ï¼Œæ ¹æ®æˆ‘çš„æç¤ºæ¥åŠ æ·±ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼Œå®ƒå¹¶ä¸éš¾ï¼Œåªæ˜¯éœ€è¦è¶³å¤Ÿçš„è€å¿ƒã€‚

å¸Œæœ›æœ¬æ–‡èƒ½ä¸ºæœ‰ç¼˜çš„ä½ æä¾›ä¸€äº›å¸®åŠ©ï¼Œé‚£ä¹ˆæœ¬æ–‡åˆ°è¿™é‡Œæ­£å¼ç»“æŸã€‚

posted on 2022-06-09 18:40Â  [å¬é£æ˜¯é£](https://www.cnblogs.com/echolun/)Â  é˜…è¯»(0)Â  è¯„è®º(0)Â  [ç¼–è¾‘](https://i.cnblogs.com/EditPosts.aspx?postid=16359890)Â  [æ”¶è—](javascript:void(0))Â  [ä¸¾æŠ¥](javascript:void(0))