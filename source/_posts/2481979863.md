---
layout: post
title: "iwdg和wwdg     "
date: "2022-04-06T22:18:31.525Z"
---
iwdg和wwdg
=========

![iwdg和wwdg     ](https://img2022.cnblogs.com/blog/2649909/202204/2649909-20220406202027392-2081941740.png) 关于独立看门狗和窗口看门狗的程序实践 iwdg&wwdg

一、什么是看门狗？
---------

在单片机工作的时候经常会出现受到外界电磁场的干扰导致程序跑飞，而陷入死循环，而使整个系统陷入无法正常工作的状态。

“看门狗”是一种专门用于监测单片机程序运行状态的模块或者芯片。

二、独立看门狗iwdg
-----------

独立看门狗应用到的寄存器

键值寄存器IWDG\_KR:0~15位有效

预分频寄存器IWDG\_PR:0~2位有效

重装载寄存器IWDG\_RLR:0~11位有效       

上述两个寄存器具有写保护功能

状态寄存器IWDG\_SR:0~1位有效

### 独立看门狗操作步骤

![](https://img2022.cnblogs.com/blog/2649909/202204/2649909-20220406194028008-498801033.png)

### 独立看门狗程序实践

在STM32F103系列单片机的不完全手册上面有对于独立看门狗的例程，分为初始化和喂狗两部分，这个程序是与上面的步骤相对应的。

![](https://img2022.cnblogs.com/blog/2649909/202204/2649909-20220406195747418-724447087.png)

 在后续的实践和学习中，发现可以用cubeMX进行看门狗的配置（等同于在代码中的初始化），之后在代码中用HAL\_IWDG\_Refresh函数直接喂狗就可以了。

 ![](https://img2022.cnblogs.com/blog/2649909/202204/2649909-20220406194353362-1705992631.png)

 ![](https://img2022.cnblogs.com/blog/2649909/202204/2649909-20220406194418750-1147176959.png)

![](https://img2022.cnblogs.com/blog/2649909/202204/2649909-20220406200413919-1385354155.jpg)

 三、窗口看门狗wwdg
------------

窗口看门狗（WWDG）用于发现由外部接口或者不可预期的逻辑操作导致的软件故障。这些故障会导致程序中断正常运行。当一个程序周期结束时，看门狗电路会产生一个MCU复位信号，除非在看门狗电路复位之前程序返回正常运行逻辑。当计数器减少到预设值的时候，也会产生一个复位信号。这就意味着计数器必须限制在一个指定的窗口内。

【窗口看门狗主要特性】

1、可编程向下计数器 

2、复位条件：计数器值小于0x40或者计数器值超出设定的窗口。

3、早期唤醒中断（EWI）计数值等于0x40时产生中断，即等于0x40就产生中断小于0x40就复位。

产生复位条件：计数器计数到小于0x40，计数器值小于配置寄存器（CFR）中设定的窗口值时  产生复位信号。

窗口计数器的计数值在0x7F到0x40之间变化.窗口计数器一旦被使能，就不能停止，直到reset。即使没有使能窗口看门狗，其计数器也会直至不停地计数，所以为了避免刚开始计数就被复位，计数器的值必须设置为大于等于0x40即CR中的T6位必须设置为1并且小于预设值，然后启动WWDG。

窗口看门狗的特点是：不能在狗饱时喂狗，也不能在狗饿时喂狗。狗饿时喂狗，狗要咬人；狗饱的时候喂，狗也要咬人；只能在一个时间段内、当狗半饱的时候喂，狗才能乖乖地干活。一般的看门狗是在任何时间都可以喂狗，不管狗是不是已经饱了。这段时间就是计数器数字在的T\[6..0\]到0x40之间时，才可以喂狗。这里的窗口，可以理解为喂狗的时间窗口。

 ![](https://img2022.cnblogs.com/blog/2649909/202204/2649909-20220406194901931-568925002.png)

四、关于看门狗的应用和一些理解误区
-----------------

窗口看门狗是挂载在APB1时钟上的一个定时器（计数器），而独立看门狗是应用独立时钟源的一个计数器，对于精准度而言窗口看门狗有更高的时间精确度，但是使用窗口看门狗时

，窗口看门狗的预分频值最高为8，会造成重装载（喂狗）的频率过高，达不到看门狗的效果。

独立看门狗并不能追踪到任务执行到哪里的时候出现了错误，只能在程序跑飞（例如进入hardfault，can error)的时候进行reset。

独立看门狗的喂狗任务可以说是与其他任务是独立的，无论是在定时器中断中，还是在RTOS的多线程系统中，独立看门狗都是独立于其他的任务而存在的，与其他的任务互不干扰。