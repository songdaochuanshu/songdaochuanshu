---
layout: post
title: "ä¸€æ­¥ä¸€æ­¥ç”Ÿæˆæ»‘åŠ¨éªŒè¯ç å›¾ç‰‡"
date: "2022-04-14T05:17:24.180Z"
---
ä¸€æ­¥ä¸€æ­¥ç”Ÿæˆæ»‘åŠ¨éªŒè¯ç å›¾ç‰‡
=============

å›¾ç‰‡å‡†å¤‡
----

å›¾ç‰‡

åç§°

å°ºå¯¸

![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220413194058652-1999387479.jpg)

bg.jpg

552 \* 344

![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220413194356514-1712042113.png)

hole.png

110 \* 110

![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220413194440229-300505845.png)

slider.png

110 \* 110

> hole.pngå’Œslider.pngä¸ºpngæ˜¯å› ä¸ºå›¾ç‰‡å¸¦æœ‰é€æ˜åº¦ã€‚

  

åˆæˆç›®æ ‡
----

æœ€ç»ˆæˆ‘å°†ä¸ºå‰ç«¯ç”Ÿæˆä¸¤å¼ å›¾ç‰‡ï¼š

å›¾ç‰‡

åç§°

å°ºå¯¸

![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220413195051086-218511065.png)

out\_bg.jpg

552 \* 344

![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220413195103783-1663722283.png)

out\_slider.png

110 \* 344

> **out\_slider.pngé«˜åº¦ä¸º344**ä¸èƒŒæ™¯å›¾ç­‰é«˜ã€‚

ä¹Ÿå¯ä»¥æ‰“å¼€æ»‘åŠ¨éªŒè¯[Demo](http://www.sunseeyou.com/)é¡µé¢ï¼ŒF12æ¥è§‚å¯Ÿå›¾ç‰‡ã€‚  
![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220413200738853-103077857.png)  
![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220413200912636-1586502440.png)

  

å®ç°
--

æœ¬æœºç¯å¢ƒä¸º.net 6.0.300-preview.22204.3, è£…æœ‰Vscodeã€‚

### 1.åˆ›å»ºé¡¹ç›®

åˆ›å»ºconsoleé¡¹ç›®

    mkdir SlideImageGenerator
    cd SlideImageGenerator
    dotnet new console
    

### 2.Nugetæ·»åŠ ImageSharp

    dotnet add package SixLabors.ImageSharp
    dotnet add package SixLabors.ImageSharp.Drawing --prerelease
    

### 3.vscodeæ‰“å¼€

    code .
    

![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220414091852455-1370507738.png)

### 4.å¼•å…¥å›¾ç‰‡

åˆ›å»ºImagesç›®å½•, å¹¶æ”¾å…¥bg.jpgï¼Œhole.pngï¼Œslider.png

    mkdir Images
    

![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220414092430935-2126442727.png)

### 5.ç”Ÿæˆout\_bg.jpg

out\_bg.jpgç”Ÿæˆæ¯”è¾ƒç®€å•ï¼Œç›´æ¥å°†hole.png"å åŠ "åˆ°bg.jpgã€‚hole.pngé»‘è‰²åŒºåŸŸæ˜¯åŠé€æ˜çš„ï¼Œå› æ­¤èƒ½å¤Ÿéšçº¦çœ‹åˆ°èƒŒæ™¯ã€‚å¼€å§‹!  
æ¸…ç©ºProgram.csï¼Œå¼•å…¥å‘½åç©ºé—´

    using SixLabors.ImageSharp;
    using SixLabors.ImageSharp.Drawing;
    using SixLabors.ImageSharp.PixelFormats;
    using SixLabors.ImageSharp.Processing;
    using SixLabors.ImageSharp.Drawing.Processing;
    

ç”Ÿæˆéšæœºåæ ‡ï¼Œä»£è¡¨è¦å‡¹æ§½çš„èµ·å§‹ä½ç½®:

    // ç”Ÿæˆéšæœºåæ ‡
    int randomX = 100, randomY = 120;
    

åŠ è½½å›¾ç‰‡

    using var backgroundImage = Image.Load<Rgba32>("images/bg.jpg");
    using var holeTemplateImage = Image.Load<Rgba32>("images/hole.png");
    using var sliderTemplateImage = Image.Load<Rgba32>("images/slider.png");
    

"å åŠ "holeTemplateImageåˆ°backgroundImageã€‚ç”¨ImageSharpæ¥è¯´å°±æ˜¯ä»¥backgroundImageä¸ºåº•ï¼Œä»ä½ç½®randomXï¼ŒrandomYå¼€å§‹ç»˜åˆ¶holeTemplateImageã€‚

    backgroundImage.Mutate(x => x.DrawImage(holeTemplateImage, new Point(randomX, randomY), 1));
    backgroundImage.SaveAsJpegAsync("out_bg.jpg");
    

è¿è¡Œ

    dotnet run
    

è¿è¡Œåå¯ä»¥åœ¨ç›®å½•çœ‹åˆ°out\_bg.jpg  
![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220414101856627-2127395229.png)

å…¨éƒ¨ä»£ç ï¼š

    using SixLabors.ImageSharp;
    using SixLabors.ImageSharp.Drawing;
    using SixLabors.ImageSharp.PixelFormats;
    using SixLabors.ImageSharp.Processing;
    using SixLabors.ImageSharp.Drawing.Processing;
    
    // ç”Ÿæˆéšæœºåæ ‡
    int randomX = 100, randomY = 120;
    
    // åŠ è½½å›¾ç‰‡
    using var backgroundImage = Image.Load<Rgba32>("images/bg.jpg");
    using var holeTemplateImage = Image.Load<Rgba32>("images/hole.png");
    using var sliderTemplateImage = Image.Load<Rgba32>("images/slider.png");
    
    // "å åŠ "holeTemplateImageåˆ°backgroundImage
    backgroundImage.Mutate(x => x.DrawImage(holeTemplateImage, new Point(randomX, randomY), 1));
    backgroundImage.SaveAsJpegAsync("out_bg.jpg");
    
    

### 6.ç”Ÿæˆout\_slider.png

out\_slider.pngç”Ÿæˆéœ€è¦ä¸‰æ­¥:  
a. ä»èƒŒæ™¯å›¾ä¸­æ‰£å‡ºå‡¹æ§½åŒºåŸŸï¼Œå½¢æˆholeMattingImageã€‚  
b. å°†slider.png"å åŠ "åˆ°æŠ å›¾holeMattingImageã€‚  
c. å°†bç”Ÿæˆçš„å›¾å½¢"å åŠ "åˆ°ä¸€ä¸ªé«˜ä¸º344,å®½ä¸º110çš„é€æ˜åŒºåŸŸï¼Œæœ€ç»ˆç”Ÿæˆout\_slider.  
ä»¥ä¸‹å…·ä½“è®²è§£ï¼š  
aæ­¥éª¤æˆ‘ç›´æ¥ä¸Šä»£ç ï¼Œå…¶å®å°±ä¸€ä¸ªè£å‰ªæ“ä½œ:

    // backgroundImageå·²åšä¿®æ”¹ï¼Œè¿™é‡Œé‡æ–°åŠ è½½èƒŒæ™¯
    using var backgroundImage2 = Image.Load<Rgba32>("images/bg.jpg");
    using var holeMattingImage = new Image<Rgba32>(sliderTemplateImage.Width, sliderTemplateImage.Height); // 110 * 110
    // æ ¹æ®é€æ˜åº¦è®¡ç®—å‡¹æ§½å›¾è½®å»“å½¢çŠ¶(å½¢çŠ¶ç”±ä¸é€æ˜åŒºåŸŸå½¢æˆ)
    var holeShape = CalcHoleShape(holeTemplateImage);
    // ç”Ÿæˆå‡¹æ§½æŠ å›¾
    holeMattingImage.Mutate(x =>
    {
        // å¯ä»¥è¿™æ ·ç†è§£ï¼š
        //   å°†holeShapeæƒ³è±¡æˆä¸€å¹…110X110çš„å›¾ç‰‡
        //   p => p.DrawImage(backgroundImage2, new Point(-randomX, -randomY), 1)åˆ™è¡¨ç¤º
        //   ä»holeShapeçš„-randomX, -randomYå¼€å§‹ç»˜åˆ¶backgroundImage2(ç›¸å½“äºbackgroundImage2å·¦ç§»randomXï¼Œä¸Šç§»randomY)
        //   ç„¶åå°†holeShapeç»˜åˆ¶ç»“æœå åŠ åˆ°holeMattingImageä¸Š
        x.Clip(holeShape, p => p.DrawImage(backgroundImage2, new Point(-randomX, -randomY), 1));
    });
    holeMattingImage.SaveAsJpegAsync("out_holeMatting.jpg");
    

è£å‰ªæ³¨æ„ä¼ å…¥çš„è´Ÿåæ ‡ï¼Œæ³¨é‡Šæ˜¯æˆ‘ä¸ªäººçš„ç†è§£ã€‚å‡¹æ§½çš„å½¢çŠ¶é€šè¿‡CalcHoleShapeå®ç°çš„ï¼ŒåŸç†æ˜¯ä¸€è¡Œè¡Œæ‰«æå›¾åƒï¼Œæ¯è¡Œè¿ç»­ä¸é€æ˜åŒºåŸŸï¼ˆåŒ…å«åŠé€æ˜ï¼‰å½¢æˆä¸€ä¸ªæˆ–å¤šä¸ª1\*nçš„çŸ©å½¢ã€‚æœ€åå°†æ‰€æœ‰å°çŸ©å½¢ç»„åˆå½¢æˆä¸€ä¸ªç»„åˆå½¢çŠ¶ComplexPolygon

    Func<Image<Rgba32>, ComplexPolygon> CalcHoleShape = (holeTemplateImage) => { 
        int temp = 0;
        var pathList = new List<IPath>();
        holeTemplateImage.ProcessPixelRows(accessor =>
        {
            for (int y = 0; y < holeTemplateImage.Height; y++)
            {
                var rowSpan = accessor.GetRowSpan(y);
                for (int x = 0; x < rowSpan.Length; x++)
                {
                    ref Rgba32 pixel = ref rowSpan[x];
                    if (pixel.A != 0)
                    {
                        if (temp == 0)
                        {
                            temp = x;
                        }
                    }
                    else
                    {
                        if (temp != 0)
                        {
                            pathList.Add(new RectangularPolygon(temp, y, x - temp, 1));
                            temp = 0;
                        }
                    }
                }
            }
        });
    
        return new ComplexPolygon(new PathCollection(pathList));
    };
    

è¿è¡Œ,å½¢æˆout\_holeMatting.jpg

    dotnet run 
    

![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220414111542256-1993011914.png)

b. å°†slider.png"å åŠ "åˆ°æŠ å›¾holeMattingImageï¼Œä»£ç æ¯”è¾ƒç®€å•

    // å åŠ æ‹–å—æ¨¡æ¿
    holeMattingImage.Mutate(x => x.DrawImage(sliderTemplateImage, new Point(0, 0), 1));
    holeMattingImage.SaveAsJpegAsync("out_holeMatting2.jpg");
    

è¿è¡Œ,å½¢æˆout\_holeMatting2.jpg

    dotnet run 
    

![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220414111557274-807863304.png)

c. å°†out\_holeMatting2å åŠ åˆ°"å åŠ "åˆ°ä¸€ä¸ªé«˜ä¸º344,å®½ä¸º110çš„é€æ˜åŒºåŸŸ

    using var sliderBarImage = new Image<Rgba32>(sliderTemplateImage.Width, backgroundImage2.Height);
    // ç»˜åˆ¶æ‹–å—æ¡
    sliderBarImage.Mutate(x => x.DrawImage(holeMattingImage, new Point(0, randomY), 1));
    sliderBarImage.SaveAsJpegAsync("out_slider.jpg");
    

è¿è¡Œ,å½¢æˆout\_slider.jpg

    dotnet run 
    

![](https://img2022.cnblogs.com/blog/1409297/202204/1409297-20220414111814927-668460324.png)

å…¨éƒ¨ä»£ç 

    using SixLabors.ImageSharp;
    using SixLabors.ImageSharp.Drawing;
    using SixLabors.ImageSharp.PixelFormats;
    using SixLabors.ImageSharp.Processing;
    using SixLabors.ImageSharp.Drawing.Processing;
    
    // ç”Ÿæˆéšæœºåæ ‡
    int randomX = 100, randomY = 120;
    
    // åŠ è½½å›¾ç‰‡
    using var backgroundImage = Image.Load<Rgba32>("images/bg.jpg");
    using var holeTemplateImage = Image.Load<Rgba32>("images/hole.png");
    using var sliderTemplateImage = Image.Load<Rgba32>("images/slider.png");
    
    // "å åŠ "holeTemplateImageåˆ°backgroundImage
    backgroundImage.Mutate(x => x.DrawImage(holeTemplateImage, new Point(randomX, randomY), 1));
    backgroundImage.SaveAsJpegAsync("out_bg.jpg");
    
    Func<Image<Rgba32>, ComplexPolygon> CalcHoleShape = (holeTemplateImage) => { 
        int temp = 0;
        var pathList = new List<IPath>();
        holeTemplateImage.ProcessPixelRows(accessor =>
        {
            for (int y = 0; y < holeTemplateImage.Height; y++)
            {
                var rowSpan = accessor.GetRowSpan(y);
                for (int x = 0; x < rowSpan.Length; x++)
                {
                    ref Rgba32 pixel = ref rowSpan[x];
                    if (pixel.A != 0)
                    {
                        if (temp == 0)
                        {
                            temp = x;
                        }
                    }
                    else
                    {
                        if (temp != 0)
                        {
                            pathList.Add(new RectangularPolygon(temp, y, x - temp, 1));
                            temp = 0;
                        }
                    }
                }
            }
        });
    
        return new ComplexPolygon(new PathCollection(pathList));
    };
    
    // backgroundImageå·²åšä¿®æ”¹ï¼Œè¿™é‡Œé‡æ–°åŠ è½½èƒŒæ™¯
    using var backgroundImage2 = Image.Load<Rgba32>("images/bg.jpg");
    using var holeMattingImage = new Image<Rgba32>(sliderTemplateImage.Width, sliderTemplateImage.Height); // 110 * 110
    // æ ¹æ®é€æ˜åº¦è®¡ç®—å‡¹æ§½å›¾è½®å»“å½¢çŠ¶(å½¢çŠ¶ç”±ä¸é€æ˜åŒºåŸŸå½¢æˆ)
    var holeShape = CalcHoleShape(holeTemplateImage);
    // ç”Ÿæˆå‡¹æ§½æŠ å›¾
    holeMattingImage.Mutate(x =>
    {
        // å¯ä»¥è¿™æ ·ç†è§£ï¼š
        //   å°†holeShapeæƒ³è±¡æˆä¸€å¹…110X110çš„å›¾ç‰‡
        //   p => p.DrawImage(backgroundImage2, new Point(-randomX, -randomY), 1)åˆ™è¡¨ç¤º
        //   ä»holeShapeçš„-randomX, -randomYå¼€å§‹ç»˜åˆ¶backgroundImage2(ç›¸å½“äºbackgroundImage2å·¦ç§»randomXï¼Œä¸Šç§»randomY)
        //   ç„¶åå°†holeShapeç»˜åˆ¶ç»“æœå åŠ åˆ°holeMattingImageä¸Š
        x.Clip(holeShape, p => p.DrawImage(backgroundImage2, new Point(-randomX, -randomY), 1));
    });
    holeMattingImage.SaveAsJpegAsync("out_holeMatting.jpg");
    
    // å åŠ æ‹–å—æ¨¡æ¿
    holeMattingImage.Mutate(x => x.DrawImage(sliderTemplateImage, new Point(0, 0), 1));
    holeMattingImage.SaveAsJpegAsync("out_holeMatting2.jpg");
    
    using var sliderBarImage = new Image<Rgba32>(sliderTemplateImage.Width, backgroundImage2.Height);
    // ç»˜åˆ¶æ‹–å—æ¡
    sliderBarImage.Mutate(x => x.DrawImage(holeMattingImage, new Point(0, randomY), 1));
    sliderBarImage.SaveAsJpegAsync("out_slider.jpg");
    

æœ€å
--

å®Œæ•´çš„æ»‘åŠ¨éªŒè¯ï¼Œå¯ä»¥å‚è€ƒ[LazySlideCaptcha](https://gitee.com/pojianbing/lazy-slide-captcha)ã€‚å†™çš„æ¯”è¾ƒæ°´ï¼Œæ¬¢è¿Starã€‚ğŸ¶