---
layout: post
title: "æ•°æ®é©±åŠ¨ï¼ç²¾ç»†åŒ–è¿è¥ï¼ç”¨æœºå™¨å­¦ä¹ åšå®¢æˆ·ç”Ÿå‘½å‘¨æœŸä¸ä»·å€¼é¢„ä¼°ï¼â›µ"
date: "2022-11-16T07:17:16.308Z"
---
æ•°æ®é©±åŠ¨ï¼ç²¾ç»†åŒ–è¿è¥ï¼ç”¨æœºå™¨å­¦ä¹ åšå®¢æˆ·ç”Ÿå‘½å‘¨æœŸä¸ä»·å€¼é¢„ä¼°ï¼â›µ
==============================

![æ•°æ®é©±åŠ¨ï¼ç²¾ç»†åŒ–è¿è¥ï¼ç”¨æœºå™¨å­¦ä¹ åšå®¢æˆ·ç”Ÿå‘½å‘¨æœŸä¸ä»·å€¼é¢„ä¼°ï¼â›µ](https://img2022.cnblogs.com/blog/2637458/202211/2637458-20221116151208977-1037052269.png) å¦‚ä½•é¢„æµ‹å®¢æˆ·ä»·å€¼ï¼Œè®¡ç®—ç‰¹å®šæ—¶é—´æ®µå†…èƒ½å¸¦æ¥çš„ä»·å€¼ï¼Œæ˜¯äº’è”ç½‘å…¬å¸åœ¨é¢ä¸´æµ·é‡ç”¨æˆ·æ—¶æ€¥éœ€è§£å†³çš„è¿è¥å‘½é¢˜ã€‚æœ¬æ–‡å°±æ¥è®²è§£ã€æœºå™¨å­¦ä¹ +RFMæ¨¡å‹ã€çš„ç²¾ç»†åŒ–è¿è¥è§£å†³æ–¹æ¡ˆã€‚

![](https://img-blog.csdnimg.cn/img_convert/2582b8eed9e7c508c93ea5536cd1e2c5.png)

> ğŸ’¡ ä½œè€…ï¼š[éŸ©ä¿¡å­](https://github.com/HanXinzi-AI)@[ShowMeAI](https://www.showmeai.tech/)  
> ğŸ“˜ [æœºå™¨å­¦ä¹ å®æˆ˜ç³»åˆ—](https://www.showmeai.tech/tutorials/41)ï¼š[https://www.showmeai.tech/tutorials/41](https://www.showmeai.tech/tutorials/41)  
> ğŸ“˜ [æœ¬æ–‡åœ°å€](https://www.showmeai.tech/article-detail/330)ï¼š[https://www.showmeai.tech/article-detail/330](https://www.showmeai.tech/article-detail/330)  
> ğŸ“¢ å£°æ˜ï¼šç‰ˆæƒæ‰€æœ‰ï¼Œè½¬è½½è¯·è”ç³»å¹³å°ä¸ä½œè€…å¹¶æ³¨æ˜å‡ºå¤„  
> ğŸ“¢ æ”¶è—[ShowMeAI](https://www.showmeai.tech/)æŸ¥çœ‹æ›´å¤šç²¾å½©å†…å®¹

![](https://img-blog.csdnimg.cn/img_convert/2076366f173910a27967bf42ce711588.png)

ç°åœ¨çš„äº’è”ç½‘å¹³å°éƒ½æœ‰ç€æµ·é‡çš„å®¢æˆ·ï¼Œä½†å®¢æˆ·å’Œå®¢æˆ·ä¹‹é—´æœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œäº†è§£å®¢æˆ·çš„è¡Œä¸ºæ–¹å¼å¯¹äºå……åˆ†ç†è§£ç”¨æˆ·ä¸ä¼˜åŒ–æœåŠ¡å¢å¼ºä¸šåŠ¡è‡³å…³é‡è¦ã€‚è€Œå€ŸåŠ©æœºå™¨å­¦ä¹ ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ›´ç²¾ç»†åŒ–åœ°è¿è¥ï¼Œå…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥**é¢„æµ‹å®¢æˆ·ä»·å€¼**ï¼Œå³åœ¨ç‰¹å®šæ—¶é—´æ®µå†…å°†ä¸ºå…¬å¸å¸¦æ¥å¤šå°‘ä»·å€¼ã€‚

æœ¬ç¯‡å†…å®¹ä¸­ä½¿ç”¨çš„ ğŸ†**scanneråœ¨çº¿äº¤æ˜“æ•°æ®é›†**ï¼Œå¯ä»¥ç›´æ¥åœ¨ [ShowMeAI](https://www.showmeai.tech/)çš„ç™¾åº¦ç½‘ç›˜ä¸­ä¸‹è½½è·å–ã€‚

> ğŸ† **å®æˆ˜æ•°æ®é›†ä¸‹è½½ï¼ˆç™¾åº¦ç½‘ç›˜ï¼‰**ï¼šå…¬âœ¦ä¼—âœ¦å·ã€ShowMeAIç ”ç©¶ä¸­å¿ƒã€å›å¤ã€**å®æˆ˜**ã€ï¼Œæˆ–è€…ç‚¹å‡» [**è¿™é‡Œ**](https://www.showmeai.tech/article-detail/305) è·å–æœ¬æ–‡ [\[26\] åŸºäºæœºå™¨å­¦ä¹ çš„å®¢æˆ·ä»·å€¼é¢„ä¼°](https://www.showmeai.tech/article-detail/330) ã€**scanneråœ¨çº¿äº¤æ˜“æ•°æ®é›†**ã€

> â­ **ShowMeAIå®˜æ–¹GitHub**ï¼š[https://github.com/ShowMeAI-Hub](https://github.com/ShowMeAI-Hub)

![](https://img-blog.csdnimg.cn/img_convert/ae6d408ff797cdf0ec35a5d37dd067ce.png)

æœ¬ç¯‡å†…å®¹ä¸­æˆ‘ä»¬çš„å®ç°æ­¥éª¤åŒ…æ‹¬ï¼š

*   æ•´åˆ&å¤„ç†æ•°æ®
*   åŸºäºé€’å½’ RFM æŠ€æœ¯ä»æ•°æ®æ„å»ºæœ‰æ•ˆç‰¹å¾
*   åŸºäºæ•°æ®å»ºæ¨¡ä¸é¢„ä¼°

ğŸ’¡ æ•´åˆ&å¤„ç†æ•°æ®
==========

ğŸ’¦ æ•°æ®è¯´æ˜
-------

[ShowMeAI](https://www.showmeai.tech/)æœ¬ç¯‡ä½¿ç”¨åˆ°çš„æ•°æ®é›†ï¼Œæ˜¯é€šè¿‡é›¶å”®åº—ã€æ‰«æã€å•†å“æ¡å½¢ç è€Œè·å¾—çš„æµæ°´é”€å”®çš„è¯¦ç»†æ•°æ®ã€‚æ•°æ®é›†è¦†ç›–ä¸€å¹´æ—¶é—´ï¼Œæ¶µç›– 22625 ä¸ªé¡¾å®¢ã€5242 ä¸ªå•†å“ã€64682 æ¬¡äº¤æ˜“ã€‚æ•°æ®å­—æ®µè¯´æ˜å¦‚ä¸‹ï¼š

å­—æ®µ

å«ä¹‰

Date

é”€å”®äº¤æ˜“çš„æ—¥æœŸ

Customer\_ID

å®¢æˆ·ID

Transaction\_ID

äº¤æ˜“ID

SKU\_Category\_ID

å•†å“ç±»åˆ«ID

SKU\_ID

å•†å“ID

Quantity

é”€å”®æ•°é‡

Sales\_Amount

é”€å”®é‡‘é¢ï¼ˆå•ä»·ä¹˜ä»¥æ•°é‡ï¼‰

ğŸ’¦ æ•°æ®è¯»å– & å¤„ç†
------------

> æœ¬æ–‡æ•°æ®å¤„ç†éƒ¨åˆ†æ¶‰åŠçš„å·¥å…·åº“ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ[ShowMeAI](https://www.showmeai.tech/)åˆ¶ä½œçš„å·¥å…·åº“é€ŸæŸ¥è¡¨å’Œæ•™ç¨‹è¿›è¡Œå­¦ä¹ å’Œå¿«é€Ÿä½¿ç”¨ã€‚
> 
> ğŸ“˜[**æ•°æ®ç§‘å­¦å·¥å…·åº“é€ŸæŸ¥è¡¨ | Pandas é€ŸæŸ¥è¡¨**](https://www.showmeai.tech/article-detail/101)
> 
> ğŸ“˜[**å›¾è§£æ•°æ®åˆ†æï¼šä»å…¥é—¨åˆ°ç²¾é€šç³»åˆ—æ•™ç¨‹**](https://www.showmeai.tech/tutorials/33)

ä¸Šè¿°ä¿¡æ¯ä¸­æœ€é‡è¦çš„3åˆ—æ˜¯ï¼šå®¢æˆ·IDã€é”€å”®äº¤æ˜“çš„æ—¥æœŸã€é”€å”®é‡‘é¢ï¼Œå½“ç„¶å¤§å®¶ä¹Ÿå¯ä»¥åœ¨åç»­å»ºæ¨¡ä¸­å›Šæ‹¬æ›´å¤šçš„ä¸°å¯Œä¿¡æ¯ï¼ˆå¦‚å•†å“ç±»åˆ«ç­‰ï¼‰ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆè¯»å–æ•°æ®å¹¶é’ˆå¯¹æ—¶é—´å­—æ®µåšä¸€ç‚¹æ ¼å¼è½¬æ¢ã€‚

    import pandas as pd 
    
    # è¯»å–CSVæ ¼å¼äº¤æ˜“æ•°æ® 
    df = pd.read_csv(data_path) # æ•°æ®è·¯å¾„ 
    
    # æ—¥æœŸå‹æ•°æ®è½¬æ¢ 
    df.Date = pd.to_datetime(df.Date)
    df.head(10) 
    

![](https://img-blog.csdnimg.cn/img_convert/081ed96a26d4f559ce856efc27a3b6de.png)

ğŸ’¡ RFM & ç‰¹å¾å·¥ç¨‹
=============

> å…³äºæœºå™¨å­¦ä¹ ç‰¹å¾å·¥ç¨‹ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ [ShowMeAI](https://www.showmeai.tech/) æ•´ç†çš„ç‰¹å¾å·¥ç¨‹æœ€å…¨è§£è¯»æ•™ç¨‹ã€‚
> 
> ğŸ“˜[**æœºå™¨å­¦ä¹ å®æˆ˜ | æœºå™¨å­¦ä¹ ç‰¹å¾å·¥ç¨‹æœ€å…¨è§£è¯»**](https://www.showmeai.tech/article-detail/208)

ğŸ’¦ RFMä»‹ç»
--------

ğŸ“˜[**RFM**](https://farapaper.com/wp-content/uploads/2018/08/Fardapaper-Discovering-recency-frequency-and-monetary-RFM.pdf) æ˜¯ä¸€ç§é‡åŒ–å®¢æˆ·ä»·å€¼çš„æ–¹æ³•ï¼Œè‹±æ–‡å…¨ç§°ä¸ºã€Recency, Frequency and Monetary valueã€ã€‚RFM æ¨¡å‹çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ **R**ï¼ˆæœ€è¿‘ä¸€æ¬¡æ¶ˆè´¹çš„æ—¶é—´é—´éš”ï¼‰ã€**F**ï¼ˆæ¶ˆè´¹çš„é¢‘ç‡ï¼‰å’Œ **M**ï¼ˆæ¶ˆè´¹é‡‘é¢ï¼‰ã€‚

![](https://img-blog.csdnimg.cn/img_convert/16814b6ad7cbebe8a977e401ecc500b8.png)

RFMçš„ä½¿ç”¨æ–¹æ³•æ˜¯ï¼Œå°†è®­ç»ƒæ•°æ®åˆ†æˆ**è§‚å¯ŸæœŸ Observed** å’Œ**æœªæ¥æœŸ Future**ã€‚ å¦‚æœæˆ‘ä»¬è¦é¢„æµ‹å®¢æˆ·ä¸€å¹´å†…ä¼šèŠ±è´¹å¤šå°‘ï¼Œå°±å°†**æœªæ¥æœŸ Future**çš„é•¿åº¦è®¾ç½®ä¸ºä¸€å¹´ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://img-blog.csdnimg.cn/img_convert/070ba5d4da29e806e695e5ee2ad83234.png)

åŸºäº**è§‚å¯ŸæœŸ**çš„æ•°æ®ç‰¹å¾å»ºæ¨¡ï¼Œå¹¶é¢„æµ‹**æœªæ¥æœŸ**çš„æƒ…å†µï¼Œä¸‹è¿°ä»£ç æˆ‘ä»¬åŸºäºæ—¥æœŸè¿›è¡Œæˆªæ–­ï¼š

    # æˆªæ–­æ—¥æœŸå‰çš„æ•°æ® 
    observed = df[df[date_col] < cut_off 
    
    # æˆªæ–­æ—¥æœŸåçš„æ•°æ® 
    future = df [(df[date_col] > cut_off) & (df[date_col] < cut_off + pd.Timedelta(label_period_days, unit='D'))] 
    

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ RFM çš„3è¦ç´ ï¼Œå¹¶é€šè¿‡ä»£ç è¿›è¡Œå®ç°ï¼š

ğŸ’¦ Recency / æ—¶é—´é—´éš”
-----------------

å®ƒä»£è¡¨è‡ªæœ€è¿‘ä¸€æ¬¡äº¤æ˜“ä»¥æ¥çš„æ—¶é—´ï¼ˆå°æ—¶/å¤©/å‘¨ï¼‰ã€‚ æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªåŸºå‡†æ—¶é—´ç‚¹æ¥è®¡ç®— Recencyã€‚ æˆ‘ä»¬ä¼šè®¡ç®—å®¢æˆ·åœ¨åŸºå‡†æ—¶é—´ç‚¹åå¤šå°‘å¤©è¿›è¡Œäº†äº¤æ˜“ã€‚

    def customer_recency(data, cut_off, date_column, customer_id_column):
      # æˆªæ–­å‰çš„æ•°æ®
      recency = data[data[date_column] < cut_off].copy()
      recency[date_column] = pd.to_datetime(recency[date_column])
      # æŒ‰æœ€æ–°äº¤æ˜“å¯¹å®¢æˆ·è¿›è¡Œåˆ†ç»„
      recency = recency.groupby(customer_id_column)[date_column].max()
      return ((pd.to_datetime(cut_off) - recency).dt.days).reset_index().rename(
          columns={date_column : 'recency'}
      )
    

ğŸ’¦ Frequency / é¢‘ç‡
-----------------

å®ƒä»£è¡¨å®¢æˆ·è¿›è¡Œäº¤æ˜“çš„ä¸åŒæ—¶é—´æ®µçš„æ•°é‡ã€‚ è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿè·Ÿè¸ªå®¢æˆ·è¿›è¡Œäº†å¤šå°‘äº¤æ˜“ä»¥åŠäº¤æ˜“å‘ç”Ÿçš„æ—¶é—´ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥ä¿ç•™ä»æˆªæ­¢æ—¥æœŸå¼€å§‹è®¡ç®—è¿™äº›æŒ‡æ ‡çš„åšæ³•ï¼Œå› ä¸ºä»¥åä¼šå¾ˆæ–¹ä¾¿ã€‚

    def customer_frequency(data, cut_off, date_column, customer_id_column, value_column, freq='M'):
      # æˆªæ–­å‰çš„æ•°æ®
      frequency = data[data[date_column] < cut_off].copy()
      # è®¾ç½®æ—¥æœŸåˆ—ä¸ºç´¢å¼•
      frequency.set_index(date_column, inplace=True)
      frequency.index = pd.DatetimeIndex(frequency.index)
      # æŒ‰å®¢æˆ·é”®å’Œä¸åŒæ—¶æœŸå¯¹äº¤æ˜“è¿›è¡Œåˆ†ç»„ 
      # å¹¶ç»Ÿè®¡æ¯ä¸ªæ—¶æœŸçš„äº¤æ˜“ 
      frequency = frequency.groupby([
          customer_id_column,
          pd.Grouper(freq=freq, level=date_column)
      ]).count()
      frequency[value_column] = 1 # å­˜å‚¨æ‰€æœ‰ä¸åŒçš„äº¤æ˜“ 
      # ç»Ÿè®¡æ±‡æ€»æ‰€æœ‰äº¤æ˜“
      return frequency.groupby(customer_id_column).sum().reset_index().rename(
          columns={value_column : 'frequency'}
      )
    

ğŸ’¦ Monetary value / æ¶ˆè´¹é‡‘é¢
------------------------

å®ƒä»£è¡¨å¹³å‡é”€å”®é¢ã€‚ åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç®€å•è®¡ç®—æ¯ä¸ªå®¢æˆ·æ‰€æœ‰äº¤æ˜“çš„å¹³å‡é”€å”®é¢ã€‚ ï¼ˆå½“ç„¶ï¼Œæˆ‘ä»¬åç»­ä¹Ÿä¼šç”¨åˆ°ï¼‰

    def customer_value(data, cut_off, date_column, customer_id_column, value_column):
      value = data[data[date_column] < cut_off]
      # è®¾ç½®æ—¥æœŸåˆ—ä¸ºç´¢å¼• 
      value.set_index(date_column, inplace=True)
      value.index = pd.DatetimeIndex(value.index)
      # è·å–æ¯ä¸ªå®¢æˆ·çš„å¹³å‡æˆ–æ€»é”€å”®é¢ 
      return value.groupby(customer_id_column)[value_column].mean().reset_index().rename(
          columns={value_column : 'value'}
      )
    

ğŸ’¦ é™„åŠ ä¿¡æ¯
-------

**ç”¨æˆ·é¾„**ï¼š è‡ªç¬¬ä¸€æ¬¡äº¤æ˜“ä»¥æ¥çš„æ—¶é—´ã€‚æˆ‘ä»¬æŠŠæ¯ä¸ªå®¢æˆ·é¦–æ¬¡äº¤æ˜“ä»¥æ¥çš„å¤©æ•°ä¹ŸåŠ åˆ°ä¿¡æ¯ä¸­ã€‚

    def customer_age(data, cut_off, date_column, customer_id_column):
      age = data[data[date_column] < cut_off]
      # è·å–ç¬¬ä¸€ç¬”äº¤æ˜“çš„æ—¥æœŸ 
      first_purchase = age.groupby(customer_id_column)[date_column].min().reset_index()
      # è·å–æˆªæ­¢åˆ°ç¬¬ä¸€æ¬¡äº¤æ˜“ä¹‹é—´çš„å¤©æ•°
      first_purchase['age'] = (cut_off - first_purchase[date_column]).dt.days
      return first_purchase[[customer_id_column, 'age']]
    

æœ€åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°æŠŠ RFM æ¶‰åŠåˆ°çš„ä¿¡æ¯å›Šæ‹¬è¿›å»ï¼š

    def customer_rfm(data, cut_off, date_column, customer_id_column, value_column, freq='M'): 
      cut_off = pd.to_datetime(cut_off) 
      
      # è®¡ç®— 
      recency = customer_recency(data, cut_off, date_column, customer_id_column) 
      
      # è®¡ç®—é¢‘ç‡ 
      frequency = customer_frequency(data, cut_off, date_column, customer_id_column, value_column, freq=freq) 
      
      # è®¡ç®—å¹³å‡å€¼ 
      value = customer_value(data, cut_off, date_column, customer_id_column, value_column) # è®¡ç®—å¹´é¾„ 
      age = customer_age(data, cut_off, date_column, customer_id_column) 
    
      # åˆå¹¶æ‰€æœ‰åˆ— 
      return recency.merge(frequency, on=customer_id_column).merge(on=customer_id_column).merge(ageï¼Œon=customer_id_column) 
    

ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™å¯ä»¥æ•è·ç‰¹å®šæ—¶é—´æ®µå†…çš„ä¿¡æ¯ï¼Œçœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·ï¼š

![](https://img-blog.csdnimg.cn/img_convert/cf6a4d4805f6824c91ae34c54f402dca.png)

æˆ‘ä»¬æŠŠæ¯ä¸ªå®¢æˆ·**æœªæ¥**æœŸé—´èŠ±è´¹çš„é‡‘é¢ä½œä¸ºæ ‡ç­¾ï¼ˆå³æˆ‘ä»¬æˆªæ–­æ•°æ®çš„åé¢ä¸€éƒ¨åˆ†ï¼Œå³futureï¼‰ã€‚

    labels = future.groupby(id_col)[value_col].sum() 
    

ğŸ’¡ å»ºæ¨¡æ€è·¯ & å®ç°
============

é€šè¿‡ä¸Šé¢çš„æ–¹å¼æˆ‘ä»¬å°±æ„å»ºå‡ºäº†æ•°æ®æ ·æœ¬ï¼Œä½†æ¯ä¸ªç”¨æˆ·åªæœ‰1ä¸ªæ ·æœ¬ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æœ‰æ›´å¤šçš„æ•°æ®æ ·æœ¬ï¼Œä»¥åŠåœ¨æ ·æœ¬ä¸­å›Šæ‹¬ä¸åŒçš„æƒ…å†µï¼ˆä¾‹å¦‚æ—¶é—´æ®µè¦†ç›–èŠ‚å‡æ—¥å’Œ 618 å’Œ 11.11 ç­‰ç‰¹æ®Šä¿ƒé”€æ´»åŠ¨ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°ã€**é€’å½’RFM**ã€æ–¹æ³•ã€‚

ğŸ’¦ é€’å½’ RFM
---------

æ‰€è°“çš„é€’å½’ RFM ç›¸å½“äºä»¥æ»‘åŠ¨çª—å£çš„æ–¹å¼æ¥æŠŠæœªæ¥ä¸åŒçš„æ—¶é—´æ®µæ„å»ºä¸º future æ ‡ç­¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å‡è®¾æ•°æ®ä»å¹´åˆï¼ˆæœ€å·¦ä¾§ï¼‰å¼€å§‹ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªé¢‘ç‡ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªæœˆï¼‰éå†æ•°æ®é›†æ„å»º**æœªæ¥ (f)** æ ‡ç­¾ï¼Œä¹Ÿå³ä¸‹å›¾çš„çº¢è‰² f å—ã€‚

![](https://img-blog.csdnimg.cn/img_convert/2e9de554691e94cc1444a2034f1748e2.gif)

å…·ä½“çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š

    def recursive_rfm(data, date_col, id_col, value_col, freq='M', start_length=30, label_period_days=30):
      dset_list = []
    
      # è·å–æ•°æ®é›†çš„èµ·å§‹æ—¶é—´
      start_date = data[date_col].min() + pd.Timedelta(start_length, unit="D")
      end_date = data[date_col].max() - pd.Timedelta(label_period_days, unit="D")
      # è·å–æ—¶é—´æ®µ
      dates = pd.date_range(start=start_date, end=end_date, freq=freq)
      data[date_col] = pd.to_datetime(data[date_col])
    
      for cut_off in dates:
        # åˆ‡åˆ†
        observed = data[data[date_col] < cut_off]
        future = data[
            (data[date_col] > cut_off) &
            (data[date_col] < cut_off + pd.Timedelta(label_period_days, unit='D'))
        ]
    
        rfm_columns = [date_col, id_col, value_col]
        print(f"computing rfm features for {cut_off} to {future[date_col].max()}:")
        _observed = observed[rfm_columns]
        # è®¡ç®—è®­ç»ƒæ•°æ®ç‰¹å¾éƒ¨åˆ†ï¼ˆå³observedéƒ¨åˆ†ï¼‰
        rfm_features = customer_rfm(_observed, cut_off, date_col, id_col, value_col)
        # è®¡ç®—æ ‡ç­¾ï¼ˆå³futureçš„æ€»æ¶ˆè´¹ï¼‰
        labels = future.groupby(id_col)[value_col].sum()
        # åˆå¹¶æ•°æ®
        dset = rfm_features.merge(labels, on=id_col, how='outer').fillna(0) 
        dset_list.append(dset)
        # å®Œæ•´æ•°æ®
      full_dataset = pd.concat(dset_list, axis=0)
      res = full_dataset[full_dataset.recency != 0].dropna(axis=1, how='any')
      return res
    
    rec_df = recursive_rfm(data_for_rfm, 'Date', 'Customer_ID', 'Sales_Amount')
    

æ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œæ•°æ®åˆ‡åˆ†ï¼Œä»¥ä¾¿æ›´å¥½åœ°è¿›è¡Œå»ºæ¨¡å’Œè¯„ä¼°ï¼Œè¿™é‡Œä¾æ—§æŠŠæ•°æ®åˆ‡åˆ†ä¸º 80% ç”¨äºè®­ç»ƒï¼Œ20% ç”¨äºæµ‹è¯•ã€‚

    from sklearn.model_selection import train_test_split
    # æ•°æ®é‡‡æ ·ï¼Œå¦‚æœå¤§å®¶æœ¬åœ°è®¡ç®—èµ„æºå°‘ï¼Œå¯ä»¥è®¾ç½®ç™¾åˆ†æ¯”è¿›è¡Œé‡‡æ ·
    rec_df = rec_df.sample(frac=1) 
    
    # ç¡®å®šç‰¹å¾ä¸æ ‡ç­¾
    X = rec_df[['recency', 'frequency', 'value', 'age']]
    y = rec_df[['Sales_Amount']].values.reshape(-1)
    
    # æ•°æ®é›†åˆ‡åˆ†
    test_size = 0.2
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=test_size, random_state=42, shuffle=True)
    

ğŸ’¦ æœºå™¨å­¦ä¹ å»ºæ¨¡
---------

> å…³äºæœºå™¨å­¦ä¹ å»ºæ¨¡éƒ¨åˆ†ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ [ShowMeAI](https://www.showmeai.tech/) çš„æœºå™¨å­¦ä¹ ç³»åˆ—æ•™ç¨‹ä¸æ¨¡å‹è¯„ä¼°åŸºç¡€çŸ¥è¯†æ–‡ç« ã€‚
> 
> ğŸ“˜[**å›¾è§£æœºå™¨å­¦ä¹ ç®—æ³•ï¼šä»å…¥é—¨åˆ°ç²¾é€šç³»åˆ—æ•™ç¨‹**](https://www.showmeai.tech/tutorials/34)
> 
> ğŸ“˜[**å›¾è§£æœºå™¨å­¦ä¹  | éšæœºæ£®æ—æ¨¡å‹è¯¦è§£**](https://www.showmeai.tech/article-detail/191)
> 
> ğŸ“˜[**å›¾è§£æœºå™¨å­¦ä¹ ç®—æ³•(2) | æ¨¡å‹è¯„ä¼°æ–¹æ³•ä¸å‡†åˆ™**](https://www.showmeai.tech/article-detail/186)

æœ‰å¾ˆå¤šæœºå™¨å­¦ä¹ æ¨¡å‹éƒ½å¯ä»¥è¿›è¡Œå»ºæ¨¡ï¼Œåœ¨æœ¬ä¾‹ä¸­æˆ‘ä»¬ä½¿ç”¨æœ€å¸¸ç”¨ä¸”æ•ˆæœè‰¯å¥½çš„**éšæœºæ£®æ—**è¿›è¡Œå»ºæ¨¡ï¼Œå› ä¸ºæ˜¯å›å½’ä»»åŠ¡ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ scikit-learn ä¸­çš„éšæœºæ£®æ—å›å½’å™¨ï¼Œä»£ç å¦‚ä¸‹ã€‚

    from sklearn.ensemble import RandomForestRegressor 
    # åœ¨è®­ç»ƒæ•°æ®é›†ä¸Šåˆå§‹åŒ–å’Œæ‹Ÿåˆæ¨¡å‹ 
    rf = RandomForestRegressor().fit(X_train, y_train) 
    

æ‹Ÿåˆåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®æ¡†ä¸­æŸ¥çœ‹æˆ‘ä»¬å¯¹æµ‹è¯•é›†çš„é¢„æµ‹ã€‚

    from sklearn.metrics import mean_squared_error
    
    # è®­ç»ƒé›†ï¼šæ ‡å‡†ç­”æ¡ˆä¸é¢„ä¼°å€¼
    predictions = pd.DataFrame()
    predictions['true'] = y_train
    predictions['preds'] = rf.predict(X_train)
    
    # æµ‹è¯•é›†ï¼šæ ‡å‡†ç­”æ¡ˆä¸é¢„ä¼°å€¼
    predictions_test = pd.DataFrame()
    predictions_test['true'] = y_test
    predictions_test['preds'] = rf.predict(X_test)
    
    # æ¨¡å‹è¯„ä¼°
    train_rmse = mean_squared_error(predictions.true, predictions.preds)**0.5
    test_rmse = mean_squared_error(predictions_test.true, predictions_test.preds)**0.5
    print(f"Train RMSE: {train_rmse}, Test RMSE: {test_rmse}")
    

è¾“å‡ºï¼š

    Train RMSE ï¼š10.608368028113563ï¼Œ Test RMSE ï¼š28.366171873961612 
    

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„å‡æ–¹æ ¹è¯¯å·® (RMSE) ä½œä¸ºè¯„ä¼°å‡†åˆ™ï¼Œå®ƒè®¡ç®—çš„æ˜¯è®­ç»ƒæ•°æ®å’Œæµ‹è¯•æ•°æ®ä¸Šã€æ ‡å‡†ç­”æ¡ˆã€å’Œã€é¢„ä¼°å€¼ã€çš„åå·®å¹³æ–¹å’Œä¸æ ·æœ¬æ•° N æ¯”å€¼çš„å¹³æ–¹æ ¹ã€‚ å³å¦‚ä¸‹å…¬å¼ï¼š

![](https://img-blog.csdnimg.cn/img_convert/bea0fe497381357bd1c8d7bf1c6a2bab.png)

æµ‹è¯•é›†ä¸Šè¯„ä¼°ç»“æœ RMSE çº¦ä¸º 28.4ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯¹æœªè§æ•°æ®çš„é¢„æµ‹å€¼ç›¸å·®çº¦ 28.40 ç¾å…ƒã€‚ ä¸è¿‡ï¼Œæˆ‘ä»¬å‘ç°ï¼Œè®­ç»ƒé›†ä¸Šçš„ RMSE æ˜æ˜¾ä½äºæµ‹è¯•é›†ä¸Šçš„ RMSEï¼Œè¯´æ˜æ¨¡å‹æœ‰ä¸€äº›è¿‡æ‹Ÿåˆäº†ã€‚ å¦‚æœæˆ‘ä»¬æŠŠè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ¯ä¸ªæ ·æœ¬é¢„ä¼°å€¼å’ŒçœŸå®å€¼ç»˜åˆ¶å‡ºæ¥ï¼Œæ˜¯å¦‚ä¸‹çš„ç»“æœï¼Œä¹Ÿèƒ½çœ‹å‡ºå·®å¼‚ï¼š

![](https://img-blog.csdnimg.cn/img_convert/cd08d200aeb4ed0502303571417a8cfa.png)

æœºå™¨å­¦ä¸­çš„è¿‡æ‹Ÿåˆé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å¯¹æ¨¡å‹çš„è°ƒå‚è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚åœ¨éšæœºæ£®æ—æ¨¡å‹ä¸­ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ ‘æ·±å¤ªæ·±ï¼Œå¶å­èŠ‚ç‚¹æ ·æœ¬æ•°è®¾ç½®è¾ƒå°ç­‰åŸå› å¯¼è‡´ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡è°ƒå‚æ–¹æ³•ï¼ˆå¦‚ç½‘æ ¼æœç´¢ã€éšæœºæœç´¢ã€è´å¶æ–¯ä¼˜åŒ–ï¼‰ç­‰è¿›è¡Œä¼˜åŒ–ã€‚å¯ä»¥åœ¨ [ShowMeAI](https://www.showmeai.tech/)çš„è¿‡å¾€æœºå™¨å­¦ä¹ å®æˆ˜æ–‡ç« ä¸­æ‰¾åˆ°è°ƒå‚æ¨¡æ¿ï¼š

> [**äººåŠ›èµ„æºæµå¤±åœºæ™¯æœºå™¨å­¦ä¹ å»ºæ¨¡ä¸è°ƒä¼˜**](https://www.showmeai.tech/article-detail/308)

> [**åŸºäºAirbnbæ•°æ®çš„æ°‘å®¿æˆ¿ä»·é¢„æµ‹æ¨¡å‹**](https://www.showmeai.tech/article-detail/316)

å‚è€ƒèµ„æ–™
====

*   ğŸ“˜ **æ•°æ®ç§‘å­¦å·¥å…·åº“é€ŸæŸ¥è¡¨ | Pandas é€ŸæŸ¥è¡¨**ï¼š[https://www.showmeai.tech/article-detail/101](https://www.showmeai.tech/article-detail/101)
*   ğŸ“˜ **å›¾è§£æ•°æ®åˆ†æï¼šä»å…¥é—¨åˆ°ç²¾é€šç³»åˆ—æ•™ç¨‹**ï¼š[https://www.showmeai.tech/tutorials/33](https://www.showmeai.tech/tutorials/33)
*   ğŸ“˜ **å›¾è§£æœºå™¨å­¦ä¹ ç®—æ³•ï¼šä»å…¥é—¨åˆ°ç²¾é€šç³»åˆ—æ•™ç¨‹**ï¼š[https://www.showmeai.tech/tutorials/34](https://www.showmeai.tech/tutorials/34)
*   ğŸ“˜ **å›¾è§£æœºå™¨å­¦ä¹ ç®—æ³•| æ¨¡å‹è¯„ä¼°æ–¹æ³•ä¸å‡†åˆ™**ï¼š[https://www.showmeai.tech/article-detail/186](https://www.showmeai.tech/article-detail/186)
*   ğŸ“˜ **å›¾è§£æœºå™¨å­¦ä¹ ç®—æ³• | éšæœºæ£®æ—æ¨¡å‹è¯¦è§£**ï¼š[https://www.showmeai.tech/article-detail/191](https://www.showmeai.tech/article-detail/191)
*   ğŸ“˜ **æœºå™¨å­¦ä¹ å®æˆ˜ | æœºå™¨å­¦ä¹ ç‰¹å¾å·¥ç¨‹æœ€å…¨è§£è¯»**ï¼š[https://www.showmeai.tech/article-detail/208](https://www.showmeai.tech/article-detail/208)
*   ğŸ“˜ **äººåŠ›èµ„æºæµå¤±åœºæ™¯æœºå™¨å­¦ä¹ å»ºæ¨¡ä¸è°ƒä¼˜**ï¼š[https://www.showmeai.tech/article-detail/308](https://www.showmeai.tech/article-detail/308)
*   ğŸ“˜ **åŸºäºAirbnbæ•°æ®çš„æ°‘å®¿æˆ¿ä»·é¢„æµ‹æ¨¡å‹**ï¼š[https://www.showmeai.tech/article-detail/316](https://www.showmeai.tech/article-detail/316)

[![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9190f41b8de4af38c8a1a0c96f0513b~tplv-k3u1fbpfcp-zoom-1.image)](https://www.showmeai.tech/)