---
layout: post
title: "Jmeter——循环控制器中实现Counter计数器的次数重置"
date: "2022-12-30T06:20:10.958Z"
---
Jmeter——循环控制器中实现Counter计数器的次数重置
===============================

近期在使用Jmeter编写个辅助测试的脚本，用到了多个Loop Controller和Counter。

当时想的思路就是三个可变的数量值，使用循环实现；但第三个可变值的数量次数，是基于第二次循环中得到的结果才能确认最终次数，每次的结果还会有不一样的情况。基于思路，先写了个线性脚本，实现如下所示：

![](https://img2023.cnblogs.com/blog/1242227/202212/1242227-20221229165405599-482605126.png)

但实际中，第三层循环，并没有按自己预期来实现，所以就想到了Counter计数器，将脚本中加入了Counter计数器，实现如下所示：

![](https://img2023.cnblogs.com/blog/1242227/202212/1242227-20221229172851500-1494752487.png)

图中的数字说明：${for1}_${for2}_${for3}

${for1}是第一个循环器中的Counter变量名  
${for2}是第二个循环器中的Counter变量名  
${for3}是第三个循环器中的Counter变量名

从图中可以看出，${for3}是累加的，不会随着一次循环结束，计数自动重置。

我所想实现的是，第二层循环中的第一次获取的结果是5个数组，则从索引0 ~ 4依次按置执行第三层循环；第二层循环中的第二次获取的结果是8个数组，则从索引0 ~ 7依次按置执行第三层循环。

但这样操作下来，第二次是会直接从索引5开始执行，这样就会丢失一部分数据，显然不是自己所想的。

中途也试过很多错，都不能实现计数重置的功能。好在，某天想起了[官方文档](https://jmeter.apache.org/usermanual/component_reference.html#Loop_Controller)，这个功能在文档是有描述的，如下所示：

![](https://img2023.cnblogs.com/blog/1242227/202212/1242227-20221229173940252-1331199905.png)

文档中描述的很清楚，可以使用`${__jm__LC__idx}`的方式实现index从0开始，其中LC为控制器的名称。

使用官网的文档，在脚本中加入变量使用，运行如下所示：

![](https://img2023.cnblogs.com/blog/1242227/202212/1242227-20221229175342757-1090306379.png)

从图中可知，第三层循环的第四个数字就是我所想要的，终于解决了心中的问题。

图中的数字说明：${for1}_${for2}_${for3}\_${resetForNumber}

前三个数字在之前已经说明过了，这里只说明下${resetForNumber}，这个变量是通过BeanShell Sampler中获取的，因为将官网给出的方案写在了BeanShell Sampler种，代码如下所示：

    long i=0;
    i = ${__jm__Loop Controller3__idx};
    vars.put("resetForNumber",String.valueOf(i));
    

虽然，描述起来很简单，但的确是实际脚本实现的过程中遇到的一个阻碍，好在问题解决了。

所以特整理此篇，希望对以后有需要的朋友有所帮助。