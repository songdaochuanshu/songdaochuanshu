---
layout: post
title: "cJson å­¦ä¹ ç¬”è®°"
date: "2022-11-20T06:22:29.350Z"
---
cJson å­¦ä¹ ç¬”è®°
==========

cJson å­¦ä¹ ç¬”è®°
==========

ä¸€ã€å‰è¨€
----

æ€è€ƒè¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼šå¯¹äºä¸åŒçš„è®¾å¤‡å¦‚ä½•è¿›è¡Œæ•°æ®äº¤æ¢ï¼Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨è½»é‡çº§åˆ«çš„ JSON æ ¼å¼ã€‚

é‚£ä¹ˆéœ€è¦æˆ‘ä»¬æ‰‹å†™ä¸€ä¸ª JSON è§£æå™¨å—ï¼Ÿè¿™å¤§å¯ä¸å¿…ï¼Œå› ä¸ºå·²ç»æœ‰å‰è¾ˆæä¾›äº†å¼€æºçš„è½»é‡çº§çš„ JSON è§£æå™¨â€”â€”cJSONã€‚æˆ‘ä»¬ä¼šç”¨å°±å¯ä»¥äº†ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ·±å…¥æºç è¿›è¡Œå­¦ä¹ ã€‚

ä¸‹å›¾åˆ™å‘æˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ cJSON å®ç° Client ä¸ Server çš„æ•°æ®äº¤æ¢ï¼š

![image-20221119161207712](https://img2022.cnblogs.com/blog/1494888/202211/1494888-20221120134218163-703341249.png)

*   Client åœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œé€šè¿‡ cJSON å°†è‡ªå·±çš„ä¸“å±æ•°æ®æ ¼å¼ Data\_ClientFormat è½¬åŒ–ä¸ºäº†é€šç”¨æ ¼å¼ JSON
*   æœåŠ¡ç«¯åœ¨æ”¶åˆ° JSON æ•°æ®åï¼Œé€šè¿‡ cJSON å°†å…¶è½¬åŒ–ä¸ºæœåŠ¡ç«¯çš„ä¸“å±æ•°æ®æ ¼å¼ Data\_ServerFormat
*   åä¹‹åŒç†

åœ¨ä»‹ç» cJSON ä¹‹å‰ï¼Œå…ˆæ¥å¯¹ JSON è¿™ä¸ªæ•°æ®æ ¼å¼æœ‰ä¸ªç®€å•äº†è§£ã€‚

äºŒã€JSON ç®€ä»‹
---------

### 1.1 ä»€ä¹ˆæ˜¯ JSON

JSON æŒ‡çš„æ˜¯ JavaScript å¯¹è±¡è¡¨ç¤ºæ³•ï¼ˆJavaScript Object Notationï¼‰ã€‚ä½†å®ƒå¹¶ä¸æ˜¯ç¼–ç¨‹è¯­è¨€ï¼Œè€Œæ˜¯ä¸€ç§å¯ä»¥åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¼ è¾“çš„**æ•°æ®äº¤æ¢æ ¼å¼**ã€‚

### 1.2 JSON ç»“æ„

JSON çš„ä¸¤ç§æ•°æ®ç»“æ„ï¼š

1.  å¯¹è±¡ï¼šA collection of key/value pairsï¼ˆä¸€ä¸ªæ— åºçš„ key / value å¯¹çš„é›†åˆï¼‰
2.  æ•°ç»„ï¼šAn ordered list of valuesï¼ˆä¸€ / å¤šä¸ª value çš„æœ‰åºåˆ—è¡¨ï¼‰

ä»ä¸Šè¿°æè¿°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å¦‚ä¸‹å››ç§ä¿¡æ¯ï¼š

*   å¯¹è±¡ï¼ˆObjectï¼‰
*   æ•°ç»„ï¼ˆArrayï¼‰
*   é”®ï¼ˆkeyï¼‰
*   å€¼ï¼ˆValueï¼‰

### 1.3 JSON å¯¹è±¡

JSON å¯¹è±¡å…·ä½“æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image-20221118232125879](https://img2022.cnblogs.com/blog/1494888/202211/1494888-20221120134217807-1472168311.png)

*   ä¸€ä¸ªå¯¹è±¡ä»¥`{`å¼€å§‹ï¼Œä»¥`}`ç»“æŸï¼Œæ˜¯è‹¥å¹²ã€Œkey / value å¯¹ã€çš„é›†åˆ
*   key å’Œ value ä½¿ç”¨`:`åˆ†éš”
*   key / value å¯¹ä¹‹é—´ä½¿ç”¨`,`åˆ†éš”

æ³¨æ„äº‹é¡¹ï¼š

1.  é”®ï¼šå¿…é¡»æ˜¯ string ç±»å‹
2.  å€¼ï¼šå¯ä»¥æ˜¯åˆæ³•çš„ JSON æ•°æ®ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å€¼ã€å¯¹è±¡ã€æ•°ç»„ã€å¸ƒå°”å€¼æˆ– nullï¼‰

å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„ JSON å¯¹è±¡ï¼š

    {
        "name" : "å¼ ä¸‰"
    }
    

è¿™ä¹Ÿæ˜¯ä¸€ä¸ªåˆæ³•çš„ JSON å¯¹è±¡ï¼š

    {
        "name" : "å¼ ä¸‰",
        "age"  : 18,
        "sex"  : "ç”·"
    }
    

### 1.4 JSON æ•°ç»„

JSON æ•°ç»„å…·ä½“æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image-20221118232514539](https://img2022.cnblogs.com/blog/1494888/202211/1494888-20221120134217523-1849030372.png)

*   ä¸€ä¸ªæ•°ç»„ä»¥`[`å¼€å§‹ï¼Œ`]`ç»“æŸï¼Œæ˜¯è‹¥å¹² value çš„æœ‰åºé›†åˆ
*   å¤šä¸ª value ä»¥`,`åˆ†éš”

å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„ JSON æ•°ç»„ï¼š

    [
        "å¼ ä¸‰",
        18,
        "ç”·"
    ]
    

> è¯¥æ•°ç»„åŒ…å«ä¸‰ä¸ª valueï¼Œåˆ†åˆ«ä¸º stringã€numberã€string

è¿™ä¹Ÿæ˜¯ä¸€ä¸ªåˆæ³•çš„ JSON æ•°ç»„ï¼š

    [
        {
            "name"	: "å¼ ä¸‰",
            "age"	: 18,
            "sex"	: "ç”·"
        },
        {
            "name"	: "æå››",
            "age"	: 19,
            "sex"	: "ç”·"
        }
    ]
    

> è¯¥æ•°ç»„åŒ…å«ä¸¤ä¸ª Objectï¼Œæ¯ä¸ª Object åˆåŒ…å«è‹¥å¹² key / valueã€‚

### 1.5 JSON å€¼

å€¼ï¼ˆvalueï¼‰å¯ä»¥æ˜¯ï¼š

*   **å­—ç¬¦ä¸²ï¼š**å¿…é¡»ç”¨åŒå¼•å·æ‹¬èµ·æ¥
*   **æ•° å€¼ï¼š**åè¿›åˆ¶æ•´æ•°æˆ–æµ®ç‚¹æ•°
*   **å¯¹ è±¡ï¼š**é”® / å€¼å¯¹çš„é›†åˆ
*   **æ•° ç»„ï¼š**å€¼çš„é›†åˆ
*   **å¸ƒå°”å€¼ï¼š**true æˆ– false
*   **null**

value å¯ä»¥æ˜¯ç®€å•çš„ç”¨åŒå¼•å·å¼•èµ·æ¥çš„ string ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°å€¼ï¼›æˆ–å¸ƒå°”å€¼ï¼ˆtrue or falseï¼‰ï¼Œæˆ– nullã€‚

å½“ç„¶ä¹Ÿå¯ä»¥æ˜¯å¤æ‚çš„ object æˆ– arrayï¼Œè¿™äº›å–å€¼æ˜¯å¯ä»¥åµŒå¥—çš„ã€‚

![image-20221120122601710](https://img2022.cnblogs.com/blog/1494888/202211/1494888-20221120134217234-796635162.png)

åœ¨ã€Œ1.4 JSON æ•°ç»„ã€ä¸­ï¼Œç¬¬äºŒä¸ªä¾‹å­å°±æ˜¯ä¸€ä¸ªåµŒå¥—çš„ä¸¾ä¾‹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¿™ä¹ˆåµŒå¥—ï¼š

    {
        "class_name"	: "è®¡ç§‘ä¸€ç­",
        "student_num"	: 2,
        "student_info"	: 
        [
            {
                "name"	: "å¼ ä¸‰",
                "age"	: 18,
                "sex"	: "ç”·"
            },
            {
                "name"	: "æå››",
                "age"	: 19,
                "sex"	: "ç”·"
            }
        ]
    }
    

ä¸‰ã€cJSON ä½¿ç”¨æ•™ç¨‹
------------

### 3.1 cJSON ä½¿ç”¨è¯´æ˜

æºç ä¸‹è½½ï¼š[https://www.aliyundrive.com/s/vms4mGLStGm](https://www.aliyundrive.com/s/vms4mGLStGm)

ç¼–è¯‘ç¯å¢ƒï¼šCentOS 7

æºç ä¸­åŒ…å« cJSON.h å’Œ cJSON.cï¼Œä»¥åŠä¸€ä¸ªæµ‹è¯•ç¨‹åº main.cï¼Œæµ‹è¯•ç¨‹åºçš„åŠŸèƒ½æ˜¯è¾“å‡ºä¸€ä¸ª JSON å­—ç¬¦ä¸²ï¼š

    {
        "name": "å¼ ä¸‰",
        "age":  18,
        "sex":  "ç”·"
    }
    

ä½ å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ç§æ–¹æ³•è¿è¡Œè¯¥ç¨‹åºï¼š

1.  `$ gcc *.c -o main -lm`ï¼Œä¼šç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ mainï¼Œæ‰§è¡Œè¯¥æ–‡ä»¶å³å¯
2.  å°† cJSON.c æ‰“åŒ…æˆé™æ€åº“ / åŠ¨æ€åº“ï¼Œç„¶ååœ¨ç¼–è¯‘ main.c çš„æ—¶å€™å°†å…¶é“¾æ¥ä¸Šå°±å¯ä»¥äº†

> ç”±äºæºç ä¸­ä½¿ç”¨äº† powã€floor å‡½æ•°ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘çš„æ—¶è¦é“¾æ¥ä¸Š math åº“ï¼Œä¹Ÿå°±æ˜¯ -lm æŒ‡ä»¤ã€‚

å¦‚æœåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æŠ¥å¥½å¤š warningï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰è­¦å‘Šï¼š

![image-20221120120313471](https://img2022.cnblogs.com/blog/1494888/202211/1494888-20221120134216933-975813848.png)

ä¸è¦æ…Œï¼Œè¿™å¹¶ä¸å½±å“ç¨‹åºçš„è¿è¡Œï¼Œå¦‚æœä½ æƒ³æ¶ˆé™¤è¿™äº›è­¦å‘Šï¼Œä¸å¦¨å°† cJSON.c æ ¼å¼åŒ–ä¸€ä¸‹ï¼ˆç”¨ VSCode æŒ‰ä¸‹alt+shift+Fï¼‰ã€‚

è‡³äºåŸç†ï¼Œä¸å¦¨å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š[gccç¼–è¯‘è­¦å‘Šå…³äºï¼ˆwarning: XXX...\[-Wmisleading-indentation\] if(err)ä¹‹ç±»çš„é—®é¢˜ï¼‰](https://blog.csdn.net/woainilixuhao/article/details/100886001)

### 3.2 cJSON structure

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå¯¹ cJSON çš„ç»“æ„ä½“æœ‰ä¸ªåˆæ­¥äº†è§£ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š

    typedef struct cJSON
    {
      struct cJSON *next, *prev;
      struct cJSON *child;
    
      int type;
    
      char *valuestring;
      int valueint;
      double valuedouble;
    
      char *string;
    } cJSON;
    

*   typeï¼šç”¨äºåŒºåˆ† JSON ç±»å‹
    *   0 è¡¨ç¤º false
    *   1 è¡¨ç¤º true
    *   2 è¡¨ç¤º null
    *   3 è¡¨ç¤º number
    *   4 è¡¨ç¤º string
    *   5 è¡¨ç¤º array
    *   6 è¡¨ç¤º object
*   string ï¼šä»£è¡¨ã€Œé”® / å€¼å¯¹ã€çš„é”®
*   value\*ï¼šä»£è¡¨ã€Œé”® / å€¼å¯¹ã€çš„å€¼ï¼Œæ­é… type ä½¿ç”¨
    *   åªæœ‰å½“ type å€¼ä¸º 4 æ—¶ï¼Œvaluestring å­—æ®µæ‰æœ‰æ•ˆ
    *   åªæœ‰å½“ type å€¼ä¸º 3 æ—¶ï¼Œvalueint æˆ– valuedouble å­—æ®µæ‰æœ‰æ•ˆ

> ç”±äºæˆ‘åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­æœªæ¶‰åŠ boolã€nullï¼Œæ‰€ä»¥ä¸¾ä¾‹ä¸­æš‚ä¸æ¶‰åŠè¿™ä¸¤ç§ç±»å‹ã€‚

### 3.3 ååºåˆ—åŒ– JSON å­—ç¬¦ä¸²

åœ¨æ­£å¼è®²è§£ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ä¸ååºåˆ—åŒ–ç›¸å…³çš„å‡½æ•°ï¼š

å‡½æ•°

è§£é‡Šè¯´æ˜

è¿”å›å€¼

cJSON\_Parse

å°† JSON å­—ç¬¦ä¸²**ååºåˆ—åŒ–**ä¸º cJSON ç»“æ„ä½“

cJSON \*

cJSON\_GetObjectItem

è·å– JSON å¯¹è±¡ä¸­çš„æŒ‡å®šé¡¹

cJSON \*

cJSON\_GetArrayItem

è·å– JSON æ•°ç»„ä¸­çš„ç¬¬ i ä¸ª JSON é¡¹

cJSON \*

cJSON\_GetArraySize

è·å– JSON æ•°ç»„çš„å¤§å°ï¼ˆè¯¥æ•°ç»„ä¸­åŒ…å«çš„ JSON é¡¹ä¸ªæ•°ï¼‰

int

cJSON\_Delete

åˆ é™¤ cJSON ç»“æ„ä½“

void

#### 3.3.1 ä¸€ä¸ªç®€å•çš„ä¾‹å­

å¯¹äºä¸€ä¸ª JSON å­—ç¬¦ä¸²ï¼š

    {
        "name": "å¼ ä¸‰",
        "age": 18,
        "sex": "ç”·"
    }
    

æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡è°ƒç”¨`cJSON_Parse(const char *value)`å‡½æ•°å°† JSON å­—ç¬¦ä¸² value ååºåˆ—åŒ–ä¸º cJSON ç»“æ„ä½“ï¼š

    cJSON *root = cJSON_Parse(pcJson); // pcJson ä¸ºä»æ–‡ä»¶ä¸­è·å–çš„ JSON å­—ç¬¦ä¸²
    if (NULL == root)
    {
        printf("fail to call cJSON_Parse\n");
        exit(0);
    }
    

ååºåˆ—åŒ–åçš„ JSON å­—ç¬¦ä¸²ï¼Œå¤§æ¦‚é•¿è¿™ä¸ªæ ·å­ï¼š

![image-20221119221819835](https://img2022.cnblogs.com/blog/1494888/202211/1494888-20221120134216581-1550828662.png)

*   å›¾ä¸­çš„ç°è‰²è™šçº¿æ˜¯å‡æƒ³çš„ï¼Œå®é™…æ˜¯ä¸å­˜åœ¨çš„
*   ç”¨æ¥è¡¨æ˜ nameã€ageã€sex éƒ½æ˜¯ root çš„ childï¼Œåªä¸è¿‡å®é™…çš„ child ä»…ä»…æŒ‡å‘äº†ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ name

é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è·å– nameã€ageã€sex å¯¹åº”çš„å€¼å‘¢ï¼Ÿå¯ä»¥é€šè¿‡è°ƒç”¨`cJSON *cJSON_GetObjectItem()`å‡½æ•°ä» object ä¸­è·å–ã€‚

    cJSON *pName = cJSON_GetObjectItem(root, "name");
    printf("name [%s]\n", pName->valuestring);
    
    cJSON *pAge = cJSON_GetObjectItem(root, "age");
    printf("age  [%d]\n", pAge->valueint);
    
    cJSON *pSex = cJSON_GetObjectItem(root, "sex");
    printf("sex  [%s]\n", pSex->valuestring);
    

*   `cJSON *cJSON_GetObjectItem(cJSON *object, const char *string)`ï¼šä» object çš„æ‰€æœ‰ child ä¸­æ£€ç´¢é”®ä¸º string çš„ JSON é¡¹
    *   å¦‚æœæ‰¾åˆ°åˆ™è¿”å›ç›¸åº”çš„ JSON é¡¹
    *   åä¹‹è¿”å› NULLã€‚

å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

    #include <stdio.h>
    #include <string.h>
    #include <stdlib.h>
    #include <math.h>
    #include <ctype.h>
    #include "cJSON.h"
    
    #define STRING_LEN_MAX 2048
    
    void GetJSONFromFile(const char *FILENAME, char **ppcJson)
    {
        FILE *fp = fopen(FILENAME, "r");
        if (NULL == fp)
        {
            printf("file open error\n");
            exit(0);
        }
    
        char *pcJson = (char *)malloc(STRING_LEN_MAX);
        memset(pcJson, 0, STRING_LEN_MAX);
    
        do
        {
            fgets(pcJson + strlen(pcJson), STRING_LEN_MAX - strlen(pcJson), fp);
        } while (!feof(fp));
    
        *ppcJson = pcJson;
    
        fclose(fp);
    }
    
    int main()
    {
        char *pcJson;
    
        GetJSONFromFile("test.json", &pcJson); // ä»æ–‡ä»¶ test.json ä¸­è·å– JSON å­—ç¬¦ä¸²
    
        cJSON *root = cJSON_Parse(pcJson);
        if (NULL == root)
        {
            printf("fail to call cJSON_Parse\n");
            exit(0);
        }
    
        cJSON *pName = cJSON_GetObjectItem(root, "name");
        printf("name [%s]\n", pName->valuestring);
    
        cJSON *pAge = cJSON_GetObjectItem(root, "age");
        printf("age  [%d]\n", pAge->valueint);
    
        cJSON *pSex = cJSON_GetObjectItem(root, "sex");
        printf("sex  [%s]\n", pSex->valuestring);
    
        cJSON_Delete(root);	// æ‰‹åŠ¨è°ƒç”¨ cJSON_Delete è¿›è¡Œå†…å­˜å›æ”¶
        
        return 0;
    }
    

#### 3.3.2 ä¸€ä¸ªæœ‰ä¸€ä¸¢ä¸¢å¤æ‚çš„ä¾‹å­

å¯¹äºä¸€ä¸ªå¤æ‚äº›çš„ JSON å­—ç¬¦ä¸²ï¼š

    {
        "class_name": "è®¡ç§‘ä¸€ç­",
        "stu_num"   : 2,
        "stu_info"  : 
        [
            {
                "name": "å¼ ä¸‰",
                "age": 18,
                "sex": "ç”·"
            },
            {
                "name": "æå››",
                "age": 20,
                "sex": "ç”·"
            }
        ]
    }
    

ååºåˆ—åŒ–è¯¥å­—ç¬¦ä¸²ä¾æ—§å¾ˆç®€å•ï¼Œåªéœ€æˆ‘ä»¬åœ¨ä»£ç ä¸­è°ƒç”¨`cJSON_Parse()`å³å¯ï¼Œè€Œéš¾ç‚¹åœ¨äºå¦‚ä½•è§£æã€‚

å…ˆæ¥çœ‹ä¸€ä¸‹è¯¥å­—ç¬¦ä¸²ååºåˆ—åŒ–åé•¿å•¥æ ·ï¼š

![image-20221119223404283](https://img2022.cnblogs.com/blog/1494888/202211/1494888-20221120134216270-1499947684.png)

å¯¹äº class\_name ä»¥åŠ stu\_nameï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å°±è§£æå‡ºæ¥ï¼š

    cJSON *pClassName = cJSON_GetObjectItem(root, "class_name");
    printf("class name [%s]\n", pClassName->valuestring);
    
    cJSON *pStuNum = cJSON_GetObjectItem(root, "stu_num");
    printf("stu num    [%d]\n", pStuNum->valueint);
    

é‚£ä¹ˆå¦‚ä½•è·å–æ›´æ·±å±‚æ¬¡çš„ nameã€age ä»¥åŠ sex å‘¢ï¼Ÿ

é€šè¿‡ JSON å­—ç¬¦ä¸²å¯ä»¥çŸ¥é“ï¼Œstu\_info æ˜¯ä¸€ä¸ª JSON æ•°ç»„ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆè¦åšçš„æ˜¯å°†è¿™ä¸ªæ•°ç»„ä» root ä¸­æ‘˜å‡ºæ¥ï¼š

    cJSON *pArray = cJSON_GetObjectItem(root, "stu_info");
    if (NULL == pArray)
    {
        printf("not find stu_info\n");
        goto err;
    }
    

æ¥ç€å°†è¯¥æ•°ç»„ä¸­çš„å„ä¸ªé¡¹ä¾æ¬¡å–å‡ºã€‚

    cJSON *item_0 = cJSON_GetArrayItem(pArray, 0);
    cJSON *item_1 = cJSON_GetArrayItem(pArray, 1);
    

*   `cJSON_GetArrayItem(cJSON *array, int item)`ï¼šä» JSON æ•°ç»„ array ä¸­è·å–ç¬¬ item é¡¹ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰
    
    *   å¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›ç›¸åº”çš„ JSON é¡¹
        
    *   åä¹‹è¿”å› NULLã€‚
        

æœ€åï¼Œå°† nameã€ageã€sex åˆ†åˆ«ä» item\_0 / item\_1 ä¸­å–å‡ºå³å¯ã€‚

ä¸Šè¿°æ“ä½œåªæ˜¯ä¸ºäº†è®²è§£å¦‚ä½•è·å–æ›´æ·±å±‚æ¬¡çš„ JSON é¡¹ï¼Œå®é™…æ“ä½œä¸­ä¼šè¿™ä¹ˆå†™ï¼š

    int iArraySize = cJSON_GetArraySize(pArray);
    for (i = 0; i < iArraySize; i++)
    {
        printf("******** Stu[%d] info ********\n", i + 1);
    
        cJSON *item = cJSON_GetArrayItem(pArray, i);
    
        cJSON *pName = cJSON_GetObjectItem(item, "name");
        printf("name  [%s]\n", pName->valuestring);
    
        cJSON *pAge = cJSON_GetObjectItem(item, "age");
        printf("age   [%d]\n", pAge->valueint);
    
        cJSON *pSex = cJSON_GetObjectItem(item, "sex");
        printf("sex   [%s]\n", pSex->valuestring);
    }
    

> å°±è·Ÿå‰¥æ´‹è‘±ä¼¼çš„ï¼Œå…ˆå°†å¤–å±‚çš„ stu\_info å‰¥å‡ºæ¥ï¼Œç„¶ååœ¨å‰¥å‡ºå†…å±‚çš„ itemï¼Œæœ€åå°† nameã€ageã€sex ä» item ä¸­åˆ†ç¦»å‡ºæ¥ã€‚
> 
> å¯¹äºæ›´å¤šå±‚æ¬¡çš„ JSON å¤„ç†ï¼Œä¹Ÿæ˜¯åŒæ ·çš„æ“ä½œï¼Œä½ åªéœ€è¦ä¿è¯åœ¨è§£æä½ æ‰€éœ€çš„ JSON é¡¹å‰ï¼Œå…¶çˆ¶èŠ‚ç‚¹å·²è¢«è§£æã€‚

å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

    #include <stdio.h>
    #include <string.h>
    #include <stdlib.h>
    #include <math.h>
    #include <ctype.h>
    #include "cJSON.h"
    
    #define STRING_LEN_MAX 2048
    
    void GetJSONFromFile(const char *FILENAME, char **ppcJson)
    {
        FILE *fp = fopen(FILENAME, "r");
        if (NULL == fp)
        {
            printf("file open error\n");
            exit(0);
        }
    
        char *pcJson = (char *)malloc(STRING_LEN_MAX);
        memset(pcJson, 0, STRING_LEN_MAX);
    
        do
        {
            fgets(pcJson + strlen(pcJson), STRING_LEN_MAX - strlen(pcJson), fp);
        } while (!feof(fp));
    
        *ppcJson = pcJson;
    
        fclose(fp);
    }
    
    int main()
    {
        char *pcJson;
    
        GetJSONFromFile("test.json", &pcJson);
    
        cJSON *root = cJSON_Parse(pcJson);
        if (NULL == root)
        {
            printf("fail to call cJSON_Parse\n");
            exit(0);
        }
    
        cJSON *pClassName = cJSON_GetObjectItem(root, "class_name");
        printf("class name [%s]\n", pClassName->valuestring);
    
        cJSON *pStuNum = cJSON_GetObjectItem(root, "stu_num");
        printf("stu num    [%d]\n", pStuNum->valueint);
    
        cJSON *pArray = cJSON_GetObjectItem(root, "stu_info");
        if (NULL == pArray)
        {
            printf("not find stu_info\n");
            goto err;
        }
        int i;
        int iArraySize = cJSON_GetArraySize(pArray);
        for (i = 0; i < iArraySize; i++)
        {
            printf("******** Stu[%d] info ********\n", i + 1);
    
            cJSON *item = cJSON_GetArrayItem(pArray, i);
    
            cJSON *pName = cJSON_GetObjectItem(item, "name");
            printf("name  [%s]\n", pName->valuestring);
    
            cJSON *pAge = cJSON_GetObjectItem(item, "age");
            printf("age   [%d]\n", pAge->valueint);
    
            cJSON *pSex = cJSON_GetObjectItem(item, "sex");
            printf("sex   [%s]\n", pSex->valuestring);
        }
        
    err:
        cJSON_Delete(root); // æ‰‹åŠ¨è°ƒç”¨ cJSON_Delete è¿›è¡Œå†…å­˜å›æ”¶
    
        return 0;
    }
    

### 3.4 åºåˆ—åŒ– cJSON ç»“æ„ä½“

å‰é¢æˆ‘ä»¬ä¸€ç›´åœ¨ä»‹ç»å¦‚ä½•å°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º cJSON ç»“æ„ä½“ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹å¦‚ä½•å°† cJSON ç»“æ„ä½“åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬è¦å…ˆæœ‰ä¸€ä¸ª cJSON ç»“æ„ä½“ï¼Œæ„é€  cJSON ç»“æ„ä½“çš„ç›¸å…³å‡½æ•°å¦‚ä¸‹ï¼š

å‡½æ•°

è§£é‡Šè¯´æ˜

è¿”å›å€¼

cJSON\_CreateObject

åˆ›å»ºä¸€ä¸ª object ç±»å‹çš„ JSON é¡¹

cJSON \*

cJSON\_CreateArray

åˆ›å»ºä¸€ä¸ª array ç±»å‹çš„ JSON é¡¹

cJSON \*

cJSON\_CreateString

åˆ›å»ºä¸€ä¸ªå€¼ä¸º string ç±»å‹çš„ JSON é¡¹

cJSON \*

cJSON\_CreateNumber

åˆ›å»ºä¸€ä¸ªå€¼ä¸º number ç±»å‹çš„ JSON é¡¹

cJSON \*

cJSON\_AddItemToObject

å°† JSON é¡¹æ·»åŠ åˆ° object ä¸­

void

cJSON\_AddItemToArray

å°† JSON é¡¹æ·»åŠ åˆ° array ä¸­

void

cJSON\_AddNumberToObject

åˆ›å»ºä¸€ä¸ªå€¼ä¸º number ç±»å‹çš„ JSON é¡¹å¹¶æ·»åŠ åˆ° JSON å¯¹è±¡ä¸­

void

cJSON\_AddStringToObject

åˆ›å»ºä¸€ä¸ªå€¼ä¸º string ç±»å‹çš„ JSON é¡¹å¹¶æ·»åŠ åˆ° JSON å¯¹è±¡ä¸­

void

cJSON\_Print

å°† cJSON ç»“æ„ä½“**åºåˆ—åŒ–**ä¸º JSON å­—ç¬¦ä¸²ï¼ˆæœ‰æ ¼å¼ï¼‰

char \*

cJSON\_PrintUnformatted

å°† cJSON ç»“æ„ä½“åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼ˆæ— æ ¼å¼ï¼‰

char \*

cJSON\_Delete

åˆ é™¤ cJSON ç»“æ„ä½“

void

#### 3.4.1 ä¸€ä¸ªç®€å•çš„ä¾‹å­

å‡è®¾æˆ‘ä»¬æƒ³è¦è·å–çš„ JSON å­—ç¬¦ä¸²ä¸ºï¼š

    {
        "name": "å¼ ä¸‰",
        "age": 18,
        "sex": "ç”·"
    }
    

æˆ‘ä»¬è¯¥å¦‚ä½•æ„é€  cJSON ç»“æ„ä½“å‘¢ï¼Ÿ

è¿˜è®°å¾—è¿™ä¸ª JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–çš„æ ·å­å—ï¼Ÿä¸è®°å¾—ä¹Ÿæ²¡å…³ç³»ï¼Œå› ä¸ºæˆ‘é©¬ä¸Šå°±è¦å¼ è´´äº†ğŸ˜

![image-20221119225512840](https://img2022.cnblogs.com/blog/1494888/202211/1494888-20221120134215935-737988475.png)

æ ¹æ®å›¾ç¤ºå¯çŸ¥ï¼Œæˆ‘ä»¬è¦å…ˆæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ rootã€‚

ç”±äºæœ¬æ¬¡æ ·ä¾‹ä¸­çš„ JSON å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡`cJSON_CreateObject()`å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ª object ç±»å‹çš„ rootï¼š

    cJSON *root = cJSON_CreateObject();
    

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°† nameã€ageã€sex åˆ†åˆ«åŠ å…¥åˆ° root ä¸­ï¼š

*   é€šè¿‡`cJSON_AddStringToObject()`å°†å­—ç¬¦ä¸²ç±»å‹çš„ nameã€sex åŠ å…¥åˆ° root ä¸­
*   é€šè¿‡`cJSON_AddNumberToObject()`å°†æ•°å€¼ç±»å‹çš„ age åŠ å…¥åˆ° root ä¸­

å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š

    cJSON_AddStringToObject(root, "name", "å¼ ä¸‰");
    cJSON_AddNumberToObject(root, "age", 18);
    cJSON_AddStringToObject(root, "sex", "ç”·");
    

*   `cJSON_AddStringToObject(object,name,s)`ï¼šå°†é”®å€¼å¯¹ï¼ˆname / sï¼‰åŠ å…¥åˆ° object ä¸­
*   `cJSON_AddNumberToObject(object,name,n)`ï¼šå°†é”®å€¼å¯¹ï¼ˆname / nï¼‰åŠ å…¥åˆ° object ä¸­

ç»è¿‡ä¸Šè¿°æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å¦‚å›¾ 6 æ‰€ç¤ºçš„ cJSON ç»“æ„ä½“ã€‚é‚£å¦‚ä½•è·å–åŸºäºè¯¥ç»“æ„ä½“çš„ JSON å­—ç¬¦ä¸²å‘¢ï¼Ÿ

å¾ˆç®€å•ï¼Œè°ƒç”¨å‡½æ•°`cJSON_Print()`æˆ–`cJSON_PrintUnformatted()`å³å¯å®ç°ï¼š

    char *pJsonFormatted = cJSON_Print(root);
    puts(pJsonFormatted);
    
    char *pJsonUnformatted = cJSON_PrintUnformatted(root);
    puts(pJsonUnformatted);
    

`cJSON_Print()`å’Œ`cJSON_PrintUnformatted()`ï¼Œè¿™ä¸¤ä¸ª API çš„åŒºåˆ«åœ¨äºï¼šä¸€ä¸ªæ˜¯æ²¡æœ‰æ ¼å¼çš„ï¼Œä¹Ÿå°±æ˜¯è½¬æ¢å‡ºçš„å­—ç¬¦ä¸²ä¸­é—´ä¸ä¼šæœ‰æ¢è¡Œã€å¯¹é½ä¹‹ç±»çš„æ ¼å¼å­˜åœ¨ã€‚è€Œ cJSON\_Print æ‰“å°å‡ºæ¥æ˜¯æˆ‘ä»¬çœ‹èµ·æ¥å¾ˆèˆ’æœçš„æ ¼å¼ï¼Œä»…æ­¤è€Œå·²ã€‚

å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

    #include <stdio.h>
    #include <string.h>
    #include <stdlib.h>
    #include <math.h>
    #include <ctype.h>
    #include "cJSON.h"
    
    int main()
    {
    	cJSON *root = cJSON_CreateObject();
    	cJSON_AddStringToObject(root, "name", "å¼ ä¸‰");
    	cJSON_AddNumberToObject(root, "age", 18);
    	cJSON_AddStringToObject(root, "sex", "ç”·");
    
    	char *pJsonFormatted = cJSON_Print(root);
    	puts(pJsonFormatted);
    	
    	char *pJsonUnformatted = cJSON_PrintUnformatted(root);
    	puts(pJsonUnformatted);
    
    	cJSON_Delete(root); // æ‰‹åŠ¨è°ƒç”¨ cJSON_Delete è¿›è¡Œå†…å­˜å›æ”¶
    	
        // è®°å¾—å›æ”¶ pJsonFormatted å’Œ pJsonUnformatted
    	if (NULL != pJsonFormatted)
    	{
    		free(pJsonFormatted);
    	}
    	if (NULL != pJsonUnformatted)
    	{
    		free(pJsonUnformatted);
    	}
    
    	return 0;
    }
    

#### 3.4.2 ä¸€ä¸ªæœ‰ä¸€ä¸¢ä¸¢å¤æ‚çš„ä¾‹å­

è¿™æ¬¡æˆ‘ä»¬è¦è·å–çš„ JSON å­—ç¬¦ä¸²ä¸ºï¼š

    {
        "class_name": "è®¡ç§‘ä¸€ç­",
        "stu_num"   : 2,
        "stu_info"  : 
        [
            {
                "name": "å¼ ä¸‰",
                "age": 18,
                "sex": "ç”·"
            },
            {
                "name": "æå››",
                "age": 20,
                "sex": "ç”·"
            }
        ]
    }
    

å¯¹åº”çš„ååºåˆ—åŒ–åçš„æ¨¡æ ·å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image-20221119232056866](https://img2022.cnblogs.com/blog/1494888/202211/1494888-20221120134215478-1510756546.png)

å…·ä½“åšæ³•ä¸ºï¼š

1.  é¦–å…ˆåˆ›å»ºä¸€ä¸ª root
2.  å°†ç¬¬äºŒå±‚çš„ class\_nameã€stu\_numã€stu\_info åŠ å…¥åˆ° root ä¸­
3.  æ„é€ ä¸¤ä¸ª JSON é¡¹ item\_0 å’Œ item\_1ï¼Œå¹¶å°† nameã€ageã€sex åˆ†åˆ«åŠ å…¥å…¶ä¸­
4.  æœ€åå°† JSON é¡¹ åŠ å…¥åˆ° stu\_info ä¸­

å¤§åŠŸå‘Šæˆï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

    #include <stdio.h>
    #include <string.h>
    #include <stdlib.h>
    #include <math.h>
    #include <ctype.h>
    #include "cJSON.h"
    
    int main()
    {
        // æ­¥éª¤ä¸€
    	cJSON *root = cJSON_CreateObject();
    
        // æ­¥éª¤äºŒ
    	cJSON_AddStringToObject(root, "class_name", "è®¡ç§‘ä¸€ç­");
    	cJSON_AddNumberToObject(root, "stu_num", 2);
    	
    	cJSON *pArray = cJSON_CreateArray();
    	cJSON_AddItemToObject(root, "stu_info", pArray);
    
       	// æ­¥éª¤ä¸‰
    	cJSON *pObject_1 = cJSON_CreateObject();
    	cJSON_AddStringToObject(pObject_1, "name", "å¼ ä¸‰");
    	cJSON_AddNumberToObject(pObject_1, "age", 18);
    	cJSON_AddStringToObject(pObject_1, "sex", "ç”·");
    	
    	cJSON *pObject_2 = cJSON_CreateObject();
    	cJSON_AddStringToObject(pObject_2, "name", "æå››");
    	cJSON_AddNumberToObject(pObject_2, "age", 19);
    	cJSON_AddStringToObject(pObject_2, "sex", "ç”·");
        
        // æ­¥éª¤å››
        cJSON_AddItemToArray(pArray, pObject_1);
    	cJSON_AddItemToArray(pArray, pObject_2);
    
    	char *pJson = cJSON_Print(root);
    	puts(pJson);
    
    
    	cJSON_Delete(root); // æ‰‹åŠ¨è°ƒç”¨ cJSON_Delete è¿›è¡Œå†…å­˜å›æ”¶
    	if (NULL != pJson)  // å›æ”¶ pJson
    	{
    		free(pJson);
    	}
    	return 0;
    }
    

å‚è€ƒèµ„æ–™
----

*   [cJSON ä½¿ç”¨ç¬”è®° - é±¼ç«¿çš„ä¼ è¯´ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/chineseboy/p/3959852.html)
*   [ä½¿ç”¨ CJSON åœ¨Cè¯­è¨€ä¸­è¿›è¡Œ JSON çš„åˆ›å»ºå’Œè§£æçš„å®ä¾‹è®²è§£ - fengbohello - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/fengbohello/p/4033272.html)
*   [cJSONå­¦ä¹ ç¬”è®°\_xukai871105çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/xukai871105/article/details/17094113)
*   [è®¤è¯†Jsonæœ¬è´¨ & ä¸€ä¸ªè¾ƒå¤æ‚Jsonä¸²çš„è§£æå®ä¾‹ - ç°ä¿¡ç½‘ï¼ˆè½¯ä»¶å¼€å‘åšå®¢èšåˆï¼‰ (freesion.com)](https://www.freesion.com/article/3343657175/)
*   [é›¶åŸºç¡€å­¦ä¹ cJSON æºç è¯¦è§£ä¸åº”ç”¨ï¼ˆä¸€ï¼‰å¦‚ä½•å­¦ä¹ cJSON\_killer-pçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/weixin_44821644/article/details/110395913)