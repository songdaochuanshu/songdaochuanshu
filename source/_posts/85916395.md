---
layout: post
title: "æ‰‹æŠŠæ‰‹å¸¦ä½ è‡ªå®šä¹‰ Gradle æ’ä»¶ â€”â€” Gradle ç³»åˆ—(2)"
date: "2022-05-17T09:19:16.340Z"
---
æ‰‹æŠŠæ‰‹å¸¦ä½ è‡ªå®šä¹‰ Gradle æ’ä»¶ â€”â€” Gradle ç³»åˆ—(2)
==================================

> è¯·ç‚¹èµåŠ å…³æ³¨ï¼Œä½ çš„æ”¯æŒå¯¹æˆ‘éå¸¸é‡è¦ï¼Œæ»¡è¶³ä¸‹æˆ‘çš„è™šè£å¿ƒã€‚
> 
> ğŸ”¥ Hiï¼Œæˆ‘æ˜¯å°å½­ã€‚æœ¬æ–‡å·²æ”¶å½•åˆ° GitHub Â· Android-NoteBook ä¸­ã€‚è¿™é‡Œæœ‰ Android è¿›é˜¶æˆé•¿çŸ¥è¯†ä½“ç³»ï¼Œæœ‰å¿—åŒé“åˆçš„æœ‹å‹ï¼Œæ¬¢è¿è·Ÿç€æˆ‘ä¸€èµ·æˆé•¿ã€‚ï¼ˆè”ç³»æ–¹å¼åœ¨ GitHubï¼‰

å‰è¨€
--

Gradle æœ¬è´¨ä¸Šæ˜¯é«˜åº¦æ¨¡å—åŒ–çš„æ„å»ºé€»è¾‘ï¼Œä¾¿äºé‡ç”¨å¹¶ä¸ä»–äººåˆ†äº«ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„ Android æ„å»ºæµç¨‹å°±æ˜¯ç”± Android Gradle Plugin å¼•å…¥çš„æ„å»ºé€»è¾‘ã€‚åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘å°†å¸¦ä½ æ¢è®¨ Gradle æ’ä»¶çš„ä½¿ç”¨æ–¹æ³•ã€å¼€å‘æ­¥éª¤å’ŒæŠ€å·§æ€»ç»“ã€‚

è¿™ç¯‡æ–‡ç« æ˜¯å…¨é¢æŒæ¡ Gradle æ„å»ºç³»ç»Ÿç³»åˆ—çš„ç¬¬ 2 ç¯‡ï¼š

*   [1ã€Gradle åŸºç¡€](https://juejin.cn/post/7092367604211253256)
*   [2ã€Gradle æ’ä»¶](https://juejin.cn/post/7098383560746696718)
*   3ã€Gradle ä¾èµ–ç®¡ç†
*   4ã€APG Transform

* * *

1\. è®¤è¯† Gradle æ’ä»¶
----------------

### 1.1 ä»€ä¹ˆæ˜¯ Gradle æ’ä»¶

Gradle å’Œ Gradle æ’ä»¶æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æ¦‚å¿µï¼ŒGradle æä¾›çš„æ˜¯ä¸€å¥—æ ¸å¿ƒçš„æ„å»ºæœºåˆ¶ï¼Œè€Œ Gradle æ’ä»¶åˆ™æ˜¯è¿è¡Œåœ¨è¿™å¥—æœºåˆ¶ä¸Šçš„ä¸€äº›å…·ä½“æ„å»ºé€»è¾‘ï¼Œæœ¬è´¨ä¸Šå’Œ .gradle æ–‡ä»¶æ˜¯ç›¸åŒã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„ç¼–è¯‘ Java ä»£ç çš„èƒ½åŠ›ï¼Œéƒ½æ˜¯ç”±æ’ä»¶æä¾›çš„ã€‚

### 1.2 Gradle æ’ä»¶çš„ä¼˜ç‚¹

è™½ç„¶ Gradle æ’ä»¶ä¸ .gradle æ–‡ä»¶æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œ.gradle æ–‡ä»¶ä¹Ÿèƒ½å®ç° Gradle æ’ä»¶ç±»ä¼¼çš„åŠŸèƒ½ã€‚ä½†æ˜¯ï¼ŒGradle æ’ä»¶ä½¿ç”¨äº†ç‹¬ç«‹æ¨¡å—å°è£…æ„å»ºé€»è¾‘ï¼Œæ— è®ºæ˜¯ä»å¼€å‘å¼€å§‹ä½¿ç”¨æ¥çœ‹ï¼ŒGradle æ’ä»¶çš„æ•´ä½“ä½“éªŒéƒ½æ›´å‹å¥½ã€‚

*   **é€»è¾‘å¤ç”¨ï¼š** å°†ç›¸åŒçš„é€»è¾‘æä¾›ç»™å¤šä¸ªç›¸ä¼¼é¡¹ç›®å¤ç”¨ï¼Œå‡å°‘é‡å¤ç»´æŠ¤ç±»ä¼¼é€»è¾‘å¼€é”€ã€‚å½“ç„¶ .gradle æ–‡ä»¶ä¹Ÿèƒ½åšåˆ°é€»è¾‘å¤ç”¨ï¼Œä½† Gradle æ’ä»¶çš„å°è£…æ€§æ›´å¥½ï¼›
*   **ç»„ä»¶å‘å¸ƒï¼š** å¯ä»¥å°†æ’ä»¶å‘å¸ƒåˆ° Maven ä»“åº“è¿›è¡Œç®¡ç†ï¼Œå…¶ä»–é¡¹ç›®å¯ä»¥ä½¿ç”¨æ’ä»¶ ID ä¾èµ–ã€‚å½“ç„¶ .gradle æ–‡ä»¶ä¹Ÿå¯ä»¥æ”¾åˆ°ä¸€ä¸ªè¿œç¨‹è·¯å¾„è¢«å…¶ä»–é¡¹ç›®å¼•ç”¨ï¼›
*   **æ„å»ºé…ç½®ï¼š** Gradle æ’ä»¶å¯ä»¥å£°æ˜æ’ä»¶æ‰©å±•æ¥æš´éœ²å¯é…ç½®çš„å±æ€§ï¼Œæä¾›å®šåˆ¶åŒ–èƒ½åŠ›ã€‚å½“ç„¶ .gradle æ–‡ä»¶ä¹Ÿå¯ä»¥åšåˆ°ï¼Œä½†å®ç°ä¼šéº»çƒ¦äº›ã€‚

### 1.3 æ’ä»¶çš„ä¸¤ç§å®ç°å½¢å¼

Gradle æ’ä»¶çš„æ ¸å¿ƒç±»æ˜¯ Pluginï¼Œä¸€èˆ¬ä½¿ç”¨ Project ä½œä¸ºæ³›å‹å®å‚ã€‚å½“ä½¿ç”¨æ–¹å¼•å…¥æ’ä»¶åï¼Œå…¶å®å°±æ˜¯è°ƒç”¨äº† `Plugin#apply()` æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ apply() æ–¹æ³•ç†è§£ä¸ºæ’ä»¶çš„æ‰§è¡Œå…¥å£ã€‚ä¾‹å¦‚ï¼š

`MyCustomGradlePlugin.groovy`

    public class MyCustomGradlePlugin implements Plugin<Project> {
        @Override
        void apply(Project project) {
            println "Hello."
        }
    }
    

å¦‚æœæ ¹æ®å®ç°å½¢å¼åˆ†ç±»ï¼ˆMyCustomGradlePlugin çš„ä»£ç ä½ç½®ï¼‰ï¼Œå¯ä»¥æŠŠ Gradle æ’ä»¶åˆ†ä¸º 2 ç±»ï¼š

*   **1ã€è„šæœ¬æ’ä»¶ï¼š** è„šæœ¬æ’ä»¶å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„è„šæœ¬æ–‡ä»¶ï¼Œå®ƒå¯ä»¥è¢«å¯¼å…¥éƒ½å…¶ä»–æ„å»ºè„šæœ¬ä¸­ã€‚æœ‰çš„æœ‹å‹è¯´è„šæœ¬æ’ä»¶ä¹Ÿéœ€è¦ä½¿ç”¨ Plugin æ¥å£æ‰ç®—è„šæœ¬æ’ä»¶ï¼Œä¾‹å¦‚ï¼š

`build.gradle`

    apply plugin: MyCustomGradlePlugin
    
    class MyCustomGradlePlugin implements Plugin<Project> {
        ...
    }
    

*   **2ã€äºŒè¿›åˆ¶æ’ä»¶ / å¯¹è±¡æ’ä»¶ï¼š** åœ¨ä¸€ä¸ªå•ç‹¬çš„æ’ä»¶æ¨¡å—ä¸­å®šä¹‰ï¼Œå…¶ä»–æ¨¡å—é€šè¿‡ Plugin ID åº”ç”¨æ’ä»¶ã€‚å› ä¸ºè¿™ç§æ–¹å¼å‘å¸ƒå’Œå¤ç”¨æ›´åŠ å‹å¥½ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ¥è§¦åˆ°çš„ Gradle æ’ä»¶éƒ½æ˜¯æŒ‡äºŒè¿›åˆ¶æ’ä»¶çš„å½¢å¼ã€‚

### 1.4 åº”ç”¨æ’ä»¶çš„æ­¥éª¤

æˆ‘ä»¬æ€»ç»“ä¸‹ä½¿ç”¨äºŒè¿›åˆ¶æ’ä»¶çš„æ­¥éª¤ï¼š

*   **1ã€å°†æ’ä»¶æ·»åŠ åˆ° classpathï¼š** å°†æ’ä»¶æ·»åŠ åˆ°æ„å»ºè„šæœ¬çš„ classpath ä¸­ï¼Œæˆ‘ä»¬çš„ Gradle æ„å»ºè„šæœ¬æ‰èƒ½åº”ç”¨æ’ä»¶ã€‚è¿™é‡ŒåŒºåˆ†æœ¬åœ°ä¾èµ–å’Œè¿œç¨‹ä¾èµ–ä¸¤ç§æƒ…å†µã€‚

**æœ¬åœ°ä¾èµ–ï¼š** æŒ‡ç›´æ¥ä¾èµ–æœ¬åœ°æ’ä»¶æºç ï¼Œä¸€èˆ¬åœ¨è°ƒè¯•æ’ä»¶çš„é˜¶æ®µæ˜¯ä½¿ç”¨æœ¬åœ°ä¾èµ–çš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼š

`é¡¹ç›® build.gradle`

    buildscript {
        ...
        dependencies {
            // For Debug
            classpath project(":easyupload")
        }
    }
    

**è¿œç¨‹ä¾èµ–ï¼š** æŒ‡ä¾èµ–å·²å‘å¸ƒåˆ° Maven ä»“åº“çš„æ’ä»¶ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯ç”¨è¿™ç§æ–¹å¼ä¾èµ–å®˜æ–¹æˆ–ç¬¬ä¸‰æ–¹å®ç°çš„ Gradle æ’ä»¶ã€‚ä¾‹å¦‚ï¼š

`é¡¹ç›® build.gradle`

    buildscript {
        repositories {
            google()
            jcenter()
        }
        dependencies {
            classpath 'com.android.tools.build:gradle:3.5.3'
            // ä¹Ÿå¯ä»¥ä½¿ç”¨å¦ä¸€ç§ç­‰ä»·è¯­æ³•ï¼š
            classpath group: 'com.android.tools.build ', name: 'gradle ', version: '3.5.3'
        }
        ...
    }
    

*   **2ã€ä½¿ç”¨ apply åº”ç”¨æ’ä»¶ï¼š** åœ¨éœ€è¦ä½¿ç”¨æ’ä»¶çš„ .gradle è„šæœ¬ä¸­ä½¿ç”¨ `apply` åº”ç”¨æ’ä»¶ï¼Œè¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ Plugin å®ä¾‹ï¼Œå¹¶æ‰§è¡Œ Plugin#apply() æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š

    apply plugin: 'com.android.application'
    
    // æˆ–è€…
    
    plugins {
        // id Â«plugin idÂ» [version Â«plugin versionÂ»] [apply Â«falseÂ»]
        id 'com.android.application'
    }
    

> **æ³¨æ„ï¼š**Â ä¸æ”¯æŒåœ¨ä¸€ä¸ª build.gradle ä¸­åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§è¯­æ³•ã€‚

### 1.5 ç‰¹æ®Šçš„ buildSrc æ¨¡å—

æ’ä»¶æ¨¡å—çš„åç§°æ˜¯ä»»æ„çš„ï¼Œé™¤éä½¿ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„åç§° â€œbuildSrcâ€ï¼ŒbuildSrc æ¨¡å—æ˜¯ Gradle é»˜è®¤çš„æ’ä»¶æ¨¡å—ã€‚buildSrc æ¨¡å—æœ¬è´¨ä¸Šå’Œæ™®é€šçš„æ’ä»¶æ¨¡å—æ˜¯ä¸€æ ·çš„ï¼Œæœ‰ä¸€äº›å°åŒºåˆ«ï¼š

*   1ã€buildSrc æ¨¡å—ä¼šè¢«è‡ªåŠ¨è¯†åˆ«ä¸ºå‚ä¸æ„å»ºçš„æ¨¡å—ï¼Œå› æ­¤ä¸éœ€è¦åœ¨ settings.gradle ä¸­ä½¿ç”¨ include å¼•å…¥ï¼Œå°±ç®—å¼•å…¥äº†ä¹Ÿä¼šç¼–è¯‘å‡ºé”™ï¼š

    Build OutPutï¼š
    'buildSrc' cannot be used as a project name as it is a reserved name
    

*   2ã€buildSrc æ¨¡å—ä¼šè‡ªåŠ¨è¢«æ·»åŠ åˆ°æ„å»ºè„šæœ¬çš„ classpath ä¸­ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ·»åŠ ï¼š

    buildscript {
        ...
        dependencies {
            // ä¸éœ€è¦æ‰‹åŠ¨æ·»åŠ 
            // classpath project(":buildSrc")
        }
    }
    

*   3ã€buildSrc æ¨¡å—çš„ build.gradle æ‰§è¡Œæ—¶æœºæ—©äºå…¶ä»– Projectï¼š

    Executing tasks: [test] 
    
    settings.gradle:This is executed during the initialization phase.
    
    > Configure project :buildSrc
    build.gradle:buildSrc.
    
    > Task :buildSrc:compileJava NO-SOURCE
    > Task :buildSrc:compileGroovy NO-SOURCE
    > Task :buildSrc:pluginDescriptors UP-TO-DATE
    > Task :buildSrc:processResources NO-SOURCE
    > Task :buildSrc:classes UP-TO-DATE
    > Task :buildSrc:jar UP-TO-DATE
    > Task :buildSrc:assemble UP-TO-DATE
    > Task :buildSrc:pluginUnderTestMetadata UP-TO-DATE
    > Task :buildSrc:compileTestJava NO-SOURCE
    > Task :buildSrc:compileTestGroovy NO-SOURCE
    > Task :buildSrc:processTestResources NO-SOURCE
    > Task :buildSrc:testClasses UP-TO-DATE
    > Task :buildSrc:test NO-SOURCE
    > Task :buildSrc:validatePlugins UP-TO-DATE
    > Task :buildSrc:check UP-TO-DATE
    > Task :buildSrc:build UP-TO-DATE
    ...
    > Configure project :
    ...
    > Task :test
    ...
    BUILD SUCCESSFUL in 19s
    

![](https://img2022.cnblogs.com/blog/2839502/202205/2839502-20220517165827354-250671838.png)

* * *

2\. è‡ªå®šä¹‰ Gradle æ’ä»¶çš„æ­¥éª¤
--------------------

è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è®²å®ç° Gradle æ’ä»¶çš„å…·ä½“æ­¥éª¤ï¼ŒåŸºæœ¬æ­¥éª¤åˆ†ä¸º 5 æ­¥ï¼š

*   1ã€åˆå§‹åŒ–æ’ä»¶ç›®å½•ç»“æ„
*   2ã€åˆ›å»ºæ’ä»¶å®ç°ç±»
*   3ã€é…ç½®æ’ä»¶å®ç°ç±»
*   4ã€å‘å¸ƒæ’ä»¶
*   5ã€ä½¿ç”¨æ’ä»¶

### 2.1 åˆå§‹åŒ–æ’ä»¶ç›®å½•ç»“æ„

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ Android Studio æ–°å»ºä¸€ä¸ª `Java or Kotlin Library` æ¨¡å—ï¼Œè¿™é‡Œä»¥é buildSrc æ¨¡å—çš„æƒ…å†µä¸ºä¾‹ï¼š

![](https://img2022.cnblogs.com/blog/2839502/202205/2839502-20220517165838884-488057433.png)

ç„¶åï¼Œå°†æ¨¡å— build.gradle æ–‡ä»¶æ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹ï¼š

`æ¨¡å— build.gradle`

    plugins {
        id 'groovy' // Groovy Language
    		id 'org.jetbrains.kotlin.jvm' // Kotlin 
        id 'java-gradle-plugin' // Java Gradle Plugin
    }
    

*   **groovy æ’ä»¶ï¼š** ä½¿ç”¨ Groovy è¯­è¨€å¼€å‘å¿…å¤‡ï¼›
*   **org.jetbrains.kotlin.jvm æ’ä»¶ï¼š** ä½¿ç”¨ Kotlin è¯­è¨€å¼€å‘å¿…å¤‡ï¼›
*   **java-gradle-plugin æ’ä»¶ï¼š** ç”¨äºå¸®åŠ©å¼€å‘ Gradle æ’ä»¶ï¼Œä¼šè‡ªåŠ¨åº”ç”¨ [Java Library æ’ä»¶](https://docs.gradle.org/current/userguide/java_library_plugin.html#java_library_plugin)ï¼Œå¹¶åœ¨ dependencies ä¸­æ·»åŠ  `implementation gradleApi()`ã€‚

æœ€åï¼Œæ ¹æ®ä½ éœ€è¦çš„å¼€å‘è¯­è¨€è¡¥å……å¯¹åº”çš„æºç æ–‡ä»¶å¤¹ï¼Œä¸åŒè¯­è¨€æœ‰é»˜è®¤çš„æºç æ–‡ä»¶å¤¹ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ build.gradle æ–‡ä»¶ä¸­é‡æ–°æŒ‡å®šï¼š

`æ¨¡å— build.gradle`

    plugins {
        id 'groovy' // Groovy Language
        id 'org.jetbrains.kotlin.jvm' // Kotlin 
        id 'java-gradle-plugin' // Java Gradle Plugin
    }
    
    sourceSets {
        main {
            groovy {
                srcDir 'src/main/groovy'
            }
    
            java {
                srcDir 'src/main/java'
            }
    
            resources {
                srcDir 'src/main/resources'
            }
        }
    }
    

æ’ä»¶ç›®å½•ç»“æ„ï¼š

![](https://img2022.cnblogs.com/blog/2839502/202205/2839502-20220517165850330-2085464924.png)

### 2.2 åˆ›å»ºæ’ä»¶å®ç°ç±»

æ–°å»ºä¸€ä¸ª Plugin å®ç°ç±»ï¼Œå¹¶é‡å†™ apply æ–¹æ³•ä¸­æ·»åŠ æ„å»ºé€»è¾‘ï¼Œä¾‹å¦‚ï¼š

`com.pengxr.easyupload.EasyUpload.groovy`

    class EasyUpload implements Plugin<Project> {
    
        @Override
        void apply(Project project) {
            // æ„å»ºé€»è¾‘
            println "Hello."
        }
    }
    

### 2.3 é…ç½®æ’ä»¶å®ç°ç±»

åœ¨æ¨¡å— build.gradle æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹é…ç½®ï¼ŒgradlePlugin å®šä¹‰äº†æ’ä»¶ ID å’Œæ’ä»¶å®ç°ç±»çš„æ˜ å°„å…³ç³»ï¼š

    gradlePlugin {
        plugins {
            modularPlugin {
                // Plugin id.
                id = 'com.pengxr.easyupload'
                // Plugin implementation.
                implementationClass = 'com.pengxr.easyupload.EasyUpload'
            }
        }
    }
    

è¿™å…¶å®æ˜¯ Java Gradle Plugin æä¾›çš„ä¸€ä¸ªç®€åŒ– APIï¼Œå…¶èƒŒåä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª \[æ’ä»¶ID\].properties é…ç½®æ–‡ä»¶ï¼ŒGradle å°±æ˜¯é€šè¿‡è¿™ä¸ªæ–‡ä»¶ç±»è¿›è¡ŒåŒ¹é…çš„ã€‚å¦‚æœä½ ä¸ä½¿ç”¨ gradlePlugin APIï¼Œç›´æ¥æ‰‹åŠ¨åˆ›å»º \[æ’ä»¶ID\].properties æ–‡ä»¶ï¼Œä½œç”¨æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚

![](https://img2022.cnblogs.com/blog/2839502/202205/2839502-20220517165910067-1590969719.png)

è¦ç‚¹ï¼š

*   **1ã€\[æ’ä»¶ID\].properties æ–‡ä»¶åæ˜¯æ’ä»¶ IDï¼Œç”¨äºåº”ç”¨æ’ä»¶**
*   **2ã€\[æ’ä»¶ID\].properties æ–‡ä»¶å†…å®¹é…ç½®äº†æ’ä»¶å®ç°ç±»çš„æ˜ å°„ï¼Œéœ€è¦ä½¿ç”¨`implementation-class`æ¥æŒ‡å®šæ’ä»¶å®ä¹ ç±»çš„å…¨é™å®šç±»å**

    implementation-class=com.pengxr.easyupload.EasyUpload
    

### 2.4 å‘å¸ƒæ’ä»¶

æˆ‘ä»¬ä½¿ç”¨Â maven æ’ä»¶ æ¥å‘å¸ƒä»“åº“ï¼Œåœ¨æ¨¡å— build.gradle æ–‡ä»¶ä¸­å¢åŠ é…ç½®ï¼š

`æ¨¡å— build.gradle`

    plugins {
        id 'groovy' // Groovy Language
    		id 'org.jetbrains.kotlin.jvm' // Kotlin 
        id 'java-gradle-plugin' // Java Gradle Plugin
    }
    
    gradlePlugin {
        plugins {
            modularPlugin {
                // Plugin id.
                id = 'com.pengxr.easyupload'
                // Plugin implementation.
                implementationClass = 'com.pengxr.easyupload.EasyUpload'
            }
        }
    }
    
    uploadArchives {
        repositories {
            mavenDeployer {
                repository(url: uri('../localMavenRepository/snapshot'))
                pom.groupId = 'com.pengxr'
                pom.artifactId = 'easyupload'
                pom.version = '1.0.0'
            }
        }
    }
    

![](https://img2022.cnblogs.com/blog/2839502/202205/2839502-20220517165920670-10424478.png)

æ‰§è¡Œ `uploadArchives` ä»»åŠ¡ï¼Œä¼šå‘å¸ƒæ’ä»¶åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸­çš„ localMavenRepository æ–‡ä»¶å¤¹ï¼Œå®é™…é¡¹ç›®ä¸­é€šå¸¸æ˜¯å‘å¸ƒåˆ° Nexus ç§åº“æˆ– Github å…¬å…±åº“ç­‰ã€‚ä¸ç†Ÿæ‚‰ç»„ä»¶å‘å¸ƒçš„è¯å¯ä»¥å›é¡¾ï¼š[Androidå·¥ç¨‹åŒ–å®è·µï¼šç»„ä»¶åŒ–å‘å¸ƒ](https://juejin.cn/post/6963633839860088846)ï¼Œæ­¤å¤„ä¸å±•å¼€ã€‚

### 2.5 ä½¿ç”¨æ’ä»¶

åœ¨é¡¹ç›®çº§ build.gradle æ–‡ä»¶ä¸­å°†æ’ä»¶æ·»åŠ åˆ° classpathï¼š

`é¡¹ç›® build.gradle`

    buildscript {
        repositories {
            google()
            jcenter()
            maven { url "$rootDir/localMavenRepository/snapshot" }
            maven { url "$rootDir/localMavenRepository/release" }
        }
        dependencies {
            // For debug
            // classpath project(":easyupload")
            classpath "com.pengxr:easyupload:1.0.0"
        }
        ...
    }
    

åœ¨æ¨¡å—çº§ build.gradle æ–‡ä»¶ä¸­ apply æ’ä»¶ï¼š

`æ¨¡å— build.gradle`

    // 'é¡¹ç›® build.gradle' æ˜¯åœ¨ gradlePlugin ä¸­å®šä¹‰çš„æ’ä»¶ ID
    apply plugin: 'com.pengxr.easyupload'
    

å®Œæˆä»¥ä¸Šæ­¥éª¤å¹¶åŒæ­¥é¡¹ç›®ï¼Œä» Build Output å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ’ä»¶ç”Ÿæ•ˆäº†ï¼š

    Build Output:
    
    Hello.
    

åˆ°è¿™é‡Œï¼Œè‡ªå®šä¹‰ Gradle æ’ä»¶æœ€åŸºæœ¬çš„æ­¥éª¤å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥åœ¨ Plugin#apply æ–¹æ³•ä¸­å¼€å§‹ä½ çš„è¡¨æ¼”ã€‚

* * *

3\. æ’ä»¶æ‰©å±•æœºåˆ¶
----------

Extension æ‰©å±•æ˜¯æ’ä»¶ä¸ºå¤–éƒ¨æ„å»ºè„šæœ¬æä¾›çš„é…ç½®é¡¹ï¼Œç”¨äºæ”¯æŒå¤–éƒ¨è‡ªå®šä¹‰æ’ä»¶çš„å·¥ä½œæ–¹å¼ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¯¹å¤–å¼€æ”¾çš„ Java Bean æˆ– Groovy Beanã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„ `android{}` å°±æ˜¯ Android Gradle Plugin æä¾›çš„æ‰©å±•ã€‚

å½“ä½ åº”ç”¨ä¸€ä¸ªæ’ä»¶æ—¶ï¼Œæ’ä»¶å®šä¹‰çš„æ‰©å±•ä¼šä»¥ `æ‰©å±•å-æ‰©å±•å¯¹è±¡` é”®å€¼å¯¹çš„å½¢å¼ä¿å­˜åœ¨ Project ä¸­çš„ [ExtensionContainer](https://docs.gradle.org/current/javadoc/org/gradle/api/plugins/ExtensionContainer.html) å®¹å™¨ä¸­ã€‚æ’ä»¶å†…å¤–éƒ¨ä¹Ÿæ˜¯é€šè¿‡ ExtensionContainer è®¿é—®æ‰©å±•å¯¹è±¡çš„ã€‚

æ³¨æ„äº‹é¡¹ï¼š

*   **æ‰©å±•åï¼š** ä¸æ”¯æŒåœ¨åŒä¸€ä¸ª Project ä¸Šæ·»åŠ é‡å¤çš„æ‰©å±•åï¼›
*   **æ˜ å°„å…³ç³»ï¼š** æ·»åŠ æ‰©å±•åï¼Œä¸æ”¯æŒé‡æ–°è®¾ç½®æ‰©å±•å¯¹è±¡ï¼›
*   **DSLï¼š** æ”¯æŒç”¨ `æ‰©å±•å {}` DSL çš„å½¢å¼è®¿é—®æ‰©å±•å¯¹è±¡ã€‚

### 3.1 åŸºæœ¬æ­¥éª¤

è¿™ä¸€èŠ‚æˆ‘ä»¬æ¥è®²å®ç° Extension æ‰©å±•çš„å…·ä½“æ­¥éª¤ï¼ŒåŸºæœ¬æ­¥éª¤åˆ†ä¸º 5 æ­¥ï¼š

*   **1ã€å®šä¹‰æ‰©å±•ç±»ï¼š** å®šä¹‰ä¸€ä¸ªæ‰©å±•é…ç½®ç±»ï¼š

`Upload.groovy`

    class Upload {
        String name
    }
    

> **æç¤ºï¼š**Â æ ¹æ® â€çº¦å®šä¼˜å…ˆäºé…ç½®â€œ åŸåˆ™ï¼Œå°½é‡ä¸ºé…ç½®æä¾›é»˜è®¤å€¼ï¼Œæˆ–è€…ä¿è¯é…ç½®ç¼ºçœæ—¶ä¹Ÿèƒ½æ­£å¸¸æ‰§è¡Œã€‚

*   **2ã€åˆ›å»ºå¹¶æ·»åŠ æ‰©å±•å¯¹è±¡ï¼š** åœ¨ Plugin#apply() ä¸­ï¼Œå°†æ‰©å±•å¯¹è±¡æ·»åŠ åˆ° Project çš„ ExtensionContainer å®¹å™¨ä¸­ï¼š

`EasyUpload.groovy`

    class EasyUpload implements Plugin<Project> {
    
        // æ‰©å±•å
        public static final String UPLOAD_EXTENSION_NAME = "upload"
    
        @Override
        void apply(Project project) {
            // æ·»åŠ æ‰©å±•
            applyExtension(project)
            // æ·»åŠ  Maven å‘å¸ƒèƒ½åŠ›
            applyMavenFeature(project)
        }
    
        private void applyExtension(Project project) {
            // åˆ›å»ºæ‰©å±•ï¼Œå¹¶æ·»åŠ åˆ° ExtensionContainer
            project.extensions.create(UPLOAD_EXTENSION_NAME, Upload)
        }
    
        private void applyMavenFeature(Project project) {
            // æ„å»ºé€»è¾‘
        }
    }
    

*   **3ã€é…ç½®æ‰©å±•ï¼š** ä½¿ç”¨æ–¹åº”ç”¨æ’ä»¶åï¼Œä½¿ç”¨ `æ‰©å±•å {}` DSLå®šåˆ¶æ’ä»¶è¡Œä¸ºï¼š

`build.gradle`

    apply plugin: 'com.pengxr.easyupload'
    
    upload {
        name = "Peng"
    }
    

*   **4ã€ä½¿ç”¨æ‰©å±•ï¼š** åœ¨ Plugin#apply() ä¸­ï¼Œé€šè¿‡ Project çš„ ExtensionContainer å®¹å™¨è·å–æ‰©å±•å¯¹è±¡ï¼Œè·å–çš„ä»£ç å»ºè®®å°è£…åœ¨æ‰©å±•å¯¹è±¡å†…éƒ¨ã€‚ä¾‹å¦‚ï¼š

    class EasyUpload implements Plugin<Project> {
    
        // æ‰©å±•å
        public static final String UPLOAD_EXTENSION_NAME = "upload"
    
        @Override
        void apply(Project project) {
            // æ·»åŠ æ‰©å±•
            applyExtension(project)
            // æ·»åŠ  Maven å‘å¸ƒèƒ½åŠ›
            applyMavenFeature(project)
        }
    
        private void applyExtension(Project project) {
            // åˆ›å»ºæ‰©å±•ï¼Œå¹¶æ·»åŠ åˆ° ExtensionContainer å®¹å™¨
            project.extensions.create(UPLOAD_EXTENSION_NAME, Upload)
        }
    
        private void applyMavenFeature(Project project) {
            project.afterEvaluate {
                // 1. Upload extension
                Upload rootConfig = Upload.getConfig(project.rootProject)
                // æ„å»ºé€»è¾‘ ...
            }
        }
    }
    

`Upload.groovy`

    class Upload {
    
        String name
    
        // å°†è·å–æ‰©å±•å¯¹è±¡çš„ä»£ç å°è£…ä¸ºé™æ€æ–¹æ³•
        static Upload getConfig(Project project) {
            // ä» ExtensionContainer å®¹å™¨è·å–æ‰©å±•å¯¹è±¡
            Upload extension = project.getExtensions().findByType(Upload.class)
            // é…ç½®ç¼ºçœçš„æ—¶å€™ï¼Œèµ‹äºˆé»˜è®¤å€¼
            if (null == extension) {
                extension = new Upload()
            }
            return extension
        }
    
        /**
         * æ£€æŸ¥æ‰©å±•é…ç½®æ˜¯å¦æœ‰æ•ˆ
         *
         * @return trueï¼švalid
         */
        boolean checkParams() {
            return true
        }
    }
    

> **æç¤ºï¼š**Â ExtensionContainer#create() æ”¯æŒå˜é•¿å‚æ•°ï¼Œæ”¯æŒè°ƒç”¨æ‰©å±•ç±»å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œä¾‹å¦‚ï¼š`project.extensions.create(UPLOAD_EXTENSION_NAME, Upload,"Name")` å°†è°ƒç”¨æ„é€ å‡½æ•° `Upload(String str)`ã€‚

*   **5ã€æ„å»ºé€»è¾‘ï¼š** åˆ°è¿™é‡Œï¼Œå®ç°æ’ä»¶æ‰©å±•æœ€åŸºæœ¬çš„æ­¥éª¤å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥åœ¨ Plugin#apply æ–¹æ³•ä¸­ç»§ç»­å®Œæˆä½ çš„è¡¨æ¼”ã€‚

### 3.2 project.afterEvaluate çš„ä½œç”¨

ä½¿ç”¨æ’ä»¶æ‰©å±•ä¸€å®šä¼šç”¨åˆ° `project.afterEvaluate()` ç”Ÿå‘½å‘¨æœŸç›‘å¬ï¼Œè¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼šå› ä¸ºæ‰©å±•é…ç½®ä»£ç çš„æ‰§è¡Œæ—¶æœºæ™šäº Plugin#apply() çš„æ‰§è¡Œæ—¶æœºï¼Œæ‰€ä»¥å¦‚æœä¸ä½¿ç”¨ project.afterEvaluate()ï¼Œåˆ™åœ¨æ’ä»¶å†…éƒ¨å°†æ— æ³•æ­£ç¡®è·å–é…ç½®å€¼ã€‚

project.afterEvaluate() ä¼šåœ¨å½“å‰ Project é…ç½®å®Œæˆåå›è°ƒï¼Œè¿™ä¸ªæ—¶æœºæ‰©å±•é…ç½®ä»£ç å·²ç»æ‰§è¡Œï¼Œåœ¨æ’ä»¶å†…éƒ¨å°±å¯ä»¥æ­£ç¡®è·å–é…ç½®å€¼ã€‚

    apply plugin: 'com.pengxr.easyupload'
    
    // æ‰§è¡Œæ—¶æœºæ™šäº apply
    upload {
        name = "Peng"
    }
    

### 3.3 åµŒå¥—æ‰©å±•

åœ¨æ‰©å±•ç±»ä¸­ç»„åˆå¦ä¸€ä¸ªé…ç½®ç±»çš„æƒ…å†µï¼Œæˆ‘ä»¬ç§°ä¸ºåµŒå¥—æ‰©å±•ï¼Œä¾‹å¦‚æˆ‘ä»¬ç†Ÿæ‚‰çš„ `defaultConfig{}` å°±æ˜¯ä¸€ä¸ªåµŒå¥—æ‰©å±•ï¼š

    android {
        compileSdkVersion 30
        buildToolsVersion "30.0.0"
        defaultConfig {
            minSdkVersion 21
            ...
        }
        ...
    }
    

é»˜è®¤ä¸‹åµŒå¥—æ‰©å±•æ˜¯ä¸æ”¯æŒä½¿ç”¨é—­åŒ…é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¤–éƒ¨æ‰©å±•ç±»ä¸­å®šä¹‰é—­åŒ…å‡½æ•°ã€‚ä¾‹å¦‚ï¼š

`Upload.groovy`

    class Upload {
    
        // åµŒå¥—æ‰©å±•
        Maven maven
    
        // åµŒå¥—æ‰©å±•
        Pom pom
    
        // åµŒå¥—æ‰©å±•é—­åŒ…å‡½æ•°ï¼Œæ–¹æ³•åä¸º mavenï¼ˆæ–¹æ³•åä¸ä¸€å®šéœ€è¦ä¸å±æ€§åä¸€è‡´ï¼‰
        void maven(Action<Maven> action) {
            action.execute(maven)
        }
    
        // åµŒå¥—æ‰©å±•é—­åŒ…å‡½æ•°ï¼Œæ–¹æ³•åä¸º maven
        void maven(Closure closure) {
            ConfigureUtil.configure(closure, maven)
        }
    
        // åµŒå¥—æ‰©å±•é—­åŒ…å‡½æ•°ï¼Œæ–¹æ³•åä¸º pom
        void pom(Action<Pom> action) {
            action.execute(pom)
        }
    
        // åµŒå¥—æ‰©å±•é—­åŒ…å‡½æ•°ï¼Œæ–¹æ³•åä¸º pom
        void pom(Closure closure) {
            ConfigureUtil.configure(closure, pom)
        }
    }
    

ä½¿ç”¨æ—¶ï¼š

`build.gradle`

    apply plugin: 'com.pengxr.easyupload'
    
    upload {
        maven {
            ...
        }
    }
    

### 3.4 NamedDomainObjectContainer å‘½å DSL

åœ¨ Android å·¥ç¨‹ä¸­ï¼Œä½ ä¸€å®šåœ¨ build.gradle æ–‡ä»¶ä¸­è§è¿‡ä»¥ä¸‹é…ç½®ï¼š

`build.gradle`

    android {
        buildTypes {
            release {
                minifyEnabled false
                proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            }
            debug {
                ...
            }
            // æ”¯æŒä»»æ„å‘½å
            preview {
                ...
            }
        }
    }
    

é™¤äº†å†…ç½®çš„ release å’Œ debugï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ buildType ä¸­å®šä¹‰ä»»æ„å¤šä¸ªä¸”ä»»æ„åç§°çš„ç±»å‹ï¼Œè¿™ä¸ªæ˜¯å¦‚æœå®ç°çš„å‘¢ï¼Ÿâ€”â€” è¿™èƒŒåæ˜¯å› ä¸º buildTypes æ˜¯ [NamedDomainObjectContainer](https://docs.gradle.org/current/javadoc/org/gradle/api/NamedDomainObjectContainer.html) ç±»å‹ï¼Œæºç ä½“ç°ï¼š

`com.android.build.api.dsl.CommonExtension.kt`

    val buildTypes: NamedDomainObjectContainer<BuildType>
    

**NamedDomainObjectContainer çš„ä½œç”¨ï¼š**

NamedDomainObjectContainer ç›´è¯‘æ˜¯å‘½åé¢†åŸŸå¯¹è±¡å®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªæ”¯æŒé…ç½®ä¸å›ºå®šæ•°é‡é…ç½®çš„å®¹å™¨ã€‚ä¸»è¦åŠŸèƒ½åˆ†ä¸º 3 ç‚¹ï¼š

*   **Set å®¹å™¨ï¼š** æ”¯æŒæ·»åŠ å¤šä¸ª T ç±»å‹å¯¹è±¡ï¼Œå¹¶ä¸”ä¸å…è®¸å‘½åé‡å¤ï¼›
*   **å‘½å DSLï¼š** æ”¯æŒä»¥ DSL çš„æ–¹å¼é…ç½® T ç±»å‹å¯¹è±¡ï¼Œè¿™ä¹Ÿè¦æ±‚ T ç±»å‹å¿…é¡»å¸¦æœ‰ String name å±æ€§ï¼Œä¸”å¿…é¡»å¸¦æœ‰ä»¥ String name ä¸ºå‚æ•°çš„ public æ„é€ å‡½æ•°ï¼›
*   **SortSet å®¹å™¨ï¼š** å®¹å™¨å°†ä¿è¯å…ƒç´ ä»¥ name è‡ªç„¶é¡ºåºæ’åºã€‚

é‚£ä¹ˆï¼Œä»¥ä¸Šé…ç½®ç›¸å½“äºä»¥ä¸‹ä¼ªä»£ç ï¼š

`build.gradle`

    val buildTypes : Collections<BuildType>
    
    BuildType release = BuildType("release")
    release.minifyEnabled = false
    release.proguardFiles = getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
    
    BuildType debug = BuildType("debug")
    ...
    
    BuildType preview = BuildType("preview")
    ...
    
    buildTypes.add(release)
    buildTypes.add(debug)
    buildType.add(preview)
    

**NamedDomainObjectContainer çš„ç”¨æ³•ï¼š**

è¿™é‡Œä»‹ç»ä¸€ä¸‹å…·ä½“ç”¨æ³•ï¼Œæˆ‘ä»¬ä»…ä»¥ä½ ç†Ÿæ‚‰çš„ BuildType ä¸ºä¾‹ï¼Œä½†ä¸ç­‰äºä»¥ä¸‹ä¸ºæºç ã€‚

*   **1ã€å®šä¹‰ç±»å‹ Tï¼š** åœ¨ç±»å‹ T ä¸­å¿…é¡»å¸¦æœ‰ä»¥ String name ä¸ºå‚æ•°çš„ public æ„é€ å‡½æ•°ã€‚ä¾‹å¦‚ï¼š

`BuildType.groovy`

    class BuildType {
        // å¿…é¡»æœ‰ String name å±æ€§ï¼Œä¸”ä¸å…è®¸æ„é€ åä¿®æ”¹
        @Nonnull
        public final String name
    
        // ä¸šåŠ¡å‚æ•°
        boolean minifyEnabled
    
        BuildType(String name) {
            this.name = name
        }
    }
    

*   **2ã€å®šä¹‰ NamedDomainObjectContainer å±æ€§ï¼š** åœ¨æ‰©å±•ç±»ä¸­å®šä¹‰ä¸€ä¸ª NamedDomainObjectContainer ç±»å‹å±æ€§ã€‚ä¾‹å¦‚ï¼š

`CommonExtension.grooyv`

    class CommonExtension {
    
        NamedDomainObjectContainer<BuildType> buildTypes
    
        CommonExtension(Project project) {
            // é€šè¿‡ project.container(...) æ–¹æ³•åˆ›å»º NamedDomainObjectContainer
            NamedDomainObjectContainer<BuildType> buildTypeObjs = project.container(BuildType)
            buildTypes = buildTypeObjs
        }
    
        // åµŒå¥—æ‰©å±•é—­åŒ…å‡½æ•°ï¼Œæ–¹æ³•åä¸º buildTypes
        void buildTypes(Action<NamedDomainObjectContainer<BuildType>> action) {
            action.execute(buildTypes)
        }
    
        void buildTypes(Closure closure) {
            ConfigureUtil.configure(closure, buildTypes)
        }
    }
    

*   **3ã€åˆ›å»º Extensionï¼š** æŒ‰ç…§ 4.1 èŠ‚ä»‹ç»çš„æ­¥éª¤åˆ›å»ºæ‰©å±•ã€‚ä¾‹å¦‚ï¼š

    project.extensions.create("android", CommonExtension)
    

åˆ°è¿™é‡Œï¼Œå°±å¯ä»¥æŒ‰ç…§ buildTypes {} çš„æ–¹å¼é…ç½® BuildType åˆ—è¡¨äº†ã€‚ç„¶è€Œï¼Œä½ ä¼šå‘ç°æ¯ä¸ªé…ç½®é¡¹å¿…é¡»ä½¿ç”¨ `=` è¿›è¡Œèµ‹å€¼ã€‚è¿™å°±æœ‰ç‚¹è†ˆåº”äººäº†ï¼Œæœ‰æ‡‚çš„å¤§ä½¬æŒ‡å¯¼ä¸€ä¸‹ã€‚

    android {
        buildTypes {
            release {
                // æ€æ ·æ‰èƒ½çœç•¥ = å·å‘¢ï¼Ÿ
                minifyEnabled = false
                proguardFiles = getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            }
        }
    }
    

* * *

4\. æ’ä»¶è°ƒè¯•
--------

### 4.1 ä¸¤ä¸ªè°ƒè¯•æ–¹æ³•

åœ¨å¼€å‘æ’ä»¶çš„è¿‡ç¨‹ä¸€å®šéœ€è¦è°ƒè¯•ï¼Œé™¤äº†é€šè¿‡æ—¥å¿—è°ƒè¯•ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰æ–­ç‚¹è°ƒè¯•çš„éœ€æ±‚ã€‚è¿™é‡Œæ€»ç»“ä¸¤ä¸ªæ–¹æ³•ï¼šæ–¹æ³• 1 è™½ç„¶åªæ”¯æŒè°ƒè¯•ç®€å•æ‰§è¡Œä»»åŠ¡ï¼Œä½†å·²ç»èƒ½æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œè€Œä¸”ç›¸å¯¹ç®€å•ã€‚è€Œæ–¹æ³• 2 æ”¯æŒå‘½ä»¤è¡Œæ·»åŠ å‚æ•°ã€‚

**æ–¹æ³• 1(ç®€å•)ï¼š** ç›´æ¥æä¾› Android Studio ä¸­ Gradle é¢æ¿çš„è°ƒè¯•åŠŸèƒ½ï¼Œå³å¯è°ƒè¯•æ’ä»¶ã€‚å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸æ’ä»¶åŠŸèƒ½ç›¸å…³çš„ Taskï¼Œå¹¶å³é”®é€‰æ‹© Debug æ‰§è¡Œã€‚

![](https://img2022.cnblogs.com/blog/2839502/202205/2839502-20220517165940271-5690400.png)

**æ–¹æ³• 2ï¼š** é€šè¿‡é…ç½® IDE Configuration ä»¥æ”¯æŒè°ƒè¯•å‘½ä»¤è¡Œä»»åŠ¡ï¼Œå…·ä½“æ­¥éª¤ï¼š

*   **1ã€åˆ›å»º Remote ç±»å‹ Configurationï¼š**

![](https://img2022.cnblogs.com/blog/2839502/202205/2839502-20220517165947665-685569141.png)

*   **2ã€æ‰§è¡Œå‘½ä»¤ï¼š** `./gradlew Task -Dorg.gradle.debug=true --no-daemon` ï¼ˆå¼€å¯ Debug & ä¸ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œæ‰§è¡Œåå‘½ä»¤è¡Œä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼š

![](https://img2022.cnblogs.com/blog/2839502/202205/2839502-20220517165955091-1934217632.png)

*   **3ã€Attach Debugï¼š** ç‚¹å‡»è°ƒè¯•æŒ‰é’®ï¼Œå³å¯å¼€å§‹æ–­ç‚¹è°ƒè¯•ã€‚

![](https://img2022.cnblogs.com/blog/2839502/202205/2839502-20220517165959242-572645336.png)

### 4.2 è°ƒè¯•æŠ€å·§

ä¸€äº›è°ƒè¯•æŠ€å·§ï¼š

*   **å¼•ç”¨æ’ä»¶æºç ï¼š** åœ¨å¼€å‘é˜¶æ®µå¯ä»¥ç›´æ¥æœ¬åœ°ä¾èµ–æ’ä»¶æºç ï¼Œè€Œä¸éœ€è¦å°†æ’ä»¶å‘å¸ƒåˆ° Maven ä»“åº“ï¼Œåªéœ€è¦åœ¨ build.gradle æ–‡ä»¶ä¸­ä¿®æ”¹é…ç½®ï¼š

`é¡¹ç›® build.gradle`

    buildscript {
        repositories {
            google()
            jcenter()
        }
        dependencies {
            // For Debug
            classpath project(":easyupload")
            // classpath "com.pengxr:easyupload:1.0.0"
        }
        ...
    }
    

*   **æ’ä»¶ä»£ç å¼€å…³ï¼š** ç”±äº Plugin#apply ä¸­çš„ä»£ç åœ¨é…ç½®é˜¶æ®µæ‰§è¡Œï¼Œå¦‚æœå…¶ä¸­çš„ä»£ç æœ‰é—®é¢˜å°±ä¼šå‡ºç° Sync æŠ¥é”™ã€‚åˆå› ä¸ºç¼–è¯‘æ’ä»¶ä»£ç éœ€è¦å…ˆ Syncï¼Œåªèƒ½å…ˆå°†å·¥ç¨‹ä¸­æ‰€æœ‰ä½¿ç”¨æ’ä»¶çš„ä»£ç æ³¨é‡Šæ‰ï¼Œé‡æ–°ç¼–è¯‘æ’ä»¶æ¨¡å—ï¼Œå†å°†æ³¨é‡Šä¿®æ”¹å›æ¥ã€‚çœŸéº»çƒ¦ï¼æˆ‘ä»¬è¿˜æ˜¯åŠ ä¸€ä¸ªå¼€å…³å§ï¼Œä¾‹å¦‚ï¼š

`gradle.properties`

    ENABLED=true
    

`æ¨¡å— build.gradle`

    if (ENABLED.toBoolean()) {
        apply plugin: 'com.pengxr.easyupload'
        upload {
            name = "123"
        }
    }
    

* * *

5\. æ’ä»¶å¼€å‘æŠ€å·§æ€»ç»“
------------

*   **åˆ¤æ–­æ˜¯å¦å½“å‰æ˜¯ App æ¨¡å—è¿˜æ˜¯ Library æ¨¡å—ï¼š** å½“æˆ‘ä»¬å¼€å‘ Android é¡¹ç›®ç›¸å…³æ’ä»¶æ—¶ï¼Œç»å¸¸éœ€è¦æ ¹æ®æ’ä»¶çš„ä½¿ç”¨ç¯å¢ƒåŒºåˆ†ä¸åŒé€»è¾‘ã€‚ä¾‹å¦‚æ’ä»¶åº”ç”¨åœ¨ App æ¨¡å—å’Œ Library æ¨¡å—ä¼šé‡‡ç”¨ä¸åŒé€»è¾‘ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åœ¨ Plugin#apply() ä¸­é‡‡ç”¨ä»¥ä¸‹åˆ¤æ–­ï¼š

    project.afterEvaluate {
        // 1. Check if apply the â€˜com.android.applicationâ€™ plugin
        if (!project.getPluginManager().hasPlugin("com.android.application")) {
            return
        }
    }
    

*   **æ’ä»¶å¼€å‘è¯­è¨€ï¼š** æœ€åˆï¼ŒGroovy æ˜¯ Gradle çš„é¦–è¦è¯­è¨€ï¼Œä½†éšç€ Java å’Œ Kotlin è¯­è¨€çš„æ¼”è¿›ï¼Œè¿™ä¸€ç°çŠ¶æœ‰æ‰€æ”¹å˜ã€‚ç°åœ¨çš„è¶‹åŠ¿æ˜¯ï¼šGradle è„šæœ¬ä½¿ç”¨ Groovy æˆ– Kotlin å¼€å‘ï¼Œè€Œ Gradle æ’ä»¶ä½¿ç”¨ Kotlin å¼€å‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç° AGP ç°åœ¨å·²ç»ç”¨ Kotlin å¼€å‘äº†ã€‚è™½ç„¶è¶‹åŠ¿æ˜¯å¾€ Kotlin é ï¼Œä½†ç›®å‰å­˜é‡çš„ Gradle è„šæœ¬ / æ’ä»¶è¿˜æ˜¯ä»¥ Groovy ä¸ºä¸»ã€‚
    *   Groovy ä¼˜åŠ¿ï¼šç¤¾åŒºæ²‰æ·€ã€åŠ¨æ€è¯­è¨€
    *   Kotlin ä¼˜åŠ¿ï¼šIDE æ”¯æŒã€è¶‹åŠ¿

> **åŸæ–‡ï¼š**Â In general, a plugin implemented using Java or Kotlin, which are statically typed, will perform better than the same plugin implemented using Groovy.

* * *

6\. æ€»ç»“
------

åˆ°è¿™é‡Œï¼ŒGradle æ’ä»¶çš„éƒ¨åˆ†å°±è®²å®Œäº†ï¼Œéœ€è¦ Demo çš„åŒå­¦å¯ä»¥çœ‹ä¸‹æˆ‘ä»¬ä¹‹å‰å®ç°è¿‡çš„å°æ’ä»¶ï¼š [EasyPrivacy](https://juejin.cn/post/7034201332500135966)ã€‚åœ¨æœ¬ç³»åˆ—åç»­çš„æ–‡ç« ä¸­ï¼Œä¹Ÿä¼šæœ‰æ–°çš„æ’ä»¶ Demoã€‚å…³æ³¨æˆ‘ï¼Œå¸¦ä½ äº†è§£æ›´å¤šï¼Œæˆ‘ä»¬ä¸‹æ¬¡è§ã€‚

### å‚è€ƒèµ„æ–™

*   ã€Šå®æˆ˜ Gradleã€‹â€”â€” \[ç¾\] Benjamin Muschko è‘—ï¼Œæå»º æœ±æœ¬å¨ æ¨æŸ³ è¯‘
*   ã€ŠGradle for Androidã€‹â€”â€” \[ç¾\] Kevin Pelgrims è‘—ï¼Œä½™å°ä¹ è¯‘
*   [Groovy å‚è€ƒæ–‡æ¡£](http://groovy-lang.org/documentation.html) â€”â€” Groovy å®˜æ–¹æ–‡æ¡£
*   [Gradle è¯´æ˜æ–‡æ¡£](https://docs.gradle.org/current/userguide/build_lifecycle.html) â€”â€” Gradle å®˜æ–¹æ–‡æ¡£
*   [Gradle DSL å‚è€ƒæ–‡æ¡£](https://docs.gradle.org/current/dsl/index.html) â€”â€” Gradle å®˜æ–¹æ–‡æ¡£
*   [Developing Custom Gradle Plugins](https://docs.gradle.org/current/userguide/custom_plugins.html) â€”â€” Gradle å®˜æ–¹æ–‡æ¡£
*   [Using Gradle Plugins](https://docs.gradle.org/6.0.1/userguide/plugins.html#sec:plugin_management) â€”â€” Gradle å®˜æ–¹æ–‡æ¡£
*   [æ·±å…¥æ¢ç´¢ Gradle è‡ªåŠ¨åŒ–æ„å»ºæŠ€æœ¯ï¼ˆç³»åˆ—ï¼‰](https://juejin.cn/post/6844904122492125198) â€”â€” jsonchao è‘—