---
layout: post
title: "Blazor Hybrid ï¼ˆBlazoræ··åˆå¼€å‘ï¼‰æ›´å¥½çš„è¯»å–æœ¬åœ°å›¾ç‰‡"
date: "2023-01-29T15:15:20.012Z"
---
Blazor Hybrid ï¼ˆBlazoræ··åˆå¼€å‘ï¼‰æ›´å¥½çš„è¯»å–æœ¬åœ°å›¾ç‰‡
===================================

åœ¨ Blazor Hybrid åº”ç”¨ä¸­ï¼Œ[Razor ç»„ä»¶](https://learn.microsoft.com/zh-cn/aspnet/core/blazor/components/?view=aspnetcore-7.0)åœ¨è®¾å¤‡ä¸Šæœ¬æœºè¿è¡Œã€‚ ç»„ä»¶é€šè¿‡æœ¬åœ°äº’æ“ä½œé€šé“å‘ˆç°åˆ°åµŒå…¥å¼ Web View æ§ä»¶ã€‚ ç»„ä»¶ä¸åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œå¹¶ä¸”ä¸æ¶‰åŠ WebAssemblyã€‚ Razor ç»„ä»¶å¯å¿«é€ŸåŠ è½½å’Œæ‰§è¡Œä»£ç ï¼Œç»„ä»¶å¯é€šè¿‡ .NET å¹³å°å®Œå…¨è®¿é—®è®¾å¤‡çš„æœ¬æœºåŠŸèƒ½ã€‚ Web View ä¸­å‘ˆç°çš„ç»„ä»¶æ ·å¼ä¸å¹³å°ç›¸å…³ï¼Œå¯èƒ½éœ€è¦ä½ ä½¿ç”¨è‡ªå®šä¹‰æ ·å¼è¡¨æ¥è¯´æ˜ä¸åŒå¹³å°ä¹‹é—´çš„å‘ˆç°å·®å¼‚ã€‚

å¦‚ä½•åœ¨Blazor Hybridä¸­è¯»å–æœ¬åœ°å›¾ç‰‡å±•ç¤ºï¼Ÿ
--------------------------

åœ¨Blazor Hybridç»å¸¸é‡åˆ°ä¸€äº›è¯»å–é€‰ä¸­çš„å›¾ç‰‡å¹¶ä¸”æ¸²æŸ“ï¼Œä½†æ˜¯æ–‡ä»¶çš„ç›®å½•åœ¨Blazorä¸­ç›´æ¥srcå¡«å†™æ˜¯æ— æ³•è¯»å–åˆ°çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯èƒ½éœ€è¦å°†æ–‡ä»¶Copyåˆ°wwwrootä¸­ï¼Œæˆ–è€…å°†å…¶è½¬æ¢Base64æ”¾å…¥åˆ°htmlä¸­ï¼Œä½†æ˜¯base64è½¬æ¢å›¾ç‰‡æ˜¯å¾ˆé•¿çš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´æ¸²æŸ“å¯èƒ½å¡æ‰½ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨jsæä¾›çš„åŠŸèƒ½å»å®ç°ï¼Œå…¶å®åœ¨Blazor Hybridä¸ºäº†å…¼å®¹ï¼Œå¯ä»¥é‡‡ç”¨jsæä¾›çš„éƒ¨åˆ†åŠŸèƒ½å®ç°ï¼Œæ•ˆæœæ›´å¥½ï¼Œ

åˆ›å»ºä¸€ä¸ª`Winform`é¡¹ç›®
---------------

ç¤ºå›¾ï¼š

![](https://img2023.cnblogs.com/blog/2415052/202301/2415052-20230129163225347-1218645027.png)

æ·»åŠ  `Microsoft.AspNetCore.Components.WebView.WindowsForms`NuGetåŒ…

    dotnet add package Microsoft.AspNetCore.Components.WebView.WindowsForms
    

ä¿®æ”¹é¡¹ç›®æ–‡ä»¶çš„å±æ€§

æ‰“å¼€`BlazorHybrid.csproj`é¡¹ç›®æ–‡ä»¶ï¼Œå°†`Microsoft.NET.Sdk` ä¿®æ”¹æˆ`Microsoft.NET.Sdk.Razor`

    <Project Sdk="Microsoft.NET.Sdk.Razor">
    

åˆ›å»º `_Imports.razor`æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç 

    @using Microsoft.AspNetCore.Components.Web
    @using Microsoft.AspNetCore.Components.Routing
    

åˆ›å»º`wwwroot`æ–‡ä»¶å¤¹

åˆ›å»º`wwwroot/index.html`æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç 

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>WinFormsBlazor</title>
        <base href="/" />
        <link href="css/app.css" rel="stylesheet" />
        <link href="WinFormsBlazor.styles.css" rel="stylesheet" />
    </head>
    
    <body>
    
        <div id="app">åŠ è½½ä¸­...</div>
    
        <div id="blazor-error-ui">
            An unhandled error has occurred.
            <a href="" class="reload">Reload</a>
            <a class="dismiss">ğŸ—™</a>
        </div>
        <!--å¼•ç”¨blazor.webview.js Serverå’Œweb assemblyï¼Œhybridçš„jséƒ½ä¸ä¸€æ ·-->
        <script src="_framework/blazor.webview.js"></script>
    
    </body>
    
    </html>
    

åˆ›å»º`wwwroot/css/app.css`æ·»åŠ ä»¥ä¸‹ä»£ç 

    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }
    
    h1:focus {
        outline: none;
    }
    
    a, .btn-link {
        color: #0071c1;
    }
    
    .btn-primary {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }
    
    .valid.modified:not([type=checkbox]) {
        outline: 1px solid #26b050;
    }
    
    .invalid {
        outline: 1px solid red;
    }
    
    .validation-message {
        color: red;
    }
    
    #blazor-error-ui {
        background: lightyellow;
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
    }
    
        #blazor-error-ui .dismiss {
            cursor: pointer;
            position: absolute;
            right: 0.75rem;
            top: 0.5rem;
        }
    

åˆ›å»º`Shared/App.razor`æ·»åŠ ä»¥ä¸‹ä»£ç 

    <Router AppAssembly="@typeof(MainLayout).Assembly">
        <Found Context="routeData">
            <RouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)" />
            <FocusOnNavigate RouteData="@routeData" Selector="h1" />
        </Found>
        <NotFound>
            <PageTitle>Not found</PageTitle>
            <LayoutView Layout="@typeof(MainLayout)">
                <p role="alert">Sorry, there's nothing at this address.</p>
            </LayoutView>
        </NotFound>
    </Router>
    

åˆ›å»º`Shared/MainLayout.razor`æ·»åŠ ä»¥ä¸‹ä»£ç 

    @inherits LayoutComponentBase
    <div>
    	@Body
    </div>
    

é€‰æ‹©`Form1.cs`æ‰“å¼€è®¾è®¡çª—å£ï¼Œå°†`BlazorWebView`æ‹–åˆ°Form1ä¸­ï¼Œå¹¶ä¸”å°†`BlazorWebView`çš„å±æ€§ä¸­çš„`Dock`ä¿®æ”¹æˆ`Fill`

![](https://img2023.cnblogs.com/blog/2415052/202301/2415052-20230129163211829-1557253236.png)

å°†ä»¥ä¸‹å‘½åç©ºé—´æ·»åŠ åˆ°Form1.csæ–‡ä»¶çš„é¡¶éƒ¨

    using Microsoft.AspNetCore.Components.WebView.WindowsForms;
    using Microsoft.Extensions.DependencyInjection;
    

åœ¨ `Form1` æ„é€ å‡½æ•°ä¸­çš„ `InitializeComponent` æ–¹æ³•è°ƒç”¨åé¢ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

    var services = new ServiceCollection();
    services.AddWindowsFormsBlazorWebView();
    blazorWebView1.HostPage = "wwwroot\\index.html";
    blazorWebView1.Services = services.BuildServiceProvider();
    blazorWebView1.RootComponents.Add<App>("#app");
    

æ•ˆæœå¦‚å›¾  
![](https://img2023.cnblogs.com/blog/2415052/202301/2415052-20230129163204482-1139565921.png)

ä¿®æ”¹`wwwroot/index.html`ä»£ç ã€‚æ·»åŠ jsæ–¹æ³•,å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°`body`é‡Œé¢

        <script>
            /** å°†byteè½¬urlå¯¹è±¡ */
            function byteToUrl(blob) {
                // é€‚é…webviewå’Œweb 
                var myBlob = new Blob([blob], { type: "image/png" });
                return (window.URL || window.webkitURL || window || {}).createObjectURL(myBlob);
                   }
            /**
            * é‡Šæ”¾urlå¯¹è±¡ï¼Œå› ä¸ºcreateObjectURLåˆ›å»ºçš„å¯¹è±¡ä¸€ç›´ä¼šå­˜åœ¨å¯èƒ½ä¼šå ç”¨è¿‡å¤šçš„å†…å­˜ï¼Œè¯·æ³¨æ„é‡Šæ”¾
            */
            function revokeUrl(url) {
                (window.URL || window.webkitURL || window || {}).revokeObjectURL(url);
            }
        </script>
    

åˆ›å»º`Pages/Index.razor`æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç 

    @using Microsoft.JSInterop;
    @inject IJSRuntime JSRuntime
    
    @page "/"
    
    @if (!string.IsNullOrEmpty(Img)){
        <img src="@Img" />
    }
    
    <input @bind="ImgPath" />
    
    <button @onclick="OnLoad">åŠ è½½å›¾ç‰‡</button>
    
    <button @onclick="Revoke">é‡Šæ”¾å›¾ç‰‡</button>
    @code {
        public string? ImgPath { get; set; }
    
        private string? Img;
    
        private async Task OnLoad()
        {
            // åŠ è½½ç›®å½•ä¸­çš„å›¾ç‰‡è·å–åˆ°byte é€šè¿‡byteToUrlè½¬æ¢URLå¯¹è±¡ å¯ä»¥ç›´æ¥é€šè¿‡urlè·å–åˆ°å›¾ç‰‡ å®ƒå­˜åœ¨ä¸æœ¬åœ°
            var file = await File.ReadAllBytesAsync(ImgPath);
            Img = await JSRuntime.InvokeAsync<string>("byteToUrl", file);
        }
    
        private async Task Revoke()
        {
            if (!string.IsNullOrEmpty(Img)){
                await JSRuntime.InvokeVoidAsync("revokeUrl", Img);
                Img = string.Empty;
            }
        }
    }
    
    <style>
        button {
            background-color: cornflowerblue;
            height: 30px;
            font-size: 15px;
            width: auto;
        }
        img{
            height:auto;
            width:auto;
        }
    
    </style>
    

æœ€ç»ˆæ•ˆæœï¼š

![](https://img2023.cnblogs.com/blog/2415052/202301/2415052-20230129163146109-218215876.gif)

ç»“å°¾
--

æˆ‘ä»¬å¯ä»¥é€šè¿‡`createObjectURL`åŠ è½½æœ¬åœ°æ–‡ä»¶æˆ–è€…å›¾ç‰‡ï¼Œå¹¶ä¸”æ¸²æŸ“ï¼Œè¿™æ ·å¯¹æ¯”copyåˆ°`wwwroot`æˆ–è€…è½¬æ¢`base64`çš„æ•ˆæœæ›´å¥½ï¼Œè€Œä¸”æ›´å®¹æ˜“ç®¡ç†,å®ç°ä¹Ÿè¶…çº§å®¹æ˜“ï¼Œç”¨äºè·¨å¹³å°å®ç°ä¹Ÿç®—æ˜¯æœ€ä½³å®ç°äº†ï¼Œ

`Blazor`æŠ€æœ¯äº¤æµï¼š452761192

æ¥è‡ªtokençš„åˆ†äº«