---
layout: post
title: "Semantic Kernel å…¥é—¨ç³»åˆ—ï¼šğŸ’¾Native Function"
date: "2023-04-12T01:05:24.355Z"
---
Semantic Kernel å…¥é—¨ç³»åˆ—ï¼šğŸ’¾Native Function
======================================

è¯­ä¹‰çš„å½’è¯­ä¹‰ï¼Œè¯­æ³•çš„å½’è¯­æ³•ã€‚

![image](https://img2023.cnblogs.com/blog/758442/202304/758442-20230411212600342-1333305744.png)  
è¯­ä¹‰çš„å½’è¯­ä¹‰ï¼Œè¯­æ³•çš„å½’è¯­æ³•ã€‚

åŸºç¡€å®šä¹‰
----

æœ€åŸºæœ¬çš„Native Functionå®šä¹‰åªéœ€è¦åœ¨æ–¹æ³•ä¸Šæ·»åŠ  `SKFunction` çš„ç‰¹æ€§å³å¯ã€‚

    using Microsoft.SemanticKernel.SkillDefinition;
    using Microsoft.SemanticKernel.Orchestration;
    
    namespace MySkillsDirectory;
    
    public class MyCSharpSkill
    {
        [SKFunction("Return the first row of a qwerty keyboard")]
        public string Qwerty(string input)
        {
            return "qwertyuiop";
        }
    
        [SKFunction("Return a string that's duplicated")]
        public string DupDup(string text)
        {
            return text + text;
        }
    }
    

é»˜è®¤æƒ…å†µä¸‹åªéœ€è¦ä¼ é€’ä¸€ä¸ªstring å‚æ•°å°±è¡Œï¼Œå¦‚æœéœ€è¦å¤šä¸ªå‚æ•°çš„è¯ï¼Œå’ŒSemantic Functionä¸€æ ·ï¼Œä¹Ÿæ˜¯ä½¿ç”¨Contextï¼Œä¸è¿‡è¿™é‡Œä¼ è¿›å»æ˜¯ `SKContext`ã€‚åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ `SKFunctionContextParameter`å£°æ˜ä¸€ä¸‹å‚æ•°ï¼Œå¯ä»¥æä¾›ä¸€å®šçš„è¯´æ˜ï¼ŒåŒæ—¶çš„æœ‰éœ€è¦çš„è¯ï¼Œå¯ä»¥è®¾ç½®å‚æ•°çš„é»˜è®¤å€¼ã€‚

    using Microsoft.SemanticKernel.SkillDefinition;
    using Microsoft.SemanticKernel.Orchestration;
    
    namespace MySkillsDirectory;
    
    public class MyCSharpSkill
    {
        [SKFunction("Return a string that's duplicated")]
        public string DupDup(string text)
        {
            return text + text;
        }
    
        [SKFunction("Joins a first and last name together")]
        [SKFunctionContextParameter(Name = "firstname", Description = "Informal name you use")]
        [SKFunctionContextParameter(Name = "lastname", Description = "More formal name you use")]
        public string FullNamer(SKContext context)
        {
            return context["firstname"] + " " + context["lastname"];
        }
    }
    

è°ƒç”¨çš„æ—¶å€™ï¼Œä¸€æ ·ä½¿ç”¨ `ContextVariables`.

    using Microsoft.SemanticKernel;
    using Microsoft.SemanticKernel.Orchestration;
    
    using MySkillsDirectory;
    
    // ... instantiate a kernel as myKernel
    
    var myContext = new ContextVariables(); 
    myContext.Set("firstname","Sam");
    myContext.Set("lastname","Appdev");
    
    var myCshSkill = myKernel.ImportSkill ( new MyCSharpSkill(), "MyCSharpSkill");
    var myOutput = await myKernel.RunAsync(myContext,myCshSkill["FullNamer"]);
    
    Console.WriteLine(myOutput);
    

å½“ç„¶å¼‚æ­¥çš„æ–¹æ³•ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å¤„ç†ä¸€äº›åƒæ˜¯ç½‘ç»œè¯·æ±‚ï¼Œæ•°æ®åº“è®¿é—®ã€æ–‡ä»¶è¯»å†™ç­‰æ“ä½œäº†ã€‚

    using Microsoft.SemanticKernel.SkillDefinition;
    using Microsoft.SemanticKernel.Orchestration;
    
    public class MyCSharpSkill
    {
        [SKFunction("Return the first row of a qwerty keyboard")]
        public string Qwerty(string input)
        {
            return "qwertyuiop";
        }
    
        [SKFunction("Return the second row of a qwerty keyboard")]
        [SKFunctionName("Asdfg")]
        public async Task<string> AsdfgAsync(string input)
        {
            await ...do something asynchronous...
    
            return "asdfghjkl";
        }
    

è¿™é‡Œé’ˆå¯¹ `AsdfgAsync` æ·»åŠ äº†ä¸€ä¸ª `SKFunctionName` çš„ç‰¹æ€§ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä½¿Function name å¥½çœ‹ä¸€äº›ï¼Œé¿å… `MyCSharpSkill.AsdfgAsync` è¿™æ ·ã€‚

æ··åˆè°ƒç”¨
----

å’Œ Semantic Functionä¸­èƒ½å¤Ÿè°ƒç”¨ Native Functionä¸€æ ·ï¼Œåœ¨ Native Functionä¹Ÿå¯ä»¥è°ƒç”¨Semantic Functionï¼Œå…¶ä¸­ä¸»è¦ä½¿ç”¨çš„è¿˜æ˜¯ `SKContext`.

    using Microsoft.SemanticKernel.SkillDefinition;
    using Microsoft.SemanticKernel.Orchestration;
    
    namespace MySkillsDirectory;
    
    public class MyCSharpSkill
    {
        [SKFunction("Tell me a joke in one line of text")]
        [SKFunctionName("TellAJokeInOneLine")]
        public async Task<string> TellAJokeInOneLineAsync(SKContext context)
        {
            // Fetch a semantic function previously loaded into the kernel
            ISKFunction joker1 = context.Func("funSkill", "joker");
    
            // OR Fetch a semantic function previously loaded into the kernel
            ISKFunction joker2 = context.Skills.GetSemanticFunction("funSkill", "joker");
    
            var joke = await joker1.InvokeAsync();
    
            return joke.Result.ReplaceLineEndings(" ");
        }
    }
    

è¿™é‡Œå¹¶æ²¡æœ‰é™åˆ¶æ˜¯ Semantic Function è¿˜æ˜¯Native Functionï¼Œæ‰€ä»¥ç”šè‡³å¯ä»¥å®Œå…¨ä½¿ç”¨Native Functionç¼–æ’æŠ€èƒ½è°ƒç”¨ï¼Œé™¤äº†å‚æ•°çš„å®šä¹‰å’Œæå–æœ‰äº›è´¹åŠ²ä»¥å¤–ï¼Œå…¶ä»–çš„å‡ ä¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæ¯•ç«Ÿè¿”å›å€¼éƒ½æ˜¯stringï¼Œè¿™ä¹Ÿå°±è´¯å½»äº†**Text is the universal wire protocolï¼Œ**å³ä¾¿æ˜¯ä»£ç ä¹Ÿå¾—å°†å°±ä¸€ä¸‹ã€‚

ä¸€äº›æ ¸å¿ƒæŠ€èƒ½
------

Semantic Kernel ä¸­å¤§éƒ¨åˆ†çš„èƒ½åŠ›éƒ½æ˜¯æœ‰æŠ€èƒ½æä¾›çš„ï¼Œä¾‹å¦‚Semantic Kernelçš„ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶Plannerï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªSemantic Skillï¼Œå¦å¤–å®˜æ–¹æä¾›äº†ä¸€äº›Core SKillï¼ŒåŸºæœ¬æ˜¯æ—¥å¸¸æ¯”è¾ƒå¸¸ç”¨çš„ã€‚å…·ä½“å¯ä»¥å‚è€ƒ[https://github.com/microsoft/semantic-kernel/tree/main/dotnet/src/SemanticKernel/CoreSkills](https://github.com/microsoft/semantic-kernel/tree/main/dotnet/src/SemanticKernel/CoreSkills)

![image](https://img2023.cnblogs.com/blog/758442/202304/758442-20230411212640073-468581011.png)

å’Œè‡ªè¡Œå®šä¹‰çš„Native Functionä¸€æ ·çš„ï¼Œåªéœ€è¦ä½¿ç”¨ImportSkillå°±è¡Œäº†

    using Microsoft.SemanticKernel.CoreSkills;
    
    // ( You want to instantiate a kernel and configure it first )
    
    myKernel.ImportSkill(new TimeSkill(), "time");
    
    const string ThePromptTemplate = @"
    Today is: {{time.Date}}
    Current time is: {{time.Time}}
    
    Answer to the following questions using JSON syntax, including the data used.
    Is it morning, afternoon, evening, or night (morning/afternoon/evening/night)?
    Is it weekend time (weekend/not weekend)?";
    
    var myKindOfDay = myKernel.CreateSemanticFunction(ThePromptTemplate, maxTokens: 150);
    
    var myOutput = await myKindOfDay.InvokeAsync();
    Console.WriteLine(myOutput);
    

è‡³æ­¤ï¼ŒSemantic Kernel çš„åŸºç¡€èƒ½åŠ›å°±å­¦ä¹ å¾—å·®ä¸å¤šäº†ã€‚

* * *

å‚è€ƒèµ„æ–™ï¼š

1.  [https://learn.microsoft.com/en-us/semantic-kernel/howto/nativefunctions](https://learn.microsoft.com/en-us/semantic-kernel/howto/nativefunctions)
2.  [https://learn.microsoft.com/en-us/semantic-kernel/howto/coreskills](https://learn.microsoft.com/en-us/semantic-kernel/howto/coreskills)
3.  [https://github.com/microsoft/semantic-kernel/tree/main/dotnet/src/SemanticKernel/CoreSkills](https://github.com/microsoft/semantic-kernel/tree/main/dotnet/src/SemanticKernel/CoreSkills)