---
layout: post
title: "å›¾è§£æ¥å•¦ï¼æœºå™¨å­¦ä¹ å·¥ä¸šéƒ¨ç½²æœ€ä½³å®è·µï¼10åˆ†é’Ÿä¸Šæ‰‹æœºå™¨å­¦ä¹ éƒ¨ç½²ä¸å¤§è§„æ¨¡æ‰©å±• â›µ"
date: "2022-11-30T21:16:00.349Z"
---
å›¾è§£æ¥å•¦ï¼æœºå™¨å­¦ä¹ å·¥ä¸šéƒ¨ç½²æœ€ä½³å®è·µï¼10åˆ†é’Ÿä¸Šæ‰‹æœºå™¨å­¦ä¹ éƒ¨ç½²ä¸å¤§è§„æ¨¡æ‰©å±• â›µ
======================================

![å›¾è§£æ¥å•¦ï¼æœºå™¨å­¦ä¹ å·¥ä¸šéƒ¨ç½²æœ€ä½³å®è·µï¼10åˆ†é’Ÿä¸Šæ‰‹æœºå™¨å­¦ä¹ éƒ¨ç½²ä¸å¤§è§„æ¨¡æ‰©å±• â›µ](https://img2023.cnblogs.com/blog/2637458/202211/2637458-20221130133704700-1309738330.png) å¦‚ä½•å¿«é€Ÿéƒ¨ç½²æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Ÿæœ¬æ–‡æ˜¯æœºå™¨å­¦ä¹ å·¥ä¸šéƒ¨ç½²çš„ best practiceï¼ˆæœ€ä½³å®è·µ)ï¼è¯¦ç»†è®²è§£äº†å¦‚ä½•æ“ä½œæœºå™¨å­¦ä¹ å¼€æºæ¡†æ¶ BentoMLï¼Œå¸®åŠ©ç ”å‘å›¢é˜Ÿè½»æ¾æ‰“åŒ…æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œå¹¶é‡ç°è¯¥æ¨¡å‹ä»¥ç”¨äºç”Ÿäº§ã€‚

![](https://img-blog.csdnimg.cn/img_convert/23949a4cd5c5fc85fd2daf10d2427464.png)

> ğŸ’¡ ä½œè€…ï¼š[éŸ©ä¿¡å­](https://github.com/HanXinzi-AI)@[ShowMeAI](https://www.showmeai.tech/)  
> ğŸ“˜ [æœºå™¨å­¦ä¹ å®æˆ˜ç³»åˆ—](https://www.showmeai.tech/tutorials/41)ï¼š[https://www.showmeai.tech/tutorials/41](https://www.showmeai.tech/tutorials/41)  
> ğŸ“˜ [æ·±åº¦å­¦ä¹ å®æˆ˜ç³»åˆ—](https://www.showmeai.tech/tutorials/42)ï¼š[https://www.showmeai.tech/tutorials/42](https://www.showmeai.tech/tutorials/42)  
> ğŸ“˜ [æœ¬æ–‡åœ°å€](https://www.showmeai.tech/article-detail/396)ï¼š[https://www.showmeai.tech/article-detail/396](https://www.showmeai.tech/article-detail/396)  
> ğŸ“¢ å£°æ˜ï¼šç‰ˆæƒæ‰€æœ‰ï¼Œè½¬è½½è¯·è”ç³»å¹³å°ä¸ä½œè€…å¹¶æ³¨æ˜å‡ºå¤„  
> ğŸ“¢ æ”¶è—[ShowMeAI](https://www.showmeai.tech/)æŸ¥çœ‹æ›´å¤šç²¾å½©å†…å®¹

![](https://img-blog.csdnimg.cn/img_convert/64e3ef9ba11f501d7184eb78e3ead129.png)

ğŸ“˜[**BentoML**](https://www.bentoml.com/) **æ˜¯ä¸€ä¸ªç”¨äºæœºå™¨å­¦ä¹ æ¨¡å‹æœåŠ¡çš„å¼€æºæ¡†æ¶ï¼Œè®¾è®¡åˆè¡·æ˜¯è®©æ•°æ®ç§‘å­¦å’Œ DevOpsï¼ˆsoftware development and IT operationsï¼‰ä¹‹é—´çš„è¡”æ¥æ›´é¡ºç•…**ã€‚æ•°æ®ç§‘å­¦å®¶æ›´å¤šçš„æ—¶å€™èšç„¦åœ¨æ¨¡å‹çš„æ•ˆæœä¼˜åŒ–ä¸Šï¼Œè€Œå¯¹äºæ¨¡å‹éƒ¨ç½²å’Œç®¡ç†ç­‰å¼€å‘å·¥ä½œæ¶‰åŠä¸å¤šã€‚å€ŸåŠ© BentoMl å¯ä»¥è½»æ¾æ‰“åŒ…ä½¿ç”¨ä»»ä½• ML æ¡†æ¶è®­ç»ƒçš„æ¨¡å‹ï¼Œå¹¶é‡ç°è¯¥æ¨¡å‹ä»¥ç”¨äºç”Ÿäº§ã€‚

![](https://img-blog.csdnimg.cn/img_convert/70cde912aeb6e81f780ecee2c0b554d8.png)

BentoMLæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š

*   å°† ML æ¨¡å‹è½¬æ¢ä¸ºç”Ÿäº§å°±ç»ªçš„ API éå¸¸ç®€å•
*   é«˜æ€§èƒ½æ¨¡å‹æœåŠ¡ï¼Œå¹¶ä¸”å…¨éƒ¨ä½¿ç”¨ Python
*   æ ‡å‡†åŒ–æ¨¡å‹æ‰“åŒ…å’Œ ML æœåŠ¡å®šä¹‰ä»¥ç®€åŒ–éƒ¨ç½²
*   æ”¯æŒæ‰€æœ‰ä¸»æµçš„æœºå™¨å­¦ä¹ è®­ç»ƒæ¡†æ¶
*   é€šè¿‡ Yatai åœ¨ Kubernetes ä¸Šå¤§è§„æ¨¡éƒ¨ç½²å’Œè¿è¡Œ ML æœåŠ¡

åœ¨æœ¬ç¯‡å†…å®¹ä¸­ï¼Œ[ShowMeAI](https://www.showmeai.tech/)å°±å¸¦å¤§å®¶æ¥è¯¦ç»†äº†è§£ä¸€ä¸‹ BentoML å’Œæ¨¡å‹éƒ¨ç½²ç›¸å…³çš„çŸ¥è¯†å’Œå®è·µæ–¹æ³•ã€‚

ğŸ’¡ è®­ç»ƒæ¨¡å‹ä¹‹åçš„å·¥ä½œ
============

ç®—æ³•å·¥ç¨‹å¸ˆå®Œæˆé’ˆå¯¹ä¸šåŠ¡åœºæ™¯çš„å»ºæ¨¡ä¸è°ƒä¼˜ä¹‹åï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œåç»­ä¸Šçº¿éƒ¨ç½²å·¥ä½œã€‚

*   å¦‚æœå›¢é˜Ÿä¸­çš„å¼€å‘äººå‘˜ï¼ˆä¾‹å¦‚åç«¯æˆ–å‰ç«¯å¼€å‘äººå‘˜ï¼‰æƒ³è¦ä½¿ç”¨å®ƒï¼Œä»–ä»¬éœ€è¦éœ€è¦å°è£…å¥½çš„æœåŠ¡æ¥å£ API æ¨¡å¼ã€‚
*   å¦‚æœ DevOps å›¢é˜Ÿæƒ³è¦ç®¡ç†æ¨¡å‹çš„éƒ¨ç½²ï¼Œåˆ™éœ€è¦å¤„ç†æ¨¡å‹ç¯å¢ƒå’Œå„ç§ä¾èµ–é¡¹ã€‚
*   å¦‚æœäº§å“å›¢é˜Ÿæƒ³è¦å¯¹æ¨¡å‹è¿›è¡Œå‹åŠ›æµ‹è¯•æˆ–å‘å®¢æˆ·å±•ç¤ºå®ƒï¼Œé‚£ä¹ˆ API å¿…é¡»æ‰©å±•åˆ°èƒ½æ”¯æ’‘å¹¶å‘è¯·æ±‚ã€‚

![](https://img-blog.csdnimg.cn/img_convert/12ad97ba51dd4ad44ab28e5ee6cd72e6.png)

ä»æ„å»º ML æ¨¡å‹åˆ°å®é™…ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œæœ‰å¾ˆå¤šå·¥ä½œå’Œæ³¨æ„ç‚¹ï¼š

*   å¤šä¸ª ML æ¡†æ¶çš„ä½¿ç”¨å’Œæ”¯æŒ
*   åˆ›å»º API å¹¶ä»¥æœ€ä½æ€§èƒ½æ°´å¹³æä¾›æœåŠ¡
*   å†ç°æ€§å’Œä¾èµ–æ€§ç®¡ç†
*   API æ–‡æ¡£
*   ç›‘æ§ã€æ—¥å¿—è®°å½•ã€æŒ‡æ ‡ç­‰

ä¸‹é¢[ShowMeAI](https://www.showmeai.tech/)å¸¦å¤§å®¶æ¥çœ‹çœ‹ BentoML æ˜¯å¦‚ä½•æ”¯æŒæ‰€æœ‰è¿™äº›éœ€æ±‚çš„ã€‚

ğŸ’¡ BentoML ç®€ä»‹&æ ¸å¿ƒæ€æƒ³
==================

**BentoML æ˜¯ç”¨äºæ¨¡å‹æœåŠ¡å’Œéƒ¨ç½²çš„ç«¯åˆ°ç«¯è§£å†³æ–¹æ¡ˆ**ã€‚BentoML å°† ML é¡¹ç›®ä¸­éœ€è¦çš„ä¸€åˆ‡æ‰“åŒ…æˆä¸€ç§ç§°ä¸º bentoï¼ˆä¾¿å½“ï¼‰çš„åˆ†å‘æ ¼å¼ï¼ˆä¾¿å½“æœ€åˆæ˜¯ä¸€ç§æ—¥æœ¬åˆé¤ç›’ï¼Œé‡Œé¢è£…ç€ä¸€ä»½ç”±ä¸»èœå’Œä¸€äº›é…èœç»„æˆçš„å•ä»½é¤ç‚¹ï¼‰ã€‚

![](https://img-blog.csdnimg.cn/img_convert/cc77974b146e4a3e4a86ee4b36e703ac.png)

æ›´å‡†ç¡®åœ°è¯´ï¼Œbento æ˜¯ä¸€ä¸ªæ–‡ä»¶å­˜æ¡£ï¼Œå…¶ä¸­åŒ…å«æ¨¡å‹è®­ç»ƒçš„æ‰€æœ‰æºä»£ç ã€å®šä¹‰çš„API ã€ä¿å­˜çš„äºŒè¿›åˆ¶æ¨¡å‹ã€æ•°æ®æ–‡ä»¶ã€Dockerfileã€ä¾èµ–é¡¹å’Œå…¶ä»–é…ç½® ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™é‡Œçš„â€œä¾¿å½“â€è§†ä¸ºç”¨äº ML çš„ Docker æ˜ åƒã€‚

![](https://img-blog.csdnimg.cn/img_convert/541f29c13d583b3f58653bf58356593c.png)

å½“ bento æ„å»ºå®Œæˆåï¼ˆä¸‹æ–‡ä¼šè¯¦ç»†è¯´æ˜ï¼‰ï¼Œä½ å¯ä»¥å°†å®ƒå˜æˆä¸€ä¸ªå¯ä»¥éƒ¨ç½²åœ¨äº‘ä¸Šçš„ Docker é•œåƒï¼Œæˆ–è€…ä½¿ç”¨ `bentoctl`ï¼ˆå®ƒä¾èµ– Terraformï¼‰ å°† bento éƒ¨ç½²åˆ°ä»»ä½•äº‘æœåŠ¡å’ŒåŸºç¡€è®¾æ–½ä¸Šï¼ˆä¾‹å¦‚ AWS Lambda æˆ– EC2ã€GCP Cloud Runã€Azure functionsç­‰ï¼‰ã€‚

ğŸ’¡ æ¨¡å‹ç‰ˆæœ¬åŒ–åŠå­˜å‚¨
===========

å¯ä»¥é€šè¿‡`pip install bentoml`å‘½ä»¤å®‰è£… bentoml

> å®‰è£…åï¼Œ `bentoml`å‘½ä»¤å·²æ·»åŠ åˆ°æ‚¨çš„ shellã€‚

å¯ä»¥ä½¿ç”¨ BentoML å°†æ¨¡å‹ä¿å­˜åœ¨ç‰¹å®šæ–‡ä»¶å¤¹ï¼ˆç§°ä¸ºæ¨¡å‹å­˜å‚¨ï¼‰ä¸­ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¿å­˜äº†ä¸€ä¸ªåœ¨é¸¢å°¾èŠ±æ•°æ®é›†ä¸Šè®­ç»ƒçš„ SVC æ¨¡å‹ã€‚

    import bentoml
    
    from sklearn import svm
    from sklearn import datasets
    
    # Load training data set
    iris = datasets.load_iris()
    X, y = iris.data, iris.target
    
    # Train the model
    clf = svm.SVC(gamma='scale')
    clf.fit(X, y)
    
    # Save model to the BentoML local model store
    saved_model = bentoml.sklearn.save_model("iris_clf", clf)
    print(f"Model saved: {saved_model}")
    
    # Model saved: Model(tag="iris_clf:hrcxybszzsm3khqa")
    

è¿™ä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„æ¨¡å‹æ ‡ç­¾ï¼Œæˆ‘ä»¬å¯ä»¥è·å–ç›¸åº”çš„æ¨¡å‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://img-blog.csdnimg.cn/img_convert/6273b98e578213f9c91986afed487497.png)

å®ƒè¿˜ä¼šåˆ›å»ºä¸€ä¸ªä»¥æ¨¡å‹æ ‡ç­¾å‘½åçš„æ–‡ä»¶å¤¹ã€‚æ‰“å¼€å’ŒæŸ¥çœ‹æ­¤æ–‡ä»¶å¤¹ï¼Œä¼šæ‰¾åˆ°äºŒè¿›åˆ¶æ–‡ä»¶å’Œä¸€ä¸ªåä¸º `model.yaml`æè¿°æ¨¡å‹å…ƒæ•°æ®ã€‚

![](https://img-blog.csdnimg.cn/img_convert/e8552e3b8aaa6b6c85980ffd20ea9373.png)

ğŸ’¡ åˆ›å»ºæ¨ç†æœåŠ¡ï¼ˆæ¨¡å‹è®¿é—® API åŒ–ï¼‰
=====================

åˆ›å»ºæ¨¡å‹å¹¶å°†å…¶ä¿å­˜åœ¨æ¨¡å‹å­˜å‚¨ä¸­åï¼Œæ‚¨å¯ä»¥å°†å…¶éƒ¨ç½²ä¸ºå¯ä»¥è¯·æ±‚çš„ API ã€‚

åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ ï¼Œç”¨`api`å½“æœ‰æ•ˆè´Ÿè½½æ•°æ®ï¼ˆNumpy Ndarray ç±»å‹ï¼‰é€šè¿‡ HTTP POST è¯·æ±‚å‘é€åˆ° `/classify`è·¯å¾„è¿›è¡Œè®¿é—®ã€‚

     import numpy as np
     import bentoml
     from bentoml.io import NumpyNdarray
     
     iris_clf_runner = bentoml.sklearn.get("iris_clf:latest").to_runner()
     
     svc = bentoml.Service("iris_classifier", runners=[iris_clf_runner])
     
     @svc.api(input=NumpyNdarray(), output=NumpyNdarray())
     def classify(input_series: np.ndarray) -> np.ndarray:
         result = iris_clf_runner.predict.run(input_series)
         return result
    

æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡ŒæœåŠ¡æ¥åœ¨æœ¬åœ°æä¾›æ¨¡å‹ï¼š

    bentoml serve service:svc --reload
    

![](https://img-blog.csdnimg.cn/img_convert/5ca9f43e54ea6032c74658cccdfd01f9.png)

ä¸Šè¿°å‘½ä»¤ä¼šå¼€å¯ä¸€ä¸ª HTTP æœ¬åœ°æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Python è¯·æ±‚è¯¥æœåŠ¡ï¼Œä»£ç å¦‚ä¸‹ï¼š

    import requests
     
    requests.post(
      "http://127.0.0.1:3000/classify",
      headers={"content-type": "application/json"},
      data="[[5.9, 3, 5.1, 1.8]]"
    ).text
      
    '[2]'
    

ä¹Ÿå¯ä»¥é€šè¿‡ç•Œé¢è®¿é—®å’Œè¯·æ±‚ï¼ˆåœ¨æµè§ˆå™¨è®¿é—® [http://localhost:3000ï¼‰](http://localhost:3000) )

![](https://img-blog.csdnimg.cn/img_convert/1097cada52d385b482e9afa2b84d46f7.png)

![](https://img-blog.csdnimg.cn/img_convert/2ee1c9e86aca8761e6d91ff0902a7c52.png)

ğŸ’¡ å®šåˆ¶ bento â€œä¾¿å½“â€
================

å¯ä»¥æ‰‹åŠ¨å®šåˆ¶ bento â€œä¾¿å½“â€ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªåä¸º`bentofile.yaml`çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒé…ç½®äº† bento çš„æ„å»ºæ–¹å¼ï¼šåŒ…æ‹¬å…ƒæ•°æ®ã€åˆ—å‡ºæœ‰ç”¨çš„æºä»£ç å¹¶å®šä¹‰åŒ…åˆ—è¡¨ã€‚

    service: "service:svc"  # Same as the argument passed to `bentoml serve`
    labels:
       owner: bentoml-team
       stage: dev
    include:
    - "*.py"  # A pattern for matching which files to include in the bento
    python:
       packages:  # Additional pip packages required by the service
       - scikit-learn
       - pandas
    

è¦æ„å»ºæ‰“åŒ…ä¾¿å½“ï¼Œè¯·åœ¨åŒ…å«çš„æ–‡ä»¶å¤¹ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

    bentoml build
    

![](https://img-blog.csdnimg.cn/img_convert/ae8061e31c6052a153c0995c0b4b9198.png)

è¿è¡Œå®Œæˆä¹‹åï¼Œå¦‚æœæˆ‘ä»¬æŸ¥çœ‹â€œä¾¿å½“â€å¹¶æ£€æŸ¥é‡Œé¢çš„å†…å®¹ï¼Œå°†çœ‹åˆ°ä»¥ä¸‹æ–‡ä»¶å¤¹ç»“æ„ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

*   APIçš„æè¿°å’Œæ¶æ„
*   æ„å»º Docker é•œåƒæ‰€éœ€çš„ Dockerfile
*   PythonåŠç¯å¢ƒä¾èµ–
*   ç»è¿‡è®­ç»ƒçš„æ¨¡å‹åŠå…¶å…ƒæ•°æ®
*   è®­ç»ƒæ¨¡å‹å’Œå®šä¹‰ API è·¯ç”±çš„æºä»£ç 
*   bento æ„å»ºé€‰é¡¹é…ç½®æ–‡ä»¶`bentoml.yaml`

![](https://img-blog.csdnimg.cn/img_convert/677da49c8f85dfb8e9bdd7beedf5efbb.png)

ğŸ’¡ æ‰“åŒ… bento ä¸º Docker é•œåƒ
=======================

åˆ›å»ºä¾¿å½“åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`dockerize`å‘½ä»¤æ¥æ„å»ºé•œåƒï¼ŒBentoML æä¾›äº†è¿™ä¸ªç®€å•çš„å‘½ä»¤æ–¹ä¾¿ä½¿ç”¨ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š

    bentoml containerize iris_classifier:latest
    

![](https://img-blog.csdnimg.cn/img_convert/58bb299f8faea03f64f703b63468a118.png)

æ„å»ºé•œåƒåï¼Œæ‚¨å¯ä»¥åœ¨ç³»ç»Ÿä¸ŠæŸ¥çœ‹å®ƒï¼š

![](https://img-blog.csdnimg.cn/img_convert/7f7a555038f63f076bff823dce78919b.png)

è¿™é‡Œçš„ Docker é•œåƒæ˜¯ç‹¬ç«‹çš„ï¼Œç”¨äºåœ¨æœ¬åœ°æä¾›æœåŠ¡æˆ–å°†å…¶éƒ¨ç½²åˆ°äº‘ä¸­ã€‚

    docker run -it --rm -p 3000:3000 iris_classifier:jclapisz2s6qyhqa serve --production
    

![](https://img-blog.csdnimg.cn/img_convert/327237e4b193ce8a3832cbcf6b500660.png)

ğŸ’¡ ä½¿ç”¨ Runners æ‰©å±•å¹¶è¡Œæ¨ç†
====================

å€ŸåŠ©äºbentomlæ¶æ„ï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œå¤„ç†å™¨å¤„ç†ä¸åŒæœåŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨é¢„ä¼°é˜¶æ®µï¼Œæˆ‘ä»¬çš„æ¨ç†ç®¡é“å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„è¿è¡Œå™¨ï¼Œå¹¶ä¸”å¯ä»¥å‚ç›´æ‰©å±•ï¼ˆé€šè¿‡åˆ†é…æ›´å¤š CPUï¼‰ã€‚æ¯ä¸ªrunnerä¹Ÿå¯ä»¥æœ‰ç‰¹å®šçš„é…ç½®ï¼ˆRAMã€CPU ä¸ GPU ç­‰ï¼‰ã€‚

åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œä¸¤ä¸ªè¿è¡Œå™¨ï¼ˆä¸€ä¸ªæ‰§è¡Œ OCR ä»»åŠ¡ï¼Œå¦ä¸€ä¸ªæ‰§è¡Œæ–‡æœ¬åˆ†ç±»ï¼‰åœ¨è¾“å…¥å›¾åƒä¸Šé¡ºåºè¿è¡Œã€‚

    import asyncio
    import bentoml
    import PIL.Image
    
    import bentoml
    from bentoml.io import Image, Text
    
    transformers_runner = bentoml.transformers.get("sentiment_model:latest").to_runner()
    ocr_runner = bentoml.easyocr.get("ocr_model:latest").to_runner()
    
    svc = bentoml.Service("sentiment_analysis", runners=[transformers_runner, ocr_runner])
    
    @svc.api(input=Image(),output=Text())
    def classify(input: PIL.Image.Image) -> str:
        ocr_text = ocr_runner.run(input)
        return transformers_runner.run(ocr_text)
    

> å¯¹äº runners æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥åœ¨ ğŸ“˜[è¿™é‡Œ](https://docs.bentoml.org/en/latest/concepts/runner.html) æŸ¥çœ‹å®˜æ–¹çš„æ›´å¤šè®²è§£.

ğŸ’¡ è‡ªé€‚åº”æ‰¹å¤„ç†
=========

åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œæ‰¹å¤„ç†æ˜¯å¾ˆå¸¸è§çš„å¤„ç†æ¨¡å¼ï¼Œåœ¨æ‰¹å¤„ç†æ¨¡å¼ä¸‹ï¼Œå¯ä»¥å¹¶è¡Œåœ°è¿›è¡Œæ•°æ®å¤„ç†ï¼Œè€Œéä¸²è¡Œç­‰å¾…ã€‚å®ƒæé«˜äº†æ€§èƒ½å’Œååé‡å¹¶åˆ©ç”¨äº†åŠ é€Ÿç¡¬ä»¶ï¼ˆæˆ‘ä»¬éƒ½çŸ¥é“GPUå°±å¯ä»¥å¯¹å‘é‡åŒ–è®¡ç®—è¿›è¡Œæ‰¹é‡åŒ–å¤„ç†ï¼‰ã€‚

![](https://img-blog.csdnimg.cn/img_convert/581f3a8be1e63d1ab9c3218592e8650d.png)

ä¸è¿‡FastAPIã€Flask æˆ– Django ç­‰ Web æ¡†æ¶æ²¡æœ‰å¤„ç†æ‰¹å¤„ç†çš„æœºåˆ¶ã€‚ä½†æ˜¯ BentoML ä¸ºæ‰¹å¤„ç†æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚å®ƒæ˜¯ä¸Šå›¾è¿™æ ·ä¸€ä¸ªå¤„ç†è¿‡ç¨‹ï¼š

*   å¤šè¾“å…¥è¯·æ±‚å¹¶è¡Œå¤„ç†
*   è´Ÿè½½å‡è¡¡å™¨åœ¨workerä¹‹é—´åˆ†å‘è¯·æ±‚ï¼ˆworkeræ˜¯ API æœåŠ¡å™¨çš„è¿è¡Œå®ä¾‹ï¼‰
*   æ¯ä¸ªworkerå°†è¯·æ±‚åˆ†å‘ç»™è´Ÿè´£æ¨ç†çš„æ¨¡å‹è¿è¡Œå™¨
*   æ¯ä¸ªè¿è¡Œå™¨é€šè¿‡åœ¨å»¶è¿Ÿå’Œååé‡ä¹‹é—´æ‰¾åˆ°æƒè¡¡æ¥åŠ¨æ€åœ°å°†è¯·æ±‚åˆ†æ‰¹åˆ†ç»„
*   runnerå¯¹æ¯ä¸ªæ‰¹æ¬¡è¿›è¡Œé¢„æµ‹
*   æœ€åå°†æ‰¹é‡é¢„æµ‹æ‹†åˆ†å¹¶ä½œä¸ºå•ç‹¬çš„å“åº”è¿”å›

è¦å¯ç”¨æ‰¹å¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®`batchable`å‚æ•°ä¸º`True`ã€‚å¦‚ä¸‹ä¾‹ï¼š

    bentoml.pytorch.save_model(
        name="mnist",
        model=model,
        signature={
            "__call__": {
                "batchable": True,
                "batch_dim": (0, 0),
            },
        },
    )
    

> å¯¹äºæ‰¹å¤„ç†æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥åœ¨ ğŸ“˜[**è¿™é‡Œ**](https://docs.bentoml.org/en/latest/guides/batching.html) æŸ¥çœ‹å®˜æ–¹çš„æ›´å¤šè®²è§£.

ğŸ’¡ å¹¶è¡Œæ¨ç†
=======

BentoML çš„ runners è®¾è®¡éå¸¸å·§å¦™ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦ç»„åˆå®ƒä»¬ï¼Œåˆ›å»ºå¯è‡ªå®šä¹‰çš„æ¨ç†å›¾ã€‚åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è§‚å¯Ÿäº†ä¸¤ä¸ªé¡ºåºè¿è¡Œçš„runnerï¼ˆä»»åŠ¡é¡ºåºä¸º OCR -> æ–‡æœ¬åˆ†ç±»ï¼‰ã€‚

ä¸‹é¢ç¤ºä¾‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¿è¡Œå™¨ä¹Ÿå¯ä»¥é€šè¿‡å¼‚æ­¥è¯·æ±‚å¹¶å‘è¿è¡Œã€‚

    import asyncio
    import PIL.Image
    
    
    import bentoml
    from bentoml.io import Image, Text
    
    
    preprocess_runner = bentoml.Runner(MyPreprocessRunnable)
    model_a_runner = bentoml.xgboost.get('model_a:latest').to_runner()
    model_b_runner = bentoml.pytorch.get('model_b:latest').to_runner()
    
    
    svc = bentoml.Service('inference_graph_demo', runners=[
        preprocess_runner,
        model_a_runner,
        model_b_runner
    ])
    
    
    @svc.api(input=Image(), output=Text())
    async def predict(input_image: PIL.Image.Image) -> str:
        model_input = await preprocess_runner.async_run(input_image)
    
    
        results = await asyncio.gather(
            model_a_runner.async_run(model_input),
            model_b_runner.async_run(model_input),
        )
    
    
        return post_process(
            results[0], # model a result
            results[1], # model b result
        )
    

![](https://img-blog.csdnimg.cn/img_convert/589d64abae01faf361a743cc8f3b716c.png)

ğŸ’¡ äº‘ç«¯éƒ¨ç½²
=======

![](https://img-blog.csdnimg.cn/img_convert/3a9a08c4f012b72481bc03b5aff200fd.png)

BentoML çš„â€œä¾¿å½“â€çš„å¦™å¤„åœ¨äºï¼Œä¸€æ—¦å®Œæˆæ„å»ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼éƒ¨ç½²å®ƒï¼š

*   â‘  å°† Docker é•œåƒæ¨é€å’Œéƒ¨ç½²åˆ°äº‘ç«¯
*   â‘¡ é€šè¿‡ä½¿ç”¨ç”± BentoML å›¢é˜Ÿå¼€å‘çš„ bentoctl æ¥éƒ¨ç½²

![](https://img-blog.csdnimg.cn/img_convert/44f7aff77814c14492605720f5e0362f.png)

ä½¿ç”¨ bentoctl æœ‰åŠ©äºå°†æ„å»ºçš„ bento éƒ¨ç½²ä¸ºäº‘ä¸Šçš„ç”Ÿäº§å°±ç»ª API ç«¯ç‚¹ã€‚å®ƒæ”¯æŒè®¸å¤šäº‘æä¾›å•†ï¼ˆAWSã€GCSã€Azureã€Herokuï¼‰ä»¥åŠåŒä¸€äº‘æä¾›å•†ï¼ˆAWS Lambdaã€EC2 ç­‰ï¼‰ä¸­çš„å¤šç§æœåŠ¡ã€‚æ ¸å¿ƒçš„éƒ¨ç½²æ­¥éª¤ä¸ºï¼š

*   å®‰è£… BentoML
*   å®‰è£… ğŸ“˜[**Terraform**](https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli)
*   è®¾ç½® AWS CLI å¹¶å®Œæˆé…ç½®ï¼ˆè¯·å‚é˜… ğŸ“˜[**å®‰è£…æŒ‡å—**](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html) ï¼‰
*   å®‰è£… bentoctl ( `pip install bentoctl`)
*   æ„å»ºå¥½ bentoâ€œä¾¿å½“â€
*   å®‰è£…å…è®¸åœ¨ AWS Lambda ä¸Šéƒ¨ç½²çš„ aws-lambda è¿ç®—ç¬¦ï¼ˆbentoctl ä¹Ÿæ”¯æŒå…¶ä»–è¿ç®—ç¬¦ï¼‰ï¼š`bentoctl operator install aws-lambda`
*   é€šè¿‡è¿è¡Œç”Ÿæˆéƒ¨ç½²æ–‡ä»¶ `bentoctl init`
*   é€šè¿‡è¿è¡Œæ„å»ºéƒ¨ç½²æ‰€éœ€çš„é•œåƒ `bentoctl build`
*   é€šè¿‡è¿è¡Œ ğŸš€ éƒ¨ç½²åˆ° Lambda `bentoctl apply -f deployment_config.yaml`

éƒ¨ç½²å®Œæˆåï¼Œç³»ç»Ÿä¼šæç¤ºæ‚¨æä¾›ä¸€ä¸ª API URLï¼Œæˆ‘ä»¬å¯ä»¥è¯·æ±‚è¯¥ URL ä¸æ¨¡å‹è¿›è¡Œäº¤äº’ã€‚

ğŸ’¡ API æ–‡æ¡£å’Œäº¤äº’å¼ UI
================

å½“éƒ¨ç½² BentoML æœåŠ¡æˆ–åœ¨æœ¬åœ°æä¾›æœåŠ¡æ—¶ï¼Œå¯ä»¥è®¿é—® ğŸ“˜[**Swagger UI**](https://swagger.io/tools/swagger-ui/)ï¼Œå€ŸåŠ©å®ƒå¯ä»¥å¯è§†åŒ– API èµ„æºå¹¶ä¸ä¹‹äº¤äº’ã€‚å¦‚ä¸‹ä¾‹ï¼Œå®ƒæ ¹æ® OpenAPI è§„èŒƒç”Ÿæˆçš„ï¼Œéå¸¸æ–¹ä¾¿åç«¯å’Œå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ä½¿ç”¨ã€‚

![](https://img-blog.csdnimg.cn/img_convert/e9dae18f957142f2a3f880dbc4e1f668.png)

å‚è€ƒèµ„æ–™
====

*   ğŸ“˜ [**BentoMLå®˜æ–¹ç½‘ç«™**](https://www.bentoml.com/)ï¼š[https://www.bentoml.com/](https://www.bentoml.com/)
*   ğŸ“˜ [**runnerså®˜æ–¹è®²è§£**](https://docs.bentoml.org/en/latest/concepts/runner.html)ï¼š[https://docs.bentoml.org/en/latest/concepts/runner.html](https://docs.bentoml.org/en/latest/concepts/runner.html)
*   ğŸ“˜ [**æ‰¹å¤„ç†å®˜æ–¹æ•™ç¨‹**](https://docs.bentoml.org/en/latest/guides/batching.html)ï¼š[https://docs.bentoml.org/en/latest/guides/batching.html](https://docs.bentoml.org/en/latest/guides/batching.html)
*   ğŸ“˜ [**Terraformå®˜æ–¹å®‰è£…æ•™ç¨‹**](https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli)ï¼š[https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli](https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli)
*   ğŸ“˜ [**AWS CLIå®‰è£…ä¸é…ç½®æŒ‡å—**](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)ï¼š[https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html)
*   ğŸ“˜ [**Swagger UI**](https://swagger.io/tools/swagger-ui/)ï¼š[https://swagger.io/tools/swagger-ui/](https://swagger.io/tools/swagger-ui/)
*   ğŸ“˜ [**Comprehensive Guide to Deploying Any ML Model as APIs With Python And AWS Lambda**](https://towardsdatascience.com/comprehensive-guide-to-deploying-any-ml-model-as-apis-with-python-and-aws-lambda-b441d257f1ec)
*   ğŸ“˜ [**Breaking Up With Flask & FastAPI: Why ML Model Serving Requires A Specialized Framework**](https://modelserving.com/blog/breaking-up-with-flask-amp-fastapi-why-ml-model-serving-requires-a-specialized-framework)

æ¨èé˜…è¯»
====

*   ğŸŒ [**æ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/40) ï¼š[https://www.showmeai.tech/tutorials/40](https://www.showmeai.tech/tutorials/40)
*   ğŸŒ [**æœºå™¨å­¦ä¹ æ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/41)ï¼š[https://www.showmeai.tech/tutorials/41](https://www.showmeai.tech/tutorials/41)
*   ğŸŒ [**æ·±åº¦å­¦ä¹ æ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/42)ï¼š[https://www.showmeai.tech/tutorials/42](https://www.showmeai.tech/tutorials/42)
*   ğŸŒ [**TensorFlowæ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/43)ï¼š[https://www.showmeai.tech/tutorials/43](https://www.showmeai.tech/tutorials/43)
*   ğŸŒ [**PyTorchæ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/44)ï¼š[https://www.showmeai.tech/tutorials/44](https://www.showmeai.tech/tutorials/44)
*   ğŸŒ [**NLPå®æˆ˜æ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/45)ï¼š[https://www.showmeai.tech/tutorials/45](https://www.showmeai.tech/tutorials/45)
*   ğŸŒ [**CVå®æˆ˜æ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/46)ï¼š[https://www.showmeai.tech/tutorials/46](https://www.showmeai.tech/tutorials/46)
*   ğŸŒ [**AI é¢è¯•é¢˜åº“ç³»åˆ—**](https://www.showmeai.tech/tutorials/48)ï¼š[https://www.showmeai.tech/tutorials/48](https://www.showmeai.tech/tutorials/48)

[![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9190f41b8de4af38c8a1a0c96f0513b~tplv-k3u1fbpfcp-zoom-1.image)](https://www.showmeai.tech/)