---
layout: post
title: "女朋友面试回来抱怨说会redis，面试官问了一堆redis"
date: "2022-05-18T21:17:45.316Z"
---
女朋友面试回来抱怨说会redis，面试官问了一堆redis
=============================

![图片](https://mmbiz.qpic.cn/mmbiz_gif/nSSic13wUHIziaBEIiaRict65qQAJKSF8cnhUib7CPosBwaVBycMdQzvvPvdKJ53tFCnmtE7YpNl4OGvWkmjU7J1LGQ/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

### Redis 优缺点及特点

**什么是Redis？简述它的优缺点？** 

Redis本质上是一个Key-Value类型的内存数据库，类似MemoryCache，整个数据库统统加载在内存当中进行操作，定期通过异步操作把数据库数据flush到硬盘上进行保存。因为是纯内存操作，Redis的性能非常出色，每秒可以处理超过 10万次读写操作，是已知性能快的 Key-Value DB。

Redis的出色之处不仅仅是性能，Redis大的魅力是支持保存多种数据结构，单个value的大限 制是1GB，不像MemoryCache只能保存1MB的数据，因此Redis可以用来实现很多有用的功能。

比方说用他的List来做FIFO双向链表，实现一个轻量级的高性能消息队列服务，用他的Set可以做高性能的tag系统等等。

另外Redis也可以对存入的Key-Value设置expire时间，因此也可以被当作一个功能加强版的MemoryCache来用。

Redis的主要缺点是数据库容量受到物理内存的限制，不能用作海量数据的高性能读写，因此Redis适合的场景主要局限在较小数据量的高性能操作和运算上。

**Redis相比MemoryCache有哪些优势？** 

    MemoryCache所有的值均是简单的字符串，Redis作为其替代者，支持更为丰富的数据类型
    
    Redis的速度比MemoryCache快很多
    
    Redis可以持久化其数据。

**Redis支持哪几种数据类型？** 

      String：字符
      List：列表
      Set：集合
      Sorted Set：有序集合
      Hash：哈希列表

**Redis主要消耗什么物理资源？** 

内存。因为Redis的数据都是存储在内存当中。内存数据库相比一般的关系型数据库，读取速度要更快，但是消耗的内存资源会更多。

**Redis的全称是什么？** 

    Remote Dictionary Server

**Redis有哪几种数据淘汰策略？**

    noeviction:默认策略，不淘汰，如果内存已满，添加数据则返回错误。
    
    allkeys-lru: 尝试回收最近最少使用的键，使得新添加的数据有空间存放。
    
    volatile-lru: 尝试回收最少使用的键，但仅限于在过期集合的键,使得新添加的数据有空间存放。
    
    allkeys-random: 回收随机的键使得新添加的数据有空间存放。
    
    volatile-random: 回收随机的键使得新添加的数据有空间存放，但仅限于在过期集合的键。
    
    volatile-ttl: 回收在过期集合的键，并且优先回收存活时间（TTL）较短的键,使得新添加的数据有空间存 放。

**一个字符串类型的值能存储最大容量是多少？**

 512M 

**为什么Redis需要把所有数据放到内存中？** 

Redis为了达到最快的读写速度将数据都读到内存中，并通过异步的方式将数据写入磁盘。所以Redis具有快速和数据持久化的特征。如果不将数据放在内存中，磁盘I/O速度严重影响Redis的性能。

**MySQL有2000w数据，redis中只存20w的数据，如何保证 redis中的数据都是热点数据？**

redis内存数据集大小上升到一定大小的时候，就会施行数据淘汰策略。

**Redis有哪些适合的场景？** 

**会话缓存(Session Cache)：** 常用的一种使用Redis的情景是会话缓存(session cache)。

用Redis缓存会话比其他存储(如MemoryCache)的优势在于：Redis提供持久化。

当维护一个不是严格要求一致性的缓存时，如果用户的购物车信息全部丢失，造成用户体验上的不佳。

随着 Redis 这些年的改进，很容易找到怎么恰当的使用Redis来缓存会话的文档。甚至广为 人知的商业平台Magento也提供Redis的插件。

**全页缓存（FPC）：**除基本的会话token之外，Redis还提供很简便的FPC平台。

回到一致性问题，即使重启了Redis实例， 因为有磁盘的持久化，用户也不会看到页面加载速度的下降，这是一个极大改进，类似PHP本地FPC。

再次以Magento为例，Magento提供一个插件来使用Redis作为全页缓存后端。

此外，对WordPress的用户来说，Pantheon有一个非常好的插件wp-Redis，这个插件能帮助你以快 速度加载你曾浏览过的页面。

**队列:**  Reids在内存存储引擎领域的一大优点是提供 list 和 set 操作，这使得Redis能作为一个很好的消息队列平台来使用。

Redis作为队列使用的操作，就类似于本地程序语言（如C#）对queue的 put/pop 操作。

如果你快速的在Google中搜索“Redis queues”，你马上就能找到大量的开源项目，这些项目的目的就是利用Redis创建非常好的后端工具，以满足各种队列需求。

例如，Celery有一个后台就是使用Redis作为 broker，你可以从这里去查看。

**排行榜/计数器：**Redis在内存中对数字进行递增或递减的操作实现的非常好。

集合(Set)和有序集合(Sorted Set)也 使得我们在执行这些操作的时候变的非常简单，Redis只是正好提供了这两种数据结构。

所以，我们要从排序集合中获取到排名靠前的10个用户–我们称之为“user\_scores”。

当然，这是假定你是根据你用户的分数做递增的排序。

**发布/订阅:**  发布/订阅的使用场景确实非常多。

我已看见人们在社交网络连接中使用，还可作为基于发布/订阅的脚本触发器，甚至用Redis的发布/订阅功能来建立聊天系统。

**Redis支持的Java客户端都有哪些？官方推荐用哪个？** 

Redisson、Jedis、lettuce等等，官方推荐使用Redisson。

**Redis和Redisson有什么关系？** 

Redisson是一个高级的分布式协调Redis客服端，能帮助用户在分布式环境中轻松实现一些Java的对象。

例如：

    
    Bloomfilter,BitSet,Set,SetMultimap,ScoredSortedSet,SortedSet,Map,ConcurrentMap,List,ListMultimap,Queue,BlockingQueue,Deque,BlockingDeque等。

**Redis如何设置密码及验证密码？** 

设置密码：config set requirepass 123456 授权密码：auth pwd

**说说Redis哈希槽的概念？** 

Redis集群没有使用一致性hash,而是引入了哈希槽的概念，Redis集群有16384个哈希槽，每个key通过 CRC16校验后对16384取模来决定放置哪个槽，集群的每个节点负责一部分hash槽。

### Redis 管道模型及事务

**怎么测试Redis的连通性？** 

跟测试ip一样，使用ping的方式。

**Redis中的管道有什么用？** 

一次请求/响应服务器能实现处理新的请求即使旧的请求还未被响应。

这样就可以将多个命令发送到服务器，而不用等待回复，后在一个步骤中读取该答复(这个跟程序语言的 async/await 异步编程一样)。

这就是管道（pipelining），是一种几十年来广泛使用的技术。例如许多POP3协议已经实现支持这个功 能，大大加快了从服务器下载新邮件的过程。

**怎么理解Redis事务？** 

事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。

事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。

**Redis事务相关的命令有哪几个？** 

    MULTI、EXEC、DISCARD、WATCH

**Redis key的过期时间和永久有效分别怎么设置？** 

    EXPIRE:设置过期
    PERSIST：设置永久有效

### Redis 内存优化及性能

**Redis如何做内存优化？** 

Redis的散列(hash)表会将一个键和一个散列表在数据库中关联起来，用户可以在散列表中为任意多个字设置值。

与字符串键值对一样，散列表里面的字段和值既可以是文本数据，可以是二进制数据。

尽可能使用散列表（hash），散列表（是说散列表里面存储的数量少）使用的内存非常小，所以应该尽可能的将你的数据模型抽象到一个散列表里面。

比如你的web系统中有一个用户对象，不要为这个用户的名称，姓氏，邮箱，密码设置单独的key,而是 应该把这个用户的所有信息存储到一张散列表里面。

**Redis回收进程如何工作的？** 

一个客户端运行了新的命令，添加了新的数据。Redis检查内存使用情况，如果大于maxmemory的限制, 则根据设定好的策略进行回收。

所以我们不断地穿越内存限制的边界，通过不断达到边界然后不断地回收回到边界以下。

如果一个命令的结果导致大量内存被使用（例如很大的集合的交集保存到一个新的键），不用多久内存限制就会被这个内存使用量超越。

**为什么Redis需要把所有数据放到内存中？** 

Redis为了达到快的读写速度将数据都读到内存中，并通过异步的方式将数据写入磁盘。

所以Redis具有快速和数据持久化的特征。

如果不将数据放在内存中，磁盘I/O速度会严重影响redis的性能。

如果设置了大量使用的内存，则数据已有记录数达到内存 限值后不能继续插入新值。

**Redis常见的性能问题都有哪些？如何解决？** 

Master写内存快照，save命令调度rdbSave函数，会阻塞主线程的工作，当快照比较大时对性能影响是非常大的，会间断性暂停服务，所以Master好不要写内存快照。

Master AOF持久化，如果不重写AOF文件，这个持久化方式对性能的影响是小的，但是AOF文件会不断增大，AOF文件过大会影响Master重启的恢复速度。

Master好不要做任何持久化工作，包括内存快照和AOF日志文件，特别是不要启用内存快照做持久化，如果数据比较关键，某个Slave开启AOF备 份数据，策略为每秒同步一次。

Master调用BGREWRITEAOF重写AOF文件，AOF在重写的时候会占大量的CPU和内存资源，导致服务加载过高，出现短暂服务暂停现象。

Redis主从复制的性能问题，为了主从复制的速度和连接的稳定性，Slave和Master好在同一个局域网内。

**Redis最适合的场景有哪些？** 

    会话缓存（Session Cache）
    全页缓存（FPC） 
    队列 
    排行榜/计数器
    发布/订阅 

**MemoryCache与Redis的区别都有哪些？** 

存储方式不同，MemoryCache是把数据全部存在内存中，数据不能超过内存的大小，断电后数据库会挂掉。Redis有部分存在硬盘上，这样能保证数据的持久性。

数据支持的类型不同MemoryCache对数据类型支持相对简单，redis有复杂的数据类型。

使用底层模型不同它们之间底层实现方式以及与客户端之间通信的应用协议不一样。

Redis直接自己 构建了VM机制，因为一般的系统调用系统函数的话，会浪费一定的时间去移动和请求。

支持的value大小不一样Redis大可以达到1GB，而MemoryCache只有1MB。

**Redis有哪几种数据结构？** 

    String字符串: String数据结构是简单的key-value类型，value不仅可以是String，也可以是数字（当数字类型用Long 可以表示的时候Encoding就是整型，其他都存储在sdshdr当做字符串）。
    
    Hash字典: 在MemoryCache中，我们经常将一些结构化的信息打包成HashMap，在客户端序列化后存储为一个字符 串的值（一般是JSON格式），比如用户的昵称、年龄、性别、积分等。
    
    List列表: List说白了就是链表（redis使用双端链表实现的List）
    
    Set集合: Set就是一个集合，集合的概念就是一堆不重复值的组合。利用Redis提供的Set数据结构，可以存储一 些集合性的数据。
    
    Sorted Set有序集合: 和Set相比，Sorted Set是将Set中的元素增加了一个权重参数score，使得集合中的元素能够按score进 行有序排列，
    
    带有权重的元素，比如一个游戏的用户得分排行榜
    
    比较复杂的数据结构，一般用到的场景不算太多 

写到这里，

女朋友就忍不住问了：可是，Redis如何做集群？

高并发下缓存击穿是怎么导致？

缓存雪崩又是怎么造成的又咋解决呢？

并发下竞争Key又是咋解决呢？

我：......

我：傻瓜，时候不早了，早些休息......