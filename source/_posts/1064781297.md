---
layout: post
title: "网络中冗余备份"
date: "2022-10-03T01:53:14.556Z"
---
网络中冗余备份
=======

冗余备份的重要性
========

如今社会，网络是各个产业的新的血脉，网络的稳定性至关重要，一旦网络出现故障，导致断网、延迟丢包等很可能会导致生产作业停滞，造成较经济损失，为此冗余备份至关重要，从链路和节点我总结出了几种冗余备份方式。

*   二层设备使用到STP类的协议、链路聚合。

*   三层设备使用动态路由、VRRP、VGMP（华为防火墙专用）。

* * *

链路备份方法
======

设备与设备之间的链路部分，是非常容易出现故障的，比如光纤被施工队挖断了、光收发损坏、水晶头老化等等问题，都会导致网络断路，从而“收获投诉”。可以可以通过一些手段去解决。

有线链路备份
------

所以在一般的网络设计中，会敷设多条网络的链路，比如比较重要的汇聚点之间设备敷设两条光纤，在某条光纤出现链路故障时候可以进行手动的切换（手动接线）。当然可以通过设备，如果是二层交换机设备，可以配合链路聚合实现负载均衡和带宽叠加。

可以分为**物理层+数据链路层**两种情况。

方法

场景

举措

备份线

交换机/路由器<->终端设备

设置多条链路，某条链路故障时候可以手动更换到新的链路

备份线后，链路聚合

交换机<->交换机

设置多条链路，链路互相连接到同一个设备，设置链路聚合绑定（注意开启STP类的协议）

![](https://picx.zhimg.com/80/v2-ce5b84535ef4a94e4ad8ef859fc9cb38_720w.png?source=d16d100b)

**图1.**两台交换机之间的链路聚合

无线链路备份
------

*   无线冗余和有线的“**交换机/路由器****<->****终端设备**”情况类似，基本上是出现在同一个层面（物理层上），也就是直接针对于接入层，终端设备接入网络。

*   随着无线技术的发展，虽然稳定和带宽还是和相比有线还是不足，在特殊常见下终端接入到内网的情况（不方便布线、使用终端需要移动等）也有越来越多的应用。

*   无线在我们生活非常的常见，比如手机开启流量和WLAN也是一种无线链路冗余，在WLAN信号不佳的情况下，切换至流量可以保证网络可以正常的使用。

*   无线相关组成就比较多了，我遇到过使用，同时接入多条无线网络，在单条无线信号网络不佳时候可以提供合理的切换，波导管天线网桥+全向的无线网桥。

常见的无线网络模式

举措

私网基站+远端的组合

*   多基站：基站可以为多台远端工作，对于接入设备的远端可设置多台邻居基站以备在当前基站信号差而不能漫游切换
*   基站与远端天线设置不同的方位或者设置收发不同的频率等，来避免某条无线链路造成不稳定，从而达到冗余的目的

WLAN

*   不同的WLAN AP设备接入
*   连接不同的频率WLAN（2.4GHz保障接入距离和5GHz保障近距离传输带宽）
*   连接同频率不同信道WLAN（比如2.4GHz的信道1和信道6，避免信道之间的干扰）

运营商网络（5G、4G）

*   从覆盖率上来说，运营商的无线覆盖率**最高**，可以弱化天线的作用，不用考虑基站的远端的走线问题
*   配合VPN软件也可以实现公网私网通信，但是需要额外支付运营商的物联网套餐资费

*   一般情况下，无线冗余可以自由组合，比如我多个远端+基站的冗余，或者可以用运营商5G。

无线+有线链路备份
---------

大部分情况下无线和有线使用场景不同。一般情况下，经常会相互的结合起来使用。比如多AP作为接入通信到核心网络的AC之间的链路就可以多加设备、链路了。

* * *

设备备份方法
======

网络中的节点也可能出现问题，比如交换机、路由器出现故障，遭受遭受雷击、进水等无法正常工作，冗余链路也不可以保证网络通信。节点的冗余通常也会设置多条有线链路。

设备冗余涉及到多台设备，如果说一个设备的故障率是0.1%，那么在中间设置2台设备并联，即使是某台设备故障任然有另一台设备可以保证网络通信，这个这条故障率就可以降低为0.05%。

*   对于二层设备，设置多台交换机或者使用交换机堆叠的技术，再配置STP类的协议（比如STP生成树协议、MSTP多生成树、RSTP快速生成树协议），是最常见的方法。
    
*   对于三层设备，可以设置动态路由（OSPF、IS-IS、RIP等）。
    

情况

举措

交换机冗余

布置多台交换机（或者交换机堆叠），配置好stp类的协议当某台交换机出现故障时，另一台交换机也可以保证网络通信

路由器冗余

布置多台路由器，在配置好动态设置多条链路，链路相互连接到设备，设置动态路由由路由协议决定

![](https://picx.zhimg.com/80/v2-333f55f0f8c3723536fdd7cb3340fd6e_720w.png?source=d16d100b)

**图2.LSW3与LSW4并联在LSW1与LSW2之间**

但是缺点嘛，就是设备也不便宜（吐槽某些单位想让驴跑又不让驴吃草），钱花在刀刃上，所以使用在汇聚或者核心是比较稳妥的，接入还是用链路备份的方法吧。

虚拟化冗余方法
=======

常见的我们将多台物理设备，虚拟成为一台设备，对于其他设备来看其具有唯一的IP，可以适用于更多的网络场景，通常用在网关中（因为对于终端设备来说，网关是唯一的）。

VRRP（虚拟路由器冗余协议）
---------------

是我们最常用的协议之一。

*   只有一种报文：Advertisement报文，目的IP组播224.0.0.18，目的MAC为0100:5e00:0012，协议号112
    

VRRP由两台路由器设备组成，通过优先级（Priority）选举出主和备。

*   主路由（Master）：负责VRRP系统中全部的路转发工作，定期（默认为1s）发送HELLO通告报文备用路由。
    
*   备用路由（Backup）：接收HELLO通告报文，当Master路由器出现故障时，能够代替Master路由器工作的路由器。
    
*   VIP：即Virtual IP， 虚拟的IP地址（整个系统对外IP的），vip会配置主路由器的指定端口网卡上，当主路由发送切换后，vip也会变更在新主路由器的指定端口上。

VGMP（引用）
--------

VGMP（VRRP Group Management Protocol）协议是华为公司的私有协议。

主要是用于防火墙的冗余备份中，VGMP协议中定义了VGMP组，FW基于VGMP组实现设备主备状态管理。

因为防火墙通过会话表来工作，当会话表缺少，可以会造成业务丢失，而VGMP可以保证报文来回路径通过同一台防火墙。当主防火墙出现故障时，所有流量都将切换到备防火墙。为了实现主用设备出现故障时能由备用设备平滑地接替工作，需要在主、备用设备之间备份关键配置命令和会话表状态等关键信息。

HRP（引用）
-------

HRP（Huawei Redundancy Protocol）华为冗余协议，用来将主防火墙关键配置和连接状态等数据向备份防火墙上同步。

当主防火墙出现故障时，所有流量都将切换到备防火墙。

因为USG防火墙是状态防火墙，如果备防火墙上没有原来主防火墙上的会话表等连接状态数据，则切换到备防火墙的流量将无法通过防火墙，造成现有的连接中断，此时用户必须重新发起连接。

HRP模块提供了基础的数据备份机制和传输功能。