---
layout: post
title: "ä¸ä¼šDRFï¼Ÿæºç éƒ½åˆ†æé€äº†ç¡®å®šä¸æ¥çœ‹ï¼Ÿ"
date: "2022-03-29T21:16:50.809Z"
---
ä¸ä¼šDRFï¼Ÿæºç éƒ½åˆ†æé€äº†ç¡®å®šä¸æ¥çœ‹ï¼Ÿ
===================

![ä¸ä¼šDRFï¼Ÿæºç éƒ½åˆ†æé€äº†ç¡®å®šä¸æ¥çœ‹ï¼Ÿ](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329233518861-2116173183.png) å‘ç°ä¼šå†™æ¥å£è¿˜ä¸å¤ªè¡Œï¼Œæºç çœ‹äº†æœ‰ç‚¹æ‡µé€¼ï¼Œå†³å®šå¥½å¥½ç¼•ä¸€ç¼•æºç ï¼ŒèŒ…å¡é¡¿å¼€å•Šï¼

ç›®å½•

*   [ä¸ä¼šDRFï¼Ÿæºç éƒ½åˆ†æé€äº†ç¡®å®šä¸æ¥çœ‹ï¼Ÿ](#ä¸ä¼šdrfæºç éƒ½åˆ†æé€äº†ç¡®å®šä¸æ¥çœ‹)
*   [å¿«é€Ÿä½¿ç”¨DRFå†™å‡ºæ¥å£](#å¿«é€Ÿä½¿ç”¨drfå†™å‡ºæ¥å£)
    *   [åºåˆ—åŒ–å’Œååºåˆ—åŒ–](#åºåˆ—åŒ–å’Œååºåˆ—åŒ–)
    *   [drfå¿«é€Ÿä½¿ç”¨](#drfå¿«é€Ÿä½¿ç”¨)
        *   [views.py](#viewspy)
        *   [serializer.py](#serializerpy)
        *   [urls.py](#urlspy)
        *   [åœ¨settingsçš„appä¸­æ³¨å†Œ](#åœ¨settingsçš„appä¸­æ³¨å†Œ)
        *   [models.py](#modelspy)
        *   [postmanæµ‹è¯•](#postmanæµ‹è¯•)
*   [CBVæºç æµç¨‹åˆ†æ](#cbvæºç æµç¨‹åˆ†æ)
*   [Django Viewå’ŒDRF APIViewçš„å°æ’æ›²](#django-viewå’Œdrf-apiviewçš„å°æ’æ›²)
*   [DRFä¹‹APIViewå’ŒRequestå¯¹è±¡åˆ†æ](#drfä¹‹apiviewå’Œrequestå¯¹è±¡åˆ†æ)
    *   [APIViewçš„æ‰§è¡Œæµç¨‹](#apiviewçš„æ‰§è¡Œæµç¨‹)
    *   [Requestå¯¹è±¡åˆ†æ](#requestå¯¹è±¡åˆ†æ)
    *   [åŸæ¥çš„djangoä¸­æ²¡æœ‰request.dataï¼Œé€ ä¸€ä¸ªï¼](#åŸæ¥çš„djangoä¸­æ²¡æœ‰requestdataé€ ä¸€ä¸ª)

ä¸ä¼šDRFï¼Ÿæºç éƒ½åˆ†æé€äº†ç¡®å®šä¸æ¥çœ‹ï¼Ÿ
===================

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329232915872-881713548.png)

> **å¯ä»¥æ›´æ–¹ä¾¿çš„ä½¿ç”¨djangoå†™å‡ºç¬¦åˆrestfulè§„èŒƒçš„æ¥å£**

**ä¸‹è½½å®‰è£…**

*   `pip3 install djangorestframework`
*   pycharmä¸‹è½½

**æ³¨æ„**

*   **`rest_framework`æ˜¯ä¸€ä¸ªappéœ€è¦æ³¨å†Œï¼**

ğŸ‘‰å®˜ç½‘ï¼š[https://www.django-rest-framework.org/](https://www.django-rest-framework.org/)

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329232927656-135059756.png)

*   drfå®‰è£…é»˜è®¤å®‰è£…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚æœdjangoç‰ˆæœ¬è¿‡ä½ä¼šè‡ªåŠ¨å‡çº§åˆ°3.xç‰ˆæœ¬
    
*   ç‰ˆæœ¬æ”¯æŒå¯¹åº”å…³ç³»
    

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329232932515-1356235374.png)

**ç¤ºä¾‹**

    '''views.py'''
    from rest_framework.views import APIView
    from rest_framework.response import Response
    
    
    class Test(APIView):
        def get(self,request):
            data = {'status':200,'msg':'success'}
            return Response(data)
        def post(self,request):
            data = {'status': 200, 'msg': 'success'}
            return Response(data)
        
    '''urls.py'''    
    path('test/', views.Test.as_view()),
        
    '''settings.py'''
    INSTALLED_APPS = [
        'django.contrib.admin',
        'django.contrib.auth',
        'django.contrib.contenttypes',
        'django.contrib.sessions',
        'django.contrib.messages',
        'django.contrib.staticfiles',
        'app01.apps.App01Config',
        'rest_framework'
    ]
    

> getè¯·æ±‚

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329233224508-1181922491.png)

> postè¯·æ±‚

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329233229766-1932712432.png)

**æ³¨æ„ï¼šå‰åç«¯åˆ†ç¦»csrfå·²ç»æ²¡æœ‰ç”¨äº†ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æºç **

    def as_view(cls, **initkwargs)
    	return csrf_exempt(view)
    

æˆ‘ä»¬å‘ç°è¿”å›å€¼æ˜¯`csrf_exempt(view)`å±€éƒ¨ä¸éªŒè¯ï¼Œåœ¨Djangoæ€»ç»“åˆ°äº†ä¸æ‡‚å¯ä»¥çœ‹ä¸€ä¸‹ï¼š[CSRF è·¨ç«™è¯·æ±‚ä¼ªé€ ](https://www.cnblogs.com/48xz/p/15998466.html)

* * *

å¿«é€Ÿä½¿ç”¨DRFå†™å‡ºæ¥å£
===========

åºåˆ—åŒ–å’Œååºåˆ—åŒ–
--------

APIæ¥å£å¼€å‘ï¼Œæœ€æ ¸å¿ƒæœ€å¸¸è§çš„ä¸€ä¸ªè¿‡ç¨‹å°±æ˜¯åºåˆ—åŒ–ï¼Œæ‰€è°“åºåˆ—åŒ–å°±æ˜¯æŠŠæ•°æ®è½¬æ¢æ ¼å¼ï¼Œåºåˆ—åŒ–å¯ä»¥åˆ†ä¸¤ä¸ªé˜¶æ®µï¼š

*   **åºåˆ—åŒ–**ï¼šæŠŠæˆ‘ä»¬è¯­è¨€è¯†åˆ«çš„æ•°æ®è½¬æ¢æˆæŒ‡å®šçš„æ ¼å¼æäº¤ç»™åˆ«äººï¼ˆå‰ç«¯ï¼‰
    *   æ¯”å¦‚pythonä¸­çš„å­—å…¸ï¼Œåˆ—è¡¨ï¼Œå¯¹è±¡ç­‰è½¬jsonï¼Œxmlï¼ŒpropÂ·Â·Â·Â·
*   **ååºåˆ—åŒ–**ï¼šæŠŠåˆ«äººæä¾›çš„æ•°æ®è½¬æ¢æˆæˆ‘ä»¬æ‰€éœ€çš„æ ¼å¼
    *   æœ€å¸¸è§çš„æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨jsonæ¨¡å—æ¥å¯¹æ•°æ®è¿›è¡Œå¤„ç†Â·Â·Â·Â·

**åœ¨Djangorestframeworkä¸­çš„åºåˆ—åŒ–ååºåˆ—åŒ–åˆæ˜¯å¦‚ä½•ï¼Ÿ**

*   **åºåˆ—åŒ–ï¼š** åœ¨Djangoä¸­è·å–åˆ°çš„æ•°æ®é»˜è®¤æ˜¯æ¨¡å‹å¯¹è±¡ï¼ˆQuerySetå¯¹è±¡ï¼‰ï¼Œä½†æ˜¯æ¨¡å‹å¯¹è±¡æ•°æ®æ— æ³•ç›´æ¥æä¾›ç»™å‰ç«¯æˆ–åˆ«çš„å¹³å°ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®è¿›è¡Œåºåˆ—åŒ–ï¼Œå˜æˆå­—ç¬¦ä¸²æˆ–jsonæ•°æ®æä¾›ç»™å‰ç«¯æˆ–å…¶ä»–å¹³å°ï¼›
*   **ååºåˆ—åŒ–**ï¼š å‰ç«¯æˆ–å…¶ä»–å¹³å°ä¼ å…¥æ•°æ®åˆ°åå°ï¼Œæ¯”å¦‚æ˜¯jsonæ ¼å¼å­—ç¬¦ä¸²ï¼Œåç«¯éœ€è¦å­˜å…¥æ•°æ®åº“ï¼Œéœ€è¦è½¬æ¢æˆpythonä¸­çš„å¯¹è±¡ï¼Œç„¶åå¤„ç†å­˜å…¥æ•°æ®åº“ï¼›
*   **æ€»ç»“ï¼š**
    *   pythonå¯¹è±¡ -----ã€‹jsonæ ¼å¼å­—ç¬¦ä¸² ï¼ˆåºåˆ—åŒ–ï¼‰
    *   jsonæ ¼å¼å­—ç¬¦ä¸² -----ã€‹ python å¯¹è±¡ ï¼ˆååºåˆ—åŒ–ï¼‰

> å¦‚ä½•ä½¿ç”¨DRFå¿«é€Ÿå†™å‡ºå¢åˆ æŸ¥æ”¹çš„æ¥å£ï¼Ÿ

drfå¿«é€Ÿä½¿ç”¨
-------

> å¿«é€Ÿå†™5ä¸ªæ¥å£
> 
> ä½¿ç”¨Djangoå†™äº”ä¸ªæ¥å£å¾—é…5ä¸ªè·¯ç”±ï¼Œ5ä¸ªè§†å›¾å‡½æ•°å»å¤„ç†ï¼Œç°åœ¨ä½¿ç”¨drfä¸éœ€è¦äº†ï¼Œå¦‚ä¸‹ï¼š

    -æŸ¥è¯¢æ‰€æœ‰---ã€‹get->http://127.0.0.1:8000/books/
    -æŸ¥è¯¢ä¸€ä¸ª---ã€‹get->http://127.0.0.1:8000/books/1/
    -æ–°å¢ä¸€ä¸ª---ã€‹post->http://127.0.0.1:8000/books/  #åœ¨bodyä¸­å¸¦æ•°æ®
    -ä¿®æ”¹-----ã€‹putï¼Œpatch--->å®é™…ç¼–ç ä¸­ï¼ŒåŸºæœ¬éƒ½ç”¨put
      	http://127.0.0.1:8000/books/1/ bodyä½“ä¸­ä¼ å…¥ä¿®æ”¹çš„æ•°æ®
    -åˆ é™¤ä¸€ä¸ª---ã€‹delete-->http://127.0.0.1:8000/books/1/
            
    '''æ¥å£éƒ½æ˜¯è¿™äº”ä¸ªçš„å˜å½¢'''
    ç™»å½•å°±æ˜¯æŸ¥è¯¢ä¸€ä¸ªï¼Œæ³¨å†Œå°±æ˜¯æ–°å¢ä¸€ä¸ª
    '''
    åœ¨æˆ‘ä»¬ä½¿ç”¨postmançš„æ—¶å€™ï¼Œåœ°å€ä¸¥æ ¼å†™ï¼Œä¸èƒ½ç¼ºå°‘/
    '''
    

### views.py

    from rest_framework.viewsets import ModelViewSet
    from app import models
    from app.serializer import  BookSerializer
    class BookView(ModelViewSet):
        serializer_class =BookSerializer
        queryset = models.Book.objects.all()
    

### serializer.py

    from rest_framework.serializers import ModelSerializer
    from app import models
    class BookSerializer(ModelSerializer):
        class Meta:
            model = models.Book
            fields = '__all__'
    
    

### urls.py

    from rest_framework.routers import SimpleRouter
    from app import views
    
    router = SimpleRouter()
    router.register('books', views.BookView)
    '''
    register(prefix, viewset, base_name)
    prefix è¯¥è§†å›¾é›†çš„è·¯ç”±å‰ç¼€
    viewset è§†å›¾é›†
    base_name è·¯ç”±åç§°çš„å‰ç¼€
    '''
    urlpatterns = [
        path('admin/', admin.site.urls),
    ]
    urlpatterns += router.urls
    
    # åƒä¸‡æ³¨æ„åˆ«æŠŠæ³¨é‡Šå†™åˆ°urlpatternsåˆ—è¡¨ä¸­ï¼Œé‚£æ ·å°±ä¸æ˜¯æ³¨é‡Šäº†ï¼Œæˆå­—ç¬¦ä¸²äº†ï¼ï¼ï¼
    

### åœ¨settingsçš„appä¸­æ³¨å†Œ

    INSTALLED_APPS = [
        'rest_framework'
    ]
    

### models.py

    from django.db import models
    
    class Book(models.Model):
        title = models.CharField(max_length=32)
        price = models.DecimalField(max_digits=5,decimal_places=2)
        authors = models.CharField(max_length=32)
    

### postmanæµ‹è¯•

> è·å–æ‰€æœ‰

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329233245503-2084317608.png)

> è·å–ä¸€æ¡

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329233249965-1324608285.png)

> æ–°å¢ä¸€æ¡æ•°æ®

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329233255781-706040797.png)

> å…¨éƒ¨ä¿®æ”¹ï¼šä¿®æ”¹idä¸º1çš„æ•°æ®ï¼Œè¿™é‡Œå°½é‡åœ¨bodyä½“é‡Œå†™å…¨å‚æ•°

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329233304449-124685932.png)

> å±€éƒ¨ä¿®æ”¹ï¼šä¿®æ”¹idä¸º1çš„æ•°æ®ï¼Œä¿®æ”¹å•¥å†™å•¥

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329233316773-2132893273.png)

> åˆ é™¤ä¸€æ¡æ•°æ®ï¼šåˆ é™¤idä¸º2çš„æ•°æ®

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329233323459-1063779724.png)

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329233328877-1341929172.png)

* * *

CBVæºç æµç¨‹åˆ†æ
=========

> å› ä¸ºDRFæ¡†æ¶é‡Œå¤§éƒ¨åˆ†éƒ½æ˜¯åŸºäºCBV(è§†å›¾ç±»)å†™ï¼Œæ‰€ä»¥æµç¨‹æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•æ‰§è¡Œéœ€è¦äº†è§£ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿ç†è§£APIViewï¼Œé¡ºä¾¿æä¸€å˜´APIViewä¹Ÿæ˜¯ç»§æ‰¿äº†View ----> `class APIView(View)`
> 
> è¿™é‡Œéœ€è¦å¼ºè°ƒä¸€ä¸‹ï¼ŒCBVè·¯ç”±å½’æ ¹ç»“åº•è¿˜æ˜¯FBVéƒ½æ˜¯å‡½æ•°çš„å†…å­˜åœ°å€ï¼Œæ¯”å¦‚`views.ç±».as_view()`åº•å±‚ä»ç„¶æ˜¯å‡½æ•°çš„å†…å­˜åœ°å€

**CBVæºç æ‰§è¡Œæµç¨‹**

    '''views.py'''
    from django.views import View
    from django.http import HttpResponse
    
    class TestView(View):
        def get(self,request):
            return HttpResponse('getè¯·æ±‚')
        # post csrfè®¤è¯æ³¨é‡Šæ‰å°±å¥½äº†
    	def post(self,request):
            return HttpResponse('postè¯·æ±‚')
    '''urls.py'''
    path('test/',views.TestView.as_view())
    

å†™ä¸€ä¸ªè§†å›¾ç±»ï¼Œå†™äº†getæ–¹æ³•å’Œpostæ–¹æ³•ï¼Œæ¥äº†getè¯·æ±‚å°±èµ°getæ–¹æ³•ï¼Œæ¥äº†postè¯·æ±‚å°±èµ°postæ–¹æ³•ï¼Œè¿‡ç¨‹å¦‚ä½•ï¼Ÿä¸”çœ‹åˆ†ææºç æ‰§è¡Œè¿‡ç¨‹~

    '''è¯·æ±‚æ¥äº†åœ¨ä¸è€ƒè™‘ä¸­é—´ä»¶çš„æƒ…å†µä¸‹ï¼Œä»è·¯ç”±çš„åŒ¹é…å…³ç³»å’Œè§†å›¾å‡½æ•°æ¥çœ‹'''
    1ã€cbvè·¯ç”±å†™æ³•ï¼špath('test/', views.TestView.as_view())
    # ç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°å†…å­˜åœ°å€ï¼ŒCBVçš„åº•å±‚ä¹Ÿæ˜¯FBVï¼Œas_viewæ˜¯ç±»çš„ç»‘å®šæ–¹æ³•ï¼Œè‡ªå·±çš„ç±»ä¸­æ²¡æœ‰å»çˆ¶ç±»(View)æ‰¾ï¼Œas_view()æ‰§è¡Œå®Œï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œå†…å­˜åœ°å€æ˜¯è°çš„ï¼Ÿæ˜¯é—­åŒ…å‡½æ•°viewçš„å¦‚ä¸‹æºç ğŸ‘‡
    @classonlymethod
        def as_view(cls, **initkwargs):
            Â·Â·Â·
            def view(request, *args, **kwargs):
                Â·Â·Â·
                return self.dispatch(request, *args, **kwargs)
            Â·Â·Â·
            return view
    # @classonlymethodé€šè¿‡æè¿°ç¬¦è‡ªå®šä¹‰è£…é¥°å™¨
    
    2ã€è¯·æ±‚æ¥äº†ï¼Œè·¯ç”±ä¹ŸåŒ¹é…æˆåŠŸï¼Œæ‰§è¡Œä¸Šè¾¹è¿”å›çš„view(requets)ï¼ŒåŠ æ‹¬å·è°ƒç”¨ï¼Œå¹¶ä¸”ä¼ å…¥äº†å½“æ¬¡è¯·æ±‚çš„requestå¯¹è±¡
    
    3ã€ç„¶ååˆè¿”å›äº†å½“å‰å¯¹è±¡çš„dispatchæ–¹æ³•ï¼Œè‡ªå·±çš„åç§°ç©ºé—´å†…æ²¡æœ‰ï¼Œé‚£ä¹ˆå»çˆ¶ç±»ä¸­æ‰¾ï¼Œç„¶åå‘ç°çˆ¶ç±»ï¼ˆViewï¼‰çš„dispatchæ–¹æ³•è¿”å›äº†return handler(request, *args, **kwargs)
    
    4ã€dispatchæ–¹æ³•å¤„ç†è¯·æ±‚ï¼Œä»€ä¹ˆè¯·æ±‚å¯¹åº”ä»€ä¹ˆæ–¹æ³•
    # çˆ¶ç±»dispatchæ–¹æ³•ï¼š
        def dispatch(self, request, *args, **kwargs):
            # è¯·æ±‚æ–¹æ³•å°å†™å¦‚æœåœ¨å½“å‰å¯¹è±¡çš„http_method_namesä¸­ï¼ˆå…«ä¸ªè¯·æ±‚æ–¹æ³•ï¼‰
        '''
            http_method_names = ['get', 'post', 'put', 'patch', 'delete', 'head', 'options', 'trace']
            '''
            if request.method.lower() in self.http_method_names:
                # å¦‚æœæˆç«‹ï¼Œé‚£ä¹ˆæ‰§è¡Œä¸‹é¢çš„åå°„ï¼Œä»å½“å‰å¯¹è±¡ï¼ˆè§†å›¾ç±»çš„å¯¹è±¡ï¼‰æ‹¿åˆ°è¯·æ±‚æ–¹æ³•ï¼Œå¦‚æœæ˜¯getè¯·æ±‚å°±æ‹¿åˆ°getæ–¹æ³•ï¼Œpostè¯·æ±‚å°±æ‹¿åˆ°postæ–¹æ³•ï¼Œç„¶åèµ‹ç»™handlerï¼Œhandlerå°±æ˜¯ç›¸åº”è¯·æ±‚å¯¹åº”çš„æ–¹æ³•ï¼Œæœ€åè¿”å›handler(request)ï¼Œæœ¬è´¨å…¶å®æ˜¯get(request)
                handler = getattr(self, request.method.lower(), self.http_method_not_allowed)
            else:
                # ä¸æˆç«‹ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è¯¥è¯·æ±‚å¯¹åº”çš„æ–¹æ³•ï¼Œæ‰§è¡Œhttp_method_not_allowedæ–¹æ³•ï¼Œå¼¹å‡ºè­¦å‘Š
                handler = self.http_method_not_allowed
            return handler(request, *args, **kwargs)
    
     
    
    
    # http_method_not_allowedæºç   
    def http_method_not_allowed(self, request, *args, **kwargs):
        logger.warning(
            'Method Not Allowed (%s): %s', request.method, request.path,
            extra={'status_code': 405, 'request': request}
        )
        return HttpResponseNotAllowed(self._allowed_methods())
    

*   `getattr(obj,pro,None)`ï¼šæŒ‰proåˆ¤æ–­æ˜¯å¦æœ‰æ— obj.proå±æ€§ï¼Œæ²¡æœ‰è¿”å›Noneï¼ŒNoneå¯ä»¥è‡ªå®šåˆ¶
*   åå°„å¿˜è®°çš„å¯ä»¥çœ‹ä¿ºçš„è¿™ç¯‡åšå®¢ï¼š[python å¤šæ€ã€ç»„åˆã€åå°„](https://www.cnblogs.com/48xz/p/15658365.html#%E5%8F%8D%E5%B0%84)

Django Viewå’ŒDRF APIViewçš„å°æ’æ›²
===========================

*   DRFä¸­æœ€â€œç‰›é€¼â€çš„è§†å›¾ç±»æ˜¯`APIView`ï¼Œä¸è¿‡ä¹Ÿç»§æ‰¿äº†`View`
    
*   å¯¼å…¥ï¼š`from rest_framework.views import APIView`
    
*   Djangoä¸­æœ€â€œç‰›é€¼â€çš„è§†å›¾ç±»æ˜¯`View`
    
*   å¯¼å…¥ï¼š
    
        from django.views import View # æœ€ç®€
        from django.views.generic import View  
        from django.views.generic.base import View  # æœ€å®Œæ•´
        
        '''è¿™ä¸‰ä¸ªå¯¼å…¥çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ªViewï¼Œæƒ³çŸ¥é“ç¼˜ç”±è¿˜å¾—çœ‹æºç å’Œç›®å½•ç»“æ„ï¼Œå¦‚ä¸‹ï¼š'''
        # ç›®å½•ç»“æ„
        -django
        -Â·Â·Â·  # æ­¤å¤„çœç•¥nä¸ªåŒ…
        -views
        -- __init__.py
        -- generic
        ---- __init__.py
        ---- base.py
        # æºç åˆ†æ
        '''é—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸Šè¿°ä¸åŒçš„pyæ–‡ä»¶éƒ½å¯ä»¥æŒ‡å‘åŒä¸€ä¸ªç±»ï¼Ÿ'''
        æˆ‘çš„æ€è·¯æ˜¯ç¾Šæ¯›å‡ºåœ¨ç¾Šèº«ä¸Šï¼Œæ—¢ç„¶éƒ½æŒ‡å‘ç±»ï¼Œé‚£ä¹ˆä»ç»“æœå‡ºå‘æ˜¯ä¸æ˜¯æ›´å¥½
        1ã€Viewç±»åœ¨base.pyä¸­ï¼Œé‚£ä¹ˆæ˜¾è€Œæ˜“è§æœ€å®Œæ•´çš„å¯¼å…¥æ˜¯æ²¡é—®é¢˜çš„ï¼Œé‡ç‚¹æ˜¯ä¸ºä»€ä¹ˆç®€å†™ä¹Ÿå¯ä»¥
        2ã€base.pyæ‰€åœ¨çš„åŒ…genericï¼Œå¦‚æœä»åŒ…ä¸­å¯¼å…¥pyæ–‡ä»¶æˆ‘ä»¬çŸ¥é“å¯ä»¥é€šè¿‡â€œç™½åå•â€__all__æ¥æŒ‡å®šè°å¯ä»¥è¢«å…¶ä»–æ–‡ä»¶å¯¼å…¥ï¼Œæˆ‘ä»¬å‘ç°genericåŒ…ä¸­æŒ‡å®šäº†ï¼š
        from django.views.generic.base import RedirectView, TemplateView, Viewå’Œ__all__ = [ 'View',Â·Â·Â·Â·Â·]ï¼Œåˆ°æ­¤ç¬¬äºŒä¸ªå¯¼å…¥è§£å†³
        
        # é‚£ä¹ˆç¬¬ä¸€ä¸ªè¿™ä¹ˆçŸ­è¿™ä¹ˆç®€å•åˆæ˜¯ä¸ºå•¥ï¼Ÿ
        3ã€åŒæ ·åœ¨viewsåŒ…çš„__init__.pyæ–‡ä»¶ä¸­å‘ç°ï¼š
        from django.views.generic.base import View
        __all__ = ['View']
        Viewç±»è¢«__all__å˜é‡åŒ…è£¹äº†
        
    

psï¼šä¸ç®¡æ˜¯DRFä¸­çš„APIViewè¿˜æ˜¯ä¹±ä¸ƒå…«ç³Ÿçš„xxViewï¼Œæœ€ååªè¦ç»§æ‰¿äº†Djangoä¸­çš„Viewå°±æ˜¯è§†å›¾ç±»

DRFä¹‹APIViewå’ŒRequestå¯¹è±¡åˆ†æ
=======================

APIViewçš„æ‰§è¡Œæµç¨‹
------------

    # åŒæ ·å’ŒDjangoä¸­ä¸€æ ·å†™ä¸€ä¸ªè§†å›¾ç±»ï¼Œåªä¸è¿‡DRFä¸­ç”¨APIViewåº•å±‚è¿˜æ˜¯View
    '''views.py'''
    from rest_framework.response import Response
    class Test(APIView):
        def get(self, request):
            data = {'status': 200, 'msg': 'success'}
            return Response(data)
    
        def post(self, request):
            data = {'status': 200, 'msg': 'success'}
            return Response(data)
    '''urls.py'''
    path('test/', views.Test.as_view())
    

> **APIViewæµç¨‹æºç åˆ†æ**

    1ã€è·¯ç”±ï¼špath('test/', views.Test.as_view())ï¼Œpathç¬¬äºŒä¸ªå‚æ•°ä»»ç„¶è¿”å›å‡½æ•°å†…å­˜åœ°å€ï¼Œä¹Ÿè¿˜æ˜¯ç±»ç»‘å®šæ–¹æ³•ï¼ŒTestæ²¡æœ‰as_viewæ–¹æ³•ï¼Œå»ç»§æ‰¿çš„APIViewä¸­æ‰¾ï¼Œè¿™æ¬¡ä¸éœ€è¦å’ŒDjangoä¸€æ ·å»Viewä¸­æ‰¾äº†ï¼Œåº†å¹¸çš„æ˜¯APIViewä¸­æœ‰as_viewæ–¹æ³•ï¼Œæ ¸å¿ƒæºç å¦‚ä¸‹ï¼š
    
    @classmethod
        def as_view(cls, **initkwargs):
            # æ ¡éªŒåå°„çš„ç»“æœ
             if isinstance(getattr(cls, 'queryset', None), models.query.QuerySet):
                def force_evaluation():
                    raise RuntimeError(
                        'Do not evaluate the `.queryset` attribute directly, 'Â·Â·Â·Â·
                    )
               Â·Â·Â·
            
            # æ ¸å¿ƒä»£ç 
            # è¿™é‡Œè°ƒç”¨äº†çˆ¶ç±»çš„as_viewï¼ŒæŸ¥çœ‹æºç å‘ç°åˆå›åˆ°äº†Djangoä¸­çš„Viewç±»ï¼Œæ‰€ä»¥æœ¬è´¨è¿˜æ˜¯å’Œä¸Šé¢ä¸€æ ·ï¼Œç”¨åˆ°äº†é—­åŒ…è¿”å›çš„view
            view = super().as_view(**initkwargs)
    		Â·Â·Â·
            # å±€éƒ¨å»æ‰äº†csrfæ ¡éªŒå’ŒåŠ è£…é¥°å™¨çš„æ•ˆæœæ˜¯ä¸€æ ·çš„
            return csrf_exempt(view)
    
    2ã€view = super().as_view(**initkwargs)ï¼Œè¿™é‡Œè·³è½¬äº†ä¸€ä¸‹ï¼Œå…¶å®çœ‹äº†çˆ¶ç±»ï¼ˆViewï¼‰çš„æºç æ˜¯å’Œä¸Šé¢Djangoä¸­å†™è§†å›¾ç±»ç»§æ‰¿çš„Viewæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œçš„ï¼ˆAPIViewï¼‰çš„as_viewåªæ˜¯è¿›è¡Œäº†ç®€å•å¤„ç†å’Œå»æ‰äº†csrfä¸­é—´ä»¶æ ¡éªŒï¼ŒçœŸå®ä½¿ç”¨çš„è¿˜æ˜¯Viewç±»ä¸­çš„as_view
    3ã€ç„¶åè¿˜æ˜¯é—­åŒ…å‡½æ•°çš„è¿”å›å€¼viewåŠ æ‹¬å·è°ƒç”¨ï¼Œä¼ å…¥äº†å½“å‰å¯¹è±¡çš„requestï¼Œç»§ç»­æ‰§è¡Œäº†self.dicpatch()ï¼Œå½“å‰ç±»ï¼ˆTestï¼‰æ²¡æœ‰å»çˆ¶ç±»ï¼ˆAPIviewï¼‰æ‰¾dispatchæ–¹æ³•ï¼Œå‘ç°APIViewç±»ä¸­æœ‰ï¼Œåƒä¸‡æ³¨æ„äº†è¿™é‡Œå¯ä¸æ˜¯Viewä¸­çš„dispatchæ–¹æ³•äº†
    4ã€APIViewç±»ä¸­çš„dispatchä¸»è¦æºç ï¼š
    # APIViewçš„dispatch
      def dispatch(self, request, *args, **kwargs):
        	  # requestæ˜¯æ–°çš„drfæä¾›çš„requestï¼Œå®ƒæ˜¯ç”±è€çš„djangoçš„requestå¾—åˆ°çš„
          	# é€šè¿‡è€requestï¼Œç”Ÿæˆä¸€ä¸ªæ–°requestï¼Œdrfçš„Requestçš„å¯¹è±¡
            request = self.initialize_request(request, *args, **kwargs)
            # æŠŠæ–°çš„requestï¼Œæ”¾åˆ°äº†è§†å›¾ç±»å¯¹è±¡ä¸­ï¼Œå¯ä»¥é€šè¿‡selfè°ƒç”¨æ–°çš„requestå’Œä¼ å…¥çš„requestæ˜¯ä¸€ä¸ªï¼Œå› ä¸ºæ”¾åˆ°äº†selfä¸­
            self.request = request
            try:
               # æ‰§è¡Œäº†ä¸‰å¤§è®¤è¯(è®¤è¯ï¼Œæƒé™ï¼Œé¢‘ç‡)
                self.initial(request, *args, **kwargs)
                # self.http_method_namesæ˜¯ä¸ªåˆ—è¡¨
                if request.method.lower() in self.http_method_names:
                  	# åŸæ¥dispatchçš„æ ¸å¿ƒä»£ç 
                    handler = getattr(self, request.method.lower(),
                                      self.http_method_not_allowed)
                else:
                    handler = self.http_method_not_allowed
                # åŸæ¥dispatchå†™çš„ï¼Œä½†æ˜¯requestå·²ç»ä¸æ˜¯è€requestäº†ï¼Œæ˜¯æ–°çš„
                response = handler(request, *args, **kwargs) # æ‰§è¡Œè§†å›¾å‡½æ•°çš„æ–¹æ³•
            except Exception as exc:
              	# æ— è®ºåœ¨ä¸‰å¤§è®¤è¯è¿‡ç¨‹ä¸­è¿˜æ˜¯æ‰§è¡Œè§†å›¾å‡½æ•°æ–¹æ³•è¿‡ç¨‹ä¸­ï¼Œåªè¦æŠ›äº†å¼‚å¸¸ï¼Œéƒ½ä¼šè¢«æ•è·åˆ°
                # å¤„ç†å…¨å±€å¼‚å¸¸
                response = self.handle_exception(exc)
    
            self.response = self.finalize_response(request, response, *args, **kwargs)
            return self.response
        
        
    æ€»ç»“ï¼š
    1ã€è·¯ç”±ï¼špath('test/', views.Test.as_view())
    2ã€APIViewç±»çš„as_viewæ‰§è¡Œï¼Œæœ€ç»ˆä½¿ç”¨Viewç±»çš„as_view
    3ã€æ‰§è¡Œé—­åŒ…è¿”å›viewåŠ æ‹¬å·è°ƒç”¨åˆ°æ­¤å°±æ˜¯as_viewåŠ æ‹¬å·è°ƒç”¨
    4ã€è°ƒç”¨æ‰§è¡Œäº†view()è¿”å›dispatchï¼Œä½†æ˜¯è¿™é‡Œçš„çˆ¶ç±»ä¸æ˜¯Viewï¼Œæ˜¯APIviewæ‰€ä»¥æ‰§è¡Œçš„dispatchæ˜¯APIViewä¸­çš„dispatchæ–¹æ³•
    5ã€dispatchæ–¹æ³•ä¸­åŒ…è£…äº†æ–°çš„Requestå¯¹è±¡ï¼Œä»¥åè§†å›¾ç±»ä¸­çš„æ–¹æ³•ä¼ å…¥çš„requestéƒ½æ˜¯æ–°çš„ï¼Œæ— è®ºä¸‰å¤§è®¤è¯è¿˜æ˜¯è§†å›¾å‡½æ•°çš„æ–¹æ³•ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºäº†å¼‚å¸¸ï¼Œéƒ½ä¼šè¢«å¤„ç†æ‰
    6ã€dispatchæ‰§è¡Œå®Œæ¯•è¿”å›reponseå¯¹è±¡ï¼Œè·³è½¬å›è¿›å…¥è§†å›¾å‡½æ•°ç»§ç»­æ‰§è¡Œas_viewå»æ‰äº†csrfæ ¡éªŒ
    

> **å¦‚ä½•åŒ…è£…äº†æ–°çš„requestï¼Ÿ**

    # APIViewä¸­çš„dispatchæ–¹æ³•å¤„ç†è€çš„request
    request = self.initialize_request(request, *args, **kwargs)
    
    # initialize_requestæ–¹æ³•ï¼Œå½“å‰ç±»ï¼ˆè‡ªå·±å†™çš„ï¼‰æ²¡æœ‰å»çˆ¶ç±»æ‰¾ï¼Œè¿˜æ˜¯APIView
     def initialize_request(self, request, *args, **kwargs):
            """
            Returns the initial request object.
            """
            parser_context = self.get_parser_context(request)
    
            return Request(
                request, # è€çš„requestï¼Œä¼ å…¥çš„éå¤„ç†çš„ï¼Œè¿”å›åå°±æ˜¯æ–°çš„äº†
                parsers=self.get_parsers(),
                authenticators=self.get_authenticators(),
                negotiator=self.get_content_negotiator(),
                parser_context=parser_context
            )
    æ³¨æ„ï¼šä¸Šé¢è¿”å›çš„Requestå¯¹è±¡æ˜¯rest_frameworkå¯¼å…¥çš„ï¼Œç„¶åå®ä¾‹åŒ–åè¿”å›çš„ï¼Œå®ä¾‹åŒ–å°±å°‘ä¸äº†__init__æ„é€ å‡½æ•°
    from rest_framework.request import Request
    '''Requestç±»'''
    class Request:
        # è¿™é‡Œå³å°†è¦åˆå§‹åŒ–çš„requestæ˜¯ä¼ å…¥çš„è€çš„request
         def __init__(self, request, parsers=None, authenticators=None,negotiator=None, parser_context=None):
         Â·Â·Â· 
         # åˆå§‹åŒ–ï¼Œå°†ä¼ å…¥çš„è€çš„requestæ”¾å…¥æ–°çš„_requestä¸­ï¼Œæ‰€ä»¥request._requestæ˜¯è€çš„ï¼Œself.request._requestç­‰ä»·äºrequest._request
    	    self._request = request
          Â·Â·Â·
        
    # éªŒè¯ä¸€ä¸‹æ–°è€request
    class Test(APIView):
        def get(self, request):
            data = {'status': 200, 'msg': 'success'}
            # æ–°çš„request
            print(type(request)) # <class 'rest_framework.request.Request'>
            print(type(self.request))# <class 'rest_framework.request.Request'>
            # è€çš„request
            print(type(self.request._request)) # <class 'django.core.handlers.wsgi.WSGIRequest'>
            print(type(request._request)) # <class 'django.core.handlers.wsgi.WSGIRequest'>
            return Response(data)
        
    æ–°çš„ï¼š<class 'rest_framework.request.Request'>
    è€çš„ï¼š<class 'django.core.handlers.wsgi.WSGIRequest'>
    

> **ä¸‰å¤§è®¤è¯å¦‚ä½•æ‰§è¡Œï¼Ÿ**

    # APIViewç±»å¤„ç†ä¸‰å¤§è®¤è¯
    self.initial(request, *args, **kwargs)
    # æ ¸å¿ƒæºç 
    def initial(self, request, *args, **kwargs):
        Â·Â·Â·Â·
        self.perform_authentication(request) # è®¤è¯
        self.check_permissions(request) # æƒé™
        self.check_throttles(request) # é¢‘ç‡
        Â·Â·Â·
    # ç»è¿‡äº†ä¸‰å¤§è®¤è¯æ‰è¿›å…¥äº†è§†å›¾å‡½æ•°
    ä¸­é—´ä»¶---è·¯ç”±---Â·Â·Â·---ä¸‰å¤§è®¤è¯---è§†å›¾å‡½æ•°Â·Â·Â·Â·
    # ç±»ä¼¼äºŒæ¬¡æ ¡éªŒ
    

Requestå¯¹è±¡åˆ†æ
-----------

> è¿™é‡Œæ˜¯ç»è¿‡åŒ…è£…åçš„request

**rest\_framework.request.Requestå¸¸ç”¨å±æ€§å’Œæ–¹æ³•**

è¿™é‡Œçš„requestå’ŒåŸæ¥çš„Djangoä½¿ç”¨requestä¸€æ ·ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ª`request.data`

*   **request.data**ï¼š_å‰ç«¯POSTæäº¤çš„æ•°æ®ï¼Œå¯ä»¥å¤„ç†å¤šç§æ ¼å¼çš„æ•°æ®ï¼Œæ— è®ºå‰ç«¯ä¼ ä»€ä¹ˆç¼–ç postæäº¤çš„æ•°æ®éƒ½åœ¨dataä¸­_
    
    psï¼šåŸæ¥æäº¤çš„æ•°æ®åœ¨request.POSTé‡Œï¼Œæœ‰å±€é™æ€§åªèƒ½å¤„ç†urlencodedå’Œformdataç¼–ç æ ¼å¼ï¼Œjsonæ ¼å¼ä¸èƒ½å¤„ç†ï¼Œæ˜¯æ²¡æœ‰`request.data`çš„ï¼Œrequestå…¶ä½™ä½¿ç”¨æ–¹æ³•çš„éƒ½ä¸€æ ·
    

    # å¦‚æœç”¨è¿‡æ–°åŒ…è£…è¿‡çš„requestæ¥è°ƒç”¨åŸæ¥çš„æ–¹æ³•å‘¢ï¼Ÿè¿™æ ·ç»™ä½¿ç”¨è€…çš„æ„Ÿè§‰ç¡®å®æ²¡ä»€ä¹ˆå˜åŒ–æºç å¦‚ä¸‹ï¼š
    '''é‡å†™äº†getattr'''
        def __getattr__(self, attr):
            try:
                return getattr(self._request, attr)
            except AttributeError:
                return self.__getattribute__(attr)
    
    é‡å†™getattrçš„ç»“æœæ˜¯ï¼Œæ–°çš„request.methodæ‰§è¡Œçš„æ—¶å€™æœ¬è´¨æ˜¯request._request.methodæ‰§è¡Œäº†åŸæ¥è€çš„requestçš„æ–¹æ³•ï¼Œé€šè¿‡è¿™å¥getattr(self._request, attr)åå°„ï¼Œæ‰€ä»¥æ‰ä¸€æ ·
    

**æ€»ç»“**ï¼š**æ–°çš„requestå½“è€çš„ç”¨å³å¯ï¼Œåªæ˜¯å¤šäº†ä¸ªdataå‰ç«¯postè¯·æ±‚ä¼ å…¥çš„æ•°æ®,ä¸‰ç§ç¼–ç æ ¼å¼éƒ½å¯ä»¥è·å–**

> éªŒè¯å¤„ç†ä¸‰ç§ç¼–ç æ ¼å¼

*   jsonæ ¼å¼ï¼Œåªæœ‰request.dataå¯ä»¥è·å–ï¼Œç»“æœæ˜¯å­—å…¸
*   form-dataæ ¼å¼å’Œurlencodeæ ¼å¼éƒ½å¯ä»¥è·å–å¹¶ä¸”æ˜¯QueryDictå¯¹è±¡

    from rest_framework.response import Response
    class Test(APIView):
        def post(self, request):
            data = {'status': 200, 'msg': 'success'}
            print(request.POST)
            print(request._request.POST)
            print(request.data)
            return Response(data)
    

> éªŒè¯

    # form-dataæ ¼å¼ç»“æœ
    <QueryDict: {'name': ['hammer']}>
    <QueryDict: {'name': ['hammer']}>
    <QueryDict: {'name': ['hammer']}>
    # urlencodeæ ¼å¼ç»“æœ
    <QueryDict: {'name': ['hammer']}>
    <QueryDict: {'name': ['hammer']}>
    <QueryDict: {'name': ['hammer']}>
    # jsonæ ¼å¼ç»“æœ
    <QueryDict: {}>
    <QueryDict: {}>
    {'name': 'Hammer'}
    

> å®˜ç½‘çš„ä¸€äº›è§£é‡Š

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329233205926-873161841.png)

åŸæ¥çš„djangoä¸­æ²¡æœ‰request.dataï¼Œé€ ä¸€ä¸ªï¼
-----------------------------

    # åŸæ¥çš„djangoçš„requestå¯¹è±¡ä¸­æ²¡æœ‰data,ä½¿å¾—request.data-->æ— è®ºä»€ä¹ˆç¼–ç æ ¼å¼ï¼Œpostæäº¤æ•°æ®ï¼Œdataéƒ½æœ‰å€¼
    from django.views import View
    from django.http import HttpResponse
    from django.utils.decorators import method_decorator
    from functools import wraps
    def outter(func):
        @wraps(func)
        def inner(request,*args,**kwargs):
            import json
            if request.POST:
                request.data = request.POST
            else:
                # å°†request.bodyä»jsonå¯¹è±¡è½¬æ¢ä¸ºå­—å…¸
                request.data = json.loads(request.body)
            res = func(request,*args,**kwargs)
            return res
        return inner
    
    @method_decorator(outter,name='post')
    class TestView(View):
        def get(self, request):
            return HttpResponse('getè¯·æ±‚')
    
        
        def post(self, request):
       		# åªæµ‹è¯•äº†jsonæ ¼å¼å…¶ä½™éƒ½å¯ä»¥ä¹Ÿæµ‹äº†
            print(request.data) # {'name': 'Hammer'}
            print(request.POST)  # <QueryDict: {}>
            return HttpResponse('postè¯·æ±‚')
    

çµæ„Ÿæ¥æºï¼š[ä¼ é€é—¨](https://blog.csdn.net/qq_44614115/article/details/114109757)