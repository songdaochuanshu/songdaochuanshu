---
layout: post
title: "Pythonå…¨æ ˆå·¥ç¨‹å¸ˆä¹‹ä»ç½‘é¡µæ­å»ºå…¥é—¨åˆ°Flaskå…¨æ ˆé¡¹ç›®å®æˆ˜(5) - Flaskä¸­çš„ORMä½¿ç”¨"
date: "2022-12-08T21:15:17.429Z"
---
Pythonå…¨æ ˆå·¥ç¨‹å¸ˆä¹‹ä»ç½‘é¡µæ­å»ºå…¥é—¨åˆ°Flaskå…¨æ ˆé¡¹ç›®å®æˆ˜(5) - Flaskä¸­çš„ORMä½¿ç”¨
=================================================

1.ç†è§£ORM
-------

*   ORMæ˜¯MTVæ¨¡å‹é‡Œé¢çš„Modelæ¨¡å‹
*   ORM(Object Relational Mapping)ï¼Œå¯¹è±¡å…³ç³»æ˜ å°„
*   ä¸¾ä¾‹ï¼šå­¦ç”Ÿé€‰è¯¾

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221206162613804-1584374739.png)

å­¦ç”Ÿå’Œè¯¾ç¨‹è¿™ä¸¤ä¸ªå®ä½“ï¼Œä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰æ‹©å¤šé—¨è¯¾ç¨‹ï¼Œä¸€ä¸ªè¯¾ç¨‹å¯ä»¥è¢«å¤šåå­¦ç”Ÿé€‰æ‹©ã€‚è¿™ä¸¤ä¸ªå®ä½“æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œå­¦ç”Ÿé€‰è¯¾å¯¹åº”çš„æ•°æ®åº“è¡¨

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221206164135524-668384350.png)

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221206164549262-2100640261.png)

**ä¸ºä»€ä¹ˆè¦å­¦ä¹ ORM**

ORMçš„é‡è¦ç‰¹æ€§

*   é¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ€æƒ³ï¼Œæ–¹ä¾¿æ‰©å……
*   å°‘å†™ï¼ˆå‡ ä¹ä¸å†™ï¼‰SQLï¼Œæå‡å¼€å‘æ•ˆç‡
*   æ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®åº“ï¼Œæ–¹ä¾¿åˆ‡æ¢
*   ORMæŠ€æœ¯æˆç†Ÿï¼Œèƒ½è§£å†³ç»å¤§éƒ¨åˆ†é—®é¢˜

2.ç¯å¢ƒå®‰è£…
------

### **2.1.Flask-sqlalchemyä»‹ç»åŠå®‰è£…**

*   PIPå®‰è£…ï¼šÂ pip install -U Flask-SQLAlchemyÂ 
*   æºç å®‰è£…ï¼šÂ python setup.py installÂ 
*   ä½¿ç”¨å›½å†…é•œåƒå®‰è£…ï¼šÂ pip install -U -i https://mirrors.aliyun.com/pypi/simple flask-sqlalchemyÂ 

**å¸¸è§å®‰è£…æŠ¥é”™ï¼š**ERROR: Could not install packages due to an OSError:

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221206170911394-774156501.png)

**è§£å†³æ–¹æ¡ˆï¼š**åœ¨pip install åé¢åŠ ä¸Š --userå³å¯

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221206171021649-884620676.png)

**å¤‡æ³¨ï¼š**å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å®‰è£…flask-sqlalchemyï¼Œè¿˜éœ€è¦å®‰è£…å®ƒæ•°æ®åº“çš„ä¾èµ–**mysqlclient**ã€‚Â pip install mysqlclientÂ 

**å®‰è£…mysqlclientå¸¸è§æŠ¥é”™ï¼š**Â error: Microsoft Visual C++ 14.0 is required. Get it with "Microsoft Visual C++ Build Tools": https://visualstudio.microsoft.com/downloads/

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221206175143774-663988446.png)

Â **è§£å†³æ–¹æ¡ˆ1ï¼š**[https://blog.csdn.net/alicee\_2012/article/details/122726986](https://blog.csdn.net/alicee_2012/article/details/122726986)

**è§£å†³æ–¹æ¡ˆ2ï¼š**[https://blog.csdn.net/weixin\_42403632/article/details/117087559](https://blog.csdn.net/weixin_42403632/article/details/117087559)(æˆ‘çš„æŠ¥é”™æ˜¯é€šè¿‡è¿™ä¸ªè§£å†³çš„)

Â å®‰è£…æˆåŠŸğŸ‘‰![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207134859666-763127727.png)

### **2.2.Flask-sqlalchemyé…ç½®**

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207143655568-456983037.png)

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207143911961-218218132.png)

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207145122318-1440658913.png)

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207145140735-571307095.png)

3.ORMçš„CURDæ“ä½œ
------------

### 3.1.è®¾è®¡æ•°æ®åº“æ¨¡å‹å¹¶åˆ›å»ºè¡¨

**æ•°æ®åº“æ¨¡å‹è®¾è®¡**

*   1ï¼‰ç»‘å®šåˆ°Flaskå¯¹è±¡ï¼šÂ db=SQLAlchemy(app)Â 
*   2ï¼‰ORMæ¨¡å‹åˆ›å»ºï¼š
    
    ![](https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif)![](https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif)
    
    class User(db.Model):
        id\=db.Column(db.Integer,primary\_key=True)
    
    View Code
    
*   3ï¼‰æŒ‡å®šè¡¨çš„åç§°ï¼šÂ \_\_tablename\_\_\='weibo\_user'Â 

**åˆ›å»ºå’Œåˆ é™¤è¡¨**

*   1ï¼‰æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“
*   2ï¼‰åˆ›å»ºè¡¨ï¼šÂ \>>> db.create\_all(bind='db1') #bind='db1'å¯ä»¥ä¸ä¼ ï¼Œå½“å­˜åœ¨éœ€è¦å¯¹å¤šä¸ªæ•°æ®åº“åˆ›å»ºè¡¨æ—¶ï¼Œéœ€è¦æ·»åŠ å¯¹åº”çš„æ•°æ®åº“å¯¹è±¡ã€‚åªæœ‰ä¸€ä¸ªåº“æ—¶ï¼Œä¸ç”¨åŠ Â 
*   3ï¼‰åˆ é™¤è¡¨ï¼šÂ \>>> db.drop\_all()Â 

**å®ä¾‹éªŒè¯ï¼š**è®¾è®¡æ•°æ®åº“æ¨¡å‹ï¼Œåˆ›å»º/åˆ é™¤è¡¨

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207163819706-1114367848.png)

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207164014647-1566134719.png)

åˆ›å»ºæŒ‡å®šåç§°çš„è¡¨

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207164517557-1734658155.png)

### 3.2.æ•°æ®åº“æ¨¡å‹è®¾è®¡

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207170308586-385622581.png)

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207170748321-1777006154.png)

**æ•°æ®åº“çš„è¡¨è‚¯å®šä¸æ­¢ä¸€å¼ ï¼ŒåŒæ—¶æ•°æ®è¡¨ä¹‹é—´éƒ½ä¼šæœ‰ä¸€äº›å…³è”å…³ç³»ï¼Œè¯¥å¦‚ä½•å®ç°ï¼Ÿ**

*   é€šè¿‡db.ForeignKey()è¿›è¡Œå¤–é”®å…³è”
*   é€šè¿‡db.relationship()è¿›è¡Œåå‘å¼•ç”¨

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207172119007-449095583.png)

 1 from flask import Flask, render\_template 2 from flask\_sqlalchemy import SQLAlchemy 3 
 4 app = Flask(\_\_name\_\_)
 5 # é…ç½®æ•°æ®åº“çš„è¿æ¥å‚æ•°
 6 app.config\['SQLALCHEMY\_DATABASE\_URI'\] = 'mysql://root:\*\*\*\*\*@\*\*\*\*\*\*\*/test\_flask'
 7 
 8 db = SQLAlchemy(app) 9 
10 
11 class User(db.Model):   #Userä¸ºæ¨¡å‹åç§°ï¼Œå³ç±»åä¸ºæ¨¡å‹åç§°
12     """ ç”¨æˆ·çš„åŸºç¡€ä¿¡æ¯ """
13     \_\_tablename\_\_ = 'weibo\_user'
14     id = db.Column(db.Integer, primary\_key=True)
15     username = db.Column(db.String(64), nullable=False)
16     password = db.Column(db.String(256), nullable=False)
17     birth\_date = db.Column(db.Date, nullable=True)
18     age = db.Column(db.Integer, default=0)
19 
20 class UserAddress(db.Model):
21     """ ç”¨æˆ·çš„åœ°å€ """
22     \_\_tablename\_\_ = 'weibo\_user\_addr'
23     id = db.Column(db.Integer, primary\_key=True)
24     addr = db.Column(db.String(256), nullable=False)
25     user\_id = db.Column(db.Integer, db.ForeignKey('weibo\_user.id'), nullable=False)   #ä½¿ç”¨db.ForeignKey()è¿›è¡Œå¤–é”®å…³è”
26     user = db.relationship('User', backref=db.backref('address', lazy=True))      #è¿™ä¸€è¡Œä»£ç ä¸ä¼šåœ¨weibo\_user\_addrè¿™å¼ è¡¨é‡Œé¢å¢åŠ ä¸€åˆ—ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬æ“ä½œæ¨¡å‹çš„æ—¶å€™å»è®¿é—®å»æŸ¥è¯¢
27     # ä½¿ç”¨db.relationship()è¿›è¡Œåå‘å¼•ç”¨ã€‚åå‘å…³è”è°å‘¢ï¼Œå…³è”Useræ¨¡å‹ï¼›å»ºç«‹ä¸€ä¸ªåå‘å¼•ç”¨backref=db.backref()ï¼Œåå‘å¼•ç”¨ç»™è°å‘¢ï¼Œç»™addressè¿™ä¸ªåå­—è‡ªå·±å®šä¹‰ï¼Œlazy=Trueå°±æ˜¯æˆ‘ä»¬æŸ¥è¯¢åˆ°æˆ‘ä»¬ç”¨æˆ·å¯¹è±¡çš„æ—¶å€™ï¼Œä¸ç›´æ¥æŠŠä»–ä¸‹é¢æ‰€æœ‰çš„åœ°å€åˆ—è¡¨ç»™ä»–æŸ¥å‡ºæ¥ï¼Œå½“æˆ‘ä»¬å»è®¿é—®çš„æ—¶å€™ï¼Œè®¿é—®ä¸‹é¢åœ°å€åˆ—è¡¨çš„æ—¶å€™å†ç»™ä»–æŸ¥å‡ºæ¥
28 
29 '''
30 æ¥ç€ä¸Šé¢ä»£ç ä¸¾ä¸ªä¾‹å­è¿›ä¸€æ­¥è§£é‡Šè¯´æ˜åå‘å¼•ç”¨ï¼š
31 UserAddressé‡Œé¢æœ‰ä¸ªåå‘å¼•ç”¨ï¼Œå¼•ç”¨çš„è°å‘¢ï¼Œå¼•ç”¨çš„User
32 
33 åœºæ™¯ä¸€ï¼š
34 user = User()   #å¾—åˆ°æŸä¸€ä¸ªç”¨æˆ·å¼ ä¸‰ï¼Œæƒ³çŸ¥é“å¼ ä¸‰ä¸‹é¢æ‰€æœ‰å¾—åœ°å€åˆ—è¡¨æ€ä¹ˆåŠï¼Ÿ
35 user.address    #é€šè¿‡user.addresså°±å¯ä»¥è·å–åˆ°åˆ°UserAddressè¿™ä¸ªæ¨¡å‹äº†ï¼Œå°±å¯ä»¥æ‰¾åˆ°å¼ ä¸‰ä¸‹é¢å¾—æ‰€æœ‰åœ°å€åˆ—è¡¨ï¼Œå³åœ°å€è¡¨å†…å®¹
36 
37 åœºæ™¯äºŒï¼š
38 å‡è®¾æˆ‘ä»¬æŸ¥åˆ°äº†æŸä¸€ä¸ªåœ°å€ï¼Œä¹Ÿå°±æ˜¯UserAddressæ¨¡å‹å¯¹åº”æ•°æ®åº“çš„å†…å®¹
39 addr = UserAddress()   #æ ¹æ®åœ°å€å¦‚ä½•å»æŸ¥ç”¨æˆ·è¡¨çš„ä¿¡æ¯å‘¢ï¼Ÿ
40 addr.user              #é€šè¿‡addr.user å°±å¾—åˆ°äº†Useræ¨¡å‹çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯userè¡¨å¯¹è±¡
41 '''
42 
43 
44 
45 @app.route('/')
46 def mine():
47     """  é¦–é¡µ """
48     return render\_template('index.html')

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207181615043-1045312235.png)

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207181627264-1047130580.png)![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207181718546-168127056.png)![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221207181836360-1849269806.png)

### 3.3.ä½¿ç”¨ORMæ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®

ç»§ç»­ä¸Šé¢ä»£ç å’Œç”¨æˆ·è¡¨ã€åœ°å€è¡¨é˜è¿°

**æ–°å¢/ä¿®æ”¹æ•°æ®**

*   æ„é€ ORMæ¨¡å‹å¯¹è±¡ï¼šÂ user = User('admin','admin@example.com')Â ã€‚åœ¨æ¨¡å‹ç±»Useré‡Œé¢ä¼ é€’ä¸€äº›å‚æ•°ï¼šç”¨æˆ·åã€å¯†ç ã€ç”¨æˆ·idç­‰ç­‰å³userè¡¨æ•°æ®å†…å®¹ï¼Œæ„é€ ä¸€ä¸ªuserå¯¹è±¡
*   æ·»åŠ åˆ°db.sessionï¼Œsessionå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªä¼šè¯ï¼ˆå¤‡æ³¨ï¼šsessioné‡Œé¢å¯æ·»åŠ å¤šä¸ªå¯¹è±¡ï¼‰ï¼šÂ db.session.add(user)Â ,å¯ä»¥å¤šæ¬¡è°ƒç”¨addä¼ é€’å¤šä¸ªå¯¹è±¡
*   æäº¤åˆ°æ•°æ®åº“ï¼šÂ db.session.commitÂ ï¼Œé€šè¿‡commitå°±å®Œæˆäº†åœ¨ç”¨æˆ·è¡¨é‡Œé¢æ·»åŠ ä¸€æ¡ç”¨æˆ·è®°å½•

æ–°å¢æ•°æ®å®ä¾‹ï¼š

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221208103140683-2071260145.png)

ä¿®æ”¹æ•°æ®å®ä¾‹ï¼š

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221208104242477-1547827611.png)

**ç‰©ç†åˆ é™¤æ•°æ®ï¼š**æ•°æ®è®°å½•åœ¨è¡¨ä¸­ç›´æ¥åˆ æ‰

*   é€šè¿‡query.filter\_by()æŸ¥è¯¢ORMæ¨¡å‹å¯¹è±¡ï¼šÂ user=User.query.filter\_by(username='ç‹äº”').first()Â ï¼Œé€šè¿‡query.filter\_byæ‰¾åˆ°Useræ¨¡å‹ä¸­ç”¨æˆ·å«ç‹äº”çš„æ•°æ®ï¼Œfirstå–ç¬¬ä¸€æ¡
*   æ·»åŠ åˆ°db.sessionï¼Œæ³¨æ„è¿™ä¸ªåœ°æ–¹æ˜¯deleteä¸æ˜¯addï¼šÂ db.session.delete(user)Â 
*   æäº¤å˜æ›´åˆ°æ•°æ®åº“ï¼šÂ db.session.commit

ç‰©ç†åˆ é™¤æ•°æ®å®ä¾‹ï¼š

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221208110657923-1791386029.png)

**é€»è¾‘åˆ é™¤ï¼š**ç›¸å½“äºè½¯åˆ é™¤ï¼Œåœ¨è¡¨ä¸­æ·»åŠ ä¸€ä¸ªçŠ¶æ€ä½ï¼Œæ¯”å¦‚isvalidå­—æ®µï¼Œç”¨äºæ ‡è®°è¯¥è®°å½•æ˜¯å¦åˆ é™¤(0:åˆ é™¤ï¼Œ1:æœªåˆ é™¤)ï¼Œå…¶å®è¡¨ä¸­æ•°æ®è®°å½•è¿˜åœ¨çš„ã€‚

### 3.4.ä½¿ç”¨ORMè¿›è¡Œæ•°æ®æŸ¥è¯¢ä¸å±•ç¤º

ç»§ç»­ä¸Šé¢ä»£ç å’Œç”¨æˆ·è¡¨ã€åœ°å€è¡¨é˜è¿°

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221208111904869-937552466.png)

**ORMæŸ¥è¯¢**

ORMæŸ¥è¯¢è¿”å›çš„æ˜¯ä¸€ä¸ªç»“æœé›†ï¼Œå¯ä»¥æŠŠå®ƒçœ‹æˆlistã€‚æ³¨æ„ï¼šå½“æ¨¡å‹æ²¡æœ‰ä½¿ç”¨\_\_tablename\_\_å‘½åè¡¨åï¼Œé‚£ä¹ˆè¡¨åå°±æ˜¯æ¨¡å‹åå³ç±»çš„åå­—ã€‚

ç­›é€‰/è·å–ORMè¿”å›ç»“æœé›†ï¼š

*   æŸ¥è¯¢æ¨¡å‹(è¡¨)æ‰€æœ‰æ•°æ®query.all()ï¼šÂ User.query.all()Â 
*   æŒ‰æ¡ä»¶æŸ¥è¯¢
    *   query.filter\_by()ï¼šÂ User.query.filter\_by(username='å¼ ä¸‰')Â 
    *   query.filter()ï¼šÂ User.query.filter(User.nickname.endswith('äº”')).all()Â 
    *   å¯ä»¥ä½¿ç”¨filter()è¿›è¡Œä¸€äº›å¤æ‚çš„æŸ¥è¯¢ï¼Œï¼šå¦‚nickname.endswith()Â è¡¨ä¸­nicknameå­—æ®µæ˜¯ä»€ä¹ˆç»“å°¾çš„ã€ä¸Šé¢all()æ˜¯å°†æŸ¥è¯¢å‡ºæ¥çš„ç»“æœå…¨éƒ¨è¿”å›ã€‚

å¯¹ORMè¿”å›ç»“æœè¿›è¡Œæ“ä½œï¼š

*   æ’åºquery.order\_by()ï¼šÂ User.query.order\_by(User.username)Â 
*   æŸ¥è¯¢TOP10çš„æ•°æ® query.limit()ï¼šÂ User.query.limit(10).all()Â 

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221208153530662-247096201.png)

è¿”å›å•ä¸ªORMå¯¹è±¡å³æŸ¥è¯¢ç»“æœåªæœ‰ä¸€æ¡æ•°æ®

*   æ ¹æ®ä¸»é”®(primary\_key)å€¼æŸ¥è¯¢ï¼šÂ User.query.get(1)Â 
*   è·å–ç¬¬ä¸€æ¡è®°å½•first()ï¼šÂ User.query.first()Â 

åŒæ—¶è¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„è§†å›¾å¿«æ·å‡½æ•°ï¼š

*   è¿”å›çš„æ•°æ®æœ‰åˆ™è¿”å›ï¼Œæ— åˆ™è¿”å›404
    *   first()Â  vsÂ  first\_or\_404()
    *   get()Â  Â vsÂ  get\_or\_404()

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221208160036841-1194123199.png)

*   Â å¤šè¡¨å…³è”æŸ¥è¯¢
    *   æ–¹å¼ä¸€ï¼šdb.session.query(User).join(Address)
    *   æ–¹å¼äºŒï¼šUser.query.join(Address)
*   åˆ†é¡µ(offset/limit)
    *   æ–¹å¼ä¸€ï¼š.offset(offset)
    *   æ–¹å¼äºŒï¼š.limit(limit)
    *   offsetå’Œlimitä½¿ç”¨æ–¹æ³•å’Œåœ¨mysqlä¸­ä½¿ç”¨ä¸€è‡´
*   åˆ†é¡µ(paginate)ï¼šqueryå¯¹è±¡æä¾›çš„paginateå‡½æ•°è¿›è¡Œåˆ†é¡µã€‚Â .paginate(page=2,per\_page=4) #pageå½“å‰åœ¨ç¬¬å‡ é¡µï¼Œper\_pageæ¯ä¸€é¡µå¤šå°‘æ¡ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªPaginationçš„å¯¹è±¡Â ã€‚è¿”å›çš„Paginationå¯¹è±¡æ‹¥æœ‰çš„å±æ€§å’Œå‡½æ•°å¦‚ä¸‹ğŸ‘‡
    *   Â has\_prev/has\_nextÂ ï¼šæ˜¯å¦æœ‰ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µ
    *   Â itemsÂ ï¼šå½“å‰é¡µçš„æ•°æ®åˆ—è¡¨
    *   Â prev\_num/next\_numÂ ï¼šä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µçš„é¡µç 
    *   Â totalÂ ï¼šæ€»è®°å½•æ•°
    *   Â pagesÂ ï¼šæ€»é¡µæ•°

**paginateå®ä¾‹ç»ƒä¹ ï¼š**

1ï¼‰å‡†å¤‡æ•°æ®

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221208162857492-1098366112.png)

2ï¼‰åˆ†é¡µï¼šÂ list\_user.paginate(page2,per\_page=4)Â 

3ï¼‰åœ¨æ¨¡æ¿ä¸­å®ç°åˆ†é¡µæ“ä½œ

 1 '''\*\*\*app.py\*\*\*'''
 2 
 3 from flask import Flask, render\_template 4 from flask\_sqlalchemy import SQLAlchemy 5 
 6 app = Flask(\_\_name\_\_)
 7 # é…ç½®æ•°æ®åº“çš„è¿æ¥å‚æ•°
 8 app.config\['SQLALCHEMY\_DATABASE\_URI'\] = 'mysql://root:\*\*@\*\*\*\*\*\*/test\_flask'
 9 db = SQLAlchemy(app)
10 
11 
12 class User(db.Model):
13     \_\_tablename\_\_ = 'weibo\_user'
14     id = db.Column(db.Integer, primary\_key=True)
15     username = db.Column(db.String(64), nullable=False)
16     password = db.Column(db.String(256), nullable=False)
17     birth\_date = db.Column(db.Date, nullable=True)
18     age = db.Column(db.Integer, default=0)
19 
20 
21 class UserAddress(db.Model):
22     """ ç”¨æˆ·çš„åœ°å€ """
23     \_\_tablename\_\_ = 'weibo\_user\_addr'
24     id = db.Column(db.Integer, primary\_key=True)
25     addr = db.Column(db.String(256), nullable=False)
26     user\_id = db.Column(db.Integer, db.ForeignKey('weibo\_user.id'), nullable=False)
27     user = db.relationship('User', backref=db.backref('address', lazy=True))
28 
29 
30 @app.route('/')
31 def mine():
32     """  é¦–é¡µ """
33     return render\_template('index.html')
34 
35 
36 @app.route('/user/<int:page>/')
37 def list\_user(page):
38     """ ç”¨æˆ·åˆ†é¡µ """
39     per\_page = 10 # æ¯ä¸€é¡µçš„æ•°æ®å¤§å°
40     # 1. æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
41     user\_ls = User.query
42     # 2. å‡†å¤‡åˆ†é¡µçš„æ•°æ®
43     user\_page\_data = user\_ls.paginate(page, per\_page=per\_page)
44     return render\_template('list\_user.html', user\_page\_data=user\_page\_data)

 1 <!--  \*\*\*list\_user.html\*\*\*   \-->
 2 
 3 <!DOCTYPE html\>
 4 <html lang\="en"\>
 5 <head\>
 6     <meta charset\="UTF-8"\>
 7     <title\>ç”¨æˆ·åˆ†é¡µæ“ä½œ</title\>
 8 </head\>
 9 <body\>
10 <h3\>æ€»å…±æœ‰{{ user\_page\_data.total }}ç”¨æˆ·ï¼Œå½“å‰åœ¨ç¬¬{{ user\_page\_data.page }}é¡µç”¨æˆ·, æ€»å…±{{ user\_page\_data.pages }}é¡µ</h3\>
11 <p\>
12 ç”¨æˆ·åˆ—è¡¨ï¼š
13 
14 <ul\>
15 {% for user in user\_page\_data.items %}
16     <li\>{{ user.username }} - {{ user.password }}</li\>
17 {% endfor %}
18 </ul\>
19 {% if user\_page\_data.has\_prev %}
20 <a href\="{{ url\_for('list\_user', page=user\_page\_data.prev\_num) }}"\>ä¸Šä¸€é¡µ</a\>
21 {%  endif %}
22 {% if user\_page\_data.has\_next %}
23 <a href\="{{ url\_for('list\_user', page=user\_page\_data.next\_num) }}"\>ä¸‹ä¸€é¡µ</a\>
24 {% endif %}
25 </p\>
26 </body\>
27 </html\>

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221208164953657-1245484003.png)

**æ€è€ƒï¼š**

é€šè¿‡æœ¬ç¯‡ORMå­¦ä¹ ï¼Œå®ç°äº†å¯ä»¥å°†æ¨¡å‹æ•°æ®é€šè¿‡è§†å›¾ä¼ é€’ç»™æ¨¡æ¿è¿›è¡Œå±•ç¤ºã€‚é‚£ä¹ˆæ¨¡æ¿htmlå¦‚ä½•é€šè¿‡è§†å›¾å¯¹æ¨¡å‹ä¸­çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Ÿè¯¦è§ä¸‹ä¸€ç¯‡ç¬”è®°ï¼š[Flaskè¡¨å•çš„å®ç°](https://www.cnblogs.com/gltou/p/16966630.html)

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221208170241497-733751285.png)