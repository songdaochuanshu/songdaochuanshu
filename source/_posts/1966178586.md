---
layout: post
title: "ã€ç‚«ä¸½ã€‘ä»0å¼€å§‹åšä¸€ä¸ªWPF+Blazorå¯¹è¯å°ç¨‹åº"
date: "2022-11-08T01:46:27.908Z"
---
ã€ç‚«ä¸½ã€‘ä»0å¼€å§‹åšä¸€ä¸ªWPF+Blazorå¯¹è¯å°ç¨‹åº
==========================

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ²™æ¼ å°½å¤´çš„ç‹¼ã€‚

> .NETæ˜¯å…è´¹ï¼Œè·¨å¹³å°ï¼Œå¼€æºï¼Œç”¨äºæ„å»ºæ‰€æœ‰åº”ç”¨çš„å¼€å‘äººå‘˜å¹³å°ã€‚

æœ¬æ–‡æ¼”ç¤ºå¦‚ä½•åœ¨[WPF](https://learn.microsoft.com/zh-cn/dotnet/desktop/wpf/overview/?view=netdesktop-6.0)ä¸­ä½¿ç”¨[Blazor](https://learn.microsoft.com/zh-cn/aspnet/core/blazor/?view=aspnetcore-7.0)å¼€å‘æ¼‚äº®çš„UIï¼Œä¸ºå®¢æˆ·ç«¯å¼€å‘æ³¨å…¥æ–°æ´»åŠ›ã€‚

**æ³¨** è¦ä½¿WPFæ”¯æŒBlazorï¼Œ[.NET](https://dotnet.microsoft.com/zh-cn/)ç‰ˆæœ¬å¿…é¡»æ˜¯ 6.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œæœ¬æ–‡æ‰€æœ‰ç¤ºä¾‹ä½¿ç”¨çš„.NET 7.0ï¼Œç‰ˆæœ¬è¦æ±‚è§[é“¾æ¥](https://learn.microsoft.com/zh-cn/aspnet/core/blazor/hybrid/tutorials/wpf?view=aspnetcore-7.0)ï¼Œæˆªå›¾çœ‹å¦‚ä¸‹æ–‡å­—ï¼š

![.NETç‰ˆæœ¬è¦æ±‚](https://img1.dotnet9.com/2022/10/1003.png)

1\. WPFé»˜è®¤ç¨‹åº
-----------

æœ¬æ–‡ä»åˆ›å»ºWPF `Hello World`å¼€å‘ï¼š

ä½¿ç”¨WPFæ¨¡æ¿åˆ›å»ºä¸€ä¸ªé»˜è®¤ç¨‹åºï¼Œå–åã€WPFBlazorChatã€‘ï¼Œé¡¹ç›®ç»„ç»‡ç»“æ„å¦‚ä¸‹ï¼š

![ç©ºç™½WPFé¡¹ç›®](https://img1.dotnet9.com/2022/10/1001.png)

è¿è¡Œé¡¹ç›®ï¼Œä¸€ä¸ªç©ºç™½çª—å£ï¼š

![WPFé¡¹ç›®ç©ºç™½çª—å£](https://img1.dotnet9.com/2022/10/1002.png)

æ¥ç€å¾€ä¸‹çœ‹ï¼Œæˆ‘ä»¬æ·»åŠ Blazoræ”¯æŒï¼Œæœ¬å°èŠ‚ä»£ç åœ¨è¿™[WPFé»˜è®¤ç¨‹åºæºç ](https://github.com/dotnet9/WPFBlazorChat/tree/main/1WPF%E9%BB%98%E8%AE%A4%E7%A8%8B%E5%BA%8F/WPFBlazorChat)ã€‚

2\. æ·»åŠ Blazoræ”¯æŒ
--------------

ä¾ç„¶ä½¿ç”¨ä¸Šé¢çš„å·¥ç¨‹ï¼Œæ·»åŠ Blazoræ”¯æŒï¼Œæ­¤éƒ¨åˆ†å‚è€ƒå¾®è½¯æ–‡æ¡£[ç”Ÿæˆ Windows Presentation Foundation (WPF) Blazor åº”ç”¨](https://learn.microsoft.com/zh-cn/aspnet/core/blazor/hybrid/tutorials/wpf?view=aspnetcore-7.0)ï¼Œæœ¬å°èŠ‚å¿«é€Ÿç•¥è¿‡ã€‚

### 2.1 ç¼–è¾‘å·¥ç¨‹æ–‡ä»¶

åŒå‡»å·¥ç¨‹æ–‡ä»¶`WPFBlazorChat.csproj`ï¼Œä¿®æ”¹å¤„å¦‚ä¸‹ï¼š

![å·¥ç¨‹æ–‡ä»¶ä¿®æ”¹å¯¹æ¯”](https://img1.dotnet9.com/2022/10/1004.png)

1.  åœ¨é¡¹ç›®æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œå°† SDK æ›´æ”¹ä¸º `Microsoft.NET.Sdk.Razor`ã€‚
2.  æ·»åŠ èŠ‚ç‚¹`<RootNameSpace>WPFBlazorChat</RootNameSpace>`ï¼Œå°†é¡¹ç›®å‘½åç©ºé—´ `WPFBlazorChat` è®¾ç½®ä¸ºåº”ç”¨çš„æ ¹å‘½åç©ºé—´ã€‚
3.  æ·»åŠ `Nuget`åŒ…`Microsoft.AspNetCore.Components.WebView.Wpf`ï¼Œç‰ˆæœ¬çœ‹ä½ é€‰æ‹©çš„`.NET`ç‰ˆæœ¬è€Œå®šã€‚

### 2.2 æ·»åŠ `_Imports.razor`æ–‡ä»¶

`_Imports.razor`æ–‡ä»¶ç±»ä¼¼ä¸€ä¸ª`Global` usingæ–‡ä»¶ï¼Œä¸“é—¨ç»™`Razor`ç»„ä»¶ä½¿ç”¨ï¼Œæ”¾ç½®ä¸€äº›ç”¨çš„æ¯”è¾ƒå¤šçš„å…¨å±€çš„å‘½åç©ºé—´ï¼Œç²¾ç®€ä»£ç ã€‚

å†…å®¹å¦‚ä¸‹ï¼Œå¼•å…¥äº†ä¸€ä¸ªå‘½åç©ºé—´`Microsoft.AspNetCore.Components.Web`ï¼Œè¿™æ˜¯`Razor`å¸¸ç”¨å‘½åç©ºé—´ï¼ŒåŒ…å«ç”¨äºå‘ `Blazor` æ¡†æ¶æä¾›æœ‰å…³æµè§ˆå™¨äº‹ä»¶çš„ä¿¡æ¯çš„ç±»å‹ã€‚ï¼š

    @using Microsoft.AspNetCore.Components.Web
    

### 2.3 æ·»åŠ `wwwroot\index.html`æ–‡ä»¶

å’Œ`Vue`ã€`React`ä¸€æ ·ï¼Œéœ€è¦ä¸€ä¸ª`html`æ–‡ä»¶æ‰¿è½½`Razor`ç»„ä»¶ï¼Œé¡µé¢å†…å®¹ç±»ä¼¼ï¼š

    <!DOCTYPE html>
    <html lang="en">
    
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>WPFBlazorChat</title>
        <base href="/" />
        <link href="css/app.css" rel="stylesheet" />
        <link href="WpfBlazor.styles.css" rel="stylesheet" />
    </head>
    
    <body>
    <div id="app">Loading...</div>
    
    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ğŸ—™</a>
    </div>
    <script src="_framework/blazor.webview.js"></script>
    </body>
    
    </html>
    

1.  `app.css`æ–‡ä»¶åœ¨ä¸‹é¢ç»™å‡ºå®šä¹‰ã€‚
2.  çœ‹`<div id="app">Loading...</div>`ï¼Œè¿™é‡Œæ˜¯æ‰¿è½½`Razor`ç»„ä»¶çš„åœ°æ–¹ï¼Œåé¢æ‰€æœ‰åŠ è½½çš„`Razor`ç»„ä»¶éƒ½æ˜¯åœ¨è¿™é‡Œæ¸²æŸ“å‡ºæ¥çš„ã€‚
3.  å…¶ä»–æš‚æ—¶ä¸ç®¡ã€‚

### 2.4 æ·»åŠ `wwwroot\css\app.css`æ–‡ä»¶

é¡µé¢çš„åŸºæœ¬æ ·å¼ï¼Œé€šç”¨çš„æ ·å¼å¯æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶ï¼š

    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }
    
    h1:focus {
        outline: none;
    }
    
    a, .btn-link {
        color: #0071c1;
    }
    
    .btn-primary {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }
    
    .valid.modified:not([type=checkbox]) {
        outline: 1px solid #26b050;
    }
    
    .invalid {
        outline: 1px solid red;
    }
    
    .validation-message {
        color: red;
    }
    
    #blazor-error-ui {
        background: lightyellow;
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
    }
    
    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }
    

### 2.5 æ·»åŠ ä¸€ä¸ªRazorç»„ä»¶

åŠ ä¸€ä¸ªRazorçš„ç»å…¸ç»„ä»¶`Counter.razor`ï¼Œ`Blazor`çš„`Hello World`ç¨‹åºå°±æœ‰è¿™ä¹ˆä¸€ä¸ªç»„ä»¶ï¼Œæ–‡ä»¶è·¯å¾„ï¼š`/RazorViews/Counter.razor`ï¼Œä¹‹æ‰€ä»¥æ”¾`RazorViews`ç›®å½•ï¼Œæ˜¯ä¸ºäº†å’ŒWPFå¸¸ç”¨çš„`Views`ç›®å½•åŒºåˆ†ï¼Œè¯¥ç»„ä»¶å†…å®¹å¦‚ä¸‹ï¼š

    <h1>Counter</h1>
    
    <p>å¥½å¼€å¿ƒï¼Œä½ ç‚¹æˆ‘äº†ï¼Œç°åœ¨æ˜¯:<span style="color: red;">@currentCount</span></p>
    
    <button class="btn btn-primary" @onclick="IncrementCount">å¿«å¿«ç‚¹æˆ‘</button>
    
    @code {
        private int currentCount = 0;
    
        private void IncrementCount()
        {
            currentCount++;
        }
    }
    

ä¸€ä¸ªæŒ‰é’®ã€å¿«å¿«ç‚¹æˆ‘ã€‘ï¼Œç‚¹å‡»`@onclick="IncrementCount"`ä½¿å˜é‡`currentCount`è‡ªå¢ï¼ŒåŒæ—¶é¡µé¢æ˜¾ç¤ºæ­¤å˜é‡å€¼ï¼Œç›¸ä¿¡ä½ èƒ½çœ‹æ‡‚ã€‚

### 2.6 Blazorä¸WPFçª—ä½“å…³è”

è¿™æ˜¯ä¸¤è€…äº§ç”Ÿå…³ç³»çš„å…³é”®ä¸€æ­¥ï¼Œæ‰“å¼€çª—ä½“`MainWindow.xaml`ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š

![çª—ä½“Xamlä¿®æ”¹](https://img1.dotnet9.com/2022/10/1005.png)

å¦‚ä¸Šä»£ç ï¼Œè¦ç‚¹å¦‚ä¸‹ï¼š

1.  æ·»åŠ ä¸Šé¢å¼•å…¥çš„`Nuget`åŒ…`Microsoft.AspNetCore.Components.WebView.Wpf`çš„å‘½åç©ºé—´ï¼Œå‘½åä¸º`blazor`ï¼Œä¸»è¦æ˜¯è¦ä½¿ç”¨`BlazorWebView`ç»„ä»¶;
2.  `BlazorWebView`ç»„ä»¶å±æ€§`HostPage`æŒ‡å®šæ‰¿è½½çš„htmlæ–‡ä»¶ï¼Œ`Services`æŒ‡å®šrazorç»„ä»¶çš„`Ioc`å®¹å™¨ï¼Œçœ‹ä¸‹é¢`MainWindow()`é‡Œæ ‡çº¢çš„ä»£ç ;
3.  `RootComponent`çš„`Selector="#app"`å±æ€§æŒ‡ç¤º`Razor`ç»„ä»¶æ¸²æŸ“çš„ä½ç½®ï¼Œçœ‹`index.html`ä¸­idä¸º`app`çš„htmlå…ƒç´ ï¼Œ`ComponentType`æŒ‡ç¤ºéœ€è¦åœ¨`#app`ä¸­æ¸²æŸ“çš„`Razor`ç»„ä»¶ç±»å‹ã€‚

æ‰“å¼€`MainWindow.xaml.cs`ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š

![æ³¨å…¥Iocå®¹å™¨](https://img1.dotnet9.com/2022/10/1006.png)

åœ¨WPFé‡Œå¯ä»¥ä½¿ç”¨[Prism](https://prismlibrary.com/)ç­‰æ¡†æ¶æä¾›çš„`Unity`ã€`DryIoc`ç­‰`Ioc`å®¹å™¨å®ç°è§†å›¾ä¸æœåŠ¡çš„æ³¨å…¥ï¼›`Razor`ç»„ä»¶è¿™é‡Œï¼Œé»˜è®¤ä½¿ç”¨`ASP.NET Core`çš„`IServiceCollection`å®¹å™¨ï¼›å¦‚æœWPFçª—ä½“ä¸Razorç»„ä»¶éœ€è¦å…±äº«æ•°æ®ï¼Œå¯ä»¥é€šè¿‡åé¢è¦è¯´çš„`Messager`å‘é€æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`Ioc`å®¹å™¨æ³¨å…¥çš„æ–¹å¼å®ç°ï¼Œæ¯”å¦‚ä»WPFçª—ä½“ä¸­æ³¨å…¥çš„æ•°æ®ï¼ˆé€šè¿‡`MainWindow`æ„é€ å‡½æ•°æ³¨å…¥ï¼‰ï¼Œé€šè¿‡`IServiceCollection`å®¹å™¨å†æ³¨å…¥`Razor`ç»„ä»¶ä½¿ç”¨ï¼Œè¿™é‡Œåé¢ä¹Ÿæœ‰æåˆ°ã€‚

![WPFä¸Razorç»„ä»¶ä¹‹é—´é€šè¿‡Iocæ•°æ®ä¼ è¾“](https://img1.dotnet9.com/2022/10/1008.png)

ä¸Šé¢æ­¥éª¤åšå®Œåï¼Œè¿è¡Œç¨‹åºï¼š

![WPFé›†æˆBlazorçš„é»˜è®¤ç¨‹åº](https://img1.dotnet9.com/2022/10/1007.gif)

OKï¼Œ`WPF`ä¸`Blazor`é›†æˆæˆåŠŸï¼Œæ‰“å®Œæ”¶å·¥ï¼Ÿ

ç­‰ç­‰ï¼Œè¿˜æ²¡å®Œå‘¢ï¼Œæœ¬å°èŠ‚æºç åœ¨è¿™[WPFä¸­æ·»åŠ Blazor](https://github.com/dotnet9/WPFBlazorChat/tree/main/2WPF%E4%B8%AD%E5%BC%95%E5%85%A5Blazor/WPFBlazorChat)ï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚

3\. è‡ªå®šä¹‰çª—ä½“
---------

![WPFé»˜è®¤çª—ä½“](https://img1.dotnet9.com/2022/10/1009.png)

çœ‹ä¸Šå›¾ï¼Œçª—ä½“è¾¹æ¡†æ˜¯WPFé»˜è®¤çš„æ ·å¼ï¼Œæœ‰æ—¶ä¼šæ„Ÿè§‰æ¯”è¾ƒä¸‘ï¼Œæˆ–è€…ä¸ä¸‘ï¼Œè®¾è®¡å¸ˆæœ‰å…¶ä»–çš„çª—ä½“é£æ ¼è®¾è®¡ï¼Œå¾€å¾€æˆ‘ä»¬è¦è‡ªå®šä¹‰çª—ä½“ï¼Œæœ¬èŠ‚åˆ†äº«éƒ¨åˆ†WPFä¸Blazorçš„è‡ªå®šä¹‰çª—ä½“å®ç°ï¼Œæ›´å¤šå®šåˆ¶åŒ–åŠŸèƒ½å¯èƒ½éœ€è¦æ‚¨è‡ªè¡Œç ”ç©¶ã€‚

### 3.1 WPFè‡ªå®šä¹‰çª—ä½“

ä¸€èˆ¬å®ç°æ˜¯è®¾ç½®çª—ä½“çš„ä¸‰ä¸ªå±æ€§`WindowStyle="None" AllowsTransparency="True" Background="Transparent"`ï¼Œå³å¯éšè—é»˜è®¤çª—ä½“çš„è¾¹æ¡†ï¼Œç„¶ååœ¨å†…å®¹åŒºè‡ªå·±ç”»æ ‡é¢˜æ ã€æœ€å°åŒ–ã€æœ€å¤§åŒ–ã€å…³é—­æŒ‰é’®ã€å®¢æˆ·åŒºç­‰ã€‚

**MainWindow.xamlï¼šéšè—WPFé»˜è®¤çª—ä½“è¾¹æ¡†**

    <Window
        x:Class="WPFBlazorChat.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:blazor="clr-namespace:Microsoft.AspNetCore.Components.WebView.Wpf;assembly=Microsoft.AspNetCore.Components.WebView.Wpf"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:razorViews="clr-namespace:WPFBlazorChat.RazorViews"
        Title="MainWindow"
        Width="800"
        Height="450"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStyle="None"
        mc:Ignorable="d">
        <Grid>
            <blazor:BlazorWebView HostPage="wwwroot\index.html" Services="{DynamicResource services}">
                <blazor:BlazorWebView.RootComponents>
                    <blazor:RootComponent ComponentType="{x:Type razorViews:Counter}" Selector="#app" />
                </blazor:BlazorWebView.RootComponents>
        </Grid>
    </Window>
    

ä¸Šé¢çš„ä»£ç åªæ˜¯éšè—äº†WPFé»˜è®¤çª—ä½“çš„è¾¹æ¡†ï¼Œè¿è¡Œç¨‹åºå¦‚ä¸‹ï¼š

![éšè—WPFé»˜è®¤çª—ä½“è¾¹æ¡†](https://img1.dotnet9.com/2022/10/1010.gif)

çœ‹ä¸Šå›¾ï¼Œç‚¹å‡»çª—ä½“ä¸­çš„æŒ‰é’®ï¼ˆå…¶å®æ˜¯Razorç»„ä»¶çš„æŒ‰é’®ï¼‰ï¼Œä½†æœªæ‰§è¡ŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼Œä¸”çª—ä½“æ¶ˆå¤±äº†ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿæ‚¨å¯ä»¥å°è¯•ç ”ç©¶ä¸‹ä¸ºä»€ä¹ˆï¼Œæˆ‘æ²¡æœ‰ç ”ç©¶ä¸ªæ‰€ä»¥ç„¶æ¥ï¼Œæš‚æ—¶åŠ ä¸ªèƒŒæ™¯å¤„ç†`BlazorWebView`ç©¿é€çš„é—®é¢˜ã€‚

**ç®€å•çš„WPFè‡ªå®šä¹‰çª—ä½“æ ·å¼**

æˆ‘ä»¬åŠ ä¸Šè‡ªå®šä¹‰çª—ä½“çš„åŸºæœ¬æ ·å¼çœ‹çœ‹ï¼š

![å¸¦åŸºæœ¬æ ·å¼çš„WPFè‡ªå®šä¹‰çª—ä½“](https://img1.dotnet9.com/2022/10/1011.gif)

`MainWindow.xaml`ä»£ç å¦‚ä¸‹ï¼š

    <Window
        x:Class="WPFBlazorChat.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:blazor="clr-namespace:Microsoft.AspNetCore.Components.WebView.Wpf;assembly=Microsoft.AspNetCore.Components.WebView.Wpf"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:razorViews="clr-namespace:WPFBlazorChat.RazorViews"
        Title="MainWindow"
        Width="800"
        Height="450"
        AllowsTransparency="True" Background="Transparent" WindowStyle="None"
        mc:Ignorable="d">
        <Window.Resources>
            <Style TargetType="{x:Type Button}">
                <Setter Property="Width" Value="35" />
                <Setter Property="Height" Value="25" />
                <Setter Property="Margin" Value="2" />
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Foreground" Value="White" />
            </Style>
        </Window.Resources>
        <Border Background="#7160E8" CornerRadius="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="35" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Border
                    Background="#7160E8" CornerRadius="5 5 0 0" MouseLeftButtonDown="MoveWindow_MouseLeftButtonDown">
                    <Grid>
                        <TextBlock
                            Margin="10,10,5,5"
                            Foreground="White"
                            Text="è¿™é‡Œæ˜¯çª—ä½“æ ‡é¢˜æ ï¼Œå·¦ä¾§å¯æ”¾Logoã€æ ‡é¢˜ï¼Œå³ä¾§æ”¾çª—ä½“æ“ä½œæŒ‰é’®ï¼šæœ€å°åŒ–ã€æœ€å¤§åŒ–ã€å…³é—­ç­‰" />
                        <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                            <Button Click="MinimizeWindow_Click" Content="â€•" />
                            <Button Click="MaximizeWindow_Click" Content="å£" />
                            <Button Click="CloseWindow_Click" Content="X" />
                        </StackPanel>
                    </Grid>
                </Border>
                <blazor:BlazorWebView Grid.Row="1" HostPage="wwwroot\index.html" Services="{DynamicResource services}">
                    <blazor:BlazorWebView.RootComponents>
                        <blazor:RootComponent ComponentType="{x:Type razorViews:Counter}" Selector="#app" />
                    </blazor:BlazorWebView.RootComponents>
                </blazor:BlazorWebView>
            </Grid>
        </Border>
    </Window>
    

æˆ‘ä»¬ç»™æ•´ä¸ªçª—ä½“å®¢æˆ·ç«¯åŒºåŸŸåŠ äº†ä¸€ä¸ªèƒŒæ™¯`Border`(æ‚¨å¯ä»¥å»æ‰BorderèƒŒæ™¯è‰²ï¼Œç‚¹å‡»ç•Œé¢æŒ‰é’®è¯•è¯•)ï¼Œç„¶ååˆå¥—äº†ä¸€ä¸ªGridï¼Œç”¨äºæ”¾ç½®è‡ªå®šä¹‰çš„æ ‡é¢˜æ ï¼ˆæ ‡é¢˜å’Œçª—ä½“æ§åˆ¶æŒ‰é’®ï¼‰å’Œ`BlazorWebView`(ç”¨äºæ¸²æŸ“Razorç»„ä»¶çš„æµè§ˆå™¨ç»„ä»¶)ï¼Œä¸‹é¢æ˜¯çª—ä½“æ§åˆ¶æŒ‰é’®çš„å“åº”äº‹ä»¶ï¼š

    using Microsoft.Extensions.DependencyInjection;
    using System.Windows;
    
    namespace WPFBlazorChat;
    
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
            var serviceCollection = new ServiceCollection();
            serviceCollection.AddWpfBlazorWebView();
            Resources.Add("services", serviceCollection.BuildServiceProvider());
        }
    
        private void MoveWindow_MouseLeftButtonDown(object sender, System.Windows.Input.MouseButtonEventArgs e)
        {
            if (e.ClickCount == 1)
            {
                this.DragMove();
            }
            else
            {
                MaximizeWindow_Click(null, null);
            }
        }
    
        private void CloseWindow_Click(object sender, RoutedEventArgs e)
        {
            this.Close();
        }
    
        private void MinimizeWindow_Click(object sender, RoutedEventArgs e)
        {
            this.WindowState = WindowState.Minimized;
        }
    
        private void MaximizeWindow_Click(object sender, RoutedEventArgs e)
        {
            this.WindowState = this.WindowState == WindowState.Maximized ? WindowState.Normal : WindowState.Maximized;
        }
    }
    

ä»£ç ç®€å•ï¼Œå¤„ç†äº†çª—ä½“æœ€å°åŒ–ã€çª—ä½“æœ€å¤§åŒ–ï¼ˆè¿˜åŸï¼‰ã€å…³é—­ã€æ ‡é¢˜æ åŒå‡»çª—ä½“æœ€å¤§åŒ–ï¼ˆè¿˜åŸï¼‰ï¼Œä¸Šé¢çš„å®ç°ä¸æ˜¯ä¸€ä¸ªå®Œç¾çš„è‡ªå®šä¹‰çª—ä½“å®ç°ï¼Œè‡³å°‘æœ‰è¿™ä¸¤ä¸ªé—®é¢˜ï¼š

*   å½“æ‚¨å°è¯•æœ€å¤§åŒ–åï¼Œçª—ä½“é“ºæ»¡äº†æ•´ä¸ªæ“ä½œç³»ç»Ÿæ¡Œé¢ï¼ˆè¿ä»»åŠ¡æ åŒºåŸŸä¹Ÿå ç”¨äº†ï¼‰ï¼›
*   çª—ä½“ä»»åŠ¡æ ä¸¤ä¸ªåœ†è§’æœªç”Ÿæ•ˆï¼ˆçº¢è‰²çŸ©å½¢æ¡†é€‰çš„éƒ¨åˆ†ï¼‰ï¼Œå³çª—ä½“ä¸‹é¢çš„ä¸¤ä¸ªåœ†è§’ï¼Œç«™é•¿æœªæ‰¾åˆ°è®©`BlazorWebView`å‡ºç°åœ†è§’çš„å±æ€§æˆ–å…¶ä»–æ–¹æ³•ï¼›æ ‡é¢˜æ åŒºåŸŸï¼ˆç»¿è‰²çŸ©å½¢æ¡†é€‰çš„éƒ¨åˆ†ï¼‰æ˜¯WPFæ§ä»¶ï¼Œæ‰€ä»¥åœ†è§’æ˜¾ç¤ºæ­£å¸¸ã€‚

![çª—ä½“åœ†è§’](https://img1.dotnet9.com/2022/10/1012.png)

åœ¨åé¢çš„`3.4`å°èŠ‚ï¼Œç«™é•¿ä½¿ç”¨ä¸€ä¸ªç¬¬ä¸‰åº“å®ç°äº†çª—ä½“åœ†è§’é—®é¢˜ï¼Œæ›´å¤šæ¯”è¾ƒå¥½çš„WPFè‡ªå®šä¹‰çª—ä½“å®ç°å¯çœ‹è¿™ç¯‡æ–‡ç« ï¼š[WPFä¸‰ç§è‡ªå®šä¹‰çª—ä½“çš„å®ç°](https://www.cnblogs.com/pumbaa/p/13306486.html),æœ¬å°èŠ‚ä¸­ç¤ºä¾‹æºç åœ¨è¿™[WPFè‡ªå®šä¹‰çª—ä½“](https://github.com/dotnet9/WPFBlazorChat/tree/main/3WPF%E4%B8%8EBlazor%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AA%97%E4%BD%93/WPFBlazorChat_1WPF%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AA%97%E4%BD%93)ã€‚

### 3.2 WPFå¼‚å½¢çª—ä½“

å¼‚å½¢çª—ä½“çš„éœ€æ±‚ï¼Œä½¿ç”¨WPFå®ç°æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œæœ¬æ¥æ‰“ç®—å†™å†™çš„ï¼Œæ„Ÿè§‰åç¦»ä¸»é¢˜å¤ªè¿œäº†ï¼Œç»™ç¯‡æ–‡ç« è‡ªè¡Œçœ‹çœ‹å§ï¼š[WPFå¼‚å½¢çª—ä½“æ¼”ç¤º](https://baijiahao.baidu.com/s?id=1666945620509938748)ï¼Œæ–‡ä¸­å¼‚å½¢çª—ä½“æ•ˆæœå¦‚ä¸‹ï¼š

![WPFå¼‚å½¢çª—ä½“](https://img1.dotnet9.com/2022/10/1013.jpeg)

ä¸‹é¢ä»‹ç»å°†çª—ä½“çš„æ ‡é¢˜æ ä¹Ÿæ”¾`Razor`ç»„ä»¶ä¸­å®ç°çš„æ–¹å¼ã€‚

### 3.3 Blazorå®ç°è‡ªå®šä¹‰çª—ä½“æ•ˆæœ

ä¸Šé¢ä½¿ç”¨äº†`WPF`åˆ¶ä½œè‡ªå®šä¹‰çª—ä½“ï¼Œæœ‰æ²¡æœ‰è¿™ç§éœ€æ±‚ï¼ŒæŠŠèœå•æ”¾ç½®åˆ°æ ‡é¢˜æ ï¼Ÿè¿™ä¸ªç®€å•ï¼ŒWPFèƒ½å¾ˆå¥½å®ç°ã€‚

å¦‚æœæ”¾`Tab`ç±»æ§ä»¶å‘¢ï¼Ÿ`Tab Header`æ˜¯åœ¨æ ‡é¢˜æ æ˜¾ç¤ºï¼Œ`TabItem`æ˜¯åœ¨å®¢æˆ·ç«¯åŒºåŸŸï¼Œ`Tab Header`ä¸`TabItem`é£æ ¼ç»Ÿä¸€ï¼Œåœ¨ä¸€å¥—ä»£ç é‡Œé¢å®ç°å’Œç»´æŠ¤ä¹Ÿæ–¹ä¾¿ï¼Œé‚£ä¹ˆåœ¨`WPF`+`Blazor`æ··åˆå¼€å‘çš„æƒ…å†µæ€ä¹ˆå®ç°å‘¢ï¼Ÿç›¸ä¿¡é€šè¿‡æœ¬èŠ‚`Razor`ç»„ä»¶å®ç°æ ‡é¢˜æ çš„ä»‹ç»ï¼Œä½ èƒ½åšå‡ºæ¥ã€‚

`MainWindow.xaml`æ¢å¤ä»£ç ï¼Œåªè®¾ç½®éšè—WPFé»˜è®¤çª—ä½“è¾¹æ¡†ï¼Œå¹¶ç»™`BlazorWebView`å¥—ä¸€å±‚èƒŒæ™¯ï¼š

![WPFé€æ˜çª—ä½“](https://img1.dotnet9.com/2022/10/1014.png)

åé¢çš„ä»£ç æœ‰å‚è€ƒ [BlazorDesktopWPF-CustomTitleBar](https://github.com/James231/BlazorDesktopWPF-CustomTitleBar) å¼€æºé¡¹ç›®å®ç°ã€‚

æˆ‘ä»¬æŠŠæ ‡é¢˜æ åšåˆ°`Counter.razor`ç»„ä»¶ï¼Œå³æ ‡é¢˜æ ã€å®¢æˆ·åŒºæ”¾ä¸€ä¸ªç»„ä»¶é‡Œï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åˆ†ç¦»ï¼Œè¿™é‡Œæˆ‘ä»¬æ–¹ä¾¿æ¼”ç¤ºï¼š

**Counter.razor**

    @using WPFBlazorChat.Services
    
    <div class="titlebar" @ondblclick="WindowService.Maximize" @onmouseup="WindowService.StopMove" @onmousedown="WindowService.StartMove">
        <button class="titlebar-btn" onclick="alert('js alert: navigation pressed');">
            <img src="svg/navigation.svg" />
        </button>
        <div class="window-title">
            æµ‹è¯•çª—ä½“æ ‡é¢˜
        </div>
        <div style="flex-grow:1"></div>
        <button class="titlebar-btn" onclick="alert('js alert: settings pressed');">
            <img src="svg/settings.svg" />
        </button>
        <button class="titlebar-btn" @onclick="WindowService.Minimize">
            <img src="svg/minimize.svg" />
        </button>
        <button class="titlebar-btn" @onclick="WindowService.Maximize">
            @if (WindowService.IsMaximized())
            {
                <img src="svg/restore.svg" />
            }
            else
            {
                <img src="svg/maximize.svg" />
            }
        </button>
        <button class="titlebar-cbtn" @onclick="()=>WindowService.Close(false)">
            <img src="svg/dismiss.svg" />
        </button>
    </div>
    
    <p>å¥½å¼€å¿ƒï¼Œä½ ç‚¹æˆ‘äº†ï¼Œç°åœ¨æ˜¯:<span style="color: red;">@currentCount</span></p>
    
    <button class="btn btn-primary" @onclick="IncrementCount">å¿«å¿«ç‚¹æˆ‘</button>
    
    @code {
        private int currentCount = 0;
    
        protected override void OnInitialized()
        {
    
            WindowService.Init();
            base.OnInitialized();
        }
    
        private void IncrementCount()
        {
            currentCount++;
        }
    }
    

ä¸‹é¢ç»™å‡ºä»£ç ç®€å•è¯´æ˜ï¼š

1.  ç¬¬ä¸€ä¸ª`div`å……åšçª—ä½“çš„æ ‡é¢˜æ åŒºåŸŸï¼Œæ³¨å†Œäº†åŒå‡»äº‹ä»¶è°ƒç”¨çª—ä½“æœ€å¤§åŒ–ï¼ˆè¿˜åŸï¼‰æ–¹æ³•ã€é¼ æ ‡æŒ‰ä¸‹ä¸é‡Šæ”¾è°ƒç”¨çª—ä½“çš„ç§»åŠ¨å¼€å§‹ä¸ç»“æŸæ–¹æ³•ï¼›
2.  åœ¨ç¬¬ä¸€ä¸ª`div`é‡Œï¼Œå…¶ä¸­æœ‰3ä¸ªæŒ‰é’®ï¼Œå³çª—ä½“çš„æ§åˆ¶æŒ‰é’®ï¼Œè°ƒç”¨çª—ä½“æœ€å°åŒ–ã€æœ€å¤§åŒ–ï¼ˆè¿˜åŸï¼‰ã€å…³é—­æ–¹æ³•è°ƒç”¨ï¼›
3.  å¦æœ‰ä¸¤ä¸ªæŒ‰é’®ï¼Œæ¼”ç¤ºå•å‡»è°ƒç”¨`JavaScript`çš„`alert`æ–¹æ³•å¼¹å‡ºæ¶ˆæ¯ã€‚

![WPFé€æ˜çª—ä½“](https://img1.dotnet9.com/2022/10/1015.png)

è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š

![WPFé€æ˜çª—ä½“](https://img1.dotnet9.com/2022/10/1016.gif)

å®ç°è¿™ä¸ªæ•ˆæœï¼Œè¿˜æœ‰ä¸€äº›ä»£ç ï¼š

1.  ä¸Šé¢çš„ä»£ç è°ƒç”¨äº†ä¸€äº›æ–¹æ³•å®ç°çª—ä½“æ“ä½œæœ€å°åŒ–ã€å…³é—­ç­‰ï¼Œä»£ç å¦‚ä¸‹;
2.  å› ä¸ºæ˜¯`Razor`ç»„ä»¶ï¼Œå³`html`å®ç°çš„ç•Œé¢ï¼Œç•Œé¢çš„`html`å…ƒç´ ä¹Ÿå®šä¹‰äº†ä¸€äº›`css`æ ·å¼ï¼Œä»£ç ä¹Ÿä¸€å¹¶ç»™å‡ºã€‚
3.  æ ‡é¢˜æ çš„æŒ‰é’®ä½¿ç”¨äº†ä¸€äº›`svg`å›¾ç‰‡ï¼Œåœ¨ä»“åº“é‡Œï¼Œå¯è‡ªè¡Œè·å–ã€‚

**çª—ä½“æ‹–åŠ¨**

é¦–å…ˆæ·»åŠ `Nuget`åŒ…`Simplify.Windows.Forms`ï¼Œç”¨äºè·å–é¼ æ ‡å…‰æ ‡çš„ä½ç½®ï¼š

    <PackageReference Include="Simplify.Windows.Forms" Version="1.1.2" />
    

æ·»åŠ çª—ä½“å¸®åŠ©ç±»ï¼š`Services\WindowService.cs`

    using System;
    using System.Linq;
    using System.Windows;
    using System.Windows.Forms;
    using System.Windows.Threading;
    using Application = System.Windows.Application;
    
    namespace WPFBlazorChat.Services;
    
    public class WindowService
    {
        private static bool _isMoving;
        private static double _startMouseX;
        private static double _startMouseY;
        private static double _startWindLeft;
        private static double _startWindTop;
    
        public static void Init()
        {
            DispatcherTimer dispatcherTimer = new();
            dispatcherTimer.Tick += UpdateWindowPos;
            dispatcherTimer.Interval = TimeSpan.FromMilliseconds(17);
            dispatcherTimer.Start();
        }
    
        public static void StartMove()
        {
            _isMoving = true;
            _startMouseX = GetX();
            _startMouseY = GetY();
            var window = GetActiveWindow();
            if (window == null)
            {
                return;
            }
    
            _startWindLeft = window.Left;
            _startWindTop = window.Top;
        }
    
        public static void StopMove()
        {
            _isMoving = false;
        }
    
        public static void Minimize()
        {
            var window = GetActiveWindow();
            if (window != null)
            {
                window.WindowState = WindowState.Minimized;
            }
        }
    
        public static void Maximize()
        {
            var window = GetActiveWindow();
            if (window != null)
            {
                window.WindowState =
                    window.WindowState == WindowState.Maximized ? WindowState.Normal : WindowState.Maximized;
            }
        }
    
    
        public static bool IsMaximized()
        {
            var window = GetActiveWindow();
            if (window != null)
            {
                return window.WindowState == WindowState.Maximized;
            }
    
            return false;
        }
    
        public static void Close(bool allWindow = false)
        {
            if (allWindow)
            {
                Application.Current?.Shutdown();
                return;
            }
    
            var window = GetActiveWindow();
            if (window != null)
            {
                window.Close();
            }
        }
    
    
        private static void UpdateWindowPos(object? sender, EventArgs e)
        {
            if (!_isMoving)
            {
                return;
            }
    
            double moveX = GetX() - _startMouseX;
            double moveY = GetY() - _startMouseY;
            Window? window = GetActiveWindow();
            if (window == null)
            {
                return;
            }
    
            window.Left = _startWindLeft + moveX;
            window.Top = _startWindTop + moveY;
        }
    
        private static int GetX()
        {
            return Control.MousePosition.X;
        }
    
        private static int GetY()
        {
            return Control.MousePosition.Y;
        }
    
        private static Window? GetActiveWindow()
        {
            return Application.Current.Windows.Cast<Window>().FirstOrDefault(currentWindow => currentWindow.IsActive);
        }
    }
    

ä¸Šé¢çš„ä»£ç ç”¨äºçª—ä½“çš„æœ€å°åŒ–ã€æœ€å¤§åŒ–ï¼ˆè¿˜åŸï¼‰ã€å…³é—­ç­‰å®ç°ï¼Œéœ€è¦åœ¨`Razor`ç»„ä»¶é‡Œæ­£ç¡®çš„è°ƒç”¨è¿™äº›æ–¹æ³•ï¼š

1.  `Counter.razor`ç»„ä»¶çš„`OnInitialized`åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•é‡Œè°ƒç”¨`WindowService.Init();`ï¼Œå¦‚ä¸Šä»£ç ï¼Œè¿™ä¸ªæ–¹æ³•å¼€å¯å®šæ—¶å™¨ï¼Œå®šæ—¶è°ƒç”¨`UpdateWindowPos`æ–¹æ³•æ£€æŸ¥é¼ æ ‡æ˜¯å¦æŒ‰ä¸‹ï¼Œå¦‚æœæŒ‰ä¸‹ï¼Œæ£€æŸ¥é—´éš”å†…çª—ä½“çš„ä½ç½®å˜åŒ–èŒƒå›´ï¼Œç„¶åä¿®æ”¹çª—ä½“ä½ç½®ï¼Œä»è€Œå®ç°çª—ä½“ä½ç½®ç§»åŠ¨ï¼ˆç§»åŠ¨çª—ä½“æ— æ³•ä½¿ç”¨WPFçš„`DragMove`æ–¹æ³•ï¼Œæ‚¨å¯ä»¥å°è¯•ä½¿ç”¨çœ‹çœ‹å®ƒæŠ¥ä»€ä¹ˆé”™ï¼‰ï¼Œç§»åŠ¨çª—ä½“æœ‰æ›´å¥½çš„æ–¹æ³•æ¬¢è¿ç•™è¨€ã€‚
    
2.  `Razor`ç»„ä»¶é‡Œçª—ä½“æ§åˆ¶æŒ‰é’®çš„ä½¿ç”¨çœ‹ä¸Šé¢çš„ä»£ç ä¸éš¾ç†è§£ï¼Œä¸è¿‡å¤šè§£é‡Šã€‚
    

ä¸Šé¢æ•ˆæœçš„æ ·å¼æ–‡ä»¶ä¿®æ”¹å¦‚ä¸‹ï¼Œ`wwwroot\css\app.css`ï¼š

    /*
    BlazorDesktopWPF-CustomTitleBar - Â© Copyright 2021 - Jam-Es.com
    Licensed under the MIT License (MIT). See LICENSE in the repo root for license information.
    */
    
    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        padding: 0;
        margin: 0;
    }
    
    .valid.modified:not([type=checkbox]) {
        outline: 1px solid #26b050;
    }
    
    .invalid {
        outline: 1px solid red;
    }
    
    .validation-message {
        color: red;
    }
    
    #blazor-error-ui {
        background: lightyellow;
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
    }
    
    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }
    
    .page-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
    }
    
    .content-container {
        padding: 0px 20px 20px 20px;
        flex-grow: 1;
        overflow-y: scroll;
    }
    
    .titlebar {
        width: 100%;
        height: 32px;
        min-height: 32px;
        background-color: #7160E8;
        display: flex;
        flex-direction: row;
    }
    
    .titlebar-btn, .titlebar-cbtn {
        width: 46px;
        background-color: #7160E8;
        color: white;
        border: none;
        border-radius: 0;
    }
    
    .titlebar-btn:hover {
        background-color: #5A5A5A;
    }
    
    .titlebar-btn:focus, .titlebar-cbtn:focus {
        outline: 0;
    }
    
    .titlebar-cbtn:hover {
        background-color: #E81123;
    }
    
    .window-title {
        display: flex;
        flex-direction: column;
        justify-content: center;
        margin-left: 5px;
        color: white;
    }
    

ä¸Šé¢çš„ä¸€äº›ä»£ç å³å®ç°äº†ç”±`Razor`ç»„ä»¶å®ç°çª—ä½“çš„æ ‡é¢˜æ˜¾ç¤ºã€çª—ä½“çš„æœ€å°åŒ–ã€æœ€å¤§åŒ–ï¼ˆè¿˜åŸï¼‰ã€å…³é—­ã€ç§»åŠ¨ç­‰æ“ä½œï¼Œç„¶è€Œè¿˜æ˜¯ä¼šæœ‰`3.1`ç»“å°¾å‡ºç°çš„é—®é¢˜ï¼Œå³çª—ä½“åœ†è§’å’Œçª—ä½“æœ€å¤§åŒ–é“ºæ»¡æ“ä½œç³»ç»Ÿæ¡Œé¢ä»»åŠ¡æ çš„é—®é¢˜ï¼Œä¸‹é¢ä¸€å°èŠ‚æˆ‘ä»¬å°è¯•è§£å†³ä»–ã€‚

å°èŠ‚æ€»ç»“ï¼šé€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œå¦‚æœæ”¾Tabæ§ä»¶é“ºæ»¡æ•´ä¸ªçª—ä½“ï¼Œæ˜¯ä¸æ˜¯æœ‰æ€è·¯äº†ï¼Ÿ

æœ¬å°èŠ‚æºç åœ¨è¿™[Razorç»„ä»¶å®ç°çª—ä½“æ ‡é¢˜æ åŠŸèƒ½](https://github.com/dotnet9/WPFBlazorChat/tree/main/3WPF%E4%B8%8EBlazor%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AA%97%E4%BD%93/WPFBlazorChat_3Blazor%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AA%97%E4%BD%93%E6%95%88%E6%9E%9C)

### 3.4 Blazorä¸WPFæ¯”è¾ƒå®Œç¾çš„å®ç°æ•ˆæœ

å…¶å®ä¸Šé¢çš„ä»£ç å¯ä»¥å½“åšå­¦ä¹ ï¼Œå³ä½¿æœ‰ä¸å°ç‘•ç–µï¼ˆå“ˆå“ˆï¼‰ï¼Œæœ¬å°èŠ‚æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ç¬¬ä¸‰åŒ…è§£å†³çª—ä½“åœ†è§’å’Œæœ€å¤§åŒ–é—®é¢˜ã€‚

é¦–å…ˆæ·»åŠ `Nuget`åŒ…`ModernWpfUI`ï¼Œè¯¥WPFæ§ä»¶åº“æœ¬ç«™ä»‹ç»é“¾æ¥[å¼€æºWPFæ§ä»¶åº“ï¼šModernWpf](https://dotnet9.com/2020/09/Open-source-WPF-control-library-recommendation-modernwpf)ï¼š

    <PackageReference Include="ModernWpfUI" Version="0.9.7-preview.2" />
    

ç„¶åæ‰“å¼€`App.xaml`ï¼Œå¼•ç”¨ä¸Šé¢å¼€æºWPFæ§ä»¶çš„æ ·å¼ï¼š

    <Application x:Class="WPFBlazorChat.App"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:ui="http://schemas.modernwpf.com/2019"
                 StartupUri="MainWindow.xaml">
        <Application.Resources>
            <ResourceDictionary>
                <ResourceDictionary.MergedDictionaries>
                    <ui:ThemeResources />
                    <ui:XamlControlsResources />
                </ResourceDictionary.MergedDictionaries>
            </ResourceDictionary>
        </Application.Resources>
    </Application>
    

æœ€åæ‰“å¼€`MainWindow.xaml`ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼ˆä¸»è¦æ˜¯å¼•å…¥çš„å‡ ä¸ªå±æ€§`ui:xxxxx`ï¼‰ï¼š

    <Window x:Class="WPFBlazorChat.MainWindow"
            xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            xmlns:ui="http://schemas.modernwpf.com/2019"
            xmlns:blazor="clr-namespace:Microsoft.AspNetCore.Components.WebView.Wpf;assembly=Microsoft.AspNetCore.Components.WebView.Wpf"
            xmlns:razorViews="clr-namespace:WPFBlazorChat.RazorViews"
            mc:Ignorable="d"
            Title="MainWindow" Height="450" Width="800"
            ui:TitleBar.ExtendViewIntoTitleBar="True"
            ui:TitleBar.IsBackButtonVisible="False"
            ui:TitleBar.Style="{DynamicResource AppTitleBarStyle}"
            ui:WindowHelper.UseModernWindowStyle="True">
        <Border Background="#7160E8" CornerRadius="5">
            <blazor:BlazorWebView HostPage="wwwroot\index.html" Services="{DynamicResource services}">
                <blazor:BlazorWebView.RootComponents>
                    <blazor:RootComponent Selector="#app" ComponentType="{x:Type razorViews:Counter}" />
                </blazor:BlazorWebView.RootComponents>
            </blazor:BlazorWebView>
        </Border>
    </Window>
    

å°±ä¸Šé¢ä¸‰å¤„ä¿®æ”¹ï¼Œæˆ‘ä»¬è¿è¡Œçœ‹çœ‹ï¼š

![WPFä¸Blazorè‡ªå®šä¹‰çª—ä½“æ¯”è¾ƒå®Œç¾çš„è§£å†³](https://img1.dotnet9.com/2022/10/1017.gif)

æ˜¯ä¸æ˜¯å’Œ`3.3`æ•ˆæœä¸€æ ·ï¼Ÿå…¶å®ä»”ç»†çœ‹ï¼Œçª—ä½“ä¸‹é¢çš„åœ†è§’ä¹Ÿæœ‰äº†ï¼š

![çª—ä½“åœ†è§’](https://img1.dotnet9.com/2022/10/1018.png)

æœ€ç»ˆè¿˜æ˜¯WPFè§£å†³äº†æ‰€æœ‰é—®é¢˜...

![æˆ‘ç¬‘äº†](https://img1.dotnet9.com/2022/10/1032.gif)

å…·ä½“æ€ä¹ˆå®ç°çš„çª—ä½“æœ€å¤§åŒ–æœªå æ“ä½œç³»ç»Ÿçš„ä»»åŠ¡æ ï¼Œä»¥åŠçª—ä½“åœ†è§’é—®é¢˜çš„è§£å†³ï¼ˆç«Ÿç„¶èƒ½è®©`BlazorWebView`éƒ¨åˆ†é€æ˜äº†ï¼‰å¯ä»¥æŸ¥çœ‹è¯¥ç»„ä»¶ç›¸å…³ä»£ç ï¼Œæœ¬æ–‡ä¸è¿‡å¤šæ·±ç©¶ã€‚

å¦å¤–ï¼ŒWPFç†Ÿæ‰‹å¯èƒ½æ¯”è¾ƒæ¸…æ¥šï¼Œå‰é¢çš„ä»£ç è¿˜ä¸èƒ½æ­£å¸¸çš„æ‹–åŠ¨æ”¹å˜çª—ä½“å¤§å°ï¼ˆä¸çŸ¥é“ä½ å‘ç°æ²¡ï¼Œæˆ‘å½“ä½ æ²¡å‘ç°ã€‚ï¼‰ï¼Œä½¿ç”¨è¯¥åº“åä¹Ÿè§£å†³äº†ï¼š

![çª—ä½“æ‰‹åŠ¨æ”¹å˜å¤§å°](https://img1.dotnet9.com/2022/10/1027.gif)

æœ¬å°èŠ‚æºç åœ¨è¿™[è§£å†³åœ†è§’å’Œæœ€å¤§åŒ–é—®é¢˜](https://github.com/dotnet9/WPFBlazorChat/tree/main/3WPF%E4%B8%8EBlazor%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AA%97%E4%BD%93/WPFBlazorChat_4Blazor%E4%B8%8EWPF%E6%AF%94%E8%BE%83%E5%AE%8C%E7%BE%8E%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C)ï¼Œä¸‹é¢å¼€å§‹æœ¬æ–‡çš„ä¸‹åŠéƒ¨åˆ†äº†ï¼Œå¥½ç´¯ï¼Œç»ˆäºåˆ°è¿™äº†ã€‚

![æˆ‘ç´¯äº†](https://img1.dotnet9.com/2022/10/1033.gif)

4\. æ·»åŠ ç¬¬ä¸‰æ–¹Blazorç»„ä»¶
-----------------

**å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ï¼**

é‰´äºå¤§éƒ¨åˆ†åŒå­¦å‰ç«¯åŸºç¡€å¯èƒ½ä¸æ˜¯å¤ªå¥½ï¼Œå³ä½¿ä½¿ç”¨[Blazor](https://learn.microsoft.com/zh-cn/aspnet/core/blazor/?view=aspnetcore-7.0)å¯ä»¥å°‘ç”¨æˆ–è€…ä¸ç”¨[JavaScript](https://baike.baidu.com/item/JavaScript/321142?fr=aladdin)ï¼Œä½†æœ‰é‚£ä¹ˆä¸€æ¬¾æ¼‚äº®ã€ä¾¿æ·çš„`Blazor`ç»„ä»¶åº“ï¼Œè¿™ä¸æ˜¯å¦‚è™æ·»ç¿¼å—ï¼Ÿæœ¬æ–‡ä½¿ç”¨[Masa Blazor](https://www.masastack.com/blazor)åšç¤ºä¾‹å±•ç¤ºï¼Œå¦‚ä»Š`Blazor`ç»„ä»¶åº“ä¼—å¤šï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„ã€é¡ºæ‰‹çš„å°±æˆï¼š

![Masa Blazor](https://img1.dotnet9.com/2022/10/1019.png)

ç«™é•¿å‰äº›æ—¥å­ä»‹ç»è¿‡[MAUIä½¿ç”¨Masa blazorç»„ä»¶åº“](https://dotnet9.com/2022/06/Use-masa-blazor-in-maui-blazor)ä¸€æ–‡ï¼Œæœ¬å°èŠ‚æ€è·¯ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œä¸”çœ‹æˆ‘è¡¨æ¼”ã€‚

![çœ‹æˆ‘è¡¨æ¼”](https://img1.dotnet9.com/2022/10/1034.png)

æ‰“å¼€Masa Blazoræ–‡æ¡£ç«™ç‚¹ï¼š[https://blazor.masastack.com/getting-started/installationï¼Œä¸€èµ·æ¥å¾€WPFä¸­å¼•å…¥è¿™æ¬¾Blazorç»„ä»¶åº“å§ã€‚](https://blazor.masastack.com/getting-started/installation%EF%BC%8C%E4%B8%80%E8%B5%B7%E6%9D%A5%E5%BE%80WPF%E4%B8%AD%E5%BC%95%E5%85%A5%E8%BF%99%E6%AC%BEBlazor%E7%BB%84%E4%BB%B6%E5%BA%93%E5%90%A7%E3%80%82)

### 4.1 å¼•å…¥Masa.BlazoråŒ…

æ‰“å¼€å·¥ç¨‹æ–‡ä»¶`WPFBlazorChat.csproj`ç›´æ¥å¤åˆ¶ä¸‹é¢çš„åŒ…ç‰ˆæœ¬ï¼Œæˆ–é€šè¿‡`NuGet`åŒ…ç®¡ç†å™¨æœç´¢`Masa.Blazorå®‰è£…`ï¼š

    <PackageReference Include="Masa.Blazor" Version="0.6.0" />
    

### 4.2 æ·»åŠ Masa.Blazorå¸¦æ¥çš„èµ„æº

æ‰“å¼€`wwwroot\index.html`ï¼Œåœ¨`<head></head>`èŠ‚ç‚¹æ·»åŠ å¦‚ä¸‹èµ„æºï¼š

    <link href="_content/Masa.Blazor/css/masa-blazor.min.css" rel="stylesheet" />
    
    <link href="https://cdn.masastack.com/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.masastack.com/npm/materialicons/materialicons.css" rel="stylesheet">
    <link href="https://cdn.masastack.com/npm/fontawesome/v5.0.13/css/all.css" rel="stylesheet">
    
    <script src="_content/BlazorComponent/js/blazor-component.js"></script>
    

å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

    <!DOCTYPE html>
    <html lang="en">
    
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>WPFBlazorChat</title>
        <base href="/" />
        <link href="css/app.css" rel="stylesheet" />
        <link href="WpfBlazor.styles.css" rel="stylesheet" />
    
        <link href="_content/Masa.Blazor/css/masa-blazor.min.css" rel="stylesheet" />
    
        <link href="https://cdn.masastack.com/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
        <link href="https://cdn.masastack.com/npm/materialicons/materialicons.css" rel="stylesheet">
        <link href="https://cdn.masastack.com/npm/fontawesome/v5.0.13/css/all.css" rel="stylesheet">
    
        <script src="_content/BlazorComponent/js/blazor-component.js"></script>
    </head>
    
    <body>
    <div id="app">Loading...</div>
    
    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ğŸ—™</a>
    </div>
    <script src="_framework/blazor.webview.js"></script>
    </body>
    
    </html>
    

### 4.3 å¼•å…¥Masa.Blazorå‘½åç©ºé—´

æ‰“å¼€`_Imports.razor`æ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š

    @using Microsoft.AspNetCore.Components.Web
    @using Masa.Blazor
    @using BlazorComponent
    

### 4.4 Razorç»„ä»¶æ·»åŠ Masa.Blazor

æ‰“å¼€`MainWindow.xaml.cs`ï¼Œæ·»åŠ ä¸€è¡Œä»£ç  `serviceCollection.AddMasaBlazor();`

![Iocä¸­æ·»åŠ Masa Blazor](https://img1.dotnet9.com/2022/10/1020.png)

### 4.5 å°è¯•Masa.Blazoræ¡ˆä¾‹

ä¸Šé¢4æ­¥çš„å‡†å¤‡å·¥ä½œåšå¥½åï¼Œæˆ‘ä»¬ç®€å•æ¥ä½¿ç”¨ä¸‹`Masa.Blazor`ç»„ä»¶ã€‚

æ‰“å¼€Tabç»„ä»¶é“¾æ¥ï¼š[https://blazor.masastack.com/components/tabsï¼Œå°è¯•è¿™ä¸ªDemoï¼š](https://blazor.masastack.com/components/tabs%EF%BC%8C%E5%B0%9D%E8%AF%95%E8%BF%99%E4%B8%AADemo%EF%BC%9A)

![Masa Blazorçš„Tabç»„ä»¶æ¡ˆä¾‹](https://img1.dotnet9.com/2022/10/1021.gif)

Demoçš„ä»£ç æˆ‘å‡ ä¹ä¸å˜çš„å¼•å…¥ï¼Œæ‰“å¼€`RazorViews\Counter.razor`æ–‡ä»¶ï¼Œä¿ç•™`3.4`èŠ‚çš„æ ‡é¢˜æ ï¼Œæ›¿æ¢äº†å®¢æˆ·åŒºåŸŸå†…å®¹ï¼Œä»£ç å¦‚ä¸‹ï¼š

    @using WPFBlazorChat.Services
    
    <MApp>
        <!--ä¸Šä¸€å°èŠ‚çš„æ ‡é¢˜æ å¼€å§‹-->
        <div class="titlebar" @ondblclick="WindowService.Maximize" @onmouseup="WindowService.StopMove" @onmousedown="WindowService.StartMove">
            <button class="titlebar-btn" onclick="alert('js alert: navigation pressed');">
                <img src="svg/navigation.svg"/>
            </button>
            <div class="window-title">
                æµ‹è¯•çª—ä½“æ ‡é¢˜
            </div>
            <div style="flex-grow: 1"></div>
            <button class="titlebar-btn" onclick="alert('js alert: settings pressed');">
                <img src="svg/settings.svg"/>
            </button>
            <button class="titlebar-btn" @onclick="WindowService.Minimize">
                <img src="svg/minimize.svg"/>
            </button>
            <button class="titlebar-btn" @onclick="WindowService.Maximize">
                @if (WindowService.IsMaximized())
                {
                    <img src="svg/restore.svg"/>
                }
                else
                {
                    <img src="svg/maximize.svg"/>
                }
            </button>
            <button class="titlebar-cbtn" @onclick="() => WindowService.Close(false)">
                <img src="svg/dismiss.svg"/>
            </button>
        </div>
        <!--ä¸Šä¸€å°èŠ‚çš„æ ‡é¢˜æ ç»“æŸ-->
        
        <!--æ–°å¢çš„Masa.Blazor Tabæ¡ˆä¾‹ä»£ç å¼€å§‹-->
        <MCard>
            <MToolbar Color="cyan" Dark Flat>
                <ChildContent>
                    <MAppBarNavIcon></MAppBarNavIcon>
    
                    <MToolbarTitle>Your Dashboard</MToolbarTitle>
    
                    <MSpacer></MSpacer>
    
                    <MButton Icon>
                        <MIcon>mdi-magnify</MIcon>
                    </MButton>
    
                    <MButton Icon>
                        <MIcon>mdi-dots-vertical</MIcon>
                    </MButton>
                </ChildContent>
    
                <ExtensionContent>
                    <MTabs @bind-Value="tab"
                           AlignWithTitle
                           SliderColor="yellow">
                        @foreach (var item in items)
                        {
                            <MTab Value="item">
                                @item
                            </MTab>
                        }
                    </MTabs>
                </ExtensionContent>
            </MToolbar>
    
            <MTabsItems @bind-Value="tab">
                @foreach (var item in items)
                {
                    <MTabItem Value="item">
                        <MCard Flat>
                            <MCardText>@text</MCardText>
                        </MCard>
                    </MTabItem>
                }
            </MTabsItems>
        </MCard>
        <!--æ–°å¢çš„Masa.Blazor Tabæ¡ˆä¾‹ä»£ç ç»“æŸ-->
    </MApp>
    
    @code {
    
        #region Masa.Blazor Tabæ¡ˆä¾‹C#ä»£ç 
        StringNumber tab;
    
        List<string> items = new()
        {
            "web", "shopping", "videos", "images", "news",
        };
    
        string text = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.";
    
        #endregion
        
        
        protected override void OnInitialized()
        {
            WindowService.Init();
            base.OnInitialized();
        }
    }
    

è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š

![Masa Blazorçš„Tabç»„ä»¶æ¡ˆä¾‹é›†æˆ](https://img1.dotnet9.com/2022/10/1022.gif)

æ˜¯ä¸æ˜¯æœ‰é‚£å‘³å„¿äº†ï¼Ÿå†å°è¯•æŠŠTabç§»åˆ°æ ‡é¢˜æ ï¼Œå‰é¢æœ‰æè¿‡çš„æ•ˆæœï¼š

![Tabæ”¾æ ‡é¢˜æ ](https://img1.dotnet9.com/2022/10/1023.gif)

ä¸Šé¢çš„æ•ˆæœï¼Œä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼Œåˆ é™¤äº†åŸæ ‡é¢˜æ ä»£ç ï¼Œå°†çª—ä½“æ“ä½œæŒ‰é’®æ”¾åˆ°äº†`MToolbar`é‡Œé¢ï¼Œå¹¶ä½¿ç”¨`MToolbar`æ·»åŠ äº†åŒå‡»äº‹ä»¶ã€é¼ æ ‡æŒ‰ä¸‹ã€é‡Šæ”¾äº‹ä»¶å®ç°çª—ä½“æ‹–åŠ¨ï¼š

    <MApp>
    
        <!--æ–°å¢çš„Masa.Blazor Tabæ¡ˆä¾‹ä»£ç å¼€å§‹-->
        <MCard>
            <MToolbar Color="cyan" Dark Flat @ondblclick="WindowService.Maximize" @onmouseup="WindowService.StopMove" @onmousedown="WindowService.StartMove">
                <MTabs @bind-Value="tab"
                       AlignWithTitle
                       SliderColor="yellow">
                    @foreach (var item in items)
                    {
                        <MTab Value="item">
                            @item
                        </MTab>
                    }
                </MTabs>
                
                <div style="flex-grow: 1"></div>
                <button class="titlebar-btn" onclick="alert('js alert: settings pressed');">
                    <img src="svg/settings.svg"/>
                </button>
                <button class="titlebar-btn" @onclick="WindowService.Minimize">
                    <img src="svg/minimize.svg"/>
                </button>
                <button class="titlebar-btn" @onclick="WindowService.Maximize">
                    @if (WindowService.IsMaximized())
                    {
                        <img src="svg/restore.svg"/>
                    }
                    else
                    {
                        <img src="svg/maximize.svg"/>
                    }
                </button>
                <button class="titlebar-cbtn" @onclick="() => WindowService.Close(false)">
                    <img src="svg/dismiss.svg"/>
                </button>
            </MToolbar>
    
            <MTabsItems @bind-Value="tab">
                @foreach (var item in items)
                {
                    <MTabItem Value="item">
                        <MCard Flat>
                            <MCardText>@text</MCardText>
                        </MCard>
                    </MTabItem>
                }
            </MTabsItems>
        </MCard>
        <!--æ–°å¢çš„Masa.Blazor Tabæ¡ˆä¾‹ä»£ç ç»“æŸ-->
    </MApp>
    

çª—ä½“æ“ä½œæŒ‰é’®çš„èƒŒæ™¯è‰²ä¹Ÿåšéƒ¨åˆ†ä¿®æ”¹ï¼š

![æ ·å¼éƒ¨åˆ†ä¿®æ”¹](https://img1.dotnet9.com/2022/10/1024.png)

å…¶å®ä¸Šé¢çš„çª—ä½“æ•ˆæœè¿˜æ˜¯æœ‰ç‚¹ç‘•ç–µï¼Œæ³¨æ„åˆ°çª—ä½“å³ä¾§çš„ç«–ç›´æ»šåŠ¨æ¡äº†å—ï¼Ÿåœ¨æ²¡å¼•å…¥`Masa.Blazor`ä¹‹å‰ï¼Œå³ä¾§æ­£å¸¸æ˜¾ç¤ºï¼Œå¼•å…¥åå¤šäº†ä¸€ä¸ªç«–ç›´æ»šåŠ¨æ¡ï¼š

![å¼•å…¥Masa.Blazoråå¤šäº†ç«–ç›´æ»šåŠ¨æ¡](https://img1.dotnet9.com/2022/10/1025.png)

è¿™ä¸ªæƒ³å»æ‰ä¹Ÿç®€å•ï¼Œåœ¨`wwwroot\css\app.css`è¿½åŠ æ ·å¼ï¼ˆå½“æ—¶ä¹Ÿæ˜¯æŠ˜è…¾äº†å¥½ä¸€ä¼šå„¿ï¼Œæœ€ååœ¨`Masa.Blazor`ç¾¤é‡Œç¾¤å‹ç»™å‡ºäº†è§£å†³æ–¹æ¡ˆï¼Œååˆ†æ„Ÿè°¢ï¼‰ï¼š

![é—®é¢˜è§£å†³è¿‡ç¨‹](https://img1.dotnet9.com/2022/10/1035.jpg)

é—®é¢˜è§£å†³`css`ä»£ç ï¼š

    ::-webkit-scrollbar {
        width: 0px;
    }
    

å› ä¸º`Razor`ç»„ä»¶æ˜¯åœ¨`BlazorWebView`é‡Œæ¸²æŸ“çš„ï¼Œå³`BlazorWebView`å°±æ˜¯ä¸ªå°å‹çš„æµè§ˆå™¨å‘€ï¼Œä¸Šé¢çš„æ ·å¼å³æŠŠæµè§ˆå™¨çš„æ»šåŠ¨æ¡å®½åº¦è®¾ç½®ä¸º0ï¼Œå®ƒä¸å°±æ²¡æœ‰äº†å—ï¼Ÿç°åœ¨æ•ˆæœå¦‚ä¸‹ï¼Œæ˜¯ä¸æ˜¯èˆ’æœäº†ï¼Ÿ

![æ ¹æ®åç•Œé¢](https://img1.dotnet9.com/2022/10/1026.png)

æ·»åŠ Masa.Blazorå°±ä»‹ç»åˆ°è¿™é‡Œï¼Œæœ¬å°èŠ‚ç¤ºä¾‹ä»£ç åœ¨è¿™é‡Œ[WPFä¸­ä½¿ç”¨Masa.Blazor](https://github.com/dotnet9/WPFBlazorChat/tree/main/4%E4%BD%BF%E7%94%A8MasaBlazor),ä¸‹é¢è®²è§£WPFä¸Blazoræ··åˆå¼€å‘åå¤šçª—ä½“æ¶ˆæ¯é€šçŸ¥é—®é¢˜ã€‚

5\. å¤šçª—ä½“æ¶ˆæ¯é€šçŸ¥
-----------

ä¸€èˆ¬`C/S`çª—ä½“ä¹‹é—´é€šä¿¡ä½¿ç”¨å§”æ‰˜ã€äº‹ä»¶ï¼Œè€Œåœ¨`WPF`å¼€å‘ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›æ¡†æ¶æä¾›çš„æŠ½è±¡äº‹ä»¶`è®¢é˜…\å‘å¸ƒ`ç»„ä»¶ï¼Œæ¯”å¦‚`Prism`çš„äº‹ä»¶èšé›†å™¨`IEventAggregator`ï¼Œæˆ–`MvvmLight`çš„`Messager`ã€‚åœ¨`B/S`å¼€å‘ä¸­ï¼Œè¿›ç¨‹å†…äº‹ä»¶é€šçŸ¥å¯èƒ½å°±ä½¿ç”¨`MediatR`ç»„ä»¶å±…å¤šäº†ï¼Œä¸è®ºæ˜¯åœ¨`C/S`è¿˜æ˜¯`B/S`å¼€å‘ï¼Œè¿™äº›ç»„ä»¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œå„å¤§ç¨‹åºæ¨¡æ¿å¯ä»¥é€šç”¨çš„ï¼Œæ›´ä¸ç”¨è¯´åˆ†å¸ƒå¼çš„æ¶ˆæ¯é˜Ÿåˆ—`RabbitMQ` å’Œ `Kafka`æ˜¯ä¸‡èƒ½çš„è¿›ç¨‹é—´é€šä¿¡æ ‡å‡†é€‰æ‹©äº†ã€‚

ä¸Šé¢æ˜¯ä¸€äº›å¥—è¯ï¼Œç«™é•¿æ ¹æ®`Prism`çš„äº‹ä»¶èšé›†å™¨å’Œ`MvvmLight`çš„Messageræºç é˜…è¯»ï¼Œç®€å•å°è£…äº†ä¸€ä¸ª`Messager`ï¼Œå¯ä»¥é€‚ç”¨äºä¸€èˆ¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚

### 5.1 Messagerå°è£…

æœ¬æ¥ä¸æƒ³è´´ä»£ç ç›´æ¥ç»™æºç é“¾æ¥çš„ï¼Œæƒ³æƒ³ä»£ç ä¹Ÿä¸å¤šï¼Œç›´æ¥ä¸Šå§ã€‚

**Message**

æ¶ˆæ¯æŠ½è±¡ç±»ï¼Œç”¨äºå®šä¹‰æ¶ˆæ¯ç±»å‹ï¼Œå…·ä½“çš„æ¶ˆæ¯éœ€è¦ç»§æ‰¿è¯¥ç±»ï¼Œæ¯”å¦‚åé¢çš„æ‰“å¼€å­çª—ä½“æ¶ˆæ¯`OpenSecondViewMessage`ã€‚

    using System;
    
    namespace WPFBlazorChat.Messages;
    
    public abstract class Message
    {
        protected Message(object sender)
        {
            this.Sender = sender ?? throw new ArgumentNullException(nameof(sender));
        }
    
        public object Sender { get; }
    }
    

**IMessenger**

æ¶ˆæ¯æ¥å£ï¼Œåªå®šä¹‰äº†ä¸‰ä¸ªæ¥å£ï¼š

1.  Subscribeï¼šæ¶ˆæ¯è®¢é˜…
2.  Unsubscribeï¼šå–æ¶ˆæ¶ˆæ¯è®¢é˜…
3.  Publishï¼šæ¶ˆæ¯å‘é€

    using System;
    
    namespace WPFBlazorChat.Messages;
    
    public interface IMessenger
    {
        void Subscribe<TMessage>(object recipient, Action<TMessage> action,
            ThreadOption threadOption = ThreadOption.PublisherThread) where TMessage : Message;
    
        void Unsubscribe<TMessage>(object recipient, Action<TMessage>? action = null) where TMessage : Message;
    
        void Publish<TMessage>(object sender, TMessage message) where TMessage : Message;
    }
    
    public enum ThreadOption
    {
        PublisherThread,
        BackgroundThread,
        UiThread
    }
    

**Messenger**

æ¶ˆæ¯çš„ç®¡ç†ï¼Œæ¶ˆæ¯ä¸­è½¬ç­‰å®ç°ï¼š

    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading;
    using System.Threading.Tasks;
    
    namespace WPFBlazorChat.Messages;
    
    public class Messenger : IMessenger
    {
        public static readonly Messenger Default = new Messenger();
        private readonly object registerLock = new object();
    
        private Dictionary<Type, List<WeakActionAndToken>>? recipientsOfSubclassesAction;
    
        public void Subscribe<TMessage>(object recipient, Action<TMessage> action, ThreadOption threadOption)
            where TMessage : Message
        {
            lock (this.registerLock)
            {
                var messageType = typeof(TMessage);
    
                this.recipientsOfSubclassesAction ??= new Dictionary<Type, List<WeakActionAndToken>>();
    
                List<WeakActionAndToken> list;
    
                if (!this.recipientsOfSubclassesAction.ContainsKey(messageType))
                {
                    list = new List<WeakActionAndToken>();
                    this.recipientsOfSubclassesAction.Add(messageType, list);
                }
                else
                {
                    list = this.recipientsOfSubclassesAction[messageType];
                }
    
                var item = new WeakActionAndToken
                { Recipient = recipient, ThreadOption = threadOption, Action = action };
    
                list.Add(item);
            }
        }
    
        public void Unsubscribe<TMessage>(object? recipient, Action<TMessage>? action) where TMessage : Message
        {
            var messageType = typeof(TMessage);
    
            if (recipient == null || this.recipientsOfSubclassesAction == null ||
                this.recipientsOfSubclassesAction.Count == 0 || !this.recipientsOfSubclassesAction.ContainsKey(messageType))
            {
                return;
            }
    
            var lstActions = this.recipientsOfSubclassesAction[messageType];
            for (var i = lstActions.Count - 1; i >= 0; i--)
            {
                var item = lstActions[i];
                var pastAction = item.Action;
    
                if (pastAction != null
                    && recipient == pastAction.Target
                    && (action == null || action.Method.Name == pastAction.Method.Name))
                {
                    lstActions.Remove(item);
                }
            }
        }
    
        public void Publish<TMessage>(object sender, TMessage message) where TMessage : Message
        {
            var messageType = typeof(TMessage);
    
            if (this.recipientsOfSubclassesAction != null)
            {
                var listClone = this.recipientsOfSubclassesAction.Keys.Take(this.recipientsOfSubclassesAction.Count)
                    .ToList();
    
                foreach (var type in listClone)
                {
                    List<WeakActionAndToken>? list = null;
    
                    if (messageType == type || messageType.IsSubclassOf(type) || type.IsAssignableFrom(messageType))
                    {
                        list = this.recipientsOfSubclassesAction[type]
                            .Take(this.recipientsOfSubclassesAction[type].Count)
                            .ToList();
                    }
    
                    if (list is { Count: > 0 })
                    {
                        this.SendToList(message, list);
                    }
                }
            }
        }
    
        private void SendToList<TMessage>(TMessage message, IEnumerable<WeakActionAndToken> weakActionsAndTokens)
            where TMessage : Message
        {
            var list = weakActionsAndTokens.ToList();
            var listClone = list.Take(list.Count()).ToList();
    
            foreach (var item in listClone)
            {
                if (item.Action is { Target: { } })
                {
                    switch (item.ThreadOption)
                    {
                        case ThreadOption.BackgroundThread:
                            Task.Run(() => { item.ExecuteWithObject(message); });
                            break;
                        case ThreadOption.UiThread:
                            SynchronizationContext.Current!.Post(_ => { item.ExecuteWithObject(message); }, null);
                            break;
                        default:
                            item.ExecuteWithObject(message);
                            break;
                    }
                }
            }
        }
    }
    
    public class WeakActionAndToken
    {
        public object? Recipient { get; set; }
    
        public ThreadOption ThreadOption { get; set; }
    
        public Delegate? Action { get; set; }
    
        public string? Tag { get; set; }
    
        public void ExecuteWithObject<TMessage>(TMessage message) where TMessage : Message
        {
            if (this.Action is Action<TMessage> factAction)
            {
                factAction.Invoke(message);
            }
        }
    }
    

æœ‰å…´è¶£çš„çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå°è£…ä»£ç ä¸Šé¢ç®€å•å…¨éƒ¨ç»™ä¸Šï¼Œåé¢çš„æ¶ˆæ¯é€šçŸ¥éƒ½æ˜¯åŸºäºä¸Šé¢çš„ä¸‰ä¸ªç±»å®ç°çš„ï¼Œæ¯”è¾ƒæ ¸å¿ƒã€‚

### 5.2 ä»£ç æ•´ç†

ç¬¬ 5 èŠ‚æ¶‰åŠåˆ°å¤šçª—ä½“åŠå¤š`Razor`ç»„ä»¶äº†ï¼Œéœ€è¦åˆ›å»ºä¸€äº›ç›®å½•å­˜æ”¾è¿™äº›æ–‡ä»¶ï¼Œæ–¹ä¾¿åˆ†ç±»ç®¡ç†ã€‚

![æ•´ç†åä»£ç ](https://img1.dotnet9.com/2022/10/1028.png)

1.  Aï¼šæ”¾`Message`ï¼Œå³ä¸€äº›æ¶ˆæ¯é€šçŸ¥ç±»ï¼›
    
2.  Bï¼šæ”¾`Razor`ç»„ä»¶ï¼Œå¦‚æœéœ€è¦ä¸`Maui\Blazor Server(Wasm)`ç­‰å…±äº«`Razor`ç»„ä»¶ï¼Œå¯ä»¥åˆ›å»º`Razorç±»åº“`å­˜å‚¨ï¼›
    
3.  Cï¼šæ”¾é€šç”¨æœåŠ¡ï¼Œè¿™é‡Œåªæ”¾äº†ä¸€ä¸ªçª—ä½“ç®¡ç†é™æ€ç±»ï¼Œå®é™…æƒ…å†µå¯ä»¥æ”¾`Redis`æœåŠ¡ã€`RabbitMQ`æ¶ˆæ¯æœåŠ¡ç­‰ï¼›
    
4.  Dï¼šæ”¾`WPF`è§†å›¾ï¼Œæœ¬ç¤ºä¾‹WPFçª—ä½“åªæ˜¯ä¸€ä¸ªå£³ï¼Œæ‰¿è½½`BlazorWebView`ä½¿ç”¨ï¼›
    

### 5.3 ç¤ºä¾‹åŠä»£ç è¯´æ˜

å…ˆçœ‹æœ¬ç¤ºä¾‹æ•ˆæœï¼Œå†ç»™å‡ºç›¸å…³ä»£ç è¯´æ˜ï¼š

![æ¶ˆæ¯é€šçŸ¥ç¤ºä¾‹](https://img1.dotnet9.com/2022/10/1029.gif)

å›¾ä¸­æœ‰ä¸‰ä¸ªæ“ä½œï¼š

1.  ç‚¹å‡»ä¸»çª—ä½“Açš„ã€+ã€‘æŒ‰é’®ï¼Œå‘é€äº†`OpenSecondViewMessage`æ¶ˆæ¯ï¼Œæ‰“å¼€å­çª—ä½“Bï¼›
2.  æ‰“å¼€å­çª—ä½“Båï¼Œå†ç‚¹å‡»ä¸»çª—ä½“Açš„ã€æ¡ƒå¿ƒã€‘æŒ‰é’®ï¼Œå‘é€äº†`SendRandomDataMessage`æ¶ˆæ¯ï¼Œå­çª—ä½“Bçš„ç¬¬äºŒä¸ª`TabItem Header`æ˜¾ç¤ºäº†æ¶ˆæ¯ä¼ æ¥çš„æ•°å­—ï¼›
3.  ç‚¹å‡»å­çª—ä½“Bçš„ã€å®‰å“ã€‘å›¾æ ‡æŒ‰é’®ï¼Œç»™ä¸»çª—ä½“Aå“åº”äº†æ¶ˆæ¯`ReceivedResponseMessage`,ä¸»çª—ä½“æ”¶åˆ°åå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ã€‚

ä¸‰ä¸ªæ¶ˆæ¯ç±»å®šä¹‰å¦‚ä¸‹ï¼š

    public class OpenSecondViewMessage : Message
    {
        public OpenSecondViewMessage(object sender) : base(sender)
        {
        }
    }
    
    public class SendRandomDataMessage : Message
    {
        public SendRandomDataMessage(object sender, int number) : base(sender)
        {
            Number = number;
        }
    
        public int Number { get; set; }
    }
    
    public class ReceivedResponseMessage : Message
    {
        public ReceivedResponseMessage(object sender) : base(sender)
        {
        }
    }
    

é™¤äº†`SendRandomDataMessage`ä¼ é€’äº†ä¸€ä¸ªä¸šåŠ¡`Number`å±æ€§ï¼Œå¦ä¸¤ä¸ªæ¶ˆæ¯åªæ˜¯èµ·åˆ°é€šçŸ¥ä½œç”¨(æ‰€ä»¥æ²¡æœ‰é¢å¤–å±æ€§å®šä¹‰ï¼‰ï¼Œå®é™…å¼€å‘æ—¶å¯èƒ½éœ€è¦ä¼ é€’ä¸šåŠ¡æ•°æ®ã€‚

#### 5.3.1 æ‰“å¼€å¤šçª—ä½“

å³ä¸Šé¢çš„ç¬¬ä¸€ä¸ªæ“ä½œï¼šç‚¹å‡»ä¸»çª—ä½“Açš„ã€+ã€‘æŒ‰é’®ï¼Œå‘é€äº†`OpenSecondViewMessage`æ¶ˆæ¯ï¼Œæ‰“å¼€å­çª—ä½“Bã€‚

åœ¨`RazorViews\MainView.razor`ä¸­æ‰§è¡ŒæŒ‰é’®ç‚¹å‡»ï¼Œå‘é€æ‰“å¼€å­çª—ä½“æ¶ˆæ¯ï¼š

    ...
    <MCol>
        <MButton class="mx-2" Fab Dark Color="indigo" OnClick="OpenNewSecondView">
            <MIcon>mdi-plus</MIcon>
        </MButton>
    </MCol>
    ...
    
    @code{
    ...
    void OpenNewSecondView()
    {
    	Messenger.Default.Publish(this, new OpenSecondViewMessage(this));
    }
    ...
    }
    

åœ¨`App.xaml.cs`é‡Œè®¢é˜…æ‰“å¼€å­çª—ä½“æ¶ˆæ¯ï¼š

    public partial class App : Application
    {
        public App()
        {
            // è®¢é˜…æ‰“å¼€å­çª—å£æ¶ˆæ¯ï¼Œåœ¨ä¸»çª—å£ç‚¹å‡»ã€+ã€‘æŒ‰é’®
            Messenger.Default.Subscribe<OpenSecondViewMessage>(this, msg =>
            {
                var chatWin = new SecondWindowView();
                chatWin.Show();
            }, ThreadOption.UiThread);
        }
    }
    

å®é™…å¼€å‘å¯èƒ½æƒ…å†µæ›´å¤æ‚ï¼Œå‘é€çš„æ¶ˆæ¯`OpenSecondViewMessage`é‡Œå¸¦WPFçª—ä½“è·¯ç”±ï¼ˆå®šä¹‰çš„ä¸€å¥—è·¯å¾„è§„åˆ™å¯»æ‰¾çª—ä½“æˆ–`ViewModel`ï¼‰ï¼Œè®¢é˜…çš„åœ°æ–¹ä¹Ÿå¯èƒ½ä¸åœ¨ä¸»ç¨‹åºï¼Œåœ¨å­æ¨¡å—çš„`Module`ç±»é‡Œã€‚

#### 5.3.2 å‘é€ä¸šåŠ¡æ•°æ®

å³ç¬¬äºŒä¸ªæ“ä½œï¼šæ‰“å¼€å­çª—ä½“Båï¼Œå†ç‚¹å‡»ä¸»çª—ä½“Açš„ã€æ¡ƒå¿ƒã€‘æŒ‰é’®ï¼Œå‘é€äº†`SendRandomDataMessage`æ¶ˆæ¯ï¼Œå­çª—ä½“Bçš„ç¬¬äºŒä¸ª`TabItem Header`æ˜¾ç¤ºäº†æ¶ˆæ¯ä¼ æ¥çš„æ•°å­—ã€‚

1.  åœ¨`RazorViews\MainView.razor`ä¸­æ‰§è¡ŒæŒ‰é’®ç‚¹å‡»ï¼Œå‘é€ä¸šåŠ¡æ¶ˆæ¯(å°±å½“å‰æ—¶é—´çš„`Millisecond`ï¼‰ï¼š

    ...
    <MCol>
        <MButton class="mx-2" Fab Small Dark Color="pink" OnClick="SendNumber">
            <MIcon>mdi-heart</MIcon>
        </MButton>
    </MCol>
    ...
    
    @code{
    ...
    void SendNumber()
    {
    	Messenger.Default.Publish(this, new SendRandomDataMessage(this, DateTime.Now.Millisecond));
    }
    ...
    }
    

2.  åœ¨`RazorViews\SecondView.razor`çš„`OnInitialized()`æ–¹æ³•é‡Œè®¢é˜…ä¸šåŠ¡æ¶ˆæ¯é€šçŸ¥ï¼š

    @using WPFBlazorChat.Messages
    <MApp>
        <MToolbar>
            <MTabs BackgroundColor="primary" Grow Dark>
                <MTab>
                    <MBadge Color="pink" Dot>
                        Item One
                    </MBadge>
                </MTab>
                <MTab>
                    <MBadge Color="green" Content="tagCount">
                        Item Two
                    </MBadge>
                </MTab>
                <MTab>
                    <MBadge Color="deep-purple accent-4" Icon="mi-masa">
                        Item Three
                    </MBadge>
                </MTab>
            </MTabs>
        </MToolbar>
        
        <MRow>
            <MButton class="mx-2" Fab Dark Large Color="purple" OnClick="ReponseMessage">
                <MIcon>
                    mdi-android
                </MIcon>
            </MButton>
        </MRow>
    </MApp>
    
    @code
    {
        private int tagCount = 6;
    
        protected override void OnInitialized()
        {
        	// è®¢é˜…ä¸šåŠ¡æ¶ˆæ¯ï¼Œåœ¨ä¸»çª—å£ç‚¹å‡»æ¡ƒå¿ƒæŒ‰é’®æ—¶è§¦å‘
            Messenger.Default.Subscribe<SendRandomDataMessage>(this, msg =>
            {
                this.InvokeAsync(() => { this.tagCount = msg.Number; });
                this.StateHasChanged();
            }, ThreadOption.UiThread);
        }
    
        void ReponseMessage()
        {
            // é€šçŸ¥ä¸»çª—ä½“ï¼Œæˆ‘å·²ç»æ”¶åˆ°æ¶ˆæ¯ï¼Œè¯·ä¸è¦å†å‘
            Messenger.Default.Publish(this, new ReceivedResponseMessage(this));
        }
    }
    

æ³¨æ„çœ‹ï¼Œä¸Šé¢æ”¶åˆ°æ¶ˆæ¯æ—¶æœ‰ä¸¤ä¸ªæ–¹æ³•è¦ç®€å•è¯´ä¸€ä¸‹ï¼Œçœ‹`OnInitialized()`é‡Œçš„ä»£ç ï¼š

*   InvokeAsyncï¼šå°†`Number`èµ‹å€¼ç»™å˜é‡`tagCount`çš„ä»£ç æ˜¯åœ¨`InvokeAsync`æ–¹æ³•é‡Œæ‰§è¡Œçš„ï¼Œè¿™ä¸ªå’ŒWPFé‡Œçš„`Dispatcher.Invoke`æ˜¯ä¸€ä¸ªæ„æ€ï¼Œç›¸å½“äºæ¥æ”¶æ•°æ®æ˜¯åœ¨å­çº¿ç¨‹ï¼Œè€Œèµ‹å€¼è¿™ä¸ªæ“ä½œä¼šå³æ—¶çš„ç»‘å®šåˆ°`<MBadge Color="green" Content="tagCount">`ä¸Šï¼Œå°±éœ€è¦UIçº¿ç¨‹åŒæ­¥ã€‚
*   StateHasChangedï¼šç›¸å½“äºWPF MVVMé‡Œçš„`PropertyChanged`äº‹ä»¶é€šçŸ¥ï¼Œé€šçŸ¥`UI`è¿™é‡Œæœ‰å€¼å˜åŒ–äº†ï¼Œè¯·ä½ åˆ·æ–°ä¸€ä¸‹ï¼Œæˆ‘è¦çœ‹çœ‹æœ€æ–°å€¼ã€‚

ä¸Šé¢çš„ä»£ç æŠŠå­çª—ä½“æ¶ˆæ¯å›åº”ä¹Ÿè´´ä¸Šäº†ï¼Œå³ç‚¹å‡»å®‰å“å›¾æ ‡æŒ‰é’®æ—¶å‘é€äº†`ReceivedResponseMessage`æ¶ˆæ¯ï¼Œåœ¨ä¸»çª—ä½“`RazorViews\MainView.razor`é‡Œä¹Ÿè®¢é˜…äº†è¿™ä¸ªæ¶ˆæ¯ï¼Œå’Œä¸Šé¢çš„ä»£ç ç±»ä¼¼ï¼š

    ...
        <!--ç¡®è®¤å¯¹è¯æ¡†å¼€å§‹-->
        <PConfirm Visible="_showComfirmDialog"
                  Title="å­çª—ä½“æ¥å›åº”äº†"
                  Type="AlertTypes.Warning"
                  OnCancel="() => _showComfirmDialog = false"
                  OnOk="() => _showComfirmDialog = false">
            è¯´ä½ åˆ«æ²¡äº‹ä¸€ç›´å‘ï¼Œå®ƒä»¬çƒ¦ï¼
        </PConfirm>
        <!--ç¡®è®¤å¯¹è¯æ¡†ç»“æŸ-->
    </MApp>
    
    @code{
    ...
    	// æ˜¯å¦æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        bool _showComfirmDialog;
    	protected override void OnInitialized()
        {
            WindowService.Init();
    
        // è®¢é˜…å­çª—ä½“å“åº”çš„æ¶ˆæ¯ï¼Œå®ƒå·²ç»æ”¶åˆ°æ¶ˆæ¯äº†ï¼Œæˆ‘å¯ä»¥ä¼‘æ¯ä¸‹å†å‘
            Messenger.Default.Subscribe<ReceivedResponseMessage>(this, msg =>
            {
                this.InvokeAsync(() => { _showComfirmDialog = true; });
                this.StateHasChanged();
            }, ThreadOption.UiThread);
            base.OnInitialized();
        }
    ...
    }
    

åœ¨`OnInitialized()`æ–¹æ³•é‡Œè®¢é˜…æ¶ˆæ¯`ReceivedResponseMessage`ï¼Œæ”¶åˆ°åå°†å˜é‡`_showComfirmDialog`ç½®ä¸º`true`ï¼Œå³ä¸Šé¢å¯¹è¯æ¡†çš„å±æ€§`Visible`ç»‘å®šçš„å€¼ï¼ŒåŒç†éœ€è¦åœ¨`InvokeAsync()`ä¸­å¤„ç†æ•°æ®æ¥æ”¶ï¼Œä¹Ÿéœ€è¦è°ƒç”¨`StateHasChanged`é€šçŸ¥UIæ•°æ®å˜åŒ–ã€‚

ä¸Šé¢è¯´äº†éƒ¨åˆ†ä»£ç ï¼Œå¯èƒ½è®²çš„ä¸å¤ªæ¸…æ¥šï¼Œå¯ä»¥çœ‹æœ¬èŠ‚ç¤ºä¾‹æºç ï¼š[å¤šçª—ä½“æ¶ˆæ¯é€šçŸ¥](https://github.com/dotnet9/WPFBlazorChat/tree/main/5WPFBlazor%E6%B6%88%E6%81%AF%E9%80%9A%E7%9F%A5/WPFBlazorChat)ã€‚

6\. æœ¬æ–‡ç¤ºä¾‹
--------

æœ¬æ¥æƒ³å†™å®Œæ•´Demoè¯´æ˜çš„ï¼Œå‘ç°ä¸Šé¢æŠŠåŸºæœ¬è¦ç‚¹éƒ½æ‹‰äº†ä¸€éï¼Œå†ç²˜è´´ä¸€äº›é‡å¤ä»£ç æœ‰ç‚¹æ²¡å®Œæ²¡äº†äº†ï¼Œæœ‰å…´è¶£çš„æ‹‰æºç [WPFä¸Blazoræ··åˆå¼€å‘Demo](https://github.com/dotnet9/WPFBlazorChat/tree/main/src)æŸ¥çœ‹ã€è¿è¡Œï¼Œä¸‹é¢æ˜¯é¡¹ç›®ä»£ç ç»“æ„ï¼š

![Demoä»£ç ç»“æ„](https://img1.dotnet9.com/2022/10/1030.png)

ä¸‹é¢æ˜¯æœ€åçš„ç¤ºä¾‹æ•ˆæœå›¾ï¼Œå‰é¢éƒ¨åˆ†æ–‡ç« å·²ç»å‘è¿‡ï¼Œå†å‘ä¸€æ¬¡ï¼Œå“ˆå“ˆï¼š

**ç”¨æˆ·åˆ—è¡¨çª—å£**

![ç”¨æˆ·åˆ—è¡¨](https://img1.dotnet9.com/2022/10/1-main-window.gif)

**æ‰“å¼€å­çª—å£**

![æ‰“å¼€çª—å£](https://img1.dotnet9.com/2022/10/3-open-child-window.gif)

**èŠå¤©çª—å£**

![èŠå¤©çª—å£](https://img1.dotnet9.com/2022/10/2-chat-window.gif)

**æ¼”ç¤ºå‘é€æ¶ˆæ¯**

7\. Click Onceå‘å¸ƒå°è¯•
------------------

ä¸Šä¸€ç¯‡æ–‡ç« é“¾æ¥ï¼š[å¿«é€Ÿåˆ›å»ºè½¯ä»¶å®‰è£…åŒ…-ClickOnce](https://mp.weixin.qq.com/s/zcO1J-AqiK7LkU52MRwmqw)ï¼Œæœ¬æ–‡ç¤ºä¾‹Click Onceå®‰è£…é¡µé¢ï¼š[https://dotnet9.com/WPFBlazorChat](https://dotnet9.com/WPFBlazorChat)

8\. Q&A
-------

### 8.1 ä¸ºå•¥è¦åœ¨WPFé‡Œä½¿ç”¨Blazorï¼Ÿåƒé¥±äº†æ’‘çš„ï¼Ÿ

`WPF`è™½ç„¶ç›¸è¾ƒ`Winform`åšå‡ºæ¯”è¾ƒå¥½çœ‹çš„UIç›¸å¯¹å®¹æ˜“ä¸€äº›ï¼Œä½†æ¯”èµ·`Blazor`ï¼Œæˆ–è€…ç›´æ¥è¯´`html`å¼€å‘ç•Œé¢ï¼Œè¿˜æ˜¯å·®äº†ä¸€ç‚¹ç‚¹ï¼Œæ›´ä½•å†µ`html`çš„èµ„æºæ›´å¤šä¸€ç‚¹ï¼Œå°è¯•ä¸€ä¸‹ä¸ºä½•ä¸å¯ï¼Ÿ

### 8.2 WPF + Blazoræ”¯æŒå“ªäº›æ“ä½œç³»ç»Ÿ

æœ€ä½æ”¯æŒ`Windows 7 SP1`å§ï¼Œæœ‰ç¾¤å‹å·²ç»å°è¯•åœ¨`Windows 7`æ­£å¸¸è¿è¡ŒæˆåŠŸï¼Œè¿™æ˜¯æœ¬æ–‡ç¤ºä¾‹Click Onceå®‰è£…é¡µé¢ï¼š[https://dotnet9.com/WPFBlazorChat](https://dotnet9.com/WPFBlazorChat)

### 8.3 Blazor æ··åˆå¼€å‘è¿˜æ”¯æŒå“ªäº›å·²æœ‰æ¡†æ¶ï¼Ÿ

`Blazoræ··åˆå¼€å‘`çš„è¯ï¼Œé™¤äº†WPFï¼Œè¿˜æœ‰MAUIï¼ˆè·¨å¹³å°æ¡†æ¶ï¼Œæ”¯æŒå¹³å°åŒ…æ‹¬`Windows\Mac\Linux\Android\iOS`ç­‰ï¼‰ã€`Winform`ï¼ˆåŒ`WPF`ï¼Œåªèƒ½åœ¨`Windowså¹³å°`è¿è¡Œï¼‰ç­‰ï¼Œå»ºè®®é˜…è¯»[å¾®è½¯æ–‡æ¡£](https://learn.microsoft.com/zh-cn/aspnet/core/blazor/hybrid/?view=aspnetcore-7.0)ç»§ç»­å­¦ä¹ ï¼Œæœ¬æ–‡åªæ˜¯ä¸ªå¼•å­ï¼š

![å¾®è½¯æ–‡æ¡£å­¦ä¹ Blazor](https://img1.dotnet9.com/2022/10/1031.png)

### 8.4 Blazorç»„ä»¶åº“é™¤äº†Masa.Blazorè¿˜æœ‰å“ªäº›ï¼Ÿ

*   å¼€æºçš„`Blazor`ç»„ä»¶æœ‰ï¼š[Ant Design Blazor](https://antblazor.com/zh-CN/)ã€[Bootstrap Blazor](https://www.blazor.zone/)ã€[MudBlazor](https://mudblazor.com/)ã€[Blazorise](https://blazorise.com/)ï¼Œä»¥åŠå¾®è½¯è‡ªå®¶çš„[FAST Blazor](https://www.fast.design/)ç­‰ï¼Œå½“ç„¶è¿˜æœ‰ä¸å°‘å¼€æºçš„`Blazor`ç»„ä»¶ã€‚
    
*   æ”¶è´¹çš„`Blazor`ç»„ä»¶ï¼š[DevExpress](https://www.devexpress.com/blazor/)ã€[Telerik](https://www.telerik.com/support/blazor-ui)ã€[Syncfusion](https://www.syncfusion.com/blazor-components)ç­‰
    

### 8.5 æœ¬æ–‡ç¤ºä¾‹ä»£ç ï¼Ÿ

æ–‡ä¸­å„å°èŠ‚ä»£ç ã€æœ€åçš„ç¤ºä¾‹ä»£ç éƒ½ç»™å‡ºäº†ç›¸åº”é“¾æ¥ï¼Œæ‚¨å¯è¿”å›æŸ¥çœ‹ã€‚

æ—¶é—´å¦‚æµæ°´ï¼Œåªèƒ½æµå»ä¸æµå›ã€‚