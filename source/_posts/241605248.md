---
layout: post
title: "Pythonå…¨æ ˆå·¥ç¨‹å¸ˆä¹‹ä»ç½‘é¡µæ­å»ºå…¥é—¨åˆ°Flaskå…¨æ ˆé¡¹ç›®å®æˆ˜(6) - Flaskè¡¨å•çš„å®ç°"
date: "2022-12-15T14:15:31.693Z"
---
Pythonå…¨æ ˆå·¥ç¨‹å¸ˆä¹‹ä»ç½‘é¡µæ­å»ºå…¥é—¨åˆ°Flaskå…¨æ ˆé¡¹ç›®å®æˆ˜(6) - Flaskè¡¨å•çš„å®ç°
===============================================

1.è¡¨å•ä»‹ç»
------

### 1.1.è¡¨å•çŸ¥è¯†å›é¡¾

**å¸¸è§çš„è¡¨å•å…ƒç´ ï¼š**

*   è¡¨å•æ ‡ç­¾<form>
    *   actionï¼šè¡¨å•æäº¤çš„URLåœ°å€
    *   methodï¼šè¡¨å•è¯·æ±‚çš„æ–¹å¼ï¼ˆGET/POStï¼‰
    *   enctypeï¼šè¯·æ±‚å†…å®¹çš„å½¢å¼ï¼Œå¦‚ï¼šapplication/x-www-form-urlencodedã€multipart/form-data
*   å•è¡Œæ–‡æœ¬æ¡†/å¤šè¡Œæ–‡æœ¬æ¡†
    *   textareaï¼šå¤šè¡Œæ–‡æœ¬
    *   å•è¡Œæ–‡æœ¬(typeçš„ä¸åŒå€¼)ï¼Œå¸¸è§çš„æœ‰ï¼štext(å•è¡Œæ–‡æœ¬)ã€password(å¯†ç )ã€email(é‚®ç®±)ã€url(URL)ã€number(æ•°å­—)ã€color(é¢œè‰²)ã€æ—¥æœŸæ—¶é—´ç­‰(dateã€monthã€weekç­‰ç­‰)
*   é€‰æ‹©ï¼ˆå•é€‰ã€å¤šé€‰ã€ä¸‹æ‹‰é€‰æ‹©ï¼‰
    *   å•é€‰ï¼šÂ <input type\="radio"\>Â 
    *   å¤šé€‰ï¼šÂ <input type\="checkbox"\>Â 
    *   ä¸‹æ‹‰æ¡†é€‰æ‹©ï¼šÂ <select\><option\></option\></select\>Â 
*   éšè—è¡¨å•åŸŸï¼šÂ <input type\="hidden"\>Â 
*   è¡¨å•æŒ‰é’®ï¼šÂ <input type\="button"\>Â Â <button\></button\>Â 
*   æ–‡ä»¶ä¸Šä¼ æ¡†ï¼šÂ <input type\="file"\>Â 

 1 <!DOCTYPE html\>
 2 <html lang\="en"\>
 3 <head\>
 4     <meta charset\="UTF-8"\>
 5     <title\>è¡¨å•çŸ¥è¯†ç‚¹å›é¡¾</title\>
 6 </head\>
 7 <body\>
 8 <form action\="/index" method\="post" enctype\="multipart/form-data"\>
 9     <ul\>
10         <li\>
11 ç”¨æˆ·åœ°å€ï¼š
12             <textarea name\="" id\="" cols\="30" rows\="10" placeholder\="è¯·è¾“å…¥åœ°å€"\></textarea\>
13         </li\>
14         <li\>
15 ç”¨æˆ·åï¼š
16             <input type\="text" placeholder\="è¯·è¾“å…¥ç”¨æˆ·å"\>
17         </li\>
18         <li\>
19 å¯†ç ï¼š
20             <input type\="password" placeholder\="è¯·è¾“å…¥å¯†ç "\>
21         </li\>
22         <li\>
23 ç”¨æˆ·çš„å¹´é¾„ï¼š
24             <input type\="number"\>
25         </li\>
26         <li\>
27 æ€§åˆ«ï¼š
28             <label\><input type\="radio" value\="ç”·" name\="sex"\>ç”·</label\>
29             <label\><input type\="radio" value\="å¥³" name\="sex"\>å¥³</label\>
30         </li\>
31         <li\>
32 çˆ±å¥½
33             <input id\="id-paly-ball" type\="checkbox" value\="æ‰“çƒ"\>
34             <label for\="id-paly-ball"\>æ‰“çƒ</label\>
35             <input id\="id-paly" type\="checkbox" value\="ç©è€"\>
36             <label for\="id-paly"\>ç©è€</label\>
37         </li\>
38     </ul\>
39 </form\>
40 </body\>
41 </html\>

**åœ¨è§†å›¾ä¸­è·å–è¡¨å•å€¼ï¼š**

*   getè¯·æ±‚ï¼šÂ request.args.get('name',None)Â 
*   postè¯·æ±‚ï¼šÂ request.form.get('name',None)Â 

**æ€è€ƒï¼šHTMLè¡¨å•åœ¨Flaskä¸­å¦‚ä½•å¿«é€Ÿä½¿ç”¨ï¼Ÿ**

### 1.2.wtfè¡¨å•ä»‹ç»

é€šè¿‡åœ¨Flaskä¸­å†™pythonä»£ç ï¼Œå¯ä»¥ç›´æ¥ç”ŸæˆHTMLè¡¨å•ï¼Œé€šè¿‡wtfå®ç°ã€‚

**flask-wtfæä¾›çš„3ä¸ªç»„è¦åŠŸèƒ½ï¼š**

*   é›†æˆwtforms
*   CSRFä¿æŠ¤ï¼Œflask-wtfèƒ½ä¿æŠ¤æ‰€æœ‰è¡¨å•å…å—è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰çš„æ”»å‡»
*   ä¸Flask-Uploadsä¸€èµ·æ”¯æŒæ–‡ä»¶ä¸Šä¼ 

**å®‰è£…**

*   pipå®‰è£…ï¼šÂ pip install Flask-WTFÂ 
*   æºç å®‰è£…ï¼šÂ python setup.py installÂ 

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221208204308874-1280691698.png)

ä¸‹è½½å¥½ä¹‹åå¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿéœ€ä¸éœ€è¦ä¸€äº›é…ç½®å‘¢ï¼Ÿå®ƒçš„é…ç½®å¾ˆç®€å•ï¼Œå®ƒé…ç½®çš„ç›®çš„å°±æ˜¯ç”¨æ¥åšCSRFä¿æŠ¤ã€‚åªéœ€è¦åœ¨Flask appä¸ŠåŠ ä¸ŠÂ WTF\_CSRF\_SECRET\_KEY = 'a random string'Â å°±è¡Œäº†ï¼Œè¿™ä¸ªkeyå¯ä»¥éšä¾¿ç»™ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ²¡æœ‰è¦æ±‚ï¼Œåªæ˜¯ä¸€ä¸ªéšæœºçš„ä¸²å°±è¡Œäº†ã€‚

1 from flask import Flask, render\_template,flash
2 from flask\_sqlalchemy import SQLAlchemy
3 
4 app = Flask(\_\_name\_\_)
5 # é…ç½®æ•°æ®åº“çš„è¿æ¥å‚æ•°
6 app.config\['SQLALCHEMY\_DATABASE\_URI'\] = 'mysql://root:@127.0.0.1/test\_flask'
7 app.config\['SECRET\_KEY'\] = 'abc'    #æ¶ˆæ¯é—ªç°ä¿æŠ¤çš„keyï¼Œæ³¨æ„å½“æ¶ˆæ¯é—ªç°çš„SECRET\_KEYé…ç½®äº†ï¼ŒWTF\_CSRF\_SECRET\_KEYä¹Ÿå¯ä»¥ä¸ç”¨é…ç½®ï¼Œä½†æ˜¯ä½ é…ç½®äº†ä¹Ÿæ²¡æœ‰å½±å“ï¼Œè¿™ä¸ªçŸ¥è¯†ç‚¹äº†è§£ä¸€ä¸‹
8 app.config\['WTF\_CSRF\_SECRET\_KEY'\] = 'abc1234abc'    #WTF\_CSRF\_SECRET\_KEYé…ç½®

**ç¬¬ä¸€ä¸ªè¡¨å•æ¨¡å‹**

1 from flask\_wtf import FlaskForm     #å¯¼å…¥flask\_wtfçš„FlaskFormç±»
2 from wtforms import StringField     #StringFieldè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ–‡æœ¬çš„è¾“å…¥æ¡†
3 
4 
5 class LoginForm(FlaskForm):     #ç»§æ‰¿FlaskFormç±»
6     """ ç™»å½•è¡¨å•çš„å®ç° """
7     username = StringField(label='ç”¨æˆ·å')

### 1.3.è¡¨å•å¸¸ç”¨å­—æ®µç±»å‹åŠæ¸²æŸ“

**è¡¨å•å¸¸ç”¨å­—æ®µç±»å‹**

*   æ–‡æœ¬/å­—ç¬¦ä¸²
    *   Â StringFieldÂ ï¼šå­—ç¬¦ä¸²è¾“å…¥
    *   Â PasswordFieldÂ ï¼šå¯†ç è¾“å…¥
    *   Â TextAreaFieldÂ ï¼šé•¿æ–‡æœ¬è¾“å…¥
    *   Â HiddenFieldÂ ï¼šéšè—è¡¨å•åŸŸ
*   æ•°å€¼ï¼ˆæ•´æ•°ï¼Œå°æ•°ï¼‰
    *   Â FloatFieldÂ ï¼šæµ®ç‚¹æ•°è¾“å…¥
    *   Â IntegerFieldÂ ï¼šæ•´æ•°è¾“å…¥
    *   Â DecimalFieldÂ ï¼šå°æ•°è¾“å…¥ï¼ˆæ›´å‡†ç¡®ï¼‰
*   é€‰æ‹©
    *   Â RadioFiedÂ ï¼šradioå•é€‰
    *   Â SelectFieldÂ ï¼šä¸‹æ‹‰å•é€‰
    *   Â SelectMultipleFieldÂ ï¼šä¸‹æ‹‰å¤šé€‰
    *   Â BooleanFieldÂ ï¼šå‹¾é€‰ï¼ˆå¤é€‰æ¡†ï¼‰
*   æ—¥æœŸ/æ—¶é—´
    *   Â DateFieldÂ ï¼šæ—¥æœŸé€‰æ‹©
    *   Â DateTimeFieldÂ ï¼šæ—¥æœŸæ—¶é—´é€‰æ‹©
*   æ–‡ä»¶/æ–‡ä»¶ä¸Šä¼ 
    *   Â FileFieldÂ ï¼šæ–‡ä»¶å•é€‰
    *   Â MultipleFileFieldÂ ï¼šæ–‡ä»¶å¤šé€‰
*   å…¶ä»–
    *   Â SubmitFieldÂ ï¼šæäº¤æŒ‰é’®
    *   Â FieldListÂ ï¼šè‡ªå®šä¹‰çš„è¡¨å•é€‰æ‹©åˆ—è¡¨ï¼ˆå¦‚ï¼šé€‰æ‹©ç”¨æˆ·å¯¹è±¡ï¼‰
    *   Â FormFieldÂ ï¼šè‡ªå®šä¹‰å¤šä¸ªå­—æ®µæ„æˆçš„é€‰é¡¹

**è¡¨å•å­—æ®µçš„å¸¸ç”¨æ ¸å¿ƒå‚æ•°**

*   Â lableÂ ï¼šlableæ ‡ç­¾ï¼ˆå¦‚ï¼šè¾“å…¥æ¡†é’±çš„æ–‡å­—æè¿°ï¼‰
*   Â defaultÂ ï¼šè¡¨å•çš„é»˜è®¤å€¼
*   Â validatorsÂ ï¼šè¡¨å•éªŒè¯è§„åˆ™
*   Â widgetÂ ï¼šå®šåˆ¶ç•Œé¢æ˜¾ç¤ºæ–¹å¼ï¼ˆå¦‚ï¼šæ–‡æœ¬æ¡†ã€é€‰æ‹©æ¡†ï¼‰
*   Â descriptionÂ ï¼šå¸®åŠ©æ–‡å­—

**è¡¨å•æ¸²æŸ“**

ä½¿ç”¨æ¨¡æ¿è¯­æ³•æ¸²æŸ“è¡¨å•å†…å®¹ï¼š

*   è¡¨å•è¾“å…¥åŒºåŸŸï¼šÂ {{form.username}}Â 
*   è¡¨å•labelï¼šÂ {{form.username.label}}Â 

**å®ä¾‹ä»£ç ï¼š**

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221209163016994-600357531.png)

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221209163111917-1334948871.png)![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221209163940926-1262522704.png)

forms.pyï¼špythonç¼–å†™ç™»å½•è¡¨å•é¡µé¢å¯¼å…¥FlaskFormï¼Œwtfformså®ç°

1 from flask\_wtf import FlaskForm
2 from wtforms import StringField, PasswordField, SubmitField
3 
4 
5 class LoginForm(FlaskForm):
6     """ ç™»å½•è¡¨å•çš„å®ç° """
7     username = StringField(label='ç”¨æˆ·å', default='admin')
8     password = PasswordField(label='å¯†ç ')
9     submit = SubmitField('ç™»å½•')

app.pyï¼šå¯¼å…¥formsæ–‡ä»¶ï¼Œå°†pythonç¼–å†™å¥½çš„HTMLé¡µé¢å±•ç¤ºç±»ä¼ é€’ç»™htmlæ–‡ä»¶

 1 from flask import Flask, render\_template 2 
 3 from forms import LoginForm 4 
 5 app = Flask(\_\_name\_\_)
 6 app.config\['WTF\_CSRF\_SECRET\_KEY'\] = 'abc1234abc'
 7 app.config\['SECRET\_KEY'\] = 'abc'
 8 
 9 
10 @app.route('/form', methods=\['GET', 'POST'\])
11 def page\_form():
12     """ form è¡¨å•ç»ƒä¹  """
13     form = LoginForm()
14     return render\_template('page\_form.html', form=form)

page\_form.html

 1 <!DOCTYPE html\>
 2 <html lang\="en"\>
 3 <head\>
 4     <meta charset\="UTF-8"\>
 5     <title\>Flask Formè¡¨å•ç»ƒä¹ </title\>
 6 </head\>
 7 <body\>
 8     <h3\>æ¬¢è¿ç™»å½•</h3\>
 9     <form action\="" method\="post"\>
10         <p\>
11 {{ form.username.label }}
12 {{ form.username }}
13         </p\>
14         <p\>
15 {{ form.password.label }}
16 {{ form.password }}
17         </p\>
18         <p\>
19 {{ form.submit }}
20         </p\>
21 
22     </form\>
23 </body\>
24 </html\>

### 1.4.é€šè¿‡è¡¨å•ä¿å­˜æ•°æ®

**ä¿å•ä¿å­˜æ•°æ®æ­¥éª¤ï¼š**

*   ç¬¬ä¸€æ­¥ï¼šæ£€æµ‹è¡¨å•æ˜¯å¦å·²ç»é€šè¿‡éªŒè¯
    *   form.validate\_on\_submit()
*   ç¬¬äºŒæ­¥ï¼šè·å–è¡¨å•ä¸­ä¼ é€’è¿‡æ¥çš„å€¼
    *   Â form.field\_name.dataÂ 
*   ç¬¬ä¸‰æ­¥ï¼šä¸šåŠ¡é€»è¾‘ä»£ç ç¼–å†™ï¼ˆç»“åˆORMï¼‰

**è¡¨å•ä¿å­˜æ•°æ®çš„æ—¶å€™ä¼šè§¦å‘CSRFè¡¨å•ä¿æŠ¤ï¼š**

*   é»˜è®¤æ¨¡æ¿æ˜¯å¼€å¯CSRFä¿æŠ¤
*   å…³é—­å•ä¸ªè¡¨å•CSRFä¿æŠ¤
    *   Â form = LoginForm(csrf\_enabled=False)Â 
*   å…¨å±€å…³é—­ï¼ˆä¸æ¨èï¼‰
    *   Â åœ¨ç±»ä¸Šé¢åŠ ä¸Š:WTF\_CSRF\_ENABLED=FalseÂ 

**å¦‚æœä¸å…³é—­CSRFä¿æŠ¤ï¼Œå¦‚ä½•å¤„ç†ï¼š**

åŒæ­¥è¯·æ±‚CSRFä¿æŠ¤ï¼Œåœ¨æ¨¡æ¿ä¸­æ·»åŠ csrf\_token,é€šè¿‡CSRFæœºåˆ¶çš„éªŒè¯ï¼š

*   æ–¹å¼ä¸€ï¼š{{ form.csrf\_token }}
*   æ–¹å¼äºŒï¼š<input type\="hidden" name\="csrf\_token" value\="{{ csrf\_token() }}"\>

**å®ä¾‹ä»£ç ï¼š**

æ–°å¢ç”¨æˆ·æ³¨å†Œè¡¨å•ï¼Œå¯¹æ³¨å†Œçš„å†…å®¹è¿›è¡Œå…¥åº“ï¼Œæ³¨å†ŒæˆåŠŸåè¿”å›indexä¸»é¡µé¢ã€‚

app.py

 1 from flask import Flask, render\_template, flash, redirect, url\_for 2 from flask\_sqlalchemy import SQLAlchemy 3 
 4 from forms import RegisterForm 5 
 6 app = Flask(\_\_name\_\_)
 7 # é…ç½®æ•°æ®åº“çš„è¿æ¥å‚æ•°
 8 app.config\['SQLALCHEMY\_DATABASE\_URI'\] = 'mysql://root:@\*\*\*\*\*\*\*\*/test\_flask'
 9 app.config\['WTF\_CSRF\_SECRET\_KEY'\] = 'abc1234abc'
10 app.config\['SECRET\_KEY'\] = 'abc'
11 db = SQLAlchemy(app)
12 
13 
14 class User(db.Model):
15     \_\_tablename\_\_ = 'weibo\_user'
16     id = db.Column(db.Integer, primary\_key=True)
17     username = db.Column(db.String(64), nullable=False)
18     password = db.Column(db.String(256), nullable=False)
19     birth\_date = db.Column(db.Date, nullable=True)
20     age = db.Column(db.Integer, default=0)
21 
22 @app.route('/')
23 def index():
24     """  é¦–é¡µ """
25     return render\_template('index.html')
26 
27 @app.route('/user/register', methods=\['GET', 'POST'\])
28 def page\_register():
29     """ æ–°ç”¨æˆ·æ³¨å†Œ """
30     # csrf\_enabledä¸ºFalseè¡¨ç¤ºä¸åšcsrfæ ¡éªŒ
31     # form = RegisterForm(csrf\_enabled=False)
32     form = RegisterForm()
33     # ç”¨æˆ·åœ¨æäº¤è¡¨å•çš„æ—¶å€™ï¼Œä¼šè§¦å‘validate\_on\_submit
34     if form.validate\_on\_submit():
35         # è¡¨å•éªŒè¯é€šè¿‡ï¼Œæ¥ä¸‹æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘
36         # 1. è·å–è¡¨å•æ•°æ®
37         username = form.username.data
38         password = form.password.data
39         birth\_date = form.birth\_date.data
40         age = form.age.data
41         # 2. æ„å»ºç”¨æˆ·å¯¹è±¡
42         user = User(
43             username=username,
44             password=password,
45             birth\_date=birth\_date,
46             age=age
47 )
48         # 3. æäº¤åˆ°æ•°æ®åº“
49 db.session.add(user)
50 db.session.commit()
51         print('æ·»åŠ æˆåŠŸ')
52         # 4. è·³è½¬åˆ°ç™»å½•é¡µé¢
53         return redirect(url\_for('index'))
54     else:
55         # æ‰“å°é”™è¯¯ä¿¡æ¯
56         print(form.errors)
57     return render\_template('page\_register.html', form=form)

forms.py

 1 from flask\_wtf import FlaskForm 2 from wtforms import StringField, PasswordField, SubmitField, DateField, IntegerField 3 
 4 
 5 class RegisterForm(FlaskForm): 6     """ ç”¨æˆ·æ³¨å†Œè¡¨å• """
 7 
 8     # def \_\_init\_\_(self, csrf\_enabled, \*args, \*\*kwargs):
 9     #     super().\_\_init\_\_(csrf\_enabled=csrf\_enabled, \*args, \*\*kwargs)
10 
11     username = StringField(label='ç”¨æˆ·å', default='')
12     password = PasswordField(label='å¯†ç ')
13     birth\_date = DateField(label='ç”Ÿæ—¥')
14     age = IntegerField(label='å¹´é¾„')
15     submit = SubmitField('æ³¨å†Œ')

page\_register.html

 1 <!DOCTYPE html\>
 2 <html lang\="en"\>
 3 <head\>
 4     <meta charset\="UTF-8"\>
 5     <title\>ç”¨æˆ·æ³¨å†Œ</title\>
 6 </head\>
 7 <body\>
 8     <h3\>ç”¨æˆ·æ³¨å†Œ</h3\>
 9 {#  todo æ³¨é‡Šå†…å®¹ï¼šä½¿ç”¨å®æ¥æŠŠè¡¨å•è¿›ä¸€æ­¥å®Œå–„ #}
10     <form action\="{{ url\_for('page\_register') }}" method\="post"\>
11 {{ form.csrf\_token }}
12         <p\>
13 {{ form.username.label }}
14 {{ form.username }}
15         </p\>
16         <p\>
17 {{ form.password.label }}
18 {{ form.password }}
19         </p\>
20         <p\>
21 {{ form.birth\_date.label }}
22 {{ form.birth\_date }}
23         </p\>
24         <p\>
25 {{ form.age.label }}
26 {{ form.age }}
27         </p\>
28         <p\>
29 {{ form.submit }}
30         </p\>
31 
32     </form\>
33 </body\>
34 </html\>

index.html

 1 <!DOCTYPE html\>
 2 <html lang\="en"\>
 3 <head\>
 4     <meta charset\="UTF-8"\>
 5     <title\>ç”¨æˆ·é¦–é¡µ</title\>
 6 </head\>
 7 <body\>
 8 æ³¨å†ŒæˆåŠŸ
 9 </body\>
10 </html\>

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214170741354-341518725.png)![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214170756269-696047177.png)

Â ![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214170830825-428924041.png)

2.è¡¨å•éªŒè¯ä¸å›¾ç‰‡ä¸Šä¼ 
-----------

### 2.1.è¡¨å•éªŒè¯

æ€è€ƒï¼šä»¥æ‰‹æœºæ³¨å†Œä¸ºä¾‹ï¼Œä¸éªŒè¯è¡¨å•ä¼šæ€ä¹ˆæ ·ï¼Ÿ

*   ç”¨æˆ·è¾“å…¥çš„å¯èƒ½ä¸æ˜¯æ‰‹æœºå·
*   ç”¨æˆ·è¾“å…¥çš„å¯èƒ½ä¸æ˜¯ä»–çš„æ‰‹æœºå·
*   ä¸æ–­çš„æäº¤è¡¨å•

æ€è€ƒï¼šè¡¨å•éªŒè¯ä¸ºäº†ä»€ä¹ˆï¼Ÿ

*   æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
*   æ›´å°‘çš„å®‰å…¨éšæ‚£
*   æ°¸è¿œä¸è¦ç›¸ä¿¡ç”¨æˆ·çš„è¾“å…¥

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214171946256-687348334.png)

**å†…ç½®çš„è¡¨å•éªŒè¯å™¨**

*   Â DataRequired/InputRequiredÂ ï¼šå¿…å¡«éªŒè¯
*   Â Email/URL/UUIDÂ ï¼šç”µå­é‚®ç®±/URL/UUIDæ ¼å¼éªŒè¯
*   Â Length(min=-1,max=-1,message=None)Â ï¼šé•¿åº¦èŒƒå›´éªŒè¯
*   Â EqualTo(fieldname,message=None)Â ï¼šé‡å¤éªŒè¯ï¼Œç”¨äºå¯†ç çš„äºŒæ¬¡è¾“å…¥éªŒè¯å’Œä¸Šä¸€æ¬¡æ˜¯å¦ä¸€è‡´

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214173252083-970721957.png)![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214173305954-1363918649.png)

**è‡ªå®šä¹‰è¡¨å•éªŒè¯**

*   åœºæ™¯ä¸€ï¼šåªæœ‰æœ¬è¡¨å•ä½¿ç”¨ï¼Œåœ¨è¡¨å•ç±»é‡Œé¢åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•åä¸ºï¼švalidatge\_éœ€è¦éªŒè¯çš„å˜é‡ï¼Œåœ¨æ–¹æ³•ä¸­ç¼–å†™éªŒè¯é€»è¾‘

*   åœºæ™¯äºŒï¼šå¤šä¸ªè¡¨å•ä¸­ä½¿ç”¨ï¼Œå¦‚ï¼šéªŒè¯æ‰‹æœºå·ç ï¼Œç™»å½•/æ³¨å†Œ/ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯é¡µé¢å‡ä¼šç”¨åˆ°ã€‚åœ¨è¡¨å•ç±»å¤–é¢å£°æ˜ä¸€ä¸ªéªŒè¯æ–¹æ³•ï¼Œä¼ å…¥formå¯¹è±¡ã€‚è¿™ä¸ªæ–¹æ³•å‘½åå°±æ²¡æœ‰è¦æ±‚ï¼Œè¿™ä¸ªè§ç¤ºä¾‹ä»£ç ã€‚

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214173221625-1046771623.png)

ğŸ‘†å›¾ä¸ºåœºæ™¯ä¸€çš„ç¤ºä¾‹ï¼Œåœºæ™¯äºŒè·Ÿè¿™ä¸ªå·®ä¸å¤šï¼›ä¸¤è€…çš„åŒºåˆ«ä¸»è¦åœ¨äºä¸€ä¸ªæ”¾åˆ°ç±»é‡Œé¢ï¼Œä¸€ä¸ªæ”¾åˆ°ç±»å¤–é¢ï¼›å¤‡æ³¨ï¼šæ–¹æ³•å‘½åçš„è§„åˆ™æš‚æ—¶è¿™ä¹ˆç†è§£ï¼Œæˆ‘å­¦çš„å¥½åƒæ˜¯è¿™æ ·çš„ï¼Œæˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„ï¼Œæœ‰çŸ¥é“æ‰€ä»¥ç„¶çš„å¯ä»¥æ•™ä¸‹æˆ‘ï¼Œè°¢è°¢ï¼

**å®ä¾‹ï¼š**

åœºæ™¯ä¸€ï¼ˆå½“å‰è¡¨å•ä½¿ç”¨ï¼‰ï¼š

 1 import re 2 
 3 from flask\_wtf import FlaskForm 4 from wtforms import StringField, PasswordField, SubmitField, DateField, IntegerField 5 from wtforms.validators import DataRequired,ValidationError 6 
 7 class RegisterForm(FlaskForm): 8     """ ç”¨æˆ·æ³¨å†Œè¡¨å• """
 9 
10     username = StringField(label='ç”¨æˆ·å', default='')
11     password = PasswordField(label='å¯†ç ',validators=\[DataRequired("è¯·è¾“å…¥å¯†ç ")\])  #å¢åŠ å¿…å¡«éªŒè¯
12     birth\_date = DateField(label='ç”Ÿæ—¥')
13     age = IntegerField(label='å¹´é¾„')
14     submit = SubmitField('æ³¨å†Œ')
15 
16     def validate\_username(self,field):  #æ³¨æ„è¿™ä¸ªæ–¹æ³•å¿…é¡»æ˜¯validate\_\*\*\*\*\*
17         """ éªŒè¯ç”¨æˆ·å """
18         # è‡ªå®šä¹‰ï¼šå¼ºåˆ¶éªŒè¯ç”¨æˆ·åä¸ºæ‰‹æœºå·
19         username = field.data
20         pattern = r'^1\[0-9\]{10}$'   #è‡ªå®šä¹‰æ­£åˆ™åŒ¹é…è§„åˆ™
21         if not re.search(pattern,username):
22             raise ValidationError('è¯·è¾“å…¥æ‰‹æœºå·ç ')
23         return field

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214174132627-1845664000.png)

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214174200183-885278225.png)![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214174206938-1172323217.png)

æˆ‘ä»¬çœ‹åˆ°æŠ¥é”™æç¤ºä¿¡æ¯æ˜¯åœ¨æ§åˆ¶å°å±•ç¤ºçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆè®©æç¤ºä¿¡æ¯å±•ç¤ºç»™ç”¨æˆ·ï¼Ÿ

forms.pyæ–‡ä»¶é‡Œé¢è‡ªå®šä¹‰äº†è¡¨å•éªŒè¯è§„åˆ™ï¼ŒéªŒè¯å¤±è´¥æŠ›å‡ºformçš„é”™è¯¯

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214175235209-1919232116.png)

app.pyæ–‡ä»¶æ— æ³•æäº¤æ—¶ï¼Œå°†æ‰“å°formæ–‡ä»¶æŠ›å‡ºçš„å¼‚å¸¸.ã€‚å¼‚å¸¸å†…å®¹ä¸ºÂ {'username': \['è¯·è¾“å…¥æ‰‹æœºå·ç '\]}Â æ˜¯ä¸ªitemsç»“æ„ã€‚

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214175257361-961665408.png)

å‰ç«¯é¡µé¢ï¼Œè·å–formsçš„usernameçš„æŠ¥é”™ä¿¡æ¯ï¼Œè¿›è¡Œå±•ç¤º

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214181220776-576902664.png)

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214181244421-819981455.png)![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221214181255138-1456168666.png)

åœºæ™¯äºŒï¼ˆå¤šä¸ªè¡¨å•ä½¿ç”¨ï¼‰ï¼š

ğŸ‘‡å›¾froms.pyï¼šç”¨pythonç¼–å†™ç™»å½•çš„å‰ç«¯é¡µé¢ã€è¡¨å•è‡ªå®šä¹‰çš„éªŒè¯ã€è¡¨å•å­—æ®µä½¿ç”¨è‡ªå®šä¹‰çš„éªŒè¯

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221215145854528-1704150696.png)

ç–‘é—®ï¼šåœ¨ç±»å¤–é¢è‡ªå®šä¹‰çš„éªŒè¯æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆè¦ä¼ formï¼Œä¸ä¼ è¡Œä¸è¡Œï¼›ä¸ç©¿formå°±ä¼šæŠ¥é”™ï¼Œè¯´åº”è¯¥ä¼ ä¸¤ä¸ªå‚æ•°ï¼Œåªä¼ äº†ä¸€ä¸ªï¼Œé‚£è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221215151703823-370698394.png)

çœ‹äº†ç³»ç»Ÿè‡ªå¸¦éªŒè¯è§„åˆ™çš„æºç ï¼Œå‘ç°éƒ½æ˜¯ä¸¤ä¸ªå½¢å‚formå’Œfieldï¼Œå°±æš‚æ—¶è¿™ä¹ˆç†è§£å§ï¼šå› ä¸ºæºç æœ‰ï¼Œè·Ÿä»–ä¿æŒä¸€è‡´ï¼Œformå…·ä½“å¹²ä»€ä¹ˆä½¿çš„åé¢ç ”ç©¶äº†å†è¯´å§ï¼  

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221215151920059-1410629700.png)

ğŸ‘‡å›¾app.pyå¯åŠ¨æ–‡ä»¶ï¼šå°†ç™»å½•é¡µé¢forms.pyäº¤ç»™htmlæ–‡ä»¶page\_formè¿›è¡Œæ¸²æŸ“å±•ç¤ºï¼ŒåŒæ—¶è¿›è¡Œformè¡¨å•çš„éªŒè¯![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221215150301129-656835802.png)

ğŸ‘‡å›¾ï¼špage\_form.html+å±•å®æ•ˆæœ

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221215150551482-374339599.png)![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221215154011355-1594590916.png)

### 2.2.å›¾ç‰‡ä¸Šä¼ 

å›¾ç‰‡ä¸Šä¼ ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼å®ç°

*   æ–¹å¼ä¸€ï¼šä¸ä½¿ç”¨wtfå®ç°
*   æ–¹å¼äºŒï¼šä½¿ç”¨wtfçš„FileFieldå¹¶æ·»åŠ ç±»å‹éªŒè¯

**å›¾ç‰‡ä¸Šä¼ ï¼šä¸ä½¿ç”¨wtf**

*   1ï¼‰è®¾ç½®<form>çš„enctypeï¼ŒÂ enctype="multipart/form-data"Â 
*   2ï¼‰åœ¨è§†å›¾å‡½æ•°ä¸­è·å–æ–‡ä»¶å¯¹è±¡Â request.filesÂ 
*   3ï¼‰ä¿å­˜æ–‡ä»¶Â f.save(file\_path)Â 

**æ–‡ä»¶åç§°æ ¼å¼åŒ–ï¼šÂ werkzeug.utils.secure\_filename**Â 

**ç¤ºä¾‹ï¼š**

**![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221215162148250-924845608.png)**

ä¸Šä¼ ä¸è§„åˆ™çš„æ–‡ä»¶åï¼Œsecure\_filenameè¿›è¡Œæ ¼å¼åŒ–

![](https://img2023.cnblogs.com/blog/2281865/202212/2281865-20221215162428846-2132263696.png)

app.py

 1 import os 2 
 3 from flask import Flask, render\_template, redirect, url\_for, request 4 from werkzeug.utils import secure\_filename 5 
 6 from forms import UserAvatarForm 7 
 8 app = Flask(\_\_name\_\_)
 9 app.config\['WTF\_CSRF\_SECRET\_KEY'\] = 'abc1234abc'
10 app.config\['SECRET\_KEY'\] = 'abc'
11 # è‡ªå®šä¹‰çš„é…ç½®æ‰©å±•ï¼Œè¡¨ç¤ºæ–‡ä»¶ä¸Šä¼ çš„è·¯å¾„
12 app.config\['UPLOAD\_PATH'\] = os.path.join(os.path.dirname(\_\_file\_\_), 'medias')
13 
14 @app.route('/img/upload', methods=\['GET', 'POST'\])
15 def img\_upload():
16     """ ä¸ä½¿ç”¨wtfå®ç°çš„æ–‡ä»¶ä¸Šä¼  """
17     if request.method == 'POST':
18         # è·å–æ–‡ä»¶åˆ—è¡¨
19         files = request.files
20         file1 = files.get('file1', None)
21         if file1:
22             # ä¿å­˜æ–‡ä»¶
23             f\_name = secure\_filename(file1.filename)
24             print('filename:', f\_name)
25             file\_name = os.path.join(app.config\['UPLOAD\_PATH'\], f\_name)
26 file1.save(file\_name)
27             print('ä¿å­˜æˆåŠŸ')
28         return redirect(url\_for('img\_upload'))
29     return render\_template('img\_upload.html')

img\_upload.html

 1 <!DOCTYPE html\>
 2 <html lang\="en"\>
 3 <head\>
 4     <meta charset\="UTF-8"\>
 5     <title\>æ–‡ä»¶ä¸Šä¼ </title\>
 6 </head\>
 7 <body\>
 8 <form action\="/img/upload" method\="post" enctype\="multipart/form-data"\>
 9     <p\>
10         <input type\="file" name\="file1"\>
11         <input type\="file" name\="file2"\>
12     </p\>
13     <p\>
14         <input type\="submit" value\="å¼€å§‹ä¸Šä¼ "\>
15     </p\>
16 </form\>
17 </body\>
18 </html\>

**å›¾ç‰‡ä¸Šä¼ ï¼šéªŒè¯**

*   æ–‡ä»¶å¿…é¡»ä¸Šä¼ ï¼šÂ FileRequiredÂ 
*   æ–‡ä»¶ç±»å‹éªŒè¯ï¼šÂ FileAllowedÂ 

app.py

 1 import os 2 
 3 from flask import Flask, render\_template, redirect 4 from werkzeug.utils import secure\_filename 5 
 6 from forms import UserAvatarForm 7 
 8 app = Flask(\_\_name\_\_)
 9 app.config\['WTF\_CSRF\_SECRET\_KEY'\] = 'abc1234abc'
10 app.config\['SECRET\_KEY'\] = 'abc'
11 # è‡ªå®šä¹‰çš„é…ç½®æ‰©å±•ï¼Œè¡¨ç¤ºæ–‡ä»¶ä¸Šä¼ çš„è·¯å¾„
12 app.config\['UPLOAD\_PATH'\] = os.path.join(os.path.dirname(\_\_file\_\_), 'medias')
13 
14 
15 @app.route('/avatar/upload', methods=\['GET', 'POST'\])
16 def avatar\_upload():
17     """ å¤´åƒä¸Šä¼  """
18     form = UserAvatarForm()
19     if form.validate\_on\_submit():
20         # è·å–å›¾ç‰‡å¯¹è±¡
21         img = form.avatar.data
22         f\_name = secure\_filename(img.filename)
23         file\_name = os.path.join(app.config\['UPLOAD\_PATH'\], f\_name)
24 img.save(file\_name)
25         print('ä¿å­˜æˆåŠŸ')
26         return redirect('/')
27     else:
28         print(form.errors)
29     return render\_template('avatar\_upload.html', form=form)

forms.py

 1 from flask\_wtf import FlaskForm 2 from flask\_wtf.file import FileRequired, FileAllowed 3 from wtforms import FileField 4 
 5 
 6 class UserAvatarForm(FlaskForm): 7     """ ç”¨æˆ·å¤´åƒä¸Šä¼  """
 8     avatar = FileField(label='ä¸Šä¼ å¤´åƒ', validators=\[
 9         FileRequired('è¯·é€‰æ‹©å¤´åƒæ–‡ä»¶'),
10         FileAllowed(\['png'\], 'ä»…æ”¯æŒPNGå›¾ç‰‡ä¸Šä¼ ')
11     \])

avatar\_upload.html

 1 <!DOCTYPE html\>
 2 <html lang\="en"\>
 3 <head\>
 4     <meta charset\="UTF-8"\>
 5     <title\>WTF æ–‡ä»¶ä¸Šä¼ </title\>
 6 </head\>
 7 <body\>
 8 <form action\="/avatar/upload" method\="post" enctype\="multipart/form-data"\>
 9 {{ form.csrf\_token }}
10     <p\>
11 {{ form.avatar.label }}
12 {{ form.avatar }}
13     </p\>
14     <p\>
15         <input type\="submit" value\="å¼€å§‹ä¸Šä¼ "\>
16     </p\>
17 </form\>
18 </body\>

**ä½¿ç”¨æ‹“å±•ï¼šFlask-Uploads**

*   å¸¸ç”¨æ–‡ä»¶ç±»å‹éªŒè¯
*   æŒ‡å®šæ–‡ä»¶ä¸Šä¼ çš„ç›®å½•