---
layout: post
title: "func-spring-boot-starter åŒ¿åå‡½æ•°æ‰˜ç®¡"
date: "2022-03-31T10:21:01.367Z"
---
func-spring-boot-starter åŒ¿åå‡½æ•°æ‰˜ç®¡
===============================

func-spring-boot-starter åŒ¿åå‡½æ•°æ‰˜ç®¡
===============================

> GitHubé¡¹ç›®è·¯å¾„:

    https://github.com/yiurhub/func-spring-boot-starter
    

> Giteeé¡¹ç›®è·¯å¾„:

    https://gitee.com/yiur/func-spring-boot-starter
    

ä½¿ç”¨æ³¨æ„äº‹é¡¹
------

> æ¨èç‰ˆæœ¬:

1.  **spring-boot-starter `2.6.x`**

è®¾è®¡åŸç†
----

![](https://img2022.cnblogs.com/blog/2167040/202203/2167040-20220331161606683-891285349.png)

åŒ¿åå‡½æ•°ç‰¹æ€§
------

### åŒ¿åå‡½æ•°é“¾æ¥é…ç½®

### Yaml

    func-link:
        # é»˜è®¤ä»£ç†æ¨¡å¼
        singleton: true
        # é»˜è®¤å¼€å¯lambdaæ¨¡å¼
        lambda: true
        # é»˜è®¤çš„callbackå›è°ƒå‡½æ•°ç±»
        call-back: org.func.spring.boot.component.callback.SimpleFuncCallback
        # logger é…ç½®
        logger:
          # é»˜è®¤false ä¸è¾“å‡ºæ—¥å¿—
          enable-log: false
          # é»˜è®¤è¾“å‡ºæ—¥å¿—ä¿¡æ¯ ${å–å½“å‰åŒ¿åå‡½æ•°çš„å…¬å¼€ä¿¡æ¯}
          message: "call method --> ${methodName}(${parameterSource})"
          # æ—¥å¿—æ‰§è¡Œæ—¥å¿—æ ¼å¼åŒ–
          date-format: "yyyy-MM-dd HH:mm:ss"
          # è¾“å‡ºæ—¥å¿—çš„æ–‡ä»¶å
          file-name: "simple"
    

### JavaConfig

æ·»åŠ ç±»æ³¨è§£`@EnableFuncLambda`

éœ€è¦æ³¨å…¥`FuncLinkFactory`å·¥å‚ç±»ï¼Œç”Ÿäº§é»˜è®¤`FuncLink`é“¾æ¥ç±»

æ·»åŠ é“¾æ¥çš„æ–¹æ³•ä¸º`setObject(key, Object)` **é“¾å¼ç¼–ç¨‹** **æ³›å‹çº¦æŸ** **Lambda**

â€‹ key: {Spring Bean Name}ğŸ˜’{åŠŸèƒ½é“¾æ¥ | æ’ä»¶}

â€‹ object: ${åŠŸèƒ½é“¾æ¥ç±»| æ’ä»¶ç±»}

FuncLinkæ¨èLambdaæ“ä½œ

è¯¦ç»†å†…å®¹è¯·çœ‹é¡¹ç›®:

    https://gitee.com/yiur/func-spring-boot-starter/tree/main/func-web-simple
    

    @Configuration
    @EnableFuncLambda("com.simple.web.lambda")
    public class FuncLinkConfig {
    
        @Autowired
        public FuncLinkFactory funcLinkFactory;
    
        @Bean
        public FuncLink funcLink() {
            return funcLinkFactory.build()
                    .<FuncLogger>setObject("logger:log", (set, log) -> "logger => ${methodName}\r\n");
        }
    
    }
    

### ä¸¥æ ¼ç±»å‹æ‰˜ç®¡

å¼€å‘æ¨è**ä¸¥æ ¼ç±»å‹æ‰˜ç®¡**ï¼Œæœ‰ä»£ç æç¤ºï¼Œå¼€å‘æ•ˆç‡æ›´é«˜ï¼Œåœ¨Webé¡¹ç›®ä¸­ï¼Œå¯ä»¥æ‰˜ç®¡æ•´ä¸ª**Servcie**å±‚

é…åˆMybaitsï¼ŒRedisç­‰æ¡†æ¶ä¸€èµ·ä½¿ç”¨

**1ã€å®šä¹‰æ¥å£**

ç”¨äºSpringBootè‡ªåŠ¨æ³¨å…¥funcLinkä»£ç†çš„HttpLinkç±»

    public interface HttpLink {
    
        Object link();
    
    }
    

**2ã€ä»£ç†ç±»ä»£ç†æ¥å£æ–¹æ³•**

`@FuncBean(link = "funcLink Bean Name")`

æ·»åŠ ç±»æ³¨è§£`@FuncBean`å£°æ˜è¿™æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ä»£ç†ç±»

æ·»åŠ æ–¹æ³•æ³¨è§£`@FuncLambda`å£°æ˜è¿™æ˜¯ä¸€ä¸ªä»£ç†æ–¹æ³•

å¦‚æœæœ‰å‚æ•°è¯·åŠ ä¸Šå‚æ•°æ³¨è§£`@FuncParameter("å‚æ•°å")`

    @Component
    @FuncBean
    public class FuncLinkHosting implements HttpLink {
    
        @Override
        @FuncLambda(classFile = HttpLink.class)
        public Map<String, String> link() {
            Map<String, String> map = new HashMap<>(10);
            map.put("GitHub", "https://github.com/yiurhub");
            map.put("Gitee", "https://gitee.com/yiur");
            map.put("åšå®¢", "https://www.cnblogs.com/yiur-bgy");
            return map;
        }
    
    }
    

### æ¾æ•£ç±»å‹æ‰˜ç®¡

å¼€å‘ä½¿ç”¨**ä¸æ¨è**ï¼Œåç»­2.xä¼°è®¡åºŸç”¨ï¼Œå¯è¯»æ€§ä¸é«˜

**1ã€å®šä¹‰æ¥å£**

æ·»åŠ ç±»æ³¨è§£`@Component`ï¼Œç”¨äºSpringBootè‡ªåŠ¨æ³¨å…¥funcLinkä»£ç†çš„HttpLinkç±»ï¼ŒSpringBootæ’ä»¶æå‡

    @Component
    public interface HttpLink {
    
        Object link();
    
    }
    

**2ã€ä»£ç†ç±»ä»£ç†æ¥å£æ–¹æ³•**

@FuncBean(link = "funcLink Bean Name")

æ¾æ•£ç±»å‹æ‰˜ç®¡éœ€è¦æ³¨æ„çš„äº‹é¡¹:

1.  ä»£ç†æ–¹æ³•è¿”å›å€¼ä¸æ¥å£ä¸ä¸€æ ·ï¼Œæ¥å£è¿”å›å€¼å¿…é¡»å¾—æ˜¯Object

æ·»åŠ ç±»æ³¨è§£`@FuncBean`å£°æ˜è¿™æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ä»£ç†ç±»

æ·»åŠ æ–¹æ³•æ³¨è§£`@FuncLambda`å£°æ˜è¿™æ˜¯ä¸€ä¸ªä»£ç†æ–¹æ³•

å¦‚æœæœ‰å‚æ•°è¯·åŠ ä¸Šå‚æ•°æ³¨è§£`@FuncParameter("å‚æ•°å")`

    @FuncBean
    public class FuncLinkHosting {
    
        @FuncLambda(classFile = HttpLink.class)
        public Map<String, String> link() {
            Map<String, String> map = new HashMap<>(10);
            map.put("GitHub", "https://github.com/yiurhub");
            map.put("Gitee", "https://gitee.com/yiur");
            map.put("åšå®¢", "https://www.cnblogs.com/yiur-bgy");
            return map;
        }
    
    }
    

### @FuncLogger

æ·»åŠ æ–¹æ³•æ³¨è§£`@FuncLogger`å¼€å¯æ–¹æ³•æ‰§è¡Œå®Œåçš„è¾“å‡ºæ—¥å¿—ï¼Œ**ä¼˜å…ˆçº§æ¯”é…ç½®æ–‡ä»¶é«˜**

`@FuncLogger`å‚æ•°  
name: ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶åï¼Œé»˜è®¤ä¸ºfunc-link

â€‹ suffix: ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶åç¼€åï¼Œé»˜è®¤ä¸ºlog

â€‹ path: ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶å­˜æ”¾ç»å¯¹è·¯å¾„è·¯å¾„ï¼Œé»˜è®¤å½“å‰é¡¹ç›®ä¸‹çš„logæ–‡ä»¶å¤¹ä¸‹

    @FuncBean
    public class FuncLinkHosting implements HttpLink {
    
        @Override
        @FuncLogger
        @FuncLambda(classFile = HttpLink.class)
        public Map<String, String> link() {
            Map<String, String> map = new HashMap<>(10);
            map.put("GitHub", "https://github.com/yiurhub");
            map.put("Gitee", "https://gitee.com/yiur");
            map.put("åšå®¢", "https://www.cnblogs.com/yiur-bgy");
            return map;
        }
    
    }
    

#### FuncLink è¿”å›message

#### åº”ç”¨

Logger æ—¥å¿—åŠŸèƒ½é“¾æ¥ï¼Œæ ¹æ®æ‰§è¡Œæ–¹æ³•ç»‘å®šçš„Beanæˆ–è€…refï¼Œæ‰§è¡Œæ­¤åŠŸèƒ½

åœ¨ç»‘å®šçš„æ–¹æ³•ä¸­æ‰§è¡Œå®Œåï¼Œåˆ™ä¼šè¾“å‡ºæ—¥å¿—ï¼Œè·å–æ‰§è¡Œçš„æ–¹æ³•ä¿¡æ¯

#### é“¾æ¥

`FuncLogger`

â€‹ åŠŸèƒ½é“¾æ¥ä¸º: **"${Bean Name}:log"**

#### ä»£ç 

    @Configuration
    @EnableFuncLambda("com.simple.web.lambda")
    public class FuncLinkConfig {
    
        @Autowired
        public FuncLinkFactory funcLinkFactory;
    
        @Bean
        public FuncLink funcLink() {
            return funcLinkFactory.build()
                    .<FuncLogger>setObject("httpLink:log", (set, log) -> "logger => ${methodName}\r\n");
        }
    
    }
    

### @FuncCallback æ³¨è§£å®ç°

æ·»åŠ æ–¹æ³•æ³¨è§£`@FuncCallback`ç»‘å®šæ–¹æ³•æ‰§è¡Œåçš„å›è°ƒå‡½æ•°

æˆåŠŸæ‰§è¡Œå›è°ƒ: `then(T result)`

å¤±è´¥æ‰§è¡Œå›è°ƒ: `error(Throwable e)`

    public class DefaultCallback implements FuncCallback {
    
        @Override
        public Object then(Object data) { return data; }
    
        @Override
        public Object error(Throwable error) {
            return error.getMessage();
        }
    
    }
    

    @FuncBean
    public class FuncLinkHosting implements HttpLink {
    
        @Override
        @FuncCallback(DefaultCallback.class)
        @FuncLambda(classFile = HttpLink.class)
        public Map<String, String> link() {
            Map<String, String> map = new HashMap<>(10);
            map.put("GitHub", "https://github.com/yiurhub");
            map.put("Gitee", "https://gitee.com/yiur");
            map.put("åšå®¢", "https://www.cnblogs.com/yiur-bgy");
            return map;
        }
    
    }
    

### FuncLink Callback å®ç°

#### åº”ç”¨

Callback æ–¹æ³•æ‰§è¡Œå®Œå›è°ƒåŠŸèƒ½é“¾æ¥ï¼Œæ ¹æ®æ‰§è¡Œæ–¹æ³•ç»‘å®šçš„Beanæˆ–è€…refï¼Œæ‰§è¡Œæ­¤åŠŸèƒ½

åœ¨Webé¡¹ç›®Serviceå±‚ä¸­è¿”å›æ–¹æ³•æ‰§è¡Œçš„ç»“æœï¼Œèƒ½åšåˆ°æœåŠ¡ç†”æ–­æ“ä½œ

#### é“¾æ¥

`FuncCallback<T, R>`çº¦æŸå‚æ•°å€¼å’Œè¿”å›å€¼ï¼Œ**æ‰§è¡Œä¼˜å…ˆçº§: 1**

â€‹ åŠŸèƒ½é“¾æ¥ä¸º: **"${Bean Name}:callback"**

`FuncCallbackThen<T, R>`çº¦æŸå‚æ•°å€¼å’Œè¿”å›å€¼ï¼Œ**æ‰§è¡Œä¼˜å…ˆçº§: 2**

â€‹ åŠŸèƒ½é“¾æ¥ä¸º: **"${Bean Name}:callback-then"**

`FuncCallbackError<R>`çº¦æŸè¿”å›å€¼ï¼Œ**æ‰§è¡Œä¼˜å…ˆçº§: 2**

â€‹ åŠŸèƒ½é“¾æ¥ä¸º: **"${Bean Name}:callback-error"**

#### ä»£ç 

    @Configuration
    @EnableFuncLambda("com.simple.web.lambda")
    public class FuncLinkConfig {
    
        @Autowired
        public FuncLinkFactory funcLinkFactory;
    
        @Bean("simple")
        public FuncLink funcLink() {
            return funcLinkFactory.build()
                    // httpLink
                    .<FuncCallback<Map<String, String>, Object>>setObject("httpLink:callback", new FuncCallback<Map<String, String>, Object>() {
                        @Override
                        public Object then(Map<String, String> result) {
                            return result;
                        }
    
                        @Override
                        public Object error(Throwable throwable) {
                            return throwable;
                        }
                    })
                    .<FuncCallbackThen<Map<String, String>, Object>>setObject("httpLink:callback-then", result -> result)
                    .<FuncCallbackError<Object>>setObject("httpLink:callback-error", throwable -> throwable);
        }
    
    }
    

### FuncLink Life å®ç°

#### åº”ç”¨

Life æ–¹æ³•æ‰§è¡Œå‰åå›è°ƒåŠŸèƒ½é“¾æ¥ï¼Œæ ¹æ®æ‰§è¡Œæ–¹æ³•ç»‘å®šçš„Beanæˆ–è€…refï¼Œæ‰§è¡Œæ­¤åŠŸèƒ½

æ–¹æ³•æ‰§è¡Œå‰ä¼šå…ˆæ‰§è¡Œstartæ–¹æ³•ï¼Œç”¨æ¥æ£€æŸ¥å‚æ•°

æ–¹æ³•æ‰§è¡Œåä¼šæ‰§è¡Œendæ–¹æ³•ï¼Œç”¨æ¥æ£€æŸ¥è¿”å›å€¼

#### é“¾æ¥

`FuncLife<T, R>`çº¦æŸå‚æ•°å€¼å’Œè¿”å›å€¼ï¼Œ**æ‰§è¡Œä¼˜å…ˆçº§: 1**

â€‹ åŠŸèƒ½é“¾æ¥ä¸º: **"${Bean Name}:life"**

`FuncLifeStart`çº¦æŸå‚æ•°å€¼å’Œè¿”å›å€¼ï¼Œ**æ‰§è¡Œä¼˜å…ˆçº§: 2**

â€‹ åŠŸèƒ½é“¾æ¥ä¸º: **"${Bean Name}:life-start"**

`FuncLifeEnd<T, R>`çº¦æŸè¿”å›å€¼ï¼Œ**æ‰§è¡Œä¼˜å…ˆçº§: 2**

â€‹ åŠŸèƒ½é“¾æ¥ä¸º: **"${Bean Name}:life-end"**

#### ä»£ç 

    @Configuration
    @EnableFuncLambda("com.simple.web.lambda")
    public class FuncLinkConfig {
    
        @Autowired
        public FuncLinkFactory funcLinkFactory;
    
        @Bean("simple")
        public FuncLink funcLink() {
            return funcLinkFactory.build()
                    // httpLink
                    .<FuncLife<Object, Object>>setObject("httpLink:life", new FuncLife<Object, Object>() {
                        @Override
                        public Map<String, Object> start(Map<String, Object> args) {
                            return args;
                        }
    
                        @Override
                        public Object end(Object result) {
                            return result;
                        }
                    })
                    .<FuncLifeStart>setObject("httpLink:life-start", args -> args)
                    .<FuncLifeEnd<Object, Object>>setObject("httpLink:life-end", result -> result);
        }
    
    }
    

1.1.3.RELEASE æ›´æ–°
----------------

func-spring-boot-starter-1.1.2.RELEASE ä¾èµ–

    <!--func-->
    <dependency>
        <groupId>io.github.yiurhub</groupId>
        <artifactId>func-spring-boot-starter</artifactId>
        <version>1.1.3.RELEASE</version>
    </dependency>
    

### æ·»åŠ åŒ¿åå‡½æ•°é“¾æ¥è‡ªå®šä¹‰å®ç°åŠŸèƒ½

> AbstractFuncLifePlugin

    public class SimpleLifePlugin extends AbstractFuncLifePlugin {
    
        public SimpleLifePlugin() {
        }
    
        public SimpleLifePlugin(String beanName, String[] refs, FuncLink funcLink, FuncCallbackPlugin funcCallbackPlugin) {
            super(beanName, refs, funcLink, funcCallbackPlugin);
        }
        
    }
    

> AbstractFuncCallbackPlugin

    public class SimpleCallbackPlugin extends AbstractFuncCallbackPlugin {
    
        public SimpleCallbackPlugin() {
        }
    
        public SimpleCallbackPlugin(String beanName, String[] refs, FuncLink funcLink, FuncProperties funcProperties, FuncLoggerPlugin funcLoggerPlugin) {
            super(beanName, refs, funcLink, funcProperties, funcLoggerPlugin);
        }
        
    }
    
    

> AbstractFuncLoggerPlugin

    public class SimpleLoggerPlugin extends AbstractFuncLoggerPlugin {
    
        public SimpleLoggerPlugin() {
        }
    
        public SimpleLoggerPlugin(String beanName, String[] refs, FuncLink funcLink, FuncProperties funcProperties) {
            super(beanName, refs, funcLink, funcProperties);
        }
        
    }
    

#### FuncLink ä½¿ç”¨

    @Configuration
    @EnableFuncLambda("com.simple.web.lambda")
    public class FuncLinkConfig {
    
        @Autowired
        public FuncLinkFactory funcLinkFactory;
    
        @Bean("simple")
        public FuncLink funcLink() {
            return funcLinkFactory.build()
                    // httpLink
                    .setObject("httpLink:FuncLifePlugin", SimpleLifePlugin.class)
                    .setObject("httpLink:FuncCallbackPlugin", SimpleCallbackPlugin.class)
                    .setObject("httpLink:FuncLoggerPlugin", SimpleLoggerPlugin.class)
        }
    
    }
    

APIæ›´æ”¹
-----

### æ³¨è§£æ›´æ”¹

`@FuncConfiguration` æ”¹ä¸º `@FuncBean`

`@EnableLog` æ”¹ä¸º `@FuncLogger`

`CallbackClass` æ”¹ä¸º `@FuncCallback`