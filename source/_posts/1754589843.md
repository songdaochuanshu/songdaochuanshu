---
layout: post
title: "opencvå­¦ä¹ ä¹‹åŸºç¡€"
date: "2022-05-11T13:40:01.252Z"
---
opencvå­¦ä¹ ä¹‹åŸºç¡€
===========

å‰æ®µæ—¶é—´ä¸€ç›´åœ¨é’»ç ”æ·±åº¦å­¦ä¹ ä¸­çš„å·ç§¯ç¥ç»ç½‘ç»œï¼Œå…¶ä¸­çš„é¢„å¤„ç†ç¯èŠ‚å¯ä»¥è¯´éå¸¸å…³é”®ï¼Œä¸»è¦å°±æ˜¯å¯¹å›¾ç‰‡å’Œè§†é¢‘è¿›è¡Œå¤„ç†ã€‚è€Œå›¾åƒå¤„ç†å°±æ¶‰åŠåˆ°å›¾å½¢å­¦å’Œåº•å±‚æŠ€æœ¯ç»†èŠ‚ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç²¾æ·±å’Œä¸“ä¸šçš„é¢†åŸŸï¼Œå‡è®¾æˆ‘ä»¬è¦ä»å¤´å¼€å§‹åšèµ·ï¼Œé‚£ç®€ç›´å¤ªéº»çƒ¦å’Œä½æ•ˆäº†ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ**openCV**å°±æ­¤åº”è¿è€Œç”Ÿï¼Œå®ƒå±è”½äº†å¾ˆå¤šåº•å±‚æŠ€æœ¯ç»†èŠ‚ï¼ŒæŠ½è±¡å‡ºæ–¹ä¾¿çš„APIï¼Œè€Œæˆ‘ä»¬åªéœ€è¦çµæ´»ç»„åˆç›¸å…³çš„ api å°±èƒ½å®ç°å¼ºå¤§çš„åŠŸèƒ½ã€‚

å†…å®¹å¤§çº²
----

1.  æ„å»º**openCV.js**
2.  **opencv**åŸºç¡€æ“ä½œ

æ„å»ºopenCV.js
-----------

**openCV**æœ‰å„ç§è¯­è¨€çš„ç‰ˆæœ¬ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯**C++** å’Œ**Python**ï¼Œä¹Ÿæœ‰**JavaScript**ç‰ˆæœ¬ï¼Œå› ä¸ºåŸºäº**js**å¯ä»¥æ›´å¿«çš„éªŒè¯å’ŒæŸ¥çœ‹æ•ˆæœï¼ŒåŒæ—¶ä¹Ÿæ˜¯å› ä¸ºæœ¬äººä¸å¤ªæ“…é•¿**C++**å’Œ**Python**ï¼ŒçœŸçš„æ˜¯æœ‰äº† **js** è¿™æŠŠé”¤å­æŠŠä»€ä¹ˆé—®é¢˜éƒ½çœ‹æˆé’‰å­äº†ğŸ˜„ã€‚å½“ç„¶å‰ææ˜¯å› ä¸ºç›®å‰**V8**å¼•æ“å’Œ**wasm**æ€§èƒ½è¶³å¤Ÿå¼ºæ‚ï¼Œå¾ˆå¤šè½»é‡çº§çš„éœ€æ±‚å®Œå…¨å¯ä»¥æ”¾åœ¨å‰ç«¯æ¥å®Œæˆã€‚

1.  å®‰è£…**Emscripten**
    
    **openCV**æ˜¯åŸºäº**C/C++**çš„ï¼Œæˆ‘ä»¬è¦ç”¨**js**ç‰ˆæœ¬çš„**openCV**ï¼Œéœ€è¦åšè½¬æ¢ï¼Œè¿™å°±éœ€è¦[Emscripten](https://emscripten.org/) è¿™ä¸ªç¼–è¯‘å™¨äº†ã€‚
    
    [Emscripten](https://emscripten.org/) æ˜¯ä¸€ä¸ªåŸºäº**LLVM**çš„ç¼–è¯‘å™¨ï¼Œå¯ä»¥å°†**C/C++**è¯­è¨€ç¼–è¯‘ä¸º**JavaScript**ã€‚æˆ‘ä»¬æŒ‰ç€å®˜ç½‘æ­¥éª¤ä¸€æ­¥ä¸€æ­¥ä¸‹è½½å®‰è£…å°±å¥½ï¼š
    
        # Get the emsdk repo
        git clone https://github.com/emscripten-core/emsdk.git
        # Enter that directory
        cd emsdk
        
        # Fetch the latest version of the emsdk (not needed the first time you clone)
        git pull
        
        # Download and install the latest SDK tools.
        ./emsdk install latest
        
        # Make the "latest" SDK "active" for the current user. (writes .emscripten file)
        ./emsdk activate latest
        
        # Activate PATH and other environment variables in the current terminal
        source ./emsdk_env.sh
        
    
2.  ä¸‹è½½**openCV**æºç 
    
    å®‰è£…å®Œç¼–è¯‘å™¨ï¼Œæ¥ç€å°±æ˜¯è·å–openCVçš„æºç 
    
        git clone https://github.com/opencv/opencv.git
        
    
3.  æ‰“åŒ…**openCV.js**
    
    å·¥å…·é“¾å’Œæºç éƒ½å‡†å¤‡å®Œæ¯•ï¼Œæœ€åä¸€æ­¥è¿˜éœ€è¦å®‰è£…**Python**ï¼Œæ­¥éª¤ç¡®å®æœ‰ç‚¹å¤šï¼Œ**Python**çš„å®‰è£…å°±ä¸æäº†ï¼Œä¸‹è½½åŒ…å®‰è£…æˆ–è€…**homebrew**å®‰è£…éƒ½å¯ä»¥ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹æ‰“åŒ…çš„å‘½ä»¤å§ï¼Œé»˜è®¤æ‰“åŒ…ä¸º**asm**ï¼Œæˆ‘ä»¬é€‰**webAssembly**ç‰ˆæœ¬çš„ï¼Œæœ€åä»build\_wasmæ‹·è´å‡ºopencv.jsã€‚
    
        cd opencv #è¿›å…¥opencvç›®å½•
        python ./platforms/js/build_js.py build_js # default asm
        python ./platforms/js/build_js.py build_wasm --build_wasm # build wasm
        
    

opencvåŸºç¡€æ“ä½œ
----------

1.  è¿è¡Œ**openCV.js**ï¼Œcv é»˜è®¤æ˜¯ä¸€ä¸ª**Promise**ï¼Œå› æ­¤éœ€è¦å¼‚æ­¥æ‰èƒ½è·å–å‡º**openCV**å…¨å±€å¯¹è±¡ã€‚
    
    è¿™é‡Œåªåšæœ€ç®€å•çš„æ“ä½œï¼Œè¯»å–å›¾ç‰‡ï¼Œè½¬æ¢ç°åº¦å›¾ï¼Œæ˜¾ç¤ºå›¾ç‰‡
    
        <canvas id="canvas" width="300" height="300"></canvas>
        <script src="./opencv.js"></script>
        <script>
          const canvas = document.createElement('canvas');
          let CV;
          async function init() {
            CV = await cv;
            console.log('cv: ', CV);
        
            const img = new Image();
            img.src = './img.png';
            img.onload = function () {
              const src = CV.imread(img);//è¯»å–å›¾ç‰‡
              const dst = new CV.Mat();
              CV.cvtColor(src, dst, CV.COLOR_RGBA2GRAY);//è½¬æ¢ä¸ºç°åº¦å›¾
              CV.imshow(canvas, dst);//æ˜¾ç¤ºå›¾ç‰‡
              src.delete();
              dst.delete();
            };
          }
          
          init();
        </script> 
        
    
2.  çŸ©é˜µæ“ä½œï¼ŒçŸ©é˜µå°±æ˜¯ä¸€ä¸ªå¤šç»´æ•°ç»„ï¼Œè€Œå›¾ç‰‡å°±æ˜¯äºŒç»´æ•°ç»„ï¼Œè¿™äº›åŸºç¡€æ“ä½œæˆ‘è®¤ä¸ºä¹Ÿæ˜¯æŒºæœ‰ç”¨çš„ã€‚
    
        const mat = new cv.Mat();// é»˜è®¤çŸ©é˜µ
        const mat = new cv.Mat(rows, cols, type);// ç±»å‹äºŒç»´çŸ©é˜µ
        const mat = new cv.Mat(rows, cols, type, new cv.Scalar());// æœ‰åˆå§‹å€¼çš„ç±»å‹äºŒç»´çŸ©é˜µ
        
        const mat = cv.Mat.zeros(rows, cols, type);//å…¨éƒ¨å¡«å……ä¸º0
        const mat = cv.Mat.ones(rows, cols, type);//å…¨éƒ¨å¡«å……ä¸º1
        const mat = cv.Mat.eye(rows, cols, type); //å•ä½çŸ©é˜µ
        
        const mat = cv.matFromArray(rows, cols, type, array);//ç”±æ•°ç»„æ„å»ºçŸ©é˜µ
        const mat = cv.matFromImageData(imgData);//ç”±å›¾ç‰‡æ„å»ºçŸ©é˜µ
        const dst = src.clone();//å…‹éš†
        src.copyTo(dst, mask);//æ ¹æ®maskæ‹·è´
        
        cv.add(src1, src2, dst, mask, dtype);//çŸ©é˜µç›¸åŠ 
        cv.subtract(src1, src2, dst, mask, dtype);//çŸ©é˜µç›¸å‡
        cv.bitwise_and(roi, roi, imgBg, maskInv);//çŸ©é˜µä¸è¿ç®—
        cv.bitwise_or(roi, roi, imgBg, maskInv);//çŸ©é˜µæˆ–è¿ç®—
        cv.bitwise_xor(roi, roi, imgBg, maskInv);//çŸ©é˜µå¼‚æˆ–è¿ç®—
        cv.bitwise_not(mask, maskInv);//çŸ©é˜µéè¿ç®—
        
    
3.  æ•°æ®ç»“æ„ç±»å‹ï¼Œè¿™ä¸ªç±»å‹ä¹Ÿå¯ä»¥äº†è§£ä¸€ä¸‹
    
        //ç‚¹
        const point = new cv.Point(x, y);
        const point = {x: x, y: y};
        //å‘é‡
        let scalar = new cv.Scalar(R, G, B, Alpha);
        let scalar = [R, G, B, Alpha];
        //å¤§å°
        const size = new cv.Size(width, height);
        const size = {width : width, height : height};
        
        //åœ†å½¢
        let circle = new cv.Circle(center, radius);
        let circle = {center : center, radius : radius};
        //çŸ©å½¢
        let rect = new cv.Rect(x, y, width, height);
        let rect = {x : x, y : y, width : width, height : height};
        
        //æ—‹è½¬çŸ©å½¢
        let rotatedRect = new cv.RotatedRect(center, size, angle);
        let rotatedRect = {center : center, size : size, angle : angle};
        
    

æ€»ç»“
--

æ‰“åŒ…æ„å»ºå‡º**openCV.js**ï¼ŒåŒæ—¶ä¹Ÿå­¦ä¹ äº†**openCV**ç›¸å…³çš„åŸºç¡€ã€‚åé¢æˆ‘ä»¬å°±å¯ä»¥åŸºäº**openCV**åšå¾ˆå¤šæœ‰è¶£çš„æ“ä½œäº†ï¼Œæ•¬è¯·æœŸå¾…ã€‚