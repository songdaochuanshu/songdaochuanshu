---
layout: post
title: "自己动手从零写桌面操作系统GrapeOS系列教程——4.1 在VirtualBox中安装CentOS"
date: "2023-04-11T01:05:03.591Z"
---
自己动手从零写桌面操作系统GrapeOS系列教程——4.1 在VirtualBox中安装CentOS
==================================================

> _学习操作系统原理最好的方法是自己写一个简单的操作系统。_

* * *

之前讲解开发环境时并没有介绍具体的安装过程，有网友反应CentOS的安装配置有问题，尤其是共享文件夹。本讲我们就来补充介绍一下在VirtualBox中安装配置CentOS的具体过程，彻底解决GrapeOS开发环境问题。

一、新建虚拟机
-------

1.在VirtulBox中点击新建按钮。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183219734-297752794.png)

2.名称和文件夹都可以自己定，我这里名称填写为CentOS7，类型选Linux，版本选Red Had (64-bit)。点击“下一步”按钮。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183226844-1996300094.png)

3.内存大小就填写默认的1024MB，够用了。如果不够用后面也可以改。点击“下一步”按钮。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183235268-1955345820.png)

4.虚拟硬盘选默认的“现在创建虚拟硬盘”。点击“创建”按钮。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183242381-477048103.png)

5.虚拟硬盘文件类型选默认的VDI。点击“下一步”按钮。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183251674-211113171.png)

6.存储在物理硬盘上选默认的“动态分配”。点击“下一步”按钮。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183259753-1242809265.png)

7.文件位置就用默认的。文件大小也用默认的8GB，对本教程来说够用了。点击“创建”按钮。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183308223-460319815.png)

8.一台虚拟裸机就配好了，具体配置如下截图：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183315282-692101424.png)

二、安装CentOS
----------

裸机配好了，下面我们就该装操作系统了。鼠标点击虚拟光驱，选择虚拟盘。选择我们之前已经下载好的CentOS安装文件CentOS-7-x86\_64-Minimal-2009.iso，iso文件相当于虚拟光盘。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183325286-762686712.png)

点击绿色的启动按钮，启动虚拟机。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183335167-1327924890.png)

启动后会显示一个安装选项，可以用键盘上下键选择，选第一项或第二项都可以，同时停止倒计时。如果不做选择的话，倒计时结束会自动安装。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183349551-608066321.png)

倒计时时间比较长，我这里选默认的第二项，然后回车。需要注意的是如果你第一次使用会发现鼠标进去虚拟机里出不来，此时按一下键盘上的右Ctrl键鼠标就出来了。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183357954-1794845644.png)

过一会儿会出现图形安装界面，语言选中文：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183404446-487207903.png)

点击“安装位置”：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183416108-184912928.png)

单击本地标准磁盘下的磁盘图标2次，然后点击“完成”按钮：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183424715-163931582.png)

点击“开始安装”：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183438044-679918457.png)

安装过程大概5分钟：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183446655-45157237.png)

安装完需要设置一下root密码，点击“ROOT密码”：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183454628-1951935500.png)

设置好密码点击“完成按钮”：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183503946-929622693.png)

继续点击“完成配置”按钮：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183512932-1909182776.png)

稍等片刻：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183522754-1336602396.png)

安装过程结束，点击“重启”按钮即可启动安装好的CentOS，同时虚拟机会自动弹出虚拟安装光盘，防止重新从光盘启动。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183533626-37720002.png)

登录：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183544139-183023964.png)

三、网络与IP配置
---------

### 1.与外网通信

虽然网络服务已经开机自动启动，但此时并不能上网：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183555501-1087335307.png)

原因是网卡没有启动，下面我们来启动网卡。修改文件/etc/sysconfig/netwrok-scripts/ifcfg-enp0s3  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183616156-563562720.png)

只要把最后一行“ONBOOT=no”改成“ONBOOT=yes”即可。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183624738-1935346079.png)

![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183633534-1228426058.png)

重启网络服务就可以ping通百度了：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183642509-2009016976.png)

### 2.与宿主机通信

此时CentOS虚拟机已经可以访问外网了，但是和宿主机Windows之间还不能相互通信，需要再加一个网卡才行，下面我们就来配置。  
用`poweroff`命令关闭CentOS虚拟机：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183657745-152645853.png)

在VirtualBox管理器中点击“网络”：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183706572-2025387277.png)

弹出网络设置窗口：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183719347-703799629.png)

点击选项卡“网卡2”：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183736769-1837215447.png)

勾选“启用网络连接”，连接方式选“仅主机(Host-Only)网络”，界面名称选默认的“VirtualBox Host-Only Ethernet Adapter”。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183751268-1671643714.png)

点击“OK”按钮，在VirtualBox管理器中可以看到多个一个网卡2：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183801730-605089220.png)

启动并登录CentOS虚拟机，通过`ip a`命令可以看到此时多了一个enp0s8的网卡。此时该网卡上的IP地址是动态分配的，每次启动都有可能不同。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183814994-16832770.png)

为了方便使用，我们需要设置静态IP，下面就来设置。  
新建并编辑文件/etc/sysconfig/netwrok-scripts/ifcfg-enp0s8  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183826020-403736525.png)

在ifcfg-enp0s8中输入如下内容：

    TYPE=Ethernet
    BOOTPROTO=static
    ONBOOT=yes
    IPADDR=192.168.56.2
    NETMASK=255.255.255.0
    GATEWAY=192.168.56.1
    DNS1=114.114.114.114
    

![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183837918-37580385.png)

关于网关地址和网络掩码可以通过如下方式查看到。  
在VirtualBox管理器菜单中点击“管理”->“主机网络管理器”：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183846109-574270866.png)

可以看到默认有一个网络适配器“VirtualBox Host-Only Ethernet Adapter”，如果没有可以点击“创建”按钮创建一个。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183853344-634091716.png)

点击“属性”按钮就可以看到网关地址和网络掩码了。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183902770-407828225.png)

保存好ifcfg-enp0s8文件，然后通过`reboot` 命令重启CentOS虚拟机。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183911796-2057368214.png)

可以看到我们设置的静态IP生效了：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183921059-1692974027.png)

此后我们就可以方便的通过SSH从PowerShell登录到CentOS虚拟机了。  
Windows键+R键打开运行小窗口，输入“powershell”：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183929526-216815666.png)

通过SSH登录：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183940835-260278708.png)

四、安装增强功能
--------

设置共享文件夹前必须先安装增强功能，下面我们来安装。  
首先需要安装几个前置软件：

    yum install -y kernel-devel-$(uname -r) bzip2 gcc make perl
    

![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410183951611-1529819642.png)

前置软件安装完毕：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184002287-1659526481.png)

在CentOS虚拟机窗口的菜单栏中点击“设备”->“安装增强功能”  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184009507-602688171.png)

点击之后的作用就是VirtualBox将自带的增强功能iso光盘文件放入到CentOS虚拟机的虚拟光驱中。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184016993-2075473940.png)

挂载后就可以看到光盘中的内容，我们要运行的是“VBoxLinuxAdditions.run”这个文件。  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184024173-1834580196.png)

大约一分钟增强功能安装完毕：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184033390-1084488587.png)

五、设置共享文件夹
---------

首先在CentOS虚拟机中创建共享文件夹/media/VMShare  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184043135-80823842.png)

在VirtualBox管理器中点击“共享文件夹”：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184051308-1554348707.png)

点击“添加共享文件夹”  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184102156-478618233.png)

然后填写相应的内容并点击“OK”按钮：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184110310-2054543895.png)

再点击“OK”按钮：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184119150-1124015127.png)

可以看到共享文件夹数量为1：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184131163-459034919.png)

此时在PowerShell中再查看文件夹/media/VMShare，已经能看到共享的内容了：  
![](https://img2023.cnblogs.com/blog/343777/202304/343777-20230410184141231-3651791.png)

如果看不到共享的内容，重启一下CentOS虚拟机就能了。  
共享文件夹设置完毕。

* * *

视频版地址：[https://www.bilibili.com/video/BV1nX4y1r7U4/](https://www.bilibili.com/video/BV1nX4y1r7U4/)  
配套的代码和资料：[https://gitee.com/jackchengyujia/grapeos-course](https://gitee.com/jackchengyujia/grapeos-course)  
GrapeOS操作系统QQ群：643474045

作者：成宇佳  
博客主页：[http://www.cnblogs.com/chengyujia/](https://www.cnblogs.com/chengyujia/)  
欢迎转载，但请保留作者和本文链接，谢谢！  
欢迎在下面的评论区与我交流。  

如果觉得写的不错，请点击下面的“推荐”按钮，让我更有动力写出更好的文章。