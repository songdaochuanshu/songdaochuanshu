---
layout: post
title: "Pythonæœç´¢ä¹¦åè·å–æ•´æœ¬èµ„æº_ç¬”è¶£é˜"
date: "2022-05-29T10:20:49.457Z"
---
Pythonæœç´¢ä¹¦åè·å–æ•´æœ¬èµ„æº\_ç¬”è¶£é˜
=====================

å‰è¨€
==

> å¶ç„¶ä¸€å¤©æŠŠæŸé¡¹ç›®æ–‡æ¡£ä¼ åˆ°æ‰‹æœºä¸Šï¼Œç”¨æ‰‹æœºè‡ªå¸¦çš„é˜…è¯»å™¨æ–¹ä¾¿éšæ—¶æ‹¿å‡ºæ¥æŸ¥é˜…ã€‚çœ‹ç€æˆ‘é‚£å¥½ä¹…æ²¡ç‚¹å¼€çš„é˜…è¯»å™¨ï¼Œå†çœ‹ç€ä¹¦æ¶ä¸Šæ‘†ç€å‡ æœ¬ä¸çŸ¥é“æ˜¯å¤šä¹…ä¹‹å‰å¯¼å…¥çš„å°è¯´ã€‚
> 
> é—­ä¸Šçœ¼ï¼Œæˆ‘ä»¿ä½›çœ‹åˆ°é‚£æ—¶å€™çš„è‡ªå·±ã€‚ä¾§èººç€ç¼©åœ¨è¢«çªé‡Œï¼Œäº®åº¦è°ƒåˆ°æœ€ä½ï¼Œçœ‹çš„æ´¥æ´¥æœ‰å‘³ã€‚
> 
> çå¼€çœ¼ï¼Œä¸€å£°çŸ­å¹ï¼Œå¿ƒä¸­äº”å‘³æ‚é™ˆï¼Œæ—¶é—´åƒç®­ä¸€æ ·é£é€è€Œå»ï¼Œè¿‡å»é™æ­¢ä¸åŠ¨ï¼Œæœªæ¥å§—å§—æ¥è¿Ÿã€‚
> 
> æ­£å¥½æœ€è¿‘åˆé‡æ¸©äº†ä¸‹pythonï¼Œå‡†å¤‡åšä¸€ä¸ªç®€å•çš„è·å–å°è¯´txtæ–‡ä»¶çš„ç¨‹åºã€‚

**ä¸€ã€å‰æœŸå‡†å¤‡**
==========

**1.å®‰è£…ç¬¬ä¸‰æ–¹åº“**
------------

> win + r è¾“å…¥cmd
> 
> å‘½ä»¤è¡Œè¾“å…¥
> 
> pip install requests
> 
> pip install pyquery
> 
> **å«Œéº»çƒ¦pycharmç›´æ¥æœç´¢åŒ…å®‰è£…å°±è¡Œ**

2.æ„Ÿè°¢[\---](https://www.bbiquge.net/)æ”¯æŒ
--------------------------------------

> çº¯å±çˆ±å¥½ï¼Œä»…ä¾›å­¦ä¹ 

* * *

äºŒã€ä¸»è¦æ­¥éª¤
======

1.è¯·æ±‚ç½‘é¡µ
------

> è€æ ·å­ï¼ŒF12è¿›æ§åˆ¶å°ï¼Œè¾“å…¥ document.chartset æŸ¥çœ‹ç½‘é¡µç¼–ç 

â€‹![](https://img-blog.csdnimg.cn/fc5a911653e3436fa84e5f4e2f217a2c.png)![](https://img2022.cnblogs.com/blog/2773467/202205/2773467-20220529173904701-1909702792.gif "ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨")â€‹  

**ä»£ç å¦‚ä¸‹ï¼š**

1 # è¯·æ±‚ç½‘é¡µ è·å–ç½‘é¡µæ•°æ®
2 def GetHTMLText(url: str) -> str:
3     res = requests.get(url=url, headers=GetHeader(), proxies=GetProxy())   
4     res.encoding = "GBK"
5     html: str = res.text
6     return html

2.è·å–ç« èŠ‚ç›®å½•
--------

**æµ‹è¯•åœ°å€ï¼š[\---](https://www.bbiquge.net/book/133312/)  
**

> Ctrl + Shift + C ï¼Œé€‰æ‹©ç« èŠ‚ç›®å½•ä»»æ„ä¸€ç« 
> 
> å¯ä»¥å‘ç°ç« èŠ‚ç›®å½•class="zjlist"ä¸‹çš„<dd>æ ‡ç­¾å†…å«æœ‰æ¯ä¸€ç« èŠ‚çš„ä¿¡æ¯ï¼Œè¯¥ç« èŠ‚çš„urlå’Œç« èŠ‚å

Â â€‹![](https://img-blog.csdnimg.cn/f9a2e8defe0940508a26e38e5526e10c.png)![](https://img2022.cnblogs.com/blog/2773467/202205/2773467-20220529173904701-1909702792.gif "ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨")â€‹â€‹

**ä»£ç å¦‚ä¸‹ï¼š**

1 # è·å–ç« èŠ‚ç›®å½•
2 def GetPageTree(doc: pQ) -> pQ:
3     pageTree: pQ = doc('.zjlist dd a')
4     return pageTree

â€‹

Â 3.è¾“å…¥è½¬ç 
-------

GBKè½¬ç :[aToolåœ¨çº¿å·¥å…·](https://www.atool99.com/urlencode.php "aToolåœ¨çº¿å·¥å…·")

> åœ¨æœç´¢æ¡†å†…è¾“å…¥åç§°ï¼Œsearchkey=ï¼Œåå°±æ˜¯è¯¥åç§°å¯¹åº”çš„GBKç¼–ç 

â€‹â€‹![](https://img-blog.csdnimg.cn/2c9d57d0702b479eb6377e30a06d7ce6.png)![](https://img2022.cnblogs.com/blog/2773467/202205/2773467-20220529173904701-1909702792.gif "ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨")â€‹â€‹

> å°†é“¾æ¥åçš„ç¼–ç è¾“è¿›è¿›è¡Œè§£ç ï¼Œå¾—åˆ°ä½ æ‰€è¾“å…¥çš„æ–‡å­—å†…å®¹

Â â€‹![](https://img-blog.csdnimg.cn/d0680d809d4e4edea1c537c4e4edf04b.png)![](https://img2022.cnblogs.com/blog/2773467/202205/2773467-20220529173904701-1909702792.gif "ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨")â€‹â€‹

**ä»£ç å¦‚ä¸‹ï¼š**

1 # è¾“å…¥è½¬ç  è·å–æœç´¢åˆ°çš„ä¹¦ç±é“¾æ¥
2 def GetSearchUrl(Novel\_Name: str) -> str:
3     StrToGbk: bytes = Novel\_Name.encode("gbk")
4     GbkToStr: str = str(StrToGbk)
5     Url\_input = GbkToStr\[2:-1\].replace("\\\\x", "%").upper()
6     Url = "\---" + "searchtype=articlename&searchkey="
7     return Url + Url\_input

4.æŠ“å–æ¨¡å¼
------

> æœç´¢åˆ°å°è¯´ä¹‹åè·³è½¬åˆ°æœç´¢åˆ°çš„ç½‘é¡µï¼Œå¯èƒ½ä¼šå‡ºç°ä¸¤ç§æƒ…å†µ
> 
> ä¸€ç§æ˜¯ä¸€æ¬¡æœç´¢åˆ°ç»“æœ
> 
> è¿˜æœ‰ä¸€ç§æ˜¯æœç´¢åˆ°å¤šç§ç»“æœï¼Œéœ€è¦å¯¹è¿™ä¸ªç½‘é¡µå†åšä¸€æ¬¡è§£æç­›é€‰
> 
> åˆ¤æ–­ç½‘é¡µå®¹å™¨çš„id="info"ï¼Œæ˜¯å¦æœ‰è¿™ä¸ªèŠ‚ç‚¹

â€‹![](https://img-blog.csdnimg.cn/9c4222303837441b8fd3df034bb53d6e.png)![](https://img2022.cnblogs.com/blog/2773467/202205/2773467-20220529173904701-1909702792.gif "ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨")â€‹  

**ä»£ç å¦‚ä¸‹ï¼š**

1 # æŠ“å–æ¨¡å¼
2 def GetModel(doc: pQ) -> bool:
3     if doc('#info'):
4         return True  # ä¸€æ¬¡æœç´¢åˆ°ï¼Œä¸éœ€è¦ç­›é€‰
5     else:
6         return False

* * *

ä¸‰ã€ä»£ç å±•ç¤º
======

![](https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif)![](https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif)

  1 import os  2 import requests  3 import time  4 import re  5 from random import choice  6 from pyquery import PyQuery as pQ  7 
  8 
  9 # è·å–è¯·æ±‚å¤´
 10 def GetHeader() -> dict: 11     header = \[  # è¯·æ±‚å¤´
 12         {
 13             "User-Agent": "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.67 Safari/537.36"
 14         },
 15         {
 16             "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1"
 17         },
 18         {
 19             "User-Agent": "Mozilla/5.0 (Windows NT 6.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1"
 20         },
 21         {
 22             "User-Agent": "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.101 Safari/537.36"
 23         },
 24         {
 25             "User-Agent": "Mozilla/5.0 (X11; U; Linux x86\_64; zh-CN; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10"
 26         },
 27         {
 28             "User-Agent": "Mozilla/5.0 (X11; U; Linux x86\_64; zh-CN; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10"
 29         },
 30         {
 31             "User-Agent": "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.101 Safari/537.36"
 32         },
 33         {
 34             "User-Agent": "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.122 UBrowser/4.0.3214.0 Safari/537.36"
 35         },
 36         {
 37             "User-Agent": "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SV1; QQDownload 732; .NET4.0C; .NET4.0E; SE 2.X MetaSr 1.0)"
 38         },
 39         {
 40             "User-Agent": "Mozilla/5.0 (Windows; U; Windows NT 6.1; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50"
 41         }
 42     \]
 43     return choice(header) 44 
 45 
 46 # è·å–ä»£ç†
 47 def GetProxy() -> dict: 48     proxies = \[  # ä»£ç†
 49         {
 50             "Https": "60.170.204.30:8060"
 51         },
 52         {
 53             "Https": "103.37.141.69:80"
 54         },
 55         {
 56             "Https": "183.236.232.160:8080"
 57         },
 58         {
 59             "Https": "202.55.5.209:8090"
 60         },
 61         {
 62             "Https": "202.55.5.209:8090"
 63         }
 64     \]
 65     return choice(proxies) 66 
 67 
 68 # è¾“å…¥è½¬ç  è·å–æœç´¢åˆ°çš„ä¹¦ç±é“¾æ¥
 69 def GetSearchUrl(Novel\_Name: str) -> str: 70     StrToGbk: bytes = Novel\_Name.encode("gbk")
 71     GbkToStr: str = str(StrToGbk) 72     Url\_input = GbkToStr\[2:-1\].replace("\\\\x", "%").upper()
 73     Url = "\---" + "modules/article/search.php?searchtype=articlename&searchkey="
 74     return Url + Url\_input 75 
 76 
 77 # è¯·æ±‚ç½‘é¡µ è·å–ç½‘é¡µæ•°æ®
 78 def GetHTMLText(url: str) -> str: 79     res = requests.get(url=url, headers=GetHeader(), proxies=GetProxy())
 80     # Console --- document.charset ---'GBK'
 81     res.encoding = "GBK"
 82     html: str = res.text 83     return html 84 
 85 
 86 # è·å–ç½‘é¡µè§£æ
 87 def GetParse(url: str) -> pQ: 88     text = GetHTMLText(url) 89     doc: pQ = pQ(text) 90     return doc 91 
 92 
 93 # è·å–å°è¯´å
 94 def GetNovelName(doc: pQ) -> str: 95     con = doc('#info')
 96     novel\_name: str = con('h1').text().split(' ')\[0\]
 97     return novel\_name 98 
 99 
100 # è·å–ç« èŠ‚ç›®å½•
101 def GetPageTree(doc: pQ) -> pQ:
102     pageTree: pQ = doc('.zjlist dd a')
103     return pageTree
104 
105 
106 # æå–ç« èŠ‚é“¾æ¥è·³è½¬åçš„é¡µé¢å†…å®¹ id="content"
107 def GetNovel(url) -> str:
108     doc = GetParse(url)
109     con = doc('#content')
110     novel: str = con.text()
111     return novel
112 
113 
114 # è·å–æ€»é¡µæ•°
115 def GetPageNums(doc: pQ):
116     pageNums = doc('.form-control option')
117     return pageNums
118 
119 
120 # è·å–novelä¸»é¡µé“¾æ¥
121 def GetHomeUrl(doc: pQ) -> str:
122     PageNums = GetPageNums(doc)
123     for page in PageNums.items():
124         if page.text() == "ç¬¬1é¡µ":
125             return page.attr('value')
126 
127 
128 # æŠ“å–æ¨¡å¼
129 def GetModel(doc: pQ) -> bool:
130     if doc('#info'):
131         return True  # ä¸€æ¬¡æœç´¢åˆ°ï¼Œä¸éœ€è¦ç­›é€‰
132     else:
133         return False
134 
135 
136 # æœç´¢åˆ°ç»“æœå¼€å§‹æŠ“å–
137 # Args\_url---novelä¸»é¡µé“¾æ¥
138 # ms---é—´éš”æ—¶é—´ï¼Œå•ä½ï¼šms
139 # url\_ ä¸»ç½‘ç«™
140 def GetDate\_1(Args\_url: str, doc: pQ, ms: int, url\_: str = "\---") -> None:
141     NovelName = GetNovelName(doc)
142     PageNums = GetPageNums(doc)
143     file\_path = os.getcwd() + "\\\\" + NovelName  # æ–‡ä»¶å­˜å‚¨è·¯å¾„
144     setDir(file\_path)  # åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ›å»º,å­˜åœ¨åˆ é™¤
145     Seconds: float = ms / 1000.0
146     for page in PageNums.items():
147         url = url\_ + page.attr('value')  # æ¯ä¸€é¡µçš„é“¾æ¥
148         currentPage = page.text()  # å½“å‰é¡µ
149         doc: pQ = GetParse(url)
150         page\_tree = GetPageTree(doc)
151         for page\_Current in page\_tree.items():
152             page\_name: str = page\_Current.text()  # ç« èŠ‚å
153             page\_link = page\_Current.attr('href')  # ç« èŠ‚é“¾æ¥
154             novel = page\_name + "\\n\\n" + GetNovel(Args\_url + page\_link) + "\\n\\n"  # æ–‡ç« å†…å®¹
155             page\_Name = clean\_file\_name(page\_name)  # å¤„ç†åçš„ç« èŠ‚å
156             download\_path = file\_path + "\\\\" + NovelName + ".txt"  # æ–‡ä»¶ä¸‹è½½è·¯å¾„
157             with open(download\_path, "a", encoding="utf-8") as f:
158 f.write(novel)
159                 print("æ­£åœ¨ä¸‹è½½ {}...".format(page\_Name))
160 time.sleep(Seconds)
161 f.close()
162             print("{}ä¸‹è½½æˆåŠŸ\\n".format(page\_Name))
163         print("{}ä¸‹è½½å®Œæˆ\\n".format(currentPage))
164     print("{}ä¸‹è½½å®Œæˆ!".format(NovelName))
165 
166 
167 # æœç´¢åˆ°é‡å¤ç»“æœï¼Œéœ€è¦è¿›è¡Œç­›é€‰.åŒ¹é…æˆåŠŸè¿”å›é¦–é¡µçš„ç½‘å€
168 def GetUrl\_2(doc: pQ, SearchName: str) -> str:
169     con = doc('.odd a').items()
170     for Title in con:
171         if Title.text() == SearchName:
172             url: str = Title.attr('href')
173             return url
174 
175 
176 # æ–‡ä»¶å¤„ç†
177 def setDir(filepath):
178     if not os.path.exists(filepath):  # å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨å°±åˆ›å»º
179 os.mkdir(filepath)
180     else:
181         for i in os.listdir(filepath):  # os.listdir(filepath)è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢æ˜¯å½“å‰ç›®å½•ä¸‹é¢çš„æ‰€æœ‰ä¸œè¥¿çš„ç›¸å¯¹è·¯å¾„
182             file\_data = filepath + "\\\\" + i  # å½“å‰æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
183             if os.path.isfile(file\_data):
184                 os.remove(file\_data)  # æ–‡ä»¶å­˜åœ¨-åˆ é™¤
185 
186 
187 # å¼‚å¸¸æ–‡ä»¶åå¤„ç†
188 def clean\_file\_name(filename: str):
189     invalid\_chars = '\[\\\\\\/:\*?ï¼Ÿ"<>|\]'
190     replace\_char = '\-'
191     return re.sub(invalid\_chars, replace\_char, filename)
192 
193 
194 # ä¿å­˜æ–‡ä»¶
195 def SaveFile(url: str, searchName: str):
196     doc = GetParse(url)
197     url\_: str = "\---" #æ‡‚å¾—éƒ½æ‡‚
198     try:
199         if GetModel(doc):
200             url = url\_ + GetHomeUrl(doc)
201             doc = doc
202         else:
203             url = GetUrl\_2(doc, searchName)
204             doc = GetParse(url)
205         GetDate\_1(Args\_url=url, doc=doc, ms=100)
206     except Exception as result:
207         print("{}".format(result))
208     finally:
209         print("è¯·è¾“å…¥æœ‰æ•ˆä¹¦å")
210 
211 
212 # è¾“å…¥åå­—æœç´¢
213 def main():
214     SearchName = input("è¯·è¾“å…¥éœ€è¦ä¸‹è½½çš„ä¹¦åï¼š")
215     url = GetSearchUrl(SearchName)
216 SaveFile(url, SearchName)
217 
218 
219 if \_\_name\_\_ == "\_\_main\_\_":
220     main()

View Code

* * *

å››ã€è¿è¡Œæ•ˆæœ
======

![](https://img2022.cnblogs.com/blog/2773467/202205/2773467-20220529173819275-1971469845.png)

![](https://img2022.cnblogs.com/blog/2773467/202205/2773467-20220529173846874-192974059.png)

* * *

æ€»ç»“
==

> æŒ‰åç§°æœç´¢è·Ÿç›´æ¥æ‹¿é¦–é¡µé“¾æ¥åŸç†å·®ä¸å¤šï¼Œåªä¸è¿‡å¤šäº†ä¸ªç­›é€‰çš„æ“ä½œ
> 
> ä»¥ä¸Šå°±æ˜¯ä»Šå¤©è¦åˆ†äº«çš„å†…å®¹ï¼Œæ—¶é—´åŸå› è¿˜æœ‰å¾ˆå¤šå¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Œåé¢æœ‰æ—¶é—´å†æ”¹å§â€¦â€¦
> 
> æœ€åè¯´è¯´è‡ªå·±çš„ä¸€äº›æƒ³æ³•ï¼Œä¸ºä»€ä¹ˆç°åœ¨å¯¹å°è¯´æ²¡ä»€ä¹ˆæ„Ÿè§‰äº†ã€‚
> 
> çœ‹å°è¯´é™¤äº†è®©æˆ‘çš„é¼»æ¢ä¸Šæˆ´ç€çš„ä¸œè¥¿è¶Šæ¥è¶Šåšä¹‹å¤–ï¼Œè¿˜è®©æˆ‘çš„ä½œæ¯å˜å¾—ä¸€å›¢ç³Ÿã€‚æˆ‘æ˜¯ä¸ªç®¡ä¸ä½è‡ªå·±çš„äººï¼Œä»¥å‰çœ‹å°è¯´æœ€ç€è¿·çš„æ—¶å€™ï¼Œé™¤äº†åƒé¥­ç¡è§‰ï¼Œå‰©ä¸‹æ—¶é—´å…¨æ‹¿æ¥çœ‹å°è¯´äº†ã€‚
> 
> å½“ç„¶ï¼Œçœ‹å°è¯´ä¹Ÿå¹¶ä¸åƒæˆ‘è¯´çš„é‚£æ ·ç™¾å®³æ— ä¸€åˆ©ï¼Œä½†æ˜¯è¦æ³¨æ„åˆç†å®‰æ’å¥½è‡ªå·±çš„æ—¶é—´ï¼ŒåŠ³é€¸ç»“åˆã€‚ğŸ˜‚