---
layout: post
title: "linux"
date: "2022-10-17T14:02:57.139Z"
---
linux
=====

ä»¥centos7ä¸ºä¸»

linuxåˆå§‹åŒ–
========

centoså®‰è£…
--------

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017213954769-631797228.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214007347-94706211.png)

### å®‰è£…ä½ç½®

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214039701-2134510666.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214051371-537574762.png)

    40Gåˆ†é…å†…å­˜
    / 		30G
    /boot 	200M
    swap	4G
    /tmp	5935M
    

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214104942-75841306.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214116932-1095970336.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214126680-1889621946.png)

### è½¯ä»¶å®‰è£…

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214139088-307051782.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214148584-1385546558.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214159706-1324997802.png)

### åˆ›å»ºè´¦æˆ·

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214212464-1004065521.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214221961-768564769.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214234109-1114097511.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214244203-646095780.png)

ç£ç›˜åˆ†åŒºè¡¨ç¤ºæ–¹æ³•
--------

linuxä¸­å°†ç¡¬ç›˜ã€åˆ†åŒºç­‰è®¾å¤‡å‡è¡¨ç¤ºä¸ºæ–‡ä»¶

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214255355-1740543554.png)

ç¡¬ç›˜ä¸æ ‡å‡†åˆ†åŒºç»“æ„
---------

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214314513-1648146266.png)

å¸¸è§çš„æ–‡ä»¶ç±»å‹
-------

*   centos7é»˜è®¤ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹
    *   XFSï¼Œæ—¥å¿—æ–‡ä»¶ç³»ç»Ÿ
    *   SWAPï¼Œäº¤æ¢æ–‡ä»¶ç³»ç»Ÿ
*   linuxæ”¯æŒçš„å…¶ä»–æ–‡ä»¶ç³»ç»Ÿç±»å‹
    *   EXT3ã€EXT4
    *   FAT16ã€FAT32ã€NTFS
    *   XFSã€JFS
    *   â€¦â€¦

inodeèŠ‚ç‚¹ä¸å—
---------

å…ƒæ•°æ® : åˆ›å»ºè€…ã€åˆ›å»ºæ—¥æœŸã€å¤§å°ç­‰ï¼Œç§°ä¸ºç´¢å¼•èŠ‚ç‚¹

æ•°æ®å— : ç”±å¤šä¸ªæ‰‡åŒºç»„æˆï¼Œå¸¸è§4KBä¸€å—ï¼Œå­˜æ”¾æ–‡ä»¶æ•°æ®å’Œç›®å½•æ•°æ®

inodeåŒºåŸŸ : å­˜å‚¨å…ƒæ•°æ®çš„åŒºåŸŸï¼Œæ–‡ä»¶å­—èŠ‚æ•°ã€æƒé™ã€å½’å±ã€æ—¶é—´é”™ã€è¿æ¥ã€æ•°æ®å—ä½ç½®

inode bitmap : inodeä½¿ç”¨æƒ…å†µï¼Œæ¯”å¦‚ç©ºé—²çš„inode

block bitmap : å—çš„ä½¿ç”¨æƒ…å†µï¼Œæ¯”å¦‚ç©ºé—²inodeä¸ç©ºé—²å—ç­‰ä¿¡æ¯

linuxç³»ç»Ÿå¼•å¯¼è¿‡ç¨‹
-----------

å¼€æœºè‡ªæ£€\[BIOS\] => MBRå¼•å¯¼ => GRUBèœå• => åŠ è½½å†…æ ¸\[kernel\] => initè¿›ç¨‹åˆå§‹åŒ–

### initè¿›ç¨‹

ç”±linuxå†…æ ¸åŠ è½½è¿è¡Œ/sbin/initç¨‹åº

æ˜¯ç³»ç»Ÿä¸­çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹

PID\[è¿›ç¨‹æ ‡è®°\]å·æ°¸è¿œä¸º1

### Systemdè¿›ç¨‹

ä»£æ›¿initè¿›ç¨‹ï¼Œæˆä¸ºä¸»æµ

ç¨‹åºä½äº/usr/lib/systemd/systemd

Systemdçš„ä¼˜åŠ¿

*   å‘ä¸‹å…¼å®¹
*   æ›´å¿«çš„å¯åŠ¨ç†Ÿè¯»ï¼Œé›†ä¸­åŒ–å‘½ä»¤ç®¡ç†ï¼Œæ›´åˆç†çš„å‘½ä»¤ç»“æ„

#### Systemdå•å…ƒç±»å‹

å•å…ƒç±»å‹

æ‰©å±•å

è¯´æ˜

Service

.service

æè¿°ä¸€ä¸ªç³»ç»ŸæœåŠ¡

Socket

.socket

æè¿°ä¸€ä¸ªè¿›ç¨‹é—´é€šä¿¡çš„å¥—æ¥å­—

Device

.device

æè¿°ä¸€ä¸ªå†…æ ¸è¯†åˆ«çš„è®¾å¤‡æ–‡ä»¶

Mount

.mount

æè¿°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç‚¹

Automount

.automount

æè¿°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„è‡ªåŠ¨æŒ‚è½½ç‚¹

Swap

.swap

æè¿°ä¸€ä¸ªå†…å­˜äº¤æ¢è®¾å¤‡æˆ–äº¤æ¢æ–‡ä»¶

Path

.path

æè¿°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶æˆ–ç›®å½•

Timer

.timer

æè¿°ä¸€ä¸ªå®šæ—¶å™¨\[ç”¨äºå®ç°ç±»ä¼¼cronçš„è°ƒåº¦ä»»åŠ¡\]

Snapshot

.snapshot

ç”¨äºä¿å­˜ä¸€ä¸ªsystemdçš„çŠ¶æ€

Scope

.scpoe

ä½¿ç”¨systemdçš„æ€»çº¿æ¥å£ä»¥ç¼–ç¨‹çš„æ–¹å¼åˆ›å»ºå¤–éƒ¨è¿›ç¨‹

Slice

.slice

æè¿°å±…äºCgroupçš„ä¸€ç»„é€šè¿‡å±‚æ¬¡ç»„ç»‡çš„ç®¡ç†ç³»ç»Ÿè¿›ç¨‹

Target

.target

æè¿°ä¸€ç»„systemdçš„å•å…ƒ

#### è¿è¡Œçº§åˆ«

å¯¹åº”çš„Systemdç›®æ ‡

è¿è¡Œçº§åˆ«

Systemdçš„target

è¯´æ˜

0

target

å…³æœºçŠ¶æ€ï¼Œä½¿ç”¨è¯¥çº§åˆ«æ—¶å°†ä¼šå…³é—­ä¸»æœº

1

rescue.target

å•ç”¨æˆ·æ¨¡å¼ï¼Œä¸éœ€è¦å¯†ç éªŒè¯å³å¯ç™»å½•ç³»ç»Ÿï¼Œå¤šç”¨äºç³»ç»Ÿç»´æŠ¤

2

multi-user.target

ç”¨æˆ·å®šä¹‰/åŸŸç‰¹å®šè¿è¡Œçº§åˆ«\[é»˜è®¤ç­‰åŒäº3\]

3

multi-user.target

å­—ç¬¦ç•Œé¢çš„å®Œæ•´å¤šç”¨æˆ·æ¨¡å¼ï¼Œå¤§å¤šæ•°æœåŠ¡å™¨ä¸»å¥è¿è¡Œåœ¨æ­¤çº§åˆ«

4

multi-user.target

ç”¨æˆ·å®šä¹‰/åŸŸç‰¹å®šè¿è¡Œçº§åˆ«\[é»˜è®¤ç­‰åŒäº3\]

5

graphical.target

å›¾å½¢ç•Œé¢çš„å¤šç”¨æˆ·æ¨¡å¼ï¼Œæä¾›äº†å›¾å½¢æ¡Œé¢æ“ä½œç³»ç»Ÿ

6

reboot.target

é‡æ–°å¯åŠ¨ï¼Œä½¿ç”¨è¯¥çº§åˆ«æ—¶å°†ä¼šé‡å¯ä¸»æœº

`init 3`å’Œ`systemctl isolate multi-user.target`å®ç°çš„æ•ˆæœä¸€æ ·

ç›®å½•ç»“æ„
----

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214334856-1702147523.png)

ç›®å½•

è¯´æ˜

bin

å­˜æ”¾çš„æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤æ–‡ä»¶

dev

å­˜æ”¾çš„æ˜¯è®¾å¤‡\[ç¡¬ç›˜ã€å…‰ç›˜ã€æ‘„åƒå¤´ã€é¼ æ ‡ç­‰\]

home

æ™®é€šç”¨æˆ·çš„å®¶ç›®å½•

lib64

åº“æ–‡ä»¶æ‰€å­˜çš„ç›®å½•

mnt

ç§»åŠ¨å­˜å‚¨è®¾å¤‡çš„æŒ‚è½½ç›®å½•

proc

å­˜æ”¾å†…å­˜æ‰€æ‰§è¡Œçš„æ–‡ä»¶ï¼Œèƒ½æŸ¥çœ‹ï¼Œä¸èƒ½ä¿®æ”¹

run

è‡ªåŠ¨è¿è¡Œçš„ç¨‹åº

srv

ä¸€äº›æœåŠ¡

tmp

ä¸´æ—¶æ–‡ä»¶

var

æ—¥å¿—æ–‡ä»¶

boot

å¼•å¯¼ç¨‹åº

etc

é…ç½®æ–‡ä»¶

lib

åº“æ–‡ä»¶æ‰€å­˜çš„ç›®å½•

media

åª’ä½“æ–‡ä»¶

opt

å­˜æ”¾çš„é‡è¦æ–‡ä»¶å’Œprocå·®ä¸å¤š

root

ç®¡ç†å‘˜ç”¨æˆ·ä¸“ç”¨çš„å®¶ç›®å½•

sbin

å’Œbinç›¸å¯¹åº”ï¼Œä½†åªæœ‰ç®¡ç†å‘˜å¯ä»¥æ‰§è¡Œ

sys

ç³»ç»Ÿ

usr

ç¬¬ä¸‰æ–¹å®‰è£…è½¯ä»¶

shell
-----

linuxç³»ç»Ÿä¸­è¿è¡Œçš„ä¸€ç§ç‰¹æ®Šç¨‹åº

åœ¨ç”¨æˆ·å’Œå†…æ ¸ä¹‹é—´å……å½“ç¿»è¯‘å®˜

ç”¨æˆ·ç™»å½•linuxç³»ç»Ÿæ—¶ï¼Œè‡ªåŠ¨åŠ è½½ä¸€ä¸ªshellç¨‹åº

bashæ˜¯linuxç³»ç»Ÿä¸­é»˜è®¤ä½¿ç”¨çš„shellç¨‹åº\[æ–‡ä»¶ä½äº/bin/bash\]

linuxåŸºç¡€é…ç½®
=========

å…³é—­é˜²ç«å¢™
-----

*   ä¸´æ—¶å…³é—­
    
    > setenforce 0
    
*   æ°¸ä¹…å…³é—­
    
    > vim /etc/selinux/config
    
    ![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214348435-268848616.png)
    
    > systemctl stop firewalld
    > 
    > iptables -F
    

ç³»ç»ŸæœåŠ¡æ§åˆ¶
------

> systemctl æ§åˆ¶ç±»å‹ æœåŠ¡åç§°

æ§åˆ¶ç±»å‹

*   stop : å…³é—­
*   start : å¼€å¯
*   restart : é‡å¯
*   reload : é‡æ–°åŠ è½½
*   status : æŸ¥çœ‹çŠ¶æ€

è¿è¡Œçº§åˆ«åˆ‡æ¢
------

### æŸ¥çœ‹è¿è¡Œçº§åˆ«

> runlevel
> 
> systemctl

runlevelåªèƒ½æŸ¥çœ‹åˆ‡æ¢è¿è¡Œçº§åˆ«ä¸å½“å‰è¿è¡Œçº§åˆ«

systemctlæ—¶èƒ½æŸ¥çœ‹é»˜è®¤çš„è¿è¡Œçº§åˆ«

### ä¸´æ—¶åˆ‡æ¢è¿è¡Œçº§åˆ«

> init
> 
> systemctl

initçš„å‘½ä»¤å‚æ•°æ˜¯è¿è¡Œç•Œåˆ«æ‰€å¯¹åº”çš„æ•°å­—

systemctlçš„å‘½ä»¤å‚æ•°æ˜¯å…·ä½“çš„target

ä¼˜åŒ–å¯åŠ¨é¡¹
-----

### ç³»ç»ŸæœåŠ¡ç®¡ç†å·¥å…·

#### ntsysvå·¥å…·

æä¾›ä¸€ä¸ªäº¤äº’å¼ã€å¯è§†åŒ–çª—å£ï¼Œå¯ä»¥åœ¨å­—ç¬¦ç»ˆç«¯è¿è¡Œï¼Œä¾¿äºé›†ä¸­ç®¡ç†å¤šä¸ªæœåŠ¡

#### systemctlå·¥å…·

ä¸æä¾›äº¤äº’å¼ã€å¯è§†åŒ–çª—å£ï¼Œç®¡ç†å•ä¸ªæœåŠ¡æ•ˆç‡æ›´é«˜

*   æŸ¥çœ‹ç³»ç»ŸæœåŠ¡çš„å¯åŠ¨çŠ¶æ€

> systemctl is-enabled æœåŠ¡åç§°

*   è®¾ç½®ç³»ç»ŸæœåŠ¡çš„å¯åŠ¨çŠ¶æ€

> systemctl enable/disable æœåŠ¡åç§°

linuxå‘½ä»¤ä»‹ç»
=========

linuxå‘½ä»¤åˆ†ç±»
---------

1.  å†…éƒ¨å‘½ä»¤

*   ç»§æ‰¿ä¸shellè§£é‡Šå™¨ç¨‹åºå†…éƒ¨çš„ä¸€äº›ç‰¹æ®ŠæŒ‡ä»¤ï¼Œä¹Ÿç§°ä¸ºå†…å»º(Built-in)æŒ‡ä»¤
*   å±äºshellçš„ä¸€éƒ¨åˆ†
*   æ²¡æœ‰å•ç‹¬å¯¹åº”çš„ç³»ç»Ÿæ–‡ä»¶
*   è‡ªåŠ¨è½½å…¥å†…å­˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨

2.  å¤–éƒ¨å‘½ä»¤

*   linuxç³»ç»Ÿä¸­èƒ½å¤Ÿå®Œæˆç‰¹å®šåŠŸèƒ½çš„è„šæœ¬æ–‡ä»¶æˆ–äºŒè¿›åˆ¶ç¨‹åº
*   å±äºshellè§£é‡Šå™¨ç¨‹åºä¹‹å¤–çš„å‘½ä»¤
*   æ¯ä¸ªå¤–éƒ¨å‘½ä»¤å¯¹åº”äº†ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ–‡ä»¶
*   å¿…é¡»åªå¸¦å…¶å¯¹åº”çš„æ–‡ä»¶ä½ç½®ï¼Œç”±shellåŠ è½½åæ‰èƒ½æ‰§è¡Œ

linuxå‘½ä»¤æ ¼å¼
---------

> å‘½ä»¤å­— \[é€‰é¡¹\] \[å‚æ•°\]

å¸®åŠ©ä¿¡æ¯
----

> help
> 
> \--help
> 
> man / info

åˆ«åä¿¡æ¯
----

*   è®¾ç½®åˆ«å

> alias å‘½ä»¤åˆ«å='å‘½ä»¤'
> 
> alias ll='ls -l --color=auto'

*   åˆ é™¤åˆ«å

> unalias å‘½ä»¤åˆ«å
> 
> unalias ll

linuxåŸºç¡€å‘½ä»¤
=========

ç›®å½•å’Œæ–‡ä»¶æ“ä½œ
-------

### æŸ¥çœ‹åŠåˆ‡æ¢ç›®å½•

#### pwd

*   æ˜¾ç¤ºç”¨æˆ·å½“å‰æ‰€åœ¨çš„å·¥ä½œç›®å½•ä½ç½®ã€

#### cd

*   å°†ç”¨æˆ·çš„å·¥ä½œç›®å½•åˆ‡æ¢åˆ°å…¶ä»–ä½ç½®

æŒ‡ä»¤

æè¿°

cd ./

åˆ‡æ¢å½“å‰ç›®å½•\[ä¸åšå˜åŒ–\]

cd ../

åˆ‡æ¢åˆ°ä¸Šä¸€çº§ç›®å½•

cd ~

åˆ‡æ¢åˆ°å®¿ä¸»ç›®å½•

cd -

åˆ‡æ¢åˆ°ä¸Šä¸€æ¬¡æ‰§è¡Œcdçš„ç›®å½•

#### ls

æŒ‡ä»¤

æè¿°

ls -l

ä»¥é•¿æ ¼å¼æ˜¾ç¤º

ls -h

æ˜¾ç¤ºæ–‡ä»¶å¤§å°ç­‰ä¿¡æ¯

ls -a

æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„éšè—æ–‡ä»¶

ls -A

æ˜¾ç¤ºå‡ºäº†"."å’Œ".."å¼€å¤´çš„æ–‡ä»¶

ls -d

æŸ¥çœ‹ç›®å½•æœ¬èº«çš„ä¿¡æ¯

ls \*.txt

æŸ¥çœ‹ä»¥.txtç»“å°¾çš„æ–‡ä»¶ã€\*åŒ¹é…æ–‡ä»¶åä¸­çš„ä»»æ„å¤šä¸ªå­—ç¬¦ã€‘

ls ?.txt

æŸ¥çœ‹å•ä¸ªå­—ç¬¦å¼€å¤´ï¼Œ.txtç»“å°¾çš„æ–‡ä»¶ã€?åŒ¹é…æ–‡ä»¶åä¸­çš„ä¸€ä¸ªå­—ç¬¦ã€‘

#### du

*   ç»Ÿè®¡æŒ‡å®šç›®å½•\[æˆ–æ–‡ä»¶\]æ‰€å ç”¨çš„ç£ç›˜ç©ºé—´çš„å¤§å°

æŒ‡ä»¤

æè¿°

du -a

ç»Ÿè®¡ç£ç›˜ç©ºé—´å ç”¨æ—¶åŒ…æ‹¬æ‰€æœ‰çš„æ–‡ä»¶ï¼Œè€Œä¸ä»…ä»…åªç»Ÿè®¡ç›®å½•

du -h

æ˜¾ç¤ºå‡ºç›®å½•æˆ–æ–‡ä»¶çš„å¤§å°\[Kã€M\]ï¼Œé»˜è®¤çš„å¤§å°å•ä½æ—¶å­—èŠ‚\[KB\]

du -s

åªç»Ÿè®¡æ¯ä¸ªå‚æ•°æ‰€å ç”¨ç©ºé—´æ€»çš„å¤§å°ï¼Œè€Œä¸æ˜¯ç»Ÿè®¡æ¯ä¸ªå­ç›®å½•ã€æ–‡ä»¶çš„å¤§å°

### åˆ›å»ºç›®å½•å’Œæ–‡ä»¶

#### mkdir

*   åˆ›å»ºæ–°çš„ç©ºç›®å½•

æŒ‡ä»¤

æè¿°

mkdir -p

ä¸€æ¬¡åˆ›å»ºå¤šå±‚ç›®å½•\[mkdir -p a/b/c/d\]

åˆ›å»ºå¤šå±‚ï¼Œå¤šä¸ªç›®å½•æ—¶ï¼Œéœ€è¦æ³¨æ„ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„

#### touch

*   åˆ›å»ºæ–°çš„ç©ºæ–‡ä»¶\[æ›´æ–°æ–‡ä»¶çš„æ—¶é—´æ ‡è®°\]

#### ln

*   ä¸ºæ–‡ä»¶æˆ–ç›®å½•åˆ›å»ºè¿æ¥æ–‡ä»¶\[å’Œwindowsçš„å¿«æ·æ–¹å¼ç±»ä¼¼\]

è½¯é“¾æ¥

ç¡¬é“¾æ¥

åˆ é™¤åŸå§‹æ–‡ä»¶å

å¤±æ•ˆ

ä»æ—§å¯ä»¥ä½¿ç”¨

ä½¿ç”¨èŒƒå›´

é€‚ç”¨äºæ–‡ä»¶æˆ–ç›®å½•

åªèƒ½ç”¨äºæ–‡ä»¶

ä¿å­˜ä½ç½®

ä¸åŸå§‹æ–‡ä»¶å¯ä»¥ä½äºä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿä¸­

å¿…é¡»ä¸åŸå§‹æ–‡ä»¶åœ¨ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ\[linuxåˆ†åŒº\]å†…

*   è½¯é“¾æ¥

> ln -s æºæ–‡ä»¶æˆ–ç›®å½• é“¾æ¥æ–‡ä»¶æˆ–ç›®æ ‡ä½ç½®
> 
> ln -s /bin/bzip2 /bin/wx/

*   ç¡¬é“¾æ¥

> ln /bin/bzip2 /bin/wx/

### å¤åˆ¶åˆ é™¤ç§»åŠ¨ç›®å½•

#### cp

*   å°†éœ€è¦å¤åˆ¶çš„æ–‡ä»¶æˆ–ç›®å½•\[æº\]é‡å»ºä¸€ä»½ï¼Œå¹¶ä¿å­˜ä¸ºæ–°çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¤åˆ¶åå¯èµ‹äºˆæ–°åç§°

æŒ‡ä»¤

æè¿°

cp -f

è¦†ç›–ç›®æ ‡åŒåæ–‡ä»¶æˆ–ç›®å½•æ—¶ä¸è¿›è¡Œæé†’ï¼Œç›´æ¥å¼ºåˆ¶å¤åˆ¶

cp -i

è¦†ç›–ç›®æ ‡åŒåæ–‡ä»¶æˆ–ç›®å½•æ—¶æé†’ç”¨æˆ·ç¡®è®¤

cp -p

å¤åˆ¶æ—¶ä¿æŒæºæ–‡ä»¶çš„æƒé™ã€å±ä¸»ä»¥åŠæ—¶é—´æ ‡è®°ç­‰å±æ€§ä¸å˜

cp -r

å¤åˆ¶ç›®å½•æ—¶å¿…é¡»ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œè¡¨ç¤ºé€’å½’å¤åˆ¶æ‰€æœ‰æ–‡ä»¶åŠå­ç›®å½•

#### rm

*   åˆ é™¤æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•

æŒ‡ä»¤

æè¿°

rm -i

rm -rf

é»˜è®¤å…¨éƒ¨åŒæ„é€’å½’åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•

#### mv

*   å°†æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•è½¬ç§»ä½ç½®
*   å¦‚æœç›®æ ‡ä½ç½®ä¸æºä½ç½®ç›¸åŒï¼Œåˆ™ç›¸å½“äºæ‰§è¡Œé‡å‘½åæ“ä½œ

> mv 123 1234 // è¿™æ˜¯é‡å‘½å
> 
> mv /root/123.txt /home/mpy // è¿™æ˜¯ç§»åŠ¨

### æŸ¥æ‰¾ç›®å½•å’Œæ–‡ä»¶

#### which

*   æŸ¥æ‰¾å¯æ‰§è¡Œå‘½ä»¤çš„åœ¨å“ªé‡Œ
    
*   æœç´¢èŒƒå›´ç”±ç¯å¢ƒå˜é‡PATHå†³å®š\[echo $PATH\]
    

> which å‘½ä»¤æˆ–ç¨‹åºå
> 
> which -a å‘½ä»¤æˆ–ç¨‹åº
> 
> which ls
> 
> which cd

#### find

*   åŸºäºæŸäº›æ¡ä»¶æŸ¥æ‰¾ä¸€äº›æ–‡ä»¶
    
*   é‡‡ç”¨é€’å½’æ–¹å¼ï¼Œæ ¹æ®ç›®æ ‡çš„åç§°ã€ç±»å‹ã€å¤§å°ç­‰ä¸åŒå±æ€§è¿›è¡Œç²¾ç»†æŸ¥æ‰¾
    

æŸ¥æ‰¾ç±»å‹

å…³é”®å­—

æè¿°

æŒ‰åç§°æŸ¥æ‰¾

\-name

æ ¹æ®ç›®æ ‡æ–‡ä»¶çš„åç§°è¿›è¡ŒæŸ¥æ‰¾ï¼Œå…è®¸ä½¿ç”¨"\*"åŠ"?"é€šé…ç¬¦

æŒ‰æ–‡ä»¶å¤§å°æŸ¥æ‰¾

\-size

æ ¹æ®ç›®æ ‡æ–‡ä»¶çš„å¤§å°è¿›è¡ŒæŸ¥æ‰¾  
ä¸€èˆ¬ä½¿ç”¨"+"ã€"-"å·è®¾ç½®è¶…è¿‡æˆ–å°äºæŒ‡å®šçš„å¤§å°ä½œä¸ºæŸ¥æ‰¾æ¡ä»¶  
å¸¸ç”¨çš„å®¹é‡å•ä½åŒ…æ‹¬kB\[æ³¨æ„kæ˜¯å°å†™\]ã€MBã€GB

æŒ‰æ–‡ä»¶å±ä¸»æŸ¥æ‰¾

\-user

æ ¹æ®æ–‡ä»¶æ˜¯å¦å±äºç›®æ ‡ç”¨æˆ·è¿›è¡ŒæŸ¥æ‰¾

æŒ‰æ–‡ä»¶ç±»å‹æŸ¥æ‰¾

\-type

æ ¹æ®æ–‡ä»¶çš„ç±»å‹è¿›è¡ŒæŸ¥æ‰¾  
é—®ä»·ç±»å‹åŒ…æ‹¬æ™®é€šæ–‡ä»¶\[f\]ã€ç›®å½•\[d\]ã€é“¾æ¥æ–‡ä»¶\[l\]ã€å—è®¾å¤‡æ–‡ä»¶\[b\]ã€å­—ç¬¦è®¾å¤‡æ–‡ä»¶\[c\]ç­‰  
å—è®¾å¤‡æ˜¯æŒ‡æˆå—è¯»å–æ•°æ®çš„è®¾å¤‡\[ç¡¬ç›˜ã€å†…å­˜ç­‰\]  
å­—ç¬¦è®¾å¤‡æ˜¯æŒ‡æŒ‰å•ä¸ªå­—ç¬¦è¯»å–æ•°æ®çš„è®¾å¤‡\[é”®ç›˜ã€é¼ æ ‡ç­‰\]

é€»è¾‘è¿ç®—ç¬¦

æè¿°

\-a

è¡¨ç¤ºä¸”and

\-o

è¡¨ç¤ºæˆ–or

> find æŸ¥æ‰¾èŒƒå›´ -name æŸ¥æ‰¾çš„æ–‡ä»¶å
> 
> find / -name 123.txt
> 
> find / -size +1024k -a -name log.txt

æ–‡ä»¶ç®¡ç†
----

### æŸ¥çœ‹å’Œæ£€ç´¢æ–‡ä»¶

#### cat

*   æ˜¾ç¤ºå‡ºæ–‡ä»¶çš„å†…å®¹

æŒ‡ä»¤

æè¿°

cat -n

æ˜¾ç¤ºå†…å®¹è¡Œå·

cat -b

æ˜¾ç¤ºå†…å®¹è¡Œå·ï¼Œä½†æ˜¯ä¸ç°å®ç©ºè¡Œ

#### more

*   å…¨å±åˆ†é¡µæ˜¾ç¤ºæ–‡ä»¶å†…å®¹
    *   æŒ‰enterå‘ä¸‹é€è¡Œæ»šåŠ¨
    *   æŒ‰ç©ºæ ¼å‘ä¸‹ç¿»ä¸€å±
    *   æŒ‰qé€€å‡º

#### less

*   å’Œmoreä¸€æ ·ï¼Œä½†æ‰©å±•åŠŸèƒ½æ›´å¤š
    *   page upå‘ä¸Šç¿»é¡µï¼Œpage downå‘ä¸‹ç¿»é¡µ
    *   æŒ‰ / æŸ¥æ‰¾å†…å®¹ï¼Œnä¸‹ä¸€ä¸ªå†…å®¹ï¼ŒNä¸Šä¸€ä¸ªå†…å®¹
    *   å…¶ä»–åŠŸèƒ½å’Œmoreç±»ä¼¼

#### head

*   æŸ¥çœ‹æ–‡ä»¶çš„å¤´å‡ è¡Œ\[é»˜è®¤10è¡Œ\]

æŒ‡ä»¤

æè¿°

head -n

nä»£è¡¨æŒ‡å®šçš„è¡Œæ•°

> head -10 /etc/1.txt // æŸ¥çœ‹1.txtçš„å‰10è¡Œ

#### tail

*   æŸ¥çœ‹æ–‡ä»¶ç»“å°¾çš„å°‘éƒ¨åˆ†å†…å®¹\[é»˜è®¤10è¡Œ\]

æŒ‡ä»¤

æè¿°

tail -n

nä»£è¡¨æŒ‡å®šçš„è¡Œæ•°

tail -f

åŠ¨æ€ç›‘æµ‹æ–‡ä»¶æœ«è¡Œå†…å®¹

> tail -10 /etc/1.txt // æŸ¥çœ‹1.txtçš„æœ€å10è¡Œ

#### wc

*   ç»Ÿè®¡æ–‡ä»¶ä¸­å•è¯æ•°é‡ç­‰ä¿¡æ¯

æŒ‡ä»¤

è¯´æ˜

wc -l

ç»Ÿè®¡è¡Œæ•°

wc -w

ç»Ÿè®¡å•è¯ä¸ªæ•°

wc -c

ç»Ÿè®¡å­—èŠ‚æ•°

#### grep

*   åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾å¹¶æ˜¾ç¤ºåŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„è¡Œ

å‚æ•°

æè¿°

\-i

æŸ¥æ‰¾æ—¶ä¼šå¿½ç•¥å¤§å°å†™

\-v

åè½¬æŸ¥æ‰¾ï¼Œè¾“å‡ºä¸æŸ¥æ‰¾æ¡ä»¶ä¸ç›¸ç¬¦çš„è¡Œ

æŸ¥æ‰¾æ¡ä»¶è®¾ç½®

*   è¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²è¦ç”¨å¼•å·åŒ…è£¹
*   `^`è¡¨ç¤ºå¼€å¤´ï¼Œ`$`è¡¨ç¤ºç»“æ„ï¼Œ`^$`è¡¨ç¤ºç©ºè¡Œ

#### xargs

> find / -name hosts | xargs -I {} å‘½ä»¤ {}
> 
> å°†æ°é¢æŸ¥æ‰¾çš„ç»“æœæ”¾å¤§åé¢æ‰§è¡Œï¼Œxargsä¼šæŠŠæ‰§è¡Œç»“æœä¿å­˜åˆ°{}ï¼Œä¹‹ååœ¨é€šè¿‡åé¢çš„æŒ‡ä»¤å¯¹{}ä¸­çš„å†…å®¹è¿›è¡Œå¤„ç†
> 
> find / -name hosts | xargs -I {} cp {} / // é€šè¿‡findæŸ¥æ‰¾hostsï¼Œä¹‹åæŠŠhostså¤åˆ¶åˆ°æ ¹ç›®å½•ä¸‹

### å¤‡ä»½å’Œæ¢å¤æ–‡æ¡£

#### gzip

*   å‹ç¼©æ–‡ä»¶

> gzip 1.txt // ç›´æ¥ç”Ÿæˆ1.txt.gz

#### bzip2

*   å‹ç¼©æ–‡ä»¶

> bzip2 1.txt // ç›´æ¥ç”Ÿæˆ1.txt.bz2

#### gunzip

*   è§£å‹æ–‡ä»¶\[ç­‰åŒäº gzip -d\]

> gunzip 1.txt.gz // è§£å‹æ–‡ä»¶

#### bunzip2

*   è§£å‹æ–‡ä»¶\[ç­‰åŒäºbzip2 -d\]

> bunzip2 1.txt.bz2 // è§£å‹æ–‡ä»¶

#### tar

*   åˆ¶ä½œå½’æ¡£æ–‡ä»¶ã€é‡Šæ”¾å½’æ¡£æ–‡ä»¶

å‚æ•°

æè¿°

\-c

åˆ›å»º.taræ ¼å¼çš„åŒ…æ–‡ä»¶

\-x

è§£å¼€.taræ ¼å¼çš„åŒ…æ–‡ä»¶

\-v

è¾“å‡ºè¯¦ç»†ä¿¡æ¯

\-f

è¡¨ç¤ºä½¿ç”¨å½’æ¡£æ–‡ä»¶

\-p

æ‰“åŒ…æ—¶ä¿ç•™åŸå§‹æ–‡ä»¶åŠç›®å½•çš„æƒé™

\-t

åˆ—è¡¨æŸ¥çœ‹åŒ…å†…çš„æ–‡ä»¶

\-C

æ·è±¹æ—¶æŒ‡å®šé‡Šæ”¾çš„ç›®æ ‡æ–‡ä»¶å¤¹

\-z

è°ƒç”¨gzipç¨‹åºè¿›è¡Œå‹ç¼©æˆ–è§£å‹

\-j

è°ƒç”¨bzip2ç¨‹åºè¿›è¡Œå‹ç¼©æˆ–è§£å‹

> tar -zcvf æ–‡ä»¶æˆ–ç›®å½• // å‹ç¼©æ–‡ä»¶
> 
> tar -zxvf .taræ–‡ä»¶ // è§£å‹æ–‡ä»¶

### viä½¿ç”¨

#### ä¸‰ç§å·¥ä½œæ¨¡å¼

å‘½ä»¤æ¨¡å¼ --è¾“å…¥aã€iã€o--> è¿›å…¥è¾“å…¥æ¨¡å¼ --æŒ‰esc-->å‘½ä»¤æ¨¡å¼ --è¾“å…¥`:`\-->è¿›å…¥æœ«è¡Œæ¨¡å¼

#### è¾“å…¥æ¨¡å¼

*   `a` : å½“å‰å…‰æ ‡çš„ä¸‹ä¸€è¡Œä½ç½®æ’å…¥
*   `i` : å½“å‰å…‰æ ‡ä½ç½®æ’å…¥
*   `o` : ä¸‹ä¸€è¡Œçš„é¦–ä½ç½®æ’å…¥

#### å‘½ä»¤æ¨¡å¼

å…‰æ ‡æ“ä½œ

æ“ä½œ

æè¿°

:set nu

æ˜¾ç¤ºè¡Œå·

:set nonu

ä¸æ˜¾ç¤ºè¡Œå·

#G

è·³è½¬åˆ°ç¬¬å‡ è¡Œ\[#ä»£è¡¨è¡Œå·\]

G

è·³è½¬åˆ°æ–‡ä»¶çš„è¡Œå°¾

gg

è·³è½¬åˆ°æ–‡ä»¶çš„è¡Œé¦–

åˆ é™¤æ“ä½œ

æ“ä½œ

æè¿°

xæˆ–Del

åˆ é™¤å…‰æ ‡å¤„çš„å•ä¸ªå­—ç¬¦

dd

åˆ é™¤å½“å‰å…‰æ ‡æ‰€åœ¨è¡Œ

#dd

åˆ é™¤ä»å…‰æ ‡å¤„å¼€å§‹çš„#è¡Œå†…å®¹

d^

åˆ é™¤å½“å‰å…‰æ ‡ä¹‹å‰åˆ°è¡Œé¦–çš„æ‰€æœ‰å­—ç¬¦

d$

åˆ é™¤å½“å‰å…‰æ ‡ä¹‹ååˆ°è¡Œå°¾çš„æ‰€æœ‰å­—ç¬¦

å¤åˆ¶æ“ä½œ

æ“ä½œ

æè¿°

yy

å¤å½“å‰æ•´è¡Œçš„å†…å®¹åˆ°å‰ªè´´æ¿

#yy

å¤åˆ¶ä»å…‰æ ‡å¤„å¼€å§‹å¤åˆ¶#è¡Œå†…å®¹\[ä»å…‰æ ‡å¤„å¼€å§‹å¾€ä¸‹æ•°#è¡Œï¼Œä¸€èµ·å¤åˆ¶\]

ç²˜è´´æ“ä½œ

æ“ä½œ

æè¿°

P

å°†ç¼“å†²åŒºä¸­çš„å†…å®¹ç²˜è´´åˆ°å…‰æ ‡ä½ç½®å¤„ä¹‹å

p

ç²˜è´´åˆ°å…‰æ ‡ä½ç½®å¤„ä¹‹å‰

æ–‡ä»¶å†…å®¹æŸ¥æ‰¾

æ“ä½œ

æè¿°

/word

ä»ä¸Šè€Œä¸‹åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²word

?word

ä»ä¸‹è€Œä¸Šåœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²word

n

å®šä½ä¸‹ä¸€ä¸ªåŒ¹é…åˆ°çš„å­—ç¬¦ä¸²

N

å®šä½ä¸Šä¸€ä¸ªåŒ¹é…åˆ°çš„å­—ç¬¦ä¸²

æ’¤é”€ç¼–è¾‘

æ“ä½œ

æè¿°

u

æŒ‰ä¸€æ¬¡å–æ¶ˆæœ€è¿‘çš„æ“ä½œï¼Œæ”¯æŒå¤šæ¬¡é‡å¤æŒ‰uæ¢å¤åˆ°åŸæ¥çš„çŠ¶æ€

U

å–æ¶ˆå¯¹å½“å‰è¡Œæ‰€åšçš„æ‰€æœ‰ç¼–è¾‘

ZZ

ä¿å­˜å½“å‰æ–‡ä»¶å†…å®¹å¹¶é€€å‡º

#### æœ«è¡Œæ¨¡å¼

*   `:` : è¿›å…¥æœ«è¡Œæ¨¡å¼

ä¿å­˜é€€å‡º

æ“ä½œ

æè¿°

:w

ä¿å­˜ä¿®æ”¹çš„å†…å®¹

:w /root/newfile

å¦å­˜ä¸ºå…¶ä»–å†…å®¹

:q

æœªä¿®æ”¹é€€å‡º

:q!

æ”¾å¼ƒå¯¹æ–‡ä»¶çš„ä¿®æ”¹ç›´æ¥é€€å‡º

:wq

ä¿å­˜å¹¶é€€å‡º

ç¼–è¾‘å…¶ä»–æ–‡ä»¶

æ“ä½œ

æè¿°

:e å…¶ä»–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„

ä»ç¼–è¾‘å½“å‰æ–‡ä»¶åˆ‡æ¢åˆ°ç¼–è¾‘å…¶ä»–æ–‡ä»¶

:r å…¶ä»–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„

åœ¨å½“å‰æ–‡ä»¶ä¸­è¯»å–å…¶ä»–æ–‡ä»¶çš„å†…å®¹

:sp å…¶ä»–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„

åˆ†å±ç¼–è¾‘å¤šä¸ªæ–‡ä»¶

ctl+wåæŒ‰ä¸Šæˆ–ä¸‹

åˆ†å±ç¼–è¾‘ååˆ‡æ¢ç¼–è¾‘å¯¹è±¡

æŸ¥æ‰¾æ›¿æ¢

æ“ä½œ

æè¿°

ğŸ˜’/old/new

å°†å½“å‰è¡Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªoldå­—ç¬¦ä¸²æ›¿æ¢ä¸ºnewå­—ç¬¦ä¸²

ğŸ˜’/old/new/g

å°†å½“å‰è¡Œæ‰¾åˆ°çš„æ‰€æœ‰oldå­—ç¬¦ä¸²å…¨éƒ¨æ›¿æ¢newå­—ç¬¦ä¸²

:#,#s/old/new/g

åœ¨è¡Œå·"#åˆ°#"èŒƒå›´å†…æŸ¥æ‰¾oldå­—ç¬¦ä¸²ï¼Œå…¨éƒ¨æ›¿æ¢ä¸ºnewå­—ç¬¦ä¸²

:%s/old/new/g

å°†æ•´ä¸ªæ–‡ä»¶ä¸­çš„oldå­—ç¬¦ä¸²å…¨éƒ¨æ›¿æ¢ä¸ºnewå­—ç¬¦ä¸²

ğŸ˜’/old/new/c

å¯¹æ¯ä¸ªæ›¿æ¢åŠ¨ä½œè¿›è¡Œæç¤ºç¡®è®¤

linuxè½¯ä»¶å®‰è£…
=========

linuxåº”ç”¨ç¨‹åºåŸºç¡€
-----------

### linuxå‘½ä»¤ä¸ç¨‹åºå…³ç³»

1.  æ–‡ä»¶ä½ç½®
    
    1.  ç³»ç»Ÿå‘½ä»¤
        
        > ä¸€èˆ¬åœ¨/binå’Œ/sbinç›®å½•ä¸­ï¼Œæˆ–ä¸ºshellå†…éƒ¨æŒ‡ä»¤
        
    2.  åº”ç”¨ç¨‹åº
        
        > é€šå¸¸åœ¨/usr/binå’Œ/usr/sbinç›®å½•ä¸­
        
2.  ä¸»è¦ç”¨é€”
    
    1.  ç³»ç»Ÿå‘½ä»¤
        
        > å®Œæˆå¯¹ç³»ç»Ÿçš„åŸºæœ¬ç®¡ç†å·¥ä½œï¼Œä¾‹å¦‚IPé…ç½®å·¥å…·
        
    2.  åº”ç”¨ç¨‹åº
        
        > å®Œæˆç›¸å¯¹ç‹¬ç«‹çš„å…¶ä»–è¾…åŠ©ä»»åŠ¡ï¼Œä¾‹å¦‚ç½‘é¡µæµè§ˆå™¨
        
3.  é€‚ç”¨ç¯å¢ƒ
    
    1.  ç³»ç»Ÿå‘½ä»¤
        
        > ä¸€èˆ¬åªåœ¨å­—ç¬¦æ“ä½œç•Œé¢ä¸­è¿è¡Œ
        
    2.  åº”ç”¨ç¨‹åº
        
        > æ ¹æ®å®é™…éœ€è¦ï¼Œæœ‰äº›ç¨‹åºå¯åœ¨å›¾å½¢ç•Œé¢ä¸­è¿è¡Œ
        
4.  è¿è¡Œæ ¼å¼
    
    1.  ç³»ç»Ÿå‘½ä»¤
        
        > ä¸€èˆ¬åŒ…æ‹¬å‘½ä»¤å­—ã€å‘½ä»¤é€‰é¡¹å’Œå‘½ä»¤å‚æ•°
        
    2.  åº”ç”¨ç¨‹åº
        
        > é€šå¸¸æ²¡æœ‰å›ºå®šçš„æ‰§è¡Œæ ¼å¼
        

### linuxç›®å½•ç»“æ„

æ–‡ä»¶ç±»å‹

ä¿å­˜ç›®å½•

æ™®é€šæ‰§è¡Œç¨‹åºæ–‡ä»¶

/usr/bin

æœåŠ¡å™¨æ‰§è¡Œç¨‹åºæ–‡ä»¶å’Œç®¡ç†ç¨‹åºæ–‡ä»¶

/usr/sbin

åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶

/etc

æ—¥å¿—æ–‡ä»¶

/var/log

åº”ç”¨ç¨‹åºæ–‡æ¡£æ–‡ä»¶

/usr/share/doc

åº”ç”¨ç¨‹åºæ‰‹å†Œé¡µæ–‡ä»¶

/usr/share/man

### è½¯ä»¶åŒ…çš„å°è£…ç±»å‹

å°è£…ç±»å‹

è¯´æ˜

rpmè½¯ä»¶åŒ…

æ‰©å±•åä¸º`.rpm`

debè½¯ä»¶åŒ…

æ‰©å±•åä¸º`.deb`

æºä»£ç è½¯ä»¶åŒ…

ä¸€èˆ¬ä¸º`.tar.gz`ã€`.tar.bz2`ç­‰æ ¼å¼

é™„å¸¦å®‰è£…ç¨‹åºçš„è½¯ä»¶åŒ…

åœ¨å‹ç¼©åŒ…å†…æä¾›install.shã€setupç­‰å®‰è£…ç¨‹åºæˆ–ä»¥`.bin`æ ¼å¼çš„å•ä¸ªæ‰§è¡Œæ–‡ä»¶

ç»¿è‰²å…å®‰è£…çš„è½¯ä»¶åŒ…

åœ¨å‹ç¼©åŒ…å†…æä¾›å·²ç»ç¼–è¯‘å·çš„æ‰§è¡Œç¨‹åºæ–‡ä»¶ï¼Œè§£å‹åæ‰“å¼€æ–‡ä»¶å¤¹å¯ç›´æ¥ä½¿ç”¨

ä½¿ç”¨RPMåŒ…ç®¡ç†å·¥å…·
----------

### RPMæ¦‚å¿µ

*   RPM Pakcage Manager

1.  ç”±Red Hatå…¬å¸æå‡ºï¼Œè¢«ä¼—å¤šlinuxå‘è¡Œç‰ˆæ‰€é‡‡ç”¨
2.  å»ºç«‹åŒæ„çš„æ•°æ®åº“æ–‡ä»¶
3.  è¯¦ç»†è®°å½•è½¯ä»¶åŒ…çš„å®‰è£…ã€å¸è½½ç­‰å˜åŒ–ä¿¡æ¯
4.  è‡ªåŠ¨åˆ†æè½¯ä»¶åŒ…ä¾èµ–å…³ç³»

*   ä¸€èˆ¬å‘½åæ ¼å¼

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214417080-313907322.png)

### rpmç®¡ç†å‘½ä»¤

> main rpm

*   æŸ¥è¯¢ã€éªŒè¯RPMè½¯ä»¶åŒ…ä¿¡æ¯
*   ç»´æŠ¤RPMæ•°æ®åº“ä¿¡æ¯
*   å®‰è£…ã€å‡çº§ã€å¸è½½RPMè½¯ä»¶åŒ…

æŸ¥è¯¢å·²å®‰è£…çš„RPMè½¯ä»¶åŒ…ä¿¡æ¯

å‚æ•°

æè¿°

\-qa

æŸ¥çœ‹ç³»ç»Ÿä¸­å·²å®‰è£…çš„æ‰€æœ‰RPMè½¯ä»¶åŒ…åˆ—è¡¨

\-qi

æŸ¥çœ‹æŒ‡å®šè½¯ä»¶çš„è¯¦ç»†ä¿¡æ¯

\-ql

æŸ¥è¯¢æŒ‡å®šè½¯ä»¶åŒ…æ‰€å®‰è£…çš„ç›®å½•ã€æ–‡ä»¶åˆ—è¡¨

\-qc

ä»…æ˜¾ç¤ºæŒ‡å®šè½¯ä»¶åŒ…å®‰è£…çš„é…ç½®æ–‡ä»¶

\-qd

ä»…æ˜¾ç¤ºæŒ‡å®šè½¯ä»¶åŒ…å®‰è£…çš„æ–‡æ¡£æ–‡ä»¶

\-qf

æŸ¥çœ‹ç¨‹åºæ˜¯ç”±å“ªä¸ªè½¯ä»¶åŒ…æä¾›çš„\[å¯ä»¥é…åˆwhichå‘½ä»¤\]

æŸ¥è¯¢æœªå®‰è£…çš„RPMè½¯ä»¶åŒ…ä¿¡æ¯

å‚æ•°

æè¿°

\-qpi

æŸ¥çœ‹.rpmå®‰è£…åŒ…æ–‡ä»¶æŸ¥çœ‹è¯¥è½¯ä»¶çš„è¯¦ç»†ä¿¡æ¯

\-qpl

æŸ¥çœ‹.rpmå®‰è£…åŒ…å†…æ‰€åŒ…å«çš„ç›®å½•ã€æ–‡ä»¶åˆ—è¡¨

\-qpc

æŸ¥çœ‹.rpmå®‰è£…åŒ…å†…æ‰€åŒ…å«çš„é…ç½®æ–‡ä»¶åˆ—è¡¨

\-qpd

æŸ¥çœ‹.rpmå®‰è£…åŒ…å†…åŒ…å«çš„æ–‡æ¡£æ–‡ä»¶åˆ—è¡¨

å®‰è£…å’Œå¸è½½RPMè½¯ä»¶åŒ…

å‚æ•°

æè¿°

\-i

å®‰è£…ä¸€ä¸ªæ–°çš„rpmè½¯ä»¶åŒ…

\-U

å‡çº§æŸä¸ªrpmè½¯ä»¶ï¼Œè‹¥åŸæœ¬æœªè£…ï¼Œåˆ™è¿›è¡Œå®‰è£…

\-F

æ›´æ–°æŸä¸ªrpmè½¯ä»¶ï¼Œè‹¥åŸæœ¬æœªè£…ï¼Œåˆ™æ”¾å¼ƒå®‰è£…

\-e

å¸è½½æŒ‡å®šçš„RPMè½¯ä»¶

å…¶ä»–é€‰é¡¹

å‚æ•°

æè¿°

\-h

ä»¥`#`å½¢å¼æ˜¾ç¤ºå®‰è£…è¿›åº¦å»ºç«‹ç»Ÿä¸€çš„æ•°æ®åº“æ–‡ä»¶

\-v

æ˜¾ç¤ºå®‰è£…è¿‡ç¨‹ä¸­çš„è¯¦ç»†ä¿¡æ¯

\--nodeps

å¿½ç•¥ä¾èµ–å…³ç³»ï¼Œä½†å¯èƒ½å¯¼è‡´è½¯ä»¶å¼‚å¸¸

é‡å»ºRPMæ•°æ®åº“

æŒ‡ä»¤

rpm --rebuilddb

rpm -initdb

å¯¼å…¥éªŒè¯å…¬é’¥

æŒ‡ä»¤

rpm --import /media/cdrom/RPM-GPG-KEY-redhat-release

ä»æºä»£ç ç¼–è¯‘å®‰è£…ç¨‹åº
----------

### ç¼–è¯‘å®‰è£…è¿‡ç¨‹

1.  è§£åŒ…
    
    > tar -zxvf è½¯ä»¶åŒ… æƒ³è¦è§£å‹çš„è·¯å¾„
    
2.  é…ç½®
    
    > cd è§£å‹çš„è·¯å¾„
    > 
    > ./configure --prefix=å®‰è£…è·¯å¾„\[/usr/local/\]
    
3.  ç¿»è¯‘
    
    > makeå‘½ä»¤
    
4.  å®‰è£…
    
    > make install
    

linuxè´¦æˆ·ä¸æƒé™
==========

ç®¡ç†ç”¨æˆ·å’Œç»„è´¦å·
--------

### ç”¨æˆ·å’Œç»„

*   ç”¨æˆ·è´¦å·
    1.  è¶…çº§ç”¨æˆ·
    2.  æ™®é€šç”¨æˆ·
    3.  ç¨‹åºç”¨æˆ·
*   ç»„è´¦å·
    1.  åŸºæœ¬ç»„\[ç§æœ‰ç»„\]
    2.  é™„åŠ ç»„\[å…¬å…±ç»„\]
*   UIDå’ŒGID
    1.  UID\[ç”¨æˆ·æ ‡è¯†ç¬¦\]
    2.  GID\[ç»„æ ‡è¯†ç¬¦\]

### ç”¨æˆ·ç®¡ç†

ä¿å­˜ç”¨æˆ·åç§°ã€å±ä¸»ç›®å½•ã€ç™»é™†shellç­‰åŸºæœ¬ä¿¡æ¯çš„æ–‡ä»¶ä½ç½®`/etc/passwd`ï¼Œæ²¡ä¸€è¡Œå¯¹åº”ä¸€ä¸ªç”¨æˆ·çš„è´¦å·è®°å½•

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214434973-83788574.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214444886-1784561003.png)

ä¿å­˜ç”¨æˆ·å¯†ç `/etc/shadow`ï¼Œæ¯ä¸€è¡Œå¯¹åº”ä¸€ä¸ªç”¨æˆ·çš„å¯†ç \[æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå†…å®¹åŒ…å«ä¹ä¸ªç”¨`:`éš”å¼€çš„é…ç½®å­—æ®µ\]

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214457739-2138236536.png)

#### useradd

*   æ·»åŠ ç”¨æˆ·

å‚æ•°

æè¿°

\-u

æŒ‡å®šUIDæ ‡è®°å·

\-d

æŒ‡å®šå®¿ä¸»ç›®å½•ï¼Œä¸æŒ‡å®šé»˜è®¤/home/ç”¨æˆ·å

\-e

æŒ‡å®šè´¦å·å¤±æ•ˆæ—¶é—´

\-g

æŒ‡å®šç”¨æˆ·çš„åŸºæœ¬ç»„å\[UIDå·\]

\-G

æŒ‡å®šç”¨æˆ·çš„é™„åŠ ç»„å\[GIDå·\]

\-M

ä¸ä¸ºç”¨æˆ·å»ºç«‹å¹¶åˆå§‹åŒ–å®¿ä¸»ç›®å½•

\-s

æŒ‡å®šç”¨æˆ·çš„ç™»é™†shell

æ–‡ä»¶æ¥æº

*   æ–°å»ºç”¨æˆ·è´¦å·æ—¶ï¼Œä»`/etc/skel`ç›®å½•ä¸­å¤åˆ¶è€Œæ¥\[ä¹Ÿå°±æ˜¯å¦‚æœæƒ³è¦ç»™æ¯ä¸ªç”¨æˆ·åˆå§‹åŒ–æ–‡ä»¶æ—¶ï¼Œå¯ä»¥å¾€è¿™é‡Œæ·»åŠ \]

ä¸»è¦çš„ç”¨æˆ·åˆå§‹é…ç½®æ–‡ä»¶

> .bash\_profile : ç”¨æˆ·æ¯æ¬¡ç™»å½•æ—¶æ‰§è¡Œ
> 
> .bashrc : æ¯æ¬¡è¿›å…¥æ–°çš„bashç¯å¢ƒæ—¶æ‰§è¡Œ
> 
> .bash\_logout : ç”¨æˆ·æ¯æ¬¡é€€å‡ºç™»å½•æ—¶æ‰§è¡Œ

#### passwd

*   ä¿®æ”¹å¯†ç 

å‚æ•°

æè¿°

\-d

æ¸…ç©ºç”¨æˆ·çš„å¯†ç ï¼Œä½¿ä¹‹æ— éœ€å¯†ç å³å¯ç™»é™†

\-l

é”å®šç”¨æˆ·è´¦å·

\-S

æŸ¥çœ‹ç”¨æˆ·çŠ¶æ€

\-u

è§£é”ç”¨æˆ·è´¦å·

#### usermod

*   ä¿®æ”¹è´¦å·å±æ€§

å‚æ•°

æè¿°

\-l

æ›´æ”¹ç”¨æˆ·è´¦å·ç™»é™†çŠ¶æ€

\-L

é”å®šç”¨æˆ·çŠ¶æ€

\-U

è§£é”ç”¨æˆ·çŠ¶æ€

> \-uã€-dã€-eã€-gã€-Gã€-sä¸useraddå‘½ä»¤å«ä¹‰ç›¸åŒ

*   ç»™ç”¨æˆ·æ¬å®¶

1.  ä½¿ç”¨usermodæ¬å®¶
    
    > usermod -d /test/test1 test1
    
2.  ä½¿ç”¨mvæ¬å®¶
    
    > mv /home/test1 /test/
    

#### userdel

*   åˆ é™¤ç”¨æˆ·è´¦å·

å‚æ•°

æè¿°

\-r

è¡¨ç¤ºè¿å®¿ä¸»çš„å®¶ç›®å½•ä¸€èµ·åˆ æ‰

### ç»„è´¦å·ç®¡ç†

ä¿å­˜ç»„è´¦å·åŸºæœ¬ä¿¡æ¯`/etc/group`

ä¿å­˜ç»„è´¦å·çš„å¯†ç ä¿¡æ¯`/etc/gshadow`

tail -5 /etc/group

    [root@localhost ~]# tail -5 /etc/group
    docker:x:982:
    admin:x:1001:
    wazuh:x:981:wazuh
    test1:x:1002:
    test2:x:1003:
    

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214512800-970497743.png)

#### groupadd

*   å•ç‹¬æ·»åŠ ç»„è´¦å·

å‚æ•°

æè¿°

\-g

æŒ‡å®šç»„çš„GID

#### gpasswd

*   è®¾ç½®ç»„è´¦å·çš„å¯†ç \[æå°‘ç”¨\]ã€æ·»åŠ åˆ é™¤ç»„ç”¨æˆ·

å‚æ•°

æè¿°

\-a

å‘ç»„æ·»åŠ ä¸€ä¸ªç”¨æˆ·

\-d

ä»ç»„å†…åˆ é™¤ä¸€ä¸ªç”¨æˆ·

\-M

åˆ·æ–°ç»„æˆå‘˜åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”

#### groupdel

*   åˆ é™¤ç»„åï¼Œç»„æˆå‘˜é™¤æƒé™å¤–ï¼Œä¸å—å½±å“

### ç»„è´¦å·æŸ¥è¯¢

#### id

*   æŸ¥è¯¢ç”¨æˆ·æ ‡è¯†

#### groups

*   æŸ¥è¯¢ç”¨æˆ·æ‰€å±ç»„

#### finger

*   æŸ¥è¯¢ç”¨æˆ·è´¦å·çš„è¯¦ç»†ä¿¡æ¯

#### wã€whoã€users

*   æŸ¥è¯¢å·²ç™»é™†åˆ°ä¸»æœºçš„ç”¨æˆ·ä¿¡æ¯

ç®¡ç†ç›®å½•å’Œæ–‡ä»¶å±æ€§
---------

### ç›®å½•å’Œæ–‡ä»¶å±æ€§

è®¿é—®æƒé™

*   è¯»å–\[r\] : å…è®¸æŸ¥çœ‹æ–‡ä»¶å†…å®¹ã€æ˜¾ç¤ºç›®å½•åˆ—è¡¨
*   å†™å…¥\[w\] : å…è®¸ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œå…è®¸åœ¨ç›®å½•ä¸­æ–°å»ºã€ç§»åŠ¨ã€åˆ é™¤æ–‡ä»¶æˆ–è€…å­ç›®å½•
*   å¯æ‰§è¡Œ\[x\] : å…è®¸è¿è¡Œç¨‹åºã€åˆ‡æ¢ç›®å½•

å½’å±\[æ‰€æœ‰æƒ\]

*   å±ä¸» : æ‹¥æœ‰è¯¥æ–‡ä»¶æˆ–è€…ç›®å½•çš„ç”¨æˆ·è´¦å·
*   å±ç»„ : æ‹¥æœ‰è¯¥æ–‡ä»¶æˆ–è€…ç›®å½•çš„ç»„è´¦å·

    [root@localhost mpy]# ll
    drwxr-xr-x.  2 mpy  mpy        6 Dec 31  2021 ä¸‹è½½
    drwxr-xr-x.  2 mpy  mpy        6 Dec 31  2021 å…¬å…±
    drwxr-xr-x.  2 mpy  mpy        6 Dec 31  2021 å›¾ç‰‡
    drwxr-xr-x.  2 mpy  mpy        6 Dec 31  2021 æ–‡æ¡£
    drwxr-xr-x.  2 mpy  mpy        6 Dec 31  2021 æ¡Œé¢
    drwxr-xr-x.  2 mpy  mpy        6 Dec 31  2021 æ¨¡æ¿
    drwxr-xr-x.  2 mpy  mpy        6 Dec 31  2021 è§†é¢‘
    drwxr-xr-x.  2 mpy  mpy        6 Dec 31  2021 éŸ³ä¹
    

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214525607-559886947.png)

#### chmod

*   ä¿®æ”¹æ–‡ä»¶ã€ç›®å½•æƒé™

å‚æ•°

æè¿°

\-R

é€’å½’ä¿®æ”¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ç›®å½•æƒé™

u/g/o/a

åˆ†åˆ«å¯¹åº”å±ä¸»ã€å±ç»„ã€å…¶ä»–ã€æ‰€æœ‰ç”¨æˆ·

+/-/=

åˆ†åˆ«æ˜¯æ·»åŠ ã€åˆ é™¤ã€åˆ·æ–°æƒé™

r/w/x

åˆ†åˆ«å¯¹åº”è¯»\[4\]ã€å†™\[2\]ã€æ‰§è¡Œ\[1\]

> chmod u+x /root/install.log

> chmod ug-r /root/install.log

> chmod ug=wr /root/install.log

> chmod 744 /root/install.log

#### chown

*   ä¿®æ”¹æ‰€æœ‰è€…

å‚æ•°

æè¿°

\-R

é€’å½’ä¿®æ”¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ç›®å½•å½’å±

> chown å±ä¸» æ–‡ä»¶æˆ–ç›®å½•
> 
> chown :å±ç»„ æ–‡ä»¶æˆ–ç›®å½•
> 
> chown å±ä¸»:å±ç»„ æ–‡ä»¶æˆ–ç›®å½•

### æ–‡ä»¶åº•å±‚å±æ€§

*   æƒé™æ§åˆ¶ä¹‹ä¸Šçš„å¯¹è±¡åº•å±‚å±æ€§

#### lsattr

*   æŸ¥çœ‹åº•å±‚æƒé™å±æ€§\[-ä»£è¡¨æ¬¡æ§åˆ¶ä½æ²¡æœ‰é™„åŠ ä»»ä½•åº•å±‚å±æ€§\]

    [root@localhost mpy]# lsattr /etc/passwd
    ---------------- /etc/passwd
    

#### chattr

*   ä¿®æ”¹åº•å±‚æƒé™å±æ€§

å‚æ•°

æè¿°

+/-/=

å’Œchmodä¸€æ ·çš„ç”¨æ³•

i

å…¨é”

a

ä¿®æ”¹é”

i : å…¨é”

*   ç›®å½• : å¯ä¿®æ”¹å·²æœ‰å­å¯¹è±¡ï¼Œä¸å¯å»ºç«‹åˆ é™¤å­å¯¹è±¡
*   æ–‡ä»¶ : ä¸å¯åˆ é™¤ã€æ”¹åã€è¿½åŠ ã€ä¿®æ”¹

> chattr +i /etc/passwd
> 
> chattr +i /etc/shadow
> 
> ä¹‹åæƒ³è¦æ·»åŠ æˆ–è€…ä¿®æ”¹æ•°æ®éƒ½æ— æ³•æ‰§è¡Œï¼Œæœ‰æƒé™ä¹Ÿæ— æ³•æ‰§è¡Œ

a : ä¿®æ”¹é”

*   ç›®å½• : å¯ä»¥å»ºç«‹ä¿®æ”¹å­å¯¹è±¡ï¼Œä¸å¯ä»¥åˆ é™¤å­å¯¹è±¡
*   æ–‡ä»¶ : å¯ä»¥è¿½åŠ å†…å®¹ï¼Œä¸å¯ä»¥ä¿®æ”¹åˆ é™¤\[å¤šç”¨äºæ—¥å¿—\]

> chattr +a /var/log/messages
> 
> ä¹‹ååªèƒ½è¿½åŠ æ•°æ®ï¼Œæ— æ³•åˆ é™¤å’Œä¿®æ”¹

### é™„åŠ æƒé™SETä½

SETä½æƒé™\[å¯ä»¥è®©æ™®é€šç”¨æˆ·æ‰§è¡Œæ–‡ä»¶æ—¶å¾—åˆ°æœ€é«˜æƒé™\]

*   ä¸ºå¯æ‰§è¡Œçš„æ–‡ä»¶è®¾ç½®ï¼Œæƒé™å­—ç¬¦ä¸º's'
*   å…¶ä»–ç”¨æˆ·æ‰§è¡Œè¯¥æ–‡ä»¶æ—¶ï¼Œå°†æ‹¥æœ‰å±ä¸»æˆ–å±ç»„æƒé™

SETä½æƒé™ç±»å‹

*   Suid : å¯¹å±ä¸»ç”¨æˆ·å¢åŠ SETä½æƒé™
*   Sgid : å¯¹å±ç»„å†…çš„ç”¨æˆ·å¢åŠ SETä½æƒé™

    [root@localhost ~]# chmod u+s /sbin/ifconfig
    [root@localhost ~]# ll /sbin/ifconfig
    -rwsr-xr-x. 1 root root 81976 Aug  8  2019 /sbin/ifconfig
    

### ç²˜æ»ä½

è®©å¤šä¸ªç”¨æˆ·åœ¨åŒä¸€ä¸ªè®¾ç½®äº†å¼€æ”¾æƒé™çš„ç›®å½•ä¸­å¯ä»¥ä¿®æ”¹å±äºè‡ªå·±çš„æ–‡ä»¶

> åœ¨rootæƒé™ä¸‹è®¾ç½®`chmod o+t /demo`

*   åˆ›å»ºè´¦å·å…±äº«ç›®å½•

    [root@localhost /]# mkdir demo
    [root@localhost /]# chmod 777 demo
    

*   åˆ‡æ¢ç”¨æˆ·åˆ›å»ºç›®å½•

    [root@localhost /]# su test1
    bash-4.2$ cd /demo/
    bash-4.2$ mkdir test1
    bash-4.2$ exit
    
    [root@localhost /]# su test2
    [test2@localhost /]$ cd /demo
    [test2@localhost demo]$ mkdir test2
    [test2@localhost demo]$ ls
    test1  test2
    

*   åˆ‡æ¢ç›®å½•åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•

    [root@localhost /]# su test1
    bash-4.2$ ls
    1.txt  boot  dev  home  lib64  mnt  proc  run   srv  test  usr
    bin    demo  etc  lib   media  opt  root  sbin  sys  tmp   var
    bash-4.2$ cd demo/
    bash-4.2$ ls
    test1  test2
    bash-4.2$ rm -rf test2
    bash-4.2$ ls
    test1
    [root@localhost /]# su test2
    [test2@localhost /]$ cd demo/
    [test2@localhost demo]$ mkdir test2
    [test2@localhost demo]$ exit
    

*   è®¾ç½®ç²˜æ»ä½

    [root@localhost /]# chmod o+t /demo/
    [root@localhost /]# ll
    drwxrwxrwt    4 root root   32 Sep 30 02:30 demo
    

*   æ— æ³•åˆ é™¤

    [root@localhost /]# su test1
    bash-4.2$ cd /demo
    bash-4.2$ rm -rf test2
    rm: cannot remove â€˜test2â€™: Operation not permitted
    bash-4.2$ ls
    test1  test2
    bash-4.2$ exit
    exit
    
    [root@localhost /]# su test2
    [test2@localhost /]$ cd /demo
    [test2@localhost demo]$ rm -rf test1
    rm: cannot remove â€˜test1â€™: Operation not permitted
    

linuxç½‘ç»œé…ç½®
=========

æŸ¥çœ‹ç½‘ç»œ
----

### æŸ¥çœ‹ç½‘ç»œè®¾ç½®

#### ifconfig

*   æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£ä¿¡æ¯

> ifconfig
> 
> ifconfig ç½‘ç»œæ¥å£
> 
> ifconfig ens33

#### hostname

*   æŸ¥çœ‹ä¸»æœºå

> hostname

#### route

*   æŸ¥çœ‹æˆ–è®¾ç½®è·¯ç”±

> route \[-n\]

#### netstat

*   æŸ¥çœ‹ç³»ç»Ÿç½‘ç»œè¿æ¥çŠ¶æ€ã€è·¯ç”±è¡¨ã€æ¥å£ä¿¡æ¯ç­‰

å‚æ•°

æè¿°

\-a

æ˜¾ç¤ºæ‰€æœ‰

\-n

ä»¥æ•°å­—å½¢å¼æ˜¾ç¤º

\-p

ä»£ç«¯å£

\-t

tcpåè®®

\-u

udpåè®®

\-r

è·¯ç”±ä¿¡æ¯

> netstat -anpt // æ˜¾ç¤ºtcpç«¯å£
> 
> netstat -anpu // æ˜¾ç¤ºudpç«¯å£

### æµ‹è¯•ç½‘ç»œè¿æ¥

#### ping

*   æµ‹è¯•ç½‘ç»œè¿é€šæ€§

> ping \[é€‰é¡¹\] ç›®æ ‡ä¸»æœº

#### traceroute

*   æµ‹è¯•ä»å½“å‰ä¸»æœºåˆ°ç›®çš„çš„ä¸»æœºä¹‹é—´ç»è¿‡çš„ç½‘ç»œèŠ‚ç‚¹\[è·¯ç”±è·Ÿè¸ª\]

> traceroute ç›®æ ‡ä¸»æœºåœ°å€

#### nslookup

*   æµ‹è¯•DNSåŸŸåè§£æ

> nslookup ç›®æ ‡ä¸»æœºåœ°å€ \[DNSæœåŠ¡å™¨\]

è®¾ç½®ç½‘ç»œ
----

1.  ä¸´æ—¶é…ç½® - ä½¿ç”¨å‘½ä»¤è°ƒå¢ç½‘ç»œå‚æ•°
    
    *   ç®€å•ã€å¿«é€Ÿï¼Œå¯ç›´æ¥ä¿®æ”¹è¿è¡Œä¸­çš„ç½‘ç»œå‚æ•°
    *   ä¸€èˆ¬åªé€‚åˆåœ¨è°ƒè¯•ç½‘ç»œçš„è¿‡ç¨‹ä¸­ä½¿ç”¨
    *   ç³»ç»Ÿé‡å¯ä»¥åï¼Œæ‰€åšçš„ä¿®æ”¹å°†ä¼šå¤±æ•ˆ
2.  æ°¸ä¹…é…ç½® - é€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹ç½‘ç»œå‚æ•°
    
    *   ä¿®æ”¹å„é¡¹ç½‘ç»œå‚æ•°çš„é…ç½®æ–‡ä»¶
        
    *   é€‚åˆå¯¹æœåŠ¡å™¨è®¾ç½®å›ºå®šå‚æ•°æ—¶ä½¿ç”¨
        
    *   éœ€è¦é‡è½½ç½‘ç»œæœåŠ¡æˆ–è€…é‡å¯ä»¥åæ‰ä¼šç”Ÿæ•ˆ
        

### ä¸´æ—¶é…ç½®

#### ç½‘ç»œé…ç½®

1.  è®¾ç½®ç½‘ç»œæ¥å£çš„IPåœ°å€ã€å­ç½‘æ©ç 

> ifconfig æ¥å£å ipåœ°å€ \[netmask å­ç½‘æ©ç \]
> 
> ifconfig ç½‘ç»œæ¥å£ ipåœ°å€\[/æ©ç é•¿åº¦\]

2.  ç¦ç”¨æˆ–è€…é‡æ–°æ¿€æ´»ç½‘å¡

> ifconfig ç½‘ç»œæ¥å£ up
> 
> ifconfig ç½‘ç»œæ¥å£ down

3.  è®¾ç½®è™šæ‹Ÿç½‘ç»œæ¥å£

> ifocnfig æ¥å£å:åºå· ipåœ°å€
> 
> ifconfig ens1:1 10.1.1.1

#### è®¾ç½®è·¯ç”±

1.  æ·»åŠ åˆ°æŒ‡å®šç½‘æ®µçš„è·¯ç”±è®°å½•

> route add -net ç½‘æ®µåœ°å€ gw ipåœ°å€

2.  åˆ é™¤åˆ°æŒ‡å®šç½‘æ®µçš„è·¯ç”±è®°å½•

> route del -net ç½‘æ®µåœ°å€

3.  åˆ é™¤è·¯ç”±è¡¨ä¸­çš„é»˜è®¤ç½‘å…³è®°å½•

> route del default gw ipåœ°å€

4.  å‘è·¯ç”±è¡¨ä¸­æ·»åŠ é»˜è®¤ç½‘å…³è®°å½•

> route add default gw ipåœ°å€
> 
> route add default gw 192.168.1.1
> 
> route add -net 0.0.0.0 gw 192.168.1.1

#### ä¿®æ”¹ä¸»æœºå

> hostname ä¸»æœºå
> 
> hostname mpy
> 
> bash // åˆ·æ–°bashåç”Ÿæ•ˆï¼Œé‡å¯åå¤±æ•ˆ

### æ°¸ä¹…é…ç½®

#### ç½‘ç»œé…ç½®

ç½‘ç»œæ¥å£é…ç½®æ–‡ä»¶`/etc/sysconfig/network-scripts/ifcfg-ens33`\[ç¬¬ä¸€å—ä»¥å¤ªç½‘å¡çš„é…ç½®æ–‡ä»¶\]

    vim /etc/sysconfig/network-scripts/ifcfg-ens33
    // ä¿®æ”¹é…ç½®
    BOOTPROTO=dhcp // æ¢æˆstaticé™æ€è·å–
    UUID=c10e5d41-4157-4f3b-b6a0-41e58843f972 // å‰é¢åŠ ä¸Š'#'
    ONBOOT=no // æ”¹æˆyes
    // åŠ ä¸Šé…ç½®ä¿¡æ¯
    IPADDR=ipåœ°å€
    NETMASK=255.255.255.0
    GATEWAY=ç½‘å…³åœ°å€
    DNS1=DNSåœ°å€[8.8.8.8]
    DNS2=DNSåœ°å€[114.114.114.114]
    // é‡å¯æœåŠ¡
    systemctl restart network
    

#### ä¿®æ”¹ä¸»æœºå

ä¸»æœºåé…ç½®æ–‡ä»¶`/etc/hostname`

    [root@mpy ~]# cat /etc/hostname
    mpy.localhost
    

#### DNSé…ç½®

DNSé…ç½®æ–‡ä»¶`/etc/resolv.conf`

    [root@mpy ~]# cat /etc/resolv.conf
    # Generated by NetworkManager
    nameserver 114.114.114.114
    

#### hostsé…ç½®

hosts\[æœ¬åœ°ä¸»æœºæ˜ å°„æ–‡ä»¶\]é…ç½®æ–‡ä»¶åœ¨`/etc/hosts`

*   ä¿å­˜ä¸»æœºåä¸IPåœ°å€çš„æ˜ å°„è®°å½•

    [root@mpy ~]# cat /etc/hosts
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
    

*   é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿé¦–å…ˆä»hostsæ–‡ä»¶æŸ¥æ‰¾è§£æè®°å½•
*   hostsæ–‡ä»¶åªå¯¹å½“å‰çš„ä¸»æœºæœ‰æ•ˆ
*   hostsæ–‡ä»¶å¯ä»¥å‡å°‘DNSæŸ¥è¯¢è¿‡ç¨‹ï¼Œä»è€ŒåŠ å¿«è®¿é—®é€Ÿåº¦

DHCPæœåŠ¡
------

ä¸ºå¤§é‡å®¢æˆ·æœºè‡ªåŠ¨åˆ†é…åœ°å€ï¼Œæä¾›é›†ä¸­ç®¡ç†å‡è½»ç®¡ç†å’Œç»´æŠ¤æˆæœ¬ã€æé«˜ç½‘ç»œé…ç½®æ•ˆç‡

åŒ…æ‹¬ç½‘å¡IPåœ°å€ã€å­ç½‘æ©ç ã€å¯¹åº”çš„ç½‘ç»œåœ°å€ã€å¹¿æ’­åœ°å€ã€é»˜è®¤ç½‘å…³ã€DNSæœåŠ¡å™¨

### DHCPåŸç†

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214536565-1574486599.png)

### DHCPä¸»è¦æ–‡ä»¶

ä¸»é…ç½®æ–‡ä»¶ : `/etc/dhcp/dhcp.conf`

æ‰§è¡Œç¨‹åº : `/user/sbin/dhcpd`ã€`/usr/sbin/dhcrelay`

æ‰§è¡Œå‚æ•°é…ç½® : `/etc/sysconfig/dhcpd`

*   dhcpd.confæ„æˆ\[å…¨å±€é…ç½®å‚æ•°ã€ç½‘æ®µå£°æ˜ã€é…ç½®é€‰é¡¹ã€é…ç½®å‚æ•°ã€ä¸»æœºå£°æ˜\]

1.  å…¨å±€è®¾ç½®ï¼Œä½œç”¨äºæ•´ä¸ªDHCPæœåŠ¡å™¨

> ddns-update-style none;
> 
> default-lease-time 21600;
> 
> max-lease-time 43200;
> 
> option domain-name "domain.org"
> 
> option domain-name-servers 202.106.0.20

2.  Subnetç½‘æ®µå£°æ˜ï¼Œä½œç”¨äºæ•´ä¸ªå­ç½‘æ®µ

> rangeå‚æ•° : è®¾ç½®ç”¨äºåˆ†é…ipåœ°å€æ± 
> 
> option subnet-maskå‚æ•° : è®¾ç½®å®¢æˆ·æœºçš„å­ç½‘æ©ç 
> 
> option routeså‚æ•° : è®¾ç½®å®¢æˆ·æœºé»˜è®¤ç½‘å…³

    subnet 192.168.1.0 netmask 255.255.255.0 {
    	range   192.168.1.100  192.168.1.200;
    	option subnet-mask     255.255.255.0;
    	option routes 		   192.168.1.1;
    }
    

3.  hostä¸»æœºå£°æ˜ï¼Œé™æ€åˆ†é…

*   hardware ethernetå‚æ•° : æŒ‡å®šå¯¹åº”ä¸»æœºçš„MACåœ°å€
*   fixed-addresså‚æ•° : æŒ‡å®šä¸ºè¯¥ä¸»æœºä¿ç•™çš„IPåœ°å€

    host prtsvr{
    	hardware ethernet 00:0c:29:7a:c3:27;
    	fixed-address 192.168.1.101;
    }
    

### å®‰è£…DHCPæœåŠ¡

1.  ç¡®ä¿é•œåƒæ–‡ä»¶å¯ä»¥ä½¿ç”¨

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214553579-1956302846.png)

2.  å¯ä»¥é‡æ–°æŒ‚è½½è·¯å¾„

> mount | grep CentOS

> umount /dev/sr0

> mount /dev/sr0 /media/

3.  æ‰¾åˆ°dhcpè½¯ä»¶

> cd /media/Packages
> 
> ls | grep dhcp

4.  å®‰è£…è½¯ä»¶

> rpm -ivh dhcp-4.2.5-68.el7.centos.x86\_64.rpm

### é…ç½®DHCPæœåŠ¡å™¨

1.  ä¿®æ”¹é…ç½®æ–‡ä»¶

> vim /etc/dhcp/dhcpd.conf

2.  åœ¨æœ«è¡Œæ¨¡å¼ä¸‹å¯¼å…¥æ ·æ¿æ–‡ä»¶

> :r /usr/share/doc/dhcp-4.2.5/dhcpd.conf.example

3.  åœ¨52è¡Œè¿›è¡Œä¿®æ”¹

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214606300-2028453559.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214617443-455308416.png)

    subnet 192.168.226.0 netmask 255.255.255.0 { // å£°æ˜ç½‘æ®µ
      range 192.168.226.200 192.168.226.211; // åœ°å€æ± 
      option domain-name-servers 114.114.114.114,8.8.8.8; // DNS
      option domain-name "internal.example.org";
      option routers 192.168.226.254; // é»˜è®¤ç½‘å…³
      option broadcast-address 192.168.226.255; // ç½‘æ®µå¹¿æ’­
      default-lease-time 600;
      max-lease-time 7200;
    }
    

4.  å¼€å¯DHCPæœåŠ¡

> systemctl start dhcpd

### æ­å»ºDHCPç¯å¢ƒ

1.  centos7ç½‘ç»œé…ç½®

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214629797-1554977283.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214639236-1774827669.png)

2.  windowsæµ‹è¯•æœºå™¨

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214650787-760965135.png)

3.  æŸ¥çœ‹æ–°ç½‘å¡

    [root@localhost mpy]# ip a sh
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host 
           valid_lft forever preferred_lft forever
    2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
        link/ether 00:0c:29:7a:c6:28 brd ff:ff:ff:ff:ff:ff
        inet 192.168.50.131/24 brd 192.168.50.255 scope global noprefixroute dynamic ens33
           valid_lft 1723sec preferred_lft 1723sec
        inet6 fe80::610:331e:d510:b244/64 scope link noprefixroute 
           valid_lft forever preferred_lft forever
    3: ens36: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
        link/ether 00:0c:29:7a:c6:32 brd ff:ff:ff:ff:ff:ff
        inet6 fe80::690a:d735:4240:f806/64 scope link noprefixroute 
           valid_lft forever preferred_lft forever
    

4.  é…ç½®æ–°ç½‘å¡

> cp /etc/sysconfig/network-scripts/ifcfg-ens33 /etc/sysconfig/network-scripts/ifcfg-ens36  
> cd /etc/sysconfig/network-scripts

    TYPE="Ethernet"
    PROXY_METHOD="none"
    BROWSER_ONLY="no"
    BOOTPROTO="static"
    DEFROUTE="yes"
    IPV4_FAILURE_FATAL="no"
    IPV6INIT="yes"
    IPV6_AUTOCONF="yes"
    IPV6_DEFROUTE="yes"
    IPV6_FAILURE_FATAL="no"
    IPV6_ADDR_GEN_MODE="stable-privacy"
    NAME="ens36"
    #UUID="c10e5d41-4157-4f3b-b6a0-41e58843f972"
    DEVICE="ens36"
    ONBOOT="yes"
    ZONE=public
    IPADDR="192.168.12.5"
    NETMASK="255.255.255.0"
    GATEWAY="192.168.12.1"
    

5.  å¯åŠ¨æ–°ç½‘å¡\[ens36\]

> ifup ens36

6.  é…ç½®DHCPé…ç½®æ–‡ä»¶
    *   è¿™é‡Œçš„IPä¿¡æ¯å’Œä¸Šé¢ç½‘å¡çš„ä¿¡æ¯è¦å¯¹åº”

    subnet 192.168.12.0 netmask 255.255.255.0 {
      range 192.168.12.100 192.168.12.150;
      option domain-name-servers 114.114.114.114,8.8.8.8;
      option domain-name "internal.example.org";
      option routers 192.168.12.1;
      option broadcast-address 192.168.12.255;
      default-lease-time 600;
      max-lease-time 7200;
    }
    

7.  windowsæœºå™¨é‡æ–°è·å–ip

> ipconfig /flushdns
> 
> ipconfig /renew

DNSæœåŠ¡
-----

### ä½œç”¨å’Œç±»å‹

#### ä½œç”¨

1.  æ­£å‘è§£æ : æ ¹æ®ä¸»æœºåç§°\[åŸŸå\]æŸ¥æ‰¾å¯¹åº”çš„IPåœ°å€
2.  åå‘è§£æ : æ ¹æ®IPåœ°å€æŸ¥æ‰¾å¯¹åº”çš„ä¸»æœºåŸŸå

#### ç±»å‹

1.  ç¼“å­˜åŸŸåæœåŠ¡å™¨
    *   ä¹Ÿç§°ä¸ºé«˜é€Ÿç¼“å­˜æœåŠ¡å™¨
    *   é€šè¿‡å‘å…¶ä»–åŸŸåæœåŠ¡å™¨æŸ¥è¯¢è·å¾—åŸŸå->IPåœ°å€è®°å½•
    *   å°†åŸŸåæŸ¥è¯¢ç»“æœç¼“å­˜åˆ°æœ¬åœ°ï¼Œæé«˜é‡å¤æŸ¥è¯¢æ—¶çš„é€Ÿåº¦
2.  ä¸»åŸŸåæœåŠ¡å™¨
    *   ç‰¹å®šDNSåŒºåŸŸçš„å®˜æ–¹æœåŠ¡å™¨ï¼Œå…·æœ‰å”¯ä¸€æ€§
    *   è´Ÿè´£ç»´æŠ¤è¯¥åŒºåŸŸå†…æ‰€æœ‰åŸŸå->IPåœ°å€çš„æ˜ å°„è®°å½•
3.  ä»åŸŸåæœåŠ¡å™¨
    *   ä¹Ÿç§°ä¸ºè¾…åŠ©åŸŸåæœåŠ¡å™¨
    *   å…¶ç»´æŠ¤çš„åŸŸå->IPåœ°å€è®°å½•æ¥æºäºä¸»åŸŸåæœåŠ¡å™¨

#### æŸ¥è¯¢æµç¨‹

hosts --> ç¼“å­˜ --> é¦–é€‰DNS --> è¿­ä»£æŸ¥è¯¢\[æ ¹åŸŸå->é¡¶çº§åŸŸå->äºŒçº§åŸŸåâ€¦â€¦\]--> è¿”å›ç»“æœ

### å®‰è£…æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶

#### å®‰è£…æ–‡ä»¶

> bind-9.9.4-61.el7.x86\_64.rpm : å®‰è£…æ–‡ä»¶
> 
> bind-utils-9.9.4-61.el7.x86\_64.rpm : å·¥å…·åŒ…
> 
> bind-libs-9.9.4-61.el7.x86\_64.rpm : è¿è¡Œåº“
> 
> bind-chroot-9.9.4-61.el7.x86\_64.rpm : ä¼ªè£…ç›®å½•

#### é…ç½®æ–‡ä»¶

1.  å…¨å±€TTLé…ç½®åŠSOAè®°å½•
    *   $TTL\[Time To Liveç”Ÿå­˜æ—¶é—´\]è®°å½•
    *   SOA\[Start Of Authorityæˆæƒä¿¡æ¯å¼€å§‹\]è®°å½•
    *   åˆ†å·';'å¼€å§‹çš„éƒ¨åˆ†è¡¨ç¤ºæ³¨é‡Šä¿¡æ¯
2.  æ­£å‘åŸŸåè§£æè®°å½•
    *   NSåŸŸåæœåŠ¡å™¨\[Name Server\]è®°å½•ã€æŒ‡è¯¥åŸŸååŒºåŸŸä¸­ï¼Œæœ‰å“ªäº›æœåŠ¡å™¨è´Ÿè´£è§£æè¿™ä¸ªåŸŸåã€‘
    *   MXé‚®ä»¶äº¤æ¢\[Mail Exchange\]è®°å½•ã€ã€‘
    *   Aåœ°å€\[Address\]è®°å½•ï¼Œåªç”¨åœ¨æ­£å‘è§£æåŒºåŸŸä¸­
    *   CNAMEåˆ«å\[Canonical Name\]è®°å½•
3.  åå‘åŸŸåè§£æè®°å½•
    *   PTRæŒ‡é’ˆ\[Point\]è®°å½•ï¼Œåªç”¨åœ¨åå‘è§£æåŒºåŸŸä¸­
    *   è®°å½•çš„ç¬¬ä¸€åˆ—æŒ‡å®šIPåœ°å€ä¸­çš„ä¸»æœºåœ°å€éƒ¨åˆ†å³å¯

### æ­å»ºDNSæœåŠ¡å™¨

*   ä¸¤å°centos7æœåŠ¡å™¨ï¼Œä¸»DNS192.168.12.5ï¼Œä»DNS192.168.12.104

#### å®‰è£…

é…ç½®ä¸¤ä¸ªæ­£å‘è§£æ\[chaitin.com | alibaba.com\]å’Œä¸€ä¸ªåå‘è§£æ\[192.168.50.131 -> bj.pdns.com\]

1.  åœ¨å…‰ç›˜ä¸­æ‰¾åˆ°è½¯ä»¶

> umount /dev/sr0
> 
> mount /dev/sr0 /media/
> 
> cd /media/Packages

> rpm -ivh bind-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-utils-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-libs-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-chroot-9.9.4-61.el7.x86\_64.rpm

2.  å¤åˆ¶æ–‡ä»¶ä¿®æ”¹æƒé™

> cp -rp /etc/named.\* /var/named/chroot/etc/
> 
> cp -rp /usr/share/doc/bind-9.9.4/sample/var/\* /var/named/chroot/var/
> 
> cp -rp /var/named/dynamic/ /var/named/chroot/var/named/
> 
> chown -R :named /var/named/chroot/var/named/
> 
> chown -R named /var/named/chroot/var/named/data/
> 
> chown -R named /var/named/chroot/var/named/slaves/
> 
> chmod 644 /var/named/chroot/var/named/named.\*
> 
> chown -R 770 /var/named/chroot/var/named/data/
> 
> chown -R 770 /var/named/chroot/var/named/slaves/

3.  ä¿®æ”¹é…ç½®æ–‡ä»¶

> vim /var/named/chroot/etc/named.conf // ä¸»é…ç½®æ–‡ä»¶

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214702665-1302544543.png)

> vim /var/named/chroot/etc/named.rfc1912.zones // å£°æ˜DNSåŒºåŸŸçš„æ–‡ä»¶

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214713035-1451299662.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214723641-1904988958.png)

4.  ç”Ÿæˆå¯¹åº”åŸŸåçš„æ•°æ®æ–‡ä»¶

> cd /var/named/chroot/var/named/

    [root@localhost etc]# cd /var/named/chroot/var/named/
    [root@localhost named]# ls
    data  dynamic  my.external.zone.db  my.internal.zone.db  named.ca  named.empty  named.localhost  named.loopback  slaves
    

*   å¤åˆ¶æ­£å‘è§£ææ¨¡ç‰ˆ\[named.localhost\]

> cp -p named.localhost chaitin.com.zone
> 
> cp -p named.localhost alibaba.com.zone

*   å¤åˆ¶åå‘è§£ææ¨¡ç‰ˆ\[named.loopback\]

> cp -p named.loopback 50.168.192.in.zone

> vim chaitin.com.zone

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214737193-533063683.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214746119-229234533.png)

*   æ­£å‘é…ç½®

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214757560-425846050.png)

*   åå‘é…ç½®

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214807906-1196500410.png)

5.  è¿è¡Œnamed

> systemctl start named

6.  å¤åˆ¶named.run

> find / -name named.run
> 
> cp -p /var/named/data/named.run /var/named/chroot/var/named/data/

7.  è¿è¡Œnamed-chroot

> systemctl start named-chroot

8.  è§£å†³æŠ¥é”™

    [root@localhost named]# systemctl start named-chroot.service
    Job for named-chroot.service failed because the control process exited with error code. See "systemctl status named-chroot.service" and "journalctl -xe" for details.
    
    [root@localhost named]# systemctl status named-chroot.service
    â— named-chroot.service - Berkeley Internet Name Domain (DNS)
       Loaded: loaded (/usr/lib/systemd/system/named-chroot.service; disabled; vendor preset: disabled)
       Active: failed (Result: exit-code) since Thu 2022-10-06 06:30:30 PDT; 7s ago
      Process: 83547 ExecStart=/usr/sbin/named -u named -c ${NAMEDCONF} -t /var/named/chroot $OPTIONS (code=exited, status=1/FAILURE)
      Process: 83544 ExecStartPre=/bin/bash -c if [ ! "$DISABLE_ZONE_CHECKING" == "yes" ]; then /usr/sbin/named-checkconf -t /var/named/chroot -z "$NAMEDCONF"; else echo "Checking of zone files is disabled"; fi (code=exited, status=0/SUCCESS)
    
    Oct 06 06:30:30 localhost named[83549]: couldn't add command channel 127.0.0.1#953: address in use
    Oct 06 06:30:30 localhost named[83549]: couldn't add command channel ::1#953: address in use
    Oct 06 06:30:30 localhost named[83549]: isc_stdio_open 'data/named.run' failed: permission denied
    Oct 06 06:30:30 localhost named[83549]: configuring logging: permission denied
    Oct 06 06:30:30 localhost named[83549]: loading configuration: permission denied
    Oct 06 06:30:30 localhost named[83549]: exiting (due to fatal error)
    Oct 06 06:30:30 localhost systemd[1]: named-chroot.service: control process exited, code=exited status=1
    Oct 06 06:30:30 localhost systemd[1]: Failed to start Berkeley Internet Name Domain (DNS).
    Oct 06 06:30:30 localhost systemd[1]: Unit named-chroot.service entered failed state.
    Oct 06 06:30:30 localhost systemd[1]: named-chroot.service failed.
    [root@localhost named]# systemctl start named-chroot
    Job for named-chroot.service failed because the control process exited with error code. See "systemctl status named-chroot.service" and "journalctl -xe" for details.
    
    [root@localhost named]# journalctl -xe
    -- Defined-By: systemd
    -- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel
    --
    -- Unit named-chroot-setup.service has begun shutting down.
    Oct 06 06:31:52 localhost polkitd[601]: Unregistered Authentication Agent for unix-process:83757:1812767 (system bus name
    Oct 06 06:31:52 localhost systemd[1]: Stopped Set-up/destroy chroot environment for named (DNS).
    -- Subject: Unit named-chroot-setup.service has finished shutting down
    -- Defined-By: systemd
    -- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel
    --
    -- Unit named-chroot-setup.service has finished shutting down.
    Oct 06 06:31:52 localhost dbus[581]: [system] Successfully activated service 'org.fedoraproject.Setroubleshootd'
    Oct 06 06:31:53 localhost setroubleshoot[83811]: SELinux is preventing /usr/sbin/named from append access on the file nam
    Oct 06 06:31:53 localhost python[83811]: SELinux is preventing /usr/sbin/named from append access on the file named.run.
    
                                             *****  Plugin catchall_boolean (89.3 confidence) suggests   ******************
    
                                             If you want to allow named to write master zones
                                             Then you must tell SELinux about this by enabling the 'named_write_master_zones'
    
                                             Do
                                             setsebool -P named_write_master_zones 1
    
                                             *****  Plugin catchall (11.6 confidence) suggests   **************************
    
                                             If you believe that named should be allowed append access on the named.run file
                                             Then you should report this as a bug.
                                             You can generate a local policy module to allow this access.
                                             Do
                                             allow this access for now by executing:
                                             # ausearch -c 'named' --raw | audit2allow -M my-named
                                             # semodule -i my-named.pp
    
    
    [root@localhost named]# ausearch -c 'named' --raw | audit2allow -M my-named
    ******************** IMPORTANT ***********************
    To make this policy package active, execute:
    
    semodule -i my-named.pp
    
    [root@localhost named]# semodule -i my-named.pp
    
    

> æ ¹æ®æç¤ºè¿è¡Œä¸‹é¢ä¸¤è¡Œä»£ç 

> ausearch -c 'named' --raw | audit2allow -M my-named

> semodule -i my-named.pp

9.  è®¾ç½®windowsæœºå™¨IP

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214821332-54227650.png)

10.  å…³é—­centosé˜²ç«å¢™

> systemctl stop firewalld
> 
> iptables -F

11.  windowsæœºå™¨è¿›è¡Œæµ‹è¯•

    C:\Users\Administrator>nslookup
    é»˜è®¤æœåŠ¡å™¨:  bj.pdns.com
    Address:  192.168.12.5
    
    > www.alibaba.com
    æœåŠ¡å™¨:  bj.pdns.com
    Address:  192.168.12.5
    
    DNS request timed out.
        timeout was 2 seconds.
    DNS request timed out.
        timeout was 2 seconds.
    åç§°:    www.alibaba.com
    Address:  129.168.226.141
    
    >  www.chaitin.com
    æœåŠ¡å™¨:  bj.pdns.com
    Address:  192.168.12.5
    
    DNS request timed out.
        timeout was 2 seconds.
    DNS request timed out.
        timeout was 2 seconds.
    åç§°:    www.chaitin.com
    Address:  192.168.226.141
    

### æ­å»ºä»åŸŸåæœåŠ¡å™¨

*   åŒºåŸŸä¼ é€

1.  åœ¨å…‰ç›˜ä¸­æ‰¾åˆ°è½¯ä»¶

> umount /dev/sr0
> 
> mount /dev/sr0 /media/
> 
> cd /media/Packages

> rpm -ivh bind-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-utils-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-libs-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-chroot-9.9.4-61.el7.x86\_64.rpm

2.  å¤åˆ¶æ–‡ä»¶ä¿®æ”¹æƒé™

> cp -rp /etc/named.\* /var/named/chroot/etc/
> 
> cp -rp /usr/share/doc/bind-9.9.4/sample/var/\* /var/named/chroot/var/
> 
> cp -rp /var/named/dynamic/ /var/named/chroot/var/named/
> 
> chown -R :named /var/named/chroot/var/named/
> 
> chown -R named /var/named/chroot/var/named/data/
> 
> chown -R named:named /var/named/chroot/var/named/slaves/
> 
> chmod -R 644 /var/named/chroot/var/named/named.\*
> 
> chown -R 770 /var/named/chroot/var/named/data/
> 
> chown -R 770 /var/named/chroot/var/named/slaves/

3.  ä¿®æ”¹é…ç½®æ–‡ä»¶

*   åœ¨å®¢æˆ·ç«¯é…ç½®

> vim /var/named/chroot/etc/named.conf // ä¸»é…ç½®æ–‡ä»¶

> vim /var/named/chroot/etc/named.rfc1912.zones

    zone "alibaba.com" IN {
     		type slave;
     		file "slaves/alibaba.com.zone d";
     		masters  { 192.168.12.5; };
    };
    

*   åœ¨æœåŠ¡å™¨æ®µé…ç½®

> vim /var/named/chroot/etc/named.rfc192.zones

    zone "alibaba.com" IN {
           type master;
           file "alibaba.com.zone";
           allow-update { 192.168.12.101; }; // è¿™é‡Œæ”¹æˆå®¢æˆ·ç«¯çš„IP
     ;
    

4.  å®¢æˆ·æœºè®¾ç½®DNS

> vim /etc/resolv.conf
> 
> nameserver 192.168.12.5

5.  ç¡®ä¿å¯ä»¥pingé€š
6.  å¼‚å¸¸å¤„ç†

> dumping master file: slaves/tmp-dt1dKHtvrc: open: permission denied

*   æƒé™ä¸å¤Ÿ

> chown -R named:named /var/named/chroot/var/named/slaves/

7.  å¯åŠ¨æœåŠ¡\[é‡åˆ°å¼‚å¸¸ï¼Œå’Œä¸Šé¢çš„DNSæŠ¥é”™å¤„ç†æ–¹æ³•ä¸€æ ·\]

> systemctl start named-chroot
> 
> vim /var/named/chroot/var/named/slaves/alibaba.com.zone

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214833397-419356101.png)

è¿œç¨‹è®¿é—®åŠæ§åˆ¶
-------

### SSHè¿œç¨‹ç®¡ç†

#### OpenSSHæœåŠ¡ç«¯

sshåè®®

*   ä¸ºå®¢æˆ·æœºæä¾›å®‰å…¨çš„shellç¯å¢ƒï¼Œç”¨äºè¿œç¨‹ç®¡ç†
*   é»˜è®¤ç«¯å£ : TCP 22

OpenSSH

*   æœåŠ¡åç§° : sshd
*   æœåŠ¡ç«¯ä¸»ç¨‹åº : /usr/sbin/sshd
*   æœåŠ¡ç«¯é…ç½®æ–‡ä»¶ : /etc/ssh/sshd\_config

æœåŠ¡ç›‘å¬é€‰é¡¹

*   ç«¯å£å·ã€åè®®ç‰ˆæœ¬ã€ç›‘å¬IPåœ°å€
*   ç¦æ­¢åå‘è§£æ

ç”¨æˆ·ç™»é™†æ§åˆ¶

*   ç¦æ­¢rootç”¨æˆ·ã€ç©ºå¯†ç ç”¨æˆ·
*   ç™»é™†æ—¶é—´ã€é‡è¯•æ¬¡æ•°
*   AllowUsersã€DenyUsers

é»˜è®¤çš„é“¾æ¥å‘½ä»¤

1.  ssh \[è¿œç¨‹å®‰å…¨ç™»é™†\]

> ssh user@host -p 22

2.  scp \[è¿œç¨‹å®‰å…¨å¤åˆ¶\]

> scp user@host:file1 file2 // æŠŠæœåŠ¡å™¨çš„æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ°ï¼Œfile1è¡¨ç¤ºæœåŠ¡å™¨æ–‡ä»¶è·¯å¾„ï¼Œfile2è¡¨ç¤ºæœ¬æœºæ–‡ä»¶å­˜æ”¾è·¯å¾„
> 
> scp file1 user@host:file2 // æŠŠæœ¬åœ°æ–‡ä»¶æ‹·è´åˆ°æœåŠ¡å™¨ä¸­ï¼Œfile1è¡¨ç¤ºæœ¬æœºæ–‡ä»¶å­˜æ”¾è·¯å¾„ï¼Œfile2è¡¨ç¤ºæœåŠ¡å™¨æ–‡ä»¶è·¯å¾„

#### OpenSSHå®¢æˆ·ç«¯

*   xhell
*   mobaxterm

#### å¯†é’¥å¯¹éªŒè¯çš„SSHä½“ç³»

å®ç°è¿‡ç¨‹

1.  åˆ›å»ºå¯†é’¥å¯¹

Linuxä½¿ç”¨`ssh-keygen`å‘½ä»¤

å¯ç”¨çš„åŠ å¯†ç®—æ³• : RSAæˆ–DSA

*   å¯†é’¥æ–‡ä»¶ : id\_rsa
    
*   å…¬é’¥æ–‡ä»¶ : id\_rsa.pub
    

2.  ä¸Šä¼ å…¬é’¥æ–‡ä»¶id\_rsa.pub

ä»»ä½•æ–¹å¼å‡å¯\[å…±äº«ã€FTPã€Emailã€SCPâ€¦â€¦\]æˆ–è€…å‘½ä»¤å¯¼å…¥`ssh-copy-id -i æœ¬åœ°å…¬é’¥æ–‡ä»¶ä½ç½® user@host`

3.  å¯¼å…¥å…¬é’¥ä¿¡æ¯

å°†å…¬é’¥æ–‡æœ¬æ·»åŠ è‡³ç›®æ ‡ç”¨æˆ·çš„å…¬é’¥åº“æˆ–è€…å‘½ä»¤å¯¼å…¥`ssh-copy-id -i æœ¬åœ°å…¬é’¥æ–‡ä»¶ä½ç½® user@host`

å…¬é’¥æ–‡ä»¶ : `~/.ssh/authorized_keys`

    ssh-copy-id -i ~/.ssh/id_rsa.pub lisi@192.168.16.21
    

4.  ä½¿ç”¨å¯†é’¥å¯¹éªŒè¯æ–¹å¼

éªŒè¯ç”¨æˆ· : æœåŠ¡ç«¯çš„ç”¨æˆ·lisi

éªŒè¯å¯†ç  : å®¢æˆ·ç«¯çš„ç”¨æˆ·zhangsançš„ç§é’¥çŸ­è¯­

> vim /etc/ssh/sshd\_config

å°†PubkeyAuthentication yeså‰é¢çš„æ³¨é‡Šå»æ‰ï¼Œå°†å…¬é’¥è®¤è¯å¼€å¯

å°†PasswordAuthentication yesæ”¹æˆnoï¼Œå°†å¯†ç è®¤è¯å…³æ‰

### TCP Wrappers

linuxä¸­çš„ä¸€ä¸ªå¤–æŒ‚ç¨‹åº

#### æ¦‚è¿°

ä¿æŠ¤æœºåˆ¶çš„å®ç°

1.  é€šè¿‡tcpdä¸»ç¨‹åºå¯¹å…¶ä»–æœåŠ¡ç¨‹åºè¿›è¡ŒåŒ…è£…
2.  ç”±å…¶ä»–æœåŠ¡ç¨‹åºè°ƒç”¨libwrap.so.\*é“¾æ¥åº“

#### è®¿é—®ç­–ç•¥

1.  è®¿é—®æ§åˆ¶ç­–ç•¥çš„é…ç½®æ–‡ä»¶

`/etc/hosts.allow`

`/etc/hosts.deny`

2.  è®¾ç½®è®¿é—®æ§åˆ¶ç­–ç•¥
    1.  ç­–ç•¥æ ¼å¼ã€æœåŠ¡åˆ—è¡¨:å®¢æˆ·æœºåœ°å€åˆ—è¡¨ã€‘
    2.  æœåŠ¡åˆ—è¡¨ã€å¤šä¸ªæœåŠ¡ä»¥é€—å·åˆ†éš”ï¼ŒALLè¡¨ç¤ºæ‰€æœ‰æœåŠ¡ã€‘
    3.  å®¢æˆ·æœºåœ°å€åˆ—è¡¨
        1.  å¤šä¸ªåœ°å€ä»¥é€—å·åˆ†éš”ï¼ŒALLè¡¨ç¤ºæ‰€æœ‰åœ°å€
        2.  å…è®¸ä½¿ç”¨é€šé…ç¬¦?å’Œ\*
        3.  ç½‘æ®µåœ°å€ï¼Œå¦‚192.168.1.æˆ–è€…192.168.1.0/255.255.255.0
        4.  åŒºåŸŸåœ°å€ï¼Œå¦‚.benet.com

    vim /etc/hosts.allow
    sshd:192.168.12.100
    
    vim /etc/hosts.deny
    sshd:all
    

linuxæ–‡ä»¶ä¼ è¾“æœåŠ¡
===========

SAMBAæœåŠ¡
-------

1.  SMBåè®®
    
    æœåŠ¡æ¶ˆæ¯å—
    
2.  CIFSåè®®
    
    é€šç”¨äº’è”ç½‘æ–‡ä»¶ç³»ç»Ÿ
    
3.  Sambaåè®®
    
    smbd : æä¾›å¯¹æœåŠ¡å™¨ä¸­æ–‡ä»¶ã€æ‰“å°èµ„æºçš„å…±äº«è®¿é—®\[TCP139ã€445\]
    
    nmdb : æä¾›åŸºäºNetBIOSä¸»æœºåçš„è§£æ\[UDP137ã€138\]
    
    é…ç½®ç›®å½•
    
    *   `/etc/samba`
    *   `/etc/samba/smb.conf`
    
    é…ç½®æ–‡ä»¶æ£€æŸ¥å·¥å…·
    
    *   testparm

### é…ç½®ä¿¡æ¯

#### é…ç½®é€‰é¡¹

/etc/samba/smb.conf

*   \[global\] : å…¨å±€è®¾ç½®
*   \[homes\] : ç”¨æˆ·ç›®å½•å…±äº«è®¾ç½®
*   \[printers\] : æ‰“å°æœºå…±äº«è®¾ç½®
*   \[myshare\] : è‡ªå®šä¹‰åç§°çš„å…±äº«ç›®å½•è®¾ç½®

#### å…¨å±€é…ç½®é¡¹

*   workgroup : æ‰€åœ¨å·¥ä½œç»„åç§°
*   server string : æœåŠ¡å™¨æè¿°ä¿¡æ¯
*   security : å®‰å…¨çº§åˆ«ï¼Œå¯ç”¨å€¼\[shellã€userã€serverã€domain\]
*   log file : æ—¥å¿—æ–‡ä»¶ä½ç½®ï¼Œ"%m"å˜é‡è¡¨ç¤ºå®¢æˆ·æœºåœ°å€
*   passwd backend : è®¾ç½®å…±äº«è´¦æˆ·æ–‡ä»¶çš„ç±»å‹

#### å…±äº«ç›®å½•é…ç½®é¡¹

*   comment : å¯¹å…±äº«ç›®å½•çš„æ³¨é‡Šã€è¯´æ˜ä¿¡æ¯
*   path : å…±äº«ç›®å½•åœ¨æœåŠ¡å™¨ä¸­å¯¹åº”çš„å®é™…è·¯å¾„
*   browseable : è¯¥å…±äº«ç›®å½•åœ¨ç½‘ä¸Šé‚»å±…ä¸­æ˜¯å¦å¯è§
*   guestok : æ˜¯å¦å…è®¸æ‰€æœ‰äººè®¿é—®ï¼Œç­‰æ•ˆäº"public"
*   writable : æ˜¯å¦å¯å†™ï¼Œä¸read onlyçš„ä½œç”¨ç›¸å
*   read only : æ˜¯å¦å¯è¯»
*   write list : æ˜¯å¦å¯å†™
*   valid users : å…è®¸å“ªäº›ç”¨æˆ·æˆ–ç»„å¯è¯»ã€valid users=admin,@manager // adminè¡¨ç¤ºç”¨æˆ·ï¼Œ@managerè¡¨ç¤ºmanagerç»„ã€‘
*   directory mask : é»˜è®¤ä¸Šä¼ ç›®å½•æƒé™\[0666\]
*   create mask : é»˜è®¤ä¸Šä¼ æ–‡ä»¶æƒé™\[0777\]

#### è¾…åŠ©é…ç½®å†…å®¹

*   æ³¨é‡Šè¡Œ : ä»¥#å¼€å¤´çš„è¡Œ
    
*   é…ç½®æ ·ä¾‹è¡Œ : ä»¥;å¼€å¤´çš„è¡Œ
    
*   ç»“åˆgrepå‘½ä»¤å¯ä»¥æå–æœ‰æ•ˆé…ç½®è¡Œ
    
    > cat /etc/samba/smb.conf.example | grep -v "^#" smb.conf | grep -v "^;" | grep -v ^$
    

#### ç”¨æˆ·è®¿é—®çš„samba

1.  å»ºç«‹sambaç”¨æˆ·æ•°æ®åº“æ–‡ä»¶

`/var/lib/samba/private/passdb.tdb`

2.  è®¾ç½®ä¸Šä¼ ç›®å½•åŠæƒé™

> mkdir -m 777 /upload

> vim /etc/samba/smb.conf

directory mask = 0755 // é»˜è®¤ä¸Šä¼ ç›®å½•æƒé™

create mask = 0644 // é»˜è®¤ä¸Šä¼ æ–‡ä»¶æƒé™

> \[upload\]
> 
> â€‹ comment=upload
> 
> â€‹ path=/upload
> 
> â€‹ public=yes
> 
> â€‹ read only=yes // æ‰€æœ‰äººå¯ä»¥è¯»
> 
> â€‹ write list=admin // adminç”¨æˆ·å¯å†™

3.  å…±äº«è´¦å·æ˜ å°„\[åˆ«å\]

> vim /etc/samba/smbusers
> 
> æ·»åŠ ä»¥ä¸‹ä¿¡æ¯
> 
> zhangsan = zs
> 
> root = administrator

4.  å¯ç”¨åˆ«å

> vim /etc/samba/smb.conf
> 
> åœ¨\[global\]ä¸­æ·»åŠ æˆ–ä¿®æ”¹
> 
> username map = /etc/samba/smbusers

5.  é‡å¯æœåŠ¡

> systemctl restart smb nmb

#### è®¾ç½®ç”¨æˆ·è®¿é—®æˆæƒ

*   æ–°å»ºå…±äº«ç›®å½•ä¸å…±äº«ç”¨æˆ·
*   ä¿®æ”¹smb.confé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ åä¸ºtoolsçš„å…±äº«ç›®å½•
*   é‡æ–°åŠ è½½smb.confæ–‡ä»¶ã€æˆ–é‡å¯smbæœåŠ¡

#### ç¡®å®šç”¨æˆ·è®¿é—®æƒé™

*   è®¾ç½®ç›®å½•æƒé™
*   è®¾ç½®ä¸Šä¼ æ–‡ä»¶å’Œç›®å½•çš„é»˜è®¤æƒé™

#### è®¿é—®åœ°å€é™åˆ¶

*   ä¸€èˆ¬ç”¨åœ¨å…¨å±€é…ç½®\[global\]éƒ¨åˆ†
*   hosts allowé…ç½®é¡¹ : ä»…å…è®¸ç‰¹å®šçš„å®¢æˆ·æœº
*   hosts deny é…ç½®é¡¹ : ä»…æ‹’ç»ç‰¹å®šçš„å®¢æˆ·æœº
*   å®¢æˆ·æœºåœ°å€è¡¨ç¤ºå½¢å¼
    *   ä»¥ç©ºæ ¼åˆ†éš”å¤šä¸ªåœ°å€
    *   ä¸»æœºåæˆ–IPåœ°å€ï¼Œä¾‹å¦‚ : 192.168.12.101æˆ–è€…prtsvr
    *   ç½‘ç»œåœ°å€ï¼Œä¾‹å¦‚ : 173.17.æˆ–è€…173.17.0.0/255/255/0/0

> vim /etc/samba/smb.conf
> 
> \[global\]
> 
> hosts allow = 192.168.4. 173.17.

### æ­å»ºæ–‡ä»¶å…±äº«æœåŠ¡å™¨

[https://odinxu.com/post/windows-access-centos-samba/](https://odinxu.com/post/windows-access-centos-samba/)

1.  é‡æ–°æŒ‚è½½é•œåƒæ–‡ä»¶

> mount | grep CentOS
> 
> umount /dev/sr0
> 
> mount /dev/sr0 /media/
> 
> cd /media/Packages

2.  å®‰è£…ä¸»ç¨‹åº

> rpm -ivh samba-4.7.1-6.el7.x86\_64.rpm
> 
> æˆ–è€… yum install -y sambaã€ç¼ºå°‘ä¾èµ–æ—¶ä½¿ç”¨ã€‘

3.  å»ºç«‹sambaç”¨æˆ·æ•°æ®åº“æ–‡ä»¶

> useradd zhangsan
> 
> pdbedit -a -u zhangsan // å°†ç³»ç»Ÿç”¨æˆ·æ·»åŠ ä¸ºsambaç”¨æˆ·
> 
> pdbedit -L // æŸ¥çœ‹sambaç”¨æˆ·
> 
> pdbedit -vL // æŸ¥çœ‹æ‰€æœ‰çš„sambaç”¨æˆ·

4.  å…³é—­é˜²ç«å¢™ã€SELINUX
    
    > systemctl stop firewalld
    > 
    > setenforce 0
    
5.  windowsçš„cmdè¾“å…¥`\\192.168.12.5`è¾“å…¥è´¦å·å¯†ç ç™»é™†
    

### è®¿é—®å…±äº«æ–‡ä»¶å¤¹

#### window

cmdä¸‹è¾“å…¥`\\sambaæœåŠ¡å™¨IP`

#### linux

`smbclient`å‘½ä»¤ï¼ŒæŸ¥çœ‹åŠç™»é™†ä½¿ç”¨å…±äº«

> smbclient -U ç”¨æˆ·å -L IPåœ°å€
> 
> smbclient -U ç”¨æˆ·å //IPåœ°å€/ç›®å½•

*   æŒ‚è½½å…±äº«æ–‡ä»¶

> mkdir /media/smbdir
> 
> mount -t cifs -o username=ç”¨æˆ·å //IPåœ°å€/ç›®å½• /media/smbdir
> 
> mount -t cifs -o username=zs [//192.168.12.5/zhangsan](//192.168.12.5/zhangsan) /media/smbdir

*   è¦ä½¿ç”¨æœ‰æƒé™çš„è´¦æˆ·rootï¼Œä¸ç„¶å¯èƒ½ä¼šæŠ¥é”™
    
    > mount error(13): Permission denied  
    > Refer to the mount.cifs(8) manual page (e.g. man mount.cifs)
    

### æ¡ˆä¾‹

shareç›®å½•

managerç›®å½•

ç®¡ç†å‘˜

admin

è¯»å†™

è¯»å†™

ç»ç†

managerç»„

åªè¯»

åªè¯»

ç”¨æˆ·

zhangsan

åªè¯»

æ— 

åˆ›å»ºå…±äº«ç›®å½• : shareã€manager

> mkdir share
> 
> mkdir manager

åˆ›å»ºè®¿é—®ç”¨æˆ· : adminã€zhangsanã€jingli1ã€jingli2

> useradd adminã€zhangsanã€jingli1ã€jingli2
> 
> pdbedit -u -a adminã€zhangsanã€jingli1ã€jingli2

åˆ›å»ºè®¿é—®ç»„ : manager

> groupadd -g 1500 manager

æƒé™éœ€æ±‚1 : shareå¯ä»¥è¢«æ‰€æœ‰äººè®¿é—®ä¸‹è½½ï¼Œä½†æ˜¯åªæœ‰adminå¯ä»¥ä¸Šä¼ 

> chmod 777 /share/ /manager/

æƒé™éœ€æ±‚2 : manageråªæœ‰å±äºmanagerç»„çš„ç”¨æˆ·å’Œadminå¯ä»¥è®¿é—®ä¸‹è½½ï¼Œå…¶ä»–æ— æƒ\[adminè¿˜å¯ä»¥ä¸Šä¼ \]

1.  ä¿®æ”¹æ‰€æœ‰äººå¯ä»¥è¯»ï¼Œadminç”¨æˆ·å¯è¯»å¯å†™

    vim /etc/samba/amb.config
    
    [tongzhi]
            comment=yuangongxinxi
            path=/share
            public=yes
            read only=yes // æ‰€æœ‰äººå¯ä»¥è¯»
            write list=admin // adminç”¨æˆ·å¯å†™
    
    [manager]
            comment=manager
            path=/manager
            public=yes
            read only=yes // æ‰€æœ‰äººå¯è¯»
            write list=admin // adminç”¨æˆ·å¯å†™
    

2.  ä¿®æ”¹å…¶ä»–ç”¨æˆ·\[zhangsan\]æ— æ³•è¯»å–managerç›®å½•

    vim /etc/samba/amb.config
    
    [manager]
            comment=manager
            path=/manager
            public=no
            read only=yes // æ‰€æœ‰äººå¯è¯»
            valid users=admin,@manager // adminè¡¨ç¤ºç”¨æˆ·ï¼Œ@managerè¡¨ç¤ºmanagerç»„
            write list=admin // adminç”¨æˆ·å¯å†™
    

YUMæœåŠ¡
-----

### éƒ¨ç½²YUMè½¯ä»¶ä»“

#### æŒ‡å®šè½¯ä»¶ä»“åº“

*   ä½¿ç”¨æœ¬åœ°ã€åŸºäºå…‰ç›˜ã€‘

`/etc/yum.repos.d/*`

1.  é‡æ–°æŒ‚è½½å…‰ç›˜

> umount /dev/sr0
> 
> mount /dev/sr0 /media

2.  ç§»åŠ¨æºæ–‡ä»¶

> mkdir /root/yum.bak
> 
> mv /etc/yum.repos.d/\* /root/yum.bak

3.  æŒ‡å®šæº

> vim /etc/yum.repos.d/test.repo
> 
> \[local-yum\]  
> name = local-yum  
> baseurl = file:///media/  
> enabled=1  
> gpgcheck=0

4.  æ¸…é™¤yumç¼“å­˜ï¼Œé‡æ–°ç”Ÿæˆ

> yum clean all
> 
> yum list

5.  å®‰è£…è½¯ä»¶

> yum install -y è½¯ä»¶
> 
> yum install -y vsftpd

#### æœåŠ¡å™¨å®‰è£…æº

*   æœåŠ¡å™¨ç«¯è®¾ç½®\[1. ä¿®æ”¹æŒ‚è½½ç‚¹ï¼Œå°†ç›®å½•è®¾ç½®ä¸ºftpå…±äº«ç›®å½• 2. ç›´æ¥å°†æŒ‚è½½ç‚¹è®¾ç½®ä¸ºé»˜è®¤çš„/var/ftp/\]
    
    1.  é‡æ–°æŒ‚è½½å…‰ç›˜
        
        > umount /dev/sr0
        > 
        > mount /dev/sr0 /media/
        
    2.  è®¾ç½®å¥½ftpæœåŠ¡\[å…è®¸åŒ¿åè®¿é—®ï¼Œä¿®æ”¹ä»–çš„é»˜è®¤å…±äº«è·¯å¾„ä¸º/media\]
        
        > vim /etc/vsftpd/vsftpd.conf
        > 
        > anonymous\_enable=YES // å¼€å¯åŒ¿åè®¿é—®
        > 
        > local\_enable=NO // å…³é—­æœ¬åœ°ç”¨æˆ·
        > 
        > write\_enable=YES // å¼€æ”¾æœåŠ¡å™¨å†™çš„æƒé™
        > 
        > anon\_umask=022
        > 
        > anon\_upload\_enable=YES // å…è®¸åŒ¿åä¸Šä¼ 
        > 
        > anon\_mkdir\_write\_enable=YES // å…è®¸åŒ¿åç”¨æˆ·åˆ›å»ºç›®å½•
        > 
        > anon\_other\_write\_enable=YES // å¼€æ”¾å…¶ä»–å†™å…¥æƒ
        > 
        > anon\_root=/media // è®¾ç½®å…±äº«è·¯å¾„
        > 
        > dirmessage\_enable=YES
        
    3.  ftp://IPåœ°å€å¯ä»¥è®¿é—®åå³å¯
        
*   å®¢æˆ·ç«¯è®¾ç½®
    
    1.  ä¿å­˜åŸæ¥çš„æº
        
        > mkdir /root/yum.bak
        > 
        > mv /etc/yum.repos.d/\* /root/yum.bak
        
    2.  æ–°å»ºæº
        
        > vim yum-ftp.repo
        > 
        > \[yum-ftp\]
        > 
        > name=yum-ftp
        > 
        > baseurl=ftp://IPåœ°å€
        > 
        > enable=1
        > 
        > gpgcheck=0
        
    3.  æ¸…é™¤åŸæ¥çš„æºç¼“å­˜
        
        > yum clean all
        
    4.  æ›´æ–°æº
        
        > yum list
        

#### ç½‘ç»œå®‰è£…æº

FTPæœåŠ¡
-----

### FTPæ¦‚è¿°

æ§åˆ¶è¿æ¥ : TCP21ï¼Œç”¨äºå‘é€FTPå‘½ä»¤ä¿¡æ¯

æ•°æ®è¿æ¥ : TCP20ï¼Œç”¨äºä¸Šä¼ ã€ä¸‹è½½æ•°æ®

*   æ•°æ®è¿æ¥çš„å»ºç«‹ç±»å‹
    
    *   ä¸»åŠ¨æ¨¡å¼ : æœåŠ¡ç«¯ä»20ç«¯å£ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘èµ·è¿æ¥
    *   è¢«åŠ¨æ¨¡å¼ : æœåŠ¡ç«¯åœ¨æŒ‡å®šèŒƒå›´å†…æŸä¸ªç«¯å£è¢«åŠ¨ç­‰å¾…å®¢æˆ·è¿æ¥
*   FTPä¼ è¾“æ¨¡å¼
    
    *   æ–‡æœ¬æ¨¡å¼ : ASCIIæ¨¡å¼ï¼Œä»¥æ–‡æœ¬åºåˆ—ä¼ è¾“æ•°æ®
    *   äºŒè¿›åˆ¶æ¨¡å¼ : Binaryæ¨¡å¼ï¼Œä»¥äºŒè¿›åˆ¶åºåˆ—ä¼ è¾“æ•°æ®
*   FTPç±»å‹
    
    *   åŒ¿åç”¨æˆ·ã€æœ¬åœ°ç”¨æˆ·ã€è™šæ‹Ÿç”¨æˆ·
*   å¸¸è§çš„FTPæœåŠ¡å™¨ç¨‹åº
    
    *   IISã€Serv-U
    *   wu-ftpdã€Proftpd
    *   vsfftp\[Very Secure FTP Daemon\]
*   å¸¸è§çš„FTPå®¢æˆ·ç«¯ç¨‹åº
    
    *   ftpå‘½ä»¤
    *   CuteFTPã€FlashFXPã€LeapFTPã€Filezila
    *   gftpã€kuftp

### vsftpæ¦‚è¿°

ä¸»ç¨‹åº : `/usr/sbin/vsftpd`

æœåŠ¡å : `vsftpd`

ç”¨æˆ·æ§åˆ¶åˆ—è¡¨æ–‡ä»¶

*   `/etc/vsftpd/ftpusers` : é»‘åå•ï¼Œå‡ºç°çš„ç”¨æˆ·ç¦æ­¢ç™»é™†
*   `/etc/vsftpd/user_list` : ç”¨æˆ·åˆ—è¡¨

ä¸»é…ç½®æ–‡ä»¶

*   `/etc/vsftpd/vsftpd.conf`

#### å…¨å±€é…ç½®é¡¹

listen=YES : æ˜¯å¦ç‹¬ç«‹è¿è¡Œçš„æ–¹å¼ç›‘å¬æœåŠ¡

listen\_address=192.168.12.1 : è®¾ç½®ç›‘å¬çš„IPåœ°å€

listen\_port : è®¾ç½®ç›‘å¬FTPæœåŠ¡çš„ç«¯å£

write\_enable=YES : æ˜¯å¦å¯ç”¨å†™å…¥æƒé™

download\_enable=YES : æ˜¯å¦å…è®¸ä¸‹è½½æ–‡ä»¶

userlist\_enable=YES : æ˜¯å¦å¯ç”¨user\_liståˆ—è¡¨æ–‡ä»¶

userlist\_deny=YES : æ˜¯å¦ç¦ç”¨user\_listä¸­çš„ç”¨æˆ·

max\_clients=0 : é™åˆ¶å¹¶å‘å®¢æˆ·ç«¯è¿æ¥å±

max\_per\_ip=0 : é™åˆ¶åŒä¸€IPåœ°å€çš„å¹¶å‘è¿æ¥æ•°

#### åŒ¿åFTPé…ç½®é¡¹

anonymous\_enable=YES : å¯ç”¨åŒ¿åè®¿é—®

anon\_umask=022 : åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„æƒé™æ©ç 

*   æ–‡ä»¶é»˜è®¤æ˜¯666ï¼Œè¿™é‡Œçš„022è¡¨ç¤ºçš„æ˜¯åç \[666-022=644çš„æƒé™\]
*   ç›®å½•é»˜è®¤æ˜¯777\[777-022=755çš„æƒé™\]

anon\_root=/var/ftp : åŒ¿åç”¨æˆ·çš„FTPæ ¹ç›®å½•

anon\_upload\_enable=YES : å…è®¸ä¸Šä¼ æ–‡ä»¶

anon\_mkdir\_write\_enable=YES : å…è®¸åˆ›å»ºç›®å½•

anon\_other\_write\_enable=YES : å¼€æ”¾å…¶ä»–å†™å…¥æƒ

anon\_max\_rate=0 : é™åˆ¶æœ€å¤§ä¼ è¾“é€Ÿç‡\[å­—èŠ‚/ç§’\]

#### æœ¬åœ°ç”¨æˆ·FTPé…ç½®é¡¹

local\_enable=YES : æ˜¯å¦å¯ç”¨æœ¬åœ°ç³»ç»Ÿç”¨æˆ·

local\_umask=022 :ã€€æœ¬åœ°ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„æƒé™æ©ç 

chroot\_local\_user=YES : æ˜¯å¦å°†ç”¨æˆ·ç¦é”¢åœ¨ä¸»ç›®å½•

local\_max\_rate=0 : é™åˆ¶æœ€å¤§ä¼ è¾“é€Ÿç‡\[å­—èŠ‚/ç§’\]

*   vsftpæ”¯æŒtcp\_wrappersçš„è®¿é—®æ§åˆ¶
    
    *   tcp\_wrappers=YES
    
        vim /etc/hosts.allow
        vsftpd:192.168.12.100
        
        vim /etc/hosts.deny
        vsftpd:all
        
    

### åŸºäºç³»ç»ŸæœåŠ¡çš„FTP

#### åŒ¿åè®¿é—®FTPæœåŠ¡

1.  å‡†å¤‡åŒ¿åFTPè®¿é—®çš„ç›®å½•\[ä½¿åŒ¿åFTPå¯¹è¯¥ç›®å½•æœ‰å†™å…¥æƒé™\]
    
        chown ftp /var/ftp/pub/
        
    
2.  å¼€æ”¾åŒ¿åç”¨æˆ·é…ç½®å¹¶å¯åŠ¨vsftpdæœåŠ¡
    
        vim /etc/vsftpd/vsftpd.conf
        
        anonymous_enable=YES // å¼€å¯åŒ¿åè®¿é—®
        local_enable=NO // å…³é—­æœ¬åœ°ç”¨æˆ·
        write_enable=YES // å¼€æ”¾æœåŠ¡å™¨å†™çš„æƒé™
        anon_umask=022 
        anon_upload_enable=YES // å…è®¸åŒ¿åä¸Šä¼ 
        anon_mkdir_write_enable=YES // å…è®¸åŒ¿åç”¨æˆ·åˆ›å»ºç›®å½•
        anon_other_write_enable=YES // å¼€æ”¾å…¶ä»–å†™å…¥æƒ
        dirmessage_enable=YES
        
    
3.  æµ‹è¯•åŒ¿åFTPæœåŠ¡å™¨
    
    è¾“å…¥`ftp://IPåœ°å€`
    

#### ç”¨æˆ·éªŒè¯çš„FTPæœåŠ¡

1.  åŸºæœ¬çš„æœ¬åœ°ç”¨æˆ·éªŒè¯\[å­˜åœ¨å¯†ç çš„ç”¨æˆ·æ‰å¯ä»¥ç™»é™†\]
    
    *   ftp://IPç™»é™†è¿›å»åçš„æ ¹ç›®å½•å³é”®é€‰æ‹©ç™»é™†
    
    ![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214847178-607592383.png)
    
    *   é€‰æ‹©å­˜åœ¨å¯†ç çš„è´¦å·æˆ–è€…`passwd ç”¨æˆ·å`è®¾ç½®å¯†ç å³å¯
    
    ![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214857617-1826604290.png)
    
2.  ä½¿ç”¨user\_listç”¨æˆ·åˆ—è¡¨æ–‡ä»¶
    
    > vim /etc/vsftpd/user\_list
    > 
    > // æ·»åŠ å…è®¸ç™»é™†çš„ç”¨æˆ·
    > 
    > zhangsan // ç³»ç»Ÿç”¨æˆ·
    > 
    > ftp // ftpåŒ¿åç”¨æˆ·
    > 
    > anonymous // windowsåŒ¿åç”¨æˆ·
    
    > vim /etc/vsftpd/vsftpd.conf
    > 
    > è®¾ç½®userlist\_enable=YES
    > 
    > è®¾ç½®userlist\_deny=NO
    

linuxç½‘ç«™æœåŠ¡
=========

Apache
------

### ApacheæœåŠ¡åŸºç¡€

#### Apacheç®€ä»‹

ä¸»è¦ç‰¹ç‚¹

*   å¼€æ”¾æºä»£ç ã€è·¨å¹³å°åº”ç”¨
*   æ”¯æŒå¤šç§ç½‘é¡µç¼–ç¨‹è¯­è¨€
*   æ¨¡å—åŒ–è®¾è®¡ã€è¿è¡Œç¨³å®šã€è‰¯å¥½çš„å®‰å…¨æ€§

è½¯ä»¶ç‰ˆæœ¬

1.X

*   ç›®å‰æœ€é«˜ç‰ˆæœ¬æ˜¯1.3ï¼Œè¿è¡Œç¨³å®š
*   å‘ä¸‹å…¼å®¹æ€§è¾ƒå¥½ï¼Œä½†ç¼ºä¹ä¸€äº›è¾ƒæ–°çš„åŠŸèƒ½

2.X

*   å…·æœ‰æ›´å¤šçš„åŠŸèƒ½ç‰¹æ€§
*   ä¸1.Xç›¸æ¯”ï¼Œé…ç½®ç®¡ç†é£æ ¼å­˜åœ¨è¾ƒå¤§å·®å¼‚

**ä¸»è¦ç›®å½•å’Œæ–‡ä»¶**

æœåŠ¡ç›®å½• : `/usr/local/httpd`

ä¸»é…ç½®æ–‡ä»¶ : `/usr/local/httpd/conf/httpd.conf`

ç½‘é¡µç›®å½• : `/usr/local/httpd/htdocs/`

æœåŠ¡è„šæœ¬ : `/usr/local/httpd/bin/apachectl`

æ‰§è¡Œç¨‹åº : `/usr/local/httpd/bin/httpd`

è®¿é—®æ—¥å¿— : `/usr/local/httpd/log/access_log`

é”™è¯¯æ—¥å¿— : `/usr/local/httpd/log/error_log`

#### å®‰è£…httpdæœåŠ¡å™¨

1.  å®‰è£…æ–‡ä»¶\[httpd-2.4.54\]

> ./configure --prefix=/usr/local/httpd --enable-so --enable-rewrite --enable-charset-lite --enable-cgi

*   å¦‚æœç¼ºä»€ä¹ˆç¯å¢ƒç›´æ¥yumå®‰è£…

> yum install -y apr\*
> 
> yum install -y pcre\*

*   ç¼–è¯‘

> make && make install

2.  å¯åŠ¨æœåŠ¡

> /usr/local/httpd/bin/apachectl start
> 
> netstat -anpt | grep 80

3.  ä¿®æ”¹é…ç½®æ–‡ä»¶

> vim /usr/local/httpd/conf/httpd.conf
> 
> æ‰¾åˆ°ServerNameï¼Œå°†æ³¨é‡Šå»æ‰

4.  è®¾ç½®ç³»ç»ŸæœåŠ¡å¯åŠ¨

> cp /usr/local/httpd/bin/apachectl /etc/init.d/httpd
> 
> å¯åŠ¨æ–¹æ³•ä¸º : service restart httpd

### httpæœåŠ¡å™¨åŸºç¡€

1.  è™šæ‹Ÿwebä¸»æœº
    
    åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸­è¿è¡Œå¤šä¸ªwebç«™ç‚¹ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªç«™ç‚¹å¹¶ä¸ç‹¬ç«‹å ç”¨ä¸€å°çœŸæ­£çš„è®¡ç®—æœº
    
2.  httpæ”¯æŒçš„è™šæ‹Ÿä¸»æœº
    
    1.  åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœº
    2.  åŸºäºIPåœ°å€çš„è™šæ‹Ÿä¸»æœº
    3.  åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº

#### webç«™ç‚¹éƒ¨ç½²

1.  åˆ›å»ºæµ‹è¯•ç«™ç‚¹

> mkdir -p /var/www/html
> 
> mkdir /var/www/html/mpya /var/www/html/mpyb

2.  åˆ›å»ºæµ‹è¯•ç½‘é¡µ

> vim /var/www/html/mpya/index.html
> 
>     <h1>mpya</h1>
>     
> 
> vim /var/www/html/mpyb/index.html
> 
>     <h1>mpya</h1>
>     

3.  ä¿®æ”¹è™šæ‹Ÿä¸»æœºæ–‡ä»¶

> vim /usr/local/httpd/conf/extra/httpd-vhosts.conf
> 
> <VirtualHost 192.168.12.5:80>  
> DocumentRoot "/var/www/html/mpya"  
> ServerName www.mpya.com  
> ServerAlias www.dummy-host.example.com  
> ErrorLog "logs/mpya.com-error\_log"  
> CustomLog "logs/mpya-access\_log" common  
> 
> <VirtualHost 192.168.12.5:80>  
> DocumentRoot "/var/www/html/mpyb"  
> ServerName www.mpyb.com  
> ErrorLog "logs/mpyb-error\_log"  
> CustomLog "logs/mpyb-access\_log" common  

4.  é…ç½®DNS

> vim /var/named/chroot/etc/named.rfc1912.zones

> zone "mpya.com" IN {  
> type master;  
> file "mpya.com.zone";  
> allow-update { none; };  
> };  
> zone "mpyb.com" IN {  
> type master;  
> file "mpyb.com.zone";  
> allow-update { none; };  
> };

> cd /var/named/chroot/var/named
> 
> cp -p alibaba.com.zone mpya.com.zone
> 
> cp -p alibaba.com.zone mpyb.com.zone

> vim mpya.com.zone

> **$TTL 1D  
> @ IN SOA mpya.com. xiaozheng.163.com. (  
> 2022100601 ; serial  
> 1D ; refresh  
> 1H ; retry  
> 1W ; expire  
> 3H ) ; minimum  
> IN NS ns1.mpya.com.  
> ns1 IN A 192.168.12.5  
> www IN A 192.168.12.5**

> vim mpyb.com.zone

> **$TTL 1D  
> @ IN SOA mpyb.com. xiaozheng.163.com. (  
> 2022100601 ; serial  
> 1D ; refresh  
> 1H ; retry  
> 1W ; expire  
> 3H ) ; minimum  
> IN NS ns1.mpyb.com.  
> ns1 IN A 192.168.12.5  
> www IN A 192.168.12.5**

> systemctl restart named-chroot

5.  ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ï¼Œå¼€å¯vhostsçš„æ¨¡å—

> vim /usr/local/httpd/conf/httpd.conf
> 
> å°†æ³¨é‡Šå»æ‰å³å¯\[æœç´¢vhosts\] \[Include conf/extra/httpd-vhosts.conf\]

6.  é‡å¯æœåŠ¡

> /usr/local/httpd/bin/apachectl restart

7.  ç»™ç›®å½•æ·»åŠ æˆæƒ

> vim /usr/local/httpd/conf/extra/httpd-vhosts.conf
> 
> <Directory "/var/www/html">
> 
> require all granted

8.  é‡å¯æœåŠ¡

> /usr/local/httpd/conf/extra/httpd-vhosts.conf

9.  è®¿é—®ç«™ç‚¹\[ä¿®æ”¹DNSä¸º192.168.12.5\]

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214910558-2135366257.png)

awstats
-------

> tar -zxvf awstats-7.3.tar.gz
> 
> cp -r awstats-7.3 /usr/local/awstats
> 
> cd /usr/local/awstats
> 
> chmod +x awstats\_\*

é…ç½® : `awstats_configure.pl`

åˆ·æ–° : `awstats_updateall.pl`

*   ä½¿ç”¨é…ç½®æ–‡ä»¶

> ./awstats\_configure.pl
> 
> ç¬¬ä¸€ä¸ªé—®çš„æ˜¯apacheé…ç½®è·¯å¾„`/usr/local/httpd/conf/httpd.conf`ï¼Œä¹‹åä¸€ç›´y
> 
> ç¬¬äºŒä¸ªé—®çš„æ˜¯è¦ç›‘è§†çš„ç«™ç‚¹å`www.mpya.com`ï¼Œä¹‹åå›è½¦å³å¯

è¿™åªæ˜¯ç›‘è§†äº†ä¸€ä¸ªç«™ç‚¹ï¼Œè¿˜æœ‰ä¸€ä¸ªmpyb.comï¼ŒåŒæ ·çš„æ“ä½œ

*   æŸ¥çœ‹ç”Ÿæˆçš„é…ç½®æ–‡ä»¶

> ls /etc/awstats

*   æ›´æ”¹æ—¥å¿—é…ç½®æ–‡ä»¶

> ls /usr/local/httpd/logs

> vim /etc/awstats/awstats.www.mpya.com.conf
> 
> LogFile="/usr/local/httpd/logs/mpya-access\_log"
> 
> vim /etc/awstats/awstats.www.mpyb.com.conf
> 
> LogFile="/usr/local/httpd/logs/mpyb-access\_log"

*   åˆ›å»ºawstatsä½¿ç”¨çš„æ•°æ®åº“ç›®å½•

> mkdir /var/lib/awstats

*   åˆ·æ–°æ•°æ®

> ./awstats\_updateall.pl now

*   æµ‹è¯•è®¿é—®

> [http://www.mpya.com/awstats/awstats.pl?config=www.mpya.com](http://www.mpya.com/awstats/awstats.pl?config=www.mpya.com)

*   ç»™æƒé™

> vim /usr/local/httpd/conf/httpd.conf
> 
>     <Directory "/usr/local/awstats/wwwroot">
>      Options None
>      AllowOverride None
>      Order allow,deny
>      Allow from all
>     </Directory>
>     
> 
> ä¸Šé¢çš„é…ç½®\[å› ä¸ºç‰ˆæœ¬æ˜¯2.xè¯­æ³•æ”¹å˜ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æ”¹\]æ”¹æˆ
> 
>     <Directory "/usr/local/awstats/wwwroot">
>      Options None
>      AllowOverride None
>      require all granted
>     </Directory>
>     

*   å¼€å¯CGI

> vim /usr/local/httpd/conf/httpd.conf
> 
> `LoadModule cgid_module modules/mod_cgid.so`å‰é¢çš„æ³¨é‡Šå»æ‰

*   å®‰è£…perl

> yum install -y perl\*

*   é‡å¯è®¿é—®

> /usr/local/httpd/bin/apachectl restart
> 
> [http://www.mpya.com/awstats/awstats.pl?config=www.mpya.com](http://www.mpya.com/awstats/awstats.pl?config=www.mpya.com)

*   é™åˆ¶è®¿é—®æºIP
    
    *   ç™½åå•å†™æ³•
    
    > vim /usr/local/httpd/conf/httpd.conf
    > 
    >     <Directory "/usr/local/awstats/wwwroot">
    >     Options None
    >     AllowOverride None
    >     require ip 192.168.12.100 // æ”¹æˆè®¿é—®IPæˆ–è€…ç½‘æ®µ192.168.12
    >     </Directory>
    >     
    
    *   é»‘åå•å†™æ³•
    
    > vim /usr/local/httpd/conf/httpd.conf
    > 
    >     <Directory "/usr/local/awstats/wwwroot">
    >     Options None
    >     AllowOverride None
    >     <RequireAll>
    >     require all granted
    >     require not ip 192.168.12.100
    >     </RequireAll>
    >     </Directory>
    >     
    
    *   ç”¨æˆ·è®¤è¯è®¿é—®
    
    > /usr/local/httpd/bin/htpasswd -c /usr/local/httpd/.mpyapwd zhangsan // ç¬¬ä¸€æ¬¡æ·»åŠ éœ€è¦æ·»åŠ -cå‚æ•°
    > 
    > /usr/local/httpd/bin/htpasswd /usr/local/httpd/.mpyapwd lisi
    
    > vim /usr/local/httpd/conf/httpd.conf
    > 
    >     <Directory "/usr/local/awstats/wwwroot">
    >     Options None
    >     AllowOverride None
    >     <RequireAll>
    >     require all granted
    >     AuthName "welcome"
    >     AuthType Basic
    >     AuthUserFile /usr/local/httpd/.mpyapwd
    >     require valid-user
    >     </RequireAll>
    >     </Directory>
    >     
    
*   å±€éƒ¨è®¤è¯\[Aç½‘ç«™æ­£å¸¸è®¿é—®ï¼ŒBç½‘ç«™éœ€è¦æˆæƒ\]
    
    > vim /usr/local/httpd/conf/extra/httpd-vhosts.conf
    > 
    >     <Directory "/var/www/html">
    >     	<Require>
    >     		require all granted
    >     	</Require>
    >     </Directory>
    >     <Directory "/var/www/html/mpyb">
    >     	<Require>
    >     		require all granted
    >     		AuthName "Welcome"
    >     		AuthType Basic
    >     		AuthUserFile /usr/local/httpd/.mpyapwd
    >     		require valid-user
    >     	</Require>
    >     </Directory>
    >     
    

Nginx
-----

Tomcat
------

squidä»£ç†æœåŠ¡å™¨
----------

å¼€å¯è·¯ç”±è½¬å‘åŠŸèƒ½

> vim /etc/sysctl.conf
> 
> net.ipv4.ip\_forward=1

åˆ·æ–°é…ç½®

> sysctl -p

> ./configure --prefix=/usr/local/squid --sysconfdir=/etc/ --enable-arp-acl --enable-linux-netfilter --enable-linux-tproxy --enable-async-io=100 --enable-err-language="Simplify\_Chinese" --enable-nuderscore --enable-gnuregex

    [root@localhost ~]# tar zxvf squid-3.4.6.tar.gz -C /opt   ###è§£å‹è½¯ä»¶åŒ…
    [root@localhost ~]#cd /opt/
    [root@opt~]#cd squid-3.4.6/
    [root@opt~]#yum -y install gcc gcc-c++ make  ##ä¸‹è½½ç¼–è¯‘å™¨
    [root@squid squid-3.4.6]# ./configure \
    --prefix=/usr/local/squid \    ###å®‰è£…ç›®å½•
    --sysconfdir=/etc \    ###é…ç½®ä½ç½®å­˜åœ¨ç›®å½•
    --enable-arp-acl \    ###å¯ç”¨aclè®¿é—®æ§åˆ¶åˆ—è¡¨
    --enable-linux-netfilter \    ###å†…æ ¸è¿‡æ»¤
    --enable-linux-tproxy \      ###æ”¯æŒé€æ˜ä»£ç†
    --enable-async-io=100 \   ###ioçš„ä¼˜åŒ–
    --enable-err-language="Simplify_Chinese" \   ##æ”¯æŒè¯­è¨€ï¼ŒæŠ¥é”™æç¤ºç®€ä½“ä¸­æ–‡
    --enable-underscore \   ##urlæ”¯æŒä¸‹åˆ’çº¿
    --enable-poll \    ###ä¸€ä¸ªå‡½æ•°    å­—ç¬¦è®¾å¤‡é©±åŠ¨å‡½æ•°
    --enable-gnuregex   ##æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼
    

ç¼–è¯‘

> make
> 
> make install

åˆ›å»ºç”¨æˆ·

> useradd -M -s/sbin/nologin squid

ç»™æƒé™

> chown -R squid:squid /usr/local/squid
> 
> chmod -R 777 /usr/local/squid/var/

å¯åŠ¨æœåŠ¡

> /usr/local/squid/sbin/squid

é…ç½®

> vim /etc/squid.conf
> 
> reply\_body\_max\_size 10 MB
> 
> http\_access allow all

é‡å¯æœåŠ¡

> killall -9 squid
> 
> /usr/local/squid/sbin/squid

è®¾ç½®é€æ˜ä»£ç†

> vim /etc/squid.conf
> 
> http\_port 192.168.12.1:3128 transparent // ä¿®æ”¹ä¸ºå†…ç½‘IP

> killall -9 squid
> 
> /usr/local/squid/sbin/sqiud

> systemctl start firewalld
> 
> iptables -F
> 
> iptables -t nat -I PREROUTING -i eno33 -s 192.168.12.0/24 -p tcp --dport 80 -j REDIRECT --to-ports 3128
> 
> // å¾€natè¡¨ä¸­çš„PREROUTINGé“¾ä¸­æ·»åŠ ä»ens33ç½‘å¡æ¥çš„æºIPåœ°å€ä¸º192.168.12.0ç½‘æ®µçš„å¹¶ä¸”ç›®æ ‡ç«¯å£æ˜¯80è¦é‡å®šå‘ç«¯å£åˆ°3128
> 
> iptables -t nat -I PREROUTING -i eno33 -s 192.168.12.0/24 -p tcp --dport 443 -j REDIRECT --to-ports 3128

shellè„šæœ¬
=======

è„šæœ¬åŸºç¡€è¯­æ³•
------

### åŸºç¡€è¯­æ³•

shellçš„ä½œç”¨ -- å‘½ä»¤è§£é‡Šå™¨ï¼Œä»‹äºç³»ç»Ÿå†…æ ¸å’Œç”¨æˆ·ä¹‹é—´ï¼Œè´Ÿè´£è§£é‡Šå‘½ä»¤è¡Œ

#### è„šæœ¬æ„æˆ

*   è„šæœ¬å£°æ˜\[#!/bin/bash\]
*   æ³¨é‡Šä¿¡æ¯\[#æ³¨é‡Šä¿¡æ¯\]
*   å¯æ‰§è¡Œè¯­å¥

    #!/bin/bash
    #æŸ¥çœ‹ç”µè„‘ç½‘ç»œä¿¡æ¯
    echo -e '\033[32m IP \033[0m'
    sleep 1
    ifconfig | grep inet | grep -v inet6 | awk '{print $2}'
    echo -e '\033[31m NETMASK \033[0m'
    sleep 1
    ifconfig | grep inet | grep -v inet6 | awk '{print $4}' 
    echo -e '\033[31m GATEWAY \033[0m'
    sleep 1
    route -n | grep UG | awk '{print $2}'
    

#### äº¤äº’å¼ç¡¬ä»¶è®¾å¤‡

*   æ ‡å‡†è¾“å…¥ : ä»è¯¥è®¾å¤‡æ¥å—ç”¨æˆ·è¾“å…¥çš„æ•°æ®
*   æ ‡å‡†è¾“å‡º : é€šè¿‡è¯¥è®¾å¤‡å‘ç”¨æˆ·è¾“å‡ºæ•°æ®
*   æ ‡å‡†é”™è¯¯ : é€šè¿‡è¯¥è®¾å¤‡æŠ¥å‘Šæ‰§è¡Œå‡ºé”™ä¿¡æ¯

ç±»å‹

è®¾å¤‡æ–‡ä»¶

æ–‡ä»¶æè¿°ç¼–å·

é»˜è®¤è®¾å¤‡

æ ‡å‡†è¾“å…¥

/dev/stdin

0 "<"

é”®ç›˜

æ ‡å‡†è¾“å‡º

/dev/stdout

1 ">"

æ˜¾ç¤ºå™¨

æ ‡å‡†é”™è¯¯è¾“å‡º

/dev/stderr

2

æ˜¾ç¤ºå™¨

#### é‡å®šå‘æ“ä½œ

ç±»å‹

æ“ä½œç¬¦

ç”¨é€”

é‡å®šå‘è¾“å…¥

<

ä»æŒ‡å®šçš„æ–‡ä»¶è¯»å–æ•°æ®ï¼Œè€Œä¸æ˜¯ä»é”®ç›˜è¾“å…¥

é‡å®šå‘è¾“å‡º

\>  
  
\>>

å°†è¾“å‡ºç»“æœä¿å­˜åˆ°æŒ‡å®šçš„æ–‡ä»¶\[è¦†ç›–åŸæœ‰å†…å®¹\]  
  
å°†è¾“å‡ºç»“æœè¿½åŠ åˆ°æŒ‡å®šçš„æ–‡ä»¶

æ ‡å‡†é”™è¯¯è¾“å‡º

2>  
  
2>>

å°†é”™è¯¯ä¿¡æ¯ä¿å­˜åˆ°æŒ‡å®šçš„æ–‡ä»¶\[è¦†ç›–åŸæœ‰å†…å®¹\]  
  
å°†é”™è¯¯ä¿¡æ¯è¿½åŠ åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­

æ··åˆè¾“å‡º

&>  
  
&>>

å°†æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯çš„å†…å®¹ä¿å­˜åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­\[è¦†ç›–åŸæœ‰å†…å®¹\]  
  
å°†æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯çš„å†…å®¹è¿½åŠ åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­

#### ç®¡é“æ“ä½œç¬¦

"|" : å°†å·¦ä¾§çš„å‘½ä»¤è¾“å‡ºç»“æœï¼Œä½œä¸ºå³ä¾§å‘½ä»¤çš„å¤„ç†å¯¹è±¡

### shellå˜é‡

#### å˜é‡çš„ä½œç”¨

ä¸ºçµæ´»ç®¡ç†linuxç³»ç»Ÿæä¾›ç‰¹å®šå‚æ•°ï¼Œç”±ä¸¤å±‚æ„æ€

*   å˜é‡å : ä½¿ç”¨å›ºå®šçš„åç§°ï¼Œç”±ç³»ç»Ÿé¢„è®¾æˆ–ç”¨æˆ·å®šä¹‰
*   å˜é‡å€¼ : èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·è®¾ç½®ã€ç³»ç»Ÿç¯å¢ƒçš„å˜åŒ–è€Œå˜åŒ–

#### å˜é‡çš„ç±»å‹

*   è‡ªå®šä¹‰å˜é‡ : ç”±ç”¨æˆ·è‡ªå®šä¹‰ã€ä½¿ç”¨å’Œä¿®æ”¹
*   ç¯å¢ƒå˜é‡ : ç”±ç³»ç»Ÿç»´æŠ¤ï¼Œç”¨äºè®¾ç½®å·¥ä½œç¯å¢ƒ
*   ä½ç½®å˜é‡ : é€šè¿‡å‘½ä»¤è¡Œç»™è„šæœ¬ç¨‹åºä¼ é€’å‚æ•°
*   é¢„å®šä¹‰å˜é‡ : Bashä¸­å†…ç½®çš„ä¸€ç±»å˜é‡ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹

### è®¡åˆ’ä»»åŠ¡

è„šæœ¬åˆ†è¯­æ³•
-----

è„šæœ¬å¾ªç¯è¯­æ³•
------

æ­£åˆ™è¡¨è¾¾å¼
-----

ç½‘ç»œ
==

è·¯ç”±

1.  è·¯ç”±

è·¨è¶Šä»æºä¸»æœºåˆ°ç›®æ ‡ä¸»æœºçš„ä¸€ä¸ªäº’è”ç½‘ç»œæ¥è½¬å‘æ•°æ®åŒ…çš„è¿‡ç¨‹

èƒ½å¤Ÿå°†æ•°æ®åŒ…è½¬å‘åˆ°æ­£ç¡®çš„ç›®çš„åœ°ï¼Œå¹¶åœ¨è½¬å‘è¿‡ç¨‹ä¸­é€‰æ‹©æœ€ä½³è·¯å¾„çš„è®¾å¤‡-è·¯ç”±å™¨

2.  è·¯ç”±è¡¨

è·¯ç”±å™¨ä¸­ç»´æŠ¤çš„è·¯ç”±æ¡ç›®çš„é›†åˆ

è·¯ç”±å™¨æ ¹æ®è·¯ç”±è¡¨åšè·¯å¾„é€‰æ‹©

3.  ç›´è¿ç½‘æ®µ

é…ç½®IPåœ°å€ï¼Œç«¯å£UPï¼Œå½¢æˆç›´è¿è·¯ç”±

4.  éç›´è¿ç½‘æ®µ

éœ€è¦é™æ€è·¯ç”±æˆ–åŠ¨æ€è·¯ç”±ï¼Œå°†ç½‘æ®µæ·»åŠ åˆ°è·¯ç”±è¡¨ä¸­

å®éªŒ
==

DNS/DHCP/SAMBA/FTP
------------------

DHCPå’ŒDNSæœåŠ¡å™¨IPåœ°å€ä¸º192.168.18.5ï¼Œè´Ÿè´£ä¸ºå®¢æˆ·æœºåˆ†é…IPåœ°å€ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸ºFTPæœåŠ¡å™¨192.168.18.6è¿›è¡ŒåŸŸåftp.mpy.comè¿›è¡Œåœ°å€è§£æï¼ŒSAMBAå’ŒFTPæœåŠ¡å™¨åœ°å€IPä¸º192.168.18.6ï¼Œ/shareç›®å½•ä¸ºå…¬æœ‰å…±äº«ç›®å½•ï¼Œç‹¬ç«‹æŒ‚è½½åˆ°lvmå·ï¼Œè¿›è¡Œé…ç½®é¢è®¾ç½®listå¯ä»¥ä¸Šä¼ 10ä¸ªæ–‡ä»¶ï¼Œzhangsanç”¨æˆ·åªè¯»ï¼Œlisiç”¨æˆ·è¯»å†™ï¼Œå°†ç”¨æˆ·å®¶ç›®å½•æŒ‚è½½åˆ°lvmå·ï¼Œè¿›è¡Œé…é¢ï¼Œç”¨æˆ·æœ€å¤šä¸Šä¼ 10ä¸ªæ–‡ä»¶

### DHCPå’ŒDNSæœåŠ¡å™¨

å®ç°IPåœ°å€åˆ†å‘å’ŒåŸŸåè§£æ

*   é‡æ–°æŒ‚è½½å…‰ç›˜

> umount /dev/sr0
> 
> mount /dev/sr0 /media

*   å…³é—­é˜²ç«å¢™ã€SELINUX

> systemctl stop firewalld
> 
> setenforec 0
> 
> iptables -F

*   ä¿®æ”¹IP

> vim /etc/sysconfig/network-scripts/ifcfg-xxx
> 
> BOOTPROTO=static
> 
> ONBOOT=yes
> 
> IPADDR=192.168.18.5
> 
> NETMASK=255.255.255.0
> 
> GATEWAY=192.168.18.1
> 
> DNS=192.168.18.5

*   è®¾ç½®yumæœ¬åœ°ä»“åº“

> mkdir /root/yum.bak
> 
> mv /etc/yum.repos/\* /root/yum.bak

*   æ›´æ–°yum

> yum clean all
> 
> yum list

*   å®‰è£…DHCP

> yum install -y dhcp

*   é…ç½®DHCPä¸»æ–‡ä»¶

> vim /etc/dhcp/dhcpd.conf
> 
> :sp /usr/share/doc/dhcp4.xxxxx/dhcpxxxxxx
> 
> æ‰¾åˆ°æ ·æ¿`9yy`å¤åˆ¶åï¼Œ`ctl+w+ä¸‹ç®­å¤´`è°ƒåˆ°é…ç½®ç›®å½•ä¸­ï¼ŒæŒ‰`p`å¤åˆ¶
> 
> subnet 192.168.18.0 netmask 255.255.255.0 {  
> range 192.168.18.10 192.168.18.30;  
> option domain-name-servers 192.168.18.5;  
> option domain-name "internal.example.org";  
> option routers 192.168.18.1;  
> option broadcast-address 192.168.18.255;  
> default-lease-time 600;  
> max-lease-time 7200;  
> }
> 
> host fantasia {  
> hardware ethernet 00:0c:29:7e:b0:9e;  
> fixed-address 192.168.18.6;  
> }

*   å®‰è£…DNSæœåŠ¡

> rpm -ivh bind-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-chroot-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-utils-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-libs-9.9.4-61.el7.x86\_64.rpm

*   é…ç½®æœåŠ¡

> cp -rp /etc/named.\* /var/named/chroot/etc/
> 
> cp -rp /usr/share/doc/bind-9.9.4/sample/var/\* /var/named/chroot/var
> 
> cp -rp /var/named/dynamic /var/named/chroot/var/named
> 
> chown -R :named /var/naemd/chroot/var/named/
> 
> chown -R named /var/named/chroot/var/named/data
> 
> chown -R named /var/named/chroot/var/named/slaves
> 
> chmod 644 /var/named/chroot/var/named/named.\*
> 
> chown -R 770 /var/named/chroot/var/named/data/
> 
> chown -R 770 /var/named/chroot/var/named/slaves/

*   é…ç½®æ–‡ä»¶

> vim /var/named/chroot/etc/named.conf
> 
> // ä¸¤ä¸ªæ¢æˆany
> 
> listen-on port 53 { any; };  
> listen-on-v6 port 53 { ::1; };  
> directory "/var/named";  
> dump-file "/var/named/data/cache\_dump.db";  
> statistics-file "/var/named/data/named\_stats.txt";  
> memstatistics-file "/var/named/data/named\_mem\_stats.txt";  
> allow-query { any; };

> vim /var/named/chroot/etc/named.rfc1912.zones
> 
> // æ­£å‘è§£æ
> 
> zone "mpy.com" IN {  
> type master;  
> file "mpy.com.zone";  
> allow-update { none; };  
> };
> 
> // åå‘è§£æ
> 
> zone "18.168.192.in-addr.arpa" IN {  
> type master;  
> file "18.168.192.in.zone";  
> allow-update { none; };  
> };

*   æ–°å»ºæ–‡ä»¶

> cp -p /var/named/chroot/var/named/named.localhost /var/named/chroot/var/named/mpy.com.zone
> 
> cp -p /var/named/chroot/var/named/named.loopback /var/named/chroot/var/named/18.168.192.in.zone

> vim mpy.com.zone
> 
> **$TTL 1D  
> @ IN SOA mpy.com. mpy.qq.com. (  
> 2022101020 ; serial  
> 1D ; refresh  
> 1H ; retry  
> 1W ; expire  
> 3H ) ; minimum  
> IN NS ns1.mpy.com.  
> ns1 IN A 192.168.18.5  
> ftp IN A 192.168.18.6**

> vim 8.168.192.in.zone
> 
> **TL 1D  
> @ IN SOA mdns.com. mpy.qq.com. (  
> 2022101001 ; serial  
> 1D ; refresh  
> 1H ; retry  
> 1W ; expire  
> 3H ) ; minimum  
> IN NS ns1.mdns.com.  
> ns1 IN A 192.168.18.5  
> 5 IN PTR mpy.mdns.com.**

*   è¿è¡Œnamed

> systemctl start named

*   å¤åˆ¶named.run

> find / -name named.run
> 
> cp -p /var/named/data/named.run /var/named/chroot/var/named/data/

*   è¿è¡Œnamed-chroot

> systemctl start named-chroot

### åˆ¶ä½œlvmå·

åœ¨æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ·»åŠ ç¡¬ç›˜åˆ¶ä½œlvmå·ï¼ŒæŒ‚è½½åˆ°ç›®å½•ï¼Œè®¾ç½®é…é¢

*   åˆ¶ä½œlvmå·ï¼ŒæŒ‚è½½ç›®å½•

> æ–°å¢ä¸¤å—ç¡¬ç›˜
> 
> fdisk -l
> 
> pvcreate /dev/sdb
> 
> vgcreate ctvg /dev/sdb
> 
> lvcreate -l 100 -n sharelv ctvg
> 
> lvcreate -l 100 -n homelv ctvg
> 
> pvcreate /dev/sdc
> 
> vgextend ctvg /dev/sdc
> 
> lvextend -L +200M /dev/ctvg/homelv
> 
> resize2fs /dev/ctvg/homelv
> 
> mkfs.ext4 /dev/ctvg/sharelv
> 
> mkfs.ext4 /dev/ctvg/homelv
> 
> mkdir /share
> 
> mount /dev/ctvg/sharelv /share
> 
> mount /dev/ctvg/homelv /home

*   è®¾ç½®é…é¢

> mount -o remount,usrquota,grpquota /dev/ctvg/sharelv /share
> 
> mount -o remount,usrquota,grpquota /dev/ctvg/homelv /home
> 
> mount | tail -2
> 
> vim /etc/fstab
> 
> // æ·»åŠ ä»¥ä¸‹ä¿¡æ¯
> 
> /dev/ctvg/sharelv/ /share defaults,usrquota,grpquota 0 0
> 
> /dev/ctvg/homelv/ /home defaults,usrquota,grpquota 0 0
> 
> quotacheck -augvc

*   æ–°å»ºç”¨æˆ·

> useradd zhangsan
> 
> passwd zhangsan
> 
> useradd lisi
> 
> passwd lisi

*   å¢åŠ ç”¨æˆ·

> edquota -u zhangsan

    Disk quotas for user zhangsan (uid 1001):
      Filesystem                   blocks       soft       hard     inodes     soft     hard
      /dev/mapper/ctvg-homelv           0          0          0          0        0        10
      /dev/mapper/ctvg-sharelv          0          0          0          0        0        10
    

> edquota -p zhangsan lisi
> 
> edquota -u lisi
> 
> quotaon -ugv /share/

### sambaå’Œvsftp

æ ¹æ®éœ€æ±‚è®¾ç½®è®¿é—®æƒé™

*   æŒ‚è½½é•œåƒæ–‡ä»¶

> umount /dev/sr0
> 
> mount /dev/sr0 /media

*   é…ç½®yumæº

> mkdir /root/yum.bak
> 
> mv /etc/yum.repos.d/\* /root/yum.bak
> 
> vim /etc/yum.repos.d/test.repo
> 
> \[test\]
> 
> name=test
> 
> baseurl=file:///media
> 
> enable=1
> 
> gpgcheck=0

*   å®‰è£…samba

> yum install -y samba

*   å¢åŠ ç”¨æˆ·

> pdbedit -a -u zhangsan
> 
> pdbedit -a -u lisi

*   é…ç½®æ–‡ä»¶

> vim /etc/samba/smb.conf
> 
> \[share\]
> 
> path=/share
> 
> public=yes
> 
> read only=yes
> 
> write list=lisi
> 
> chmod 777 /share
> 
> chmod o+t /share
> 
> systemctl start smb
> 
> systemctl start nmb

DNS/Suid/Web
------------

ä¸»æœº\[192.168.12.10\]è®¿é—®æœåŠ¡å™¨\[202.10.1.10\]ä¼šç»è¿‡ä¸­é—´ä»£ç†æœåŠ¡å™¨\[192.168.12.1å’Œ202.10.1.1\]ï¼Œæ—¥å¿—è®°å½•ä»192.168.12.10è®¿é—®å˜æˆ202.10.1.1è®¿é—®

### DNSç¯å¢ƒã€Webç¯å¢ƒ

202.10.1.10

*   ä¿®æ”¹IPåœ°å€

> vim /etc/sysconfig/network-scripts/ifcfg-ens33
> 
>     IPADDR="202.10.1.10"
>     NETMASK="255.255.255.0"
>     GATEWAY="202.10.1.1"
>     

*   å®‰è£…DNSæœåŠ¡

> rpm -ivh bind-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-chroot-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-utils-9.9.4-61.el7.x86\_64.rpm
> 
> rpm -ivh bind-libs-9.9.4-61.el7.x86\_64.rpm

*   é…ç½®æœåŠ¡

> cp -rp /etc/named.\* /var/named/chroot/etc/
> 
> cp -rp /usr/share/doc/bind-9.9.4/sample/var/\* /var/named/chroot/var
> 
> cp -rp /var/named/dynamic /var/named/chroot/var/named
> 
> chown -R :named /var/naemd/chroot/var/named/
> 
> chown -R named /var/named/chroot/var/named/data
> 
> chown -R named /var/named/chroot/var/named/slaves
> 
> chmod 644 /var/named/chroot/var/named/named.\*
> 
> chown -R 770 /var/named/chroot/var/named/data/
> 
> chown -R 770 /var/named/chroot/var/named/slaves/

*   é…ç½®æ–‡ä»¶

> vim /var/named/chroot/etc/named.conf
> 
> // ä¸¤ä¸ªæ¢æˆany
> 
> listen-on port 53 { any; };  
> listen-on-v6 port 53 { ::1; };  
> directory "/var/named";  
> dump-file "/var/named/data/cache\_dump.db";  
> statistics-file "/var/named/data/named\_stats.txt";  
> memstatistics-file "/var/named/data/named\_mem\_stats.txt";  
> allow-query { any; };

> vim /var/named/chroot/etc/named.rfc1912.zones
> 
> // æ­£å‘è§£æ
> 
> zone "mpya.com" IN {  
> type master;  
> file "mpy.com.zone";  
> allow-update { none; };  
> };
> 
> zone "mpya.com" IN {  
> type master;  
> file "mpy.com.zone";  
> allow-update { none; };  
> };
> 
> // åå‘è§£æ
> 
> zone "1.10.202.in-addr.arpa" IN {  
> type master;  
> file "1.10.202.in.zone";  
> allow-update { none; };  
> };

*   æ–°å»ºæ–‡ä»¶

> cp -p /var/named/chroot/var/named/named.localhost /var/named/chroot/var/named/mpya.com.zone
> 
> cp -p /var/named/chroot/var/named/named.localhost /var/named/chroot/var/named/mpyb.com.zone
> 
> cp -p /var/named/chroot/var/named/named.loopback /var/named/chroot/var/named/1.10.202.in.zone

> vim mpya.com.zone
> 
> **$TTL 1D  
> @ IN SOA mpya.com. xiaozheng.163.com. (  
> 2022100601 ; serial  
> 1D ; refresh  
> 1H ; retry  
> 1W ; expire  
> 3H ) ; minimum  
> IN NS ns1.mpya.com.  
> ns1 IN A 202.10.1.10  
> www IN A 202.10.1.10**

> vim mpyb.com.zone
> 
> **$TTL 1D  
> @ IN SOA mpyb.com. xiaozheng.163.com. (  
> 2022100601 ; serial  
> 1D ; refresh  
> 1H ; retry  
> 1W ; expire  
> 3H ) ; minimum  
> IN NS ns1.mpyb.com.  
> ns1 IN A 202.10.1.10  
> www IN A 202.10.1.10**

> vim 1.10.202.in.zone
> 
> **$TTL 1D  
> @ IN SOA pdns.com. xiaozhang.163.com. (  
> 2022100601 ; serial  
> 1D ; refresh  
> 1H ; retry  
> 1W ; expire  
> 3H ) ; minimum  
> IN NS ns1.pdns.com.  
> ns1 IN A 202.10.1.10  
> 10 IN PTR bj.pdns.com.**

*   è¿è¡Œnamed

> systemctl start named

*   å¤åˆ¶named.run

> find / -name named.run
> 
> cp -p /var/named/data/named.run /var/named/chroot/var/named/data/

*   è¿è¡Œnamed-chroot

> systemctl start named-chroot

*   é…ç½®httpd-2.4.54

> ./configure --prefix=/usr/local/httpd --enable-so --enable-rewrite --enable-charset-lite --enable-cgi

*   å¦‚æœç¼ºä»€ä¹ˆç¯å¢ƒç›´æ¥yumå®‰è£…

> yum install -y apr\*
> 
> yum install -y pcre\*

*   ç¼–è¯‘

> make && make install

*   å¯åŠ¨æœåŠ¡

> /usr/local/httpd/bin/apachectl start
> 
> netstat -anpt | grep 80

*   ä¿®æ”¹é…ç½®æ–‡ä»¶

> vim /usr/local/httpd/conf/httpd.conf
> 
> æ‰¾åˆ°ServerNameï¼Œå°†æ³¨é‡Šå»æ‰

*   è®¾ç½®ç³»ç»ŸæœåŠ¡å¯åŠ¨

> cp /usr/local/httpd/bin/apachectl /etc/init.d/httpd
> 
> å¯åŠ¨æ–¹æ³•ä¸º : service restart httpd

*   åˆ›å»ºæµ‹è¯•ç«™ç‚¹

> mkdir -p /var/www/html
> 
> mkdir /var/www/html/mpya /var/www/html/mpyb

*   åˆ›å»ºæµ‹è¯•ç½‘é¡µ

> vim /var/www/html/mpya/index.html
> 
>     <h1>mpya</h1>
>     
> 
> vim /var/www/html/mpyb/index.html
> 
>     <h1>mpya</h1>
>     

*   ä¿®æ”¹è™šæ‹Ÿä¸»æœºæ–‡ä»¶

> vim /usr/local/httpd/conf/extra/httpd-vhosts.conf
> 
> <VirtualHost 192.168.12.5:80>  
> DocumentRoot "/var/www/html/mpya"  
> ServerName www.mpya.com  
> ServerAlias www.dummy-host.example.com  
> ErrorLog "logs/mpya.com-error\_log"  
> CustomLog "logs/mpya-access\_log" common  
> 
> <VirtualHost 192.168.12.5:80>  
> DocumentRoot "/var/www/html/mpyb"  
> ServerName www.mpyb.com  
> ErrorLog "logs/mpyb-error\_log"  
> CustomLog "logs/mpyb-access\_log" common  

*   ä¿®æ”¹ä¸»é…ç½®æ–‡ä»¶ï¼Œå¼€å¯vhostsçš„æ¨¡å—

> vim /usr/local/httpd/conf/httpd.conf
> 
> å°†æ³¨é‡Šå»æ‰å³å¯\[æœç´¢vhosts\] \[Include conf/extra/httpd-vhosts.conf\]

*   é‡å¯æœåŠ¡

> /usr/local/httpd/bin/apachectl restart

*   ç»™ç›®å½•æ·»åŠ æˆæƒ

> vim /usr/local/httpd/conf/extra/httpd-vhosts.conf
> 
> <Directory "/var/www/html">
> 
> require all granted

*   é‡å¯æœåŠ¡

> /usr/local/httpd/conf/extra/httpd-vhosts.conf

*   è®¿é—®ç«™ç‚¹\[ä¿®æ”¹DNSä¸º202.10.1.10\]

### å®‰è£…squid

192.168.12.1 / 202.10.1.1

*   è®¾ç½®ä¸¤å—ç½‘å¡

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214922302-1697693447.png)

*   é…ç½®IP

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214933454-1867308298.png)

*   å®‰è£…squid

> ./configure --prefix=/usr/local/squid --sysconfdir=/etc/ --enable-arp-acl --enable-linux-netfilter --enable-linux-tproxy --enable-async-io=100 --enable-err-language="Simplify\_Chinese" --enable-nuderscore --enable-gnuregex

*   ç¼–è¯‘

> make
> 
> make install

*   åˆ›å»ºç”¨æˆ·

> useradd -M -s/sbin/nologin squid

*   ç»™æƒé™

> chown -R squid:squid /usr/local/squid
> 
> chmod -R 777 /usr/local/squid/var/

*   å¯åŠ¨æœåŠ¡

> /usr/local/squid/sbin/squid

*   é…ç½®

> vim /etc/squid.conf
> 
> reply\_body\_max\_size 10 MB
> 
> http\_access allow all

*   é‡å¯æœåŠ¡

> killall -9 squid
> 
> /usr/local/squid/sbin/squid

*   è®¾ç½®é€æ˜ä»£ç†

> vim /etc/squid.conf
> 
> http\_port 192.168.12.1:3128 transparent // ä¿®æ”¹ä¸ºå†…ç½‘IP

> killall -9 squid
> 
> /usr/local/squid/sbin/sqiud

*   è®¾ç½®é˜²ç«å¢™

> systemctl start firewalld
> 
> iptables -F
> 
> iptables -t nat -I PREROUTING -i eno33 -s 192.168.12.0/24 -p tcp --dport 80 -j REDIRECT --to-ports 3128
> 
> // å¾€natè¡¨ä¸­çš„PREROUTINGé“¾ä¸­æ·»åŠ ä»ens33ç½‘å¡æ¥çš„æºIPåœ°å€ä¸º192.168.12.0ç½‘æ®µçš„å¹¶ä¸”ç›®æ ‡ç«¯å£æ˜¯80è¦é‡å®šå‘ç«¯å£åˆ°3128
> 
> iptables -t nat -I PREROUTING -i eno33 -s 192.168.12.0/24 -p tcp --dport 443 -j REDIRECT --to-ports 3128

### è·¨ç½‘æ®µpingé€š

å¼€å¯è·¯ç”±è½¬å‘åŠŸèƒ½\[192.168.12.1 / 202.10.1.1\]

> vim /etc/sysctl.conf
> 
> net.ipv4.ip\_forward=1

### å®¢æˆ·ç«¯è®¾ç½®

*   åœ¨èƒ½pingé€šçš„æƒ…å†µä¸‹ä¿®æ”¹DNSä¸º202.10.1.10

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214947905-617176069.png)

*   åœ¨ä¸è®¾ç½®é€æ˜ä»£ç†çš„æƒ…å†µä¸‹\[192.168.12.1 / 202.10.1.1ä¿®æ”¹/etc/squid.conf ä¸­çš„http\_portä¸º3128\]å»è®¿é—®ä¸¤ä¸ªç½‘ç«™

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017214955787-1500259211.png)

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017215007452-1270384716.png)

æ˜¯å®¢æˆ·ç«¯ç›´æ¥å»è®¿é—®

*   è®¾ç½®ä»£ç†æˆ–é€æ˜ä»£ç†

![](https://img2022.cnblogs.com/blog/2857712/202210/2857712-20221017215016937-377875267.png)