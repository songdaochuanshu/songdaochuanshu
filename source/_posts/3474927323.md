---
layout: post
title: ".Net Coreåç«¯æ¶æ„å®æˆ˜ã€1-é¡¹ç›®åˆ†å±‚æ¡†æ¶è®¾è®¡ã€‘"
date: "2023-02-14T17:15:55.024Z"
---
.Net Coreåç«¯æ¶æ„å®æˆ˜ã€1-é¡¹ç›®åˆ†å±‚æ¡†æ¶è®¾è®¡ã€‘
===========================

> æ‘˜è¦ï¼šåŸºäº.NET Core 7.0WebApiåç«¯æ¶æ„å®æˆ˜ã€1-é¡¹ç›®ç»“æ„åˆ†å±‚è®¾è®¡ã€‘Â Â 2023/02/05, ASP.NET Core 7.0, VS2022

å¼•è¨€
--

    ä»å®ä¹ åˆ°ç°åœ¨å›æƒ³è‡ªå·±å·²ç»å…¥è¡Œå››å¹´äº†ï¼Œå¾ˆåº†å¹¸è‡ªå·±ä¸€ç›´è¿˜æ˜¯ä»äº‹ç€å¼€å‘çš„å·¥ä½œã€‚è¿™å‡ å¹´ä¸ç®¡æ˜¯å·¥ä½œè¿˜æ˜¯ç”Ÿæ´»éƒ½æœ‰å¾ˆå¤šä¸ç”˜ä¸å¤±è½è¿˜æœ‰  
æ”¶è·ï¼Œä»å­¦æ ¡å‡ºæ¥ä¹‹åæœ‰æ—¶å€™è§‰å¾—è‡ªå·±çš„å¿ƒæ€å—ä¸äº†å°å°çš„æ‰“å‡»ï¼Œå¯èƒ½å°±åƒå¹³å‡¡çš„ä¸–ç•Œä¸­çš„å­™å°‘å¹³ä¸€æ ·ï¼Œæœ‰ç€ä¸€é¢—æ•æ„Ÿè€Œè„†å¼±çš„è‡ªå°Šå¿ƒã€‚æ˜¥  
ç§ä¸€ç²’ç²Ÿï¼Œç§‹æ”¶ä¸‡é¢—å­ã€‚ä»2021å¹´1æœˆä»½åˆ°ç°åœ¨ä¸€ç›´æ²¡æœ‰æ›´æ–°è¿‡åšå®¢ï¼Œåœ¨è¿™ä¸ªæ’­ç§çš„å­£èŠ‚æˆ‘æƒ³æˆ‘åº”è¯¥è¦æ€»ç»“ä¸€ä¸‹è¿‡å»çš„æŠ€æœ¯ç»éªŒï¼Œå¯¹è‡ªå·±æ˜¯æ  
å‡ï¼Œå¯¹åˆ«äººå¯èƒ½æˆ–å¤šæˆ–å°‘éƒ½æœ‰å¸®åŠ©ã€‚é˜¿é‡Œå·´å·´å¤§ç¥æ¯•ç„æ›¾è¯´è¿‡ï¼Œâ€œä¸€ä¸ªä¼˜ç§€çš„å·¥ç¨‹å¸ˆå’Œä¸€ä¸ªæ™®é€šå·¥ç¨‹å¸ˆçš„åŒºåˆ«ï¼Œä¸æ˜¯æ»¡å¤©é£çš„æ¶æ„å›¾ï¼Œä»–çš„åŠŸ  
åº•ä½“ç°åœ¨æ‰€å†™çš„æ¯ä¸€è¡Œä»£ç ä¸Šâ€ã€‚è¿™å¥è¯æˆ‘ä¸è¯¸å›å…±æ€å…±å‹‰ï¼

åˆ†å±‚ç›®æ ‡
----

*   å¤§é“è‡³ç®€ï¼šèƒ½æé«˜å¼€å‘æ•ˆç‡ï¼Œè®©åˆšè¿›å…¬å¸çš„å®ä¹ ç”Ÿä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹CRUD
*   ç»“æ„æ¸…æ™°ï¼šä¸ä»…è¦éµå¾ªDIPåŸåˆ™ï¼ˆé™ä½è€¦åˆï¼‰ï¼Œè€Œä¸”ä¹Ÿè¦ä¿è¯æ¯ä¸€å±‚æˆ–æ¯ä¸€ä¸ªç±»åº“èŒè´£å•ä¸€ï¼Œå‡å°‘åæœŸç»´æŠ¤æˆæœ¬
*   æ‰©å±•/å¤ç”¨ï¼šåˆ†å±‚ä¹‹åæœ‰å¾ˆé«˜çš„å¤ç”¨æ€§å’Œæ›´æ–¹ä¾¿çš„æ¨ªå‘æ‰©å±•æ€§

### ä¼ ç»Ÿä¸‰å±‚æ¶æ„

ä¼ ç»Ÿçš„ä¸‰å±‚æ¶æ„ï¼šè¡¨ç°å±‚ã€ä¸šåŠ¡é€»è¾‘å±‚å’Œæ•°æ®è®¿é—®å±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230209194207497-1227078460.png)

### DDDå››å±‚æ¶æ„

Â åŸºäºDDDçš„å››å±‚æ¶æ„ï¼šç”¨æˆ·æ¥å£å±‚ã€åº”ç”¨å±‚ã€é¢†åŸŸå±‚å’ŒåŸºç¡€è®¾æ–½å±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230207201219722-896580178.png)

ä¸ä¼ ç»Ÿçš„ä¸‰å±‚æ¶æ„ç›¸æ¯”DDDçš„åˆ†å±‚æ¶æ„å°†ä¸šåŠ¡é€»è¾‘å±‚æ‹†ä¸ºäº†åº”ç”¨å±‚ä¸é¢†åŸŸå±‚

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230209202017843-28958256.png)

ä¸‹æ–¹å·¦å›¾ä¸ºä¼ ç»Ÿå››å±‚æ¶æ„ï¼Œå³å›¾ä¸ºä¾èµ–å€’ç½®åçš„å››å±‚æ¶æ„ã€‚åº”ç”¨å±‚ä¸é¢†åŸŸå±‚æä¾›æ¥å£ï¼ŒåŸºç¡€è®¾æ–½å±‚æä¾›å®ç°ã€‚é¢†åŸŸå±‚ä¸ä¾èµ–ä»»ä½•ä¸€å±‚ï¼Œåªä¸“æ³¨ä¸ä¸šåŠ¡ã€‚ä¸ªäººè®¤ä¸ºåŸºç¡€è®¾æ–½å±‚è¿­ä»£é¢‘ç‡è¦ä½äºæ¥å£å±‚ï¼ŒæŠ½è±¡ç¨‹åº¦é«˜äºè¡¨ç°å±‚ã€‚æ‰€ä»¥è®©è¡¨ç°å±‚ä¾èµ–åŸºç¡€è®¾æ–½å±‚æ›´åˆé€‚ã€‚

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230212161951640-1702120875.png)

> æˆ‘çš„æœ¬ç³»åˆ—åšå®¢å¯¹åº”çš„é¡¹ç›®ä¹Ÿæ˜¯åŸºäºDDDçš„æ¶æ„æ€æƒ³ï¼Œå½“ç„¶ä¹Ÿä¼šåŠ å…¥è‡ªå·±çš„ä¸€äº›æƒ³æ³•åœ¨å…¶ä¸­ã€‚
> 
> æƒ³å­¦ä¹ é¢†åŸŸé©±åŠ¨è®¾è®¡çš„åŒå­¦å¯ç§»æ­¥[ã€ŠDDD å®æˆ˜è¯¾ã€‹](https://time.geekbang.org/column/article/149941)

é¡¹ç›®ç»“æ„
----

æ•´ä½“é¡¹ç›®ç»“æ„å¦‚ä¸‹æ–¹ä¸‰å¼ å›¾æ‰€ç¤ºï¼š

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230213203101647-406571170.png)

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230212165751044-2110831998.png)

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230212165816195-776602294.png)

### å±‚çº§ä»‹ç»

`1.ICore.WebApi`è¿™ä¸€å±‚ä¸»è¦æ„å»º RESTful åº”ç”¨ç¨‹åºï¼Œæä¾›HTTPæœåŠ¡ã€‚ç®¡é“ä¸­é—´ä»¶ã€è¿‡æ»¤å™¨ã€è·¨åŸŸã€è·¯ç”±ã€æ¨¡å‹éªŒè¯ç­‰éƒ½åœ¨æ­¤é…ç½®ã€‚

`2.ICore.Application`è¿™ä¸€å±‚å¾ˆè–„ï¼Œä¸ä¼šåŒ…å«ä»»ä½•ä¸ä¸šåŠ¡æœ‰å…³çš„é€»è¾‘ä¿¡æ¯ï¼Œå°†ä½¿ç”¨CQRSçš„è®¾è®¡æ¨¡å¼ã€‚å®‰å…¨è®¤è¯ã€æƒé™æ ¡éªŒã€äº‹åŠ¡æ§åˆ¶ã€å‘é€æˆ–è®¢é˜…é¢†åŸŸäº‹ä»¶ç­‰éƒ½å¯åœ¨æ­¤å±‚åšå¤„ç†ã€‚

`3.ICore.Task`è¿™ä¸€å±‚ä¸»è¦ç”¨äºå¤„ç†ç³»ç»Ÿå†…å°å‹å®šæ—¶ä»»åŠ¡ã€‚ç¹å¤šã€å¤æ‚çš„å®šæ—¶ä»»åŠ¡å»ºè®®ç”¨ç¬¬ä¸‰æ–¹è°ƒåº¦å¹³å°ï¼Œä¾‹å¦‚ï¼šXXL-JOBã€‚

`4.ICore.Domain.Core`è¿™ä¸€å±‚ä¸»è¦ç”¨äºå®ç°æ ¸å¿ƒçš„ä¸šåŠ¡é€»è¾‘ï¼å†…éƒ¨ä¸»è¦åŒ…å«Entityï¼ˆå®ä½“ï¼‰ã€Domain Eventï¼ˆé¢†åŸŸäº‹ä»¶ï¼‰ã€Domain Serviceï¼ˆé¢†åŸŸæœåŠ¡ï¼‰ç­‰ã€‚

`5.ICore.Domain.Abstractions`è¿™ä¸€å±‚ä¸»è¦ç”¨äºå®šä¹‰ä¸€äº›åŸºç±»çš„æ¥å£å’Œé¢†åŸŸäº‹ä»¶çš„æ¥å£ã€‚ä¾‹å¦‚ï¼šIAggregateRootèšåˆæ ¹æ¥å£ã€IEntityã€IEntity<TKey>Â å®ä½“æ¥å£ç­‰ã€‚

`6.ICore.Infrastructure.Core`è¿™ä¸€å±‚ä¸»è¦å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºæä¾›åŸºç¡€å®ç°ï¼Œä¾‹å¦‚ä»“å‚¨çš„å®ç°ã€å·¥ä½œå•å…ƒæ¨¡å¼çš„å®ç°ã€Redisç¼“å­˜ã€é˜Ÿåˆ—æœåŠ¡ç­‰ã€‚

`7.ICore.Test`è¿™ä¸€å±‚ä¸»è¦ç”¨äºå¯¹æ•´ä¸ªç¨‹åºçš„å•å…ƒæµ‹è¯•ï¼Œå‡å°‘ä¸å¿…è¦çš„BUGä»¥åŠæé«˜æµ‹è¯•æ•ˆç‡ã€‚

### å…¶å®ƒè§„èŒƒ

#### ç¼–ç ã€æ ¼å¼è§„èŒƒ

æˆ‘å¼ºçƒˆå»ºè®®å¤§å®¶çœ‹é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œï¼Œä»¥ä¸Šé¢çš„è§„èŒƒæ¥çº¦æŸè‡ªå·±çš„ç¼–ç ã€‚

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230212212758531-1998705236.jpg)

#### é…ç½®æ–‡ä»¶è§„èŒƒ

*   å…¨éƒ¨é‡‡ç”¨jsonæ ¼å¼æ–‡ä»¶
*   å»ºç«‹æ˜ å°„ç±»ï¼Œä½¿ç”¨IOptions<T>æ–¹å¼è¯»å–é…ç½®ä¿¡æ¯
*   æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€æ•°æ®ä¼ è¾“çš„åŠ å¯†å¯†é’¥ç­‰ä¸å»ºè®®å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œåº”æ”¾åˆ°åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒä¸­

#### å®‰å…¨è§„èŒƒï¼ˆåªåˆ—ä¸¾éƒ¨åˆ†ï¼‰

*   åŠ å…¥æ¶æ„è¯·æ±‚IPé»‘åå•
*   é˜²SQLæ³¨å…¥æ”»å‡»
*   æ—¥å¿—åº”è®°å½•è¯·æ±‚æ—¶é—´ã€æ“ä½œäººIDã€IPåœ°å€ã€æ˜¯å¦æˆåŠŸç­‰é‡è¦ä¿¡æ¯
*   CORSç­–ç•¥åº”åŠ ä¸Šç™½åå•é™åˆ¶
*   ç”Ÿäº§ç¯å¢ƒçš„æ¥å£æ–‡æ¡£ä¸å¯¹å¤–æš´éœ²

å¯åŠ¨é¡¹ç›®
----

é¦–å…ˆ.Net CoreåŒSpring Bootä¸€æ ·éƒ½æ˜¯è‡ªå®¿ä¸»ç¨‹åºï¼Œå…¶ä¸æ˜¯å¿…éœ€åœ¨IISå†…éƒ¨æ‰˜ç®¡ã€‚å®ç°è·¨å¹³å°ç¦»ä¸å¼€.Net Coreå†…ç½®çš„kestrelé«˜æ€§èƒ½æœåŠ¡å™¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆå›¾ç‰‡æ¥è‡ªå®˜ç½‘ï¼‰:

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230214203432394-1029734775.png)

### ä¿®æ”¹ç«¯å£

1ã€åœ¨`launchSettings.json`æ–‡ä»¶ä¸­ä¿®æ”¹ç«™ç‚¹ä¿¡æ¯ï¼ŒæŠŠIIS ExpressèŠ‚ç‚¹åˆ æ‰

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230214205131200-1101280664.jpg)

2ã€åœ¨`appsettings.json`ä¸­è®¾ç½®å¯åŠ¨ç«¯å£

    "Kestrel": {
      "Endpoints": {
        "Https": {
          "Url": "https://*:8000"
        },
        "Http": {
          "Url": "http://*:8001"
        }
      }
    }

3ã€åœ¨`Program`ä¸­è®¾ç½®å¯åŠ¨ç«¯å£

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230214211432159-1387596312.png)

    app.Run("http://*:8001");

### åŠ å…¥Startup.cs

ä».Net6.0å¼€å§‹å·²å»é™¤äº†Startup.cs æ–‡ä»¶ï¼Œä¾èµ–æ³¨å…¥æœåŠ¡å’ŒMiddlewareå…¨åœ¨Program.csä¸­é…ç½®ã€‚

æˆ‘ä»å†™.Net Core2.0å¼€å§‹ä¸€ç›´åˆ°ç°åœ¨ï¼ŒStartup.csæ–‡ä»¶æˆ‘è§‰å¾—è¿˜æ˜¯æœ‰å¿…è¦å­˜åœ¨ï¼Œä¸ªäººä½¿ç”¨ä¹ æƒ¯è€Œå·²ğŸ˜‰

#### æ”¹é€ Program.cs

    using ICore.WebApi;
    
    var builder = WebApplication.CreateBuilder(args);
    var startup = new Startup(builder.Configuration);
    
    startup.ConfigureServices(builder.Services);
    startup.Configure(builder.Build());

#### é‡å†™Startup.cs

    namespace ICore.WebApi
    {
        public class Startup
        {
            public IConfiguration Configuration { get; }
            public Startup(IConfiguration configuration) => Configuration = configuration;
    
            // This method gets called by the runtime. Use this method to add services to the container.
            public void ConfigureServices(IServiceCollection services)
            {
                services.AddControllers();
                // Learn more about configuring Swagger/OpenAPI at https://aka.ms/aspnetcore/swashbuckle
                services.AddEndpointsApiExplorer();
                services.AddSwaggerGen();
            }
    
            // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
            public void Configure(WebApplication app)
            {
                if (app.Environment.IsDevelopment())
                {
                    app.UseSwagger();
                    app.UseSwaggerUI();
                }
    
                app.UseAuthorization();
    
                app.MapControllers();
    
                app.Run("http://*:8001");
            }
        }
    }

### Runèµ·æ¥ï¼

ä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨`dotnet ICore.WebApi.dll --urls="http://*:8001" --ip="127.0.0.1" --port=8001`

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230214220946843-1407285964.png)

![](https://img2023.cnblogs.com/blog/1677460/202302/1677460-20230214220511795-1017939631.png)

è¿™ä¸€èŠ‚å°±åˆ°è¿™é‡Œï¼Œåé¢ä¼šç»§ç»­ä¸Šæ–°ï¼ğŸ˜Š