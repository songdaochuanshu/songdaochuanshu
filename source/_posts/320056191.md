---
layout: post
title: "如何编写测试团队通用的Jmeter脚本"
date: "2022-07-13T08:24:11.973Z"
---
如何编写测试团队通用的Jmeter脚本
===================

平时学习、工作过程中，编写的一些jmeter脚本，相信大多数都遇到过这个问题。那就是：如果换一台电脑运行，文件路径不一样，会导致运行失败。

前不久，自己就真真切切遇到过一回，A同学写了个脚本用于压测，需要其他测试同学协助下，结果部分人员没有提前调试代码，导致运行的时候报错。

主要的原因就是，A同学写的脚本不能通用，以自己本机的路径来编写的，而其他同学的文件路径不一样，导致报错。

后面我实在看不下去了，把脚本改动了下，压测顺利结束。

那么这个问题是否有解决的办法呢，自然是有的，而且很简单。

我们来看详细

获取文件目录
------

### 用户定义变量

我们先来看第一种方式，直接使用beanshell函数，将变量放到用户定义的变量中，如下所示；脚本运行后，可以在日志中查看到获取到的脚本路径。

![](https://img2022.cnblogs.com/blog/1242227/202205/1242227-20220517232518320-538044689.png)

代码如下所示：

    ${__BeanShell(import org.apache.jmeter.services.FileServer;FileServer.getFileServer().getBaseDir();,)}
    
    

添加的这行代码，后续直接用shellPath字段来替换掉固定文件path就ok了

### beanshell处理器

在线程组中添加beanshell后置处理器，配置如下：

![](https://img2022.cnblogs.com/blog/1242227/202205/1242227-20220517231802104-896873982.png)

代码如下所示：

    import org.apache.jmeter.services.FileServer;
    
    String path = FileServer.getFileServer().getBaseDir();
    
    log.info(path);
    
    

HTTP默认请求头
---------

通常一个脚本中，不止一个接口请求。我们每个请求都得有host、protocol，如果这些通用参数都写在每个请求里，变动一次，那这改动量可就太大了。

对于这个问题，我们可以使用HTTP默认请求头，将host、protocol配置好，在后续的请求中就不会再填写host、protocol。

如果参数有改动，那也只需要改动一次而已，大大提高效率。配置如下所示：

![](https://img2022.cnblogs.com/blog/1242227/202205/1242227-20220517232635425-53235688.png)

功能应用
----

针对开篇讲到的案列，问题出现点，我们来一一解答

### CSV参数化

脚本是打包在一个文件夹传递的，脚本中引用一个参数化文件。文件的路径为A同学的固定路径，可其他同学拿到脚本，存放的路径并不一致，那直接运行的话，必然会报错。

对于这个点，我们来改造如下，脚本路径使用变量shellPath替换即可，如下所示：

![](https://img2022.cnblogs.com/blog/1242227/202206/1242227-20220617213511776-1141570887.png)

### 附件上传

脚本中还有个附件上传请求，文件路径也是固定的，同理，用我们定义的变量shellPath替换即可，如下所示：

![](https://img2022.cnblogs.com/blog/1242227/202206/1242227-20220617214136878-434987454.png)

### 删除数据

脚本运行过程中，会保存一些字段数据，但为了不影响新一轮测试，所以在测试前，会把历史数据给删除。

同样的，我们要删除的文件路径也替换成变量shellPath，如下所示：

![](https://img2022.cnblogs.com/blog/1242227/202206/1242227-20220622194757793-1546639326.png)

以上只是jmeter使用中很简单的功能，虽然简单，但作用却很大。

如果脚本不通用，即使在自己电脑上正常运行，换一台设备，就又得再调试，不是我们想要的效果。

在编写脚本时，还是需要编写通用的脚本，一些小细节，忽略不得。