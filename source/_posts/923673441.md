---
layout: post
title: "svelteç»„ä»¶ï¼šsvelte3.xè‡ªå®šä¹‰ç¾åŒ–è™šæ‹Ÿæ»šåŠ¨æ¡ç»„ä»¶svelte-scrollbar"
date: "2022-05-06T20:20:35.378Z"
---
svelteç»„ä»¶ï¼šsvelte3.xè‡ªå®šä¹‰ç¾åŒ–è™šæ‹Ÿæ»šåŠ¨æ¡ç»„ä»¶svelte-scrollbar
==============================================

åŸºäºsvelte3.0è‡ªå®šä¹‰pcç«¯è™šæ‹Ÿæ»šåŠ¨æ¡ç»„ä»¶_svelteScrollbar_ã€‚

**svelte-scrollbar**ï¼šè¿ç”¨svelte3.xåˆ›å»ºçš„æ¡Œé¢pcç‰ˆè‡ªå®šä¹‰ç¾åŒ–æ»šåŠ¨æ¡ç»„ä»¶ã€‚æ”¯æŒæ˜¯å¦åŸç”Ÿæ»šåŠ¨æ¡ã€è‡ªåŠ¨éšè—ã€æ°´å¹³+å‚ç›´æ»šåŠ¨(æ»šè½®æ»‘åŠ¨)ã€è‡ªå®šä¹‰æ»šåŠ¨æ¡å¤§å°ã€èƒŒæ™¯è‰²ã€é—´è·åŠåŠ¨æ€å®æ—¶æ›´æ–°ç­‰åŠŸèƒ½ã€‚

![](https://img2022.cnblogs.com/blog/1289798/202205/1289798-20220506224651624-1230571157.png)

svelteScrollbaråŠŸèƒ½åŠæ•ˆæœæœ‰äº›ç±»ä¼¼elementUIç»„ä»¶åº“ä¸­çš„_el-scrollbar_ç»„ä»¶ã€‚

![](https://img2022.cnblogs.com/blog/1289798/202205/1289798-20220506225059401-335781186.gif)

### **â—† å¼•å…¥ä½¿ç”¨**

åœ¨éœ€è¦ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æ¡çš„é¡µé¢å¼•å…¥ç»„ä»¶ã€‚

import Scrollbar from '$lib/Scrollbar'

![](https://img2022.cnblogs.com/blog/1289798/202205/1289798-20220506225510018-1754937803.gif)

### **â—† å¿«é€Ÿä½¿ç”¨**

ä½¿ç”¨Â <Scrollbar></Scrollbar>Â åŒ…ä½çš„å†…å®¹ï¼Œå³å¯å¿«é€Ÿç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿæ»šåŠ¨æ¡ç»„ä»¶ã€‚

<!-- //åŸç”Ÿæ»šåŠ¨æ¡ \-->
<Scrollbar native\>
    <div\>è‡ªå®šä¹‰å†…å®¹ä¿¡æ¯ã€‚</div\>
</Scrollbar\>

<!-- //è‡ªåŠ¨éšè—æ»šåŠ¨æ¡ \-->
<Scrollbar autohide\={true}\>
    <div\>è‡ªå®šä¹‰å†…å®¹ä¿¡æ¯ã€‚</div\>
</Scrollbar\>

<!-- //æ°´å¹³æ»šåŠ¨æ¡ï¼ˆæ”¯æŒæ»šè½®æ»‘åŠ¨ï¼‰ \-->
<Scrollbar mousewheel\>
    <div\>è‡ªå®šä¹‰å†…å®¹ä¿¡æ¯ã€‚</div\>
</Scrollbar\>

<!-- //è‡ªå®šä¹‰é«˜åº¦/æœ€å¤§é«˜åº¦ \-->
<Scrollbar height\="200" maxHeight\="350"\>
    <div\>è‡ªå®šä¹‰å†…å®¹ä¿¡æ¯ã€‚</div\>
</Scrollbar\>

<!-- //è‡ªå®šä¹‰å¤§å°/é—´éš™/é¢œè‰² \-->
<Scrollbar size\="10px" gap\="5" color\="#09f"\>
    <div\>è‡ªå®šä¹‰å†…å®¹ä¿¡æ¯ã€‚</div\>
</Scrollbar\>

![](https://img2022.cnblogs.com/blog/1289798/202205/1289798-20220506230738013-471457586.gif)

![](https://img2022.cnblogs.com/blog/1289798/202205/1289798-20220506230755705-743828386.gif)

![](https://img2022.cnblogs.com/blog/1289798/202205/1289798-20220506230821950-783075663.gif)

![](https://img2022.cnblogs.com/blog/1289798/202205/1289798-20220506230913882-2109407107.gif)

### **â—† å®ç°è¿‡ç¨‹**

svelteScrollbaræ”¯æŒå¦‚ä¸‹è‡ªå®šä¹‰å‚æ•°é…ç½®ã€‚

<script>
    // æ˜¯å¦å¼€å¯åŸç”Ÿæ»šåŠ¨æ¡
    export let native = false
    // æ˜¯å¦è‡ªåŠ¨éšè—æ»šåŠ¨æ¡
    export let autohide = false
    // æ»šåŠ¨æ¡å°ºå¯¸
    export let size = undefined
    // æ»šåŠ¨æ¡é¢œè‰²
    export let color = ''
    // æ»šåŠ¨æ¡å±‚å 
    export let zIndex = null
    // æ»šåŠ¨æ¡åŒºåŸŸé«˜åº¦
    export let height = undefined
    // æ»šåŠ¨æ¡åŒºåŸŸæœ€å¤§é«˜åº¦
    export let maxHeight = undefined
    // æ»šåŠ¨æ¡é—´éš™
    export let gap = 0
    // æ˜¯å¦å¼€å¯æ°´å¹³æ»šè½®æ»šåŠ¨æ§åˆ¶
    export let mousewheel = false
    
    ...
</script>

ç»„ä»¶æ¨¡æ¿åŠjsé€»è¾‘å¤„ç†éƒ¨åˆ†ã€‚

<div class\="vui\_\_scrollbar" bind:this\={el} on:mouseenter\={handleMouseEnter} on:mouseleave\={handleMouseLeave}\>
    <div class\="vscroll\_\_wrap" class:hidenative\={!bool(native)} bind:this\={wrap} on:scroll\={handleScroll} on:mousewheel\={handleMouseWheel} style\="{wrapStyle}"\>
        <slot />
    </div\>
    <div class\="vscroll\_\_bar vertical" class:ishide\={!data.isShowBar} on:mousedown\={e =\> handleClickTrack(e, 0)} >
        <div class\="vscroll\_\_thumb" bind:this\={barY} style\="background: {color}; height: {data.barHeight}px; width: {addUnit(size)}" on:mousedown\={e =\> handleDragThumb(e, 0)}></div\>
    </div\>
    <div class\="vscroll\_\_bar horizontal" class:ishide\={!data.isShowBar} on:mousedown\={e =\> handleClickTrack(e, 1)}>
        <div class\="vscroll\_\_thumb" bind:this\={barX} style\="background: {color}; width: {data.barWidth}px; height: {addUnit(size)}" on:mousedown\={e =\> handleDragThumb(e, 1)}></div\>
    </div\>
</div\>

<script\>
    /\*\*
     \* @Desc     svelte3.xæ¡Œé¢ç«¯è™šæ‹Ÿæ»šåŠ¨æ¡ç»„ä»¶SvelteScrollbar
     \* @Time     andy by 2022-05
     \* @About    Qï¼š282310962  wxï¼šxy190310
     \*/
     
    // ...
    import { onMount, afterUpdate, createEventDispatcher, tick } from 'svelte'
    const dispatch \= createEventDispatcher()

    import util from './util'

    $: data \= {
        // æ»šåŠ¨æ¡å®½åº¦
        barWidth: 0,
        // æ»šåŠ¨æ¡é«˜åº¦
        barHeight: 0,
        // æ»šåŠ¨æ¡æ°´å¹³åç§»ç‡
        ratioX: 1,
        // æ»šåŠ¨æ¡å‚ç›´åç§»ç‡
        ratioY: 1,
        // é¼ æ ‡æ˜¯å¦æŒ‰ä½æ»šåŠ¨æ¡
        isTaped: false,
        // é¼ æ ‡æ˜¯å¦æ‚¬åœäºæ»šåŠ¨åŒºåŸŸ
        isHover: false,
        // æ˜¾ç¤ºæ»šåŠ¨æ¡
        isShowBar: !bool(autohide)
    }

    const bool \= (boolean) \=> JSON.parse(boolean) ? true : false
    const addUnit \= (val) \=> val ? parseInt(val) + 'px' : null

    let observeTimer \= null
    let c \= {}
    // æ»šåŠ¨æ¡å¯¹è±¡
    let el
    let wrap
    let barX
    let barY

    $: wrapStyle \= \`height: ${addUnit(height)}; max\-height: ${addUnit(maxHeight)}\`
    $: GAP \= addUnit(gap)

    onMount(() \=> {
        console.log('ç›‘å¬æ»šåŠ¨æ¡å¼€å¯...')

        updated()

        let observer \= new MutationObserver(mutation \=> {
            updated()
        })

        observer.observe(wrap, {
            attributes: true,
            childList: true,
            subtree: true,
            attributeFilter: \[
                'style', 'class'
            \]
        })

        window.addEventListener('resize', util.throttle(updated))

        return () \=> {
            observer.disconnect()
            window.removeEventListener('resize', updated)
            console.log('ç›‘å¬æ»šåŠ¨æ¡å…³é—­...')
        }
    })

    afterUpdate(() \=> {
        // console.log('ç›‘å¬domæ›´æ–°...')
    })

    // é¼ æ ‡æ»‘å…¥
    function handleMouseEnter() {
        data.isHover \= true
        data.isShowBar \= true
        updated()
    }

    // é¼ æ ‡æ»‘å‡º
    function handleMouseLeave() {
        data.isHover \= false
        if(!data.isTaped && bool(autohide)) {
            data.isShowBar \= false
        }
    }

    // æ‹–åŠ¨æ»šåŠ¨æ¡
    function handleDragThumb(e, index) {
        // ...
    }

    // ç‚¹å‡»æ»šåŠ¨æ¡æ’æ§½
    function handleClickTrack(e, index) {
        if(index \== 0) {
            wrap.scrollTop \= (Math.abs(e.target.getBoundingClientRect().top \- e.clientY) \- barY.offsetHeight / 2) \* data.ratioY
            barY.style.transform \= \`translateY(${wrap.scrollTop / data.ratioY}px)\`
        }else {
            wrap.scrollLeft \= (Math.abs(e.target.getBoundingClientRect().left \- e.clientX) \- barX.offsetWidth / 2) \* data.ratioX
            barX.style.transform \= \`translateX(${wrap.scrollLeft / data.ratioX}px)\`
        }
    }

    // æ›´æ–°æ»šåŠ¨åŒº
    async function updated() {
        // ...
    }

    // é¼ æ ‡æ»šåŠ¨äº‹ä»¶
    function handleScroll(e) {
        let target \= e.target
        let status
        if(target.scrollTop \== 0) {
            status \= 'top' // æ»šåŠ¨è‡³é¡¶éƒ¨
        }else if(target.scrollTop + target.offsetHeight \>= target.scrollHeight) {
            status \= 'bottom' // æ»šåŠ¨è‡³åº•éƒ¨
        }

        /\*\*
         \* çˆ¶ç»„ä»¶è°ƒç”¨ const { target, status, scrollTop, scrollLeft } = e.detail
         \*/
        dispatch('scroll', {
            target, // æ»šåŠ¨å¯¹è±¡
            status, // æ»šåŠ¨çŠ¶æ€(è®°å½•æ»šåŠ¨ä½ç½®)
            scrollTop: target.scrollTop,
            scrollLeft: target.scrollLeft
        })
        updated()
    }

    // æ§åˆ¶æ»šè½®æ°´å¹³æ»šåŠ¨
    function handleMouseWheel(e) {
        if(!bool(mousewheel)) return
        e.preventDefault()
        if(wrap.scrollWidth \> wrap.offsetWidth) {
            wrap.scrollLeft += e.deltaY
        }
    }

    // æ»šåŠ¨åˆ°ä¸€ç»„ç‰¹å®šåæ ‡
    export async function scrollTo(arg1, arg2) {
        await tick()

        if(typeof arg1 \== 'object') {
            wrap.scrollTo(arg1)
        }else if(!isNaN(arg1) && !isNaN(arg2)) {
            wrap.scrollTo(arg1, arg2)
        }
    }

    // è®¾ç½®æ»šåŠ¨æ¡åˆ°é¡¶éƒ¨çš„è·ç¦»
    export async function setScrollTop(value) {
        await tick()

        wrap.scrollTop \= value \== 'top' ? 0 : value \== 'bottom' ? wrap.scrollHeight : parseInt(value)
        barY.style.transform \= \`translateY(${wrap.scrollTop / data.ratioY}px)\`
    }

    // è®¾ç½®æ»šåŠ¨æ¡åˆ°å·¦è¾¹çš„è·ç¦»
    export async function setScrollLeft(value) {
        await tick()

        wrap.scrollLeft \= value \== 'left' ? 0 : value \== 'right' ? wrap.scrollWidth : parseInt(value)
        barX.style.transform \= \`translateX(${wrap.scrollLeft / data.ratioX}px)\`
    }
</script\>

<style\>
    @import 'Scrollbar.scss';
</style\>

![](https://img2022.cnblogs.com/blog/1289798/202205/1289798-20220506232031247-1472435913.gif)

å¦‚ä¸Šå›¾ï¼šæ”¯æŒç›‘å¬scrollæ»šåŠ¨äº‹ä»¶ã€‚

<Scrollbar on:scroll\={handleScroll}\>
    <div\>è‡ªå®šä¹‰å†…å®¹ä¿¡æ¯ã€‚</div\>
</Scrollbar\>

<script\>
    // ç›‘å¬æ»šåŠ¨äº‹ä»¶
    function handleScroll(e) {
        const { target, status, scrollTop, scrollLeft } \= e.detail
        scrollTopVal \= scrollTop
        scrollLeftVal \= scrollLeft

        // åˆ¤æ–­æ»šåŠ¨çŠ¶æ€ï¼ˆæ–¹æ³•1ï¼‰
        /\*if(scrollTop == 0) {
            scrollStatus = 'æ»šåŠ¨è‡³é¡¶éƒ¨'
        }else if(scrollTop + target.offsetHeight >= target.scrollHeight) {
            scrollStatus = 'æ»šåŠ¨åº•éƒ¨'
        }else {
            scrollStatus = 'æ»šåŠ¨ä¸­'
        }\*/

        // // åˆ¤æ–­æ»šåŠ¨çŠ¶æ€ï¼ˆæ–¹æ³•2ï¼‰
        if(status \== 'top') {
            scrollStatus \= 'æ»šåŠ¨è‡³é¡¶éƒ¨'
        }else if(status \== 'bottom') {
            scrollStatus \= 'æ»šåŠ¨åº•éƒ¨'
        }else {
            scrollStatus \= 'æ»šåŠ¨ä¸­'
        }
    }
</script\>

Okayï¼ŒåŸºäºsvelte.jså¼€å‘è‡ªå®šä¹‰è™šæ‹Ÿæ»šåŠ¨æ¡ç»„ä»¶å°±åˆ†äº«åˆ°è¿™é‡Œã€‚å¸Œæœ›å¯¹å¤§å®¶æœ‰äº›å¸®åŠ©å“ˆ~~ğŸ˜ƒ

**æœ€åé™„ä¸Šä¸€ä¸ªSvelte3è‡ªå®šä¹‰pcç«¯å¯¹è¯æ¡†ç»„ä»¶**

svelte-layeråŸºäºsvelte3.xè‡ªå®šä¹‰å¼¹çª—ç»„ä»¶ï¼š[https://www.cnblogs.com/xiaoyan2017/p/16158044.html](https://www.cnblogs.com/xiaoyan2017/p/16158044.html)

![](https://img2022.cnblogs.com/blog/1289798/202205/1289798-20220506232714670-930034113.jpg)

æœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œæœªç»åšä¸»å…è®¸ä¸å¾—è½¬è½½ï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·äº¤æµ QQï¼ˆ282310962ï¼‰ wxï¼ˆxy190310ï¼‰