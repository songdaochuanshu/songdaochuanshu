---
layout: post
title: "Grafana 系列文章（五）：Grafana Explore 查询管理"
date: "2023-02-02T03:17:45.441Z"
---
Grafana 系列文章（五）：Grafana Explore 查询管理
====================================

> 👉️**URL:** [https://grafana.com/docs/grafana/latest/explore/query-management/](https://grafana.com/docs/grafana/latest/explore/query-management/)
> 
> 📝**Description:**
> 
> Explore 中的查询管理 为了帮助调试查询，Explore 允许你调查查询请求和响应，以及查询统计数据，...

Explore 中的查询管理
--------------

为了帮助调试查询，Explore 允许你通过查询检查器 (Query Inspector) 来调查查询请求和响应，以及查询统计。这个功能类似于面板检查器的任务 [检查查询性能](https://grafana.com/docs/grafana/latest/panels/query-a-data-source/inspect-query-performance/) 和 [检查查询请求和响应数据](https://grafana.com/docs/grafana/latest/panels/query-a-data-source/inspect-request-and-response-data/)。

![Explore 中的查询检查器按钮的截图](https://img2023.cnblogs.com/other/3034537/202302/3034537-20230202093823931-1382903913.png)

查询历史 (Query history)
--------------------

查询历史是你在 Explore 中使用过的查询列表。历史记录是在你的浏览器里的，不会被共享。要打开并与你的历史记录互动，请点击 Explore 中的**查询历史**按钮。

### 查看查询历史

查询历史让你查看你的查询历史。对于每个单独的查询，你可以：

*   运行一个查询。
*   创建和/或编辑一个评论。
*   复制一个查询到剪贴板上。
*   将查询的短链接复制到剪贴板上。
*   给查询加星

### 管理最爱的查询

所有在查询历史标签中被标记的查询都会显示在 "标记 "中。这使你能更快地访问你最喜欢的查询，并能重复使用这些查询，而不需要从头开始输入它们。

### 排序查询历史

默认情况下，查询历史显示的是最近的查询。你可以按日期或按数据源名称以升序或降序对你的历史进行排序。

1.  点击**查询排序的**字段。
2.  选择下列选项之一：
    *   最新的在前
    *   最旧的在前
    *   数据源 A-Z
    *   数据源 Z-A

> **Note:** 如果你处于分割模式，那么选择的排序模式只适用于活动面板。

### 过滤查询历史

在查询历史和星级标签中，通过数据源名称过滤查询历史。

1.  点击**过滤特定数据源的查询**字段。
2.  选择你想过滤历史的数据源。你可以选择多个数据源。

在**查询历史**标签中，也可以使用滑块按日期过滤查询。

*   使用垂直滑块来过滤日期的查询。
*   通过拖动顶部手柄，调整开始日期。
*   通过拖动顶部手柄，调整结束日期。

> **Note:** 如果你处于分割模式，过滤器只应用于你当前的活动面板。

### 在查询历史中搜索

你可以在你的历史查询和你的评论中进行搜索。在查询历史选项卡和星级选项卡中，可以对查询进行搜索。

1.  点击**搜索查询**栏。
2.  在搜索栏中输入你要搜索的术语。

### 查询历史设置

你可以在 "设置 "选项卡中自定义查询历史。选项在下表中有描述。

设置

默认值

Grafana 将保存你的查询历史的时间段

1 周

更改默认的活动标签

Query history tab

只显示当前在 Explore 中活动的数据源的查询

True

清理查询历史

永久删除所有存储的查询。

> **Note:** 查询历史设置是全局性的，并适用于分割模式下的两个面板。

Prometheus 特定功能
---------------

Explore 的第一个版本具有为 Prometheus 定制的查询体验。当一个查询被执行时，它实际上执行了两个查询，一个是针对图表的普通普罗米修斯查询，一个是针对表格的即时查询。即时查询返回每个时间序列的最后一个值，这显示了图表中显示的数据的一个很好的摘要。

### Metrics 浏览器

在查询字段的左侧，点击**指标 (Metrics)**，打开指标浏览器。这显示了一个分层的菜单，指标按其前缀分组。例如，所有的 Alertmanager 指标都被归入`alertmanager`前缀。如果你只是想探索哪些指标是可用的，这是一个好的起点。

![面板菜单中新的 Explore 选项截图](https://img2023.cnblogs.com/other/3034537/202302/3034537-20230202093824262-322496810.png)

### 查询字段

查询字段支持公制名称、功能的自动完成，工作方式与标准 Prometheus 查询编辑器基本相同。按**回车键**可以执行一个查询。

自动完成菜单可以通过按`Ctrl+Space`来触发。自动完成菜单包含一个新的历史部分，其中有一个最近执行的查询列表。

建议可以出现在查询字段下--点击它们可以用建议的改变来更新你的查询。

*   对于计数器 (counters)（单调增长的指标），将建议一个速率 (rate) 函数。
*   对于桶 (buckets)，将建议使用直方图 (histogram) 函数。
*   对于记录规则 (recording rule)，可以扩展规则。

### 表格过滤

点击表格面板 "标签 "栏中的过滤器按钮，为查询表达式添加过滤器。你也可以为多个查询添加过滤器--过滤器被添加到所有的查询中。

Grafana 系列文章
------------

[Grafana 系列文章](https://ewhisper.cn/tags/Grafana/)

> _三人行, 必有我师; 知识共享, 天下为公._ 本文由东风微鸣技术博客 [EWhisper.cn](https://EWhisper.cn) 编写.