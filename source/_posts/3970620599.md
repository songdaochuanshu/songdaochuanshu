---
layout: post
title: "Jenkinsfile åŒæ—¶æ£€å‡ºå¤šä¸ª Git ä»“åº“"
date: "2022-11-17T01:42:29.474Z"
---
Jenkinsfile åŒæ—¶æ£€å‡ºå¤šä¸ª Git ä»“åº“
=========================

![Jenkinsfile åŒæ—¶æ£€å‡ºå¤šä¸ª Git ä»“åº“](https://img2022.cnblogs.com/blog/1043209/202211/1043209-20221116220859479-1529270981.png) åœ¨Jenkinsfileæ£€å‡ºGitä»“åº“å¾ˆå®¹æ˜“ï¼Œä½†è‹¥æƒ³åŒæ—¶æ£€å‡ºå¤šä¸ªGitä»“åº“åº”è¯¥æ€ä¹ˆåšå‘¢...

å‰ç½®
--

é€šå¸¸ï¼Œåœ¨ Jenkinsfile ä¸­ä½¿ç”¨ Git ä»“åº“æ˜¯è¿™æ ·çš„ï¼š

    stage('Checkout git repo') {
        steps {
            checkout([
                $class: 'GitSCM',
                branches: [[name: 'develop']],
                userRemoteConfigs: [[
                    credentialsId:  'ssh-private-key-id',
                    url: 'project-git-repo-url'
                ]]
            ])
        }
    }
    

ä»¥ä¸Šå†™æ³•çš„ç»“æœæ˜¯è¿œç¨‹ Git ä»“åº“ä¸­æ‰€æœ‰å†…å®¹éƒ½è¢«æ£€å‡ºåˆ°å½“å‰å·¥ä½œç›®å½•ä¸‹ï¼Œå› æ­¤æˆ‘ä»¬æ‰èƒ½åƒä¸‹é¢è¿™æ ·ï¼ˆä¸ç”¨åˆ‡æ¢ç›®å½•è€Œï¼‰ç›´æ¥è¿è¡Œä¸€äº›å‘½ä»¤ï¼š

    stage('generate version number') {
        steps {
            VERSION_NUBMER = sh(script: "git describe --always", returnStdout: true).trim()
        }
    }
    

å°† Git ä»“åº“æ£€å‡ºåˆ°æŒ‡å®šæ–‡ä»¶å¤¹
----------------

å¦‚æœè¦åŒæ—¶æ‹‰å–å¤šä¸ª Git ä»“åº“ï¼Œé¢ä¸´çš„é¦–è¦é—®é¢˜æ˜¯å¦‚ä½•å°† Git ä»“åº“æ£€å‡ºåˆ°æŒ‡å®šæ–‡ä»¶å¤¹ã€‚å¯¹æ­¤ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ `$class: 'RelativeTargetDirectory'` è§£å†³ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

    stage('Checkout git repo') {
        steps {
            checkout([
                $class: 'GitSCM',
                branches: [[name: 'develop']],
                userRemoteConfigs: [[
                    credentialsId:  'ssh-private-key-id',
                    url: 'project-git-repo-url'
                ]],
                extensions: [[
                    $class: 'RelativeTargetDirectory',
                    relativeTargetDir: 'repo-folder'
                ]]
            ])
        }
    }
    

è¿™æ ·ä¸€æ¥ï¼Œè¿œç¨‹ Git ä»“åº“ä¸­æ‰€æœ‰å†…å®¹å°†è¢«æ£€å‡ºåˆ° `./repo-folder` æ–‡ä»¶å¤¹ä¸‹ï¼›åç»­æˆ‘ä»¬è‹¥æƒ³åœ¨ Git é¡¹ç›®ç›®å½•ä¸‹æ“ä½œï¼Œå°±éœ€è¦å…ˆ `cd ./repo-folder` äº†ï¼Œä¾‹å¦‚ï¼š

    stage('generate version number') {
        steps {
            VERSION_NUBMER = sh(script: "cd ./repo-folder && git describe --always", returnStdout: true).trim()
        }
    }
    

æ£€å‡ºå¤š Git ä»“åº“
----------

åœ¨è§£å†³äº†å°† Git ä»“åº“æ£€å‡ºåˆ°æŒ‡å®šæ–‡ä»¶å¤¹è¿™ä¸€é—®é¢˜åï¼Œæ£€å‡ºå¤š Git ä»“åº“è¿™ä¸€éœ€æ±‚å°±ç¨æ˜¾å®¹æ˜“ï¼Œä¸‹é¢ä»¥æ£€å‡ºrepoAã€repoBã€repoCä¸‰ä¸ªä»“åº“ä¸ºä¾‹ï¼š

    stage('Checkout multiple git repos') {
        steps {
            checkout([
                $class: 'GitSCM',
                branches: [[name: 'develop']],
                userRemoteConfigs: [[
                    credentialsId:  'ssh-private-key-id',
                    url: 'project-git-repoA-url'
                ]],
                extensions: [[
                    $class: 'RelativeTargetDirectory',
                    relativeTargetDir: 'repoA-folder'
                ]]
            ])
    
            checkout([
                $class: 'GitSCM',
                branches: [[name: 'develop']],
                userRemoteConfigs: [[
                    credentialsId:  'ssh-private-key-id',
                    url: 'project-git-repoB-url'
                ]],
                extensions: [[
                    $class: 'RelativeTargetDirectory',
                    relativeTargetDir: 'repoB-folder'
                ]]
            ])
    
            checkout([
                $class: 'GitSCM',
                branches: [[name: 'develop']],
                userRemoteConfigs: [[
                    credentialsId:  'ssh-private-key-id',
                    url: 'project-git-repoC-url'
                ]],
                extensions: [[
                    $class: 'RelativeTargetDirectory',
                    relativeTargetDir: 'repoC-folder'
                ]]
            ])
        }
    }
    

ä¸Šé¢ğŸ‘†ä»£ç çš„ç»“æœå°±æ˜¯å·¥ä½œç›®å½•ä¸‹æœ‰äº† `repoA-folder`ã€`repoB-folder`ã€`repoC-folder` ä¸‰ä¸ªæ–‡ä»¶å¤¹ã€‚

åŒæ—¶
--

æˆªæ­¢ç°åœ¨ï¼Œè¿˜æ²¡æœ‰è¾¾åˆ°æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„ã€‚æœ¬æ–‡æ ‡é¢˜å«åšâ€œJenkinsfile åŒæ—¶æ£€å‡ºå¤šä¸ª Git ä»“åº“â€ï¼Œä½†ç°åœ¨æˆ‘ä»¬ä»…ä»…åšåˆ°äº†â€œå¤šä¸ªâ€è¿˜æ²¡æœ‰åšåˆ°â€œåŒæ—¶â€ï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨Jenkins Pipelineè¯­æ³•ä¸­çš„ `parallel` å…³é”®å­—ã€‚

    stage('Checkout multiple git repos at the same time') {
        parallel {
            stage('repoA') {
                steps {
                    checkout([
                        $class: 'GitSCM',
                        branches: [[name: 'develop']],
                        userRemoteConfigs: [[
                            credentialsId:  'ssh-private-key-id',
                            url: 'project-git-repoA-url'
                        ]],
                        extensions: [[
                            $class: 'RelativeTargetDirectory',
                            relativeTargetDir: 'repoA-folder'
                        ]]
                    ])
                }
            }
    
            stage('repoB') {
                steps {
                    checkout([
                        $class: 'GitSCM',
                        branches: [[name: 'develop']],
                        userRemoteConfigs: [[
                            credentialsId:  'ssh-private-key-id',
                            url: 'project-git-repoB-url'
                        ]],
                        extensions: [[
                            $class: 'RelativeTargetDirectory',
                            relativeTargetDir: 'repoB-folder'
                        ]]
                    ])
                }
            }
    
            stage('repoC') {
                steps {
                    checkout([
                        $class: 'GitSCM',
                        branches: [[name: 'develop']],
                        userRemoteConfigs: [[
                            credentialsId:  'ssh-private-key-id',
                            url: 'project-git-repoC-url'
                        ]],
                        extensions: [[
                            $class: 'RelativeTargetDirectory',
                            relativeTargetDir: 'repoC-folder'
                        ]]
                    ])
                }
            }
        }
    }
    
    

å‚è€ƒ
--

*   [Jenkins Pipeline](https://www.jenkins.io/doc/book/pipeline)
*   [Jenkins Git Plugin](https://plugins.jenkins.io/git/#plugin-content-pipelines)
*   [Jenkins Pipeline SCM Step](https://www.jenkins.io/doc/pipeline/steps/workflow-scm-step)

* * *

![image](https://img2022.cnblogs.com/blog/1043209/202211/1043209-20221116220827385-2137356631.jpg)

æ–‡å®Œæ’’èŠ±ğŸ‰ï¼æ„Ÿè°¢è§‚çœ‹ğŸ‘ï¼