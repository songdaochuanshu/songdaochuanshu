---
layout: post
title: "mybatis通用功能代码生成工具"
date: "2022-05-03T14:16:03.317Z"
---
mybatis通用功能代码生成工具
=================

mybatis操作数据库的过程中，如果只考虑单表操作，mapper和dao层基本80%的都是固定的，故而可以使用工具进行生成，文末提供自己编写的工具(基于mysql存储过程)：  
作者其实就是使用(mybatis-generator)这个工具过程中，有些想法，实践下，编写时很多实现留了口子，后续方便集成到开发框架中。

工具提供 mapper,dao层功能如下：　

通用查询,返回对象  
通用查询，返回集合  
通用主键查询，返回集合  
通过条件和主键in查询,返回集合  
通过主键更新  
通过条件更新  
通过条件和主键in更新  
单条插入，id自增  
单条插入，id不自增  
批量插入

（如需定制化生成代码,请翻阅前几篇文章，本文仅将通用性代码抽取出来：https://www.cnblogs.com/wanglifeng717/p/15839391.html）

*   1.查询部分示例

因为查询根据不同条件sql不同,可以使用动态语句。使用对象拼接查询条件。此时mapper层只需要一个方法。（工具自动生成代码如下）

// 通用查询，返回对象
@Select({ 
"<script> ",
"select t.id as id,t.create\_time as create\_time,t.last\_update\_time as last\_update\_time,t.login\_name as login\_name,t.login\_password as login\_password,t.status as status,t.remark as remark,t.admin\_user\_id as admin\_user\_id ",
"from tbl\_sapo\_admin\_account t ",
"<where> ",
"<if test='queryObj!=null'>",
"<if test = 'queryObj.id!=null'> and id=#{queryObj.id,jdbcType=INTEGER}  </if>" ,
"<if test = 'queryObj.create\_time!=null'> and create\_time=#{queryObj.createTime,jdbcType=TIMESTAMP}  </if>" ,
"<if test = 'queryObj.last\_update\_time!=null'> and last\_update\_time=#{queryObj.lastUpdateTime,jdbcType=TIMESTAMP}  </if>" ,
"<if test = 'queryObj.loginName !=null and queryObj.loginName !=&apos;&apos;'> and login\_name=#{queryObj.loginName,jdbcType=VARCHAR}  </if>" ,
"<if test = 'queryObj.loginPassword !=null and queryObj.loginPassword !=&apos;&apos;'> and login\_password=#{queryObj.loginPassword,jdbcType=VARCHAR}  </if>" ,
"<if test = 'queryObj.status!=null'> and status=#{queryObj.status,jdbcType=INTEGER}  </if>" ,
"<if test = 'queryObj.remark !=null and queryObj.remark !=&apos;&apos;'> and remark=#{queryObj.remark,jdbcType=VARCHAR}  </if>" ,
"<if test = 'queryObj.admin\_user\_id!=null'> and admin\_user\_id=#{queryObj.adminUserId,jdbcType=INTEGER}  </if>" ,
"</if>",
"</where> ",
"</script>" 
})
SapoAdminAccount getSapoAdminAccount(@Param("queryObj") SapoAdminAccount sapoAdminAccountForQuery);

*   2.更新部分示例

更新的前提基本都是已经查出来该记录，直接根据主键更新即可。并没有很多花样。（工具自动生成代码如下）

// 通过主键更新
@Update({
    "update tbl\_sapo\_admin\_account set ",
    "create\_time=#{updateObj.createTime,jdbcType=TIMESTAMP} ,last\_update\_time=#{updateObj.lastUpdateTime,jdbcType=TIMESTAMP} ,login\_name=#{updateObj.loginName,jdbcType=VARCHAR} ,login\_password=#{updateObj.loginPassword,jdbcType=VARCHAR} ,status=#{updateObj.status,jdbcType=INTEGER} ,remark=#{updateObj.remark,jdbcType=VARCHAR} ,admin\_user\_id=#{updateObj.adminUserId,jdbcType=INTEGER}  ",
    "where id = #{updateObj.id,jdbcType=INTEGER} "
})
int updateSapoAdminAccountByPrimaryKey(@Param("updateObj") SapoAdminAccount sapoAdminAccountForUpdate);

如果更新的条件是不确定的，更新的内容也不确定，可以使用动态语句，基本一个更新语句包打天下（工具自动生成代码如下：）

// 通过条件更新
@Update({ 
"<script> ",
"update tbl\_sapo\_admin\_account ",
"<set>",
"<if test='updateObj!=null'>",
"<if test = 'updateObj.create\_time!=null'>  create\_time=#{updateObj.createTime,jdbcType=TIMESTAMP} , </if>" ,
"<if test = 'updateObj.last\_update\_time!=null'>  last\_update\_time=#{updateObj.lastUpdateTime,jdbcType=TIMESTAMP} , </if>" ,
"<if test = 'updateObj.loginName !=null and updateObj.loginName !=&apos;&apos;'>  login\_name=#{updateObj.loginName,jdbcType=VARCHAR} , </if>" ,
"<if test = 'updateObj.loginPassword !=null and updateObj.loginPassword !=&apos;&apos;'>  login\_password=#{updateObj.loginPassword,jdbcType=VARCHAR} , </if>" ,
"<if test = 'updateObj.status!=null'>  status=#{updateObj.status,jdbcType=INTEGER} , </if>" ,
"<if test = 'updateObj.remark !=null and updateObj.remark !=&apos;&apos;'>  remark=#{updateObj.remark,jdbcType=VARCHAR} , </if>" ,
"<if test = 'updateObj.admin\_user\_id!=null'>  admin\_user\_id=#{updateObj.adminUserId,jdbcType=INTEGER} , </if>" ,
"</if>",
"</set>",
"<where>",
"<if test='queryObj!=null'>",
"<if test = 'queryObj.id!=null'> and id=#{queryObj.id,jdbcType=INTEGER}  </if>" ,
"<if test = 'queryObj.create\_time!=null'> and create\_time=#{queryObj.createTime,jdbcType=TIMESTAMP}  </if>" ,
"<if test = 'queryObj.last\_update\_time!=null'> and last\_update\_time=#{queryObj.lastUpdateTime,jdbcType=TIMESTAMP}  </if>" ,
"<if test = 'queryObj.loginName !=null and queryObj.loginName !=&apos;&apos;'> and login\_name=#{queryObj.loginName,jdbcType=VARCHAR}  </if>" ,
"<if test = 'queryObj.loginPassword !=null and queryObj.loginPassword !=&apos;&apos;'> and login\_password=#{queryObj.loginPassword,jdbcType=VARCHAR}  </if>" ,
"<if test = 'queryObj.status!=null'> and status=#{queryObj.status,jdbcType=INTEGER}  </if>" ,
"<if test = 'queryObj.remark !=null and queryObj.remark !=&apos;&apos;'> and remark=#{queryObj.remark,jdbcType=VARCHAR}  </if>" ,
"<if test = 'queryObj.admin\_user\_id!=null'> and admin\_user\_id=#{queryObj.adminUserId,jdbcType=INTEGER}  </if>" ,
"</if>",
"</where>",
"</script>" 
})
int updateSapoAdminAccount(@Param("updateObj") SapoAdminAccount sapoAdminAccountForUpdate,@Param("queryObj") SapoAdminAccount sapoAdminAccountForQuery);

*   3.插入部分示例

// 单条插入:id自增
@Insert({ 
    "insert into tbl\_sapo\_admin\_account ",
    "(id,create\_time,last\_update\_time,login\_name,login\_password,status,remark,admin\_user\_id)",
    "values ",
    "(#{item.id,jdbcType=INTEGER} ,#{item.createTime,jdbcType=TIMESTAMP} ,#{item.lastUpdateTime,jdbcType=TIMESTAMP} ,#{item.loginName,jdbcType=VARCHAR} ,#{item.loginPassword,jdbcType=VARCHAR} ,#{item.status,jdbcType=INTEGER} ,#{item.remark,jdbcType=VARCHAR} ,#{item.adminUserId,jdbcType=INTEGER} ) "
})
@Options(useGeneratedKeys \= true, keyProperty = "id", keyColumn = "id")
int insertSapoAdminAccount(@Param("item") SapoAdminAccount sapoAdminAccount);

// 批量插入
@Insert({
    "<script> ",
        "insert into tbl\_sapo\_admin\_account ( id,create\_time,last\_update\_time,login\_name,login\_password,status,remark,admin\_user\_id ) values",
        "<foreach collection='itemList' item='item' index='index' open='(' separator='),(' close=')'>",
            "#{item.id,jdbcType=INTEGER} ,#{item.createTime,jdbcType=TIMESTAMP} ,#{item.lastUpdateTime,jdbcType=TIMESTAMP} ,#{item.loginName,jdbcType=VARCHAR} ,#{item.loginPassword,jdbcType=VARCHAR} ,#{item.status,jdbcType=INTEGER} ,#{item.remark,jdbcType=VARCHAR} ,#{item.adminUserId,jdbcType=INTEGER}  ",
        "</foreach>",
    "</script>" 
})
int batchInsertSapoAdminAccount(@Param("itemList") List<SapoAdminAccount> sapoAdminAccountList);

工具生成dao层代码示例：

![](https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif)![](https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif)

    // 批量插入
    @SuppressWarnings("unchecked")
    public int batchInsertSapoAdminAccount(Object object) {
        // 类型转换，支持单个对象或者集合形式作为入参
        List<SapoAdminAccount> list = null;
        if (object instanceof SapoAdminAccount) {
            list \= new ArrayList<>();
            list.add((SapoAdminAccount) object);
        } else if (object instanceof List) {
            for (Object o : (List<?>) object) {
                if (!(o instanceof SapoAdminAccount)) {
                    throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + ",error element: " + o.toString() + ",object type is error for batch insert" + BizLogUtils.getValueOfBizId());
                }
            }
            list \= (List<SapoAdminAccount>) object;
        } else {
            throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + ",object type is error for batch insert"  + BizLogUtils.getValueOfBizId());
        }

        // 如果集合为空则报异常
        if (list == null || list.size() == 0) {
            throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + ",batch insert empty ,bizId="  + BizLogUtils.getValueOfBizId());
        }

        // 插入阈值， 每多少条commit一次，默认是200条做一次。
        int threshold = 200;

        int result = 0;
        int sum = list.size();
        int end = 0;
        for (int i = 0; i < sum; i = i + threshold) {
            end \= i + threshold > sum ? sum : i + threshold;
            try {
                result += mapper.batchInsertSapoAdminAccount(list.subList(i, end));
            } catch (Exception e) {
                //  根据业务做补偿机制，例如通过end值，将之前插入的值全部删除或者状态翻转为无效
                batchInsertSapoAdminAccountFailOffset(list.subList(0, end));
                throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc()+ ",end value： " + end + ",batch insert has error,offset \[batch insert error\] success ,bizId=" + BizLogUtils.getValueOfBizId(),  e);
            }
        }
        return result;
    }

    // 批量插入失败后，进行相关补偿操作
    private void batchInsertSapoAdminAccountFailOffset(List<SapoAdminAccount> list) {

        //  补偿操作，可以比插入操作的阈值大一点， 每多少条commit一次，默认是400条做一次。
        int threshold = 400;
        int sum = list.size();
        int end = 0;
        for (int i = 0; i < sum; i = i + threshold) {
            end \= i + threshold > sum ? sum : i + threshold;
            try {
                // TODO 批量插入失败后，需要进行补偿的操作，例如：将之前插入的值全部删除或者状态翻转为无效
                //List<Integer> idList = list.subList(i, end).stream().map(SapoAdminAccount::getId).collect(Collectors.toList());
                //SapoAdminAccount sapoAdminAccountForUpdate = new SapoAdminAccount();
                //sapoAdminAccountForUpdate.setxx();
                //updateSapoAdminAccount(idList,null,sapoAdminAccountForUpdate);
            } catch (Exception e) {
                // 如果做业务补偿的时候也失败了，只能将重要信息打印在日志里面，运维干预进行恢复了
                throw new BusinessException( ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + ", \[offset batch insert error\]  failed ,"+ ",bizId: " + BizLogUtils.getValueOfBizId(), e);
            }
        }

    }

// 单条插入:id自增
public int insertSapoAdminAccount(SapoAdminAccount sapoAdminAccount){

    if(sapoAdminAccount == null  ){
        bizLogger.warn(" insert tbl\_sapo\_admin\_account  sapoAdminAccount is null ");
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " sapoAdminAccount is null  , bizId=" + BizLogUtils.getValueOfBizId());
    }

    int insertResult =0;
    try {
        insertResult \=  mapper.insertSapoAdminAccount(sapoAdminAccount);
    } catch (DuplicateKeyException e) {
        bizLogger.error(" update tbl\_sapo\_admin\_account duplicateKeyException ,sapoAdminAccount : "
                + sapoAdminAccount.toString());
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " duplicate exception ,bizId=" + BizLogUtils.getValueOfBizId(),e);
    }
    
    if (insertResult==0) {
        bizLogger.warn("insert  tbl\_sapo\_admin\_account  result == 0 , sapoAdminAccount: "+sapoAdminAccount.toString());
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
    }   
    
    return insertResult;
}

// 单条插入：id不自增
public void insertSapoAdminAccount(SapoAdminAccount sapoAdminAccount){

    if(sapoAdminAccount == null  ){
        bizLogger.warn(" insert tbl\_sapo\_admin\_account  sapoAdminAccount is null ");
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " sapoAdminAccount is null  , bizId=" + BizLogUtils.getValueOfBizId());
    }

    int insertResult =0;
    try {
        insertResult \=  mapper.insertSapoAdminAccount(sapoAdminAccount);
    } catch (DuplicateKeyException e) {
        bizLogger.error(" update tbl\_sapo\_admin\_account duplicateKeyException ,sapoAdminAccount : "
                + sapoAdminAccount.toString());
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " duplicate exception ,bizId=" + BizLogUtils.getValueOfBizId(),e);
    }
    
    if (insertResult!=1) {
        bizLogger.warn("insert  tbl\_sapo\_admin\_account  result ！= 1 , sapoAdminAccount: "+sapoAdminAccount.toString());
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
    }   
    
}

// 通用主键查询，返回对象
public SapoAdminAccount getSapoAdminAccountByPrimaryKey(Integer id){
    
    if(id == null){
        bizLogger.warn(" select tbl\_sapo\_admin\_account  id is null ");
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " id is null , bizId=" + BizLogUtils.getValueOfBizId());
    }
    
    SapoAdminAccount sapoAdminAccount \= mapper.getSapoAdminAccountByPrimaryKey(id);
    
    if(sapoAdminAccount == null){
        bizLogger.warn(" select tbl\_sapo\_admin\_account  by primary key ,but find null ,id : "
                + id.toString());
        throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
    }
 
    return sapoAdminAccount;     
}

// 通用查询，返回对象
public SapoAdminAccount getSapoAdminAccount(SapoAdminAccount sapoAdminAccountForQuery){
    
    if(sapoAdminAccountForQuery == null){
        bizLogger.warn(" select tbl\_sapo\_admin\_account  sapoAdminAccountForQuery is null ");
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " sapoAdminAccountForQuery is null , bizId=" + BizLogUtils.getValueOfBizId());
    }
    
    SapoAdminAccount sapoAdminAccount \= mapper.getSapoAdminAccount(sapoAdminAccountForQuery);
    
    if(sapoAdminAccount == null){
        bizLogger.warn(" select tbl\_sapo\_admin\_account  result is null ,sapoAdminAccountForQuery : "
                + sapoAdminAccountForQuery.toString());
        throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
    }
 
    return sapoAdminAccount;     
}

// 通用查询，返回集合
public List<SapoAdminAccount> getSapoAdminAccountList(SapoAdminAccount sapoAdminAccountForQuery){
    
    if(sapoAdminAccountForQuery == null){
        bizLogger.warn(" select tbl\_sapo\_admin\_account  sapoAdminAccountForQuery is null ");
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " sapoAdminAccountForQuery is null , bizId=" + BizLogUtils.getValueOfBizId());
    }
    
    List<SapoAdminAccount> sapoAdminAccountList = mapper.getSapoAdminAccountList(sapoAdminAccountForQuery);
    
    if(sapoAdminAccountList == null || sapoAdminAccountList.size()==0){
        bizLogger.warn(" select tbl\_sapo\_admin\_account  List is null or size=0 ,sapoAdminAccountForQuery : "
                + sapoAdminAccountForQuery.toString());
        throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
    }
 
    return sapoAdminAccountList;     
}

// 通过主键更新
public void updateSapoAdminAccountByPrimaryKey(SapoAdminAccount sapoAdminAccountForUpdate){

    if(sapoAdminAccountForUpdate == null){
        bizLogger.warn(" update tbl\_sapo\_admin\_account  sapoAdminAccountForUpdate is null ");
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " sapoAdminAccountForUpdate is null , bizId=" + BizLogUtils.getValueOfBizId());
    }

     int updateResult = 0;
    
    try {
        updateResult \=  mapper.updateSapoAdminAccountByPrimaryKey(sapoAdminAccountForUpdate);
    } catch (DuplicateKeyException e) {
        bizLogger.warn(" update tbl\_sapo\_admin\_account duplicateKeyException ,sapoAdminAccountForUpdate : "
                + sapoAdminAccountForUpdate.toString());
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " duplicate exception ,bizId=" + BizLogUtils.getValueOfBizId(),e);
    }
    
    /\*
    if (updateResult!=1) {
        bizLogger.warn("update  tbl\_sapo\_admin\_account  result !=1 \[updateResult, sapoAdminAccountForUpdate\] : "+updateResult+","+ sapoAdminAccountForUpdate.toString());
        throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
    }
    \*/
}

// 通过条件和主键in更新
public void updateSapoAdminAccount(List<Integer> idListForQuery,SapoAdminAccount sapoAdminAccountForQuery,SapoAdminAccount sapoAdminAccountForUpdate){
    
    if(idListForQuery == null && sapoAdminAccountForQuery==null ){
        bizLogger.warn(" update tbl\_sapo\_admin\_account  idListForQuery and sapoAdminAccountForQuery is null at same time");
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " idListForQuery and sapoAdminAccountForQuery is null at same time , bizId=" + BizLogUtils.getValueOfBizId());
    }
    
    if(sapoAdminAccountForUpdate == null  ){
        bizLogger.warn(" update tbl\_sapo\_admin\_account  sapoAdminAccountForUpdate is null ");
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " sapoAdminAccountForUpdatey is null  , bizId=" + BizLogUtils.getValueOfBizId());
    }
    
    
    int updateResult = 0;
    
    try {
        updateResult \=  mapper.updateSapoAdminAccount(idListForQuery,sapoAdminAccountForQuery,sapoAdminAccountForUpdate);
    } catch (DuplicateKeyException e) {
        bizLogger.error(" update tbl\_sapo\_admin\_account duplicateKeyException ,sapoAdminAccountForQuery : "
                + sapoAdminAccountForQuery.toString()+" ; idListForQuery: "+idListForQuery);
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " duplicate exception ,bizId=" + BizLogUtils.getValueOfBizId(),e);
    }
    /\*
    if (updateResult!=1) {
        bizLogger.warn("update  tbl\_sapo\_admin\_account result  !=1 \[updateResult, sapoAdminAccountForQuery,idListForQuery\] : "+updateResult+","+ sapoAdminAccountForQuery.toString()+","+idListForQuery);
        throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
    }
    \*/
}

// 通过条件和主键in查询,返回集合
public List<SapoAdminAccount> getSapoAdminAccountList( List<Integer> idListForQuery, SapoAdminAccount sapoAdminAccountForQuery){
    
    if(idListForQuery == null && sapoAdminAccountForQuery == null){
        bizLogger.warn(" select tbl\_sapo\_admin\_account  idListForQuery  && sapoAdminAccountForQuery  is null at same time");
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " idListForQuery  && sapoAdminAccountForQuery  is null at same time , bizId=" + BizLogUtils.getValueOfBizId());
    }
    
    List<SapoAdminAccount> sapoAdminAccountList = mapper.getSapoAdminAccountList(idListForQuery,sapoAdminAccountForQuery);
    
    if(sapoAdminAccountList == null || sapoAdminAccountList.size()==0){
        bizLogger.warn(" select tbl\_sapo\_admin\_account  ,but result list is null or size=0 ,sapoAdminAccountForQuery : "
                + sapoAdminAccountForQuery.toString()+"; idListForQuery : "+idListForQuery.toString());
        throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
    }
 
    return sapoAdminAccountList;     
}

// 通过条件更新
public void updateSapoAdminAccount(SapoAdminAccount sapoAdminAccountForUpdate,SapoAdminAccount sapoAdminAccountForQuery){
    
    if(sapoAdminAccountForUpdate == null || sapoAdminAccountForQuery==null ){
        bizLogger.warn(" update tbl\_sapo\_admin\_account  sapoAdminAccountForUpdate or sapoAdminAccountForQuery is null ");
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " sapoAdminAccountForUpdate or sapoAdminAccountForQuery is null , bizId=" + BizLogUtils.getValueOfBizId());
    }
    
    int updateResult = 0;
    
    try {
        updateResult \=  mapper.updateSapoAdminAccount(sapoAdminAccountForUpdate,sapoAdminAccountForQuery);
    } catch (DuplicateKeyException e) {
        bizLogger.error(" update tbl\_sapo\_admin\_account duplicateKeyException ,sapoAdminAccountForQuery : "
                + sapoAdminAccountForQuery.toString());
        throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
                ResultInfo.SYS\_INNER\_ERROR.getDesc() \+ " duplicate exception ,bizId=" + BizLogUtils.getValueOfBizId(),e);
    }
    /\*
    if (updateResult!=1) {
        bizLogger.warn("update  tbl\_sapo\_admin\_account  result !=1 \[updateResult, sapoAdminAccountForQuery\] : "+updateResult+","+ sapoAdminAccountForQuery.toString());
        throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
    }
    \*/
}

View Code

工具生成mapper层代码示例：

![](https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif)![](https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif)

// 通用查询，返回对象
@Select({ 
"<script\> ",
"select t.id as id,t.create\_time as create\_time,t.last\_update\_time as last\_update\_time,t.login\_name as login\_name,t.login\_password as login\_password,t.status as status,t.remark as remark,t.admin\_user\_id as admin\_user\_id ",
"from tbl\_sapo\_admin\_account t ",
"<where\> ",
"<if test\='queryObj!=null'\>",
"<if test \= 'queryObj.id!=null'\> and id\=#{queryObj.id,jdbcType\=INTEGER}  </if\>" ,
"<if test \= 'queryObj.create\_time!=null'\> and create\_time\=#{queryObj.createTime,jdbcType\=TIMESTAMP}  </if\>" ,
"<if test \= 'queryObj.last\_update\_time!=null'\> and last\_update\_time\=#{queryObj.lastUpdateTime,jdbcType\=TIMESTAMP}  </if\>" ,
"<if test \= 'queryObj.loginName !=null and queryObj.loginName !=&apos;&apos;'\> and login\_name\=#{queryObj.loginName,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.loginPassword !=null and queryObj.loginPassword !=&apos;&apos;'\> and login\_password\=#{queryObj.loginPassword,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.status!=null'\> and status\=#{queryObj.status,jdbcType\=INTEGER}  </if\>" ,
"<if test \= 'queryObj.remark !=null and queryObj.remark !=&apos;&apos;'\> and remark\=#{queryObj.remark,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.admin\_user\_id!=null'\> and admin\_user\_id\=#{queryObj.adminUserId,jdbcType\=INTEGER}  </if\>" ,
"</if\>",
"</where\> ",
"</script\>" 
})
SapoAdminAccount getSapoAdminAccount(@Param("queryObj") SapoAdminAccount sapoAdminAccountForQuery);

// 通用查询，返回集合
@Select({ 
"<script\> ",
"select t.id as id,t.create\_time as create\_time,t.last\_update\_time as last\_update\_time,t.login\_name as login\_name,t.login\_password as login\_password,t.status as status,t.remark as remark,t.admin\_user\_id as admin\_user\_id ",
"from tbl\_sapo\_admin\_account t ",
"<where\> ",
"<if test\='queryObj!=null'\>",
"<if test \= 'queryObj.id!=null'\> and id\=#{queryObj.id,jdbcType\=INTEGER}  </if\>" ,
"<if test \= 'queryObj.create\_time!=null'\> and create\_time\=#{queryObj.createTime,jdbcType\=TIMESTAMP}  </if\>" ,
"<if test \= 'queryObj.last\_update\_time!=null'\> and last\_update\_time\=#{queryObj.lastUpdateTime,jdbcType\=TIMESTAMP}  </if\>" ,
"<if test \= 'queryObj.loginName !=null and queryObj.loginName !=&apos;&apos;'\> and login\_name\=#{queryObj.loginName,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.loginPassword !=null and queryObj.loginPassword !=&apos;&apos;'\> and login\_password\=#{queryObj.loginPassword,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.status!=null'\> and status\=#{queryObj.status,jdbcType\=INTEGER}  </if\>" ,
"<if test \= 'queryObj.remark !=null and queryObj.remark !=&apos;&apos;'\> and remark\=#{queryObj.remark,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.admin\_user\_id!=null'\> and admin\_user\_id\=#{queryObj.adminUserId,jdbcType\=INTEGER}  </if\>" ,
"</if\>",
"</where\> ",
"</script\>" 
})
List<SapoAdminAccount\> getSapoAdminAccountList(@Param("queryObj") SapoAdminAccount sapoAdminAccountForQuery);

// 通过主键查询，返回对象
@Select({
    "select t.id as id,t.create\_time as create\_time,t.last\_update\_time as last\_update\_time,t.login\_name as login\_name,t.login\_password as login\_password,t.status as status,t.remark as remark,t.admin\_user\_id as admin\_user\_id ",
    "from tbl\_sapo\_admin\_account t ",
    "where id \= #{id,jdbcType\=INTEGER}"
})
SapoAdminAccount getSapoAdminAccountByPrimaryKey(Integer id);

// 通过条件和主键in查询,返回集合
@Select({ 
"<script\> ",
"select t.id as id,t.create\_time as create\_time,t.last\_update\_time as last\_update\_time,t.login\_name as login\_name,t.login\_password as login\_password,t.status as status,t.remark as remark,t.admin\_user\_id as admin\_user\_id ",
"from tbl\_sapo\_admin\_account t ",
"<where\> ",
"<if test\='queryObj!=null'\>",
"<if test \= 'queryObj.id!=null'\> and id\=#{queryObj.id,jdbcType\=INTEGER}  </if\>" ,
"<if test \= 'queryObj.create\_time!=null'\> and create\_time\=#{queryObj.createTime,jdbcType\=TIMESTAMP}  </if\>" ,
"<if test \= 'queryObj.last\_update\_time!=null'\> and last\_update\_time\=#{queryObj.lastUpdateTime,jdbcType\=TIMESTAMP}  </if\>" ,
"<if test \= 'queryObj.loginName !=null and queryObj.loginName !=&apos;&apos;'\> and login\_name\=#{queryObj.loginName,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.loginPassword !=null and queryObj.loginPassword !=&apos;&apos;'\> and login\_password\=#{queryObj.loginPassword,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.status!=null'\> and status\=#{queryObj.status,jdbcType\=INTEGER}  </if\>" ,
"<if test \= 'queryObj.remark !=null and queryObj.remark !=&apos;&apos;'\> and remark\=#{queryObj.remark,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.admin\_user\_id!=null'\> and admin\_user\_id\=#{queryObj.adminUserId,jdbcType\=INTEGER}  </if\>" ,
"</if\>",
"<if test \= 'itemList != null and itemList.size() > 0'\> AND id IN " ,
"    <foreach collection\='itemList' item\='item' index\='index' open\='(' separator\=',' close\=')'\> " ,
"        #{item,jdbcType\=INTEGER}   " ,
"    </foreach\> " ,
"</if\>" ,
"</where\> ",
"</script\>" 
})
List<SapoAdminAccount\> getSapoAdminAccountList(@Param("itemList") List<Integer\> idListForQuery,@Param("queryObj") SapoAdminAccount sapoAdminAccountForQuery);

// 通过主键更新
@Update({
    "update tbl\_sapo\_admin\_account set ",
    "create\_time\=#{updateObj.createTime,jdbcType\=TIMESTAMP} ,last\_update\_time\=#{updateObj.lastUpdateTime,jdbcType\=TIMESTAMP} ,login\_name\=#{updateObj.loginName,jdbcType\=VARCHAR} ,login\_password\=#{updateObj.loginPassword,jdbcType\=VARCHAR} ,status\=#{updateObj.status,jdbcType\=INTEGER} ,remark\=#{updateObj.remark,jdbcType\=VARCHAR} ,admin\_user\_id\=#{updateObj.adminUserId,jdbcType\=INTEGER}  ",
    "where id \= #{updateObj.id,jdbcType\=INTEGER} "
})
int updateSapoAdminAccountByPrimaryKey(@Param("updateObj") SapoAdminAccount sapoAdminAccountForUpdate);

// 通过条件更新
@Update({ 
"<script\> ",
"update tbl\_sapo\_admin\_account ",
"<set\>",
"<if test\='updateObj!=null'\>",
"<if test \= 'updateObj.create\_time!=null'\>  create\_time\=#{updateObj.createTime,jdbcType\=TIMESTAMP} , </if\>" ,
"<if test \= 'updateObj.last\_update\_time!=null'\>  last\_update\_time\=#{updateObj.lastUpdateTime,jdbcType\=TIMESTAMP} , </if\>" ,
"<if test \= 'updateObj.loginName !=null and updateObj.loginName !=&apos;&apos;'\>  login\_name\=#{updateObj.loginName,jdbcType\=VARCHAR} , </if\>" ,
"<if test \= 'updateObj.loginPassword !=null and updateObj.loginPassword !=&apos;&apos;'\>  login\_password\=#{updateObj.loginPassword,jdbcType\=VARCHAR} , </if\>" ,
"<if test \= 'updateObj.status!=null'\>  status\=#{updateObj.status,jdbcType\=INTEGER} , </if\>" ,
"<if test \= 'updateObj.remark !=null and updateObj.remark !=&apos;&apos;'\>  remark\=#{updateObj.remark,jdbcType\=VARCHAR} , </if\>" ,
"<if test \= 'updateObj.admin\_user\_id!=null'\>  admin\_user\_id\=#{updateObj.adminUserId,jdbcType\=INTEGER} , </if\>" ,
"</if\>",
"</set\>",
"<where\>",
"<if test\='queryObj!=null'\>",
"<if test \= 'queryObj.id!=null'\> and id\=#{queryObj.id,jdbcType\=INTEGER}  </if\>" ,
"<if test \= 'queryObj.create\_time!=null'\> and create\_time\=#{queryObj.createTime,jdbcType\=TIMESTAMP}  </if\>" ,
"<if test \= 'queryObj.last\_update\_time!=null'\> and last\_update\_time\=#{queryObj.lastUpdateTime,jdbcType\=TIMESTAMP}  </if\>" ,
"<if test \= 'queryObj.loginName !=null and queryObj.loginName !=&apos;&apos;'\> and login\_name\=#{queryObj.loginName,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.loginPassword !=null and queryObj.loginPassword !=&apos;&apos;'\> and login\_password\=#{queryObj.loginPassword,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.status!=null'\> and status\=#{queryObj.status,jdbcType\=INTEGER}  </if\>" ,
"<if test \= 'queryObj.remark !=null and queryObj.remark !=&apos;&apos;'\> and remark\=#{queryObj.remark,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.admin\_user\_id!=null'\> and admin\_user\_id\=#{queryObj.adminUserId,jdbcType\=INTEGER}  </if\>" ,
"</if\>",
"</where\>",
"</script\>" 
})
int updateSapoAdminAccount(@Param("updateObj") SapoAdminAccount sapoAdminAccountForUpdate,@Param("queryObj") SapoAdminAccount sapoAdminAccountForQuery);

// 通过条件和主键in更新
@Update({ 
"<script\> ",
"update tbl\_sapo\_admin\_account ",
"<set\>",
"<if test\='updateObj!=null'\>",
"<if test \= 'updateObj.create\_time!=null'\>  create\_time\=#{updateObj.createTime,jdbcType\=TIMESTAMP} , </if\>" ,
"<if test \= 'updateObj.last\_update\_time!=null'\>  last\_update\_time\=#{updateObj.lastUpdateTime,jdbcType\=TIMESTAMP} , </if\>" ,
"<if test \= 'updateObj.loginName !=null and updateObj.loginName !=&apos;&apos;'\>  login\_name\=#{updateObj.loginName,jdbcType\=VARCHAR} , </if\>" ,
"<if test \= 'updateObj.loginPassword !=null and updateObj.loginPassword !=&apos;&apos;'\>  login\_password\=#{updateObj.loginPassword,jdbcType\=VARCHAR} , </if\>" ,
"<if test \= 'updateObj.status!=null'\>  status\=#{updateObj.status,jdbcType\=INTEGER} , </if\>" ,
"<if test \= 'updateObj.remark !=null and updateObj.remark !=&apos;&apos;'\>  remark\=#{updateObj.remark,jdbcType\=VARCHAR} , </if\>" ,
"<if test \= 'updateObj.admin\_user\_id!=null'\>  admin\_user\_id\=#{updateObj.adminUserId,jdbcType\=INTEGER} , </if\>" ,
"</if\>",
"</set\>",
"<where\>",
"<if test\='queryObj!=null'\>",
"<if test \= 'queryObj.id!=null'\> and id\=#{queryObj.id,jdbcType\=INTEGER}  </if\>" ,
"<if test \= 'queryObj.create\_time!=null'\> and create\_time\=#{queryObj.createTime,jdbcType\=TIMESTAMP}  </if\>" ,
"<if test \= 'queryObj.last\_update\_time!=null'\> and last\_update\_time\=#{queryObj.lastUpdateTime,jdbcType\=TIMESTAMP}  </if\>" ,
"<if test \= 'queryObj.loginName !=null and queryObj.loginName !=&apos;&apos;'\> and login\_name\=#{queryObj.loginName,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.loginPassword !=null and queryObj.loginPassword !=&apos;&apos;'\> and login\_password\=#{queryObj.loginPassword,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.status!=null'\> and status\=#{queryObj.status,jdbcType\=INTEGER}  </if\>" ,
"<if test \= 'queryObj.remark !=null and queryObj.remark !=&apos;&apos;'\> and remark\=#{queryObj.remark,jdbcType\=VARCHAR}  </if\>" ,
"<if test \= 'queryObj.admin\_user\_id!=null'\> and admin\_user\_id\=#{queryObj.adminUserId,jdbcType\=INTEGER}  </if\>" ,
"</if\>",
"<if test \= 'itemList != null and itemList.size() > 0'\> AND id IN " ,
"    <foreach collection\='itemList' item\='item' index\='index' open\='(' separator\=',' close\=')'\> " ,
"        #{item,jdbcType\=INTEGER}   " ,
"    </foreach\> " ,
"</if\>" ,
"</where\>",
"</script\>" 
})
int updateSapoAdminAccount(@Param("itemList") List<Integer\> idListForQuery,@Param("queryObj") SapoAdminAccount sapoAdminAccountForQuery,@Param("updateObj") SapoAdminAccount sapoAdminAccountForUpdate);

// 单条插入:id自增
@Insert({ 
    "insert into tbl\_sapo\_admin\_account ",
    "(id,create\_time,last\_update\_time,login\_name,login\_password,status,remark,admin\_user\_id)",
    "values ",
    "(#{item.id,jdbcType\=INTEGER} ,#{item.createTime,jdbcType\=TIMESTAMP} ,#{item.lastUpdateTime,jdbcType\=TIMESTAMP} ,#{item.loginName,jdbcType\=VARCHAR} ,#{item.loginPassword,jdbcType\=VARCHAR} ,#{item.status,jdbcType\=INTEGER} ,#{item.remark,jdbcType\=VARCHAR} ,#{item.adminUserId,jdbcType\=INTEGER} ) "
})
@Options(useGeneratedKeys \= true, keyProperty \= "id", keyColumn \= "id")
int insertSapoAdminAccount(@Param("item") SapoAdminAccount sapoAdminAccount);

// 单条插入：id不自增
@Insert({ 
    "insert into tbl\_sapo\_admin\_account ",
    "(id,create\_time,last\_update\_time,login\_name,login\_password,status,remark,admin\_user\_id)",
    "values ",
    "(#{item.id,jdbcType\=INTEGER} ,#{item.createTime,jdbcType\=TIMESTAMP} ,#{item.lastUpdateTime,jdbcType\=TIMESTAMP} ,#{item.loginName,jdbcType\=VARCHAR} ,#{item.loginPassword,jdbcType\=VARCHAR} ,#{item.status,jdbcType\=INTEGER} ,#{item.remark,jdbcType\=VARCHAR} ,#{item.adminUserId,jdbcType\=INTEGER} ) "
})
int insertSapoAdminAccount(@Param("item") SapoAdminAccount sapoAdminAccount);

// 批量插入
@Insert({
    "<script\> ",
        "insert into tbl\_sapo\_admin\_account ( id,create\_time,last\_update\_time,login\_name,login\_password,status,remark,admin\_user\_id ) values",
        "<foreach collection\='itemList' item\='item' index\='index' open\='(' separator\='),(' close\=')'\>",
            "#{item.id,jdbcType\=INTEGER} ,#{item.createTime,jdbcType\=TIMESTAMP} ,#{item.lastUpdateTime,jdbcType\=TIMESTAMP} ,#{item.loginName,jdbcType\=VARCHAR} ,#{item.loginPassword,jdbcType\=VARCHAR} ,#{item.status,jdbcType\=INTEGER} ,#{item.remark,jdbcType\=VARCHAR} ,#{item.adminUserId,jdbcType\=INTEGER}  ",
        "</foreach\>",
    "</script\>" 
})
int batchInsertSapoAdminAccount(@Param("itemList") List<SapoAdminAccount\> sapoAdminAccountList);

View Code

工具代码：

![](https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif)![](https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif)

  1 \-- 本文来自博客园，作者：wanglifeng，转载请注明原文链接：https://www.cnblogs.com/wanglifeng717/p/16219565.html
  2 DROP PROCEDURE IF EXISTS \`print\_code\`;  3 DELIMITER $
  4 CREATE  PROCEDURE \`print\_code\`()  5 BEGIN
  6 
  7 SET  group\_concat\_max\_len \= 4294967295;
  8 
  9 
 10 \-- SET @noStrInTbl='tbl\_ams';
 11  SET @noStrInTbl\='tbl';
 12 
 13 
 14 \-- 保存所有表及表的所有字段
 15 DROP TABLE if EXISTS all\_col\_table; 16 CREATE table if not exists all\_col\_table( 17 tbl\_name VARCHAR(256)  NOT NULL  COMMENT '表名:tbl\_sapo\_admin\_account',
 18 col VARCHAR(256) NOT NULL  COMMENT '字段名:create\_time',
 19 col\_camel VARCHAR(256) COMMENT '字段驼峰形式:createTime',
 20 col\_type VARCHAR(256) COMMENT '字段类型，datetime',
 21 java\_type VARCHAR(256) COMMENT 'java类型，datetime',
 22 jdbc\_type VARCHAR(256) COMMENT 'jdbc类型：datetime->TIMESTAMP',
 23 if\_test VARCHAR(1024) COMMENT 'queryObj.create\_time!=null',
 24 update\_if\_test VARCHAR(1024) COMMENT 'updateObj.create\_time!=null',
 25 col\_for\_query\_jdbc VARCHAR(256) COMMENT 'create\_time=#{queryObj.createTime,jdbcType=TIMESTAMP} ',
 26 col\_for\_update\_jdbc VARCHAR(256) COMMENT 'create\_time=#{updateObj.createTime,jdbcType=TIMESTAMP} ',
 27 col\_for\_insert\_jdbc VARCHAR(256) COMMENT '#{item.createTime,jdbcType=TIMESTAMP} ',
 28 col\_comment VARCHAR(512) COMMENT '字段注释'
 29 ) ENGINE\=InnoDB DEFAULT CHARSET\=utf8;
 30 
 31 \-- select \* from all\_col\_table;
 32 
 33 \-- 将本库中所有表及所有字段插入表中
 34 INSERT INTO all\_col\_table(tbl\_name,col) 35 SELECT 
 36     t1.table\_name, t1.column\_name 
 37 FROM
 38     information\_schema.COLUMNS t1
 39 WHERE
 40       t1.table\_schema\= DATABASE() ;
 41 
 42 \-- 字段转驼峰
 43 UPDATE all\_col\_table SET col\_camel \=CONCAT\_WS('',REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE( REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(col, '\_z', 'Z'), '\_y', 'Y'), '\_x', 'X'), '\_w', 'W'), '\_v', 'V'), '\_u', 'U'), '\_t', 'T'), '\_s', 'S'), '\_r', 'R'), '\_q', 'Q'), '\_p', 'P'), '\_o', 'O'), '\_n', 'N'), '\_m', 'M'), '\_l', 'L'), '\_k', 'K'), '\_j', 'J'), '\_i', 'I'), '\_h', 'H'), '\_g', 'G'), '\_f', 'F'), '\_e', 'E'), '\_d', 'D'), '\_c', 'C'), '\_b', 'B'), '\_a', 'A'),'\_','') 
 44 ,'');
 45 
 46 
 47 \-- 更新字段类型id  --> int ,name  -->varchar      
 48 UPDATE all\_col\_table a SET a.col\_type \= 
 49 (
 50 SELECT t1.data\_type 51 FROM
 52     information\_schema.COLUMNS t1
 53 WHERE
 54     t1.table\_schema\= DATABASE()  
 55     and t1.TABLE\_NAME \= a.tbl\_name 56     and t1.column\_name \=a.col
 57 );
 58 \-- select \* from all\_col\_table;
 59 
 60 \-- 转换成jdbc类型
 61 UPDATE all\_col\_table SET jdbc\_type\=
 62 case  col\_type 63     when 'datetime' then 'TIMESTAMP' 
 64     when 'tinyint'  then 'TINYINT' 
 65     when 'bigint'   then 'BIGINT' 
 66     when 'int'      then 'INTEGER'
 67     when 'float'      then 'REAL' 
 68     when 'varchar'  then 'VARCHAR' 
 69 END;
 70 
 71 \-- java类型转换
 72 UPDATE all\_col\_table SET java\_type\=
 73 case  col\_type 74     when 'datetime' then 'Date' 
 75     when 'tinyint'  then 'Byte' 
 76     when 'bigint'   then 'Long' 
 77     when 'int'      then 'Integer' 
 78     when 'varchar'  then 'String' 
 79 END;
 80 
 81 \-- 组语句：create\_time=#{queryObj.createTime,jdbcType=TIMESTAMP} 
 82 UPDATE all\_col\_table SET col\_for\_query\_jdbc\=CONCAT\_WS('',col,'\=#{queryObj.',col\_camel,',jdbcType=',jdbc\_type,'} ');
 83 UPDATE all\_col\_table SET col\_for\_update\_jdbc\=CONCAT\_WS('',col,'\=#{updateObj.',col\_camel,',jdbcType=',jdbc\_type,'} ');
 84 UPDATE all\_col\_table SET col\_for\_insert\_jdbc\=CONCAT\_WS('','#{item.',col\_camel,',jdbcType=',jdbc\_type,'} ');
 85 
 86 \-- 组语句：queryObj.java\_desc!=null and queryObj.java\_desc!=&apos;&apos;
 87 UPDATE all\_col\_table SET if\_test\=
 88 case  col\_type 89     when 'varchar'  then CONCAT\_WS('',"'",'queryObj.',col\_camel,' !=null and queryObj.',col\_camel,' !=&apos;&apos;',"'") 
 90     else CONCAT\_WS('',"'",'queryObj.',col,'!=null',"'")
 91 END;
 92 \-- #######################################
 93 UPDATE all\_col\_table SET update\_if\_test\=
 94 case  col\_type 95     when 'varchar'  then CONCAT\_WS('',"'",'updateObj.',col\_camel,' !=null and updateObj.',col\_camel,' !=&apos;&apos;',"'") 
 96     else CONCAT\_WS('',"'",'updateObj.',col,'!=null',"'")
 97 END;
 98 
 99 
100 \-- 表相关数据
101 DROP TABLE if EXISTS all\_table;
102 CREATE table if not exists all\_table(
103 tbl\_name VARCHAR(256)  NOT NULL  COMMENT '表名:tbl\_sapo\_admin\_account',
104 primary\_key VARCHAR(255) COMMENT '主键',
105 tbl\_name\_camel VARCHAR(1024) COMMENT '表名驼峰:SapoAdminAccount',
106 tbl\_name\_ref\_camel VARCHAR(1024) COMMENT '表名引用驼峰:sapoAdminAccount',
107 col\_list TEXT COMMENT '字段列表',
108 col\_list\_alias TEXT COMMENT '字段别名列表',
109 insert\_if\_test TEXT COMMENT 'insert语句',
110 query\_if\_test TEXT COMMENT 'queryTest语句',
111 update\_chase TEXT COMMENT 'update固定语句',
112 update\_if\_test TEXT COMMENT 'updateTest语句'
113 ) ENGINE\=InnoDB ;
114 
115 
116 
117 
118 \-- 把所有表入库
119 INSERT INTO all\_table(tbl\_name) 
120 SELECT 
121 t1.table\_name
122 FROM
123 information\_schema.tables t1
124 WHERE
125       t1.table\_schema\= DATABASE() AND t1.TABLE\_NAME NOT IN('all\_col\_table','all\_table');
126       
127       \-- 表名转驼峰
128 UPDATE all\_table SET tbl\_name\_camel \=REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE( REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(tbl\_name, @noStrInTbl, ''), '\_z', 'Z'), '\_y', 'Y'), '\_x', 'X'), '\_w', 'W'), '\_v', 'V'), '\_u', 'U'), '\_t', 'T'), '\_s', 'S'), '\_r', 'R'), '\_q', 'Q'), '\_p', 'P'), '\_o', 'O'), '\_n', 'N'), '\_m', 'M'), '\_l', 'L'), '\_k', 'K'), '\_j', 'J'), '\_i', 'I'), '\_h', 'H'), '\_g', 'G'), '\_f', 'F'), '\_e', 'E'), '\_d', 'D'), '\_c', 'C'), '\_b', 'B'), '\_a', 'A'),'\_','') ;
129 UPDATE all\_table SET tbl\_name\_ref\_camel \=REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE( REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(tbl\_name, CONCAT(@noStrInTbl,'\_'), ''), '\_z', 'Z'), '\_y', 'Y'), '\_x', 'X'), '\_w', 'W'), '\_v', 'V'), '\_u', 'U'), '\_t', 'T'), '\_s', 'S'), '\_r', 'R'), '\_q', 'Q'), '\_p', 'P'), '\_o', 'O'), '\_n', 'N'), '\_m', 'M'), '\_l', 'L'), '\_k', 'K'), '\_j', 'J'), '\_i', 'I'), '\_h', 'H'), '\_g', 'G'), '\_f', 'F'), '\_e', 'E'), '\_d', 'D'), '\_c', 'C'), '\_b', 'B'), '\_a', 'A'),'\_','') ;
130 
131 
132  
133  
134  
135  
136 \-- 更新主键
137 UPDATE all\_table a SET  a.primary\_key\=
138 (SELECT 
139 column\_name
140 FROM information\_schema.columns t1
141 WHERE 
142  t1.table\_schema\= DATABASE() AND t1.COLUMN\_KEY\='PRI' AND a.tbl\_name\=table\_name 
143 );
144 
145 \-- 更新每个表的字段列表 t.id as id,t.create\_time as create\_time,t.last\_update\_time as last\_update\_time
146 UPDATE all\_table a SET a.col\_list\_alias\=
147 (
148 SELECT GROUP\_CONCAT(
149     CONCAT\_WS('','t.',col,' as ',col)
150 ) FROM all\_col\_table WHERE tbl\_name \= a.tbl\_name
151 );
152 \-- #######################################
153 UPDATE all\_table a SET a.col\_list\=
154 (
155 SELECT GROUP\_CONCAT( col ) FROM all\_col\_table WHERE tbl\_name \= a.tbl\_name
156 );
157 \-- 更新结果为："<if test = 'queryObj.id!=null '>  and id=#{queryObj.id,jdbcType=INTEGER}   </if>",
158 UPDATE all\_table a SET a.query\_if\_test\=
159 (
160 SELECT 
161 GROUP\_CONCAT(
162             CONCAT\_WS('','"<if test = ',if\_test,'\> and ',col\_for\_query\_jdbc,' </if>" ,')
163         SEPARATOR '\\r\\n') 
164     FROM all\_col\_table WHERE tbl\_name \= a.tbl\_name
165 );
166 
167 \-- #######################################
168 UPDATE all\_table a SET a.update\_if\_test\=
169 (
170 SELECT 
171 GROUP\_CONCAT(
172             CONCAT\_WS('','"<if test = ',update\_if\_test,'\>  ',col\_for\_update\_jdbc,', </if>" ,')
173         SEPARATOR '\\r\\n') 
174     FROM all\_col\_table WHERE tbl\_name \= a.tbl\_name AND a.primary\_key!=col
175 );
176 
177 \-- #######################################
178 UPDATE all\_table a SET a.insert\_if\_test\=
179 (
180 SELECT   
181 GROUP\_CONCAT(col\_for\_insert\_jdbc) 
182     FROM all\_col\_table WHERE tbl\_name \= a.tbl\_name
183 );
184 
185 
186 
187 \-- #######################################
188 \-- 更新update\_chase
189 UPDATE all\_table a SET a.update\_chase\=
190 (
191 SELECT 
192 GROUP\_CONCAT( col\_for\_update\_jdbc ) 
193     FROM all\_col\_table WHERE tbl\_name \= a.tbl\_name AND a.primary\_key !=col
194 );
195  
196 
197 
198 
199 \-- #################################################################################
200 \-- #################################开始组建语句####################################
201 \-- #################################################################################
202 \-- ############################## mapper select ####################################
203 \-- #################################################################################
204 \-- #################################################################################
205 
206 \-- 保存所有表及表的所有字段
207 DROP TABLE if EXISTS java\_code;
208 CREATE table if not exists java\_code(
209 tbl\_name VARCHAR(256)  NOT NULL  COMMENT '表名:tbl\_sapo\_admin\_account',
210 code\_type VARCHAR(255) COMMENT '代码类似，inert,update,select',
211 code\_layer VARCHAR(255) COMMENT '代码层级 ，mapper,dao,domain',
212 func\_desc VARCHAR(255) COMMENT '功能描述',
213 java\_code TEXT COMMENT 'java代码',
214 versions VARCHAR(255) COMMENT '版本',
215 versions\_desc VARCHAR(255) COMMENT '版本描述'
216 ) ENGINE\=InnoDB DEFAULT CHARSET\=utf8;
217 
218 
219 
220 \-- ######################################################################################################
221 \-- 通用查询，返回对象
222 \-- ######################################################################################################
223 
224 
225 SET @query\_template1\=
226 '
227 // 通用查询，返回对象
228 @Select({ 
229 "<script> ",
230 "select @col\_list\_alias@ ",
231 "from @tbl\_name@ t ",
232 "<where> ",
233 "<if test=\\'queryObj!=null\\'\>",
234 @query\_if\_test@
235 "</if>",
236 "</where> ",
237 "</script>" 
238 })
239 @tbl\_name\_camel@ get@tbl\_name\_camel@(@Param("queryObj") @tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForQuery);
240 ';
241 
242 INSERT INTO java\_code
243 SELECT tbl\_name,'select','mapper','通用查询，返回对象',@query\_template1,'1','' FROM all\_table;
244 
245 \-- dao层语句
246 SET @query\_template1\=
247 '
248 // 通用查询，返回对象
249 public @tbl\_name\_camel@ get@tbl\_name\_camel@(@tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForQuery){
250     
251 if(@tbl\_name\_ref\_camel@ForQuery == null){
252 bizLogger.warn(" select @tbl\_name@  @tbl\_name\_ref\_camel@ForQuery is null ");
253 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
254 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " @tbl\_name\_ref\_camel@ForQuery is null , bizId=" + BizLogUtils.getValueOfBizId());
255 }
256     
257 @tbl\_name\_camel@ @tbl\_name\_ref\_camel@ = mapper.get@tbl\_name\_camel@(@tbl\_name\_ref\_camel@ForQuery);
258     
259 if(@tbl\_name\_ref\_camel@ == null){
260 bizLogger.warn(" select @tbl\_name@  result is null ,@tbl\_name\_ref\_camel@ForQuery : "
261 + @tbl\_name\_ref\_camel@ForQuery.toString());
262 throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
263 }
264  
265 return @tbl\_name\_ref\_camel@;     
266 }
267 ';
268 
269 INSERT INTO java\_code
270 SELECT tbl\_name,'select','dao','通用查询,返回对象',@query\_template1,'1','' FROM all\_table;
271 
272 
273 \-- ######################################################################################################
274 \-- 通用查询，返回集合
275 \-- ######################################################################################################
276 
277 SET @query\_template1\=
278 '
279 // 通用查询，返回集合
280 @Select({ 
281 "<script> ",
282 "select @col\_list\_alias@ ",
283 "from @tbl\_name@ t ",
284 "<where> ",
285 "<if test=\\'queryObj!=null\\'\>",
286 @query\_if\_test@
287 "</if>",
288 "</where> ",
289 "</script>" 
290 })
291 List<@tbl\_name\_camel@> get@tbl\_name\_camel@List(@Param("queryObj") @tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForQuery);
292 ';
293 
294 INSERT INTO java\_code
295 SELECT tbl\_name,'select','mapper','通用查询，返回集合',@query\_template1,'1','' FROM all\_table;
296 
297 \-- dao层
298 SET @query\_template1\=
299 '
300 // 通用查询，返回集合
301 public List<@tbl\_name\_camel@> get@tbl\_name\_camel@List(@tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForQuery){
302     
303 if(@tbl\_name\_ref\_camel@ForQuery == null){
304 bizLogger.warn(" select @tbl\_name@  @tbl\_name\_ref\_camel@ForQuery is null ");
305 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
306 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " @tbl\_name\_ref\_camel@ForQuery is null , bizId=" + BizLogUtils.getValueOfBizId());
307 }
308     
309 List<@tbl\_name\_camel@> @tbl\_name\_ref\_camel@List = mapper.get@tbl\_name\_camel@List(@tbl\_name\_ref\_camel@ForQuery);
310     
311 if(@tbl\_name\_ref\_camel@List == null || @tbl\_name\_ref\_camel@List.size()==0){
312 bizLogger.warn(" select @tbl\_name@  List is null or size=0 ,@tbl\_name\_ref\_camel@ForQuery : "
313 + @tbl\_name\_ref\_camel@ForQuery.toString());
314 throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
315 }
316  
317 return @tbl\_name\_ref\_camel@List;     
318 }
319 ';
320 
321 INSERT INTO java\_code
322 SELECT tbl\_name,'select','dao','通用查询，返回集合',@query\_template1,'1','' FROM all\_table;
323 
324 
325 \-- ######################################################################################################
326 \-- 通过主键查询，返回对象
327 \-- ######################################################################################################
328 \-- 本文来自博客园，作者：wanglifeng，转载请注明原文链接：https://www.cnblogs.com/wanglifeng717/p/16219565.html
329 SET @query\_template1\=
330 '
331 // 通过主键查询，返回对象
332 @Select({
333 "select @col\_list\_alias@ ",
334 "from @tbl\_name@ t ",
335 "where @primary\_key@ = #{@col\_camel@,jdbcType=@jdbc\_type@}"
336 })
337 @tbl\_name\_camel@ get@tbl\_name\_camel@ByPrimaryKey(@java\_type@ @col\_camel@);
338 ';
339 
340 INSERT INTO java\_code
341 SELECT tbl\_name,'select','mapper','通过主键查询',@query\_template1,'1','' FROM  all\_table;
342 
343 
344 \-- dao层
345 SET @query\_template1\=
346 '
347 // 通用主键查询，返回对象
348 public @tbl\_name\_camel@ get@tbl\_name\_camel@ByPrimaryKey(@java\_type@ @col\_camel@){
349     
350 if(@col\_camel@ == null){
351 bizLogger.warn(" select @tbl\_name@  @col\_camel@ is null ");
352 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
353 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " @col\_camel@ is null , bizId=" + BizLogUtils.getValueOfBizId());
354 }
355     
356 @tbl\_name\_camel@ @tbl\_name\_ref\_camel@ = mapper.get@tbl\_name\_camel@ByPrimaryKey(@col\_camel@);
357     
358 if(@tbl\_name\_ref\_camel@ == null){
359 bizLogger.warn(" select @tbl\_name@  by primary key ,but find null ,@col\_camel@ : "
360 + @col\_camel@.toString());
361 throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
362 }
363  
364 return @tbl\_name\_ref\_camel@;     
365 }
366 ';
367 
368 
369 
370 INSERT INTO java\_code
371 SELECT tbl\_name,'select','dao','通用主键查询，返回集合',@query\_template1,'1','' FROM all\_table;
372 
373 
374 \-- ######################################################################################################
375 \-- 通过条件和主键in查询,返回集合
376 \-- ######################################################################################################
377 
378 
379 SET @query\_template1\=
380 '
381 // 通过条件和主键in查询,返回集合
382 @Select({ 
383 "<script> ",
384 "select @col\_list\_alias@ ",
385 "from @tbl\_name@ t ",
386 "<where> ",
387 "<if test=\\'queryObj!=null\\'\>",
388 @query\_if\_test@
389 "</if>",
390 "<if test = \\'itemList != null and itemList.size() \> 0\\'\> AND id IN " ,
391 "    <foreach collection=\\'itemList\\' item=\\'item\\' index=\\'index\\' open=\\'(\\' separator=\\',\\' close=\\')\\'\> " ,
392 "        #{item,jdbcType=@jdbc\_type@}   " ,
393 "    </foreach> " ,
394 "</if>" ,
395 "</where> ",
396 "</script>" 
397 })
398 List<@tbl\_name\_camel@> get@tbl\_name\_camel@List(@Param("itemList") List<@java\_type@> @col\_camel@ListForQuery,@Param("queryObj") @tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForQuery);
399 ';
400 
401 INSERT INTO java\_code
402 SELECT tbl\_name,'select','mapper','通过条件和主键in查询,返回集合',@query\_template1,'1','' FROM  all\_table;
403 
404 
405 \-- dao层
406 SET @query\_template1\=
407 '
408 // 通过条件和主键in查询,返回集合
409 public List<@tbl\_name\_camel@> get@tbl\_name\_camel@List( List<@java\_type@> @col\_camel@ListForQuery, @tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForQuery){
410     
411 if(@col\_camel@ListForQuery == null && @tbl\_name\_ref\_camel@ForQuery == null){
412 bizLogger.warn(" select @tbl\_name@  @col\_camel@ListForQuery  && @tbl\_name\_ref\_camel@ForQuery  is null at same time");
413 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
414 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " @col\_camel@ListForQuery  && @tbl\_name\_ref\_camel@ForQuery  is null at same time , bizId=" + BizLogUtils.getValueOfBizId());
415 }
416     
417 List<@tbl\_name\_camel@> @tbl\_name\_ref\_camel@List = mapper.get@tbl\_name\_camel@List(@col\_camel@ListForQuery,@tbl\_name\_ref\_camel@ForQuery);
418     
419 if(@tbl\_name\_ref\_camel@List == null || @tbl\_name\_ref\_camel@List.size()==0){
420 bizLogger.warn(" select @tbl\_name@  ,but result list is null or size=0 ,@tbl\_name\_ref\_camel@ForQuery : "
421 + @tbl\_name\_ref\_camel@ForQuery.toString()+"; @col\_camel@ListForQuery : "+@col\_camel@ListForQuery.toString());
422 throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
423 }
424  
425 return @tbl\_name\_ref\_camel@List;     
426 }
427 ';
428 
429 INSERT INTO java\_code
430 SELECT tbl\_name,'select','dao','通过条件和主键in查询,返回集合',@query\_template1,'1','' FROM all\_table;
431 
432 
433 
434 \-- #################################################################################
435 \-- #################################################################################
436 \-- #################################################################################
437 \-- #################################################################################
438 \-- ############################## mapper update ####################################
439 \-- #################################################################################
440 \-- #################################################################################
441 
442 \-- ######################################################################################################
443 \-- 通过主键更新
444 \-- ######################################################################################################
445 
446 
447 SET @query\_template1\=
448 '
449 // 通过主键更新
450 @Update({
451 "update @tbl\_name@ set ",
452 "@update\_chase@ ",
453 "where @primary\_key@ = #{updateObj.@col\_camel@,jdbcType=@jdbc\_type@} "
454 })
455 int update@tbl\_name\_camel@ByPrimaryKey(@Param("updateObj") @tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForUpdate);
456 ';
457 
458 
459 INSERT INTO java\_code
460 SELECT tbl\_name,'update','mapper','通过主键更新',@query\_template1,'1','' FROM all\_table;
461 
462 \-- dao
463 
464 SET @query\_template1\=
465 '
466 // 通过主键更新
467 public void update@tbl\_name\_camel@ByPrimaryKey(@tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForUpdate){
468 
469 if(@tbl\_name\_ref\_camel@ForUpdate == null){
470 bizLogger.warn(" update @tbl\_name@  @tbl\_name\_ref\_camel@ForUpdate is null ");
471 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
472 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " @tbl\_name\_ref\_camel@ForUpdate is null , bizId=" + BizLogUtils.getValueOfBizId());
473 }
474 
475 int updateResult = 0;
476     
477 try {
478 updateResult =  mapper.update@tbl\_name\_camel@ByPrimaryKey(@tbl\_name\_ref\_camel@ForUpdate);
479 } catch (DuplicateKeyException e) {
480 bizLogger.warn(" update @tbl\_name@ duplicateKeyException ,@tbl\_name\_ref\_camel@ForUpdate : "
481 + @tbl\_name\_ref\_camel@ForUpdate.toString());
482 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
483 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " duplicate exception ,bizId=" + BizLogUtils.getValueOfBizId(),e);
484 }
485     
486 /\*
487 if (updateResult!=1) {
488 bizLogger.warn("update  @tbl\_name@  result !=1 \[updateResult, @tbl\_name\_ref\_camel@ForUpdate\] : "+updateResult+","+ @tbl\_name\_ref\_camel@ForUpdate.toString());
489 throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
490 }
491 \*/
492 }
493 ';
494 
495 
496 INSERT INTO java\_code
497 SELECT tbl\_name,'update','dao','通过主键更新',@query\_template1,'1','' FROM all\_table;
498 
499 \-- ######################################################################################################
500 \-- 通过条件更新
501 \-- ######################################################################################################
502 
503 
504 SET @query\_template1\=
505 '
506 // 通过条件更新
507 @Update({ 
508 "<script> ",
509 "update @tbl\_name@ ",
510 "<set>",
511 "<if test=\\'updateObj!=null\\'\>",
512 @update\_if\_test@
513 "</if>",
514 "</set>",
515 "<where>",
516 "<if test=\\'queryObj!=null\\'\>",
517 @query\_if\_test@
518 "</if>",
519 "</where>",
520 "</script>" 
521 })
522 int update@tbl\_name\_camel@(@Param("updateObj") @tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForUpdate,@Param("queryObj") @tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForQuery);
523 ';
524 
525 
526 INSERT INTO java\_code
527 SELECT tbl\_name,'update','mapper','通过条件更新',@query\_template1,'1','' FROM all\_table;
528 
529 \-- dao
530 SET @query\_template1\=
531 '
532 // 通过条件更新
533 public void update@tbl\_name\_camel@(@tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForUpdate,@tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForQuery){
534     
535 if(@tbl\_name\_ref\_camel@ForUpdate == null || @tbl\_name\_ref\_camel@ForQuery==null ){
536 bizLogger.warn(" update @tbl\_name@  @tbl\_name\_ref\_camel@ForUpdate or @tbl\_name\_ref\_camel@ForQuery is null ");
537 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
538 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " @tbl\_name\_ref\_camel@ForUpdate or @tbl\_name\_ref\_camel@ForQuery is null , bizId=" + BizLogUtils.getValueOfBizId());
539 }
540     
541 int updateResult = 0;
542     
543 try {
544 updateResult =  mapper.update@tbl\_name\_camel@(@tbl\_name\_ref\_camel@ForUpdate,@tbl\_name\_ref\_camel@ForQuery);
545 } catch (DuplicateKeyException e) {
546 bizLogger.error(" update @tbl\_name@ duplicateKeyException ,@tbl\_name\_ref\_camel@ForQuery : "
547 + @tbl\_name\_ref\_camel@ForQuery.toString());
548 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
549 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " duplicate exception ,bizId=" + BizLogUtils.getValueOfBizId(),e);
550 }
551 /\*
552 if (updateResult!=1) {
553 bizLogger.warn("update  @tbl\_name@  result !=1 \[updateResult, @tbl\_name\_ref\_camel@ForQuery\] : "+updateResult+","+ @tbl\_name\_ref\_camel@ForQuery.toString());
554 throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
555 }
556 \*/
557 }
558 ';
559 
560 
561 INSERT INTO java\_code
562 SELECT tbl\_name,'update','dao','通过条件更新',@query\_template1,'1','' FROM all\_table;
563 
564 
565 
566 \-- ######################################################################################################
567 \-- 通过条件和主键in更新
568 \-- ######################################################################################################
569 
570 
571 SET @query\_template1\=
572 '
573 // 通过条件和主键in更新
574 @Update({ 
575 "<script> ",
576 "update @tbl\_name@ ",
577 "<set>",
578 "<if test=\\'updateObj!=null\\'\>",
579 @update\_if\_test@
580 "</if>",
581 "</set>",
582 "<where>",
583 "<if test=\\'queryObj!=null\\'\>",
584 @query\_if\_test@
585 "</if>",
586 "<if test = \\'itemList != null and itemList.size() \> 0\\'\> AND id IN " ,
587 "    <foreach collection=\\'itemList\\' item=\\'item\\' index=\\'index\\' open=\\'(\\' separator=\\',\\' close=\\')\\'\> " ,
588 "        #{item,jdbcType=@jdbc\_type@}   " ,
589 "    </foreach> " ,
590 "</if>" ,
591 "</where>",
592 "</script>" 
593 })
594 int update@tbl\_name\_camel@(@Param("itemList") List<@java\_type@> @col\_camel@ListForQuery,@Param("queryObj") @tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForQuery,@Param("updateObj") @tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForUpdate);
595 ';
596 
597 
598 INSERT INTO java\_code
599 SELECT tbl\_name,'update','mapper','通过条件和主键in更新',@query\_template1,'1','' FROM all\_table;
600 
601 \-- dao
602 
603 SET @query\_template1\=
604 '
605 // 通过条件和主键in更新
606 public void update@tbl\_name\_camel@(List<@java\_type@> @col\_camel@ListForQuery,@tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForQuery,@tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForUpdate){
607     
608 if(@col\_camel@ListForQuery == null && @tbl\_name\_ref\_camel@ForQuery==null ){
609 bizLogger.warn(" update @tbl\_name@  @col\_camel@ListForQuery and @tbl\_name\_ref\_camel@ForQuery is null at same time");
610 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
611 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " @col\_camel@ListForQuery and @tbl\_name\_ref\_camel@ForQuery is null at same time , bizId=" + BizLogUtils.getValueOfBizId());
612 }
613     
614 if(@tbl\_name\_ref\_camel@ForUpdate == null  ){
615 bizLogger.warn(" update @tbl\_name@  @tbl\_name\_ref\_camel@ForUpdate is null ");
616 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
617 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " @tbl\_name\_ref\_camel@ForUpdatey is null  , bizId=" + BizLogUtils.getValueOfBizId());
618 }
619     
620     
621 int updateResult = 0;
622     
623 try {
624 updateResult =  mapper.update@tbl\_name\_camel@(@col\_camel@ListForQuery,@tbl\_name\_ref\_camel@ForQuery,@tbl\_name\_ref\_camel@ForUpdate);
625 } catch (DuplicateKeyException e) {
626 bizLogger.error(" update @tbl\_name@ duplicateKeyException ,@tbl\_name\_ref\_camel@ForQuery : "
627 + @tbl\_name\_ref\_camel@ForQuery.toString()+" ; @col\_camel@ListForQuery: "+@col\_camel@ListForQuery);
628 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
629 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " duplicate exception ,bizId=" + BizLogUtils.getValueOfBizId(),e);
630 }
631 /\*
632 if (updateResult!=1) {
633 bizLogger.warn("update  @tbl\_name@ result  !=1 \[updateResult, @tbl\_name\_ref\_camel@ForQuery,@col\_camel@ListForQuery\] : "+updateResult+","+ @tbl\_name\_ref\_camel@ForQuery.toString()+","+@col\_camel@ListForQuery);
634 throw new BusinessException(ResultInfo.NO\_DATA.getCode(),ResultInfo.NO\_DATA.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
635 }
636 \*/
637 }
638 ';
639 
640 \-- 本文来自博客园，作者：wanglifeng，转载请注明原文链接：https://www.cnblogs.com/wanglifeng717/p/16219565.html
641 INSERT INTO java\_code
642 SELECT tbl\_name,'update','dao','通过条件和主键in更新',@query\_template1,'1','' FROM all\_table;
643 
644 
645 
646 \-- #################################################################################
647 \-- #################################################################################
648 \-- #################################################################################
649 \-- #################################################################################
650 \-- ############################## mapper insert ####################################
651 \-- #################################################################################
652 \-- #################################################################################
653 
654 \-- ######################################################################################################
655 \-- 单条插入:id自增
656 \-- ######################################################################################################
657 
658 SET @query\_template1\=
659 '
660 // 单条插入:id自增
661 @Insert({ 
662 "insert into @tbl\_name@ ",
663 "(@col\_list@)",
664 "values ",
665 "(@insert\_if\_test@) "
666 })
667 @Options(useGeneratedKeys = true, keyProperty = "id", keyColumn = "id")
668 int insert@tbl\_name\_camel@(@Param("item") @tbl\_name\_camel@ @tbl\_name\_ref\_camel@);
669 ';
670 
671 
672 INSERT INTO java\_code
673 SELECT tbl\_name,'insert','mapper','单条插入',@query\_template1,'1','id自增' FROM all\_table;
674 
675 \-- dao
676 SET @query\_template1\=
677 '
678 // 单条插入:id自增
679 public int insert@tbl\_name\_camel@(@tbl\_name\_camel@ @tbl\_name\_ref\_camel@){
680 
681 if(@tbl\_name\_ref\_camel@ == null  ){
682 bizLogger.warn(" insert @tbl\_name@  @tbl\_name\_ref\_camel@ is null ");
683 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
684 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " @tbl\_name\_ref\_camel@ is null  , bizId=" + BizLogUtils.getValueOfBizId());
685 }
686 
687 int insertResult =0;
688 try {
689 insertResult =  mapper.insert@tbl\_name\_camel@(@tbl\_name\_ref\_camel@);
690 } catch (DuplicateKeyException e) {
691 bizLogger.error(" update @tbl\_name@ duplicateKeyException ,@tbl\_name\_ref\_camel@ : "
692 + @tbl\_name\_ref\_camel@.toString());
693 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
694 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " duplicate exception ,bizId=" + BizLogUtils.getValueOfBizId(),e);
695 }
696     
697 if (insertResult==0) {
698 bizLogger.warn("insert  @tbl\_name@  result == 0 , @tbl\_name\_ref\_camel@: "+@tbl\_name\_ref\_camel@.toString());
699 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
700 }   
701     
702 return insertResult;
703 }
704 ';
705 
706 INSERT INTO java\_code
707 SELECT tbl\_name,'insert','dao','单条插入',@query\_template1,'1','id自增' FROM all\_table;
708 
709 \-- ######################################################################################################
710 \-- 单条插入：id不自增
711 \-- ######################################################################################################
712 \-- 本文来自博客园，作者：wanglifeng，转载请注明原文链接：https://www.cnblogs.com/wanglifeng717/p/16219565.html
713 SET @query\_template1\=
714 '
715 // 单条插入：id不自增
716 @Insert({ 
717 "insert into @tbl\_name@ ",
718 "(@col\_list@)",
719 "values ",
720 "(@insert\_if\_test@) "
721 })
722 int insert@tbl\_name\_camel@(@Param("item") @tbl\_name\_camel@ @tbl\_name\_ref\_camel@);
723 ';
724 
725 
726 INSERT INTO java\_code
727 SELECT tbl\_name,'insert','mapper','单条插入',@query\_template1,'2','id不自增' FROM all\_table;
728 
729 \-- dao
730 SET @query\_template1\=
731 '
732 // 单条插入：id不自增
733 public void insert@tbl\_name\_camel@(@tbl\_name\_camel@ @tbl\_name\_ref\_camel@){
734 
735 if(@tbl\_name\_ref\_camel@ == null  ){
736 bizLogger.warn(" insert @tbl\_name@  @tbl\_name\_ref\_camel@ is null ");
737 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
738 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " @tbl\_name\_ref\_camel@ is null  , bizId=" + BizLogUtils.getValueOfBizId());
739 }
740 
741 int insertResult =0;
742 try {
743 insertResult =  mapper.insert@tbl\_name\_camel@(@tbl\_name\_ref\_camel@);
744 } catch (DuplicateKeyException e) {
745 bizLogger.error(" update @tbl\_name@ duplicateKeyException ,@tbl\_name\_ref\_camel@ : "
746 + @tbl\_name\_ref\_camel@.toString());
747 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),
748 ResultInfo.SYS\_INNER\_ERROR.getDesc() + " duplicate exception ,bizId=" + BizLogUtils.getValueOfBizId(),e);
749 }
750     
751 if (insertResult!=1) {
752 bizLogger.warn("insert  @tbl\_name@  result ！= 1 , @tbl\_name\_ref\_camel@: "+@tbl\_name\_ref\_camel@.toString());
753 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + " ,bizId="+BizLogUtils.getValueOfBizId());
754 }   
755     
756 }
757 ';
758 
759 INSERT INTO java\_code
760 SELECT tbl\_name,'insert','dao','单条插入',@query\_template1,'2','id不自增' FROM all\_table;
761 
762 
763 \-- ######################################################################################################
764 \-- 批量插入
765 \-- ######################################################################################################
766 SET @query\_template1\=
767 '
768 // 批量插入
769 @Insert({
770 "<script> ",
771 "insert into @tbl\_name@ ( @col\_list@ ) values",
772         "<foreach collection=\\'itemList\\' item=\\'item\\' index=\\'index\\' open=\\'(\\' separator=\\'),(\\' close=\\')\\'\>",
773 "@insert\_if\_test@ ",
774 "</foreach>",
775 "</script>" 
776 })
777 int batchInsert@tbl\_name\_camel@(@Param("itemList") List<@tbl\_name\_camel@> @tbl\_name\_ref\_camel@List);
778 ';
779 
780 
781 INSERT INTO java\_code
782 SELECT tbl\_name,'insert','mapper','批量插入', @query\_template1,'1',''  FROM all\_table;
783 
784 \-- dao
785 
786 SET @query\_template1\=
787 '
788 // 批量插入
789 @SuppressWarnings("unchecked")
790 public int batchInsert@tbl\_name\_camel@(Object object) {
791 // 类型转换，支持单个对象或者集合形式作为入参
792 List<@tbl\_name\_camel@> list = null;
793 if (object instanceof @tbl\_name\_camel@) {
794 list = new ArrayList<>();
795 list.add((@tbl\_name\_camel@) object);
796 } else if (object instanceof List) {
797 for (Object o : (List<?>) object) {
798 if (!(o instanceof @tbl\_name\_camel@)) {
799 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + ",error element: " + o.toString() + ",object type is error for batch insert" + BizLogUtils.getValueOfBizId());
800 }
801 }
802 list = (List<@tbl\_name\_camel@>) object;
803 } else {
804 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + ",object type is error for batch insert"  + BizLogUtils.getValueOfBizId());
805 }
806 
807 // 如果集合为空则报异常
808 if (list == null || list.size() == 0) {
809 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + ",batch insert empty ,bizId="  + BizLogUtils.getValueOfBizId());
810 }
811 
812 // 插入阈值， 每多少条commit一次，默认是200条做一次。
813 int threshold = 200;
814 
815 int result = 0;
816 int sum = list.size();
817 int end = 0;
818 for (int i = 0; i < sum; i = i + threshold) {
819 end = i + threshold > sum ? sum : i + threshold;
820 try {
821 result += mapper.batchInsert@tbl\_name\_camel@(list.subList(i, end));
822 } catch (Exception e) {
823 //  根据业务做补偿机制，例如通过end值，将之前插入的值全部删除或者状态翻转为无效
824 batchInsert@tbl\_name\_camel@FailOffset(list.subList(0, end));
825 throw new BusinessException(ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc()+ ",end value： " + end + ",batch insert has error,offset \[batch insert error\] success ,bizId=" + BizLogUtils.getValueOfBizId(),  e);
826 }
827 }
828 return result;
829 }
830 
831 // 批量插入失败后，进行相关补偿操作
832 private void batchInsert@tbl\_name\_camel@FailOffset(List<@tbl\_name\_camel@> list) {
833 
834 //  补偿操作，可以比插入操作的阈值大一点， 每多少条commit一次，默认是400条做一次。
835 int threshold = 400;
836 int sum = list.size();
837 int end = 0;
838 for (int i = 0; i < sum; i = i + threshold) {
839 end = i + threshold > sum ? sum : i + threshold;
840 try {
841 // TODO 批量插入失败后，需要进行补偿的操作，例如：将之前插入的值全部删除或者状态翻转为无效
842 //List<Integer> idList = list.subList(i, end).stream().map(@tbl\_name\_camel@::getId).collect(Collectors.toList());
843 //@tbl\_name\_camel@ @tbl\_name\_ref\_camel@ForUpdate = new @tbl\_name\_camel@();
844 //@tbl\_name\_ref\_camel@ForUpdate.setxx();
845 //update@tbl\_name\_camel@(idList,null,@tbl\_name\_ref\_camel@ForUpdate);
846 } catch (Exception e) {
847 // 如果做业务补偿的时候也失败了，只能将重要信息打印在日志里面，运维干预进行恢复了
848 throw new BusinessException( ResultInfo.SYS\_INNER\_ERROR.getCode(),ResultInfo.SYS\_INNER\_ERROR.getDesc() + ", \[offset batch insert error\]  failed ,"+ ",bizId: " + BizLogUtils.getValueOfBizId(), e);
849 }
850 }
851 
852 }
853 ';
854 
855 
856 INSERT INTO java\_code
857 SELECT tbl\_name,'insert','dao','批量插入', @query\_template1,'1',''  FROM all\_table;
858 
859 
860 
861 \-- ######################################################################################################
862 \-- pojo setter方法
863 \-- ######################################################################################################
864 
865 INSERT INTO java\_code
866 SELECT tbl\_name,'pojo','setter','实体类赋值',pojo\_code,'1',''
867 FROM (
868 SELECT tbl\_name ,
869 (
870     SELECT CONCAT\_WS('','/\* 新建对象\*/\\r\\n','@tbl\_name\_camel@',' ','@tbl\_name\_ref\_camel@','\= new ','@tbl\_name\_camel@','();\\r\\n\\r\\n/\*设置属性\*/\\r\\n',
871 group\_concat(
872                    /\* cdkmallGoodsApply.setUserUuid(userUuid); \*/
873                     CONCAT\_WS( ''
874                         ,CONCAT\_WS('','/\*',c.column\_comment,' | ',c.column\_type,' | ',if(c.is\_nullable\='YES','可空','非空'),if(c.extra\='','',CONCAT\_WS('',' | ',c.extra)),' | ','默认=',ifnull(c.COLUMN\_DEFAULT,'null'),'  \*/ \\r\\n')
875                         ,REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE( REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(TABLE\_NAME, CONCAT(@noStrInTbl,'\_'), ''), '\_z', 'Z'), '\_y', 'Y'), '\_x', 'X'), '\_w', 'W'), '\_v', 'V'), '\_u', 'U'), '\_t', 'T'), '\_s', 'S'), '\_r', 'R'), '\_q', 'Q'), '\_p', 'P'), '\_o', 'O'), '\_n', 'N'), '\_m', 'M'), '\_l', 'L'), '\_k', 'K'), '\_j', 'J'), '\_i', 'I'), '\_h', 'H'), '\_g', 'G'), '\_f', 'F'), '\_e', 'E'), '\_d', 'D'), '\_c', 'C'), '\_b', 'B'), '\_a', 'A'),'\_','')  
876                          ,REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE( REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(CONCAT\_WS('','.set','\_',c.column\_name), '\_z', 'Z'), '\_y', 'Y'), '\_x', 'X'), '\_w', 'W'), '\_v', 'V'), '\_u', 'U'), '\_t', 'T'), '\_s', 'S'), '\_r', 'R'), '\_q', 'Q'), '\_p', 'P'), '\_o', 'O'), '\_n', 'N'), '\_m', 'M'), '\_l', 'L'), '\_k', 'K'), '\_j', 'J'), '\_i', 'I'), '\_h', 'H'), '\_g', 'G'), '\_f', 'F'), '\_e', 'E'), '\_d', 'D'), '\_c', 'C'), '\_b', 'B'), '\_a', 'A'),'\_','') 
877                          ,REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE( REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(CONCAT\_WS('','(',c.column\_name,');'), '\_z', 'Z'), '\_y', 'Y'), '\_x', 'X'), '\_w', 'W'), '\_v', 'V'), '\_u', 'U'), '\_t', 'T'), '\_s', 'S'), '\_r', 'R'), '\_q', 'Q'), '\_p', 'P'), '\_o', 'O'), '\_n', 'N'), '\_m', 'M'), '\_l', 'L'), '\_k', 'K'), '\_j', 'J'), '\_i', 'I'), '\_h', 'H'), '\_g', 'G'), '\_f', 'F'), '\_e', 'E'), '\_d', 'D'), '\_c', 'C'), '\_b', 'B'), '\_a', 'A'),'\_','')  
878                      ) SEPARATOR '\\r\\n'
879 )
880             ) as pojo\_code
881     FROM
882 information\_schema.COLUMNS c
883         WHERE
884         c.table\_schema\= DATABASE() AND 
885         c.TABLE\_NAME \= a.tbl\_name
886     ) AS pojo\_code
887 FROM all\_table a
888 ) tt;
889 
890 \-- ######################################################################################################
891 \-- ######################################################################################################
892 \-- 本文来自博客园，作者：wanglifeng，转载请注明原文链接：https://www.cnblogs.com/wanglifeng717/p/16219565.html
893 \-- 将模板中的@xx@占位符统一全部替换掉
894 UPDATE java\_code j SET j.java\_code\=
895 (
896 SELECT 
897 REPLACE(
898 REPLACE(
899 REPLACE(
900 REPLACE(
901 REPLACE(
902 REPLACE(
903 REPLACE(
904 REPLACE(
905 REPLACE(
906 REPLACE(
907 REPLACE(
908 REPLACE(
909 REPLACE(
910 j.java\_code,'@col\_list\_alias@',col\_list\_alias),
911 '@tbl\_name@',tbl\_name),
912 '@primary\_key@',primary\_key),
913 '@col\_camel@',col\_camel),
914 '@jdbc\_type@',jdbc\_type),
915 '@tbl\_name\_camel@',tbl\_name\_camel),
916 '@tbl\_name\_ref\_camel@',tbl\_name\_ref\_camel),
917 '@query\_if\_test@',query\_if\_test),
918 '@update\_if\_test@',update\_if\_test),
919 '@col\_list@',col\_list),
920 '@insert\_if\_test@',insert\_if\_test),
921 '@update\_chase@',update\_chase),
922 '@java\_type@',java\_type) AS code
923 FROM 
924 (
925 SELECT 
926 a.tbl\_name,a.col\_list\_alias,a.primary\_key,c.col\_camel,c.jdbc\_type,a.tbl\_name\_camel,c.java\_type,a.query\_if\_test,a.tbl\_name\_ref\_camel,a.update\_if\_test,a.update\_chase
927 ,a.col\_list,a.insert\_if\_test
928 FROM all\_table a
929 JOIN all\_col\_table c
930 ON a.tbl\_name\=c.tbl\_name 
931 WHERE a.primary\_key \= c.col  
932 ) t
933 WHERE j.tbl\_name \=t.tbl\_name
934 );
935 
936 DELETE FROM java\_code WHERE tbl\_name NOT LIKE 'tbl%';
937 
938 
939 DROP TABLE all\_col\_table;
940 DROP TABLE all\_table;
941 
942 
943 \-- select \* from all\_col\_table;
944 \-- select \* from all\_table;
945  SELECT \* FROM java\_code;
946  
947  /\*
948 SELECT java\_code FROM java\_code WHERE tbl\_name = 'tbl\_ams\_award\_pool' AND code\_layer='mapper';
949 
950 SELECT java\_code FROM java\_code WHERE tbl\_name = 'tbl\_ams\_award\_pool' AND code\_layer='dao';
951 
952  \*/
953 
954 END$
955 DELIMITER ;
956 
957 
958 CALL print\_code();
959 
960 
961 
962 \-- 本文来自博客园，作者：wanglifeng，转载请注明原文链接：https://www.cnblogs.com/wanglifeng717/p/16219565.html

View Code

本文来自博客园，作者：wanglifeng，转载请注明原文链接：https://www.cnblogs.com/wanglifeng717/p/16219565.html