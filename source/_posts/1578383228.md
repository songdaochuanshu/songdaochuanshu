---
layout: post
title: "GitHub è‡ªåŠ¨åˆå¹¶ pr çš„æœºå™¨äººâ€”â€”auto-merge-bot"
date: "2022-04-19T03:25:17.562Z"
---
GitHub è‡ªåŠ¨åˆå¹¶ pr çš„æœºå™¨äººâ€”â€”auto-merge-bot
===================================

ä½œä¸ºä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼å›¾æ•°æ®åº“äº§å“ï¼ŒNebula Graph æ‰€æœ‰çš„ç ”å‘æµç¨‹éƒ½åœ¨ GitHub ä¸Šè¿ä½œã€‚åŸºäº GitHub ç”Ÿæ€ Nebula æŠ€æœ¯å›¢é˜Ÿæœ‰ä¸€å¥— pr çš„è‡ªåŠ¨åŒ–æµç¨‹ï¼Œæœ¬æ–‡ä¸»è¦è®²è§£è¿™å¥—æµç¨‹çš„æ¼”è¿›â€¦

æœ¬æ–‡é¦–å‘äº [Nebula Graph Community å…¬ä¼—å·](https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fnebula-website-cn.oss-cn-hangzhou.aliyuncs.com%2Fnebula-blog%2FWeChatOffical.png)

![](https://img2022.cnblogs.com/blog/1772871/202204/1772871-20220419111639313-34951911.jpg)

èƒŒæ™¯  
ä½œä¸ºä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼å›¾æ•°æ®åº“äº§å“ï¼ŒNebula æ‰€æœ‰çš„ç ”å‘æµç¨‹éƒ½åœ¨ GitHub ä¸Šè¿ä½œã€‚åŸºäº GitHub ç”Ÿæ€ Nebula æŠ€æœ¯å›¢é˜Ÿæœ‰ä¸€å¥— pr çš„è‡ªåŠ¨åŒ–æµç¨‹ï¼šæ¯æ¬¡ pr æä¸Šæ¥çš„æ—¶å€™ï¼Œ pull request bot è·‘ä¸€éæµ‹è¯•ï¼Œçœ‹çœ‹è¿™ä¸ª pr merge åˆ°ä¸»åˆ†æ”¯ä»¥åæ˜¯å¦å¯ä»¥ä¿è¯å½“å‰çš„ä¸€äº›åŠŸèƒ½è¿˜å¯ä»¥ç»§ç»­æ­£å¸¸è¿è¡Œã€‚

è¿™æ—¶å€™ï¼Œé—®é¢˜å‡ºç°äº†ï¼šæ¯ä¸ª pr ä¸Šæ¥ä¸€æ¬¡éƒ½è¦è·‘ä¸€éæµ‹è¯•ï¼Œè¿™æ ·çš„æ“ä½œæ—¢è´¹æ—¶åˆå¯¹æµ‹è¯•æœºé€ æˆä¸å¿…è¦çš„æ¶ˆè€—ã€‚äºæ˜¯ï¼ŒNebula ç ”å‘å›¢é˜Ÿæ‰“ç®—æ¼”å˜ç°æœ‰çš„ pr åˆå¹¶æœºå™¨äººã€‚

æœ¬æ–‡ä¸»è¦è®²è¿°å¦‚ä½•åœ¨åŸå…ˆçš„è®¾å®šä¸‹ï¼Œä¼˜åŒ–è®¾è®¡ï¼Œä»è€ŒèŠ‚çœæµ‹è¯•èµ„æºã€‚

è®¾è®¡æ€è·¯  
åŸºäºç°æœ‰ bot çš„å®ç°æ€è·¯ï¼Œæ¥å¼€å‘ä¸€æ¬¾æ–°çš„ bot ä¼˜åŒ– pr åˆå¹¶ã€‚æ–°çš„ bot ä¸»è¦ç‰¹ç‚¹æ˜¯ï¼Œåˆ©ç”¨ github action æä¾›çš„ on schedule åŠŸèƒ½ï¼Œåœ¨æ¯éš”ä¸€æ®µæ—¶é—´åå¯ä»¥è‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰ pull request åˆå¹¶åçš„æµ‹è¯•ï¼Œè¿™æ ·ä¸€æ¥å°±ä¸éœ€è¦æ¯ä¸ª pull request éƒ½è·‘ä¸€æ¬¡ CIï¼ŒèŠ‚çœäº†æ—¶é—´å’Œæ€§èƒ½æ¶ˆè€—ã€‚è‹¥æµ‹è¯•å¤±è´¥ï¼Œåˆ™ç”¨éšæœºå‰”é™¤çš„æ–¹æ¡ˆå‰”é™¤å…¶ä¸­æŸä¸ª pull request ç„¶åç»§ç»­æ‰§è¡Œæµ‹è¯•ï¼Œç›´åˆ°æµ‹è¯•é€šè¿‡æˆ–è€…æ²¡ç”¨å¯ç”¨çš„ pull request ä¸ºæ­¢ã€‚éšåå°†æ­¤æ¬¡æµ‹è¯•é€šè¿‡ä¸­çš„åŒ…å«çš„ pull request merge åˆ°ä¸»åˆ†æ”¯ä¸­ï¼Œå¹¶ä¸”æä¾›å‘é€æ­¤æ¬¡ merge ä¿¡æ¯åˆ°é’‰é’‰ç¾¤é‡Œçš„åŠŸèƒ½ã€‚

å‡è®¾ç”¨æˆ·æœ‰ä¸€ä¸ªæ–°çš„ pull request æä¸Šæ¥ï¼Œå®ƒçš„ä¸€ç”Ÿéœ€è¦ç»å†ï¼š

pull request è¢« reviewers approve  
Repository maintainer è¯„è®º/mergeï¼Œè¡¨æ˜åŒæ„ merge  
å®Œæˆ 1ï¼Œ2 åï¼Œ pull request å°±ä¼šè¢« bot è¯†åˆ«ä¸ºå¯ merge çš„ pull request  
bot å°†æ‰€æœ‰æ ‡ä¸ºå¯ merge çš„ pull request é¢„åŠ è½½åˆ° runner çš„æœ¬åœ°åŸºäº master çš„åˆ†æ”¯ä¸­è¿›è¡Œ ci æµ‹è¯•  
æµ‹è¯•é€šè¿‡ï¼Œpull request è¢« merge åˆ°ä¸»åˆ†æ”¯ï¼›æµ‹è¯•å¤±è´¥ï¼Œbot ä¼šéšæœºå‰”é™¤ç°æœ‰åŒ…å«çš„ pull requestï¼Œå†è¿›è¡Œæµ‹è¯•ï¼Œç›´åˆ°æµ‹è¯•é€šè¿‡æˆ–è€…æ²¡æœ‰å¯ç”¨çš„åˆ†æ”¯ä¸ºæ­¢ã€‚  
ï¼ˆå¯é€‰ï¼‰bot å°†æœ¬æ¬¡ merge çš„ç»“æœå‘é€åˆ°é’‰é’‰ç¾¤ä¸­  
éœ€è¦æ³¨æ„ï¼š

ä½¿ç”¨ auto-merge-bot æ—¶ï¼Œrepository éœ€è¦åœ¨ GitHub orgnization ä¸­é…ç½®ä¸€ä¸ª teamï¼Œè¿™ä¸ª team é‡Œçš„éƒ¨åˆ† member çš„ role éœ€è¢«æ ‡è¯†ä¸º maintainerï¼Œå¯¹åº”ä¸Šè¿°æ­¥éª¤2ã€‚

maintainer å¯ä»¥é€šè¿‡è¯„è®º / merge è¡¨ç¤ºåŒæ„ merge è¯¥ pull requestï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¯„è®º / wait a minute æˆ–è€…åˆ é™¤è¯„è®ºå–æ¶ˆ mergeï¼Œä½†æ˜¯ç›®å‰å¦‚æœ bot å·²ç»åœ¨è¿è¡Œä¸­ï¼Œåªèƒ½é€šè¿‡æ‰‹åŠ¨åœæ­¢æ­¤æ¬¡ bot çš„ workflow æ¥å–æ¶ˆ mergeï¼Œåœ¨æœªæ¥ç‰ˆæœ¬ä¸­ä¼šåŠ å…¥è¯¥åŠŸèƒ½ã€‚  
å…³äºé’‰é’‰ç¾¤å‘é€åŠŸèƒ½ï¼Œéœ€åœ¨é’‰é’‰ç¾¤ä¸­é…ç½®æœºå™¨äººï¼Œè¯¦è§ [https://developers.dingtalk.com/document/robots/custom-robot-access](https://developers.dingtalk.com/document/robots/custom-robot-access) å’Œ [https://developers.dingtalk.com/document/robots/customize-robot-security-settingsï¼Œç›®å‰ä»…æ”¯æŒåŠ ç­¾çš„å®‰å…¨è®¾ç½®æ–¹å¼ã€‚](https://developers.dingtalk.com/document/robots/customize-robot-security-settings%EF%BC%8C%E7%9B%AE%E5%89%8D%E4%BB%85%E6%94%AF%E6%8C%81%E5%8A%A0%E7%AD%BE%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BE%E7%BD%AE%E6%96%B9%E5%BC%8F%E3%80%82)  
ci æµ‹è¯•çš„ä»£ç éœ€è¦ç”¨æˆ·åœ¨å…¥å‚ä¸­ä¼ å…¥ã€‚  
Github Action çš„ schedule æœ‰å»¶è¿Ÿï¼Œå¹¶ä¸ä¼šæŒ‰ç…§æŒ‡å®šçš„æ—¶é—´å¦‚æœŸè¿è¡Œï¼Œé€šå¸¸å»¶è¿Ÿ 15 - 30 åˆ†é’Ÿã€‚  
æµ‹è¯•ç”¨ä¾‹  
...

on:  
schedule:  
\- cron: '\* \*/1 \* \* \*' --- æ¯å°æ—¶è·‘ä¸€æ¬¡  
workflow\_dispatch:

...

    - name: Run merge script
      uses: klay-ke/auto-merge-pr@master  --- è¯¥åœ°å€ä»¥åå¯èƒ½ä¼šæ”¹
      id: merge-pr
      with:
        send-to-dingtalk-group: true
        dingtalk-access-token: ${{ secrets.DINGTALK_ACCESS_TOKEN }}
        dingtalk-secret: ${{ secrets.DINGTALK_SECRET }}
        maintainer-team-name: ${{ secrets.MAINTAINER_TEAM_NAME }}
        gh-token: ${{ secrets.GH_TOKEN }}
        ci-command: 'bash ./build.sh'
    

è¾“å…¥  
å‚æ•° ç±»å‹ required é»˜è®¤å€¼ æè¿°  
send-to-dingtalk-group boolean å¦ false è‹¥ä¸º trueï¼Œåˆ™è¡¨æ˜éœ€è¦å‘é€ merge ä¿¡æ¯åˆ°é’‰é’‰ç¾¤ä¸­ï¼ŒåŒæ—¶ dingtalk-access-token å’Œ dingtalk-access-token å­—æ®µéœ€è¦æä¾›  
dingtalk-access-token string å½“ send-to-dingtalk-group ä¸º true ç©ºå­—ç¬¦ä¸² é’‰é’‰ç¾¤æœºå™¨äººçš„ access token  
dingtalk-secret string å½“ send-to-dingtalk-group ä¸º true ç©ºå­—ç¬¦ä¸² é’‰é’‰ç¾¤æœºå™¨äººçš„ secret.  
maintainer-team-name string æ˜¯ None maintainer team çš„åå­—  
gh-token string æ˜¯ None Github Token  
ci-command string å¦ None ci æµ‹è¯•ä»£ç   
è¾“å‡º  
å¯é€šè¿‡ ${{ steps.{actionè®¾ç½®çš„id - å¯¹åº”ç”¨ä¾‹ä¸­çš„merge-pr}.outputs.{å‚æ•°å} }} åœ¨åç»­ step ä¸­è¯»å–è¾“å‡ºï¼›

å‚æ•° ç±»å‹ æè¿°  
merge-info string æœ¬æ¬¡ merge ä¿¡æ¯  
error-log string é”™è¯¯æ—¥å¿—  
pass-log string æ—¥å¿—ä¿¡æ¯  
merged boolean æ˜¯å¦æœ‰ pull request æˆåŠŸ merge  
ä»¥ä¸Šã€‚

Nebula ç¤¾åŒºé¦–å±Šå¾æ–‡æ´»åŠ¨æ­£å¼å¼€å¯å•¦ ğŸ”— å¥–å“ä¸°åšï¼Œå…¨åœºæ™¯è¦†ç›–ï¼šæ’¸ç æœºæ¢°é”®ç›˜ã€æ‰‹æœºæ— çº¿å……ã€å¥åº·å°åŠ©æ‰‹æ™ºèƒ½æ‰‹ç¯ï¼Œæ›´æœ‰æ•°æ®åº“è®¾è®¡ã€çŸ¥è¯†å›¾è°±å®è·µä¹¦ç±ç­‰ä½ æ¥é¢†ï¼Œè¿˜æœ‰ Nebula ç²¾è‡´å‘¨è¾¹é€ä¸åœğŸ

æ¬¢è¿å¯¹ Nebula æœ‰å…´è¶£ã€å–œé’»ç ”çš„å°ä¼™ä¼´æ¥ä¹¦å†™è‡ªå·±å’Œ Nebula æœ‰è¶£çš„æ•…äº‹å‘€ï½

äº¤æµå›¾æ•°æ®åº“æŠ€æœ¯ï¼ŸåŠ å…¥ Nebula äº¤æµç¾¤è¯·å…ˆå¡«å†™ä¸‹ä½ çš„ Nebula åç‰‡ï¼ŒNebula å°åŠ©æ‰‹ä¼šæ‹‰ä½ è¿›ç¾¤~~

Nebula Graphï¼šä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼å›¾æ•°æ®åº“