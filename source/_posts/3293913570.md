---
layout: post
title: "Three.js è¿›é˜¶ä¹‹æ—…ï¼šæ–°æ˜¥ç‰¹å…¸-Rabbit craft go ğŸ‡"
date: "2023-01-22T18:18:39.139Z"
---
Three.js è¿›é˜¶ä¹‹æ—…ï¼šæ–°æ˜¥ç‰¹å…¸-Rabbit craft go ğŸ‡
=====================================

![Three.js è¿›é˜¶ä¹‹æ—…ï¼šæ–°æ˜¥ç‰¹å…¸-Rabbit craft go &#128007;](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185654805-1694492854.png) å…”å¹´åˆ°äº†ï¼Œç¥å¤§å®¶èº«ä½“å¥ï¼Œåº·ä¸‡äº‹é¡ºåˆ©ã€‚æœ¬æ–‡å†…å®¹ä½œä¸ºå…”å¹´æ–°æ˜¥çºªå¿µé¡µé¢ï¼Œå°†ä½¿ç”¨ Three.js åŠ å…¶ä»–å‰ç«¯å¼€å‘çŸ¥è¯†ï¼Œåˆ›å»ºä¸€ä¸ªä»¥å…”å­ä¸ºä¸»é¢˜çš„ 3D ç®€å•çš„è¶£å‘³é¡µé¢ Rabbit craft goã€‚æœ¬æ–‡å†…å®¹åŒ…æ‹¬ä½¿ç”¨çº¯ä»£ç åˆ›å»ºä¸‰ç»´æµ®å²›ã€å°æ²³ã€æ ‘æœ¨ã€å…”å­ã€èƒ¡èåœä»¥åŠå…”å­çš„è¿åŠ¨äº¤äº’ã€æµ®å²›çš„åŠ¨ç”»æ•ˆæœç­‰ã€‚æœ¬æ–‡åŒ…å«çš„çŸ¥è¯†ç‚¹ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŒ…æ‹¬ ä½¿ç”¨ Three.js ç½‘æ ¼ç«‹æ–¹ä½“æ­å»ºä¸‰ç»´å¡é€šåœºæ™¯ã€é”®ç›˜äº‹ä»¶çš„ç›‘å¬ä¸ä¸‰ç»´åœºæ™¯åŠ¨ç”»çš„ç»“åˆç­‰ï¼Œå¦‚æœä»”ç»†é˜…è¯»å¹¶å®è·µè¿‡æœ¬ä¸“æ ã€ŠThree.js è¿›é˜¶ä¹‹æ—…ã€‹çš„è¯ï¼Œéå¸¸å®¹æ˜“æŒæ¡ã€‚

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185230252-1743140518.png)

**å£°æ˜ï¼šæœ¬æ–‡æ¶‰åŠå›¾æ–‡å’Œæ¨¡å‹ç´ æä»…ç”¨äºä¸ªäººå­¦ä¹ ã€ç ”ç©¶å’Œæ¬£èµï¼Œè¯·å‹¿äºŒæ¬¡ä¿®æ”¹ã€éæ³•ä¼ æ’­ã€è½¬è½½ã€å‡ºç‰ˆã€å•†ç”¨ã€åŠè¿›è¡Œå…¶ä»–è·åˆ©è¡Œä¸ºã€‚**

æ‘˜è¦
--

**å…”å¹´åˆ°äº†ï¼Œç¥å¤§å®¶èº«ä½“å¥ï¼Œåº·ä¸‡äº‹é¡ºåˆ©**ã€‚æœ¬æ–‡å†…å®¹ä½œä¸ºå…”å¹´æ–°æ˜¥çºªå¿µé¡µé¢ï¼Œå°†ä½¿ç”¨ `Three.js` åŠ å…¶ä»–å‰ç«¯å¼€å‘çŸ¥è¯†ï¼Œåˆ›å»ºä¸€ä¸ªä»¥å…”å­ä¸ºä¸»é¢˜çš„ `3D` ç®€å•çš„è¶£å‘³é¡µé¢ `Rabbit craft go`ã€‚æœ¬æ–‡å†…å®¹åŒ…æ‹¬ä½¿ç”¨çº¯ä»£ç åˆ›å»ºä¸‰ç»´æµ®å²›ã€å°æ²³ã€æ ‘æœ¨ã€å…”å­ã€èƒ¡èåœä»¥åŠå…”å­çš„è¿åŠ¨äº¤äº’ã€æµ®å²›çš„åŠ¨ç”»æ•ˆæœç­‰ã€‚æœ¬æ–‡åŒ…å«çš„çŸ¥è¯†ç‚¹ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œä¸»è¦åŒ…æ‹¬ ä½¿ç”¨ `Three.js` ç½‘æ ¼ç«‹æ–¹ä½“æ­å»ºä¸‰ç»´å¡é€šåœºæ™¯ã€é”®ç›˜äº‹ä»¶çš„ç›‘å¬ä¸ä¸‰ç»´åœºæ™¯åŠ¨ç”»çš„ç»“åˆç­‰ï¼Œå¦‚æœä»”ç»†é˜…è¯»å¹¶å®è·µè¿‡æœ¬ä¸“æ [ã€ŠThree.js è¿›é˜¶ä¹‹æ—…ã€‹](https://juejin.cn/column/7140122697622618119)çš„è¯ï¼Œéå¸¸å®¹æ˜“æŒæ¡ã€‚

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185244868-848752830.png)

> `ğŸš©` å…”å­é€ å‹æ¥æºäº [Three.jså¼€æºè®ºå›](https://discourse.threejs.org/)ï¼Œé¡µé¢æ•´ä½“é€ å‹çµæ„Ÿæ¥æºäºã€Šæˆ‘çš„ä¸–ç•Œã€‹ï¼Œé¡µé¢åç§°çµæ„Ÿæ¥æºäºæ¸¸æˆã€ŠLara Craft Goã€‹ã€‚

æ•ˆæœ
--

æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®ç°æ•ˆæœï¼Œé¡µé¢åŠ è½½å®Œæˆåæ˜¯ä¸€ä¸ªæ¸¸æˆæ“ä½œæç¤ºç•Œé¢ï¼Œå¯ä»¥é€šè¿‡é”®ç›˜ `âŒ¨` `ç©ºæ ¼é”®` åŠ `W`ã€ `A`ã€ `S`ã€ `D` æˆ–æ–¹å‘é”®æ“ä½œå°å…”å­è¿åŠ¨ã€‚ç‚¹å‡»**å¼€å§‹**æŒ‰é’®åï¼Œæ¸¸æˆæç¤ºç•Œé¢æ¶ˆå¤±ï¼Œå¯ä»¥çœ‹åˆ°å€’ä¸‰è§’é€ å‹çš„å¤©ç©ºæµ®å²›åŠæµ®å²›ä¸Šæ–¹çš„æ ‘æœ¨ `ğŸŒ³`ã€æ²³æµ `â›µ`ã€æ¡¥ `ğŸŒ‰`ã€èƒ¡èåœ `ğŸ¥•`ã€å…”å­ `ğŸ‡` ç­‰å…ƒç´ ï¼Œæ¥ç€æ‘„åƒæœºé•œå¤´ `ğŸ“¹` è‡ªåŠ¨æ‹‰è¿‘å¹¶èšç„¦åˆ°å…”å­ä¸Šã€‚

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185303372-1585178241.gif)

æŒ‰ç…§æ“ä½œæç¤ºç•Œé¢çš„æŒ‰é”®ï¼Œå¯ä»¥æ“ä½œå…”å­è¿›è¡Œå‰è¿›ã€è½¬å‘ã€è·³è·ƒç­‰è¿åŠ¨ï¼Œå½“å…”å­çš„è¿åŠ¨ä½ç½®è§¦ç¢°åˆ°èƒ¡èåœæ—¶ï¼Œèƒ¡èåœä¼šæ¶ˆå¤±åŒæ—¶å…”å­ä¼šè¿›è¡Œè·³è·ƒè¿åŠ¨ã€‚å½“å…”å­è¿åŠ¨åˆ°å°æ²³æˆ–è€…è¶…å‡ºæµ®å²›èŒƒå›´æ—¶ï¼Œå…”å­åˆ™ä¼šå è½åˆ°ä¸‹æ–¹ã€‚

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185316750-865608735.gif)

æ‰“å¼€ä»¥ä¸‹é“¾æ¥ï¼Œåœ¨çº¿é¢„è§ˆæ•ˆæœï¼Œå¤§å±è®¿é—®æ•ˆæœæ›´ä½³ã€‚

*   `ğŸ‘â€ğŸ—¨` åœ¨çº¿é¢„è§ˆåœ°å€ï¼š[https://dragonir.github.io/rabbit-craft-go](https://dragonir.github.io/rabbit-craft-go/)

æœ¬ä¸“æ ç³»åˆ—ä»£ç æ‰˜ç®¡åœ¨ `Github` ä»“åº“[ã€threejs-odesseyã€‘](https://github.com/dragonir/threejs-odessey)ï¼Œ**åç»­æ‰€æœ‰ç›®å½•ä¹Ÿéƒ½å°†åœ¨æ­¤ä»“åº“ä¸­æ›´æ–°**ã€‚

> `ğŸ”—` ä»£ç ä»“åº“åœ°å€ï¼šgit@github.com:dragonir/threejs-odessey.git

å®ç°
--

æ–‡ç« ç¯‡å¹…æœ‰é™ï¼Œå› æ­¤**åˆ å‡äº†ä¸‰ç»´æ¨¡å‹çš„ä½ç½®ä¿¡æ¯ç­‰ç»†èŠ‚è°ƒæ•´ä»£ç ï¼Œåªæä¾›æ„å»ºä¸‰ç»´æ¨¡å‹çš„æ•´ä½“æ€è·¯é€»è¾‘**ï¼Œæƒ³äº†è§£è¯¥éƒ¨åˆ†å†…å®¹çš„è¯¦ç»†ä»‹ç»å¯ä»¥é˜…è¯»æœ¬ä¸“æ å‰å‡ ç¯‡æ–‡ç« åŠé˜…è¯»æœ¬æ–‡é…å¥—[æºç ](https://github.com/dragonir/threejs-odessey)ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ•´ä¸ªé¡µé¢çš„å®ç°è¯¦ç»†æ­¥éª¤ï¼š

### é¡µé¢ç»“æ„

`Rabbit Craft Go` é¡µé¢çš„æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼Œå…¶ä¸­ `canvas.webgl` æ˜¯ç”¨äºæ¸²æŸ“åœºæ™¯çš„å®¹å™¨ã€å‰©ä½™æ ‡ç­¾éƒ½æ˜¯ä¸€äº›è£…é¥°å…ƒç´ æˆ–æç¤ºè¯­ã€‚

    <canvas class="webgl"></canvas>
    <div class="mask" id="mask">
      <div class="box">
        <div class="keyboard">
          <div class="row"><span class="key">W/â†‘</span></div>
          <div class="row"><span class="key">A/â†</span><span class="key">S/â†“</span><span class="key">D/â†’</span></div>
          <div class="row"><span class="key space">space</span></div>
        </div>
        <p class="tips"><b>W</b>: è¡Œèµ°&emsp;<b>S</b>: åœæ­¢&emsp;<b>A</b>: å‘å·¦è½¬&emsp;<b>D</b>: å‘å³è½¬&emsp;<b>ç©ºæ ¼é”®</b>: è·³è·ƒ</p>
        <p class="start"><button class="button" id="start_button">å¼€å§‹</button></p>
      </div>
    </div>
    <a class='github' href='https://github.com/dragonir/threejs-odessey' target='_blank' rel='noreferrer'>
      <span class='author'>three.js odessey</span>
    </a>
    <h1 class="title">RABBIT CRAFT GO!</h1>
    <div class="banner"><i></i></div>
    

### åœºæ™¯åˆå§‹åŒ–

åœºæ™¯åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥å¿…éœ€çš„å¼€å‘èµ„æºï¼Œå¹¶åˆå§‹åŒ–æ¸²æŸ“åœºæ™¯ã€ç›¸æœºã€æ§åˆ¶å™¨ã€å…‰ç…§ã€é¡µé¢ç¼©æ”¾é€‚é…ç­‰ã€‚å…¶ä¸­å¤–éƒ¨èµ„æºçš„å¼•å…¥ï¼Œå…¶ä¸­ `OrbitControls` ç”¨äºé¡µé¢é•œå¤´ç¼©æ”¾åŠç§»åŠ¨æ§åˆ¶ï¼›`TWEEN` å’Œ `Animations` ç”¨äºç”Ÿæˆé•œå¤´è¡¥é—´åŠ¨ç”»ï¼Œä¹Ÿå°±æ˜¯åˆšå¼€å§‹æ—¶æµ®å²›ç”±è¿œåŠè¿‘çš„é•œå¤´åˆ‡æ¢åŠ¨ç”»ä¸­æ•ˆæœï¼›`Island`ã€`Carrot`ã€`Rabbit`ã€`Waterfall` ç­‰æ˜¯ç”¨æ¥æ„å»ºä¸‰ç»´ä¸–ç•Œçš„ç±»ã€‚ä¸ºäº†ä½¿åœºæ™¯æ›´åŠ å¡é€šåŒ–ï¼Œä½¿ç”¨äº† `THREE.sRGBEncoding` æ¸²æŸ“æ•ˆæœã€‚åœºæ™¯ä¸­æ·»åŠ äº†ä¸¤ç§å…‰æºï¼Œå…¶ä¸­ `THREE.DirectionalLight` ç”¨æ¥ç”Ÿæˆé˜´å½±æ•ˆæœã€‚

    import * as THREE from 'three';
    import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';
    import { TWEEN } from "three/examples/jsm/libs/tween.module.min.js";
    import Animations from './environment/animation';
    import Island from './environment/island';
    import Carrot from './environment/carrot';
    import Rabbit from './environment/rabbit';
    import Waterfall from './environment/waterfall';
    
    // åˆå§‹åŒ–æ¸²æŸ“å™¨
    const canvas = document.querySelector('canvas.webgl');
    const renderer = new THREE.WebGLRenderer({
      canvas: canvas,
      antialias: true,
      alpha: true
    });
    renderer.setSize(sizes.width, sizes.height);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.outputEncoding = THREE.sRGBEncoding;
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.needsUpdate = true;
    
    // åˆå§‹åŒ–åœºæ™¯
    const scene = new THREE.Scene();
    
    // åˆå§‹åŒ–ç›¸æœº
    const camera = new THREE.PerspectiveCamera(60, sizes.width / sizes.height, 1, 5000)
    camera.position.set(-2000, -250, 2000);
    
    // é•œå¤´æ§åˆ¶å™¨
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.target.set(0, 0, 0);
    controls.enableDamping = true;
    controls.enablePan = false;
    controls.dampingFactor = 0.15;
    
    // é¡µé¢ç¼©æ”¾äº‹ä»¶ç›‘å¬
    window.addEventListener('resize', () => {
      sizes.width = window.innerWidth;
      sizes.height = window.innerHeight;
      // æ›´æ–°æ¸²æŸ“
      renderer.setSize(sizes.width, sizes.height);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))
      // æ›´æ–°ç›¸æœº
      camera.aspect = sizes.width / sizes.height;
      camera.updateProjectionMatrix();
    });
    
    // å…‰ç…§
    const ambientLight = new THREE.AmbientLight(0xffffff, 1);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
    scene.add(directionalLight);
    

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185335222-1323834770.png)

### åˆ›å»ºæµ®å²›

å¦‚ä»¥ä¸‹ `ğŸ‘‡` ä¸¤å¹…å›¾æ‰€ç¤ºï¼Œæ•´ä¸ªæµ®å²›é€ å‹æ˜¯ä¸€ä¸ªå››æ£±æ¤ï¼Œæ•´ä½“åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œé¡¶éƒ¨æ˜¯ç”±åœ°é¢å’Œæ²³æµæ„æˆçš„å››æ–¹ä½“ã€åº•éƒ¨ä¸‰å—æ˜¯å€’ç½®çš„ä¸‰è§’ã€‚ç”Ÿæˆè¿™äº›ä¸‰ç»´æ¨¡å‹çš„å…¶å®ä¹Ÿå¹¶æ²¡æœ‰å¤šå°‘æŠ€å·§ï¼Œå°±åƒæ­ç§¯æœ¨ä¸€æ ·ä½¿ç”¨ `Three.js` æä¾›çš„ç«‹æ–¹ä½“ç½‘æ ¼é€šè¿‡è®¡ç®—æ‹¼æ¥åˆ°ä¸€èµ·å³å¯ã€‚ç±» `Island` åŒ…å«ä¸€ä¸ªæ–¹æ³• `generate` ç”¨äºåˆ›å»ºä¸Šè¿°ä¸‰ç»´æ¨¡å‹ï¼Œå¹¶å°†æ‰€åˆ›å»ºæ¨¡å‹æ·»åŠ åˆ°ä¸‰ç»´åˆ†ç»„ `floorMesh` ä¸­ç”¨äºå¤–éƒ¨è°ƒç”¨ï¼Œå…¶ä¸­æ£±æŸ±éƒ¨åˆ†æ˜¯é€šè¿‡ `CylinderBufferGeometry` æ¥å®ç°çš„ã€‚

    export default class Island {
      constructor() {
        this.floorMesh = new THREE.Group();
        this.generate();
      }
    
      generate() {
        // å·¦ä¾§åœ°é¢
        const leftFieldMat = new THREE.MeshToonMaterial({
          color: 0x015521d,
          side: THREE.DoubleSide,
        });
        const leftFieldGeom = new THREE.BoxBufferGeometry(800, 30, 1800);
        this.leftFieldMesh = new THREE.Mesh(leftFieldGeom, leftFieldMat);
        // å³ä¾§åœ°é¢
        this.rightFieldMesh = this.leftFieldMesh.clone();
        const mapCapMat = new THREE.MeshMatcapMaterial({
          matcap: new THREE.TextureLoader().load('./images/matcap.png'),
          side: THREE.DoubleSide
        })
        // é¡¶éƒ¨æ£±æŸ±
        const topFieldGeom = new THREE.CylinderBufferGeometry(1200, 900, 200, 4, 4);
        this.topFieldMesh = new THREE.Mesh(topFieldGeom, mapCapMat);
        // ä¸­é—´æ£±æŸ±
        const middleFieldGeom = new THREE.CylinderBufferGeometry(850, 600, 200, 4, 4);
        this.middleFieldMesh = new THREE.Mesh(middleFieldGeom, mapCapMat);
        // åº•éƒ¨æ£±é”¥
        const bottomFieldGeom = new THREE.ConeBufferGeometry(550, 400, 4);
        this.bottomFieldMesh = new THREE.Mesh(bottomFieldGeom, mapCapMat);
        // æ²³é¢
        const strGroundMat = new THREE.MeshLambertMaterial({
          color: 0x75bd2d,
          side: THREE.DoubleSide,
        });
        const strCroundGeom = new THREE.BoxBufferGeometry(205, 10, 1800);
        this.strGroundMesh = new THREE.Mesh(strCroundGeom, strGroundMat);
    
        // å°æ²³
        const streamMat = new THREE.MeshLambertMaterial({
          color: 0x0941ba,
          side: THREE.DoubleSide,
        });
        const streamGeom = new THREE.BoxBufferGeometry(200, 16, 1800);
        this.streamMesh = new THREE.Mesh(streamGeom, streamMat);
        // ...
      }
    };
    

æµ®å²›ä¿¯è§†å›¾æ˜¯ä¸€ä¸ª**æ­£æ–¹å½¢**ã€‚

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185349707-2048761562.png)

æµ®å²›ä¾§è§†å›¾æ˜¯ä¸€ä¸ª**å€’ä¸‰è§’å½¢**ã€‚

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185401919-157941306.png)

### åˆ›å»ºæ°´æµ

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºæ²³æµæ·»åŠ ä¸€ä¸ªå°ç€‘å¸ƒï¼Œä½¿åœºæ™¯åŠ¨èµ·æ¥ã€‚æµåŠ¨çš„ç€‘å¸ƒä¸‰ç»´æ°´æ»´ `ğŸ’§` æ»´è½æ•ˆæœçš„æ˜¯é€šè¿‡åˆ›å»ºå¤šä¸ªé™å®šèŒƒå›´å†…éšæœºä½ç½®çš„ `THREE.BoxBufferGeometry` æ¥å®ç°æ°´æ»´æ¨¡å‹ï¼Œç„¶åé€šè¿‡æ°´æ»´çš„æ˜¾ç¤ºéšè—åŠ¨ç”»å®ç°è§†è§‰ä¸Šçš„æ°´æ»´å è½æ•ˆæœã€‚`Waterfall` ç±»ç”¨äºåˆ›å»ºå•ä¸ªæ°´æ»´ï¼Œå®ƒä¸ºæ°´æ»´åˆå§‹åŒ–éšæœºä½ç½®å’Œé€Ÿåº¦ï¼Œå¹¶æä¾›ä¸€ä¸ª `update` æ–¹æ³•ç”¨æ¥æ›´æ–°å®ƒä»¬ã€‚

    export default class Waterfall {
      constructor (scene) {
        this.scene = scene;
        this.drop = null;
        this.generate();
      }
      generate () {
        this.geometry = new THREE.BoxBufferGeometry(15, 50, 5);
        this.material = new THREE.MeshLambertMaterial({ color: 0x0941ba });
        this.drop = new THREE.Mesh(this.geometry, this.material);
        this.drop.position.set((Math.random() - 0.5) * 200, -50, 900 + Math.random(1, 50) * 10);
        this.scene.add(this.drop);
        this.speed = 0;
        this.lifespan = Math.random() * 50 + 50;
        this.update = function() {
          this.speed += 0.07;
          this.lifespan--;
          this.drop.position.x += (5 - this.drop.position.x) / 70;
          this.drop.position.y -= this.speed;
        };
      }
    };
    

å®Œæˆæ°´æ»´åˆ›å»ºåï¼Œä¸è¦å¿˜äº†éœ€è¦åœ¨é¡µé¢é‡ç»˜åŠ¨ç”» `tick` æ–¹æ³•ä¸­åƒè¿™æ ·æ›´æ–°å·²åˆ›å»ºçš„æ°´æ»´æ•°ç»„ `drops`ï¼Œä½¿å…¶çœ‹èµ·æ¥ç”Ÿæˆå‘ä¸‹æµåŠ¨å è½çš„æ•ˆæœã€‚

    for (var i = 0; i < drops.length; i++) {
      drops[i].update();
      if (drops[i].lifespan < 0) {
        scene.remove(scene.getObjectById(drops[i].drop.id));
        drops.splice(i, 1);
      }
    }
    

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185415338-823200982.gif)

### åˆ›å»ºæ¡¥

åœ¨æ²³æµä¸Šæ–¹æ·»åŠ ä¸€ä¸ªå°æœ¨æ¡¥ `ğŸŒ‰`ï¼Œè¿™æ ·å°å…”å­å°±å¯ä»¥é€šè¿‡æœ¨æ¡¥åœ¨å°æ²³ä¸¤è¾¹ç§»åŠ¨äº†ã€‚ ç±» `Bridge` é€šè¿‡ `generate` æ–¹æ³•åˆ›å»ºä¸€ä¸ªå°æœ¨æ¡¥ï¼Œå¹¶é€šè¿‡ä¸‰ç»´æ¨¡å‹ç»„ `bridgeMesh` å°†å…¶å¯¼å‡ºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢åˆ›å»ºçš„ `Island` ç±»ä¸­ä½¿ç”¨å®ƒï¼Œå°†å…¶æ·»åŠ åˆ°ä¸‰ç»´åœºæ™¯ä¸­ã€‚

    export default class Bridge {
      constructor() {
        this.bridgeMesh = new THREE.Group();
        this.generate();
      }
      generate() {
        var woodMat = new THREE.MeshLambertMaterial({
          color: 0x543b14,
          side: THREE.DoubleSide
        });
        // æœ¨å¤´
        for (var i = 0; i < 15; i++) {
          var blockGeom = new THREE.BoxBufferGeometry(10, 3, 70);
          var block = new THREE.Mesh(blockGeom, woodMat);
          this.bridgeMesh.add(block);
        }
        // æ¡¥å°¾
        var geometry_rail_v = new THREE.BoxBufferGeometry(3, 20, 3);
        var rail_1 = new THREE.Mesh(geometry_rail_v, woodMat);
        var rail_2 = new THREE.Mesh(geometry_rail_v, woodMat);
        var rail_3 = new THREE.Mesh(geometry_rail_v, woodMat);
        var rail_4 = new THREE.Mesh(geometry_rail_v, woodMat);
        // ...
      }
    }
    

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185429208-1178021182.png)

### åˆ›å»ºæ ‘

ä»é¢„è§ˆåŠ¨å›¾å’Œé¡µé¢å¯ä»¥çœ‹åˆ°ï¼Œæµ®å²›ä¸Šå…±æœ‰ä¸¤ç§æ ‘ `ğŸŒ³`ï¼Œç»¿è‰²çš„é«˜æ ‘å’Œç²‰çº¢è‰²çš„çŸ®æ ‘ï¼Œæ ‘çš„å®ç°ä¹Ÿéå¸¸ç®€å•ï¼Œæ˜¯ä½¿ç”¨äº†ä¸¤ä¸ª `BoxBufferGeometry` æ‹¼æ¥åˆ°ä¸€èµ·ã€‚ç±» `Tree` å’Œ `LeafTree` åˆ†åˆ«ç”¨äºç”Ÿæˆè¿™ä¸¤ç§æ ‘æœ¨ï¼Œæ¥æ”¶å‚æ•° `(x, y, z)` åˆ†åˆ«è¡¨ç¤ºæ ‘æœ¨åœ¨åœºæ™¯ä¸­çš„ä½ç½®ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ `Island` è¾…å¯¼ä¸Šæ·»åŠ ä¸€äº›æ ‘æœ¨ï¼Œæ„æˆæµ®å²›ä¸Šçš„ä¸€ç‰‡å°æ£®æ—ã€‚

    export default class Tree {
      constructor(x, y, z) {
        this.x = x;
        this.y = y;
        this.z = z;
        this.treeMesh = new THREE.Group();
        this.generate();
      }
      generate() {
        // æ ‘å¹²
        var trunkMat = new THREE.MeshLambertMaterial({
          color: 0x543b14,
          side: THREE.DoubleSide
        });
        var trunkGeom = new THREE.BoxBufferGeometry(20, 200, 20);
        this.trunkMesh = new THREE.Mesh(trunkGeom, trunkMat);
        // æ ‘å¶
        var leavesMat = new THREE.MeshLambertMaterial({
          color: 0x016316,
          side: THREE.DoubleSide
        });
        var leavesGeom = new THREE.BoxBufferGeometry(80, 400, 80);
        this.leavesMesh = new THREE.Mesh(leavesGeom, leavesMat);
        this.treeMesh.add(this.trunkMesh);
        this.treeMesh.add(this.leavesMesh);
        this.treeMesh.position.set(this.x, this.y, this.z);
        // ...
      }
    }
    

çŸ®æ ‘

    export default class LeafTree {
      constructor(x, y, z) {
        this.x = x;
        this.y = y;
        this.z = z;
        this.treeMesh = new THREE.Group();
        this.generate();
      }
      generate() {
        // ...
      }
    }
    

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185442361-894711036.png)

### åˆ›å»ºèƒ¡èåœ

æ¥ç€ï¼Œåœ¨åœ°é¢ä¸Šæ·»åŠ ä¸€äº›èƒ¡èåœ `ğŸ¥•`ã€‚èƒ¡èåœèº«ä½“éƒ¨åˆ†æ˜¯é€šè¿‡å››æ£±æŸ± `CylinderBufferGeometry` å®ç°çš„ï¼Œç„¶åé€šè¿‡ `BoxBufferGeometry` ç«‹æ–¹ä½“æ¥å®ç°èƒ¡èåœçš„ä¸¤ç‰‡å¶å­ã€‚åœºæ™¯ä¸­å¯ä»¥é€šè¿‡ `Carrot` ç±»æ¥æ·»åŠ èƒ¡èåœï¼Œæœ¬é¡µé¢ç¤ºä¾‹ä¸­æ˜¯é€šè¿‡å¾ªç¯è°ƒç”¨æ·»åŠ äº† `20` ä¸ªéšæœºä½ç½®çš„èƒ¡èåœã€‚

    export default class Carrot {
      constructor() {
        this.carrotMesh = new THREE.Group();
        this.generate();
      }
      generate() {
        const carrotMat = new THREE.MeshLambertMaterial({
          color: 0xd9721e
        });
        const leafMat = new THREE.MeshLambertMaterial({
          color: 0x339e33
        });
        // èº«ä½“
        const bodyGeom = new THREE.CylinderBufferGeometry(5, 3, 12, 4, 1);
        this.body = new THREE.Mesh(bodyGeom, carrotMat);
        // å¶å­
        const leafGeom = new THREE.BoxBufferGeometry(5, 10, 1, 1);
        this.leaf1 = new THREE.Mesh(leafGeom, leafMat);
        this.leaf2 = this.leaf1.clone();
        // ...
        this.carrotMesh.add(this.body);
        this.carrotMesh.add(this.leaf1);
        this.carrotMesh.add(this.leaf2);
      }
    };
    

    for (let i = 0; i < 20; i++) {
      carrot[i] = new Carrot();
      scene.add(carrot[i].carrotMesh);
      carrot[i].carrotMesh.position.set(-170 * Math.random() * 3 - 300, -12, 1400 * Math.random() * 1.2 - 900);
    }
    

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185457389-1035204089.png)

### åˆ›å»ºå…”å­

æœ€åï¼Œæ¥åˆ›å»ºé¡µé¢çš„ä¸»è§’å…”å­ `ğŸ‡`ã€‚å…”å­å…¨éƒ¨éƒ½æ˜¯ç”±ç«‹æ–¹ä½“ `BoxBufferGeometry` æ­å»ºè€Œæˆçš„ï¼Œæ•´ä½“å¯ä»¥åˆ†è§£ä¸ºå¤´ã€çœ¼ç›ã€è€³æœµã€é¼»å­ã€å˜´ã€èƒ¡é¡»ã€èº«ä½“ã€å°¾å·´ã€å››è‚¢ç­‰æ„æˆï¼Œæ„å»ºå…”å­æ—¶çš„æ ¸å¿ƒè¦ç´ å°±æ˜¯**å„ä¸ªç«‹æ–¹ä½“ä½ç½®å’Œç¼©æ”¾æ¯”ä¾‹çš„è°ƒæ•´**ï¼Œéœ€è¦å…·å¤‡ä¸€å®šçš„å®¡ç¾èƒ½åŠ›ï¼Œå½“ç„¶æœ¬ä¾‹ä¸­ä½¿ç”¨çš„å…”å­æ˜¯åœ¨ `Three.js` ç¤¾åŒºå¼€æºä»£ç çš„åŸºç¡€ä¸Šæ”¹é€ çš„ `ğŸ˜‚`ã€‚

å®Œæˆå…”å­çš„æ•´ä½“å¤–å½¢ä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡ `gsap` ç»™å…”å­æ·»åŠ ä¸€äº›è¿åŠ¨åŠ¨ç”»æ•ˆæœå’Œæ–¹æ³•ä»¥ä¾›å¤–éƒ¨è°ƒç”¨ï¼Œå…¶ä¸­ `blink()` æ–¹æ³•ç”¨äºçœ¨çœ¼ã€`jump()` æ–¹æ³•ç”¨äºåŸåœ°è·³è·ƒã€`nod()` æ–¹æ³•ç”¨äºç‚¹å¤´ã€`run()` æ–¹æ³•ç”¨äºå¥”è·‘ã€`fall()` æ–¹æ³•ç”¨äºè¾¹ç•Œæ£€æµ‹æ—¶æ£€æµ‹åˆ°è¶…å‡ºè¿åŠ¨èŒƒå›´æ—¶ä½¿å…”å­å è½æ•ˆæœç­‰ã€‚å®Œæˆ `Rabbit` ç±»åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨åœºæ™¯ä¸­åˆå§‹åŒ–å°å…”å­ã€‚

    import { TweenMax, Power0, Power1, Power4, Elastic, Back } from 'gsap';
    
    export default class Rabbit {
      constructor() {
        this.bodyInitPositions = [];
        this.runningCycle = 0;
        this.rabbitMesh = new THREE.Group();
        this.bodyMesh = new THREE.Group();
        this.headMesh = new THREE.Group();
        this.generate();
      }
      generate() {
        var bodyMat = new THREE.MeshLambertMaterial({
          color: 0x5c6363
        });
        var tailMat = new THREE.MeshLambertMaterial({
          color: 0xc2bebe
        });
        var nouseMat = new THREE.MeshLambertMaterial({
          color: 0xed716d
        });
        // ...
        var pawMat = new THREE.MeshLambertMaterial({
          color: 0xbf6970
        });
        var bodyGeom = new THREE.BoxBufferGeometry(50, 50, 42, 1);
        var headGeom = new THREE.BoxBufferGeometry(44, 44, 54, 1);
        var earGeom = new THREE.BoxBufferGeometry(5, 60, 10, 1);
        var eyeGeom = new THREE.BoxBufferGeometry(20, 20, 8, 1);
        var irisGeom = new THREE.BoxBufferGeometry(8, 8, 8, 1);
        var mouthGeom = new THREE.BoxBufferGeometry(8, 16, 4, 1);
        var mustacheGeom = new THREE.BoxBufferGeometry(0.5, 1, 22, 1);
        var spotGeom = new THREE.BoxBufferGeometry(1, 1, 1, 1);
        var legGeom = new THREE.BoxBufferGeometry(33, 33, 10, 1);
        var pawGeom = new THREE.BoxBufferGeometry(45, 10, 10, 1);
        var pawFGeom = new THREE.BoxBufferGeometry(20, 20, 20, 1);
        var tailGeom = new THREE.BoxBufferGeometry(20, 20, 20, 1);
        var nouseGeom = new THREE.BoxBufferGeometry(20, 20, 15, 1);
        var tailGeom = new THREE.BoxBufferGeometry(23, 23, 23, 1);
        this.body = new THREE.Mesh(bodyGeom, bodyMat);
        this.bodyMesh.add(this.body);
        this.head = new THREE.Mesh(headGeom, bodyMat);
        this.bodyMesh.add(this.legL);
        this.headMesh.add(this.earR);
        this.rabbitMesh.add(this.bodyMesh);
        this.rabbitMesh.add(this.headMesh);
        // ...
      }
      blink() {
        var sp = 0.5 + Math.random();
        if (Math.random() > 0.2)
          TweenMax.to([this.eyeR.scale, this.eyeL.scale], sp / 8, {
            y: 0,
            ease: Power1.easeInOut,
            yoyo: true,
            repeat: 3
          });
      }
      // è·³è·ƒ
      jump() {
        var speed = 10;
        var totalSpeed = 10 / speed;
        var jumpHeight = 150;
        TweenMax.to(this.earL.rotation, totalSpeed / 2, {
          z: "+=.3",
          ease: Back.easeOut,
          yoyo: true,
          repeat: 1
        });
        TweenMax.to(this.earR.rotation, totalSpeed / 2, {
          z: "-=.3",
          ease: Back.easeOut,
          yoyo: true,
          repeat: 1
        });
        // ...
      }
      // ç‚¹å¤´
      nod() {}
      // å¥”è·‘
      run() {}
      // ç§»åŠ¨
      move() {}
      // å è½
      fall() {}
      // åŠ¨ä½œé”€æ¯
      killNod() {}
      killJump() {}
      killMove() {}
    }
    

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185511669-1066157217.png)

å°†å…”å­æ·»åŠ åˆ°åœºæ™¯ä¸­ã€‚

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185520788-1984411985.png)

### æ·»åŠ åŠ¨ç”»å’Œæ“ä½œ

ä¸ºäº†ä½¿å…”å­å¯ä»¥è¿åŠ¨å’Œå¯äº¤äº’ï¼Œæˆ‘ä»¬é€šè¿‡ç›‘å¬é”®ç›˜æŒ‰é”®çš„æ–¹å¼æ¥è°ƒç”¨å…”å­ç±»å†…ç½®çš„å¯¹åº”åŠ¨ç”»æ–¹æ³•ï¼Œå…”å­çš„æ–¹å‘è½¬åŠ¨å¯ä»¥é€šè¿‡ä¿®æ”¹å…”å­çš„æ—‹è½¬å±æ€§ `rotation` æ¥å®ç°ã€‚

    // å…”å­æ§åˆ¶
    const rabbitControl = {
      tureLeft: () => {
        rabbit && (rabbit.rabbitMesh.rotation.y -= Math.PI / 2);
      },
      turnRight: () => {
        rabbit && (rabbit.rabbitMesh.rotation.y += Math.PI / 2);
      },
      stopMove: () => {
        rabbitMoving = false;
        rabbit.killMove();
        rabbit.nod();
      },
    }
    
    // é”®ç›˜ç›‘å¬
    document.addEventListener('keydown', e => {
      if (e && e.keyCode) {
        switch(e.keyCode) {
          // å·¦
          case 65:
          case 37:
            rabbitControl.tureLeft();
            break;
          // å³
          case 68:
          case 39:
            rabbitControl.turnRight();
            break;
          // å‰
          case 87:
          case 38:
            rabbitMoving = true;
            break;
          // ç©ºæ ¼é”®
          case 32:
            !rabbitJumping && rabbit.jump() && (rabbitJumping = true);
            break;
          default:
            break;
        }
      }
    });
    
    document.addEventListener('keyup', e => {
      if (e && e.keyCode) {
        switch(e.keyCode) {
          case 83:
          case 40:
          case 87:
          case 38:
            rabbitMoving = false;
            rabbit.killMove();
            rabbit.nod();
            break;
          case 32:
            setTimeout(() => {
              rabbitJumping = false;
            }, 800);
            break;
        }
      }
    });
    

ä¸ºäº†ä½¿åœºæ™¯æ›´åŠ çœŸå®å’Œè¶£å‘³ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€äº›è¾¹ç•Œæ£€æµ‹æ–¹æ³•ï¼Œå½“å…”å­ä½ç½®å¤„äºéå¯è¿åŠ¨åŒºåŸŸå¦‚å°æ²³ã€æµ®å²›ä¹‹å¤–ç­‰åŒºåŸŸæ—¶ï¼Œå¯ä»¥è°ƒç”¨å…”å­çš„ `fall()`ï¼Œæ–¹æ³•ä½¿å…¶å è½ã€‚å½“æ£€æµ‹åˆ°å…”å­çš„ä½ç½®å’Œèƒ¡èåœçš„ä½ç½®é‡å æ—¶ï¼Œç»™å…”å­æ·»åŠ äº†ä¸€ä¸ª `jump()` è·³è·ƒåŠ¨ä½œå¹¶ä½¿æ£€æµ‹åˆ°çš„è¿™ä¸ªèƒ¡èåœä»åœºæ™¯ä¸­ç§»é™¤ã€‚

    const checkCollision = () => {
      for (let i = 0; i < 20; i++) {
        let rabbCarr = rabbit.rabbitMesh.position.clone().sub(carrot[i].carrotMesh.position.clone());
        if (rabbCarr.length() <= 20) {
          rabbit.jump();
          scene.remove(carrot[i].carrotMesh);
          rabbCarr = null;
        }
      }
      // æ£€æŸ¥æ˜¯å¦æ˜¯åœ°é¢çš„è¾¹ç•Œ
      var rabbFloor = island.floorMesh.position.clone().sub(rabbit.rabbitMesh.position.clone());
      if (
        rabbFloor.x <= -900 ||
        rabbFloor.x >= 900 ||
        rabbFloor.z <= -900 ||
        rabbFloor.z >= 900
      ) {
        rabbit.fall();
      }
      // å°æ²³æ£€æµ‹
      var rabbStream = rabbit.rabbitMesh.position.clone().sub(island.streamMesh.position.clone());
      if (
        (rabbStream.x >= -97 &&
          rabbStream.x <= 97 &&
          rabbStream.z >= -900 &&
          rabbStream.z <= 688) ||
        (rabbStream.x >= -97 && rabbStream.x <= 97 && rabbStream.z >= 712)
      ) {
        rabbit.fall();
      }
    }
    

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185537031-489213371.gif)

### é¡µé¢è£…é¥°

æœ€åï¼Œæˆ‘ä»¬æ¥åˆ¶ä½œä¸€ä¸ªå…¶å®é¡µé¢ï¼Œä¸­é—´éƒ¨åˆ†æ˜¯é”®ç›˜æ“ä½œè¯´æ˜ï¼Œåº•éƒ¨æ˜¯ä¸€äº›è£…é¥°æ–‡æ¡ˆå›¾ç‰‡ï¼Œæ“ä½œæç¤ºä¸‹æ–¹æ˜¯ä¸€ä¸ª**å¼€å§‹**æŒ‰é’®ï¼Œæˆ‘ä»¬ç»™è¿™ä¸ªæŒ‰é’®æ·»åŠ ä¸€ä¸ªé€šè¿‡ `TWEEN.js` å®ç°çš„é•œå¤´è¡¥é—´åŠ¨ç”»æ•ˆæœï¼Œå½“ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œé¡µé¢é¦–å…ˆæ˜¾ç¤ºçš„æ˜¯å€’ç½®ä¸‰è§’é€ å‹çš„æµ®å²›ï¼Œç„¶åé•œå¤´æ…¢æ…¢æ–¹æ³•æ‹‰è¿‘ï¼Œæ˜¾ç¤ºå‡ºå…”å­è¿åŠ¨çš„åŒºåŸŸã€‚æœ¬é¡µé¢ä¸ºäº†ä½¿å…¶çœ‹èµ·æ¥æ›´åŠ ç¬¦åˆæ¸¸æˆä¸»é¢˜ï¼Œæ ‡é¢˜æ–‡æ¡ˆä½¿ç”¨äº†ä¸€ç§åƒç´ åŒ–çš„å­—ä½“ `âœ¨`ã€‚

    const startButton = document.getElementById('start_button');
    const mask = document.getElementById('mask');
    startButton.addEventListener('click', () => {
      mask.style.display = 'none';
      Animations.animateCamera(camera, controls, { x: 50, y: 120, z: 1000 }, { x: 0, y: 0, z: 0 }, 3600, () => {});
    });
    

![](https://img2023.cnblogs.com/blog/772544/202301/772544-20230122185548413-544501371.png)

> `ğŸ”—` æºç åœ°å€ï¼š[https://github.com/dragonir/threejs-odessey](https://github.com/dragonir/threejs-odessey)

æ€»ç»“
--

æœ¬æ–‡ä¸­ä¸»è¦åŒ…å«çš„çŸ¥è¯†ç‚¹åŒ…æ‹¬ï¼š

*   ä½¿ç”¨ `Three.js` ç½‘æ ¼ç«‹æ–¹ä½“æ­å»ºä¸‰ç»´å¡é€šåœºæ™¯
*   é”®ç›˜äº‹ä»¶çš„ç›‘å¬ä¸ä¸‰ç»´åœºæ™¯åŠ¨ç”»çš„ç»“åˆ

> æƒ³äº†è§£å…¶ä»–å‰ç«¯çŸ¥è¯†æˆ–å…¶ä»–æœªåœ¨æœ¬æ–‡ä¸­è¯¦ç»†æè¿°çš„**Web 3D**å¼€å‘æŠ€æœ¯ç›¸å…³çŸ¥è¯†ï¼Œå¯é˜…è¯»æˆ‘å¾€æœŸçš„æ–‡ç« ã€‚å¦‚æœæœ‰ç–‘é—®å¯ä»¥åœ¨è¯„è®ºä¸­**ç•™è¨€**ï¼Œå¦‚æœè§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸è¦å¿˜äº†**ä¸€é”®ä¸‰è¿å“¦ ğŸ‘**ã€‚

é™„å½•
--

*   \[1\]. [ğŸŒ´ Three.js æ‰“é€ ç¼¤çº·å¤æ—¥3Dæ¢¦ä¸­æƒ…å²›](https://juejin.cn/post/7102215670477094925)
*   \[2\]. [ğŸ”¥ Three.js å®ç°ç‚«é…·çš„èµ›åšæœ‹å…‹é£æ ¼3Dæ•°å­—åœ°çƒå¤§å±](https://juejin.cn/post/7124116814937718797)
*   \[3\]. [ğŸ¼ Three.js å®ç°2022å†¬å¥¥ä¸»é¢˜3Dè¶£å‘³é¡µé¢ï¼Œå«å†°å¢©å¢©](https://juejin.cn/post/7060292943608807460)
*   \[4\]. [ğŸ¦Š Three.js å®ç°3Då¼€æ”¾ä¸–ç•Œå°æ¸¸æˆï¼šé˜¿ç‹¸çš„å¤šå…ƒå®‡å®™](https://juejin.cn/post/7081429595689320478)
*   \[5\]. [ğŸ† 1000ç²‰ï¼ä½¿ç”¨Three.jså®ç°ä¸€ä¸ªåˆ›æ„çºªå¿µé¡µé¢](https://juejin.cn/post/7143039765725020167)
*   `...`
*   [ã€Three.js è¿›é˜¶ä¹‹æ—…ã€‘ç³»åˆ—ä¸“æ è®¿é—® ğŸ‘ˆ](https://juejin.cn/column/7140122697622618119)
*   [æ›´å¤šå¾€æœŸã€3Dã€‘ä¸“æ è®¿é—® ğŸ‘ˆ](https://juejin.cn/column/7049923956257587213)
*   [æ›´å¤šå¾€æœŸã€å‰ç«¯ã€‘ä¸“æ è®¿é—® ğŸ‘ˆ](https://juejin.cn/column/7021076460089638926)

å‚è€ƒ
--

*   \[1\]. [three.js journey](https://threejs-journey.com/)
*   \[2\]. [threejs.org](https://threejs.org)

> æœ¬æ–‡ä½œè€…ï¼šdragonir æœ¬æ–‡åœ°å€ï¼š[https://www.cnblogs.com/dragonir/p/17064580.html](https://www.cnblogs.com/dragonir/p/17064580.html)