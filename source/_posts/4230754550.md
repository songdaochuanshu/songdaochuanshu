---
layout: post
title: "svelteç»„ä»¶ï¼šsvelte3è‡ªå®šä¹‰æ¡Œé¢PCç«¯å¯¹è¯æ¡†ç»„ä»¶svelte-layer"
date: "2022-04-18T01:46:15.258Z"
---
svelteç»„ä»¶ï¼šsvelte3è‡ªå®šä¹‰æ¡Œé¢PCç«¯å¯¹è¯æ¡†ç»„ä»¶svelte-layer
=========================================

åŸºäºSvelte3.xå¼€å‘pcç½‘é¡µç‰ˆè‡ªå®šä¹‰å¼¹çª—ç»„ä»¶_svelteLayer_ã€‚

**svelte-layer**ï¼šåŸºäºsvelte.jsè½»é‡çº§å¤šåŠŸèƒ½pcæ¡Œé¢ç«¯å¯¹è¯æ¡†ç»„ä»¶ã€‚æ”¯æŒå¤šç§å¼¹çª—ç±»å‹ã€**30+**å‚æ•°éšæ„ç»„åˆé…ç½®ï¼Œæ•´åˆäº†æ‹–æ‹½/å››å‘¨ç¼©æ”¾/æœ€å¤§åŒ–/è®°å¿†å¼¹çª—ä½ç½®/å…¨å±/è‡ªå®šä¹‰å±‚çº§ç­‰åŠŸèƒ½ã€‚

![](https://img2022.cnblogs.com/blog/1289798/202204/1289798-20220418002830193-213774124.png)

svelteLayeråŠŸèƒ½æ•ˆæœä¸Šæœ‰äº›ç±»ä¼¼layer.jsæ’ä»¶ã€‚

### **â—† å¿«é€Ÿå¼•å…¥**

åœ¨éœ€è¦ä½¿ç”¨ç»„ä»¶åŠŸèƒ½çš„é¡µé¢ï¼Œå¼•å…¥ç»„ä»¶ã€‚

import Layer, {svLayer} from '$lib/Layer'

![](https://img2022.cnblogs.com/blog/1289798/202204/1289798-20220418003456405-1416220888.gif)

svelteLayeræ”¯æŒ**æ ‡ç­¾å¼+å‡½æ•°å¼**ä¸¤ç§è°ƒç”¨æ–¹å¼ã€‚

*   **æ ‡ç­¾å¼è°ƒç”¨**

<!-- è¯¢é—®æ¡† \-->
<Layer bind:open\={showConfirm} shadeClose\="false" title\="è­¦å‘Šä¿¡æ¯" xclose zIndex\="2001" lockScroll\={false} resize dragOut
    content\="<div style='color:#00e0a1;padding:20px 40px;'>è¿™é‡Œæ˜¯ç¡®è®¤æ¡†æç¤ºä¿¡æ¯</div>"
    btns\={\[
        {text: 'å–æ¶ˆ', click: () \=\> showConfirm=false},
        {text: 'ç¡®å®š', style: 'color:#e63d23;', click: handleInfo},
    \]}
/>

*   å‡½æ•°å¼è°ƒç”¨

function handleInfo(e) {
    let el \= svLayer({
        title: 'æ ‡é¢˜',
        content: \`<div style="padding:20px;">
            <p>å‡½æ•°å¼è°ƒç”¨ï¼š<em style="color:#999;">svLayer({...})</em></p>
        </div>\`,
        resize: true,
        btns: \[
            {
                text: 'å–æ¶ˆ',
                click: () \=> {
                    // å…³é—­å¼¹çª—
                    el.$set({open: false})
                }
            },
            {
                text: 'ç¡®è®¤',
                style: 'color:#09f;',
                click: () \=> {
                    svLayer({
                        type: 'toast',
                        icon: 'loading',
                        content: 'åŠ è½½ä¸­...',
                        opacity: .2,
                        time: 2
                    })
                }
            },
        \]
    })
}

![](https://img2022.cnblogs.com/blog/1289798/202204/1289798-20220418004104267-1955310126.gif)

æ”¯æŒæ ‡ç­¾å¼å’Œå‡½æ•°å¼æ··åˆæ­é…è°ƒç”¨ï¼Œè¿˜æ”¯æŒå¦‚ä¸Šå›¾**åŠ¨æ€åŠ è½½**å¤–éƒ¨ç»„ä»¶ã€‚

![](https://img2022.cnblogs.com/blog/1289798/202204/1289798-20220418004342668-19997669.png)

![](https://img2022.cnblogs.com/blog/1289798/202204/1289798-20220418004356284-1250274856.png)

![](https://img2022.cnblogs.com/blog/1289798/202204/1289798-20220418004424288-1325326294.png)

![](https://img2022.cnblogs.com/blog/1289798/202204/1289798-20220418004439380-1493452205.png)

![](https://img2022.cnblogs.com/blog/1289798/202204/1289798-20220418004502069-1696840452.png)

![](https://img2022.cnblogs.com/blog/1289798/202204/1289798-20220418004512469-1776896960.png)

### **â—† å‚æ•°é…ç½®**

svelte-layeré»˜è®¤æ”¯æŒå¦‚ä¸‹å‚æ•°è‡ªå®šä¹‰é…ç½®ã€‚

<script context="module">
    let index \= 0 // ç”¨äºæ§åˆ¶å€’è®¡æ—¶ä¸´æ—¶ç´¢å¼•
    let lockNum = 0 // ç”¨äºæ§åˆ¶é”å®šå±å¹•ä¸´æ—¶ç´¢å¼•
</script>

<script>
    // æ˜¯å¦æ‰“å¼€å¼¹çª—bind:open={showDialog}
    export let open = false
    // å¼¹çª—æ ‡è¯†
    export let id = undefined
    // æ ‡é¢˜
    export let title = ''
    // å†…å®¹
    export let content = ''
    // å¼¹çª—ç±»å‹
    export let type = ''
    // è‡ªå®šä¹‰æ ·å¼
    export let layerStyle = undefined
    // è‡ªå®šä¹‰ç±»å
    export let customClass = ''
    // toastå›¾æ ‡
    export let icon = ''
    // æ˜¯å¦æ˜¾ç¤ºé®ç½©å±‚
    export let shade = true
    // ç‚¹å‡»é®ç½©å±‚å…³é—­
    export let shadeClose = true
    // é”å®šå±å¹•
    export let lockScroll = true
    // é®ç½©å±‚é€æ˜åº¦
    export let opacity = ''
    // æ˜¯å¦æ˜¾ç¤ºå…³é—­å›¾æ ‡
    export let xclose = false
    // å…³é—­å›¾æ ‡ä½ç½®
    export let xposition = 'right'
    // å…³é—­å›¾æ ‡é¢œè‰²
    export let xcolor = '#000'
    // å¼¹çª—åŠ¨ç”»
    export let anim = 'scaleIn'
    // å¼¹å‡ºä½ç½®ï¼ˆauto | \['100px','50px'\] | t | r | b | l | lt | rt | lb | rbï¼‰
    export let position = 'auto'
    // æŠ½å±‰å¼¹çª—
    export let drawer = ''
    // å³é”®å¼¹çª—å®šä½
    export let follow = null
    // å¼¹çª—è‡ªåŠ¨å…³é—­æ—¶é—´
    export let time = 0
    // å¼¹çª—å±‚çº§
    export let zIndex = 202204
    // ç½®é¡¶å¼¹çª—
    export let topmost = false
    // å¼¹çª—å¤§å°
    export let area = 'auto'
    // å¼¹çª—æœ€å¤§å®½åº¦
    export let maxWidth = 375
    // å¼¹çª—æ˜¯å¦æœ€å¤§åŒ–
    export let maximize = false
    // å¼¹çª—æ˜¯å¦å…¨å±
    export let fullscreen = false
    // æ˜¯å¦å›ºå®š
    export let fixed = true
    // æ˜¯å¦æ‹–æ‹½
    export let drag = '.vlayer\_\_wrap-tit'
    // æ˜¯å¦æ‹–æ‹½å±å¹•å¤–
    export let dragOut = false
    // é™åˆ¶æ‹–æ‹½æ–¹å‘ vertical|horizontal
    export let dragDir = ''
    // æ‹–æ‹½ç»“æŸå›è°ƒ {width: 120, height: 120, x: 100, y: 100}
    export let dragEnd = undefined
    // æ˜¯å¦ç¼©æ”¾
    export let resize = false

    // å¼¹çª—æŒ‰é’®äº‹ä»¶
    export let btns = null
    /\*export let btns = \[
        {text: 'å–æ¶ˆ', style: 'color:red', disabled: true, click: null},
        {text: 'ç¡®å®š', style: 'color:blue', click: null}
    \]\*/

    // å‡½æ•°å¼æ‰“å¼€|å…³é—­å›è°ƒ
    export let onOpen = undefined
    export let onClose \= undefined
    export let beforeClose \= undefined

    // æ¥æ”¶å‡½æ•°ç§»é™¤æŒ‡ä»¤
    export let remove = undefined

    import { onMount, afterUpdate, createEventDispatcher, tick } from 'svelte'
    const dispatch \= createEventDispatcher()
    
    // ...
</script>

å¼¹çª—æ¨¡æ¿åŠæ ¸å¿ƒé€»è¾‘å¤„ç†ã€‚

<div class\="vui\_\_layer" class:opened class:vui\_\_layer-closed\={closeCls} id\={id} bind:this\={el}\>
    <!-- é®ç½©å±‚ \-->
    {#if bool(shade)}<div class\="vlayer\_\_overlay" on:click\={shadeClicked} style:opacity\></div\>{/if}
    <!-- ä¸»ä½“ \-->
    <div class\="vlayer\_\_wrap {type&&'popui\_\_'+type} anim-{anim}" style\="{layerStyle}"\>
        {#if title}<div class\="vlayer\_\_wrap-tit"\>{@html title}</div\>{/if}
        {#if icon&&type\=='toast'}<div class\="vlayer\_\_toast-icon vlayer\_\_toast-{icon}"\>{@html toastIcon\[icon\]}</div\>{/if}
        <div class\="vlayer\_\_wrap-cntbox"\>
            <!-- åˆ¤æ–­contentæ’æ§½æ˜¯å¦å­˜åœ¨ \-->
            {#if $$slots.content}
                <div class\="vlayer\_\_wrap-cnt"\><slot name\="content" /></div\>
            {:else}
                {#if content}
                    <!-- iframe \-->
                    {#if type=='iframe'}
                    <div class\="vlayer\_\_wrap-iframe"\>
                        <iframe scrolling\="auto" allowtransparency\="true" frameborder\="0" src\={content}\></iframe\>
                    </div\>
                    <!-- message|notify|popover \-->
                    {:else if type=='message' || type=='notify' || type=='popover'}
                    <div class\="vlayer\_\_wrap-cnt"\>
                        {#if icon}<i class\="vlayer-msg\_\_icon {icon}"\>{@html messageIcon\[icon\]}</i\>{/if}
                        <div class\="vlayer-msg\_\_group"\>
                            {#if title}<div class\="vlayer-msg\_\_title"\>{@html title}</div\>{/if}
                            <div class\="vlayer-msg\_\_content"\>{@html content}</div\>
                        </div\>
                    </div\>
                    <!-- åŠ è½½åŠ¨æ€ç»„ä»¶ \-->
                    {:else if type == 'component'}
                    <svelte:component this\={content}/>
                    {:else}
                    <div class\="vlayer\_\_wrap-cnt"\>{@html content}</div\>
                    {/if}
                {/if}
            {/if}
            <slot />
        </div\>

        <!-- æŒ‰é’®ç»„ \-->
        {#if btns}
        <div class\="vlayer\_\_wrap-btns"\>
            {#each btns as btn,index}
                <span class\="btn" class:btn-disabled\={btn.disabled} style\="{btn.style}"\>{@html btn.text}</span\>
            {/each}
        </div\>
        {/if}

        {#if xclose}
        <span class\="vlayer\_\_xclose" style\="color: {xcolor}" on:click\={hide}\></span\>
        {/if}
        {#if maximize}<span class\="vlayer\_\_maximize" on:click\={maximizeClicked}\></span\>{/if}
        <!-- ç¼©æ”¾ \-->
        {#if resize}
        <span class\="vlayer\_\_groupresize"\>
            <i class\="vlayer\_\_resize LT"\></i\>
            <i class\="vlayer\_\_resize RT"\></i\>
            <i class\="vlayer\_\_resize LB"\></i\>
            <i class\="vlayer\_\_resize RB"\></i\>
        </span\>
        {/if}
    </div\>
    <!-- ä¼˜åŒ–æ‹–æ‹½å¡é¡¿ \-->
    <div class\="vlayer\_\_dragfix"\></div\>
</div\>

<script\>
    /\*\*
     \* @Desc     Svelte.jsæ¡Œé¢ç«¯å¯¹è¯æ¡†ç»„ä»¶SvelteLayer
     \* @Time     andy by 2022-04
     \* @About    Qï¼š282310962  wxï¼šxy190310
     \*/
    
    // ...
    onMount(() \=> {
        console.log('ç›‘å¬å¼¹çª—å¼€å¯')
        window.addEventListener('resize', autopos, false)
        return () \=> {
            console.log('ç›‘å¬å¼¹çª—å…³é—­')
            window.removeEventListener('resize', autopos, false)
        }
    })

    afterUpdate(() \=> {
        console.log('ç›‘å¬å¼¹çª—æ›´æ–°')
    })

    // åŠ¨æ€ç›‘å¬å¼€å¯/å…³é—­
    $: if(open) {
        show()
    }else {
        hide()
    }

    /\*\*
     \* å¼€å¯å¼¹çª—
     \*/
    async function show() {
        if(opened) return
        opened \= true
        dispatch('open')
        typeof onOpen \=== 'function' && onOpen()

        // é¿å…è·å–å¼¹çª—å®½é«˜ä¸å‡†ç¡®
        await tick()

        zIndex \= util.getZIndex(zIndex) + 1

        auto()
    }

    /\*\*
     \* å…³é—­å¼¹çª—
     \*/
    function hide() {
        // ...
    }

    // å¼¹çª—ä½ç½®
    function auto() {
        autopos()

        // å…¨å±å¼¹çª—
        if(fullscreen) {
            full()
        }

        // æ‹–æ‹½|ç¼©æ”¾
        move()
    }

    // å¼¹çª—å®šä½
    function autopos() {
        if(!opened) return
        let ol, ot
        let pos \= position
        let isfixed \= bool(fixed)
        let vlayero \= el.querySelector('.vlayer\_\_wrap')

        if(!isfixed || follow) {
            vlayero.style.position \= 'absolute'
        }

        let area \= \[util.client('width'), util.client('height'), vlayero.offsetWidth, vlayero.offsetHeight\]

        ol \= (area\[0\] \- area\[2\]) / 2
        ot \= (area\[1\] \- area\[3\]) / 2

        if(follow) {
            offset()
        }else {
            typeof pos \=== 'object' ? (
                ol \= parseFloat(pos\[0\]) || 0, ot \= parseFloat(pos\[1\]) || 0
            ) : (
                pos \== 't' ? ot \= 0 : 
                pos \== 'r' ? ol \= area\[0\] \- area\[2\] : 
                pos \== 'b' ? ot \= area\[1\] \- area\[3\] : 
                pos \== 'l' ? ol \= 0 : 
                pos \== 'lt' ? (ol \= 0, ot \= 0) : 
                pos \== 'rt' ? (ol \= area\[0\] \- area\[2\], ot \= 0) : 
                pos \== 'lb' ? (ol \= 0, ot \= area\[1\] \- area\[3\]) :
                pos \== 'rb' ? (ol \= area\[0\] \- area\[2\], ot \= area\[1\] \- area\[3\]) : 
                null
            )

            vlayero.style.left \= parseFloat(isfixed ? ol : util.scroll('left') + ol) + 'px'
            vlayero.style.top \= parseFloat(isfixed ? ot : util.scroll('top') + ot) + 'px'
        }
    }

    // è·Ÿéšå®šä½
    function offset() {
        let ow, oh, ps
        let vlayero \= el.querySelector('.vlayer\_\_wrap')

        ow \= vlayero.offsetWidth
        oh \= vlayero.offsetHeight
        ps \= util.getFollowRect(follow, ow, oh)
        tipArrow \= ps\[2\]

        vlayero.style.left \= ps\[0\] + 'px'
        vlayero.style.top \= ps\[1\] + 'px'
    }

    // æœ€å¤§åŒ–å¼¹çª—
    async function full() {
        // ...
    }

    // å¤ä½å¼¹çª—
    async function restore() {
        // ...
    }

    // æ‹–æ‹½ç¼©æ”¾
    function move() {
        let isfixed \= bool(fixed)
        let isdragOut \= bool(dragOut)
        let c \= {}

        let vlayero \= el.querySelector('.vlayer\_\_wrap')
        let otit \= el.querySelector('.vlayer\_\_wrap-tit')
        let ocnt \= el.querySelector('.vlayer\_\_wrap-cntbox')
        let obtn \= el.querySelector('.vlayer\_\_wrap-btns')
        let odrag \= el.querySelector(drag)
        let oresize \= el.querySelectorAll('.vlayer\_\_resize')
        let ofix \= el.querySelector('.vlayer\_\_dragfix')

        // æ‹–æ‹½
        if(odrag) {
            odrag.style.cursor \= util.isIE() ? 'move' : 'grab'
            util.on(odrag, 'mousedown', function(e) {
                // ...
            })
        }

        util.on(document, 'mousemove', function(e) {
            if(c.dragTrigger) {
                let iL \= e.clientX \- c.pos\[0\] + c.area\[0\]
                let iT \= e.clientY \- c.pos\[1\] + c.area\[1\]
                let fixL \= isfixed ? 0 : c.scroll\[1\]
                let fixT \= isfixed ? 0 : c.scroll\[2\]
                let iMaxL \= c.client\[0\] + fixL \- c.area\[2\]
                let iMaxT \= c.client\[1\] + fixT \- c.area\[3\]
                let oMaxT \= c.scroll\[0\] \- c.area\[3\]

                // è¾¹ç•Œæ£€æµ‹
                if(isdragOut) {
                    iT \= iT < 0 ? 0 : iT
                    iT \= (iT \> oMaxT) ? oMaxT : iT
                }else {
                    iL \= (iL < fixL) ? fixL : iL
                    iL \= (iL \> iMaxL) ? iMaxL : iL
                    iT \= (iT < fixT) ? fixT : iT
                    iT \= (iT \> iMaxT) ? iMaxT : iT
                }

                // è®°å½•æ‹–æ‹½å¼¹çª—åæ ‡
                c.dragPosition \= {
                    width: c.area\[2\],
                    height: c.area\[3\],
                    x: iL,
                    y: iT
                }

                // é™åˆ¶æ‹–æ‹½æ–¹å‘
                dragDir \== 'horizontal' ? (vlayero.style.left \= iL + 'px')
                :
                dragDir \== 'vertical' ? (vlayero.style.top \= iT + 'px')
                :
                (vlayero.style.left \= iL + 'px', vlayero.style.top \= iT + 'px')
            }

            // è¾¹è§’ç¼©æ”¾
            if(c.resizeTrigger && c.elem) {
                // ...
            }
        })

        util.on(document, 'mouseup', function() {
            c.dragTrigger && (
                delete c.dragTrigger, ofix.style.display \= 'none',
                typeof dragEnd \=== 'function' && dragEnd(dragPosition)
            )
            c.resizeTrigger && (
                delete c.resizeTrigger, ofix.style.display \= 'none'
            )
            document.onmouseup \= null
        })
    }

    // ç‚¹å‡»æœ€å¤§åŒ–æŒ‰é’®
    function maximizeClicked(e) {
        let o \= e.target
        if(o.classList.contains('maximized')) {
            restore()
        }else {
            full()
        }
    }
    
    //...
</script\>

svelte-layerè¿˜æ”¯æŒç±»å‹ä¸ºÂ message | notify | popoverÂ å¼¹çª—ã€‚

![](https://img2022.cnblogs.com/blog/1289798/202204/1289798-20220418005629228-376570771.gif)

svLayer.message({})
svLayer.notify({})
svLayer.popover({})

è°ƒç”¨æ–¹å¼å¦‚ä¸Šï¼Œåªæ”¯æŒå‡½æ•°å¼è°ƒç”¨ã€‚

svelte-layeræ”¯æŒè‡ªå®šä¹‰æ‹–æ‹½åŒºåŸŸÂ drag: '#header'Â ï¼Œæ˜¯å¦æ‹–æ‹½åˆ°çª—å£å¤–Â dragOut: trueÂ ã€‚è¿˜æ”¯æŒiframeå¼¹çª—ç±»å‹Â type: 'iframe'Â ï¼Œé…ç½®Â topmost: trueÂ å³å¯è®©å½“å‰æ´»åŠ¨çª—å£ä¿æŒç½®é¡¶çŠ¶æ€ã€‚

è¯¥ç»„ä»¶è¿˜æœ‰ä¸€å¤§äº®ç‚¹ï¼Œå°±æ˜¯æ”¯æŒåŠ¨æ€å¼•å…¥å¤–éƒ¨ç»„ä»¶ã€‚

import Counter from '$lib/Counter.svelte'

// åŠ¨æ€åŠ è½½ç»„ä»¶(å‡½æ•°å¼è°ƒç”¨)
function showComponentLayer() {
    svLayer({
        type: 'component',
        title: 'åŠ¨æ€åŠ è½½ç»„ä»¶',
        content: Counter,
        resize: true,
        xclose: true,
        maximize: true,
        area: \['360px', '250px'\]
    })
}

<!-- ç»„ä»¶è°ƒç”¨ \-->
<Layer bind:open\={showComponent} content\="è¿™é‡Œæ˜¯å†…å®¹ä¿¡æ¯" resize drag\=".vlayer\_\_wrap-cnt"
    btns\={\[
        {text: 'ç¡®è®¤', style: 'color:#f60;', click: () \=\> showComponent=false},
    \]}
    on:open={handleOpen} on:close={handleClose}
>
    <svelte:fragment slot\="content"\>
        <Counter />
    </svelte:fragment\>
</Layer\>

OKï¼ŒåŸºäºSvelte.jså¼€å‘pcç«¯å¼¹çª—ç»„ä»¶å°±åˆ†äº«åˆ°è¿™é‡Œã€‚å¸Œæœ›å¯¹å¤§å®¶æœ‰ä¸€äº›å¸®åŠ©~Â ğŸ’ª

**æœ€åé™„ä¸Šä¸€ä¸ªsvelte3+svelteKitèŠå¤©å®ä¾‹é¡¹ç›®**

svelte3.x+sassä»¿å¾®ä¿¡appèŠå¤©ï¼š[https://www.cnblogs.com/xiaoyan2017/p/16110203.html](https://www.cnblogs.com/xiaoyan2017/p/16110203.html)

![](https://img2022.cnblogs.com/blog/1289798/202204/1289798-20220418011209490-170605200.gif)

æœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œæœªç»åšä¸»å…è®¸ä¸å¾—è½¬è½½ï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·äº¤æµ QQï¼ˆ282310962ï¼‰ wxï¼ˆxy190310ï¼‰