---
layout: post
title: "JVMå­¦ä¹ ç¬”è®°â€”â€”ç±»åŠ è½½å’Œå­—èŠ‚ç æŠ€æœ¯ç¯‡"
date: "2022-11-06T10:20:15.738Z"
---
JVMå­¦ä¹ ç¬”è®°â€”â€”ç±»åŠ è½½å’Œå­—èŠ‚ç æŠ€æœ¯ç¯‡
===================

JVMå­¦ä¹ ç¬”è®°â€”â€”ç±»åŠ è½½å’Œå­—èŠ‚ç æŠ€æœ¯ç¯‡
===================

åœ¨æœ¬ç³»åˆ—å†…å®¹ä¸­æˆ‘ä»¬ä¼šå¯¹JVMåšä¸€ä¸ªç³»ç»Ÿçš„å­¦ä¹ ï¼Œæœ¬ç‰‡å°†ä¼šä»‹ç»JVMçš„ç±»åŠ è½½å’Œå­—èŠ‚ç æŠ€æœ¯éƒ¨åˆ†

æˆ‘ä»¬ä¼šåˆ†ä¸ºä»¥ä¸‹å‡ éƒ¨åˆ†è¿›è¡Œä»‹ç»ï¼š

*   ç±»æ–‡ä»¶ç»“æ„
*   å­—èŠ‚ç æŒ‡ä»¤
*   ç¼–è¯‘æœŸå¤„ç†
*   ç±»åŠ è½½é˜¶æ®µ
*   ç±»åŠ è½½å™¨
*   è¿è¡ŒæœŸä¼˜åŒ–

ç±»æ–‡ä»¶ç»“æ„
-----

è¿™ä¸€å°èŠ‚æˆ‘ä»¬å°†ç®€å•ä»‹ç»ä¸€ä¸‹ç±»çš„æ–‡ä»¶ç»“æ„éƒ¨åˆ†ï¼Œç®€å•é˜…è¯»ä¸€ä¸‹ä»¥ä¸‹å†…å®¹å³å¯

### æ•´ä½“æ–‡ä»¶å±•ç¤º

é¦–å…ˆæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„HelloWorldæ–‡ä»¶æ¥è¿›è¡Œç±»æ–‡ä»¶ç»“æ„ä»‹ç»

é¦–å…ˆæˆ‘ä»¬ç»™å‡ºJavaæ–‡ä»¶ä»£ç ï¼š

    package cn.itcast.jvm.t5;
    // HelloWorld ç¤ºä¾‹
    public class HelloWorld {
    	public static void main(String[] args) {
    		System.out.println("hello world");
    }
    

æˆ‘ä»¬å¦‚æœæƒ³è¦è·å–åº•å±‚äºŒè¿›åˆ¶ä»£ç ï¼Œéœ€è¦åœ¨outæ–‡ä»¶ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

    // è·å¾—åº•å±‚äºŒè¿›åˆ¶ä»£ç 
    javac -parameters -d . HellowWorld.java
    

ç„¶åæˆ‘ä»¬å°±å¯ä»¥è·å¾—äºŒè¿›åˆ¶ä»£ç ï¼š

    // å½“ç„¶ç›®å‰ä½ æ˜¯å®Œå…¨çœ‹ä¸æ‡‚çš„ï¼Œæˆ‘ä»¬è¿™é‡Œåªéœ€è¦å¤§æ¦‚äº†è§£ç»“æ„å³å¯ï¼Œä¸éœ€è¦è§£è¯»
    [root@localhost ~]# od -t xC HelloWorld.class
    0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09
    0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07
    0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29
    0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e
    0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 63
    0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01
    0000140 00 04 74 68 69 73 01 00 1d 4c 63 6e 2f 69 74 63
    0000160 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 6f
    0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16
    0000220 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72
    0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13
    0000260 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69
    0000300 6e 67 3b 01 00 10 4d 65 74 68 6f 64 50 61 72 61
    0000320 6d 65 74 65 72 73 01 00 0a 53 6f 75 72 63 65 46
    0000340 69 6c 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64
    0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e
    0000400 00 1f 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64
    0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74
    0000440 63 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c
    0000460 6f 57 6f 72 6c 64 01 00 10 6a 61 76 61 2f 6c 61
    0000500 6e 67 2f 4f 62 6a 65 63 74 01 00 10 6a 61 76 61
    0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 00 03 6f
    0000540 75 74 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72
    0000560 69 6e 74 53 74 72 65 61 6d 3b 01 00 13 6a 61 76
    0000600 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d
    0000620 01 00 07 70 72 69 6e 74 6c 6e 01 00 15 28 4c 6a
    0000640 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b
    0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01
    0000700 00 07 00 08 00 01 00 09 00 00 00 2f 00 01 00 01
    0000720 00 00 00 05 2a b7 00 01 b1 00 00 00 02 00 0a 00
    0000740 00 00 06 00 01 00 00 00 04 00 0b 00 00 00 0c 00
    0000760 01 00 00 00 05 00 0c 00 0d 00 00 00 09 00 0e 00
    0001000 0f 00 02 00 09 00 00 00 37 00 02 00 01 00 00 00
    0001020 09 b2 00 02 12 03 b6 00 04 b1 00 00 00 02 00 0a
    0001040 00 00 00 0a 00 02 00 00 00 06 00 08 00 07 00 0b
    0001060 00 00 00 0c 00 01 00 00 00 09 00 10 00 11 00 00
    0001100 00 12 00 00 00 05 01 00 10 00 00 00 01 00 13 00
    0001120 00 00 02 00 14
    

### ç±»æ–‡ä»¶ç»“æ„å±•ç¤º

é¦–å…ˆæˆ‘ä»¬ç»™å‡ºç±»æ–‡ä»¶ç»“æ„çš„æ•´ä½“å±•ç¤ºï¼š

    ClassFile {
        // é­”æ•°
        u4 magic;
        
        // ç±»æ–‡ä»¶ç‰ˆæœ¬
        u2 minor_version;
        u2 major_version;
        
        // ç±»æ–‡ä»¶å¸¸é‡æ± 
        u2 constant_pool_count;
        cp_info constant_pool[constant_pool_count-1];
        
        // ç±»æ–‡ä»¶çš„ç±»å‹ï¼ˆpublicæˆ–privateï¼‰
        u2 access_flags;
        
        // å­ç±»çˆ¶ç±»ä»‹ç»
        u2 this_class;
        u2 super_class;
        
        // æ¥å£ä»‹ç»
        u2 interfaces_count;
        u2 interfaces[interfaces_count];
        
        // é™æ€å˜é‡ä»‹ç»
        u2 fields_count;
        field_info fields[fields_count];
        
        // æ–¹æ³•ä»‹ç»ï¼ˆåŒ…æ‹¬é™æ€æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•ï¼Œæ­£å¸¸æ–¹æ³•ï¼‰
        u2 methods_count;
        method_info methods[methods_count];
        
        // é™„åŠ ä¿¡æ¯
        u2 attributes_count;
        attribute_info attributes[attributes_count];
    }
    

### é­”æ•°ä¿¡æ¯

é¦–å…ˆæˆ‘ä»¬ç»™å‡ºé­”æ•°å®šä¹‰ï¼š

*   0~3 å­—èŠ‚ï¼Œè¡¨ç¤ºå®ƒæ˜¯å¦æ˜¯ã€classã€‘ç±»å‹çš„æ–‡ä»¶

æˆ‘ä»¬ç»™å‡ºå®ä¾‹å±•ç¤ºï¼š

*   0000000 _**ca fe ba be**_ 00 00 00 34 00 23 0a 00 06 00 15 09

### ç‰ˆæœ¬ä¿¡æ¯

é¦–å…ˆæˆ‘ä»¬ç»™å‡ºç‰ˆæœ¬å®šä¹‰ï¼š

*   4~7 å­—èŠ‚ï¼Œè¡¨ç¤ºç±»çš„ç‰ˆæœ¬ 00 34ï¼ˆ52ï¼‰ è¡¨ç¤ºæ˜¯ Java 8

æˆ‘ä»¬ç»™å‡ºå®ä¾‹å±•ç¤ºï¼š

*   0000000 ca fe ba be _**00 00 00 34**_ 00 23 0a 00 06 00 15 09

### å¸¸é‡æ± ä¿¡æ¯

é¦–å…ˆæˆ‘ä»¬ç»™å‡ºå¸¸é‡æ± å®šä¹‰ï¼š

*   8~9 å­—èŠ‚ï¼Œè¡¨ç¤ºå¸¸é‡æ± é•¿åº¦ï¼Œ00 23 ï¼ˆ35ï¼‰ è¡¨ç¤ºå¸¸é‡æ± æœ‰ #1~#34é¡¹ï¼Œæ³¨æ„ #0 é¡¹ä¸è®¡å…¥ï¼Œä¹Ÿæ²¡æœ‰å€¼

æˆ‘ä»¬ç»™å‡ºå®ä¾‹å±•ç¤ºï¼š

*   0000000 ca fe ba be 00 00 00 34 _**00 23**_ 0a 00 06 00 15 09

æˆ‘ä»¬ç»™å‡ºå¸¸é‡æ± çš„ç±»å‹å¯¹åº”çš„åå…­è¿›åˆ¶æ ‡å·ï¼š

Constant Type

Value

CONSTANT\_Class

7

CONSTANT\_Fieldref

9

CONSTANT\_Methodref

10

CONSTANT\_InterfaceMethodref

11

CONSTANT\_String

8

CONSTANT\_Integer

3

CONSTANT\_Float

4

CONSTANT\_Long

5

CONSTANT\_Double

6

CONSTANT\_NameAndType

12

CONSTANT\_Utf8

1

CONSTANT\_MethodHandle

15

CONSTANT\_MethodType

16

CONSTANT\_InvokeDynamic

18

ç„¶åä¸‹è¿°çš„34é¡¹å…¨éƒ¨éƒ½æ˜¯å¸¸é‡å†…å®¹ï¼Œæˆ‘ä»¬çš„å¸¸é‡é€šå¸¸åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š

ä¿¡æ¯è¡¨ç¤º

ä¿¡æ¯è¡¨ç¤ºå

ä½æ•°

å«ä¹‰

0a

Method ä¿¡æ¯

3

ä¿¡æ¯è¡¨ç¤ºï¼šè°ƒç”¨ç±»åï¼šè°ƒç”¨æ–¹æ³•å

09

Field ä¿¡æ¯

3

ä¿¡æ¯è¡¨ç¤ºï¼šè°ƒç”¨ç±»åï¼šè°ƒç”¨é™æ€æ–¹æ³•å

08

å­—ç¬¦ä¸²å¸¸é‡åç§°

2

ä¿¡æ¯è¡¨ç¤ºï¼šè°ƒç”¨å¸¸é‡æ± ä½ç½®

07

Class ä¿¡æ¯

2

ä¿¡æ¯è¡¨ç¤ºï¼šè°ƒç”¨å¸¸é‡æ± ä½ç½®

01

utf8 ä¸²

3

ä¿¡æ¯è¡¨ç¤ºï¼šå­—ç¬¦é•¿åº¦ï¼šå­—ç¬¦æ„ä¹‰

æˆ‘ä»¬ç»™å‡ºä¸€äº›å®ä¾‹ï¼š

    // ç¬¬#1é¡¹ 0a è¡¨ç¤ºä¸€ä¸ª Method ä¿¡æ¯ï¼Œ00 06 å’Œ 00 15ï¼ˆ21ï¼‰ 
    // è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #6 å’Œ #21 é¡¹æ¥è·å¾—è¿™ä¸ªæ–¹æ³•çš„ã€æ‰€å±ç±»ã€‘å’Œã€æ–¹æ³•åã€‘
    0a 00 06 00 15
    
    // ç¬¬#2é¡¹ 09 è¡¨ç¤ºä¸€ä¸ª Field ä¿¡æ¯ï¼Œ00 16ï¼ˆ22ï¼‰å’Œ 00 17ï¼ˆ23ï¼‰ 
    //è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #22 å’Œ # 23 é¡¹æ¥è·å¾—è¿™ä¸ªæˆå‘˜å˜é‡çš„ã€æ‰€å±ç±»ã€‘å’Œã€æˆå‘˜å˜é‡åã€‘
    09 00 16 00 17
        
    // ç¬¬#3é¡¹ 08 è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡åç§°ï¼Œ00 18ï¼ˆ24ï¼‰è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #24 é¡¹
    08 00 18 
        
    // ç¬¬#5é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1bï¼ˆ27ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #27 é¡¹
    07 00 1b
        
    // ç¬¬#7é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 06 è¡¨ç¤ºé•¿åº¦ï¼Œ3c 69 6e 69 74 3e æ˜¯ã€ <init> ã€‘
    00 06 3c 69 6e 69 74 3e
    

### è®¿é—®æ ‡è¯†ä¸ç»§æ‰¿ä¿¡æ¯

é¦–å…ˆæˆ‘ä»¬ç»™å‡ºè®¿é—®æ ‡è¯†ä¸ç»§æ‰¿ä¿¡æ¯å®šä¹‰ï¼š

*   ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºè¯¥ class æ˜¯ä¸€ä¸ªç±»çš„ä¿¡æ¯ï¼š00 21 å…¬å…±çš„
*   ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºæ ¹æ®å¸¸é‡æ± ä¸­ä½ç½®æ‰¾åˆ°æœ¬ç±»å…¨é™å®šåï¼š00 05 è¡¨ç¤ºå¸¸é‡æ± #5
*   ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºæ ¹æ®å¸¸é‡æ± ä¸­ä½ç½®æ‰¾åˆ°çˆ¶ç±»å…¨é™å®šå ï¼š00 06 è¡¨ç¤ºå¸¸é‡æ± #6
*   ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºæ¥å£çš„æ•°é‡ï¼š 00 00 è¡¨ç¤ºæ¥å£æ•°ä¸º0

æˆ‘ä»¬ç»™å‡ºè®¿é—®æ ‡è¯†ä¸ç»§æ‰¿ä¿¡æ¯çš„ä¸€äº›ä¿¡æ¯åˆ—è¡¨ï¼š

Flag Name

Value

Interpretation

ACC\_PUBLIC

0x0001

Declared public ; may be accessed from outside its package.

ACC\_FINAL

0x0010

Declared final ; no subclasses allowed.

ACC\_SUPER

0x0020

Treat superclass methods specially when invoked by the invokespecial instruction.

ACC\_INTERFACE

0x0200

Is an interface, not a class.

ACC\_ABSTRACT

0x0400

Declared abstract ; must not be instantiated.

ACC\_SYNTHETIC

0x1000

Declared synthetic; not present in the source code.

ACC\_ANNOTATION

0x2000

Declared as an annotation type.

ACC\_ENUM

0x4000

Declared as an enum type.

### æˆå‘˜å˜é‡ä¿¡æ¯

é¦–å…ˆæˆ‘ä»¬ç»™å‡ºæˆå‘˜å˜é‡ä¿¡æ¯å®šä¹‰ï¼š

*   è¡¨ç¤ºæˆå‘˜å˜é‡æ•°é‡ï¼Œæœ¬ç±»ä¸º 0

æˆ‘ä»¬ç»™å‡ºå®ä¾‹å±•ç¤ºï¼š

*   0000660 29 56 00 21 00 05 00 06 00 00 _**00 00**_ 00 02 00 01

æˆ‘ä»¬ç»™å‡ºæˆå‘˜å˜é‡çš„ä¸€äº›ä¿¡æ¯åˆ—è¡¨ï¼š

FieldType

Type

Interpretation

B

byte

signed byte

C

char

Unicode character code point in the Basic Multilingual Plane, encoded with UTF-16

D

double

double-precision floating-point value

F

float

single-precision floating-point value

I

int

integer

J

long

long integer

L ClassName ;

reference

an instance of class ClassName

S

short

signed short

Z

boolean

true or false

\[

reference

one array dimension

### æ–¹æ³•ä¿¡æ¯

é¦–å…ˆæˆ‘ä»¬ç»™å‡ºæ–¹æ³•ä¿¡æ¯å®šä¹‰ï¼š

*   è¡¨ç¤ºæ–¹æ³•æ•°é‡ï¼Œæœ¬ç±»ä¸º 2

æˆ‘ä»¬ç»™å‡ºå®ä¾‹å±•ç¤ºï¼š

*   0000660 29 56 00 21 00 05 00 06 00 00 00 00 _**00 02**_ 00 01

ä¸€ä¸ªæ–¹æ³•ç”± è®¿é—®ä¿®é¥°ç¬¦ï¼Œåç§°ï¼Œå‚æ•°æè¿°ï¼Œæ–¹æ³•å±æ€§æ•°é‡ï¼Œæ–¹æ³•å±æ€§ç»„æˆï¼Œç”±äºè¿‡äºå¤æ‚è¿™é‡Œä¸åšå±•ç¤º

### é™„åŠ å±æ€§

é¦–å…ˆæˆ‘ä»¬ç»™å‡ºæ–¹æ³•ä¿¡æ¯å®šä¹‰ï¼š

*   00 01 è¡¨ç¤ºé™„åŠ å±æ€§æ•°é‡
*   00 13 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #19 é¡¹ï¼Œå³ã€SourceFileã€‘
*   00 00 00 02 è¡¨ç¤ºæ­¤å±æ€§çš„é•¿åº¦
*   00 14 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #20 é¡¹ï¼Œå³ã€HelloWorld.javaã€‘

æˆ‘ä»¬ç»™å‡ºå®ä¾‹å±•ç¤ºï¼š

*   00 01 00 13 00 00 00 02 00 14

å­—èŠ‚ç æŒ‡ä»¤
-----

è¿™ä¸€èŠ‚æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»å­—èŠ‚ç æŒ‡ä»¤ä»¥åŠåˆ†æJavaåº•å±‚ä»£ç 

### å­—èŠ‚ç æŒ‡ä»¤ä»‹ç»

æˆ‘ä»¬é¦–å…ˆå¯¹ä¹‹å‰çš„HelloWorldä¸­çš„ä¸¤ä¸ªæŒ‡ä»¤è¿›è¡Œä»‹ç»

ç¬¬ä¸€ä¸ªæŒ‡ä»¤æ˜¯ï¼š

*   æ„é€ æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ ï¼špublic cn.itcast.jvm.t5.HelloWorld();

å…¶äºŒè¿›åˆ¶ä»£ç ä¸ºï¼š

*   2a b7 00 01 b1

æˆ‘ä»¬å¯¹å…¶è¿›è¡Œè§£é‡Šï¼š

*   2a => aload\_0 åŠ è½½ slot 0 çš„å±€éƒ¨å˜é‡ï¼Œå³ thisï¼Œåšä¸ºä¸‹é¢çš„ invokespecial æ„é€ æ–¹æ³•è°ƒç”¨çš„å‚æ•°
*   b7 => invokespecial é¢„å¤‡è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œå“ªä¸ªæ–¹æ³•å‘¢ï¼Ÿ
*   00 01 å¼•ç”¨å¸¸é‡æ± ä¸­ #1 é¡¹ï¼Œå³ã€ Method java/lang/Object."<init>"ğŸ˜¦)V ã€‘
*   b1 è¡¨ç¤ºè¿”å›

ç¬¬äºŒä¸ªæŒ‡ä»¤æ˜¯ï¼š

*   ä¸»æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ï¼špublic static void main(java.lang.String\[\]);

å…¶äºŒè¿›åˆ¶ä»£ç ä¸ºï¼š

*   b2 00 02 12 03 b6 00 04 b1

æˆ‘ä»¬å¯¹å…¶è¿›è¡Œè§£é‡Šï¼š

*   b2 => getstatic ç”¨æ¥åŠ è½½é™æ€å˜é‡ï¼Œå“ªä¸ªé™æ€å˜é‡å‘¢ï¼Ÿ
    
*   00 02 å¼•ç”¨å¸¸é‡æ± ä¸­ #2 é¡¹ï¼Œå³ã€Field java/lang/System.out:Ljava/io/PrintStream;ã€‘
    
*   12 => ldc åŠ è½½å‚æ•°ï¼Œå“ªä¸ªå‚æ•°å‘¢ï¼Ÿ
    
*   03 å¼•ç”¨å¸¸é‡æ± ä¸­ #3 é¡¹ï¼Œå³ ã€String hello worldã€‘
    
*   b6 => invokevirtual é¢„å¤‡è°ƒç”¨æˆå‘˜æ–¹æ³•ï¼Œå“ªä¸ªæ–¹æ³•å‘¢ï¼Ÿ
    
*   00 04 å¼•ç”¨å¸¸é‡æ± ä¸­ #4 é¡¹ï¼Œå³ã€Method java/io/PrintStream.println:(Ljava/lang/String;)Vã€‘
    
*   b1 è¡¨ç¤ºè¿”å›
    

### Javapå·¥å…·ä»‹ç»

æˆ‘ä»¬å¦‚æœé‡‡ç”¨äºŒè¿›åˆ¶ä»£ç æ¥æŸ¥çœ‹å…¶åº•å±‚æ•°æ®å°±ä¼šæ˜¾å¾—ç¹æ‚ä¸”éº»çƒ¦

æ‰€ä»¥Javaä¸ºæˆ‘ä»¬æä¾›äº†å…·ä½“çš„å·¥å…·ï¼Œéš¶å±äºJVMçš„å·¥å…·ï¼Œå¯ä»¥ç›´æ¥åœ¨outæ–‡ä»¶ä¸‹ä½¿ç”¨ï¼š

    // javap åç¼–è¯‘å·¥å…·
    [root@localhost ~]# javap -v HelloWorld.class
    

ç„¶åæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°HelloWorldçš„åç¼–è¯‘æ–‡ä»¶ï¼š

    // è™½ç„¶ä¾æ—§æ˜¯åº•å±‚ä»£ç ï¼Œä½†è¿™ç§é˜…è¯»æ–¹å¼å°±æ¯”è¾ƒèˆ’æœ
    
    // é­”æ•°
    Classfile /root/HelloWorld.class
        Last modified Jul 7, 2019; size 597 bytes
        MD5 checksum 361dca1c3f4ae38644a9cd5060ac6dbc
        Compiled from "HelloWorld.java"
    // ç‰ˆæœ¬
    public class cn.itcast.jvm.t5.HelloWorld
        minor version: 0
        major version: 52
        flags: ACC_PUBLIC, ACC_SUPER
    // å¸¸é‡æ± 
    Constant pool:
        #1 = Methodref #6.#21 // java/lang/Object."<init>":()V
        #2 = Fieldref #22.#23 //
    java/lang/System.out:Ljava/io/PrintStream;
        #3 = String #24 // hello world
        #4 = Methodref #25.#26 // java/io/PrintStream.println:
    (Ljava/lang/String;)V
        #5 = Class #27 // cn/itcast/jvm/t5/HelloWorld
        #6 = Class #28 // java/lang/Object
        #7 = Utf8 <init>
        #8 = Utf8 ()V
        #9 = Utf8 Code
        #10 = Utf8 LineNumberTable
        #11 = Utf8 LocalVariableTable
        #12 = Utf8 this
        #13 = Utf8 Lcn/itcast/jvm/t5/HelloWorld;#14 = Utf8 main
        #15 = Utf8 ([Ljava/lang/String;)V
        #16 = Utf8 args
        #17 = Utf8 [Ljava/lang/String;
        #18 = Utf8 MethodParameters
        #19 = Utf8 SourceFile
        #20 = Utf8 HelloWorld.java
        #21 = NameAndType #7:#8 // "<init>":()V
        #22 = Class #29 // java/lang/System
        #23 = NameAndType #30:#31 // out:Ljava/io/PrintStream;
        #24 = Utf8 hello world
        #25 = Class #32 // java/io/PrintStream
        #26 = NameAndType #33:#34 // println:(Ljava/lang/String;)V
        #27 = Utf8 cn/itcast/jvm/t5/HelloWorld
        #28 = Utf8 java/lang/Object
        #29 = Utf8 java/lang/System
        #30 = Utf8 out
        #31 = Utf8 Ljava/io/PrintStream;
        #32 = Utf8 java/io/PrintStream
        #33 = Utf8 println
        #34 = Utf8 (Ljava/lang/String;)V
                    
    // æ–¹æ³•æ‰§è¡Œ
    {
    	public cn.itcast.jvm.t5.HelloWorld();
        descriptor: ()V
        flags: ACC_PUBLIC
        Code:
            stack=1, locals=1, args_size=1
                0: aload_0
                1: invokespecial #1 // Method java/lang/Object."
    <init>":()V
    		4: return
    	LineNumberTable:
    		line 4: 0
    	LocalVariableTable:
            Start Length Slot Name Signature
            0        5     0  this Lcn/itcast/jvm/t5/HelloWorld;
    	public static void main(java.lang.String[]);
    		descriptor: ([Ljava/lang/String;)V
    		flags: ACC_PUBLIC, ACC_STATIC
    		Code:
    			stack=2, locals=1, args_size=1
    			0: getstatic #2 // Field
    java/lang/System.out:Ljava/io/PrintStream;
    			3: ldc #3 // String hello world
            	5: invokevirtual #4 // Method
    java/io/PrintStream.println:(Ljava/lang/String;)V
            	8: return
    		LineNumberTable:
    			line 6: 0
    			line 7: 8
            // å±€éƒ¨å˜é‡æ± 
    		LocalVariableTable:
    			Start Length Slot Name Signature
    			0		 9 	   0  args [Ljava/lang/String;
    	MethodParameters:
    	Name Flags
    	args
    }
    

### å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹

æˆ‘ä»¬é¦–å…ˆç»™å‡ºä¸€ä¸²ç®€å•çš„Javaä»£ç ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    /**
     * æ¼”ç¤º å­—èŠ‚ç æŒ‡ä»¤ å’Œ æ“ä½œæ•°æ ˆã€å¸¸é‡æ± çš„å…³ç³»
     */
    public class Demo3_1 {
        public static void main(String[] args) {
            int a = 10;
            int b = Short.MAX_VALUE + 1;
            int c = a + b;
            System.out.println(c);
        }
    }
    

æˆ‘ä»¬å†ç»™å‡ºjavapåç¼–è¯‘åçš„ä»£ç ï¼š

    Classfile /E:/ç¼–ç¨‹å†…å®¹/JVM/èµ„æ–™-è§£å¯†JVM/ä»£ç /jvm/out/production/jvm/cn/itcast/jvm/t3/bytecode/Demo3_1.class
      Last modified 2022-11-2; size 635 bytes
      MD5 checksum 1a6413a652bcc5023f130b392deb76a1
      Compiled from "Demo3_1.java"
    public class cn.itcast.jvm.t3.bytecode.Demo3_1
      minor version: 0
      major version: 52
      flags: ACC_PUBLIC, ACC_SUPER
    Constant pool:
       #1 = Methodref          #7.#25         // java/lang/Object."<init>":()V
       #2 = Class              #26            // java/lang/Short
       #3 = Integer            32768
       #4 = Fieldref           #27.#28        // java/lang/System.out:Ljava/io/PrintStream;
       #5 = Methodref          #29.#30        // java/io/PrintStream.println:(I)V
       #6 = Class              #31            // cn/itcast/jvm/t3/bytecode/Demo3_1
       #7 = Class              #32            // java/lang/Object
       #8 = Utf8               <init>
       #9 = Utf8               ()V
      #10 = Utf8               Code
      #11 = Utf8               LineNumberTable
      #12 = Utf8               LocalVariableTable
      #13 = Utf8               this
      #14 = Utf8               Lcn/itcast/jvm/t3/bytecode/Demo3_1;
      #15 = Utf8               main
      #16 = Utf8               ([Ljava/lang/String;)V
      #17 = Utf8               args
      #18 = Utf8               [Ljava/lang/String;
      #19 = Utf8               a
      #20 = Utf8               I
      #21 = Utf8               b
      #22 = Utf8               c
      #23 = Utf8               SourceFile
      #24 = Utf8               Demo3_1.java
      #25 = NameAndType        #8:#9          // "<init>":()V
      #26 = Utf8               java/lang/Short
      #27 = Class              #33            // java/lang/System
      #28 = NameAndType        #34:#35        // out:Ljava/io/PrintStream;
      #29 = Class              #36            // java/io/PrintStream
      #30 = NameAndType        #37:#38        // println:(I)V
      #31 = Utf8               cn/itcast/jvm/t3/bytecode/Demo3_1
      #32 = Utf8               java/lang/Object
      #33 = Utf8               java/lang/System
      #34 = Utf8               out
      #35 = Utf8               Ljava/io/PrintStream;
      #36 = Utf8               java/io/PrintStream
      #37 = Utf8               println
      #38 = Utf8               (I)V
    {
      public cn.itcast.jvm.t3.bytecode.Demo3_1();
        descriptor: ()V
        flags: ACC_PUBLIC
        Code:
          stack=1, locals=1, args_size=1
             0: aload_0
             1: invokespecial #1                  // Method java/lang/Object."<init>":()V
             4: return
          LineNumberTable:
            line 6: 0
          LocalVariableTable:
            Start  Length  Slot  Name   Signature
                0       5     0  this   Lcn/itcast/jvm/t3/bytecode/Demo3_1;
    
      public static void main(java.lang.String[]);
        descriptor: ([Ljava/lang/String;)V
        flags: ACC_PUBLIC, ACC_STATIC
        Code:
          stack=2, locals=4, args_size=1
             0: bipush        10
             2: istore_1
             3: ldc           #3                  // int 32768
             5: istore_2
             6: iload_1
             7: iload_2
             8: iadd
             9: istore_3
            10: getstatic     #4                  // Field java/lang/System.out:Ljava/io/PrintStream;
            13: iload_3
            14: invokevirtual #5                  // Method java/io/PrintStream.println:(I)V
            17: return
          LineNumberTable:
            line 8: 0
            line 9: 3
            line 10: 6
            line 11: 10
            line 12: 17
          LocalVariableTable:
            Start  Length  Slot  Name   Signature
                0      18     0  args   [Ljava/lang/String;
                3      15     1     a   I
                6      12     2     b   I
               10       8     3     c   I
    }
    SourceFile: "Demo3_1.java"
    

ä¸‹é¢æˆ‘ä»¬é€šè¿‡å›¾è§£æ¥æ‰§è¡Œåº•å±‚ç»“æ„å˜åŒ–ï¼š

1.  **å¸¸é‡æ± è½½å…¥è¿è¡Œæ—¶å¸¸é‡æ± **

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075627141-876410966.png)

2.  **æ–¹æ³•å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒº**

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075631063-1461565938.png)

3.  **main çº¿ç¨‹å¼€å§‹è¿è¡Œï¼Œåˆ†é…æ ˆå¸§å†…å­˜**

    è¿™é‡Œçš„ç»¿è‰²å—å—æ˜¯å±€éƒ¨å˜é‡è¡¨ï¼Œé‡Œé¢ç”¨äºå­˜æ”¾å±€éƒ¨å˜é‡ï¼Œå¤§å°ä¸º4ï¼Œå‰é¢javapæœ‰æ ‡è®°
    è¿™é‡Œçš„é’è‰²å—å—æ˜¯æ“ä½œæ•°æ ˆï¼Œæˆ‘ä»¬çš„æ“ä½œæ•°çš„ä»»ä½•æ“ä½œéƒ½è¦åœ¨é‡Œé¢è¿›è¡Œï¼Œå¤§å°ä¸º2ï¼Œå‰é¢javapæœ‰æ ‡è®°
    

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075635708-985388434.png)

4.  **æ‰§è¡Œæ–¹æ³•bipush 10**

    å°†ä¸€ä¸ª byte å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œç±»ä¼¼çš„æŒ‡ä»¤è¿˜æœ‰:
    
    - sipush å°†ä¸€ä¸ª short å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰
    - ldc å°†ä¸€ä¸ª int å‹å…¥æ“ä½œæ•°æ ˆ
    - ldc2_w å°†ä¸€ä¸ª long å‹å…¥æ“ä½œæ•°æ ˆï¼ˆåˆ†ä¸¤æ¬¡å‹å…¥ï¼Œå› ä¸º long æ˜¯ 8 ä¸ªå­—èŠ‚ï¼‰
    
    è¿™é‡Œå°çš„æ•°å­—éƒ½æ˜¯å’Œå­—èŠ‚ç æŒ‡ä»¤å­˜åœ¨ä¸€èµ·ï¼Œè¶…è¿‡ short èŒƒå›´çš„æ•°å­—å­˜å…¥äº†å¸¸é‡æ± 
    

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075639646-287413053.png)

5.  **æ‰§è¡Œæ–¹æ³•istore\_1**

    å°†æ“ä½œæ•°æ ˆé¡¶æ•°æ®å¼¹å‡ºï¼Œå­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ slot 1
    

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075643836-212346661.png)

6.  **æ‰§è¡Œæ–¹æ³•ldc #3**

    ä»å¸¸é‡æ± åŠ è½½ #3 æ•°æ®åˆ°æ“ä½œæ•°æ ˆ
    æ³¨æ„ Short.MAX_VALUE æ˜¯ 32767ï¼Œæ‰€ä»¥ 32768 = Short.MAX_VALUE + 1 å®é™…æ˜¯åœ¨ç¼–è¯‘æœŸé—´è®¡ç®—å¥½çš„
    

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075648905-2026777343.png)

7.  **æ‰§è¡Œæ–¹æ³•istore\_2**

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075652414-815265490.png)

8.  **æ‰§è¡Œæ–¹æ³•iload\_1 iload\_2**

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075656367-358482041.png)

9.  **æ‰§è¡Œæ–¹æ³•iadd**

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075701259-1948891986.png)

10.  **æ‰§è¡Œæ–¹æ³•istore\_3**

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075706130-1462186672.png)

11.  **æ‰§è¡Œæ–¹æ³•getstatic #4**

    è¿™é‡Œéœ€è¦æ³¨æ„getstaticå¼•ç”¨äº†å¸¸é‡æ± é‡Œå­˜æ”¾çš„System.outçš„å¼•ç”¨å¯¹è±¡åœ°å€
    ç„¶åæˆ‘ä»¬åˆ°å †é‡Œå»å¯»æ‰¾è¯¥å¯¹è±¡ï¼Œæ‰¾åˆ°è¯¥å¯¹è±¡åå°†è¯¥å¯¹è±¡çš„å¼•ç”¨æ”¾åˆ°æ“ä½œæ•°æ ˆä¸­è¿›è¡Œæ“ä½œ
    

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075710535-1637833320.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075713758-839678014.png)

12.  **æ‰§è¡Œæ–¹æ³•iload\_3**

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075718795-1515506687.png)

13.  **æ‰§è¡Œæ–¹æ³•invokevirtual #5**

    ç¬¬ä¸€æ­¥æ“ä½œï¼š
    æ‰¾åˆ°å¸¸é‡æ±  #5 é¡¹
    å®šä½åˆ°æ–¹æ³•åŒº java/io/PrintStream.println:(I)V æ–¹æ³•
    ç”Ÿæˆæ–°çš„æ ˆå¸§ï¼ˆåˆ†é… localsã€stackç­‰ï¼‰
    ä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œæ–°æ ˆå¸§ä¸­çš„å­—èŠ‚ç 
    
    ç¬¬äºŒæ­¥æ“ä½œï¼š
    æ‰§è¡Œå®Œæ¯•ï¼Œå¼¹å‡ºæ ˆå¸§
    æ¸…é™¤ main æ“ä½œæ•°æ ˆå†…å®¹
    

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075726384-1482818565.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075731952-970368325.png)

14.  **æ‰§è¡Œæ–¹æ³•return**

    å®Œæˆ main æ–¹æ³•è°ƒç”¨ï¼Œå¼¹å‡º main æ ˆå¸§
    ç¨‹åºç»“æŸ
    

### æ–¹æ³•i++åº•å±‚å®ç°

ç›®çš„ï¼š

*   ä»å­—èŠ‚ç è§’åº¦åˆ†æ a++ ç›¸å…³é¢˜ç›®

æºç ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    /**
     * ä»å­—èŠ‚ç è§’åº¦åˆ†æã€€a++  ç›¸å…³é¢˜ç›®
     */
    public class Demo3_2 {
        public static void main(String[] args) {
            int a = 10;
            int b = a++ + ++a + a--;
            System.out.println(a);
            System.out.println(b);
        }
    }
    

å­—èŠ‚ç ï¼š

    Classfile /E:/ç¼–ç¨‹å†…å®¹/JVM/èµ„æ–™-è§£å¯†JVM/ä»£ç /jvm/out/production/jvm/cn/itcast/jvm/t3/bytecode/Demo3_2.class
      Last modified 2022-11-2; size 610 bytes
      MD5 checksum 5f6a35e5b9bb88d08249958a8d2ab043
      Compiled from "Demo3_2.java"
    public class cn.itcast.jvm.t3.bytecode.Demo3_2
      minor version: 0
      major version: 52
      flags: ACC_PUBLIC, ACC_SUPER
    Constant pool:
       #1 = Methodref          #5.#22         // java/lang/Object."<init>":()V
       #2 = Fieldref           #23.#24        // java/lang/System.out:Ljava/io/PrintStream;
       #3 = Methodref          #25.#26        // java/io/PrintStream.println:(I)V
       #4 = Class              #27            // cn/itcast/jvm/t3/bytecode/Demo3_2
       #5 = Class              #28            // java/lang/Object
       #6 = Utf8               <init>
       #7 = Utf8               ()V
       #8 = Utf8               Code
       #9 = Utf8               LineNumberTable
      #10 = Utf8               LocalVariableTable
      #11 = Utf8               this
      #12 = Utf8               Lcn/itcast/jvm/t3/bytecode/Demo3_2;
      #13 = Utf8               main
      #14 = Utf8               ([Ljava/lang/String;)V
      #15 = Utf8               args
      #16 = Utf8               [Ljava/lang/String;
      #17 = Utf8               a
      #18 = Utf8               I
      #19 = Utf8               b
      #20 = Utf8               SourceFile
      #21 = Utf8               Demo3_2.java
      #22 = NameAndType        #6:#7          // "<init>":()V
      #23 = Class              #29            // java/lang/System
      #24 = NameAndType        #30:#31        // out:Ljava/io/PrintStream;
      #25 = Class              #32            // java/io/PrintStream
      #26 = NameAndType        #33:#34        // println:(I)V
      #27 = Utf8               cn/itcast/jvm/t3/bytecode/Demo3_2
      #28 = Utf8               java/lang/Object
      #29 = Utf8               java/lang/System
      #30 = Utf8               out
      #31 = Utf8               Ljava/io/PrintStream;
      #32 = Utf8               java/io/PrintStream
      #33 = Utf8               println
      #34 = Utf8               (I)V
    {
      public cn.itcast.jvm.t3.bytecode.Demo3_2();
        descriptor: ()V
        flags: ACC_PUBLIC
        Code:
          stack=1, locals=1, args_size=1
             0: aload_0
             1: invokespecial #1                  // Method java/lang/Object."<init>":()V
             4: return
          LineNumberTable:
            line 6: 0
          LocalVariableTable:
            Start  Length  Slot  Name   Signature
                0       5     0  this   Lcn/itcast/jvm/t3/bytecode/Demo3_2;
    
      public static void main(java.lang.String[]);
        descriptor: ([Ljava/lang/String;)V
        flags: ACC_PUBLIC, ACC_STATIC
        Code:
          stack=2, locals=3, args_size=1
             0: bipush        10
             2: istore_1
             3: iload_1
             4: iinc          1, 1
             7: iinc          1, 1
            10: iload_1
            11: iadd
            12: iload_1
            13: iinc          1, -1
            16: iadd
            17: istore_2
            18: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;
            21: iload_1
            22: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V
            25: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;
            28: iload_2
            29: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V
            32: return
          LineNumberTable:
            line 8: 0
            line 9: 3
            line 10: 18
            line 11: 25
            line 12: 32
          LocalVariableTable:
            Start  Length  Slot  Name   Signature
                0      33     0  args   [Ljava/lang/String;
                3      30     1     a   I
               18      15     2     b   I
    }
    SourceFile: "Demo3_2.java"
    

ç›¸å…³çŸ¥è¯†ç‚¹è¡¥å……ï¼š

    // æ³¨æ„ iinc æŒ‡ä»¤æ˜¯ç›´æ¥åœ¨å±€éƒ¨å˜é‡ slot ä¸Šè¿›è¡Œè¿ç®—
    // a++å’Œ++açš„åŒºåˆ«æ˜¯å…ˆæ‰§è¡Œ iload è¿˜æ˜¯ å…ˆæ‰§è¡Œ iinc
    // a++ å…ˆæ‰§è¡Œiload
    // ++a å…ˆæ‰§è¡Œiinc
    

ç›¸å…³å›¾ç¤ºå±•ç¤ºï¼š

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075742015-1323857431.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075745517-1704464648.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075749171-1787067302.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075752578-578777337.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075755749-757776243.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075759963-798298115.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075804165-220818114.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075807645-770521803.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075811277-1907396994.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075815128-1592753347.png)

![](https://img2022.cnblogs.com/blog/2886527/202211/2886527-20221106075822206-92717566.png)

### æ¡ä»¶åˆ¤æ–­æŒ‡ä»¤

é¦–å…ˆæˆ‘ä»¬ç»™å‡ºæ¡ä»¶åˆ¤æ–­çš„ç›¸å…³æŒ‡ä»¤é›†åˆï¼š

æŒ‡ä»¤

åŠ©è®°ç¬¦

å«ä¹‰

0x99

ifeq

åˆ¤æ–­æ˜¯å¦ == 0

0x9a

ifne

åˆ¤æ–­æ˜¯å¦ != 0

0x9b

iflt

åˆ¤æ–­æ˜¯å¦ < 0

0x9c

ifge

åˆ¤æ–­æ˜¯å¦ >= 0

0x9d

ifgt

åˆ¤æ–­æ˜¯å¦ > 0

0x9e

ifle

åˆ¤æ–­æ˜¯å¦ <= 0

0x9f

if\_icmpeq

ä¸¤ä¸ªintæ˜¯å¦ ==

0xa0

if\_icmpne

ä¸¤ä¸ªintæ˜¯å¦ !=

0xa1

if\_icmplt

ä¸¤ä¸ªintæ˜¯å¦ <

0xa2

if\_icmpge

ä¸¤ä¸ªintæ˜¯å¦ >=

0xa3

if\_icmpgt

ä¸¤ä¸ªintæ˜¯å¦ >

0xa4

if\_icmple

ä¸¤ä¸ªintæ˜¯å¦ <=

0xa5

if\_acmpeq

ä¸¤ä¸ªå¼•ç”¨æ˜¯å¦ ==

0xa6

if\_acmpne

ä¸¤ä¸ªå¼•ç”¨æ˜¯å¦ !=

0xc6

ifnull

åˆ¤æ–­æ˜¯å¦ == null

0xc7

ifnonnull

åˆ¤æ–­æ˜¯å¦ != null

æˆ‘ä»¬å¯¹ä¸Šè¿°å†…å®¹åšç®€å•è¯´æ˜ï¼š

*   byteï¼Œshortï¼Œchar éƒ½ä¼šæŒ‰ int æ¯”è¾ƒï¼Œå› ä¸ºæ“ä½œæ•°æ ˆéƒ½æ˜¯ 4 å­—èŠ‚
*   goto ç”¨æ¥è¿›è¡Œè·³è½¬åˆ°æŒ‡å®šè¡Œå·çš„å­—èŠ‚ç 

æºç ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    public class Demo3_3 {
        public static void main(String[] args) {
            int a = 0;
            if(a == 0) {
                a = 10;
            } else {
                a = 20;
            }
        }
    }
    

æˆ‘ä»¬å°†é‡è¦çš„å­—èŠ‚ç å†…å®¹å•ç‹¬è°ƒä¸‹æ¥è®²è§£ï¼š

    // äº§ç”Ÿä¸€ä¸ª0
    0: iconst_0
    // æ”¾å…¥åˆ°å±€éƒ¨å˜é‡æ± 
    1: istore_1
    // å–å‡º0    
    2: iload_1
    // ifne:åˆ¤æ–­æ˜¯å¦ != 0
    // è¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸ä¸º0ï¼Œå¦‚æœä¸ä¸º0ç›´æ¥è·³è½¬12ï¼Œå¦‚æœä¸æ˜¯ç»§ç»­æ‰§è¡Œ
    3: ifne 12
    // æ”¾å…¥ä¸€ä¸ª10ï¼Œç„¶åå­˜å…¥åˆ°åŸæœ¬açš„ä½ç½®
    6: bipush 10
    8: istore_1
    // ç›´æ¥è·³è½¬åˆ°return
    9: goto 15
    // è¿™é‡Œæ˜¯å¦‚æœä¸ä¸º0çš„é€»è¾‘ï¼šæ”¾å…¥ä¸€ä¸ª20ç„¶åå­˜åˆ°açš„ä½ç½®
    12: bipush 20
    14: istore_1
    // ä»£ç ç»“æŸ
    15: return
    

### å¾ªç¯æ§åˆ¶æŒ‡ä»¤

æˆ‘ä»¬å¾ªç¯æ§åˆ¶æŒ‡ä»¤å®é™…ä¸Šè¿˜æ˜¯é‡‡ç”¨æ¡ä»¶åˆ¤æ–­è¯­å¥çš„æŒ‡ä»¤è¿›è¡Œæ“ä½œ

whileæºç ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    public class Demo3_4 {
        public static void main(String[] args) {
            int a = 0;
            while (a < 10) {
                a++;
            }
        }
    }
    

æˆ‘ä»¬å°†whileä¸­é‡è¦çš„å­—èŠ‚ç å†…å®¹å•ç‹¬è°ƒä¸‹æ¥è®²è§£ï¼š

    0: iconst_0
    1: istore_1
    // é¦–å…ˆå–å‡ºaçš„å€¼ï¼Œå†æ”¾å…¥ä¸€ä¸ª10ï¼Œç„¶åé‡‡ç”¨if_icmpgeåˆ¤æ–­aæ˜¯å¦>=10ï¼Œå¦‚æœæ˜¯è·³è½¬returnç»“æŸï¼Œå¦‚æœä¸æ˜¯æ‰§è¡Œä¸‹è¿°æ“ä½œ
    2: iload_1
    3: bipush 10
    5: if_icmpge 14
    // è¿™é‡Œæ˜¯è‡ªåŠ æ“ä½œï¼Œæ³¨æ„æ˜¯åœ¨å±€éƒ¨å˜é‡ä¸­æ‰§è¡Œï¼Œè¿™æ—¶å±€éƒ¨å˜é‡çš„a+1ï¼Œä½†æ˜¯æ“ä½œæ•°æ ˆçš„aå€¼æœªå‘ç”Ÿå˜åŒ–
    8: iinc 1, 1
    // æˆ‘ä»¬å›åˆ°2æ“ä½œï¼Œé‡æ–°å–aï¼Œå–10ï¼Œå¹¶å†æ¬¡è¿›è¡Œæ¯”è¾ƒ
    11: goto 2
    14: return
    

dowhileæºç ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    public class Demo3_5 {
        public static void main(String[] args) {
            int a = 0;
            do {
                a++;
            } while (a < 10);
        }
    }
    

æˆ‘ä»¬å°†dowhileä¸­é‡è¦çš„å­—èŠ‚ç å†…å®¹å•ç‹¬è°ƒä¸‹æ¥è®²è§£ï¼š

    0: iconst_0
    1: istore_1
    // æˆ‘ä»¬é¦–å…ˆå¯¹açš„å€¼è¿›è¡Œä¸€æ¬¡è‡ªåŠ æ“ä½œï¼Œç„¶åå†å–aå’Œ10
    2: iinc 1, 1
    5: iload_1
    6: bipush 10
    // åœ¨è¿™é‡Œè¿›è¡Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœç¬¦åˆæ¡ä»¶å°±å›åˆ°ç¬¬äºŒæ­¥ä¸æ–­é‡å¤
    8: if_icmplt 2
    11: return
    

foræºç ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    public class Demo3_6 {
        public static void main(String[] args) {
            for (int i = 0; i < 10; i++) {
    
            }
        }
    }
    

æˆ‘ä»¬å°†forä¸­é‡è¦çš„å­—èŠ‚ç å†…å®¹å•ç‹¬è°ƒä¸‹æ¥è®²è§£ï¼š

    // æˆ‘ä»¬ä¼šå‘ç°forå’Œwhileçš„æºç æ˜¯å®Œå…¨ä¸€è‡´çš„~
    0: iconst_0
    1: istore_1
    2: iload_1
    3: bipush 10
    5: if_icmpge 14
    8: iinc 1, 1
    11: goto 2
    14: return
    

### æ„é€ æ–¹æ³•

æˆ‘ä»¬å…ˆæ¥ä»‹ç»æ„é€ æ–¹æ³•çš„æ„é€ åŸç†ï¼š

*   ç¼–è¯‘å™¨ä¼šæŒ‰ä»ä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ static é™æ€ä»£ç å—å’Œé™æ€æˆå‘˜èµ‹å€¼çš„ä»£ç ï¼Œåˆå¹¶ä¸ºä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³• <cinit>()V
*   <cinit>()V æ–¹æ³•ä¼šåœ¨ç±»åŠ è½½çš„åˆå§‹åŒ–é˜¶æ®µè¢«è°ƒç”¨ ï¼Œä½†åŸå§‹æ„é€ æ–¹æ³•<init>()V å†…çš„ä»£ç æ€»æ˜¯åœ¨æœ€å

é¦–å…ˆæˆ‘ä»¬æ¥ä»‹ç»ç±»çš„æ„é€ æ–¹æ³•ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    public class Demo3_8_1 {
    
    	static int i = 10;
        
        static {
            i = 20;
        }
    
    
        static {
            i = 30;
        }
    
        
    
        public static void main(String[] args) {
            System.out.println(Demo3_8_1.i);
        }
    }
    

ç„¶åæˆ‘ä»¬æŸ¥çœ‹é‡è¦çš„å­—èŠ‚ç éƒ¨åˆ†:

    // è¿™é‡Œé¦–å…ˆå°†æœ€ä¸Šé¢çš„æ„é€ è¯­å¥static int i = 10;è¯»å–ï¼Œå¹¶è¾“å…¥10ä¸ºiçš„å€¼
    0: bipush 10
    2: putstatic #2 // Field i:I
    // è¿™é‡Œå°†ä¸­é—´çš„æ„é€ æ–¹æ³•è¯»å–ï¼Œi=20
    5: bipush 20
    7: putstatic #2 // Field i:I
    // è¿™é‡Œå°†æœ€åçš„æ„é€ æ–¹æ³•è¯»å–ï¼Œi=30
    10: bipush 30
    12: putstatic #2 // Field i:I
    // æ‰€ä»¥æœ€åæˆ‘ä»¬çš„ç±»ä¸­çš„iä¸º30
    15: return
    

ç„¶ååŒç†æˆ‘ä»¬æ¥æŸ¥çœ‹å­˜åœ¨åŸå§‹æ„é€ æ–¹æ³•çš„ç±»ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    public class Demo3_8_2 {
    
    
        private String a = "s1";
    
        {
            b = 20;
        }
    
        private int b = 10;
    
        {
            a = "s2";
        }
    
        // è¿™ä¸ªå°±æ˜¯åŸå§‹æ„é€ æ–¹æ³•
        public Demo3_8_2(String a, int b) {
            this.a = a;
            this.b = b;
        }
    
        public static void main(String[] args) {
            Demo3_8_2 d = new Demo3_8_2("s3", 30);
            System.out.println(d.a);
            System.out.println(d.b);
        }
    }
    

æˆ‘ä»¬æ¥æŸ¥çœ‹é‡è¦çš„å­—èŠ‚ç éƒ¨åˆ†ï¼š

    // é¦–å…ˆä»–ä»¬è°ƒç”¨äº† super.<init>()Vï¼Œåˆ†åˆ«æŒ‰é¡ºåºç»™abè¿›è¡Œèµ‹å€¼
    0: aload_0
    1: invokespecial #1 // super.<init>()V
    4: aload_0
    5: ldc #2 // <- "s1"
    7: putfield #3 // -> this.a
    10: aload_0
    11: bipush 20 // <- 20
    13: putfield #4 // -> this.b
    16: aload_0
    17: bipush 10 // <- 10
    19: putfield #4 // -> this.b
    22: aload_0
    23: ldc #5 // <- "s2"
        
    // ä½†æ˜¯åé¢ä»–ä»¬è°ƒç”¨äº†åŸå§‹æ„é€ æ–¹æ³•ï¼Œå°†ä¼ è¿›æ¥çš„å‚æ•°å€¼ä½œä¸ºaï¼Œbçš„å€¼èµ‹å€¼
    25: putfield #3 // -> this.a
    28: aload_0 // ------------------------------
    29: aload_1 // <- slot 1(a) "s3" |
    30: putfield #3 // -> this.a |
    33: aload_0 |
    34: iload_2 // <- slot 2(b) 30 |
    35: putfield #4 // -> this.b --------------------
    38: return
    

### æ–¹æ³•è°ƒç”¨

æˆ‘ä»¬é¦–å…ˆç»™å‡ºä¸€äº›æ–¹æ³•å’Œæ–¹æ³•è°ƒç”¨ç¤ºä¾‹ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    public class Demo3_9 {
        
        // æ„é€ æ–¹æ³•
        public Demo3_9() { }
    
        // ç§æœ‰æ–¹æ³•
        private void test1() { }
    
        // æ— æ³•æ”¹å˜çš„ç§æœ‰æ–¹æ³•
        private final void test2() { }
    
        // å…¬å¼€æ–¹æ³•
        public void test3() { }
    
        // é™æ€å…¬å¼€æ–¹æ³•
        public static void test4() { }
    
        // ç»§æ‰¿toStringæ–¹æ³•
        @Override
        public String toString() {
            return super.toString();
        }
    
        // å„ç§ç¤ºä¾‹å±•ç¤º
        public static void main(String[] args) {
            Demo3_9 d = new Demo3_9();
            d.test1();
            d.test2();
            d.test3();
            d.test4();
            Demo3_9.test4();
            d.toString();
        }
    
    }
    

æˆ‘ä»¬æ¥æŸ¥çœ‹å…¶å­—èŠ‚ç ï¼š

    0: new #2 // class cn/itcast/jvm/t3/bytecode/Demo3_9
    3: dup
    4: invokespecial #3 // Method "<init>":()V
    7: astore_1
    8: aload_1
    9: invokespecial #4 // Method test1:()V
    12: aload_1
    13: invokespecial #5 // Method test2:()V
    16: aload_1
    17: invokevirtual #6 // Method test3:()V
    20: aload_1
    21: pop
    22: invokestatic #7 // Method test4:()V
    25: invokestatic #7 // Method test4:()V
    28: return
    

æˆ‘ä»¬å¯¹å…¶è¿›è¡Œè§£é‡Šï¼š

*   new æ˜¯åˆ›å»ºã€å¯¹è±¡ã€‘ï¼Œç»™å¯¹è±¡åˆ†é…å †å†…å­˜ï¼Œæ‰§è¡ŒæˆåŠŸä¼šå°†ã€å¯¹è±¡å¼•ç”¨ã€‘å‹å…¥æ“ä½œæ•°æ ˆ
    
*   dup æ˜¯èµ‹å€¼æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å†…å®¹ï¼Œæœ¬ä¾‹å³ä¸ºã€å¯¹è±¡å¼•ç”¨ã€‘ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä»½å¼•ç”¨å‘¢
    
*   ä¸€ä¸ªæ˜¯è¦é…åˆ invokespecial è°ƒç”¨è¯¥å¯¹è±¡çš„æ„é€ æ–¹æ³• "<init>"ğŸ˜¦)V ï¼ˆä¼šæ¶ˆè€—æ‰æ ˆé¡¶ä¸€ä¸ªå¼•ç”¨)
    
*   å¦ä¸€ä¸ªè¦é…åˆ astore\_1 èµ‹å€¼ç»™å±€éƒ¨å˜é‡
    
*   æœ€ç»ˆæ–¹æ³•ï¼ˆfinalï¼‰ï¼Œç§æœ‰æ–¹æ³•ï¼ˆprivateï¼‰ï¼Œæ„é€ æ–¹æ³•éƒ½æ˜¯ç”± invokespecial æŒ‡ä»¤æ¥è°ƒç”¨ï¼Œå±äºé™æ€ç»‘å®š
    
*   æ™®é€šæˆå‘˜æ–¹æ³•æ˜¯ç”± invokevirtual è°ƒç”¨ï¼Œå±äºåŠ¨æ€ç»‘å®šï¼Œå³æ”¯æŒå¤šæ€
    
*   æˆå‘˜æ–¹æ³•ä¸é™æ€æ–¹æ³•è°ƒç”¨çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œæ‰§è¡Œæ–¹æ³•å‰æ˜¯å¦éœ€è¦ã€å¯¹è±¡å¼•ç”¨ã€‘
    
*   d.test4()æ˜¯é€šè¿‡å¯¹è±¡å¼•ç”¨è°ƒç”¨ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä½†åœ¨è°ƒç”¨invokestatic ä¹‹å‰æ‰§è¡Œäº† pop æŒ‡ä»¤ï¼ŒæŠŠå¯¹è±¡å¼•ç”¨ä»æ“ä½œæ•°æ ˆå¼¹æ‰äº†
    
*   è¿˜æœ‰ä¸€ä¸ªæ‰§è¡Œ invokespecial çš„æƒ…å†µæ˜¯é€šè¿‡ super è°ƒç”¨çˆ¶ç±»æ–¹æ³•
    

### å¼‚å¸¸å¤„ç†

æˆ‘ä»¬åŒæ ·é¦–å…ˆç»™å‡ºå¼‚å¸¸å¤„ç†çš„ä»£ç ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    public class Demo3_11_1 {
    
        public static void main(String[] args) {
            int i = 0;
            try {
                i = 10;
            } catch (Exception e) {
                i = 20;
            }
        }
    }
    

æˆ‘ä»¬ç»™å‡ºé‡è¦çš„å­—èŠ‚ç éƒ¨åˆ†ï¼š

    {
    public static void main(java.lang.String[]);
        descriptor: ([Ljava/lang/String;)V
        flags: ACC_PUBLIC, ACC_STATIC
        Code:
          stack=1, locals=3, args_size=1
             0: iconst_0
             1: istore_1
             // é¦–å…ˆè¿™é‡Œæ˜¯tryï¼Œå°†10èµ‹ç»™i
             2: bipush        10
             4: istore_1
             // å†å¾€ä¸‹æ˜¯catchä»£ç ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æ‰§è¡Œï¼Œæ‰€ä»¥ç›´æ¥é‡‡ç”¨gotoè·³è½¬åˆ°return
             5: goto          12
             // è¿™é‡Œå­˜æ”¾catchä»£ç ï¼Œå¦‚æœæ£€æµ‹åˆ°é”™è¯¯ï¼Œå°±ä¼šè·³è½¬åˆ°è¿™é‡Œæ‰§è¡Œ
             8: astore_2
             9: bipush        20
            11: istore_1
            12: return
          // é¦–å…ˆè¿™ä¸ªåœ°æ–¹å¤šäº†ä¸€ä¸ªå¼‚å¸¸å¤„ç†æœºåˆ¶fromå’Œtoæ˜¯ä½œç”¨èŒƒå›´ï¼Œè¿™é‡Œæ˜¯[)å½¢å¼çš„
          // æ­¤å¤–targetè¡¨ç¤ºè·³è½¬è¡Œæ•°ï¼Œtypeè¡¨ç¤ºé‡åˆ°ä»€ä¹ˆæ ·çš„é”™è¯¯
          // ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ï¼Œä¸éœ€è¦åœ¨ä¸Šè¿°é‡å¤ä¹¦å†™
          Exception table:
             from    to  target type
                 2     5     8   Class java/lang/Exception
          // Exceptionä¹Ÿä¼šè¢«çœ‹ä½œå¯¹è±¡ï¼Œè¿™é‡Œéœ€è¦è¿›è¡Œå­˜æ”¾
          LocalVariableTable:
            Start  Length  Slot  Name   Signature
               23       3     2     e   Ljava/lang/Exception;
                0      27     0  args   [Ljava/lang/String;
                2      25     1     i   I
    }
    

å½“ç„¶é’ˆå¯¹å¤šä¸ªå¼‚å¸¸å¤„ç†ï¼Œæˆ‘ä»¬åŒæ ·é‡‡ç”¨è¿™ç§æ–¹å¼ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    public class Demo3_11_2 {
    
        public static void main(String[] args) {
            int i = 0;
            try {
                i = 10;
            } catch (ArithmeticException e) {
                i = 30;
            } catch (NullPointerException e) {
                i = 40;
            } catch (Exception e) {
                i = 50;
            }
        }
    
    }
    
    

æˆ‘ä»¬ç»™å‡ºéƒ¨åˆ†é‡è¦å­—èŠ‚ç ï¼š

      public static void main(java.lang.String[]);
        descriptor: ([Ljava/lang/String;)V
        flags: ACC_PUBLIC, ACC_STATIC
        Code:
          stack=1, locals=3, args_size=1
             0: iconst_0
             1: istore_1
             2: bipush        10
             4: istore_1
             5: goto          26
             8: astore_2
             9: bipush        30
            11: istore_1
            12: goto          26
            15: astore_2
            16: bipush        40
            18: istore_1
            19: goto          26
            22: astore_2
            23: bipush        50
            25: istore_1
            26: return
          // æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¼‚å¸¸å¤„ç†è¡¨ä¸­å‡ºç°äº†å…¶ä»–å¼‚å¸¸çš„å¤„ç†ä¿¡æ¯
          Exception table:
             from    to  target type
                 2     5     8   Class java/lang/ArithmeticException
                 2     5    15   Class java/lang/NullPointerException
                 2     5    22   Class java/lang/Exception
          // åŒæ—¶å±€éƒ¨å˜é‡è¡¨ä¸­ä¹Ÿä¼šæœ‰å¼‚å¸¸Exceptionçš„å­˜æ”¾ä½ç½®ï¼Œè¿™é‡Œç”±äºå¼‚å¸¸åœ¨åŒä¸€å¤„ï¼Œä¸ä¼šåŒæ—¶å‡ºç°ï¼Œæ‰€ä»¥æ”¾åœ¨åŒä¸€ä¸ªå±€éƒ¨å˜é‡å³å¯
          LocalVariableTable:
            Start  Length  Slot  Name   Signature
                9       3     2     e   Ljava/lang/ArithmeticException;
               16       3     2     e   Ljava/lang/NullPointerException;
               23       3     2     e   Ljava/lang/Exception;
                0      27     0  args   [Ljava/lang/String;
                2      25     1     i   I
    }
    

é’ˆå¯¹multi-catch çš„æƒ…å†µç³»ç»Ÿçš„å¤„ç†æ–¹æ³•ä¹Ÿå¤§åŒå°å¼‚ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    import java.lang.reflect.InvocationTargetException;
    import java.lang.reflect.Method;
    
    public class Demo3_11_3 {
    
        public static void main(String[] args) {
            try {
                Method test = Demo3_11_3.class.getMethod("test");
                test.invoke(null);
            } catch (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {
                e.printStackTrace();
            }
        }
    
        public static void test() {
            System.out.println("ok");
        }
    }
    

æˆ‘ä»¬ç»™å‡ºéƒ¨åˆ†é‡è¦å­—èŠ‚ç ï¼š

      public static void main(java.lang.String[]);
        descriptor: ([Ljava/lang/String;)V
        flags: ACC_PUBLIC, ACC_STATIC
        Code:
          stack=3, locals=2, args_size=1
             0: ldc           #2                  // class cn/itcast/jvm/t3/bytecode/Demo3_11_3
             2: ldc           #3                  // String test
             4: iconst_0
             5: anewarray     #4                  // class java/lang/Class
             8: invokevirtual #5                  // Method java/lang/Class.getMethod:(Ljava/lang/String;[Ljava/lang/Class;)Ljava/lang/reflect/Method;
            11: astore_1
            12: aload_1
            13: aconst_null
            14: iconst_0
            15: anewarray     #6                  // class java/lang/Object
            18: invokevirtual #7                  // Method java/lang/reflect/Method.invoke:(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;
            21: pop
            22: goto          30
            25: astore_1
            26: aload_1
            27: invokevirtual #11                 // Method java/lang/ReflectiveOperationException.printStackTrace:()V
            30: return
          Exception table:
             from    to  target type
                 0    22    25   Class java/lang/NoSuchMethodException
                 0    22    25   Class java/lang/IllegalAccessException
                 0    22    25   Class java/lang/reflect/InvocationTargetException
          // è¿™é‡Œæ³¨æ„åªæ ‡æœ‰ä¸€ä¸ªå‘ä½äº†ï¼Œæ‰€ä»¥æŸç§æ„ä¹‰ä¸Šæ˜¯èŠ‚çœå†…å­˜äº†~
          LocalVariableTable:
            Start  Length  Slot  Name   Signature
               12      10     1  test   Ljava/lang/reflect/Method;
               26       4     1     e   Ljava/lang/ReflectiveOperationException;
                0      31     0  args   [Ljava/lang/String;
    }
    

æœ€åæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹finallyæ“ä½œï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    public class Demo3_11_4 {
    
        public static void main(String[] args) {
            int i = 0;
            try {
                i = 10;
            } catch (Exception e) {
                i = 20;
            } finally {
                i = 30;
            }
        }
    }
    

æˆ‘ä»¬æŸ¥çœ‹éƒ¨åˆ†é‡è¦å­—èŠ‚ç ï¼š

      public static void main(java.lang.String[]);
        descriptor: ([Ljava/lang/String;)V
        flags: ACC_PUBLIC, ACC_STATIC
        Code:
          stack=1, locals=4, args_size=1
             // å‰ç«¯çš„ä»£ç æ˜¾å¾—ç®€å•ç²—æš´
             // å°±æ˜¯åœ¨tryé˜¶æ®µæ‰§è¡Œä¸€æ¬¡finallyæ“ä½œï¼Œç›´æ¥èµ‹å€¼ä¸€ä»½åœ¨catchæ“ä½œé‡Œé¢æ‰§è¡Œfinallyæ“ä½œï¼Œæœ€åå†æ”¾ä¸€ä»½finallyåœ¨æœ€å
             // ä¹Ÿå°±æ˜¯è¯´finallyä¸€å…±æœ‰ä¸‰ä»½ï¼Œç¬¬ä¸€ä»½åœ¨tryï¼Œç¬¬äºŒä»½åœ¨catchï¼Œç¬¬ä¸‰ä»½å•ç‹¬å­˜æ”¾é˜²æ­¢å‰é¢å‡ºç°å¼‚å¸¸åˆ™ç›´æ¥æ‰§è¡Œ
             0: iconst_0
             1: istore_1
             2: bipush        10
             4: istore_1
             5: bipush        30
             7: istore_1
             8: goto          27
            11: astore_2
            12: bipush        20
            14: istore_1
            15: bipush        30
            17: istore_1
            18: goto          27
            21: astore_3
            22: bipush        30
            24: istore_1
            25: aload_3
            26: athrow
            27: return
          // é‡ç‚¹åœ¨è¿™é‡Œï¼å› ä¸ºtryå’Œcatchæ“ä½œéƒ½æœ‰å¯èƒ½å‡ºç°å¼‚å¸¸ï¼Œæ‰€ä»¥æ·»åŠ äº†ä¸¤ä¸ªå¼‚å¸¸ï¼Œå¦‚æœå‘ç°å¼‚å¸¸ï¼Œç›´æ¥è·³åˆ°ç‹¬æœ‰çš„fianllyæ“ä½œé‡Œæ‰§è¡Œ
          Exception table:
             from    to  target type
                 2     5    11   Class java/lang/Exception
                 2     5    21   any
                11    15    21   any
    		// è¿™é‡ŒåŒæ ·æ˜¯å¼‚å¸¸å ä½
          LocalVariableTable:
            Start  Length  Slot  Name   Signature
               12       3     2     e   Ljava/lang/Exception;
                0      28     0  args   [Ljava/lang/String;
                2      26     1     i   I
    }
    

### åŠ é”å¤„ç†

æœ€åæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹synchronizedçš„å¤„ç†é—®é¢˜ï¼š

    package cn.itcast.jvm.t3.bytecode;
    
    public class Demo3_13 {
    
        public static void main(String[] args) {
            Object lock = new Object();
            synchronized (lock) {
                System.out.println("ok");
            }
        }
    }
    

æˆ‘ä»¬åŒæ ·ç»™å‡ºé‡è¦çš„å­—èŠ‚ç éƒ¨åˆ†ï¼š

      public static void main(java.lang.String[]);
        descriptor: ([Ljava/lang/String;)V
        flags: ACC_PUBLIC, ACC_STATIC
        Code:
          stack=2, locals=4, args_size=1
             0: new           #2                  // new Object
             3: dup
             4: invokespecial #1                  // invokespecial <init>:()V
             7: astore_1						  // lockå¼•ç”¨ -> lock
             8: aload_1							  // <- lock ï¼ˆsynchronizedå¼€å§‹ï¼‰
             9: dup
            10: astore_2						  // lockå¼•ç”¨ -> slot 2
            11: monitorenter					  // monitorenter(lockå¼•ç”¨)
            12: getstatic     #3                  // <- System.out
            15: ldc           #4                  // <- "ok"
            17: invokevirtual #5                  // invokevirtual println:(Ljava/lang/String;)V
            20: aload_2							  // <- slot 2(lockå¼•ç”¨)
            21: monitorexit						  // monitorexit(lockå¼•ç”¨)
            22: goto          30
            25: astore_3						  // any -> slot 3
            26: aload_2							  // <- slot 2(lockå¼•ç”¨)
            27: monitorexit						  // monitorexit(lockå¼•ç”¨)
            28: aload_3
            29: athrow
            30: return
          Exception table:
             from    to  target type
                12    22    25   any
                25    28    25   any
          LocalVariableTable:
            Start  Length  Slot  Name   Signature
                0      31     0  args   [Ljava/lang/String;
                8      23     1  lock   Ljava/lang/Object;
    }
    

ç¼–è¯‘æœŸå¤„ç†
-----

è¿™ä¸€èŠ‚æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»ç¼–è¯‘æœŸJVMä¸ºæˆ‘ä»¬åšçš„ç®€å•å¤„ç†

### è¯­æ³•ç³–ä»‹ç»

é¦–å…ˆæˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹è¯­æ³•ç³–çš„æ¦‚å¿µï¼š

*   æ‰€è°“çš„è¯­æ³•ç³–ï¼Œå…¶å®å°±æ˜¯æŒ‡ java ç¼–è¯‘å™¨æŠŠ \*.java æºç ç¼–è¯‘ä¸º \*.class å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨ç”Ÿæˆå’Œè½¬æ¢çš„ä¸€äº›ä»£ç 
*   ç›¸å½“äºåœ¨JVMçš„åŸç‰ˆæœ¬çš„ä¸€äº›æ’ä»¶ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç¼–è¯‘

æˆ‘ä»¬ä¸‹é¢æ‰€ä»‹ç»çš„ç¼–è¯‘æœŸå¤„ç†åŸºæœ¬éƒ½æ˜¯è¯­æ³•ç³–çš„å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ï¼š

*   ä»¥ä¸‹ä»£ç çš„åˆ†æï¼Œå€ŸåŠ©äº† javap å·¥å…·ï¼Œidea çš„åç¼–è¯‘åŠŸèƒ½ï¼Œidea æ’ä»¶ jclasslib ç­‰å·¥å…·ã€‚
*   ç¼–è¯‘å™¨è½¬æ¢çš„ç»“æœç›´æ¥å°±æ˜¯ class å­—èŠ‚ç ï¼Œåªæ˜¯ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œç»™å‡ºäº†ç­‰ä»· çš„ java æºç æ–¹å¼

### é»˜è®¤æ„é€ å™¨

é¦–å…ˆæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬çš„ç±»æ²¡æœ‰ä¹¦å†™æ„é€ å™¨ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬è¡¥å……ä¸€ä¸ªæ„é€ å™¨

é¦–å…ˆè¿™æ˜¯æˆ‘ä»¬çš„æºç ï¼š

    public class Candy1 {
    }
    

ç„¶åç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸæ‰€åšçš„å¤„ç†å¦‚ä¸‹ï¼š

    public class Candy1 {
        // è¿™ä¸ªæ— å‚æ„é€ æ˜¯ç¼–è¯‘å™¨å¸®åŠ©æˆ‘ä»¬åŠ ä¸Šçš„
        public Candy1() {
            super(); // å³è°ƒç”¨çˆ¶ç±» Object çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œå³è°ƒç”¨ java/lang/Object."<init>":()V
        }
    }
    

### è‡ªåŠ¨æ‹†è£…ç®±

æˆ‘ä»¬åœ¨æœ€å¼€å§‹çš„ç‰ˆæœ¬ä¸­å…¶å®åŒ…æ˜¯ä¸€ä¸ªå¾ˆæ™®éçš„æ¦‚å¿µï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œæ‰‹åŠ¨æ‹†ç®±è£…ç®±æ“ä½œï¼š

    public class Candy2 {
        public static void main(String[] args) {
            Integer x = Integer.valueOf(1);
            int y = x.intValue();
        }
    }
    

ä½†æ˜¯åœ¨JDK5ä¹‹åï¼Œç³»ç»Ÿä¸ºæˆ‘ä»¬è‡ªåŠ¨æ·»åŠ äº†è‡ªåŠ¨æ‹†è£…ç®±åŠŸèƒ½ï¼Œæˆ‘ä»¬å°±å¯ä»¥èŠ‚çœæ‰è¿™ä¸€æ­¥ï¼š

    public class Candy2 {
        public static void main(String[] args) {
            Integer x = 1;
            int y = x;
        }
    }
    

### æ³›å‹é›†åˆå–å€¼

æ³›å‹ä¹Ÿæ˜¯åœ¨ JDK 5 å¼€å§‹åŠ å…¥çš„ç‰¹æ€§ï¼Œä½† java åœ¨ç¼–è¯‘æ³›å‹ä»£ç åä¼šæ‰§è¡Œ æ³›å‹æ“¦é™¤ çš„åŠ¨ä½œï¼Œå³æ³›å‹ä¿¡æ¯

åœ¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ä¹‹åå°±ä¸¢å¤±äº†ï¼Œå®é™…çš„ç±»å‹éƒ½å½“åšäº† Object ç±»å‹æ¥å¤„ç†ï¼š

    public class Candy3 {
        public static void main(String[] args) {
            List<Integer> list = new ArrayList<>();
            list.add(10); // å®é™…è°ƒç”¨çš„æ˜¯ List.add(Object e)
            Integer x = list.get(0); // å®é™…è°ƒç”¨çš„æ˜¯ Object obj = List.get(int index);
        }
    }
    

æ‰€ä»¥å®é™…ä¸Šç³»ç»Ÿåœ¨è¿™éƒ¨åˆ†è¿˜ä¸ºæˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªè‡ªåŠ¨ç±»å‹è½¬æ¢çš„åŠŸèƒ½ï¼š

    // éœ€è¦å°† Object è½¬ä¸º Integer
    Integer x = (Integer)list.get(0);
    

å¦‚æœæˆ‘ä»¬å‰é¢çš„ç±»å‹æ˜¯intç±»å‹ï¼Œé‚£ä¹ˆè¿˜ä¼šè¿½åŠ ä¸€å±‚è‡ªåŠ¨æ‹†è£…ç®±åŠŸèƒ½ï¼š

    // éœ€è¦å°† Object è½¬ä¸º Integer, å¹¶æ‰§è¡Œæ‹†ç®±æ“ä½œ
    int x = ((Integer)list.get(0)).intValue();
    

### å¯å˜å‚æ•°

å¯å˜å‚æ•° String... args å…¶å®æ˜¯ä¸€ä¸ª String\[\] args ï¼Œä»ä»£ç ä¸­çš„èµ‹å€¼è¯­å¥ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚

æˆ‘ä»¬æ­£å¸¸æƒ…å†µä¸‹ä¹¦å†™å°±å¯ä»¥å°†å¯å˜å‚æ•°è½¬åŒ–ä¸ºä¸€ä¸ªæ•°ç»„ç±»å‹ï¼š

    public class Candy4 {
        
        public static void foo(String... args) {
            String[] array = args; // ç›´æ¥èµ‹å€¼
            System.out.println(array);
        } 
        
        public static void main(String[] args) {
        	foo("hello", "world");
        }
    }
    

ä½†æ˜¯åœ¨åº•å±‚ä¸­ç³»ç»Ÿä¼šä¸ºæˆ‘ä»¬å®Œæˆä¸€äº›æ“ä½œï¼š

    public class Candy4 {
        
        // è¿™é‡Œæ¥å—çš„å‚æ•°ç›´æ¥ç”±argså¯å˜å‚æ•°å˜ä¸ºStringç±»å‹çš„æ•°ç»„å‚æ•°
        public static void foo(String[] args) {
            String[] array = args; // ç›´æ¥èµ‹å€¼
            System.out.println(array);
        } 
        
        public static void main(String[] args) {
            // ç›¸å½“äºæˆ‘ä»¬ç›´æ¥åˆ›å»ºäº†Stringç±»å‹çš„æ•°ç»„ï¼Œå¹¶ä¸”å°†å€¼å°è£…è¿›å»ï¼Œè¿™ä¸ªæ•°ç»„çš„å¤§å°å°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å¤§å°
            foo(new String[]{"hello", "world"});
        }
    }
    

### foreachå¾ªç¯

æˆ‘ä»¬çš„foreachå¾ªç¯æ“ä½œä¹Ÿæ˜¯ç”±æœ€åŸºæœ¬çš„forå¾ªç¯æ¥æ¼”å˜è¿‡æ¥çš„ï¼Œåªä¸è¿‡æ˜¯ç³»ç»Ÿä¸ºæˆ‘ä»¬è¿›è¡Œäº†å¤„ç†è€Œå·²ï¼š

    public class Candy5_1 {
        public static void main(String[] args) {
            
            // æ•°ç»„èµ‹åˆå€¼çš„ç®€åŒ–å†™æ³•ä¹Ÿæ˜¯è¯­æ³•ç³–å“¦
            int[] array = {1, 2, 3, 4, 5}; 
            
            // è¿™æ˜¯æˆ‘ä»¬çš„foreachå¾ªç¯
            for (int e : array) {
                System.out.println(e);
            }
        }
    }
    

ä¸‹é¢æˆ‘ä»¬æ¥å±•ç¤ºç”±ç³»ç»Ÿç¼–è¯‘åçš„javaä»£ç ï¼š

    public class Candy5_1 {
        
        public Candy5_1() {
        } 
        
        public static void main(String[] args) {
            
            // è¿™é‡Œçš„æ•°ç»„èµ‹å€¼å®é™…ä¸Šè¿˜æ˜¯è°ƒç”¨äº†new int[]ï¼Œä½†æ˜¯ç³»ç»Ÿå¸®ä½ è¡¥å……ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœç•¥
            int[] array = new int[]{1, 2, 3, 4, 5};
            
            // è¿™é‡Œä¾æ—§é‡‡ç”¨çš„æ˜¯forå¾ªç¯ï¼Œä½†æ˜¯ç³»ç»Ÿä¸ºä½ å°è£…å¥½äº†forå¾ªç¯çš„å¼€å¤´ä¸ç»“æŸæ¡ä»¶ï¼Œå¹¶ä¸”å¸®ä½ æŠŠæ•°ç»„ä¸­çš„å…ƒç´ å–å‡ºæ¥
            for(int i = 0; i < array.length; ++i) {
                int e = array[i];
                System.out.println(e);
            }
        }
    }
    

å¯¹äºé›†åˆä¹Ÿæ˜¯åŒæ ·çš„æ¦‚å¿µï¼š

    public class Candy5_2 {
        public static void main(String[] args) {
            
            List<Integer> list = Arrays.asList(1,2,3,4,5);
            
            for (Integer i : list) {
                System.out.println(i);
            }
        }
    }
    

æˆ‘ä»¬ç»™å‡ºé›†åˆçš„ç¼–è¯‘ä»£ç ï¼š

    public class Candy5_2 {
        
        public Candy5_2() {
        } 
        
        public static void main(String[] args) {
            
            List<Integer> list = Arrays.asList(1, 2, 3, 4, 5);
            
            // å®é™…ä¸Šç³»ç»Ÿæˆ‘ä»¬æå–äº†ä¸€ä¸ªè¿­ä»£å™¨ä½œä¸ºæ•°ç»„çš„éå†æ¡ä»¶ï¼Œå¹¶ä¸ºæˆ‘ä»¬å®Œæˆäº†è¿­ä»£å™¨åˆ¤å®šä»¥åŠè¿­ä»£å™¨é€’å¢
            Iterator iter = list.iterator();
            while(iter.hasNext()) {
                Integer e = (Integer)iter.next();
                System.out.println(e);
            }
        }
    }
    

### switchå­—ç¬¦ä¸²

æˆ‘ä»¬JDK7ä¹‹åçš„switchå¯ä»¥ç›´æ¥é‡‡ç”¨å­—ç¬¦ä¸²æ¥è¿›è¡Œåˆ¤å®šï¼Œè¿™åŒæ ·ä¹Ÿæ˜¯åº•å±‚ç¼–è¯‘çš„è¯­æ³•ç³–å†…å®¹ï¼š

    public class Candy6_1 {
        public static void choose(String str) {
            switch (str) {
                case "hello": {
                    System.out.println("h");
                    break;
                }
                case "world": {
                    System.out.println("w");
                    break;
                }
            }
        }
    }
    

æˆ‘ä»¬çš„åº•å±‚æ˜¯é‡‡ç”¨hashCodeå’Œequalæ–¹æ³•æ¥è¿›è¡Œåˆ¤å®šçš„ï¼š

    public class Candy6_1 {
        
        public Candy6_1() {
        }
            
        public static void choose(String str) {
            
            byte x = -1;
            
            // é¦–å…ˆè¿›è¡ŒhashCodeæ¯”è¾ƒï¼Œå› ä¸ºhashCodeæ˜¯å”¯ä¸€å€¼ï¼Œæ¯”è¾ƒé€Ÿåº¦å¿«ï¼Œå¯ä»¥è¿›è¡Œå¤§è§„æ¨¡æ¯”è¾ƒ
            switch(str.hashCode()) {
                    
                // ç„¶åæˆ‘ä»¬å†é‡‡ç”¨eqæ–¹æ³•ç¡®å®šï¼Œå› ä¸ºæœ‰çš„å€¼çš„hashCodeæ˜¯ä¸€è‡´çš„ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤å®šæ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„æ¡ä»¶ 
                // æˆ‘ä»¬æ ¹æ®æ¡ä»¶å†è®¾ç½®ä¸€ä¸ªxçš„å‚æ•°ç”¨äºå¦ä¸€ä¸ªswitchæ¥æ‰§è¡Œæ–¹æ³•
                case 99162322: // hello çš„ hashCode
                    if (str.equals("hello")) {
                        x = 0;
                    } 
                    break;
                case 113318802: // world çš„ hashCode
                    if (str.equals("world")) {
                        x = 1;
                    }
                } 
            
                // æ‰§è¡Œæ–¹æ³•çš„switch
            	switch(x) {
                    case 0:
                        System.out.println("h");
                        break;
                    case 1:
                        System.out.println("w");
            }
        }
    }
    

### switchæšä¸¾

switchå’Œæšä¸¾ä¸€åŒä½¿ç”¨ä¹Ÿæ˜¯ç”±ç³»ç»Ÿåº•å±‚è¿›è¡Œäº†æ”¹é€ ï¼š

    enum Sex {
        MALE, FEMALE
    }
    

    public class Candy7 {
        public static void foo(Sex sex) {
        switch (sex) {
            case MALE:
                System.out.println("ç”·"); break;
            case FEMALE:
                System.out.println("å¥³"); break;
            }
        }
    }
    

æˆ‘ä»¬åº•å±‚ä¿®æ”¹å¦‚ä¸‹ï¼š

    public class Candy7 {
        /**
        * å®šä¹‰ä¸€ä¸ªåˆæˆç±»ï¼ˆä»… jvm ä½¿ç”¨ï¼Œå¯¹æˆ‘ä»¬ä¸å¯è§ï¼‰
        * ç”¨æ¥æ˜ å°„æšä¸¾çš„ ordinal ä¸æ•°ç»„å…ƒç´ çš„å…³ç³»
        * æšä¸¾çš„ ordinal è¡¨ç¤ºæšä¸¾å¯¹è±¡çš„åºå·ï¼Œä» 0 å¼€å§‹
        * å³ MALE çš„ ordinal()=0ï¼ŒFEMALE çš„ ordinal()=1
        */
        static class $MAP {
            
            // æ•°ç»„å¤§å°å³ä¸ºæšä¸¾å…ƒç´ ä¸ªæ•°ï¼Œé‡Œé¢å­˜å‚¨caseç”¨æ¥å¯¹æ¯”çš„æ•°å­—
            static int[] map = new int[2];
            
            static {
                    map[Sex.MALE.ordinal()] = 1;
                    map[Sex.FEMALE.ordinal()] = 2;
                }
            
            } 
        
        	public static void foo(Sex sex) {
                
                int x = $MAP.map[sex.ordinal()];
                
                switch (x) {
                    case 1:
                        System.out.println("ç”·");
                    break;
                    case 2:
                        System.out.println("å¥³");
                    break;
                }
            }
    }
    

### æšä¸¾ç±»

åœ¨JDK7ä¸­ç”šè‡³ä¸ºæˆ‘ä»¬ç›´æ¥è®¾è®¡äº†æšä¸¾ç±»ï¼š

    enum Sex {
        MALE, FEMALE
    }
    

åº•å±‚ç›´æ¥ä¸ºæˆ‘ä»¬åˆ›é€ äº†ä¸€ä¸ªç±»ï¼š

    public final class Sex extends Enum<Sex> {
        
        // é¦–å…ˆå°†å±æ€§è¿›è¡Œå®šä¹‰ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªVALUEæ•°ç»„å­˜æ”¾è¿™äº›å±æ€§
        public static final Sex MALE;
        public static final Sex FEMALE;
        private static final Sex[] $VALUES;
        
        // è®¾ç½®ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå°†æ•°æ®è®¾ç½®å¥½é¡ºåºå·ï¼Œå¹¶å­˜å…¥æ•°ç»„
        static {
            MALE = new Sex("MALE", 0);
            FEMALE = new Sex("FEMALE", 1);
            $VALUES = new Sex[]{MALE, FEMALE};
        } 
    
        // ç§æœ‰æ–¹æ³•é˜²æ­¢ä¿®æ”¹æšä¸¾
        private Sex(String name, int ordinal) {
            super(name, ordinal);
        } 
        
        // è·å¾—æ‰€æœ‰æšä¸¾æ•°
        public static Sex[] values() {
            return $VALUES.clone();
        } 
        
        // æ ¹æ®åç§°è·å¾—æšä¸¾
        public static Sex valueOf(String name) {
            return Enum.valueOf(Sex.class, name);
        }
    }
    

### try-with-resources

JDK 7 å¼€å§‹æ–°å¢äº†å¯¹éœ€è¦å…³é—­çš„èµ„æºå¤„ç†çš„ç‰¹æ®Šè¯­æ³•try-with-resourcesï¼š

    try(èµ„æºå˜é‡ = åˆ›å»ºèµ„æºå¯¹è±¡){
        
    } catch( ) {
        
    }
    

ä½†æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„ï¼š

*   å…¶ä¸­èµ„æºå¯¹è±¡éœ€è¦å®ç° AutoCloseable æ¥å£ï¼Œ æ‰èƒ½å¤Ÿè‡ªåŠ¨è¿›è¡Œèµ„æºå…³é—­
*   ä¾‹å¦‚ InputStream ã€ OutputStream ã€Connection ã€ Statement ã€ ResultSet ç­‰æ¥å£éƒ½å®ç°äº† AutoCloseable ï¼Œ

æˆ‘ä»¬å¯ä»¥è¿™æ ·ä¹¦å†™ä»£ç ï¼š

    public class Candy9 {
        public static void main(String[] args) {
            // ä¹¦å†™ä»£ç æ—¶å°†éœ€è¦å…³é—­çš„èµ„æºæ”¾åœ¨tryæ¡ä»¶ä¸­ï¼Œæœ€åç³»ç»Ÿä¼šè‡ªåŠ¨å…³é—­
            try(InputStream is = new FileInputStream("d:\\1.txt")) {
                System.out.println(is);
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
    

ç³»ç»Ÿä¸ºæˆ‘ä»¬æ‰€è°ƒæ•´çš„ä»£ç å¦‚ä¸‹ï¼š

    public class Candy9 {
        
        public Candy9() {
        }
            
        public static void main(String[] args) {
            try {
                InputStream is = new FileInputStream("d:\\1.txt");
                Throwable t = null;
                try {
                    System.out.println(is);
                } catch (Throwable e1) {
                    // t æ˜¯æˆ‘ä»¬ä»£ç å‡ºç°çš„å¼‚å¸¸
                    t = e1;
                    throw e1;
                } finally {
                    // åˆ¤æ–­äº†èµ„æºä¸ä¸ºç©º
                    if (is != null) {
                        // å¦‚æœæˆ‘ä»¬ä»£ç æœ‰å¼‚å¸¸
                        if (t != null) {
                            try {
                                is.close();
                        } catch (Throwable e2) {
                            // å¦‚æœ close å‡ºç°å¼‚å¸¸ï¼Œä½œä¸ºè¢«å‹åˆ¶å¼‚å¸¸æ·»åŠ 
                            t.addSuppressed(e2);
                    	}
                	} else {
                    	// å¦‚æœæˆ‘ä»¬ä»£ç æ²¡æœ‰å¼‚å¸¸ï¼Œclose å‡ºç°çš„å¼‚å¸¸å°±æ˜¯æœ€å catch å—ä¸­çš„ e
                    	is.close();
                		}
                	}
            	}
            } catch (IOException e) {
            e.printStackTrace();
            }
        }
    }
    

### æ–¹æ³•é‡å†™æ—¶çš„æ¡¥æ¥æ–¹æ³•

æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ–¹æ³•é‡å†™æ—¶å¯¹è¿”å›å€¼åˆ†ä¸¤ç§æƒ…å†µï¼š

*   çˆ¶å­ç±»çš„è¿”å›å€¼å®Œå…¨ä¸€è‡´
*   å­ç±»è¿”å›å€¼å¯ä»¥æ˜¯çˆ¶ç±»è¿”å›å€¼çš„å­ç±»

æˆ‘ä»¬ç»™å‡ºä¸€ä¸ªç®€å•ä¾‹å­ï¼š

    class A {
        public Number m() {
        	return 1;
        }
        }
    
    class B extends A {
        @Override
        // å­ç±» m æ–¹æ³•çš„è¿”å›å€¼æ˜¯ Integer æ˜¯çˆ¶ç±» m æ–¹æ³•è¿”å›å€¼ Number çš„å­ç±»
        public Integer m() {
            return 2;
        }
    }
    

è¿™æ—¶æˆ‘ä»¬çš„ç³»ç»Ÿä¹Ÿä¼šä¸ºæˆ‘ä»¬åšè°ƒæ•´ï¼š

    class B extends A {
        
        public Integer m() {
            return 2;
        }
        
        // æ­¤æ–¹æ³•æ‰æ˜¯çœŸæ­£é‡å†™äº†çˆ¶ç±» public Number m() æ–¹æ³•
        public synthetic bridge Number m() {
            // è°ƒç”¨ public Integer m()
            return m();
        }
    }
    

### åŒ¿åå†…éƒ¨ç±»

æˆ‘ä»¬å¹³æ—¶æ‰€ä½¿ç”¨çš„åŒ¿åå†…éƒ¨ç±»å…¶å®æ˜¯ç³»ç»Ÿä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºçš„ä¸€ä¸ªç±»ï¼š

    public class Candy11 {
        public static void test(final int x) {
            
            // ä¾‹å¦‚æˆ‘ä»¬è¿™é‡Œé‡‡ç”¨ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»
            // æ³¨æ„è¿™é‡Œå¦‚æœä¸ºåŒ¿åå†…éƒ¨ç±»æ·»åŠ å‚æ•°ï¼Œéœ€è¦æ·»åŠ finalå›ºå®šå‚æ•°ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç±»ä¸­çš„å‚æ•°æ˜¯æ— æ³•ä¿®æ”¹çš„ï¼
            Runnable runnable = new Runnable() {
                @Override
                public void run() {
                    System.out.println("ok:" + x);
                    }
                };
        }
    }
    

ç³»ç»Ÿä¸ºæˆ‘ä»¬ç›´æ¥åˆ›é€ äº†ä¸€ä¸ªç±»ï¼š

    // application
    
    public class Candy11 {
        
        public static void test(final int x) {
            Runnable runnable = new Candy11$1(x);
        }
        
    }
    

    // é¢å¤–ç”Ÿæˆçš„ç±»
    final class Candy11$1 implements Runnable {
        
        // ç³»ç»Ÿåˆ›é€ çš„å±æ€§
        int val$x;
        
        // ç¬¬ä¸€æ¬¡åˆ›é€ æ—¶ï¼Œå¯¹å±æ€§èµ‹å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°åªèƒ½æ˜¯ä¸å˜çš„
        Candy11$1(int x) {
        	this.val$x = x;
        } 
        
        // æˆ‘ä»¬åˆ›é€ çš„åŒ¿åå†…éƒ¨ç±»çš„æ–¹æ³•
    	public void run() {
        	System.out.println("ok:" + this.val$x);
        }
    }
    

ç±»åŠ è½½é˜¶æ®µ
-----

è¿™ä¸€èŠ‚æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»JVMçš„ç±»åŠ è½½é˜¶æ®µ

### åŠ è½½é˜¶æ®µ

åŠ è½½é˜¶æ®µæ˜¯ç±»åŠ è½½é˜¶æ®µçš„ç¬¬ä¸€é˜¶æ®µ

åŠ è½½é˜¶æ®µçš„ç”¨å¤„æ˜¯ï¼š

*   å°†ç±»çš„å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒºä¸­ï¼Œå†…éƒ¨é‡‡ç”¨ C++ çš„ instanceKlass æè¿° java ç±»

ç”±äºæˆ‘ä»¬æ— æ³•ç›´æ¥ä½¿ç”¨C++è¯­è¨€çš„instanceKlassï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ©é•œåƒæ¥å®ŒæˆåŠ è½½ï¼š

*   java\_mirror å³ java çš„ç±»é•œåƒï¼Œä¾‹å¦‚å¯¹ String æ¥è¯´ï¼Œå°±æ˜¯ String.classï¼Œä½œç”¨æ˜¯æŠŠ klass æš´éœ²ç»™ java ä½¿ç”¨

é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬æ¥ä»‹ç»instanceKlassçš„å…¶ä»–é‡è¦éƒ¨åˆ†ï¼š

*   \_super å³çˆ¶ç±»
*   \_fields å³æˆå‘˜å˜é‡
*   \_methods å³æ–¹æ³•
*   \_constants å³å¸¸é‡æ± 
*   \_class\_loader å³ç±»åŠ è½½å™¨
*   \_vtable è™šæ–¹æ³•è¡¨
*   \_itable æ¥å£æ–¹æ³•è¡¨

é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬å¼ºè°ƒä¸¤ä¸ªæ³¨æ„ç‚¹ï¼š

*   å¦‚æœè¿™ä¸ªç±»è¿˜æœ‰çˆ¶ç±»æ²¡æœ‰åŠ è½½ï¼Œå…ˆåŠ è½½çˆ¶ç±»
*   åŠ è½½å’Œé“¾æ¥å¯èƒ½æ˜¯äº¤æ›¿è¿è¡Œçš„

### é“¾æ¥é˜¶æ®µ

è¿æ¥é˜¶æ®µæ˜¯ç±»åŠ è½½é˜¶æ®µçš„ç¬¬äºŒé˜¶æ®µ

é“¾æ¥ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šéªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æ

#### éªŒè¯é˜¶æ®µ

æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹éªŒè¯çš„å«ä¹‰ï¼š

*   éªŒè¯ç±»æ˜¯å¦ç¬¦åˆ JVMè§„èŒƒï¼Œå®‰å…¨æ€§æ£€æŸ¥

#### å‡†å¤‡é˜¶æ®µ

æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹è§£é‡Šçš„å«ä¹‰ï¼š

*   ä¸º static å˜é‡åˆ†é…ç©ºé—´ï¼Œè®¾ç½®é»˜è®¤å€¼

å…¶ä¸­æˆ‘ä»¬éœ€è¦æ³¨æ„ï¼š

*   static å˜é‡åœ¨ JDK 7 ä¹‹å‰å­˜å‚¨äº instanceKlass æœ«å°¾ï¼Œä» JDK 7 å¼€å§‹ï¼Œå­˜å‚¨äº \_java\_mirror æœ«å°¾
*   static å˜é‡åˆ†é…ç©ºé—´å’Œèµ‹å€¼æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼Œåˆ†é…ç©ºé—´åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆï¼Œèµ‹å€¼åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ
*   å¦‚æœ static å˜é‡æ˜¯ final çš„åŸºæœ¬ç±»å‹ï¼Œä»¥åŠå­—ç¬¦ä¸²å¸¸é‡ï¼Œé‚£ä¹ˆç¼–è¯‘é˜¶æ®µå€¼å°±ç¡®å®šäº†ï¼Œèµ‹å€¼åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ
*   å¦‚æœ static å˜é‡æ˜¯ final çš„ï¼Œä½†å±äºå¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆèµ‹å€¼ä¹Ÿä¼šåœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ

#### è§£æé˜¶æ®µ

æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹è§£æçš„å«ä¹‰ï¼š

*   å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨
*   è¿™ä¸ªé˜¶æ®µå¯¹æˆ‘ä»¬ç¨‹åºå‘˜æ¥è¯´å‡ ä¹æ˜¯é€æ˜çš„ï¼Œä¸éœ€è¦è¿‡å¤šäº†è§£

### åˆå§‹åŒ–é˜¶æ®µ

é¦–å…ˆæˆ‘ä»¬å…ˆæ¥ç®€å•ä»‹ç»ä¸€ä¸‹<cinit>æ–¹æ³•ï¼š

*   å³staticæ–¹æ³•ï¼Œä¼šå°†æ‰€æœ‰çš„èµ‹å€¼æŒ‰é¡ºåºå †ç§¯åœ¨staticæ–¹æ³•ä¸­ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ„é€ ç±»æ—¶æ‰§è¡Œ
*   åˆå§‹åŒ–å³è°ƒç”¨<cinit>()V ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯è¿™ä¸ªç±»çš„ã€æ„é€ æ–¹æ³•ã€çš„çº¿ç¨‹å®‰å…¨

åˆå§‹åŒ–æ—¶æœºï¼š

*   main æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œæ€»ä¼šè¢«é¦–å…ˆåˆå§‹åŒ–
*   é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶
*   å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘
*   å­ç±»è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–
*   Class.forName
*   new ä¼šå¯¼è‡´åˆå§‹åŒ–

ä¸ä¼šåˆå§‹åŒ–çš„æ—¶é—´ç‚¹ï¼š

*   è®¿é—®ç±»çš„ static final é™æ€å¸¸é‡ï¼ˆåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ï¼‰ä¸ä¼šè§¦å‘åˆå§‹åŒ–
*   ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ–
*   åˆ›å»ºè¯¥ç±»çš„æ•°ç»„ä¸ä¼šè§¦å‘åˆå§‹åŒ–
*   ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•
*   Class.forName çš„å‚æ•° 2 ä¸º false æ—¶

æˆ‘ä»¬ç»™å‡ºç®€å•éªŒè¯çš„ä»£ç ï¼š

    package cn.itcast.jvm.t3.load;
    
    import java.io.IOException;
    
    public class Load3 {
        
        static {
            System.out.println("main init");
        }
        
        // æ¯æ¬¡é€‰æ‹©ä¸€ä¸ªæµ‹è¯•~
        public static void main(String[] args) throws ClassNotFoundException, IOException {
    //        // 1. é™æ€å¸¸é‡ä¸ä¼šè§¦å‘åˆå§‹åŒ–
    //        System.out.println(B.b);
    //        // 2. ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ–
    //        System.out.println(B.class);
    //        // 3. åˆ›å»ºè¯¥ç±»çš„æ•°ç»„ä¸ä¼šè§¦å‘åˆå§‹åŒ–
    //        System.out.println(new B[0]);
    //        // 4. ä¸ä¼šåˆå§‹åŒ–ç±» Bï¼Œä½†ä¼šåŠ è½½ Bã€A
    //        ClassLoader cl = Thread.currentThread().getContextClassLoader();
    //        cl.loadClass("cn.itcast.jvm.t3.load.B");
    //        // 5. ä¸ä¼šåˆå§‹åŒ–ç±» Bï¼Œä½†ä¼šåŠ è½½ Bã€A
    //        ClassLoader c2 = Thread.currentThread().getContextClassLoader();
    //        Class.forName("cn.itcast.jvm.t3.load.B", false, c2);
            System.in.read();
    
    
    //        // 1. é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶
    //        System.out.println(A.a);
    //        // 2. å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘
    //        System.out.println(B.c);
    //        // 3. å­ç±»è®¿é—®çˆ¶ç±»é™æ€å˜é‡ï¼Œåªè§¦å‘çˆ¶ç±»åˆå§‹åŒ–
    //        System.out.println(B.a);
    //        // 4. ä¼šåˆå§‹åŒ–ç±» Bï¼Œå¹¶å…ˆåˆå§‹åŒ–ç±» A
    //        Class.forName("cn.itcast.jvm.t3.load.B");
        }
    }
    
    class A {
        static int a = 0;
        static {
            System.out.println("a init");
        }
    }
    
    class B extends A {
        final static double b = 5.0;
        static boolean c = false;
        static {
            System.out.println("b init");
        }
    }
    

ç±»åŠ è½½å™¨
----

è¿™ä¸€èŠ‚æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»JVMçš„ç±»åŠ è½½å™¨

### å››ç§åŸºæœ¬ç±»åŠ è½½å™¨

æˆ‘ä»¬å…ˆæ¥ä»‹ç»å››ç§åŸºæœ¬ç±»åŠ è½½å™¨ï¼š

åç§°

åŠ è½½å“ªçš„ç±»

è¯´æ˜

Bootstrap ClassLoader

JAVA\_HOME/jre/lib

æ— æ³•ç›´æ¥è®¿é—®

Extension ClassLoader

JAVA\_HOME/jre/lib/ext

ä¸Šçº§ä¸º Bootstrapï¼Œæ˜¾ç¤ºä¸º null

Application ClassLoader

classpath

ä¸Šçº§ä¸º Extension

è‡ªå®šä¹‰ç±»åŠ è½½å™¨

è‡ªå®šä¹‰

ä¸Šçº§ä¸º Application

æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹è¿è¡Œæœºåˆ¶ï¼š

*   é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“Bootstrap ClassLoader æ˜¯ä¸å¯è®¿é—®çš„ï¼Œå½“æˆ‘ä»¬æŸ¥æ‰¾åˆ°è¯¥å±‚çº§æ—¶ä¼šæ˜¾ç¤ºnull
*   æˆ‘ä»¬å¦‚æœéœ€è¦åŠ è½½ä¸€ä¸ªç±»ï¼Œä¼šå…ˆæ£€æµ‹æ˜¯å¦æœ‰ä¸Šçº§ï¼Œå¦‚æœæœ‰ä¸Šçº§å°±åˆ°ä¸Šçº§ä¸­å»ï¼Œå¦‚æœæ²¡æœ‰å°±åœ¨æœ¬å±‚æŸ¥æ‰¾æ˜¯å¦æœ‰è¯¥ç±»
*   æ„æ€å°±æ˜¯ä»¥æœ€é«˜çº§çš„åŠ è½½å™¨ä¸­çš„ç±»ä¸ºæœ€é«˜æ ‡å‡†ï¼Œå¦‚æœåŒæ—¶å­˜åœ¨å¤šä¸ªç±»ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©æœ€é«˜çº§çš„ç±»åŠ è½½å™¨ä¸­çš„ç±»æ¥è¿è¡Œ

### å¯åŠ¨ç±»åŠ è½½å™¨

ç”¨ Bootstrap ç±»åŠ è½½å™¨åŠ è½½ç±»ï¼š

    package cn.itcast.jvm.t3.load;
    
    public class F {
        static {
            System.out.println("bootstrap F init");
        }
    }
    

æ‰§è¡Œ :

    package cn.itcast.jvm.t3.load;
    
    public class Load5_1 {
        public static void main(String[] args) throws ClassNotFoundException {
            Class<?> aClass = Class.forName("cn.itcast.jvm.t3.load.F");
            System.out.println(aClass.getClassLoader()); // AppClassLoader  ExtClassLoader
        }
    }
    

è¾“å‡ºï¼š

    // æˆ‘ä»¬ä¼šå‘ç°æœ€åè¾“å‡ºçš„ç»“æœä¸ºnullï¼Œè¿™å°±æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥JVMç´¢æ€§ç»™æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªnullè¿”å›
    
    // è¿è¡Œ~
    E:\git\jvm\out\production\jvm>java -Xbootclasspath/a:.
        
    // è¿è¡Œç»“æœ
    cn.itcast.jvm.t3.load.Load5
    bootstrap F init
    null
    

æˆ‘ä»¬å¯¹ä¸Šè¿°çš„è¿è¡Œè¯­å¥åšç®€å•è§£é‡Šï¼š

*   \-Xbootclasspath è¡¨ç¤ºè®¾ç½® bootclasspath
*   å…¶ä¸­ /a:. è¡¨ç¤ºå°†å½“å‰ç›®å½•è¿½åŠ è‡³ bootclasspath ä¹‹å

### æ‰©å±•ç±»åŠ è½½å™¨

ç”¨Extension ClassLoader ç±»åŠ è½½å™¨åŠ è½½ç±»ï¼š

    package cn.itcast.jvm.t3.load;
    
    public class G {
        static {
    //        System.out.println("ext G init");
            System.out.println("classpath G init");
        }
    }
    

æ‰§è¡Œï¼š

    package cn.itcast.jvm.t3.load;
    
    /**
     * æ¼”ç¤º æ‰©å±•ç±»åŠ è½½å™¨
     * åœ¨ C:\Program Files\Java\jdk1.8.0_91 ä¸‹æœ‰ä¸€ä¸ª my.jar
     * é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ª G çš„ç±»ï¼Œè§‚å¯Ÿåˆ°åº•æ˜¯å“ªä¸ªç±»è¢«åŠ è½½äº†
     */
    public class Load5_2 {
        public static void main(String[] args) throws ClassNotFoundException {
            Class<?> aClass = Class.forName("cn.itcast.jvm.t3.load.G");
            System.out.println(aClass.getClassLoader());
        }
    }
    

è¾“å‡ºï¼š

    // ç›®å‰æ˜¯ç”±Application ClassLoader åŠ è½½å™¨è¿è¡Œçš„ï¼ï¼ˆå…¶å®æˆ‘ä»¬ç›®å‰ä½¿ç”¨çš„åŸºæœ¬éƒ½æ˜¯Applicationç±»åŠ è½½å™¨ï¼‰
    classpath G init
    sun.misc.Launcher$AppClassLoader@18b4aac2
    

ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†è¯¥ç¨‹åºæ‰“æˆjaråŒ…ä¹‹åå¹¶æ”¾åœ¨Extension ClassLoaderçš„å¯¹åº”ç›®å½•ä¸‹ä¹‹åæˆ‘ä»¬å†æ¥è¿è¡Œï¼š

    // æˆ‘ä»¬å°±ä¼šå‘ç°ç±»åŠ è½½å™¨ç›®å½•å˜ä¸ºäº†Extension ClassLoader
    ext G init
    sun.misc.Launcher$ExtClassLoader@29453f44
    

### åŒäº²å§”æ´¾æ¨¡å¼

é¦–å…ˆæˆ‘ä»¬æ¥ç®€å•ä»‹ç»ä¸€ä¸‹åŒäº²å§”æ´¾æ¨¡å¼ï¼š

*   æ‰€è°“çš„åŒäº²å§”æ´¾ï¼Œå°±æ˜¯æŒ‡è°ƒç”¨ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•æ—¶ï¼ŒæŸ¥æ‰¾ç±»çš„è§„åˆ™
*   æ„æ€å°±æ˜¯æˆ‘ä»¬è¦éµä»åŒäº²ï¼ˆä¸Šçº§ï¼‰çš„æŒ‡ä»¤ï¼Œä»¥åŒäº²ä¸ºä¸»ï¼Œå…ˆè°ƒç”¨åŒäº²çš„ç±»å¼•ç”¨ï¼Œå†è€ƒè™‘è‡ªèº«

æˆ‘ä»¬ç»™å‡ºåŒäº²å§”æ´¾æ¨¡å¼çš„ä»£ç ï¼š

    protected Class<?> loadClass(String name, boolean resolve)
            throws ClassNotFoundException
        {
            synchronized (getClassLoadingLock(name)) {
                // 1. æ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»åŠ è½½
                Class<?> c = findLoadedClass(name);
                if (c == null) {
                    long t0 = System.nanoTime();
                    try {
                        if (parent != null) {
                            // 2. æœ‰ä¸Šçº§çš„è¯ï¼Œå§”æ´¾ä¸Šçº§ loadClass
                            c = parent.loadClass(name, false);
                        } else {
                            // 3. å¦‚æœæ²¡æœ‰ä¸Šçº§äº†ï¼ˆExtClassLoaderï¼‰ï¼Œåˆ™å§”æ´¾BootstrapClassLoader
                            c = findBootstrapClassOrNull(name);
                        }
                    } catch (ClassNotFoundException e) {
    					//	å°±ç®—å‡ºç°å¼‚å¸¸ï¼Œè¿™é‡Œæ•è·ä¸åšä»»ä½•å¤„ç†ï¼Œç»§ç»­è¿è¡Œç¨‹åº
                    }
    
                    if (c == null) {
                        // 4. æ¯ä¸€å±‚æ‰¾ä¸åˆ°ï¼Œè°ƒç”¨ findClass æ–¹æ³•ï¼ˆæ¯ä¸ªç±»åŠ è½½å™¨è‡ªå·±æ‰©å±•ï¼‰æ¥åŠ è½½
                        long t1 = System.nanoTime();
                        c = findClass(name);
    
                        // 5. è®°å½•è€—æ—¶
                        sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);
                        sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);
                        sun.misc.PerfCounter.getFindClasses().increment();
                    }
                }
                if (resolve) {
                    resolveClass(c);
                }
                return c;
            }
        }
    

### è‡ªå®šä¹‰ç±»åŠ è½½å™¨

é¦–å…ˆæˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼š

*   ç”±æˆ‘ä»¬è‡ªå·±è®¾ç½®ä»€ä¹ˆæƒ…å†µä¸‹åœ¨ä»€ä¹ˆæ–‡ä»¶å¤¹ä¸‹å–å¾—ç±»çš„æœ¬ä½“

é‚£ä¹ˆæˆ‘ä»¬ç»™å‡ºæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„æƒ…å†µï¼š

*   æƒ³åŠ è½½é classpath éšæ„è·¯å¾„ä¸­çš„ç±»æ–‡ä»¶
*   éƒ½æ˜¯é€šè¿‡æ¥å£æ¥ä½¿ç”¨å®ç°ï¼Œå¸Œæœ›è§£è€¦æ—¶ï¼Œå¸¸ç”¨åœ¨æ¡†æ¶è®¾è®¡
*   è¿™äº›ç±»å¸Œæœ›äºˆä»¥éš”ç¦»ï¼Œä¸åŒåº”ç”¨çš„åŒåç±»éƒ½å¯ä»¥åŠ è½½ï¼Œä¸å†²çªï¼Œå¸¸è§äº tomcat å®¹å™¨

æˆ‘ä»¬è¿™é‡Œç»™å‡ºç®€å•æ­¥éª¤ï¼š

*   ç»§æ‰¿ ClassLoader çˆ¶ç±»
*   è¦éµä»åŒäº²å§”æ´¾æœºåˆ¶ï¼Œé‡å†™ findClass æ–¹æ³•ï¼ˆæ³¨æ„ä¸æ˜¯é‡å†™ loadClass æ–¹æ³•ï¼Œå¦åˆ™ä¸ä¼šèµ°åŒäº²å§”æ´¾æœºåˆ¶ï¼‰
*   è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç 
*   è°ƒç”¨çˆ¶ç±»çš„ defineClass æ–¹æ³•æ¥åŠ è½½ç±»
*   ä½¿ç”¨è€…è°ƒç”¨è¯¥ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•

è¿è¡ŒæœŸä¼˜åŒ–
-----

è¿™ä¸€èŠ‚æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»JVMçš„è¿è¡ŒæœŸä¼˜åŒ–

### å³æ—¶ç¼–è¯‘

é¦–å…ˆæˆ‘ä»¬æ¥ç®€å•ä»‹ç»ä¸€ä¸‹å³æ—¶ç¼–è¯‘ï¼š

*   å³æ—¶ç¼–è¯‘å°±æ˜¯åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­è°ƒæ•´ç¼–è¯‘çš„ç»†èŠ‚çŠ¶æ€ï¼Œä¾‹å¦‚å†…éƒ¨å¼•ç”¨å†…éƒ¨æ„é€ ç­‰

æˆ‘ä»¬ç»™å‡ºä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

    package cn.itcast.jvm.t3.jit;
    
    public class JIT1 {
    
        // -XX:+PrintCompilation -XX:-DoEscapeAnalysis
        public static void main(String[] args) {
            for (int i = 0; i < 200; i++) {
                long start = System.nanoTime();
                for (int j = 0; j < 1000; j++) {
                    new Object();
                }
                long end = System.nanoTime();
                System.out.printf("%d\t%d\n",i,(end - start));
            }
        }
    }
    

æˆ‘ä»¬ç»™å‡ºè¿è¡Œé˜¶æ®µçš„éƒ¨åˆ†å†…å®¹ï¼š

    // å‰é¢æ˜¯ç¬¬å‡ æ¬¡ï¼Œåé¢æ˜¯å…·ä½“æ—¶é—´
    
    // æˆ‘ä»¬ä¼šå‘ç°éšç€æ¬¡æ•°çš„å¢å¤šï¼Œæˆ‘ä»¬çš„è¿è¡Œæ—¶é—´è¶Šæ¥è¶Šå°‘ï¼Œè¿™å…¶å®å°±æ˜¯å³æ—¶ç¼–è¯‘çš„åŠŸåŠ³
    
    // ç¬¬ä¸€é˜¶æ®µï¼šéå¸¸å¤§~
    0 96426
    1 52907
    2 44800
    3 119040
    4 65280
    5 47360
    6 45226
    7 47786
    8 48640
    9 60586
    10 42667
    
    // ç¬¬äºŒé˜¶æ®µï¼šç›¸å¯¹å‡å°‘~
    82 18774
    83 17067
    84 21760
    85 23467
    86 17920
    87 17920
    88 18774
    89 18773
    90 19200
    
    // ç¬¬ä¸‰é˜¶æ®µï¼šéå¸¸å°‘~
    190 1280
    191 853
    192 853
    193 853
    194 853
    195 854
    196 853
    197 853
    198 853
    199 854
    

æˆ‘ä»¬é¦–å…ˆæ¥è§£é‡Šä¸€ä¸ªæ¦‚å¿µï¼š

*   profiling æ˜¯æŒ‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¶é›†ä¸€äº›ç¨‹åºæ‰§è¡ŒçŠ¶æ€çš„æ•°æ®ï¼Œä¾‹å¦‚ã€æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ã€‘ï¼Œã€å¾ªç¯çš„å›è¾¹æ¬¡æ•°ã€‘ç­‰

å…¶å®æˆ‘ä»¬çš„å³æ—¶ç¼–è¯‘ä¼šè¢«åˆ†ä¸ºäº”ä¸ªæ—¶é—´æ®µï¼š

*   0 å±‚ï¼Œè§£é‡Šæ‰§è¡Œï¼ˆInterpreterï¼‰
*   1 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆä¸å¸¦ profilingï¼‰
*   2 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦åŸºæœ¬çš„ profilingï¼‰
*   3 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦å®Œå…¨çš„ profilingï¼‰
*   4 å±‚ï¼Œä½¿ç”¨ C2 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œ

é‚£ä¹ˆæˆ‘ä»¬å°±æ¥ä»‹ç»å³æ—¶ç¼–è¯‘å’Œè§£é‡Šå™¨çš„åŒºåˆ«ï¼š

*   è§£é‡Šå™¨æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºæœºå™¨ç ï¼Œä¸‹æ¬¡å³ä½¿é‡åˆ°ç›¸åŒçš„å­—èŠ‚ç ï¼Œä»ä¼šæ‰§è¡Œé‡å¤çš„è§£é‡Š
*   JIT æ˜¯å°†ä¸€äº›å­—èŠ‚ç ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œå¹¶å­˜å…¥ Code Cacheï¼Œä¸‹æ¬¡é‡åˆ°ç›¸åŒçš„ä»£ç ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ— éœ€å†ç¼–è¯‘
*   è§£é‡Šå™¨æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºé’ˆå¯¹æ‰€æœ‰å¹³å°éƒ½é€šç”¨çš„æœºå™¨ç 
*   JIT ä¼šæ ¹æ®å¹³å°ç±»å‹ï¼Œç”Ÿæˆå¹³å°ç‰¹å®šçš„æœºå™¨ç 

å¯æ˜¯å³æ—¶ç¼–è¯‘ä¹Ÿä¼šæœ‰éƒ¨åˆ†ç¼ºé™·ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½å°†æ‰€æœ‰ä»£ç éƒ½ä½¿ç”¨å³æ—¶ç¼–è¯‘æ¥è¿›è¡Œï¼š

*   å¯¹äºå æ®å¤§éƒ¨åˆ†çš„ä¸å¸¸ç”¨çš„ä»£ç ï¼Œæˆ‘ä»¬æ— éœ€è€—è´¹æ—¶é—´å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œè€Œæ˜¯é‡‡å–è§£é‡Šæ‰§è¡Œçš„æ–¹å¼è¿è¡Œï¼›
*   å¦ä¸€æ–¹é¢ï¼Œå¯¹äºä»…å æ®å°éƒ¨åˆ†çš„çƒ­ç‚¹ä»£ç ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œä»¥è¾¾åˆ°ç†æƒ³çš„è¿è¡Œé€Ÿåº¦ã€‚

æˆ‘ä»¬å°†è¿™ç§æ€æƒ³ç§°ä¸ºé€ƒé€¸åˆ†æï¼š

*   é€ƒé€¸åˆ†æå°±æ˜¯åˆ¤æ–­æ–°å»ºçš„å¯¹è±¡æ˜¯å¦é€ƒé€¸ã€‚
*   å¯ä»¥ä½¿ç”¨ -XX:-DoEscapeAnalysis å…³é—­é€ƒé€¸åˆ†æ

### æ–¹æ³•å†…è”

æˆ‘ä»¬æ¥ç®€å•ä»‹ç»ä¸€ä¸‹æ–¹æ³•å†…è”ï¼š

*   å½“æ–¹æ³•çš„ç¯‡å¹…è¾ƒçŸ­æ—¶ï¼Œæˆ‘ä»¬ä¼šç›´æ¥å°†æ–¹æ³•çš„å†…å®¹æ›¿æ¢åˆ°å¼•ç”¨æ–¹æ³•çš„ä½ç½®

æˆ‘ä»¬ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

    // å¯¹äºè¿™ä¹ˆä¸€ä¸ªç®€å•çš„è¿”å›æ–¹æ³•
    private static int square(final int i) {
    	return i * i;
    }
    
    // å¦‚æœæˆ‘ä»¬è°ƒç”¨ä¸‹è¿°è¯­å¥ï¼š
    System.out.println(square(9));
    
    // åœ¨ç¼–è¯‘å™¨ä¸­å°±ä¼šè¿™æ ·å¤„ç†ï¼š
    System.out.println(9 * 9);
    
    // ç”šè‡³è¿˜å¯ä»¥åšå¸¸é‡æŠ˜å çš„ä¼˜åŒ–ï¼š
    System.out.println(81);
    

### å­—æ®µä¼˜åŒ–

æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹å­—æ®µä¼˜åŒ–ï¼š

*   å­—æ®µä¼˜åŒ–å°±æ˜¯å°†ä¹‹å‰æ‰€ä½¿ç”¨çš„å­—æ®µå­˜å‚¨åœ¨ä¸€ä¸ªæˆ‘ä»¬æ‰€çœ‹ä¸åˆ°çš„é»˜è®¤æ•°ç»„ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡è°ƒç”¨æˆ–å…¶ä»–æ“ä½œæ—¶ä¼šç›´æ¥åœ¨æ•°ç»„ä¸­è·å–

æˆ‘ä»¬ç»™å‡ºç®€å•ä¾‹å­ï¼š

    package test;
    
    import org.openjdk.jmh.annotations.*;
    import org.openjdk.jmh.runner.Runner;
    import org.openjdk.jmh.runner.RunnerException;
    import org.openjdk.jmh.runner.options.Options;
    import org.openjdk.jmh.runner.options.OptionsBuilder;
    
    import java.util.Random;
    import java.util.concurrent.ThreadLocalRandom;
    
    @Warmup(iterations = 2, time = 1)
    @Measurement(iterations = 5, time = 1)
    @State(Scope.Benchmark)
    public class Benchmark1 {
    
        // ç®€å•æ¥è¯´å°±æ˜¯ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨ä¸‹è¿°ä¸‰ä¸ªæ–¹æ³•1000æ¬¡ï¼Œæˆ‘ä»¬ä¼šåˆ¤æ–­å…¶æ‰§è¡Œé¡ºåº
        
        // æˆ‘ä»¬ä¸åšç¤ºä¾‹ç›´æ¥ç»™å‡ºç»“æœï¼šä¸‰è€…åŸºæœ¬ä¸€è‡´ï¼Œå› ä¸ºä»–ä»¬éƒ½å€ŸåŠ©äº†æ•°ç»„æ¥å‚¨å­˜æ•°æ®
        
        int[] elements = randomInts(1_000);
    
        private static int[] randomInts(int size) {
            Random random = ThreadLocalRandom.current();
            int[] values = new int[size];
            for (int i = 0; i < size; i++) {
                values[i] = random.nextInt();
            }
            return values;
        }
    
        // è¿™æ˜¯æˆ‘ä»¬å¹³æ—¶ä¼šä¹¦å†™çš„ä»£ç ï¼Œä½†æ˜¯ç³»ç»Ÿåœ¨forä¹‹å‰ä¸ºæˆ‘ä»¬åšäº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥å­˜æ”¾elementsçš„å€¼ï¼Œå°±å’Œtest2ä¸€æ ·
        @Benchmark
        public void test1() {
            for (int i = 0; i < elements.length; i++) {
                doSum(elements[i]);
            }
        }
    
        // è¿™æ˜¯æ ‡å‡†æ ¼å¼
        @Benchmark
        public void test2() {
            int[] local = this.elements;
            for (int i = 0; i < local.length; i++) {
                doSum(local[i]);
            }
        }
    
        // è¿™æ˜¯foreeachå¾ªç¯ï¼Œæˆ‘ä»¬åœ¨å‰é¢é€šè¿‡å­—èŠ‚ç åˆ†æå¯ä»¥çŸ¥é“foreachæ˜¯å®Œå…¨åŸºäºforå¾ªç¯åˆ¶ä½œçš„ï¼Œæ‰€ä»¥ä»–ä¹Ÿå­˜åœ¨æ•°ç»„å­˜æ”¾æ•°æ®
        @Benchmark
        public void test3() {
            for (int element : elements) {
                doSum(element);
            }
        }
    
        static int sum = 0;
    
        @CompilerControl(CompilerControl.Mode.DONT_INLINE)
        static void doSum(int x) {
            sum += x;
        }
    
    
        public static void main(String[] args) throws RunnerException {
            Options opt = new OptionsBuilder()
                    .include(Benchmark1.class.getSimpleName())
                    .forks(1)
                    .build();
    
            new Runner(opt).run();
        }
    }
    

### åå°„ä¼˜åŒ–

åå°„ä¼˜åŒ–ä¹Ÿæ˜¯ç±»ä¼¼äºå³æ—¶ç¼–è¯‘çš„ä¼˜åŒ–æ–¹æ³•ï¼š

*   åœ¨æˆ‘ä»¬çš„è¿è¡ŒæœŸé—´ä¼šå­˜åœ¨ä¸€ä¸ªé˜ˆå€¼
*   åœ¨è¿è¡Œæ¬¡æ•°æœªåˆ°è¾¾é˜ˆå€¼ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šé‡‡ç”¨åå°„æä¾›çš„æ–¹æ³•æˆ–è€…ç±»æ¥è¿è¡Œ
*   ä½†æ˜¯å½“è¿è¡Œæ¬¡æ•°åˆ°è¾¾é˜ˆå€¼ä¹‹åï¼Œæˆ‘ä»¬å°±ä¼šè§†æƒ…å†µé‡‡ç”¨æˆ‘ä»¬è¿è¡Œè¿‡ç¨‹ä¸­æä¾›çš„æ–¹æ³•æˆ–è€…ç±»æ¥è¿›è¡Œä½™ä¸‹çš„è¿è¡Œ

æˆ‘ä»¬ç»™å‡ºç®€å•ç¤ºä¾‹ï¼š

    package cn.itcast.jvm.t3.reflect;
    
    import java.io.IOException;
    import java.lang.reflect.InvocationTargetException;
    import java.lang.reflect.Method;
    
    public class Reflect1 {
    
        public static void foo() {
            System.out.println("foo...");
        }
    
        public static void main(String[] args) throws NoSuchMethodException, InvocationTargetException, IllegalAccessException, IOException {
            Method foo = Reflect1.class.getMethod("foo");
            for (int i = 0; i <= 16; i++) {
                System.out.printf("%d\t", i);
                foo.invoke(null);
            }
            System.in.read();
        }
    }
    

æˆ‘ä»¬æ¥ä»‹ç»ç¤ºä¾‹ä¸­çš„è¿è¡Œç»“æœï¼š

*   æˆ‘ä»¬åœ¨ä¸Šè¿°çš„å‰åå…­æ¬¡è¿è¡Œä¸­ä¼šå‘ç°æ—¶é—´æ…¢æ…¢é€’å‡ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„éƒ¨åˆ†å­˜å‚¨å¯¼è‡´çš„
    
*   ä½†æ˜¯æˆ‘ä»¬çš„ç¬¬åä¸ƒæ¬¡è¿è¡Œå°±ä¼šæ˜æ˜¾å‘ç°æ—¶é—´å¤§å¹…åº¦å‡å°‘ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸å†ä½¿ç”¨åå°„çš„é€”å¾„è·å¾—fooï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æ–¹æ³•ä¸­çš„foo
    

ç»“æŸè¯­
===

åˆ°è¿™é‡Œæˆ‘ä»¬JVMçš„ç±»åŠ è½½å’Œå­—èŠ‚ç æŠ€æœ¯ç¯‡å°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ä¸ºä½ å¸¦æ¥å¸®åŠ©~

###### é™„å½•

è¯¥æ–‡ç« å±äºå­¦ä¹ å†…å®¹ï¼Œå…·ä½“å‚è€ƒBç«™é»‘é©¬ç¨‹åºå‘˜æ»¡è€å¸ˆçš„JVMå®Œæ•´æ•™ç¨‹

è¿™é‡Œé™„ä¸Šè§†é¢‘é“¾æ¥ï¼š[01-ç±»åŠ è½½-æ¦‚è¿°\_å“”å“©å“”å“©\_bilibili](https://www.bilibili.com/video/BV1yE411Z7AP?p=96&vd_source=338ccc664622651493b6fe1ded5bc801)