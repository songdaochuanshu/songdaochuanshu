---
layout: post
title: "ESP8266 ä½¿ç”¨ DRV8833é©±åŠ¨æ¿é©±åŠ¨N20ç”µæœº"
date: "2022-07-25T04:51:09.751Z"
---
ESP8266 ä½¿ç”¨ DRV8833é©±åŠ¨æ¿é©±åŠ¨N20ç”µæœº
============================

RT

æ‰‹é‡Œè¿™å—ESP8266æ˜¯æ¶‚é¸¦çš„æ¿å­ï¼Œå’¸é±¼ä¸Šä¸‰å—ä¸€ä¸ªä¹°äº†ä¸€å †ï¼Œçœ‹ESP8266-12Få¼•è„šéƒ½å·®ä¸å¤šçš„ã€‚è£¸ç„Šäº†ä¸ªæœ€å°ç³»ç»Ÿï¼ŒåŠ ä¸¤ä¸ªæŒ‰é’®ï¼ˆä¸€ä¸ªçƒ§å½•ï¼Œä¸€ä¸ªå¤ä½ï¼‰

![å›¾1 ç°çŠ¶](https://img2022.cnblogs.com/blog/531421/202207/531421-20220725095019080-248285111.png)

### 1\. å‡†å¤‡å·¥ä½œ

æœç´¢è¿‡ç¨‹ä¸­å‘ç° DRV8833å››è·¯è¾“å…¥å£éœ€è¦PWMï¼Œè€Œ8266ä¸­çš„PWMå£æœ‰4ä¸ªIOå£ã€‚ä½†æ˜¯æˆ‘çœ‹åˆ°ç½‘ä¸Šæœ‰äººè¯´â€œRSP8266ä¸­åŸºæœ¬ä¸Šæ•°å­—IOéƒ½å¯ä»¥ä½œä¸ºPWMå¤ç”¨å¼•è„šâ€ï¼Œæˆ‘ä¸æ¸…æ¥šã€‚

![å›¾2 ESP8266ä¸­çš„PWMã€‚æ¥è‡ªä¹é‘«- ESP8266 æŠ€æœ¯å‚è€ƒæ‰‹å†Œ.pdf](https://img2022.cnblogs.com/blog/531421/202207/531421-20220725095051255-731950693.png)

ä¹‹å‰æˆ‘æŠŠGPIO15æ¥åœ°äº†ã€‚å› ä¸ºç½‘ä¸Šä¸€äº›äººè¯´è¦æ¥åœ°ï¼Œä»¥åŠæ¶‚é¸¦æ–‡æ¡£ä¸­æœ‰è¯´GPIO15æ¶‰åŠåˆ°åˆå§‹åŒ–è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¥ä¸ºè¿™ä¸ªå¼•è„šæ˜¯ä¸èƒ½ç”¨çš„

![å›¾3 æ¶‚é¸¦ TYWE3L æ¨¡ç»„è§„æ ¼ä¹¦ä¸­å…³äºGPIOçš„æè¿°](https://img2022.cnblogs.com/blog/531421/202207/531421-20220725095143250-220527155.png)

è¯•ç€å»æ‰åï¼Œå‘ç°å¯ä»¥æ­£å¸¸çƒ§å½•å’Œè¿è¡Œã€‚é‚£å°±è¿™ä¹ˆç€äº†ï¼Œåæ­£ä½ å¼•è„šéƒ½å¼•å‡ºæ¥äº†ï¼Œæˆ‘åº”è¯¥å¯ä»¥éšä¾¿æŠ˜è…¾ï¼Œæˆ‘ä¹Ÿä¸ç”¨wifiåŠŸèƒ½ï¼Œè‡³äºGPIO15èƒ½ä¸èƒ½ç”¨è¿˜å¾—ç­‰åç»­éªŒè¯ã€‚

ä¸‹é¢æ˜¯ç°åœ¨çš„çƒ§å½•å’Œå¤ä½æœ€å°ç³»ç»Ÿå›¾ï¼šå»æ‰GPIO15åˆ°GNDè¿™æ¡çº¿

![å›¾4 ESP8266æœ€å°ç³»ç»Ÿå›¾](https://img2022.cnblogs.com/blog/531421/202207/531421-20220725095214684-235328988.png)

### 2\. PWM å‘¼å¸ç¯æµ‹è¯•

å› ä¸ºå®åœ¨RTOSä¸‹å¼€å‘çš„ï¼Œæ‰€ä»¥æ‰‹å†Œå…ˆæ”¾ä¸Šæ¥ã€‚[esp8266-rtos-sdk PWM](https://docs.espressif.com/projects/esp8266-rtos-sdk/en/latest/api-reference/peripherals/pwm.html#pwm)

RTOSä¸‹ä¹Ÿæœ‰ç¤ºä¾‹ä»£ç ï¼šESP8266\_RTOS\_SDK\\examples\\peripherals\\pwm

PWMé‡è¦å‚æ•°ï¼š

é¢‘ç‡ï¼š1/Ts(å‘¨æœŸ)

å ç©ºæ¯”ï¼šTon/Ts

åœ¨é¢‘ç‡ä¸€å®šæ—¶ï¼Œå¯é€šè¿‡ä¸åŒå ç©ºæ¯”æ¥æ”¹å˜LEDäº®åº¦ï¼Œå°±è¾¾åˆ°å‘¼å¸ç¯æ•ˆæœäº†ã€‚

    #include <stdio.h>
    #include <string.h>
    #include <stdlib.h>
    #include "freertos/FreeRTOS.h"
    #include "freertos/task.h"
    #include "freertos/queue.h"
    #include "esp_log.h"
    #include "esp_system.h"
    #include "esp_err.h"
    #include "esp8266/gpio_register.h"
    #include "esp8266/pin_mux_register.h"
    #include "driver/pwm.h"
    
    
    //#define PWM_0_OUT_IO_NUM   12
    //#define PWM_1_OUT_IO_NUM   13
    //#define PWM_2_OUT_IO_NUM   14
    #define PWM_3_OUT_IO_NUM   15
    
    // PWM period 1000us(1Khz), same as depth
    // å‘¨æœŸ
    #define PWM_PERIOD    (1000)
    
    static const char *TAG = "pwm_example";
    
    // pwm pin number
    const uint32_t pin_num[1] = {
        // PWM_0_OUT_IO_NUM,
        // PWM_1_OUT_IO_NUM,
        // PWM_2_OUT_IO_NUM,
        PWM_3_OUT_IO_NUM
    };
    
    // duties table, real_duty = duties[x]/PERIOD
    // å ç©ºæ¯”
    uint32_t duties[1] = {
        // 10000, 10000, 10000, 
        500,
    };
    
    // phase table, delay = (phase[x]/360)*PERIOD
    // ç›¸ä½
    float phase[1] = {
        0
    };
    // #define configTICK_RATE_HZ 1000
    void app_main()
    {
        pwm_init(PWM_PERIOD, duties, 1, pin_num);
        pwm_set_phases(phase);
        pwm_start();
        char flag = 0;
        uint16_t count = 1;
        while (1) {
            if(flag){
                count--;
            }else{
                count++;
            }
    
            if(count>=1000){
                flag=1;
                ESP_LOGI(TAG, "PWM 1000\n");
            }else if(count<=1){
                flag = 0;
                ESP_LOGI(TAG, "PWM 0\n");
    
                // ç†„ç­ååœç•™
                vTaskDelay(pdMS_TO_TICKS(300));
            }
            // è®¾ç½®å ç©ºæ¯”
            pwm_set_duty(0, count);
            pwm_start();
    
            vTaskDelay(pdMS_TO_TICKS(2));
        }
    }
    

15å·å¼•è„šä¸Šçš„PWMå‘¼å¸ç¯å¦‚ä¸‹ï¼š

æµ‹è¯•PWMçš„å‘¼å¸ç¯

### 3\. DRV8833 é©±åŠ¨æ¿è¿æ¥

ç½‘ä¸Šæ‰¾åˆ°æ¥çº¿å›¾ï¼Œæ¥è¯•è¯•

![å›¾5 DRV8833æ¥çº¿å›¾](https://img2022.cnblogs.com/blog/531421/202207/531421-20220725100327321-921461389.png)

æ”¾åœ¨æˆ‘çš„ç”µè·¯ä¸­çš„æ¥çº¿å›¾

![å›¾6 è‡ªå·±ç³»ç»Ÿä¸­çš„æ¥çº¿å›¾](https://img2022.cnblogs.com/blog/531421/202207/531421-20220725100351660-14904527.png)

ç„Šæ¥ï¼Œç„Šæ¥å®Œæˆåï¼Œä¸²å£ä¿¡æ¯æŠ¥é”™

    Fatal exception (0): 
    epc1=0x4013ffff, epc2=0x00000000, epc3=0x00000000, excvaddr=0x00000000, depc=0x00000000
    
    

åº”è¯¥æ˜¯ç„Šçš„æ—¶å€™ç¢°åˆ°ä»¥å‰çš„å¼•è„šäº†æˆ–è€…æ–°ç„Šæ¥çš„çº¿å½±å“äº†è¿è¡Œ

é‡æ–°çƒ§å½•ä¸‹ç¨‹åºï¼Œçƒ§å½•æŒ‰é’®æŒ‰ä¸‹ï¼ŒæŒ‰å¤ä½æ¯«æ— ååº”ï¼Œæ’æŸ¥ä¸‹é—®é¢˜ã€‚

æœ€åå‘ç°æ˜¯GPIO2å½±å“äº†ï¼Œå› ä¸º**GPIO2åœ¨æ¨¡å—å¯åŠ¨çš„æ—¶å€™å¦‚æœæ‹‰ä½ä¼šå¯åŠ¨å¤±è´¥**ã€‚æˆ‘ä¹Ÿæä¸æ‡‚ä¸ºä»€ä¹ˆç°åœ¨æ¥çš„æ˜¯VCCä½†æ˜¯æ˜¯ä½ç”µå¹³ã€‚å’ŒGPIO15æ¢ä¸ªä½ç½®å§ã€‚

![å›¾7 ä¿®æ”¹GPIO2<>15](https://img2022.cnblogs.com/blog/531421/202207/531421-20220725100416988-959324988.png)

### 4\. ä»£ç éƒ¨åˆ†

**ä¾›ç”µ**

é¦–å…ˆGPIO15è¦ä¾›ç”µï¼Œè¾“å‡ºé«˜ç”µå¹³ï¼š

    #include "driver/gpio.h"
    #define GPIO_15 15
    void app_main()
    {
    
        // ä¸æ˜¯RTOSä¸­çš„é…ç½®æ–¹å¼
        // é…ç½® IO15 ä¸º GPIOåŠŸèƒ½
        // PIN_FUNC_SELECT(PERIPHS_GPIO_MUX_REG(15), FUNC_GPIO15);
        // è®¾ç½®é«˜ç”µå¹³
        // GPIO_OUTPUT_SET(15, 1);
    
        // é…ç½®IO15ä¸ºè¾“å‡º
        gpio_config_t ioConf;
        ioConf.intr_type = GPIO_INTR_DISABLE;
        ioConf.mode = GPIO_MODE_OUTPUT;
        ioConf.pin_bit_mask = (1ULL<<GPIO_15);
        ioConf.pull_down_en = 0;
        ioConf.pull_up_en = 0;
        gpio_config(&ioConf);
        // è¾“å‡ºé«˜ç”µå¹³
        gpio_set_level(GPIO_15, 0);
    
    

ä¾›ç”µåï¼Œé©±åŠ¨æ¿ä¸Šçš„LEDäº®äº†ã€‚

**å››è·¯PWMè¾“å‡º**

    #define PWM_0_OUT_IO_NUM   12
    #define PWM_1_OUT_IO_NUM   13
    #define PWM_2_OUT_IO_NUM   14
    #define PWM_3_OUT_IO_NUM   2
    
    // PWM period 1000us(1Khz), same as depth
    // å‘¨æœŸ
    #define PWM_PERIOD    (1000)
    
    // pwm pin number
    const uint32_t pin_num[4] = {
        PWM_0_OUT_IO_NUM,
        PWM_1_OUT_IO_NUM,
        PWM_2_OUT_IO_NUM,
        PWM_3_OUT_IO_NUM
    };
    
    // duties table, real_duty = duties[x]/PERIOD
    // å ç©ºæ¯”
    uint32_t duties[4] = {
        500,
        500,
        500,
        500,
    };
    
    // phase table, delay = (phase[x]/360)*PERIOD
    // ç›¸ä½
    float phase[4] = {
        0, 0, 0, 0,
    };
    
    void app_main()
    {
    
       ...
    
        // é…ç½®å››è·¯PWMå£
        pwm_init(PWM_PERIOD, duties, 4, pin_num);
        pwm_set_phases(phase);
        pwm_start();
    

ä¸²å£æ—¥å¿—è¾“å‡ºï¼š

    gpio: GPIO[15]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m
    gpio: GPIO[2]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m
    gpio: GPIO[12]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m
    gpio: GPIO[13]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m
    gpio: GPIO[14]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0 [0m
    pwm: --- PWM v3.4
    

ç°åœ¨é€šç”µåï¼Œç”µæœºæ²¡è½¬åŠ¨ï¼Œä½†æ˜¯æœ‰å“å£°ã€‚

æ˜¯å› ä¸ºé©±åŠ¨æ–¹å¼ä¸å¯¹ï¼Œçœ‹çœ‹DRV8833çš„é€»è¾‘æ§åˆ¶ï¼š

![å›¾8 DRV8833é€»è¾‘æ§åˆ¶1](https://img2022.cnblogs.com/blog/531421/202207/531421-20220725100513836-611843116.png)

![å›¾9 DRV8833é€»è¾‘æ§åˆ¶2](https://img2022.cnblogs.com/blog/531421/202207/531421-20220725100537272-573160112.png)

ç°åœ¨IO12å’ŒIO13éƒ½æ˜¯PWMè¾“å‡ºï¼Œå°±ä¼šè‚¯å®šå°±åŠ¨ä¸äº†çš„ã€‚å°†IO13è®¾ä¸ºä½ç”µå¹³å°±å¯ä»¥äº†ã€‚

é€Ÿåº¦ä¸å¤Ÿå¿«ï¼Œå…ˆæŠŠå ç©ºæ¯”è°ƒå¤§ä¸€äº›ã€‚ç¡®å®å¿«äº†ã€‚å†å°†é¢‘ç‡è®¾ç½®ä¸º10Khzï¼Œé€Ÿåº¦ç›¸æ¯”1Khzå¥½åƒæ²¡æå‡ã€‚å¦‚æœè¿˜æƒ³å¢åŠ è½¬é€Ÿæ˜¯ä¸æ˜¯åªèƒ½å¢åŠ ç”µå‹ï¼Ÿç°åœ¨åªæ˜¯3.3çš„ç”µå‹å¤ªå°äº†ã€‚

ä¸è¿‡ç°åœ¨æ€»ç®—æ˜¯è½¬èµ·æ¥äº†

![å›¾10 çœ‹è¿™æ®‹å½±](https://img2022.cnblogs.com/blog/531421/202207/531421-20220725100819128-1227483831.png)

ä»¥åŠæ€»è§ˆå›¾ï¼š

![å›¾11 ç”µè·¯æ€»è§ˆå›¾](https://img2022.cnblogs.com/blog/531421/202207/531421-20220725100855950-1622175813.png)

å®Œæ•´ä»£ç ï¼š

    #include <stdio.h>
    #include <string.h>
    #include <stdlib.h>
    
    #include "freertos/FreeRTOS.h"
    #include "freertos/task.h"
    #include "freertos/queue.h"
    
    #include "esp_log.h"
    #include "esp_system.h"
    #include "esp_err.h"
    
    #include "esp8266/gpio_register.h"
    #include "esp8266/pin_mux_register.h"
    
    #include "driver/pwm.h"
    #include "driver/gpio.h"
    
    #define PWM_0_OUT_IO_NUM   12
    
    #define GPIO_15 15
    #define GPIO_13 13
    
    // PWM period 1000us(1Khz), same as depth
    // å‘¨æœŸ 1ms=1Khz 100us=10Khz
    #define PWM_PERIOD    (1000)
    
    // pwm pin number
    const uint32_t pin_num[1] = {
        PWM_0_OUT_IO_NUM,
    };
    
    // duties table, real_duty = duties[x]/PERIOD
    // å ç©ºæ¯”
    uint32_t duties[1] = {
        999,
    };
    
    // phase table, delay = (phase[x]/360)*PERIOD
    // ç›¸ä½
    float phase[1] = {
        0
    };
    
    
    void app_main()
    {
        // é…ç½®IO15ä¸ºè¾“å‡º
        gpio_config_t ioConf;
        ioConf.intr_type = GPIO_INTR_DISABLE;
        ioConf.mode = GPIO_MODE_OUTPUT;
        ioConf.pin_bit_mask = (1ULL<<GPIO_15);
        ioConf.pull_down_en = 0;
        ioConf.pull_up_en = 0;
        gpio_config(&ioConf);
        // è¾“å‡ºé«˜ç”µå¹³
        gpio_set_level(GPIO_15, 1);
        
        // é…ç½®IO13ä¸ºè¾“å‡º
        ioConf.intr_type = GPIO_INTR_DISABLE;
        ioConf.mode = GPIO_MODE_OUTPUT;
        ioConf.pin_bit_mask = (1ULL<<GPIO_13);
        ioConf.pull_down_en = 0;
        ioConf.pull_up_en = 0;
        gpio_config(&ioConf);
        // è¾“å‡ºé«˜ç”µå¹³
        gpio_set_level(GPIO_13, 0);
    
        // é…ç½®ä¸€è·¯PWMå£
        pwm_init(PWM_PERIOD, duties, 1, pin_num);
        pwm_set_phases(phase);
        pwm_start();
        
    }
    
    

å…¶ä»–å‚è€ƒï¼š

*   [TYWE3L æ¨¡ç»„è§„æ ¼ä¹¦](https://developer.tuya.com/cn/docs/iot/wifie3lpinmodule?id=K9605uj1ar87n)
*   [esp8266-rtos-sdk PWM](https://docs.espressif.com/projects/esp8266-rtos-sdk/en/latest/api-reference/peripherals/pwm.html#pwm)
*   [ESP8266å­¦ä¹ å†ç¨‹(4)â€”â€”PWM](https://blog.csdn.net/qq_41714908/article/details/105223493)
*   [DRV8833ç›´æµç”µæœºé©±åŠ¨æ¿åœ¨æ™ºèƒ½å°è½¦çš„åº”ç”¨](https://blog.csdn.net/sxstj/article/details/124680329)
*   [ESP8266å¼•è„šçš„è¯´æ˜](https://www.cnblogs.com/ejiyuan/p/15610074.html)
*   [ESP8266å­¦ä¹ å†ç¨‹â€”â€”GPIOé…ç½®](https://www.freesion.com/article/9071421051/)
*   [ã€ç”µæœºé©±åŠ¨èŠ¯ç‰‡ï¼ˆHæ¡¥ã€ç›´æµç”µæœºé©±åŠ¨æ–¹å¼ï¼‰â€”â€”DRV8833ã€TB6612ã€A4950ã€L298Nçš„è¯¦è§£ä¸æ¯”è¾ƒã€‘](https://blog.csdn.net/qq_44897194/article/details/105524808)