---
layout: post
title: "Spring Boot整合Swagger报错："this.condition" is null"
date: "2022-05-28T04:26:01.988Z"
---
Spring Boot整合Swagger报错："this.condition" is null
===============================================

前段时间看到群里有吐槽swagger整合问题，当时没仔细看，总以为是姿势不对。

这两天正好自己升级Spring Boot版本，然后突然出现了这样的一个错误：

    Caused by: java.lang.NullPointerException: Cannot invoke "org.springframework.web.servlet.mvc.condition.PatternsRequestCondition.getPatterns()" because "this.condition" is null
    	at springfox.documentation.spring.web.WebMvcPatternsRequestConditionWrapper.getPatterns(WebMvcPatternsRequestConditionWrapper.java:56) ~[springfox-spring-webmvc-3.0.0.jar:3.0.0]
    	at springfox.documentation.RequestHandler.sortedPaths(RequestHandler.java:113) ~[springfox-core-3.0.0.jar:3.0.0]
    	at springfox.documentation.spi.service.contexts.Orderings.lambda$byPatternsCondition$3(Orderings.java:89) ~[springfox-spi-3.0.0.jar:3.0.0]
    	at java.base/java.util.Comparator.lambda$comparing$77a9974f$1(Comparator.java:473) ~[na:na]
    	at java.base/java.util.TimSort.countRunAndMakeAscending(TimSort.java:355) ~[na:na]
    	at java.base/java.util.TimSort.sort(TimSort.java:220) ~[na:na]
    	at java.base/java.util.Arrays.sort(Arrays.java:1307) ~[na:na]
    	at java.base/java.util.ArrayList.sort(ArrayList.java:1721) ~[na:na]
    	at java.base/java.util.stream.SortedOps$RefSortingSink.end(SortedOps.java:392) ~[na:na]
    	at java.base/java.util.stream.Sink$ChainedReference.end(Sink.java:258) ~[na:na]
    	at java.base/java.util.stream.Sink$ChainedReference.end(Sink.java:258) ~[na:na]
    	at java.base/java.util.stream.Sink$ChainedReference.end(Sink.java:258) ~[na:na]
    	at java.base/java.util.stream.Sink$ChainedReference.end(Sink.java:258) ~[na:na]
    	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:510) ~[na:na]
    	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499) ~[na:na]
    	at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921) ~[na:na]
    	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) ~[na:na]
    	at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:682) ~[na:na]
    	at springfox.documentation.spring.web.plugins.WebMvcRequestHandlerProvider.requestHandlers(WebMvcRequestHandlerProvider.java:81) ~[springfox-spring-webmvc-3.0.0.jar:3.0.0]
    	at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197) ~[na:na]
    	at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625) ~[na:na]
    	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509) ~[na:na]
    	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499) ~[na:na]
    	at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921) ~[na:na]
    	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) ~[na:na]
    	at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:682) ~[na:na]
    	at springfox.documentation.spring.web.plugins.AbstractDocumentationPluginsBootstrapper.withDefaults(AbstractDocumentationPluginsBootstrapper.java:107) ~[springfox-spring-web-3.0.0.jar:3.0.0]
    	at springfox.documentation.spring.web.plugins.AbstractDocumentationPluginsBootstrapper.buildContext(AbstractDocumentationPluginsBootstrapper.java:91) ~[springfox-spring-web-3.0.0.jar:3.0.0]
    	at springfox.documentation.spring.web.plugins.AbstractDocumentationPluginsBootstrapper.bootstrapDocumentationPlugins(AbstractDocumentationPluginsBootstrapper.java:82) ~[springfox-spring-web-3.0.0.jar:3.0.0]
    	at springfox.documentation.spring.web.plugins.DocumentationPluginsBootstrapper.start(DocumentationPluginsBootstrapper.java:100) ~[springfox-spring-web-3.0.0.jar:3.0.0]
    	at org.springframework.context.support.DefaultLifecycleProcessor.doStart(DefaultLifecycleProcessor.java:178) ~[spring-context-5.3.20.jar:5.3.20]
    	... 14 common frames omitted
    

查了一下，找到一个Spring Boot下的Issue：[https://github.com/spring-projects/spring-boot/issues/28794](https://github.com/spring-projects/spring-boot/issues/28794)，但这个issue已经关闭了，目前这个问题的主要讨论在springfox，具体issue是这个：[https://github.com/springfox/springfox/issues/3462](https://github.com/springfox/springfox/issues/3462)

![图 1](https://img2022.cnblogs.com/other/626506/202205/626506-20220528113454104-730889537.png)

![图 2](https://img2022.cnblogs.com/other/626506/202205/626506-20220528113454414-318720875.png)

顺着这个issue看了一下，这个问题主要出现在Spring Boot 2.6及以后，只要是Spring Boot 2.6引入的新PathPatternParser导致的。

目前从评论中得处的解决方案是：

1.  Path匹配策略切换回`ant_path_matcher`

    spring.mvc.pathmatch.matching-strategy=ant_path_matcher
    

2.  添加下面这个Bean的定义

    @Bean
    public WebMvcEndpointHandlerMapping webEndpointServletHandlerMapping(WebEndpointsSupplier webEndpointsSupplier, ServletEndpointsSupplier servletEndpointsSupplier, ControllerEndpointsSupplier controllerEndpointsSupplier, EndpointMediaTypes endpointMediaTypes, CorsEndpointProperties corsProperties, WebEndpointProperties webEndpointProperties, Environment environment) {
      List<ExposableEndpoint<?>> allEndpoints = new ArrayList();
      Collection<ExposableWebEndpoint> webEndpoints = webEndpointsSupplier.getEndpoints();
      allEndpoints.addAll(webEndpoints);
      allEndpoints.addAll(servletEndpointsSupplier.getEndpoints());
      allEndpoints.addAll(controllerEndpointsSupplier.getEndpoints());
      String basePath = webEndpointProperties.getBasePath();
      EndpointMapping endpointMapping = new EndpointMapping(basePath);
      boolean shouldRegisterLinksMapping = this.shouldRegisterLinksMapping(webEndpointProperties, environment, basePath);
      return new WebMvcEndpointHandlerMapping(endpointMapping, webEndpoints, endpointMediaTypes, corsProperties.toCorsConfiguration(), new EndpointLinksResolver(allEndpoints, basePath), shouldRegisterLinksMapping, null);
    }
    
    private boolean shouldRegisterLinksMapping(WebEndpointProperties webEndpointProperties, Environment environment, String basePath) {
      return webEndpointProperties.getDiscovery().isEnabled() && (StringUtils.hasText(basePath) || ManagementPortType.get(environment).equals(ManagementPortType.DIFFERENT));
    }
    

我这边直接用了第一种方法，加了配置就好了。如果你最近也遇到这个问题，希望[这篇文章](https://blog.didispace.com/swagger-spring-boot-2-6/)对你起到帮助！

本文首发：[Spring Boot整合Swagger时PatternsRequestCondition.getPatterns()报错："this.condition" is null](https://blog.didispace.com/swagger-spring-boot-2-6/)，顺手推荐一个我正在连载的[Java新特性专栏](https://www.didispace.com/java-features/)，电子书形式编写，沉浸式阅读体验，赶紧加入收藏夹吧！

> 欢迎关注我的公众号：程序猿DD。第一时间了解前沿行业消息、分享深度技术干货、获取优质学习资源