---
layout: post
title: "èŠèŠ C++ ä¸­å‡ ç±»ç‰¹æ®Šæˆå‘˜å‡½æ•°"
date: "2022-07-12T06:23:46.316Z"
---
èŠèŠ C++ ä¸­å‡ ç±»ç‰¹æ®Šæˆå‘˜å‡½æ•°
================

ä¸€ï¼šèƒŒæ™¯
----

åœ¨ C# ä¸­è¦è¯´`ç±»`é»˜è®¤ç»™æˆ‘ä»¬å®šä¹‰çš„ç‰¹æ®Šæˆå‘˜å‡½æ•°ï¼Œè«è¿‡äº `æ„é€ å‡½æ•°`ï¼Œä½†åœ¨ C++ ä¸­è¿™æ ·çš„ç‰¹æ®Šå‡½æ•°é«˜è¾¾ 6 ç§ï¼Œæœ‰å¿…è¦æ•´åˆä¸€ä¸‹èŠä¸€èŠã€‚

äºŒï¼šç‰¹æ®Šæˆå‘˜å‡½æ•°
--------

### 1\. é»˜è®¤æ„é€ å‡½æ•°

å’Œ C# ä¸€æ ·ï¼Œå¾ˆå¤šä¹¦ä¸­éƒ½è¯´ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰å®šä¹‰ `æ„é€ å‡½æ•°`ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªï¼Œå‚è€ƒä¸‹é¢çš„ä¾‹å­ï¼š

    
    class Person {
    
    public:
    	string name;
    	int age;
    };
    
    int main()
    {
    	Person person;
    }
    
    

æ¥ä¸‹æ¥è§‚å¯Ÿä¸‹æ±‡ç¼–ä»£ç ï¼Œçœ‹ä¸‹æœ‰æ²¡æœ‰è°ƒç”¨ `é»˜è®¤æ„é€ å‡½æ•°` .

    
    	Person person;
    003E32EF  lea         ecx,[person]  
    003E32F2  call        Person::Person (03E15EBh)
    
    

å¯¹äº C# å­¦ä¹ è€…æ¥è¯´æœ‰ç‚¹æ‡µå“ˆï¼Œå®šä¹‰äº†å°±ç›¸å½“äºnewäº†ï¼Œ å“ˆå“ˆï¼Œè¿™æ˜¯å› ä¸º C++ é»˜è®¤éƒ½æ˜¯å€¼ç±»å‹å“ˆï¼Œä¸è¿‡è¿™é‡Œæœ‰å¿…è¦æ¾„æ¸…ä¸€ä¸‹ï¼Œå¹¶ä¸ä¸€å®šæ‰€æœ‰æƒ…å†µéƒ½ä¼šè°ƒç”¨ `é»˜è®¤æ„é€ å‡½æ•°`ï¼Œå› ä¸º C++ çš„æ±‡ç¼–ç”Ÿæˆç”±å„è‡ª ç¼–è¯‘å™¨ æ¥å†³å®šï¼Œå¦‚æœ `ç¼–è¯‘å™¨` è§‰å¾—æ²¡å¿…è¦è°ƒç”¨ `æ„é€ å‡½æ•°` é‚£å®ƒå°±ä¼šæŠŠè¿™ä¸€æ­¥çœæ‰æ¥åŠ é€Ÿæ€§èƒ½ï¼Œé‚£ä»€ä¹ˆæ—¶å€™ä¸ä¼šè°ƒå‘¢ï¼Ÿ å‚è€ƒå¦‚ä¸‹ä»£ç ã€‚

    
    class Person {
    
    public:
    	void show() {
    		printf("show!");
    	}
    };
    
    int main()
    {
    	Person person;
    	person.show();
    }
    
    

æ¥ä¸‹æ¥çœ‹ä¸‹æ±‡ç¼–ä»£ç ã€‚

    
    	person.show();
    00E73F4F  lea         ecx,[person]  
    00E73F52  call        Person::show (0E713B6h) 
    
    

å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ï¼Œè¿™ç§æƒ…å†µä¸‹è°ƒç”¨ `æ„é€ å‡½æ•°` å…¶å®æ²¡æœ‰å¿…è¦ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å°±å¹²è„†çœç•¥äº†ã€‚

### 2\. ææ„å‡½æ•°

åœ¨ C# ä¸­ `ææ„å‡½æ•°` æ˜¯ç”± CLR è´Ÿè´£ç®¡ç†ï¼Œåœ¨ C++ ä¸­æ²¡æœ‰æ‰˜ç®¡è¿™ä¸ªæ¦‚å¿µï¼Œæ‰€ä»¥é»˜è®¤åªèƒ½æ˜¯ç»“æŸä½œç”¨åŸŸä¹‹å‰ï¼Œè‡ªåŠ¨è°ƒç”¨ `ææ„å‡½æ•°` é‡Šæ”¾ï¼Œå‚è€ƒå¦‚ä¸‹å›¾ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/63cc8aea628345de9df318465a48bad7~tplv-k3u1fbpfcp-zoom-1.image)

### 3\. èµ‹å€¼æ„é€ å‡½æ•°

åˆšæ‰ä¹Ÿè¯´åˆ°äº†ï¼Œåœ¨ C++ ä¸­ç”­ç®¡æ˜¯ class è¿˜æ˜¯ struct é»˜è®¤éƒ½æ˜¯å€¼ç±»å‹ï¼Œæ—¢ç„¶æ˜¯å€¼ç±»å‹å°±å­˜åœ¨`stack copy` çš„æƒ…å†µï¼Œåœ¨ C# ä¸­ä¹Ÿæ˜¯å› ä¸ºé‡å†™äº† `Equals` å’Œ `GetHashCode` æ¥å®ç°çš„å€¼copyï¼Œæ¥ä¸‹æ¥ç®€å•çœ‹ä¸‹ä»£ç ï¼š

    
    class Person {
    
    public:
    	string name;
    	int age;
    };
    
    int main()
    {
    	Person p1 = { "jack",20 };
    	Person p2(p1);
    }
    
    

å†çœ‹ä¸‹ `Person p2(p1)` çš„æ±‡ç¼–ä»£ç ã€‚

    
    	Person p2(p1);
    000F80A2  lea         eax,[p1]  
    000F80A5  push        eax  
    000F80A6  lea         ecx,[p2]  
    000F80A9  call        Person::Person (0F15C3h) 
    
    

ä»æ±‡ç¼–ä¸­å¯ä»¥çœ‹åˆ°è°ƒç”¨äº† `Person::Person (0F15C3h)` å‡½æ•°ï¼Œè¯·æ³¨æ„ï¼Œè¿™ä¸ªä¸æ˜¯ `æ„é€ å‡½æ•°`ï¼Œè€Œæ˜¯ `èµ‹å€¼æ„é€ å‡½æ•°` ğŸ˜‚ï¼Œ å¯ä»¥è°ƒè¯•ä¸‹å»çœ‹çœ‹å“¦ã€‚ã€‚ã€‚ æˆªå›¾å¦‚ä¸‹ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/915f1e7a804840cdbe630324ef226747~tplv-k3u1fbpfcp-zoom-1.image)

å€¼å¾—è¯´ä¸€ä¸‹çš„æ˜¯ï¼ŒC++ é»˜è®¤æä¾›çš„ `èµ‹å€¼æ„é€ å‡½æ•°` æ˜¯æµ…copyï¼Œå¦‚æœè¦å®ç°æ·± copy çš„è¯ï¼Œæˆ–è€…æœ‰ä¸€äº›è‡ªå®šä¹‰çš„é€»è¾‘ï¼Œå»ºè®®è‡ªå·±å®ç°ä¸€ä¸‹ã€‚

    
    class Person {
    
    public:
    	string name;
    	int age;
    
    public:
    	Person(string name, int age) :name(name), age(age) {}
    	Person(const Person& p) {
    		name = p.name;
    		age = p.age;
    	}
    };
    
    int main()
    {
    	Person p1 = { "aaaaaaaaaaaaaaaaaaaaaaaaaaa",20 };
    	Person p2(p1);
    }
    
    

### 4\. èµ‹å€¼è¿ç®—ç¬¦

åœ¨ C# ä¸­ `å€¼ç±»å‹` , `åŒ¿åç±»å‹`, `Record` éƒ½æ˜¯é‡å†™è¿‡ `Equals` åŠ `=` è¿ç®—ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¿™äº›ç±»å‹ä¸Šç”¨ `=`, å…¶å®åœ¨ C++ ä¸­ä¹Ÿå¯ä»¥åœ¨ class ä¹‹é—´è¿›è¡Œèµ‹å€¼ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬é‡å†™è¿ç®—ç¬¦ `=` ï¼Œå¦‚ä½•çœ‹å‡ºæ¥å‘¢ï¼Ÿå…ˆçœ‹ä¸‹ä»£ç ï¼š

    
    class Person {
    
    public:
    	string name;
    	int age;
    
    public:
    	Person(string name, int age) :name(name), age(age) {}
    	Person(const Person& p) {
    		name = p.name;
    		age = p.age;
    	}
    };
    
    int main()
    {
    	Person p1 = { "aaaaaaaaaaaaaaaaaaaaaaaaaaa",20 };
    	Person p2 = { "bbbbbbbbbbbbbbbbbbbbbbbbbbb",22 };
    
    	p2 = p1;
    }
    
    

æœ€åä¸€å¥çš„ `p2 = p1` ä¹‹æ‰€ä»¥èƒ½æˆåŠŸæ˜¯å› ä¸º `=` è¢«é‡å†™äº†ï¼Œå‚è€ƒæ±‡ç¼–ä»£ç ã€‚

    
    	p2 = p1;
    00FD967C  lea         eax,[p1]  
    00FD967F  push        eax  
    00FD9680  lea         ecx,[p2]  
    00FD9683  call        Person::operator= (0FD161Dh)  
    
    

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d0a342b8fa824e3fa337e548be5b5db5~tplv-k3u1fbpfcp-zoom-1.image)

å¦‚æœéœ€è¦è‡ªå®šä¹‰ï¼Œå¯ä»¥è‡ªå·±é‡å†™ã€‚

    
    class Person {
    
    public:
    	string name;
    	int age;
    
    public:
    	Person(string name, int age) :name(name), age(age) {}
    	Person(const Person& p) {
    		name = p.name;
    		age = p.age;
    	}
    	Person& operator = (const Person& p) {
    		name = p.name;
    		age = p.age;
    		return *this;
    	}
    };
    
    int main()
    {
    	Person p1 = { "aaaaaaaaaaaaaaaaaaaaaaaaaaa",20 };
    	Person p2 = { "bbbbbbbbbbbbbbbbbbbbbbbbbbb",22 };
    
    	p2 = p1;
    }
    
    

åœ¨ C++ 11 ä¸­è¿˜æœ‰ç‰¹æ®Šçš„ `ç§»åŠ¨æ„é€ å‡½æ•°` å’Œ `ç§»åŠ¨èµ‹å€¼æ„é€ å‡½æ•°`, è¿™ä¸ªè¿˜éœ€è¦ç†è§£ å·¦å€¼ å’Œ å³å€¼å¼•ç”¨ï¼Œç¯‡å¹…æœ‰é™ï¼Œæ”¾åˆ°åé¢å’Œå¤§å®¶èŠäº†å“ˆã€‚

![å›¾ç‰‡åç§°](https://images.cnblogs.com/cnblogs_com/huangxincheng/345039/o_210929020104æœ€æ–°æ¶ˆæ¯ä¼˜æƒ ä¿ƒé”€å…¬ä¼—å·å…³æ³¨äºŒç»´ç .jpg)