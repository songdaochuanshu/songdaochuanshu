---
layout: post
title: "æ·±å…¥C++05ï¼šè¿ç®—ç¬¦é‡è½½"
date: "2022-06-08T09:18:30.044Z"
---
æ·±å…¥C++05ï¼šè¿ç®—ç¬¦é‡è½½
=============

ğŸ“•è¿ç®—ç¬¦é‡è½½
=======

1.å¤æ•°ç±»
-----

è¿ç®—ç¬¦é‡è½½ç›®çš„ï¼šä½¿å¯¹è±¡è¿ç®—è¡¨ç°å¾—å’Œç¼–è¯‘å™¨å†…ç½®ç±»å‹ä¸€æ ·ï¼›

å¤æ•°ç±»ä¾‹å­

    #include<iostream>
    
    using namespace std;
    
    class CComplex{
    public:
        CComplex(int r = 0, int l = 0): mreal(r), mimage(l) {}
        void show() {
            cout << "å®éƒ¨ï¼š" << mreal << "è™šéƒ¨:" << mimage << endl;
        }
        CComplex operator+(const CComplex &temp) { // ä¸€ä¸ªå‚æ•° ç›¸å½“äºxxx.operator+(temp);
            return CComplex(mreal + temp.mreal, mimage + temp.mimage);//å¯¹è±¡ä¼˜åŒ–ï¼Œå‡å°‘ç”Ÿæˆä¸€ä¸ªå¯¹è±¡çš„æ„é€ å’Œææ„è¿‡ç¨‹;
        }
        CComplex& operator++() {//å…ˆåŠ ,å‰ç½®çš„
            mreal++;
            mimage++;
            return *this;
        }
        CComplex operator++(int) {//ååŠ ï¼Œåç½®çš„
            return CComplex(mreal++, mimage++);
        }
        void operator+=(const CComplex &temp) {
            mreal += temp.mreal;
            mimage += temp.mimage;
        }
    private:
        int mreal;
        int mimage;
        friend CComplex operator+(const CComplex &other, const CComplex &temp);
        friend ostream& operator<<(ostream &out, const CComplex &temp);
        friend istream& operator>>(istream &in, CComplex &temp);
       
    };
    CComplex operator+(const CComplex &other, const CComplex &temp) { //ä¸¤ä¸ªå‚æ•°, ::operator+(other, temp);
        return CComplex(other.mreal + temp.mreal, other.mimage + temp.mimage);
    }
    ostream& operator<<(ostream &out, const CComplex &temp) { //å…¨å±€å‡½æ•°å¥½
        out << temp.mreal << " " << temp.mimage << endl;
        return out;
    }
    istream& operator>>(istream &in, CComplex &temp) { //è®¾ç½®æˆå…¨å±€å‡½æ•°å¥½ï¼Œä¸èƒ½è®¾ç½®ä¸ºconstï¼Œå› ä¸ºéœ€è¦æ”¹å˜
        in >> temp.mreal >> temp.mimage;
        return in;
    }
    int main() {
        CComplex comp1(10, 20);
        CComplex comp2(20, 30);
        CComplex comp3 = comp1 + comp2; //å¦‚æœè°ƒç”¨ç±»æ–¹æ³•ï¼šcomp1.operator+(comp2); å¦‚æœè°ƒç”¨å…¨å±€æ–¹æ³•ï¼š::operator+(comp1, comp2);ä¼˜å…ˆè°ƒç”¨å…¨å±€æ–¹æ³•
        comp3.show();
        CComplex comp4 = comp3 + 20;//è°ƒç”¨å…¨å±€æ–¹æ³•å’Œç±»æ–¹æ³•éƒ½å¯ä»¥ï¼Œå› ä¸ºçŸ¥é“comp3æ˜¯ä»€ä¹ˆç±»ï¼Œç„¶åä¼šå°†20è½¬æ¢æˆå¯¹åº”çš„ç±»;
        comp4 = 20 + comp3;//åªèƒ½é€šè¿‡è°ƒç”¨å…¨å±€æ–¹æ³•ï¼Œè°ƒç”¨ç±»æ–¹æ³•æ˜¯ä¸æˆåŠŸçš„ï¼Œå› ä¸º20ä¸çŸ¥é“æ˜¯ä»€ä¹ˆç±»ï¼›
        comp4.show();
        ++comp4;
        comp4.show();
        CComplex comp5 = comp4++;;
        comp5.show();
        cout << comp5 << comp4 << endl;
        return 0;
    }
    

![image-20220322194246008](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081014303.png)

2.å®ç°stringç±»
-----------

    #include<iostream>
    #include<string>
    
    using namespace std;
    
    class String {
    public:
        String(const char* str = nullptr) {
            if (str != nullptr) {
                len = strlen(str);
                _data = new char[len + 1];
                strcpy(_data, str);
    
            }
            else {
                len = 0;
                _data = new char[1];
                _data[0] = '\0';
            }
        }
        ~String() {
            delete[]_data;
            _data = nullptr;
        }
        String(const String& other) { //æ‹·è´æ„é€ 
            _data = new char[other.len + 1];
            strcpy(_data, other._data);
            len = other.len;
        }
        String operator=(const String& other) { //èµ‹å€¼é‡è½½
            if (*this == other) return *this;
    
            delete[]_data;
            _data = new char[other.len + 1];
            strcpy(_data, other._data);
            return *this;
        }
        char operator[](const int index) { //å¯ä»¥æ”¹å€¼
            if (index >= len) throw "å·²ç»è¶Šç•Œå•¦";
            return _data[index];
        }
        const char operator[](const int index) const { //ä¸å¯ä»¥æ”¹å€¼
            if (index >= len) throw "å·²ç»è¶Šç•Œå•¦";
            return _data[index];
        }
        size_t size() { return len; }
        String operator+=(const String& str) {
            len += str.len;
            char* newstring = new char[len + 1];
            strcpy(newstring, _data);
            strcat(newstring, str._data);
            delete[]_data;
            _data = newstring;
            return *this;
        }
        bool operator==(const String& str) {
            return strcmp(str._data, _data) == 0;
        }
    private:
        char* _data;
        size_t len;
        friend String operator+(const String& temp, const String& other);
        friend ostream& operator<<(ostream& out, const String& other);
        friend istream& operator>>(istream& in, String& other);
    };
    String operator+(const String& temp, const String& other) {
        char* p = new char[temp.len + other.len + 1]; 
        strcpy(p, temp._data);
        strcat(p, other._data);//è¿½åŠ 
        String res(p); //res ä¹Ÿè¦newå’Œdelete
        delete[]p;
        return res;
    }
    ostream& operator<<(ostream& out, const String& other) { //è¾“å‡º
        out << other._data;//ä¸ç”¨åŠ *ï¼ŒæŒ‰åœ°å€è¾“å‡ºå…¨éƒ¨
        return out;
    }
    istream& operator>>(istream& in, String& other) { //è¾“å…¥ï¼Œæ¯æ¬¡è¾“å‡ºéƒ½æ ‡è®°ä¸ºé‡æ–°è¾“å…¥
        char temp[1000];
        in >> temp;
        delete[]other._data;
        other._data = new char[strlen(temp) + 1];
        strcpy(other._data, temp);
        return in;
    }
    int main() {
        String test = "abc";
        test += "d";
        cout << test;
        const char* p = "abc";
        cout << *p << " " << p << endl;//cout ä»åœ°å€ä¸æ–­è¾“å…¥æ•°æ®ï¼Œè€Œ*pè¯»åˆ°çš„å°±æ˜¯åœ°å€çš„å€¼ï¼›
        cin >> test;
        cout << test << endl;
        cout << test[2] << endl;
        return 0;
    }
    

å­˜åœ¨é—®é¢˜ï¼š

åœ¨operator+çš„é‡è½½å‡½æ•°ä¸­ï¼Œå­˜åœ¨ä¸¤æ¬¡newå’Œä¸¤æ¬¡deleteï¼Œæµªè´¹å†…å­˜å’Œæ—¶é—´ï¼Œå¯ä»¥ä¼˜åŒ–ä¸€ä¸‹ï¼š

    String operator+(const String& temp, const String& other) {
        //char* p = new char[temp.len + other.len + 1]; 
        String res; 
        res._data =  new char[temp.len + other.len + 1];
        strcpy(res._data, temp._data);
        strcat(res._data, other._data);
        return res; //åªæœ‰ä¸€æ¬¡çš„newå’Œdelete
    }
    

3.å®ç°stringå­—ç¬¦ä¸²å¯¹è±¡çš„è¿­ä»£å™¨iterator
---------------------------

ä¸ºä»€ä¹ˆéœ€è¦è¿­ä»£å™¨ï¼šå› ä¸ºæ•°æ®å¾€å¾€å­˜åœ¨ç±»çš„æˆå‘˜å±æ€§ä¸­ï¼Œæ¯”å¦‚ä¸Šè¿°çš„Stringç±»çš„`char *_data`ï¼Œå¦‚æœæˆ‘æƒ³ä¸€ä¸ªä¸ªè®¿é—®æ•°æ®ï¼Œæˆ‘éœ€è¦ä¹Ÿç”¨ä¸€ä¸ª`char*` çš„æŒ‡é’ˆæŒ‡å‘â€”`_data`,è€Œäº‹å®æ˜¯æˆ‘ä»¬ä¸å¯ä»¥è®¿é—®å¯¹è±¡çš„privateå±æ€§ï¼æ‰€ä»¥éœ€è¦è¿­ä»£å™¨æ¥å®ç°ï¼›

**è¿­ä»£å™¨ï¼šè¦è®¿é—®é¡ºåºå®¹å™¨å’Œå…³è”å®¹å™¨ä¸­çš„å…ƒç´ ï¼Œéœ€è¦é€šè¿‡"è¿­ä»£å™¨ï¼ˆiteratorï¼‰"è¿›è¡Œï¼Œæä¾›ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼ï¼Œæ¥é€æ˜åœ°éå†å®¹å™¨**

è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç›¸å½“äºå®¹å™¨å’Œæ“çºµå®¹å™¨çš„ç®—æ³•ä¹‹é—´çš„ä¸­ä»‹ã€‚è¿­ä»£å™¨å¯ä»¥æŒ‡å‘å®¹å™¨ä¸­çš„æŸä¸ªå…ƒç´ ï¼Œé€šè¿‡è¿­ä»£å™¨å°±å¯ä»¥è¯»å†™å®ƒæŒ‡å‘çš„å…ƒç´ ã€‚ä»è¿™ä¸€ç‚¹ä¸Šçœ‹ï¼Œè¿­ä»£å™¨å’ŒæŒ‡é’ˆç±»ä¼¼ã€‚

è¿­ä»£å™¨æœ‰æ­£å‘è¿­ä»£å™¨ï¼ˆå®¹å™¨ç±»å::iterator è¿­ä»£å™¨å;ï¼‰ã€å¸¸é‡æ­£å‘è¿­ä»£å™¨ï¼ˆå®¹å™¨ç±»å::const\_iterator è¿­ä»£å™¨å;ï¼‰ã€åå‘è¿­ä»£å™¨ï¼ˆå®¹å™¨ç±»å::reverse\_iterator è¿­ä»£å™¨å;ï¼‰ã€å¸¸é‡åå‘è¿­ä»£å™¨ï¼ˆå®¹å™¨ç±»å::const\_reverse\_iterator è¿­ä»£å™¨å;ï¼‰

éå†ä¾‹å­ï¼š

    string str1 = "hello world!";//str1å«å®¹å™¨å—ï¼Ÿï¼Œå¯ä»¥ï¼Œå› ä¸ºstr1å…¶åº•å±‚æ”¾äº†ä¸€ç»„char
    //iteratorå³å®¹å™¨çš„è¿­ä»£å™¨
    string::iterator it = str1.begin();
    for (; it!=str1.end(); ++it)
    {
    	cout << *it << " ";
    }
    cout << endl;
    

è¯´æ˜ï¼š

![image-20220323210201662](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081029415.png)

æ³›å‹ç®—æ³•ï¼šæ¯”å¦‚sortç­‰ï¼›**æ³›å‹ç®—æ³•ï¼šç»™æ‰€æœ‰å®¹å™¨éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå‚æ•°æ¥å—çš„éƒ½æ˜¯å®¹å™¨çš„è¿­ä»£å™¨ã€‚**

æˆ‘ä»¬è¦çŸ¥é“ï¼š

*   å¦‚ä¸Šé¢æ‰€è¯´ï¼Œstr1å¯¹è±¡ä¸­å­˜å…¥äº†å„ç§å„æ ·çš„å­—ç¬¦ï¼Œå­—ç¬¦ä¸²ç±»å‹åº•å±‚çš„æˆå‘˜å˜é‡ä¸ºç§æœ‰çš„ï¼Œæˆ‘ä»¬æ— æ³•çœ‹è§ã€‚
*   å®¹å™¨æœ‰ä¸€ä¸ªbegin()æ–¹æ³•ï¼Œbegin()è¿”å›å®ƒåº•å±‚çš„è¿­ä»£å™¨çš„è¡¨ç¤ºï¼Œitè¿­ä»£å™¨æŒ‡å‘å®¹å™¨çš„é¦–å…ƒç´ ä½ç½®ã€‚
*   å®¹å™¨ä¸­è¿˜æœ‰ä¸€ä¸ªend()æ–¹æ³•ï¼Œend()è¡¨ç¤ºå®¹å™¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ çš„åç»§ä½ç½®ï¼Œå¾ªç¯ä¸­it!=end()ï¼Œ++itï¼Œå°†å…¶éå†ä¸€éã€‚
*   åº•å±‚æ— è®ºæ˜¯æ•°ç»„è¿˜æ˜¯é“¾è¡¨ä»€ä¹ˆçš„ï¼Œå¦‚ä½•ä»å½“å‰å…ƒç´ éå†åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ“å¿ƒï¼›å®¹å™¨åº•å±‚å…ƒç´ çœŸçœŸæ­£æ­£ä»ä¸€ä¸ªå…ƒç´ è·‘åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä¸åŒæ•°æ®ç»“æ„ï¼Œä¸åŒå·®å¼‚éƒ½å°è£…åœ¨è¿­ä»£å™¨++è¿ç®—ç¬¦é‡è½½å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨å‰ç½®++ï¼ˆåç½®++æ¯”å‰ç½®++å¤šä¸€ä¸ªä¸´æ—¶å¯¹è±¡çš„æ„é€ å’Œææ„è¿‡ç¨‹ï¼‰
*   è¿­ä»£å™¨è¿˜éœ€è¦æä¾› \* è¿ç®—ç¬¦é‡è½½ï¼Œè®¿é—®è¿­ä»£å™¨æ‰€è¿­ä»£å…ƒç´ çš„å€¼ï¼Œè¿­ä»£å™¨è§£å¼•ç”¨è®¿é—®çš„å°±æ˜¯å®¹å™¨åº•å±‚æ•°æ®ã€‚

String è¿­ä»£å™¨çš„å®ç°ï¼š

    class String {
     public:
        ..... //ä¸Šé¢çš„ä»£ç 
        class iterator {
        public:
            iterator(char *p = nullptr):_p(p) {}
            bool operator!=(const iterator& it) {
                return _p != it._p;
            }
            void operator++() { //å‰ç½®++ï¼Œå‡å°‘ä¸´æ—¶å¯¹è±¡çš„æ„é€ ï¼›
                ++_p;
            }
            char& operator*() {
                return *_p;
            }
        private:
            char* _p;
        };
        iterator begin() { //ä¸èƒ½é‡‡ç”¨å¼•ç”¨ï¼Œå› ä¸ºæ˜¯ä¸´æ—¶å¯¹è±¡
            return iterator(_data);//æ„é€ ä¸´æ—¶è¿­ä»£å™¨ï¼ŒæŒ‡å‘é¦–å…ƒç´ ï¼›
        }
        iterator end() { //ä¸èƒ½é‡‡ç”¨å¼•ç”¨ï¼Œå› ä¸ºæ˜¯ä¸´æ—¶å¯¹è±¡
            return iterator(_data + len);//æ„é€ ä¸´æ—¶è¿­ä»£å™¨ï¼ŒæŒ‡å‘æœ«å…ƒç´ çš„åç»§ä½ç½®ï¼›
        }
    privateï¼š
        .....
    };
    int main() {
        String test = "hello word";
        //String::iterator it = test.begin();
        auto it = test.begin();  //ç”¨è‡ªåŠ¨æ¨å¯¼éå†auto ä»£æ›¿ String::iterator 
        for (; it != test.end(); ++it) { //
            cout << *it << " ";
        }
        cout << endl;
        for (char ch : test) { // foreachå†…éƒ¨ä¹Ÿæ˜¯ç”¨iteratorå®ç°ï¼Œå¦‚æœæ²¡æœ‰iteratorä¼šå‘ç”Ÿé”™è¯¯ï¼›
            cout << ch << " ";
        }
        return 0;
    }
    
    

![image-20220323213844737](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081029211.png)

4.å®ç°vectorå®¹å™¨çš„è¿­ä»£å™¨iterator
------------------------

ç›´æ¥ä¸Šæ‰‹ä»£ç ï¼Œæ³¨æ„ğŸ‘€å¤šäº†è§£é€‰æ‹©constï¼Œ&ï¼Œè¿™äº›åŠ å’Œä¸åŠ çš„é—®é¢˜ï¼›

    template<typename T>
    class vector {//å’Œä¹‹å‰çš„æ¨¡æ¿vectorä¸€æ ·
    public:
        ....
        class iterator {
        public:
            iterator( T *p): _p(p) {} //ä¸å¯ä»¥åŠ const,å› ä¸ºåŠ äº†constçš„è¯ä¼šæœ‰_p(T*) = p(const T*),è¿™æ ·ä¼šç±»å‹è½¬æ¢é”™è¯¯ï¼›
    
            //ç›¸ä¿¡ä¸€å¥è¯ï¼šå¦‚æœä¸æ”¹å˜å€¼ï¼Œå°±åŠ constï¼Œå‚æ•°ä¸ºconstï¼Œå¯æ¥å—constå’Œéconstï¼Œå‡½æ•°ä¸ºconstï¼Œå¯ä»¥å¸¸å¯¹è±¡å’Œæ™®é€šå¯¹è±¡è°ƒç”¨ï¼›
            bool operator!=(const iterator &it)const { 
                return _p != it._p;
            }
            void operator++() {
                ++_p;
            }
            T& operator*() {
                return *_p;
            }
            const T& operator*()const { //å¸¸å¯¹è±¡ä¹Ÿèƒ½è°ƒç”¨ï¼Œå¹¶ä¸”ä¸å¯ä»¥æ”¹å˜å€¼ï¼›
                return *_p;
            }
        private:
            T* _p;
        };
        iterator begin() {
            return iterator(_first);
        }
        iterator end() {
            return iterator(_end);
        }
    private:
        .....
    }
    int main() {
        vector<int> arr;
        for (int i = 0; i < 20; i++) {
            arr.push_back(i);
        }
        auto i = arr.begin();
        *i = 100;//è°ƒç”¨çš„æ˜¯æ™®é€šæ–¹æ³•ï¼Œéå¸¸æ–¹æ³•ï¼
        for (; i != arr.end(); ++i) {
            cout << *i << " ";
        }
        return 0;
    }
    

![image-20220323225556649](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081029896.png)

5.å®¹å™¨çš„è¿­ä»£å™¨å¤±æ•ˆé—®é¢˜
------------

â‘ è¿­ä»£å™¨çš„å¤±æ•ˆé—®é¢˜ï¼š

**å¯¹å®¹å™¨çš„æ“ä½œå½±å“äº†å…ƒç´ çš„å­˜æ”¾ä½ç½®ï¼Œç§°ä¸ºè¿­ä»£å™¨å¤±æ•ˆ**

â‘¡å¤±æ•ˆæƒ…å†µï¼š

*   å½“å®¹å™¨è°ƒç”¨erase()æ–¹æ³•åï¼Œå½“å‰ä½ç½®åˆ°å®¹å™¨æœ«å°¾å…ƒç´ çš„æ‰€æœ‰è¿­ä»£å™¨å…¨éƒ¨å¤±æ•ˆã€‚
*   å½“å®¹å™¨è°ƒç”¨insert()æ–¹æ³•åï¼Œå½“å‰ä½ç½®åˆ°å®¹å™¨æœ«å°¾å…ƒç´ çš„æ‰€æœ‰è¿­ä»£å™¨å…¨éƒ¨å¤±æ•ˆã€‚
*   å¦‚æœå®¹å™¨æ‰©å®¹ï¼Œåœ¨å…¶ä»–åœ°æ–¹é‡æ–°åˆå¼€è¾Ÿäº†ä¸€å—å†…å­˜ã€‚åŸæ¥å®¹å™¨åº•å±‚çš„å†…å­˜ä¸Šæ‰€ä¿å­˜çš„è¿­ä»£å™¨å…¨éƒ½å¤±æ•ˆäº†ã€‚
*   ä¸åŒå®¹å™¨çš„è¿­ä»£å™¨ï¼Œæ˜¯ä¸èƒ½è¿›è¡Œæ¯”è¾ƒè¿ç®—çš„ã€‚

ä¾‹å­ï¼šç¨‹åºï¼šæŠŠvecå®¹å™¨ä¸­æ‰€æœ‰çš„å¶æ•°å…¨éƒ¨åˆ æ‰ï¼›æŠŠvecå®¹å™¨ä¸­çš„å¶æ•°å‰é©±ä½ç½®æ’å…¥ å¶æ•°å€¼-1ï¼›

![image-20220323231637455](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081032880.png)

â‘¢è¿­ä»£å™¨å¤±æ•ˆçš„è§£å†³åŠæ³•ï¼š**å¯¹æ’å…¥/åˆ é™¤ç‚¹çš„è¿­ä»£å™¨è¿›è¡Œæ›´æ–°æ“ä½œã€‚**ï¼ˆæ–°çš„è¿­ä»£å™¨æ‰æ˜¯æœ‰æ•ˆçš„ï¼‰

![image-20220323232706001](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081121422.png)

    //å¯¹äºåˆ é™¤æ“ä½œ
    auto it = vec.begin();
    while (it!=vec.end())
    {
    	if (*it % 2 == 0)
    	{
    		it = vec.erase(it);//è¿”å›æ›´æ–°å½“å‰åˆ é™¤ä½ç½®è¿­ä»£å™¨ï¼Œå¹¶ä¸”ä¸è¿›è¡Œ++æ“ä½œï¼Œå› ä¸ºå…ƒç´ å·²ç»å¾€å‰ç§»åŠ¨ï¼›
            
    	}
    	else
    	{
    		++it;
    	}
    }
    
    //ç»™vecå®¹å™¨ä¸­æ‰€æœ‰çš„å¶æ•°å‰é¢æ·»åŠ ä¸€ä¸ªå°äºå¶æ•°å€¼1çš„æ•°å­—
    auto it = vec.begin();
    for (; it!=vec.end(); ++it)
    {
    	if (*it % 2 == 0)
    	{
    		it = vec.insert(it, *it-1);//æ›´æ–°å½“å‰å¢åŠ ä½ç½®è¿­ä»£å™¨
    		++it; // è¿™æ ·ä¸€å…±ç§»åŠ¨ä¸¤ä¸ªä½ç½®
    	}
    }
    
    

â‘£è¿­ä»£å™¨å¤±æ•ˆåŸç†ï¼š

æˆ‘ä»¬å°è¯•å†™ä¸€ä¸‹åº•å±‚è¿­ä»£å™¨çš„ä»£ç ï¼š

åœ¨vectorç±»ä¸­åŠ ä¸€ä¸ªè¿­ä»£å™¨é“¾è¡¨ï¼ˆä¿å­˜æ¯ä¸€ä¸ªè¿­ä»£å™¨çš„ä¿¡æ¯ï¼‰ï¼›åœ¨è¿­ä»£å™¨ä¸­åŠ å¤šä¸€ä¸ªå½“å‰çš„vectoræŒ‡é’ˆï¼ˆçœ‹çœ‹è¯¥è¿­ä»£å™¨å±äºè°ï¼‰ï¼›eraseã€insertæ“ä½œéƒ½ç§»åŠ¨å½“å‰vectoré‡Œæ•°æ®çš„ä½ç½®ï¼Œæ‰©å®¹æ“ä½œæ¬ç§»vectorä¸­çš„æ•°æ®åˆ°å¦ä¸€å—æ–°å†…å­˜ï¼Œå°†è¿­ä»£å™¨é“¾è¡¨ä¸­ä¿¡æ¯å¯¹åº”ä¸ä¸Šçš„è¿­ä»£å™¨ å¤±æ•ˆæ‰ï¼›æ­¥éª¤å¦‚ä¸‹ï¼š

*   åœ¨iteratorç§æœ‰æˆå‘˜ä¸‹æ·»åŠ ä¸€ä¸ªæŒ‡å‘å½“å‰å¯¹è±¡çš„æŒ‡é’ˆï¼Œè®©è¿­ä»£å™¨çŸ¥é“å½“å‰è¿­ä»£çš„å®¹å™¨å¯¹è±¡ï¼Œä¸åŒå®¹å™¨ä¹‹é—´ä¸èƒ½ç›¸äº’æ¯”è¾ƒ
    
        vector<T, Alloc> *_pVec;
        
    
*   å¢åŠ ä¸€ä¸ªç»“æ„ä½“ç»´æŠ¤äº†ä¸€ä¸ªé“¾è¡¨ã€‚curæ˜¯æŒ‡å‘æŸä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿­ä»£å™¨ä¸­å­˜æœ‰â‘ è¯¥è¿­ä»£å™¨æ˜¯å“ªä¸ªç±»å¯¹è±¡â‘¡è¯¥è¿­ä»£å™¨æŒ‡å‘å“ªä¸ªå…ƒç´ ï¼›åˆå®šä¹‰äº†ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªIterator\_BaseèŠ‚ç‚¹çš„æŒ‡é’ˆï¼›å¤–é¢å®šä¹‰äº†ä¸€ä¸ªå¤´èŠ‚ç‚¹\_headï¼Œè®°å½•äº†ç”¨æˆ·ç”³è¯·çš„è¿­ä»£å™¨ï¼Œè®°å½•åœ¨Iterator\_Baseé“¾è¡¨ä¸­
    

![image-20220324175933945](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081036818.png)

*   verifyæ£€æŸ¥æœ‰æ•ˆæ€§ã€‚åœ¨æˆ‘ä»¬å¢åŠ æˆ–åˆ é™¤åï¼ŒæŠŠæˆ‘ä»¬å½“å‰èŠ‚ç‚¹çš„åœ°å€åˆ°æœ«å°¾çš„åœ°å€ï¼Œå…¨éƒ¨è¿›è¡Œæ£€æŸ¥ï¼Œåœ¨å­˜å‚¨çš„è¿­ä»£å™¨é“¾è¡¨ä¸Šè¿›è¡Œéå†ï¼Œå“ªä¸€ä¸ªè¿­ä»£å™¨æŒ‡é’ˆæŒ‡å‘çš„è¿­ä»£å™¨è¿­ä»£å…ƒç´ çš„æŒ‡é’ˆåœ¨æ£€æŸ¥èŒƒå›´å†…ï¼Œå°±å°†ç›¸åº”è¿­ä»£å™¨æŒ‡å‘å®¹å™¨çš„æŒ‡é’ˆç½®ä¸ºç©ºï¼Œå³ä¸ºå¤±æ•ˆçš„è¿­ä»£å™¨

    void verify(T *first, T *last)
    {
    	Iterator_Base *pre = &this->_head;
    	Iterator_Base *it = this->_head._next;
    	while (it != nullptr)
    	{
    		if (it->_cur->_ptr > first && it->_cur->_ptr <= last)
    		{
    			//è¿­ä»£å™¨å¤±æ•ˆï¼ŒæŠŠiteratoræŒæœ‰çš„å®¹å™¨æŒ‡é’ˆç½®nullptr
    			it->_cur->_pVec = nullptr;
    			//åˆ é™¤å½“å‰è¿­ä»£å™¨èŠ‚ç‚¹ï¼Œç»§ç»­åˆ¤æ–­åé¢çš„è¿­ä»£å™¨èŠ‚ç‚¹æ˜¯å¦å¤±æ•ˆ
    			pre->_next = it->_next;
    			delete it;
    			it = pre->_next;
    		}
    		else
    		{
    			pre = it;
    			it = it->_next;
    		}
    	}
    }
    
    

*   !=è¿ç®—ç¬¦å·é‡è½½å‰è¦æ£€æŸ¥è¿­ä»£å™¨çš„æœ‰æ•ˆæ€§ï¼Œå³ä¸¤ä¸ªè¿­ä»£å™¨æ¯”è¾ƒä¹‹å‰æ£€æŸ¥æ˜¯å¦å¤±æ•ˆï¼Œæˆ–è€…æ˜¯å¦æ˜¯åŒä¸€ç±»å‹å®¹å™¨çš„è¿­ä»£å™¨ã€‚ ++ã€\*è¿ç®—ç¬¦ä¹Ÿéœ€è¦æ£€éªŒå…¶æœ‰æ•ˆæ€§
    
        bool operator!=(const iterator &it)const
        {
        	//æ£€æŸ¥è¿­ä»£å™¨çš„æœ‰æ•ˆæ€§
        	if (_pVec == nullptr || _pVec != it._pVec)//è¿­ä»£å™¨ä¸ºç©ºæˆ–è¿­ä»£ä¸¤ä¸ªä¸åŒå®¹å™¨
        	{
        		throw "iterator incompatable!";
        	}
        	return _ptr != it._ptr;
        }
        //++ã€*ä¹Ÿä¸€æ ·ï¼›
        
    
*   pop\_backä¸­åŠ å…¥äº†verfiyï¼Œ è‡ªå®šä¹‰insertå®ç°(æœªè€ƒè™‘æ‰©å®¹ä¸ptråˆæ³•æ€§ï¼ŒåŠ å…¥verifyæ“ä½œï¼Œè¿˜æœ‰å¾€åç§»åŠ¨æ•°æ®)ï¼Œè‡ªå®šä¹‰eraseå®ç°ï¼ˆåŠ å…¥verifyæ“ä½œï¼Œè¿˜æœ‰å¾€å‰ç§»åŠ¨æ•°æ®ï¼‰ï¼›
    

    void pop_back()//å°¾åˆ 
    {
    	if (empty()) return;
    	verify(_last - 1, _last);
    	//ä¸ä»…è¦æŠŠ_lastæŒ‡é’ˆ--ï¼Œè¿˜éœ€è¦ææ„åˆ é™¤çš„å…ƒç´ 
    	--_last;
    	_allocator.destroy(_last);
    }
    //è‡ªå®šä¹‰vectorå®¹å™¨insertæ–¹æ³•å®ç°
    iterator insert(iterator it, const T &val)
    {
    	//1.è¿™é‡Œæˆ‘ä»¬æœªè€ƒè™‘æ‰©å®¹
    	//2.è¿˜æœªè€ƒè™‘it._ptræŒ‡é’ˆåˆæ³•æ€§ï¼Œå‡è®¾å®ƒåˆæ³•
    	verify(it._ptr - 1, _last);
    	T *p = _last;
    	while (p > it._ptr)
    	{
    		_allocator.construct(p, *(p-1));
    		_allocator.destroy(p - 1);
    		p--;
    	}
    	_allocator.construct(p, val);
    	_last++;
    	return iterator(this, p);
    }
    //è‡ªå®šä¹‰vectorå®¹å™¨eraseæ–¹æ³•å®ç°
    iterator erase(iterator it)
    {
    	verify(it._ptr - 1, _last);
    	T *p = it._ptr;
    	while (p < _last-1)
    	{
    		_allocator.destroy(p);
    		_allocator.construct(p, *(p+1));
    		p++;
    	}
    	_allocator.destroy(p);
    	_last--;
    	return iterator(this, it._ptr);
    }
    

æ€»ç»“ï¼švectorä¼šæœ‰ç»´æŠ¤è¿­ä»£å™¨çš„é“¾è¡¨ï¼Œåœ¨vectorè¿­ä»£å™¨ä¸­ï¼Œå¦‚æœæœ‰æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆä¸è¿™äº›ä½ç½®æœ‰å…³è”çš„è¿­ä»£å™¨ï¼ˆæ¯”å¦‚åœ¨æ’å…¥åˆ é™¤åé¢ï¼‰ä¼šå…¨éƒ¨å¤±æ•ˆï¼Œå› ä¸ºä¼šç”¨verifyå‡½æ•°å°†è¿­ä»£å™¨å¤±æ•ˆï¼Œå¤±æ•ˆåä»€ä¹ˆæ“ä½œéƒ½ä¼šå¤±è´¥ï¼›

æ€»ä»£ç ï¼š

    #include<iostream>
    #include<algorithm>
    
    using namespace std;
    
    //å®¹å™¨çš„ç©ºé—´é…ç½®å™¨
    template <typename T>
    struct Allocator
    {
    	T* allocate(size_t size)//åªè´Ÿè´£å†…å­˜å¼€è¾Ÿ
    	{
    		return (T*)malloc(sizeof(T) * size);
    	}
    	void deallocate(void* p)//åªè´Ÿè´£å†…å­˜é‡Šæ”¾
    	{
    		free(p);
    	}
    	void construct(T* p, const T& val)//å·²ç»å¼€è¾Ÿå¥½çš„å†…å­˜ä¸Šï¼Œè´Ÿè´£å¯¹è±¡æ„é€ 
    	{
    		new (p) T(val);//å®šä½newï¼ŒæŒ‡å®šå†…å­˜ä¸Šæ„é€ valï¼ŒT(val)æ‹·è´æ„é€ 
    	}
    	void destroy(T* p)//åªè´Ÿè´£å¯¹è±¡ææ„
    	{
    		p->~T();//~T()ä»£è¡¨äº†Tç±»å‹çš„ææ„å‡½æ•°
    	}
    };
    
    //####1
    template <typename T, typename Alloc = Allocator<T>>
    class vector//å‘é‡å®¹å™¨
    {
    public:
    	vector(int size = 10)//æ„é€ 
    	{
    		_first = _allocator.allocate(size);
    		_last = _first;
    		_end = _first + size;
    	}
    	~vector()//ææ„
    	{
    		for (T* p = _first; p != _last; ++p)
    		{
    			_allocator.destroy(p);//æŠŠ_firstæŒ‡é’ˆæŒ‡å‘çš„æ•°ç»„çš„æœ‰æ•ˆå…ƒç´ ææ„
    		}
    		_allocator.deallocate(_first);//é‡Šæ”¾å †ä¸Šçš„æ•°ç»„å†…å­˜
    		_first = _last = _end = nullptr;
    	}
    	vector(const vector<T>& rhs)//æ‹·è´æ„é€ 
    	{
    		int size = rhs._end - rhs._first;//ç©ºé—´å¤§å°
    		_first = _allocator.allocate(size);
    		int len = rhs._last - rhs._first;//æœ‰æ•ˆå…ƒç´ 
    		for (int i = 0; i < len; ++i)
    		{
    			_allocator.construct(_first + i, rhs._first[i]);
    		}
    		_last = _first + len;
    		_end = _first + size;
    	}
    	vector<T>& operator=(const vector<T>& rhs)//èµ‹å€¼è¿ç®—ç¬¦é‡è½½
    	{
    		if (this == &rhs)
    		{
    			return *this;
    		}
    
    		for (T* p = _first; p != _last; ++p)
    		{
    			_allocator.destory(p);//æŠŠ_firstæŒ‡é’ˆæŒ‡å‘çš„æ•°ç»„çš„æœ‰æ•ˆå…ƒç´ ææ„
    		}
    		_allocator.deallocate(_first);//é‡Šæ”¾å †ä¸Šçš„æ•°ç»„å†…å­˜
    
    		int size = rhs._end - rhs._first;//ç©ºé—´å¤§å°
    		_first = _allocator.allocate(size);
    		int len = rhs._last - rhs._first;//æœ‰æ•ˆå…ƒç´ 
    		for (int i = 0; i < len; ++i)
    		{
    			_allocator.construct(_first + i, rhs._first[i]);
    		}
    		_last = _first + len;
    		_end = _first + size;
    		return *this;
    	}
    	void push_back(const T& val)//å°¾æ’
    	{
    		if (full())
    		{
    			expand();
    		}
    		_allocator.construct(_last, val);//_lastæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜æ„é€ ä¸€ä¸ªå€¼ä¸ºvalçš„å¯¹è±¡
    		_last++;
    	}
    	void pop_back()//å°¾åˆ 
    	{
    		if (empty()) return;
    		verify(_last - 1, _last); //è°ƒç”¨verify
    		//ä¸ä»…è¦æŠŠ_lastæŒ‡é’ˆ--ï¼Œè¿˜éœ€è¦ææ„åˆ é™¤çš„å…ƒç´ 
    		--_last;
    		_allocator.destroy(_last);
    	}
    	T back()const//è¿”å›å®¹å™¨æœ«å°¾å…ƒç´ å€¼
    	{
    		return *(_last - 1);
    	}
    	bool full()const
    	{
    		return _last == _end;
    	}
    	bool empty()const
    	{
    		return _first == _last;
    	}
    	int size()const//è¿”å›å®¹å™¨ä¸­å…ƒç´ ä¸ªæ•°
    	{
    		return _last - _first;
    	}
    	T& operator[](int index)
    	{
    		if (index < 0 || index >= size())
    		{
    			throw "OutOfRangeException";
    		}
    		return _first[index];
    	}
    
    	//#####2
    	//è¿­ä»£å™¨ä¸€èˆ¬å®ç°æˆå®¹å™¨çš„åµŒå¥—ç±»å‹
    	class iterator
    	{
    	public:
    		friend class vector <T, Alloc>;
    		//æ–°ç”Ÿæˆå½“å‰å®¹å™¨æŸä¸€ä¸ªä½ç½®å…ƒç´ çš„è¿­ä»£å™¨
    		iterator(vector<T, Alloc>* pvec = nullptr
    			, T* ptr = nullptr)
    			:_ptr(ptr), _pVec(pvec)
    		{
    			Iterator_Base* itb = new Iterator_Base(this, _pVec->_head._next); //thisæŒ‡å‘å½“å‰è¿­ä»£å™¨ï¼ˆåœ¨ä¸Šé¢ç±»é‡Œé¢è¡¨ç¤ºä»€ä¹ˆï¼‰ï¼›_pVec->_headè¡¨ç¤ºå½“å‰å¯¹è±¡çš„è¿­ä»£å™¨é“¾è¡¨å¤´
    			_pVec->_head._next = itb;
    		}
    		bool operator!=(const iterator& it)const
    		{
    			//æ£€æŸ¥è¿­ä»£å™¨çš„æœ‰æ•ˆæ€§
    			if (_pVec == nullptr || _pVec != it._pVec)//è¿­ä»£å™¨ä¸ºç©ºæˆ–è¿­ä»£ä¸¤ä¸ªä¸åŒå®¹å™¨
    			{
    				throw "iterator incompatable!";
    			}
    			return _ptr != it._ptr;
    		}
    		void operator++()
    		{
    			//æ£€æŸ¥è¿­ä»£å™¨æœ‰æ•ˆæ€§
    			if (_pVec == nullptr)
    			{
    				throw "iterator incalid!";
    			}
    			_ptr++; //åªæ”¹å˜äº†å½“å‰è¿­ä»£å™¨æŒ‡å‘çš„å…ƒç´ 
    		}
    		T& operator*()
    		{
    			//æ£€æŸ¥è¿­ä»£å™¨æœ‰æ•ˆæ€§
    			if (_pVec == nullptr)
    			{
    				throw "iterator invalid!";
    			}
    			return *_ptr;
    		}
    		const T& operator*()const
    		{
    			if (_pVec == nullptr)
    			{
    				throw "iterator invalid!";
    			}
    			return *_ptr;
    		}
    	private:
    		T* _ptr;//å½“å‰è¿­ä»£å™¨æ˜¯å“ªä¸ªå®¹å™¨å¯¹è±¡ï¼Œæ‰¾åˆ°å½“å‰è¿­ä»£å™¨çš„ç›®æ ‡å€¼
    		vector<T, Alloc>* _pVec;//æŒ‡å‘å½“å‰å¯¹è±¡å®¹å™¨çš„æŒ‡é’ˆ
    	};
    
    	iterator begin()
    	{
    		return iterator(this, _first);
    	}
    	iterator end()
    	{
    		return iterator(this, _last);
    	}
    	//æ£€æŸ¥è¿­ä»£å™¨å¤±æ•ˆ
    	void verify(T* first, T* last)
    	{
    		Iterator_Base* pre = &this->_head;
    		Iterator_Base* it = this->_head._next;
    		while (it != nullptr)
    		{
    			if (it->_cur->_ptr > first && it->_cur->_ptr <= last)
    			{
    				//è¿­ä»£å™¨å¤±æ•ˆï¼ŒæŠŠiteratoræŒæœ‰çš„å®¹å™¨æŒ‡é’ˆç½®nullptr
    				it->_cur->_pVec = nullptr;
    				//åˆ é™¤å½“å‰è¿­ä»£å™¨èŠ‚ç‚¹ï¼Œç»§ç»­åˆ¤æ–­åé¢çš„è¿­ä»£å™¨èŠ‚ç‚¹æ˜¯å¦å¤±æ•ˆ
    				pre->_next = it->_next;
    				delete it;
    				it = pre->_next;
    			}
    			else
    			{
    				pre = it;
    				it = it->_next;
    			}
    		}
    	}
    
    	//è‡ªå®šä¹‰vectorå®¹å™¨insertæ–¹æ³•å®ç°
    	iterator insert(iterator it, const T& val)
    	{
    		//1.è¿™é‡Œæˆ‘ä»¬æœªè€ƒè™‘æ‰©å®¹
    		//2.è¿˜æœªè€ƒè™‘it._ptræŒ‡é’ˆåˆæ³•æ€§ï¼Œå‡è®¾å®ƒåˆæ³•
    		verify(it._ptr - 1, _last); //è°ƒç”¨verify
    		T* p = _last;
    		while (p > it._ptr)
    		{
    			_allocator.construct(p, *(p - 1));
    			_allocator.destroy(p - 1);
    			p--;
    		}
    		_allocator.construct(p, val);
    		_last++;
    		return iterator(this, p);
    	}
    
    	//è‡ªå®šä¹‰vectorå®¹å™¨eraseæ–¹æ³•å®ç°
    	iterator erase(iterator it)
    	{
    		verify(it._ptr - 1, _last); //è°ƒç”¨verify
    		T* p = it._ptr;
    		while (p < _last - 1)
    		{
    			_allocator.destroy(p);
    			_allocator.construct(p, *(p + 1));
    			p++;
    		}
    		_allocator.destroy(p);
    		_last--;
    		return iterator(this, it._ptr);
    	}
    private:
    	T* _first;//èµ·å§‹æ•°ç»„ä½ç½®
    	T* _last;//æŒ‡å‘æœ€åä¸€ä¸ªæœ‰æ•ˆå…ƒç´ åç»§ä½ç½®
    	T* _end;//æŒ‡å‘æ•°ç»„ç©ºé—´çš„åç»§ä½ç½®
    	Alloc _allocator;//å®šä¹‰å®¹å™¨çš„ç©ºé—´é…ç½®å™¨å¯¹è±¡
    
    	//å®¹å™¨è¿­ä»£å™¨å¤±æ•ˆå¢åŠ ä»£ç 
    	struct Iterator_Base
    	{
    		Iterator_Base(iterator* c = nullptr, Iterator_Base* n = nullptr)
    			:_cur(c), _next(n) {}
    		iterator* _cur;
    		Iterator_Base* _next;
    	};
    	Iterator_Base _head; //å­˜è¿­ä»£å™¨çš„é“¾è¡¨
    
    	void expand()//æ‰©å®¹
    	{
    		int size = _end - _first;
    		//T *ptmp = new T[2*size];
    		T* ptmp = _allocator.allocate(2 * size);
    		for (int i = 0; i < size; ++i)
    		{
    			_allocator.construct(ptmp + i, _first[i]);
    			//ptmp[i] = _first[i];
    		}
    		//delete[]_first;
    		for (T* p = _first; p != _last; ++p)
    		{
    			_allocator.destroy(p);
    		}
    		_allocator.deallocate(_first);
    		_first = ptmp;
    		_last = _first + size;
    		_end = _first + 2 * size;
    	}
    };
    
    int main() {
    	vector<int> vec;
    	for (int i = 0; i < 5; ++i)
    	{
    		vec.push_back(i);
    	}
    
    	auto it3 = vec.end();
    	vec.pop_back(); // it3 å¤±æ•ˆ
    	auto it2 = vec.end();
    	cout << (it3 != it2);
    
    	auto it1 = vec.end();
    	while (it1 != vec.end()) { //å› ä¸ºè¿™æ¡è¯­å¥æœ‰end(),ä¼šæ„é€ è¿­ä»£å™¨ï¼ŒåŠ å¤šäº†vecè¿­ä»£å™¨é“¾è¡¨ä¸­çš„å…ƒç´ ï¼›ä½†æ˜¯æ¯æ¬¡ç”Ÿæˆçš„éƒ½æ˜¯æœ€åä¸€ä¸ªå…ƒç´ çš„è¿­ä»£å™¨ï¼›
    		++it1;
    	}
    	vec.pop_back();//verify(_last-1, _last)
    	auto it2 = vec.end();
    	cout << (it1 != it2) << endl;
    	return 0;
    }
    

6.æ·±å…¥ç†è§£newå’Œdeleteçš„åŸç†
-------------------

â‘ **newä¸deleteå®ç°åŸç†è¿›è¡Œå‰–æ**

mallocå’Œnewï¼š

*   mallocæŒ‰å­—èŠ‚å¼€è¾Ÿå†…å­˜çš„ï¼›newå¼€è¾Ÿå†…å­˜æ—¶éœ€è¦æŒ‡å®šç±»å‹ï¼›
*   mallocå¼€è¾Ÿå†…å­˜è¿”å›çš„éƒ½æ˜¯void \* ï¼Œnewç›¸å½“äºè¿ç®—ç¬¦é‡è½½å‡½æ•°ï¼Œè¿”å›å€¼è‡ªåŠ¨è½¬ä¸ºæŒ‡å®šçš„ç±»å‹çš„æŒ‡é’ˆã€‚
*   mallocåªè´Ÿè´£å¼€è¾Ÿå†…å­˜ç©ºé—´ï¼Œnewä¸ä»…ä»…ä¹Ÿæœ‰mallocåŠŸèƒ½ï¼Œè¿˜å¯ä»¥è¿›è¡Œæ•°æ®çš„åˆå§‹åŒ–ï¼ˆä½¿ç”¨æ„é€ å‡½æ•°ï¼‰ã€‚
*   mallocå¼€è¾Ÿå†…å­˜å¤±è´¥è¿”å›nullptræŒ‡é’ˆï¼›newæŠ›å‡ºçš„æ˜¯bad\_allocç±»å‹çš„å¼‚å¸¸ã€‚
*   mallocå¼€è¾Ÿå•ä¸ªå…ƒç´ å†…å­˜ä¸æ•°ç»„å†…å­˜ çš„å†…å­˜è®¡ç®—æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ç»™æ‰€æœ‰å…ƒç´ æ‰€éœ€è¦çš„å­—èŠ‚æ•°ï¼ˆæ¯”å¦‚ä¸€ä¸ªint 4ä¸ªå­—èŠ‚ï¼Œint arr\[2\] 8ä¸ªå­—èŠ‚ï¼‰ï¼›newå¼€è¾Ÿæ—¶ï¼Œå¦‚æœå…ƒç´ æ˜¯ç¼–è¯‘å™¨å†…ç½®ç±»å‹ï¼Œåˆ™å’Œmallocä¸€æ ·ï¼ˆmallocéœ€è¦è‡ªå·±ç®—ï¼Œnewä¸ç”¨ï¼‰ï¼›ä½†æ˜¯å¯¹äºç±»å¯¹è±¡ï¼Œå¯¹å•ä¸ªå…ƒç´ å†…å­˜åé¢ä¸éœ€è¦\[\]ï¼Œå†…å­˜å¤§å°ä¹Ÿå’Œå…ƒç´ æ‰€éœ€è¦çš„å­—èŠ‚æ•°ä¸€æ ·ï¼ˆä¸€ä¸ª int 4ä¸ªå­—èŠ‚ï¼‰ï¼›æ•°ç»„éœ€è¦åŠ ä¸Š\[\]å¹¶ç»™ä¸Šå…ƒç´ ä¸ªæ•°ï¼Œå­—èŠ‚æ•°åˆ™æ˜¯æ˜¯ æ‰€æœ‰å…ƒç´ æ‰€éœ€å­—èŠ‚æ•° + 4ä¸ªå­—èŠ‚ï¼ˆè®°å½•æœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼‰ï¼› å¯ä»¥çœ‹æœ€åçš„è§£æ

deleteå’Œfree

*   freeä¸ç®¡é‡Šæ”¾å•ä¸ªå…ƒç´ å†…å­˜è¿˜æ˜¯æ•°ç»„å†…å­˜ï¼Œåªéœ€è¦ä¼ å…¥å†…å­˜çš„èµ·å§‹åœ°å€å³å¯ã€‚
*   deleteé‡Šæ”¾å•ä¸ªå…ƒç´ å†…å­˜ï¼Œä¸éœ€è¦åŠ ä¸­æ‹¬å·ï¼Œä½†é‡Šæ”¾æ•°æ®å†…å­˜æ—¶éœ€è¦åŠ ä¸­æ‹¬å·ã€‚ä¸­æ‹¬å·ï¼š\[\]
*   freeåªæœ‰ä¸€æ­¥ï¼Œå°±æ˜¯é‡Šæ”¾å†…å­˜ï¼›deleteæ‰§è¡Œå…¶å®æœ‰ä¸¤æ­¥ï¼Œå…ˆè°ƒç”¨ææ„ï¼Œå†é‡Šæ”¾å†…å­˜

â‘¡**newä¸deleteå®ç°åŸç†å‰–æ**

`int* p = new int; delete p;`

åæ±‡ç¼–ä¸ºï¼š

![image-20220325005827341](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081056038.png)

æˆ‘ä»¬å‘ç°ï¼Œ**å…¶å®newå’Œdeleteçš„æœ¬è´¨æ˜¯æœ‰å¯¹newå’Œdeleteé‡è½½å‡½æ•°çš„è°ƒç”¨**ï¼š`new -> operator new delete -> operator delete`

**å®ç°ä¸€ä¸‹operator newå’Œ operator deleteï¼š**

    //new:å…ˆè°ƒç”¨operatorå¼€è¾Ÿå†…å­˜ç©ºé—´ï¼Œç„¶åè°ƒç”¨å¯¹è±¡çš„æ„é€ å‡½æ•°
    void* operator new(size_t size)
    {
    	void *p = malloc(size);
    	if (p == nullptr)
    	{
    		throw bad_alloc();
    	}
    	cout << "operator new addr:" << p <<endl;
    	return p;
    }
    
    //operator new[]å®ç°
    void* operator new[](size_t size)
    {
    	void *p = malloc(size);
    	if (p == nullptr)
    	{
    		throw bad_alloc();
    	}
    	cout << "operator new[] addr:" << p <<endl;
    	return p;
    }
    
    //delete p:è°ƒç”¨pæŒ‡å‘å¯¹è±¡çš„ææ„å‡½æ•°ï¼Œå†è°ƒç”¨operator deleteé‡Šæ”¾å†…å­˜ç©ºé—´
    void operator delete(void *ptr)
    {
    	cout << "operator delete addr:" << ptr <<endl;
    	free(ptr);
    }
    //operator delete[]å®ç°
    void operator delete[](void *ptr)
    {
    	cout << "operator delete[] addr:" << ptr <<endl;
    	free(ptr);
    }
    

å…¶ä¸­ï¼Œ`bad_alloc()`å‡½æ•°å®é™…ä»£ç ï¼š

![image-20220325010336014](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081058201.png)

æµ‹è¯•ï¼šä»¥Testç±»ä¸ºä¾‹å­ï¼š

    class Test {
    public:
    	Test(int data = 1): ptr(new int(data)) { cout << "Test()" << endl; }
    	~Test() { cout << "~Test()" << endl; }
    privateï¼š
        int *ptr;
    };
    int main() {
    	Test* ptr = new Test;
    	delete ptr;
    	cout << endl;
    	Test *test = new Test[2];
    	delete[]test;
    	return 0;
    }
    

![image-20220325012721720](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081058293.png)

â‘¢é‡è¦é—®é¢˜ï¼š**new å’Œdeleteèƒ½å¤Ÿæ··ç”¨å—ï¼Ÿ**

æˆ‘ä»¬çœ‹çœ‹c++ç¼–è¯‘å™¨å†…ç½®ç±»å‹ï¼š

ä»¥intä¸ºä¾‹å­ï¼š

    int *p = new int;
    delete[]p;
    
    int *q = new int[10];
    delete q;
    

![image-20220325013215094](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081059028.png)

æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼ï¼ï¼å› ä¸ºå¯¹äºæ•´å‹æ¥è¯´ï¼Œæ²¡æœ‰æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°ï¼Œé’ˆå¯¹äºintç±»å‹ï¼Œnewä¸deleteåŠŸèƒ½åªå‰©ä¸‹mallocä¸freeåŠŸèƒ½ï¼Œå¯ä»¥å°†å…¶æ··ç”¨ã€‚

æˆ‘ä»¬çœ‹çœ‹ç±» ç±»å‹ï¼š

ä»¥ä¸Šè¿°çš„Testä¸ºä¾‹å­ï¼š

    Test *p1 = new Test();
    delete[]p1;
    
    Test *p2 = new Test[5];
    delete p2;
    

![image-20220325013640472](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081059138.png)

ç¬¬ä¸€ä¸ªä¼šä¸€ç›´ä¸æ–­æ­»å¾ªç¯ï¼Œç¬¬äºŒä¸ªä¼šè§¦å‘å¼‚å¸¸ï¼›

**å…·ä½“åŸå› ï¼š**

æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªtestå¯¹è±¡æ˜¯åªæœ‰ä¸€ä¸ªæ•´å‹æŒ‡é’ˆæˆå‘˜å˜é‡ï¼Œåªå ç”¨å››ä¸ªå­—èŠ‚çš„ï¼›è€ŒTest\[5\]è¿™é‡Œåˆ†é…äº†5ä¸ªtestå¯¹è±¡ã€‚deleteæ—¶å…ˆè°ƒç”¨ææ„å‡½æ•°ï¼ŒthisæŒ‡é’ˆéœ€è¦å°†æ­£ç¡®çš„å¯¹è±¡çš„åœ°å€ä¼ å…¥ææ„å‡½æ•°ä¸­ï¼ŒåŠ äº†\[\]è¡¨ç¤ºæœ‰å¥½å‡ ä¸ªå¯¹è±¡ï¼Œå¯¹æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½è¦è¿›è¡Œææ„ã€‚ä½†deleteçœŸæ­£æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼Œåº•å±‚æ˜¯mallocæŒ‰å­—èŠ‚å¼€è¾Ÿï¼Œå¹¶ä¸çŸ¥é“æ˜¯å¦å¼€è¾Ÿäº†5ä¸ªtestå¯¹è±¡çš„æ•°ç»„ï¼Œå› æ­¤è¿˜è¦å†å¤šå¼€è¾Ÿä¸€ä¸ª4å­—èŠ‚æ¥å­˜å‚¨å¯¹è±¡çš„ä¸ªæ•°ï¼Œå‡è®¾å®ƒçš„åœ°å€æ˜¯0x100ï¼›ä½†æ˜¯newå®Œä¹‹åp2è¿”å›çš„åœ°å€æ˜¯0x104åœ°å€ï¼Œæ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ã€‚å½“æˆ‘ä»¬æ‰§è¡Œdelete\[\]æ—¶ï¼Œä¼šåˆ°å‰å››ä¸ª4å­—èŠ‚æ¥å–ä¸€ä¸‹å¯¹è±¡çš„ä¸ªæ•°ï¼Œå°†çŸ¥é“äº†æ˜¯5ä¸ªå¹¶å°†è¿™å—å†…å­˜å¹³å‡åˆ†ä¸º5ä»½ï¼Œå°†å…¶æ¯ä¸€ä»½å¯¹è±¡èµ·å§‹åœ°å€ä¼ ç»™ç›¸åº”çš„ææ„å‡½æ•°ï¼Œæ­£å¸¸ææ„ï¼Œæœ€åå°†0x100å¼€å§‹çš„4å­—èŠ‚ä¹Ÿé‡Šæ”¾ã€‚  
è€Œä¸Šè¿°ä¸­p2å‡ºé”™æ˜¯ç»™ç”¨æˆ·è¿”å›çš„ç¬¬ä¸€ä¸ªå¯¹è±¡çš„èµ·å§‹åœ°å€ï¼Œdelete p2è®¤ä¸ºp2åªæ˜¯æŒ‡å‘äº†ä¸€ä¸ªå¯¹è±¡ï¼Œåªå°†Test\[0\]å¯¹è±¡ææ„ï¼Œç›´æ¥ä»0x104 free(p2)ï¼Œä½†åº•å±‚å®é™…æ˜¯ä»0x100å¼€è¾Ÿçš„ï¼Œå› æ­¤å´©æºƒå­˜åœ¨å¼‚å¸¸ï¼›è€Œp1å‡ºé”™åˆ™å¾ˆæ˜æ˜¾ï¼šp1åªæ˜¯å•ä¸ªå…ƒç´ ï¼Œä»0x104å¼€å§‹å¼€è¾Ÿå†…å­˜ï¼Œä½†æ˜¯delete\[\]p1ï¼Œé‡Œé¢å¹¶æ²¡æœ‰é‚£ä¹ˆå¤šå…ƒç´ ï¼Œæœ€åè¿˜é‡Šæ”¾äº†4ä¸ªå­—èŠ‚çš„å­˜å‚¨å¯¹è±¡ä¸ªæ•°çš„å†…å­˜(å³ä»0x100é‡Šæ”¾)å› æ­¤å´©æºƒã€‚

![image-20220325021928139](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081102331.png)

æ€»ç»“ï¼š**1.å¯¹äºæ™®é€šçš„ç¼–è¯‘å™¨å†…ç½®ç±»å‹new/delete\[\]æ··ç”¨æ˜¯å¯ä»¥çš„ï¼›new\[\]/deleteæ··ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚** **2.è‡ªå®šä¹‰çš„ç±»ç±»å‹ï¼Œæœ‰ææ„å‡½æ•°ï¼Œä¸ºäº†è°ƒç”¨æ­£ç¡®çš„ææ„å‡½æ•°ï¼Œé‚£ä¹ˆå¼€è¾Ÿå¯¹è±¡æ•°ç»„æ—¶ä¼šå¤šå¼€è¾Ÿ4ä¸ªå­—èŠ‚è®°å½•å¯¹è±¡çš„ä¸ªæ•°ï¼Œä¸èƒ½æ··ç”¨ã€‚**

â‘£æ‰©å±•é—®é¢˜ï¼š**C++ä¸­å¦‚ä½•è®¾è®¡ä¸€ä¸ªç¨‹åºæ£€æŸ¥å†…å­˜æ³„éœ²é—®é¢˜ï¼Ÿ**

**æ ¸å¿ƒæ˜¯ç”¨newä¸deleteè¿ç®—ç¬¦é‡è½½æ¥ç®¡æ•´ä¸ªåº”ç”¨çš„å†…å­˜ç®¡ç†ï¼Œå¯¹å†…å­˜å¼€è¾Ÿé‡Šæ”¾éƒ½è¦è®°å½•ã€‚** æ£€æŸ¥å†…å­˜æ³„éœ²ï¼Œåœ¨å…¨å±€ä¸­é‡å†™newä¸deleteï¼Œnewæ“ä½œä¸­ç”¨æ˜ å°„è¡¨è®°å½•ä¸€ä¸‹éƒ½æœ‰å“ªäº›å†…å­˜è¢«å¼€è¾Ÿè¿‡äº†ï¼›deleteæ—¶å€™ï¼Œå°†ç›¸åº”çš„å†…å­˜èµ„æºç”¨å†…å­˜åœ°å€æ ‡è¯†ï¼Œå†åˆ é™¤æ‰ã€‚å¦‚æœæ•´ä¸ªç³»ç»Ÿè¿è¡Œå®Œå‘ç°æ˜ å°„è¡¨ä¸­æœ‰ä¸€äº›å†…å­˜è¿˜æ²¡æœ‰è¢«é‡Šæ”¾åˆ™å­˜åœ¨å†…å­˜æ³„éœ²ï¼›

7.newå’Œdeleteé‡è½½å®ç°çš„å¯¹è±¡æ± å¼•ç”¨
----------------------

\*\*å¯¹è±¡æ± ï¼š \*\* **åœ¨ä¸€éƒ¨åˆ†å†…å­˜ç©ºé—´ï¼ˆæ± å­ï¼‰ä¸­äº‹å…ˆå®ä¾‹åŒ–å¥½å›ºå®šæ•°é‡çš„å¯¹è±¡ï¼Œå½“éœ€è¦ä½¿ç”¨æ± ä¸­çš„å¯¹è±¡æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­è¯¥æ± ä¸­æ˜¯å¦æœ‰é—²ç½®ï¼ˆæš‚æœªä½¿ç”¨ï¼‰çš„å¯¹è±¡ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å–å‡ºä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åœ¨æ± ä¸­åˆ›å»ºè¯¥å¯¹è±¡ã€‚å½“ä¸€ä¸ªå¯¹è±¡ä¸å†è¢«ä½¿ç”¨æ—¶ï¼Œå…¶åº”è¯¥å°†å…¶æ”¾å›å¯¹è±¡æ± ï¼Œä»¥ä¾¿åæ¥çš„ç¨‹åºä½¿ç”¨ï¼Œæœ€åç¨‹åºç»“æŸçš„æ—¶å€™ï¼Œå†ç»Ÿä¸€é‡Šæ”¾ï¼›**

ä¸ºä»€ä¹ˆéœ€è¦å¯¹è±¡æ± ï¼šå› ä¸ºå¤§é‡çš„pushå’Œpopæ“ä½œï¼Œä¼šä¸æ–­ç”³è¯·å’Œé‡Šæ”¾ç©ºé—´ï¼Œå½±å“æ€§èƒ½ï¼›æ‹¿Queueä¸ºä¾‹å­ï¼š

    #include<iostream>
    
    using namespace std;
    
    template<typename T>
    class Queue {
    public:
    	Queue(){
    		_front = _rear = new QueueItem(); //æä¾›ä¸€ä¸ªç©ºèŠ‚ç‚¹
    	}
    	~Queue() {
    		QueueItem* cur = _front;
    		while (cur != nullptr) {
    			_front = _front->next;
    			delete cur;
    			cur = _front;
    		}
    	}
    	void push(const T &val) { //é˜Ÿå°¾å…¥é˜Ÿ
    		QueueItem* item = new QueueItem(val);
    		_rear->next = item;
    		_rear = item;
    	}
    	void pop() { //é˜Ÿå¤´å‡ºé˜Ÿ, ä¸ç”¨è¿”å›å€¼,è®°ä½é˜Ÿå¤´ä¸ºç©º
    		if (empty()) throw "é˜Ÿåˆ—ä¸ºç©º";
    		QueueItem* item = _front->next;
    		_front->next = item->next;
    		if (_front->next == nullptr) { //è¯´æ˜åªæœ‰ä¸€ä¸ªå…ƒç´ ;
    			_rear = _front;
    		}
    		delete item;
    	}
    	T front()const { //åªè¯»æ“ä½œæ‰€ä»¥åŠ const
    		if (empty()) throw "é˜Ÿåˆ—ä¸ºç©º";
    		return _front->next->_data; //å¯¹è±¡æ‰æœ‰ç‚¹æ“ä½œï¼ŒæŒ‡é’ˆæ˜¯ç®­å¤´æ“ä½œ,æœ‰å¤šä¸ªnextå› ä¸ºæœ‰ç©ºçš„å¤´èŠ‚ç‚¹
    	}
    	bool empty()const { return _rear == _front; } //åªè¯»æ“ä½œ
    
    private:
    	struct QueueItem //æƒ³åšä¸€ä¸ªå¯¹è±¡æ± ï¼ˆ10000ä¸ªQueueItemçš„èŠ‚ç‚¹ï¼‰ï¼Œä¸ç”¨å¤§é‡newå’Œdeleteï¼Œç”¨åˆ°å°±é‡Œé¢æ‹¿ï¼Œä¸ç”¨å°±å½’è¿˜ï¼Œç¨‹åºå‘˜æ¥å†…å­˜ç®¡ç†
    	{
    		QueueItem(T data = T()): _data(data), next(nullptr) {} //ç•™æ„ä¸€ä¸‹ï¼Œè¿™ä¸ªT data = T()æ“ä½œ
    		T _data;
    		QueueItem* next;
    	};
    	QueueItem* _front; //é˜Ÿå¤´
    	QueueItem* _rear; //é˜Ÿå°¾
    };
    
    int main() {
    	Queue<int> que;
    	for (int i = 0; i < 1000000; ++i)
    	{
    		que.push(i); //è¿™é‡Œå­˜åœ¨å¤§é‡çš„newå’Œdelete
    		que.pop(); //
    	}
    	cout << que.empty() << endl;
    	return 0;
    }
    

è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼šæ¯æ¬¡pushéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡new QueueItemï¼Œæ¯æ¬¡popéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡QueueItemçš„deleteï¼›è€ŒèŠ‚ç‚¹ä¸åŒçš„æ˜¯åªæ˜¯ç»“ç‚¹ä¸­æ•°æ®ä¸åŒï¼ŒçŸ­æ—¶é—´å†…å¤§é‡å¯¹å…¶è¿›è¡Œè°ƒç”¨ï¼Œä¼šå½±å“æˆ‘ä»¬ç¨‹åºçš„æ€§èƒ½ã€‚æ‰€ä»¥é‡‡ç”¨å¯¹è±¡æ± æ›´ä½³ï¼Œå¯¹è±¡æ± æ¨¡å‹å¦‚ä¸‹ï¼š

![image-20220325093445118](https://fastly.jsdelivr.net/gh/little-boy-David/blog-img/images202206081105459.png)

å¯çŸ¥ï¼šç¬¬ä¸€æ¬¡å¯¹è±¡æ± ç”Ÿæˆçš„å¯¹è±¡å…¨éƒ¨ç”¨å®Œï¼Œä¼šé‡æ–°å¼€è¾Ÿæ–°å¯¹è±¡åœ¨å¯¹è±¡æ± ä¸­ï¼Œå¦‚æœå½’è¿˜ç¬¬ä¸€æ¬¡å¼€è¾Ÿçš„å¯¹è±¡ï¼Œä¹Ÿä¼šé“¾æ¥åˆ°å¯¹è±¡æ± ç©ºé—²å¯¹è±¡ä¸­

å¯¹è±¡æ± å®ç°ï¼š

    #include<iostream>
    
    using namespace std;
    
    template<typename T>
    class Queue {
    public:
    	Queue(){
    		_front = _rear = new QueueItem(); //æä¾›ä¸€ä¸ªç©ºèŠ‚ç‚¹
    	}
    	~Queue() {
    		QueueItem* cur = _front;
    		while (cur != nullptr) {
    			_front = _front->next;
    			delete cur;
    			cur = _front;
    		}
    	}
    	void push(const T &val) { //é˜Ÿå°¾å…¥é˜Ÿ
    		QueueItem* item = new QueueItem(val); //å…ˆè°ƒç”¨newåœ¨å¯¹è±¡æ± ä¸­æ‹¿å‡ºå¯¹è±¡ï¼Œç„¶åé‡‡ç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–å¯¹è±¡ï¼›å¯ä»¥å’Œä¹‹å‰newæ±‡ç¼–åšäº†ä»€ä¹ˆè¡Œä¸ºè¿›è¡Œå¯¹æ¯”
    		_rear->next = item;
    		_rear = item;
    	}
    	void pop() { //é˜Ÿå¤´å‡ºé˜Ÿ, ä¸ç”¨è¿”å›å€¼,è®°ä½é˜Ÿå¤´ä¸ºç©º
    		if (empty()) throw "é˜Ÿåˆ—ä¸ºç©º";
    		QueueItem* item = _front->next;
    		_front->next = item->next;
    		if (_front->next == nullptr) { //è¯´æ˜åªæœ‰ä¸€ä¸ªå…ƒç´ ;
    			_rear = _front;
    		}
    		delete item;
    	}
    	T front()const { //åªè¯»æ“ä½œæ‰€ä»¥åŠ const
    		if (empty()) throw "é˜Ÿåˆ—ä¸ºç©º";
    		return _front->next->_data; //å¯¹è±¡æ‰æœ‰ç‚¹æ“ä½œï¼ŒæŒ‡é’ˆæ˜¯ç®­å¤´æ“ä½œ,æœ‰å¤šä¸ªnextå› ä¸ºæœ‰ç©ºçš„å¤´èŠ‚ç‚¹
    	}
    	bool empty()const { return _rear == _front; } //åªè¯»æ“ä½œ
    
    private:
    	//æƒ³åšä¸€ä¸ªå¯¹è±¡æ± ï¼ˆ100000ä¸ªQueueItemçš„èŠ‚ç‚¹ï¼‰ï¼Œä¸ç”¨å¤§é‡newå’Œdeleteï¼Œç”¨åˆ°å°±é‡Œé¢æ‹¿ï¼Œä¸ç”¨å°±å½’è¿˜ï¼Œç¨‹åºå‘˜æ¥å†…å­˜ç®¡ç†
    	struct QueueItem
    	{
    		QueueItem(T data = T()): _data(data), next(nullptr) {} //ç•™æ„ä¸€ä¸‹ï¼Œè¿™ä¸ªT data = T()æ“ä½œï¼ï¼ï¼ï¼ï¼ï¼ï¼
    		//QueueItemæä¾›è‡ªå®šä¹‰å†…å­˜ç®¡ç†
    		void* operator new(size_t size){ //ä¼šè‡ªåŠ¨å˜ä¸ºstaticæ–¹æ³•ï¼Œè¿™é‡Œçš„sizeæ²¡æœ‰ç”¨åˆ°
    			if (_itemPool == nullptr) {
    				_itemPool = (QueueItem*)new char[POOL_ITEM_SIZE * sizeof(QueueItem)]; //ä¸ºä»€ä¹ˆå†…å­˜æ± ç”¨charï¼Ÿ
    				QueueItem* p = _itemPool;//æŒ‡å‘é¦–åœ°å€
    				for (; p < _itemPool + POOL_ITEM_SIZE - 1; ++p) { //æœ€åä¸€ä¸ªå…ƒç´ æŒ‡å‘ç©ºï¼Œä¸éœ€è¦éå†åˆ°æœ€åä¸€ä¸ªå…ƒç´ 
    					p->next = p + 1;
    				}
    				p->next = nullptr;
    			}
    			QueueItem* p = _itemPool; 
    			_itemPool = _itemPool->next;
    			return p;
    		}
    
    		void operator delete(void* ptr) { //ä½¿ç”¨void*ï¼Œè‡ªåŠ¨å˜ä¸ºé™æ€æ–¹æ³•
    			QueueItem* p = (QueueItem*)ptr;
    			p->next = _itemPool;
    			_itemPool = p;
    		}
    		T _data;
    		QueueItem* next;
    		static QueueItem* _itemPool; //å†…å­˜æ± æŒ‡é’ˆ
    		static const int POOL_ITEM_SIZE = 100000;
    	};
    	QueueItem* _front; //é˜Ÿå¤´
    	QueueItem* _rear; //é˜Ÿå°¾
    };
    template <typename T>
    typename Queue<T>::QueueItem *Queue<T>::QueueItem::_itemPool = nullptr; //è®°ä½æ ·ä¾‹
    
    int main() {
    	Queue<int> que;
    	for (int i = 0; i < 1000000; ++i)
    	{
    		que.push(i); //ç”¨å¯¹è±¡æ± å¤„ç†
    		que.pop(); //
    	}
    	cout << que.empty() << endl;
    	return 0;
    }
    

[ä»€ä¹ˆæ˜¯0æ„é€ ](https://blog.csdn.net/qq_43579888/article/details/111437152?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_utm_term~default-1.pc_relevant_antiscanv2&spm=1001.2101.3001.4242.2&utm_relevant_index=4)