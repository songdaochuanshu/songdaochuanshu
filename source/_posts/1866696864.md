---
layout: post
title: "æ‰‹æŠŠæ‰‹æ•™ä½ ç©è½¬ Giteaï½œä½¿ç”¨ Docker å®‰è£… Gitea"
date: "2022-09-29T22:23:08.804Z"
---
æ‰‹æŠŠæ‰‹æ•™ä½ ç©è½¬ Giteaï½œä½¿ç”¨ Docker å®‰è£… Gitea
================================

![æ‰‹æŠŠæ‰‹æ•™ä½ ç©è½¬ Giteaï½œä½¿ç”¨ Docker å®‰è£… Gitea](https://img2022.cnblogs.com/blog/2956540/202209/2956540-20220927202342451-1450911419.png) ä»å®¹å™¨é•œåƒå®‰è£… Gitea çš„è¿‡ç¨‹éå¸¸ç®€å•çš„ï¼Œå ªæ¯”â€œä¸€é”®å¼â€å®‰è£…ã€‚Gitea å®‰è£…ä½¿ç”¨ç³»åˆ—æ•™ç¨‹å°†ä¼šä»å¤šç§æ–¹å¼è¿›è¡Œå…¨æ–¹ä½çš„å®æ“æ¼”ç¤ºã€‚

[ä½¿ç”¨ Docker å®‰è£… Gitea](https://www.cnblogs.com/Gitea/p/docker.html) çš„è¿‡ç¨‹éå¸¸ç®€å•çš„ï¼Œå ªæ¯”â€œä¸€é”®å¼â€å®‰è£…ã€‚Gitea å®‰è£…ä½¿ç”¨ç³»åˆ—æ•™ç¨‹å°†ä¼šä»å¤šç§æ–¹å¼è¿›è¡Œå…¨æ–¹ä½çš„å®æ“æ¼”ç¤ºã€‚

> ğŸ“º[è§†é¢‘æ¼”ç¤º](https://mp.weixin.qq.com/s/04PfakBqoYfmIYV1rDULcA)ä¸­ä½¿ç”¨è…¾è®¯äº‘å®éªŒç¯å¢ƒ[å®‰è£… Docker å¹¶å¿«é€Ÿå¯åŠ¨ Gitea](https://cloud.tencent.com/lab/courseDetail/1354756567073273)

ç¯å¢ƒå‡†å¤‡
----

### æœåŠ¡å™¨é…ç½®

OS

Version

CPU

RAM

Debian Linux

`bullseye`

2 Core

4GB

æœ¬æ–‡æ‰€é‡‡ç”¨çš„æœåŠ¡å™¨é…ç½®å¦‚ä¸‹ï¼Œå»ºè®®å†…å­˜æœ€å°‘åœ¨ 1GB ä»¥ä¸Šã€‚OS ç‰ˆæœ¬å¯ä»¥æ˜¯ Debianã€Ubuntuã€Fedora ä»¥åŠ CentOSï¼Œæœ¬æ–‡ä¼˜å…ˆä½¿ç”¨ Debianï¼Œå…¶ä»–ç³»ç»Ÿå‘è¡Œç‰ˆçš„ä¼šåœ¨åç»­æ–‡ç« ä¸­é…Œæƒ…æ¼”ç¤ºã€‚

### Docker è¿è¡Œç¯å¢ƒ

æœ€æ–°çš„ Docker Engine å’Œ Docker Desktop é›†æˆäº† `docker compose` å‘½ä»¤è¡Œå·¥å…·ã€‚æ›´å¤šä¿¡æ¯è¯·å‚é˜…ï¼š

*   Docker Engine å®‰è£…æŒ‡å—ï¼š[https://docs.docker.com/engine/install/](https://docs.docker.com/engine/install/)
*   Docker Engine ä¸€é”®å®‰è£…è„šæœ¬ï¼š `curl -fsSL https://get.docker.com | bash`
*   è§£å†³ docker å‘½ä»¤æ‰§è¡Œæƒé™é—®é¢˜ï¼š[https://docs.docker.com/go/daemon-access/](https://docs.docker.com/go/daemon-access/)
*   æ£€æŸ¥ docker è¿è¡Œç¯å¢ƒï¼š`docker info`

é€‰æ‹©é•œåƒ
----

[Gitea](https://gitea.io) æä¾›äº†æ ‡å‡†çš„å®¹å™¨é•œåƒï¼ˆ[`gitea/gitea`](https://hub.docker.com/r/gitea/gitea)ï¼‰ï¼Œç»Ÿä¸€æ”¯æŒ SQLiteã€MySQLã€PostgreSQL å’Œ SQL Server ä½œä¸ºæ•°æ®åº“åç«¯ã€‚æ¯ä¸ªç‰ˆæœ¬çš„é•œåƒåŒæ—¶æ”¯æŒä¸¤ç§ä¸»æµçš„å¤„ç†å™¨ä½“ç³»ç»“æ„ `amd64` å’Œ `arm64/v8`ã€‚

### é•œåƒæ ‡ç­¾

*   **æœ€æ–°çš„ç¨³å®šç‰ˆ**
    
    `latest`
    
*   **å›ºå®šåœ¨æŸä¸ªç¨³å®šç‰ˆ**
    
    `1.17.2`, `1.17`, `1`
    
*   **æœ€æ–°çš„å¼€å‘ç‰ˆ**ï¼Œéš Gitea ä»£ç åˆå¹¶åŒæ­¥æ›´æ–°
    
    `dev`
    

### Rootless é•œåƒ

[Rootless é•œåƒ](https://docs.gitea.io/en-us/install-with-docker-rootless/)ä½¿ç”¨ Gitea å†…å»ºçš„ Go SSH æä¾› Git æœåŠ¡ï¼Œä»£æ›¿äº† OpenSSHã€‚

åœ¨é€‰ç”¨ rootless é•œåƒæ—¶ï¼ŒåŠ ä¸Šé•œåƒæ ‡ç­¾ `-rootless`ã€‚æ”¯æŒçš„é•œåƒæ ‡ç­¾å¦‚ä¸‹ï¼š

*   `latest-rootless`, `1-rootless`
*   `1.17.2-rootless`
*   `dev-rootless`

å®‰è£… Gitea
--------

### ç¯å¢ƒå˜é‡

åœ¨é›†ç¾¤æ¨¡å¼å®‰è£… Gitea æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ä¸º Gitea å®¹å™¨æŒ‡å®šä¸€äº›å…±äº«çš„åˆå§‹å€¼ï¼Œä¾‹å¦‚ `UID/GID`ã€æ•°æ®åº“è¿æ¥å‚æ•°ã€å…±äº«å¯†é’¥ç­‰ã€‚è¯¸å¦‚æ•°æ®åº“å’Œ Gitea çš„ä¸€äº›åŠŸèƒ½é…ç½®é€‰é¡¹æœ€ç»ˆéƒ½ä¼šåœ¨å®‰è£…å¼•å¯¼ç•Œé¢ç»“æŸåå†™å…¥åˆ° [`app.ini`](https://github.com/go-gitea/gitea/blob/main/custom/conf/app.example.ini) æ–‡ä»¶å¹¶ä¿å­˜ã€‚å› æ­¤ï¼Œå¦‚æœæ˜¯ä½œä¸ºå•å®ä¾‹éƒ¨ç½²çš„ Giteaï¼Œæ‚¨æ— éœ€å…³å¿ƒå¦‚ä½•è®¾ç½®è¿™äº›ç¯å¢ƒå˜é‡ï¼Œç¨åçš„åˆå§‹åŒ–å®‰è£…è¿‡ç¨‹ä¼šä¸ºæ‚¨è‡ªåŠ¨ç”Ÿæˆè¿™äº›é…ç½®ã€‚åˆå§‹åŒ–å®Œæˆåï¼Œæ‚¨å¯ä»¥åœ¨å¤šä¸ª Gitea å®ä¾‹é—´å…±äº«åŒä¸€ä»½é…ç½®æ–‡ä»¶å’Œæ•°æ®ç¼“å­˜æ¥å®ç°æœåŠ¡å™¨é›†ç¾¤ã€‚

> é˜…è¯»æ›´å¤šï¼š[https://docs.gitea.io/en-us/install-with-docker/](https://docs.gitea.io/en-us/install-with-docker/)

### å¯åŠ¨ Gitea

#### åˆ›å»ºå·¥ä½œç›®å½•

é¦–å…ˆåˆ›å»ºä¸€ä¸ª gitea å·¥ä½œç›®å½•ï¼Œåç»­å·¥ä½œéƒ½åœ¨è¿™ä¸ªç›®å½•ä¸‹å®Œæˆã€‚

    mkdir ~/gitea && cd ~/gitea
    
    # é¢„å…ˆåˆ›å»º data å’Œ config ç›®å½•ï¼Œç¨åç”¨äºæ•°æ®æŒ‚è½½
    mkdir data config
    chown 1000:1000 data config
    

#### åˆ›å»º docker-compose.yml

ä½¿ç”¨ä¸‹é¢çš„æ¨¡æ¿åˆ›å»º `docker-compose.yml`ï¼Œè¿™é‡Œä½¿ç”¨åˆ°çš„é•œåƒæ˜¯ `gitea/gitea:1.17.2-rootless`ã€‚

> rooless ç‰ˆæœ¬çš„é•œåƒé»˜è®¤ä½¿ç”¨ UID/GID 1000:1000 ä½œä¸ºç¨‹åºè¿è¡Œçš„ç”¨æˆ·ç»„ï¼Œä¸ºäº†ä¿è¯ gitea ç¨‹åºæŒ‚è½½æƒé™æ­£ç¡®çš„æ•°æ®ç›®å½•ï¼Œæˆ‘ä»¬åœ¨å‰é¢çš„æ­¥éª¤ä¸­é¢„å…ˆåˆ›å»ºäº† `data` å’Œ `config` ç›®å½•ã€‚

    version: "3"
    
    services:
      server:
        image: gitea/gitea:1.17.2-rootless
        container_name: gitea
        restart: always
        volumes:
          - ./data:/var/lib/gitea
          - ./config:/etc/gitea
          - /etc/timezone:/etc/timezone:ro
          - /etc/localtime:/etc/localtime:ro
        ports:
          - "3000:3000"
          - "2222:2222"
    

å‡ ä¸ªé‡è¦çš„å‚æ•°è¯´æ˜ï¼š

*   `volumes:` æ•°æ®æŒ‚è½½
    *   `./data:/data`ï¼Œå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„ `data` ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ `/var/lib/gitea` ç›®å½•ã€‚`/data` æ˜¯ Gitea æ ‡å‡†å®¹å™¨çš„æ•°æ®å­˜å‚¨ç‚¹ï¼ŒåŒ…å«äº† Git ä»“åº“ã€SQLite æ•°æ®åº“æ–‡ä»¶ã€ç¼“å­˜æ–‡ä»¶ç­‰ã€‚
    *   `./config:/etc/gitea` æŒ‚è½½ Gitea çš„ app.ini é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚
    *   `/etc/timezone:/etc/timezone:ro` ç”¨äºæŒ‡å®šæ—¶åŒº
    *   `/etc/localtime:/etc/localtime:ro` åŒä¸Šï¼Œç”¨äºæŒ‡å®šæœ¬åœ°æ—¶é—´
*   `ports:` ç«¯å£æ˜ å°„
    *   `3000:3000` HTTP ç«¯å£ï¼Œä»å·¦åˆ°å³çš„é¡ºåºæ˜¯ä»ä¸»æœºæ˜ å°„åˆ° Docker å®¹å™¨ã€‚åœ¨æ­¤ï¼Œæ‚¨å¯ä»¥é€šè¿‡ `http://127.0.0.1:3000` ç›´æ¥è®¿é—®åˆ° Gitea çš„ Web ç•Œé¢ï¼Œæˆ–é€šè¿‡åå‘ä»£ç†å¼•æ“æä¾›æ›´å…·æœ‰æ‰©å±•æ€§çš„ SSL é›†æˆï¼Œä¾‹å¦‚ Nginxã€‚
    *   `2222:2222` SSH ç«¯å£ã€‚è¿™é‡Œä¸»æœºä¾§æš´éœ²çš„ç«¯å£ä¸º `2222` é¿å…äº†ä¸é»˜è®¤ SSH æœåŠ¡ç«¯å£å†²çªã€‚ç¦ç”¨ SSH æ—¶åˆ é™¤ç«¯å£è½¬å‘å³å¯ã€‚å¦‚æœæ‚¨å¸Œæœ›å°†ä¸»æœºå®Œå…¨ä½œä¸º Gitea æœåŠ¡å™¨ï¼Œå¯ä»¥å°†ä¸»æœºé…ç½®æ–‡ä»¶ `/etc/ssh/sshd_config` ä¸­çš„ç«¯å£ `Port 22` æ›´æ”¹ä¸ºå…¶ä»–å€¼ï¼Œä½¿å¾— Docker å¯ä»¥ä½¿ç”¨ Gitea å†…å»ºçš„ Go SSH æˆ– OpenSSH å ç”¨ 22 ç«¯å£ä½œä¸º Git æœåŠ¡ã€‚

#### å¯åŠ¨ Gitea å®ä¾‹

ä½¿ç”¨ docker compose å‘½ä»¤æ‹‰å–é•œåƒå¹¶å¯åŠ¨ Gitea å®ä¾‹ï¼š

    docker compose up -d
    

ç”¨ `docker compose ps` æŸ¥çœ‹å®¹å™¨ï¼š

    NAME     COMMAND                   SERVICE    STATUS     PORTS
    gitea    "/usr/local/bin/dockâ€¦"    server     running    2222/tcp, 0.0.0.0:3000->3000/tcp
    

ç”¨ `docker compose logs -f` æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š

    $ docker compose logs -f
    gitea  | 2022/09/26 14:50:31 cmd/web.go:106:runWeb() [I] Starting Gitea on PID: 1
    gitea  | 2022/09/26 14:50:31 ...s/install/setting.go:21:PreloadSettings() [I] AppPath: /usr/local/bin/gitea
    gitea  | 2022/09/26 14:50:31 ...s/install/setting.go:22:PreloadSettings() [I] AppWorkPath: /var/lib/gitea
    gitea  | 2022/09/26 14:50:31 ...s/install/setting.go:23:PreloadSettings() [I] Custom path: /var/lib/gitea/custom
    gitea  | 2022/09/26 14:50:31 ...s/install/setting.go:24:PreloadSettings() [I] Log path: /var/lib/gitea/data/log
    gitea  | 2022/09/26 14:50:31 ...s/install/setting.go:25:PreloadSettings() [I] Configuration file: /etc/gitea/app.ini
    gitea  | 2022/09/26 14:50:31 ...s/install/setting.go:26:PreloadSettings() [I] Prepare to run install page
    gitea  | 2022/09/26 14:50:31 ...s/install/setting.go:29:PreloadSettings() [I] SQLite3 is supported
    gitea  | 2022/09/26 14:50:31 cmd/web.go:217:listen() [I] [63314bb7-6] Listen: http://0.0.0.0:3000
    gitea  | 2022/09/26 14:50:31 cmd/web.go:221:listen() [I] [63314bb7-6] AppURL(ROOT_URL): http://localhost:3000/
    

å½“çœ‹åˆ°ä¸Šè¿°æ—¥å¿—çš„æ—¶å€™å¯ä»¥è®¤ä¸ºå®ä¾‹å·²ç»å¯åŠ¨äº†ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ [http://localhost:3000/](http://localhost:3000/) å³å¯ç™»é™† Gitea å®ä¾‹è¿›è¡Œåˆå§‹åŒ–è®¾ç½®ã€‚

ç™»å½• Gitea
--------

é¦–æ¬¡å®‰è£… Gitea åï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥ [http://localhost:3000/](http://localhost:3000/) è®¿é—®åˆå§‹åŒ–é¡µé¢ï¼ŒæŒ‰éœ€è®¾ç½®æœåŠ¡å™¨ä¿¡æ¯ã€‚ç¬¬ä¸€ä¸ªæ³¨å†Œçš„ç”¨æˆ·è´¦å·ä¸ºç®¡ç†è´¦å·ã€‚

![image](https://img2022.cnblogs.com/blog/2956540/202209/2956540-20220927193823094-433532346.png)

è‡³æ­¤å·²ç»ç”¨ Docker çš„æ–¹å¼æ¥æˆåŠŸå®‰è£…å’Œè¿è¡Œäº† Gitea å®ä¾‹ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œè¯¸å¦‚ä»£ç æ‰˜ç®¡ã€å›¢é˜Ÿäººå‘˜ç®¡ç†ã€é…ç½®æŒç»­é›†æˆå·¥å…· [Drone](https://www.cnblogs.com/Gitea/p/drone.html)ã€[Jenkins](https://www.cnblogs.com/Gitea/p/jenkins.html) ç­‰ã€‚