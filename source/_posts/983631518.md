---
layout: post
title: "Semantic Kernel å…¥é—¨ç³»åˆ—ï¼šğŸ”¥Kernel å†…æ ¸å’ŒğŸ§‚Skills æŠ€èƒ½"
date: "2023-04-10T01:05:11.172Z"
---
Semantic Kernel å…¥é—¨ç³»åˆ—ï¼šğŸ”¥Kernel å†…æ ¸å’ŒğŸ§‚Skills æŠ€èƒ½
============================================

å€ŸåŠ©Semantic Kernel å¯ä»¥å¿«é€Ÿåˆ›å»ºèåˆ LLM AI å’ŒNative Codeèƒ½åŠ›çš„åº”ç”¨ã€‚

![image](https://img2023.cnblogs.com/blog/758442/202304/758442-20230408192854056-1172997337.png)

ç†è§£äº†LLMçš„ä½œç”¨ä¹‹åï¼Œå¦‚ä½•æ‰èƒ½æ„é€ å‡ºä¸LLMç›¸ç»“åˆçš„åº”ç”¨ç¨‹åºå‘¢ï¼Ÿ

é¦–å…ˆæˆ‘ä»¬éœ€è¦æŠŠLLM AIçš„èƒ½åŠ›å’ŒåŸç”Ÿä»£ç çš„èƒ½åŠ›åŒºåˆ†å¼€æ¥ï¼Œåœ¨Semantic Kernelï¼ˆä»¥ä¸‹ç®€ç§°SKï¼‰ï¼ŒLLMçš„èƒ½åŠ›ç§°ä¸º semantic function ï¼Œä»£ç çš„èƒ½åŠ›ç§°ä¸º native functionï¼Œä¸¤è€…å¹³ç­‰çš„ç§°ä¹‹ä¸ºfunctionï¼ˆåŠŸèƒ½ï¼‰ï¼Œä¸€ç»„åŠŸèƒ½æ„æˆä¸€ä¸ªæŠ€èƒ½ï¼ˆskillï¼‰ã€‚ SKçš„åŸºæœ¬èƒ½åŠ›å‡æ˜¯ç”±skillæ„æˆã€‚

![image](https://img2023.cnblogs.com/blog/758442/202304/758442-20230409223908643-961699753.png)

æœ‰äº†ä¸€å †skillä¹‹åå¹¶ä¸èƒ½ç›´æ¥æ‰§è¡Œï¼Œéœ€è¦æœ‰ä¸€ä¸ªé…ç½®å’Œç®¡ç†çš„å•å…ƒï¼Œå°±åƒæ˜¯MVC éœ€è¦ASP.NETæ¡†æ¶ä¸€æ ·ï¼ŒSkillä¹Ÿéœ€è¦æœ‰ä¸€ä¸ªKernelè¿›è¡Œç»„ç»‡ç®¡ç†ã€‚

Kernel é™¤äº†ç»„ç»‡ç®¡ç†Skillï¼Œè¿˜å…¼é¡¾äº†åŸºç¡€æœåŠ¡çš„é…ç½®ï¼Œä¾‹å¦‚OpenAI/Azure OpenAIçš„æˆæƒä¿¡æ¯ï¼Œé»˜è®¤çš„LLMæ¨¡å‹é€‰æ‹©ç­‰ç­‰ã€‚å¦å¤–å½“æ¶‰åŠåˆ°ä¸Šä¸‹æ–‡çš„ç®¡ç†ï¼ŒæŠ€èƒ½å‚æ•°çš„ä¼ é€’æ—¶ï¼ŒKernelä¹Ÿèƒ½å‘æŒ¥é‡è¦çš„ä½œç”¨ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»¥å¼€å§‹ç€æ‰‹ä¸Šæ‰‹SKåº”ç”¨å¼€å‘çš„å­¦ä¹ ã€‚

å‡†å¤‡é˜¶æ®µ
----

1.  é¦–å…ˆå‡†å¤‡ä¸€ä¸ªåº”ç”¨ç¯å¢ƒï¼ŒConsole å¯ä»¥ï¼ŒASP.NET ä¹Ÿå¯ä»¥ï¼ŒNotebooks ä¹Ÿå¯ä»¥ã€‚ä½¿ç”¨Notebooksçš„è¯æ¨èå‚è€ƒå®˜æ–¹çš„[Notebooksåˆé›†](https://github.com/microsoft/semantic-kernel/tree/main/samples/notebooks/dotnet)å’Œ[Uncle John's Semantic Kernel Recipes](https://github.com/johnmaeda/SK-Recipes)ã€‚
2.  åº”ç”¨ç¯å¢ƒå‡†å¤‡å¥½ä¹‹åï¼Œå’Œæ‰€æœ‰çš„.Net åº“ä¸€æ ·ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®‰è£…SKçš„nuget åŒ…ã€‚ç”±äºæ˜¯ä¸€ä¸ªè¾ƒæ–°çš„åŒ…ï¼Œæ‰€ä»¥æ›´æ–°å˜åŒ–ä¼šæ¯”è¾ƒå¿«ã€‚

    dotnet add package Microsoft.SemanticKernel --prerelease
    

3.  æ¥ä¸‹æ¥è¿›è¡Œåº”ç”¨å†…çš„å‡†å¤‡å·¥ä½œï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª `kernel`;

    using Microsoft.SemanticKernel;
    var kernel = Kernel.Builder.Build();
    

4.  ç„¶åé…ç½®åŸºç¡€æ¨¡å‹ï¼ŒåŸºç¡€æ¨¡å‹ç›®å‰æœ‰å››ä¸ªï¼š
    
    *   TextCompletionï¼Œæœ€å¸¸ç”¨çš„GPT-3çš„æ¨¡å‹ï¼Œå¸¸ç”¨äºæ–‡æœ¬ç”Ÿæˆ
    *   ChatCompetionï¼ŒGPT3.5æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ChatGPTçš„æ¨¡å‹ï¼ŒåŸºæœ¬å°±ç”¨äºèŠå¤©åŠŸèƒ½
    *   EmbeddingGenerationï¼ŒåµŒå…¥æ¨¡å‹ï¼Œè¿™ä¸ªå°†ç”¨äºMemoryçš„ç”Ÿæˆå’Œæœç´¢ï¼Œåœ¨åæœŸèƒ½åŠ›æ‰©å±•æ—¶å°†ä¼šæœ‰æå¤§çš„ç”¨é€”
    *   ImageGenerationï¼Œå›¾å½¢æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯DALL-Eæ¨¡å‹ï¼Œç”¨äºå›¾ç‰‡çš„ç”Ÿæˆ
    
    ç”±äºAzure OpenAIæä¾›äº†å’ŒOpen AIç›¸åŒçš„èƒ½åŠ›ï¼Œæ‰€ä»¥ä»¥ä¸Šçš„æ¨¡å‹é…ç½®å¯ä»¥é€‰æ‹©OpenAIçš„æ¥å£ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©Azure OpenAIçš„æ¥å£ï¼Œæ ¹æ®è‡ªå·±æœ‰å“ªä¸ªé€‰å“ªä¸ªçš„åŸåˆ™ä½¿ç”¨ã€‚
    
    å½“ç„¶ä»¥ä¸Šæ¨¡å‹ä¹Ÿæä¾›äº†åŸºæœ¬çš„æ¥å£å®šä¹‰ï¼Œå¦‚æœæœ‰è‡ªå·±çš„LLM AIæ¥å£çš„è¯ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œå®ç°ç›¸å…³æ¥å£ï¼Œç„¶åä½¿ç”¨ã€‚
    
    è¿™é‡Œä»¥OpenAIçš„æ¥å£ä¸ºä¾‹ï¼Œç»§ç»­è¿›è¡Œå­¦ä¹ ã€‚
    

    // ç®€å•çš„æŠ€èƒ½ä»»åŠ¡ä½¿ç”¨TextCompletionå³å¯
    // 1. ServiceId ç”¨äºæŒ‡å®šå½“å‰æ¨¡å‹çš„é…ç½®ï¼Œç›¸åŒçš„æ¨¡å‹ä¸èƒ½æœ‰é‡å¤çš„ServiceIdé…ç½®
    // 2. modelId æŒ‡å®šTextCompetionæ‰€ä½¿ç”¨çš„LLM æ¨¡å‹ï¼Œç›®å‰åŸºæœ¬ä¸º text-davinci-003
    // 3. apikey OpenAI æ¥å£è°ƒç”¨éœ€è¦ä½¿ç”¨çš„APIkey
    kernel.Config.AddOpenAITextCompletionService("ServiceId","text-davinci-003",Environment.GetEnvironmentVariable("OPENAI_API_KEY"));
    
    

Semantic Function
-----------------

5.  æ³¨å†Œä¸€ä¸ªSemantic Function

    using Microsoft.SemanticKernel.SemanticFunctions;
    
    // âš ï¸ Semantic Functionçš„æ ¸å¿ƒå°±æ˜¯promptâš ï¸ 
    // è¿™é‡Œå·æ‡’ï¼Œä½¿ç”¨Semantic Kernelå®˜æ–¹æ ·ä¾‹åº“é‡Œé¢çš„çš„Summary Skill
    var prompt = 
    """
    [SUMMARIZATION RULES]
    DONT WASTE WORDS
    USE SHORT, CLEAR, COMPLETE SENTENCES.
    DO NOT USE BULLET POINTS OR DASHES.
    USE ACTIVE VOICE.
    MAXIMIZE DETAIL, MEANING
    FOCUS ON THE CONTENT
    
    [BANNED PHRASES]
    This article
    This document
    This page
    This material
    [END LIST]
    
    Summarize:
    Hello how are you?
    +++++
    Hello
    
    Summarize this
    {{$input}}
    +++++
    """;
    // ä½¿ç”¨æ‰©å±•æ–¹æ³•åœ¨Kernelä¸Šæ³¨å†Œä¸€ä¸ªSemanticFunction 
    // prompt æ˜¯Semantic Functionçš„æ ¸å¿ƒï¼Œå¦‚ä½•è®¾è®¡ä¸€ä¸ªå¥½çš„promptæ˜¯æˆåŠŸæ„å»ºSemantic Functionçš„å…³é”®æ‰€åœ¨ï¼Œä¹Ÿæ˜¯æœªæ¥LLM AI åº”ç”¨ä¸­çš„é‡è¦å†…å®¹
    // PromptTemplateConfig ç”¨äºé…ç½®prompt æ¨¡æ¿çš„ç›¸å…³å‚æ•°
    // functionName æ˜¯è‡ªå®šä¹‰çš„åŠŸèƒ½åç§°[å¯é€‰]
    // skillName æ˜¯è‡ªå®šä¹‰çš„æŠ€èƒ½åç§°[å¯é€‰]
    var summaryFunction = kernel.CreateSemanticFunction(prompt,new PromptTemplateConfig());
    

å¯ä»¥æ³¨æ„åˆ°çš„æ˜¯åœ¨promptä¸­ï¼Œæœ‰ä¸€ä¸ªå˜é‡å‚æ•° `{{$input}}`,è¿™æ˜¯SKçš„é»˜è®¤è¾“å…¥å‚æ•°ï¼Œç”¨äºæ³¨å…¥éœ€è¦å¤„ç†çš„ç”¨æˆ·è¾“å…¥ï¼Œè¿™æ ·çš„æ ¼å¼ç”¨äºé¢„é˜²**Prompt Injection**ï¼Œè¿™å°±æ˜¯å¦å¤–ä¸€ä¸ªè¯é¢˜äº†ã€‚

6.  æ‰§è¡ŒFunction

    // å®šä¹‰éœ€è¦å¤„ç†çš„è¾“å…¥
    var input = "Multi-modal interfaces are becoming increasingly popular for app developers. These interfaces allow users to interact with apps in a variety of ways by combining different modes of input and output, such as voice, touch, and visuals, to create a more interactive and engaging user experience. In this blog we will overview how you can use Semantic Kernel with a multi-modal example.  ";
    // é€šè¿‡ Kernel è¿è¡Œ function 
    var resultContext = await kernel.RunAsync(input,summaryFunction);
    // è¾“å‡ºç»“æœ
    resultContext.Result.Dump();
    // output 
    // Multi-modal interfaces are becoming increasingly popular for app developers, combining different modes of input and output such as voice, touch, and visuals to create a more interactive and engaging user experience. Semantic Kernel can be used to create a multi-modal example.
    

ä»¥ä¸Šå°±å®Œæˆäº†ä¸€ä¸ªç®€å•çš„Semantic Functionçš„ä½¿ç”¨ã€‚

å¥½çš„ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚

Native Function
---------------

7.  å£°æ˜ä¸€ä¸ªNative Skill

    using Microsoft.SemanticKernel.SkillDefinition;
    // è¿™é‡Œå·æ‡’ï¼Œä½¿ç”¨Semantic Kernel CoreSkillsä¸­çš„ TextSkill
    public class TextSkill {
    	[SKFunction("Convert a string to uppercase.")]
    	public string Uppercase(string text)
    	{
    		return text.ToUpper(System.Globalization.CultureInfo.CurrentCulture);
    	}
    }
    

è¿™é‡Œåªéœ€è¦å¯¹æ–¹æ³•æ·»åŠ ä¸€ä¸ªSKFunctionçš„æ³¨é‡Šï¼Œå°±å¯ä»¥è½¬å˜ä¸ºä¸€ä¸ªSKçš„Native Functionã€‚

8.  æ³¨å†ŒNative Skill

    // skillInstance å°±æ˜¯Native Skillçš„å®ä¾‹
    // skillName è‡ªå®šä¹‰çš„æŠ€èƒ½åç§° [å¯é€‰]
    var textSkill = kernel.ImportSkill(new TextSkill(),nameof(TextSkill));
    

è¿™é‡Œä½¿ç”¨åˆ°çš„æ˜¯ä¸€ä¸ªImportï¼Œæ„å‘³ç€å¯¼å…¥äº†SkillInstanceä¸­æ‰€æœ‰çš„å®šä¹‰SKFunctionã€‚è€ŒSemantic Skill ä¹Ÿæœ‰ä¸€ä¸ªå¯¹åº”çš„Importæ–¹æ³•ImportSemanticSkillFromDirectoryï¼Œå¯ä»¥ä»ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­å¯¼å…¥æ‰€æœ‰æŠ€èƒ½ã€‚

9.  æ‰§è¡ŒFunction

    // æ³¨å†ŒNative Function å¦‚ä½•æ²¡æœ‰æŒ‡å®š SKFunctionNameçš„è¯ï¼Œéƒ½ä¼šæ˜¯ç”¨æ–¹æ³•å£°æ˜çš„åç§°ï¼Œä½¿ç”¨nameofè¿™ç§å·æ‡’æ–¹æ³•å¯ä»¥æ–¹ä¾¿å¾—ä»Skillé›†åˆä¸­è·å–å¯¹åº”çš„Function
    var uppercaseFunction = textSkill[nameof(TextSkill.Uppercase)];
    // é€šè¿‡ Kernel è¿è¡Œ function
    var nativeResultContext = await kernel.RunAsync(input,uppercaseFunction);
    // è¾“å‡ºç»“æœ
    nativeResultContext.Result.Dump();
    // outputï¼š
    // MULTI-MODAL INTERFACES ARE BECOMING INCREASINGLY POPULAR FOR APP DEVELOPERS. THESE INTERFACES ALLOW USERS TO INTERACT WITH APPS IN A VARIETY OF WAYS BY COMBINING DIFFERENT MODES OF INPUT AND OUTPUT, SUCH AS VOICE, TOUCH, AND VISUALS, TO CREATE A MORE INTERACTIVE AND ENGAGING USER EXPERIENCE. IN THIS BLOG WE WILL OVERVIEW HOW YOU CAN USE SEMANTIC KERNEL WITH A MULTI-MODAL EXAMPLE.
    

ä»¥ä¸Šå°±å®Œæˆäº†ä¸€ä¸ªç®€å•çš„Native Functionçš„ä½¿ç”¨ã€‚

é“¾å¼è°ƒç”¨
----

å½“å®Œæˆäº†ä»¥ä¸ŠSkillå’ŒFunctionçš„å‡†å¤‡ä¹‹åï¼Œå°±å¯ä»¥æƒ³åŠæ³•å°†å¤šä¸ªSkillä¸²è”èµ·æ¥ä½¿ç”¨äº†ï¼Œå°±åƒæ˜¯å‘½ä»¤è¡Œä¸­çš„ç®¡é“ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ç®¡é“ä¸€æ ·ã€‚

    // kernel.RunAsync æœ¬èº«å°±æ”¯æŒå¤šä¸ªFunctionå‚æ•°ï¼Œå¹¶æŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œ
    var upperSummeryContext = await kernel.RunAsync(input, summaryFunction,uppercaseFunction);
    //  è¾“å‡ºç»“æœ
    upperSummeryContext.Result.Dump();
    
    // output:
    // MULTI-MODAL INTERFACES ARE BECOMING INCREASINGLY POPULAR FOR APP DEVELOPERS, COMBINING DIFFERENT MODES OF INPUT AND OUTPUT SUCH AS VOICE, TOUCH, AND VISUALS TO CREATE A MORE INTERACTIVE AND ENGAGING USER EXPERIENCE. SEMANTIC KERNEL CAN BE USED TO CREATE A MULTI-MODAL EXAMPLE.
    

è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„ç»“åˆäº†LLM AIèƒ½åŠ›å’ŒåŸç”Ÿä»£ç èƒ½åŠ›çš„åº”ç”¨å°±æ„å»ºæˆåŠŸäº†ã€‚

* * *

å‚è€ƒèµ„æ–™ï¼š

1.  [Concepts Overview for Semantic Kernel | Microsoft Learn](https://learn.microsoft.com/en-us/semantic-kernel/concepts-sk/)
2.  [Kernel in Semantic Kernel | Microsoft Learn](https://learn.microsoft.com/en-us/semantic-kernel/concepts-sk/kernel)
3.  [Skills in Semantic Kernel | Microsoft Learn](https://learn.microsoft.com/en-us/semantic-kernel/concepts-sk/skills)
4.  [How to write semantic skills in Semantic Kernel | Microsoft Learn](https://learn.microsoft.com/en-us/semantic-kernel/howto/semanticfunctions)
5.  [How to write native skills in Semantic Kernel | Microsoft Learn](https://learn.microsoft.com/en-us/semantic-kernel/howto/nativefunctions)
6.  [SK-Recipes](https://github.com/johnmaeda/SK-Recipes)