---
layout: post
title: "å®ç°ç®€å•çš„`Blazor`ä½ä»£ç "
date: "2023-02-15T21:15:04.224Z"
---
å®ç°ç®€å•çš„\`Blazor\`ä½ä»£ç 
==================

æœ¬ç¯‡åšå®¢åªå®ç°åŸºæœ¬çš„ä½ä»£ç ï¼Œæ¯”å¦‚æ–°å¢ç»„ä»¶ï¼ŒåŠ¨æ€ä¿®æ”¹ç»„ä»¶å‚æ•°

åˆ›å»ºé¡¹ç›®
----

é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„`Blazor Server`ï¼Œå¹¶ä¸”å‘½å`LowCode.Web`

å®ç°æˆ‘ä»¬è¿˜éœ€è¦å¼•ç”¨ä¸€ä¸ª`Blazor`ç»„ä»¶åº“ï¼Œç”±äºä½œè€…ç”¨`Masa Blazor`æ¯”è¾ƒå¤šæ‰€ä»¥ä½¿ç”¨`Masa Blazor`

### å®‰è£…`Masa Blazor`

å°†`Masa Blazor`æ·»åŠ åˆ°é¡¹ç›®ä¾èµ–ä¸­

    <ItemGroup>
    	<PackageReference Include="Masa.Blazor" Version="1.0.0-preview.3" />
    </ItemGroup>
    
    

ä¿®æ”¹`Program.cs`æ–‡ä»¶ å¢åŠ äº†`builder.Services.AddMasaBlazor();`

    var builder = WebApplication.CreateBuilder(args);
    builder.Services.AddRazorPages();
    builder.Services.AddServerSideBlazor();
    builder.Services.AddMasaBlazor();
    
    var app = builder.Build();
    
    if (!app.Environment.IsDevelopment())
    {
        // The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.
        app.UseHsts();
    }
    
    app.UseHttpsRedirection();
    
    app.UseStaticFiles();
    
    app.UseRouting();
    
    app.MapBlazorHub();
    app.MapFallbackToPage("/_Host");
    
    app.Run();
    

æ‰“å¼€`_Imports.razor` æ·»åŠ ä»¥ä¸‹ä»£ç 

    @using Microsoft.AspNetCore.Components.Routing
    @using Microsoft.AspNetCore.Components.Web
    @using Microsoft.JSInterop
    @using LowCode.Web
    @using Masa.Blazor
    @using BlazorComponent
    @using LowCode.Web.Components
    

ä¿®æ”¹`Pages\_Host.cshtml`ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç 

    @page "/"
    @using Microsoft.AspNetCore.Components.Web
    @namespace LowCode.Web.Pages
    @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
    
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8"/>
        <base href="~/"/>
        <link href="css/site.css" rel="stylesheet"/>
        <!-- masa blazor css style -->
        <link href="_content/Masa.Blazor/css/masa-blazor.min.css" rel="stylesheet"/>
    
        <!--icon file,import need to use-->
        <link href="https://cdn.masastack.com/npm/@("@mdi")/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
        <component type="typeof(HeadOutlet)" render-mode="ServerPrerendered"/>
    </head>
    <body>
    <component type="typeof(App)" render-mode="ServerPrerendered"/>
    
    <div id="blazor-error-ui">
        <environment include="Staging,Production">
            An error has occurred. This application may no longer respond until reloaded.
        </environment>
        <environment include="Development">
            An unhandled exception has occurred. See browser dev tools for details.
        </environment>
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ğŸ—™</a>
    </div>
    
    <script src="_framework/blazor.server.js"></script>
    <!--js(should lay the end of file)-->
    <script src="_content/BlazorComponent/js/blazor-component.js"></script>
    </body>
    </html>
    

ä¿®æ”¹`MainLayout.razor`æ–‡ä»¶

    @inherits LayoutComponentBase
    
    <MApp>
        @Body
    </MApp>
    

è¿™æ ·å°±å®Œæˆå®‰è£…äº†`Masa Blazor`

ç„¶åå¼€å§‹å†™å®ç°

### å®ç°ä½ä»£ç ç»„ä»¶è®¾è®¡

åˆ›å»º`Components`æ–‡ä»¶å¤¹

åˆ›å»ºæ¸²æŸ“ç»„ä»¶`Component\Render.razor`ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç 

    @using LowCode.Web.Components.Options
    @RenderFragment
    
    @code{
        /// <summary>
        /// æ¸²æŸ“ç»„ä»¶
        /// </summary>
        [Parameter]
        public RenderFragment RenderFragment { get; set; }
    
        /// <summary>
        /// æ¸²æŸ“é…ç½®
        /// </summary>
        public GenerateMButtonOptions GenerateMButtonOptions { get; set; }
    
        /// <summary>
        /// æ¸²æŸ“åŠ¨æ€ä»£ç 
        /// </summary>
        public string Code { get; set; }
    }
    

å®šä¹‰ç»„ä»¶åº“æ¨¡æ¿ `DynamicComponentGenerator.razor`ï¼Œç”±äº`cs`æ–‡ä»¶ä¸èƒ½`razor`æ¨¡æ¿ï¼Œæ‰€ä»¥åˆ›å»º`razor`æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œä»¥ä¸‹ä»£ç æˆ‘ä»¬æ·»åŠ ä¸‰ä¸ªç»„ä»¶æ¨¡æ¿ï¼Œ

    @using LowCode.Web.Components.Options
    
    @code {
        public static (RenderFragment, string) GenerateMButton(GenerateMButtonOptions options)
        {
            // å®šä¹‰æ¨¡æ¿é»˜è®¤æ•°æ®
            RenderFragment template = @<MButton Block=options.block
                                                Height=options.height
                                                Width=options.width
                                                Class=@options.Class
                                                Style=@options.Style
                                                Dark=options.dark
                                                Attributes=options.attributes>@options.childContent</MButton>;
    
            // æ¨¡æ¿å®šä¹‰ä»£ç  ï¼ˆå­˜åœ¨é—®é¢˜ï¼‰
            var data = $@"<MButton Block={options.block}
                                 Height={options.height}
                                 Width={options.width}
                                 Class={options.Class}
                                 Style={options.Style}
                                 Dark={options.dark}
            Attributes={options.attributes}>{@options.childContent}</MButton>";
    
            return (builder => { builder.AddContent(0, template); }, data);
        }
    
    
        public static (RenderFragment, string) GenerateMCard(GenerateMButtonOptions options)
        {
            RenderFragment template = @<MCard Height=options.height
                                                Width=options.width
                                                Class=@options.Class
                                                Style=@options.Style
                                                Dark=options.dark
                                                Attributes=options.attributes>@options.childContent</MCard>;
    
            var data = $@"<MCard Height={options.height}
                                 Width={options.width}
                                 Class={options.Class}
                                 Style={options.Style}
                                 Dark={options.dark}
            Attributes={options.attributes}>{@options.childContent}</MCard>";
    
            return (builder => { builder.AddContent(0, template); }, data);
        }
    
        public static (RenderFragment, string) GenerateMAvatar(GenerateMButtonOptions options)
        {
            RenderFragment template = @<MAvatar Height=options.height
                                               Width=options.width
                                               Class=@options.Class
                                               Style=@options.Style
                                               Attributes=options.attributes>@options.childContent</MAvatar>;
    
            var data = $@"<MAvatar Height={options.height}
                                 Width={options.width}
                                 Class={options.Class}
                                 Style={options.Style}
            Attributes={options.attributes}>{@options.childContent}</MAvatar>";
    
            return (builder => { builder.AddContent(0, template); }, data);
        }
    }
    

æ·»åŠ `Component\ComponentType.cs` ç»„ä»¶æšä¸¾

    namespace LowCode.Web.Components;
    
    public enum ComponentType
    {
        MButton,
    
        MCart,
    
        MAvatar
    }
    

æ·»åŠ `Component\ComponentLibrary.razor`ç”¨äºæ˜¾ç¤ºæ”¯æŒçš„ç»„ä»¶

    <div style="height: 100px">
        <MButton class="button" OnClick="() => OnClick?.Invoke(ComponentType.MButton)">
            <MIcon>
                mdi-card
            </MIcon>
            æŒ‰é’®
        </MButton>
        <MButton class="button" OnClick="() => OnClick?.Invoke(ComponentType.MCart)">
            <MIcon>mdi-id-card</MIcon>
            å¡ç‰‡
        </MButton>
        <MButton class="button" OnClick="() => OnClick?.Invoke(ComponentType.MAvatar)">
            <MIcon>mdi-id-card</MIcon>
            å¤´åƒ
        </MButton>
    </div>
    
    @code{
    
        public delegate void OnClickDelegate(ComponentType type);
    
        [Parameter]
        public OnClickDelegate? OnClick { get; set; }
    
    }
    
    <style>
        .button {
            margin: 5px;
        }
    </style>
    

æ–°å¢`Component\Options\GenerateMButtonOptions.cs` æ·»åŠ ä»¥ä¸‹ä»£ç  ï¼Œæ·»åŠ ç»„ä»¶æ—¶çš„å‚æ•°

    using BlazorComponent;
    using Microsoft.AspNetCore.Components;
    
    namespace LowCode.Web.Components.Options;
    
    public class GenerateMButtonOptions
    {
        public string? height { get; set; }
    
        public string? width { get; set; }
    
        public bool block { get; set; }
    
        public bool dark { get; set; }
    
        public string Style { get; set; } = string.Empty;
        public string Class { get; set; } = string.Empty;
    
        public Dictionary<string, object>? attributes { get; set; } = new();
    
        public RenderFragment? childContent { get; set; }
    }
    

ç„¶åä¿®æ”¹`Pages\Index.razor`ï¼Œ

    @page "/"
    @using LowCode.Web.Components.Options
    
    <MRow NoGutters>
        <MCol>
            <MCard Class="pa-1"
                   Outlined
                   Style="height: 100vh"
                   tile>
    
                <ComponentLibrary OnClick="CreateOnClick"></ComponentLibrary>
    
            </MCard>
            </MCol>
            <MCol Order="2"
              Cols="12"
              Sm="6"
              Md="8">
            <MCard Class="pa-2"
                   Outlined
                   Style="height: 100vh"
                   tile>
                @foreach (var item in Renders)
                {
                    <render @onclick="() => Id = item.Key">
                        @item.Value.RenderFragment
                    </render>
                }
            </MCard>
        </MCol>
        <MCol Order="3">
            <MCard Class="pa-2"
                   Outlined
                   Style="height:100vh"
                   tile>
                <MCard>
                    @*TODO:é€šè¿‡åå°„å®ç°è·å–ç»„ä»¶å‚æ•°æ ¹æ®å‚æ•°ç±»å‹æ˜¾ç¤ºæŒ‡å®šç»„ä»¶åŠ¨æ€ä¿®æ”¹å‚æ•°*@
                    @foreach (var item in Renders)
                    {
                        var options = item.Value.GenerateMButtonOptions;
                        if (item.Key == Id)
                        {
                            <MTextField @bind-Value="options.width" Label="width"></MTextField>
                            <MTextField @bind-Value="options.height" Label="height"></MTextField>
                            <MTextField @bind-Value="options.Style" Label="Style"></MTextField>
                            <MTextField @bind-Value="options.Class" Label="Class"></MTextField>
                            <MDivider></MDivider>
                            <MButton OnClick="() => AddOptionsAttribute(options.attributes)" Block>æ–°å¢æ‰©å±•å‚æ•°è¾“å…¥æ¡†</MButton>
                            @foreach (var e in options.attributes)
                            {
                                <MTextarea NoResize Rows="1" Value="@e.Key" ValueChanged="(v) => { options.attributes.Remove(e.Key);options.attributes.Add(v,e.Value);}"></MTextarea>
                                <MTextarea NoResize Rows="1" Value="@options.attributes[e.Key].ToString()" ValueChanged="(v)=>options.attributes[e.Key]= v"></MTextarea>
                            }
                            <MButton Block OnClick="()=>DeleteComponent(item.Key)">åˆ é™¤</MButton>
                        }
                    }
                </MCard>
            </MCard>
        </MCol>
    </MRow>
    
    @code {
        public string Id { get; set; }
        private Dictionary<string, Render> Renders = new();
    
        private RenderFragment RenderFragment { get; set; }
    
        private void AddOptionsAttribute(Dictionary<string, object> attribute)
        {
            attribute.Add("new","");
        }
    
        private void DeleteComponent(string key)
        {
            Renders.Remove(key);
        }
    
        private void CreateOnClick(ComponentType type)
        {
            GenerateMButtonOptions options = null;
            string code;
            switch (type)
            {
                case ComponentType.MButton:
                    options = new()
                    {
                        childContent = @<span>æ–°å»ºçš„æŒ‰é’®</span>,
                        attributes = new Dictionary<string, object>(),
                        width = "100px",
                    };
    
                    (RenderFragment, code) = DynamicComponentGenerator.GenerateMButton(options);
    
                    Renders.Add(Guid.NewGuid().ToString("N"), new Render() { RenderFragment = RenderFragment, GenerateMButtonOptions = options, Code = code });
    
                    break;
                case ComponentType.MCart:
    
                    options = new()
                    {
                        childContent = @<MButton>å¤šä¸ªæŒ‰é’®</MButton>,
                        attributes = new Dictionary<string, object>(),
                        width = "100px",
                    };
    
                    (RenderFragment, code) = DynamicComponentGenerator.GenerateMCard(options);
    
                    Renders.Add(Guid.NewGuid().ToString("N"), new Render() { RenderFragment = RenderFragment, GenerateMButtonOptions = options, Code = code });
                    break;
                case ComponentType.MAvatar:
                    options = new()
                    {
                        childContent = @<MImage Src="https://cdn.masastack.com/stack/images/website/masa-blazor/jack.png" Alt="Jack"></MImage>,
                        attributes = new Dictionary<string, object>(),
                        width = "100px",
                    };
    
                    (RenderFragment, code) = DynamicComponentGenerator.GenerateMAvatar(options);
    
                    Renders.Add(Guid.NewGuid().ToString("N"), new Render() { RenderFragment = RenderFragment, GenerateMButtonOptions = options, Code = code });
                    break;
                default:
                    throw new ArgumentOutOfRangeException(nameof(type), type, null);
            }
    
            StateHasChanged();
        }
    }
    
    

è¿™æ ·å°±å®ç°äº†æ•´ä¸ªç®€å•çš„ä½ä»£ç æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çœ‹çœ‹æ•ˆæœï¼Œç®€å•äº†è§£å®ç°åŸç†

æˆ‘ä»¬å®šä¹‰äº†ç»„ä»¶çš„æ¨¡æ¿ï¼Œè¿™ä¸ªæ¨¡æ¿æ˜¯å›ºå®šçš„ï¼Œé€šè¿‡`Blazor`æä¾›çš„åŒå‘ç»‘å®šå®ç°åŠ¨æ€ä¿®æ”¹ç»„ä»¶å‚æ•°ï¼Œè¿™ç§æ–¹å¼å¯èƒ½ä¸å¤ªé€‚åˆå®Œæ•´çš„ä½ä»£ç ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸é”™çš„æ€è·¯ï¼Œ

![](https://img2023.cnblogs.com/blog/2415052/202302/2415052-20230215153353320-894778428.gif)

è¿™ä¸ªé¡¹ç›®è¿˜å¤„äºDemoé˜¶æ®µï¼Œä¸çŸ¥é“æ˜¯å¦æœ‰å¤§ä½¬ä¸€å—ç ”ç©¶ï¼Œç ”ç©¶æŠ€æœ¯æé™ï¼ŒBlazoréå¸¸å¥½ç”¨ï¼Œæ¨è

[GitHub](https://github.com/239573049/Masa.Low.Code)  
é¡¹ç›®æ˜¯MITå¼€æºï¼Œå¸Œæœ›å¤§ä½¬ä¸€å—å­¦ä¹ ï¼Œä¿ƒè¿›Blazorç”Ÿæ€

æ¥ç€Tokençš„åˆ†äº«