---
layout: post
title: "ä½¿ç”¨ Vue 3 æ—¶åº”é¿å…çš„ 10 ä¸ªé”™è¯¯"
date: "2023-03-10T01:17:47.815Z"
---
ä½¿ç”¨ Vue 3 æ—¶åº”é¿å…çš„ 10 ä¸ªé”™è¯¯
=====================

Vue 3å·²ç»ç¨³å®šäº†ç›¸å½“é•¿ä¸€æ®µæ—¶é—´äº†ã€‚è®¸å¤šä»£ç åº“éƒ½åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®ƒï¼Œå…¶ä»–äººæœ€ç»ˆéƒ½å°†ä¸å¾—ä¸è¿ç§»åˆ°Vue 3ã€‚æˆ‘ç°åœ¨æœ‰æœºä¼šä½¿ç”¨å®ƒå¹¶è®°å½•äº†æˆ‘çš„é”™è¯¯ï¼Œä¸‹é¢è¿™äº›é”™è¯¯ä½ å¯èƒ½æƒ³è¦é¿å…ã€‚

ä½¿ç”¨Reactiveå£°æ˜åŸå§‹å€¼
---------------

æ•°æ®å£°æ˜åœ¨è¿‡å»éƒ½æ˜¯éå¸¸ç›´æ¥çš„ï¼Œä½†æ˜¯ç°åœ¨æœ‰å¾ˆå¤šå¸®åŠ©å‡½æ•°ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚ç›®å‰çš„è§„åˆ™æ˜¯ï¼š

*   ä½¿ç”¨`reactive`å£°æ˜`Object, Array, Map, Set`
*   ä½¿ç”¨`ref`å£°æ˜`String, Number, Boolean`

ä¸ºä¸€ä¸ªåŸå§‹å€¼ä½¿ç”¨`reactive`ä¼šè¿”å›ä¸€ä¸ªè­¦å‘Šï¼Œå¹¶ä¸”è¯¥å€¼ä¸ä¼šæˆä¸ºå¯å“åº”å¼æ•°æ®ã€‚

    /* DOES NOT WORK AS EXPECTED */
    <script setup>
    import { reactive } from "vue";
    
    const count = reactive(0);
    </script>
    

> \[Vue warn\]: value cannot be made reactive

çŸ›ç›¾çš„æ˜¯ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯å¯è¡Œçš„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨`ref`æ¥å£°æ˜ä¸€ä¸ª`Array`ä¼šåœ¨å†…éƒ¨è°ƒç”¨`reactive`ã€‚

è§£æ„å“åº”å¼æ•°æ®
-------

å‡è®¾ä½ æœ‰ä¸€ä¸ªå“åº”å¼å¯¹è±¡æ‹¥æœ‰`count`å±æ€§ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæŒ‰é’®æ¥é€’å¢`count`ã€‚

    <template>
      Counter: {{ state.count }}
      <button @click="add">Increase</button>
    </template>
    
    <script>
    import { reactive } from "vue";
    export default {
      setup() {
        const state = reactive({ count: 0 });
    
        function add() {
          state.count++;
        }
    
        return {
          state,
          add,
        };
      },
    };
    </script>
    

ä¸Šè¿°é€»è¾‘ç›¸å½“ç›´æ¥ï¼Œè€Œä¸”å¦‚é¢„æœŸçš„é‚£æ ·å·¥ä½œï¼Œä½†ä½ å¯èƒ½ä¼šåˆ©ç”¨javascriptçš„è§£æ„æ¥åšä»¥ä¸‹äº‹æƒ…ï¼š

    /* DOES NOT WORK AS EXPECTED */
    <template>
      <div>Counter: {{ count }}</div>
      <button @click="add">Increase</button>
    </template>
    
    <script>
    import { reactive } from "vue";
    export default {
      setup() {
        const state = reactive({ count: 0 });
    
        function add() {
          state.count++;
        }
    
        return {
          ...state,
          add,
        };
      },
    };
    </script>
    

ä»£ç çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”æ ¹æ®æˆ‘ä»¬ä»¥å‰çš„ç»éªŒåº”è¯¥æ˜¯å¯è¡Œçš„ï¼Œä½†äº‹å®ä¸Šï¼ŒVueçš„å“åº”å¼è·Ÿè¸ªæ˜¯é€šè¿‡å±æ€§è®¿é—®è¿›è¡Œçš„ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½èµ‹å€¼æˆ–è§£æ„ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œå› ä¸ºä¸ç¬¬ä¸€ä¸ªå¼•ç”¨çš„å“åº”å¼è¿æ¥å·²ç»æ–­å¼€ã€‚è¿™å°±æ˜¯ä½¿ç”¨å“åº”å¼å¸®åŠ©å‡½æ•°çš„å±€é™æ€§ä¹‹ä¸€ã€‚

å¯¹.valueæ„Ÿåˆ°å›°æƒ‘
-----------

åŒæ ·çš„ï¼Œä½¿ç”¨`ref`çš„ä¸€ä¸ªæ€ªå¼‚æ¨¡å¼å¯èƒ½ä¹Ÿå¾ˆéš¾ä¹ æƒ¯ã€‚

`Ref`æ¥æ”¶ä¸€ä¸ªå€¼ï¼Œå¹¶è¿”å›å“åº”å¼å¯¹è±¡ã€‚è¯¥å€¼åœ¨å¯¹è±¡å†…éƒ¨çš„`.value`å±æ€§ä¸‹å¯ç”¨ã€‚

    const count = ref(0)
    
    console.log(count) // { value: 0 }
    console.log(count.value) // 0
    
    count.value++
    console.log(count.value) // 1
    

ä½†æ˜¯`ref`åœ¨æ¨¡æ¿æ–‡ä»¶ä¸­ä½¿ç”¨æ—¶ä¼šè¢«è§£åŒ…ï¼Œå¹¶ä¸”ä¸éœ€è¦`.value`ã€‚

    <script setup>
    import { ref } from 'vue'
    
    const count = ref(0)
    
    function increment() {
      count.value++
    }
    </script>
    
    <template>
      <button @click="increment">
        {{ count }} // no .value needed
      </button>
    </template>
    

ä½†æ˜¯è¦å°å¿ƒäº†ï¼è§£åŒ…åªåœ¨é¡¶çº§å±æ€§ä¸­ç”Ÿæ•ˆã€‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µä¼šç”Ÿæˆ`[object Object]`ã€‚

    // DON'T DO THIS
    <script setup>
    import { ref } from 'vue'
    
    const object = { foo: ref(1) }
    
    </script>
    
    <template>
      {{ object.foo + 1 }}  // [object Object]
    </template>
    

æ­£ç¡®åœ°ä½¿ç”¨`.value`éœ€è¦æ—¶é—´ã€‚å°½ç®¡æŸäº›æ—¶å€™æˆ‘ä¼šå¿˜è®°å¦‚ä½•ä½¿ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨å®ƒçš„é¢‘ç‡è¶Šæ¥è¶Šé«˜ã€‚

è§¦å‘äº‹ä»¶
----

è‡ªä»Vueçš„æœ€åˆå‘å¸ƒä»¥æ¥ï¼Œå­ç»„ä»¶å°±å¯ä»¥ä¸çˆ¶ç»„ä»¶ä½¿ç”¨`emit`æ¥é€šä¿¡ã€‚ä½ åªéœ€è¦æ·»åŠ è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨æ¥ç›‘å¬ä¸€ä¸ªäº‹ä»¶ã€‚

    // å­ç»„ä»¶
    this.$emit('my-event')
    
    // çˆ¶ç»„ä»¶
    <my-component @my-event="doSomething" />
    

ç°åœ¨ï¼Œ`emit`éœ€è¦ä½¿ç”¨`defineEmits`æ¥è¿›è¡Œå£°æ˜ã€‚

    <script setup>
    const emit = defineEmits(['my-event'])
    emit('my-event')
    </script>
    

å¦ä¸€ä»¶è¦è®°ä½çš„äº‹æƒ…æ˜¯ï¼Œ`defineEmits`å’Œ`defineProps`éƒ½ä¸éœ€è¦è¢«å¯¼å…¥ã€‚å®ƒä»¬åœ¨ä½¿ç”¨`script setup`æ—¶è‡ªåŠ¨å¯ç”¨ã€‚

    <script setup>
    const props = defineProps({
      foo: String
    })
    
    const emit = defineEmits(['change', 'delete'])
    // setup code
    </script>
    

æœ€åï¼Œç”±äºäº‹ä»¶ç°åœ¨å¿…é¡»è¢«å£°æ˜ï¼Œæ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨`.native`ä¿®é¥°ç¬¦ï¼Œäº‹å®ä¸Šå®ƒå·²ç»è¢«ç§»é™¤äº†ã€‚

å£°æ˜é™„åŠ é€‰é¡¹
------

Options APIæ–¹æ³•æœ‰å‡ ä¸ªå±æ€§åœ¨`script setup`ä¸­æ˜¯ä¸è¢«æ”¯æŒçš„ã€‚

*   `name`
*   `inheritAttrs`
*   æ’ä»¶æˆ–åº“æ‰€éœ€çš„è‡ªå®šä¹‰é€‰é¡¹

è§£å†³åŠæ³•æ˜¯æŒ‰ç…§`script setup`RFCçš„[å®šä¹‰](https://github.com/vuejs/rfcs/blob/master/active-rfcs/0040-script-setup.md#declaring-additional-options)ï¼Œåœ¨åŒä¸€ä¸ªç»„ä»¶ä¸­è®¾ç½®ä¸¤ä¸ªä¸åŒçš„è„šæœ¬ã€‚

    <script>
      export default {
        name: 'CustomName',
        inheritAttrs: false,
        customOptions: {}
      }
    </script>
    
    <script setup>
      // script setup logic
    </script>
    

ä½¿ç”¨å“åº”å¼è½¬æ¢
-------

Reactivity Transformæ˜¯Vue 3çš„ä¸€ä¸ª[å®éªŒæ€§ä½†æœ‰äº‰è®®çš„åŠŸèƒ½](https://github.com/vuejs/rfcs/discussions/369)ï¼Œç›®çš„æ˜¯ç®€åŒ–ç»„ä»¶çš„å£°æ˜æ–¹å¼ã€‚å®ƒçš„æƒ³æ³•æ˜¯åˆ©ç”¨ç¼–è¯‘æ—¶çš„è½¬æ¢æ¥è‡ªåŠ¨è§£åŒ…ä¸€ä¸ª`ref`ï¼Œå¹¶ä½¿`.value`è¿‡æ—¶ã€‚ä½†ç°åœ¨å®ƒè¢«æ”¾å¼ƒäº†ï¼Œå¹¶å°†åœ¨Vue 3.3ä¸­è¢«åˆ é™¤ã€‚å®ƒä»ç„¶å¯ä»¥ä½œä¸ºä¸€ä¸ªåŒ…ä½¿ç”¨ï¼Œä½†ç”±äºå®ƒä¸æ˜¯Vueæ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦åœ¨å®ƒèº«ä¸ŠæŠ•å…¥æ—¶é—´ã€‚

å®šä¹‰å¼‚æ­¥ç»„ä»¶
------

ä»¥å‰çš„å¼‚æ­¥ç»„ä»¶æ˜¯é€šè¿‡å°†å…¶åŒ…å«åœ¨ä¸€ä¸ªå‡½æ•°ä¸­æ¥å£°æ˜çš„ã€‚

    const asyncModal = () => import('./Modal.vue')
    

ä» Vue 3å¼€å§‹ï¼Œå¼‚æ­¥ç»„ä»¶éœ€è¦ä½¿ç”¨`defineAsyncComponent`å¸®åŠ©å‡½æ•°æ¥æ˜¾å¼åœ°å®šä¹‰ã€‚

    import { defineAsyncComponent } from 'vue'
    
    const asyncModal = defineAsyncComponent(() => import('./Modal.vue'))
    

åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å¤šä½™çš„åŒ…è£¹å…ƒç´ 
-------------

åœ¨Vue 2ä¸­ï¼Œç»„ä»¶æ¨¡æ¿éœ€è¦ä¸€ä¸ªå•ä¸€çš„æ ¹å…ƒç´ ï¼Œè¿™æœ‰æ—¶ä¼šå¼•å…¥ä¸å¿…è¦çš„åŒ…è£¹å…ƒç´ ã€‚

    <!-- Layout.vue -->
    <template>
      <div>
        <header>...</header>
        <main>...</main>
        <footer>...</footer>
      </div>
    </template>
    

ç°åœ¨ä¸å†éœ€è¦è¿™æ ·äº†ï¼Œå› ä¸ºç°åœ¨æ”¯æŒå¤šä¸ªæ ¹å…ƒç´ ã€‚ğŸ¥³

    <!-- Layout.vue -->
    <template>
      <header>...</header>
      <main v-bind="$attrs">...</main>
      <footer>...</footer>
    </template>
    

ä½¿ç”¨é”™è¯¯çš„ç”Ÿå‘½å‘¨æœŸ
---------

æ‰€æœ‰çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸäº‹ä»¶éƒ½è¢«é‡æ–°å‘½åï¼Œè¦ä¹ˆæ·»åŠ `on`å‰ç¼€ï¼Œè¦ä¹ˆå®Œå…¨æ”¹å˜åç§°ã€‚ä½ å¯ä»¥åœ¨ä¸‹é¢çš„å›¾è¡¨ä¸­æŸ¥çœ‹æ‰€æœ‰çš„å˜åŒ–ã€‚

![Lifecycle Event.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4e885d3e5eb34924a0abcf40c4c8c35f~tplv-k3u1fbpfcp-watermark.image?)

ä¸çœ‹æ–‡æ¡£
----

æœ€åï¼Œå®˜æ–¹æ–‡æ¡£å·²ç»è¿›è¡Œäº†ä¿®æ”¹ä»¥åæ˜ æ–°çš„APIï¼Œå¹¶åŒ…æ‹¬è®¸å¤šæœ‰ä»·å€¼çš„è¯´æ˜ã€æŒ‡å—å’Œæœ€ä½³å®è·µã€‚å³ä½¿ä½ æ˜¯ä¸€ä¸ªç»éªŒä¸°å¯Œçš„Vue 2å·¥ç¨‹å¸ˆï¼Œä½ ä¹Ÿä¸€å®šä¼šé€šè¿‡é˜…è¯»æ–‡æ¡£å­¦åˆ°ä¸€äº›æ–°ä¸œè¥¿ã€‚

æ€»ç»“
--

æ¯ä¸ªæ¡†æ¶éƒ½æœ‰ä¸€ä¸ªå­¦ä¹ æ›²çº¿ï¼Œè€ŒVue 3çš„å­¦ä¹ æ›²çº¿æ— ç–‘æ¯”Vue 2çš„æ›´é™¡å³­ã€‚æˆ‘ä»ç„¶ä¸ç›¸ä¿¡ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´çš„è¿ç§»å·¥ä½œæ˜¯åˆç†çš„ï¼Œä½†ç»„åˆå¼APIè¦æ•´æ´å¾—å¤šï¼Œåœ¨ä½ æŒæ¡äº†å®ƒä¹‹åä¼šæ„Ÿè§‰å¾ˆè‡ªç„¶ã€‚

æœ€åï¼Œè¯·è®°ä½ï¼š

> çŠ¯é”™æ¯”ä»€ä¹ˆéƒ½ä¸åšè¦å¥½å¾—å¤šã€‚
> 
> Making mistakes is a lot better than not doing anything.

ä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹ã€‚å¦‚æœå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€è½¬å‘~