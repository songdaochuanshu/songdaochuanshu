---
layout: post
title: "Goå¾®æœåŠ¡æ¡†æ¶go-kratoså®æˆ˜01ï¼šquickstart å¿«é€Ÿå¼€å§‹"
date: "2022-05-29T22:19:09.017Z"
---
Goå¾®æœåŠ¡æ¡†æ¶go-kratoså®æˆ˜01ï¼šquickstart å¿«é€Ÿå¼€å§‹
====================================

å…ˆæ¥æ„Ÿå—ä¸‹ç”¨ kratos å¿«é€Ÿåˆ›å»ºé¡¹ç›®

ä¸€ã€ç¯å¢ƒå‡†å¤‡
------

1.1 å®‰è£…ä¾èµ–è½¯ä»¶

*   [protoc](https://github.com/protocolbuffers/protobuf)
*   [protoc-gen-go](https://github.com/protocolbuffers/protobuf-go)

å»ºè®®å¼€å¯ GO111MODULE

1.2 å®‰è£… kratos cli

> go install github.com/go-kratos/kratos/cmd/kratos/v2@latest

CLI å·¥å…·ä½¿ç”¨è¯´æ˜ï¼š[CLIå·¥å…·ä½¿ç”¨](https://go-kratos.dev/docs/getting-started/usage)

go-kratos å’Œ Go ç‰ˆæœ¬ï¼š

> go 1.17  
> go-kratos v2.2.1

äºŒã€åˆ›å»ºå’Œè¿è¡Œé¡¹ç›®
---------

2.1 é€šè¿‡ `kratos new` å‘½ä»¤åˆ›å»ºé¡¹ç›®æ¨¡æ¿

ä½¿ç”¨ `kratos new` å‘½ä»¤åˆ›å»º quickstart é¡¹ç›®ï¼š

> kratos new quickstart

ä½¿ç”¨è¯¥å‘½ä»¤åˆ›å»ºé¡¹ç›®ï¼š

    $ kratos new quickstart
    ğŸš€ Creating service quickstart, layout repo is https://github.com/go-kratos/kratos-layout.git, please wait a moment.
    
    From https://github.com/go-kratos/kratos-layout
       cf30efc..cc5192f  main       -> origin/main
     * [new tag]         v2.2.1     -> v2.2.1
     * [new tag]         v2.1.3     -> v2.1.3
     * [new tag]         v2.1.4     -> v2.1.4
     * [new tag]         v2.1.5     -> v2.1.5
     * [new tag]         v2.2.0     -> v2.2.0
    Updating cf30efc..cc5192f
    Fast-forward
     .github/workflows/gitee-sync.yml                   |  27 +
     Makefile                                           |  35 +-
     README.md                                          |   2 +-
     api/helloworld/v1/error_reason.pb.go               | 100 ++--
     api/helloworld/v1/error_reason.proto               |  11 +-
     api/helloworld/v1/error_reason_errors.pb.go        |  30 -
     api/helloworld/v1/greeter.pb.go                    | 114 ++--
    
    ... ...
    
    
    ğŸº Project creation succeeded quickstart
    ğŸ’» Use the following command to start the project ğŸ‘‡:
    
    $ cd quickstart
    $ go generate ./...
    $ go build -o ./bin/ ./...
    $ ./bin/quickstart -conf ./configs
    
                            ğŸ¤ Thanks for using Kratos
            ğŸ“š Tutorial: https://go-kratos.dev/docs/getting-started/start
    

å¦‚æœæ‹‰å– github ä¸Šçš„é¡¹ç›®æ¨¡æ¿å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨ `-r` å‚æ•°æŒ‡å®šæ‹‰å–é¡¹ç›®æ¨¡æ¿åœ°å€.

æ¯”å¦‚æ‹‰å– gitee ä¸Šçš„æ¨¡æ¿ï¼š

> kratos new quickstart -r [https://gitee.com/go-kratos/kratos-layout.git](https://gitee.com/go-kratos/kratos-layout.git)

æ›´å¤šå‘½ä»¤çš„ä½¿ç”¨ï¼š[kratos å‘½ä»¤ä½¿ç”¨](https://go-kratos.dev/docs/getting-started/usage)

2.2 ä½¿ç”¨ go generate å‘½ä»¤ç”Ÿæˆç›¸åº”ä»£ç 

ç”Ÿæˆ proto æºç ã€wire ç­‰ç­‰ï¼š

    $ go generate ./...
    go: downloading github.com/go-kratos/kratos/v2 v2.2.1
    go: downloading google.golang.org/genproto v0.0.0-20220222213610-43724f9ea8cf
    go: downloading github.com/go-logr/logr v1.2.1
    go: downloading github.com/go-logr/stdr v1.2.0
    
    ... ...
    

2.3 è¿è¡Œé¡¹ç›®

ä½¿ç”¨ `kratos run` å‘½ä»¤è¿è¡Œé¡¹ç›®

    $ kratos run
    INFO msg=config loaded: config.yaml format: yaml
    INFO msg=[gRPC] server listening on: [::]:9000
    INFO msg=[HTTP] server listening on: [::]:8000
    

2.4 æµ‹è¯•æ¥å£

æˆ‘ä½¿ç”¨çš„ go å†™çš„ curlieï¼š[https://github.com/rs/curlie](https://github.com/rs/curlie) æµ‹è¯•ï¼š

    $ curlie  http://localhost:8000/helloworld/kratos
    HTTP/1.1 200 OK
    {
        "message": "Hello kratos"
    }
    

ä¸‰ã€kratos é¡¹ç›®å¸ƒå±€
-------------

åŸºäº kratos-layout åˆ›å»ºçš„é¡¹ç›®ï¼Œä½¿ç”¨çš„ kratos new å‘½ä»¤ï¼š

> kratos new

ç”Ÿæˆçš„ç›®å½•ç»“æ„å›¾å¦‚ä¸‹ï¼š

      .
    â”œâ”€â”€ Dockerfile  
    â”œâ”€â”€ LICENSE
    â”œâ”€â”€ Makefile  
    â”œâ”€â”€ README.md
    â”œâ”€â”€ api // ä¸‹é¢ç»´æŠ¤äº†å¾®æœåŠ¡ä½¿ç”¨çš„protoæ–‡ä»¶ä»¥åŠæ ¹æ®å®ƒä»¬æ‰€ç”Ÿæˆçš„goæ–‡ä»¶
    â”‚Â Â  â””â”€â”€ helloworld
    â”‚Â Â      â””â”€â”€ v1
    â”‚Â Â          â”œâ”€â”€ error_reason.pb.go
    â”‚Â Â          â”œâ”€â”€ error_reason.proto
    â”‚Â Â          â”œâ”€â”€ error_reason.swagger.json
    â”‚Â Â          â”œâ”€â”€ greeter.pb.go
    â”‚Â Â          â”œâ”€â”€ greeter.proto
    â”‚Â Â          â”œâ”€â”€ greeter.swagger.json
    â”‚Â Â          â”œâ”€â”€ greeter_grpc.pb.go
    â”‚Â Â          â””â”€â”€ greeter_http.pb.go
    â”œâ”€â”€ cmd  // æ•´ä¸ªé¡¹ç›®å¯åŠ¨çš„å…¥å£æ–‡ä»¶
    â”‚Â Â  â””â”€â”€ server
    â”‚Â Â      â”œâ”€â”€ main.go
    â”‚Â Â      â”œâ”€â”€ wire.go  // æˆ‘ä»¬ä½¿ç”¨wireæ¥ç»´æŠ¤ä¾èµ–æ³¨å…¥
    â”‚Â Â      â””â”€â”€ wire_gen.go
    â”œâ”€â”€ configs  // è¿™é‡Œé€šå¸¸ç»´æŠ¤ä¸€äº›æœ¬åœ°è°ƒè¯•ç”¨çš„æ ·ä¾‹é…ç½®æ–‡ä»¶
    â”‚Â Â  â””â”€â”€ config.yaml
    â”œâ”€â”€ generate.go
    â”œâ”€â”€ go.mod
    â”œâ”€â”€ go.sum
    â”œâ”€â”€ internal  // è¯¥æœåŠ¡æ‰€æœ‰ä¸å¯¹å¤–æš´éœ²çš„ä»£ç ï¼Œé€šå¸¸çš„ä¸šåŠ¡é€»è¾‘éƒ½åœ¨è¿™ä¸‹é¢ï¼Œä½¿ç”¨internalé¿å…é”™è¯¯å¼•ç”¨
    â”‚   â”œâ”€â”€ biz   // ä¸šåŠ¡é€»è¾‘çš„ç»„è£…å±‚ï¼Œç±»ä¼¼ DDD çš„ domain å±‚ï¼Œdata ç±»ä¼¼ DDD çš„ repoï¼Œè€Œ repo æ¥å£åœ¨è¿™é‡Œå®šä¹‰ï¼Œä½¿ç”¨ä¾èµ–å€’ç½®çš„åŸåˆ™ã€‚
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ README.md
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ biz.go
    â”‚Â Â  â”‚Â Â  â””â”€â”€ greeter.go
    â”‚Â Â  â”œâ”€â”€ conf  // å†…éƒ¨ä½¿ç”¨çš„configçš„ç»“æ„å®šä¹‰ï¼Œä½¿ç”¨protoæ ¼å¼ç”Ÿæˆ
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ conf.pb.go
    â”‚Â Â  â”‚Â Â  â””â”€â”€ conf.proto
    â”‚Â Â  â”œâ”€â”€ data  // ä¸šåŠ¡æ•°æ®è®¿é—®ï¼ŒåŒ…å« cacheã€db ç­‰å°è£…ï¼Œå®ç°äº† biz çš„ repo æ¥å£ã€‚æˆ‘ä»¬å¯èƒ½ä¼šæŠŠ data ä¸ dao æ··æ·†åœ¨ä¸€èµ·ï¼Œdata åé‡ä¸šåŠ¡çš„å«ä¹‰ï¼Œå®ƒæ‰€è¦åšçš„æ˜¯å°†é¢†åŸŸå¯¹è±¡é‡æ–°æ‹¿å‡ºæ¥ï¼Œæˆ‘ä»¬å»æ‰äº† DDD çš„ infraå±‚ã€‚
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ README.md
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ data.go
    â”‚Â Â  â”‚Â Â  â””â”€â”€ greeter.go
    â”‚Â Â  â”œâ”€â”€ server  // httpå’Œgrpcå®ä¾‹çš„åˆ›å»ºå’Œé…ç½®
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ grpc.go
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ http.go
    â”‚Â Â  â”‚Â Â  â””â”€â”€ server.go
    â”‚Â Â  â””â”€â”€ service  // å®ç°äº† api å®šä¹‰çš„æœåŠ¡å±‚ï¼Œç±»ä¼¼ DDD çš„ application å±‚ï¼Œå¤„ç† DTO åˆ° biz é¢†åŸŸå®ä½“çš„è½¬æ¢(DTO -> DO)ï¼ŒåŒæ—¶ååŒå„ç±» biz äº¤äº’ï¼Œä½†æ˜¯ä¸åº”å¤„ç†å¤æ‚é€»è¾‘
    â”‚Â Â      â”œâ”€â”€ README.md
    â”‚Â Â      â”œâ”€â”€ greeter.go
    â”‚Â Â      â””â”€â”€ service.go
    â””â”€â”€ third_party  // api ä¾èµ–çš„ç¬¬ä¸‰æ–¹proto
        â”œâ”€â”€ README.md
        â”œâ”€â”€ google
        â”‚Â Â  â””â”€â”€ api
        â”‚Â Â      â”œâ”€â”€ annotations.proto
        â”‚Â Â      â”œâ”€â”€ http.proto
        â”‚Â Â      â””â”€â”€ httpbody.proto
        â””â”€â”€ validate
            â”œâ”€â”€ README.md
            â””â”€â”€ validate.proto
    

æ•´ä¸ªé¡¹ç›®æ¶æ„æµç¨‹å›¾ï¼Œå®˜æ–¹çš„ä¸€ä¸ªæ¶æ„å›¾ï¼š

![image-20220528195535136](https://img2022.cnblogs.com/blog/650581/202205/650581-20220529220545005-1708774495.png)

ä¸Šé¢è™½ç„¶å¯¹ä»£ç ç»“æ„åšäº†æ–‡å­—è¯´æ˜ï¼Œä½†æ˜¯åœ¨ internal é‡Œï¼Œæœ‰ DDD è¿™ä¸ªæ¦‚å¿µï¼Œç›¸ä¿¡å¾ˆå¤šäººçœ‹äº†åï¼Œä¸æ˜¯å¾ˆæ˜ç™½ã€‚

å…ˆæ¥çœ‹çœ‹ DDD çš„åˆ†å±‚æ¶æ„ï¼Œæ¶æ„å›¾å¦‚ä¸‹ï¼š

![image-20220529175626340](https://img2022.cnblogs.com/blog/650581/202205/650581-20220529220544996-1213643788.png)

å†æ¥å¯¹æ¯”çœ‹çœ‹ internal ç›®å½•é‡Œçš„ bizã€dataã€serviceã€serverã€conf è¿™ 5 ä¸ªç›®å½•ã€‚

*   bizï¼šæ–‡æ¡£é‡Œè¯´äº†ç±»ä¼¼ DDD çš„ domain å±‚ï¼Œä¹Ÿå°±æ˜¯ DDD æ¶æ„ä¸­çš„é¢†åŸŸå±‚ã€‚è¿™é‡Œè¿˜å®šä¹‰äº†å¯¹ä¸šåŠ¡æ“ä½œçš„æ¥å£ã€‚ä¸šåŠ¡é€»è¾‘ç»„è£…ã€‚
*   dataï¼šå¯¹æ•°æ®åº“ dbï¼Œç¼“å­˜ cache çš„å°è£…ï¼Œå¹¶ä¸”å®ç° biz ä¸­å®šä¹‰çš„æ¥å£ã€‚å®ƒå°†é¢†åŸŸå¯¹è±¡é‡æ–°æ‹¿å‡ºæ¥ï¼Œè¿™é‡Œå»æ‰äº† DDD çš„åŸºç¡€å±‚ã€‚
*   serviceï¼šå®ç° api å®šä¹‰çš„æœåŠ¡å±‚ï¼Œç±»ä¼¼ DDD çš„åº”ç”¨å±‚ã€‚å¤„ç†æ•°æ®ä¼ è¾“å¯¹è±¡åˆ° biz(é¢†åŸŸå®ä½“)çš„è½¬æ¢ã€‚åŒæ—¶ååŒå„ç±» biz äº¤äº’ï¼Œä¸åº”å¤„ç†å¤æ‚é€»è¾‘ã€‚
*   serverï¼šhttp å’Œ grpc å®ä¾‹çš„åˆ›å»ºå’Œé…ç½®ï¼Œä»¥åŠæ³¨å†Œå¯¹åº”çš„ serviceã€‚

> service -> biz -> data

å››ã€å‚è€ƒ
----

*   [https://go-kratos.dev/docs/getting-started/start](https://go-kratos.dev/docs/getting-started/start) kratos é¡¹ç›®åˆå§‹åŒ–
*   [https://go-kratos.dev/docs/intro/layout](https://go-kratos.dev/docs/intro/layout) kratos é¡¹ç›®ç»“æ„

\== just do it ==