---
layout: post
title: "ArrayList å¯ä»¥å®Œå…¨æ›¿ä»£æ•°ç»„å—ï¼Ÿ"
date: "2022-11-20T18:21:29.111Z"
---
ArrayList å¯ä»¥å®Œå…¨æ›¿ä»£æ•°ç»„å—ï¼Ÿ
====================

> **æœ¬æ–‡å·²æ”¶å½•åˆ° Â [GitHub Â· AndroidFamily](https://github.com/pengxurui/AndroidFamily)ï¼Œæœ‰ Android è¿›é˜¶çŸ¥è¯†ä½“ç³»ï¼Œæ¬¢è¿ Starã€‚æŠ€æœ¯å’ŒèŒåœºé—®é¢˜ï¼Œè¯·å…³æ³¨å…¬ä¼—å· \[å½­æ—­é”\] åŠ å…¥ Android äº¤æµç¾¤ã€‚**

å‰è¨€
--

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°å½­ã€‚

[åœ¨å‰é¢çš„æ–‡ç« é‡Œ](https://mp.weixin.qq.com/s/_zbUXmgulPe4PSsSSdQdJg)ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¾ˆå¤šæ•°æ®ç»“æ„ä¸ç®—æ³•æ€æƒ³ã€‚åœ¨å®é™…çš„ä¸šåŠ¡å¼€å‘ä¸­ï¼Œå¾€å¾€ä¸éœ€è¦æˆ‘ä»¬æ‰‹å†™æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æ ‡å‡†åº“çš„æ•°æ®ç»“æ„ / å®¹å™¨ç±»ã€‚

åœ¨åç»­çš„æ–‡ç« é‡Œï¼Œæˆ‘ä»¬å°†ä»¥ Java è¯­è¨€ä¸ºä¾‹ï¼Œåˆ†æä» ArrayList åˆ° LinkedHashMap ç­‰ä¸€ç³»åˆ—æ ‡å‡†åº“å®¹å™¨ç±»ï¼Œæœ€åå†æœ‰ä¸€ç¯‡æ€»ç»“å›é¡¾ï¼Œè¯·å…³æ³¨ã€‚

* * *

**å­¦ä¹ è·¯çº¿å›¾ï¼š**

![](https://files.mdnice.com/user/3257/12ba3412-601a-44fc-a664-a7f2db206d7c.png)

* * *

1\. è¯´ä¸€ä¸‹ ArrayList å’Œ LinkedList çš„åŒºåˆ«ï¼Ÿ
-----------------------------------

*   **1ã€æ•°æ®ç»“æ„ï¼š** åœ¨æ•°æ®ç»“æ„ä¸Šï¼ŒArrayList å’Œ LinkedList éƒ½æ˜¯ â€œçº¿æ€§è¡¨â€ï¼Œéƒ½ç»§æ‰¿äº Java çš„ `List` æ¥å£ã€‚å¦å¤– LinkedList è¿˜å®ç°äº† Java çš„ `Deque` æ¥å£ï¼Œæ˜¯åŸºäºé“¾è¡¨çš„æ ˆæˆ–é˜Ÿåˆ—ï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯ `ArrayDeque` åŸºäºæ•°ç»„çš„æ ˆæˆ–é˜Ÿåˆ—ï¼›
    
*   **2ã€çº¿ç¨‹å®‰å…¨ï¼š** ArrayList å’Œ LinkedList éƒ½ä¸è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œä¸ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›
    
*   **3ã€åº•å±‚å®ç°ï¼š** åœ¨åº•å±‚å®ç°ä¸Šï¼ŒArrayList æ˜¯åŸºäºåŠ¨æ€æ•°ç»„çš„ï¼Œè€Œ LinkedList æ˜¯åŸºäºåŒå‘é“¾è¡¨çš„ã€‚äº‹å®ä¸Šï¼Œå®ƒä»¬å¾ˆå¤šç‰¹æ€§çš„åŒºåˆ«éƒ½æ˜¯å› ä¸ºåº•å±‚å®ç°ä¸åŒå¼•èµ·çš„ã€‚æ¯”å¦‚è¯´ï¼š
    
    *   **åœ¨éå†é€Ÿåº¦ä¸Šï¼š** æ•°ç»„æ˜¯ä¸€å—è¿ç»­å†…å­˜ç©ºé—´ï¼ŒåŸºäºå±€éƒ¨æ€§åŸç†èƒ½å¤Ÿæ›´å¥½åœ°å‘½ä¸­ CPU ç¼“å­˜è¡Œï¼Œè€Œé“¾è¡¨æ˜¯ç¦»æ•£çš„å†…å­˜ç©ºé—´å¯¹ç¼“å­˜è¡Œä¸å‹å¥½ï¼›
        
    *   **åœ¨è®¿é—®é€Ÿåº¦ä¸Šï¼š** æ•°ç»„æ˜¯ä¸€å—è¿ç»­å†…å­˜ç©ºé—´ï¼Œæ”¯æŒ O(1) æ—¶é—´å¤æ‚åº¦éšæœºè®¿é—®ï¼Œè€Œé“¾è¡¨éœ€è¦ O(n) æ—¶é—´å¤æ‚åº¦æŸ¥æ‰¾å…ƒç´ ï¼›
        
    *   **åœ¨æ·»åŠ å’Œåˆ é™¤æ“ä½œä¸Šï¼š** å¦‚æœæ˜¯åœ¨æ•°ç»„çš„æœ«å°¾æ“ä½œåªéœ€è¦ O(1) æ—¶é—´å¤æ‚åº¦ï¼Œä½†åœ¨æ•°ç»„ä¸­é—´æ“ä½œéœ€è¦æ¬è¿å…ƒç´ ï¼Œæ‰€ä»¥éœ€è¦ O(n)æ—¶é—´å¤æ‚åº¦ï¼Œè€Œé“¾è¡¨çš„åˆ é™¤æ“ä½œæœ¬èº«åªæ˜¯ä¿®æ”¹å¼•ç”¨æŒ‡å‘ï¼Œåªéœ€è¦ O(1) æ—¶é—´å¤æ‚åº¦ï¼ˆå¦‚æœè€ƒè™‘æŸ¥è¯¢è¢«åˆ é™¤èŠ‚ç‚¹çš„æ—¶é—´ï¼Œå¤æ‚åº¦åˆ†æä¸Šä¾ç„¶æ˜¯ O(n)ï¼Œåœ¨å·¥ç¨‹åˆ†æä¸Šè¿˜æ˜¯æ¯”æ•°ç»„å¿«ï¼‰ï¼›
        
    *   **é¢å¤–å†…å­˜æ¶ˆè€—ä¸Šï¼š** ArrayList åœ¨æ•°ç»„çš„å°¾éƒ¨å¢åŠ äº†é—²ç½®ä½ç½®ï¼Œè€Œ LinkedList åœ¨èŠ‚ç‚¹ä¸Šå¢åŠ äº†å‰é©±å’Œåç»§æŒ‡é’ˆã€‚
        

* * *

2\. ArrayList æºç åˆ†æ
------------------

è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬æ¥åˆ†æ ArrayList ä¸­ä¸»è¦æµç¨‹çš„æºç ã€‚

### 2.1 ArrayList çš„å±æ€§

ArrayList çš„å±æ€§å¾ˆå¥½ç†è§£ï¼Œåº•å±‚æ˜¯ä¸€ä¸ª Object æ•°ç»„ï¼Œæˆ‘è¦ä¸¾æ‰‹æé—®ï¼š

*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 1ï¼š** ä¸ºä»€ä¹ˆ elementData å­—æ®µä¸å£°æ˜ `private` å…³é”®å­—ï¼Ÿ
*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 2ï¼š** ä¸ºä»€ä¹ˆ elementData å­—æ®µå£°æ˜ `transient` å…³é”®å­—ï¼Ÿ
*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 3ï¼š** ä¸ºä»€ä¹ˆelementData å­—æ®µä¸å£°æ˜ä¸ºæ³›å‹ç±»å‹ `E`ï¼Ÿ
*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 4ï¼š** ä¸ºä»€ä¹ˆ ArrayList çš„æœ€å¤§å®¹é‡æ˜¯ `Integer.MAX_VALUE`ï¼Œ`Long.MAX_VALUE` ä¸è¡Œå—ï¼Ÿ
*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 5ï¼š** ä¸ºä»€ä¹ˆ ArrayList çš„æœ€å¤§å®¹é‡æ˜¯ `MAX_VALUE - 8`ï¼Œä¸€å®šä¼šå‡ `8` å—ï¼Ÿ

è¿™äº›é—®é¢˜æˆ‘ä»¬åœ¨åˆ†ææºç çš„è¿‡ç¨‹ä¸­å›ç­”ã€‚ç–‘é—®è¿™ä¹ˆå¤šï¼ŒArrayList ç¬é—´ä¸é¦™äº†ã€‚

    public class ArrayList<E> extends AbstractList<E> implements List<E>, RandomAccess, Cloneable, java.io.Serializable {
        // new ArrayList() é»˜è®¤åˆå§‹å®¹é‡
        private static final int DEFAULT_CAPACITY = 10;
    
        // new ArrayList(0) çš„å…¨å±€ç©ºæ•°ç»„
        private static final Object[] EMPTY_ELEMENTDATA = {};
    
        // new ArrayList() çš„å…¨å±€ç©ºæ•°ç»„
        private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};
    
        // ä¿®æ”¹æ¬¡æ•°è®°å½•
        protected transient int modCount = 0;
    
        // æ•°ç»„çš„æœ€å¤§é•¿åº¦
        // ç–‘é—® 4ï¼šä¸ºä»€ä¹ˆ ArrayList çš„æœ€å¤§å®¹é‡æ˜¯ Integer.MAX_VALUEï¼ŒLong.MAX_VALUE ä¸è¡Œå—ï¼Ÿ
        // ç–‘é—® 5ï¼šä¸ºä»€ä¹ˆ ArrayList çš„æœ€å¤§å®¹é‡æ˜¯ MAX_VALUE - 8ï¼Œä¸€å®šä¼šå‡ 8 å—ï¼Ÿ
        private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8
    
        // ç–‘é—® 1ï¼šä¸ºä»€ä¹ˆä¸å£°æ˜ privateï¼ˆåæ–‡å›ç­”ï¼‰
        // ç–‘é—® 2ï¼šä¸ºä»€ä¹ˆå£°æ˜ transientï¼ˆåæ–‡å›ç­”ï¼‰
        // ç–‘é—® 3ï¼šä¸ºä»€ä¹ˆä¸å£°æ˜ä¸ºæ³›å‹ç±»å‹ E
        // åº•å±‚æ•°ç»„
        transient Object[] elementData;
    
        // æ•°ç»„çš„æœ‰æ•ˆé•¿åº¦ï¼ˆä¸æ˜¯ elementData.lengthï¼‰
        private int size;
    
        // size() è¿”å›çš„æ˜¯æ•°ç»„çš„æœ‰æ•ˆé•¿åº¦ï¼ˆåˆç†ï¼Œåº•å±‚æ•°ç»„æˆ‘ä»¬ä¸å…³å¿ƒï¼‰
        public int size() {
            return size;
        }
    }
    

### 2.2 ArrayList çš„æ„é€ æ–¹æ³•

ArrayList æœ‰ä¸‰ä¸ªæ„é€ å‡½æ•°ï¼š

*   **1ã€å¸¦åˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³•ï¼š** å¦‚æœåˆå§‹å®¹é‡å¤§äº 0ï¼Œåˆ™åˆ›å»ºæŒ‡å®šé•¿åº¦çš„æ•°ç»„ã€‚å¦‚æœåˆå§‹å®¹é‡æ˜¯ 0ï¼Œåˆ™æŒ‡å‘ç¬¬ 1 ä¸ªå…¨å±€ç©ºæ•°ç»„ ï¼›`EMPTY_ELEMENTDATA`ï¼›
*   **2ã€æ— å‚æ„é€ æ–¹æ³•ï¼š** æŒ‡å‘ç¬¬ 2 ä¸ªå…¨å±€ç©ºæ•°ç»„ `DEFAULTCAPACITY_EMPTY_ELEMENTDATA`ï¼›
*   **3ã€å¸¦é›†åˆçš„æ„é€ æ–¹æ³•ï¼š** å°†é›†åˆè½¬ä¸ºæ•°ç»„ï¼Œå¦‚æœæ•°ç»„ä¸ºç©ºï¼Œåˆ™æŒ‡å‘ç¬¬ 1 ä¸ªå…¨å±€ç©ºæ•°ç»„ `EMPTY_ELEMENTDATA`ï¼›

**å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æŒ‡å®šå¤§äº 0 çš„åˆå§‹å®¹é‡å¤–ï¼ŒArrayList åœ¨æ„é€ æ—¶ä¸ä¼šåˆ›å»ºæ•°ç»„ï¼Œè€Œæ˜¯æŒ‡å‘å…¨å±€ç©ºæ•°ç»„ï¼Œè¿™æ˜¯æ‡’åˆå§‹åŒ–çš„ç­–ç•¥ã€‚**

æ„é€ å™¨çš„æºç ä¸éš¾ï¼Œä½†å°æœ‹å‹æ€»æœ‰å¤ªå¤šçš„é—®å·ï¼Œä¸¾æ‰‹æé—® ğŸ™‹ğŸ»â€â™€ï¸ï¼š

*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 6ï¼šæ—¢ç„¶éƒ½æ˜¯å®¹é‡ä¸º 0 ï¼Œä¸ºä»€ä¹ˆ ArrayList è¦åŒºåˆ†å‡º 2 ä¸ªç©ºæ•°ç»„ï¼Ÿ**

è¿™ä¸ªé—®é¢˜ç›´æ¥å›ç­”å§ï¼šArrayList è®¤ä¸ºæ— å‚æ„é€ å‡½æ•°åº”è¯¥ä½¿ç”¨é»˜è®¤è¡Œä¸ºï¼Œåœ¨é¦–æ¬¡æ·»åŠ æ•°æ®æ—¶ä¼šåˆ›å»ºé•¿åº¦ä¸º `10ï¼ˆDEFAULT_CAPACITYï¼‰` çš„é»˜è®¤åˆå§‹æ•°ç»„ï¼›è€Œæ˜¾ç¤ºè®¾ç½®åˆå§‹å®¹é‡ä¸º 0 æ˜¯å¼€å‘è€…çš„æ˜¾å¼æ„å›¾ï¼Œæ‰€ä»¥ä¸ä½¿ç”¨é»˜è®¤åˆå§‹æ•°ç»„ï¼Œåœ¨é¦–æ¬¡æ·»åŠ æ•°æ®æ—¶åªä¼šåˆ›å»ºé•¿åº¦ä¸º `1 ï¼ˆsize + 1ï¼‰`çš„æ•°ç»„ï¼ˆå¯ä»¥ç»“åˆåæ–‡æºç ç†è§£ä¸‹ï¼‰ã€‚

*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 7ï¼š** åœ¨å¸¦é›†åˆçš„æ„é€ æ–¹æ³•ä¸­ï¼Œä¸ºä»€ä¹ˆä¼šå­˜åœ¨é›†åˆè½¬åŒ–åçš„æ•°ç»„ç±»å‹ä¸æ˜¯ Object\[\].class çš„æƒ…å†µï¼Ÿ

    // å¸¦åˆå§‹å®¹é‡çš„æ„é€ æ–¹æ³•
    public ArrayList(int initialCapacity) {
        if (initialCapacity > 0) {
            // åˆ›å»º initialCapacity é•¿åº¦çš„æ•°ç»„
            this.elementData = new Object[initialCapacity];
        } else if (initialCapacity == 0) {
            // æŒ‡å‘ç¬¬ 1 ä¸ªå…¨å±€ç©ºæ•°ç»„
            this.elementData = EMPTY_ELEMENTDATA;
        } else {
            // ä¸åˆæ³•çš„åˆå§‹å®¹é‡
            throw new IllegalArgumentException("Illegal Capacity: "+initialCapacity);
        }
    }
    
    // æ— å‚æ„é€ æ–¹æ³•
    public ArrayList() {
        // æŒ‡å‘ç¬¬ 1 ä¸ªå…¨å±€ç©ºæ•°ç»„
        this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
    }
    
    // å¸¦é›†åˆçš„æ„é€ æ–¹æ³•
    public ArrayList(Collection<? extends E> c) {
        // å°†é›†åˆè½¬ä¸ºæ•°ç»„
        elementData = c.toArray();
        if ((size = elementData.length) != 0) {
            // ç–‘é—® 7ï¼šè¿™ä¸€ä¸ªæ¡ä»¶è¯­å¥å¥½å¥‡æ€ªï¼ŒtoArray() çš„è¿”å›å€¼ç±»å‹å°±æ˜¯ Object[] å•Šï¼Ÿ
            if (elementData.getClass() != Object[].class)
                elementData = Arrays.copyOf(elementData, size, Object[].class);
        } else {
            this.elementData = EMPTY_ELEMENTDATA;
        }
    }
    
    public Object[] toArray() {
        return Arrays.copyOf(elementData, size);
    }
    

### 2.3 ArrayList çš„æ·»åŠ ä¸æ‰©å®¹æ–¹æ³•

ArrayList å¯ä»¥åœ¨æ•°ç»„æœ«å°¾æˆ–æ•°ç»„ä¸­é—´æ·»åŠ å…ƒç´ ï¼š

*   å¦‚æœæ˜¯åœ¨æ•°ç»„æœ«å°¾æ·»åŠ ï¼Œå‡æ‘Šæ—¶é—´åªéœ€è¦ O(1) æ—¶é—´å¤æ‚åº¦ï¼›
*   å¦‚æœåœ¨æ•°ç»„ä¸­é—´æ·»åŠ ï¼Œç”±äºéœ€è¦æ¬è¿æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ O(n) æ—¶é—´å¤æ‚åº¦ã€‚

æ·»åŠ å‰ä¼šå…ˆæ£€æŸ¥æ•°æ®å®¹é‡ï¼Œä¸è¶³ä¼šå…ˆæ‰©å®¹ï¼š

*   åœ¨ä½¿ç”¨æ— å‚æ„é€ å™¨åˆå§‹åŒ–æ—¶ï¼Œé¦–æ¬¡æ·»åŠ å…ƒç´ æ—¶ä¼šç›´æ¥æ‰©å®¹åˆ° 10 çš„å®¹é‡ï¼›
*   åœ¨å…¶ä»–æƒ…å†µï¼Œä¼šç›´æ¥æ‰©å®¹åˆ°æ—§å®¹é‡çš„ 1.5 å€ï¼Œè€Œä¸æ˜¯æ‰©å®¹åˆ°æœ€å°å®¹é‡è¦æ±‚ã€‚

**ä¸ç®¡æ˜¯æ‰©å®¹åˆ° 10 è¿˜æ˜¯æ‰©å®¹åˆ° 1.5 å€ï¼Œéƒ½æ˜¯ä¸ºäº†é˜²æ­¢é¢‘ç¹æ‰©å®¹ï¼Œé¿å…æ¯æ¬¡ add æ·»åŠ æ•°æ®éƒ½è¦æ‰©å®¹ä¸€æ¬¡ã€‚**

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å›åˆ°ä¸€äº›å°æœ‹å‹çš„ç–‘é—®ï¼š

*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 4ï¼šä¸ºä»€ä¹ˆ ArrayList çš„æœ€å¤§å®¹é‡æ˜¯ `Integer.MAX_VALUE`ï¼Œ`Long.MAX_VALUE` ä¸è¡Œå—ï¼Ÿ**

æœ¬è´¨ä¸Šçœ‹ï¼Œåº”è¯¥è¯´æ˜¯æ•°ç»„é•¿åº¦çš„é™åˆ¶ï¼Œè€Œä¸æ˜¯ ArrayList é•¿åº¦çš„é™åˆ¶ã€‚åœ¨ [ã€Šå¯¹è±¡çš„å†…å­˜åˆ†ä¸ºå“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿã€‹](https://mp.weixin.qq.com/s/zuB_lD33TfMUpXIzXCKvaw) è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬è®¨è®ºè¿‡å¯¹è±¡çš„å†…å­˜å¸ƒå±€ã€‚æ•°ç»„å¯¹è±¡çš„é•¿åº¦æ˜¯è®°å½•åœ¨å¯¹è±¡å¤´ä¸­çš„ â€œæ•°ç»„é•¿åº¦â€ å­—æ®µä¸­ï¼Œè¿™ä¸ªå­—æ®µæ˜¯ 4 å­—èŠ‚ï¼Œæ­£å¥½å°±æ˜¯ Integer ä¹Ÿæ˜¯ 4 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥é™åˆ¶ä¸º `Integer.MAX_VALUE`ï¼Œè€Œä¸èƒ½ä½¿ç”¨ `Long.MAX_VALUE`ã€‚

ä¸å¯¹å•Šï¼ŒJava Integer æ˜¯æœ‰ç¬¦å·æ•´æ•°ï¼Œæ‰€ä»¥ `Integer.MAX_VALUE` åªæœ‰ 31 ä½æœ‰æ•ˆä½ï¼Œè¿˜å°‘äº† 1 ä½å‘¢ã€‚æ²¡é”™ï¼Œæ˜¯å°‘äº†ä¸€ä½ã€‚å¦‚æœè¦æ¦¨å¹²è¿™ 1 ä½å®¹é‡ï¼Œå½“ç„¶å¯ä»¥ç”¨ long ç±»å‹å¹¶ä¸”é™åˆ¶åˆ° 32 ä½èƒ½å¤Ÿè¡¨ç¤ºçš„æœ€å¤§æ­£æ•´æ•°ä¸Šï¼Œå¹¶ä¸”åœ¨æºç ä¸­åˆ°å¤„åŠ ä¸Šæ•°ç»„è¶Šç•Œåˆ¤æ–­ï¼Œæƒ³æƒ³å°±ä¸ç¨³å®šçš„ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œé™åˆ¶æ•°ç»„é•¿åº¦ä¸º int ç±»å‹ä¸”æœ€å¤§é•¿åº¦ä¸º `Integer.MAX_VALUE`ï¼Œå¦‚æœæœ‰è¶…è¿‡ `Integer.MAX_VALUE` å­˜å‚¨å®¹é‡çš„éœ€æ±‚ï¼Œé‚£å°±åˆ›å»ºä¸¤ä¸ªæ•°ç»„å‘€ï¼šï¼‰ä½ è§‰å¾—å“ªç§æ›´å¥½ã€‚

`Java å¯¹è±¡å†…å­˜å¸ƒå±€`

![](https://files.mdnice.com/user/3257/dcd46f0a-eec5-4a3f-b8c7-daf9b4886dbc.png)

*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 5ï¼šä¸ºä»€ä¹ˆ ArrayList çš„æœ€å¤§å®¹é‡æ˜¯ `MAX_VALUE - 8`ï¼Œä¸€å®šä¼šå‡ `8` å—ï¼Ÿ**

ä¾ç„¶ä¸å¯¹è±¡çš„å†…å­˜å¸ƒå±€æœ‰å…³ã€‚åœ¨ Java è™šæ‹Ÿæœºåƒåœ¾å›æ”¶ç®—æ³•ä¸­ï¼Œéœ€è¦è®¡ç®—å¯¹è±¡çš„å†…å­˜å¤§å°ï¼Œè®¡ç®—ç»“æœæ˜¯å­˜å‚¨åœ¨ `jint` ç±»å‹å˜é‡ï¼ˆJava int ç±»å‹åœ¨ JNI ä¸­çš„æ˜ å°„ï¼‰ä¸­çš„ã€‚å¦‚æœæ•°ç»„çš„é•¿åº¦æ˜¯ `MAX_VALUE`ï¼Œé‚£ä¹ˆåŠ ä¸Šå¯¹è±¡å¤´ä¹‹åå°±æ•´å‹æº¢å‡ºäº†ï¼Œæ‰€ä»¥ ArrayList ä¼šé¢„å…ˆå‡æ‰å¯¹è±¡å¤´å¯èƒ½å ç”¨çš„ 8 ä¸ªå­—èŠ‚ã€‚å¯¹è±¡å¤´çš„å…·ä½“å¤§å°å–å†³äºè™šæ‹Ÿæœºå®ç°ï¼Œå‡ 8 æ˜¯ç›¸å¯¹ä¿å®ˆçš„ã€‚

å…¶å®ï¼ŒArrayList çš„æœ€å¤§å®¹é‡ä¹Ÿä¸ä¸€å®šä¼šå‡ 8ï¼Œå¦‚æœæœ€å°å®¹é‡è¦æ±‚æ˜¯è¶…è¿‡ `MAX_ARRAY_SIZE` çš„ï¼Œé‚£ä¹ˆè¿˜æ˜¯ä¼šæ‰©å®¹åˆ° `MAX_VALUE` ã€‚è¿™æœ‰ç‚¹æ‘†çƒ‚çš„æ„æ€ï¼Œä¼šä¸ä¼šæº¢å‡ºè¿è¡Œæ—¶å†è¯´ã€‚

`æ•°ç»„é•¿åº¦æº¢å‡º`

    OutOfMemoryError: Requested array size exceeds VM limit
    

*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 8ï¼šä¸åº”è¯¥æ˜¯ elementData.length - minCapacity > 0 å—ï¼Ÿ** è¿™æ˜¯è€ƒè™‘åˆ°æ•´å‹æº¢å‡ºçš„æƒ…å†µï¼ŒminCapacity æº¢å‡ºå°±å˜æˆè´Ÿæ•°äº†ã€‚

    // åœ¨æ•°ç»„æœ«å°¾æ·»åŠ å…ƒç´ 
    public boolean add(E e) {
        // å…ˆç¡®ä¿åº•å±‚æ•°ç»„å®¹é‡è¶³å¤Ÿå®¹çº³ size + 1ï¼Œä¸è¶³ä¼šæ‰©å®¹
        ensureCapacityInternal(size + 1);  // Increments modCount!!
        // åœ¨ size + 1 çš„ä½ç½®èµ‹å€¼
        elementData[size++] = e;
        return true;
    }
    
    // åœ¨æ•°ç»„ä¸­é—´æ’å…¥å…ƒç´ 
    public void add(int index, E element) {
        // èŒƒå›´æ£€æŸ¥
        rangeCheckForAdd(index);
        // å…ˆç¡®ä¿å®¹é‡è¶³å¤Ÿå®¹çº³ size + 1ï¼Œä¸è¶³ä¼šæ‰©å®¹
        ensureCapacityInternal(size + 1);  // Increments modCount!!
        // å…ˆæ¬è¿æ•°æ®è…¾å‡ºç©ºä½
        System.arraycopy(elementData, index, elementData, index + 1, size - index);
        // åœ¨ index çš„ä½ç½®èµ‹å€¼
        elementData[index] = element;
        // é•¿åº¦åŠ ä¸€
        size++;
    }
    
    // åœ¨æ•°ç»„æœ«å°¾æ·»åŠ é›†åˆ
    public boolean addAll(Collection<? extends E> c) {
        // é›†åˆè½¬æ•°ç»„
        Object[] a = c.toArray();
        // å…ˆç¡®ä¿åº•å±‚æ•°ç»„å®¹é‡è¶³å¤Ÿå®¹çº³ size + numNewï¼Œä¸è¶³ä¼šæ‰©å®¹
        int numNew = a.length;
        ensureCapacityInternal(size + numNew);  // Increments modCount
        // æ¬è¿åŸæ•°æ®
        System.arraycopy(a, 0, elementData, size, numNew);
        // é•¿åº¦åŠ  numNew
        size += numNew;
        return numNew != 0;
    }
    
    // åœ¨æ•°ç»„ä¸­é—´æ’å…¥é›†åˆ
    public boolean addAll(int index, Collection<? extends E> c) {
        // ç•¥ï¼ŒåŸç†ç±»ä¼¼
    }
    
    // å°è¯•æ‰©å®¹
    // ï¼ˆæç¤ºï¼šæºç è°ƒç”¨äº† calculateCapacity() å‡½æ•°ï¼Œè¿™é‡Œåšå†…è”ç®€åŒ–ï¼‰
    private void ensureCapacityInternal(int minCapacity) {
        // ä½¿ç”¨æ— å‚æ„é€ å™¨åˆå§‹åŒ–æ—¶ï¼ŒæŒ‡å®šæ‰©å®¹ä¸º 10 
        if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
            minCapacity =  Math.max(DEFAULT_CAPACITY, minCapacity);
        }
        ensureExplicitCapacity(minCapacity);
    }
    
    private void ensureExplicitCapacity(int minCapacity) {
        modCount++;
        // ç–‘é—® 8ï¼šä¸åº”è¯¥æ˜¯ elementData.length - minCapacity > 0 å—ï¼Ÿ
        // å¦‚æœåº•å±‚æ•°ç»„é•¿åº¦ä¸å¤Ÿ minCapacity æœ€å°å®¹é‡è¦æ±‚ï¼Œåˆ™éœ€è¦æ‰©å®¹
        if (minCapacity - elementData.length > 0)
            grow(minCapacity);
    }
    
    private void grow(int minCapacity) {
        // æ—§å®¹é‡
        int oldCapacity = elementData.length;
        // æ–°å®¹é‡ = æ—§å®¹é‡ * 1.5 å€ï¼ˆæœ‰å¯èƒ½æ•´å‹æº¢å‡ºï¼‰
        int newCapacity = oldCapacity + (oldCapacity >> 1);
        // å¦‚æœæ–°å®¹é‡å°äºæœ€å°å®¹é‡è¦æ±‚ï¼Œåˆ™ä½¿ç”¨æœ€å°å®¹é‡ï¼ˆaddAll å¤§é›†åˆçš„æƒ…å†µï¼‰
        if (newCapacity - minCapacity < 0) {
            newCapacity = minCapacity;
        }
        // ï¼ˆæç¤ºï¼šä¸Šä¸€ä¸ª if çš„ newCapacity æœ‰å¯èƒ½æ˜¯æº¢å‡ºçš„ï¼‰
        // å¦‚æœæ–°å®¹é‡è¶…å‡ºæœ€å¤§æ•°ç»„é•¿åº¦é™åˆ¶ï¼Œè¯´æ˜æ— æ³•æ‰©å®¹ 1.5 å€ï¼Œå›å½’åˆ° minCapacity ä¸Š
        // ï¼ˆæç¤ºï¼šæºç è°ƒç”¨äº† hugeCapacity() å‡½æ•°ï¼Œè¿™é‡Œåšå†…è”ç®€åŒ–ï¼‰
        if (newCapacity - MAX_ARRAY_SIZE > 0) {
            // æœ€å°å®¹é‡è¦æ±‚å‘ç”Ÿæ•´å‹æº¢å‡ºï¼Œæ— æ³•æ»¡è¶³è¦æ±‚ï¼Œåªèƒ½ç›´æ¥æŠ›å‡º OOM
            if (minCapacity < 0) throw new OutOfMemoryError();
            // å¦‚æœæœ€å°å®¹é‡è¦æ±‚è¶…å‡ºæœ€å¤§æ•°ç»„é•¿åº¦é™åˆ¶ï¼Œåˆ™æ‰©å®¹åˆ° MAX_VALUEï¼ˆè¯´æ˜ä¸ä¸€å®šä¼šå‡ 8ï¼‰
            // å¦åˆ™ï¼Œæ‰©å®¹åˆ°æœ€å¤§æ•°ç»„é•¿åº¦é™åˆ¶ï¼ˆMAX_VALUE - 8ï¼‰
            newCapacity = (minCapacity > MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE;
        }
        // æ‰©å®¹åˆ° newCapacity é•¿åº¦
        elementData = Arrays.copyOf(elementData, newCapacity);
    }
    
    private static int hugeCapacity(int minCapacity) {
        // å·²ç»å†…è”ç®€åŒ–åˆ° grow æ–¹æ³•ä¸­
    }
    

é™¤äº†æ‰©å®¹ä¹‹å¤–ï¼ŒArrayList è¿˜æ”¯æŒç¼©å®¹ï¼Œå°†åº•å±‚æ•°ç»„çš„å®¹é‡ç¼©å°åˆ°å®é™…å…ƒç´ çš„æ•°é‡ï¼š

    // ç¼©å®¹
    public void trimToSize() {
        modCount++;
        if (size < elementData.length) {
            elementData = (size == 0) ? EMPTY_ELEMENTDATA : Arrays.copyOf(elementData, size);
        }
    }
    

å¦å¤–ï¼Œå› ä¸ºæ‰©å®¹æ¶‰åŠåˆ°æ•°æ®æ¬è¿æ“ä½œï¼Œæ‰€ä»¥å¦‚æœèƒ½äº‹å…ˆçŸ¥é“æ•°æ®çš„å®¹é‡ï¼Œæœ€å¥½åœ¨åˆ›å»º ArrayList æ—¶å°±æ˜¾å¼æŒ‡å®šæ•°æ®é‡å¤§å°ã€‚

### 2.4 ArrayList çš„è¿­ä»£å™¨

Java çš„ foreach æ˜¯è¯­æ³•ç³–ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯é‡‡ç”¨ iterator çš„æ–¹å¼ã€‚ArrayList æä¾›äº† 2 ä¸ªè¿­ä»£å™¨ï¼š

*   **iterator():Iterator()ï¼š** å•å‘è¿­ä»£å™¨
*   **ListIterator listIterator()ï¼š** åŒå‘è¿­ä»£å™¨

åœ¨è¿­ä»£å™¨éå†æ•°ç»„çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½å‡ºç°å¤šä¸ªçº¿ç¨‹å¹¶å‘ä¿®æ”¹æ•°ç»„çš„æƒ…å†µï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´ç”šè‡³æ•°ç»„è¶Šç•Œï¼Œæ‰€ä»¥ Java å¾ˆå¤šå®¹å™¨ç±»çš„è¿­ä»£å™¨ä¸­éƒ½æœ‰ fail-fast æœºåˆ¶ã€‚

å¦‚æœåœ¨è¿­ä»£çš„è¿‡ç¨‹ä¸­å‘ç° expectedModCount å˜åŒ–ï¼Œè¯´æ˜æ•°æ®è¢«ä¿®æ”¹ï¼Œæ­¤æ—¶å°±ä¼šæå‰æŠ›å‡º `ConcurrentModificationException` å¼‚å¸¸ï¼ˆå½“ç„¶ä¹Ÿä¸ä¸€å®šæ˜¯è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼‰ã€‚

    private class Itr implements Iterator<E> {
        int cursor;       // index of next element to return
        int lastRet = -1; // index of last element returned; -1 if no such
        // åˆ›å»ºè¿­ä»£å™¨æ˜¯ä¼šè®°å½•å¤–éƒ¨ç±»çš„ modCount
        int expectedModCount = modCount;
        ...
    
        Itr() {}
    
        public boolean hasNext() {
            return cursor != size;
        }
    
        @SuppressWarnings("unchecked")
        public E next() {
            // æ£€æŸ¥
            checkForComodification();
            ...
        }
    
        public void remove() {
            ...
            // æ›´æ–°
            expectedModCount = modCount;
        }
    }
    

*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 1ï¼šä¸ºä»€ä¹ˆ elementData å­—æ®µä¸å£°æ˜ `private` å…³é”®å­—ï¼Ÿ**

åœ¨æ³¨é‡Šä¸­çš„è§£é‡Šæ˜¯ï¼šâ€œnon-private to simplify nested class accessâ€ã€‚ä½†æˆ‘ä»¬çŸ¥é“åœ¨ Java ä¸­ï¼Œå†…éƒ¨ç±»æ˜¯å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„ private å˜é‡çš„ï¼Œæ‰€ä»¥è¿™å°±è¯´ä¸é€šçš„ã€‚æˆ‘çš„ç†è§£æ˜¯ï¼šå› ä¸ºå†…éƒ¨ç±»åœ¨ç¼–è¯‘åä¼šç”Ÿæˆç‹¬ç«‹çš„ Class æ–‡ä»¶ï¼Œå¦‚æœå¤–éƒ¨ç±»çš„ elementData å­—æ®µæ˜¯ private ç±»å‹ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±éœ€è¦åœ¨ ArrayList ä¸­æ’å…¥ getter / setterï¼Œå¹¶é€šè¿‡æ–¹æ³•è°ƒç”¨ï¼Œè€Œ non-private å­—æ®µå°±å¯ä»¥ç›´æ¥è®¿é—®å­—æ®µã€‚

### 2.5 ArrayList çš„åºåˆ—åŒ–è¿‡ç¨‹

*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 2ï¼šä¸ºä»€ä¹ˆ elementData å­—æ®µå£°æ˜ `transient` å…³é”®å­—ï¼Ÿ**

ArrayList é‡å†™äº† JDK åºåˆ—åŒ–çš„é€»è¾‘ï¼ŒåªæŠŠ elementData æ•°ç»„ä¸­æœ‰æ•ˆå…ƒç´ çš„éƒ¨åˆ†åºåˆ—åŒ–ï¼Œè€Œä¸ä¼šåºåˆ—åŒ–æ•´ä¸ªæ•°ç»„ã€‚

    // åºåˆ—åŒ–å’Œååºåˆ—åŒ–åªè€ƒè™‘æœ‰æ•ˆå…ƒç´ 
    private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException{
        // Write out element count, and any hidden stuff
        int expectedModCount = modCount;
        s.defaultWriteObject();
    
        // å†™å…¥æ•°ç»„é•¿åº¦
        s.writeInt(size);
    
        // å†™å…¥æœ‰æ•ˆå…ƒç´ 
        for (int i=0; i<size; i++) {
            s.writeObject(elementData[i]);
        }
    
        if (modCount != expectedModCount) {
            throw new ConcurrentModificationException();
        }
    }
    

### 2.6 ArrayList çš„ clone() è¿‡ç¨‹

ArrayList ä¸­çš„ elementData æ•°ç»„æ˜¯å¼•ç”¨ç±»å‹ï¼Œå› æ­¤åœ¨ clone() ä¸­éœ€è¦å®ç°æ·±æ‹·è´ï¼Œå¦åˆ™åŸå¯¹è±¡ä¸å…‹éš†å¯¹è±¡ä¼šç›¸äº’å½±å“ï¼š

    public Object clone() {
        try {
            ArrayList<?> v = (ArrayList<?>) super.clone();
            // æ‹·è´æ•°ç»„å¯¹è±¡
            v.elementData = Arrays.copyOf(elementData, size);
            // ä¿®æ”¹è®¡æ•°å½’é›¶
            v.modCount = 0;
            return v;
        } catch (CloneNotSupportedException e) {
            // this shouldn't happen, since we are Cloneable
            throw new InternalError(e);
        }
    }
    

### 2.7 ä¸ºä»€ä¹ˆé˜¿é‡Œå·´å·´è¦æ±‚è°¨æ…ä½¿ç”¨ subList APIï¼Ÿ

åœ¨ ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸­ï¼Œæœ‰å…³äº `ArrayList#subList` API çš„è§„å®šã€‚ä¸ºä»€ä¹ˆé˜¿é‡Œå·´å·´è¦åšè¿™æ ·çš„é™åˆ¶å‘¢ï¼Ÿ

*   ã€å¼ºåˆ¶ã€‘ArrayList çš„ subList ç»“æœä¸å¯å¼ºè½¬æˆ ArrayListï¼Œå¦åˆ™ä¼šæŠ›å‡º ClassCastException å¼‚å¸¸ï¼›
*   ã€å¼ºåˆ¶ã€‘åœ¨ subList åœºæ™¯ä¸­ï¼Œé«˜åº¦æ³¨æ„å¯¹åŸé›†åˆå…ƒç´ çš„å¢åŠ æˆ–åˆ é™¤ï¼Œå‡ä¼šå¯¼è‡´å­åˆ—è¡¨çš„éå†ã€å¢åŠ ã€åˆ é™¤äº§ç”Ÿ ConcurrentModificationException å¼‚å¸¸ã€‚

è¿™æ˜¯å› ä¸º subList API åªæ˜¯æä¾›é€šè¿‡èµ·å§‹ç´¢å¼• fromIndex å’Œç»ˆæ­¢ç´¢å¼• toIndex åŒ…è£…äº†ä¸€ä¸ªåŸ ArrayList çš„ **â€œè§†å›¾çª—å£â€** ï¼Œå¹¶ä¸æ˜¯çœŸçš„æˆªå–å¹¶åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ ArrayListï¼Œæ‰€ä»¥å¼ºåˆ¶ç±»å‹è½¬æ¢å°±ä¼šæŠ›å‡º ClassCastException å¼‚å¸¸ã€‚

æ­¤æ—¶ï¼Œåœ¨ ArrayList æˆ– SubList ä¸Šåšä¿®æ”¹ï¼Œè¦æ³¨æ„ç›¸äº’ä¹‹é—´çš„å½±å“ï¼š

*   åœ¨ ArrayList æˆ– SubList ä¸Šä¿®æ”¹å…ƒç´ ï¼Œéƒ½ä¼šåŒæ­¥æ›´æ–°åˆ°å¯¹æ–¹ï¼ˆå› ä¸ºåº•å±‚éƒ½æ˜¯ ArrayList æœ¬èº«ï¼‰ï¼›
*   åœ¨ SubList ä¸Šå¢åŠ æˆ–åˆ é™¤å…ƒç´ ï¼Œä¼šå½±å“åˆ° ArrayListï¼›
*   åœ¨ ArrayList ä¸Šå¢åŠ æˆ–åˆ é™¤å…ƒç´ ï¼Œä¼šå¯¼è‡´ SubList æŠ›å‡º ConcurrentModificationException å¼‚å¸¸ã€‚

`ArrayList.java`

    public List<E> subList(int fromIndex, int toIndex) {
        subListRangeCheck(fromIndex, toIndex, size);
        return new SubList(this, 0, fromIndex, toIndex);
    }
    
    private class SubList extends AbstractList<E> implements RandomAccess {
        // åŸ ArrayList
        private final AbstractList<E> parent;
        private final int parentOffset;
        private final int offset;
        int size;
    
        SubList(AbstractList<E> parent, int offset, int fromIndex, int toIndex) {
            this.parent = parent;
            this.parentOffset = fromIndex;
            this.offset = offset + fromIndex;
            this.size = toIndex - fromIndex;
            // modCount è®°å½•
            this.modCount = ArrayList.this.modCount;
        }
    
        public E set(int index, E e) {
            rangeCheck(index);
            // åœ¨ ArrayList ä¸Šå¢åŠ æˆ–åˆ é™¤å…ƒç´ ï¼Œä¼šå¯¼è‡´ SubList æŠ›å‡º ConcurrentModificationException å¼‚å¸¸
            checkForComodification();
            // åœ¨ SubList ä¸Šå¢åŠ æˆ–åˆ é™¤å…ƒç´ ï¼Œä¼šå½±å“åˆ° ArrayListï¼›
            E oldValue = ArrayList.this.elementData(offset + index);
            ArrayList.this.elementData[offset + index] = e;
            return oldValue;
        }
    }
    

### 2.8 ArrayList å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ï¼Ÿ

æœ‰ 4 ç§æ–¹å¼ï¼š

*   **æ–¹æ³• 1 - ä½¿ç”¨ Vector å®¹å™¨ï¼š** Vector æ˜¯çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬çš„æ•°ç»„å®¹å™¨ï¼Œå®ƒä¼šåœ¨æ‰€æœ‰æ–¹æ³•ä¸Šå¢åŠ  synchronized å…³é”®å­—ï¼›
*   **æ–¹æ³• 2 - ä½¿ç”¨ Collections.synchronizedList åŒ…è£…ç±»ï¼š** åŸç†ä¹Ÿæ˜¯åœ¨æ‰€æœ‰æ–¹æ³•ä¸Šå¢åŠ  synchronized å…³é”®å­—ï¼›
*   **æ–¹æ³• 3 - ä½¿ç”¨ CopyOnWriteArrayList å®¹å™¨ï¼š** åŸºäºåŠ é”çš„ â€œè¯»å†™åˆ†ç¦»â€ å’Œ â€œå†™æ—¶å¤åˆ¶â€ å®ç°çš„åŠ¨æ€æ•°ç»„ï¼Œé€‚åˆäºè¯»å¤šå†™å°‘ï¼Œæ•°æ®é‡ä¸å¤§çš„åœºæ™¯ã€‚
*   **æ–¹æ³• 4 - ä½¿ç”¨ ArrayBlockingQueue å®¹å™¨ï¼š** åŸºäºåŠ é”çš„é˜»å¡é˜Ÿåˆ—ï¼Œé€‚åˆäºå¸¦é˜»å¡æ“ä½œçš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ã€‚

> **æç¤ºï¼š** å…³äº CopyOnWriteArrayList çš„æ›´å¤šå†…å®¹ï¼Œå»çœ‹çœ‹ä¸“æ æ–‡ç«  [ã€ŠCopyOnWriteArrayList æ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿã€‹](https://juejin.cn/post/7162035643785150472)

* * *

3\. Arrays#ArrayListï¼šä¸–ç•Œä¸Šçš„å¦ä¸€ä¸ªæˆ‘
-----------------------------

äº‹å®ä¸Šï¼Œåœ¨ Java ç¯å¢ƒä¸­æœ‰ä¸¤ä¸ª ArrayListï¼Œè¿™æˆ–è®¸æ˜¯ä¸€ä¸ªéšè—çš„å½©è›‹ï¼ˆå‘ï¼‰ï¼š

*   **ArrayListï¼š** ä¸€èˆ¬è®¤ä¸ºçš„ ArrayListï¼Œæ˜¯ä¸€ä¸ªé¡¶çº§ç±»ï¼›
*   **Arrays#ArrayListï¼š** Arrays çš„é™æ€å†…éƒ¨ç±»ï¼Œå’Œä¸Šé¢è¿™ä¸ª ArrayList æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚

å…¶å®ï¼ŒArrays#ArrayList çš„å®šä½å°±æ˜¯åœ¨æ•°ç»„å’Œå’Œ List ç›´æ¥åˆ‡æ¢è€Œå·²ã€‚Arrays æä¾›äº†æ•°ç»„è½¬ List çš„ APIï¼Œè€Œ Arrays#ArrayList ä¹Ÿæä¾›äº† List è½¬æ•°ç»„çš„ APIï¼ˆè¿™äº› API ç¬¬ä¸€ä¸ª ArrayList ä¸­ä¹Ÿéƒ½æœ‰â€¦ï¼‰

å›è¿‡å¤´çœ‹å‰©ä¸‹çš„ 2 ä¸ªé—®é¢˜ï¼š

*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 3ï¼šä¸ºä»€ä¹ˆ elementData å­—æ®µä¸å£°æ˜ä¸ºæ³›å‹ç±»å‹ `E`ï¼Ÿ**

æ³›å‹æ“¦é™¤åç­‰äº Object\[\] elementDataï¼Œæ²¡æœ‰åŒºåˆ«ã€‚

*   **ğŸ™‹ğŸ»â€â™€ï¸ç–‘é—® 7ï¼šåœ¨å¸¦é›†åˆçš„æ„é€ æ–¹æ³•ä¸­ï¼Œä¸ºä»€ä¹ˆä¼šå­˜åœ¨é›†åˆè½¬åŒ–åçš„æ•°ç»„ç±»å‹ä¸æ˜¯ Object\[\].class çš„æƒ…å†µï¼Ÿ**

è¿™æ˜¯å› ä¸ºæœ‰äº› List é›†åˆçš„åº•å±‚æ•°ç»„ä¸æ˜¯ Object\[\] ç±»å‹ï¼Œæœ‰å¯èƒ½æ˜¯ String\[\] ç±»å‹ã€‚è€Œåœ¨ ArrayList#toArray() æ–¹æ³•ä¸­ï¼Œè¿”å›å€¼çš„ç±»å‹æ˜¯ Object\[\] ç±»å‹ï¼Œæœ‰ç±»å‹é”™è¯¯é£é™©ã€‚

ä¾‹å¦‚ï¼šåœ¨è¿™æ®µä»£ç ä¸­ï¼ŒArrayList æ¥æ”¶ä¸€ä¸ªç”± String æ•°ç»„è½¬åŒ–çš„ Listï¼Œæœ€ååœ¨ ArrayList#toArray() è¿”å›çš„ Object æ•°ç»„ä¸­æ·»åŠ ä¸€ä¸ª Object å¯¹è±¡ï¼Œå°±å‡ºç°å¼‚å¸¸äº†ï¼š

`ç¤ºä¾‹ä»£ç `

    // å‡è®¾æ²¡æœ‰ç‰¹æ®Šå¤„ç†
    List<String> list = new ArrayList<>(Arrays.asList("list"));
    // class java.util.ArrayList
    System.out.println(list.getClass());
    
    Object[] listArray = list.toArray();
    // å¦‚æœè¿‡æ²¡æœ‰ç‰¹æ®Šå¤„ç†ï¼Œå®é™…ç±»å‹æ˜¯ [Ljava.lang
    System.out.println(listArray.getClass());
    // å¦‚æœè¿‡æ²¡æœ‰ç‰¹æ®Šå¤„ç†ï¼Œå°†æŠ›å‡º ArrayStoreException å¼‚å¸¸
    listArray[0] = new Object();
    

æºç æ‘˜è¦ï¼š

`Arrays.java`

    public static <T> List<T> asList(T... a) {
        return new ArrayList<>(a);
    }
    
    private static class ArrayList<E> extends AbstractList<E> implements RandomAccess, java.io.Serializable {
        // æ³›å‹æ“¦é™¤åï¼šObject[] a;
        private final E[] a;
    
        // æ³›å‹æ“¦é™¤åï¼šObject[] array;
        // Java æ•°ç»„æ˜¯åå˜çš„ï¼Œèƒ½å¤Ÿæ¥æ”¶ String[] ç±»å‹çš„æ•°ç»„
        ArrayList(E[] array) {
            // èµ‹å€¼
            a = Objects.requireNonNull(array);
        }
    
        // å®é™…è¿”å›çš„æ•°ç»„å¯èƒ½æ˜¯ Object[] ç±»å‹ï¼Œä¹Ÿå¯èƒ½æ˜¯ String[] ç±»å‹
        @Override
        public Object[] toArray() {
            return a.clone();
        }
    }
    

`ArrayList.java`

    public class ArrayList<E> extends AbstractList<E> implements List<E>, RandomAccess, Cloneable, java.io.Serializable
        transient Object[] elementData;
    
        // å¸¦é›†åˆçš„æ„é€ æ–¹æ³•
        public ArrayList(Collection<? extends E> c) {
            // å°†é›†åˆè½¬ä¸ºæ•°ç»„
            elementData = c.toArray();
            if ((size = elementData.length) != 0) {
                // ç–‘é—® 7ï¼šè¿™ä¸€ä¸ªæ¡ä»¶è¯­å¥å¥½å¥‡æ€ªï¼ŒtoArray() çš„è¿”å›å€¼ç±»å‹å°±æ˜¯ Object[] å•Šï¼Ÿ
                if (elementData.getClass() != Object[].class)
                    elementData = Arrays.copyOf(elementData, size, Object[].class);
            } else {
                this.elementData = EMPTY_ELEMENTDATA;
            }
        }
    
        public Object[] toArray() {
            return Arrays.copyOf(elementData, size);
        }
    }
    

* * *

4\. ArrayList è¿™ä¹ˆå¥½ç”¨ï¼Œå¯ä»¥å®Œå…¨æ›¿ä»£æ•°ç»„å—ï¼Ÿ
-----------------------------

å¤§å¤šæ•°åœºæ™¯å¯ä»¥ï¼Œä½†ä¸èƒ½å®Œå…¨æ›¿ä»£ã€‚

ArrayList æ˜¯åŸºäº Object æ•°ç»„å°è£…çš„åŠ¨æ€æ•°ç»„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒåº•å±‚æ•°ç»„çš„æ•°æ®æ¬è¿å’Œæ‰©å®¹ç­‰é€»è¾‘ï¼Œå› æ­¤åœ¨å¤§å¤šæ•°ä¸šåŠ¡å¼€å‘åœºæ™¯ä¸­ï¼Œé™¤éæ˜¯ä¸ºäº†æœ€æ±‚æè‡´çš„æ€§èƒ½ï¼Œå¦åˆ™ç›´æ¥ä½¿ç”¨ ArrayList ä»£æ›¿æ•°ç»„æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚

é‚£ä¹ˆï¼ŒArrayList æœ‰å“ªäº›åœ°æ–¹ä¸Šæ¯”æ•°ç»„å·®å‘¢ï¼Ÿ

*   ä¸¾ä¾‹ 1 - ArrayList ç­‰å®¹å™¨ç±»ä¸æ”¯æŒ int ç­‰åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥å¿…ç„¶å­˜åœ¨è£…ç®±æ‹†ç®±æ“ä½œï¼›
    
*   ä¸¾ä¾‹ 2 - ArrayList é»˜è®¤çš„æ‰©å®¹é€»è¾‘æ˜¯ä¼šæ‰©å¤§åˆ°åŸå®¹é‡çš„ 1.5 å€ï¼Œåœ¨å¤§æ•°æ®é‡çš„åœºæ™¯ä¸­ï¼Œè¿™æ ·çš„æ‰©å®¹é€»è¾‘æ˜¯å¦å¤šä½™ï¼Œéœ€è¦æ‰“ä¸Šé—®é¢˜ï¼›
    
*   ä¸¾ä¾‹ 3 - ArrayList çš„çµæ´»æ€§ä¸å¤Ÿã€‚ArrayList ä¸å…è®¸åº•å±‚æ•°æ®æœ‰ç©ºæ´ï¼Œæ‰€æœ‰çš„æœ‰æ•ˆæ•°æ®éƒ½ä¼š â€œå‹ç¼©â€ åˆ°åº•å±‚æ•°ç»„çš„é¦–éƒ¨ã€‚å› æ­¤ï¼Œå½“éœ€è¦åŸºäºæ•°ç»„äºŒæ¬¡å¼€å‘å®¹å™¨æ—¶ï¼ŒArrayList å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½é€‰æ‹©ã€‚
    
    *   ä¾‹å¦‚ï¼Œä½¿ç”¨ ArrayList å¼€å‘æ ˆçš„ç»“æ„æˆ–è®¸åˆé€‚ï¼Œå¯ä»¥åœ¨æ•°ç»„çš„å°¾éƒ¨æ“ä½œæ•°æ®ã€‚ä½†ä½¿ç”¨ ArrayList å¼€å‘é˜Ÿåˆ—å°±ä¸åˆé€‚ï¼Œå› ä¸ºåœ¨æ•°ç»„çš„é¦–éƒ¨å…¥é˜Ÿæˆ–å‡ºé˜Ÿéœ€è¦æ¬è¿æ•°æ®ï¼›
        
    *   è€Œæ•°ç»„æ²¡æœ‰è¿™äº›çº¦æŸï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°ç»„è®¾è®¡ä¸º â€œç¯å½¢æ•°ç»„â€ï¼Œå°±å¯ä»¥é¿å…å…¥é˜Ÿå’Œå‡ºé˜Ÿæ—¶æ¬è¿æ•°æ®ã€‚ä¾‹å¦‚ Java çš„ `ArrayBlockingQueue` å’Œ [ArrayDeque](https://juejin.cn/post/7162819765361672199) å°±æ˜¯åŸºäºæ•°ç»„çš„é˜Ÿåˆ—ã€‚
        

* * *

5\. æ€»ç»“
------

*   1ã€ArrayList æ˜¯åŸºäºæ•°ç»„å°è£…çš„åŠ¨æ€æ•°ç»„ï¼Œå°è£…äº†æ“ä½œæ•°ç»„æ—¶çš„æ¬è¿å’Œæ‰©å®¹ç­‰é€»è¾‘ï¼›
    
*   2ã€åœ¨æ„é€  ArrayList æ—¶ï¼Œé™¤äº†æŒ‡å®šå¤§äº 0 çš„åˆå§‹å®¹é‡å¤–ï¼ŒArrayList åœ¨æ„é€ æ—¶ä¸ä¼šåˆ›å»ºæ•°ç»„ï¼Œè€Œæ˜¯æŒ‡å‘å…¨å±€ç©ºæ•°ç»„ï¼Œè¿™æ˜¯æ‡’åˆå§‹åŒ–çš„ç­–ç•¥ï¼›
    
*   3ã€åœ¨æ·»åŠ æ•°æ®æ—¶ä¼šå…ˆæ£€æŸ¥æ•°æ®å®¹é‡ï¼Œä¸è¶³ä¼šå…ˆæ‰©å®¹ã€‚é¦–æ¬¡æ·»åŠ é»˜è®¤ä¼šæ‰©å®¹åˆ° 10 å®¹é‡ï¼Œåç»­ä¼šæ‰©å®¹åˆ°æ—§å®¹é‡çš„ 1.5 å€ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…åå¤æ‰©å®¹ï¼›
    
*   4ã€å› ä¸ºæ‰©å®¹æ¶‰åŠåˆ°æ•°æ®æ¬è¿æ“ä½œï¼Œæ‰€ä»¥å¦‚æœèƒ½äº‹å…ˆçŸ¥é“æ•°æ®çš„å®¹é‡ï¼Œæœ€å¥½åœ¨åˆ›å»º ArrayList æ—¶å°±æ˜¾å¼æŒ‡å®šæ•°æ®é‡å¤§å°ï¼›
    
*   5ã€ArrayList é‡å†™äº†åºåˆ—åŒ–è¿‡ç¨‹ï¼Œåªå¤„ç†æ•°ç»„ä¸­æœ‰æ•ˆçš„å…ƒç´ ï¼›
    
*   6ã€ArrayList çš„ subList API åªæ˜¯æä¾›è§†å›¾çª—å£ï¼Œå¹¶ä¸æ˜¯åˆ›å»ºæ–°åˆ—è¡¨ï¼›
    
*   7ã€ArrayList åœ¨å¤§å¤šæ•°åœºæ™¯ä¸­å¯ä»¥ä»£æ›¿æ•°ç»„ï¼Œä½†åœ¨é«˜æ€§èƒ½å’ŒäºŒæ¬¡å°è£…çš„åœºæ™¯ä¸­ï¼ŒArrayList æ— æ³•æ›¿ä»£æ•°ç»„ã€‚
    

åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬æ¥è®¨è®º ArrayList çš„å­ªç”Ÿå…„å¼Ÿ â€”â€” [LinkedList](https://juejin.cn/post/7162203434014212109)ã€‚è¯·å…³æ³¨ã€‚

* * *

**å‚è€ƒèµ„æ–™**

*   [ä¸ºä»€ä¹ˆé˜¿é‡Œå·´å·´è¦æ±‚è°¨æ…ä½¿ç”¨ ArrayList ä¸­çš„ subList æ–¹æ³•](https://juejin.cn/post/6844903874042527758) â€”â€” HollisChuang è‘—
*   [ArrayList æºç è§£æï¼Œè€å“¥ï¼Œæ¥ä¸€èµ·å¤ä¹ ä¸€å“ˆï¼Ÿ](https://mp.weixin.qq.com/s/3PNWmtS-bEZgZjd9wyMiDA) â€”â€” iisheng è‘—
*   [Arrays.asList(x).toArray().getClass() should be Object\[\].class](https://bugs.openjdk.org/browse/JDK-6260652) â€”â€” OpenJDK
*   [Why I can't create an array with large size?](https://stackoverflow.com/questions/31382531/why-i-cant-create-an-array-with-large-size) â€”â€” stack overflow

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7db0e43b744943f685ad1e3627f1ceb1~tplv-k3u1fbpfcp-watermark.image?)