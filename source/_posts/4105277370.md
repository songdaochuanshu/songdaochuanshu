---
layout: post
title: "æ·±å…¥æ¢ç©¶MinimalApiæ˜¯å¦‚ä½•åœ¨Swaggerä¸­å±•ç¤ºçš„"
date: "2022-06-06T04:32:45.832Z"
---
æ·±å…¥æ¢ç©¶MinimalApiæ˜¯å¦‚ä½•åœ¨Swaggerä¸­å±•ç¤ºçš„
=============================

### å‰è¨€

Â Â Â Â ä¹‹å‰çœ‹åˆ°æŠ€æœ¯ç¾¤é‡Œæœ‰åŒå­¦è®¨è®ºè¯´å¯¹äºMinimalApièƒ½æ¥å…¥åˆ°Swaggerä¸­æ„Ÿåˆ°å¾ˆç¥å¥‡,åŠ ä¸ŠSwaggerçš„æ•°æ®æœ¬èº«æ˜¯æ”¯æŒ`OpenApi2.0`å’Œ`OpenApi3.0`ä½¿å¾—`swagger.json`æˆä¸ºäº†è®¸å¤šæ¥å£æ–‡æ¡£ç®¡ç†å·¥å…·çš„æ ‡å‡†æ•°æ®æºã€‚ASP.NET Coreèƒ½å¤Ÿè½»æ¾å¿«é€Ÿçš„é›†æˆSwaggerå¾—ç›Šäºå¾®è½¯å¯¹OpenApiçš„å¤§åŠ›æ”¯æŒï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹å‡ ä¹æ˜¯æ·»åŠ é»˜è®¤é…ç½®ï¼Œå°±èƒ½å¾ˆå¥½çš„å·¥ä½œäº†ã€‚è¿™ä¸€åˆ‡éƒ½æ˜¯å¾—ç›ŠäºASP.NET Coreåº•å±‚æä¾›äº†å¯¹æ¥å£å…ƒæ•°æ®çš„æè¿°å’Œå¯¹ç»ˆç»“ç‚¹çš„ç›¸å…³æè¿°ã€‚æœ¬æ–‡æˆ‘ä»¬å°±é€šè¿‡MinimalApiæ¥äº†è§£ä¸€ä¸‹ASP.NET Coreä¸ºä½•èƒ½æ›´å¥½çš„é›†æˆSwaggerã€‚

### ä½¿ç”¨æ–¹å¼

è™½ç„¶æˆ‘ä»¬è®¨è®ºçš„æ˜¯MInimalApiä¸Swaggeræ•°æ®æºçš„å…³ç³»ï¼Œä½†æ˜¯ä¸ºäº†ä½¿å¾—çœ‹èµ·æ¥æ›´æ¸…æ™°ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸‹MinimalApiå¦‚ä½•é›†æˆåˆ°Swaggerï¼Œç›´æ¥ä¸Šä»£ç 

    var builder = WebApplication.CreateBuilder(args);
    
    //è¿™æ˜¯é‡ç‚¹ï¼Œæ˜¯ASP.NET Coreè‡ªèº«æä¾›çš„
    builder.Services.AddEndpointsApiExplorer();
    //æ·»åŠ swaggeré…ç½®
    builder.Services.AddSwaggerGen(c =>
    {
        c.SwaggerDoc("v1", new() 
        { 
    	Title = builder.Environment.ApplicationName,
    	Version = "v1"
        });
    });
    
    var app = builder.Build();
    
    if (app.Environment.IsDevelopment())
    {
        //swaggerç»ˆç»“ç‚¹
        app.UseSwagger();
        app.UseSwaggerUI(c => c.SwaggerEndpoint("/swagger/v1/swagger.json", 
                              $"{builder.Environment.ApplicationName} v1"));
    }
    
    app.MapGet("/swag", () => "Hello Swagger!");
    
    app.Run();
    

ä¸Šé¢æˆ‘ä»¬æåˆ°äº†`AddEndpointsApiExplorer`æ˜¯ASP.NET Coreè‡ªèº«æä¾›çš„ï¼Œä½†æ˜¯å¦‚æœä½¿å¾—MinimalApièƒ½åœ¨Swaggerä¸­å±•ç¤ºå°±å¿…é¡»è¦æ·»åŠ è¿™ä¸ªæœåŠ¡ã€‚æ‰€ä»¥Swaggerè¿˜æ˜¯é‚£ä¸ªSwaggerï¼Œå˜çš„æ˜¯ASP.NET Coreæœ¬èº«ï¼Œä½†æ˜¯å˜åŒ–æ˜¯å¦‚ä½•é€‚é…æ•°æ®æºçš„é—®é¢˜ï¼ŒSwaggerä¾¿æ˜¯å»ºç«‹åœ¨è¿™ä¸ªä¾¿åˆ©åŸºç¡€ä¸Šã€‚æ¥ä¸‹æ¥å’±ä»¬å°±é€šè¿‡æºç çœ‹ä¸€ä¸‹å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚

### æºç æ¢ç©¶

æƒ³äº†è§£å®ƒä»¬çš„å…³ç³»å°±ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªä¸»è§’ï¼Œä¸€ä¸ªæ˜¯swaggerçš„æ•°æ®æºæ¥è‡ªä½•å¤„ï¼Œå¦ä¸€ä¸ªæ˜¯ASP.NET Coreæ˜¯å¦‚ä½•æä¾›è¿™ä¸ªæ•°æ®æºçš„ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Swaggerçš„æ•°æ®æºæ¥è‡ªä½•å¤„ã€‚

#### swaggerçš„æ•°æ®æº

ç†Ÿæ‚‰`Swashbuckle.AspNetCore`çš„åº”è¯¥çŸ¥é“å®ƒå…¶å®æ˜¯ç”±å‡ ä¸ªç¨‹åºé›†ä¸€èµ·æ„å»ºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´`Swashbuckle.AspNetCore`æœ¬èº«æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä¸è¿‡è¿™ä¸æ˜¯é‡ç‚¹ï¼Œå…¶ä¸­ç”Ÿæˆ`Swagger.json`çš„æ˜¯åœ¨`Swashbuckle.AspNetCore.SwaggerGen`ç¨‹åºé›†ä¸­ï¼Œç›´æ¥æ‰¾åˆ°ä½ç½®åœ¨`SwaggerGenerator`ç±»ä¸­\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/domaindrivendev/Swashbuckle.AspNetCore/blob/v6.3.1/src/Swashbuckle.AspNetCore.SwaggerGen/SwaggerGenerator/SwaggerGenerator.cs)\]åªæ‘˜è¦æˆ‘ä»¬å…³æ³¨çš„åœ°æ–¹å³å¯

    public class SwaggerGenerator : ISwaggerProvider
    {
        private readonly IApiDescriptionGroupCollectionProvider _apiDescriptionsProvider;
        private readonly ISchemaGenerator _schemaGenerator;
        private readonly SwaggerGeneratorOptions _options;
    
        public SwaggerGenerator(
            SwaggerGeneratorOptions options,
            IApiDescriptionGroupCollectionProvider apiDescriptionsProvider,
            ISchemaGenerator schemaGenerator)
        {
            _options = options ?? new SwaggerGeneratorOptions();
            _apiDescriptionsProvider = apiDescriptionsProvider;
            _schemaGenerator = schemaGenerator;
        }
    
        /// <summary>
        /// è·å–Swaggeræ–‡æ¡£çš„æ ¸å¿ƒæ–¹æ³•
        /// </summary>
        public OpenApiDocument GetSwagger(string documentName, string host = null, string basePath = null)
        {
            if (!_options.SwaggerDocs.TryGetValue(documentName, out OpenApiInfo info))
                throw new UnknownSwaggerDocument(documentName, _options.SwaggerDocs.Select(d => d.Key));
    
            //ç»„è£…OpenApiDocumentæ ¸å¿ƒæ•°æ®æºæºæ¥è‡ª_apiDescriptionsProvider
            var applicableApiDescriptions = _apiDescriptionsProvider.ApiDescriptionGroups.Items
                .SelectMany(group => group.Items)
                .Where(apiDesc => !(_options.IgnoreObsoleteActions && apiDesc.CustomAttributes().OfType<ObsoleteAttribute().Any()))
                .Where(apiDesc => _options.DocInclusionPredicate(documentName, apiDesc));
    
            var schemaRepository = new SchemaRepository(documentName);
    
            var swaggerDoc = new OpenApiDocument
            {
                Info = info,
                Servers = GenerateServers(host, basePath),
                // Pathsç»„è£…æ˜¯æ¥è‡ªapplicableApiDescriptions
                Paths = GeneratePaths(applicableApiDescriptions, schemaRepository),
                Components = new OpenApiComponents
                {
                    Schemas = schemaRepository.Schemas,
                    SecuritySchemes = new Dictionary<string, OpenApiSecurityScheme>(_options.SecuritySchemes)
                },
                SecurityRequirements = new List<OpenApiSecurityRequirement>(_options.SecurityRequirements)
            };
    
            //çœç•¥å…¶ä»–ä»£ç 
            return swaggerDoc;
        }
    }
    

å¦‚æœä½ æ¯”è¾ƒäº†è§£`Swagger.json`çš„è¯é‚£ä¹ˆå¯¹`OpenApiDocument`è¿™ä¸ªç±»çš„ç»“æ„ä¸€å®šæ˜¯ä¸€ç›®äº†ç„¶ï¼Œä¸ä¿¡çš„è¯ä½ å¯ä»¥è‡ªè¡Œçœ‹çœ‹å®ƒçš„ç»“æ„

    {
      "openapi": "3.0.1",
      "info": {
        "title": "MyTest.WebApi",
        "description": "æµ‹è¯•æ¥å£",
        "version": "v1"
      },
      "paths": {
        "/": {
          "get": {
            "tags": [
              "MyTest.WebApi"
            ],
            "responses": {
              "200": {
                "description": "Success",
                "content": {
                  "text/plain": {
                    "schema": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "components": {}
    }
    

è¿™ä¹ˆçœ‹æ¸…æ™°äº†å§`OpenApiDocument`è¿™ä¸ªç±»å°±æ˜¯è¿”å›`Swagger.json`çš„æ¨¡å‹ç±»ï¼Œè€Œæ‰¿è½½æè¿°æ¥å£ä¿¡æ¯çš„æ ¸å¿ƒå­—æ®µ`paths`æ­£æ˜¯æ¥è‡ª`IApiDescriptionGroupCollectionProvider`ã€‚æ‰€ä»¥å°ç»“ä¸€ä¸‹ï¼ŒSwaggeræ¥å£çš„æ–‡æ¡£ä¿¡æ¯çš„æ•°æ®æºæ¥è‡ªäº`IApiDescriptionGroupCollectionProvider`ã€‚

#### ASP.Net Coreå¦‚ä½•æä¾›

é€šè¿‡ä¸Šé¢åœ¨`Swashbuckle.AspNetCore.SwaggerGen`ç¨‹åºé›†ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†çœŸæ­£ç»„è£…Swaggeræ¥å£æ–‡æ¡£éƒ¨åˆ†çš„æ•°æ®æºæ¥è‡ªäº`IApiDescriptionGroupCollectionProvider`ï¼Œä½†æ˜¯è¿™ä¸ªæ¥å£å¹¶éæ¥è‡ªSwashbuckleè€Œæ˜¯æ¥è‡ªASP.NET Coreã€‚è¿™å°±å¼•å…¥äº†å¦ä¸€ä¸ªä¸»è§’ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„`AddEndpointsApiExplorer`æ–¹æ³•ã€‚ç›´æ¥åœ¨`dotnet/aspnetcore`ä»“åº“é‡Œæ‰¾åˆ°æ–¹æ³•ä½ç½®\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/dotnet/aspnetcore/blob/v6.0.5/src/Mvc/Mvc.ApiExplorer/src/DependencyInjection/EndpointMethodInfoApiExplorerServiceCollectionExtensions.cs#L20)\]çœ‹ä¸€ä¸‹æ–¹æ³•å®ç°

    public static IServiceCollection AddEndpointsApiExplorer(this IServiceCollection services)
    {
        services.TryAddSingleton<IActionDescriptorCollectionProvider, DefaultActionDescriptorCollectionProvider>();
        //swaggerç”¨åˆ°çš„æ ¸å¿ƒæ“ä½œIApiDescriptionGroupCollectionProvider
        services.TryAddSingleton<IApiDescriptionGroupCollectionProvider, ApiDescriptionGroupCollectionProvider>();
        services.TryAddEnumerable(
            ServiceDescriptor.Transient<IApiDescriptionProvider, EndpointMetadataApiDescriptionProvider>());
        return services;
    }
    

çœ‹åˆ°äº†AddEndpointsApiExploreræ–¹æ³•ç›¸ä¿¡å°±æ˜ç™½äº†ä¸ºå•¥è¦æ·»åŠ è¿™ä¸ªæ–¹æ³•äº†å§ï¼Œé‚£ä½ å°±æœ‰ç–‘é—®äº†ä¸ºå•¥ä¸ä½¿ç”¨MinimalApiçš„æ—¶å€™å°±ä¸ç”¨å¼•å…¥AddEndpointsApiExplorerè¿™ä¸ªæ–¹æ³•äº†ï¼Œå†µä¸”ä¹Ÿèƒ½ä½¿ç”¨swaggerã€‚è¿™æ˜¯å› ä¸ºåœ¨`AddControllers`æ–¹æ³•é‡Œæ·»åŠ äº†`AddApiExplorer`æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é‡ŒåŒ…å«äº†é’ˆå¯¹Controllerçš„æ¥å£æè¿°ä¿¡æ¯ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šè¯´äº†ï¼Œæ¯•ç«Ÿè¿™ç§çš„æ ¸å¿ƒæ˜¯MinimalApiã€‚æ¥ä¸‹æ¥å°±çœ‹ä¸‹IApiDescriptionGroupCollectionProvideræ¥å£çš„é»˜è®¤å®ç°`ApiDescriptionGroupCollectionProvider`ç±»é‡Œçš„å®ç°\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/dotnet/aspnetcore/blob/v6.0.5/src/Mvc/Mvc.ApiExplorer/src/ApiDescriptionGroupCollectionProvider.cs)\]

    public class ApiDescriptionGroupCollectionProvider : IApiDescriptionGroupCollectionProvider
    {
    	private readonly IActionDescriptorCollectionProvider _actionDescriptorCollectionProvider;
    	private readonly IApiDescriptionProvider[] _apiDescriptionProviders;
    	private ApiDescriptionGroupCollection? _apiDescriptionGroups;
    
    	public ApiDescriptionGroupCollectionProvider(
    		IActionDescriptorCollectionProvider actionDescriptorCollectionProvider,
    		IEnumerable<IApiDescriptionProvider> apiDescriptionProviders)
    	{
    		_actionDescriptorCollectionProvider = actionDescriptorCollectionProvider;
    		_apiDescriptionProviders = apiDescriptionProviders.OrderBy(item => item.Order).ToArray();
    	}
    
    	public ApiDescriptionGroupCollection ApiDescriptionGroups
    	{
    		get
    		{
    			var actionDescriptors = _actionDescriptorCollectionProvider.ActionDescriptors;
    			if (_apiDescriptionGroups == null || _apiDescriptionGroups.Version != actionDescriptors.Version)
    			{
    				//å¦‚æœ_apiDescriptionGroupsä¸ºnullåˆ™ä½¿ç”¨GetCollectionæ–¹æ³•è¿”å›çš„æ•°æ®
    				_apiDescriptionGroups = GetCollection(actionDescriptors);
    			}
    			return _apiDescriptionGroups;
    		}
    	}
    
    	private ApiDescriptionGroupCollection GetCollection(ActionDescriptorCollection actionDescriptors)
    	{
    		var context = new ApiDescriptionProviderContext(actionDescriptors.Items);
    
    		//è¿™é‡Œä½¿ç”¨äº†_apiDescriptionProviders
    		foreach (var provider in _apiDescriptionProviders)
    		{
    			provider.OnProvidersExecuting(context);
    		}
    
    		for (var i = _apiDescriptionProviders.Length - 1; i >= 0; i--)
    		{
    			_apiDescriptionProviders[i].OnProvidersExecuted(context);
    		}
    
    		var groups = context.Results
    			.GroupBy(d => d.GroupName)
    			.Select(g => new ApiDescriptionGroup(g.Key, g.ToArray()))
    			.ToArray();
    		return new ApiDescriptionGroupCollection(groups, actionDescriptors.Version);
    	}
    }
    

è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†`IApiDescriptionProvider[]`é€šè¿‡ä¸Šé¢çš„æ–¹æ³•æˆ‘ä»¬å¯ä»¥çŸ¥é“IApiDescriptionProvideré»˜è®¤å®ç°æ˜¯`EndpointMetadataApiDescriptionProvider`ç±»\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/dotnet/aspnetcore/blob/v6.0.5/src/Mvc/Mvc.ApiExplorer/src/ApiDescriptionGroupCollectionProvider.cs)\]çœ‹ä¸€ä¸‹ç›¸å®ç°

    internal class EndpointMetadataApiDescriptionProvider : IApiDescriptionProvider
    {
        private readonly EndpointDataSource _endpointDataSource;
        private readonly IHostEnvironment _environment;
        private readonly IServiceProviderIsService? _serviceProviderIsService;
        private readonly ParameterBindingMethodCache ParameterBindingMethodCache = new();
    
        public EndpointMetadataApiDescriptionProvider(
            EndpointDataSource endpointDataSource,
            IHostEnvironment environment,
            IServiceProviderIsService? serviceProviderIsService)
        {
            _endpointDataSource = endpointDataSource;
            _environment = environment;
            _serviceProviderIsService = serviceProviderIsService;
        }
    
        public void OnProvidersExecuting(ApiDescriptionProviderContext context)
        {
            //æ ¸å¿ƒæ•°æ®æ¥è‡ªEndpointDataSourceç±»
            foreach (var endpoint in _endpointDataSource.Endpoints)
            {
                if (endpoint is RouteEndpoint routeEndpoint &&
                    routeEndpoint.Metadata.GetMetadata<MethodInfo>() is { } methodInfo &&
                    routeEndpoint.Metadata.GetMetadata<IHttpMethodMetadata>() is { } httpMethodMetadata &&
                    routeEndpoint.Metadata.GetMetadata<IExcludeFromDescriptionMetadata>() is null or { ExcludeFromDescription: false })
                {
                    foreach (var httpMethod in httpMethodMetadata.HttpMethods)
                    {
                        context.Results.Add(CreateApiDescription(routeEndpoint, httpMethod, methodInfo));
                    }
                }
            }
        }
    
        private ApiDescription CreateApiDescription(RouteEndpoint routeEndpoint, string httpMethod, MethodInfo methodInfo)
        {
            //å®ç°ä»£ç çœç•¥	
        }
    }
    

è¿™ä¸ªç±»é‡Œè¿˜æœ‰å…¶ä»–æ–¹æ³•ä»£ç ä¹Ÿéå¸¸å¤šï¼Œéƒ½æ˜¯åœ¨ç»„è£…ApiDescriptioné‡Œçš„æ•°æ®ï¼Œé€šè¿‡åç§°å¯ä»¥å¾—çŸ¥ï¼Œè¿™ä¸ªç±»æ˜¯ä¸ºäº†æè¿°APIæ¥å£ä¿¡æ¯ç”¨çš„ï¼Œä½†æ˜¯æˆ‘ä»¬äº†è§£åˆ°çš„æ˜¯å®ƒçš„æ•°æ®æºéƒ½æ¥è‡ª`EndpointDataSource`ç±»çš„å®ä¾‹ã€‚æˆ‘ä»¬éƒ½çŸ¥é“MinimalApiæä¾›çš„æ“ä½œæ–¹æ³•å°±æ˜¯`MapGet`ã€`MapPost`ã€`MapPut`ã€`MapDelete`ç­‰ç­‰ï¼Œè¿™äº›æ–¹æ³•çš„æœ¬è´¨éƒ½æ˜¯åœ¨è°ƒç”¨`Map`æ–¹æ³•\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/dotnet/aspnetcore/blob/v6.0.5/src/Http/Routing/src/Builder/EndpointRouteBuilderExtensions.cs#L419)\]ï¼Œçœ‹ä¸€ä¸‹æ ¸å¿ƒå®ç°

    private static RouteHandlerBuilder Map(this IEndpointRouteBuilder endpoints,
    			RoutePattern pattern, Delegate handler, bool disableInferBodyFromParameters)
    {
    	//çœç•¥éƒ¨åˆ†ä»£ç 
    	var requestDelegateResult = RequestDelegateFactory.Create(handler, options);
    	var builder = new RouteEndpointBuilder(requestDelegateResult.RequestDelegate,pattern,defaultOrder)
    	{
    		//è·¯ç”±åç§°
    		DisplayName = pattern.RawText ?? pattern.DebuggerToString(),
    	};
    
    	//è·å¾—httpmethod
    	builder.Metadata.Add(handler.Method);
    
    	if (GeneratedNameParser.TryParseLocalFunctionName(handler.Method.Name, out var endpointName)
    		|| !TypeHelper.IsCompilerGeneratedMethod(handler.Method))
    	{
    		endpointName ??= handler.Method.Name;
    		builder.DisplayName = $"{builder.DisplayName} => {endpointName}";
    	}
    
    	var attributes = handler.Method.GetCustomAttributes();
    
    	foreach (var metadata in requestDelegateResult.EndpointMetadata)
    	{
    		builder.Metadata.Add(metadata);
    	}
    
    	if (attributes is not null)
    	{
    		foreach (var attribute in attributes)
    		{
    			builder.Metadata.Add(attribute);
    		}
    	}
    
    	// æ·»åŠ ModelEndpointDataSource
    	var dataSource = endpoints.DataSources.OfType<ModelEndpointDataSource>().FirstOrDefault();
    	if (dataSource is null)
    	{
    		dataSource = new ModelEndpointDataSource();
    		endpoints.DataSources.Add(dataSource);
    	}
    	//å°†RouteEndpointBuilderæ·»åŠ åˆ°ModelEndpointDataSource
    	return new RouteHandlerBuilder(dataSource.AddEndpointBuilder(builder));
    }
    

é€šè¿‡`Map`æ–¹æ³•æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯æ¬¡æ·»åŠ ä¸€ä¸ªMinimalApiç»ˆç»“ç‚¹éƒ½ä¼šç»™`ModelEndpointDataSource`å®ä¾‹æ·»åŠ ä¸€ä¸ª`EndpointBuilder`å®ä¾‹,EndPointBuilderé‡Œæ‰¿è½½ç€MinimalApiç»ˆç»“ç‚¹çš„ä¿¡æ¯ï¼Œè€ŒModelEndpointDataSourceåˆ™æ˜¯ç»§æ‰¿äº†`EndpointDataSource`ç±»,è¿™ä¸ªå¯ä»¥çœ‹å®ƒçš„å®šä¹‰\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/dotnet/aspnetcore/blob/v6.0.5/src/Http/Routing/src/ModelEndpointDataSource.cs)\]

    internal class ModelEndpointDataSource : EndpointDataSource
    {
    }
    

è¿™å°±å’Œä¸Šé¢æåˆ°çš„`EndpointMetadataApiDescriptionProvider`é‡Œçš„EndpointDataSourceè”ç³»èµ·æ¥äº†,ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œçœ‹åˆ°çš„æ˜¯`IEndpointRouteBuilder`çš„`DataSources`å±æ€§ï¼Œä»åå­—çœ‹è¿™æ˜æ˜¾æ˜¯ä¸€ä¸ªé›†åˆï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å®šä¹‰çš„åœ°æ–¹çœ‹ä¸€ä¸‹\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/dotnet/aspnetcore/blob/v6.0.5/src/Http/Routing/src/IEndpointRouteBuilder.cs)\]

    public interface IEndpointRouteBuilder
    {
        IApplicationBuilder CreateApplicationBuilder();
        IServiceProvider ServiceProvider { get; }
        //è¿™é‡Œæ˜¯ä¸€ä¸ªEndpointDataSourceçš„é›†åˆ
        ICollection<EndpointDataSource> DataSources { get; }
    }
    

è¿™é‡Œæ—¢ç„¶æ˜¯ä¸€ä¸ªé›†åˆé‚£å¦‚ä½•å’ŒEndpointDataSourceè”ç³»èµ·æ¥å‘¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¾—å»çœ‹EndpointDataSourceæ˜¯å¦‚ä½•è¢«æ³¨å†Œçš„å³å¯ï¼Œæ‰¾åˆ°`EndpointDataSource`æ³¨å†Œçš„åœ°æ–¹\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/dotnet/aspnetcore/blob/v6.0.5/src/Http/Routing/src/DependencyInjection/RoutingServiceCollectionExtensions.cs#L57)\]æŸ¥çœ‹ä¸€ä¸‹æ³¨å†Œä»£ç 

    var dataSources = new ObservableCollection<EndpointDataSource>();
    services.TryAddEnumerable(ServiceDescriptor.Transient<IConfigureOptions<RouteOptions>, ConfigureRouteOptions>(
        serviceProvider => new ConfigureRouteOptions(dataSources)));
    
    services.TryAddSingleton<EndpointDataSource>(s =>
    {
        return new CompositeEndpointDataSource(dataSources);
    });
    

é€šè¿‡è¿™æ®µä»£ç æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸¤ç‚¹ä¿¡æ¯

*   ä¸€æ˜¯EndpointDataSourceè¿™ä¸ªæŠ½è±¡ç±»ï¼Œç³»ç»Ÿç»™ä»–æ³¨å†Œçš„æ˜¯`CompositeEndpointDataSource`è¿™ä¸ªå­ç±»ï¼Œçœ‹åå­—å¯ä»¥çœ‹å‡ºæ˜¯ç»„åˆçš„EndpointDataSource
*   äºŒæ˜¯`CompositeEndpointDataSource`æ˜¯é€šè¿‡`ObservableCollection<EndpointDataSource>`è¿™ä¹ˆä¸€ä¸ªé›†åˆæ¥åˆå§‹åŒ–çš„

æˆ‘ä»¬å¯ä»¥ç®€å•çš„æ¥çœ‹ä¸‹CompositeEndpointDataSourceä¼ é€’çš„dataSourcesæ˜¯å¦‚ä½•è¢«æ¥æ”¶çš„\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/dotnet/aspnetcore/blob/v6.0.5/src/Http/Routing/src/CompositeEndpointDataSource.cs#L22:54)\]å’±ä»¬åªå…³æ³¨ä»–è¯´å¦‚ä½•è¢«æ¥æ”¶çš„

    public sealed class CompositeEndpointDataSource : EndpointDataSource
    {
        private readonly ICollection<EndpointDataSource> _dataSources = default!;
        internal CompositeEndpointDataSource(ObservableCollection<EndpointDataSource> dataSources) : this()
        {
            _dataSources = dataSources;
        }
    
        public IEnumerable<EndpointDataSource> DataSources => _dataSources;
    }
    

é€šè¿‡ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿé»˜è®¤ä¸ºEndpointDataSourceæŠ½è±¡ç±»æ³¨å†Œäº†`CompositeEndpointDataSource`å®ç°ç±»ï¼Œè€Œè¿™ä¸ªå®ç°ç±»æ˜¯ä¸€ä¸ªç»„åˆç±»ï¼Œå®ƒç»„åˆäº†ä¸€ä¸ªEndpointDataSourceçš„é›†åˆã€‚é‚£ä¹ˆåˆ°äº†è¿™é‡Œå°±åªå‰©ä¸‹ä¸€ä¸ªé—®é¢˜äº†ï¼Œé‚£å°±æ˜¯`EndpointDataSource`æ˜¯å¦‚ä½•å’Œ`IEndpointRouteBuilder`çš„`DataSources`å±æ€§å…³è”èµ·æ¥çš„ã€‚ç°åœ¨æœ‰äº†æä¾›æ•°æ®æºçš„IEndpointRouteBuilderï¼Œæœ‰æ‰¿è½½æ•°æ®çš„EndpointDataSourceã€‚è¿™ä¸ªåœ°æ–¹å‘¢å¤§å®¶ä¹Ÿæ¯”è¾ƒç†Ÿæ‚‰é‚£å°±æ˜¯`UseEndpoints`ä¸­é—´ä»¶é‡Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ˜¯å¦‚ä½•å®ç°çš„\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/dotnet/aspnetcore/blob/19d21ad0d209b5c7be6387c7db3cf202c91951af/src/Http/Routing/src/Builder/EndpointRoutingApplicationBuilderExtensions.cs#L99)\]

    public static IApplicationBuilder UseEndpoints(this IApplicationBuilder builder, Action<IEndpointRouteBuilder> configure)
    {
        // çœç•¥ä¸€å †ä»£ç 
    
        //å¾—åˆ°IEndpointRouteBuilderå®ä¾‹
        VerifyEndpointRoutingMiddlewareIsRegistered(builder, out var endpointRouteBuilder);
        //è·å–RouteOptions
        var routeOptions = builder.ApplicationServices.GetRequiredService<IOptions<RouteOptions>>();
        //éå†IEndpointRouteBuilderçš„DataSources
        foreach (var dataSource in endpointRouteBuilder.DataSources)
        {
            if (!routeOptions.Value.EndpointDataSources.Contains(dataSource))
            {
                //dataSourceæ”¾å…¥RouteOptionsçš„EndpointDataSourcesé›†åˆ
                routeOptions.Value.EndpointDataSources.Add(dataSource);
            }
        }
    
        return builder.UseMiddleware<EndpointMiddleware>();
    }
    
    private static void VerifyEndpointRoutingMiddlewareIsRegistered(IApplicationBuilder app, out IEndpointRouteBuilder endpointRouteBuilder)
    {
        if (!app.Properties.TryGetValue(EndpointRouteBuilder, out var obj))
        {
            throw new InvalidOperationException();
        }
    
        endpointRouteBuilder = (IEndpointRouteBuilder)obj!;
    
        if (endpointRouteBuilder is DefaultEndpointRouteBuilder defaultRouteBuilder && !object.ReferenceEquals(app, defaultRouteBuilder.ApplicationBuilder))
        {
            throw new InvalidOperationException();
        }
    }
    

è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æ˜¯è·å–çš„`IOptions<RouteOptions>`é‡Œçš„EndpointDataSourcesï¼Œæ€ä¹ˆå’Œé¢„æƒ³çš„å‰§æœ¬ä¸ä¸€æ ·å‘¢ï¼Ÿå¹¶éå¦‚æ­¤ï¼Œä½ çœ‹ä¸Šé¢å’±ä»¬è¯´çš„è¿™æ®µä»£ç 

    var dataSources = new ObservableCollection<EndpointDataSource>();
    services.TryAddEnumerable(ServiceDescriptor.Transient<IConfigureOptions<RouteOptions>, ConfigureRouteOptions>(
    	serviceProvider => new ConfigureRouteOptions(dataSources)));
    

ä¸Šé¢çš„dataSourcesåŒæ—¶ä¼ é€’ç»™äº†`CompositeEndpointDataSource`å’Œ`ConfigureRouteOptions`ï¼Œè€ŒConfigureRouteOptionsåˆ™æ­£æ˜¯`IConfigureOptions<RouteOptions>`ç±»å‹çš„ï¼Œæ‰€ä»¥è·å–`IOptions<RouteOptions>`å°±æ˜¯è·å–çš„ConfigureRouteOptionsçš„å®ä¾‹ï¼Œå’±ä»¬æ¥çœ‹ä¸€ä¸‹ConfigureRouteOptionsç±»çš„å®ç°\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/dotnet/aspnetcore/blob/v6.0.5/src/Http/Routing/src/ConfigureRouteOptions.cs)\]

    internal class ConfigureRouteOptions : IConfigureOptions<RouteOptions>
    {
        private readonly ICollection<EndpointDataSource> _dataSources;
    
        public ConfigureRouteOptions(ICollection<EndpointDataSource> dataSources)
        {
            if (dataSources == null)
            {
                throw new ArgumentNullException(nameof(dataSources));
            }
    
            _dataSources = dataSources;
        }
    
        public void Configure(RouteOptions options)
        {
            if (options == null)
            {
                throw new ArgumentNullException(nameof(options));
            }
    
            options.EndpointDataSources = _dataSources;
        }
    }
    

å®ƒçš„æœ¬è´¨æ“ä½œå°±æ˜¯å¯¹`RouteOptions`çš„EndpointDataSourcesçš„å±æ€§è¿›è¡Œæ“ä½œï¼Œå› ä¸º`ICollection<EndpointDataSource>`æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥è¿™ä¸ªé›†åˆæ˜¯å…±äº«çš„ï¼Œå› æ­¤`IEndpointRouteBuilder`çš„`DataSources`å’Œ`IConfigureOptions<RouteOptions>`æœ¬è´¨æ˜¯ä½¿ç”¨äº†åŒä¸€ä¸ª`ICollection<EndpointDataSource>`é›†åˆï¼Œæ‰€ä»¥ä¸Šé¢çš„`UseEndpoints`é‡Œè·å–RouteOptionsé€‰é¡¹çš„æœ¬è´¨æ­£æ˜¯è·å–çš„EndpointDataSourceé›†åˆã€‚

> æ¯æ¬¡å¯¹`IEndpointRouteBuilder`çš„`DataSources`é›†åˆAddçš„æ—¶å€™å…¶å®æ˜¯åœ¨ä¸º`ICollection<EndpointDataSource>`é›†åˆæ·»åŠ æ•°æ®ï¼Œè€Œ`IConfigureOptions<RouteOptions>`ä¹Ÿä½¿ç”¨äº†è¿™ä¸ªé›†åˆï¼Œæ‰€ä»¥å®ƒä»¬çš„æ•°æ®æ˜¯äº’é€šçš„ã€‚  
> è®¸å¤šåŒå­¦éƒ½å¾ˆå¥½å¼ºï¼Œé»˜è®¤å¹¶æ²¡åœ¨MinimalApiçœ‹åˆ°æ³¨å†Œ`UseEndpoints`ï¼Œä½†æ˜¯åœ¨ASP.NET Core6.0ä¹‹å‰è¿˜æ˜¯éœ€è¦æ³¨å†Œ`UseEndpoints`ä¸­é—´ä»¶çš„ã€‚è¿™å…¶å®æ˜¯ASP.NET Core6.0è¿›è¡Œçš„ä¸€æ¬¡å‡çº§ä¼˜åŒ–ï¼Œå› ä¸ºå¾ˆå¤šæ“ä½œé»˜è®¤éƒ½å¾—æ·»åŠ ï¼Œæ‰€ä»¥æŠŠå®ƒç»Ÿä¸€å°è£…èµ·æ¥äº†ï¼Œè¿™ä¸ªå¯ä»¥åœ¨`WebApplicationBuilder`ç±»ä¸­çœ‹åˆ°\[[ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ](https://github.com/dotnet/aspnetcore/blob/v6.0.5/src/DefaultBuilder/src/WebApplicationBuilder.cs#L245)\]åœ¨`ConfigureApplication`æ–¹æ³•ä¸­çš„ä»£ç 

    private void ConfigureApplication(WebHostBuilderContext context, IApplicationBuilder app)
    {
        // çœç•¥éƒ¨åˆ†ä»£ç 
    
        // æ³¨å†ŒUseDeveloperExceptionPageå…¨å±€å¼‚å¸¸ä¸­é—´ä»¶
        if (context.HostingEnvironment.IsDevelopment())
        {
            app.UseDeveloperExceptionPage();
        }
    
        app.Properties.Add(WebApplication.GlobalEndpointRouteBuilderKey, _builtApplication);
    
        if (_builtApplication.DataSources.Count > 0)
        {
            // æ³¨å†ŒUseRoutingä¸­é—´ä»¶
            if (!_builtApplication.Properties.TryGetValue(EndpointRouteBuilderKey, out var localRouteBuilder))
            {
                app.UseRouting();
            }
            else
            {
                app.Properties[EndpointRouteBuilderKey] = localRouteBuilder;
            }
        }
    
        app.Use(next =>
        {
            //è°ƒç”¨WebApplicationçš„Runæ–¹æ³•
            _builtApplication.Run(next);
            return _builtApplication.BuildRequestDelegate();
        });
    
        // å¦‚æœDataSourcesé›†åˆæœ‰æ•°æ®åˆ™æ³¨å†ŒUseEndpoints
        if (_builtApplication.DataSources.Count > 0)
        {
            app.UseEndpoints(_ => { });
        }
    
        // çœç•¥éƒ¨åˆ†ä»£ç 
    }
    

ç›¸ä¿¡å¤§å®¶é€šè¿‡`ConfigureApplication`è¿™ä¸ªæ–¹æ³•å¤§å®¶å°±äº†è§£äº†å§ï¼Œä¹‹å‰æˆ‘ä»¬èƒ½çœ‹åˆ°çš„ç†Ÿæ‚‰æ–¹æ³•`UseDeveloperExceptionPage`ã€`UseRouting`ã€`UseEndpoints`æ–¹æ³•éƒ½åœ¨è¿™é‡Œï¼Œæ¯•ç«Ÿä¹‹å‰è¿™å‡ ä¸ªæ–¹æ³•å‡ ä¹ä¹Ÿæˆäº†æ–°å»ºé¡¹ç›®æ—¶å€™å¿…é¡»è¦æ·»åŠ çš„ï¼Œæ‰€ä»¥å¾®è½¯å¹²è„†å°±åœ¨å†…éƒ¨ç»Ÿä¸€å°è£…èµ·æ¥äº†ã€‚

#### æºç å°ç»“

ä¸Šé¢å’±ä»¬åˆ†æäº†ç›¸å…³çš„æºç ï¼Œæ•´ç†èµ·æ¥å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªæ€è·¯ã€‚

*   `Swashbuckle.AspNetCore.SwaggerGen`ç”¨æ¥ç”Ÿæˆswaggerçš„æ•°æ®æºæ¥è‡ª`IApiDescriptionGroupCollectionProvider`
*   IApiDescriptionGroupCollectionProviderå®ä¾‹çš„æ•°æ®æ¥è‡ª`EndpointDataSource`
*   å› ä¸º`EndpointDataSource`çš„`DataSources`å’Œ`IConfigureOptions<RouteOptions>`æœ¬è´¨æ˜¯ä½¿ç”¨äº†åŒä¸€ä¸ª`ICollection<EndpointDataSource>`é›†åˆï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯åŒä¸€ä»½æ•°æ®
*   æ¯æ¬¡ä½¿ç”¨MinimalApiçš„Mapç›¸å…³çš„æ–¹æ³•çš„æ˜¯ä¼šç»™`IEndpointRouteBuilder`çš„`DataSources`é›†åˆæ·»åŠ æ•°æ®
*   åœ¨`UseEndpoints`ä¸­é—´ä»¶é‡Œè·å–`IEndpointRouteBuilder`çš„`DataSources`æ•°æ®ç»™RouteOptionsé€‰é¡¹çš„EndpointDataSourcesé›†åˆå±æ€§æ·»åŠ æ•°æ®,æœ¬è´¨åˆ™æ˜¯ç»™`ICollection<EndpointDataSource>`é›†åˆèµ‹å€¼ï¼Œè‡ªç„¶ä¹Ÿå°±æ˜¯ç»™`EndpointDataSource`çš„`DataSources`å±æ€§èµ‹å€¼

è¿™ä¹Ÿç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ€è·¯ï¼Œå¦‚æœä½ æƒ³è‡ªå·±å»é€‚é…swaggeræ•°æ®æºçš„è¯å®Œå…¨ä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ªæ€è·¯ï¼Œæƒ³åŠæ³•æŠŠä½ è¦æä¾›çš„æ¥å£ä¿¡æ¯æ”¾åˆ°EndpointDataSourceçš„DataSourcesé›†åˆå±æ€§é‡Œå³å¯ï¼Œæˆ–è€…ç›´æ¥é€‚é…IApiDescriptionGroupCollectionProvideré‡Œçš„æ•°æ®ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œç ”ç©¶ä¸€ä¸‹ã€‚

### ä½¿ç”¨æ‰©å±•

æˆ‘ä»¬çœ‹åˆ°äº†å¾®è½¯ç»™æˆ‘ä»¬æä¾›äº†`IApiDescriptionGroupCollectionProvider`è¿™ä¸ªä¾¿åˆ©æ¡ä»¶ï¼Œæ‰€ä»¥å¦‚æœä»¥åæœ‰è·å–æ¥å£ä¿¡æ¯çš„æ—¶å€™åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ï¼Œå¾ˆå¤šæ—¶å€™æ¯”å¦‚å†™ç›‘æ§ç¨‹åºæˆ–è€…å†™Apiæ¥å£è°ƒç”¨çš„ä»£ç ç”Ÿæˆå™¨çš„æ—¶å€™éƒ½å¯ä»¥è€ƒè™‘ä¸€ä¸‹ï¼Œå’±ä»¬ç®€å•çš„ç¤ºä¾‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ï¼Œé¦–å…ˆå®šä¹‰ä¸ªæ¨¡å‹ç±»æ¥æ‰¿è½½æ¥å£ä¿¡æ¯

    public class ApiDoc
    {
        /// <summary>
        /// æ¥å£åˆ†ç»„
        /// </summary>
        public string Group { get; set; }
    
        /// <summary>
        /// æ¥å£è·¯ç”±
        /// </summary>
        public string Route { get; set; }
    
        /// <summary>
        /// httpæ–¹æ³•
        /// </summary>
        public string HttpMethod { get; set; }
    }
    

è¿™ä¸ªç±»éå¸¸ç®€å•åªåšæ¼”ç¤ºä½¿ç”¨ï¼Œç„¶åæˆ‘ä»¬åœ¨IApiDescriptionGroupCollectionProvideré‡Œè·å–ä¿¡æ¯æ¥å¡«å……è¿™ä¸ªé›†åˆï¼Œè¿™é‡Œæˆ‘ä»¬å†™ä¸€ä¸ªhttæ¥å£æ¥å±•ç¤º

    app.MapGet("/apiinfo", (IApiDescriptionGroupCollectionProvider provider) => {
        List<ApiDoc> docs = new List<ApiDoc>();
        foreach (var group in provider.ApiDescriptionGroups.Items)
        {
            foreach (var apiDescription in group.Items)
            {
                docs.Add(new ApiDoc 
                { 
                    Group = group.GroupName, 
                    Route = apiDescription.RelativePath,
                    HttpMethod = apiDescription.HttpMethod
                });
            }
        }
        return docs;
    });
    

è¿™ä¸ªæ—¶å€™å½“ä½ åœ¨æµè§ˆå™¨é‡Œè¯·æ±‚`/apiinfo`è·¯å¾„çš„æ—¶å€™ä¼šè¿”å›ä½ çš„webapiåŒ…å«çš„æ¥å£ç›¸å…³çš„ä¿¡æ¯ã€‚å’±ä»¬çš„ç¤ºä¾‹æ˜¯éå¸¸ç®€å•çš„ï¼Œå®é™…ä¸ŠIApiDescriptionGroupCollectionProvideråŒ…å«çš„æ¥å£ä¿¡æ¯æ˜¯éå¸¸å¤šçš„åŒ…å«è¯·æ±‚å‚æ•°ä¿¡æ¯ã€è¾“å‡ºè¿”å›ä¿¡æ¯ç­‰å¾ˆå…¨é¢ï¼Œè¿™ä¹Ÿæ˜¯swaggerå¯ä»¥å®Œå…¨ä¾èµ–å®ƒçš„åŸå› ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œçš„äº†è§£ä¸€ä¸‹ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šè®²è§£äº†ã€‚

### æ€»ç»“

Â Â Â Â æœ¬æ–‡å’±ä»¬ä¸»è¦é€šè¿‡MinimalApiå¦‚ä½•é€‚é…swaggerçš„è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹æ¥è®²è§£äº†ASP.NET Coreæ˜¯å¦‚ä½•ç»™Swaggeræä¾›äº†æ•°æ®çš„ã€‚æœ¬è´¨æ˜¯å¾®è½¯åœ¨ASP.NET Coreæœ¬èº«æä¾›äº†`IApiDescriptionGroupCollectionProvider`è¿™ä¹ˆä¸€ä¸ªæ•°æ®æºï¼ŒSwaggerå€ŸåŠ©è¿™ä¸ªæ•°æ®æºç”Ÿæˆäº†swaggeræ–‡æ¡£ï¼ŒIApiDescriptionGroupCollectionProvideræ¥è‡ªå£°æ˜ç»ˆç»“ç‚¹çš„æ—¶å€™å¾€`EndpointDataSource`çš„`DataSources`é›†åˆé‡Œæ·»åŠ çš„æ¥å£ä¿¡æ¯ç­‰ã€‚å…¶å®å®ƒå†…éƒ¨æ¯”è¿™ä¸ªè¿˜è¦å¤æ‚ä¸€ç‚¹ï¼Œä¸è¿‡å¦‚æœæˆ‘ä»¬ç”¨æ¥è·å–æ¥å£ä¿¡æ¯çš„è¯ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ä½¿ç”¨IApiDescriptionGroupCollectionProvideråº”è¯¥å°±è¶³å¤Ÿäº†ã€‚  
Â Â Â Â åˆ†äº«ä¸€æ®µæˆ‘ä¸ªäººæ¯”è¾ƒè®¤å¯çš„è¯ï¼Œä¸å…¶å¤©å¤©é’»å¤´è§…ç¼ã€æ‰¾å„ç§æœºä¼šï¼Œä¸å¦‚æŠŠè¿™äº›æ—¶é—´å’Œé‡‘é’±æŠ•å…¥åˆ°è‡ªå·±çš„èƒ½åŠ›å»ºè®¾ä¸Šã€‚æœºä¼šç¨çºµå³é€ï¼Œè€Œä¸”åˆ«äººç»™ä½ çš„æœºä¼šï¼Œæ²¡å‡†å„¿åè€Œæ˜¯é™·é˜±ã€‚è€ŒæŠ•èµ„ä¸ªäººèƒ½åŠ›å°±æ˜¯ç§¯ç´¯ä¸€ä¸ªèµ„äº§è´¦æˆ·ï¼Œåªèƒ½è¶Šå­˜è¶Šå¤šï¼Œçœ‹èµ·æ¥æ…¢ï¼Œä½†æ˜¯ä½ æ°¸è¿œåœ¨äº«å—æ—¶é—´å¸¦æ¥çš„å¤åˆ©ï¼Œå…¶å®å¿«å¾—å¾ˆï¼Œæ”¶ç›Šä¹Ÿç¨³å®šå¾—å¤šã€‚æœ‰äº†èƒ½åŠ›ä¹‹åï¼Œæœºä¼šä¹Ÿå°±æ¥äº†ã€‚  
  

ğŸ‘‡æ¬¢è¿æ‰«ç å…³æ³¨æˆ‘çš„å…¬ä¼—å·ğŸ‘‡ ![](https://img2020.cnblogs.com/blog/2042116/202006/2042116-20200622133425514-1420050576.png)