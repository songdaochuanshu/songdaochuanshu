---
layout: post
title: "stm32h750移植lvgl"
date: "2022-10-30T06:24:52.266Z"
---
stm32h750移植lvgl
---------------

之前没做过ui，只用过lcd画几条线写点字，如果按键、菜单什么的全用线画也太麻烦了，所以需要一个ui库。

听说lvgl用的人很多，就打算裸机移植一下用用。本文移植的lvgl版本是lvgl6.2，也移植过8.2，但是flash占用陡增占了快300k，我用到了外置flash，涉及到bootloader+app，有机会下篇文章细说。

使用的单片机是stm32h750vbt6，内置的flash极小只有128k，ram倒是很大1M够用了，符合lvgl6.2的最低要求，当然具体用多少和屏幕大小有关，显存容量必须算进去。

lvgl源码下载地址https://github.com/lvgl/lvgl

lvgl具体使用直接在官网可以找到

**下载完可见到这样的目录结构，我们只要使用到这几个文件夹的内容。**

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030130534268-2050532977.png)

**README.md里其实就有移植步骤，我这里走个流程。**

为了方便直接把lvgl-release-v6文件夹复制到你自己的工程目录里，改名为lvgl（**一定要改，不然后续头文件会定位错误，具体为什么可以看源码研究**）。

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030131330827-43242783.png)

**几个文件夹、文件介绍：**

src里是源码，把.c文件全部加入工程，什么都不用改。

porting里是提供的接口模板xxxtemplate，需要添加修改内容，是本地lcd、输入设备、文件系统和lvgl的桥梁（比如你有刀，但不会砍树，把刀递给lvgl它才能砍树）。

lv\_conf\_template.h顾名思义是配置文件的模板，需要修改。

**具体移植流程：**

lv\_conf\_template.h改名为lv\_conf.h放到和lvgl文件夹同级的位置，否则会造成后续头文件找不到的问题。

porting内的文件同样把\_template后缀都删了重命名。

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030132909637-1926044423.png) ![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030132912401-683597895.png)

最后添加进工程的文件如图所示：

 ![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030132732474-2125542921.png)

把这几个文件的#if 0全部改成1使能这几个文件，并且把3个lv\_port\_xxx.c文件的include也删掉后缀\_template和你自己的对应。

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030133121735-75532016.png)

lv\_port\_disp.c 负责显示部分；

lv\_port\_fs.c 负责文件系统部分（file system）；

lv\_port\_indev.c 负责输入设备部分（input device）；

本次我只用到了显示部分，所以我只改了lv\_port\_disp.c和lv\_conf.h

**1、lv\_conf.h修改此处，为你的屏幕像素大小，我的是160\*90：**

 ![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030133617147-577939351.png)

**2、lv\_port\_disp.c ，找到void lv\_port\_disp\_init(void)函数修改其内容如图，lvgl6.2提供三种范例，disp\_buf\_123对应ui处理速度慢中快可自己选择，我这里选择的2：**

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030133844134-724290336.png)

**lv\_port\_disp.c ，继续添加你自己lcd的1初始化函数、2画点函数如图：**

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030134153421-965423265.png)

**3、最后再自己配个1-10ms的中断，加入lv\_tick\_inc(x)函数给lvgl心跳计时用。x为你中断周期，我这里为1ms所以写1。**

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030135745776-1384340943.png)

**4、当然记得加头文件路径，用到多少加多少，我的如下：**

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030134259970-1737534301.png)

**5、开始编译，不报错基本就移植成功了：**

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030134810180-1338112589.png)

**可能报错的原因：**

flash超出或者ram超出报memory错误这个没本法，可以用外置ram、flash。

头文件源文件找不到等错误可能是配置步骤没做对仔细检查。

**使用lvgl范例：**

然后在main函数内加入如下内容，进行测试：

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030134937148-47739254.png)

 ![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030134952032-1154572742.png)

意思是在lv\_acr\_act()图层上画一个方块，加一个label标签显示字号为15的“Hello, world”。

最后在主循环内加入lvgl的刷新函数，循环执行：

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030135451388-1592644967.png)

重新编译下载效果如下：

![](https://img2022.cnblogs.com/blog/2531887/202210/2531887-20221030135319685-1745786361.jpg)

移植成功。

ui就是很吃存储空间的，lvgl高版本吃更多的内存但也代表着更丰富的功能，我后来移植的8.2版本对flash要求更高远超了128k，用到了外置qspi的flash，用到bootloader+app的结构，后续有机会细说。

posted on 2022-10-30 14:06  [兵无常形](https://www.cnblogs.com/czy8388/)  阅读(6)  评论(0)  [编辑](https://i.cnblogs.com/EditPosts.aspx?postid=16841060)  [收藏](javascript:void(0))  [举报](javascript:void(0))