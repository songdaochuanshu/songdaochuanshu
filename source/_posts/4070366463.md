---
layout: post
title: "DRF è§†å›¾ç»„ä»¶"
date: "2022-04-01T17:20:57.858Z"
---
DRF è§†å›¾ç»„ä»¶
========

![DRF è§†å›¾ç»„ä»¶](https://img2022.cnblogs.com/blog/2608072/202204/2608072-20220401230814733-215477841.png) ä½ é—®æˆ‘ä½¿ç”¨DRFè§†å›¾ç»„ä»¶å¿«é€Ÿå†™æ¥å£ï¼Ÿä¹ä¹å½’ä¸€å‰‘è¯€æ—©å°±å‡†å¤‡å¥½äº†ï¼Œæ²¡æœ‰å‰¯ä½œç”¨ï¼

ç›®å½•

*   [DRF è§†å›¾ç»„ä»¶](#drf-è§†å›¾ç»„ä»¶)
*   [è§†å›¾ç»„ä»¶å¤§çº²](#è§†å›¾ç»„ä»¶å¤§çº²)
    *   [ä¸¤ä¸ªè§†å›¾åŸºæœ¬ç±»](#ä¸¤ä¸ªè§†å›¾åŸºæœ¬ç±»)
    *   [äº”ä¸ªæ‰©å±•ç±»](#äº”ä¸ªæ‰©å±•ç±»)
    *   [ä¹ä¸ªå­ç±»è§†å›¾](#ä¹ä¸ªå­ç±»è§†å›¾)
    *   [è§†å›¾é›†](#è§†å›¾é›†)
        *   [å¸¸ç”¨è§†å›¾é›†çˆ¶ç±»](#å¸¸ç”¨è§†å›¾é›†çˆ¶ç±»)
        *   [é­”æ³•ç±»](#é­”æ³•ç±»)
    *   [ä¸€è§ˆè¡¨](#ä¸€è§ˆè¡¨)
*   [DRFä¸­è§†å›¾çš„â€œä¸ƒåäºŒå˜â€](#drfä¸­è§†å›¾çš„ä¸ƒåäºŒå˜)
    *   [ç¬¬ä¸€å±‚ï¼šåŸºäºAPIviewçš„äº”ä¸ªæ¥å£](#ç¬¬ä¸€å±‚åŸºäºapiviewçš„äº”ä¸ªæ¥å£)
        *   [ç¬¬ä¸€å±‚äº”ä¸ªæ¥å£demo](#ç¬¬ä¸€å±‚äº”ä¸ªæ¥å£demo)
    *   [ç¬¬äºŒå±‚ï¼šåŸºäºGenericAPIViewçš„äº”ä¸ªæ¥å£](#ç¬¬äºŒå±‚åŸºäºgenericapiviewçš„äº”ä¸ªæ¥å£)
        *   [å¸¸ç”¨ç±»å±æ€§ï¼š](#å¸¸ç”¨ç±»å±æ€§)
        *   [ç¬¬äºŒå±‚äº”ä¸ªæ¥å£demo](#ç¬¬äºŒå±‚äº”ä¸ªæ¥å£demo)
    *   [ç¬¬ä¸‰å±‚ï¼šåŸºäºGenericAPIView+äº”ä¸ªè§†å›¾æ‰©å±•ç±»å†™](#ç¬¬ä¸‰å±‚åŸºäºgenericapiviewäº”ä¸ªè§†å›¾æ‰©å±•ç±»å†™)
        *   [ç¬¬ä¸‰å±‚äº”ä¸ªæ¥å£demo](#ç¬¬ä¸‰å±‚äº”ä¸ªæ¥å£demo)
        *   [GenericAPIViewé€Ÿå†™äº”ä¸ªæ¥å£demo](#genericapiviewé€Ÿå†™äº”ä¸ªæ¥å£demo)
    *   [ç¬¬å››å±‚ï¼šGenericAPIView+ä¹ä¸ªè§†å›¾å­ç±»å†™äº”ä¸ªæ¥å£](#ç¬¬å››å±‚genericapiviewä¹ä¸ªè§†å›¾å­ç±»å†™äº”ä¸ªæ¥å£)
        *   [ç¬¬å››å±‚å¿«é€Ÿå†™äº”ä¸ªæ¥å£demo](#ç¬¬å››å±‚å¿«é€Ÿå†™äº”ä¸ªæ¥å£demo)
    *   [ç¬¬äº”å±‚ï¼šåŸºäºViewSetå†™äº”ä¸ªæ¥å£](#ç¬¬äº”å±‚åŸºäºviewsetå†™äº”ä¸ªæ¥å£)
        *   [ç¬¬äº”å±‚åŸºäºModelViewSetè§†å›¾é›†å†™äº”ä¸ªæ¥å£demo](#ç¬¬äº”å±‚åŸºäºmodelviewsetè§†å›¾é›†å†™äº”ä¸ªæ¥å£demo)
        *   [ReadOnlyModelViewSetè§†å›¾é›†](#readonlymodelviewsetè§†å›¾é›†)
        *   [**ä¸¤ä¸ªè§†å›¾é›†æ€»ç»“**ï¼š](#ä¸¤ä¸ªè§†å›¾é›†æ€»ç»“)
        *   [å…¶ä»–è§†å›¾é›†](#å…¶ä»–è§†å›¾é›†)
            *   [**ViewSet**](#viewset)
            *   [GenericViewSet](#genericviewset)
            *   [ViewSetMixin](#viewsetmixin)
    *   [æ€»ç»“](#æ€»ç»“)
    *   [è¡¥å……](#è¡¥å……)
        *   [è§†å›¾é›†ä¸­å®šä¹‰é™„åŠ actionåŠ¨ä½œ](#è§†å›¾é›†ä¸­å®šä¹‰é™„åŠ actionåŠ¨ä½œ)
        *   [actionå±æ€§](#actionå±æ€§)

DRF è§†å›¾ç»„ä»¶
========

![ModelSerializeråºåˆ—åŒ–å™¨å®æˆ˜](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331204518477-1421764727.png)

> DRFæ¡†æ¶æä¾›äº†å¾ˆå¤šé€šç”¨çš„è§†å›¾åŸºç±»ä¸æ‰©å±•ç±»ï¼Œä¸Šç¯‡ä½¿ç”¨çš„APIViewæ˜¯æ¯”è¾ƒåBaseçš„ï¼Œè§†å›¾çš„ä½¿ç”¨æ›´åŠ ç®€åŒ–äº†ä»£ç ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸‹å…¶ä»–è§†å›¾çš„ç”¨æ³•

Django REST framwork æä¾›çš„è§†å›¾çš„ä¸»è¦ä½œç”¨ï¼š

*   æ§åˆ¶åºåˆ—åŒ–å™¨çš„æ‰§è¡Œï¼ˆæ£€éªŒã€ä¿å­˜ã€è½¬æ¢æ•°æ®ï¼‰
*   æ§åˆ¶æ•°æ®åº“æŸ¥è¯¢çš„æ‰§è¡Œ

**å…ˆæ¥çœ‹çœ‹è¿™å…¶ä¸­çš„äººæƒ…ä¸–æ•…ï¼šä¸¤ä¸ªè§†å›¾åŸºæœ¬ç±»ï¼Œäº”ä¸ªæ‰©å±•ç±»ï¼Œä¹ä¸ªè§†å›¾å­ç±»ï¼Œè§†å›¾é›†æ–¹æ³•ï¼Œè§†å›¾é›†Â·Â·**

![img](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi.loli.net%2F2021%2F07%2F13%2FQeyDj2BmxElJbg8.png&refer=http%3A%2F%2Fi.loli.net&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1651330684&t=c73a7ccb16e2aeb7d9731835bdae0fa6)

è§†å›¾ç»„ä»¶å¤§çº²
======

ä¸¤ä¸ªè§†å›¾åŸºæœ¬ç±»
-------

**å¯¼å…¥**ï¼š

    from rest_framework.views import APIView
    from rest_framework.generics import GenericAPIView
    

*   APIViewï¼šDRFæœ€é¡¶å±‚è§†å›¾ç±»
*   GenericAPIViewï¼šDRFé€šç”¨è§†å›¾ç±»

äº”ä¸ªæ‰©å±•ç±»
-----

> æ‰©å±•ç±»ä¸æ˜¯è§†å›¾ç±»ï¼Œæ²¡æœ‰é›†æˆAPIViewï¼Œéœ€è¦é…åˆGenericAPIViewä½¿ç”¨ï¼Œå› ä¸ºäº”ä¸ªæ‰©å±•ç±»çš„å®ç°éœ€è¦è°ƒç”¨GenericAPIViewæä¾›çš„åºåˆ—åŒ–å™¨ä¸æ•°æ®åº“æŸ¥è¯¢çš„æ–¹æ³•
> 
> ä¸»è¦æ˜¯ç”¨æ¥å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥

**å¯¼å…¥**

    from rest_framework.mixins import CreateModelMixin,ListModelMixin,DestroyModelMixin,RetrieveModelMixin,UpdateModelMixin
    

*   CreateModelMixin
*   ListModelMixin
*   DestroyModelMixin
*   RetrieveModelMixin
*   UpdateModelMixin

ä¹ä¸ªå­ç±»è§†å›¾
------

**å¯¼å…¥**

    from rest_framework.generics import  CreateAPIView,ListAPIView,DestroyAPIView,RetrieveAPIView,UpdateAPIView,ListCreateAPIView,RetrieveUpdateAPIView,RetrieveUpdateDestroyAPIView,RetrieveDestroyAPIView
    

> è§†å›¾å­ç±»å…¶å®å¯ä»¥ç†è§£ä¸ºGenericAPIViewé€šç”¨è§†å›¾ç±»å’ŒMixinæ‰©å±•ç±»çš„æ’åˆ—ç»„åˆç»„æˆçš„ï¼Œåº•å±‚äº‹é€šè¿‡å°è£…å’Œç»§æ‰¿æ¥å†™

*   CreateAPIView
    
        æä¾› post æ–¹æ³•
        ç»§æ‰¿è‡ªï¼š GenericAPIViewã€CreateModelMixin
        
    
*   ListAPIView
    
        æä¾› get æ–¹æ³•
        ç»§æ‰¿è‡ªï¼šGenericAPIViewã€ListModelMixin
        
    
*   DestroyAPIView
    
        æä¾› delete æ–¹æ³•
        ç»§æ‰¿è‡ªï¼šGenericAPIViewã€DestoryModelMixin
        
    
*   RetrieveAPIView
    
        æä¾› get æ–¹æ³•
        ç»§æ‰¿è‡ª: GenericAPIViewã€RetrieveModelMixin
        
    
*   UpdateAPIView
    
        æä¾› put å’Œ patch æ–¹æ³•
        ç»§æ‰¿è‡ªï¼šGenericAPIViewã€UpdateModelMixin
        
    
*   ListCreateAPIView
    
        æä¾›get å’Œ postæ–¹æ³•
        ç»§æ‰¿è‡ªï¼šListModelMixinã€CreateModelMixinã€GenericAPIView
        
    
*   RetrieveUpdateAPIView
    
        æä¾› getã€putã€patchæ–¹æ³•
        ç»§æ‰¿è‡ªï¼š GenericAPIViewã€RetrieveModelMixinã€UpdateModelMixin
        
    
*   RetrieveDestroyAPIView
    
        æä¾›ï¼šgetã€deleteæ–¹æ³•
        ç»§æ‰¿è‡ªï¼šRetrieveModelMixinã€DestroyModelMixinã€GenericAPIView
        
    
*   RetrieveUpdateDestroyAPIView
    
        æä¾› getã€putã€patchã€deleteæ–¹æ³•
        ç»§æ‰¿è‡ªï¼šGenericAPIViewã€RetrieveModelMixinã€UpdateModelMixinã€DestoryModelMixin
        
    

è§†å›¾é›†
---

**å¯¼å…¥**

    from rest_framework.viewsets import ModelViewSet,ReadOnlyModelViewSet,ViewSet,GenericViewSet,ViewSetMixin
    

### å¸¸ç”¨è§†å›¾é›†çˆ¶ç±»

*   ModelViewSetï¼šç»§æ‰¿è‡ªGenericViewSetï¼ŒåŒæ—¶åŒ…æ‹¬äº†ListModelMixinã€RetrieveModelMixinã€CreateModelMixinã€UpdateModelMixinã€DestoryModelMixinã€‚
    
*   ReadOnlyModelViewSetï¼šç»§æ‰¿è‡ªGenericViewSetï¼ŒåŒæ—¶åŒ…æ‹¬äº†ListModelMixinã€RetrieveModelMixinã€‚
    
*   ViewSetï¼šç»§æ‰¿è‡ªAPIViewä¸ViewSetMixinï¼Œä½œç”¨ä¹Ÿä¸APIViewåŸºæœ¬ç±»ä¼¼ï¼Œæä¾›äº†èº«ä»½è®¤è¯ã€æƒé™æ ¡éªŒã€æµé‡ç®¡ç†ç­‰ã€‚ViewSetä¸»è¦é€šè¿‡ç»§æ‰¿ViewSetMixinæ¥å®ç°åœ¨è°ƒç”¨as\_view()æ—¶ä¼ å…¥å­—å…¸ï¼ˆ{`'get'`:`'list'`}ï¼‰çš„æ˜ å°„å¤„ç†å·¥ä½œã€‚
    
    *   åœ¨ViewSetä¸­ï¼Œæ²¡æœ‰æä¾›ä»»ä½•åŠ¨ä½œactionæ–¹æ³•ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°actionæ–¹æ³•ã€‚
*   GenericViewSetï¼šä½¿ç”¨ViewSeté€šå¸¸å¹¶ä¸æ–¹ä¾¿ï¼Œå› ä¸º`list`ã€retrieveã€createã€updateã€destoryç­‰æ–¹æ³•éƒ½éœ€è¦è‡ªå·±ç¼–å†™ï¼Œè€Œè¿™äº›æ–¹æ³•ä¸å‰é¢è®²è¿‡çš„Mixinæ‰©å±•ç±»æä¾›çš„æ–¹æ³•åŒåï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿Mixinæ‰©å±•ç±»æ¥å¤ç”¨è¿™äº›æ–¹æ³•è€Œæ— éœ€è‡ªå·±ç¼–å†™ã€‚ä½†æ˜¯Mixinæ‰©å±•ç±»ä¾èµ–ä¸GenericAPIViewï¼Œæ‰€ä»¥è¿˜éœ€è¦ç»§æ‰¿GenericAPIViewã€‚
    
    *   GenericViewSetå°±å¸®åŠ©æˆ‘ä»¬å®Œæˆäº†è¿™æ ·çš„ç»§æ‰¿å·¥ä½œï¼Œç»§æ‰¿è‡ªGenericAPIViewä¸`ViewSetMixin,åœ¨å®ç°äº†è°ƒç”¨as_view()æ—¶ä¼ å…¥å­—å…¸ï¼ˆå¦‚`{`'get'`:`'list'`}\`ï¼‰çš„æ˜ å°„å¤„ç†å·¥ä½œçš„åŒæ—¶ï¼Œè¿˜æä¾›äº†GenericAPIViewæä¾›çš„åŸºç¡€æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥æ­é…Mixinæ‰©å±•ç±»ä½¿ç”¨ã€‚

### é­”æ³•ç±»

*   ViewSetMixinï¼šæ§åˆ¶è‡ªåŠ¨ç”Ÿæˆè·¯ç”±

ä¸€è§ˆè¡¨
---

![image](https://img2022.cnblogs.com/blog/2608072/202204/2608072-20220401230311161-1719571848.png)

DRFä¸­è§†å›¾çš„â€œä¸ƒåäºŒå˜â€
=============

ç¬¬ä¸€å±‚æ˜¯ç»§æ‰¿APIViewå†™ï¼Œç¬¬äºŒå±‚åŸºäºåŸºäºGenericAPIViewå†™ï¼Œç¬¬ä¸‰å±‚åŸºäºGenericAPIView+äº”ä¸ªæ‰©å±•ç±»å†™ï¼Œç¬¬å››å±‚é€šè¿‡ä¹ä¸ªè§†å›¾å­ç±»æ¥å†™ï¼Œç¬¬äº”å±‚æ˜¯é€šè¿‡ViewSetå†™

psï¼šç¬¬å‡ å±‚æ˜¯æˆ‘æ„æ·«å‡ºæ¥çš„è¯ä¸è¦ä»‹æ„~ï¼Œä¸€å±‚æ›´æ¯”ä¸€å±‚ç‰›ï¼Œæ¬²ç»ƒæ­¤åŠŸå¿…å…ˆè‡ªå®«ï¼ï¼ï¼

ç¬¬ä¸€å±‚ï¼šåŸºäºAPIviewçš„äº”ä¸ªæ¥å£
------------------

    class BookView(APIView):
        def get(self, requets):
            # åºåˆ—åŒ–
            book_list = models.Book.objects.all()
            # åºåˆ—åŒ–å¤šæ¡æ•°æ®many=True
            ser = serializer.BookSerializer(instance=book_list, many=True)
            return Response(ser.data)
    
        def post(self, request):
            # è·å–ååºåˆ—åŒ–æ•°æ®
            ser = serializer.BookSerializer(data=request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡å­˜å…¥æ•°æ®åº“ï¼Œä¸éœ€è¦é‡å†™createæ–¹æ³•äº†
                ser.save()
                return Response({'code': 100, 'msg': 'æ–°å¢æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒå¤±è´¥
            return Response({'code': 101, 'msg': 'æ ¡éªŒæœªé€šè¿‡', 'error': ser.errors})
    
    
    class BookViewDetail(APIView):
        def get(self, request, pk):
            book = models.Book.objects.filter(pk=pk).first()
            ser = serializer.BookSerializer(instance=book)
            return Response(ser.data)
    
        def put(self, request, pk):
            book = models.Book.objects.filter(pk=pk).first()
            # ä¿®æ”¹ï¼Œinstanceå’Œdataéƒ½è¦ä¼ 
            ser = serializer.BookSerializer(instance=book, data=request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡ä¿®æ”¹ï¼Œä¸éœ€è¦é‡å†™update
                ser.save()
                return Response({'code:': 100, 'msg': 'ä¿®æ”¹æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒä¸é€šè¿‡
            return Response({'code:': 102, 'msg': 'æ ¡éªŒæœªé€šè¿‡ï¼Œä¿®æ”¹å¤±è´¥', 'error': ser.errors})
    
        def delete(self, request, pk):
            models.Book.objects.filter(pk=pk).delete()
            return Response({'code': 100, 'msg': 'åˆ é™¤æˆåŠŸ'})
    

### ç¬¬ä¸€å±‚äº”ä¸ªæ¥å£demo

[ModelSerializeråºåˆ—åŒ–å™¨å®æˆ˜ - HammerZe - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/48xz/p/16084008.html)

ç¬¬äºŒå±‚ï¼šåŸºäºGenericAPIViewçš„äº”ä¸ªæ¥å£
-------------------------

### å¸¸ç”¨ç±»å±æ€§ï¼š

    -GenericAPIView   ç»§æ‰¿äº†APIViewï¼Œå°è£…äº†ä¸€äº›å±æ€§å’Œæ–¹æ³•ï¼Œè·Ÿæ•°æ®åº“æ‰“äº¤é“
      	-queryset = None # æŒ‡å®šåºåˆ—åŒ–é›†
        -serializer_class = None  # æŒ‡å®šåºåˆ—åŒ–ç±»
        -lookup_field = 'pk'  # æŸ¥è¯¢å•æ¡ï¼Œåˆ†ç»„åˆ†å‡ºæ¥çš„å‚æ•°ï¼Œè½¬æ¢å™¨å¯¹è±¡å‚æ•°çš„åå­—
        -filter_backends   # è¿‡æ»¤æ’åºåŠŸèƒ½ä¼šç”¨å®ƒ
        -pagination_class  # åˆ†é¡µåŠŸèƒ½
        
        -get_queryset()  # è·å–è¦åºåˆ—åŒ–çš„æ•°æ®,åæœŸå¯èƒ½ä¼šé‡å†™
        -get_object()    # é€šè¿‡lookup_fieldæŸ¥è¯¢çš„
        -get_serializer()  # ä½¿ç”¨å®ƒåºåˆ—åŒ–
        -get_serializer_class() # è¿”å›åºåˆ—åŒ–ç±» ï¼ŒåæœŸå¯èƒ½é‡å†™
        
        
        
    demoï¼š
    # æŒ‡å®šåºåˆ—åŒ–é›†
    queryset = models.Book.objects.all()
    # æŒ‡å®šåºåˆ—åŒ–ç±»
    serializer_class = serializer.BookSerializer
    

### ç¬¬äºŒå±‚äº”ä¸ªæ¥å£demo

    from rest_framework.response import Response
    
    
    from app01 import models
    from app01 import serializer
    from rest_framework.generics import GenericAPIView
    # ä¹¦è§†å›¾ç±»
    class BookView(GenericAPIView):
        # æŒ‡å®šåºåˆ—åŒ–é›†
        queryset = models.Book.objects.all()
        # æŒ‡å®šåºåˆ—åŒ–ç±»
        serializer_class = serializer.BookSerializer
        def get(self, requets):
            # obj = self.queryset()
            obj = self.get_queryset() # ç­‰åŒäºä¸Šé¢
            # ser = self.get_serializer_class()(instance=obj,many=True)
            ser = self.get_serializer(instance=obj,many=True) # ç­‰åŒäºä¸Šé¢
            return Response(ser.data)
    
        def post(self, request):
            # è·å–ååºåˆ—åŒ–æ•°æ®
            # ser = serializer.BookSerializer(data=request.data)
            ser = self.get_serializer(data = request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡å­˜å…¥æ•°æ®åº“ï¼Œä¸éœ€è¦é‡å†™createæ–¹æ³•äº†
                ser.save()
                return Response({'code': 100, 'msg': 'æ–°å¢æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒå¤±è´¥
            return Response({'code': 101, 'msg': 'æ ¡éªŒæœªé€šè¿‡', 'error': ser.errors})
    
    
    class BookViewDetail(GenericAPIView):
        # æŒ‡å®šåºåˆ—åŒ–é›†
        queryset = models.Book.objects.all()
        # æŒ‡å®šåºåˆ—åŒ–ç±»
        serializer_class = serializer.BookSerializer
        def get(self, request, pk):
            # book = models.Book.objects.filter(pk=pk).first()
            book = self.get_object() # æ ¹æ®pkæ‹¿åˆ°å•ä¸ªå¯¹è±¡
            # ser = serializer.BookSerializer(instance=book)
            ser = self.get_serializer(instance=book)
            return Response(ser.data)
    
        def put(self, request, pk):
            # book = models.Book.objects.filter(pk=pk).first()
            book = self.get_object()
            # ä¿®æ”¹ï¼Œinstanceå’Œdataéƒ½è¦ä¼ 
            # ser = serializer.BookSerializer(instance=book, data=request.data)
            ser = self.get_serializer(instance=book,data=request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡ä¿®æ”¹ï¼Œä¸éœ€è¦é‡å†™update
                ser.save()
                return Response({'code:': 100, 'msg': 'ä¿®æ”¹æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒä¸é€šè¿‡
            return Response({'code:': 102, 'msg': 'æ ¡éªŒæœªé€šè¿‡ï¼Œä¿®æ”¹å¤±è´¥', 'error': ser.errors})
    
        def delete(self, request, pk):
            # models.Book.objects.filter(pk=pk).delete()
            self.get_object().delete()
            return Response({'code': 100, 'msg': 'åˆ é™¤æˆåŠŸ'})
    

**è·¯ç”±**

    path('books/', views.BookView.as_view()),
    path('books/<int:pk>', views.BookViewDetail.as_view())
    

**æ€»ç»“**ï¼šåˆ°ç¬¬äºŒå±‚åªéœ€ä¿®æ”¹`queryset`å’Œ`serializer_class`ç±»å±æ€§å³å¯ï¼Œå…¶ä½™éƒ½ä¸éœ€è¦ä¿®æ”¹

**æ³¨æ„**ï¼šè™½ç„¶pkæ²¡æœ‰åœ¨ormè¯­å¥ä¸­è¿‡æ»¤ä½¿ç”¨ï¼Œä½†æ˜¯è·¯ç”±åˆ†ç»„è¦ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½åˆ ï¼Œæˆ–è€…å†™æˆ`*args **kwargs`æ¥æ”¶å¤šä½™çš„å‚æ•°ï¼Œä¸”è·¯ç”±è½¬æ¢å™¨å¿…é¡»å†™æˆ`pk`

    # æºç 
    lookup_field = 'pk'
    lookup_url_kwarg = None
    

`get_queryset()`æ–¹æ³•å¯ä»¥é‡å†™ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªè§†å›¾ç±»å†…æ“ä½œå¦å¤–è¡¨æ¨¡å‹ï¼Œæ¥æŒ‡å®šåºåˆ—åŒ–çš„æ•°æ®

    class BookViewDetail(GenericAPIView):
        queryset = models.Book.objects.all()
        Â·Â·Â·
        '''
        æŒ‡å®šåºåˆ—åŒ–æ•°æ®çš„æ ¼å¼ï¼š
        self.queryset()
        self.get_queryset() # ç­‰åŒäºä¸Šé¢
        queryset = models.Book.objects.all()
        '''
    	# å¯ä»¥é‡å†™get_querysetæ–¹æ³•åœ¨bookè§†å›¾ç±»é‡Œæ“ä½œä½œè€…æ¨¡å‹
        def get_queryset(self,request):
            if self.request.path == '/user'
            return Author.objects.all()
        Â·Â·Â·
        # è¿™æ ·åºåˆ—åŒ–çš„æ•°æ®å°±ä¸ä¸€æ ·äº†ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶åºåˆ—åŒ–ä¸åŒçš„æ•°æ®
        
        '''å½“ç„¶è¿˜å¯ä»¥é€šè¿‡é‡å†™get_serializer_classæ¥è¿”å›å…¶ä»–åºåˆ—åŒ–å™¨ç±»'''
    

ç¬¬ä¸‰å±‚ï¼šåŸºäºGenericAPIView+äº”ä¸ªè§†å›¾æ‰©å±•ç±»å†™
-----------------------------

äº”ä¸ªè§†å›¾æ‰©å±•ç±»ï¼š`from rest_framework.mixins import CreateModelMixin,ListModelMixin,DestroyModelMixin,RetrieveModelMixin,UpdateModelMixin`

> é€šè¿‡GenericAPIView+è§†å›¾æ‰©å±•ç±»æ¥ä½¿å¾—ä»£ç æ›´ç®€å•ï¼Œä¸€ä¸ªæ¥å£å¯¹åº”ä¸€ä¸ªæ‰©å±•ç±»ï¼Œæ³¨æ„æ‰©å±•ç±»ä¸æ˜¯è§†å›¾ç±»

*   ListModelMixinï¼šè·å–æ‰€æœ‰APIï¼Œå¯¹åº”list()æ–¹æ³•
*   CreateModelMixinï¼šæ–°å¢ä¸€æ¡APIï¼Œå¯¹åº”create()æ–¹æ³•
*   UpdateModelMixinï¼šä¿®æ”¹ä¸€æ¡APIï¼Œå¯¹åº”update()æ–¹æ³•
*   RetrieveModelMixinï¼šè·å–ä¸€æ¡APIï¼Œå¯¹åº”retrieve()æ–¹æ³•
*   DestroyModelMixinï¼šåˆ é™¤ä¸€æ¡APIï¼Œå¯¹åº”destroy()æ–¹æ³•

**æ³¨æ„**ï¼šCreateModelMixinæ‰©å±•ç±»æä¾›äº†æ›´é«˜çº§çš„æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡é‡å†™æ¥æ ¡éªŒæ•°æ®å­˜å…¥

        def perform_create(self, serializer):
            serializer.save()
    

### ç¬¬ä¸‰å±‚äº”ä¸ªæ¥å£demo

    from app01 import models
    from app01 import serializer
    from rest_framework.generics import GenericAPIView
    from rest_framework.mixins import CreateModelMixin,ListModelMixin,DestroyModelMixin,RetrieveModelMixin,UpdateModelMixin
    
    # è·å–æ‰€æœ‰å’Œæ–°å¢API
    class BookView(ListModelMixin,CreateModelMixin,GenericAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
        def get(self, request):
           return super().list(request)
    
        def post(self, request):
            return super().create(request)
    
    # è·å–åˆ é™¤ä¿®æ”¹å•ä¸ªAPI
    class BookViewDetail(UpdateModelMixin,RetrieveModelMixin,DestroyModelMixin,GenericAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
        def get(self, request, *args,**kwargs):
            return super().retrieve(request, *args,**kwargs)
    
        def put(self, request, *args,**kwargs):
            return super().update(request, *args,**kwargs)
    
        def delete(self, request, *args,**kwargs):
            return super().destroy(request, *args,**kwargs)
    

**æ€»ç»“**

é€šè¿‡è¿›ä¸€æ¬¡å°è£…+ç»§æ‰¿ä»£ç ä¹Ÿå˜å¾—è¶Šæ¥è¶Šå°‘äº†

### GenericAPIViewé€Ÿå†™äº”ä¸ªæ¥å£demo

**æ¨¡å‹**

    from django.db import models
    
    
    # Create your models here.
    
    # build four model tables
    
    class Book(models.Model):
        name = models.CharField(max_length=32)
        price = models.DecimalField(decimal_places=2, max_digits=5)
        publish = models.ForeignKey(to='Publish', on_delete=models.CASCADE)
        authors = models.ManyToManyField(to='Author')
        def __str__(self):
            return self.name
    
        # è‡ªå®šåˆ¶å­—æ®µ
        @property
        def publish_detail(self):
            return {'name': self.publish.name, 'addr': self.publish.city}
    
    
        @property
        def author_list(self):
            l = []
            print(self.authors.all()) # <QuerySet [<Author: Author object (1)>, <Author: Author object (2)>]>
    
            for author in self.authors.all():
                print(author.author_detail) # AuthorDetail object (1)
                l.append({'name': author.name, 'age': author.age, 'addr': author.author_detail.addr})
            return l
    
    
    class Author(models.Model):
        name = models.CharField(max_length=32)
        age = models.IntegerField()
        author_detail = models.OneToOneField(to='AuthorDetail', on_delete=models.CASCADE)
    
        def __str__(self):
            return self.name
    
        @property
        def authordetail_info(self):
            return {'phone':self.author_detail.telephone,'addr':self.author_detail.addr}
    
    
    class AuthorDetail(models.Model):
        telephone = models.BigIntegerField()
        addr = models.CharField(max_length=64)
    
    
    class Publish(models.Model):
        name = models.CharField(max_length=32)
        city = models.CharField(max_length=32)
        email = models.EmailField()
    
    

**åºåˆ—åŒ–å™¨**

    from django.db import models
    
    
    # Create your models here.
    
    # build four model tables
    
    class Book(models.Model):
        name = models.CharField(max_length=32)
        price = models.DecimalField(decimal_places=2, max_digits=5)
        publish = models.ForeignKey(to='Publish', on_delete=models.CASCADE)
        authors = models.ManyToManyField(to='Author')
        def __str__(self):
            return self.name
    
        # è‡ªå®šåˆ¶å­—æ®µ
        @property
        def publish_detail(self):
            return {'name': self.publish.name, 'addr': self.publish.city}
    
    
        @property
        def author_list(self):
            l = []
            print(self.authors.all()) # <QuerySet [<Author: Author object (1)>, <Author: Author object (2)>]>
    
            for author in self.authors.all():
                print(author.author_detail) # AuthorDetail object (1)
                l.append({'name': author.name, 'age': author.age, 'addr': author.author_detail.addr})
            return l
    
    
    class Author(models.Model):
        name = models.CharField(max_length=32)
        age = models.IntegerField()
        author_detail = models.OneToOneField(to='AuthorDetail', on_delete=models.CASCADE)
    
        def __str__(self):
            return self.name
    
        @property
        def authordetail_info(self):
            return {'phone':self.author_detail.telephone,'addr':self.author_detail.addr}
    
    
    class AuthorDetail(models.Model):
        telephone = models.BigIntegerField()
        addr = models.CharField(max_length=64)
    
    
    class Publish(models.Model):
        name = models.CharField(max_length=32)
        city = models.CharField(max_length=32)
        email = models.EmailField()
    
    

**è§†å›¾**

    from rest_framework.generics import GenericAPIView
    from rest_framework.mixins import ListModelMixin, CreateModelMixin, DestroyModelMixin, RetrieveModelMixin, \
        UpdateModelMixin
    
    from app01 import models
    from app01 import serializer
    
    
    # ä¹¦è§†å›¾ç±»
    class BookView(ListModelMixin, CreateModelMixin, GenericAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    
        def get(self, request):
            return super().list(request)
    
        def post(self, request):
            return super().create(request)
    
    
    class BookViewDetail(RetrieveModelMixin, DestroyModelMixin, UpdateModelMixin, GenericAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    
        def get(self, request, *args, **kwargs):
            return super().retrieve(request, *args, **kwargs)
    
        def put(self, request, *args, **kwargs):
            return super().update(request, *args, **kwargs)
    
        def delete(self, request, *args, **kwargs):
            return super().destroy(request, *args, **kwargs)
    
    
    # ä½œè€…
    class AuthorView(ListModelMixin, CreateModelMixin, GenericAPIView):
        queryset = models.Author.objects.all()
        serializer_class = serializer.AuthorSerializer
    
        def get(self, request):
            return super().list(request)
    
        def post(self, request):
            return super().create(request)
    
    
    class AuthorViewDetail(RetrieveModelMixin, DestroyModelMixin, UpdateModelMixin, GenericAPIView):
        queryset = models.Author.objects.all()
        serializer_class = serializer.AuthorSerializer
    
        def get(self, request, *args, **kwargs):
            return super().retrieve(request, *args, **kwargs)
    
        def put(self, request, *args, **kwargs):
            return super().update(request, *args, **kwargs)
    
        def delete(self, request, *args, **kwargs):
            return super().destroy(request, *args, **kwargs)
    
    
    # ä½œè€…è¯¦æƒ…
    
    class AuthorDetailView(ListModelMixin, CreateModelMixin, GenericAPIView):
        queryset = models.AuthorDetail.objects.all()
        serializer_class = serializer.AuthorDetailSerializer
    
        def get(self, request):
            return super().list(request)
    
        def post(self, request):
            return super().create(request)
    
    
    class OneAuthorViewDetail(RetrieveModelMixin, DestroyModelMixin, UpdateModelMixin, GenericAPIView):
        queryset = models.AuthorDetail.objects.all()
        serializer_class = serializer.AuthorDetailSerializer
    
        def get(self, request, *args, **kwargs):
            return super().retrieve(request, *args, **kwargs)
    
        def put(self, request, *args, **kwargs):
            return super().update(request, *args, **kwargs)
    
        def delete(self, request, *args, **kwargs):
            return super().destroy(request, *args, **kwargs)
    
    
    # å‡ºç‰ˆç¤¾
    class PublishView(ListModelMixin, CreateModelMixin, GenericAPIView):
        queryset = models.Publish.objects.all()
        serializer_class = serializer.PublishSerializer
    
        def get(self, request):
            return super().list(request)
    
        def post(self, request):
            return super().create(request)
    
    
    class PublishViewDetail(RetrieveModelMixin, DestroyModelMixin, UpdateModelMixin, GenericAPIView):
        queryset = models.Publish.objects.all()
        serializer_class = serializer.PublishSerializer
    
        def get(self, request, *args, **kwargs):
            return super().retrieve(request, *args, **kwargs)
    
        def put(self, request, *args, **kwargs):
            return super().update(request, *args, **kwargs)
    
        def delete(self, request, *args, **kwargs):
            return super().destroy(request, *args, **kwargs)
    
    

**è·¯ç”±**

    from django.contrib import admin
    from django.urls import path
    
    from app01 import views
    
    urlpatterns = [
        path('admin/', admin.site.urls),
        # ä¹¦
        path('books/', views.BookView.as_view()),
        path('books/<int:pk>', views.BookViewDetail.as_view()),
    
        # ä½œè€…
        path('authors/', views.AuthorView.as_view()),
        path('authors/<int:pk>', views.AuthorViewDetail.as_view()),
    
        # ä½œè€…è¯¦æƒ…
        path('authorsdetail/', views.AuthorDetailView.as_view()),
        path('authorsdetail/<int:pk>', views.OneAuthorViewDetail.as_view()),
    
        # å‡ºç‰ˆç¤¾
        path('publish/', views.PublishView.as_view()),
        path('publish/<int:pk>', views.PublishViewDetail.as_view()),
    ]
    
    

**Postmanä»¥åŠæµ‹å®Œï¼Œè¯·æ”¾å¿ƒä½¿ç”¨~**

ç¬¬å››å±‚ï¼šGenericAPIView+ä¹ä¸ªè§†å›¾å­ç±»å†™äº”ä¸ªæ¥å£
------------------------------

**å¯¼å…¥è§†å›¾å­ç±»**ï¼š`from rest_framework.generics import CreateAPIView,ListAPIView,DestroyAPIView,RetrieveAPIView,UpdateAPIView,ListCreateAPIView,RetrieveUpdateAPIView,RetrieveUpdateDestroyAPIView,RetrieveDestroyAPIView`

> ä½¿ç”¨å“ªä¸ªç»§æ‰¿å“ªä¸ªå°±å¯ä»¥äº†ï¼Œå…·ä½“å¯ä»¥çœ‹ç»§æ‰¿çš„çˆ¶ç±»é‡Œæœ‰ä»€ä¹ˆæ–¹æ³•ä¸éœ€è¦åˆ»æ„å»è®°

    from rest_framework.generics import  CreateAPIView,ListAPIView,DestroyAPIView,RetrieveAPIView,UpdateAPIView,ListCreateAPIView,RetrieveUpdateAPIView,RetrieveUpdateDestroyAPIView,RetrieveDestroyAPIView
    
    # 1ã€æŸ¥è¯¢æ‰€æœ‰,æ–°å¢API
    class BookView(ListCreateAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    # 2ã€æ–°å¢æ¥å£
    class BookView(CreateAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    # 3ã€æŸ¥è¯¢æ¥å£
    class BookView(ListAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    
    # 4ã€æŸ¥è¯¢å•ä¸ªï¼Œä¿®æ”¹ä¸€ä¸ªï¼Œåˆ é™¤ä¸€ä¸ªæ¥å£
    class BookViewDetail(RetrieveUpdateDestroyAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    
    # 5ã€æŸ¥è¯¢å•ä¸ªæ¥å£
    class BookViewDetail(RetrieveAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    
    # 6ã€ä¿®æ”¹å•ä¸ªæ¥å£
    class BookViewDetail(UpdateAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    
    # 7ã€åˆ é™¤å•ä¸ªæ¥å£
    class BookViewDetail(DestroyAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    
    # 8ã€æŸ¥è¯¢å•ä¸ªã€ä¿®æ”¹æ¥å£
    class BookViewDetail(RetrieveUpdateAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    
    
    # 9ã€æŸ¥è¯¢å•ä¸ªã€åˆ é™¤æ¥å£
    class BookViewDetail(RetrieveDestroyAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    
    '''ä¸Šè¿°å…±ä¹ä¸ªè§†å›¾å­ç±»ï¼Œä¹ä¹å½’ä¸€å‰‘è¯€~'''
    
    # æ›´æ–°å’Œåˆ é™¤æ¥å£è‡ªå·±æ•´åˆ
    class BookViewDetail(UpdateAPIView,DestroyAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    

### ç¬¬å››å±‚å¿«é€Ÿå†™äº”ä¸ªæ¥å£demo

    from rest_framework.generics import ListCreateAPIView, RetrieveUpdateDestroyAPIView
    
    from app01 import models
    from app01 import serializer
    
    class BookView(ListCreateAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    
    class BookViewDetail(RetrieveUpdateDestroyAPIView):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    '''å…¶ä½™çš„å’Œç¬¬ä¸‰å±‚ä¸€æ ·'''
    

ç¬¬äº”å±‚ï¼šåŸºäºViewSetå†™äº”ä¸ªæ¥å£
------------------

**è§†å›¾é›†å¯¼å…¥**ï¼š`from rest_framework.viewsets import ModelViewSet,ReadOnlyModelViewSet,ViewSet,GenericViewSet,ViewSetMixin`

**è·¯ç”±å¯¼å…¥**ï¼š`from rest_framework.routers import SimpleRouter,DefaultRouter`

**åŸºäºViewSetè§†å›¾é›†å†™ï¼Œéœ€è¦æˆ‘ä»¬é…ç½®è·¯ç”±**

*   æ–¹æ³•ä¸€
    
        from django.urls import path, include
        from rest_framework.routers import SimpleRouter
        from app01 import views
        
        router = SimpleRouter()
        router.register('books', views.BookView, 'books')
        urlpatterns = [
            ...
        ]
        urlpatterns += router.urls
        '''
        register(self, prefix, viewset, basename=None)
        prefixï¼šè·¯ç”±urlå‰ç¼€
        viewsetï¼šå¤„ç†è¯·æ±‚çš„viewsetç±»
        basenameï¼šè·¯ç”±åç§°çš„å‰ç¼€ï¼Œä¸€èˆ¬å’Œprefixå†™æˆä¸€æ ·å°±è¡Œ
        '''
        # ç­‰åŒäº
        path('books/'),include(router.urls)
        path('books/<int:pk>'),include(router.urls)
        
    
*   æ–¹æ³•äºŒ
    
        router = SimpleRouter()
        router.register('books', views.BookView, 'books')
        
        urlpatterns = [
            ...
            url(r'^', include(router.urls))
        ]
        
        
        # ç”Ÿæˆä¸¤ç§è·¯ç”±
        path('/api/v1'),include(router.urls)
        # [<URLPattern '^books/$' [name='books-list']>, <URLPattern '^books/(?P<pk>[^/.]+)/$' [name='books-detail']>]
        # ç­‰åŒäºè‡ªå·±é…çš„
        path('/api/v1/books/'),include(router.urls)
        path('/api/v1/books/<int:pk>'),include(router.urls)
        
    
    **å¼‚åŒ**ï¼š
    
    *   åŒï¼šæ–¹æ³•ä¸€å’Œæ–¹æ³•äºŒéƒ½å¯ä»¥è‡ªåŠ¨ç”Ÿæˆè·¯ç”±ï¼Œä»£æ›¿äº†ä¸‹é¢çš„è·¯ç”±
        
            path('books/', views.BookView.as_view()),
            path('books/<int:pk>', views.BookViewDetail.as_view()),
            
        
    *   å¼‚ï¼šæ–¹æ³•äºŒå¯ä»¥æ‹¼æ¥è·¯å¾„ï¼Œå¦‚æœä¸æ‹¼æ¥æ˜¯å’Œæ–¹æ³•ä¸€ä¸€æ ·çš„
        

**ä¸¤ç§ä¸åŒçš„è·¯ç”±**

![image](https://img2022.cnblogs.com/blog/2608072/202204/2608072-20220401230414064-269031554.png)

![image](https://img2022.cnblogs.com/blog/2608072/202204/2608072-20220401230419579-128662386.png)

### ç¬¬äº”å±‚åŸºäºModelViewSetè§†å›¾é›†å†™äº”ä¸ªæ¥å£demo

**views.py**

    from rest_framework.viewsets import ModelViewSet,ReadOnlyModelViewSet,ViewSet,GenericViewSet,ViewSetMixin
    class BookView(ModelViewSet):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    

**urls.py**

    from django.contrib import admin
    from django.urls import path, include
    from rest_framework.routers import SimpleRouter
    
    from app01 import views
    
    router = SimpleRouter()
    router.register('books', views.BookView, 'books')
    
    urlpatterns = [
        path('admin/', admin.site.urls),
        path('api/v1/',include(router.urls)),
    ]
    

psï¼šå‰©ä¸‹çš„éƒ½ä¸€æ ·~

### ReadOnlyModelViewSetè§†å›¾é›†

**ç»§æ‰¿è¯¥ReadOnlyModelViewSetè§†å›¾é›†çš„ä½œç”¨æ˜¯åªè¯»ï¼ŒåªåšæŸ¥è¯¢ï¼Œä¿®æ”¹åˆ é™¤ç­‰æ“ä½œä¸å…è®¸**

    from rest_framework.viewsets import ModelViewSet,ReadOnlyModelViewSet,ViewSet,GenericViewSet,ViewSetMixin
    class BookView(ReadOnlyModelViewSet):
        queryset = models.Book.objects.all()
        serializer_class = serializer.BookSerializer
    

![image](https://img2022.cnblogs.com/blog/2608072/202204/2608072-20220401230449672-861222647.png)

### **ä¸¤ä¸ªè§†å›¾é›†æ€»ç»“**ï¼š

*   ModelViewSetå¯ä»¥å†™äº”ä¸ªæ¥å£ï¼Œè€ŒReadOnlyModelViewSetåªèƒ½å†™ä¸¤ä¸ªæ¥å£

**æœ¬è´¨**

*   ModelViewSetç»§æ‰¿äº†äº”ä¸ªè§†å›¾æ‰©å±•ç±»+GenericViewSetï¼ŒGenericViewSetç»§æ‰¿äº†ViewSetMixin+GenericAPIView
    
    PSï¼šViewSetMixinæ§åˆ¶äº†è·¯ç”±å†™æ³•
    
*   ReadOnlyModelViewSetç»§æ‰¿äº†RetrieveModelMixin+ListModelMixin+GenericViewSet
    

### å…¶ä»–è§†å›¾é›†

#### **ViewSet**

ViewSet = ViewSetMixin+APIView

    
    class ViewSet(ViewSetMixin, views.APIView):
        """
        The base ViewSet class does not provide any actions by default.
        """
        pass
    

#### GenericViewSet

GenericViewSet = ViewSetMixin+GenericAPIView

    class GenericViewSet(ViewSetMixin, generics.GenericAPIView):
        """
        The GenericViewSet class does not provide any actions by default,
        but does include the base set of generic view behavior, such as
        the `get_object` and `get_queryset` methods.
        """
        pass
    

#### ViewSetMixin

é­”æœ¯è§†å›¾ç±»ï¼Œæ§åˆ¶è‡ªåŠ¨ç”Ÿæˆè·¯ç”±ï¼Œå¯ä»¥é€šè¿‡ç»„åˆç»§æ‰¿ï¼Œä»¥å‰çš„å†™æ³•å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœè¦è‡ªåŠ¨ç”Ÿæˆè·¯ç”±å¿…é¡»å¾—ç»§æ‰¿ViewSetMixinåŠå…¶å­ç±»ï¼›æˆ–è€…é€‰æ‹©ç»§æ‰¿ViewSetã€GenericViewSet

    class ViewSetMixin:
        """
        This is the magic.
    
        Overrides `.as_view()` so that it takes an `actions` keyword that performs
        the binding of HTTP methods to actions on the Resource.
    
        For example, to create a concrete view binding the 'GET' and 'POST' methods
        to the 'list' and 'create' actions...
    
        view = MyViewSet.as_view({'get': 'list', 'post': 'create'})
        """
    è¿™å°±æ˜¯é­”æ³•ã€‚  
     
    é‡å†™' .as_view() 'ï¼Œä»¥ä¾¿å®ƒæ¥å—ä¸€ä¸ª' actions 'å…³é”®å­—æ‰§è¡Œ  
    å°†HTTPæ–¹æ³•ç»‘å®šåˆ°èµ„æºä¸Šçš„åŠ¨ä½œã€‚  
     
    ä¾‹å¦‚ï¼Œåˆ›å»ºç»‘å®š'GET'å’Œ'POST'æ–¹æ³•çš„å…·ä½“è§†å›¾  
    åˆ°â€œåˆ—è¡¨â€å’Œâ€œåˆ›å»ºâ€åŠ¨ä½œâ€¦  
     
    = MyViewSetè§†å›¾ã€‚ As_view ({'get': 'list'ï¼Œ 'post': 'create'})  
    

æ€»ç»“
--

*   ç¬¬ä¸€å±‚ï¼šåŸºäºAPIViewå†™è§†å›¾ï¼Œgetã€postã€putã€deleteéƒ½éœ€è¦è‡ªå·±å†™ï¼Œåºåˆ—åŒ–çš„æ•°æ®å’Œåºåˆ—åŒ–ç±»éœ€è¦è·å–åæŒ‡å®š
    
        class BookView(APIView):
            def get(self, requets):
                book_list = models.Book.objects.all()
                ser = serializer.BookSerializer(instance=book_list, many=True)
                return Response(ser.data)
        
    
*   ç¬¬äºŒå±‚ï¼šåŸºäºGenericAPIViewå†™è§†å›¾ï¼Œä¼˜åŒ–äº†è§†å›¾ç±»å†…åºåˆ—åŒ–æ•°æ®å’Œåºåˆ—åŒ–ç±»çš„ä»£ç å†—ä½™é—®é¢˜ï¼Œé€šè¿‡`queryset`å’Œ`serializer_class`æŒ‡å®šåºåˆ—åŒ–é›†å’Œåºåˆ—åŒ–å™¨å³å¯ï¼Œä¸€ä¸ªè§†å›¾ç±»å†…å†™ä¸€æ¬¡å³å¯ï¼Œæœ€åé€šè¿‡`get_queryset`å’Œ`get_serializer`æ–¹æ³•å¤„ç†
    
        class BookView(GenericAPIView):
            queryset = models.Book.objects.all()
            serializer_class = serializer.BookSerializer
            def get(self, requets):
                obj = self.get_queryset() 
                ser = self.get_serializer(instance=obj,many=True) 
                return Response(ser.data)
        
    
*   ç¬¬ä¸‰å±‚ï¼šåŸºäºGenericAPIView+5ä¸ªè§†å›¾æ‰©å±•ç±»å†™è§†å›¾ï¼Œæ¯ä¸ªæ‰©å±•ç±»å¯¹åº”ä¸€ä¸ªæ¥å£ï¼Œæ›´åŠ ç»†åŒ–ï¼Œé€šè¿‡ç»§æ‰¿çˆ¶ç±»(æ‰©å±•ç±»)å‡å°‘äº†ä»£ç çš„å†—ä½™
    
        class BookView(ListModelMixin,CreateModelMixin,GenericAPIView):
            queryset = models.Book.objects.all()
            serializer_class = serializer.BookSerializer
            def get(self, request):
               return super().list(request)
        
    
*   ç¬¬å››å±‚ï¼ŒåŸºäºä¹ä¸ªè§†å›¾å­ç±»å†™ï¼Œè§†å›¾å­ç±»å°†æ‰©å±•ç±»å’ŒGenericAPIViewå°è£…åˆ°ä¸€å—ï¼Œä½¿å¾—æˆ‘ä»¬è¦å†™çš„ä»£ç æ›´å°‘äº†ï¼Œæ€»ä¹‹å°±æ˜¯ç‰›é€¼~
    
        class BookView(ListCreateAPIView):
            queryset = models.Book.objects.all()
            serializer_class = serializer.BookSerializer
        
    
*   ç¬¬äº”å±‚ï¼ŒåŸºäºViewSetå†™è§†å›¾ï¼Œè¿™æ ·ä»¥æ¥5ä¸ªæ¥å£å°±éƒ½åœ¨ä¸€ä¸ªè§†å›¾ç±»å†…ï¼Œä»£ç æ›´å°‘äº†ï¼Œä½†æ˜¯å¯æ‰©å±•æ€§ä½äº†ï¼Œè·¯ç”±ä¹Ÿæ˜¯é—®é¢˜ï¼Œgetæ‰€æœ‰å’Œgetä¸€æ¡è·¯ç”±å†²çªéœ€è¦ä¿®æ”¹
    
        class BookView(ModelViewSet):
            queryset = models.Book.objects.all()
            serializer_class = serializer.BookSerializer
        '''è·¯ç”±'''
        router = SimpleRouter()
        router.register('books', views.BookView, 'books')
        
        urlpatterns = [
            path('admin/', admin.site.urls),
            path('api/v1/',include(router.urls)),
        ]
        
    

è¡¥å……
--

### è§†å›¾é›†ä¸­å®šä¹‰é™„åŠ actionåŠ¨ä½œ

åœ¨è§†å›¾é›†ä¸­ï¼Œé™¤äº†ä¸Šè¿°é»˜è®¤çš„æ–¹æ³•åŠ¨ä½œå¤–ï¼Œè¿˜å¯ä»¥æ·»åŠ è‡ªå®šä¹‰åŠ¨ä½œã€‚

ä¸¾ä¾‹ï¼š

    from rest_framework.viewsets import ModelViewSet,ReadOnlyModelViewSet
    class StudentModelViewSet(ModelViewSet):
        queryset = Student.objects.all()
        serializer_class = StudentModelSerializer
    
        def login(self,request):
            """å­¦ç”Ÿç™»å½•åŠŸèƒ½"""
            return Response({"message":"ç™»å½•æˆåŠŸ"})
    

urlçš„å®šä¹‰

    urlpatterns = [
        path("students8/", views.StudentModelViewSet.as_view({"get": "list", "post": "create"})),
        re_path("students8/(?P<pk>\d+)/",
                views.StudentModelViewSet.as_view({"get": "retrieve", "put": "update", "delete": "destroy"})),
    
        path("stu/login/",views.StudentModelViewSet.as_view({"get":"login"}))
    
    ]
    

### actionå±æ€§

åœ¨è§†å›¾é›†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡actionå¯¹è±¡å±æ€§æ¥è·å–å½“å‰è¯·æ±‚è§†å›¾é›†æ—¶çš„actionåŠ¨ä½œæ˜¯å“ªä¸ªã€‚

ä¾‹å¦‚ï¼š

    from rest_framework.viewsets import ModelViewSet
    from students.models import Student
    from .serializers import StudentModelSerializer
    from rest_framework.response import Response
    class StudentModelViewSet(ModelViewSet):
        queryset = Student.objects.all()
        serializer_class = StudentModelSerializer
    
        def get_new_5(self,request):
            """è·å–æœ€è¿‘æ·»åŠ çš„5ä¸ªå­¦ç”Ÿä¿¡æ¯"""
            # æ“ä½œæ•°æ®åº“
            print(self.action) # è·å–æœ¬æ¬¡è¯·æ±‚çš„è§†å›¾æ–¹æ³•å
            
            
    é€šè¿‡è·¯ç”±è®¿é—®åˆ°å½“å‰æ–¹æ³•ä¸­.å¯ä»¥çœ‹åˆ°æœ¬æ¬¡çš„actionå°±æ˜¯è¯·æ±‚çš„æ–¹æ³•å
    

* * *

  
ç´¯æ­»ğŸµï¼Œæœ‰é”™è¯¯è¯·æŒ‡æ­£~æ„Ÿè°¢