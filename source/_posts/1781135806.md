---
layout: post
title: "ç°ä»£ CSS é«˜é˜¶æŠ€å·§ï¼Œä¸è§„åˆ™è¾¹æ¡†è§£å†³æ–¹æ¡ˆ"
date: "2022-12-18T05:13:56.415Z"
---
ç°ä»£ CSS é«˜é˜¶æŠ€å·§ï¼Œä¸è§„åˆ™è¾¹æ¡†è§£å†³æ–¹æ¡ˆ
=====================

æœ¬æ–‡æ˜¯ CSS Houdini ä¹‹ CSS Painting API ç³»åˆ—ç¬¬å››ç¯‡ã€‚

*   [ç°ä»£ CSS ä¹‹é«˜é˜¶å›¾ç‰‡æ¸éšæ¶ˆå¤±æœ¯](https://juejin.cn/post/7167160342101884935)
*   [ç°ä»£ CSS é«˜é˜¶æŠ€å·§ï¼Œåƒ Canvas ä¸€æ ·è‡ªç”±ç»˜å›¾æ„å»ºæ ·å¼ï¼](https://juejin.cn/post/7168984450230353950)
*   [ç°ä»£ CSS é«˜é˜¶æŠ€å·§ï¼Œå®Œç¾çš„æ³¢æµªè¿›åº¦æ¡æ•ˆæœï¼](https://juejin.cn/post/7170868201645932551)

åœ¨ä¸Šä¸‰ç¯‡ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†ä»‹ç»äº† CSS Painting API æ˜¯å¦‚ä½•ä¸€æ­¥ä¸€æ­¥ï¼Œå®ç°è‡ªå®šä¹‰å›¾æ¡ˆç”šè‡³å®ç°åŠ¨ç”»æ•ˆæœçš„ï¼

åœ¨è¿™ä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ¢ç´¢ï¼Œå°è¯•ä½¿ç”¨ CSS Painting APIï¼Œå»å®ç°è¿‡å¾€ CSS ä¸­éå¸¸éš¾ä»¥å®ç°çš„ä¸€ä¸ªç‚¹ï¼Œé‚£å°±æ˜¯å¦‚ä½•ç»˜åˆ¶ä¸è§„åˆ™å›¾å½¢çš„è¾¹æ¡†ã€‚

CSS Painting API
----------------

å†ç®€å•å¿«é€Ÿçš„è¿‡ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯ CSS Painting APIã€‚

CSS Painting API æ˜¯ CSS Houdini çš„ä¸€éƒ¨åˆ†ã€‚è€Œ Houdini æ˜¯ä¸€ç»„åº•å±‚ APIï¼Œå®ƒä»¬å…¬å¼€äº† CSS å¼•æ“çš„å„ä¸ªéƒ¨åˆ†ï¼Œä»è€Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿé€šè¿‡åŠ å…¥æµè§ˆå™¨æ¸²æŸ“å¼•æ“çš„æ ·å¼å’Œå¸ƒå±€è¿‡ç¨‹æ¥æ‰©å±• CSSã€‚Houdini æ˜¯ä¸€ç»„ APIï¼Œå®ƒä»¬ä½¿å¼€å‘äººå‘˜å¯ä»¥ç›´æ¥è®¿é—® [CSS å¯¹è±¡æ¨¡å‹](https://developer.mozilla.org/zh-CN/docs/Web/API/CSS_Object_Model) ï¼ˆCSSOMï¼‰ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥ç¼–å†™æµè§ˆå™¨å¯ä»¥è§£æä¸º CSS çš„ä»£ç ï¼Œä»è€Œåˆ›å»ºæ–°çš„ CSS åŠŸèƒ½ï¼Œè€Œæ— éœ€ç­‰å¾…å®ƒä»¬åœ¨æµè§ˆå™¨ä¸­æœ¬åœ°å®ç°ã€‚

CSS Paint API ç›®å‰çš„ç‰ˆæœ¬æ˜¯ [CSS Painting API Level 1](https://drafts.css-houdini.org/css-paint-api/#paintworkletglobalscope)ã€‚å®ƒä¹Ÿè¢«ç§°ä¸º CSS Custom Paint æˆ–è€… Houdini's Paint Workletã€‚

æˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£ä¸º JS In CSSï¼Œåˆ©ç”¨ JavaScript Canvas ç”»å¸ƒçš„å¼ºå¤§èƒ½åŠ›ï¼Œå®ç°è¿‡å¾€ CSS æ— æ³•å®ç°çš„åŠŸèƒ½ã€‚

è¿‡å¾€ CSS å®ç°ä¸è§„åˆ™å›¾å½¢çš„è¾¹æ¡†æ–¹å¼
-------------------

CSS å®ç°ä¸è§„åˆ™å›¾å½¢çš„è¾¹æ¡†ï¼Œä¸€ç›´æ˜¯ CSS çš„ä¸€ä¸ªéš¾ç‚¹ä¹‹ä¸€ã€‚åœ¨è¿‡å¾€ï¼Œè™½ç„¶æˆ‘ä»¬æœ‰å¾ˆå¤šæ–¹å¼åˆ©ç”¨ Hack å‡ºä¸è§„åˆ™å›¾å½¢çš„è¾¹æ¡†ï¼Œæˆ‘åœ¨ä¹‹å‰çš„å¤šç¯‡æ–‡ç« ä¸­æœ‰åå¤æåŠè¿‡ï¼š

*   [æœ‰æ„æ€ï¼ä¸è§„åˆ™è¾¹æ¡†çš„ç”Ÿæˆæ–¹æ¡ˆ](https://github.com/chokcoco/iCSS/issues/106)
*   [CSS å¥‡æŠ€æ·«å·§ | å·§å¦™å®ç°æ–‡å­—äºŒæ¬¡åŠ ç²—å†åŠ è¾¹æ¡†](https://github.com/chokcoco/iCSS/issues/145)

æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ ·ä¸€ä¸ªå›¾å½¢ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d28ca29a96d4c9c936f541c9e3e2da7~tplv-k3u1fbpfcp-zoom-1.image)

åˆ©ç”¨ CSS å®ç°è¿™æ ·ä¸€ä¸ªå›¾å½¢æ˜¯ç›¸å¯¹ç®€å•çš„ï¼Œå¯ä»¥åˆ©ç”¨ mask æˆ–è€… background ä¸­çš„æ¸å˜å®ç°ï¼Œåƒæ˜¯è¿™æ ·ï¼š

    <div class="arrow-button"></div>
    

    .arrow-button {
        position: relative;
        width: 180px;
        height: 64px;
        background: #f49714;
    
        &::after {
            content: "";
            position: absolute;
            width: 32px;
            height: 64px;
            top: 0;
            right: -32px;
            background: 
                linear-gradient(-45deg, transparent 0, transparent 22px, #f49714 22px, #f49714 100%),
                linear-gradient(-135deg, transparent 0, transparent 22px, #f49714 22px, #f49714 100%);
            background-size: 32px 32px;
            background-repeat: no-repeat;
            background-position: 0 bottom, 0 top;
        }
    }
    

ä½†æ˜¯ï¼Œå¦‚æœï¼Œè¦å®ç°è¿™ä¸ªå›¾å½¢ï¼Œä½†æ˜¯åªæœ‰ä¸€å±‚è¾¹æ¡†ï¼Œåˆ©ç”¨ CSS å°±ä¸é‚£ä¹ˆå¥½å®ç°äº†ï¼Œåƒæ˜¯è¿™æ ·ï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/833b647d5c3644b49a31486237ce2d23~tplv-k3u1fbpfcp-zoom-1.image)

åœ¨è¿‡å¾€ï¼Œæœ‰ä¸¤ç§ç›¸å¯¹è¿˜ä¸é”™çš„æ–¹å¼ï¼Œå»å®ç°è¿™æ ·ä¸€ä¸ªä¸è§„åˆ™å›¾å½¢çš„è¾¹æ¡†ï¼š

1.  å€ŸåŠ© filterï¼Œåˆ©ç”¨å¤šé‡ `drop-shadow()`
2.  å€ŸåŠ© SVG æ»¤é•œå®ç°

æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚

### å€ŸåŠ© filterï¼Œåˆ©ç”¨å¤šé‡ `drop-shadow()` å®ç°ä¸è§„åˆ™è¾¹æ¡†

è¿˜æ˜¯ä¸Šé¢çš„å›¾å½¢ï¼Œæˆ‘ä»¬åˆ©ç”¨å¤šé‡ `drop-shadow()`ï¼Œå¯ä»¥å¤§è‡´çš„å¾—åˆ°å®ƒçš„è¾¹æ¡†æ•ˆæœã€‚ä»£ç å¦‚ä¸‹:

    div {
        position: relative;
        width: 180px;
        height: 64px;
        background: #fff;
    
        &::after {
            content: "";
            position: absolute;
            width: 32px;
            height: 64px;
            top: 0;
            right: -32px;
            background: 
                linear-gradient(-45deg, transparent 0, transparent 22px, #fff 22px, #fff 100%),
                linear-gradient(-135deg, transparent 0, transparent 22px, #fff 22px, #fff 100%);
            background-size: 32px 32px;
            background-repeat: no-repeat;
            background-position: 0 bottom, 0 top;
        }
    }
    div {
        filter: 
            drop-shadow(0px 0px .5px #000)
            drop-shadow(0px 0px .5px #000)
            drop-shadow(0px 0px .5px #000);
    }
    

å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡å åŠ  3 å±‚ `drop-shadow()`ï¼Œæ¥å®ç°ä¸è§„åˆ™å›¾å½¢çš„è¾¹æ¡†ï¼Œè™½ç„¶ `drop-shadow()` æ˜¯ç”¨äºç”Ÿæˆé˜´å½±çš„ï¼Œä½†æ˜¯å¤šå±‚å€¼å¾ˆå°çš„é˜´å½±å åŠ ä¸‹ï¼Œç«Ÿç„¶æœ‰äº†ç±»ä¼¼äºè¾¹æ¡†çš„æ•ˆæœï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/381f6745fb3c4e709ee5203a204425ac~tplv-k3u1fbpfcp-zoom-1.image)

### å€ŸåŠ© SVG æ»¤é•œå®ç°å®ç°ä¸è§„åˆ™è¾¹æ¡†

å¦å¤–ä¸€ç§æ–¹å¼ï¼Œéœ€è¦æŒæ¡æ¯”è¾ƒæ·±çš„ SVG æ»¤é•œçŸ¥è¯†ã€‚é€šè¿‡å®ç°ä¸€ç§ç‰¹æ®Šçš„ SVG æ»¤é•œï¼Œå†é€šè¿‡ CSS çš„ filter å¼•å…¥ï¼Œå®ç°ä¸è§„åˆ™è¾¹æ¡†ã€‚

çœ‹çœ‹ä»£ç ï¼š

    <div></div>
    
    <svg width="0" height="0">
        <filter id="outline">
            <feMorphology in="SourceAlpha" result="DILATED" operator="dilate" radius="1"></feMorphology>
            <feMerge>
                <feMergeNode in="DILATED" />
                <feMergeNode in="SourceGraphic" />
            </feMerge>
        </filter>
    </svg>
    

    div {
        position: relative;
        width: 180px;
        height: 64px;
        background: #fff;
    
        &::after {
            content: "";
            position: absolute;
            width: 32px;
            height: 64px;
            top: 0;
            right: -32px;
            background: 
                linear-gradient(-45deg, transparent 0, transparent 22px, #fff 22px, #fff 100%),
                linear-gradient(-135deg, transparent 0, transparent 22px, #fff 22px, #fff 100%);
            background-size: 32px 32px;
            background-repeat: no-repeat;
            background-position: 0 bottom, 0 top;
        }
    }
    div {
        filter: url(#outline);
    }
    

ç®€å•æµ…æä¸€ä¸‹è¿™æ®µ SVG æ»¤é•œä»£ç ï¼š

1.  `<feMorphology in="SourceAlpha" result="DILATED" operator="dilate" radius="1"></feMorphology>` å°†åŸå›¾çš„ä¸é€æ˜éƒ¨åˆ†ä½œä¸ºè¾“å…¥ï¼Œé‡‡ç”¨äº† dilate æ‰©å¼ æ¨¡å¼ä¸”ç¨‹åº¦ä¸º radius="1"ï¼Œç”Ÿæˆäº†ä¸€ä¸ªæ¯”åŸå›¾å¤§ 1px çš„é»‘è‰²å›¾å—
2.  ä½¿ç”¨ feMerge å°†é»‘è‰²å›¾å—å’ŒåŸå›¾å åŠ åœ¨ä¸€èµ·
3.  å¯ä»¥é€šè¿‡æ§åˆ¶æ»¤é•œä¸­çš„ radius="1" æ¥æ§åˆ¶è¾¹æ¡†çš„å¤§å°

è¿™æ ·ï¼Œä¹Ÿå¯ä»¥å®ç°ä¸è§„åˆ™å›¾å½¢çš„è¾¹æ¡†æ•ˆæœï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/702be1594baa47af8843dda6483b22f1~tplv-k3u1fbpfcp-zoom-1.image)

[CodePen Demo -- 3 ways to achieve unregular border](https://codepen.io/Chokcoco/pen/oNyyNQd)

åˆ©ç”¨ CSS Painting API å®ç°ä¸è§„åˆ™è¾¹æ¡†
---------------------------

é‚£ä¹ˆï¼Œåˆ°äº†ä»Šå¤©ï¼Œåˆ©ç”¨ CSS Painting API ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ç§æ›´ä¸ºç›´æ¥çš„æ–¹å¼ï¼Œæ›´å¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

è¿˜æ˜¯ä¸Šé¢çš„å›¾å½¢ï¼Œæˆ‘ä»¬åˆ©ç”¨ clip-path æ¥å®ç°ä¸€ä¸‹ã€‚

    <div></div>
    

    div {
        position: relative;
        width: 200px;
        height: 64px;
        background: #f49714;
        clip-path: polygon(85% 0%, 100% 50%, 85% 100%, 0% 100%, 0% 0%;); 
    }
    

æˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™æ ·ä¸€ä¸ªå›¾å½¢ï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d52e4628f7db4638902614cb11b9f09d~tplv-k3u1fbpfcp-zoom-1.image)

å½“ç„¶ï¼Œæœ¬æ–‡çš„ä¸»è§’æ˜¯ CSS Painting APIï¼Œæ—¢ç„¶æˆ‘ä»¬æœ‰ `clip-path` çš„å‚æ•°ï¼Œå…¶å®å®Œå…¨ä¹Ÿå¯ä»¥åˆ©ç”¨ CSS Painting API çš„ borderDraw æ¥ç»˜åˆ¶è¿™ä¸ªå›¾å½¢ã€‚

æˆ‘ä»¬å°è¯•ä¸€ä¸‹ï¼Œæ”¹é€ æˆ‘ä»¬çš„ä»£ç ï¼š

    <div></div>
    <script>
    if (CSS.paintWorklet) {              
       CSS.paintWorklet.addModule('/CSSHoudini.js');
    }
    </script>
    

    div {
        position: relative;
        width: 200px;
        height: 64px;
        background: paint(borderDraw);
        --clipPath: 85% 0%, 100% 50%, 85% 100%, 0% 100%, 0% 0%;); 
    }
    

è¿™é‡Œï¼Œæˆ‘ä»¬å°†åŸæœ¬çš„ `clip-path` çš„å…·ä½“è·¯å¾„å‚æ•°ï¼Œå®šä¹‰ä¸ºäº†ä¸€ä¸ª CSS å˜é‡ `--clipPath`ï¼Œä¼ å…¥æˆ‘ä»¬è¦å®ç°çš„ `borderDraw` æ–¹æ³•ä¸­ã€‚æ•´ä¸ªå›¾å½¢æ•ˆæœï¼Œå°±æ˜¯è¦åˆ©ç”¨ `background: paint(borderDraw)` ç»˜åˆ¶å‡ºæ¥ã€‚

æ¥ä¸‹æ¥ï¼Œçœ‹çœ‹ï¼Œæˆ‘ä»¬éœ€è¦å®ç° `borderDraw`ã€‚æ ¸å¿ƒçš„ç‚¹åœ¨äºï¼Œæˆ‘ä»¬é€šè¿‡æ‹¿åˆ° `--clipPath` å‚æ•°ï¼Œè§£æå®ƒï¼Œç„¶åé€šè¿‡å¾ªç¯å‡½æ•°åˆ©ç”¨ç”»å¸ƒæŠŠè¿™ä¸ªå›¾å½¢ç»˜åˆ¶å‡ºæ¥ã€‚

    // CSSHoudini.js æ–‡ä»¶
    registerPaint(
        "borderDraw",
        class {
            static get inputProperties() {
                return ["--clipPath"];
            }
    
            paint(ctx, size, properties) {
                const { width, height } = size;
                const clipPath = properties.get("--clipPath");
                const paths = clipPath.toString().split(",");
                const parseClipPath = function (obj) {
                    const x = obj[0];
                    const y = obj[1];
                    let fx = 0,
                        fy = 0;
                    if (x.indexOf("%") > -1) {
                        fx = (parseFloat(x) / 100) * width;
                    } else if (x.indexOf("px") > -1) {
                        fx = parseFloat(x);
                    }
                    if (y.indexOf("%") > -1) {
                        fy = (parseFloat(y) / 100) * height;
                    } else if (y.indexOf("px") > -1) {
                        fy = parseFloat(y);
                    }
                    return [fx, fy];
                };
    
                var p = parseClipPath(paths[0].trim().split(" "));
                ctx.beginPath();
                ctx.moveTo(p[0], p[1]);
                for (var i = 1; i < paths.length; i++) {
                    p = parseClipPath(paths[i].trim().split(" "));
                    ctx.lineTo(p[0], p[1]);
                }
                ctx.closePath();            
                ctx.fill();
            }
        }
    );
    

ç®€å•è§£é‡Šä¸€ä¸‹ä¸Šè¿°çš„ä»£ç ï¼Œæ³¨æ„å…¶ä¸­æœ€éš¾ç†è§£çš„ `parseClipPath()` æ–¹æ³•çš„è§£é‡Šã€‚

1.  é¦–å…ˆæˆ‘ä»¬ï¼Œé€šè¿‡ `properties.get("--clipPath")`ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ‹¿åˆ°ä¼ å…¥çš„ `--clipPath` å‚æ•°
2.  é€šè¿‡ `spilt()` æ–¹æ³•ï¼Œå°† `--clipPath` åˆ†æˆä¸€æ®µæ®µï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å›¾å½¢å®é™…çš„ç»˜åˆ¶æ­¥éª¤
3.  è¿™é‡Œæœ‰ä¸€ç‚¹éå¸¸é‡è¦ï¼Œä¹Ÿå°±æ˜¯ `parseClipPath()` æ–¹æ³•ï¼Œç”±äºæˆ‘ä»¬çš„ `-clipPath` çš„æ¯ä¸€æ®µå¯èƒ½æ˜¯ `100% 50%` è¿™æ ·çš„æ„é€ ï¼Œä½†æ˜¯å®é™…åœ¨ç»˜å›¾çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦çš„å®é™…åæ ‡çš„ç»å¯¹å€¼ï¼Œè­¬å¦‚åœ¨ä¸€ä¸ª 100 x 100 çš„ç”»å¸ƒä¸Šï¼Œæˆ‘ä»¬éœ€è¦å°† `50% 50%` çš„ç™¾åˆ†æ¯”åæ ‡ï¼Œè½¬åŒ–ä¸ºå®é™…çš„ `50 50` è¿™æ ·çš„ç»å¯¹å€¼
4.  åœ¨ç†è§£äº† `parseClipPath()` åï¼Œå‰©ä¸‹çš„å°±éƒ½éå¸¸å¥½ç†è§£äº†ï¼Œæˆ‘ä»¬é€šè¿‡ `ctx.beginPath()`ã€`ctx.move`ã€`ctx.lineTo` ä»¥åŠ `ctx.closePath()` å°†æ•´ä¸ª `--clipPath` çš„å›¾å½¢ç»˜åˆ¶å‡ºæ¥
5.  æœ€åï¼Œåˆ©ç”¨ `ctx.fill()` ç»™å›¾å½¢ä¸Šè‰²

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†è¿™æ ·ä¸€ä¸ªå›¾å½¢ï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/324a7d18b6cb400f87550cb074d2b818~tplv-k3u1fbpfcp-zoom-1.image)

éƒ½æ‹¿åˆ°äº†å®Œæ•´çš„å›¾å½¢äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªç»™è¿™ä¸ªå›¾å½¢ç»˜åˆ¶è¾¹æ¡†ï¼Œä¸ä¸Šè‰²ï¼Œä¸å°±å¾—åˆ°äº†å®ƒçš„è¾¹æ¡†æ•ˆæœäº†å—ï¼Ÿ

ç®€å•æ”¹é€ ä¸€äº› JavaScript ä»£ç çš„æœ€åéƒ¨åˆ†ï¼š

    // CSSHoudini.js æ–‡ä»¶
    registerPaint(
        "borderDraw",
        class {
            static get inputProperties() {
                return ["--clipPath"];
            }
            paint(ctx, size, properties) {
                // ...
                ctx.closePath();            
                // ctx.fill();
                ctx.lineWidth = 1;
                ctx.strokeStyle = "#000";
                ctx.stroke();
            }
        }
    );
    

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†å›¾å½¢çš„è¾¹æ¡†æ•ˆæœï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b8a6163022fe4a7aafebca82906e313f~tplv-k3u1fbpfcp-zoom-1.image)

### ä»…ä»…åˆ©ç”¨ background ç»˜åˆ¶çš„ç¼ºé™·

ä½†æ˜¯ï¼Œä»…ä»…åˆ©ç”¨ `[bacg](background: paint(borderDraw))` æ¥ç»˜åˆ¶è¾¹æ¡†æ•ˆæœï¼Œä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚

ä¸Šè¿°çš„å›¾å½¢ï¼Œæˆ‘ä»¬ä»…ä»…èµ‹äºˆäº† 1px çš„è¾¹æ¡†ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¾¹æ¡†æ”¹æˆ 5px å‘¢ï¼Ÿçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

    // CSSHoudini.js æ–‡ä»¶
    registerPaint(
        "borderDraw",
        class {
            static get inputProperties() {
                return ["--clipPath"];
            }
            paint(ctx, size, properties) {
                // ...
                ctx.lineWidth = 5;
                ctx.strokeStyle = "#000";
                ctx.stroke();
            }
        }
    );
    

æ­¤æ—¶ï¼Œæ•´ä¸ªå›¾å½¢ä¼šå˜æˆï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e19315a39cc54befba1cb27ca3b55c64~tplv-k3u1fbpfcp-zoom-1.image)

å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰å±•ç¤ºå®Œæ•´çš„ 5px çš„è¾¹æ¡†ï¼Œè¿™æ˜¯ç”±äºæ•´ä¸ªç”»å¸ƒåªæœ‰å…ƒç´ çš„é«˜å®½å¤§å°ï¼Œè€Œä¸Šè¿°çš„ä»£ç ä¸­ï¼Œå…ƒç´ çš„è¾¹æ¡†æœ‰ä¸€éƒ¨åˆ†ç»˜åˆ¶åˆ°äº†ç”»å¸ƒä¹‹å¤–ï¼Œå› æ­¤ï¼Œæ•´ä¸ªå›¾å½¢å¹¶éæˆ‘ä»¬æœŸå¾…çš„æ•ˆæœã€‚

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ¢ä¸€ç§æ€è·¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç»§ç»­æ”¹é€ ä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ï¼Œä»…ä»…éœ€è¦æ”¹é€  CSS ä»£ç å³å¯ï¼š

    div {
        position: relative;
        width: 200px;
        height: 64px;
        margin: auto;
        clip-path: polygon(var(--clipPath)); 
        --clipPath: 85% 0%, 100% 50%, 85% 100%, 0% 100%, 0% 0%;
        
        &::before {
          content:"";
          position:absolute;
          inset: 0;
          mask: paint(borderDraw);
          background: #000;
        }
    }
    

è¿™é‡Œï¼Œæˆ‘ä»¬çš„å…ƒç´ æœ¬èº«ï¼Œè¿˜æ˜¯åˆ©ç”¨äº† `clip-path: polygon(var(--clipPath))` å‰ªåˆ‡äº†è‡ªèº«ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬å€ŸåŠ©äº†ä¸€ä¸ªä¼ªå…ƒç´ ï¼Œåˆ©ç”¨è¿™ä¸ªä¼ªå…ƒç´ å»å®ç°å…·ä½“çš„è¾¹æ¡†æ•ˆæœã€‚

è¿™é‡Œå…¶å®ç”¨äº†ä¸€ç§å†…å¤–åˆ‡å‰²çš„æ€æƒ³ï¼Œå»å®ç°çš„è¾¹æ¡†æ•ˆæœï¼š

1.  åˆ©ç”¨çˆ¶å…ƒç´ çš„ `clip-path: polygon(var(--clipPath))` å‰ªåˆ‡æ‰å¤–å›´çš„å›¾å½¢
2.  åˆ©ç”¨ç»™ä¼ªå…ƒç´ çš„ mask ä½œç”¨å®é™…çš„ `paint(borderDraw)` æ–¹æ³•ï¼ŒæŠŠå›¾å½¢çš„å†…éƒ¨é•‚ç©ºï¼Œåªä¿ç•™è¾¹æ¡†éƒ¨åˆ†

è¿˜æ˜¯è®¾ç½® `ctx.lineWidth = 5`ï¼Œå†çœ‹çœ‹æ•ˆæœï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2a111335a5dd4fc2925ba92fad430aff~tplv-k3u1fbpfcp-zoom-1.image)

çœ‹ä¸Šå»ä¸é”™ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œè™½ç„¶è®¾ç½®äº† `5px` çš„è¾¹æ¡†å®½åº¦ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œä¸Šå›¾çš„è¾¹æ¡†å®½åº¦åªæœ‰ `2.5px` çš„ï¼Œè¿™æ˜¯ç”±äºå¦å¤–ä¸€ç‚¹ä¸€åŠè¾¹æ¡†å®é™…ä¸Šè¢«åˆ‡å‰²æ‰äº†ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¦‚æœéœ€è¦å®ç° `5px` çš„æ•ˆæœï¼Œå®é™…ä¸Šéœ€è¦ `ctx.lineWidth =10`ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª CSS å˜é‡æ¥æ§åˆ¶è¾¹æ¡†çš„å¤§å°ï¼š

    div {
        position: relative;
        width: 200px;
        height: 64px;
        margin: auto;
        clip-path: polygon(var(--clipPath)); 
        --clipPath: 85% 0%, 100% 50%, 85% 100%, 0% 100%, 0% 0%;
        --borderWidth: 5;
        
        &::before {
          content:"";
          position:absolute;
          inset: 0;
          mask: paint(borderDraw);
          background: #000;
        }
    }
    

åœ¨å®é™…çš„ borderDraw å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†ä¼ å…¥çš„ `--borderWidth` å‚æ•°ï¼Œä¹˜ä»¥ 2 ä½¿ç”¨å°±å¥½ï¼š

    
    registerPaint(
        "borderDraw",
        class {
            static get inputProperties() {
                return ["--clipPath", "--borderWidth"];
            }
            paint(ctx, size, properties) {
                const borderWidth = properties.get("--borderWidth");
                // ...
                ctx.lineWidth = borderWidth * 2;
                ctx.strokeStyle = "#000";
                ctx.stroke();
            }
        }
    );
    

è¿™æ ·ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½èƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„è¾¹æ¡†é•¿åº¦ï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b8cbd9f9df2421c8d62d5dbb4901244~tplv-k3u1fbpfcp-zoom-1.image)

[CodePen Demo -- CSS Hudini & Unregular Custom Border](https://codepen.io/Chokcoco/pen/MWXXYgJ)

åˆ°è¿™é‡Œï¼Œæ•´ä¸ªå®ç°å°±å®Œæˆäº†ï¼Œæ•´ä¸ªè¿‡ç¨‹å…¶å®æœ‰å¤šå¤„éå¸¸å…³é”®çš„ç‚¹ï¼Œä¼šæœ‰ä¸€ç‚¹ç‚¹éš¾ä»¥ç†è§£ï¼Œå…·ä½“å¯èƒ½éœ€è¦è‡ªå·±å®é™…è°ƒè¯•ä¸€éæ‰¾åˆ°å®ç°çš„åŸç†ã€‚

å…·ä½“åº”ç”¨
----

åœ¨æŒæ¡äº†ä¸Šè¿°çš„æ–¹æ³•åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹å¼ï¼Œå®ç°å„ç±»ä¸è§„åˆ™å›¾å½¢çš„è¾¹æ¡†æ•ˆæœï¼Œæˆ‘ä»¬åªéœ€è¦ä¼ å…¥å¯¹äºçš„ `clip-path` å‚æ•°ä»¥åŠæˆ‘ä»¬æƒ³è¦çš„è¾¹æ¡†é•¿åº¦å³å¯ã€‚

å¥½ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½å®ç°å„ç±»ä¸åŒçš„ä¸è§„åˆ™å›¾å½¢çš„è¾¹æ¡†æ•ˆæœäº†ã€‚

åƒæ˜¯è¿™æ ·ï¼š

    div {
        position: relative;
        width: 200px;
        height: 200px;
        clip-path: polygon(var(--clipPath)); 
        --clipPath: 0% 15%, 15% 15%, 15% 0%, 85% 0%, 85% 15%, 100% 15%, 100% 85%, 85% 85%, 85% 100%, 15% 100%, 15% 85%, 0% 85%;
        --borderWidrh: 1;
        --color: #000;
        
        &::before {
          content:"";
          position:absolute;
          inset: 0;
          mask: paint(borderDraw);
          background: var(--color);
        }
    }
    
    div:nth-child(2) {
        --clipPath: 50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%;
        --borderWidrh: 2;
        --color: #ffcc00;
    }
    div:nth-child(3) {
        --clipPath: 90% 58%90% 58%, 69% 51%, 69% 51%, 50% 21%, 50% 21%, 39% 39%, 39% 39%, 15% 26%, 15% 26%, 15% 55%, 15% 55%, 31% 87%, 31% 87%, 14% 84%, 14% 84%, 44% 96%, 44% 96%, 59% 96%, 59% 96%, 75% 90%, 75% 90%, 71% 83%, 71% 83%, 69% 73%, 69% 73%, 88% 73%, 88% 73%, 89% 87%, 89% 87%, 94% 73%, 94% 73%;
        --borderWidrh: 1;
        --color: deeppink;
    }
    div:nth-child(4) {
        --clipPath: 0% 0%, 100% 0%, 100% 75%, 75% 75%, 75% 100%, 50% 75%, 0% 75%;
        --borderWidrh: 1;
        --color: yellowgreen;
    }
    div:nth-child(5) {
        --clipPath: 20% 0%, 0% 20%, 30% 50%, 0% 80%, 20% 100%, 50% 70%, 80% 100%, 100% 80%, 70% 50%, 100% 20%, 80% 0%, 50% 30%;
        --borderWidrh: 3;
        --color: #c7b311;
    }
    

å¾—åˆ°ä¸åŒå›¾å½¢çš„è¾¹æ¡†æ•ˆæœï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d577e5b5b01946cbb49186064d637130~tplv-k3u1fbpfcp-zoom-1.image)

[CodePen Demo -- CSS Hudini & Unregular Custom Border](https://codepen.io/Chokcoco/pen/KKeROeX)

åˆæˆ–è€…æ˜¯åŸºäºå®ƒä»¬ï¼Œå»å®ç°å„ç±»æŒ‰é’®æ•ˆæœï¼Œè¿™ç§æ•ˆæœåœ¨ä»¥å¾€ä½¿ç”¨ CSS æ˜¯éå¸¸éå¸¸éš¾å®ç°çš„ï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b017bc79b4d407c92daf7c8c4f12f94~tplv-k3u1fbpfcp-zoom-1.image)

å®ƒä»¬çš„æ ¸å¿ƒåŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œç”šè‡³åŠ ä¸Š Hover æ•ˆæœï¼Œä¹Ÿæ˜¯éå¸¸çš„è½»æ¾ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8b0ffc3fcf04bfabea6d7a48a3e4a92~tplv-k3u1fbpfcp-zoom-1.image)

å®Œæ•´çš„ä»£ç ï¼Œä½ å¯ä»¥æˆ³è¿™é‡Œï¼š[CodePen Demo -- https://codepen.io/Chokcoco/pen/ExRLqdO](https://codepen.io/Chokcoco/pen/ExRLqdO)

è‡³æ­¤ï¼Œæˆ‘ä»¬å†ä¸€æ¬¡åˆ©ç”¨ CSS Painting API å®ç°äº†æˆ‘ä»¬è¿‡å¾€ CSS å®Œå…¨æ— æ³•å®ç°çš„æ•ˆæœã€‚è¿™ä¸ªä¹Ÿå°±æ˜¯ CSS Houdini çš„é­…åŠ›ï¼Œæ˜¯ JS In CSS çš„é­…åŠ›ã€‚

å…¼å®¹æ€§ï¼Ÿ
----

å¥½å§ï¼Œå…¶å®ä¸Šä¸€ç¯‡æ–‡ç« ä¹Ÿè°ˆåˆ°äº†å…¼å®¹é—®é¢˜ï¼Œå› ä¸ºå¯èƒ½æœ‰å¾ˆå¤šçœ‹åˆ°æœ¬ç¯‡æ–‡ç« å¹¶æ²¡æœ‰å»ç¿»çœ‹å‰ä¸¤ç¯‡æ–‡ç« çš„åŒå­¦ã€‚é‚£ä¹ˆï¼ŒCSS Painting API çš„å…¼å®¹æ€§åˆ°åº•å¦‚ä½•å‘¢ï¼Ÿ

[CanIUse - registerPaint](https://caniuse.com/?search=registerPaint) æ•°æ®å¦‚ä¸‹ï¼ˆæˆªæ­¢è‡³ 2022-11-23ï¼‰ï¼š

![image](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6edf9fab6f1740e08b48b1a9d2499b0a~tplv-k3u1fbpfcp-zoom-1.image)

Chrome å’Œ Edge åŸºäº [Chromium](https://www.google.com.hk/search?newwindow=1&rlz=1C5GCEM_enCN988CN988&q=Chromium&spell=1&sa=X&ved=2ahUKEwi3he2ensL7AhVaSmwGHdnzBxgQkeECKAB6BAgoEAE) å†…æ ¸çš„æµè§ˆå™¨å¾ˆæ—©å°±å·²ç»æ”¯æŒï¼Œè€Œä¸»æµæµè§ˆå™¨ä¸­ï¼ŒFirefox å’Œ Safari ç›®å‰è¿˜ä¸æ”¯æŒã€‚

CSS Houdini è™½ç„¶å¼ºå¤§ï¼Œç›®å‰çœ‹æ¥è¦æƒ³å¤§è§„æ¨¡ä¸Šç”Ÿäº§ç¯å¢ƒï¼Œä»éœ€ä¸€æ®µæ—¶é—´çš„ç­‰å¾…ã€‚è®©æˆ‘ä»¬ç»™æ—¶é—´ä¸€ç‚¹æ—¶é—´ï¼

æœ€å
--

å¥½äº†ï¼Œæœ¬æ–‡åˆ°æ­¤ç»“æŸï¼Œå¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰æ‰€å¸®åŠ© ğŸ˜ƒ

å¦‚æœè¿˜æœ‰ä»€ä¹ˆç–‘é—®æˆ–è€…å»ºè®®ï¼Œå¯ä»¥å¤šå¤šäº¤æµï¼ŒåŸåˆ›æ–‡ç« ï¼Œæ–‡ç¬”æœ‰é™ï¼Œæ‰ç–å­¦æµ…ï¼Œæ–‡ä¸­è‹¥æœ‰ä¸æ­£ä¹‹å¤„ï¼Œä¸‡æœ›å‘ŠçŸ¥ã€‚