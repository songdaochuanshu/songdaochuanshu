---
layout: post
title: "åšå®¢å›­æµ‹è¯•"
date: "2022-05-31T10:23:20.862Z"
---
åšå®¢å›­æµ‹è¯•
=====

ä¸€ã€å¼€å‘èƒŒæ™¯
------

*   äº§å“å‡ºè®¾è®¡ç¨¿è¦æ±‚åšä¸€ä¸ªä»¿åŸç”ŸappçŸ­ä¿¡éªŒè¯ç ç»„ä»¶ï¼ŒèŠ±äº†ä¸¤å°æ—¶æå‡ºæ¥ä¸€ä¸ªè¿˜å¯ä»¥çš„ç»„ä»¶ï¼Œæ”¯æŒå±å¹•è‡ªé€‚åº”ï¼Œå¯ä»¥ç”¨äºå¼¹å‡ºæ¡†ï¼Œæˆ–è‡ªå·±å°è£…çš„vueç»„ä»¶é‡Œï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©é‚£äº›è¢«äº§å“å‹æ¦¨çš„åŒå­¦ï¼Œå“ˆå“ˆã€‚ğŸ˜„
    
*   å…¶æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨ä¸€ä¸ªè¾“å…¥æ¡†ä½¿ç”¨css3,translateå±æ€§ï¼Œæ¯è¾“å…¥ä¸€æ¬¡åå‘å³ä½ç§»ä¸€ä¸ªå•ä½ä½ç½®ï¼Œç›´åˆ°è¾“å…¥å®ŒéªŒè¯ç ä¸ªæ•°æ¶ˆå¤±ã€‚ç„¶åå®šä¹‰ä¸€ä¸ªæ•°ç»„smsCodeListï¼Œåˆå§‹åŒ–æ—¶pushå¯¹è±¡
    

    smsCodeList = [{
        val: '',
        isError: ''
    }]
    

äºŒã€è´¹å‘ä¸å¤šè¯´ï¼Œå…ˆçœ‹æ¼”ç¤º
------------

[æ¼”ç¤º](https://user-images.githubusercontent.com/34472552/170011691-68b93a18-fca5-4e35-9924-ac36fb5d5972.mp4)

![image.png](https://img2022.cnblogs.com/other/2437752/202205/2437752-20220531181509931-765813587.png)

![image.png](https://img2022.cnblogs.com/other/2437752/202205/2437752-20220531181510190-1929883838.png)

ä¸‰ã€ä»£ç è§£é‡Š
------

    // htmlä»£ç 
    <div class='sms-check-code-wrapper' @click='handleClick'>
     <div class="sms-code-container">
       <div :class="['sms-code-title', {'error': error}]"
            :style="{'color': error ? errorColor : errorColorDefault}">
       {{ title }}</div>
       <div class='sms-code-box'>
         <div class="sms-code-input-box" :style="{'transform': `translate(${inputBoxActive}%)`}">
           <input
               ref='refInout'
               v-show='isShowInputBox'
               type='number'
               v-model='inputValue'
               class='sms-code-input'
               :style="{
                  'width': style.smsCodeItemWidth + '%',
                  'paddingLeft': style.inputPL + '%'
                }"
               @keyup="onKeyUp"
               @keydown='onKeyDown'
               v-focus
               :maxlength='codeNum'
               autocomplete="one-time-code"
               inputmode="numeric"
               value=''
           />
         </div>
         <div class='sms-code-bottom flex-sb'>
           <div class='sms-code-item'
                :style="{
                  'width': style.smsCodeItemWidth + '%'
                }"
                v-for='(item, index) in smsCodeList' :key='index'>
             <span :class="['sms-value', {'error': item.isError }]"
                   :style="{'color': item.isError ? errorColor : errorColorDefault}">
             {{ item.val }}</span>
             <span :class="['sms-line', {'error': item.isError}]"
                   :style="{'backgroundColor': item.isError ? errorColor : errorColorDefault}">
             </span>
           </div>
         </div>
       </div>
     </div>
    </div>
    

    åªéœ€ç®€å•çš„è¿™å‡ è¡Œhtmlç»“æ„ï¼Œç”¨æ¥æ¸²æŸ“æ ‡é¢˜å’Œè¾“å…¥æ¡†å’ŒéªŒè¯ç ç»„ä»¶
    js ä»£ç ä¹Ÿå¾ˆç®€å•
    

    // é¦–å…ˆå®šä¹‰ä¸€äº›åˆå§‹é»˜è®¤å€¼ï¼Œå› ä¸ºé»˜è®¤æŒ‰ç…§6ä½æ•°éªŒè¯ç æ¥çš„
    let defaultCodeNum = 6
    let defaultMoveUnit = 17.2
    let defaultInputPL = 7
    let defaultSmsCodeItemWidth = 14
    export default {
      name: "VueSmsCheckCode",
      directives: {
        focus: {
          inserted: function (el) {
            el.focus()
          }
        }
      },
      props: {
        title: {
          type: String,
          default: 'è¯·å½•å…¥éªŒè¯ç '
        },
        codeNum: { // éªŒè¯ç ä¸ªæ•°
          type: Number,
          default: 6
        },
        isError: { // éªŒè¯ç é”™è¯¯æ˜¾ç¤ºé”™è¯¯æç¤º
          type: Boolean,
          default: false
        },
        errorColor: {
          type: String,
          default: '#D81A1A'
        }
      },
      data() {
        return {
          smsCodeList: [], // éªŒè¯ç è¾“å…¥æ˜¾ç¤ºåœ¨divä¸Šçš„æ•°å­—
          inputValue: '', // è¾“å…¥æ¡†çš„å€¼
          smsValue: '', // éªŒè¯ç å®Œæ¯•åå½’æ€»çš„å˜é‡
          moveUnit: 17.2, // input ä½ç§»å•ä½
    
          inputBoxActive: 0, // å½“å‰è¾“å…¥æ¡†ä½ç§»ä½ç½®
          currentIndex: 0, // å½“å‰éªŒè¯ç ç´¢å¼•
          isShowInputBox: true, // æ˜¯å¦æ˜¾ç¤ºè¾“å…¥æ¡†
          error: false, // éªŒè¯ç é”™è¯¯æŠ¥çº¢
          errorColorDefault: '#b1b1b1', // é»˜è®¤é”™è¯¯è¾“å…¥æ¡†é¢œè‰²
          style: { // é»˜è®¤æ ·å¼
            inputPL: 0, // input padding-leftå€¼
            smsCodeItemWidth: 0, // éªŒè¯ç æ˜¾ç¤ºitemçš„å®½åº¦(è‡ªé€‚åº”)
          }
        }
      },
      created() {
        this.reDomRender() // åˆå§‹åŒ–æ—¶ï¼Œé€šè¿‡ä¼ è¿‡æ¥çš„éªŒè¯ç ä¸ªæ•°é‡æ–°æ¸²æŸ“ç»„ä»¶ï¼ˆå„ä¸ªdomä½ç½®ï¼Œå®½åº¦ç­‰é‡æ–°è®¡ç®—ï¼‰
        this.compareList() // push é»˜è®¤æ•°æ®
        this.inputPaving() // å½“ç‚¹å‡»æ‰‹æœºéªŒè¯ç è‡ªåŠ¨å¡«å……æ—¶ï¼Œè‡ªåŠ¨å¹³é“ºæ•°æ®
      },
      methods: {
        reDomRender() {
          this.style = {
            inputPL: Math.round(defaultCodeNum / (this.codeNum / defaultInputPL)),
            smsCodeItemWidth:  Math.round(defaultCodeNum / this.codeNum * defaultSmsCodeItemWidth)
          }
          this.moveUnit =  Math.round(defaultCodeNum / (this.codeNum / (defaultMoveUnit - .3333)))
        },
        compareList() {
          for (let i = 0; i < this.codeNum; i++) {
            if (this.smsCodeList.length < this.codeNum) {
              this.smsCodeList.push({
                val: '',
                isError: this.isError
              })
            }
          }
        },
        initAll() {
          this.smsCodeList = []
          this.compareList()
          this.inputValue = ''
          this.smsValue = ''
          this.inputBoxActive = 0
          this.currentIndex = 0
          this.isShowInputBox = true
          // å»¶æ—¶è§£å†³å…‰æ ‡èšç„¦
          setTimeout(() => {
            this.$refs.refInout.focus()
          })
        },
        // å½“ç‚¹å‡»éªŒè¯ç æ—¶ï¼ŒinputBoxActiveï¼Œå€¼è¦åˆ†é“ºåœ¨æ¯ä¸ªè¾“å…¥æ¡†é‡Œ
        inputPaving() {
          let v = this.inputValue
          if (v.length > 0) {
            v.split('').forEach((item, index) => {
              if (index <= v.length) {
                this.smsCodeList[index].val = item
                const inputPosition = (index + 1) * this.moveUnit
                this.inputBoxActive = inputPosition >= 100 ? 100 : inputPosition
                this.currentIndex = index + 1
                this.smsValue += item
                this.inputValue = ''
                if (index + 1 === this.codeNum) {
                  this.isShowInputBox = false
                  this.sendFun()
                }
              }
            })
          }
        },
        onKeyDown(e) {
          let key = e.key;
          e.returnValue = !(key === 'e' || key === 'E' || key === '+' || key === '-');
        },
        onKeyUp(e) {
          if (this.currentIndex < 1) return
          if (e.code === 'Backspace' || e.key === 'Backspace') { // ä¼šé€€
            this.currentIndex = this.currentIndex - 1
    
            this.inputBoxActive = this.inputBoxActive - this.moveUnit
    
            this.smsCodeList = this.smsCodeList.map((val, index) => {
              if (index === this.currentIndex) {
                val.val = ''
                val.isError = this.isError
                return val
              }
              return val
            })
          }
        },
        handleClick() {
          this.$refs.refInout.focus()
        },
        sendFun() {
          this.$emit('finish', this.smsValue)
        }
      },
      watch: {
        inputValue(v) { // ç›‘å¬è¾“å…¥æ¡†è¾“å…¥çš„å€¼
          if (!v) return
          // åˆå§‹åŒ–æ—¶ï¼Œç‚¹å‡»è½¯é”®ç›˜ä¸Šçš„éªŒè¯ç è‡ªåŠ¨å¡«å……æ—¶åˆ†é“ºinputæ•°æ®
          if (v.length > 1) {
            this.inputPaving()
            return;
          }
          this.inputBoxActive = this.inputBoxActive + this.moveUnit
          this.smsCodeList.map((val, index) => {
            if (this.currentIndex === index) {
              if(val) {
                  //å½“å‰è¾“å…¥çš„ä½ç½®ä½¿çº¢è‰²åº•éƒ¨æ¡åˆå§‹åŒ–
                val.isError = false
              }
              val.val = v
              return val
            }
            return val
          })
          this.currentIndex += 1
          this.inputValue = ''
          if (this.currentIndex >= this.codeNum) { // å½“æœ€åä¸€ä½æ—¶å‘
            this.isShowInputBox = false
            this.smsCodeList.forEach(val => {
              this.smsValue += val.val
            })
            this.sendFun()
          }
        },
        isError(v) { // ç›‘å¬éªŒè¯ç æ˜¯å¦é”™è¯¯
          this.error = v
          if (v) {
            this.smsCodeList.map(value => {
              value.isError = true
              return value
            })
            this.initAll()
          }
        }
      }
    }
    
    

    å‰©ä¸‹çš„å°±æ˜¯cssäº†
    
    npm install vue-sms-check-code --save
    
    æœ€æ–°ç‰ˆ1.0.1 (2022/5/25)
    
    åŒ…å¸¸è§„æ“ä½œä¸‹è½½ä½¿ç”¨
    
    å¦å¤–éœ€è¦å®Œæ•´çš„ä»£ç è¯·åˆ°githubæˆ–giteeä¸Šä¸‹è½½
    
    å¼€æºå¹¶æ€»ç»“æ•´ç†çœŸçš„å¾ˆè´¹æ—¶é—´ï¼Œå¦‚æœä¸é”™è¿˜è¯·star
    ğŸˆ¶ï¸é—®é¢˜è¯·issues
    
    
    

[giteeæºç åœ°å€](https://gitee.com/snailbody/vue-sms-check-code)

[githubæºç åœ°å€](https://github.com/snailbody/vue-sms-check-code)

æºç é‡Œæœ‰example ä½¿ç”¨æ–¹å¼ï¼Œä½¿ç”¨ç°å¸¸ç®€å•ã€‚

å¼€æºå¹¶æ€»ç»“æ•´ç†çœŸçš„å¾ˆè´¹æ—¶é—´ï¼Œæ¬¢è¿star

åº•éƒ¨æµ‹è¯•