---
layout: post
title: "å¦‚ä½•åœ¨ pyqt ä¸­è‡ªå®šä¹‰å·¥å…·æç¤º ToolTip"
date: "2022-05-24T03:25:34.206Z"
---
å¦‚ä½•åœ¨ pyqt ä¸­è‡ªå®šä¹‰å·¥å…·æç¤º ToolTip
=========================

å‰è¨€
==

Qt è‡ªå¸¦çš„å·¥å…·æç¤ºæ ·å¼ä¸å¤ªå¥½çœ‹ï¼Œå°±ç®—åŠ äº†æ ·å¼è¡¨ä¹Ÿæ—¶ä¸æ—¶ä¼šå¤±æ•ˆï¼ŒåŒæ—¶å·¥å…·æç¤ºæ²¡æœ‰é˜´å½±ï¼Œçœ‹èµ·æ¥å°±æ›´éš¾å—äº†ã€‚æ‰€ä»¥æœ¬ç¯‡åšå®¢å°†ä¼šä»‹ç»è‡ªå®šä¹‰å·¥å…·æç¤ºçš„æ–¹æ³•ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![è‡ªå®šä¹‰å·¥å…·æç¤º](https://img2022.cnblogs.com/blog/2065884/202205/2065884-20220523233519723-144370220.gif)

å®ç°è¿‡ç¨‹
====

å·¥å…·æç¤ºå…¶å®å°±æ˜¯ä¸€ä¸ªå¸¦äº†æ ‡ç­¾çš„çª—å£ï¼Œä¸ºäº†ç»™å·¥å…·æç¤ºåŠ ä¸Šé˜´å½±ï¼Œåªè¦ç»™çª—å£è®¾ç½® `QGraphicsShadowEffect` å³å¯ã€‚åŒæ—¶ `QToolTip` å¼¹å‡ºä¹‹åä¸ä¼šä¸€ç›´å¡åœ¨ç•Œé¢ä¸Šï¼Œä¸€æ®µæ—¶é—´åå°±ä¼šæ¶ˆå¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ç»™è‡ªå®šä¹‰çš„å·¥å…·æç¤ºåŠ ä¸Šä¸€ä¸ª `QTimer`ï¼Œæ—¶é—´æº¢å‡ºä¹‹åå°±éšè—å·¥å…·æç¤ºã€‚

    # coding:utf-8
    from PyQt5.QtCore import QFile, QPropertyAnimation, QTimer, Qt
    from PyQt5.QtGui import QColor
    from PyQt5.QtWidgets import (QApplication, QFrame, QGraphicsDropShadowEffect,
                                 QHBoxLayout, QLabel)
    
    
    class ToolTip(QFrame):
    
        def __init__(self, text='', parent=None):
            super().__init__(parent=parent)
            self.__text = text
            self.__duration = 1000
            self.timer = QTimer(self)
            self.hBox = QHBoxLayout(self)
            self.label = QLabel(text, self)
            self.ani = QPropertyAnimation(self, b'windowOpacity', self)
    
            # set layout
            self.hBox.addWidget(self.label)
            self.hBox.setContentsMargins(10, 7, 10, 7)
    
            # add shadow
            self.shadowEffect = QGraphicsDropShadowEffect(self)
            self.shadowEffect.setBlurRadius(32)
            self.shadowEffect.setColor(QColor(0, 0, 0, 60))
            self.shadowEffect.setOffset(0, 5)
            self.setGraphicsEffect(self.shadowEffect)
    
            self.timer.setSingleShot(True)
            self.timer.timeout.connect(self.hide)
    
            # set style
            self.setAttribute(Qt.WA_StyledBackground)
            self.setDarkTheme(False)
            self.__setQss()
    
        def text(self):
            return self.__text
    
        def setText(self, text: str):
            """ set text on tooltip """
            self.__text = text
            self.label.setText(text)
            self.label.adjustSize()
            self.adjustSize()
    
        def duration(self):
            return self.__duration
    
        def setDuration(self, duration: int):
            """ set tooltip duration in milliseconds """
            self.__duration = abs(duration)
    
        def __setQss(self):
            """ set style sheet """
            f = QFile("resource/tooltip.qss")
            f.open(QFile.ReadOnly)
            self.setStyleSheet(str(f.readAll(), encoding='utf-8'))
            f.close()
    
            self.label.adjustSize()
            self.adjustSize()
    
        def setDarkTheme(self, dark=False):
            """ set dark theme """
            dark = 'true' if dark else 'false'
            self.setProperty('dark', dark)
            self.label.setProperty('dark', dark)
            self.setStyle(QApplication.style())
    
        def showEvent(self, e):
            self.timer.stop()
            self.timer.start(self.__duration)
            super().showEvent(e)
    
        def hideEvent(self, e):
            self.timer.stop()
            super().hideEvent(e)
    

å·¥å…·æç¤ºç»§æ‰¿è‡ª `QFrame` çš„åŸå› æ˜¯æˆ‘ä»¬éœ€è¦è®¾ç½®è¾¹æ¡†æ ·å¼ï¼Œæ ·å¼è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼Œæ”¯æŒäº®æš—ä¸¤ç§ä¸»é¢˜ï¼š

    ToolTip[dark="false"] {
        border: 1px solid rgba(0, 0, 0, 0.06);
        border-radius: 5px;
        background-color: rgb(243, 243, 243);
    }
    
    ToolTip[dark="true"] {
        border: 1px solid rgb(28, 28, 28);
        border-radius: 5px;
        background-color: rgb(43, 43, 43);
    }
    
    QLabel {
        background-color: transparent;
        font: 15px 'Segoe UI', 'Microsoft YaHei';
    }
    
    QLabel[dark="false"] {
        color: black;
    }
    
    QLabel[dark="true"] {
        color: white;
    }
    

æµ‹è¯•
==

ä¸‹è¿°ä»£ç çš„è¿è¡Œæ•ˆæœå°±æ˜¯åŠ¨å›¾ä¸­æ‰€ç¤ºçš„æ ·å­ï¼Œåªè¦ç»™æƒ³è¦è®¾ç½®å·¥å…·æç¤ºçš„éƒ¨ä»¶å®‰è£…ä¸Šäº‹ä»¶è¿‡æ»¤å™¨ï¼Œå°±èƒ½å°† `QToolTip` æ›¿æ¢æˆè‡ªå®šä¹‰çš„å·¥å…·æç¤ºï¼š

    # coding:utf-8
    import sys
    from PyQt5.QtCore import QEvent, QPoint
    from PyQt5.QtWidgets import QApplication, QWidget, QPushButton, QHBoxLayout
    
    from tool_tip import ToolTip
    
    
    class Demo(QWidget):
    
        def __init__(self):
            super().__init__()
            self.hBox = QHBoxLayout(self)
            self.button1 = QPushButton('ã‚­ãƒ©ã‚­ãƒ©', self)
            self.button2 = QPushButton('é£Ÿã¹ãŸæ„›', self)
            self._toolTip = ToolTip(parent=self)
            # self._toolTip.setDarkTheme(True)
    
            self.button1.setToolTip('aiko - ã‚­ãƒ©ã‚­ãƒ© âœ¨')
            self.button2.setToolTip('aiko - é£Ÿã¹ãŸæ„› ğŸ¥°')
            self.button1.setToolTipDuration(1000)
            self.button2.setToolTipDuration(5000)
    
            self.button1.installEventFilter(self)
            self.button2.installEventFilter(self)
    
            self.hBox.setContentsMargins(30, 30, 30, 30)
            self.hBox.setSpacing(20)
            self.hBox.addWidget(self.button1)
            self.hBox.addWidget(self.button2)
    
            self.resize(600, 300)
            self._toolTip.hide()
    
            with open('resource/demo.qss', encoding='utf-8') as f:
                self.setStyleSheet(f.read())
    
        def eventFilter(self, obj, e: QEvent):
            if obj is self:
                return super().eventFilter(obj, e)
    
            tip = self._toolTip
            if e.type() == QEvent.Enter:
                tip.setText(obj.toolTip())
                tip.setDuration(obj.toolTipDuration())
    
                pos = obj.mapTo(self, QPoint(0, 0))
                x = pos.x() + obj.width()//2 - tip.width()//2
                y = pos.y() - 5 - tip.height()
    
                # adjust postion to prevent tooltips from appearing outside the window
                x = min(max(5, x), self.width() - tip.width() - 5)
                y = min(max(5, y), self.height() - tip.height() - 5)
    
                tip.move(x, y)
                tip.show()
            elif e.type() == QEvent.Leave:
                tip.hide()
            elif e.type() == QEvent.ToolTip:
                return True
    
            return super().eventFilter(obj, e)
    
    
    if __name__ == '__main__':
        app = QApplication(sys.argv)
        w = Demo()
        w.show()
        app.exec_()
    
    

ç”¨åˆ°çš„æ ·å¼æ–‡ä»¶å¦‚ä¸‹ï¼š

    QWidget{
        background-color: white;
    }
    
    QPushButton {
        background-color: rgb(204, 204, 204);
        padding: 10px 64px 10px 64px;
        font: 19px 'Microsoft YaHei';
        border: transparent;
        border-radius: 4px;
    }
    
    QPushButton:pressed:hover {
        background-color: rgb(153, 153, 153);
    }
    
    QPushButton:hover {
        background-color: rgb(230, 230, 230);
    }
    
    QPushButton:disabled {
        background-color: rgb(204, 204, 204);
        color: rgb(122, 122, 122);
    }
    

åè®°
==

è‡ªå®šä¹‰å·¥å…·æç¤ºçš„æ–¹æ³•å·²ç»ä»‹ç»å®Œäº†ï¼Œæ›´å¤šå¥½åº·çš„è‡ªå®šä¹‰å°éƒ¨ä»¶å‚è§ GitHub ä»“åº“ [https://github.com/zhiyiYo/PyQt-Fluent-Widgets](https://github.com/zhiyiYo/PyQt-Fluent-Widgets)ï¼Œä»¥ä¸Š~~