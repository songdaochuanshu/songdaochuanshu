---
layout: post
title: "Redis持久化机制"
date: "2023-01-13T15:17:43.291Z"
---
Redis持久化机制
==========

全量同步与增量同步的区别
------------

全量同步：就是每天定时（避开高峰期）或者采用一个周期实现将数据拷贝到一个地方也就是Rdb存储。  
增量同步：比如采用对行为的操作实现对数据的同步，也就是AOF。  
全量与增量的比较：增量同步比全量同步更加消耗服务器的内存，但是能够更加的保证数据的同步。  

RDB与AOF实现持久化的区别
---------------

Redis提供了两种持久化的机制，分别为RDB、AOF实现，RDB采用定时（全量）持久化机制，但是服务器因为某种原因宕机后可能数据会丢失，AOF是基于数据操作日志实现的持久化，所以AOF采用增量同步的方案。  
Redis已经帮助我默认开启了rdb存储。

Redis的RDB与AOF同步配置
-----------------

### RDB

Redis默认采用rdb方式实现数据的持久化，以快照的形式将数据持久化到磁盘的是一个二进制的文件dump.rdb， 在redis.conf文件中搜索"dump.rdb"。  
Redis会将数据集的快照dump到dump.rdb文件中。此外，我们也可以通过配置文件来修改Redis服务器dump快照的频率，在打开6379.conf文件之后，我们搜索save，可以看到下面的配置信息：  
![](https://img2023.cnblogs.com/blog/1504668/202301/1504668-20230113224617219-2142673561.png)  
save 900 1 #在900秒(15分钟)之后，如果至少有1个key发生变化，则dump内存快照。  
save 300 10 #在300秒(5分钟)之后，如果至少有10个key发生变化，则dump内存快照。  
save 60 10000 #在60秒(1分钟)之后，如果至少有10000个key发生变化，则dump内存快照。  
Set(包含增加和覆盖)、del  
Set name yushengjun  
Set name mayikt  
Del name  
![](https://img2023.cnblogs.com/blog/1504668/202301/1504668-20230113230549567-1554782652.png)

### Aof

Aof是以执行命令的形式实现同步，在Redis的配置文件中存在三种同步方式，它们分别是：  
appendfsync always #每次有数据修改发生时都会写入AOF文件，能够保证数据不丢失，但是效率非常低。  
appendfsync everysec #每秒钟同步一次，可能会丢失1s内的数据，但是效率非常高。  
appendfsync no #从不同步。高效但是数据不会被持久化。  
直接修改redis.conf中 appendonly yes  
建议最好还是使用everysec 既能够保证数据的同步、效率也还可以。  
![](https://img2023.cnblogs.com/blog/1504668/202301/1504668-20230113225337262-1298587399.png)

MySQL与Redis一致性解决同步问题
--------------------

方式1：直接清除Redis的缓存，重新读取数据库即可  
方式2：使用mq异步订阅mysql binlog实现增量同步  
方式3：使用alibaba的canal  

aof重写/压缩机制
----------

参考文章：https://baijiahao.baidu.com/s?id=1703595719672597505&wfr=spider&for=pc  
声明：本文参考蚂蚁课堂。