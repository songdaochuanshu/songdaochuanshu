---
layout: post
title: "é«˜æ•ˆç†è§£ FreeSql WhereDynamicFilterï¼Œæ·±å…¥äº†è§£è®¾è®¡åˆè¡·[.NET ORM]"
date: "2022-07-17T15:18:07.064Z"
---
é«˜æ•ˆç†è§£ FreeSql WhereDynamicFilterï¼Œæ·±å…¥äº†è§£è®¾è®¡åˆè¡·\[.NET ORM\]
====================================================

å°æ—¶å€™å­¦ä¹ ç¼–ç¨‹ï¼Œè€å¸ˆç»å¸¸æ•™å¯¼æˆ‘ä»¬ï¼Œç¨‹åº = æ•°æ®ç»“æ„ + ç®—æ³•ï¼Œä»Šå¤©å°±ä»¥æˆ‘è‡ªèº«çš„è®¤çŸ¥è®²è§£è¯¥åŠŸèƒ½çš„å®Œæ•´è®¾è®¡è¿‡ç¨‹ï¼Œå…¶ä¸­åŒ…å«æ•°æ®ç»“æ„å’Œç®—æ³•ã€‚å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆObject Relational Mappingï¼Œç®€ç§°ORMï¼‰æ¨¡å¼æ˜¯ä¸€ç§ä¸ºäº†è§£å†³é¢å‘å¯¹è±¡ä¸å…³ç³»æ•°æ®åº“å­˜åœ¨çš„äº’ä¸åŒ¹é…çš„ç°è±¡çš„æŠ€æœ¯ã€‚ç®€å•çš„è¯´ï¼ŒORMæ˜¯é€šè¿‡ä½¿ç”¨æè¿°å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´æ˜ å°„çš„å…ƒæ•°æ®ï¼Œå°†ç¨‹åºä¸­çš„å¯¹è±¡è‡ªåŠ¨æŒä¹…åŒ–åˆ°å…³ç³»æ•°æ®åº“ä¸­ã€‚FreeSql æœ‰ä¸€ä¸ªç”¨æˆ·å¾ˆè¿·çš„åŠŸèƒ½ WhereDynamicFilter åŠ¨æ€è¡¨æ ¼æŸ¥è¯¢ï¼Œæœ¬æ–‡è®²è§£å®ƒçš„è®¾è®¡åˆè¡·ï¼Œå¦‚ä½•é«˜æ•ˆç†è§£ï¼Œä»æ­¤ä¸å†è¿·æƒ‘ã€‚

ğŸ’» å‰è¨€
-----

æœ€è¿‘å‡ ä¹æ¯å¤©40åº¦ï¼Œè¶Šçƒ­è¶Šä¸æƒ³é¢å¯¹ç”µè„‘ï¼Œè¿˜å¥½å¼€æºé¡¹ç›®éƒ½æ¯”è¾ƒç¨³å®šæ²¡é‚£ä¹ˆå¤šå¾…è§£å†³é—®é¢˜ï¼Œè¶ç€æš‘å‡å¸¦ç€å¥³å„¿å­¦ä¹ æ¸¸æ³³å·²ç•¥æœ‰å°æˆã€‚æ¸¸æ³³å¥½å¤„å¤ªå¤šäº†ï¼Œå»ºè®®æœ‰å­©å­çš„éƒ½å»å­¦å­¦ï¼Œæˆ‘æ˜¯åœ¨å²¸è¾¹æŒ‡å¯¼å¤§çº¦ä¸€å‘¨å·¦å³å°±å­¦ä¼šäº†ï¼Œç›®å‰å¯æ¸¸200ç±³ã€‚

FreeSql æœ‰ä¸€ä¸ªç”¨æˆ·å¾ˆè¿·çš„åŠŸèƒ½ WhereDynamicFilter åŠ¨æ€è¡¨æ ¼æŸ¥è¯¢ï¼Œæœ¬æ–‡è®²è§£å®ƒçš„è®¾è®¡åˆè¡·ï¼Œå¦‚ä½•é«˜æ•ˆç†è§£ï¼Œä»æ­¤ä¸å†è¿·æƒ‘ã€‚

å°æ—¶å€™å­¦ä¹ ç¼–ç¨‹ï¼Œè€å¸ˆç»å¸¸æ•™å¯¼æˆ‘ä»¬ï¼Œç¨‹åº = æ•°æ®ç»“æ„ + ç®—æ³•ï¼Œä»Šå¤©å°±ä»¥æˆ‘è‡ªèº«çš„è®¤çŸ¥è®²è§£è¯¥åŠŸèƒ½çš„å®Œæ•´è®¾è®¡è¿‡ç¨‹ï¼Œå…¶ä¸­åŒ…å«æ•°æ®ç»“æ„å’Œç®—æ³•ã€‚

è‡ªä»ç¼–å†™äº†.NET ORM å¼€æºé¡¹ç›®ï¼Œæ¯æ¬¡å†™æ–‡ç« å¿…æœ‰é»‘å­ï¼Œä¸Šæ¬¡å‘è¡¨çš„æ–‡ç« è¯„è®ºï¼š

[ã€Š\[å¼€æºç²¾å“\] .NET Redis Client åˆå¤šäº†ä¸€ä¸ªé€‰æ‹©ã€‹](https://www.cnblogs.com/FreeSql/p/16455983.html)

> @China-Mr-zhongè¯´ï¼šå†™çš„é¡¹ç›® éƒ½å¾ˆçƒ‚ æ€ä¹ˆå¥½æ„æ€ è¯´æ˜¯ç²¾å“

> @FreeSqlå›å¤ï¼š

> ![](https://img2022.cnblogs.com/blog/1694977/202207/1694977-20220708145228877-895387955.png)

> é»‘å­ï¼Œå¿«å›å»å…ˆå­¦ä¸‹åšäººï¼Œé»‘å®Œä¸€æ¬¡åˆä¸€æ¬¡ï¼Œä½ ä»£ç å†™å¾—çœŸå¥½ã€‚

åŸæ¥ä»–ä¹Ÿæ˜¯ ORM ä½œè€…ï¼Œå¼€æºä½œå“ï¼šFast.Framework

è€Œæˆ‘ä¸Šæ¬¡å‘è¡¨çš„æ–‡ç« å¹¶é ORM å•Šï¼Œé¢å¯¹è¿™æ ·çš„ç¤¾åŒºåœˆå­ï¼Œæœ‰æ—¶å€™çœŸçš„æ— è¯­ï¼Œè¿™æ®µè¢«é»‘çš„å†…å®¹æ˜¯äº‹åç¼–è¾‘çš„ï¼Œå› ä¸ºç°åœ¨è¿™ç¯‡æ–‡ç« å‘è¡¨æ²¡å¤šä¹…å·²ç»æœ‰é»‘å­å¼€å§‹ç‚¹åå¯¹äº†ã€‚

* * *

ğŸŒ³ ORMæ¦‚å¿µ
--------

å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆObject Relational Mappingï¼Œç®€ç§°ORMï¼‰æ¨¡å¼æ˜¯ä¸€ç§ä¸ºäº†è§£å†³é¢å‘å¯¹è±¡ä¸å…³ç³»æ•°æ®åº“å­˜åœ¨çš„äº’ä¸åŒ¹é…çš„ç°è±¡çš„æŠ€æœ¯ã€‚ç®€å•çš„è¯´ï¼ŒORMæ˜¯é€šè¿‡ä½¿ç”¨æè¿°å¯¹è±¡å’Œæ•°æ®åº“ä¹‹é—´æ˜ å°„çš„å…ƒæ•°æ®ï¼Œå°†ç¨‹åºä¸­çš„å¯¹è±¡è‡ªåŠ¨æŒä¹…åŒ–åˆ°å…³ç³»æ•°æ®åº“ä¸­ã€‚

FreeSql æ˜¯ .Net ORMï¼Œèƒ½æ”¯æŒ .NetFramework4.0+ã€.NetCoreã€Xamarinã€MAUIã€Blazorã€ä»¥åŠè¿˜æœ‰è¯´ä¸å‡ºæ¥çš„è¿è¡Œå¹³å°ï¼Œå› ä¸ºä»£ç **ç»¿è‰²æ— ä¾èµ–**ï¼Œæ”¯æŒæ–°å¹³å°éå¸¸ç®€å•ã€‚ç›®å‰å•å…ƒæµ‹è¯•æ•°é‡ï¼š8500+ï¼ŒNugetä¸‹è½½æ•°é‡ï¼š900K+ã€‚QQç¾¤ï¼š4336577(å·²æ»¡)ã€8578575(åœ¨çº¿)ã€52508226(åœ¨çº¿)

FreeSql ä½¿ç”¨æœ€å®½æ¾çš„å¼€æºåè®® MIT [https://github.com/dotnetcore/FreeSql](https://github.com/dotnetcore/FreeSql) ï¼Œå®Œå…¨å¯ä»¥å•†ç”¨ï¼Œæ–‡æ¡£é½å…¨ï¼Œç”šè‡³æ‹¿å»å–é’±ä¹Ÿå¯ä»¥ã€‚

FreeSql ä¸»è¦ä¼˜åŠ¿åœ¨äºæ˜“ç”¨æ€§ä¸Šï¼ŒåŸºæœ¬æ˜¯å¼€ç®±å³ç”¨ï¼Œåœ¨ä¸åŒæ•°æ®åº“ä¹‹é—´åˆ‡æ¢å…¼å®¹æ€§æ¯”è¾ƒå¥½ï¼Œæ•´ä½“çš„åŠŸèƒ½ç‰¹æ€§å¦‚ä¸‹ï¼š

*   æ”¯æŒ CodeFirst å¯¹æ¯”ç»“æ„å˜åŒ–è¿ç§»ï¼›
*   æ”¯æŒ DbFirst ä»æ•°æ®åº“å¯¼å…¥å®ä½“ç±»ï¼›
*   æ”¯æŒ ä¸°å¯Œçš„è¡¨è¾¾å¼å‡½æ•°ï¼Œè‡ªå®šä¹‰è§£æï¼›
*   æ”¯æŒ æ‰¹é‡æ·»åŠ ã€æ‰¹é‡æ›´æ–°ã€BulkCopyï¼›
*   æ”¯æŒ å¯¼èˆªå±æ€§ï¼Œè´ªå©ªåŠ è½½ã€å»¶æ—¶åŠ è½½ã€çº§è”ä¿å­˜ï¼›
*   æ”¯æŒ è¯»å†™åˆ†ç¦»ã€åˆ†è¡¨åˆ†åº“ï¼Œç§Ÿæˆ·è®¾è®¡ï¼›
*   æ”¯æŒ MySql/SqlServer/PostgreSQL/Oracle/Sqlite/Firebird/è¾¾æ¢¦/ç¥é€š/äººå¤§é‡‘ä»“/ç¿°é«˜/Clickhouse/MsAccess Ado.net å®ç°åŒ…ï¼Œä»¥åŠ Odbc çš„ä¸“é—¨å®ç°åŒ…ï¼›

8500+ä¸ªå•å…ƒæµ‹è¯•ä½œä¸ºåŸºè°ƒï¼Œæ”¯æŒ10å¤šæ•°æ•°æ®åº“ï¼Œæˆ‘ä»¬æä¾›äº†é€šç”¨Odbcç†è®ºä¸Šæ”¯æŒæ‰€æœ‰æ•°æ®åº“ï¼Œç›®å‰å·²çŸ¥æœ‰ç¾¤å‹ä½¿ç”¨ FreeSql æ“ä½œåä¸ºé«˜æ–¯ã€mycatã€tidb ç­‰æ•°æ®åº“ã€‚å®‰è£…æ—¶åªéœ€è¦é€‰æ‹©å¯¹åº”çš„æ•°æ®åº“å®ç°åŒ…ï¼š

> dotnet add packages FreeSql.Provider.MySql

* * *

ğŸ£ éœ€æ±‚çŸ›ç›¾
-------

è™½ç„¶ ORM æœ‰ç†è®ºå®šä¹‰æ”¯æ’‘ï¼Œä½†å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéš¾å…é‡åˆ°åŠ¨æ€æŸ¥è¯¢çš„éœ€æ±‚ï¼Œå¸¸è§çš„æœ‰åå°ç®¡ç†ç³»ç»Ÿç”¨æˆ·è‡ªå®šä¹‰è¿‡æ»¤æŸ¥è¯¢ï¼Œå¦‚ï¼š

![](https://img2022.cnblogs.com/blog/1694977/202207/1694977-20220716201401339-2132602358.png)

é‰´äºå®é™…ä¸ç†è®ºçš„çŸ›ç›¾ï¼Œå¯¼è‡´å¾ˆå¤šéå¸¸å®ç”¨çš„åŠŸèƒ½ç±»åº“è®©ä¸€äº›äººè¯Ÿç—…ï¼ŒæŒ‡è¿™æ˜¯ SqlHelperï¼Œå¹¶é ORMï¼Œåœ¨æ­¤ä¸ä¾¿ç†è®ºï¼ŒåŠŸè¿‡è‡ªåœ¨äººå¿ƒã€‚

* * *

ğŸ“° æ•°æ®ç»“æ„
-------

æ•°æ®ç»“æ„çš„å®šä¹‰ï¼Œå†³å®šäº†åŠŸèƒ½çš„ä½¿ç”¨æ·±åº¦ï¼Œè¿™å—ä¹Ÿå‚è€ƒäº†ä¸€äº›ç«Ÿå“ç±»ä¼¼çš„åŠŸèƒ½ï¼Œå®é™…åœ¨ .NET ORM é¢†åŸŸå¾ˆå°‘æœ‰å®Œç¾å¹¶ç®€å•çš„ç°å®ï¼Œè¦ä¹ˆä½¿ç”¨å¤ªå¤æ‚ï¼Œè¦ä¹ˆä¸æ”¯æŒæ·±å±‚çº§ï¼Œç”šè‡³æœ‰ SQL æ³¨å…¥æ¼æ´ã€‚

ç±»ä¼¼çš„åŠŸèƒ½å…¶å®å¸‚é¢äº§å“åº”ç”¨æŒºå¹¿æ³›ï¼Œå‡ ä¹å·²ç»å½¢æˆäº†ä¸€å¥—æˆç†Ÿçš„äº§å“è§„åˆ™ã€‚å¦‚æœä¸æ˜¯äº²èº«ç»å†è¿‡ç±»ä¼¼äº§å“ï¼Œæ˜¯å¾ˆéš¾å®šä¹‰å‡ºå®Œç¾çš„æ•°æ®ç»“æ„çš„ï¼Œä½œä¸ºä¸€ä¸ªå…¬ä¼—å¼€æºé¡¹ç›®ï¼ŒAPI ä¸€æ—¦ç¡®å®šå†æ”¹æ˜¯éå¸¸ç—›è‹¦çš„å†³å®šï¼Œç”¨æˆ·å‡çº§ä¸å…¼å®¹çš„æƒ…å†µä¸ä»…ä¼šå½±å“ FreeSql å£ç¢‘ï¼Œè¿˜ä¼šè®©ä½¿ç”¨è€…è¿›é€€ä¸¤éš¾ï¼Œåˆ°åº•è¦ä¸è¦å‡çº§ï¼Ÿå¥½åœ¨ FreeSql ä» 2018 å¹´æœ€åˆç†å¿µä¿æŒè‡³ä»Šï¼Œå…³äºå‰åç ´åæ€§å‡çº§å‡ ä¹æ²¡æœ‰ã€‚

æœ€ç»ˆæ ¹æ®å¯¹ SQL é€»è¾‘è¡¨è¾¾å¼çš„ç†è§£ï¼ŒåŠ ä¸Šå‚è€ƒ JAVA ä¸€ä¸ªçŸ¥åçš„åå°å¼€æºæ¡†æ¶ï¼Œå–é•¿è¡¥çŸ­ç¡®å®šäº†æœ€ç»ˆæ•°æ®ç»“æ„ã€‚

è¯´è¿™ä¹ˆå¤šæ— å¤–ä¹ä¸‰ä¸ªé‡ç‚¹ï¼š

1ã€è‡ªå·±ä¸ç†Ÿæ‚‰çš„ï¼Œå¤šæ–¹é¢å­¦ä¹ ï¼Œæ¥çº³æ›´æˆç†Ÿçš„æ–¹æ¡ˆï¼›

2ã€è‡ªå·±è¦æ˜¯æ²¡æƒ³å¥½æ€ä¹ˆåšï¼Œå¤šè§‚å¯Ÿå†åšï¼›

3ã€å¤šæ€è€ƒç”¨æˆ·åœºæ™¯ï¼›

æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„åœºæ™¯æœ‰ä»¥ä¸‹å‡ ç§ï¼š

1ã€WHERE id = 1

    {
        "Field": "id",
        "Operator": "Equals",
        "Value": 1
    }
    

2ã€WHERE id = 1 AND id = 2

    {
        "Logic": "And",
        "Filters":
        [
            {
                "Field": "id",
                "Operator": "Equals",
                "Value": 1
            },
            {
                "Field": "id",
                "Operator": "Equals",
                "Value": 2
            }
        ]
    }
    

3ã€WHERE id IN (1,2)

    {
        "Field": "id",
        "Operator": "Contains",
        "Value": [1,2] //æˆ–è€… "1,2"
    }
    

4ã€WHERE id = 1 OR id = 2

    {
        "Logic": "Or",
        "Filters":
        [
            {
                "Field": "id",
                "Operator": "Equals",
                "Value": 1
            },
            {
                "Field": "id",
                "Operator": "Equals",
                "Value": 2
            }
        ]
    }
    

5ã€WHERE id = 1 AND (id = 2 OR id = 3)

æ³¨æ„ä¼˜å…ˆçº§ï¼Œå®ƒä¸æ˜¯ id = 1 AND id = 2 OR id = 3

    {
        "Logic": "And",
        "Filters":
        [
            {
                "Field": "id",
                "Operator": "Equals",
                "Value": 1
            },
            {
                "Logic": "Or",
                "Filters":
                [
                    {
                        "Field": "id",
                        "Operator": "Equals",
                        "Value": 2
                    },
                    {
                        "Field": "id",
                        "Operator": "Equals",
                        "Value": 3
                    }
                ]
            }
        ]
    }
    

ç¬¬5ä¸ªä¾‹å­æœ€ç‰¹åˆ«ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ WhereDynamicFilter æ•°æ®ç»“æ„å®šä¹‰æˆæ ‘å‹çš„ä¸»è¦åŸå› ã€‚

å…³äº Operator æˆ‘ä»¬éœ€è¦ä»¥ä¸‹ä½¿ç”¨åœºæ™¯ï¼š

*   Contains/StartsWith/EndsWith/NotContains/NotStartsWith/NotEndsWithï¼šåŒ…å«/ä¸åŒ…å«ï¼Œlike '%xx%'ï¼Œæˆ–è€… like 'xx%'ï¼Œæˆ–è€… like '%xx'
*   Equal/NotEqualï¼šç­‰äº/ä¸ç­‰äº
*   GreaterThan/GreaterThanOrEqualï¼šå¤§äº/å¤§äºç­‰äº
*   LessThan/LessThanOrEqualï¼šå°äº/å°äºç­‰äº
*   Rangeï¼šèŒƒå›´æŸ¥è¯¢
*   DateRangeï¼šæ—¥æœŸèŒƒå›´ï¼Œæœ‰ç‰¹æ®Šå¤„ç† value\[1\] + 1
*   Any/NotAnyï¼šæ˜¯å¦ç¬¦åˆ value ä¸­ä»»ä½•ä¸€é¡¹ï¼ˆç›´ç™½çš„è¯´æ˜¯ SQL INï¼‰
*   Customï¼šè‡ªå®šä¹‰è§£æ

æœ€ç»ˆå®Œæ•´çš„ c# æ•°æ®ç»“æ„ç±»å®šä¹‰å¦‚ä¸‹ï¼š

    /// <summary>
    /// åŠ¨æ€è¿‡æ»¤æ¡ä»¶
    /// </summary>
    [Serializable]
    public class DynamicFilterInfo
    {
        /// <summary>
        /// å±æ€§åï¼šName
        /// å¯¼èˆªå±æ€§ï¼šParent.Name
        /// å¤šè¡¨ï¼šb.Name
        /// </summary>
        public string Field { get; set; }
        /// <summary>
        /// æ“ä½œç¬¦
        /// </summary>
        public DynamicFilterOperator Operator { get; set; }
        /// <summary>
        /// å€¼
        /// </summary>
        public object Value { get; set; }
    
        /// <summary>
        /// Filters ä¸‹çš„é€»è¾‘è¿ç®—ç¬¦
        /// </summary>
        public DynamicFilterLogic Logic { get; set; }
        /// <summary>
        /// å­è¿‡æ»¤æ¡ä»¶ï¼Œå®ƒä¸å½“å‰çš„é€»è¾‘å…³ç³»æ˜¯ And
        /// æ³¨æ„ï¼šå½“å‰ Field å¯ä»¥ç•™ç©º
        /// </summary>
        public List<DynamicFilterInfo> Filters { get; set; }
    }
    
    public enum DynamicFilterLogic { And, Or }
    public enum DynamicFilterOperator
    {
        /// <summary>
        /// like
        /// </summary>
        Contains,
        StartsWith,
        EndsWith,
        NotContains,
        NotStartsWith,
        NotEndsWith,
    
        /// <summary>
        /// =
        /// Equal/Equals/Eq æ•ˆæœç›¸åŒ
        /// </summary>
        Equal,
        /// <summary>
        /// =
        /// Equal/Equals/Eq æ•ˆæœç›¸åŒ
        /// </summary>
        Equals,
        /// <summary>
        /// =
        /// Equal/Equals/Eq æ•ˆæœç›¸åŒ
        /// </summary>
        Eq,
        /// <summary>
        /// <>
        /// </summary>
        NotEqual,
    
        /// <summary>
        /// >
        /// </summary>
        GreaterThan,
        /// <summary>
        /// >=
        /// </summary>
        GreaterThanOrEqual,
        /// <summary>
        /// <
        /// </summary>
        LessThan,
        /// <summary>
        /// <=
        /// </summary>
        LessThanOrEqual,
    
        /// <summary>
        /// >= and <
        /// æ­¤æ—¶ Value çš„å€¼æ ¼å¼ä¸ºé€—å·åˆ†å‰²ï¼švalue1,value2 æˆ–è€…æ•°ç»„
        /// </summary>
        Range,
    
        /// <summary>
        /// >= and <
        /// æ­¤æ—¶ Value çš„å€¼æ ¼å¼ä¸ºé€—å·åˆ†å‰²ï¼šdate1,date2 æˆ–è€…æ•°ç»„
        /// è¿™æ˜¯ä¸“é—¨ä¸ºæ—¥æœŸèŒƒå›´æŸ¥è¯¢å®šåˆ¶çš„æ“ä½œç¬¦ï¼Œå®ƒä¼šå¤„ç† date2 + 1ï¼Œæ¯”å¦‚ï¼š
        /// å½“ date2 é€‰æ‹©çš„æ˜¯ 2020-05-30ï¼Œé‚£æŸ¥è¯¢çš„æ—¶å€™æ˜¯ < 2020-05-31
        /// å½“ date2 é€‰æ‹©çš„æ˜¯ 2020-05ï¼Œé‚£æŸ¥è¯¢çš„æ—¶å€™æ˜¯ < 2020-06
        /// å½“ date2 é€‰æ‹©çš„æ˜¯ 2020ï¼Œé‚£æŸ¥è¯¢çš„æ—¶å€™æ˜¯ < 2021
        /// å½“ date2 é€‰æ‹©çš„æ˜¯ 2020-05-30 12ï¼Œé‚£æŸ¥è¯¢çš„æ—¶å€™æ˜¯ < 2020-05-30 13
        /// å½“ date2 é€‰æ‹©çš„æ˜¯ 2020-05-30 12:30ï¼Œé‚£æŸ¥è¯¢çš„æ—¶å€™æ˜¯ < 2020-05-30 12:31
        /// å¹¶ä¸” date2 åªæ”¯æŒä»¥ä¸Š 5 ç§æ ¼å¼ (date1 æ²¡æœ‰é™åˆ¶)
        /// </summary>
        DateRange,
    
        /// <summary>
        /// in (1,2,3)
        /// æ­¤æ—¶ Value çš„å€¼æ ¼å¼ä¸ºé€—å·åˆ†å‰²ï¼švalue1,value2,value3... æˆ–è€…æ•°ç»„
        /// </summary>
        Any,
        /// <summary>
        /// not in (1,2,3)
        /// æ­¤æ—¶ Value çš„å€¼æ ¼å¼ä¸ºé€—å·åˆ†å‰²ï¼švalue1,value2,value3... æˆ–è€…æ•°ç»„
        /// </summary>
        NotAny,
    
        /// <summary>
        /// è‡ªå®šä¹‰è§£æï¼Œæ­¤æ—¶ Field ä¸ºåå°„ä¿¡æ¯ï¼ŒValue ä¸ºé™æ€æ–¹æ³•çš„å‚æ•°(string)
        /// ç¤ºèŒƒï¼š{ Operator: "Custom", Field: "RawSql webapp1.DynamicFilterCustom,webapp1", Value: "(id,name) in ((1,'k'),(2,'m'))" }
        /// æ³¨æ„ï¼šä½¿ç”¨è€…è‡ªå·±æ‰¿æ‹…ã€æ³¨å…¥é£é™©ã€‘
        /// é™æ€æ–¹æ³•å®šä¹‰ç¤ºèŒƒï¼š
        /// namespace webapp1
        /// {
        /// public class DynamicFilterCustom
        /// {
        /// [DynamicFilterCustom]
        /// public static string RawSql(object sender, string value) => value;
        /// }
        /// }
        /// </summary>
        Custom
    }
    
    /// <summary>
    /// æˆæƒ DynamicFilter æ”¯æŒ Custom è‡ªå®šä¹‰è§£æ
    /// </summary>
    [AttributeUsage(AttributeTargets.Method)]
    public class DynamicFilterCustomAttribute : Attribute { }
    

* * *

ğŸ“¡ å®‰å…¨è€ƒè™‘
-------

ç”±äº ISelect.WhereDynamicFilter æ–¹æ³•å®ç°åŠ¨æ€è¿‡æ»¤æ¡ä»¶ï¼ˆä¸å‰ç«¯äº¤äº’ï¼‰ï¼Œåœ¨ SQL æ³¨å…¥å®‰å…¨é˜²å¾¡è¿™å—ä¸€å®šè¦è¿›è¡Œåˆ°åº•ï¼Œä¸»è¦æ€è€ƒå¦‚ä¸‹ï¼š

1ã€Field åªå…è®¸ä¼ é€’ c# å®ä½“å±æ€§åï¼ˆä¸æ”¯æŒä½¿ç”¨æ•°æ®åº“å­—æ®µåï¼Œç”šè‡³ç›´æ¥ä½¿ç”¨ SQL å†…å®¹ç‰‡æ®µï¼‰ï¼›

2ã€Operator åªå…è®¸è§„å®šçš„æšä¸¾æ“ä½œç±»å‹ï¼›

3ã€Value å¿…é¡»æ ¹æ® Operator è¿›è¡Œå¼ºåˆ¶ç±»å‹æ£€æŸ¥ï¼Œæ¯”å¦‚ "1,2" + Any æ£€ç´¢å‡ºæ¥çš„æ•°æ®æ˜¯ int\[\] { 1,2 }ï¼›

4ã€Operator Custom ç±»å‹æ”¯æŒç”¨æˆ·è‡ªè¡Œæ‰©å±•ï¼Œå¯ç°å®æ›´è‡ªç”±çš„æŸ¥è¯¢ï¼›

* * *

âš¡ ç®—æ³•
----

å¦‚æœæŠŠæ•°æ®ç»“æ„å®šä¹‰æˆçµé­‚ï¼Œé‚£ç®—æ³•å°±æ˜¯é©±å£³ï¼Œå®ç° WhereDynamicFilter çš„æ ¸å¿ƒç®—æ³•æ˜¯é€’å½’æ ‘ç»“æ„ã€‚

æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç›´æ¥å»æºç æŸ¥çœ‹å®ç°ï¼š[https://github.com/dotnetcore/FreeSql](https://github.com/dotnetcore/FreeSql)

* * *

ğŸŒŒ éš¾ç†è§£
------

WhereDynamicFilter åŠŸèƒ½2020å¹´ä¸Šçº¿åˆ°ç°åœ¨ï¼Œæˆ‘ä¸ªäººéƒ½è§‰å¾—å…¶å®è›®éš¾ç†è§£çš„ï¼Œæ›´ä¸è¦æå¾ˆå¤šä½¿ç”¨è€…åé¦ˆã€‚ä¸»è¦åŸå› æ˜¯æ•°æ®ç»“æ„ä¸ºæ ‘ç»“æ„ï¼Œé€šå¸¸80%çš„äººåªæ˜¯ç®€å•çš„ä¸€å±‚ AND/OR éœ€æ±‚ï¼Œä»–ä»¬å¾ˆå°‘ä¼šé‡åˆ°æ·±å±‚çº§çš„è‡ªå®šä¹‰æŸ¥è¯¢ã€‚

ä½†æ˜¯ä½œä¸ºåŠŸèƒ½æ€§ ORM ç±»åº“ï¼Œåº”è¯¥æ»¡è¶³æ›´å¤šé€‚ç”¨èŒƒå›´ï¼Œè€Œä¸æ˜¯å¦¥åä¸ºæ±‚ç®€å•æ¥å®ç°åŠŸèƒ½ã€‚

å…¶å®ä¾¿äºç†è§£ä¹Ÿä¸éš¾ï¼Œåªè¦æŒæ¡ä»¥ä¸‹æ–¹æ³•ï¼š

1ã€Logic æ˜¯è®¾ç½® Filters æ•°ç»„ä¸‹çš„é€»è¾‘å…³ç³»ï¼ˆè¿™å¾ˆé‡è¦ï¼Œä¸€å®šè¦ç†è§£æ­£ç¡®ï¼‰

> ä¸ºäº†è§£å†³ WHERE id = 1 AND (id = 2 OR id = 3) ä¼˜å…ˆçº§é—®é¢˜ï¼ŒFilters æ›´åƒä¸€å¯¹æ‹¬å·

    {
        "Logic": "And",
        "Filters":
        [
            { "Field": "id", "Operator": "Equals", "Value": 1 },
            {
                "Logic": "Or",
                "Filters":
                [
                    { "Field": "id", "Operator": "Equals", "Value": 2 },
                    { "Field": "id", "Operator": "Equals", "Value": 3 }
                ]
            }
        ]
    }
    

2ã€Field/Operator/Value ä¸ Logic/Filters ä¸è¦åŒæ—¶è®¾ç½®ï¼ˆé¿å…ç†è§£å›°éš¾ï¼‰

3ã€åˆ é™¤ JSON ä¸­ä¸å¿…è¦çš„å†…å®¹

è¿™ä¸ªç—…ä¸å¥½æ²»ï¼Œå› ä¸ºå¼ºç±»å‹å¯¹è±¡äº§ç”Ÿçš„é»˜è®¤ json å†…å®¹ï¼Œå³ä½¿æ— ç”¨çš„å±æ€§ä¹Ÿåºåˆ—åŒ–äº†ã€‚

    {
        "Field": null,
        "Operator": "And",
        "Value": null,
        "Logic": "Or",
        "Filters":
        [
            {
                "Field": "Name-1",
                "Operator": "Equals",
                "Value": "ye-01",
                "Logic": "And",
                "Fitlers": null
            },
            {
                "Field": "Name-1",
                "Operator": "Equals",
                "Value": "ye-02",
                "Logic": "And",
                "Fitlers": null
            }
        ]
    }
    

ä»¥ä¸Šç±»å‹æ”¹æˆå¦‚ä¸‹ï¼Œæ˜¯ä¸æ˜¯æ›´å¥½ç†è§£ï¼Ÿ

    {
        "Logic": "Or",
        "Filters":
        [
            {
                "Field": "Name-1",
                "Operator": "Equals",
                "Value": "ye-01"
            },
            {
                "Field": "Name-1",
                "Operator": "Equals",
                "Value": "ye-02"
            }
        ]
    }
    

* * *

ğŸš€ æœ€ç»ˆåŠŸèƒ½
-------

ä¸€ä¸ªä»»æ„å®šåˆ¶çš„é«˜çº§æŸ¥è¯¢åŠŸèƒ½é¢„è§ˆå¦‚ä¸‹ï¼š

![](https://img2022.cnblogs.com/blog/1694977/202207/1694977-20220716211204771-1986820466.png)

å‰ç«¯åªéœ€è¦æŒ‰è¦æ±‚ç»„è£…å¥½ DynamicFilterInfo å¯¹åº”çš„ JSON æ•°æ®å†…å®¹ï¼Œåå°å°±å¯è½»æ˜“å®Œæˆé«˜çº§è¿‡æ»¤æŸ¥è¯¢ï¼Œæœ‰å¤šè½»æ˜“å‘¢ï¼Ÿ

    var dyfilter = JsonConvert.DeserializeObject<DynamicFilterInfo>(jsonText);
    
    var list = fsql.Select<T>().WhereDynamicFilter(dyfilter).ToList();
    

* * *

â›³ ç»“æŸè¯­
-----

å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©å¤§å®¶ä» WhereDynamicFilter çš„è®¾è®¡åˆè¡·ï¼Œè½»æ¾ç†è§£å¹¶ç†Ÿç»ƒæŒæ¡å®ƒï¼Œä¸ºä¼ä¸šçš„é¡¹ç›®ç ”å‘è´¡çŒ®åŠ›é‡ã€‚

å¼€æºåœ°å€ï¼š[https://github.com/dotnetcore/FreeSql](https://github.com/dotnetcore/FreeSql)

* * *

ä½œè€…æ˜¯ä»€ä¹ˆäººï¼Ÿ

ä½œè€…æ˜¯ä¸€ä¸ªå…¥è¡Œ 18å¹´çš„è€æ‰¹ï¼Œä»–ç›®å‰å†™çš„.net å¼€æºé¡¹ç›®æœ‰ï¼š

å¼€æºé¡¹ç›®

æè¿°

å¼€æºåœ°å€

å¼€æºåè®®

ImCore

æ¶æ„æœ€ç®€å•ï¼Œæ‰©å±•æ€§æœ€å¼ºçš„èŠå¤©ç³»ç»Ÿæ¶æ„

[https://github.com/2881099/im](https://github.com/2881099/im)

æœ€å®½æ¾çš„ MIT åè®®ï¼Œå¯å•†ç”¨

FreeRedis

æœ€ç®€å•çš„ RediscClient

[https://github.com/2881099/FreeRedis](https://github.com/2881099/FreeRedis)

æœ€å®½æ¾çš„ MIT åè®®ï¼Œå¯å•†ç”¨

csredis

[https://github.com/2881099/csredis](https://github.com/2881099/csredis)

æœ€å®½æ¾çš„ MIT åè®®ï¼Œå¯å•†ç”¨

FightLandlord

æ–—åœ°ä¸»å•æœºæˆ–ç½‘ç»œç‰ˆ

[https://github.com/2881099/FightLandlord](https://github.com/2881099/FightLandlord)

æœ€å®½æ¾çš„ MIT åè®®ï¼Œå­¦ä¹ ç”¨é€”

IdleScheduler

å®šæ—¶ä»»åŠ¡

[https://github.com/2881099/IdleBus/tree/master/IdleScheduler](https://github.com/2881099/IdleBus/tree/master/IdleScheduler)

æœ€å®½æ¾çš„ MIT åè®®ï¼Œå¯å•†ç”¨

IdleBus

ç©ºé—²å®¹å™¨

[https://github.com/2881099/IdleBus](https://github.com/2881099/IdleBus)

æœ€å®½æ¾çš„ MIT åè®®ï¼Œå¯å•†ç”¨

FreeSql

å›½äº§æœ€å¥½ç”¨çš„ ORM

[https://github.com/dotnetcore/FreeSql](https://github.com/dotnetcore/FreeSql)

æœ€å®½æ¾çš„ MIT åè®®ï¼Œå¯å•†ç”¨

FreeSql.Cloud

åˆ†å¸ƒå¼äº‹åŠ¡tcc/saga

[https://github.com/2881099/FreeSql.Cloud](https://github.com/2881099/FreeSql.Cloud)

æœ€å®½æ¾çš„ MIT åè®®ï¼Œå¯å•†ç”¨

FreeSql.AdminLTE

ä½ä»£ç åå°ç®¡ç†é¡¹ç›®ç”Ÿæˆ

[https://github.com/2881099/FreeSql.AdminLTE](https://github.com/2881099/FreeSql.AdminLTE)

æœ€å®½æ¾çš„ MIT åè®®ï¼Œå¯å•†ç”¨

FreeSql.DynamicProxy

åŠ¨æ€ä»£ç†

[https://github.com/2881099/FreeSql.DynamicProxy](https://github.com/2881099/FreeSql.DynamicProxy)

æœ€å®½æ¾çš„ MIT åè®®ï¼Œå­¦ä¹ ç”¨é€”

éœ€è¦çš„è¯·æ‹¿èµ°ï¼Œè¿™äº›éƒ½æ˜¯æœ€è¿‘å‡ å¹´çš„å¼€æºä½œå“ï¼Œä»¥å‰æ›´æ—©å†™çš„å°±ä¸å‘äº†ã€‚

QQç¾¤ï¼š4336577(å·²æ»¡)ã€8578575(åœ¨çº¿)ã€52508226(åœ¨çº¿)