---
layout: post
title: "How to get the return value of the setTimeout inner function in js All In One"
date: "2022-10-19T09:32:30.837Z"
---
How to get the return value of the setTimeout inner function in js All In One
=============================================================================

![](https://img2022.cnblogs.com/blog/740516/202210/740516-20221019164517460-1171629023.png)How to get the return value of the setTimeout inner function in js All In One åœ¨ js ä¸­å¦‚ä½•è·å– setTimeout å†…éƒ¨å‡½æ•°çš„è¿”å›å€¼

How to get the return value of the `setTimeout` inner function in js All In One
===============================================================================

> åœ¨ js ä¸­å¦‚ä½•è·å– `setTimeout` å†…éƒ¨å‡½æ•°çš„è¿”å›å€¼

âœ… Promise wrap & Async / Await

![](https://img2022.cnblogs.com/blog/740516/202210/740516-20221019164517460-1171629023.png)

raise a question
----------------

> æå‡ºé—®é¢˜

å¦‚ä½•è·å– setTimeout çš„è¿”å›å€¼ï¼Œä»¥ä¾¿å¯ä»¥`è‡ªåŠ¨åŒ–æµ‹è¯•`ï¼Œå³å¯ä»¥ä½¿ç”¨`æµ‹è¯•ç”¨ä¾‹`æ¨¡ç‰ˆï¼Œè·‘é€šæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Ÿ

error

![](https://img2022.cnblogs.com/blog/740516/202210/740516-20221019171954680-1061649406.png)

question analysis
-----------------

> é—®é¢˜åˆ†æ

æ­£å¸¸æ€è·¯ä¸‹ï¼Œæ˜¯ä¸å¯èƒ½å®ç°çš„ï¼Œå› ä¸º setTimeout æ˜¯ä¸€ä¸ªå¼‚æ­¥`å®ä»»åŠ¡`ä¸ä¼šé˜»å¡ js `å•çº¿ç¨‹`çš„æ‰§è¡Œï¼Œä¼˜å…ˆçº§æœ€ä½ï¼Œæœ€åæ‰ä¼šè¢«æ‰§è¡Œï¼›  
æ•…æµ‹è¯•ç”¨ä¾‹ä¸­æ‰§è¡Œè¯»å–ç»“æœçš„ä»£ç é€»è¾‘è·å–ä¸åˆ°å®ƒçš„è¿”å›å€¼ï¼Œå³æµ‹è¯•ä»£ç é€»è¾‘å·²ç»æ‰§è¡Œäº†ï¼Œç»“æœè¿˜æ²¡è¿”å›ï¼›

é‚£æ—¢ç„¶ setTimeout æ˜¯å¼‚æ­¥çš„ï¼Œé‚£å°±æƒ³åŠæ³•é˜»å¡å®ƒï¼Œè®©å®ƒçš„ç»“æœå…ˆè¿”å›ï¼Œç„¶åå†æ‰§è¡Œè¯»å–ç»“æœçš„ä»£ç é€»è¾‘ï¼›  
æ‰€ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°ä½¿ç”¨ `Promise` æŠŠ setTimeout åŒ…è£…æˆä¸€ä¸ª`å¾®ä»»åŠ¡`ï¼Œç„¶åé€šè¿‡ `Async/Await` æ¥è¿›è¡Œ`å¼‚æ­¥æµç¨‹`çš„æ§åˆ¶

Try it out
----------

> å°è¯•éªŒè¯

    "use strict";
    
    /**
     *
     * @author xgqfrms
     * @license MIT
     * @copyright xgqfrms
     * @created 2022-10-18
     * @modified
     *
     * @description js debounce
     * @description  js debounce
     * @difficulty Medium
     * @time_complexity O(n)
     * @space_complexity O(n)
     * @augments
     * @example
     * @link https://www.cnblogs.com/xgqfrms/p/13849482.html
     * @solutions
     *
     * @best_solutions
     *
     */
    
    const log = console.log;
    
    // function debounce(func) {
    //   var id;
    //   return function (args) {
    //     console.log(`args 1 =`, args);
    //     var context = this;
    //     // var args = arguments;
    //     clearTimeout(id);
    //     id = setTimeout(() => {
    //       // func.apply(context, args);
    //       // func.apply(context, [...args]);
    //       func.apply(context, ...args);
    //       // Uncaught TypeError: Spread syntax requires ...iterable[Symbol.iterator] to be a function
    //     });
    //   };
    // };
    
    // function debounce(func, delay) {
    //   let id;
    //   // âœ… ...rest ä¿è¯åœ¨ä¸ä½¿ç”¨ arguments çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ä¸å®šæ•°é‡çš„å‚æ•°
    //   return function (...args) {
    //     console.log(`\nrest args =`, args);
    //     console.log(`rest ...args =`, ...args);
    //     console.log(`rest [...args] =`, [...args]);
    //     let args1 = arguments;
    //     let args2 = Array.prototype.slice.call(arguments, 0);
    //     console.log(`args1 =`, args1);
    //     console.log(`args2 =`, args2);
    //     let context = this;
    //     // let that = this;
    //     clearTimeout(id);
    //     id = setTimeout(() => {
    //       // âœ… apply æ¥å—å‚æ•°æ•°ç»„ [arg1, arg2, ...]
    //       func.apply(context, args);
    //       // func.apply(context, [...args]);
    //       // func.apply(context, ...args);
    //       // Uncaught TypeError: CreateListFromArrayLike called on non-object
    //       // âœ… call æ¥å—å‚æ•°åˆ—è¡¨ (arg1, arg2, ...)
    //       func.call(context, ...args2);
    //     }, delay);
    //   };
    // };
    
    const debounce = (func, delay) => {
      let id;
      // âœ… ...rest ä¿è¯åœ¨ä¸ä½¿ç”¨ arguments çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ä¸å®šæ•°é‡çš„å‚æ•°
      return async (...args) => {
        console.log(`\nrest args =`, args);
        console.log(`rest ...args =`, ...args);
        console.log(`rest [...args] =`, [...args]);
        let context = this;
        // let that = this;
        clearTimeout(id);
        // id = setTimeout(() => {
        //   // âœ… apply æ¥å—å‚æ•°æ•°ç»„ [arg1, arg2, ...]
        //   func.apply(context, args);
        //   // func.apply(context, [...args]);
        //   // âœ… call æ¥å—å‚æ•°åˆ—è¡¨ (arg1, arg2, ...)
        //   // func.call(context, ...args);
        // }, delay);
        const promise = new Promise((resolve, reject) => {
          id = setTimeout(() => {
            resolve(func.apply(context, args));
          }, delay);
        });
        // return promise;
        const result = await(promise);
        console.log(`result`, result);
        return result;
        // js how to get setTimeout inner function return value âœ… promise wrap  & async / await
      };
    };
    
    // function test (a, b, c, d) {
    //   const args = [...arguments];
    //   console.log(`test args =`, args);
    // }
    
    // const fn = debounce(test, 1000);
    
    // fn(1,2,3);
    // // fn(1,2,3,4);
    // fn(1,2,3,4,5);
    
    // æµ‹è¯•ç”¨ä¾‹ test cases
    const testCases = [
      {
        input: [1,2,3],
        result: '1,2,3',
        desc: 'value equal to "1,2,3"',
      },
      {
        input: [1,2,3,4],
        result: '1,2,3,4',
        desc: 'value equal to "1,2,3,4"',
      },
      {
        input: [1,2,3,4,5],
        result: '1,2,3,4,5',
        desc: 'value equal to "1,2,3,4,5"',
      },
    ];
    
    function test (a, b, c, d) {
      const args = [...arguments];
      console.log(`test args =`, args);
      return args;
    }
    
    const func = debounce(test, 1000);
    
    log(`func =`, func);
    // func = [AsyncFunction (anonymous)]
    // func = Promise { [Function (anonymous)] }
    
    
    (async () => {
      for (const [i, testCase] of testCases.entries()) {
        async function testCaseAsyncFunc(i, testCase) {
          const result = await func(...testCase.input);
          log(`result =`, result);
          // result = Promise { <pending> }
          // TypeError: func is not a function
          log(`test case ${i} result: `, result.join() === testCase.result ? `âœ… passed` : `âŒ failed`, result);
          // log(`test case ${i} =`, testCase);
        }
        await testCaseAsyncFunc(i, testCase);
      }
    })();
    
    
    

solutions
---------

> å¾—å‡ºç»“è®º

    "use strict";
    
    /**
     *
     * @author xgqfrms
     * @license MIT
     * @copyright xgqfrms
     * @created 2022-10-18
     * @modified
     *
     * @description How to get the return value of the setTimeout inner function in js All In One
     * @description åœ¨ js ä¸­å¦‚ä½•è·å– setTimeout å†…éƒ¨å‡½æ•°çš„è¿”å›å€¼
     * @difficulty Hard
     * @time_complexity O(n)
     * @space_complexity O(n)
     * @augments
     * @example
     * @link https://www.cnblogs.com/xgqfrms/p/16806941.html
     * @link https://www.cnblogs.com/xgqfrms/p/13849482.html
     * @solutions
     *
     * @best_solutions
     *
     */
    
    const log = console.log;
    
    // 1. no need return value
    /*
    
    function debounce(func, delay) {
      let id;
      // âœ… ...rest ä¿è¯åœ¨ä¸ä½¿ç”¨ arguments çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ä¸å®šæ•°é‡çš„å‚æ•°
      return function (...args) {
        let that = this;
        clearTimeout(id);
        id = setTimeout(() => {
          // âœ… apply æ¥å—å‚æ•°æ•°ç»„ [arg1, arg2, ...]
          func.apply(that, args);
          // func.apply(context, [...args]);
          // âœ… call æ¥å—å‚æ•°åˆ—è¡¨ (arg1, arg2, ...)
          // func.call(context, ...args2);
        }, delay);
      };
    };
    
    function test (a, b, c, d) {
      const args = [...arguments];
      console.log(`test args =`, args);
    }
    
    const fn = debounce(test, 1000);
    
    fn(1,2,3);
    fn(1,2,3,4);
    fn(1,2,3,4,5);
    
    */
    
    // 2. setTimeout with return value
    const debounce = (func, delay) => {
      let id;
      // âœ… ...rest ä¿è¯åœ¨ä¸ä½¿ç”¨ arguments çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ä¸å®šæ•°é‡çš„å‚æ•°
      return async (...args) => {
        console.log(`\nrest args =`, args);
        console.log(`rest ...args =`, ...args);
        console.log(`rest [...args] =`, [...args]);
        let that = this;
        clearTimeout(id);
        const result = await new Promise((resolve, reject) => {
          id = setTimeout(() => {
            // âœ… apply æ¥å—å‚æ•°æ•°ç»„ [arg1, arg2, ...]
            resolve(func.apply(that, args));
          }, delay);
        });
        return result;
        // const promise = new Promise((resolve, reject) => {
        //   id = setTimeout(() => {
        //     // âœ… apply æ¥å—å‚æ•°æ•°ç»„ [arg1, arg2, ...]
        //     resolve(func.apply(that, args));
        //   }, delay);
        // });
        // const result = await(promise);
        // console.log(`result =`, result);
        // return result;
      };
    };
    
    
    // æµ‹è¯•ç”¨ä¾‹ test cases
    const testCases = [
      {
        input: [1,2,3],
        result: '1,2,3',
        desc: 'value equal to "1,2,3"',
      },
      {
        input: [1,2,3,4],
        result: '1,2,3,4',
        desc: 'value equal to "1,2,3,4"',
      },
      {
        input: [1,2,3,4,5],
        result: '1,2,3,4,5',
        desc: 'value equal to "1,2,3,4,5"',
      },
    ];
    
    function test (a, b, c, d) {
      const args = [...arguments];
      console.log(`test args =`, args);
      return args;
    }
    
    const func = debounce(test, 1000);
    
    log(`func =`, func);
    // func = [AsyncFunction (anonymous)]
    
    (async () => {
      for (const [i, testCase] of testCases.entries()) {
        async function testCaseAsyncFunc(i, testCase) {
          const result = await func(...testCase.input);
          log(`result =`, result);
          log(`test case ${i} result: `, result.join() === testCase.result ? `âœ… passed` : `âŒ failed`, result);
          // log(`test case ${i} =`, testCase);
        }
        await testCaseAsyncFunc(i, testCase);
      }
    })();
    
    
    

js debounce & js throttle
-------------------------

> å¦‚ä½•ä½¿ç”¨ js å®ç°ä¸€ä¸ª debounce å‡½æ•° All In One

[https://www.cnblogs.com/xgqfrms/p/13849482.html](https://www.cnblogs.com/xgqfrms/p/13849482.html)

> å¦‚ä½•ä½¿ç”¨ js å®ç°ä¸€ä¸ª throttle å‡½æ•° All In One

[https://www.cnblogs.com/xgqfrms/p/13849487.html](https://www.cnblogs.com/xgqfrms/p/13849487.html)

refs
----

[https://splunktool.com/how-to-make-javascript-settimeout-returns-value-in-a-function](https://splunktool.com/how-to-make-javascript-settimeout-returns-value-in-a-function)

[https://stackoverflow.com/questions/24928846/get-return-value-from-settimeout](https://stackoverflow.com/questions/24928846/get-return-value-from-settimeout)

* * *

* * *

> ### **Â©xgqfrms 2012-2020**
> 
> **www.cnblogs.com/xgqfrms å‘å¸ƒæ–‡ç« ä½¿ç”¨ï¼šåªå…è®¸æ³¨å†Œç”¨æˆ·æ‰å¯ä»¥è®¿é—®ï¼**
> 
> **åŸåˆ›æ–‡ç« ï¼Œç‰ˆæƒæ‰€æœ‰Â©ï¸xgqfrms, ç¦æ­¢è½¬è½½ ğŸˆ²ï¸ï¼Œä¾µæƒå¿…ç©¶âš ï¸ï¼**

* * *

æœ¬æ–‡é¦–å‘äºåšå®¢å›­ï¼Œä½œè€…ï¼š[xgqfrms](https://www.cnblogs.com/xgqfrms/)ï¼ŒåŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/xgqfrms/p/16806941.html](https://www.cnblogs.com/xgqfrms/p/16806941.html)

æœªç»æˆæƒç¦æ­¢è½¬è½½ï¼Œè¿è€…å¿…ç©¶ï¼

* * *