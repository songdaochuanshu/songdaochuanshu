---
layout: post
title: ".env[mode]æ–‡ä»¶ä¸­å¦‚ä½•æ·»åŠ æ³¨é‡Š"
date: "2022-09-22T06:03:32.641Z"
---
.env\[mode\]æ–‡ä»¶ä¸­å¦‚ä½•æ·»åŠ æ³¨é‡Š
=====================

æœ¬æ–‡ä»ŽæŠ›ç –å¼•çŽ‰ï¼Œä»Ž.env\[mode\]æ–‡ä»¶ä¸­å¦‚ä½•æ·»åŠ æ³¨é‡Šå…¥æ‰‹ï¼Œæµ…æž.env\[mode\]æ–‡ä»¶æ˜¯å¦‚ä½•è¢«dotenvæ’ä»¶åŠ è½½å¹¶æ³¨å…¥åˆ°process.envå˜é‡ä¸­çš„ï¼Œæ›´å¤šè¯·è‡ªè¡ŒæŽ¢ç´¢ï¼Œä¸éš¾ã€‚

å‰è¨€
--

`Vue-Cli` å…è®¸æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º`.env.[mode]`æ–‡ä»¶æ¥è®¾ç½®ä¸€äº›æ‰“åŒ…ç¼–è¯‘çš„å¯åŠ¨å‚æ•°ï¼Œé€šè¿‡æ‰§è¡Œè„šæœ¬çš„æ—¶å€™åŠ `mode`å‚æ•°ï¼ŒæŒ‡å®šä¸åŒçŽ¯å¢ƒéœ€è¦åŠ è½½çš„é…ç½®æ–‡ä»¶

å½¢å¦‚ï¼š `.env.prod`

    NODE_ENV='production'
    VUE_APP_PATH='./'
    VUE_APP_RUNTIME='prod'
    

é—®é¢˜
--

æ€Žä¹ˆåœ¨ `.env.prod` æ–‡ä»¶ä¸­æ·»åŠ æ³¨é‡Šå‘¢ï¼Ÿ

åˆ†æž
--

è¿™è¦çœ‹`vue`æ˜¯æ€Žä¹ˆè§£æž `.env.prod` æ–‡ä»¶çš„

é€šè¿‡å¯åŠ¨è„šæœ¬å‚æ•° `--mode prod`ï¼Œä¸€è·¯æ‰¾åˆ°äº†å¤„ç† `.env.prod` æ–‡ä»¶çš„é€»è¾‘ï¼Œè®©æˆ‘ä»¬ä¸€å—çœ‹ä¸‹

`pathï¼šnode_modules\@vue\cli-service\lib\Service.js`

    const dotenv = require('dotenv');
    
    // ...
    
    loadEnv (mode) {
        const logger = debug('vue:env')
        const basePath = path.resolve(this.context, `.env${mode ? `.${mode}` : ``}`)
        const localPath = `${basePath}.local`
    
        const load = envPath => {
          try {
            const env = dotenv.config({ path: envPath, debug: process.env.DEBUG })
            dotenvExpand(env)
            logger(envPath, env)
          } catch (err) {
            // only ignore error if file is not found
            if (err.toString().indexOf('ENOENT') < 0) {
              error(err)
            }
          }
        }
    
        load(localPath)
        load(basePath)
    
        // by default, NODE_ENV and BABEL_ENV are set to "development" unless mode
        // is production or test. However the value in .env files will take higher
        // priority.
        if (mode) {
          // always set NODE_ENV during tests
          // as that is necessary for tests to not be affected by each other
          const shouldForceDefaultEnv = (
            process.env.VUE_CLI_TEST &&
            !process.env.VUE_CLI_TEST_TESTING_ENV
          )
          const defaultNodeEnv = (mode === 'production' || mode === 'test')
            ? mode
            : 'development'
          if (shouldForceDefaultEnv || process.env.NODE_ENV == null) {
            process.env.NODE_ENV = defaultNodeEnv
          }
          if (shouldForceDefaultEnv || process.env.BABEL_ENV == null) {
            process.env.BABEL_ENV = defaultNodeEnv
          }
        }
      }
    

ä»Žä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥å¾—çŸ¥ï¼Œ`vue`ä½¿ç”¨`dotenv`è§£æž `.env.prod` æ–‡ä»¶ï¼Œå¹¶å°†çŽ¯å¢ƒå˜é‡ä»Ž `.env[mode]` æ–‡ä»¶ä¸­åŠ è½½åˆ° `process.env` çŽ¯å¢ƒå˜é‡ä¸­

è§£å†³ï¼ˆdotenvï¼‰
----------

`dotenv`æ’ä»¶å·²ç»è¢« `Vue-Cli` é›†æˆäº†

[GitHubåœ°å€](https://github.com/motdotla/dotenv#rules)

`README.md` ä¸­æœ‰è¿™ä¹ˆä¸€æ®µè¯ï¼š

*   â€œ# marks the beginning of a comment (unless when the value is wrapped in quotes)â€

è¿™å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼Œåœ¨`.env.[mode]` æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `#` è¿›è¡Œæ³¨é‡Š

### ä½¿ç”¨æµ‹è¯•

1.  `path: .env.prod` å‚æ•°é…ç½®

    NODE_ENV='production'
    # VUE_APP_PATH='/pc/'
    VUE_APP_PATH='./'
    VUE_APP_RUNTIME='prod'
    

2.  `package.json` æ–‡ä»¶è„šæœ¬å‘½ä»¤é…ç½®`--mode`å‚æ•°

    "scripts": {
        "build": "vue-cli-service build --mode prod",
      },
    

3.  æ‰§è¡Œ `npm run build` å‘½ä»¤ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š

    NODE_ENV=== production
    VUE_APP_PATH=== ./
    

æœ¬æ–‡åˆ°æ­¤ä¸ºæ­¢ï¼Œè¦æƒ³äº†è§£æ›´å¤š`dotenv`è¯·è‡ªè¡ŒæŽ¢ç´¢ï¼Œæ„Ÿè°¢è§‚çœ‹ðŸ˜‰

* * *

![](https://img2022.cnblogs.com/blog/1037867/202209/1037867-20220922102149330-443776714.png)

æˆ‘æ˜¯ [**ç”œç‚¹cc**](https://blog.i-xiao.space/)

çƒ­çˆ±å‰ç«¯ï¼Œä¹Ÿå–œæ¬¢ä¸“ç ”å„ç§è·Ÿæœ¬èŒå·¥ä½œå…³ç³»ä¸å¤§çš„æŠ€æœ¯ï¼ŒæŠ€æœ¯ã€äº§å“å…´è¶£å¹¿æ³›ä¸”æµ“åŽšï¼Œç­‰å¾…ç€ä¸€ä¸ªåˆ›ä¸šæœºä¼šã€‚ä¸»è¦è‡´åŠ›äºŽåˆ†äº«å®žç”¨æŠ€æœ¯å¹²è´§ï¼Œå¸Œæœ›å¯ä»¥ç»™ä¸€å°éƒ¨åˆ†äººä¸€äº›å¾®å°å¸®åŠ©ã€‚

æˆ‘æŽ’æ–¥â€œæ–°äººè¿·èŒ«ï¼Œè€äººçœ‹æˆâ€çš„çŽ°è±¡ï¼Œå¸Œæœ›èƒ½å’Œå¤§å®¶ä¸€èµ·åŠªåŠ›ç ´å±€ã€‚è¥é€ ä¸€ä¸ªè‰¯å¥½çš„æŠ€æœ¯æ°›å›´ï¼Œä¸ºäº†ä¸ªäººã€ä¸ºäº†æˆ‘å›½çš„æ•°å­—åŒ–è½¬åž‹ã€äº’è”ç½‘ç‰©è”ç½‘æŠ€æœ¯ã€æ•°å­—ç»æµŽå‘å±•åšä¸€ç‚¹ç‚¹è´¡çŒ®ã€‚**æ•°é£Žæµäººç‰©è¿˜çœ‹ä¸­å›½ã€çœ‹ä»Šæœã€çœ‹ä½ æˆ‘ã€‚**

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼š[ç”œç‚¹cc](https://www.cnblogs.com/all-smile/)ï¼Œè½¬è½½è¯·æ³¨æ˜ŽåŽŸæ–‡é“¾æŽ¥ï¼š[https://www.cnblogs.com/all-smile/p/16718289.html](https://www.cnblogs.com/all-smile/p/16718289.html)