---
layout: post
title: "POP3协议（电子邮件邮局协议）中UIDL和TOP命令在实际使用中的作用"
date: "2022-04-11T07:19:02.809Z"
---
POP3协议（电子邮件邮局协议）中UIDL和TOP命令在实际使用中的作用
====================================

POP3是电子邮件协议中用于接收邮件的协议，相较于发送邮件的SMTP协议，POP3的命令要多一些。主要的命令有LIST、STAT、RETR、DELE、UIDL、TOP、QUIT，以及用于登录邮箱的USER和PASS命令。  
   
**介绍POP3命令的文章有很多，这里重点介绍UIDL和TOP在实际使用中的现实意义。**  
   
使用这些命令非常简单，可以用telnet命令进行模拟交互。下面以pop.yeah.net邮箱服务器为例，在命令行模式下输入：

> **telnet pop.yeah.net 110**  
>    
> ![](https://img2022.cnblogs.com/blog/2408155/202204/2408155-20220411135321442-971004274.png)

当用户连接上POP邮件服务器时，会收到服务器返回的欢迎语，接着使用USER和PASS命令登录邮箱，登录成功后，就可以使用其它命令与POP服务器进行在线交互了。  
其中，STAT命令显示邮箱中的邮件数量和所有邮件的大小（以字节为单位）。  
**LIST**命令用于列出邮箱中的所有邮件信息，确切的说是消息摘要，**因为这里的邮件信息并不是指邮件的主题、发件人、收件人等信息**，而只是简单的邮件编号（msgno）和邮件大小。  
这里显示的有8封邮件，由于可能存在多条（多行）消息，因此POP协议中以"."加回车换行（"\\r\\n"）作为整个LIST响应消息的结束，此外接收邮件的RETR命令也是以“.\\r\\n”作为整个邮件的结束。

**显然我们无法通过LIST命令看到邮件具体的摘要信息，比如最重要的邮件主题和发件人。**

TOP命令的作用
--------

此时TOP命令就发挥了作用，该命令用于获取某封邮件的邮件头和邮件体中的前N行内容（**TOP msgno N**）。使用如下命令可以获取邮件头。

> **TOP 1 0**

**注意这里的N是指邮件体中的前N行内容，如果N为0，则表示不返回内容，仅返回邮件头（这里获取邮件编号为1的邮件头）。**  
 

![](https://img2022.cnblogs.com/blog/2408155/202204/2408155-20220411135340227-362810369.png)

邮件头中包含了**主题**（Subject）、**发件人**（From）、**收件人**（To）、**抄送人**（Cc）等重要信息。当然这些信息需要你自己写程序进行逐行解析。

通过**LIST**和**TOP**命令的结合使用，我们就可以快速的查看邮箱中所有邮件的概要信息。这样可以避免将整个邮件全部下载下来。  
当我们看到感兴趣的邮件时（主题和发件人）可以决定是否使用**RETR**命令将整封邮件读取下来；反之，如果是垃圾邮件，则直接使用**DELE**命令将其删除。

UIDL命令的作用
---------

UIDL命令用于查询某封邮件的唯一标识符。  
该命令的现实意义在于：**当你对邮件进行持久化，也就是下载到本地进行离线管理时，可作为识别该邮件的唯一身份ID，从而避免重复下载，并进行有效的本地化管理。**  
通过上面的命令我们可以看到，POP协议是以邮件编号（msgno）作为邮件标识进行在线交互操作，但邮件编号（msgno）只能保证在本次会话中保持唯一，不能保证在下次会话中不会发生变化。如果删除了第1封邮件，并退出重新登录邮箱，邮件的顺序将会打乱。

**附带说明一下**：DELE命令只是将邮件在本次会话中标记为删除，只有在QUIT命令发出时，也就是退出POP会话时，服务器才会进行一次真正的邮件删除操作。  
   
有些人使用邮件客户端程序接收邮件后，并不会从pop服务器上删除邮件。这样可以确保在不同的终端上还能继续查看邮件，比如使用公司的Foxmail接收了邮件，如果回家或出差时，可以使用其它终端设备（笔记本或手机）的邮件客户端程序（比如Outlook）将邮件再下载一遍。这时客户端程序会通过邮件的UIDL来确定该邮件是否已下载过，比如我们可以使用UIDL来作为下载邮件的文件名，如果发现文件已存在，就不需要从POP服务器进行再次读取。  
 

通过**LIST**和**UIDL**命令的结合使用，我们可以对离线邮件（已下载邮件）进行在线比对，**从而判断是否有新邮件需要接收**。  
 

附： 部分常用邮箱使用的UIDL一览
------------------

**qq邮箱**  
![](https://img2022.cnblogs.com/blog/2408155/202204/2408155-20220411135435538-453883607.png)

   
**新浪邮箱**  
![](https://img2022.cnblogs.com/blog/2408155/202204/2408155-20220411135451127-1566189858.png)

   
**网易邮箱**  
![](https://img2022.cnblogs.com/blog/2408155/202204/2408155-20220411135506482-300778150.png)

   
**微软邮箱**  
![](https://img2022.cnblogs.com/blog/2408155/202204/2408155-20220411135528758-402626310.png)

   
**附：**《[**POP3：基于命令行的电子邮件（EMail）在线查看和批量下载工具**](https://www.cnblogs.com/softlee/p/16091637.html)》