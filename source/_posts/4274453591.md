---
layout: post
title: "【Java面试】Zookeeper中的Watch机制的原理？"
date: "2022-05-16T09:19:31.093Z"
---
【Java面试】Zookeeper中的Watch机制的原理？
==============================

> 一个工作了7年的粉丝，遇到了一个Zookeeper的问题。
> 
> 因为接触过Zookeeper这个技术，不知道该怎么回答。
> 
> 我说一个工作了7年的程序员，没有接触过主流技术，这不正常。
> 
> 于是我问了他工资以后，我理解了！
> 
> 好吧，关于“Zookeeper中Watch机制的实现原理”，看看普通人和高手的回答。

普通人：
----

嗯。。。。。。。。。。。。。。。

高手：
---

好的，这个问题我打算从两个方面来回答。

Zookeeper是一个分布式协调组件，为分布式架构下的多个应用组件提供了顺序访问控制能力。

它的数据存储采用了类似于文件系统的树形结构，以节点的方式来管理存储在Zookeeper上的数据。

![image-20220418150841209](https://img2022.cnblogs.com/other/1666682/202205/1666682-20220516163512215-703172142.png)

Zookeeper提供了一个Watch机制，可以让客户端感知到Zookeeper Server上存储的数据变化，这样一种机制可以让Zookeeper实现很多的场景，比如配置中心、注册中心等。

![image-20220418151302479](https://img2022.cnblogs.com/other/1666682/202205/1666682-20220516163512387-1327682059.png)

Watch机制采用了Push的方式来实现，也就是说客户端和Zookeeper Server会建立一个长连接，一旦监听的指定节点发生了变化，就会通过这个长连接把变化的事件推送给客户端。

Watch的具体流程分为几个部分：

*   首先，是客户端通过指定命令比如`exists`、`get`，对特定路径增加watch
    
*   然后服务端收到请求以后，用HashMap保存这个客户端会话以及对应关注的节点路径，同时客户端也会使用HashMap
    
    存储指定节点和事件回调函数的对应关系。
    
*   当服务端指定被watch的节点发生变化后，就会找到这个节点对应的会话，把变化的事件和节点信息发给这个客户端。
    
*   客户端收到请求以后，从ZkWatcherManager里面对应的回调方法进行调用，完成事件变更的通知。
    

![image-20220418152850371](https://img2022.cnblogs.com/other/1666682/202205/1666682-20220516163512571-755918428.png)

以上就是我对这个问题的理解！

总结
--

这个面试题呢，我认为考察的价值也很大，其实对于服务端的数据变更通知，

无非就是pull和push两种方案，而这道题里面涉及到的技术点就是push的实现。

在业务开发里面，也可能会涉及到类似的场景，比如消息通知，扫码登录等。

如果你了解这些思想，那在解决这类问题的时候，会变得更加从容。

本期的普通人VS高手面试系列就到这里结束了。

需要高手面试文档（附赠阿里内部十万字面试文档）或者有不懂的技术面试题想咨询的小伙伴可以私信或者评论区留言。

![file](http://mic-blob-bucket.oss-cn-beijing.aliyuncs.com/27872_4182EE30A79542DE818096095368E1B6)

> 版权声明：本博客所有文章除特别声明外，均采用 CC BY-NC-SA 4.0 许可协议。转载请注明来自 `Mic带你学架构`！  
> 如果本篇文章对您有帮助，还请帮忙点个关注和赞，您的坚持是我不断创作的动力。欢迎关注「跟着Mic学架构」公众号公众号获取更多技术干货！

![](https://img2022.cnblogs.com/other/1666682/202205/1666682-20220516163513012-200120405.png)