---
layout: post
title: "å¦‚ä½•ç²¾ç®€ Prometheus çš„æŒ‡æ ‡å’Œå­˜å‚¨å ç”¨"
date: "2022-11-18T12:35:24.060Z"
---
å¦‚ä½•ç²¾ç®€ Prometheus çš„æŒ‡æ ‡å’Œå­˜å‚¨å ç”¨
========================

å‰è¨€
--

éšç€ Prometheus ç›‘æ§çš„ç»„ä»¶ã€æ•°é‡ã€æŒ‡æ ‡è¶Šæ¥è¶Šå¤šï¼ŒPrometheus å¯¹è®¡ç®—æ€§èƒ½çš„è¦æ±‚ä¼šè¶Šæ¥è¶Šé«˜ï¼Œå­˜å‚¨å ç”¨ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¦ä¼˜åŒ– Prometheus æ€§èƒ½, ä¼˜åŒ–å­˜å‚¨å ç”¨. ç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„å¯èƒ½æ˜¯å„ç§ Prometheus çš„å…¼å®¹å­˜å‚¨æ–¹æ¡ˆ, å¦‚ Thanos æˆ– VMã€Mimir ç­‰ã€‚ä½†æ˜¯å®é™…ä¸Šè™½ç„¶é›†ä¸­å­˜å‚¨ã€é•¿æœŸå­˜å‚¨ã€å­˜å‚¨é™é‡‡æ ·åŠå­˜å‚¨å‹ç¼©å¯ä»¥ä¸€å®šç¨‹åº¦è§£å†³ç›¸å…³é—®é¢˜ï¼Œä½†æ˜¯æ²»æ ‡ä¸æ²»æœ¬ã€‚

*   çœŸæ­£çš„æœ¬ï¼Œè¿˜æ˜¯åœ¨äºæŒ‡æ ‡é‡ï¼ˆseriesï¼‰è¿‡äºåºå¤§ã€‚
*   æ²»æœ¬ä¹‹æ³•ï¼Œåº”è¯¥æ˜¯å‡å°‘æŒ‡æ ‡é‡ã€‚æœ‰ 2 ç§åŠæ³•ï¼š
    *   [Prometheus æ€§èƒ½è°ƒä¼˜ - è§£å†³é«˜åŸºæ•°é—®é¢˜](https://ewhisper.cn/posts/16339/)
    *   æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µï¼Œåªä¿ç•™ï¼ˆkeepï¼‰å±•ç¤ºï¼ˆGrafana Dashboardsï¼‰å’Œå‘Šè­¦ï¼ˆprometheus rulesï¼‰ä¼šç”¨åˆ°çš„æŒ‡æ ‡ã€‚

æœ¬æ¬¡é‡ç‚¹ä»‹ç»ç¬¬äºŒç§åŠæ³•ï¼šå¦‚ä½•æ ¹æ®å®é™…çš„ä½¿ç”¨æƒ…å†µç²¾ç®€ Prometheus çš„æŒ‡æ ‡å’Œå­˜å‚¨å ç”¨ï¼Ÿ

æ€è·¯
--

1.  åˆ†æå½“å‰ Prometheus ä¸­å­˜å‚¨çš„æ‰€æœ‰çš„ metric nameï¼ˆæŒ‡æ ‡é¡¹ï¼‰ï¼›
2.  åˆ†æå±•ç¤ºç¯èŠ‚ç”¨åˆ°çš„æ‰€æœ‰ metric nameï¼Œå³ Grafana çš„ Dashboards ç”¨åˆ°çš„æ‰€æœ‰æŒ‡æ ‡ï¼›
3.  åˆ†æå‘Šè­¦ç¯èŠ‚ç”¨åˆ°çš„æ‰€æœ‰ metric nameï¼Œå³ Prometheus Rule é…ç½®ä¸­ç”¨åˆ°çš„æ‰€æœ‰æŒ‡æ ‡ï¼›
4.  ï¼ˆå¯é€‰ï¼‰åˆ†æè¯Šæ–­ç¯å¢ƒç”¨åˆ°çš„æ‰€æœ‰ metric nameï¼Œå³ç»å¸¸åœ¨ Prometheus UI ä¸Š query çš„æŒ‡æ ‡ï¼›
5.  é€šè¿‡ [`relabel`](https://ewhisper.cn/posts/53316/) åœ¨ `metric_relabel_configs` æˆ– `write_relabel_configs` ä»… `keep` 2-4 ä¸­çš„æŒ‡æ ‡, ä»¥æ­¤å¤§å¹…å‡å°‘ Prometheus éœ€è¦å­˜å‚¨çš„æŒ‡æ ‡é‡.

è¦å…·ä½“å®ç°è¿™ä¸ªæ€è·¯, å¯ä»¥é€šè¿‡ Grafana Labs å‡ºå“çš„ [mimirtool](https://github.com/grafana/mimir/releases) æ¥æå®š.

æˆ‘è¿™é‡Œæœ‰ä¸ªå‰åçš„å¯¹æ¯”æ•ˆæœ, å¯ä¾›å‚è€ƒè¿™æ ·åšæ•ˆæœæœ‰å¤šæƒŠäºº:

1.  ç²¾ç®€å‰: 270336 æ´»åŠ¨ series
2.  ç²¾ç®€å: 61055 æ´»åŠ¨ series
3.  ç²¾ç®€æ•ˆæœ: å°†è¿‘ 5 å€çš„ç²¾ç®€ç‡!

Grafana Mimirtool
-----------------

Grafana Mimir æ˜¯ä¸€æ¬¾ä»¥å¯¹è±¡å­˜å‚¨ä¸ºå­˜å‚¨æ–¹å¼çš„ Prometheus é•¿æœŸå­˜å‚¨è§£å†³æ–¹æ¡ˆ, ä» Cortex æ¼”åŒ–è€Œæ¥. å®˜æ–¹å·ç§°æ”¯æŒäº¿çº§åˆ«çš„ series å†™å…¥å­˜å‚¨å’ŒæŸ¥è¯¢.

Grafana Mimirtool æ˜¯ Mimir å‘å¸ƒçš„ä¸€ä¸ªå®ç”¨å·¥å…·, å¯å•ç‹¬ä½¿ç”¨.

Grafana Mimirtool æ”¯æŒä»ä»¥ä¸‹æ–¹é¢æå–æŒ‡æ ‡:

*   Grafana å®ä¾‹ä¸­çš„Grafana Dashboards(é€šè¿‡ Grafana API)
*   Mimir å®ä¾‹ä¸­çš„ Prometheus alerting å’Œ recording rules
*   Grafana Dashboards JSONæ–‡ä»¶
*   Prometheusè®°alerting å’Œ recording rules çš„ YAMLæ–‡ä»¶

ç„¶åï¼ŒGrafana Mimirtoolå¯ä»¥å°†è¿™äº›æå–çš„æŒ‡æ ‡ä¸Prometheusæˆ–Cloud Prometheuså®ä¾‹ä¸­çš„æ´»åŠ¨ series è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶è¾“å‡ºä¸€ä¸ª `used` æŒ‡æ ‡å’Œ `unused` æŒ‡æ ‡çš„åˆ—è¡¨ã€‚

Prometheus ç²¾ç®€æŒ‡æ ‡å®æˆ˜
-----------------

### å‡è®¾

å‡å®š:

*   é€šè¿‡kube-prometheus-stack å®‰è£… Prometheus
*   å·²å®‰è£… Grafana ä¸”ä½œä¸ºå±•ç¤ºç«¯
*   å·²é…ç½®ç›¸åº”çš„ å‘Šè­¦è§„åˆ™
*   é™¤æ­¤ä¹‹å¤–, æ— å…¶ä»–éœ€è¦é¢å¤–ä¿ç•™çš„æŒ‡æ ‡

### å‰æ

1.  [Grafana Mimirtool](https://github.com/grafana/mimir/releases) ä» releases ä¸­æ‰¾åˆ° mimirtool å¯¹åº”å¹³å°çš„ç‰ˆæœ¬ä¸‹è½½å³å¯ä½¿ç”¨;
2.  å·²[åˆ›å»º Grafana API token](https://grafana.com/docs/grafana/latest/http_api/auth/#create-api-token)
3.  [Prometheus](https://prometheus.io/)å·²å®‰è£…å’Œé…ç½®.

### ç¬¬ä¸€æ­¥: åˆ†æ Grafana Dashboards ç”¨åˆ°çš„æŒ‡æ ‡

#### é€šè¿‡ Grafana API

å…·ä½“å¦‚ä¸‹:

    # é€šè¿‡ Grafana APIåˆ†æ Grafana ç”¨åˆ°çš„æŒ‡æ ‡
    # å‰ææ˜¯ç°åœ¨ Grafanaä¸Šåˆ›å»º API Keys
    mimirtool analyze grafana --address http://172.16.0.20:32651 --key=eyJrIjoiYjBWMGVoTHZTY3BnM3V5UzNVem9iWDBDSG5sdFRxRVoiLCJuIjoibWltaXJ0b29sIiwiaWQiOjF9
    

ğŸ“è¯´æ˜:

*   `http://172.16.0.20:32651` æ˜¯ Grafana åœ°å€
*   `--key=eyJr` æ˜¯ Grafana API Token. é€šè¿‡å¦‚ä¸‹ç•Œé¢è·å¾—:

![åˆ›å»º Grafana API Token](https://img2022.cnblogs.com/other/3034537/202211/3034537-20221118100733481-897904777.png)

è·å–åˆ°çš„æ˜¯ä¸€ä¸ª `metrics-in-grafana.json`, å†…å®¹æ¦‚è¿°å¦‚ä¸‹:

    {
        "metricsUsed": [
            ":node_memory_MemAvailable_bytes:sum",
            "alertmanager_alerts",
            "alertmanager_alerts_invalid_total",
            "alertmanager_alerts_received_total",
            "alertmanager_notification_latency_seconds_bucket",
            "alertmanager_notification_latency_seconds_count",
            "alertmanager_notification_latency_seconds_sum",
            "alertmanager_notifications_failed_total",
            "alertmanager_notifications_total",
            "cluster",
            "cluster:namespace:pod_cpu:active:kube_pod_container_resource_limits",
            "cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests",
            "cluster:namespace:pod_memory:active:kube_pod_container_resource_limits",
            "cluster:namespace:pod_memory:active:kube_pod_container_resource_requests",
            "cluster:node_cpu:ratio_rate5m",
            "container_cpu_cfs_periods_total",
            "container_cpu_cfs_throttled_periods_total",
            "..."
        ],
        "dashboards": [
            {
                "slug": "",
                "uid": "alertmanager-overview",
                "title": "Alertmanager / Overview",
                "metrics": [
                    "alertmanager_alerts",
                    "alertmanager_alerts_invalid_total",
                    "alertmanager_alerts_received_total",
                    "alertmanager_notification_latency_seconds_bucket",
                    "alertmanager_notification_latency_seconds_count",
                    "alertmanager_notification_latency_seconds_sum",
                    "alertmanager_notifications_failed_total",
                    "alertmanager_notifications_total"
                ],
                "parse_errors": null
            },
            {
                "slug": "",
                "uid": "c2f4e12cdf69feb95caa41a5a1b423d9",
                "title": "etcd",
                "metrics": [
                    "etcd_disk_backend_commit_duration_seconds_bucket",
                    "etcd_disk_wal_fsync_duration_seconds_bucket",
                    "etcd_mvcc_db_total_size_in_bytes",
                    "etcd_network_client_grpc_received_bytes_total",
                    "etcd_network_client_grpc_sent_bytes_total",
                    "etcd_network_peer_received_bytes_total",
                    "etcd_network_peer_sent_bytes_total",
                    "etcd_server_has_leader",
                    "etcd_server_leader_changes_seen_total",
                    "etcd_server_proposals_applied_total",
                    "etcd_server_proposals_committed_total",
                    "etcd_server_proposals_failed_total",
                    "etcd_server_proposals_pending",
                    "grpc_server_handled_total",
                    "grpc_server_started_total",
                    "process_resident_memory_bytes"
                ],
                "parse_errors": null
            },
            {...}
        ]
    }
    

#### (å¯é€‰)é€šè¿‡ Grafana Dashboards json æ–‡ä»¶

å¦‚æœæ— æ³•åˆ›å»º Grafana API Token, åªè¦æœ‰ Grafana Dashboards json æ–‡ä»¶, ä¹Ÿå¯ä»¥ç”¨æ¥åˆ†æ, ç¤ºä¾‹å¦‚ä¸‹:

    # é€šè¿‡ Grafana Dashboard json åˆ†æ Grafana ç”¨åˆ°çš„æŒ‡æ ‡
    mimirtool analyze dashboard grafana_dashboards/blackboxexporter-probe.json
    mimirtool analyze dashboard grafana_dashboards/es.json
    

å¾—åˆ°çš„ json ç»“æ„å’Œä¸Šä¸€èŠ‚ç±»ä¼¼, å°±ä¸èµ˜è¿°äº†.

### ç¬¬äºŒæ­¥: åˆ†æ Prometheus Alerting å’Œ Recording Rules ç”¨åˆ°çš„æŒ‡æ ‡

å…·ä½“æ“ä½œå¦‚ä¸‹:

    # (å¯é€‰)é€šè¿‡ kubectl cp å°†ç”¨åˆ°çš„ rule files æ‹·è´åˆ°æœ¬åœ°
    kubectl cp <prompod>:/etc/prometheus/rules/<releasename>-kube-prometheus-st-prometheus-rulefiles-0 -c prometheus ./kube-prometheus-stack/rulefiles/
    
    # é€šè¿‡ Prometheus rule files åˆ†æ Prometheus Rule ç”¨åˆ°çš„æŒ‡æ ‡(æ¶‰åŠ recording rule å’Œ alert rules)
    mimirtool analyze rule-file ./kube-prometheus-stack/rulefiles/*
    

ç»“æœå¦‚ä¸‹ `metrics-in-ruler.json`:

    {
      "metricsUsed": [
        "ALERTS",
        "aggregator_unavailable_apiservice",
        "aggregator_unavailable_apiservice_total",
        "apiserver_client_certificate_expiration_seconds_bucket",
        "apiserver_client_certificate_expiration_seconds_count",
        "apiserver_request_terminations_total",
        "apiserver_request_total",
        "blackbox_exporter_config_last_reload_successful",
        "..."
      ],
      "ruleGroups": [
        {
          "namspace": "default-monitor-kube-prometheus-st-kubernetes-apps-ae2b16e5-41d8-4069-9297-075c28c6969e",
          "name": "kubernetes-apps",
          "metrics": [
            "kube_daemonset_status_current_number_scheduled",
            "kube_daemonset_status_desired_number_scheduled",
            "kube_daemonset_status_number_available",
            "kube_daemonset_status_number_misscheduled",
            "kube_daemonset_status_updated_number_scheduled",
            "..."
          ]
          "parse_errors": null
        },
        {
          "namspace": "default-monitor-kube-prometheus-st-kubernetes-resources-ccb4a7bc-f2a0-4fe4-87f7-0b000468f18f",
          "name": "kubernetes-resources",
          "metrics": [
            "container_cpu_cfs_periods_total",
            "container_cpu_cfs_throttled_periods_total",
            "kube_node_status_allocatable",
            "kube_resourcequota",
            "namespace_cpu:kube_pod_container_resource_requests:sum",
            "namespace_memory:kube_pod_container_resource_requests:sum"
          ],
          "parse_errors": null
        }, 
        {...}
      ]
    }            
    

### ç¬¬ä¸‰æ­¥: åˆ†ææ²¡ç”¨åˆ°çš„æŒ‡æ ‡

å…·ä½“å¦‚ä¸‹:

    # ç»¼åˆåˆ†æ Prometheus é‡‡é›†åˆ°çš„ VS. (å±•ç¤º(Grafana Dashboards) + è®°å½•åŠå‘Šè­¦(Rule files))
    mimirtool analyze prometheus --address=http://172.16.0.20:30090/ --grafana-metrics-file="metrics-in-grafana.json" --ruler-metrics-file="metrics-in-ruler.json"
    

ğŸ“è¯´æ˜:

*   `--address=http://172.16.0.20:30090/` ä¸º prometheus åœ°å€
*   `--grafana-metrics-file="metrics-in-grafana.json"` ä¸ºç¬¬ä¸€æ­¥å¾—åˆ°çš„ json æ–‡ä»¶
*   `--ruler-metrics-file="kube-prometheus-stack-metrics-in-ruler.json"` ä¸ºç¬¬äºŒæ­¥å¾—åˆ°çš„ json æ–‡ä»¶

è¾“å‡ºç»“æœ`prometheus-metrics.json` å¦‚ä¸‹:

    {
      "total_active_series": 270336,
      "in_use_active_series": 61055,
      "additional_active_series": 209281,
      "in_use_metric_counts": [
        {
          "metric": "rest_client_request_duration_seconds_bucket",
          "count": 8855,
          "job_counts": [
            {
              "job": "kubelet",
              "count": 4840
            }, 
            {
              "job": "kube-controller-manager",
              "count": 1958
            },
            {...}
          ]
        },
        {
          "metric": "grpc_server_handled_total",
          "count": 4394,
          "job_counts": [
            {
              "job": "kube-etcd",
              "count": 4386
            },
            {
              "job": "default/kubernetes-ebao-ebaoops-pods",
              "count": 8
            }
          ]
        },
        {...}
      ],
      "additional_metric_counts": [    
        {
          "metric": "rest_client_rate_limiter_duration_seconds_bucket",
          "count": 81917,
          "job_counts": [
            {
              "job": "kubelet",
              "count": 53966
            },
            {
              "job": "kube-proxy",
              "count": 23595
            },
            {
              "job": "kube-scheduler",
              "count": 2398
            },
            {
              "job": "kube-controller-manager",
              "count": 1958
            }
          ]
        },  
        {
          "metric": "rest_client_rate_limiter_duration_seconds_count",
          "count": 7447,
          "job_counts": [
            {
              "job": "kubelet",
              "count": 4906
            },
            {
              "job": "kube-proxy",
              "count": 2145
            },
            {
              "job": "kube-scheduler",
              "count": 218
            },
            {
              "job": "kube-controller-manager",
              "count": 178
            }
          ]
        },
        {...}
      ]
    }                                 
    

### ç¬¬å››æ­¥: ä»… `keep` ç”¨åˆ°çš„æŒ‡æ ‡

#### åœ¨ `write_relabel_configs` ç¯èŠ‚é…ç½®

å¦‚æœä½ æœ‰ä½¿ç”¨ `remote_write`, é‚£ä¹ˆç›´æ¥åœ¨ `write_relabel_configs` ç¯èŠ‚é…ç½® `keep` relabel è§„åˆ™, ç®€å•ç²—æš´.

å¯ä»¥å…ˆç”¨ `jp` å‘½ä»¤å¾—åˆ°æ‰€æœ‰éœ€è¦ `keep` çš„metric name:

    jq '.metricsUsed' metrics-in-grafana.json \
    | tr -d '", ' \
    | sed '1d;$d' \
    | grep -v 'grafanacloud*' \
    | paste -s -d '|' -
    

è¾“å‡ºç»“æœç±»ä¼¼å¦‚ä¸‹:

    instance:node_cpu_utilisation:rate1m|instance:node_load1_per_cpu:ratio|instance:node_memory_utilisation:ratio|instance:node_network_receive_bytes_excluding_lo:rate1m|instance:node_network_receive_drop_excluding_lo:rate1m|instance:node_network_transmit_bytes_excluding_lo:rate1m|instance:node_network_transmit_drop_excluding_lo:rate1m|instance:node_vmstat_pgmajfault:rate1m|instance_device:node_disk_io_time_seconds:rate1m|instance_device:node_disk_io_time_weighted_seconds:rate1m|node_cpu_seconds_total|node_disk_io_time_seconds_total|node_disk_read_bytes_total|node_disk_written_bytes_total|node_filesystem_avail_bytes|node_filesystem_size_bytes|node_load1|node_load15|node_load5|node_memory_Buffers_bytes|node_memory_Cached_bytes|node_memory_MemAvailable_bytes|node_memory_MemFree_bytes|node_memory_MemTotal_bytes|node_network_receive_bytes_total|node_network_transmit_bytes_total|node_uname_info|up
    

ç„¶åç›´æ¥åœ¨ `write_relabel_configs` ç¯èŠ‚é…ç½® `keep` relabel è§„åˆ™:

    remote_write:
    - url: <remote_write endpoint>
      basic_auth:
        username: <æŒ‰éœ€>
        password: <æŒ‰éœ€>
      write_relabel_configs:
      - source_labels: [__name__]
        regex: instance:node_cpu_utilisation:rate1m|instance:node_load1_per_cpu:ratio|instance:node_memory_utilisation:ratio|instance:node_network_receive_bytes_excluding_lo:rate1m|instance:node_network_receive_drop_excluding_lo:rate1m|instance:node_network_transmit_bytes_excluding_lo:rate1m|instance:node_network_transmit_drop_excluding_lo:rate1m|instance:node_vmstat_pgmajfault:rate1m|instance_device:node_disk_io_time_seconds:rate1m|instance_device:node_disk_io_time_weighted_seconds:rate1m|node_cpu_seconds_total|node_disk_io_time_seconds_total|node_disk_read_bytes_total|node_disk_written_bytes_total|node_filesystem_avail_bytes|node_filesystem_size_bytes|node_load1|node_load15|node_load5|node_memory_Buffers_bytes|node_memory_Cached_bytes|node_memory_MemAvailable_bytes|node_memory_MemFree_bytes|node_memory_MemTotal_bytes|node_network_receive_bytes_total|node_network_transmit_bytes_total|node_uname_info|up
        action: keep
    

#### åœ¨ `metric_relabel_configs` ç¯èŠ‚é…ç½®

å¦‚æœæ²¡æœ‰ä½¿ç”¨ `remote_write`, é‚£ä¹ˆåªèƒ½åœ¨ `metric_relabel_configs` ç¯èŠ‚é…ç½®äº†.

ä»¥ etcd job ä¸ºä¾‹: (ä»¥ prometheus é…ç½®ä¸ºä¾‹, Prometheus Operator è¯·è‡ªè¡ŒæŒ‰éœ€è°ƒæ•´)

    - job_name: serviceMonitor/default/monitor-kube-prometheus-st-kube-etcd/0
      honor_labels: false
      kubernetes_sd_configs:
      - role: endpoints
        namespaces:
          names:
          - kube-system
      scheme: https
      tls_config:
        insecure_skip_verify: true
        ca_file: /etc/prometheus/secrets/etcd-certs/ca.crt
        cert_file: /etc/prometheus/secrets/etcd-certs/healthcheck-client.crt
        key_file: /etc/prometheus/secrets/etcd-certs/healthcheck-client.key
      relabel_configs:
      - source_labels:
        - job
        target_label: __tmp_prometheus_job_name
      - ...
      metric_relabel_configs: 
      - source_labels: [__name__]
        regex: etcd_disk_backend_commit_duration_seconds_bucket|etcd_disk_wal_fsync_duration_seconds_bucket|etcd_mvcc_db_total_size_in_bytes|etcd_network_client_grpc_received_bytes_total|etcd_network_client_grpc_sent_bytes_total|etcd_network_peer_received_bytes_total|etcd_network_peer_sent_bytes_total|etcd_server_has_leader|etcd_server_leader_changes_seen_total|etcd_server_proposals_applied_total|etcd_server_proposals_committed_total|etcd_server_proposals_failed_total|etcd_server_proposals_pending|grpc_server_handled_total|grpc_server_started_total|process_resident_memory_bytes|etcd_http_failed_total|etcd_http_received_total|etcd_http_successful_duration_seconds_bucket|etcd_network_peer_round_trip_time_seconds_bucket|grpc_server_handling_seconds_bucket|up
        action: keep    
    

#### ä¸ç”¨ `keep` è€Œä½¿ç”¨ `drop`

åŒæ ·æ»´, ä¸ç”¨ `keep` è€Œæ”¹ä¸ºä½¿ç”¨ `drop` ä¹Ÿæ˜¯å¯ä»¥çš„. è¿™é‡Œä¸å†èµ˜è¿°.

ğŸ‰ğŸ‰ğŸ‰

æ€»ç»“
--

æœ¬æ–‡ä¸­ï¼Œä»‹ç»äº†ç²¾ç®€ Prometheus æŒ‡æ ‡çš„éœ€æ±‚, ç„¶åè¯´æ˜å¦‚ä½•ä½¿ç”¨ `mimirtool analyze` å‘½ä»¤æ¥ç¡®å®šGrafana Dashboards ä»¥åŠ Prometheus Rules ä¸­ç”¨åˆ°çš„æŒ‡æ ‡ã€‚ç„¶åç”¨ `analyze prometheus` åˆ†æäº†å±•ç¤ºå’Œå‘Šè­¦ä¸­`used` å’Œ `unused` çš„æ´»åŠ¨ seriesï¼Œæœ€åé…ç½®äº† Prometheus ä»¥ä»… `keep` ç”¨åˆ°çš„æŒ‡æ ‡ã€‚

ç»“åˆè¿™æ¬¡å®æˆ˜, ç²¾ç®€ç‡å¯ä»¥è¾¾åˆ° 5 å€å·¦å³, æ•ˆæœè¿˜æ˜¯éå¸¸æ˜æ˜¾çš„. æ¨èè¯•ä¸€è¯•. ğŸ‘ï¸ğŸ‘ï¸ğŸ‘ï¸

ğŸ“šï¸ å‚è€ƒæ–‡æ¡£
--------

*   [grafana/mimir: Grafana Mimir provides horizontally scalable, highly available, multi-tenant, long-term storage for Prometheus. (github.com)](https://github.com/grafana/mimir)
*   [Analyzing and reducing metrics usage with Grafana Mimirtool | Grafana Cloud documentation](https://grafana.com/docs/grafana-cloud/billing-and-usage/control-prometheus-metrics-usage/usage-analysis-mimirtool/)

> æœ¬æ–‡ç”±ä¸œé£å¾®é¸£æŠ€æœ¯åšå®¢ [EWhisper.cn](https://EWhisper.cn) ç¼–å†™ï¼