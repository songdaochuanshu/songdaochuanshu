---
layout: post
title: "ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ã€‘æ‰‹æ’•çº¢é»‘æ ‘"
date: "2022-04-02T06:21:34.414Z"
---
ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ã€‘æ‰‹æ’•çº¢é»‘æ ‘
==============

çº¢é»‘æ ‘
===

å®šä¹‰
--

**åŠ¨æœº**ï¼š

*   äºŒå‰æŸ¥æ‰¾æ ‘æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æœ€åæƒ…å†µæ—¶é—´å¤æ‚åº¦å¯èƒ½é€€åŒ–ä¸º `O(n)`ã€‚
    
*   AVL æ ‘å¾ˆå¥½çš„é™åˆ¶äº†æ•°çš„é«˜åº¦ä¸º `O(logn)`ï¼Œæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾çš„æœ€åæ—¶é—´å¤æ‚åº¦å‡ä¸º `O(logn)`ï¼›ä½†åˆ é™¤æ“ä½œæœ€å¤šéœ€è¦åš `O(logn)` æ¬¡æ—‹è½¬ã€‚
    
*   çº¢é»‘æ ‘æ˜¯å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼š
    
    *   æ¯ä¸ªç»“ç‚¹æ˜¯çº¢è‰²æˆ–é»‘è‰²çš„
        
    *   æ ¹ç»“ç‚¹ä¸ºé»‘è‰²
        
    *   å¤–ç»“ç‚¹ä¸ºé»‘è‰²ï¼ˆå¤–ç•Œç‚¹å³ä¸º `null`ï¼‰
        
    *   å¦‚æœä¸€ä¸ªç»“ç‚¹æ—¶çº¢è‰²ï¼Œé‚£ä¹ˆå®ƒçš„å­©å­å¿…é¡»æ˜¯é»‘è‰²
        
    *   ä»»ä¸€ç»“ç‚¹åˆ°å¤–ç»“ç‚¹çš„è·¯å¾„ä¸Šï¼ŒåŒ…å«ç›¸åŒæ•°ç›®çš„é»‘ç»“ç‚¹
        

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220329192644874-1332384409.png)

**ç»“ç‚¹çš„é»‘é«˜åº¦**ï¼šè¯¥ç»“ç‚¹åˆ°å¤–ç»“ç‚¹çš„è·¯å¾„ä¸ŠåŒ…å«çš„é»‘ç»“ç‚¹æ•°ç›®

**çº¢é»‘æ ‘çš„é»‘é«˜åº¦**ï¼šæ ¹ç»“ç‚¹çš„é»‘é«˜åº¦

æ€§è´¨
--

*   è‹¥å¿½ç•¥çº¢ç»“ç‚¹è€Œåªè€ƒè™‘é»‘ç»“ç‚¹ï¼Œåˆ™è¿™æ£µæ ‘æ˜¯å¹³è¡¡çš„
    
*   ä»»ä½•ä¸€æ¡è·¯å¾„ä¸Šä¸èƒ½æœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢ç»“ç‚¹ã€‚ä»ä»»æ„ç»“ç‚¹è§¦å‘æœ€é•¿çš„è·¯å¾„ï¼ˆçº¢é»‘ç»“ç‚¹é—´éš”ç»„æˆï¼‰æ˜¯æœ€çŸ­è·¯å¾„ï¼ˆä»…ç”±é»‘ç»“ç‚¹ç»„æˆï¼‰çš„ `2` å€
    
*   ä»»ä½•ä¸€ä¸ªç»“ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦æœ€å¤šç›¸å·® `2` å€
    
*   çº¢é»‘æ ‘çš„å¹³è¡¡æ€§æ¯” AVL æ ‘æ›´å¼±
    
*   å¹³å‡å’Œæœ€åé«˜åº¦ï¼š`O(logn)`
    
*   æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æ“ä½œçš„å¹³å‡å’Œæœ€åæ—¶é—´å¤æ‚åº¦æ˜¯ `O(logn)`ï¼Œä¸”ä»…æ¶‰åŠ `O(1)` æ¬¡æ—‹è½¬
    
*   çº¢é»‘æ ‘çš„é«˜åº¦ï¼š`h = O(logn)` ä¸” `logn <= h <= 2logn`  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220329194214520-934898106.png)
    

ç»“ç‚¹å®šä¹‰
----

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330221037324-548387718.png)

1ï¸âƒ£ `key`ï¼šå…³é”®å­—çš„å€¼  
2ï¸âƒ£ `value`ï¼šå…³é”®å­—çš„å­˜å‚¨ä¿¡æ¯  
3ï¸âƒ£ `parent`ï¼šçˆ¶äº²ç»“ç‚¹çš„å¼•ç”¨  
4ï¸âƒ£ `left`ï¼šå·¦å­æ ‘æ ¹ç»“ç‚¹çš„å¼•ç”¨  
5ï¸âƒ£ `right`ï¼šå³å­æ ‘æ ¹ç»“ç‚¹å¼•ç”¨  
6ï¸âƒ£ `color`ï¼šç»“ç‚¹é¢œè‰²

    class RBNode<K extends Comparable<K>, V> {
        public RBNode<K, V> parent;
        public RBNode<K, V> left;
        public RBNode<K, V> right;
        public boolean color;
        public K key;
        public V value;
    
        public RBNode(RBNode<K, V> parent, K key, V value) {
            this.parent = parent;
            this.key = key;
            this.value = value;
        }
    }
    

æ’å…¥ç®—æ³•
----

*   æŸ¥æ‰¾ï¼Œè‹¥æŸ¥æ‰¾æˆåŠŸåˆ™ä¸æ’å…¥å¹¶æ›´æ–°ç»“ç‚¹å€¼ï¼›è‹¥æŸ¥æ‰¾å¤±è´¥ï¼Œå†æŸ¥æ‰¾å¤±è´¥çš„ä½ç½®æ’å…¥æ–°ç»“ç‚¹
    
*   æ–°ç»“ç‚¹æ€»æ˜¯ä½œä¸º**å¶ç»“ç‚¹**æ’å…¥çš„
    
*   æ–°ç»“ç‚¹å¿…é¡»ä¸º**çº¢è‰²**
    
*   è‹¥æ–°ç»“ç‚¹çš„çˆ¶ç»“ç‚¹æ˜¯**é»‘è‰²**ï¼Œåˆ™æ’å…¥è¿‡ç¨‹ç»“æŸ
    
*   è‹¥æ–°ç»“ç‚¹çš„çˆ¶ç»“ç‚¹æ˜¯**çº¢è‰²**ï¼Œåˆ™éœ€è¦å¤„ç†**åŒçº¢ç¼ºé™·**
    

è¿™é‡Œå®šä¹‰ `x` ä¸ºæ–°æ’å…¥çš„ç»“ç‚¹ï¼Œ`p` ä¸º `x` çš„çˆ¶ç»“ç‚¹ï¼Œ`g` ä¸º `x` çš„çˆ·çˆ·ç»“ç‚¹ï¼Œ`u` ä¸º `x` çš„å”å”

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220329195937494-1390006142.png)

### åŒçº¢ä¿®æ­£

1ï¸âƒ£ **`x` çš„å”å”æ˜¯é»‘è‰²**

*   `g` åˆ° `x` çš„è·¯å¾„ä¸º `LL` å‹  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330203833254-310524739.png)
    
*   `g` åˆ° `x` çš„è·¯å¾„ä¸º `RR` å‹  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330204438334-1876678466.png)
    
*   `g` åˆ° `x` çš„è·¯å¾„ä¸º `LR` å‹  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330210245529-661874747.png)
    
*   `g` åˆ° `x` çš„è·¯å¾„ä¸º `RL` å‹  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330210854464-1495284802.png)
    

2ï¸âƒ£ **`x` çš„å”å”æ˜¯çº¢è‰²**

![](https://img2022.cnblogs.com/blog/2288178/202204/2288178-20220401090859884-1281188793.png)

### å®ä¾‹

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330214545032-908572474.png)

æ­¤æ—¶ç»“ç‚¹ 50 çš„çˆ¶äº²ç»“ç‚¹ 60 ä¹Ÿä¸ºçº¢è‰²ï¼Œéœ€è¦è¿›è¡ŒåŒçº¢ä¿®æ­£ã€‚æ³¨æ„åˆ°ï¼Œå…¶å”å”ç»“ç‚¹ 20 ä¹Ÿæ˜¯çº¢è‰²ï¼Œåªéœ€è¦å°†çˆ¶äº²ç»“ç‚¹ 60 å’Œå”å”ç»“ç‚¹ 20 å˜ä¸ºé»‘è‰²ï¼Œå†æŠŠçˆ·çˆ·ç»“ç‚¹ 30 å˜ä¸ºçº¢è‰²ï¼Œç»“æœå¦‚ä¸‹å›¾ã€‚

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330214859551-1421466850.png)

ä¹‹åä¼šå‘ç°ï¼Œç»“ç‚¹ 30 å’Œå…¶çˆ¶ç»“ç‚¹ 70 éƒ½ä¸ºçº¢è‰²ï¼Œéœ€è¦è¿›è¡ŒåŒçº¢ä¿®æ­£ã€‚è€Œç»“ç‚¹ 30 çš„å”å”ç»“ç‚¹ 85 ä¸ºé»‘è‰²ï¼Œç»“ç‚¹ 30 çš„çˆ·çˆ·ç»“ç‚¹ 15 åˆ°è¾¾ç»“ç‚¹ 30 çš„è·¯å¾„æ˜¯ RL å‹ï¼Œæ•…éœ€è¦å…ˆå³æ—‹ï¼Œå†å·¦æ—‹ã€‚ç»“æœå¦‚ä¸‹å›¾ã€‚

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330220015436-1173046182.png)

### æ—‹è½¬æ“ä½œ

ç”±äºçº¢é»‘æ ‘ç»“ç‚¹è¿˜æ‹¥æœ‰ `parent` å±æ€§ï¼Œæ•…ä¸èƒ½åƒå¹³è¡¡äºŒå‰æ ‘ä¸€æ ·è¿›è¡Œæ—‹è½¬ï¼ˆ[ã€æ•°æ®ç»“æ„ä¸ç®—æ³•ã€‘æ‰‹æ’•å¹³è¡¡äºŒå‰æ ‘](https://www.cnblogs.com/gonghr/p/16064797.html#%E6%8F%92%E5%85%A5%E7%AE%97%E6%B3%95)ï¼‰ï¼Œéœ€è¦ç‰¹æ®Šè€ƒè™‘ `parent`çš„èµ‹å€¼ã€‚

1ï¸âƒ£ `RR` å‹

**å·¦æ—‹**

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330224354440-1353878542.png)

éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯çˆ·çˆ·ç»“ç‚¹ `g` çš„ `parent` çš„è®¾ç½®ï¼Œéœ€è¦å…ˆåˆ¤æ–­ `g` æ˜¯å·¦å­ç»“ç‚¹è¿˜æ˜¯å³å­ç»“ç‚¹ã€‚

        private void leftRotate(RBNode<K, V> g) {
            if (g != null) {
                RBNode<K, V> p = g.right;
                g.right = p.left;
                if (p.left != null) {
                    p.left.parent = g;
                }
                p.parent = g.parent;
                if (g.parent == null) {
                    this.root = p;
                } else if (g.parent.left == g) {
                    g.parent.left = p;
                } else {
                    g.parent.right = p;
                }
                p.left = g;
                g.parent = p;
            }
    

2ï¸âƒ£ `LL` å‹

**å³æ—‹**

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330225034095-733815567.png)

éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯çˆ·çˆ·ç»“ç‚¹ `g` çš„ `parent` çš„è®¾ç½®ï¼Œéœ€è¦å…ˆåˆ¤æ–­ `g` æ˜¯å·¦å­ç»“ç‚¹è¿˜æ˜¯å³å­ç»“ç‚¹ã€‚

        private void rightRotate(RBNode<K, V> g) {
            if(g != null) {
                RBNode<K, V> p = g.left;
                g.left = p.right;
                if(p.right != null) {
                    p.right.parent = g;
                }
                p.parent = g.parent;
                if(g.parent == null) {
                    this.root = p;
                } else if(g.parent.left == g) {
                    g.parent.left = p;
                } else {
                    g.parent.right = p;
                }
                p.right = g;
                g.parent = p;
            }
        }
    

3ï¸âƒ£ `LR` å‹

å…ˆå¯¹ `g` çš„å·¦å­ç»“ç‚¹å·¦æ—‹ï¼Œå†å¯¹ `g` å³æ—‹

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330231353666-1348521269.png)

        private void leftRightRotate(RBNode<K,V> g) {
            if(g != null) {
                leftRotate(g.left);
                rightRotate(g);
            }
        }
    

4ï¸âƒ£ `RL` å‹

å…ˆå¯¹ `g` çš„å³å­ç»“ç‚¹å³æ—‹ï¼Œå†å¯¹ `g` å·¦æ—‹

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220330231647070-774204213.png)

        private void rightLeftRotate(RBNode<K, V> g) {
            if(g != null) {
                rightRotate(g.right);
                leftRotate(g);
            }
        }
    

### ä»£ç 

1ï¸âƒ£ æ’å…¥æ“ä½œ

**ä»£ç æè¿°**

*   å¦‚æœæ ¹ç»“ç‚¹ä¸ºç©ºï¼Œåˆ™åˆ›å»ºæ ¹ç»“ç‚¹ï¼Œè¿”å›
    
*   å¦åˆ™ï¼Œæ ¹æ® `key` ä¸ç»“ç‚¹å…³é”®å€¼çš„æ¯”è¾ƒæ‰¾åˆ°æ’å…¥ä½ç½®
    
*   åˆ›å»ºç»“ç‚¹å¹¶æ’å…¥
    
*   å¹³è¡¡å¤„ç†
    

        public void insert(K key, V value) {
            RBNode<K, V> t = this.root;
            if (t == null) {
                this.root = new RBNode<K, V>(null, key, value);
                setColor(root, BLACK);
                return;
            }
            int cmp = 0;
            RBNode<K, V> parent = null;
            while (t != null) {
                parent = t;
                cmp = key.compareTo(t.key);
                if (cmp < 0) {
                    t = t.left;
                } else if (cmp > 0) {
                    t = t.right;
                } else {
                    t.value = value;
                    return;
                }
            }
            RBNode<K, V> e = new RBNode<K, V>(parent, key, value);
            if (cmp < 0) {
                parent.left = e;
            } else {
                parent.right = e;
            }
            // å¹³è¡¡å¤„ç†ï¼Œæ—‹è½¬+å˜è‰²
            fixAfterPut(e);
        }
    

2ï¸âƒ£ å¹³è¡¡å¤„ç†

**ä»£ç æè¿°**

*   æ–°æ’å…¥çš„ç»“ç‚¹éƒ½è®¾ç½®ä¸ºçº¢è‰²
    
*   è¿›å…¥å¾ªç¯ï¼Œæ¡ä»¶æ˜¯ `x` ä¸ä¸ºç©ºä¸” `x` ä¸ä¸ºæ ¹ç»“ç‚¹ä¸” `x` çš„çˆ¶äº²ä¸ºçº¢è‰²ï¼ˆè¿›è¡ŒåŒçº¢å¤„ç†ï¼‰
    
*   è‹¥çˆ¶ç»“ç‚¹æ˜¯çˆ·çˆ·ç»“ç‚¹çš„å·¦å­ç»“ç‚¹ï¼Œå³ä¸º `L` ç±»å‹
    
    *   ä»¤ `uncle` ä¸ºå”å”ç»“ç‚¹
        
    *   è‹¥å”å”ç»“ç‚¹ä¸ºçº¢è‰²ï¼šä»¤çˆ·çˆ·ç»“ç‚¹ä¸ºçº¢è‰²ï¼Œçˆ¶äº²ç»“ç‚¹ä¸ºé»‘è‰²ï¼Œå”å”ç»“ç‚¹ä¸ºé»‘è‰²ï¼Œ`x` èµ‹ä¸ºçˆ·çˆ·ç»“ç‚¹ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯å¤„ç†ã€‚
        
    *   è‹¥å”å”ç»“ç‚¹ä¸ºé»‘è‰²ï¼š
        
        *   è‹¥ `x` æ˜¯çˆ¶ç»“ç‚¹çš„å³å­ç»“ç‚¹ï¼Œåˆ™ä¸º `LR` å‹ï¼Œå…ˆå·¦æ—‹ï¼Œå†å³æ—‹ï¼ŒæŸ“è‰²
            
        *   è‹¥ `x` æ˜¯çˆ¶ç»“ç‚¹çš„å·¦å­ç»“ç‚¹ï¼Œåˆ™ä¸º `LL` å‹ï¼Œå·¦æ—‹ï¼ŒæŸ“è‰²
            
*   è‹¥çˆ¶ç»“ç‚¹æ˜¯çˆ·çˆ·ç»“ç‚¹çš„å³å­ç»“ç‚¹ï¼Œå³ä¸º `R` ç±»å‹
    
    *   ä»¤ `uncle` ä¸ºå”å”ç»“ç‚¹
        
    *   è‹¥å”å”ç»“ç‚¹ä¸ºçº¢è‰²ï¼šä»¤çˆ·çˆ·ç»“ç‚¹ä¸ºçº¢è‰²ï¼Œçˆ¶äº²ç»“ç‚¹ä¸ºé»‘è‰²ï¼Œå”å”ç»“ç‚¹ä¸ºé»‘è‰²ï¼Œ`x` èµ‹ä¸ºçˆ·çˆ·ç»“ç‚¹ï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯å¤„ç†ã€‚
        
    *   è‹¥å”å”ç»“ç‚¹ä¸ºé»‘è‰²ï¼š
        
        *   è‹¥ `x` æ˜¯çˆ¶ç»“ç‚¹çš„å·¦å­ç»“ç‚¹ï¼Œåˆ™ä¸º `RL` å‹ï¼Œå…ˆå³æ—‹ï¼Œå†å·¦æ—‹ï¼ŒæŸ“è‰²
            
        *   è‹¥ `x` æ˜¯çˆ¶ç»“ç‚¹çš„å³å­ç»“ç‚¹ï¼Œåˆ™ä¸º `RR` å‹ï¼Œå³æ—‹ï¼ŒæŸ“è‰²
            
*   è®¾ç½®æ ¹ç»“ç‚¹ä¸ºé»‘è‰²ï¼ˆå§‹ç»ˆå¦‚æ­¤ï¼‰
    

        private void fixAfterInsert(RBNode<K, V> x) {
            setColor(x, RED);
            while (x != null && x != root && colorOf(x.parent) == RED) {
                if (x.parent == x.parent.parent.left) {
                    RBNode<K, V> uncle = x.parent.parent.right;
                    if (colorOf(uncle) == RED) {
                        setColor(x.parent, BLACK);
                        setColor(uncle, BLACK);
                        setColor(x.parent.parent, RED);
                        x = x.parent.parent;
                    } else {
                        if (x == x.parent.right) {
                            leftRightRotate(x.parent.parent);
                            setColor(x, BLACK);
                            setColor(x.right, RED);
                        } else {
                            setColor(x.parent, BLACK);
                            setColor(x.parent.parent, RED);
                            rightRotate(x.parent.parent);
                        }
                    }
                } else {
                    RBNode<K, V> uncle = x.parent.parent.left;
                    if (colorOf(uncle) == RED) {
                        setColor(x.parent, BLACK);
                        setColor(uncle, BLACK);
                        setColor(x.parent.parent, RED);
                        x = x.parent.parent;
                    } else {
                        if (x == x.parent.left) {
                            rightLeftRotate(x.parent.parent);
                            setColor(x, BLACK);
                            setColor(x.left, RED);
                        } else {
                            setColor(x.parent, BLACK);
                            setColor(x.parent.parent, RED);
                            leftRotate(x.parent.parent);
                        }
                    }
                }
            }
            setColor(root, BLACK);
        }
    

æŸ¥æ‰¾å‰é©±å’Œåç»§ç»“ç‚¹
---------

1ï¸âƒ£ æŸ¥æ‰¾å‰é©±ç»“ç‚¹

*   è‹¥å½“å‰ç»“ç‚¹ä¸ºç©ºï¼Œåˆ™è¿”å›
    
*   è‹¥å½“å‰ç»“ç‚¹å­˜åœ¨å·¦å­æ ‘ï¼Œåˆ™å‰é©±ç»“ç‚¹æ˜¯å·¦å­æ ‘çš„æœ€å³ç»“ç‚¹
    
*   è‹¥å½“å‰ç»“ç‚¹ä¸å­˜åœ¨å·¦å­æ ‘ï¼šæ³¨æ„è¿™ç§æƒ…å†µåœ¨åˆ é™¤æ—¶æ˜¯ä¸ç”¨è€ƒè™‘çš„ï¼Œè¦ä¹ˆä¸ºå¶å­ç»“ç‚¹ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ï¼›è¦ä¹ˆå¯ä»¥ç”¨å³å­æ ‘ä»£æ›¿ï¼Œä¸ç”¨è€ƒè™‘å‰é©±ã€‚è¿™é‡Œæ˜¯æ±‚çš„æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„å‰é©±ç»“ç‚¹ã€‚  
    ![](https://img2022.cnblogs.com/blog/2288178/202204/2288178-20220401091709532-29435011.png)
    

        private RBNode<K, V> predecessor(RBNode<K, V> node) {
            if (node == null) {
                return null;
            } else if (node.left != null) {
                RBNode<K, V> p = node.left;
                while (p.right != null) {
                    p = p.right;
                }
                return p;
            } else {
                RBNode<K, V> p = node.parent;
                RBNode<K, V> ch = node;
                while (p != null && ch == p.left) {
                    ch = p;
                    p = p.parent;
                }
                return p;
            }
        }
    

2ï¸âƒ£ æŸ¥æ‰¾åç»§ç»“ç‚¹

*   è‹¥å½“å‰ç»“ç‚¹ä¸ºç©ºï¼Œåˆ™è¿”å›
    
*   è‹¥å½“å‰ç»“ç‚¹å­˜åœ¨å³å­æ ‘ï¼Œåˆ™å‰é©±ç»“ç‚¹æ˜¯å³å­æ ‘çš„æœ€å·¦ç»“ç‚¹
    
*   è‹¥å½“å‰ç»“ç‚¹ä¸å­˜åœ¨å³å­æ ‘ï¼šæ³¨æ„è¿™ç§æƒ…å†µåœ¨åˆ é™¤æ—¶æ˜¯ä¸ç”¨è€ƒè™‘çš„ï¼Œè¦ä¹ˆä¸ºå¶å­ç»“ç‚¹ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ï¼›è¦ä¹ˆå¯ä»¥ç”¨å·¦å­æ ‘ä»£æ›¿ï¼Œä¸ç”¨è€ƒè™‘åç»§ã€‚è¿™é‡Œæ˜¯æ±‚çš„æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„åç»§ç»“ç‚¹ã€‚  
    ![](https://img2022.cnblogs.com/blog/2288178/202204/2288178-20220401092001253-1499630849.png)
    

        private RBNode<K, V> successor(RBNode<K, V> node) {
            if (node == null) {
                return null;
            } else if (node.right != null) {
                RBNode<K, V> p = node.right;
                while (p.left != null) {
                    p = p.left;
                }
                return p;
            } else {
                RBNode<K, V> p = node.parent;
                RBNode<K, V> ch = node;
                while (p != null && ch == p.right) {
                    ch = p;
                    p = p.parent;
                }
                return p;
            }
        }
    

åˆ é™¤ç®—æ³•
----

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220331160944206-73973310.png)

*   å®šä¹‰ `x` ä¸ºå®é™…åˆ é™¤ç»“ç‚¹ï¼Œ`r` ä¸ºæ›¿æ¢ `X` çš„ç»“ç‚¹ï¼Œ`p` ä¸º `x` çš„çˆ¶äº²ï¼Œ`s` ä¸º `x` çš„å…„å¼Ÿ
    
*   æŸ¥æ‰¾ï¼Œè‹¥æŸ¥æ‰¾å¤±è´¥åˆ™ç›´æ¥è¿”å›ï¼Œè‹¥æŸ¥æ‰¾æˆåŠŸåˆ™åˆ é™¤å¯¹åº”çš„ç»“ç‚¹ `x`
    
*   åˆ é™¤æ“ä½œæœ€ç»ˆå¯å½’ç»“ä¸ºä¸¤ç§æƒ…å†µï¼šåˆ é™¤å¶ç»“ç‚¹å’Œåˆ é™¤åªæœ‰ä¸€ä¸ªå­©å­çš„ç»“ç‚¹
    
    *   è‹¥ `x` ä¸ºçº¢ï¼Œåˆ™å¿…ä¸ºçº¢å¶å­ï¼Œç›´æ¥åˆ é™¤
        
    *   è‹¥ `x` ä¸ºé»‘ `r` ä¸ºçº¢ï¼Œ`r` æ›¿æ¢ `x`ï¼Œå¹¶å°† `r` æŸ“é»‘
        
    *   è‹¥ `x` ä¸ºé»‘ `r` ä¸ºé»‘ï¼šéœ€è¦å¤„ç†åŒé»‘ç¼ºé™·
        

### åŒé»‘ç¼ºé™·

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220331161731723-161863316.png)

*   è‹¥ `x` ä¸ºé»‘ `r` ä¸ºé»‘ï¼ˆ`r` å¯èƒ½ä¸ºå¤–ç»“ç‚¹ï¼‰ï¼šåŒé»‘ç¼ºé™·
    
*   `x` ä¸ºå®é™…åˆ é™¤ç»“ç‚¹ï¼Œ`r` ä¸ºæ›¿æ¢ `x` çš„ç»“ç‚¹ï¼Œ`p` ä¸º `x` çš„çˆ¶äº²ï¼Œ`s` ä¸º `x` çš„å…„å¼Ÿï¼Œ`n` ä¸º `s` çš„å­©å­
    

1ï¸âƒ£ å…„å¼Ÿ `s` ä¸ºé»‘ï¼Œä¸”æœ‰çº¢å­©å­

*   `p` åˆ° `n` çš„è·¯å¾„ä¸º `LL` å‹  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220331175026731-1567454773.png)
    
*   `p` åˆ° `n` çš„è·¯å¾„ä¸º `LR` å‹  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220331181343108-435629380.png)
    
*   `p` åˆ° `n` çš„è·¯å¾„ä¸º `RR` å‹ã€‚  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220331181001360-2092789190.png)
    
*   `p` åˆ° `n` çš„è·¯å¾„ä¸º `RL` å‹ã€‚  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220331182017027-117803063.png)
    

2ï¸âƒ£ å…„å¼Ÿ `s` ä¸ºé»‘ï¼Œæ— çº¢å­©å­

*   çˆ¶äº² `p` ä¸ºçº¢  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220331191547951-1295626401.png)
    
*   çˆ¶äº² `p` ä¸ºé»‘  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220331191908811-1515368248.png)
    

3ï¸âƒ£ å…„å¼Ÿ `s` ä¸ºçº¢

*   `s` ä¸º `p` çš„å·¦å­©å­  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220331193028515-601789742.png)

ç»è¿‡å˜æ¢åï¼Œé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œä½† `r` çš„å…„å¼Ÿå˜ä¸ºé»‘è‰²ï¼Œå¯èƒ½è½¬ä¸ºé»‘å…„å¼Ÿæœ‰çº¢å­©å­æƒ…å†µï¼ˆæœ€å¤šéœ€ä¸¤æ¬¡æ—‹è½¬ï¼‰ï¼Œæˆ–é»‘å…„å¼Ÿæ— çº¢å­©å­æœ‰çº¢çˆ¶äº²æƒ…å†µï¼Œéœ€æŸ“è‰²ã€‚

*   `s` ä¸º `p` çš„å³å­©å­  
    ![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220331194029994-1390406140.png)

ç»è¿‡å˜æ¢åï¼Œé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œä½† `r` çš„å…„å¼Ÿå˜ä¸ºé»‘è‰²ï¼Œå¯èƒ½è½¬ä¸ºé»‘å…„å¼Ÿæœ‰çº¢å­©å­æƒ…å†µï¼ˆæœ€å¤šéœ€ä¸¤æ¬¡æ—‹è½¬ï¼‰ï¼Œæˆ–é»‘å…„å¼Ÿæ— çº¢å­©å­æœ‰çº¢çˆ¶äº²æƒ…å†µï¼Œéœ€æŸ“è‰²ã€‚

### ä»£ç 

1ï¸âƒ£ åˆ é™¤æ—¶å…ˆæ‰¾åˆ°è¦åˆ é™¤çš„ç»“ç‚¹

        private RBNode<K, V> getNode(K key) {
            RBNode<K, V> node = this.root; 
            while (node != null) {
                int cmp = key.compareTo(node.key);
                if (cmp < 0) {
                    node = node.left;
                } else if (cmp > 0) {
                    node = node.right;
                } else {
                    return node;
                }
            }
            return null;
        }
    

2ï¸âƒ£ åˆ é™¤ç»“ç‚¹

**ä»£ç æè¿°**

*   è‹¥è¦è¢«åˆ é™¤çš„ç»“ç‚¹çš„å·¦å³å­ç»“ç‚¹éƒ½å­˜åœ¨ï¼Œåˆ™æ‰¾åˆ°å…¶ä¸­åºåç»§ï¼ˆå‰é©±ï¼‰ç»“ç‚¹ï¼Œå°†ä¸­åºç»“ç‚¹çš„å€¼èµ‹ç»™è¯¥ç»“ç‚¹ï¼Œç„¶åä»¤è¯¥ç»“ç‚¹çš„å¼•ç”¨æŒ‡å‘ä¸­åºç»“ç‚¹ï¼Œç”¨æ¥åˆ é™¤è¯¥ä¸­åºç»“ç‚¹
    
*   ä»¤ `relpacement` æŒ‡å‘ç»“ç‚¹çš„éç©ºå­ç»“ç‚¹
    
*   è‹¥ `replacemnet` ä¸ä¸ºç©ºï¼Œå³æ‰¾åˆ°äº†è¯¥ç»“ç‚¹çš„éç©ºå­ç»“ç‚¹ï¼Œåˆ™ç”¨è¯¥å­ç»“ç‚¹ç»“ç‚¹æ›¿æ¢è¯¥ç»“ç‚¹ã€‚ç‰¹åˆ«æ³¨æ„ `parent` å±æ€§çš„èµ‹å€¼ã€‚è‹¥è¯¥ç»“ç‚¹æ˜¯é»‘è‰²ï¼Œå¤„ç†åŒé»‘ç¼ºé™·ã€‚
    
*   è‹¥è¯¥ç»“ç‚¹æ²¡æœ‰å­ç»“ç‚¹ï¼Œä¸”çˆ¶ç»“ç‚¹ä¸ºç©ºï¼Œè¯´æ˜è¯¥ç»“ç‚¹å°±æ˜¯æ ¹èŠ‚ç‚¹ï¼Œç›´æ¥åˆ é™¤
    
*   è‹¥è¯¥ç»“ç‚¹æ²¡æœ‰å­ç»“ç‚¹ï¼Œä¸”çˆ¶ç»“ç‚¹ä¸æ˜¯ç©º
    
    *   è‹¥ä¸ºé»‘è‰²ç»“ç‚¹ï¼Œå¤„ç†åŒé»‘ç¼ºé™·
        
    *   åˆ é™¤è¯¥ç»“ç‚¹
        

        private void deleteNode(RBNode<K, V> node) {
            if (node.left != null && node.right != null) {
    //            RBNode<K, V> predecessor = predecessor(node);
    //            node.value = predecessor.value;
    //            node = predecessor;
                RBNode<K, V> successor = successor(node);
                node.key = successor.key;
                node.value = successor.value;
                node = successor;
            }
            RBNode<K, V> replacement = node.left != null ? node.left : node.right;
            if (replacement != null) {
                replacement.parent = node.parent;
                if (node.parent == null) {
                    root = replacement;
                } else if (node == node.parent.left) {
                    node.parent.left = replacement;
                } else {
                    node.parent.right = replacement;
                }
                node.left = node.right = node.parent = null;
                if (colorOf(node) == BLACK) {
                    fixAfterRemove(replacement);
                }
            } else if (node.parent == null) {
                root = null;
            } else {
                if (colorOf(node) == BLACK) {
                    fixAfterRemove(node);
                }
                if (node.parent != null) {
                    if (node == node.parent.left) {
                        node.parent.left = null;
                    } else {
                        node.parent.right = null;
                    }
                }
            }
        }
    

3ï¸âƒ£ å¤„ç†åŒé»‘ç¼ºé™·

ä»£ç æè¿°

*   åªè¦å½“å‰ç»“ç‚¹ä¸æ˜¯æ ¹èŠ‚ç‚¹ï¼Œä¸”é¢œè‰²ä¸ºé»‘è‰²ï¼Œå¾ªç¯
    
    *   å¦‚æœå½“å‰ç»“ç‚¹æ˜¯å·¦èŠ‚ç‚¹ï¼Œå³ä¸º `L` å‹
        
        *   ä»¤ `s` ä¸ºè¯¥ç»“ç‚¹çš„å³å…„å¼Ÿç»“ç‚¹
            
        *   è‹¥ `s` ä¸ºçº¢è‰²ï¼Œè¯´æ˜è¯¥ç»“ç‚¹çš„å…„å¼Ÿç»“ç‚¹ä¸ºçº¢è‰²ï¼Œå±äºæƒ…å†µä¸‰ï¼ˆ2ï¼‰ï¼Œå°†å…¶è½¬åŒ–ä¸ºæƒ…å†µä¸€æˆ–äºŒï¼ˆå…„å¼Ÿç»“ç‚¹ `s` å˜ä¸ºé»‘ï¼‰
            
        *   è‹¥ `s` ä¸ºé»‘è‰²ï¼Œä¸”æ— çº¢å­©å­ï¼Œå±äºæƒ…å†µäºŒï¼ˆå°†å…„å¼Ÿç»“ç‚¹ `s` æŸ“çº¢ï¼‰ï¼Œå°† `x` èµ‹äºˆ `x.parent` å‘ä¸Šç»§ç»­åŒé»‘ä¿®æ­£
            
        *   å¦åˆ™ï¼Œè‹¥æœ‰çº¢å­©å­
            
            *   è‹¥ä¸º `LL` å‹ï¼Œå³æ—‹ + æŸ“è‰²ï¼Œå±äºæƒ…å†µä¸€ï¼ˆ1ï¼‰
                
            *   è‹¥ä¸º `LR` å‹ï¼Œå·¦å³æ—‹ + æŸ“è‰²ï¼Œå±äºæƒ…å†µä¸€ï¼ˆ2ï¼‰
                
    *   å¦‚æœå½“å‰ç»“ç‚¹æ˜¯å³èŠ‚ç‚¹ï¼Œå³ä¸º `R` å‹
        
        *   ä»¤ `s` ä¸ºè¯¥ç»“ç‚¹çš„å·¦å…„å¼Ÿç»“ç‚¹
            
        *   è‹¥ `s` ä¸ºçº¢è‰²ï¼Œè¯´æ˜è¯¥ç»“ç‚¹çš„å…„å¼Ÿç»“ç‚¹ä¸ºçº¢è‰²ï¼Œå±äºæƒ…å†µä¸‰ï¼ˆ1ï¼‰ï¼Œå°†å…¶è½¬åŒ–ä¸ºæƒ…å†µä¸€æˆ–äºŒï¼ˆå…„å¼Ÿç»“ç‚¹ `s` å˜ä¸ºé»‘ï¼‰
            
        *   è‹¥ `s` ä¸ºé»‘è‰²ï¼Œä¸”æ— çº¢å­©å­ï¼Œå±äºæƒ…å†µäºŒï¼ˆå°†å…„å¼Ÿç»“ç‚¹ `s` æŸ“çº¢ï¼‰ï¼Œå°† `x` èµ‹äºˆ `x.parent` å‘ä¸Šç»§ç»­åŒé»‘ä¿®æ­£
            
        *   å¦åˆ™ï¼Œè‹¥æœ‰çº¢å­©å­
            
            *   è‹¥ä¸º `RR` å‹ï¼Œå·¦æ—‹ + æŸ“è‰²ï¼Œå±äºæƒ…å†µä¸€ï¼ˆ3ï¼‰
                
            *   è‹¥ä¸º `RL` å‹ï¼Œå³å·¦æ—‹ + æŸ“è‰²ï¼Œå±äºæƒ…å†µä¸€ï¼ˆ4ï¼‰
                
*   `x` æœ‰å¯èƒ½æœ€åæŒ‡å‘æ ¹ç»“ç‚¹ï¼Œå¿…é¡»ä¿è¯ä¸ºé»‘è‰²
    

        private void fixAfterRemove(RBNode<K, V> x) {
            while (x != root && colorOf(x) == BLACK) {
                if (x == x.parent.left) {
                    RBNode<K, V> s = x.parent.right;
                    if (colorOf(s) == RED) {
                        leftRotate(x.parent);
                        setColor(s, BLACK);
                        setColor(x.parent, RED);
                        s = x.parent.right;
                    }
                    if (colorOf(s.left) == BLACK && colorOf(s.right) == BLACK) {
                        setColor(s, RED);
                        x = x.parent;
                    } else {
                        if (colorOf(s.right) == BLACK) {
                            RBNode<K, V> p = s.parent;
                            rightLeftRotate(p);
                            setColor(s, BLACK);
                            setColor(s.parent, p.color);
                            setColor(p, BLACK);
                            x = root;
                        } else {
                            RBNode<K, V> p = s.parent;
                            leftRotate(p);
                            setColor(s, colorOf(p));
                            setColor(p, BLACK);
                            setColor(s.right, BLACK);
                            x = root;  // ç»ˆæ­¢å¾ªç¯
                        }
                    }
                } else {
                    RBNode<K, V> s = x.parent.left;
                    if (colorOf(s) == RED) {
                        setColor(s, BLACK);
                        setColor(x.parent, RED);
                        rightRotate(x.parent);
                        s = x.parent.left;
                    }
                    if (colorOf(s.left) == BLACK && colorOf(s.right) == BLACK) {
                        setColor(s, RED);
                        x = x.parent;
                    } else {
                        if (colorOf(s.left) == BLACK) {
                            RBNode<K, V> p = s.parent;
                            leftRightRotate(p);
                            setColor(s, BLACK);
                            setColor(s.parent, p.color);
                            setColor(p, BLACK);
                            x = root;
                        } else {
                            RBNode<K, V> p = s.parent;
                            rightRotate(p);
                            setColor(s, colorOf(p));
                            setColor(p, BLACK);
                            setColor(s.left, BLACK);
                            x = root;
                        }
                    }
                }
            }
            setColor(x, BLACK);
        }
    
    

### æ€»ç»“

![](https://img2022.cnblogs.com/blog/2288178/202203/2288178-20220331194235797-751080573.png)

æœ€å¤šæ¶‰åŠ `3` æ¬¡æ—‹è½¬ï¼Œ`O(logn)` æ¬¡æŸ“è‰²

AVL æ ‘ vs çº¢é»‘æ ‘
------------

*   æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤æœ€åæ—¶é—´å¤æ‚åº¦å‡ä¸º `O(logn)`ã€‚
    
*   çº¢é»‘æ ‘å¹³è¡¡æ€§å¼±äº AVL æ ‘ï¼Œæ•…æŸ¥æ‰¾æ€§èƒ½ä½äº AVL æ ‘ã€‚
    
*   çº¢é»‘æ ‘æ’å…¥åˆ é™¤æ‰€éœ€çš„æ—‹è½¬æ¬¡æ•°è¾ƒå°‘ï¼Œæ’å…¥ã€åˆ é™¤æ•ˆç‡é«˜äº AVL æ ‘ã€‚
    

å®Œæ•´ä»£ç 
----

    class RBTree<K extends Comparable<K>, V> {
        private static final boolean RED = false;
        private static final boolean BLACK = true;
        private RBNode<K, V> root;
    
        private void inorder(RBNode<K, V> root) {
            if (root != null) {
                inorder(root.left);
                System.out.print(root.key + " " + (root.color ? "B" : "R") + " ");
                inorder(root.right);
            }
        }
    
        private void preorder(RBNode<K, V> root) {
            if (root != null) {
                System.out.print(root.key + " " + (root.color ? "B" : "R") + " ");
                preorder(root.left);
                preorder(root.right);
            }
        }
    
        public void preorderTraverse() {
            preorder(this.root);
            System.out.println();
        }
    
        public void inorderTraverse() {
            inorder(this.root);
            System.out.println();
        }
    
        public boolean colorOf(RBNode<K, V> node) {
            return node != null ? node.color : BLACK;
        }
    
        public void insert(K key, V value) {
            RBNode<K, V> t = this.root;
            if (t == null) {
                this.root = new RBNode<K, V>(null, key, value);
                setColor(root, BLACK);
                return;
            }
            int cmp = 0;
            RBNode<K, V> parent = null;
            while (t != null) {
                parent = t;
                cmp = key.compareTo(t.key);
                if (cmp < 0) {
                    t = t.left;
                } else if (cmp > 0) {
                    t = t.right;
                } else {
                    t.value = value;
                    return;
                }
            }
            RBNode<K, V> e = new RBNode<K, V>(parent, key, value);
            if (cmp < 0) {
                parent.left = e;
            } else {
                parent.right = e;
            }
            // å¹³è¡¡å¤„ç†ï¼Œæ—‹è½¬+å˜è‰²
            fixAfterInsert(e);
        }
    
        private void fixAfterInsert(RBNode<K, V> x) {
            setColor(x, RED);
            while (x != null && x != root && colorOf(x.parent) == RED) {
                if (x.parent == x.parent.parent.left) {
                    RBNode<K, V> uncle = x.parent.parent.right;
                    if (colorOf(uncle) == RED) {
                        setColor(x.parent, BLACK);
                        setColor(uncle, BLACK);
                        setColor(x.parent.parent, RED);
                        x = x.parent.parent;
                    } else {
                        if (x == x.parent.right) {
                            leftRightRotate(x.parent.parent);
                            setColor(x, BLACK);
                            setColor(x.right, RED);
                        } else {
                            setColor(x.parent, BLACK);
                            setColor(x.parent.parent, RED);
                            rightRotate(x.parent.parent);
                        }
                    }
                } else {
                    RBNode<K, V> uncle = x.parent.parent.left;
                    if (colorOf(uncle) == RED) {
                        setColor(x.parent, BLACK);
                        setColor(uncle, BLACK);
                        setColor(x.parent.parent, RED);
                        x = x.parent.parent;
                    } else {
                        if (x == x.parent.left) {
                            rightLeftRotate(x.parent.parent);
                            setColor(x, BLACK);
                            setColor(x.left, RED);
                        } else {
                            setColor(x.parent, BLACK);
                            setColor(x.parent.parent, RED);
                            leftRotate(x.parent.parent);
                        }
                    }
                }
            }
            setColor(root, BLACK);
        }
    
        private RBNode<K, V> predecessor(RBNode<K, V> node) {
            if (node == null) {
                return null;
            } else if (node.left != null) {
                RBNode<K, V> p = node.left;
                while (p.right != null) {
                    p = p.right;
                }
                return p;
            } else {
                RBNode<K, V> p = node.parent;
                RBNode<K, V> ch = node;
                while (p != null && ch == p.left) {
                    ch = p;
                    p = p.parent;
                }
                return p;
            }
        }
    
        private RBNode<K, V> successor(RBNode<K, V> node) {
            if (node == null) {
                return null;
            } else if (node.right != null) {
                RBNode<K, V> p = node.right;
                while (p.left != null) {
                    p = p.left;
                }
                return p;
            } else {
                RBNode<K, V> p = node.parent;
                RBNode<K, V> ch = node;
                while (p != null && ch == p.right) {
                    ch = p;
                    p = p.parent;
                }
                return p;
            }
        }
    
        public void remove(K key) {
            RBNode<K, V> node = getNode(key);
            if (node == null) return;
            deleteNode(node);
            return;
        }
    
        private void deleteNode(RBNode<K, V> node) {
            if (node.left != null && node.right != null) {
    //            RBNode<K, V> predecessor = predecessor(node);
    //            node.value = predecessor.value;
    //            node = predecessor;
                RBNode<K, V> successor = successor(node);
                node.key = successor.key;
                node.value = successor.value;
                node = successor;
            }
            RBNode<K, V> replacement = node.left != null ? node.left : node.right;
            if (replacement != null) {
                replacement.parent = node.parent;
                if (node.parent == null) {
                    root = replacement;
                } else if (node == node.parent.left) {
                    node.parent.left = replacement;
                } else {
                    node.parent.right = replacement;
                }
                node.left = node.right = node.parent = null;
                if (colorOf(node) == BLACK) {
                    fixAfterRemove(replacement);
                }
            } else if (node.parent == null) {
                root = null;
            } else {
                if (colorOf(node) == BLACK) {
                    fixAfterRemove(node);
                }
                if (node.parent != null) {
                    if (node == node.parent.left) {
                        node.parent.left = null;
                    } else {
                        node.parent.right = null;
                    }
                }
            }
        }
    
        private void fixAfterRemove(RBNode<K, V> x) {
            while (x != root && colorOf(x) == BLACK) {
                if (x == x.parent.left) {
                    RBNode<K, V> s = x.parent.right;
                    if (colorOf(s) == RED) {
                        leftRotate(x.parent);
                        setColor(s, BLACK);
                        setColor(x.parent, RED);
                        s = x.parent.right;
                    }
                    if (colorOf(s.left) == BLACK && colorOf(s.right) == BLACK) {
                        setColor(s, RED);
                        x = x.parent;
                    } else {
                        if (colorOf(s.right) == BLACK) {
                            RBNode<K, V> p = s.parent;
                            rightLeftRotate(p);
                            setColor(s, BLACK);
                            setColor(s.parent, p.color);
                            setColor(p, BLACK);
                            x = root;
                        } else {
                            RBNode<K, V> p = s.parent;
                            leftRotate(p);
                            setColor(s, colorOf(p));
                            setColor(p, BLACK);
                            setColor(s.right, BLACK);
                            x = root;  // ç»ˆæ­¢å¾ªç¯
                        }
                    }
                } else {
                    RBNode<K, V> s = x.parent.left;
                    if (colorOf(s) == RED) {
                        setColor(s, BLACK);
                        setColor(x.parent, RED);
                        rightRotate(x.parent);
                        s = x.parent.left;
                    }
                    if (colorOf(s.left) == BLACK && colorOf(s.right) == BLACK) {
                        setColor(s, RED);
                        x = x.parent;
                    } else {
                        if (colorOf(s.left) == BLACK) {
                            RBNode<K, V> p = s.parent;
                            leftRightRotate(p);
                            setColor(s, BLACK);
                            setColor(s.parent, p.color);
                            setColor(p, BLACK);
                            x = root;
                        } else {
                            RBNode<K, V> p = s.parent;
                            rightRotate(p);
                            setColor(s, colorOf(p));
                            setColor(p, BLACK);
                            setColor(s.left, BLACK);
                            x = root;
                        }
                    }
                }
            }
            setColor(x, BLACK);
        }
    
        private RBNode<K, V> getNode(K key) {
            RBNode<K, V> node = this.root;
            while (node != null) {
                int cmp = key.compareTo(node.key);
                if (cmp < 0) {
                    node = node.left;
                } else if (cmp > 0) {
                    node = node.right;
                } else {
                    return node;
                }
            }
            return null;
        }
    
        private void setColor(RBNode<K, V> node, boolean color) {
            if (node != null) {
                node.color = color;
            }
        }
    
        private void leftRotate(RBNode<K, V> g) {
            if (g != null) {
                RBNode<K, V> p = g.right;
                g.right = p.left;
                if (p.left != null) {
                    p.left.parent = g;
                }
                p.parent = g.parent;
                if (g.parent == null) {
                    this.root = p;
                } else if (g.parent.left == g) {
                    g.parent.left = p;
                } else {
                    g.parent.right = p;
                }
                p.left = g;
                g.parent = p;
            }
        }
    
        private void rightRotate(RBNode<K, V> g) {
            if (g != null) {
                RBNode<K, V> p = g.left;
                g.left = p.right;
                if (p.right != null) {
                    p.right.parent = g;
                }
                p.parent = g.parent;
                if (g.parent == null) {
                    this.root = p;
                } else if (g.parent.left == g) {
                    g.parent.left = p;
                } else {
                    g.parent.right = p;
                }
                p.right = g;
                g.parent = p;
            }
        }
    
        private void leftRightRotate(RBNode<K, V> g) {
            leftRotate(g.left);
            rightRotate(g);
        }
    
        private void rightLeftRotate(RBNode<K, V> g) {
            rightRotate(g.right);
            leftRotate(g);
        }
    }
    
    class RBNode<K extends Comparable<K>, V> {
        public RBNode<K, V> parent;
        public RBNode<K, V> left;
        public RBNode<K, V> right;
        public boolean color;
        public K key;
        public V value;
    
        public RBNode(RBNode<K, V> parent, K key, V value) {
            this.parent = parent;
            this.key = key;
            this.value = value;
        }
    }
    

ğŸ› æ–¹æ³•æµ‹è¯•

        public static void main(String[] args) {
            RBTree<Integer, Integer> tree = new RBTree<>();
            Scanner scanner = new Scanner(System.in);
            int n;
            n = scanner.nextInt();
            while (n-- > 0) {
                String operation = scanner.next();
                String value = scanner.next();
                if (operation.equals("Insert")) {
                    tree.insert(Integer.parseInt(value), 1);
                } else {
                    tree.remove(Integer.parseInt(value));
                }
            }
            tree.inorderTraverse();
            System.out.println();
            tree.preorderTraverse();
        }
    

**è¾“å…¥**ï¼š

    32
    Insert 10
    Insert 40
    Insert 30
    Insert 60
    Insert 90
    Insert 70
    Insert 20
    Insert 50
    Insert 80
    Insert 10
    Insert 66
    Insert 85
    Insert 60
    Insert 12
    Insert 32
    Insert 74
    Insert 7
    Insert 52
    Insert -5
    Insert 13
    Insert 23
    Insert 13
    Insert 103
    Insert 306
    Insert 2
    Insert -97
    Insert 752
    Remove 90
    Remove 60
    Remove 70
    Remove 50
    Remove 80
    

**è¾“å‡º**ï¼š

    -97 R -5 B 2 R 7 R 10 B 12 B 13 R 20 B 23 R 30 R 32 B 40 B 52 B 66 B 74 B 85 B 103 B 306 R 752 B 
    
    66 B 30 R 12 B 7 R -5 B -97 R 2 R 10 B 20 B 13 R 23 R 40 B 32 B 52 B 85 B 74 B 306 R 103 B 752 B