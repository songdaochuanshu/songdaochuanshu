---
layout: post
title: "ä»0æ­å»ºvue3ç»„ä»¶åº“:ShakeæŠ–åŠ¨ç»„ä»¶"
date: "2022-10-19T08:38:46.578Z"
---
ä»0æ­å»ºvue3ç»„ä»¶åº“:ShakeæŠ–åŠ¨ç»„ä»¶
=====================

å…ˆçœ‹ä¸‹æ•ˆæœ

![GIF2.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d944017b59b64be890c017c1619d2e2d~tplv-k3u1fbpfcp-watermark.image?)

å…¶å®å°±æ˜¯ä¸ªæŠ–åŠ¨æ•ˆæœç»„ä»¶ï¼Œå®ç°èµ·æ¥ä¹Ÿéå¸¸ç®€å•ã€‚ä¹‹æ‰€ä»¥åšè¿™æ ·ä¸€ä¸ªç»„ä»¶æ˜¯ä¸ºäº†åé¢å†™Formè¡¨å•çš„æ—¶å€™ä¼šç”¨åˆ°å®ƒåšä¸€ä¸ªè§„åˆ™æ ¡éªŒï¼Œæ¯”å¦‚ä¸‹é¢ä¸€ä¸ªç®€å•çš„ç™»å½•é¡µé¢ï¼Œå½“ç‚¹å‡»ç™»å½•ä¼šæç¤ºç”¨æˆ·å“ªä¸ªä¿¡æ¯æ²¡è¾“å…¥ï¼Œå½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªç®€é™‹çš„demo

![GIF7.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/315a74f5ca1a46b1a91164eaf27e4bd1~tplv-k3u1fbpfcp-watermark.image?)

æ¥ä¸‹æ¥å°±å¼€å§‹æˆ‘ä»¬çš„Shakeç»„ä»¶å®ç°

CSSæ ·å¼
-----

å½“ä½ éœ€è¦æŠ–åŠ¨çš„æ—¶å€™å°±ç»™å®ƒæ·»åŠ ä¸ªæŠ–åŠ¨çš„ç±»åï¼Œä¸éœ€è¦å°±ç§»é™¤è¿™ä¸ªç±»åå³å¯ã€‚æŠ–åŠ¨æ•ˆæœå°±ç”¨CSS3ä¸­çš„`transform`çš„å¹³ç§»å±æ€§åŠ åŠ¨ç”»å®ç°

    @keyframes shake {
    
        10%,
        90% {
            transform: translate3d(-1px, 0, 0);
        }
    
        20%,
        80% {
            transform: translate3d(2px, 0, 0);
        }
    
        30%,
        70% {
            transform: translate3d(-4px, 0, 0);
        }
    
        40%,
        60% {
            transform: translate3d(4px, 0, 0);
        }
    
        50%,
        50% {
            transform: translate3d(-4px, 0, 0);
        }
    }
    
    .k-shake.k-shakeactive {
        animation: shake 1s linear;
    }
    
    

ç»„ä»¶é€»è¾‘
----

æ ¹æ®ä¸Šé¢æ•ˆæœï¼Œå¾ˆæ˜¾ç„¶æ˜¯éœ€è¦ç”¨åˆ°æ’æ§½`slot`çš„ï¼Œåšåˆ°ç”¨æˆ·ä¼ ä»€ä¹ˆæˆ‘ä»¬å°±æŠ–ä»€ä¹ˆï¼Œåšåˆ°ä¸‡ç‰©çš†å¯æŠ–ã€‚

![R-C.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e09b0dfced5f4c76970a5eb7b0bd10b4~tplv-k3u1fbpfcp-watermark.image?)

è¿™é‡Œä½¿ç”¨vue3ä¸­çš„`v-model`æŒ‡ä»¤ä¼šæ›´æ–¹ä¾¿ï¼Œå¦‚ä¸‹ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨`Shake`ç»„ä»¶æ—¶ï¼Œ`trigger`ä¸º`true`å³å¼€å§‹æŠ–åŠ¨

            <Shake v-model="trigger">
                æŠ–åŠ¨
            </Shake>
    

ç»„ä»¶å…·ä½“å®ç°ä»£ç ,åŒæ ·çš„è¿™æ¬¡è¿˜æ˜¯ä½¿ç”¨`setup`è¯­æ³•ç³–å½¢å¼å®ç°

    <template>
        <div class="k-shake" :class="{['k-shakeactive']:props.modelValue}">
            <slot />
        </div>
    </template>
    <script lang="ts">
    import { defineComponent } from 'vue'
    import './style/index.less'
    export default defineComponent({
        name: 'k-shake'
    });
    </script>
    <script lang='ts' setup>
    import { watch } from 'vue'
    //v-modelä¼ æ¥çš„å€¼å³ä¸ºmodelValue
    type ShakeProps = {
        modelValue?: boolean
    }
    //å‘é€update:modelValueæ¥é…åˆv-modelè¯­æ³•ç³–
    type Emits = {
        (e: 'update:modelValue', value: boolean): void
    }
    
    //è·å–propså±æ€§å¹¶ä¸”è®¾ç½®é»˜è®¤å€¼
    const props = withDefaults(defineProps<ShakeProps>(), {
        modelValue: false
    })
    const emits = defineEmits<Emits>()
    
    //ç›‘å¬modelValueï¼Œä¸ºtrueçš„è¯ï¼Œ1såç½®ä¸ºfalse
    watch(() => props.modelValue, (newVal) => {
        if (newVal) {
            setTimeout(() => {
                emits("update:modelValue", false)
            }, 1000);
        }
    
    }, { immediate: true })
    
    
    </script>
    
    

**è¯´æ˜**

è¿™é‡Œæ¥æ”¶å‚æ•°`props`ä»¥åŠäº‹ä»¶`emits`ä½¿ç”¨äº†ä»¥æ³›å‹çš„å½¢å¼å®šä¹‰ï¼Œä¸äº†è§£çš„å¯ä»¥çœ‹ä¸‹è¿™ä¸ª[ä¼ é€é—¨](https://cn.vuejs.org/api/sfc-script-setup.html#typescript-only-features)ã€‚watchåŠ äº†ç«‹å³ç›‘å¬ä¸ºäº†é˜²æ­¢ç”¨æˆ·ä¸Šæ¥å°±èµ‹å€¼ä¸º`true`å¯¼è‡´ä¸‹æ¬¡ä¸è§¦å‘ã€‚

å•å…ƒæµ‹è¯•
----

æ–°å»º`shake.test.ts`

    import { describe, expect, it } from "vitest";
    import { mount } from '@vue/test-utils'
    import shake from '../shake.vue'
    // The component to test
    
    
    describe('test shake', () => {
        it("should render slot", () => {
            const wrapper = mount(shake, {
                slots: {
                    default: 'Hello world'
                }
            })
    
            // Assert the rendered text of the component
            expect(wrapper.text()).toContain('Hello world')
        })
        it("should have class", () => {
            const wrapper = mount(shake, {
                props: {
                    modelValue: true
                }
            })
            expect(wrapper.classes()).toContain('k-shakeactive')
        })
    })
    

è¿™ä¸ªå•å…ƒæµ‹è¯•çš„æ„æ€å…¶å®å°±æ˜¯

1.  `slot`ä¼ å…¥`Hello world`,æœŸæœ›é¡µé¢å°±ä¼šå‡ºç°`Hello world`
2.  `props`ä¼ å…¥`modelValue`ä¸º`true`,é‚£ä¹ˆç»„ä»¶å°±åŒ…å«æ ·å¼`k-shakeactive`

æœ€åæ‰§è¡Œ`pnpm run coverage`å‘½ä»¤å°±ä¼šæ”¾ä¸‹`shake`æµ‹è¯•ä»£ç é€šè¿‡äº†

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/beeb5418ab954cbe9a9ed8ad5f6165c3~tplv-k3u1fbpfcp-watermark.image?)

å¯¼å‡ºæ‰“åŒ…å‘å¸ƒ
------

è¿™é‡Œå’Œä»¥å¾€ç»„ä»¶å®ç°åŸºæœ¬ä¸€æ ·äº†ï¼Œè¿™é‡Œç›´æ¥è´´ä»£ç 

*   shake/index.ts

    import shake from './shake.vue'
    import { withInstall } from '@kitty-ui/utils'
    const Shake = withInstall(shake)
    export default Shake
    

*   src/index.ts

    export { default as Button } from './button'
    export { default as Icon } from './icon'
    export { default as Link } from './link'
    export { default as Upload } from './upload'
    export { default as Shake } from './shake'
    

æœ€åæ‰§è¡Œ

    pnpm run build:kitty
    

    pnpm run pnpm run build:kitty
    

å³å¯å®Œæˆå‘å¸ƒ

å†™åœ¨æœ€å
----

ç»„ä»¶åº“çš„æ‰€æœ‰å®ç°ç»†èŠ‚å¯ä»¥å…³æ³¨å…¬ä¼—å· webå‰ç«¯è¿›é˜¶ è·å–ï¼ŒåŒ…æ‹¬`ç¯å¢ƒæ­å»º`ï¼Œ`è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ`ï¼Œ`æ–‡æ¡£æ­å»º`ï¼Œ`vitestå•å…ƒæµ‹è¯•`ç­‰ç­‰ã€‚

> å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©åŠ¨åŠ¨æŒ‡å¤´ç‚¹ä¸ªèµğŸ‘å§~

å¼€æºåœ°å€
----

[kitty-ui: Vite+Tsæ­å»ºçš„Vue3ç»„ä»¶åº“](https://gitee.com/geeksdidi/kittyui)