---
layout: post
title: "ç§è—ï¼èµ„æ·±æ•°æ®ä¸“å®¶SQLæ•ˆç‡ä¼˜åŒ–æŠ€å·§ â›µ"
date: "2022-12-01T16:25:52.537Z"
---
ç§è—ï¼èµ„æ·±æ•°æ®ä¸“å®¶SQLæ•ˆç‡ä¼˜åŒ–æŠ€å·§ â›µ
====================

![ç§è—ï¼èµ„æ·±æ•°æ®ä¸“å®¶SQLæ•ˆç‡ä¼˜åŒ–æŠ€å·§ â›µ](https://img2023.cnblogs.com/blog/2637458/202211/2637458-20221129110753450-556518776.png) åŒä¸€ä¸ªæ•°æ®åˆ†æçš„éœ€æ±‚ï¼Œä¸åŒäººçš„SQLä»£ç æ•ˆç‡ä¸Šä¼šå·®åˆ«å¾ˆå¤§ï¼æœ¬æ–‡ç»™å¤§å®¶æ¢³ç†é›†ä¸­æ•ˆç‡ä¼˜åŒ–æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯æ•°æ®å²—é¢è¯•çš„é«˜é¢‘é—®é¢˜å“¦ï¼å¿«å­¦èµ·æ¥~

![](https://img-blog.csdnimg.cn/img_convert/48a826f05fd80b7c420ce0850e69cfe2.png)

> ğŸ’¡ ä½œè€…ï¼š[éŸ©ä¿¡å­](https://github.com/HanXinzi-AI)@[ShowMeAI](https://www.showmeai.tech/)  
> ğŸ“˜ [æ•°æ®åˆ†æå®æˆ˜ç³»åˆ—](https://www.showmeai.tech/tutorials/40)ï¼š[https://www.showmeai.tech/tutorials/40](https://www.showmeai.tech/tutorials/40)  
> ğŸ“˜ [æœ¬æ–‡åœ°å€](https://www.showmeai.tech/article-detail/391)ï¼š[https://www.showmeai.tech/article-detail/391](https://www.showmeai.tech/article-detail/391)  
> ğŸ“¢ å£°æ˜ï¼šç‰ˆæƒæ‰€æœ‰ï¼Œè½¬è½½è¯·è”ç³»å¹³å°ä¸ä½œè€…å¹¶æ³¨æ˜å‡ºå¤„  
> ğŸ“¢ æ”¶è—[ShowMeAI](https://www.showmeai.tech/)æŸ¥çœ‹æ›´å¤šç²¾å½©å†…å®¹

![](https://img-blog.csdnimg.cn/img_convert/364e59af9d47fb254f24554490e8da1a.png)

æ‰€æœ‰çš„æ•°æ®ç›¸å…³å·¥ä½œäººå‘˜ï¼ŒåŒ…æ‹¬æ•°æ®å¼€å‘ã€æ•°æ®åˆ†æå¸ˆã€æ•°æ®ç§‘å­¦å®¶ç­‰ï¼Œå¤šå¤šå°‘å°‘ä¼šä½¿ç”¨æ•°æ®åº“ï¼Œæˆ‘ä»¬å¾ˆå¤šçš„ä¸šåŠ¡æ•°æ®ä¹Ÿæ˜¯å­˜æ”¾åœ¨ä¸šåŠ¡è¡¨ä¸­ã€‚ä½†å³ä½¿æ˜¯åŒä¸€ä¸ªéœ€æ±‚ï¼Œä¸åŒäººå†™å‡ºçš„ SQL æ•ˆç‡ä¸Šä¹Ÿä¼šæœ‰å¾ˆå¤§å·®åˆ«ï¼Œè€Œæˆ‘ä»¬åœ¨æ•°æ®å²—ä½é¢è¯•çš„æ—¶å€™ï¼Œä¹Ÿä¼šè€ƒå¯Ÿç›¸å…³çš„æŠ€èƒ½å’Œæ€è€ƒï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œ[ShowMeAI](https://www.showmeai.tech/)å°†ç»™å¤§å®¶æ¢³ç† SQL ä¸­å¯ä»¥ç”¨äºä¼˜åŒ–æ•ˆç‡å’Œæé€Ÿçš„æ ¸å¿ƒè¦æ±‚ã€‚

![](https://img-blog.csdnimg.cn/img_convert/bd38f0d215e0fe061901b11f41d7d3f8.png)

> å…³äº SQL çš„åŸºç¡€æŠ€èƒ½çŸ¥è¯†ï¼Œæ¬¢è¿å¤§å®¶æŸ¥é˜…[ShowMeAI](https://www.showmeai.tech/)åˆ¶ä½œçš„é€ŸæŸ¥è¡¨ï¼š
> 
> ğŸ“˜ [**ç¼–ç¨‹è¯­è¨€é€ŸæŸ¥è¡¨ | SQL é€ŸæŸ¥è¡¨**](https://www.showmeai.tech/article-detail/99)

ğŸ’¡ 1ï¼‰ä½¿ç”¨æ­£åˆ™`regexp_like`ä»£æ›¿`LIKE`
==============================

å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬è¦è¿›è¡Œæ¨¡ç³ŠåŒ¹é…çš„æ—¶å€™ï¼ˆå°¤å…¶æ˜¯åŒ¹é…é¡¹å¾ˆå¤šçš„æ—¶å€™ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨`regexp_like`ä»£æ›¿`LIKE`å¯ä»¥æé«˜æ•ˆç‡ã€‚

ğŸ’¦ ä½æ•ˆä»£ç 
-------

    SELECT *
    FROM phones
    WHERE
        lower(name) LIKE '%samsing&' OR
        lower(name) LIKE '%apple&' OR
        lower(name) LIKE '%htc&' OR
    

ğŸ’¦ é«˜æ•ˆä»£ç 
-------

    SELECT *
    FROM phones
    WHERE
        REGEXP_LIKE(lower(name),'samsung|apple|htc')
    

ğŸ’¡ 2ï¼‰ä½¿ç”¨`regexp_extract`ä»£æ›¿ `Case-when Like`
==========================================

ç±»ä¼¼çš„ï¼Œä½¿ç”¨`regexp_extract`ä»£æ›¿`Case-when Like`å¯ä»¥æé«˜æ•ˆç‡ã€‚

ğŸ’¦ ä½æ•ˆä»£ç 
-------

    SELECT *
    CASE
        WHEN concat(' ', name, ' ') LIKE '%acer%' then 'Acer' 
        WHEN concat(' ', name, ' ') LIKE '%samsung%' then 'Samsung'
        WHEN concat(' ', name, ' ') LIKE '%dell%' then 'Dell'
    AS brand
    FROM laptops
    

ğŸ’¦ é«˜æ•ˆä»£ç 
-------

    SELECT
          regexp_extract(name,'(acer|samsung|dell)')
    AS brand
    FROM laptops
    

ğŸ’¡ 3ï¼‰INå­å¥è½¬æ¢ä¸ºä¸´æ—¶è¡¨
===============

ä½†æˆ‘ä»¬è¿›è¡Œæ•°æ®é€‰æ‹©æ—¶å€™ï¼Œæœ‰æ—¶å€™ä¼šç”¨åˆ°`in`ä½œä¸ºæ¡ä»¶é€‰æ‹©ï¼Œå¦‚æœæˆ‘ä»¬çš„å€™é€‰é¡¹éå¸¸å¤šï¼Œé‚£åˆ©ç”¨ä¸´æ—¶è¡¨å¯èƒ½ä¼šå¸¦æ¥æ›´å¥½çš„æ•ˆç‡ã€‚

ğŸ’¦ ä½æ•ˆä»£ç 
-------

    SELECT *
    FROM table1 as t1
    WHERE
         itemid in (3363134, 5343, 5555555)
    

ğŸ’¦ é«˜æ•ˆä»£ç 
-------

    SELECT *
    FROM table 1 as t1
    JOIN (
          SELECT
               itemid
          FROM (
                SELECT
                     split('3363134, 5343, 5555555') as bar
               )
               CROSS JOIN
                       UNNEST(bar) AS t(itemid)
          ) AS table2 as t2
    ON
      t1.itemid = t2.itemid
    

ğŸ’¡ 4ï¼‰å°† JOIN çš„è¡¨ä»å¤§åˆ°å°æ’åº
====================

å½“æˆ‘ä»¬è¦è¿›è¡Œè¡¨å…³è”ï¼ˆjoinï¼‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¡¨åŸºäºå¤§å°è¿›è¡Œä¸€ä¸ªæ’åºï¼ŒæŠŠå¤§è¡¨æ’åœ¨å‰é¢ï¼Œå°è¡¨æ’åœ¨åé¢ï¼Œä¹Ÿä¼šå¸¦æ¥æ•ˆç‡çš„æå‡ã€‚

ğŸ’¦ ä½æ•ˆä»£ç 
-------

    SELECT *
    FROM small_table
    JOIN large_table
    ON small_table.id = large_table.id
    

ğŸ’¦ é«˜æ•ˆä»£ç 
-------

    SELECT *
    FROM large_table
    JOIN small_table
    ON small_table.id = large_table.id
    

ğŸ’¡ 5ï¼‰ä½¿ç”¨ç®€å•çš„è¡¨å…³è”æ¡ä»¶
===============

å¦‚æœæˆ‘ä»¬è¦åŸºäºæ¡ä»¶å¯¹ä¸¤ä¸ªè¡¨è¿›è¡Œè¿æ¥ï¼Œé‚£æ¡ä»¶ä¸­å°½é‡ä¸è¦å‡ºç°å¤æ‚å‡½æ•°ï¼Œå¦‚æœä¸€å®šéœ€è¦ä½¿ç”¨ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å…ˆç”¨å‡½æ•°å¯¹è¡¨çš„æ•°æ®å¤„ç†äº§å‡ºç”¨äºè¿æ¥çš„å­—æ®µã€‚

å¦‚ä¸‹ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¹`a`å’Œ`b`è¡¨è¿›è¡Œè¿æ¥ï¼Œæ¡ä»¶æ˜¯`b`è¡¨çš„ã€Œå¹´ã€ã€Œæœˆã€ã€Œæ—¥ã€æ‹¼æ¥åå’Œ`a`è¡¨çš„æ—¥æœŸä¸€è‡´ï¼Œé‚£ç²—ç³™çš„å†™æ³•å’Œä¼˜åŒ–çš„å†™æ³•åˆ†åˆ«å¦‚ä¸‹ï¼š

ğŸ’¦ ä½æ•ˆä»£ç 
-------

    SELECT *
    FROM table1 a
    JOIN table2 b
    ON a.date = CONCAT(b.year, '-', b.month, '-', b.day)
    

ğŸ’¦ é«˜æ•ˆä»£ç 
-------

    SELECT *
    FROM table1 a
    JOIN (
         SELECT name, CONCAT(b.year, '-', b.month, '-', b.day) as date
         FROM table2 b
    ) new
    ON a.date = new.date
    

ğŸ’¡ 6ï¼‰åˆ†ç»„çš„å­—æ®µæŒ‰ç…§ç±»åˆ«å–å€¼ç§ç±»æ•°æ’åº
=====================

å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®æŒ‰ç…§å¤šä¸ªå­—æ®µåˆ†ç»„ï¼Œå°¤å…¶æ˜¯å­—æ®µä¸­æœ‰idç±»è¿™ç§å–å€¼éå¸¸å¤šçš„ç±»åˆ«å­—æ®µï¼Œæˆ‘ä»¬åº”å½“æŠŠå®ƒæ’åœ¨æœ€å‰é¢ï¼Œè¿™ä¹Ÿå¯ä»¥å¯¹æ•ˆç‡æœ‰ä¸€äº›å¸®åŠ©ã€‚

ğŸ’¦ ä½æ•ˆä»£ç 
-------

    SELECT 
      main_category,
      sub_category,
      itemid
      sum(price)
    FROM
      table1
    GROUP BY
      main_category, sub_category, itemid
    

ğŸ’¦ é«˜æ•ˆä»£ç 
-------

    SELECT 
      main_category,
      sub_category,
      itemid
      sum(price)
    FROM
      table1
    GROUP BY
      itemid, sub_category, main_category
    

ğŸ’¡ 7ï¼‰é¿å… WHERE å­å¥ä¸­çš„å­æŸ¥è¯¢
=====================

å½“æˆ‘ä»¬è¦æŸ¥è¯¢çš„è¯­å¥çš„`where`æ¡ä»¶ä¸­åŒ…å«å­æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`with`è¯­å¥æ„å»ºä¸´æ—¶è¡¨æ¥è°ƒæ•´è¿æ¥æ¡ä»¶ï¼Œæå‡æ•ˆç‡ï¼Œå¦‚ä¸‹ï¼š

ğŸ’¦ é”™è¯¯ä»£ç 
-------

    SELECT sum(price)
    FROM table1
    WHERE itemid in (
             SELECT itemid
             FROM table2
    )
    

ğŸ’¦ å¥½ä»£ç 
------

    WITH t2
         AS (SELECT itemid
             FROM   table2)
    SELECT Sum(price)
    FROM   table1 AS t1
           JOIN t2
             ON t1.itemid = t2.itemid 
    

ğŸ’¡ 8ï¼‰å–æœ€å¤§ç›´æ¥ç”¨Maxè€ŒéRankåå–ç¬¬1
========================

è¿™ä¸€æ¡å¾ˆå¥½ç†è§£ï¼Œå¦‚æœæˆ‘ä»¬è¦å–æŸå­—æ®µæœ€å¤§å–å€¼ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ maxï¼Œè€Œä¸è¦ç”¨ rank æ’åºåå–ç¬¬ 1ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

ğŸ’¦ ä½æ•ˆä»£ç 
-------

    SELECt *
    FROM (
         SELECT userid, rank() over (order by prdate desc) as rank
         FROM table 1
    )
    WHERE ranking = 1
    

ğŸ’¦ é«˜æ•ˆä»£ç 
-------

    SELECT userid, max(prdate)
    FROM table1
    GROUP BY 1
    

ğŸ’¡ 9ï¼‰å…¶ä»–ä¼˜åŒ–ç‚¹
==========

*   å¯¹äºå¤§è¡¨ï¼Œåˆ©ç”¨`approx_distinct()`ä»£æ›¿`count(distinct)`æ¥è®¡æ•°ã€‚
*   å¯¹äºå¤§è¡¨ï¼Œåˆ©ç”¨`approx_percentie(metric,0.5)`ä»£æ›¿`median`ã€‚
*   å°½å¯èƒ½é¿å…ä½¿ç”¨`UNION`ã€‚

å‚è€ƒèµ„æ–™
====

*   ğŸ“˜ [**ç¼–ç¨‹è¯­è¨€é€ŸæŸ¥è¡¨ | SQL é€ŸæŸ¥è¡¨**](https://www.showmeai.tech/article-detail/99)ï¼š[https://www.showmeai.tech/article-detail/99](https://www.showmeai.tech/article-detail/99)

æ¨èé˜…è¯»
====

*   ğŸŒ [**æ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/40) ï¼š[https://www.showmeai.tech/tutorials/40](https://www.showmeai.tech/tutorials/40)
*   ğŸŒ [**æœºå™¨å­¦ä¹ æ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/41)ï¼š[https://www.showmeai.tech/tutorials/41](https://www.showmeai.tech/tutorials/41)
*   ğŸŒ [**æ·±åº¦å­¦ä¹ æ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/42)ï¼š[https://www.showmeai.tech/tutorials/42](https://www.showmeai.tech/tutorials/42)
*   ğŸŒ [**TensorFlowæ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/43)ï¼š[https://www.showmeai.tech/tutorials/43](https://www.showmeai.tech/tutorials/43)
*   ğŸŒ [**PyTorchæ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/44)ï¼š[https://www.showmeai.tech/tutorials/44](https://www.showmeai.tech/tutorials/44)
*   ğŸŒ [**NLPå®æˆ˜æ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/45)ï¼š[https://www.showmeai.tech/tutorials/45](https://www.showmeai.tech/tutorials/45)
*   ğŸŒ [**CVå®æˆ˜æ•°æ®åˆ†æå®æˆ˜ç³»åˆ—**](https://www.showmeai.tech/tutorials/46)ï¼š[https://www.showmeai.tech/tutorials/46](https://www.showmeai.tech/tutorials/46)
*   ğŸŒ [**AI é¢è¯•é¢˜åº“ç³»åˆ—**](https://www.showmeai.tech/tutorials/48)ï¼š[https://www.showmeai.tech/tutorials/48](https://www.showmeai.tech/tutorials/48)

[![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9190f41b8de4af38c8a1a0c96f0513b~tplv-k3u1fbpfcp-zoom-1.image)](https://www.showmeai.tech/)