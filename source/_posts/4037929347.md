---
layout: post
title: "æ¶ˆæ¯é˜Ÿåˆ—ä¹‹RabbitMQä»‹ç»ä¸è¿ç”¨"
date: "2022-10-26T07:20:57.190Z"
---
æ¶ˆæ¯é˜Ÿåˆ—ä¹‹RabbitMQä»‹ç»ä¸è¿ç”¨
==================

> RabbitMQ è¯´æ˜  
> æœ¬ç« ï¼Œæˆ‘ä»¬ä¸»è¦ä»`RabbitMQç®€ä»‹`ã€`RabbitMQå®‰è£…`ã€`RabbitMQå¸¸ç”¨å‘½ä»¤`ã€`RabbitMQæ¶æ„æ¨¡å¼`ã€`RabbitMQä½¿ç”¨`ã€`Quick.RabbitMQPlusçš„ä½¿ç”¨`å’Œ`RabbitMQæ€»ç»“`è¿™å‡ ä¸ªæ–¹é¢å¯¹  
> **RabbitMQ**è¿›è¡Œä»‹ç»ï¼

1ã€ğŸ‡RabbitMQ ç®€ä»‹
---------------

RabbitMQ æ˜¯ä½¿ç”¨[Erlang](https://www.erlang.org)è¯­è¨€å¼€å‘çš„å¼€æºæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼ŒåŸºäº AMQP åè®®æ¥å®ç°ã€‚

AMQP çš„ä¸»è¦ç‰¹å¾æ˜¯é¢å‘æ¶ˆæ¯ã€é˜Ÿåˆ—ã€è·¯ç”±ï¼ˆåŒ…æ‹¬ç‚¹å¯¹ç‚¹å’Œå‘å¸ƒ/è®¢é˜…ï¼‰ã€å¯é æ€§å’Œå®‰å…¨ã€‚AMQP åè®®æ›´å¤šç”¨åœ¨ä¼ä¸šç³»ç»Ÿå†…ï¼Œå¯¹æ•°æ®ä¸€è‡´æ€§ã€ç¨³å®šæ€§å’Œå¯é æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œå¯¹æ€§èƒ½å’Œååé‡çš„è¦æ±‚è¿˜åœ¨å…¶æ¬¡ã€‚

MQ å…¨ç§°ä¸º Message Queueï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯ä¸€ç§`åº”ç”¨ç¨‹åº`å¯¹`åº”ç”¨ç¨‹åº`çš„é€šä¿¡æ–¹æ³•ã€‚åº”ç”¨ç¨‹åºé€šè¿‡è¯»å†™å‡ºå…¥é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼ˆé’ˆå¯¹åº”ç”¨ç¨‹åºçš„æ•°æ®ï¼‰æ¥é€šä¿¡ï¼Œè€Œæ— éœ€ä¸“ç”¨è¿æ¥æ¥é“¾æ¥å®ƒä»¬ã€‚

`æ¶ˆæ¯ä¼ é€’`æŒ‡çš„æ˜¯ç¨‹åºä¹‹é—´é€šè¿‡åœ¨æ¶ˆæ¯ä¸­å‘é€æ•°æ®è¿›è¡Œé€šä¿¡ï¼Œè€Œä¸æ˜¯é€šè¿‡ç›´æ¥è°ƒç”¨å½¼æ­¤æ¥é€šä¿¡ï¼Œç›´æ¥è°ƒç”¨é€šå¸¸æ˜¯ç”¨äºè¯¸å¦‚è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„æŠ€æœ¯ã€‚`æ’é˜Ÿ`æŒ‡çš„æ˜¯åº”ç”¨ç¨‹åºé€šè¿‡`é˜Ÿåˆ—`æ¥é€šä¿¡ã€‚é˜Ÿåˆ—çš„ä½¿ç”¨é™¤å»äº†æ¥æ”¶å’Œå‘é€åº”ç”¨ç¨‹åºåŒæ—¶æ‰§è¡Œçš„è¦æ±‚ã€‚

* * *

2ã€ğŸˆRabbitMQ å®‰è£…
---------------

ä»¥ä¸‹æˆ‘ä»¬ä¸»è¦ä»‹ç» RabbitMQ åœ¨ **Windows** ç¯å¢ƒä¸­çš„å®‰è£…è¿‡ç¨‹ã€‚

### 2.1ã€ğŸ‰ ä¸‹è½½ OTP

ç”±äº RabbitMQ ä½¿ç”¨ Erlang æŠ€æœ¯å¼€å‘ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®‰è£… Erlang è¿è¡Œç¯å¢ƒåï¼Œæ‰èƒ½å®‰è£…æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ã€‚

æˆ‘ä»¬åˆ°[https://www.erlang.org/downloads](https://www.erlang.org/downloads)ä¸‹è½½ç›¸åº”ç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå¦‚è¿™é‡Œæˆ‘ä»¬ä¸‹è½½[https://github.com/erlang/otp/releases/download/OTP-25.0.4/otp\_win64\_25.0.4.exe](https://github.com/erlang/otp/releases/download/OTP-25.0.4/otp_win64_25.0.4.exe)è¿™ä¸ªç‰ˆæœ¬ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![erlang](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145222141-1009998540.png)

### 2.2ã€ğŸŠ ä¸‹è½½ RabbitMQ

æˆ‘ä»¬åˆ°[https://www.rabbitmq.com/download.html](https://www.rabbitmq.com/download.html)ä¸‹è½½ç›¸åº”ç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œå¦‚è¿™é‡Œæˆ‘ä»¬ä¸‹è½½[https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.10.7/rabbitmq-server-3.10.7.exe](https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.10.7/rabbitmq-server-3.10.7.exe)è¿™ä¸ªç‰ˆæœ¬ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![rabbitmq](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145236824-577395738.png)

### 2.3ã€ğŸ‹ å®‰è£… Erlang å’Œ RabbitMQ

æˆ‘ä»¬åœ¨ D ç›˜åˆ†åˆ«åˆ›å»ºç›®å½•**D:\\Net\_Program\\Net\_RabbitMQErlang**å’Œ**D:\\Net\_Program\\Net\_RabbitMQ**ï¼ˆ_å®é™…ç¯å¢ƒä¸­æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ–°å»ºç›®å½•å³å¯_ï¼‰ï¼Œç”¨äºå®‰è£… Erlang å’Œ RabbitMQã€‚

åŒå‡»ä¸‹è½½ä¸‹æ¥çš„ otp\_win64\_25.0.4.exe å’Œ rabbitmq-server-3.10.7.exe è¿›è¡Œå®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹ä¸­å°†å®‰è£…ç›®å½•é€‰æ‹©åˆšæ‰åˆ›å»ºçš„ç›®å½•å³å¯ï¼Œå…¶ä»–æŒ‰ç…§é»˜è®¤è®¾ç½®å³å¯ã€‚

### 2.4ã€ğŸŒ æ¿€æ´» Rabbit MQ's Management Plugin

æ¿€æ´»æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š

*   ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ CMD
    
*   ç„¶ååˆ‡æ¢åˆ° RabbitMQ çš„å®‰è£…ç›®å½• sbin ä¸‹ï¼Œ**D:\\Net\_Program\\Net\_RabbitMQ\\rabbitmq\_server-3.10.7\\sbin**
    
*   ç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤å¹¶æ‰§è¡Œ
    
        rabbitmq-plugins.bat enable rabbitmq_management
        
    
    **å¦‚å‡ºç°å¦‚ä¸‹æ‰€ç¤ºçš„æç¤ºä¿¡æ¯ï¼ŒåŸå› æ˜¯å®‰è£…äº† Erlang æ²¡æœ‰é‡å¯ç”µè„‘å¯¼è‡´çš„ç¯å¢ƒå˜é‡æ²¡æœ‰ç”Ÿæ•ˆï¼Œé‡å¯ç”µè„‘å³å¯ï¼š**
    
    ![erlang](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145251650-136052474.png)
    
*   ç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤é‡å¯ RabbitMQ æœåŠ¡
    
        net stop rabbitmq && net start rabbitmq
        
    
*   æœ€åå³å¯è®¿é—® RabbitMQ çš„ç®¡ç†æ§åˆ¶å°äº†ï¼Œè®¿é—®åœ°å€ï¼ˆé»˜è®¤è´¦æˆ·å’Œå¯†ç ä¸º **guest**ï¼‰ï¼š[http://localhost:15672](http://localhost:15672)
    

**æ¿€æ´»è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š**

![rabbitmq](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145305745-1612163825.png)

![rabbitmq](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145310072-1648106235.png)

![rabbitmq](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145314910-1853934119.png)

### 2.5ã€ğŸ è¿œç¨‹è®¾ç½®

å¦‚æœå¸Œæœ› RabbitMQ å…è®¸è¿œç¨‹è¿æ¥ï¼Œæ¯”å¦‚åœ¨ Windows Service2012 æœåŠ¡å™¨ä¸Šå®‰è£…äº† RabbitMQï¼Œå…¶ä»–å®¢æˆ·ç«¯æƒ³è¿æ¥æ­¤æœåŠ¡å™¨çš„ RabbitMQï¼Œåˆ™éœ€è¦è®¾ç½®é˜²ç«å¢™å¼€æ”¾ç«¯å£ã€‚

å…·ä½“è®¾ç½®æ­¥éª¤ï¼ˆä»¥ Windows Service2012 ä¸ºä¾‹ï¼‰ï¼š

*   æ‰“å¼€é˜²ç«å¢™ â†’ å…¥ç«™è§„åˆ™ â†’ æ–°å»ºè§„åˆ™ â†’ é€‰æ‹©â€œç«¯å£â€ï¼Œä¸‹ä¸€æ­¥ â†’ é€‰æ‹© TCPï¼Œå¹¶åœ¨ç‰¹å®šæœ¬åœ°ç«¯å£ä¸­å¡«å…¥ 15672,5671-5672ï¼Œä¸‹ä¸€æ­¥ â†’ é€‰æ‹©â€œå…è®¸è¿æ¥â€ï¼Œä¸‹ä¸€æ­¥ â†’ ä¸‹ä¸€æ­¥ â†’ è¾“å…¥åç§°æˆ–æè¿° â†’ å®Œæˆã€‚

### 2.6ã€ğŸµ Docker ä¸­å®‰è£… RabbitMQ

å¦‚æœä½ ç”µè„‘ä¸Šæ²¡å®‰è£… Dockerï¼Œè¯·å…ˆå®‰è£… Dockerï¼Œå¯å‚è€ƒï¼š[Docker çš„å®‰è£…](/docs/dev/service/docker#3-docker-å®‰è£…)

RabbitMQ åœ¨ Docker ä¸­çš„é•œåƒåœ°å€ï¼š[https://hub.docker.com/\_/rabbitmq](https://hub.docker.com/_/rabbitmq)

![rabbitmqhub](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145334956-836823329.png)

#### **2.6.1ã€æ‹‰å–é•œåƒå®¹å™¨å¹¶å®‰è£…**

*   **æ‹‰å– RabbitMQ é•œåƒ**
    
    ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ CMDï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ‹‰å– RabbitMQ é•œåƒï¼š
    
        docker pull rabbitmq
        
    
    ![rabbitmqpull](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145353153-584760885.png)
    
    ![rabbitmqpull](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145357942-2135868618.png)
    
    æ‹‰å–å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€ Docker Desktop å®¢æˆ·ç«¯æŸ¥çœ‹å°±å¤šäº†ä¸€ä¸ªåç§°ä¸º rabbitmq çš„é•œåƒäº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
    
    ![rabbitmqpull](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145407146-915260132.png)
    
*   **æ–°å»ºç›®å½•**
    
    åœ¨`D:\Net_Program\Net_Docker\RabbitMQ`ä¸‹åˆ†åˆ«æ–°å»º`Data`å’Œ`Log`æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾ RabbitMQ æ•°æ®å’Œæ—¥å¿—ï¼š
    
    **D:\\Net\_Program\\Net\_Docker\\RabbitMQ\\Data**
    
    **D:\\Net\_Program\\Net\_Docker\\RabbitMQ\\Log**
    
*   **åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨**
    
    ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ CMDï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼š
    
        docker run -d --volume D:/Net_Program/Net_Docker/RabbitMQ/Data:/var/lib/rabbitmq --volume D:/Net_Program/Net_Docker/RabbitMQ/Log:/var/log/rabbitmq --hostname rabbitmq --name rabbitmq -p 15672:15672 -p 5672:5672 rabbitmq
        
    
    ![rabbitmqrun](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145431680-1419194297.png)
    
    :::tip å‚æ•°è¯´æ˜ï¼š
    
    å®Œæ•´æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š
    
        docker run -d --volume D:/Net_Program/Net_Docker/RabbitMQ/Data:/var/lib/rabbitmq --volume D:/Net_Program/Net_Docker/RabbitMQ/Log:/var/log/rabbitmq --hostname rabbitmq --name rabbitmq -p 15672:15672 -p 5672:5672 -e RABBITMQ_DEFAULT_VHOST=/ -e RABBITMQ_DEFAULT_USER=guest -e RABBITMQ_DEFAULT_PASS=guest rabbitmq
        
    
    *   \-dï¼šè¡¨ç¤ºåœ¨åå°è¿è¡Œå®¹å™¨ï¼›
        
    *   \--volume D:/Net\_Program/Net\_Docker/RabbitMQ/Data:/var/lib/rabbitmqï¼šæ˜ å°„ RabbitMQ æ•°æ®å­˜å‚¨ç›®å½•ï¼›
        
    *   \--volume D:/Net\_Program/Net\_Docker/RabbitMQ/Log:/var/log/rabbitmqï¼šæ˜ å°„ RabbitMQ æ—¥å¿—å­˜å‚¨ç›®å½•ï¼›
        
    *   \--name rabbitmqï¼šè®¾ç½®å®¹å™¨åç§°ï¼›
        
    *   \--hostnameï¼šæŒ‡å®šä¸»æœºåï¼ˆRabbitMQ çš„ä¸€ä¸ªé‡è¦æ³¨æ„äº‹é¡¹æ˜¯å®ƒæ ¹æ®æ‰€è°“çš„ èŠ‚ç‚¹åç§° å­˜å‚¨æ•°æ®ï¼Œé»˜è®¤ä¸ºä¸»æœºåï¼‰ï¼›
        
    *   \-pï¼šå°†å®¹å™¨çš„ç«¯å£ 5672ï¼ˆåº”ç”¨è®¿é—®ç«¯å£ï¼‰å’Œ 15672 ï¼ˆæ§åˆ¶å° Web ç«¯å£å·ï¼‰æ˜ å°„åˆ°ä¸»æœºä¸­ï¼›
        
    *   \-eï¼šæŒ‡å®šç¯å¢ƒå˜é‡ï¼š
        
        *   RABBITMQ\_DEFAULT\_VHOSTï¼šé»˜è®¤è™šæ‹Ÿæœºåï¼›
            
        *   RABBITMQ\_DEFAULT\_USERï¼šé»˜è®¤çš„ç”¨æˆ·åï¼›
            
        *   RABBITMQ\_DEFAULT\_PASSï¼šé»˜è®¤çš„ç”¨æˆ·å¯†ç ï¼›
            
    
    :::
    
*   **å¯åŠ¨ Docker çš„æ—¶å€™è‡ªåŠ¨å¯åŠ¨ RabbitMQ**
    
    ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ CMDï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š
    
        docker update rabbitmq --restart=always
        
    
    ![rabbitmqstart](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145457031-1197305701.png)
    

#### **2.6.2ã€å®‰è£… Rabbit MQ's Management Plugin**

*   **æ–¹å¼ 1ï¼š**
    
    ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ CMDï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å…ˆè¿›å…¥ RabbitMQ å®¹å™¨ï¼š
    
        docker exec -it rabbitmq /bin/bash
        
    
    å†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š
    
        rabbitmq-plugins enable rabbitmq_management
        
    
    ![æ’ä»¶](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145510018-1542191994.png)
    
    è¿™æ—¶å€™åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€[http://localhost:15672](http://localhost:15672)å³å¯æŸ¥çœ‹ RabbitMQ çš„ Web ç®¡ç†ç«¯äº†ã€‚
    
    ![æ’ä»¶](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145518634-667817975.png)
    
*   **æ–¹å¼ 2ï¼š**
    
    ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ CMDï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯ï¼š
    
        docker exec -it rabbitmq rabbitmq-plugins enable rabbitmq_management
        
    
*   **æ³¨æ„äº‹é¡¹ï¼š**
    
    å½“æˆ‘ä»¬å®‰è£…å¥½æ’ä»¶åï¼Œæ‰“å¼€[http://localhost:15672](http://localhost:15672)Web ç®¡ç†ç•Œé¢ï¼Œä½¿ç”¨ guest è´¦æˆ·ç™»å½•è¿›å»åï¼Œç‚¹å‡»**Channels**æ ‡ç­¾ï¼Œä¼šå‡ºç°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„è­¦å‘Šæé†’ï¼š
    
    ![æ’ä»¶](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145537078-1539785501.png)
    
    1.  ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ CMDï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å…ˆè¿›å…¥ RabbitMQ å®¹å™¨ï¼š
        
            docker exec -it rabbitmq /bin/bash
            
        
    2.  å†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆ‡æ¢åˆ°ä»¥ä¸‹è·¯å¾„ï¼š
        
            cd /etc/rabbitmq/conf.d/
            
        
    3.  å†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ä¿®æ”¹`management_agent.disable_metrics_collector` = `false`ï¼š
        
            echo management_agent.disable_metrics_collector = false > management_agent.disable_metrics_collector.conf
            
        
    4.  å†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤é€€å‡ºå®¹å™¨ï¼š
        
            exit
            
        
    5.  å†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤é‡å¯å®¹å™¨ï¼š
        
            docker restart rabbitmq
            
        
    
    **æ‰§è¡Œå‘½ä»¤è¿‡ç¨‹ï¼š**
    
    ![channels](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145550568-1962623476.png)
    
    **ç•Œé¢æ•ˆæœï¼š**
    
    ![channels](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145555375-1383660529.png)
    

* * *

3ã€ğŸ¥­RabbitMQ å¸¸ç”¨å‘½ä»¤
-----------------

### 3.1ã€ğŸ ç”¨æˆ·ç®¡ç†

*   å¢åŠ ç”¨æˆ·ï¼š
    
        rabbitmqctl add_user user1 pwd1
        
    
*   åˆ é™¤ç”¨æˆ·ï¼š
    
        rabbitmqctl delete_user user1
        
    
*   ä¿®æ”¹å¯†ç ï¼š
    
        rabbitmqctl change_password user1 123456
        
    
*   æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ï¼š
    
        rabbitmqctl list_users
        
    

### 3.2ã€ğŸ ç”¨æˆ·è§’è‰²

1.  è®¾ç½®ç”¨æˆ·è§’è‰²ï¼š
    
        rabbitmqctl set_user_tags user1 Tag
        
    
    user1 ä¸ºç”¨æˆ·åç§°
    
    Tag ä¸ºè§’è‰²åç§°ï¼Œå¦‚ï¼šadministratorã€monitoringã€policymakerã€managementã€impersonator
    
2.  è®¾ç½®å¤šä¸ªè§’è‰²ï¼š
    
        rabbitmqctl set_user_tags user1 Tag1 Tag2
        
    

**æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š**

!\[ml\]![image](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145615867-1065267138.png)

!\[ml\]![image](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145620296-209021578.png)

!\[ml\]![image](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145625220-1903412480.png)

* * *

4ã€ğŸRabbitMQ æ¶æ„æ¨¡å¼
-----------------

### 4.1ã€ğŸ‘RabbitMQ æ¶æ„æ¨¡å¼

![RabbitMQ](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145822511-1184501362.png)

**æ¶æ„æ¨¡å¼è¯´æ˜ï¼š**

1.  é¦–å…ˆå»ºç«‹ç”Ÿäº§è€…ä¸ MQ ä¹‹é—´çš„è¿æ¥ï¼›
    
2.  ç„¶åç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ° MQ çš„äº¤æ¢æœºä¸­ï¼›
    
3.  äº¤æ¢æœºå°†æ¶ˆæ¯åˆ†åˆ«å­˜å‚¨åˆ°ä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ—ä¸­ï¼›
    
4.  å»ºç«‹æ¶ˆè´¹è€…ä¸ MQ ä¹‹é—´çš„è¿æ¥ï¼›
    
5.  æ¶ˆè´¹è€…æŒ‡å®šæ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼›
    
6.  æœ€åé˜Ÿåˆ—å°†æ¶ˆæ¯æ¨é€ç»™å¯¹åº”çš„æ¶ˆè´¹è€…ã€‚
    

### 4.2ã€ğŸ’RabbitMQ ä¸­å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µ

1.  **Messageï¼ˆæ¶ˆæ¯ï¼‰**ï¼šæ¶ˆæ¯æ˜¯ä¸é€æ˜çš„ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—çš„å¯é€‰å±æ€§ç»„æˆï¼Œå¦‚ï¼šè·¯ç”±é”®ï¼ˆRoutingKeyï¼‰ã€ç›¸å¯¹å…¶ä»–æ¶ˆæ¯çš„ä¼˜å…ˆæƒï¼ˆPriorityï¼‰ã€æŒ‡å‡ºè¯¥æ¶ˆæ¯æ˜¯å¦éœ€è¦æ°¸ä¹…å­˜å‚¨ï¼ˆDeliveryModeï¼‰ç­‰ï¼›
    
2.  **Producerï¼ˆç”Ÿäº§è€…ï¼‰**ï¼šç”Ÿäº§è€…æ˜¯å‘äº¤æ¢æœºå‘å¸ƒæ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼›
    
3.  **Exchangeï¼ˆäº¤æ¢æœºï¼‰**ï¼šç”¨æ¥æ¥å—æ¶ˆæ¯å¹¶å°†æ¶ˆæ¯è·¯ç”±ï¼ˆå­˜å‚¨ï¼‰ç»™æœåŠ¡å™¨ä¸­çš„é˜Ÿåˆ—ã€‚äº¤æ¢æœºæœ‰å››ç§ç±»å‹ï¼Œå³å†³å®šæ¶ˆæ¯å‘å¸ƒåˆ°é‚£ä¸ªé˜Ÿåˆ—ï¼Œå…·ä½“æœ‰ä»¥ä¸‹çš„ç±»å‹ï¼š
    
    *   **Fanoutï¼šå‘å¸ƒè®¢é˜…ï¼ˆå¹¿æ’­æ¨¡å¼ï¼‰ï¼Œæ¯ä¸ªå‘é€åˆ° Fanout ç±»å‹çš„äº¤æ¢å™¨æ¶ˆæ¯ï¼Œäº¤æ¢å™¨ä¼šå°†æ¶ˆæ¯å‘é€åˆ°å®ƒç»‘å®šçš„æ‰€æœ‰é˜Ÿåˆ—ä¸­ï¼Œå®ƒè½¬å‘æ¶ˆæ¯æ˜¯æœ€å¿«çš„ï¼Œä¹Ÿæ˜¯ç›®å‰ä½¿ç”¨æœ€å¤šçš„ç±»å‹ã€‚**
        
    *   **Direct**ï¼šè·¯ç”±æ¨¡å¼ï¼Œè·¯ç”±æ¨¡å¼ä¸‹ï¼Œåœ¨å‘å¸ƒæ¶ˆæ¯æ—¶æŒ‡å®šä¸åŒçš„ RouteKeyï¼Œäº¤æ¢æœºä¼šæ ¹æ®ä¸åŒçš„ RouteKey åˆ†å‘æ¶ˆæ¯åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ï¼Œ**ç®€å•ç‚¹è¯´å…¶å®å°±æ˜¯åœ¨ Fanout åŸºç¡€ä¸Šå¤šå¢åŠ äº†ä¸€ä¸ª RoutingKey æ¡ä»¶**ã€‚
        
    *   **Topic**ï¼šé€šé…ç¬¦æ¨¡å¼ï¼ˆä¸»é¢˜ï¼‰ï¼Œé€šé…ç¬¦æ¨¡å¼å’Œè·¯ç”±æ¨¡å¼å…¶å®å·®ä¸å¤šï¼Œä¸åŒä¹‹å¤„åœ¨äºé€šé…ç¬¦æ¨¡å¼ä¸­çš„è·¯ç”±å¯ä»¥å£°æ˜ä¸ºæ¨¡ç³ŠæŸ¥è¯¢ã€‚ç¬¦å·`#`åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªè¯ï¼Œç¬¦å·`*`åŒ¹é…ä¸€ä¸ªè¯ã€‚RabbitMQ ä¸­é€šé…ç¬¦çš„é€šé…ç¬¦æ˜¯ç”¨`.`æ¥åˆ†å‰²å­—ç¬¦ä¸²çš„ï¼Œæ¯”å¦‚`a.*`åªèƒ½åŒ¹é…åˆ° a.bã€a.cï¼Œè€Œ`a.#`å¯ä»¥åŒ¹é…åˆ° a.a.cã€a.a.bã€‚
        
    *   **Headers**ï¼šæ ¹æ®æ¶ˆæ¯å†…å®¹ä¸­çš„ Headers å±æ€§åŒ¹é…ï¼ˆæ€§èƒ½å·®ï¼Œä¸å®ç”¨ï¼Œä½¿ç”¨å°‘)ï¼Œ**è¯¥æ¨¡å¼åŸºæœ¬ä¸ä½¿ç”¨**ã€‚
        
4.  **Queueï¼ˆé˜Ÿåˆ—ï¼‰**ï¼šæ¶ˆæ¯çš„`å­˜æ”¾å®¹å™¨`ï¼Œä¸€ä¸ªæ¶ˆæ¯å¯ä»¥æ”¾åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªé˜Ÿåˆ—ä¸­ï¼›
    
5.  **Bindingï¼ˆç»‘å®šï¼‰**ï¼šå¦‚æœæƒ³è¦å°†æ¶ˆæ¯å­˜æ”¾åˆ°å…·ä½“çš„é˜Ÿåˆ—ä¸­ï¼Œå°±éœ€è¦å…ˆå°†é˜Ÿåˆ—å’Œäº¤æ¢æœºè¿›è¡Œç»‘å®šï¼Œäº¤æ¢æœºè·Ÿé˜Ÿåˆ—çš„ç»‘å®šå¯ä»¥æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼›
    
6.  **Connectionï¼ˆè¿æ¥ï¼‰**ï¼šå¦‚ä¸€ä¸ª Tcp è¿æ¥ï¼›
    
7.  **Channelï¼ˆé€šé“ï¼‰**ï¼šå¤šè·¯å¤ç”¨è¿æ¥ä¸­çš„ä¸€æ¡ç‹¬ç«‹çš„åŒå‘æ•°æ®æµé€šé“ï¼Œé€šé“æ˜¯å»ºç«‹åœ¨çœŸå®çš„ TCP è¿æ¥å†…çš„è™šæ‹Ÿé€šé“ï¼ŒAMQP å‘½ä»¤éƒ½æ˜¯é€šè¿‡é€šé“å‘å‡ºå»çš„ï¼Œä¸ç®¡æ˜¯å‘å¸ƒæ¶ˆæ¯ã€è®¢é˜…é˜Ÿåˆ—è¿˜æ˜¯æ¥æ”¶æ¶ˆæ¯ï¼Œéƒ½æ˜¯é€šè¿‡é€šé“å®Œæˆçš„ï¼Œå› ä¸ºå¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´åˆ›å»ºå’Œé”€æ¯ä¸€ä¸ª TCP è¿æ¥éƒ½æ˜¯å¾ˆæ˜‚è´µçš„å¼€é”€ï¼Œæ‰€ä»¥ä½¿ç”¨é€šé“ä»¥å®ç°å¤ç”¨ä¸€æ¡ TCP è¿æ¥ï¼›
    
8.  **Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰**ï¼šæ¥æ”¶å’Œæ¶ˆè´¹æ¶ˆæ¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼›
    
9.  **Virtual Hostï¼ˆè™šæ‹Ÿä¸»æœºï¼‰**ï¼šå³å°å‹çš„ RabbitMQ æœåŠ¡å™¨ï¼Œå®ƒè¡¨ç¤ºä¸€æ‰¹äº¤æ¢å™¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å’Œç›¸å…³å¯¹è±¡ï¼Œè¿æ¥æ—¶å¿…é¡»æŒ‡å®šï¼Œé»˜è®¤æ˜¯:/ï¼ˆä»¥è·¯å¾„åŒºåˆ†ï¼‰ï¼›
    
10.  **Broker**ï¼šæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å®ä½“ã€‚
    

### 4.3ã€ğŸ“RabbitMQ å‡ ç§æ¨¡å¼

#### **4.3.1ã€ç®€å•é˜Ÿåˆ—æ¨¡å¼**

åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œä¸ç”¨æ˜¾ç¤ºå£°æ˜`äº¤æ¢æœº`ï¼Œåªéœ€å£°æ˜`ä¸€ä¸ªé˜Ÿåˆ—`å³å¯ã€‚

ç”Ÿäº§è€…æŒ‡å®šé˜Ÿåˆ—åç§°å‘é€æ¶ˆæ¯ç»™ MQï¼Œç„¶åä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„äº¤æ¢æœºå°†æ¶ˆæ¯è½¬å‘ç»™è¿™ä¸ªé˜Ÿåˆ—ã€‚

æ¶ˆè´¹è€…åªéœ€è¦ç›‘å¬è¿™ä¸ªé˜Ÿåˆ—ï¼Œä¸€æœ‰æ¶ˆæ¯å°±ä¼šå¾—åˆ°é€šçŸ¥åšå‡ºå“åº”ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![ç®€å•é˜Ÿåˆ—æ¨¡å¼](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145848270-1289894404.png)

#### **4.3.2ã€å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼ˆWork Queuesï¼‰**

å’Œç®€å•é˜Ÿåˆ—æ¨¡å¼åŸºæœ¬ä¸€æ ·ï¼Œä¸è¿‡æœ‰ä¸€ç‚¹ä¸åŒï¼Œè¯¥æ¨¡å¼æœ‰å¤šä¸ªæ¶ˆè´¹è€…åœ¨ç›‘å¬é˜Ÿåˆ—ã€‚

RabbitMQ ä¼šä»¥**è½®è¯¢**çš„æ–¹å¼å°†æ¶ˆæ¯å‘ç»™å¤šä¸ªæ¶ˆè´¹è€…ç¡®ä¿ä¸€æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œå³ï¼š**_åœ¨è¯¥æ¨¡å¼ä¸‹ä¸€æ¡æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹_**ã€‚

#### **4.3.3ã€Exchange - å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆFanoutï¼‰**

å’Œä¸Šé¢ 2 ç§æ¨¡å¼é»˜è®¤æä¾›äº¤æ¢æœºä¸åŒçš„æ˜¯ï¼Œè¯¥æ¨¡å¼éœ€è¦**æ˜¾ç¤ºå£°æ˜äº¤æ¢æœº**ï¼Œç„¶åå¯ä»¥åˆ›å»ºå¤šä¸ªé˜Ÿåˆ—å’Œè¿™ä¸ªäº¤æ¢æœºè¿›è¡Œç»‘å®šã€‚

ç”Ÿäº§è€…å‘æ¶ˆæ¯ç»™ MQ æ—¶éœ€è¦æŒ‡å®š`äº¤æ¢æœº`ï¼Œç„¶åäº¤æ¢æœºå°†æ¶ˆæ¯è½¬å‘ç»™ä¸è‡ªå·±**ç»‘å®šçš„æ‰€æœ‰é˜Ÿåˆ—**.

æ¶ˆè´¹è€…ç›‘å¬æŒ‡å®šçš„é˜Ÿåˆ—è·å¾—æ¶ˆæ¯ï¼Œæ¯ä¸ªé˜Ÿåˆ—å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…ç›‘å¬ï¼ŒåŒæ ·ä¹Ÿæ˜¯ä»¥è½®è¯¢çš„æœºåˆ¶å‘ç»™æ¶ˆè´¹è€…ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![ç®€å•é˜Ÿåˆ—æ¨¡å¼](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145911250-1565997253.png)

**è¯¥æ¨¡å¼æ˜¯ç›®å‰ä½¿ç”¨æœ€å¤šçš„æ¨¡å¼ã€‚**

#### **4.3.4ã€Exchange - è·¯ç”±æ¨¡å¼ï¼ˆDirectï¼‰**

å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œé˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºæ—¶éœ€è¦æŒ‡å®šä¸€ä¸ª RoutingKeyã€‚

é‚£ä¹ˆç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶ä¸ä»…éœ€è¦æŒ‡å®šäº¤æ¢æœºè¿˜éœ€è¦æŒ‡å®š RoutingKeyã€‚

è¿™æ ·çš„è¯äº¤æ¢æœºå°±ä¼šæŠŠæ¶ˆæ¯è½¬å‘ç»™è·Ÿè‡ªå·±ç»‘å®šå¹¶ä¸” RoutingKey ç›¸åŒ¹é…çš„é˜Ÿåˆ—ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![ç®€å•é˜Ÿåˆ—æ¨¡å¼](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145922138-1617506737.png)

PSï¼šå½“ç”Ÿäº§è€…å‘é€äº†ä¸€ä¸ªæ¶ˆæ¯ä¸”å‘é€çš„ RoutingKey ä¸º success æ—¶ï¼Œäº¤æ¢æœºä¼šæ ¹æ®è¯¥ RoutingKey åŒ¹é…å¹¶è½¬å‘æ¶ˆæ¯åˆ° Queue1 å’Œ Queue2ï¼Œä¸¤ä¸ªé˜Ÿåˆ—éƒ½æ»¡è¶³äº†è·¯ç”±è§„åˆ™ï¼›å½“ RoutingKey ä¸º error æ—¶ï¼Œä»… Queue2 æ»¡è¶³ï¼Œåˆ™å°†æ¶ˆæ¯è½¬å‘ç»™ Queue2ã€‚

#### **4.3.5ã€Exchange - é€šé…ç¬¦æ¨¡å¼ï¼ˆTopicï¼‰**

å’Œè·¯ç”±æ¨¡å¼å”¯ä¸€çš„ä¸åŒå°±æ˜¯å¯ä»¥è®¾ç½®å¸¦æœ‰é€šé…ç¬¦è¿›è¡Œæ¨¡ç³ŠåŒ¹é…çš„ RoutingKeyã€‚

è®¾å®šçš„ RoutingKeyï¼ˆä¸è®ºæ˜¯ BindingKey è¿˜æ˜¯ RoutingKeyï¼‰éƒ½éœ€è¦ä¸ºå¸¦`.`çš„å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ a.bã€c.d.eã€fff.gggg.hhhh ç­‰ï¼Œæœ€å¤šä¸º 255 ä¸ªå­—èŠ‚.

åœ¨äº¤æ¢æœºå’Œé˜Ÿåˆ—ç»‘å®šæ—¶ï¼Œç»™å®šçš„ RoutingKey å¯ä»¥ä¾ç…§å¦‚ä¸‹æ¥è®¾ç½®ï¼š

*   ï¼šåŒ¹é… 0~N ä¸ªå•è¯ï¼›
    ============
    
*   \*ï¼šåŒ¹é… 1 ä¸ªå•è¯ã€‚
    

æ¯”å¦‚ä¸¤ä¸ª RoutingKey åˆ†åˆ«ä¸º index.å’Œ#.crtï¼Œå½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶ç»™å®šçš„ RoutingKey ä¸º index.aã€index.b æˆ– index.c ç­‰éƒ½æ»¡è¶³ index.çš„è§„åˆ™ï¼Œa.crtã€aa.crt æˆ–æ˜¯ b.crt ç­‰éƒ½æ»¡è¶³#.crt çš„è§„åˆ™ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![ç®€å•é˜Ÿåˆ—æ¨¡å¼](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025145934919-1506282069.png)

* * *

5ã€ğŸ¥RabbitMQ ä½¿ç”¨
---------------

é’ˆå¯¹ RabbitMQ çš„ä½¿ç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦ä»‹ç»åœ¨.Net Coreï¼ˆ.Net6ï¼‰ä¸­çš„ç®€å•ä½¿ç”¨ï¼Œå…¶ä»–å¹³å°æˆ–è¯­è¨€ç±»ä¼¼ï¼Œä»…ä½œå‚è€ƒã€‚

### 5.1ã€ğŸ… å®‰è£… RabbitMQ.Client åŒ…

æˆ‘ä»¬å°†ä½¿ç”¨**[RabbitMQ.Client](https://www.nuget.org/packages/RabbitMQ.Client)**è¿™ä¸ªåŒ…æ¥å®ç°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–åŒ…ï¼Œå¦‚ï¼š**EasyNetQ**ã€‚

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£… RabbitMQ.Client åŒ…å³å¯ï¼š

    Install-Package RabbitMQ.Client -Version 6.4.0
    

### 5.2ã€ğŸ¥‘ ç”Ÿäº§è€…å®ç°

é¦–å…ˆæˆ‘ä»¬å®šä¹‰ RabbitMQHelper.cs å¸®åŠ©ç±»ï¼Œè¯¥ç±»éœ€è¦å®ç°æ³›å‹ T çš„å®šä¹‰ï¼ˆ**T ä¸ºå‘é€å’Œæ¥æ”¶çš„æ¶ˆæ¯å®ä½“**ï¼‰ã€‚

ç„¶ååœ¨è¯¥ç±»ä¸­å®šä¹‰`æ¶ˆæ¯é€šé“`ã€`æ¶ˆæ¯è¿æ¥`ã€`äº¤æ¢æœºåç§°`ã€`é˜Ÿåˆ—åç§°é›†åˆ`å’Œ`è·¯ç”±è§„åˆ™`å˜é‡ã€‚

å®šä¹‰æ„é€ å‡½æ•° RabbitMQHelperï¼Œå¹¶å®ç°è¿æ¥å·¥å‚çš„å®šä¹‰ã€æ¶ˆæ¯è¿æ¥çš„åˆå§‹åŒ–ã€æ¶ˆæ¯é€šé“çš„åˆå§‹åŒ–ä»¥åŠäº¤æ¢æœºç±»å‹ï¼ˆæ­¤å¤„æˆ‘ä»¬ä»¥**å‘å¸ƒè®¢é˜…æ¨¡å¼ Fanout çš„å®ç°ä¸ºä¾‹**ï¼‰çš„å®šä¹‰ã€‚

**æ³¨æ„ï¼šä»¥ä¸‹å®ç°ä»£ç ä»…ä»…ä¸ºäº†å±•ç¤ºä½¿ç”¨è¯´æ˜ï¼Œæ²¡æœ‰è¿›ä¸€æ­¥è¿›è¡Œå°è£…ã€‚**

å…·ä½“å¸®åŠ©ç±»å’Œè°ƒç”¨ç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

using RabbitMQ.Client.Events;
    using RabbitMQ.Client;
    using System.Text;
    
    namespace Quick.RabbitMQPlus
    {
        public class RabbitMQHelper<T> where T : class
        {
            /// <summary>
            /// æ¶ˆæ¯é€šé“
            /// </summary>
            readonly IModel _channel;
    
            /// <summary>
            /// æ¶ˆæ¯è¿æ¥
            /// </summary>
            readonly IConnection _connection;
    
            /// <summary>
            /// äº¤æ¢æœºåç§°
            /// </summary>
            readonly string _exchangeName = "TestExchangeName";
    
            /// <summary>
            /// é˜Ÿåˆ—åç§°é›†åˆ
            /// </summary>
            readonly List<string> _queueNames = new() { "Queue1", "Queue2" };
    
            /// <summary>
            /// è·¯ç”±è§„åˆ™
            /// </summary>
            string _routeKey = "TestRouteName";
    
            /// <summary>
            /// æ„é€ å‡½æ•°
            /// </summary>
            public RabbitMQHelper()
            {
                //åˆ›å»ºè¿æ¥å·¥å‚
                var connectionFactory = new ConnectionFactory
                {
                    HostName = "192.168.1.1",
                    UserName = "admin",
                    Password = "123456",
                    Port = 5672
                };
    
                //åˆ›å»ºè¿æ¥
                _connection = connectionFactory.CreateConnection();
    
                //åˆ›å»ºé€šé“
                _channel = _connection.CreateModel();
    
                /*
                 * å®šä¹‰ä¸€ä¸ªFanoutç±»å‹äº¤æ¢æœºï¼š
                 * å‚æ•°1ï¼šäº¤æ¢æœºåç§°
                 * å‚æ•°2ï¼šäº¤æ¢æœºç±»å‹
                 * å‚æ•°3ï¼šæ˜¯å¦å¼€å¯æ¶ˆæ¯æŒä¹…åŒ–
                 * å‚æ•°4ï¼šæ˜¯å¦è®¾ç½®å¦‚æœè¿™ä¸ªé˜Ÿåˆ—æ²¡æœ‰å…¶ä»–æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œé˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤
                 * å‚æ•°5ï¼šæŒ‡å®šé˜Ÿåˆ—æºå¸¦çš„ä¿¡æ¯
                 */
                _channel.ExchangeDeclare(_exchangeName, ExchangeType.Fanout, false, false, null);
            }
    
            /// <summary>
            /// å‘é€æ¶ˆæ¯
            /// </summary>
            /// <param name="data"></param>
            /// <returns></returns>
            public async Task<(bool, string)> Send(T data)
            {
                return await Task.Run(() =>
                {
    
                    if (_channel == null)
                    {
                        return (false, "RabbitMQåˆå§‹åŒ–é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥é…ç½®ï¼");
                    }
    
                    var ret = true;
                    var errMsg = string.Empty;
    
                    try
                    {
                        if (string.IsNullOrWhiteSpace(_routeKey))
                        {
                            _routeKey = _exchangeName;
                        }
    
                        //å°†å¤šä¸ªé˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœºä¸Š
                        foreach (var item in _queueNames)
                        {
                            /*
                             * å®šä¹‰é˜Ÿåˆ—ï¼š
                             * å‚æ•°1ï¼šé˜Ÿåˆ—åç§°
                             * å‚æ•°2ï¼šæ˜¯å¦æŒä¹…åŒ–ï¼Œtrueä¸ºæŒä¹…åŒ–ã€‚é˜Ÿåˆ—ä¼šå­˜å‚¨åˆ°ç£ç›˜ï¼ŒæœåŠ¡å™¨é‡å¯æ—¶å¯ä»¥ä¿è¯ä¸ä¸¢å¤±ä¿¡æ¯
                             * å‚æ•°3ï¼šæ˜¯å¦æ’ä»–ï¼Œtrueä¸ºæ’ä»–ã€‚å¦‚æœä¸€ä¸ªé˜Ÿåˆ—å£°æ˜ä¸ºæ’ä»–é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä»…å¯¹é¦–æ¬¡å£°æ˜å®ƒçš„è¿æ¥å¯è§ï¼Œå¹¶åœ¨è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤
                             * å‚æ•°4ï¼šæ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueä¸ºè‡ªåŠ¨åˆ é™¤ã€‚è‡ªåŠ¨åˆ é™¤çš„å‰ææ˜¯ï¼šè‡´å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è¿æ¥åˆ°è¿™ä¸ªé˜Ÿåˆ—ï¼Œä¹‹åæ‰€æœ‰ä¸è¿™ä¸ªé˜Ÿåˆ—è¿æ¥çš„æ¶ˆè´¹è€…éƒ½æ–­å¼€æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨åˆ é™¤
                             * å‚æ•°5ï¼šæŒ‡å®šé˜Ÿåˆ—æºå¸¦çš„ä¿¡æ¯
                             */
                            _channel.QueueDeclare(item, true, false, false, null);
    
                            //å°†é˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœº
                            _channel.QueueBind(item, _exchangeName, _routeKey, null);
                        }
    
                        //å°†å®ä½“åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œè¯¥æ–¹æ³•ï¼ˆObjectToJsonï¼‰éœ€è‡ªå·±å®ç°
                        var msg = ObjectToJson(data);
    
                        //å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºbyte[]
                        var msgBody = Encoding.UTF8.GetBytes(msg);
    
                        /*
                         * å‘å¸ƒæ¶ˆæ¯ï¼š
                         * å‚æ•°1ï¼šäº¤æ¢æœºåç§°ï¼Œå¦‚æœä¼ ""ï¼Œå°†ä½¿ç”¨RabbitMQé»˜è®¤çš„äº¤æ¢æœºåç§°
                         * å‚æ•°2ï¼šæŒ‡å®šè·¯ç”±çš„è§„åˆ™ï¼Œä½¿ç”¨å…·ä½“çš„é˜Ÿåˆ—åç§°ï¼Œäº¤æ¢æœºä¸º""æ—¶ï¼Œæ¶ˆæ¯ç›´æ¥å‘é€åˆ°é˜Ÿåˆ—ä¸­
                         * å‚æ•°3ï¼šæŒ‡å®šä¼ é€’çš„æ¶ˆæ¯æºå¸¦çš„properties
                         * å‚æ•°4ï¼šæŒ‡å®šä¼ é€’çš„æ¶ˆæ¯ï¼Œbyte[]ç±»å‹
                         */
                        _channel.BasicPublish(_exchangeName, _routeKey, null, msgBody);
                    }
                    catch (Exception e)
                    {
                        ret = false;
                        errMsg = e.Message;
                    }
    
                    return (ret, errMsg);
                });
            }
    
            /// <summary>
            /// å…³é—­é€šé“å’Œè¿æ¥
            /// </summary>
            public void Close()
            {
                _channel.Close();
                _connection.Close();
            }
        }
    }

    //æ¶ˆæ¯å®ä½“
    var msgModel = new TestRabbitMQModel
    {
        UserId = rand.Next(1, 9999),
        UserName = "Quber",
        UserAge = rand.Next(20, 80),
        CreateTime = DateTime.Now
    };
    
    //å®šä¹‰å‘é€å¯¹è±¡
    var sendInstance = new RabbitMQHelper<TestRabbitMQModel>();
    
    //å‘é€æ¶ˆæ¯
    var sendRet = await sendInstance.Send(msgModel);
    
    if (sendRet.Item1)
    {
        //å‘é€æˆåŠŸ
        //â€¦â€¦
    
        //æ¶ˆæ¯å‘é€å®Œæˆåï¼Œå…³é—­é€šé“ï¼ˆæ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œå†³å®šè¦ä¸è¦è°ƒç”¨å…³é—­æ–¹æ³•ï¼‰
        sendInstance.Close();
    }
    else
    {
        //å‘é€å¤±è´¥
        var errMsg = $"å¤±è´¥åŸå› ï¼š{sendRet.Item2}";
    }

### 5.3ã€ğŸ† æ¶ˆè´¹è€…å®ç°

æ¶ˆè´¹è€…çš„å®ç°å’Œç”Ÿäº§è€…çš„å®ç°åŸºæœ¬ä¸€æ ·ï¼Œç›´æ¥ä¸Šä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

using RabbitMQ.Client.Events;
    using RabbitMQ.Client;
    using System.Text;
    
    namespace Quick.RabbitMQPlus
    {
        public class RabbitMQHelper<T> where T : class
        {
            /// <summary>
            /// æ¶ˆæ¯é€šé“
            /// </summary>
            readonly IModel _channel;
    
            /// <summary>
            /// æ¶ˆæ¯è¿æ¥
            /// </summary>
            readonly IConnection _connection;
    
            /// <summary>
            /// äº¤æ¢æœºåç§°
            /// </summary>
            readonly string _exchangeName = "TestExchangeName";
    
            /// <summary>
            /// é˜Ÿåˆ—åç§°é›†åˆ
            /// </summary>
            readonly List<string> _queueNames = new() { "Queue1", "Queue2" };
    
            /// <summary>
            /// è·¯ç”±è§„åˆ™
            /// </summary>
            string _routeKey = "TestRouteName";
    
            /// <summary>
            /// æ„é€ å‡½æ•°
            /// </summary>
            public RabbitMQHelper()
            {
                //åˆ›å»ºè¿æ¥å·¥å‚
                var connectionFactory = new ConnectionFactory
                {
                    HostName = "192.168.1.1",
                    UserName = "admin",
                    Password = "123456",
                    Port = 5672
                };
    
                //åˆ›å»ºè¿æ¥
                _connection = connectionFactory.CreateConnection();
    
                //åˆ›å»ºé€šé“
                _channel = _connection.CreateModel();
    
                /*
                 * å®šä¹‰ä¸€ä¸ªFanoutç±»å‹äº¤æ¢æœºï¼š
                 * å‚æ•°1ï¼šäº¤æ¢æœºåç§°
                 * å‚æ•°2ï¼šäº¤æ¢æœºç±»å‹
                 * å‚æ•°3ï¼šæ˜¯å¦å¼€å¯æ¶ˆæ¯æŒä¹…åŒ–
                 * å‚æ•°4ï¼šæ˜¯å¦è®¾ç½®å¦‚æœè¿™ä¸ªé˜Ÿåˆ—æ²¡æœ‰å…¶ä»–æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œé˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤
                 * å‚æ•°5ï¼šæŒ‡å®šé˜Ÿåˆ—æºå¸¦çš„ä¿¡æ¯
                 */
                _channel.ExchangeDeclare(_exchangeName, ExchangeType.Fanout, false, false, null);
            }
    
            /// <summary>
            /// æ¥æ”¶æ¶ˆæ¯
            /// </summary>
            /// <param name="queueName">é˜Ÿåˆ—åç§°</param>
            /// <param name="received">å›è°ƒæ–¹æ³•</param>
            /// <param name="prefetchCount">è®¾ç½®RabbitMQä¸€æ¬¡æœ€å¤šæ¨é€å¤šå°‘æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼Œé»˜è®¤ä¸º10</param>
            public async Task<(bool, string)> Receive(string queueName, Func<T?, string, Task<bool>> received, ushort prefetchCount = 10)
            {
                return await Task.Run(() =>
                {
                    if (_channel == null)
                    {
                        return (false, "RabbitMQåˆå§‹åŒ–é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥é…ç½®ï¼");
                    }
    
                    var ret = true;
                    var errMsg = string.Empty;
    
                    try
                    {
                        /*
                         * è®¾ç½®é™æµæœºåˆ¶
                         * å‚æ•°1ï¼šæ¶ˆæ¯æœ¬èº«çš„å¤§å°ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆè¡¨ç¤ºå¯¹æ¶ˆæ¯æœ¬èº«çš„å¤§å°ä¸é™åˆ¶
                         * å‚æ•°2ï¼šè®¾ç½®RabbitMQä¸€æ¬¡æœ€å¤šæ¨é€å¤šå°‘æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…
                         * å‚æ•°3ï¼šæ˜¯å¦å°†ä¸Šé¢çš„è®¾ç½®åº”ç”¨äºæ•´ä¸ªé€šé“ï¼Œfalseè¡¨ç¤ºåªåº”ç”¨äºå½“å‰æ¶ˆè´¹è€…
                         */
                        _channel.BasicQos(0, prefetchCount, false);
    
                        //åˆ›å»ºæ¶ˆè´¹è€…å¯¹è±¡
                        var consumer = new EventingBasicConsumer(_channel);
    
                        //æ¥æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶
                        consumer.Received += async (_, ea) =>
                        {
                            //è·å–æ¶ˆæ¯ä»¥åŠååºåˆ—åŒ–ä¸ºå®ä½“ï¼ˆJsonToObjectæ–¹æ³•éœ€è‡ªå·±å®ç°ï¼‰
                            var msg = Encoding.UTF8.GetString(ea.Body.ToArray());
                            var data = JsonToObject<T>(msg);
    
                            var retRec = true;
    
                            try
                            {
                                //æ¥æ”¶æ¶ˆè´¹äº‹ä»¶ï¼Œå¦‚æœè¿”å›trueåˆ™ä»£è¡¨å¤„ç†æˆåŠŸï¼Œä»¥ä¾¿å‘ŠçŸ¥RabbitMQè¯¥æ¶ˆæ¯å·²æ¶ˆè´¹å¹¶å¤„ç†æˆåŠŸ
                                retRec = await received(data, msg);
                            }
                            catch (Exception e)
                            {
                                retRec = false;
                            }
    
                            //ä¸šåŠ¡å¤„ç†æˆåŠŸçš„æ—¶å€™
                            if (retRec)
                            {
                                //å‘ŠçŸ¥RabbitMQè¯¥æ¶ˆæ¯æˆåŠŸå¤„ç†ï¼Œå¯ä»¥ä»é˜Ÿåˆ—ä¸­åˆ é™¤è¯¥æ¶ˆæ¯äº†
                                _channel.BasicAck(ea.DeliveryTag, false);
                            }
                            else
                            {
                                /*
                                 * å‘ŠçŸ¥RabbitMQè¯¥æ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œé‡æ–°åŠ å…¥é˜Ÿåˆ—ï¼Œä»¥ä¾¿åç»­å¯å†æ¬¡æ¶ˆè´¹è¯¥æ¶ˆæ¯
                                 * å‚æ•°1ï¼š
                                 * å‚æ•°2ï¼šæ˜¯å¦å°†è¯¥æ¶ˆæ¯é‡æ–°åŠ å…¥é˜Ÿåˆ—ï¼Œtrueä¸ºé‡æ–°åŠ å…¥é˜Ÿåˆ—
                                 *
                                 * éœ€è¦æ³¨æ„çš„æ˜¯ï¼š
                                 *     å‡è®¾await received(data, msg);ä¸€ç›´å¯¹æŸäº›æ¶ˆæ¯éƒ½å¤„ç†å¤±è´¥ï¼ˆå³retRec=falseï¼‰ï¼Œ
                                 *     é‚£ä¹ˆè¿™äº›æ•°æ®ï¼ˆè¿™ä¸€æ‰¹æ¬¡çš„æ‰€æœ‰æ•°æ®ï¼‰ä¼šé‡æ–°è¿›å…¥é˜Ÿåˆ—ï¼Œå¹¶åœ¨ä¸‹æ¬¡é‡æ–°æ¶ˆè´¹ï¼Œ
                                 *     å¦‚æœä¸šåŠ¡æ–¹æ³•receivedä¸åšå¤„ç†çš„è¯ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆä¸€ç›´å¾ªç¯æ¶ˆè´¹è¯¥æ‰¹æ¬¡çš„æ¶ˆæ¯
                                 */
                                _channel.BasicReject(ea.DeliveryTag, true);
                            }
                        };
    
                        //å¯åŠ¨æ¶ˆè´¹è€…ï¼Œè®¾ç½®ä¸ºæ‰‹åŠ¨åº”ç­”æ¶ˆæ¯
                        /*
                         * å¯åŠ¨æ¶ˆè´¹è€…ï¼š
                         * å‚æ•°1ï¼šæŒ‡å®šè¦æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—çš„åç§°
                         * å‚æ•°2ï¼šæŒ‡å®šæ˜¯å¦è‡ªåŠ¨å‘Šè¯‰RabbitMQè¯¥æ¶ˆæ¯å·²æ”¶åˆ°
                         * å‚æ•°3ï¼šæŒ‡å®šæ¶ˆæ¯çš„å›è°ƒ
                         */
                        _channel.BasicConsume(queueName, false, consumer);
                    }
                    catch (Exception e)
                    {
                        ret = false;
                        errMsg = e.Message;
                    }
    
                    return (ret, errMsg);
                });
            }
    
            /// <summary>
            /// å…³é—­é€šé“å’Œè¿æ¥
            /// </summary>
            public void Close()
            {
                _channel.Close();
                _connection.Close();
            }
        }
    }

    //å®šä¹‰æ¥æ”¶å¯¹è±¡
    var recInstance = new RabbitMQHelper<TestRabbitMQModel1>();
    
    //æ¥æ”¶é˜Ÿåˆ—Queue1çš„æ¶ˆæ¯
    var retRec = await recInstance.Receive("Queue1", async (data, msg) =>
    {
        await Task.Delay(5000);
    
        Console.ForegroundColor = ConsoleColor.Green;
        Console.WriteLine($"\r\né˜Ÿåˆ—1æ¶ˆæ¯ï¼š{msg}");
    
        //è¿”å›trueä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†æˆåŠŸï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯å·²ç»æ¥æ”¶æˆåŠŸï¼Œä¼šä»MQé˜Ÿåˆ—ä¸­åˆ é™¤
        //è¿”å›falseä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†å¤±è´¥ï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯æ²¡æœ‰å¤„ç†æˆåŠŸï¼Œåˆ™MQä¼šç»§ç»­æ¨é€è¿™æ¡æ¶ˆæ¯
        return true;
    }, 1);
    
    //æ¥æ”¶æ¶ˆæ¯å¤±è´¥
    if (!retRec.Item1)
    {
        Console.ForegroundColor = ConsoleColor.Red;
        Console.WriteLine($"\r\né˜Ÿåˆ—1æ¥æ”¶å¤±è´¥ï¼š{retRec1.Item2}");
    }
    
    //å…³é—­é€šé“ï¼ˆæ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œå†³å®šè¦ä¸è¦è°ƒç”¨å…³é—­æ–¹æ³•ï¼‰
    recInstance.Close();

* * *

6ã€ğŸ¥”Quick.RabbitMQPlus.Furion çš„ä½¿ç”¨
---------------------------------

ä¸ºäº†æ›´å¥½æ›´ç®€å•çš„åœ¨.Net Core ä¸­ä½¿ç”¨ RabbitMQï¼Œç‰¹æ­¤åŸºäº**RabbitMQ.Client**å°è£…äº†**Quick.RabbitMQPlus.Furion**å’Œ**Quick.RabbitMQPlus**ç»„ä»¶ã€‚

*   **Quick.RabbitMQPlus.Furion**ï¼šä¾èµ–äº.Net6+ã€Furion
    
*   **Quick.RabbitMQPlus**ï¼šä¾èµ–äº.Net6+
    

Quick.RabbitMQPlus.Furion åŒ…åœ°å€ä¸ºï¼š[https://www.nuget.org/packages/Quick.RabbitMQPlus.Furion](https://www.nuget.org/packages/Quick.RabbitMQPlus.Furion)

å…³äº Quick.RabbitMQPlus.Furion çš„è¯¦ç»†ä½¿ç”¨è¯´æ˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

### 6.1ã€ğŸ¹ æ›´æ–°æ—¥å¿—

*   1.0.9
    
    *   åœ¨è·¯ç”±æ¨¡å¼æ¶ˆè´¹çš„æ—¶å€™ï¼Œå»æ‰äº†è°ƒç”¨å®ä¾‹åŒ–æ–¹æ³•**Instance()**å¿…é¡»ä¼ å…¥å‚æ•°`true`çš„å‚æ•°ï¼›
        
    *   æä¾›äº†ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œç¬¬ä¸€ç§å°±æ˜¯**v1.0.8**ä¹‹å‰çš„é€šè¿‡å®ä¾‹åŒ–çš„æ–¹å¼è¿›è¡Œåˆå§‹åŒ–ä½¿ç”¨ï¼Œç¬¬äºŒç§å°±æ˜¯**v1.0.9**ä¹‹åå¢åŠ äº†å¯ä»¥é€šè¿‡**ä¾èµ–æ³¨å…¥**çš„æ–¹å¼è¿›è¡Œåˆå§‹åŒ–ä½¿ç”¨**_ï¼ˆæ¨èä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼‰_**;
        
    *   æ–°å¢åŠ äº†`AddRabbitMQPlus`å’Œ`GetInstance`æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«æœ‰ 2 ä¸ªé‡è½½ï¼Œå…·ä½“è¯´æ˜å‚è§`Quick.RabbitMQPlusæ–¹æ³•`ï¼›
        
    *   å¢åŠ äº† IQuickRabbitMQPlus æ¥å£ï¼Œå¦‚æœä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼Œå°±å¯ä»¥å®ç°è¯¥æ¥å£å¹¶ä½¿ç”¨å…¶ä¸­çš„å„ä¸ªæ–¹æ³•ã€‚
        
*   1.0.8
    
    *   å»æ‰äº†é€šè¿‡å®ä½“ç‰¹æ€§å»é…ç½®å„ä¸ªå±æ€§ï¼Œç›®çš„åœ¨äºç®€åŒ–å„ä¸ªé…ç½®ï¼Œéƒ½é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œè®¾ç½®ï¼›
        
    *   åœ¨æ¥æ”¶æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å®ä½“ç‰¹æ€§**QuickRabbitMQPlusReceive**å»è®¾ç½®æ¥æ”¶çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚**\[QuickRabbitMQPlusReceive("TestRabbitMQName1")\]**ï¼‰ï¼Œå¦‚æœä¸è¦å®ä½“ç‰¹æ€§ï¼Œé‚£ä¹ˆå°±ä¼šé€šè¿‡é…ç½®ä¸­çš„**QueueNames**å±æ€§å»æ§åˆ¶ï¼›
        
    *   å¯¹æ¥æ”¶æ•°æ®çš„æ–¹æ³•è¿›è¡Œäº†é‡è½½ï¼›
        
    *   é…ç½®ä¸­å¢åŠ äº†**Default**å±æ€§ï¼Œç”¨äºè®¾ç½®é»˜è®¤è¿æ¥é…ç½®ï¼ˆå¦‚æœé…ç½®ä¸­æœ‰å¤šä¸ªè¿æ¥é…ç½®ï¼Œå¹¶ä¸”æ²¡æœ‰ä¸€ä¸ªé…ç½®ä¸­è®¾ç½® Default ä¸º trueï¼Œé‚£ä¹ˆé»˜è®¤ä¼šä½¿ç”¨ç¬¬ä¸€ä¸ªé…ç½®ï¼‰ï¼›
        
    *   é…ç½®ä¸­å¢åŠ äº†**PrefetchCount**å±æ€§ï¼Œç”¨äºå…¨å±€è®¾ç½® RabbitMQ ä¸€æ¬¡æœ€å¤šæ¨é€å¤šå°‘æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼Œé»˜è®¤ä¸º 10ï¼›
        
    *   é…ç½®ä¸­å»æ‰äº†**RouteKey**é…ç½®ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯è·¯ç”±æ¨¡å¼ï¼Œè¯·ä½¿ç”¨**RouteKeys**å±æ€§è¿›è¡Œé…ç½®ï¼Œå‰ææ˜¯**RouteKeys**å’Œ**QueueNames**é›†åˆçš„æ•°é‡éœ€è¦ä¿æŒä¸€è‡´ï¼›
        
    *   å®ä¾‹åŒ–ç»„ä»¶å¯¹è±¡çš„æ—¶å€™ï¼Œå»æ‰äº†æ³›å‹çš„å®šä¹‰ï¼Œå¦‚`var sendInstance = QuickRabbitMQPlusInstance.Instance();`ï¼›
        
    *   å‘é€å’Œæ¥æ”¶çš„æ–¹æ³•ï¼Œå¢åŠ äº†æ³›å‹çš„å®šä¹‰ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸å—é™äºåœ¨ç»„ä»¶å®ä¾‹åŒ–çš„æ—¶å€™æŒ‡å®šåªèƒ½æ˜¯æŸä¸ªæ³›å‹ï¼Œå°†æ³›å‹çš„å®šä¹‰è®¾ç½®åˆ°æ–¹æ³•ä¸Šæ›´çµæ´»ï¼Œå¦‚åŒä¸€ä¸ªç»„ä»¶å®ä¾‹åŒ–å¯¹è±¡å¯å‘é€ä¸åŒçš„æ³›å‹å®ä½“æ•°æ®ã€‚
        
*   1.0.7
    
    *   å»æ‰äº†å¿…é¡»è¦è®¾ç½®å®ä½“ç‰¹æ€§çš„æ§åˆ¶ï¼ˆå¦‚æœæ²¡æœ‰å®ä½“ç‰¹æ€§ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å°†ç›¸å…³å±æ€§é…ç½®é½å…¨ï¼‰ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯é…ç½®ä¸­çš„ç¬¬ä¸€ä¸ªé…ç½®ï¼›
        
    *   åœ¨è·¯ç”±æ¨¡å¼ä¸‹ï¼Œå¯æŒ‡å®šå°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ï¼Œéœ€è¦é…ç½®`QueueNames`å’Œ`RouteKeys`çš„é›†åˆæ•°é‡ä¿æŒä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼›
        
    *   Send æ–¹æ³•å¢åŠ äº†ç¬¬äºŒä¸ªå‚æ•°ï¼Œè·¯ç”± Key åç§°ï¼›
        
    *   å®ä¾‹åŒ–å¯¹è±¡çš„æ–¹æ³• Instance å¢åŠ äº†å‚æ•°`Instance(bool isReceive = false)`ï¼Œå½“å‰å®ä¾‹åŒ–å¯¹è±¡æ˜¯å¦ä¸ºæ¥æ”¶æ¶ˆæ¯ã€‚
        
*   1.0.6
    
    *   æ–°å¢åŠ äº†å¯åŠ¨æ€åˆ‡æ¢è¿æ¥çš„æ–¹æ³•`ChangeConn`ï¼›
        
    *   å»æ‰äº†`Furion`çš„ä¾èµ–ï¼›
        
    *   å»æ‰äº†`Newtonsoft.Json`çš„ä¾èµ–ï¼›
        
    *   åŒæ—¶å°†åŸæ¥çš„`Quick.RabbitMQPlus`åˆ†ä¸ºäº†`Quick.RabbitMQPlus`å’Œ`Quick.RabbitMQPlus.Furion`è¿™ä¸¤ä¸ªç‰ˆæœ¬ã€‚
        

### 6.2ã€ğŸ¥• Quick.RabbitMQPlus.Furion ä½¿ç”¨è¯´æ˜

è¯¥ç»„ä»¶æ˜¯åŸºäº`RabbitMQ.Client`å’Œ`Furion`ç»„ä»¶è¿›è¡Œå°è£…ä½¿ç”¨çš„ï¼Œç›®çš„åœ¨äºç»“åˆ.Net Core æ›´å¿«ã€æ›´ç®€å•å’Œæ›´çµæ´»çš„ä½¿ç”¨ RabbitMQï¼ï¼ï¼

**åŠŸèƒ½è¯´æ˜ï¼š**

*   æ”¯æŒ`å‘å¸ƒè®¢é˜…æ¨¡å¼`ã€`è·¯ç”±æ¨¡å¼`,`é€šé…ç¬¦æ¨¡å¼`å’Œ`Headerså±æ€§æ¨¡å¼`ï¼›
    
*   å¯æ ¹æ®é…ç½®æ–‡ä»¶è¯»å– RabbitMQ è¿æ¥çš„å„ä¸ªé…ç½®ï¼ˆå¦‚ï¼šRabbitMQ æœåŠ¡åœ°å€ã€è´¦å·ã€å¯†ç å’Œäº¤æ¢æœºåç§°ç­‰ï¼‰ï¼›
    
*   æ”¯æŒé…ç½®å¤šä¸ª RabbitMQ çš„è¿æ¥é…ç½®ï¼›
    
*   æ”¯æŒåŠ¨æ€åˆ‡æ¢ RabbitMQ çš„è¿æ¥é…ç½®ï¼›
    
*   **å¯æ ¹æ®å®ä½“å®šä¹‰çš„ç‰¹æ€§å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ï¼ˆå·²åºŸå¼ƒï¼‰**ï¼Œç›®å‰åªé’ˆå¯¹æ¥æ”¶æ¶ˆæ¯å®šä¹‰äº†å®ä½“ç‰¹æ€§ï¼Œå¹¶ä¸”åªèƒ½æŒ‡å®šæ¥æ”¶æ¶ˆæ¯çš„é˜Ÿåˆ—**_ï¼ˆv1.0.8 è°ƒæ•´ï¼‰_**ï¼›
    
*   æ”¯æŒé…ç½®å°†å¤šä¸ªé˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœºï¼›
    
*   ä¸€ä¸ªæ¶ˆè´¹ç«¯æ”¯æŒå¯ä»¥åŒæ—¶æ¶ˆè´¹å¤šä¸ªå¤šåˆ—çš„æ¶ˆæ¯ç­‰ï¼›
    
*   æ”¯æŒä½¿ç”¨åŒä¸€ä¸ªå®ä½“ï¼Œå°†ä¸åŒçš„æ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ï¼ˆä½¿ç”¨è·¯ç”±æ¨¡å¼ï¼ŒåŒæ—¶åœ¨å‘é€çš„æ—¶å€™å°†è·¯ç”± Key ä¼ å…¥ï¼‰ï¼›
    
*   æ”¯æŒå…¨å±€è®¾ç½®æ¥æ”¶æ¶ˆæ¯ä¸€æ¬¡æ€§æ¥æ”¶å¤šå°‘æ¡çš„é…ç½®**_ï¼ˆv1.0.8 æ–°å¢ï¼‰_**ï¼›
    
*   æ”¯æŒä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œç¬¬ä¸€ç§å°±æ˜¯**v1.0.8**ä¹‹å‰çš„é€šè¿‡å®ä¾‹åŒ–çš„æ–¹å¼è¿›è¡Œåˆå§‹åŒ–ä½¿ç”¨ï¼Œç¬¬äºŒç§å°±æ˜¯**v1.0.9**ä¹‹åå¢åŠ äº†å¯ä»¥é€šè¿‡**ä¾èµ–æ³¨å…¥**çš„æ–¹å¼è¿›è¡Œåˆå§‹åŒ–ä½¿ç”¨**_ï¼ˆæ¨èä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼‰_**ã€‚
    

### 6.3ã€ğŸŒ½ å®‰è£…

å®‰è£…å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š

    Install-Package Quick.RabbitMQPlus.Furion
    

è¯¥ç»„ä»¶çš„å‘½åç©ºé—´ä¸ºï¼š`Quick.RabbitMQPlus`ï¼ŒåŒ…æ‹¬`Quick.RabbitMQPlus`åŸç”Ÿç»„ä»¶ã€‚

![Quick.RabbitMQPlus.Furion](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025150143899-463541192.png)

![Quick.RabbitMQPlus.Furion](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025150156264-1461613915.png)

### 6.4ã€ğŸŒ¶ ç”Ÿäº§ç«¯

#### **6.4.1ã€é…ç½®`appsettings.json`**

åœ¨`appsettings.json`é…ç½®æ–‡ä»¶ä¸­åˆ›å»ºèŠ‚ç‚¹`QuickRabbitMQPlus`\>`PrefetchCount`å’Œ`QuickRabbitMQPlusConfigs`ï¼ŒPrefetchCount ä¸ºè®¾ç½® RabbitMQ ä¸€æ¬¡æœ€å¤šæ¨é€å¤šå°‘æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼ˆé»˜è®¤ä¸º 10ï¼‰ï¼ŒQuickRabbitMQPlusConfigs ä¸ºæ•°ç»„ç±»å‹ï¼ˆå³å¯é…ç½®å¤šä¸ª RabbitMQ æœåŠ¡åœ°å€ï¼‰ï¼Œå…·ä½“é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š

    {
        "QuickRabbitMQPlus": {
            "PrefetchCount": 1,
            "QuickRabbitMQPlusConfigs": [
                {
                    "Default": false,
                    "ConnId": 1,
                    "UserName": "quber",
                    "Password": "0807_quberONE",
                    "HostName": "127.0.0.1",
                    "Port": 5672,
                    "ExchangeType": "direct",
                    "ExchangeName": "TestExchangeName",
                    "QueueNames": ["TestRabbitMQName1", "TestRabbitMQName2"],
                    "RouteKeys": ["TestRouteKey1", "TestRouteKey2"] //ExchangeType=directæ‰èµ·ä½œç”¨ï¼Œå¹¶ä¸”å’ŒQueueNamesä¸€ä¸€å¯¹åº”
                    //"ExchangeDurable": true,
                    //"QueueDurable": true,
                    //"MessageDurable": true
                },
                //fanoutæ¨¡å¼
                {
                    "Default": true,
                    "ConnId": 2,
                    "UserName": "quber",
                    "Password": "0807_quberONE",
                    "HostName": "127.0.0.1",
                    "Port": 5672,
                    "ExchangeType": "fanout",
                    "ExchangeName": "TestExchangeName",
                    "QueueNames": ["TestRabbitMQName1", "TestRabbitMQName2"],
                    "RouteKeys": ["TestRouteKey1", "TestRouteKey2"] //ExchangeType=directæ‰èµ·ä½œç”¨ï¼Œå¹¶ä¸”å’ŒQueueNamesä¸€ä¸€å¯¹åº”
                    //"ExchangeDurable": true,
                    //"QueueDurable": true,
                    //"MessageDurable": true
                }
            ]
        }
    }
    

**é…ç½®è¯´æ˜ï¼ˆæ¶ˆè´¹ç«¯é€šç”¨ï¼‰ï¼š**

å±æ€§åç§°

å±æ€§è¯´æ˜

æ˜¯å¦å¿…å¡«

å¤‡æ³¨

PrefetchCount

å…¨å±€è®¾ç½® RabbitMQ ä¸€æ¬¡æœ€å¤šæ¨é€å¤šå°‘æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼Œé»˜è®¤ä¸º 10

**æ¶ˆè´¹ç«¯æ‰ä½¿ç”¨çš„å±æ€§**

Default

æ˜¯å¦ä¸ºé»˜è®¤è¿æ¥

é»˜è®¤ä¸º false

ConnId

è¿æ¥ Idï¼ˆè¯·ç¡®ä¿è¯¥ Id çš„å”¯ä¸€æ€§ï¼‰

âˆš

å¦‚æœè¦åŠ¨æ€åˆ‡æ¢è¿æ¥é…ç½®ï¼Œè¯·ç¡®ä¿è¯¥ Id æœ‰å€¼å¹¶ä¸”å”¯ä¸€

UserName

RabbitMQ è¿æ¥è´¦æˆ·

âˆš

Password

RabbitMQ è¿æ¥å¯†ç 

âˆš

HostName

RabbitMQ è¿æ¥ IP

âˆš

Port

RabbitMQ è¿æ¥ç«¯å£

ä¸å¡«å°±æ˜¯é»˜è®¤ç«¯å£**5672**

ExchangeType

äº¤æ¢æœºç±»å‹ï¼ˆfanoutï¼šå‘å¸ƒè®¢é˜…æ¨¡å¼ã€directï¼šè·¯ç”±æ¨¡å¼ã€topicï¼šé€šé…ç¬¦æ¨¡å¼ã€headersï¼šå±æ€§åŒ¹é…æ¨¡å¼ï¼‰

âˆš

ExchangeName

äº¤æ¢æœºåç§°

âˆš

QueueNames

é˜Ÿåˆ—åç§°é›†åˆï¼ˆä¸äº¤æ¢æœº ExchangeName è¿›è¡Œç»‘å®šï¼‰

âˆš

æ­¤å¤„ä¸ºé›†åˆï¼Œç›®çš„æ˜¯åœ¨å‘å¸ƒæ¶ˆæ¯æ—¶å°†æ¶ˆæ¯å­˜å‚¨åˆ°è¯¥é˜Ÿåˆ—é›†åˆä¸­å»

RouteKeys

è·¯ç”±åç§°é›†åˆï¼ˆæˆ–é€šé…ç¬¦åç§°é›†åˆï¼‰

**ExchangeType=direct**æ‰èµ·ä½œç”¨ï¼Œå¹¶ä¸”å’Œ QueueNames æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œè¿™æ ·é…ç½®ç›®çš„æ˜¯å¯ä»¥å®ç°å°†æ¶ˆæ¯ 1 å‘é€åˆ°é˜Ÿåˆ— 1ï¼Œå°†æ¶ˆæ¯ 2 å‘é€åˆ°é˜Ÿåˆ— 2

ExchangeDurable

äº¤æ¢æœºæ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤ä¸º true

å¦‚æœé‡‡ç”¨é»˜è®¤çš„è®¾ç½®ï¼Œé…ç½®æ–‡ä»¶å¯ä»¥ä¸è¦è¯¥å±æ€§

QueueDurable

é˜Ÿåˆ—æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤ä¸º true

å¦‚æœé‡‡ç”¨é»˜è®¤çš„è®¾ç½®ï¼Œé…ç½®æ–‡ä»¶å¯ä»¥ä¸è¦è¯¥å±æ€§

MessageDurable

æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼Œé»˜è®¤ä¸º true

å¦‚æœé‡‡ç”¨é»˜è®¤çš„è®¾ç½®ï¼Œé…ç½®æ–‡ä»¶å¯ä»¥ä¸è¦è¯¥å±æ€§

#### **6.4.2ã€é…ç½® Program.cs**

ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯**Furion**ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯åœ¨ç¨‹åºå¯åŠ¨æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹ä»£ç ï¼ˆå…·ä½“å¯å‚è€ƒ[Furion å…¥é—¨æŒ‡å—](https://dotnetchina.gitee.io/furion/docs/serverun/)ï¼‰ï¼Œç›®çš„æ˜¯æ³¨å†Œ**RabbitMQ æœåŠ¡**å’Œ**é…ç½®é€‰é¡¹ QuickRabbitMQPlusOptions**ã€‚

1.  **ä¾èµ–æ³¨å…¥æ–¹å¼-WinForm ä¸­ä½¿ç”¨ï¼š**
    
        [STAThread]
        static void Main()
        {
        	ApplicationConfiguration.Initialize();
        
        	//åˆå§‹åŒ–Furion
        	Serve.Run(GenericRunOptions.DefaultSilence);
        }
    
        public void ConfigureServices(IServiceCollection services)
        {
        	//æ³¨å†ŒFrmMainçª—ä½“ç±»
        	services.AddScoped<FrmMain>();
        
        	//æ³¨å…¥IQuickRabbitMQPlusçš„æ–¹å¼
        	//é€šè¿‡AddRabbitMQPlusæ·»åŠ ä¾èµ–æ³¨å…¥
        	services.AddRabbitMQPlus();
        
        	////ä½¿ç”¨æ„é€ å‡½æ•°è·å–å®ä¾‹çš„æ–¹å¼ï¼š
        	////é€šè¿‡AddRabbitMQPlusæ·»åŠ ä¾èµ–æ³¨å…¥ï¼Œå¹¶æ³¨å†ŒTestConsumerClassForDIç±»
        	//services.AddRabbitMQPlus<TestConsumerClassForDI>()
        
        	//DIå®¹å™¨ç”ŸæˆserviceProvider
        	var serviceProvider = services.BuildServiceProvider();
        
        	//é€šè¿‡serviceProviderè·å–MainFormçš„æ³¨å†Œå®ä¾‹
        	var frmMain = serviceProvider.GetRequiredService<FrmMain>();
        	//var frmMain = (FrmMain)serviceProvider.GetService(typeof(FrmMain));
        
        	Application.Run(frmMain);
        }
    
    **è¯´æ˜ï¼š**ä¸Šè¿°çš„å…³é”®ç‚¹å°±åœ¨äºè°ƒç”¨**.AddRabbitMQPlus()**æˆ–è€…**.AddRabbitMQPlus<T>()**æ–¹æ³•å¯¹æœåŠ¡è¿›è¡Œæ³¨å†Œã€‚
    
2.  **å®ä¾‹åŒ–æ–¹å¼-WinForm ä¸­ä½¿ç”¨ï¼š**
    
        [STAThread]
        static void Main()
        {
        	//åˆå§‹åŒ–Furion
        	Serve.Run(GenericRunOptions.DefaultSilence);
        
        	//æˆ–è€…
        	//Serve.Run(RunOptions.DefaultSilence.ConfigureBuilder(builder =>
        	//{
        		//æ³¨å†ŒRabbitMQè¿æ¥é…ç½®å¯¹è±¡
        		//builder.Services.AddConfigurableOptions<QuickRabbitMQPlusOptions>();
        	//}).Configure(app =>
        	//{
        	//}));
        
        	ApplicationConfiguration.Initialize();
        	Application.Run(new FrmMain());
        }
    
        public void ConfigureServices(IServiceCollection services)
        {
        	//æ³¨å†ŒRabbitMQè¿æ¥é…ç½®å¯¹è±¡
        	services.AddConfigurableOptions<QuickRabbitMQPlusOptions>();
        }
    
3.  **Quick.RabbitMQPlus ç»„ä»¶ï¼Œä¾èµ–æ³¨å…¥æ–¹å¼-WinForm ä¸­ä½¿ç”¨ï¼š**
    
    **Program.cs çš„ Main æ–¹æ³•ï¼š**
    
        ApplicationConfiguration.Initialize();
        
        using IHost host = Host.CreateDefaultBuilder()
        	.ConfigureServices((_, services) =>
        		{
        			//æ³¨å†ŒFrmMainçª—ä½“ç±»
        			services.AddScoped<FrmMain>();
        
        			//æ³¨å…¥IQuickRabbitMQPlusçš„æ–¹å¼
        			//é€šè¿‡AddRabbitMQPlusæ·»åŠ ä¾èµ–æ³¨å…¥
        			services.AddRabbitMQPlus();
        
        			////ä½¿ç”¨æ„é€ å‡½æ•°è·å–å®ä¾‹çš„æ–¹å¼ï¼š
        			////é€šè¿‡AddRabbitMQPlusæ·»åŠ ä¾èµ–æ³¨å…¥ï¼Œå¹¶æ³¨å†ŒTestConsumerClassForDIç±»
        			//services.AddRabbitMQPlus<TestConsumerClassForDI>()
        
        			//DIå®¹å™¨ç”ŸæˆserviceProvider
        			var serviceProvider = services.BuildServiceProvider();
        
        			//é€šè¿‡serviceProviderè·å–MainFormçš„æ³¨å†Œå®ä¾‹
        			var frmMain = serviceProvider.GetRequiredService<FrmMain>();
        			//var frmMain = (FrmMain)serviceProvider.GetService(typeof(FrmMain));
        
        			Application.Run(frmMain);
        		}
        	)
        	.Build();
        
        host.RunAsync();
    
4.  **Quick.RabbitMQPlus ç»„ä»¶ï¼Œå®ä¾‹åŒ–æ–¹å¼-WinForm ä¸­ä½¿ç”¨ï¼š**
    
    **Program.cs çš„ Main æ–¹æ³•ï¼š**
    
        [STAThread]
        static void Main()
        {
        	ApplicationConfiguration.Initialize();
        	Application.Run(new FrmMain());
        }
        
    

_å…¶ä»–åº“çš„ä½¿ç”¨æ–¹å¼ä¹ŸåŸºæœ¬ç±»ä¼¼ï¼Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ã€‚_

#### **6.4.3ã€å®šä¹‰å‘é€æ¶ˆæ¯å®ä½“**

å¦‚ä¸‹æ‰€ç¤ºæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ¶ˆæ¯å®ä½“ï¼š

    namespace Quick.RabbitMQPlus.Publisher
    {
        public class TestRabbitMQModel
        {
            public int UserId { get; set; }
    
            public string UserName { get; set; }
    
            public int UserAge { get; set; }
    
            public DateTime CreateTime { get; set; }
        }
    }
    

#### **6.4.4ã€å‘é€æ¶ˆæ¯ Demo**

**å®šä¹‰å‘é€å¯¹è±¡ï¼š**

public partial class FrmMain : Form
    {
    	private readonly IQuickRabbitMQPlus _quickRabbitMqPlus;
    
    	public FrmMain(IQuickRabbitMQPlus quickRabbitMqPlus)
    	{
    		InitializeComponent();
    
    		//å®šä¹‰å‘é€å¯¹è±¡
    		_quickRabbitMqPlus = quickRabbitMqPlus;
    	}
    }

//å®šä¹‰å‘é€å¯¹è±¡
    var sendInstance = QuickRabbitMQPlusInstance.Instance();

**å‘é€å•æ¡æ¶ˆæ¯ï¼š**

//å‘é€10æ¡æ•°æ®
    for (int i = 0; i < 10; i++)
    {
    	var msgModel = new TestRabbitMQModel
    	{
    		UserId = rand.Next(1, 9999),
    		UserName = "Quick" + (i + 1),
    		UserAge = rand.Next(20, 80),
    		CreateTime = DateTime.Now
    	};
    
    	var sendRet = await _quickRabbitMqPlus.Send(msgModel);
    
    	if (sendRet.Item1)
    	{
    		//å‘é€æˆåŠŸ
    	}
    	else
    	{
    		//å‘é€å¤±è´¥
    		var errMsg = $"å¤±è´¥åŸå› ï¼š{sendRet.Item2}";
    	}
    
    	//é—´éš”2ç§’å‘é€ä¸€æ¬¡
    	await Task.Delay(2000);
    }
    
    //æ¶ˆæ¯å‘é€å®Œæˆåï¼Œå…³é—­é€šé“
    _quickRabbitMqPlus.Close();

//å½“i % 2ä¸º0æ—¶ï¼Œå‘é€ç»™è·¯ç”±TestRouteKey1å¯¹åº”çš„é˜Ÿåˆ—TestRabbitMQName1ï¼Œå¦åˆ™å‘é€ç»™è·¯ç”±TestRouteKey2å¯¹åº”çš„é˜Ÿåˆ—TestRabbitMQName2
    //æ­¤å¤„å°±å®ç°äº†åœ¨è·¯ç”±æ¨¡å¼ä¸‹ï¼Œå°†ä¸åŒçš„æ¶ˆæ¯å‘é€ç»™ä¸åŒçš„é˜Ÿåˆ—
    //éœ€è¦æ³¨æ„çš„æ—¶å€™ï¼Œæ­¤æ–¹å¼éœ€è¦å°†äº¤æ¢æœºç±»å‹é…ç½®ä¸ºdirectè·¯ç”±æ¨¡å¼ï¼ŒåŒæ—¶éœ€è¦è®¾ç½®é…ç½®çš„QueueNameså’ŒRouteKeyså±æ€§ï¼ˆè¿™ä¸¤å±æ€§çš„é›†åˆæ•°é‡éœ€è¦ä¿æŒä¸€è‡´ï¼Œä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼‰
    var sendRet = await _quickRabbitMqPlus.Send(msgModel, i % 2 == 0 ? "TestRouteKey1" : "TestRouteKey2");

**å‘é€å¤šæ¡æ¶ˆæ¯ï¼š**

    var sendList = new List<TestRabbitMQModel>{
    	new TestRabbitMQModel(),
    	new TestRabbitMQModel()
    };
    
    var sendRet = await _quickRabbitMqPlus.Send(sendList);
    

**åˆ‡æ¢è¿æ¥ï¼š**

    //åˆ‡æ¢åˆ°connId=2çš„é…ç½®
    _quickRabbitMqPlus.ChangeConn(2);
    
    var sendRetConn2 = await _quickRabbitMqPlus.Send(msgModel);
    
    //åˆ‡æ¢åˆ°connId=3çš„é…ç½®
    _quickRabbitMqPlus.ChangeConn(3);
    
    var sendRetConn3 = await _quickRabbitMqPlus.Send(msgModel);

### 6.5ã€ğŸ¥¦ æ¶ˆè´¹ç«¯

#### **6.5.1ã€é…ç½®`appsettings.json`ä¸å®ä½“ç‰¹æ€§`QuickRabbitMQPlusReceive`**

*   **é…ç½®è¯´æ˜ï¼š**
    
    å…·ä½“é…ç½®è¯·å‚è§ç”Ÿäº§ç«¯ï¼ˆå’Œç”Ÿäº§ç«¯å®Œå…¨ä¸€è‡´ï¼‰ã€‚
    
    éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¶ˆè´¹ç«¯ä¸­ï¼Œå¢åŠ äº†**PrefetchCount**é…ç½®ï¼Œç›®çš„ç”¨äºå…¨å±€è®¾ç½® RabbitMQ ä¸€æ¬¡æœ€å¤šæ¨é€å¤šå°‘æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼Œé»˜è®¤ä¸º 10ã€‚
    
    **éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ¶ˆè´¹ç«¯ä¸­çš„ QueueNames å±æ€§è®¾ç½®äº†å¤šä¸ªé˜Ÿåˆ—ï¼Œå°±ä»£è¡¨è¯¥æ¶ˆè´¹ç«¯åŒæ—¶æ¥æ”¶å¤šä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯**
    
*   **å®ä½“ç‰¹æ€§é…ç½®è¯´æ˜ï¼ˆæ¶ˆè´¹ç«¯ä½¿ç”¨ï¼‰ï¼š**
    
    å±æ€§åç§°
    
    å±æ€§è¯´æ˜
    
    æ˜¯å¦å¿…å¡«
    
    å¤‡æ³¨
    
    queueName
    
    é˜Ÿåˆ—åç§°ï¼ˆå¤šä¸ªé˜Ÿåˆ—åç§°è¯·ä½¿ç”¨è‹±æ–‡é€—å·,åˆ†éš”ï¼‰
    
    **å¦‚æœåŒæ—¶è®¾ç½®äº†å®ä½“ç‰¹æ€§çš„é˜Ÿåˆ—åç§°å’Œé…ç½®ä¸­çš„`QueueNames`å±æ€§ï¼Œé‚£ä¹ˆä¼šä¼˜å…ˆé‡‡ç”¨å®ä½“çš„é˜Ÿåˆ—åç§°**
    
    å¦‚ä¸‹æ‰€ç¤ºï¼š
    
        namespace Quick.RabbitMQPlus.Publisher
        {
            [QuickRabbitMQPlusReceive("TestRabbitMQName1")]
            //[QuickRabbitMQPlusReceive("TestRabbitMQName1,TestRabbitMQName2")]
            public class TestRabbitMQModel
            {
                public int UserId { get; set; }
        
                public string UserName { get; set; }
        
                public int UserAge { get; set; }
        
                public DateTime CreateTime { get; set; }
            }
        }
    

#### **6.5.2ã€é…ç½® Program.cs**

ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯**Furion**ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯åœ¨ç¨‹åºå¯åŠ¨æ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹ä»£ç ï¼ˆå…·ä½“å¯å‚è€ƒ[Furion å…¥é—¨æŒ‡å—](https://dotnetchina.gitee.io/furion/docs/serverun/)ï¼‰ï¼Œç›®çš„æ˜¯æ³¨å†Œ**RabbitMQ æœåŠ¡**å’Œ**é…ç½®é€‰é¡¹ QuickRabbitMQPlusOptions**ã€‚

1.  **ä¾èµ–æ³¨å…¥æ–¹å¼-Worker Service ä¸­ä½¿ç”¨ï¼š**
    
    //åˆå§‹åŒ–Furion
        Serve.Run(GenericRunOptions.Default);
    
        public void ConfigureServices(IServiceCollection services)
        {
        	//é€šè¿‡AddRabbitMQPlusæ·»åŠ ä¾èµ–æ³¨å…¥
        	services.AddRabbitMQPlus();
        }
    
    **è¯´æ˜ï¼š**ä¸Šè¿°çš„å…³é”®ç‚¹å°±åœ¨äºè°ƒç”¨**.AddRabbitMQPlus()**æˆ–è€…**.AddRabbitMQPlus<T>()**æ–¹æ³•å¯¹æœåŠ¡è¿›è¡Œæ³¨å†Œã€‚
    
2.  **ä¾èµ–æ³¨å…¥æ–¹å¼-æ§åˆ¶å°ä¸­ä½¿ç”¨ï¼š**
    
    //åˆå§‹åŒ–Furion
        Serve.Run(GenericRunOptions.DefaultSilence);
    
        public void ConfigureServices(IServiceCollection services)
        {
        	////é€šè¿‡AddRabbitMQPlusæ·»åŠ ä¾èµ–æ³¨å…¥
        	//services.AddRabbitMQPlus();
        
        	//ä½¿ç”¨æ„é€ å‡½æ•°è·å–å®ä¾‹çš„æ–¹å¼ï¼š
        	//é€šè¿‡AddRabbitMQPlusæ·»åŠ ä¾èµ–æ³¨å…¥ï¼Œå¹¶æ³¨å†ŒTestConsumerClassForDIç±»
        	services.AddRabbitMQPlus<TestConsumerClassForDI>();
        }
    
3.  **Quick.RabbitMQPlus ç»„ä»¶ï¼Œä¾èµ–æ³¨å…¥æ–¹å¼-Worker Service ä¸­ä½¿ç”¨ï¼š**
    
    **Program.cs çš„ Main æ–¹æ³•ï¼š**
    
        IHost host = Host.CreateDefaultBuilder(args)
        	.ConfigureServices(services =>
        	{
        		services.AddHostedService<Worker>();
        
        		//é€šè¿‡AddRabbitMQPlusæ·»åŠ ä¾èµ–æ³¨å…¥
        		services.AddRabbitMQPlus();
        	})
        	.Build();
        
        await host.RunAsync();
    
4.  **Quick.RabbitMQPlus ç»„ä»¶ï¼Œä¾èµ–æ³¨å…¥æ–¹å¼-æ§åˆ¶å°ä¸­ä½¿ç”¨ï¼š**
    
    **Program.cs çš„ Main æ–¹æ³•ï¼š**
    
        using IHost host = Host.CreateDefaultBuilder(args)
        	.ConfigureServices((_, services) =>
        	//æ³¨å…¥IQuickRabbitMQPlusçš„æ–¹å¼
        	//é€šè¿‡AddRabbitMQPlusæ·»åŠ ä¾èµ–æ³¨å…¥
        	services.AddRabbitMQPlus()
        
        	////ä½¿ç”¨æ„é€ å‡½æ•°è·å–å®ä¾‹çš„æ–¹å¼ï¼š
        	////é€šè¿‡AddRabbitMQPlusæ·»åŠ ä¾èµ–æ³¨å…¥ï¼Œå¹¶æ³¨å†ŒTestConsumerClassForDIç±»
        	//services.AddRabbitMQPlus<TestConsumerClassForDI>()
        )
        .Build();
    

#### **6.5.3ã€å®šä¹‰æ¥æ”¶æ¶ˆæ¯å®ä½“**

å¦‚ä¸‹æ‰€ç¤ºæˆ‘ä»¬å¯ä»¥å®šä¹‰ 3 ä¸ªæ¶ˆæ¯å®ä½“ï¼ˆç¬¬ä¸€ä¸ªç”¨äºæ¥æ”¶é˜Ÿåˆ—`TestRabbitMQName1`çš„æ¶ˆæ¯ï¼Œç¬¬äºŒä¸ªç”¨äºæ¥æ”¶é˜Ÿåˆ—`TestRabbitMQName2`çš„æ¶ˆæ¯ï¼Œç¬¬ä¸‰ä¸ªç”¨äºæ¥æ”¶é˜Ÿåˆ—`TestRabbitMQName1`å’Œ`TestRabbitMQName2`ï¼‰ï¼š

    namespace Quick.RabbitMQPlus.Consumer
    {
        [QuickRabbitMQPlusReceive("TestRabbitMQName1")]
        public class TestRabbitMQModel1
        {
            public int UserId { get; set; }
    
            public string UserName { get; set; }
    
            public int UserAge { get; set; }
    
            public DateTime CreateTime { get; set; }
        }
    }

    namespace Quick.RabbitMQPlus.Consumer
    {
        [QuickRabbitMQPlusReceive("TestRabbitMQName2")]
        public class TestRabbitMQModel2
        {
            public int UserId { get; set; }
    
            public string UserName { get; set; }
    
            public int UserAge { get; set; }
    
            public DateTime CreateTime { get; set; }
        }
    }

    namespace Quick.RabbitMQPlus.Consumer
    {
        [QuickRabbitMQPlusReceive("TestRabbitMQName1,TestRabbitMQName2")]
        public class TestRabbitMQModel3
        {
            public int UserId { get; set; }
    
            public string UserName { get; set; }
    
            public int UserAge { get; set; }
    
            public DateTime CreateTime { get; set; }
        }
    }

#### **6.5.4ã€æ¥æ”¶æ¶ˆæ¯ Demo**

**å®šä¹‰æ¥æ”¶å¯¹è±¡ï¼ˆä¾èµ–æ³¨å…¥æ–¹å¼ï¼‰ï¼š**

public class Worker : BackgroundService
    {
    	private readonly ILogger<Worker> _logger;
    	private readonly IQuickRabbitMQPlus _quickRabbitMqPlus;
    
    	public Worker(ILogger<Worker> logger, IQuickRabbitMQPlus quickRabbitMqPlus)
    	{
    		_logger = logger;
    		_quickRabbitMqPlus = quickRabbitMqPlus;
    	}
    }

//è·å–IQuickRabbitMQPlusçš„å®ä¾‹ï¼ˆAppæ˜¯Furionä¸­çš„é™æ€ç±»ï¼‰
    var _quickRabbitMqPlus = App.GetService<IQuickRabbitMQPlus>();
//è·å–IQuickRabbitMQPlusçš„å®ä¾‹ï¼ˆå…¶ä¸­çš„hostä¸ºIHostå¯¹è±¡ï¼ŒGetInstanceæ–¹æ³•ä¸ºå°è£…çš„æ‰©å±•æ–¹æ³•ï¼‰
    //var _quickRabbitMqPlus = host.Services.GetInstance<IQuickRabbitMQPlus>();
    
    //è·å–IQuickRabbitMQPlusçš„å®ä¾‹ï¼ˆå…¶ä¸­çš„hostä¸ºIHostå¯¹è±¡ï¼ŒGetInstanceæ–¹æ³•ä¸ºå°è£…çš„æ‰©å±•æ–¹æ³•ï¼‰
    var _quickRabbitMqPlus = host.GetInstance<IQuickRabbitMQPlus>();

**å®šä¹‰æ¥æ”¶å¯¹è±¡ï¼ˆå®ä¾‹åŒ–æ–¹å¼ï¼‰ï¼š**

    //å®šä¹‰æ¥æ”¶å¯¹è±¡
    var recInstance = QuickRabbitMQPlusInstance.Instance();
    

**å®šä¹‰ä¸¤ä¸ªæ¶ˆè´¹ç«¯ï¼Œä¸€ä¸ªæ¶ˆè´¹ç«¯æ¶ˆè´¹ä¸€ä¸ªé˜Ÿåˆ—**ï¼Œå…·ä½“çš„æ¥æ”¶æ¶ˆæ¯ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼ˆ**æ¥æ”¶å•æ¡æ¶ˆæ¯**ï¼‰ï¼š

    namespace Quick.RabbitMQPlus.ConsumerServiceFurion
    {
        public class Worker : BackgroundService
        {
            private readonly ILogger<Worker> _logger;
            private readonly IQuickRabbitMQPlus _quickRabbitMqPlus;
    
            public Worker(ILogger<Worker> logger, IQuickRabbitMQPlus quickRabbitMqPlus)
            {
                _logger = logger;
                _quickRabbitMqPlus = quickRabbitMqPlus;
            }
    
            protected override async Task ExecuteAsync(CancellationToken stoppingToken)
            {
                while (!stoppingToken.IsCancellationRequested)
                {
                    //æ¥æ”¶é˜Ÿåˆ—1çš„æ¶ˆæ¯
                    var retRec1 = await _quickRabbitMqPlus.Receive<TestRabbitMQModel1>(async (data, msg) =>
                    {
                        await Task.Delay(1000);
    
                        Console.ForegroundColor = ConsoleColor.Green;
                        Console.WriteLine($"\r\né˜Ÿåˆ—1æ¶ˆæ¯ï¼š{msg}");
    
                        //è¿”å›trueä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†æˆåŠŸï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯å·²ç»æ¥æ”¶æˆåŠŸï¼Œä¼šä»MQé˜Ÿåˆ—ä¸­åˆ é™¤
                        //è¿”å›falseä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†å¤±è´¥ï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯æ²¡æœ‰å¤„ç†æˆåŠŸï¼Œåˆ™MQä¼šç»§ç»­æ¨é€è¿™æ¡æ¶ˆæ¯
                        return true;
                    }, async (errMsg, msg) =>
                    {
                        await Task.Delay(3000);
    
                        Console.ForegroundColor = ConsoleColor.Red;
                        Console.WriteLine($"\r\né˜Ÿåˆ—1æ¥æ”¶é”™è¯¯ï¼š{errMsg}\r\nåŸå§‹æ•°æ®ï¼š{msg}");
                    }, 1);
                    if (!retRec1.Item1)
                    {
                        Console.ForegroundColor = ConsoleColor.Red;
                        Console.WriteLine($"\r\né˜Ÿåˆ—1æ¥æ”¶å¤±è´¥ï¼š{retRec1.Item2}");
                    }
    
                    //æ¥æ”¶é˜Ÿåˆ—2çš„æ¶ˆæ¯
                    var retRec2 = await _quickRabbitMqPlus.Receive<TestRabbitMQModel2>(async (data, msg) =>
                    {
                        await Task.Delay(2500);
    
                        Console.ForegroundColor = ConsoleColor.Magenta;
                        Console.WriteLine($"\r\né˜Ÿåˆ—2æ¶ˆæ¯ï¼š{msg}");
    
                        //è¿”å›trueä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†æˆåŠŸï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯å·²ç»æ¥æ”¶æˆåŠŸï¼Œä¼šä»MQé˜Ÿåˆ—ä¸­åˆ é™¤
                        //è¿”å›falseä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†å¤±è´¥ï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯æ²¡æœ‰å¤„ç†æˆåŠŸï¼Œåˆ™MQä¼šç»§ç»­æ¨é€è¿™æ¡æ¶ˆæ¯
                        return true;
                    }, async (errMsg, msg) =>
                    {
                        await Task.Delay(3000);
    
                        Console.ForegroundColor = ConsoleColor.Red;
                        Console.WriteLine($"\r\né˜Ÿåˆ—1æ¥æ”¶é”™è¯¯ï¼š{errMsg}\r\nåŸå§‹æ•°æ®ï¼š{msg}");
                    }, 10);
                    if (!retRec2.Item1)
                    {
                        Console.ForegroundColor = ConsoleColor.Red;
                        Console.WriteLine($"\r\né˜Ÿåˆ—2æ¥æ”¶å¤±è´¥ï¼š{retRec2.Item2}");
                    }
                }
            }
        }
    }

    //æ¥æ”¶é˜Ÿåˆ—1çš„æ¶ˆæ¯
    var retRec1 = await _quickRabbitMqPlus.Receive<TestRabbitMQModel1>(async (data, msg) =>
    {
        await Task.Delay(1000);
    
        Console.ForegroundColor = ConsoleColor.Green;
        Console.WriteLine($"\r\né˜Ÿåˆ—1æ¶ˆæ¯ï¼š{msg}");
    
        //è¿”å›trueä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†æˆåŠŸï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯å·²ç»æ¥æ”¶æˆåŠŸï¼Œä¼šä»MQé˜Ÿåˆ—ä¸­åˆ é™¤
        //è¿”å›falseä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†å¤±è´¥ï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯æ²¡æœ‰å¤„ç†æˆåŠŸï¼Œåˆ™MQä¼šç»§ç»­æ¨é€è¿™æ¡æ¶ˆæ¯
        return true;
    });
    if (!retRec1.Item1)
    {
        Console.ForegroundColor = ConsoleColor.Red;
        Console.WriteLine($"\r\né˜Ÿåˆ—1æ¥æ”¶å¤±è´¥ï¼š{retRec1.Item2}");
    }
    
    //æ¥æ”¶é˜Ÿåˆ—2çš„æ¶ˆæ¯
    var retRec2 = await _quickRabbitMqPlus.Receive<TestRabbitMQModel2>(async (data, msg) =>
    {
        await Task.Delay(2500);
    
        Console.ForegroundColor = ConsoleColor.Magenta;
        Console.WriteLine($"\r\né˜Ÿåˆ—2æ¶ˆæ¯ï¼š{msg}");
    
        //è¿”å›trueä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†æˆåŠŸï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯å·²ç»æ¥æ”¶æˆåŠŸï¼Œä¼šä»MQé˜Ÿåˆ—ä¸­åˆ é™¤
        //è¿”å›falseä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†å¤±è´¥ï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯æ²¡æœ‰å¤„ç†æˆåŠŸï¼Œåˆ™MQä¼šç»§ç»­æ¨é€è¿™æ¡æ¶ˆæ¯
        return true;
    });
    if (!retRec2.Item1)
    {
        Console.ForegroundColor = ConsoleColor.Red;
        Console.WriteLine($"\r\né˜Ÿåˆ—2æ¥æ”¶å¤±è´¥ï¼š{retRec2.Item2}");
    }

æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š

![6.4.4-1](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025150556039-180208775.gif)

**å®šä¹‰ä¸€ä¸ªæ¶ˆè´¹ç«¯ï¼ŒåŒæ—¶æ¶ˆè´¹ä¸¤ä¸ªé˜Ÿåˆ—**ï¼Œå…·ä½“çš„æ¥æ”¶æ¶ˆæ¯ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼ˆ**æ¥æ”¶å•æ¡æ¶ˆæ¯**ï¼‰ï¼š

    //æ¥æ”¶é˜Ÿåˆ—1çš„æ¶ˆæ¯
    var retRec = await _quickRabbitMqPlus.Receive<TestRabbitMQModel3>(async (data, msg) =>
    {
        await Task.Delay(1000);
    
        Console.ForegroundColor = ConsoleColor.Green;
        Console.WriteLine($"\r\né˜Ÿåˆ—1ã€2æ¶ˆæ¯ï¼š{msg}");
    
        //è¿”å›trueä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†æˆåŠŸï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯å·²ç»æ¥æ”¶æˆåŠŸï¼Œä¼šä»MQé˜Ÿåˆ—ä¸­åˆ é™¤
        //è¿”å›falseä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†å¤±è´¥ï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯æ²¡æœ‰å¤„ç†æˆåŠŸï¼Œåˆ™MQä¼šç»§ç»­æ¨é€è¿™æ¡æ¶ˆæ¯
        return true;
    });
    if (!retRec.Item1)
    {
        Console.ForegroundColor = ConsoleColor.Red;
        Console.WriteLine($"\r\né˜Ÿåˆ—1ã€2æ¥æ”¶å¤±è´¥ï¼š{retRec.Item2}");
    }

æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š

![6.4.4-2](https://img2022.cnblogs.com/blog/346453/202210/346453-20221025150634773-1305168379.gif)

**å¦‚æœéœ€è¦æ¥æ”¶å¤šæ¡æ¶ˆæ¯ï¼Œè¯·ä½¿ç”¨`Receives`æ–¹æ³•ï¼š**

    //æ¥æ”¶é˜Ÿåˆ—1çš„æ¶ˆæ¯
    var retRec = await _quickRabbitMqPlus.Receives<TestRabbitMQModel3>(async (dataList, msg) =>
    {
    	//æ­¤å¤„çš„dataListä¸ºList<TestRabbitMQModel3>
    
        return true;
    });

### 6.6ã€ğŸ¥™ Quick.RabbitMQPlus.Furion æ–¹æ³•

*   é¦–å…ˆå£°æ˜ Quick.RabbitMQPlus çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å¾—åˆ° Quick.RabbitMQPlus çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œä¸€ç§æ˜¯é€šè¿‡**ä¾èµ–æ³¨å…¥**åœ¨æ„é€ å‡½æ•°ä¸­å¾—åˆ°ï¼Œå¦ä¸€ç§æ˜¯ç›´æ¥é€šè¿‡**å®ä¾‹åŒ–å¯¹è±¡**çš„æ–¹å¼ï¼Œå…·ä½“å¯å‚ç…§ä¸Šè¿°æ–‡æ¡£ä¸­çš„ç›¸å…³ç¤ºä¾‹ã€‚
    
*   ä¾èµ–æ³¨å…¥æ–¹æ³•ï¼š
    
    æ–¹æ³•åç§°
    
    æ–¹æ³•è¯´æ˜
    
    æ–¹æ³•å‚æ•°
    
    å¤‡æ³¨
    
    AddRabbitMQPlus
    
    æ·»åŠ ä¾èµ–æ³¨å…¥æœåŠ¡
    
    é‡è½½ 1ï¼š()  
    é‡è½½ 2ï¼š<T>()
    
    è¯¥æ–¹æ³•ä¸º**IServiceCollection**çš„æ‰©å±•æ–¹æ³•ï¼Œç›®çš„æ˜¯å®ç°`IQuickRabbitMQPlus`æ¥å£çš„æ³¨å†Œã€‚  
    é‡è½½ 1 ä»£è¡¨æ³¨å†Œçš„æ˜¯**IQuickRabbitMQPlus**æœåŠ¡ï¼›  
    é‡è½½ 2 ä¼ å…¥äº†**æ³›å‹ T**ï¼Œä»£è¡¨çš„æ˜¯æ³¨å†Œäº†**IQuickRabbitMQPlus**æœåŠ¡çš„åŒæ—¶ï¼Œä¹Ÿæ³¨å†Œäº† T è¿™ä¸ªæœåŠ¡ï¼ˆ**T**è¿™ä¸ªæ³›å‹ç±»ä¸­ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­å®ç°äº†**IQuickRabbitMQPlus**æ¥å£æœåŠ¡ï¼Œè¯¥æ–¹æ³•å¯èƒ½åœ¨æ§åˆ¶å°ç¨‹åºä½¿ç”¨çš„æƒ…å†µè¾ƒå¤šï¼‰ã€‚
    
    GetInstance
    
    è·å–æŸæ¥å£æœåŠ¡çš„å®ä¾‹
    
    é‡è½½ 1ï¼š()  
    é‡è½½ 2ï¼š()
    
    è¯¥æ–¹æ³•ä¸º**IServiceProvider**æˆ–**IHost**çš„æ‰©å±•æ–¹æ³•ï¼Œç›®çš„æ˜¯è·å–æŸæ¥å£æˆ–ç±»çš„å®ä¾‹ã€‚  
    é‡è½½ 1 æ˜¯åŸºäº**IServiceProvider**çš„æ‰©å±•ï¼›  
    é‡è½½ 2 æ˜¯åŸºäº**IHost**çš„æ‰©å±•ã€‚
    
*   å…¶æ¬¡å°±å¯ä»¥ä½¿ç”¨ä½¿ç”¨è¯¥å®ä¾‹åŒ–å¯¹è±¡ä¸­çš„å‘é€å’Œæ¥æ”¶æ–¹æ³•äº†ï¼Œå…·ä½“è¯´æ˜å¦‚ä¸‹æ‰€ç¤ºï¼š
    
    æ–¹æ³•åç§°
    
    æ–¹æ³•è¯´æ˜
    
    æ–¹æ³•å‚æ•°
    
    å¤‡æ³¨
    
    Send
    
    å‘é€æ¶ˆæ¯æ–¹æ³•ï¼Œæ”¯æŒå•æ¡æ¶ˆæ¯å’Œå¤šæ¡æ¶ˆæ¯çš„å‘é€
    
    (data,routeKey)
    
    æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•° data å¯ä»¥ä¸º T æˆ– List<T>  
    æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºè·¯ç”±åç§°ï¼ˆå½“äº¤æ¢æœºç±»å‹ä¸ºè·¯ç”±æ¨¡å¼çš„æ—¶å€™ï¼Œè¯¥å‚æ•°èµ·ä½œç”¨ï¼Œå¦‚å¯ä»¥å®ç°ä½¿ç”¨åŒä¸€ä¸ªå®ä½“å°†ä¸åŒçš„æ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—ä¸­ï¼‰
    
    Receive
    
    æ¥æ”¶æ¶ˆæ¯ï¼ˆå•æ¡æ¶ˆæ¯ï¼‰ï¼Œ**è¯¥æ–¹æ³•æœ‰ 3 ä¸ªé‡è½½**
    
    é‡è½½ 1ï¼š(received)  
    é‡è½½ 2ï¼š(received, receivedError)  
    é‡è½½ 3ï¼š(received, receivedError, prefetchCount)
    
    æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°åŒ…å« 2 ä¸ªè¿”å›æ•°æ®ï¼ˆç¬¬ä¸€ä¸ªä¸º**T**ï¼Œç¬¬äºŒä¸ªä¸º**T å¯¹åº”çš„å­—ç¬¦ä¸²**ï¼‰ï¼Œå¹¶ä¸”è¯¥å›è°ƒå‡½æ•°éœ€è¦è¿”å› bool ç±»å‹ï¼ˆä»¥ä¾¿å‘Šè¯‰ RabbitMQ æœåŠ¡è¯¥æ¶ˆæ¯æ˜¯å¦å¤„ç†æˆåŠŸï¼‰ï¼›  
      
    æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ¶ˆè´¹å‡ºé”™çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°åŒ…æ‹¬ 2 ä¸ªè¿”å›æ•°æ®ï¼ˆç¬¬ä¸€ä¸ªä¸ºé”™è¯¯æç¤ºä¿¡æ¯ï¼Œç¬¬äºŒä¸ªä¸º**T å¯¹åº”çš„å­—ç¬¦ä¸²**ï¼‰  
    æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºè®¾ç½® RabbitMQ ä¸€æ¬¡æœ€å¤šæ¨é€å¤šå°‘æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼Œé»˜è®¤ä¸º 10
    
    Receives
    
    æ¥æ”¶æ¶ˆæ¯ï¼ˆå¤šæ¡æ¶ˆæ¯ï¼‰ï¼Œ**è¯¥æ–¹æ³•æœ‰ 3 ä¸ªé‡è½½**
    
    é‡è½½ 1ï¼š(received)  
    é‡è½½ 2ï¼š(received, receivedError)  
    é‡è½½ 3ï¼š(received, receivedError, prefetchCount)
    
    æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°åŒ…å« 2 ä¸ªè¿”å›æ•°æ®ï¼ˆç¬¬ä¸€ä¸ªä¸º**List<T>**ï¼Œç¬¬äºŒä¸ªä¸º**List<T>å¯¹åº”çš„å­—ç¬¦ä¸²**ï¼‰ï¼Œå¹¶ä¸”è¯¥å›è°ƒå‡½æ•°éœ€è¦è¿”å› bool ç±»å‹ï¼ˆä»¥ä¾¿å‘Šè¯‰ RabbitMQ æœåŠ¡è¯¥æ¶ˆæ¯æ˜¯å¦å¤„ç†æˆåŠŸï¼‰ï¼›  
    æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºæ¶ˆè´¹å‡ºé”™çš„å›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°åŒ…æ‹¬ 2 ä¸ªè¿”å›æ•°æ®ï¼ˆç¬¬ä¸€ä¸ªä¸ºé”™è¯¯æç¤ºä¿¡æ¯ï¼Œç¬¬äºŒä¸ªä¸º**List<T>å¯¹åº”çš„å­—ç¬¦ä¸²**ï¼‰  
    æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºè®¾ç½® RabbitMQ ä¸€æ¬¡æœ€å¤šæ¨é€å¤šå°‘æ¡æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼Œé»˜è®¤ä¸º 10
    
    ChangeConn
    
    åˆ‡æ¢è¿æ¥ï¼ˆåˆ‡æ¢é…ç½®æ–‡ä»¶ä¸­æŸä¸ªè¿æ¥é…ç½®ï¼‰
    
    (connId)
    
    æ–¹æ³•å‚æ•° connId ä¸º int ç±»å‹ï¼Œå³ä¸é…ç½®ä¸­çš„ ConnId ä¿æŒä¸€è‡´
    
    Close
    
    å…³é—­è¿æ¥
    
    ()
    
    **æ³¨æ„ï¼Œå¦‚æœè°ƒç”¨äº†è¯¥æ–¹æ³•ï¼Œåˆæƒ³é‡æ–°ä½¿ç”¨å®ä¾‹åŒ–å¯¹è±¡ mqInstance å‘é€æˆ–æ¥æ”¶æ¶ˆæ¯ï¼Œéœ€è¦é‡æ–°å®ä¾‹åŒ–è¯¥å¯¹è±¡ã€‚**
    
    **å¦‚ä¸‹æ‰€ç¤ºä¸ºæ¥æ”¶æ¶ˆæ¯çš„ä½¿ç”¨æ–¹å¼ï¼š**
    
        //æ¥æ”¶é˜Ÿåˆ—1çš„æ¶ˆæ¯
        var retRec1 = await _quickRabbitMqPlus.Receive<TestRabbitMQModel1>(async (data, msg) =>
        {
        	await Task.Delay(1000);
        
        	Console.ForegroundColor = ConsoleColor.Green;
        	Console.WriteLine($"\r\né˜Ÿåˆ—1æ¶ˆæ¯ï¼š{msg}");
        
        	//è¿”å›trueä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†æˆåŠŸï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯å·²ç»æ¥æ”¶æˆåŠŸï¼Œä¼šä»MQé˜Ÿåˆ—ä¸­åˆ é™¤
        	//è¿”å›falseä»£è¡¨ä¸šåŠ¡é€»è¾‘å¤„ç†å¤±è´¥ï¼Œä¼šå‘ŠçŸ¥MQè¿™æ¡æ¶ˆæ¯æ²¡æœ‰å¤„ç†æˆåŠŸï¼Œåˆ™MQä¼šç»§ç»­æ¨é€è¿™æ¡æ¶ˆæ¯
        	return true;
        }, async (errMsg, msg) =>
        {
        	await Task.Delay(3000);
        
        	Console.ForegroundColor = ConsoleColor.Red;
        	Console.WriteLine($"\r\né˜Ÿåˆ—1æ¥æ”¶é”™è¯¯ï¼š{errMsg}\r\nåŸå§‹æ•°æ®ï¼š{msg}");
        }, 1);
        if (!retRec1.Item1)
        {
        	Console.ForegroundColor = ConsoleColor.Red;
        	Console.WriteLine($"\r\né˜Ÿåˆ—1æ¥æ”¶å¤±è´¥ï¼š{retRec1.Item2}");
        }
        
    

* * *

7ã€ğŸŸQuick.RabbitMQPlus ä½¿ç”¨è¯´æ˜
---------------------------

`Quick.RabbitMQPlus`ç»„ä»¶çš„ä½¿ç”¨æ–¹å¼å’Œ`Quick.RabbitMQPlus.Furion`ç»„ä»¶å®Œå…¨ä¸€è‡´ï¼ˆåŒ…æ‹¬é…ç½®ã€å®ä½“ç‰¹æ€§å’Œæ–¹æ³•ç­‰ï¼‰ï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯`Quick.RabbitMQPlus.Furion`éœ€è¦åœ¨å¯åŠ¨ç¨‹åºä¸­é€šè¿‡**ä¾èµ–æ³¨å…¥æ³¨å†ŒæœåŠ¡ï¼ˆservices.AddRabbitMQPlus()ã€services.AddRabbitMQPlus<T>()ï¼‰**æˆ–**æ³¨å†Œ RabbitMQ è¿æ¥é…ç½®å¯¹è±¡**ï¼ˆ**builder.Services.AddConfigurableOptions<QuickRabbitMQPlusOptions>();**ï¼‰ã€‚

* * *

8ã€ğŸŒ°RabbitMQ æ€»ç»“
---------------

ç»è¿‡ä»¥ä¸Šå¯¹ RabbitMQ çš„ä»‹ç»å’Œè¿ç”¨ï¼Œç®€å•æ€»ç»“å‡ ç‚¹å…³äº RabbitMQ çš„é‡ç‚¹æ³¨æ„äº‹é¡¹ï¼š

*   éœ€è¦äº†è§£æŒæ¡ RabbitMQ çš„å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼šç”Ÿäº§è€…ã€äº¤æ¢æœºã€é˜Ÿåˆ—ã€ç»‘å®šã€è¿æ¥ã€é€šé“å’Œæ¶ˆè´¹è€…ï¼›
    
*   éœ€è¦äº†è§£æŒæ¡ RabbitMQ çš„å‡ ç§æ¨¡å¼ï¼šç®€å•é˜Ÿåˆ—æ¨¡å¼ã€å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ã€å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆä½¿ç”¨æœ€å¤šï¼‰ã€è·¯ç”±æ¨¡å¼å’Œé€šé…ç¬¦æ¨¡å¼ï¼›
    
*   åœ¨æ¶ˆè´¹æ•°æ®å®Œæˆåï¼Œéœ€è¦å“åº”ç»™ MQ æœåŠ¡å™¨ï¼Œå› æ­¤è¦ç†è§£è‡ªåŠ¨å“åº”å’Œæ‰‹åŠ¨å“åº”çš„åŸç†å’ŒåŒºåˆ«ï¼ˆä¸€èˆ¬éƒ½ä½¿ç”¨æ‰‹åŠ¨å“åº”ï¼Œä¸ºäº†ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±å¹¶ä¸”å¯å†æ¬¡æ¶ˆè´¹ï¼‰ï¼›
    
*   å¦‚æœæƒ³è¦æ¶ˆæ¯æŒä¹…åŒ–ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µå¯¹`äº¤æ¢æœº`ã€`é˜Ÿåˆ—`å’Œ`æ¶ˆæ¯`è®¾ç½®å…¶æŒä¹…åŒ–é…ç½®ï¼›
    
*   â€¦â€¦