---
layout: post
title: "3é“å¸¸è§çš„vueé¢è¯•é¢˜ï¼Œä½ éƒ½ä¼šäº†å—ï¼Ÿ"
date: "2022-04-09T02:50:28.338Z"
---
3é“å¸¸è§çš„vueé¢è¯•é¢˜ï¼Œä½ éƒ½ä¼šäº†å—ï¼Ÿ
==================

æœ€è¿‘æµä¼ å„å¤§å‚çº·çº·è£å‘˜ï¼Œå¯¼è‡´å¾ˆå¤šäººâ€œè¢«è¿«â€æ¯•ä¸šï¼Œæ˜¾ç„¶å¾ˆå¤šäººè¿˜æ˜¯æƒ³ç•™çº§ï¼Œæ— å¥ˆå‡ºç°åœ¨åå•ä¸­ï¼Œåªèƒ½æ„Ÿå¹å‘½è¿ä¸å…¬ï¼Œä¸è¿‡æ‹¿äº†N+1ï¼Œä¹Ÿç®—æ˜¯å¾ˆæ¬£æ…°ã€‚

åˆå¾—å»é¢è¯•äº†ï¼Œæ¥ä¸‹æ¥ä¸€èµ·æ¥å·©å›ºä¸‹[vueçš„3é“é¢è¯•é¢˜](https://www.1024nav.com/front-junior/framework-vue)å§ï¼

computed å®ç°åŸç†
-------------

`computed` è®¡ç®—å±æ€§ï¼Œæœ‰ä¸¤ç§å®šä¹‰æ–¹å¼ï¼Œä¸€ç§æ˜¯æ–¹æ³•ï¼Œå¦ä¸€ç§æ˜¯ getï¼Œset å±æ€§ã€‚å¹¶ä¸” `computed` ç›‘å¬çš„å¯¹è±¡å¿…é¡»æ˜¯å·²ç»åœ¨ data å®šä¹‰çš„å±æ€§

Vue åœ¨åˆ›å»º `computed` å±æ€§æ—¶å€™ï¼Œä¼šå¾ªç¯æ‰€æœ‰è®¡ç®—å±æ€§ï¼Œæ¯ä¸€ä¸ªè®¡ç®—å±æ€§ä¼šåˆ›å»ºä¸€ä¸ª watchï¼Œå¹¶ä¸”åœ¨é€šè¿‡ `defineProperty` ç›‘å¬ï¼Œåœ¨ `get` ä¸­ï¼Œè®¡ç®—å±æ€§å·¥ä½œæ˜¯åšä¾èµ–æ”¶é›†ï¼Œåœ¨ `set` ä¸­ï¼Œè®¡ç®—å±æ€§é‡è¦å·¥ä½œæ˜¯é‡æ–°æ‰§è¡Œè®¡ç®—æ–¹æ³•

`computed` æ˜¯æ‡’æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€æ¬¡åˆå§‹åŒ–ä¹‹åï¼Œä¸ä¼šæ‰§è¡Œè®¡ç®—ï¼Œä¸‹ä¸€æ¬¡å˜æ›´æ‰§è¡Œé‡æ–°è®¡ç®—æ˜¯åœ¨ set ä¸­

`computed` æ”¶é›†æ—¶æœºå’Œ `data` ä¸€æ ·ï¼Œæ˜¯åœ¨ç»„ä»¶æŒ‚è½½å‰ï¼Œä½†æ˜¯**å…¶æ”¶é›†å¯¹è±¡æ˜¯è‡ªå·±å±æ€§å¯¹åº”çš„ watchï¼Œè€Œ data æœ¬èº«æ‰€æœ‰æ•°æ®å¯¹åº”ä¸€ä¸ª watch**

å…·ä½“å¯ä»¥æŸ¥çœ‹ computed çš„å®ç°æºç ï¼Œè¿™é‡Œç§»é™¤æœåŠ¡ç«¯æ¸²æŸ“ç›¸å…³é€»è¾‘

    function initComputed(vm: Component, computed: Object) {
      const watchers = (vm._computedWatchers = Object.create(null));
    
      for (const key in computed) {
        const userDef = computed[key];
        const getter = typeof userDef === "function" ? userDef : userDef.get;
        if (process.env.NODE_ENV !== "production" && getter == null) {
          warn(`Getter is missing for computed property "${key}".`, vm);
        }
    
        // è®¡ç®—å±æ€§ç‹¬äº«watcher
        watchers[key] = new Watcher(vm, getter || noop, noop, computedWatcherOptions);
    
        // åœ¨å®ä¾‹åŒ–Watcheråï¼Œå¼€å§‹å¯¹è®¡ç®—å±æ€§è¿›è¡Œå“åº”å¼å¤„ç†
        if (!(key in vm)) {
          defineComputed(vm, key, userDef);
        } else if (process.env.NODE_ENV !== "production") {
          if (key in vm.$data) {
            warn(`The computed property "${key}" is already defined in data.`, vm);
          } else if (vm.$options.props && key in vm.$options.props) {
            warn(`The computed property "${key}" is already defined as a prop.`, vm);
          }
        }
      }
    }
    

æ¥ä¸‹æ¥çœ‹ `defineComputed` æºç 

    if (typeof userDef === "function") {
      sharedPropertyDefinition.get = createComputedGetter(key);
      sharedPropertyDefinition.set = noop;
    } else {
      sharedPropertyDefinition.get = userDef.get ? createComputedGetter(key) : noop;
      sharedPropertyDefinition.set = userDef.set || noop;
    }
    Object.defineProperty(target, key, sharedPropertyDefinition);
    

æ¥ä¸‹æ¥çœ‹ `createComputedGetter` å‡½æ•°ï¼Œè·å–è®¡ç®—å±æ€§å¯¹åº”çš„ `watcher`ï¼Œå¦‚æœ `dirty` æ˜¯ `true`ï¼Œåˆ™è®¡ç®—å€¼ï¼Œå¹¶æ”¶é›†ä¾èµ–

    function createComputedGetter(key) {
      return function () {
        // è·å–åˆ°ç›¸åº” key çš„ computed-watcher
        var watcher = this._computedWatchers[key];
        // å¦‚æœ computed ä¾èµ–çš„æ•°æ®å˜åŒ–ï¼Œdirty ä¼šå˜æˆtrueï¼Œä»è€Œé‡æ–°è®¡ç®—ï¼Œç„¶åæ›´æ–°ç¼“å­˜å€¼ watcher.value
        if (watcher.dirty) {
          watcher.evaluate();
        }
        if (Dep.target) {
          watcher.depend();
        }
        return watcher.value;
      };
    }
    

æ¥ä¸‹æ¥ï¼Œåœ¨ `Watcher` ç±»ä¸­æ‰¾åˆ° `evaluate`ï¼Œæ‰§è¡Œ `get` æ–¹æ³•ï¼Œå¹¶è®¾ç½® `dirty` ä¸º `false`

    evaluate () {
      this.value = this.get()
      this.dirty = false
    }
    

`get()` æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼Œåœ¨è¿™é‡Œæ‰§è¡Œè®¡ç®—è¿‡ç¨‹ï¼Œå¹¶è¿”å›ã€‚

    Watcher.prototype.get = function () {
      // æ”¹å˜ Dep.target
      pushTarget();
      // getter å°±æ˜¯ watcher å›è°ƒ
      var value = this.getter.call(this.vm, this.vm);
      // æ¢å¤å‰ä¸€ä¸ª watcher
      popTarget();
      return value;
    };
    
    Dep.target = null;
    
    var targetStack = [];
    
    function pushTarget(_target) {
      if (Dep.target) {
        targetStack.push(Dep.target);
      }
      Dep.target = _target;
    }
    
    function popTarget() {
      Dep.target = targetStack.pop();
    }
    

çœ‹å®Œäº† `watcher.evaluate()` æ¥ä¸‹æ¥çœ‹ `depend()` æ–¹æ³•å®šä¹‰

    Watcher.prototype.depend = function () {
      var i = this.deps.length;
      while (i--) {
        dep.addSub(Dep.target);
      }
    };
    

è¿™é‡Œçœ‹å‡º `watcher` çš„ `deps` å­˜å‚¨çš„å°±æ˜¯ `Dep.target` çš„æ•°ç»„ï¼Œæ²¡é”™ï¼Œå°±æ˜¯ä¾èµ–å±æ€§çš„æ”¶é›†ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±åˆ°æ­¤å®Œæˆã€‚

vue-loader çš„ä½œç”¨
--------------

vue-loader æ˜¯ Webpack çš„ loader æ¨¡å—ï¼Œå®ƒä½¿æˆ‘ä»¬å¯ä»¥ç”¨ `.vue` æ–‡ä»¶æ ¼å¼ç¼–å†™å•æ–‡ä»¶ç»„ä»¶ã€‚

å•æ–‡ä»¶ç»„ä»¶æ–‡ä»¶æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå³æ¨¡æ¿ï¼ˆtemplateï¼‰ã€è„šæœ¬ï¼ˆscriptï¼‰å’Œæ ·å¼ï¼ˆstyleï¼‰ã€‚

vue-loader æ¨¡å—å…è®¸ webpack ä½¿ç”¨å•ç‹¬çš„åŠ è½½å™¨æ¨¡å—ï¼ˆä¾‹å¦‚ SASS æˆ– SCSS åŠ è½½å™¨ï¼‰æå–å’Œå¤„ç†æ¯ä¸ªéƒ¨åˆ†ã€‚è¯¥è®¾ç½®ä½¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ .vue æ–‡ä»¶æ— ç¼ç¼–å†™ç¨‹åºã€‚

vue-loader æ¨¡å—è¿˜å…è®¸æŠŠé™æ€èµ„æºè§†ä¸ºæ¨¡å—ä¾èµ–æ€§ï¼Œå¹¶å…è®¸ä½¿ç”¨ webpack åŠ è½½å™¨è¿›è¡Œå¤„ç†ã€‚è€Œä¸”è¿˜å…è®¸åœ¨å¼€å‘è¿‡ç¨‹ä¸­è¿›è¡Œçƒ­é‡è£…ã€‚

Vue æ’ä»¶çš„åŠŸèƒ½
---------

æ’ä»¶é€šå¸¸ç”¨æ¥ä¸º Vue æ·»åŠ å…¨å±€åŠŸèƒ½ã€‚æœ‰å¦‚ä¸‹ç”¨é€”

1.  æ·»åŠ å…¨å±€æ–¹æ³•æˆ–è€… propertyã€‚å¦‚ï¼š[vue-custom-element](https://github.com/karol-f/vue-custom-element)
2.  æ·»åŠ å…¨å±€èµ„æºï¼šæŒ‡ä»¤/è¿‡æ»¤å™¨/è¿‡æ¸¡ç­‰ã€‚å¦‚ [vue-touch](https://github.com/vuejs/vue-touch)
3.  é€šè¿‡å…¨å±€æ··å…¥æ¥æ·»åŠ ä¸€äº›ç»„ä»¶é€‰é¡¹ã€‚å¦‚ [vue-router](https://github.com/vuejs/vue-router)
4.  æ·»åŠ  Vue å®ä¾‹æ–¹æ³•ï¼Œé€šè¿‡æŠŠå®ƒä»¬æ·»åŠ åˆ° `Vue.prototype` ä¸Šå®ç°ã€‚
5.  ä¸€ä¸ªåº“ï¼Œæä¾›è‡ªå·±çš„ APIï¼ŒåŒæ—¶æä¾›ä¸Šé¢æåˆ°çš„ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½ã€‚å¦‚ [vue-router](https://github.com/vuejs/vue-router)

å¦‚ä½•è‡ªå®šä¹‰ Vue æ’ä»¶
------------

Vue.js çš„æ’ä»¶åº”è¯¥æš´éœ²ä¸€ä¸ª `install` æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ `Vue` æ„é€ å™¨ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰çš„é€‰é¡¹å¯¹è±¡ï¼š

    MyPlugin.install = function (Vue, options) {
      // 1. æ·»åŠ å…¨å±€æ–¹æ³•æˆ– property
      Vue.myGlobalMethod = function () {
        // é€»è¾‘...
      }
    
      // 2. æ·»åŠ å…¨å±€èµ„æº
      Vue.directive('my-directive', {
        bind (el, binding, vnode, oldVnode) {
          // é€»è¾‘...
        }
        ...
      })
    
      // 3. æ³¨å…¥ç»„ä»¶é€‰é¡¹
      Vue.mixin({
        created: function () {
          // é€»è¾‘...
        }
        ...
      })
    
      // 4. æ·»åŠ å®ä¾‹æ–¹æ³•
      Vue.prototype.$myMethod = function (methodOptions) {
        // é€»è¾‘...
      }
    }
    

å†™åœ¨æœ€å
----

å¦‚æœæ–‡ä¸­å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œ **è®°å¾—ä¸‰è¿~ ğŸ‰ğŸ‰ğŸ‰** å¦‚æ–‡ä¸­æœ‰é”™è¯¯ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶æŒ‡æ­£ä¿®æ”¹ï¼

æ›´å¤šå‰ç«¯é¢ç»ï¼Œå°½åœ¨ [www.1024nav.com](www.1024nav.com)

ç¦æ­¢è½¬å‘