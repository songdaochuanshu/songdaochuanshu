---
layout: post
title: "测试必会 Docker 实战（一）：掌握高频命令，夯实内功基础"
date: "2022-04-28T08:24:07.729Z"
---
测试必会 Docker 实战（一）：掌握高频命令，夯实内功基础
===============================

在 Dokcer 横空出世之前，应用打包一直是大部分研发团队的痛点。在工作中，面对多种服务，多个服务器，以及多种环境，如果还继续用传统的方式打包部署，会浪费大量时间精力。

在 Docker 出现后，它以更高效的利用系统资源、更高效的利用系统资源、一致的运行环境、持续交付和部署、更轻松的迁移、更轻松的维护和拓展，6 大优点迅速火了起来。  
Docker 的基础命令，堪称 Docker 的内功，只有把内功修炼好了，我们在 Docker 的学习路上才会更加顺畅，不会导致“走火入魔”。  
接下来我将从与虚拟机的对比开始，以实战的方式，带大家更加了解，更会“玩” Docker。

[![](https://ceshiren.com/uploads/default/optimized/3X/1/7/1741a69efc8db5a8517b08df9309fbb0bc776623_2_800x408.jpeg)](https://ceshiren.com/uploads/default/original/3X/1/7/1741a69efc8db5a8517b08df9309fbb0bc776623.jpeg)

1080×552 44.9 KB

  
– 左边为虚拟机，右边为docker环境 –  
Server:物理机服务器  
Host OS：构建的操作系统  
Hypervisor：一种虚拟机软件，装了之后才能虚拟化操作系统  
Guest OS：虚拟化的操作系统  
Bins/Libs：执行命令、工具  
App A：构建的软件  
Docker Engine：跳过虚拟化内核的步骤，直接使用宿主机内核  
从图片中我们可以清楚的了解到，相比于 Docker，虚拟机更加的臃肿。  
虚拟机和容器都需要物理机以及操作系统，但是虚拟机有 Hypervisor 层以及 Guest OS 层。但是 Docker 是没有这两个部分的，只有一层 Docker Engine。

获取更多相关资料vx ：ceshiren001

并且每个容器都和宿主机共享计算机的硬件资源以及操作系统。那么由Hypervisor带来的资源耗损，在容器这边是不存在的。所以Docker与虚拟机对比，是有很强大的优势的，当然，也会有一定的缺点。  
优势（省去了虚拟化内核的步骤）

1.  节省资源（CPU、内存）
2.  秒级启动
3.  轻量级方案（同样一台服务器可以启动几百个docker，但是不能启动几百个虚拟机）  
    劣势
4.  隔离性、安全性相比虚拟机更弱（比如，如果其中一个容器将内核给"搞坏了"，那所有的容器就都无法正常工作了）
5.  某些情况下服务器会挑内核（eg.编译c++）

而对于测试人员，Docker又为我们带来了什么样的便利呢？

1.  搭建测试环境
2.  搭建各类基础服务
3.  搭建测试执行环境（自动化测试脚本执行环境）  
    在刚开始的时候，由于网络的原因，我们在下载的镜像的时候，常常速度是非常慢的。所以如果下载镜像很慢的同学，可以尝试配置国内的加速器加速镜像下载
4.  登录阿里开发者平台：  
    [开放云原生应用-云原生（Cloud Native）-云原生介绍 - 阿里云](https://dev.aliyun.com/search.html)
5.  点击“创建我的容器镜像”
6.  注册/登录后，进入Docker 镜像仓库，选中加速器 Tab  
    [阿里云登录 - 欢迎登录阿里云，安全稳定的云计算服务平台](https://cr.console.aliyun.com/#/imageList)
7.  根据个人需要, 选择运行Docker 的OS，按照要求修改Docker配置文件。

步骤如下：

修改配置文件 :  
添加红色部分到  
保存文件  
好记性不如烂键盘，单单只背下来Docker的命令是不够的，还要自己多敲多去练习，才能更熟练、更深刻的掌握Docker。  
下载镜像  
查看已下载的镜像  
我们可以看到刚刚下载的Jenkins镜像

那么，其中的每个字段又是什么意思呢？  
![](https://ceshiren.com/uploads/default/original/3X/7/c/7c78f8499b871d325975ef4b36f4640f90ae7874.png)  
删除镜像  
我们可以看到，Jenkins镜像已经被成功删除了  
下载指定版本的镜像  
此时我们可以发现，镜像的TAG不再是latest而是我们所指定的版本号  
将镜像打包成一个tar包

将打包的镜像加载出来

给镜像加tag号  
打了tag之后，会发现多了一个3.6.0 tag版本的镜像，但是image ID和原本的保持一致

然后我们删掉这个镜像，发现提示untagged，且这个镜像被成功删除  
给镜像改名称  
然后我们就可以看到，多了一个叫做testjenkins的镜像，但是image ID和原本的保持一致  
push镜像到镜像仓库  
容器运行命令参数  
容器管理命令参数  
接下来我们继续使用Jenkins进行一个实战的演练  
docker ps也是我们常用的一个命令，下面是docker ps后显示的启动容器信息，其中每个字段都有自己的含义  
![](https://ceshiren.com/uploads/default/original/3X/f/6/f67a9d696828e2d308d4c75f5e2704d1f1fd5a58.png)  
CONTAINER ID:容器ID(和image ID无关)  
如何删除这个启动的容器呢？是否可以和镜像一样，直接rm呢？  
从图中我们可以看到,如果直接删除运行中的容器会报错，需要先stop然后删除

或者直接  
我们从图片中可以看出，虽然这个容器是启动的状态，但是使用docker rm -f依然可以直接删除  
在docker ps 的时候我们可以看到，PORTS字段下面显示了两个端口号，这两个端口号是做什么的呢？  
其实呀，这两个端口号，是容器故意对外暴露的端口号，我们可以通过端口映射的方式，使容器内部的端口号与宿主机的某个端口号产生链接。这样我们就可以通过端口号，去访问或者操作容器啦  
如何指定端口号呢？就是使用 -p 参数  
将宿主机的8080端口指向容器的8080端口，这样我们在宿主机的8080端口就可以访问到Jenkins啦  
在启动的过程中，我们可能会碰到各种各样的问题，我们如何定位问题呢？  
当然是使用查看log大法

学到这里，可能有同学会有疑虑啦，如果docker挂掉，在docker内产生的数据应该怎么办呢，这些数据应该如何保存呢  
接下来，我们要了解的，docker是如何进行数据持久化的呢？  
当我们启动容器时，添加了数据挂载的参数-v 宿主机\_path:container\_path,docker就可以通过数据挂载的方式，使容器和宿主机的数据进行同步保存，  
接下来我们通过实战的方式，就可以看到docker是如何实现这一功能的  
1.启动Jenkins，要增加-v挂载卷参数  
注意：挂载权限：sudo chown -R 1000:1000 /home/docker/jenkins  
2\. 使用docker exec -it myjenkins bash进入刚启动的jenkins容器，并cat /var/jenkins\_home/secrets/initialAdminPassword这一步是为了找到jenkins的启动密码

3.输入密码，进入Jenkins页面创建一个job。  
4.删掉容器，重新执行之前的命令，重启Jenkins，进入页面，发现job没有因为容器被删而丢失  
注意：如果容器无法成功启动，且log提示权限问题，则在启动命令中添加-u 0  
docker exec -it {容器名称} bash  
进入容器，exec的意思是在容器中运行一个命令。如果使用bash 并且指定了-it 就会打开容器的shell 交互

docker cp {container:name}:{container\_path} {host\_path}把宿主机上的一个文件copy到容器中

有一些容器启动时，我们需要给他添加一些初始的参数，比如mysql，我们需要给他添加一些初始的账号和密码，docker如何操作这种情况呢？让我们动动小手，演练一下吧

1.  启动mysql容器，注意要加-e传递参数
    
2.  通过数据库连接工具连接数据库  
    host要填写宿主机的ip地址，Password是我们一开始设定的  
    端口号填写映射的宿主机的端口号
    
3.  在数据库中创建一个表
    
4.  删掉容器，然后重启
    
5.  进入刚刚创建的容器内的mysql路径下，发现有刚刚添加的表，这个就是容器的数据持久化的功能啦
    

我们接下来再思考一个问题，因为容器是有隔离性的。  
如果容器之间互相链接可以用什么方式？  
这里就要引入另外一个参数啦 --link，这个参数的作用就是把一台容器的网络信息，注入到另外一台容器中  
老方法，我们还是通过testlink实战，体验一下这个功能吧  
2.启动mariadb  
3.启动tesklink，mariadb的信息注入到testlink容器中  
4.查看日志，可以看到成功连接到mariadb

一个思考题，如果是三个容器需要连接呢，使用什么样的方式？  
答案是：–env因为在docker中，–link就是通过环境变量的方式配置的。

现在很多网站的架构都是前后端分离，在这种情况下，我们应该如何使用docker分别启动前端和后端，且能互相通信呢？我们可以使用下面的命令  
–net=container:conan:这样创建的容器不会创建自己的网卡，配置自己的IP，而是和一个指定的容器共享IP、端口范围。  
查看docker 的信息  
获取容器/镜像的元数据  
以上，我们通过实战的方式了解了docker的概念，熟悉了docker的一部分基础命令，看完文章后，就要熟悉练习了哦。下一次，将带大家通过3个实战练习selenium、prometheus+grafana、mysql的监控，带大家了解docker的招式法门，学会之后，我们就可以真正的带入工作，进行实战了。

[更多技术文章](https://qrcode.ceba.ceshiren.com/link?name=article&project_id=qrcode&from=bokeyuan&timestamp=1651114661)