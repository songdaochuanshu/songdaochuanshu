---
layout: post
title: "yolov8 tensorrtæ¨¡å‹åŠ é€Ÿéƒ¨ç½²ã€å®æˆ˜ã€‘"
date: "2023-01-25T02:39:37.311Z"
---
yolov8 tensorrtæ¨¡å‹åŠ é€Ÿéƒ¨ç½²ã€å®æˆ˜ã€‘
=========================

ubuntu18.04 yolov8 tensorrtæ¨¡å‹åŠ é€Ÿéƒ¨ç½²ã€å®æˆ˜ã€‘
=====================================

[**TensorRT-Alpha**](https://github.com/FeiYull/TensorRT-Alpha)åŸºäºtensorrt+cuda c++å®ç°æ¨¡å‹end2endçš„gpuåŠ é€Ÿï¼Œæ”¯æŒwin10ã€linuxï¼Œåœ¨2023å¹´å·²ç»æ›´æ–°æ¨¡å‹ï¼šYOLOv8, YOLOv7, YOLOv6, YOLOv5, YOLOv4, YOLOv3, YOLOX, YOLOR,pphumanseg,u2net,EfficientDetã€‚  
Windows10æ•™ç¨‹æ­£åœ¨åˆ¶ä½œï¼Œå¯ä»¥å…³æ³¨ä»“åº“ï¼š[https://github.com/FeiYull/TensorRT-Alpha](https://github.com/FeiYull/TensorRT-Alpha)

ä¸€ã€åŠ é€Ÿç»“æœå±•ç¤º
========

1.1 æ€§èƒ½é€Ÿè§ˆ
--------

ğŸš€å¿«é€Ÿçœ‹çœ‹yolov8n åœ¨ç§»åŠ¨ç«¯RTX2070m(8G)çš„æ–°èƒ½è¡¨ç°ï¼š

model

video resolution

model input size

GPU Memory-Usage

GPU-Util

yolov8n

1920x1080

8x3x640x640

1093MiB/7982MiB

14%

ä¸‹å›¾æ˜¯yolov8nçš„è¿è¡Œæ—¶é—´å¼€é”€ï¼Œå•ä½æ˜¯msï¼š  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/51ed467668e24b8c982008903733a6e2.jpeg#pic_center)

æ›´å¤šTensorRT-Alphaæµ‹è¯•å½•åƒåœ¨Bç«™è§†é¢‘ï¼š  
[**Bç«™ï¼šYOLOv8n**](https://www.bilibili.com/video/BV1vY4y1d7Dr/?spm_id_from=333.999.0.0&vd_source=a96c9c3f099f4167807291a34fd50fd5)  
[**Bç«™ï¼šYOLOv8s**](https://www.bilibili.com/video/BV1mx4y1M76P/?spm_id_from=333.999.0.0&vd_source=a96c9c3f099f4167807291a34fd50fd5)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/78afd19e93464dd8bf8c4d12cf129147.jpeg#pic_center)

1.2ç²¾åº¦å¯¹é½
-------

ä¸‹é¢æ˜¯å·¦è¾¹æ˜¯pythonæ¡†æ¶æ¨ç†ç»“æœï¼Œå³è¾¹æ˜¯TensorRT-Alphaæ¨ç†ç»“æœã€‚  
![yolov8n : Offical( left ) vs Ours( right )](https://img-blog.csdnimg.cn/56466c1923f84f43a5ef52f21cd74e99.jpeg#pic_center)

yolov8n : Offical( left ) vs Ours( right )

  

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/0ea125d5f6754251a44c913ade381905.jpeg#pic_center)

yolov7-tiny : Offical( left ) vs Ours( right )

  

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/8f718f04409b44c6b1cb00d93bbd6fb3.jpeg#pic_center)

yolov6s : Offical( left ) vs Ours( right )

  

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/cd2e2ed1e1554aa8a35795541ef08058.jpeg#pic_center)

yolov5s : Offical( left ) vs Ours( right )

  

YOLOv4 YOLOv3 YOLOR YOLOXç•¥ã€‚

äºŒã€Ubuntu18.04ç¯å¢ƒé…ç½®
=================

å¦‚æœæ‚¨å¯¹tensorrtä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¯·åŠ¡å¿…ä¿æŒä¸‹é¢åº“ç‰ˆæœ¬ä¸€è‡´ã€‚

2.1 å®‰è£…å·¥å…·é“¾å’Œopencv
----------------

    sudo apt-get update 
    sudo apt-get install build-essential 
    sudo apt-get install git
    sudo apt-get install gdb
    sudo apt-get install cmake
    

    sudo apt-get install libopencv-dev  
    # pkg-config --modversion opencv
    

2\. å®‰è£…Nvidiaç›¸å…³åº“
---------------

æ³¨ï¼šNvidiaç›¸å…³ç½‘ç«™éœ€è¦æ³¨å†Œè´¦å·ã€‚

### 2.1 å®‰è£…Nvidiaæ˜¾å¡é©±åŠ¨

    ubuntu-drivers devices
    sudo add-apt-repository ppa:graphics-drivers/ppa
    sudo apt update
    sudo apt install nvidia-driver-470-server # for ubuntu18.04
    nvidia-smi
    

### 2.2 å®‰è£… cuda11.3

*   è¿›å…¥é“¾æ¥: [https://developer.nvidia.com/cuda-toolkit-archive](https://developer.nvidia.com/cuda-toolkit-archive)
*   é€‰æ‹©ï¼šCUDA Toolkit 11.3.0(April 2021)
*   é€‰æ‹©ï¼š\[Linux\] -> \[x86\_64\] -> \[Ubuntu\] -> \[18.04\] -> \[runfile(local)\]  
      
    åœ¨ç½‘é¡µä½ èƒ½çœ‹åˆ°ä¸‹é¢å®‰è£…å‘½ä»¤ï¼Œæˆ‘è¿™é‡Œå·²ç»æ‹·è´ä¸‹æ¥ï¼š

    wget https://developer.download.nvidia.com/compute/cuda/11.3.0/local_installers/cuda_11.3.0_465.19.01_linux.run
    sudo sh cuda_11.3.0_465.19.01_linux.run
    

cudaçš„å®‰è£…è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä½ åœ¨bashçª—å£æ‰‹åŠ¨ä½œä¸€äº›é€‰æ‹©ï¼Œè¿™é‡Œé€‰æ‹©å¦‚ä¸‹ï¼š

*   selectï¼š\[continue\] -> \[accept\] -> æ¥ç€æŒ‰ä¸‹å›è½¦é”®å–æ¶ˆDriverå’Œ465.19.01è¿™ä¸ªé€‰é¡¹ï¼Œå¦‚ä¸‹å›¾(**it is important!**) -> \[Install\]  
      
    ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/68a9b9252ef648e2b90ba48a59dd9137.jpeg#pic_center)  
    bashçª—å£æç¤ºå¦‚ä¸‹è¡¨ç¤ºå®‰è£…å®Œæˆ

    #===========
    #= Summary =
    #===========
    
    #Driver:   Not Selected
    #Toolkit:  Installed in /usr/local/cuda-11.3/
    #......
    

æŠŠcudaæ·»åŠ åˆ°ç¯å¢ƒå˜é‡ï¼š

    vim ~/.bashrc
    

æŠŠä¸‹é¢æ‹·è´åˆ° .bashrcé‡Œé¢

    # cuda v11.3
    export PATH=/usr/local/cuda-11.3/bin${PATH:+:${PATH}}
    export LD_LIBRARY_PATH=/usr/local/cuda-11.3/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
    export CUDA_HOME=/usr/local/cuda-11.3
    

åˆ·æ–°ç¯å¢ƒå˜é‡å’ŒéªŒè¯

    source ~/.bashrc
    nvcc -V
    

bashçª—å£æ‰“å°å¦‚ä¸‹ä¿¡æ¯è¡¨ç¤ºcuda11.3å®‰è£…æ­£å¸¸  

    nvcc: NVIDIA (R) Cuda compiler driver<br>
    Copyright (c) 2005-2021 NVIDIA Corporation<br>
    Built on Sun_Mar_21_19:15:46_PDT_2021<br>
    Cuda compilation tools, release 11.3, V11.3.58<br>
    Build cuda_11.3.r11.3/compiler.29745058_0<br>
    

### 2.3 å®‰è£… cudnn8.2

*   è¿›å…¥ç½‘ç«™ï¼š[https://developer.nvidia.com/rdp/cudnn-archive](https://developer.nvidia.com/rdp/cudnn-archive)
*   é€‰æ‹©ï¼š Download cuDNN v8.2.0 (April 23rd, 2021), for CUDA 11.x
*   é€‰æ‹©ï¼š cuDNN Library for Linux (x86\_64)
*   ä½ å°†ä¼šä¸‹è½½è¿™ä¸ªå‹ç¼©åŒ…: "cudnn-11.3-linux-x64-v8.2.0.53.tgz"

    # è§£å‹
    tar -zxvf cudnn-11.3-linux-x64-v8.2.0.53.tgz
    

å°†cudnnçš„å¤´æ–‡ä»¶å’Œlibæ‹·è´åˆ°cuda11.3çš„å®‰è£…ç›®å½•ä¸‹ï¼š

    sudo cp cuda/include/cudnn.h /usr/local/cuda/include/
    sudo cp cuda/lib64/libcudnn* /usr/local/cuda/lib64/
    sudo chmod a+r /usr/local/cuda/include/cudnn.h
    sudo chmod a+r /usr/local/cuda/lib64/libcudnn*
    

### 2.4 ä¸‹è½½ tensorrt8.4.2.4

æœ¬æ•™ç¨‹ä¸­ï¼Œtensorrtåªéœ€è¦ä¸‹è½½\\ã€è§£å‹å³å¯ï¼Œä¸éœ€è¦å®‰è£…ã€‚

*   è¿›å…¥ç½‘ç«™ï¼š [https://developer.nvidia.cn/nvidia-tensorrt-8x-download](https://developer.nvidia.cn/nvidia-tensorrt-8x-download)
*   æŠŠè¿™ä¸ªæ‰“å‹¾ï¼š I Agree To the Terms of the NVIDIA TensorRT License Agreement
*   é€‰æ‹©: TensorRT 8.4 GA Update 1
*   é€‰æ‹©: TensorRT 8.4 GA Update 1 for Linux x86\_64 and CUDA 11.0, 11.1, 11.2, 11.3, 11.4, 11.5, 11.6 and 11.7 TAR Package
*   ä½ å°†ä¼šä¸‹è½½è¿™ä¸ªå‹ç¼©åŒ…: "TensorRT-8.4.2.4.Linux.x86\_64-gnu.cuda-11.6.cudnn8.4.tar.gz"

    # è§£å‹
    tar -zxvf TensorRT-8.4.2.4.Linux.x86_64-gnu.cuda-11.6.cudnn8.4.tar.gz
    # å¿«é€ŸéªŒè¯ä¸€ä¸‹tensorrt+cuda+cudnnæ˜¯å¦å®‰è£…æ­£å¸¸
    cd TensorRT-8.4.2.4/samples/sampleMNIST
    make
    cd ../../bin/
    

å¯¼å‡ºtensorrtç¯å¢ƒå˜é‡(**it is important!**)ï¼Œæ³¨ï¼šå°†LD\_LIBRARY\_PATH:åé¢çš„è·¯å¾„æ¢æˆä½ è‡ªå·±çš„ï¼åç»­ç¼–è¯‘onnxæ¨¡å‹çš„æ—¶å€™ä¹Ÿéœ€è¦æ‰§è¡Œä¸‹é¢ç¬¬ä¸€è¡Œå‘½ä»¤

    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/xxx/temp/TensorRT-8.4.2.4/lib
    ./sample_mnist
    

bashçª—å£æ‰“å°ç±»ä¼¼å¦‚ä¸‹å›¾çš„æ‰‹å†™æ•°å­—è¯†åˆ«è¡¨æ˜cuda+cudnn+tensorrtå®‰è£…æ­£å¸¸  
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/928d777b0490452cad3e2814eaf4d6da.png#pic_center)

ä¸‰ã€YOLOv8æ¨¡å‹éƒ¨ç½²
============

3.1 ä¸‹è½½ä»“åº“TensorRT-Alpha
----------------------

    git clone https://github.com/FeiYull/tensorrt-alpha
    

3.2 è·å–onnxæ–‡ä»¶
------------

ç›´æ¥åœ¨ç½‘ç›˜ä¸‹è½½ [weiyun](https://share.weiyun.com/3T3mZKBm) or [google driver](https://drive.google.com/drive/folders/1-8phZHkx_Z274UVqgw6Ma-6u5AKmqCOv) æˆ–è€…ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯¼å‡ºonnx:

    # ğŸ”¥ yolov8 å®˜æ–¹ä»“åº“: https://github.com/ultralytics/ultralytics
    # ğŸ”¥ yolov8 å®˜æ–¹æ•™ç¨‹: https://docs.ultralytics.com/quickstart/
    # ğŸš€TensorRT-Alpha will be updated synchronously as soon as possible!
    
    # å®‰è£… yolov8
    conda create -n yolov8 python==3.8 -y
    conda activate yolov8
    pip install ultralytics==8.0.5
    pip install onnx
    
    # ä¸‹è½½å®˜æ–¹æƒé‡(".pt" file)
    https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8n.pt
    https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8s.pt
    https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8m.pt
    https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8l.pt
    https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8x.pt
    https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8x6.pt
    

å¯¼å‡º onnx:

    # 640
    yolo mode=export model=yolov8n.pt format=onnx dynamic=True    #simplify=True
    yolo mode=export model=yolov8s.pt format=onnx dynamic=True    #simplify=True
    yolo mode=export model=yolov8m.pt format=onnx dynamic=True    #simplify=True
    yolo mode=export model=yolov8l.pt format=onnx dynamic=True    #simplify=True
    yolo mode=export model=yolov8x.pt format=onnx dynamic=True    #simplify=True
    # 1280
    yolo mode=export model=yolov8x6.pt format=onnx dynamic=True   #simplify=True
    

3.3 ç¼–è¯‘ onnx
-----------

    # æŠŠä½ çš„onnxæ–‡ä»¶æ”¾åˆ°è¿™ä¸ªè·¯å¾„:tensorrt-alpha/data/yolov8
    cd tensorrt-alpha/data/yolov8
    # è¯·æŠŠLD_LIBRARY_PATH:æ¢æˆæ‚¨è‡ªå·±çš„è·¯å¾„ã€‚
    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:~/TensorRT-8.4.2.4/lib
    # 640
    ../../../../TensorRT-8.4.2.4/bin/trtexec   --onnx=yolov8n.onnx  --saveEngine=yolov8n.trt  --buildOnly --minShapes=images:1x3x640x640 --optShapes=images:4x3x640x640 --maxShapes=images:8x3x640x640
    ../../../../TensorRT-8.4.2.4/bin/trtexec   --onnx=yolov8s.onnx  --saveEngine=yolov8s.trt  --buildOnly --minShapes=images:1x3x640x640 --optShapes=images:4x3x640x640 --maxShapes=images:8x3x640x640
    ../../../../TensorRT-8.4.2.4/bin/trtexec   --onnx=yolov8m.onnx  --saveEngine=yolov8m.trt  --buildOnly --minShapes=images:1x3x640x640 --optShapes=images:4x3x640x640 --maxShapes=images:8x3x640x640
    ../../../../TensorRT-8.4.2.4/bin/trtexec   --onnx=yolov8l.onnx  --saveEngine=yolov8l.trt  --buildOnly --minShapes=images:1x3x640x640 --optShapes=images:4x3x640x640 --maxShapes=images:8x3x640x640
    ../../../../TensorRT-8.4.2.4/bin/trtexec   --onnx=yolov8x.onnx  --saveEngine=yolov8x.trt  --buildOnly --minShapes=images:1x3x640x640 --optShapes=images:4x3x640x640 --maxShapes=images:8x3x640x640
    # 1280
    ../../../../TensorRT-8.4.2.4/bin/trtexec   --onnx=yolov8x6.onnx  --saveEngine=yolov8x6.trt  --buildOnly --minShapes=images:1x3x1280x1280 --optShapes=images:4x3x1280x1280 --maxShapes=images:8x3x1280x1280
    

ä½ å°†ä¼šçš„åˆ°ä¾‹å¦‚ï¼šyolov8n.trtã€yolov8s.trtã€yolov8m.trtç­‰æ–‡ä»¶ã€‚

3.4 ç¼–è¯‘è¿è¡Œ
--------

    git clone https://github.com/FeiYull/tensorrt-alpha
    cd tensorrt-alpha/yolov8
    mkdir build
    cd build
    cmake ..
    make -j10
    # æ³¨: æ•ˆæœå›¾é»˜è®¤ä¿å­˜åœ¨è·¯å¾„ tensorrt-alpha/yolov8/build
    
    # ä¸‹é¢å‚æ•°è§£é‡Š
    # --show è¡¨ç¤ºå¯è§†åŒ–ç»“æœ
    # --savePath è¡¨ç¤ºä¿å­˜ï¼Œé»˜è®¤ä¿å­˜åœ¨buildç›®å½•
    # --savePath=../ ä¿å­˜åœ¨ä¸Šä¸€çº§ç›®å½•
    
    ## 640
    # æ¨ç†å›¾ç‰‡
    ./app_yolov8  --model=../../data/yolov8/yolov8n.trt --size=640 --batch_size=1  --img=../../data/6406407.jpg   --show --savePath
    ./app_yolov8  --model=../../data/yolov8/yolov8n.trt --size=640 --batch_size=8  --video=../../data/people.mp4  --show --savePath
    
    # æ¨ç†è§†é¢‘
    ./app_yolov8  --model=../../data/yolov8/yolov8n.trt     --size=640 --batch_size=8  --video=../../data/people.mp4  --show --savePath=../
    
    # åœ¨çº¿æ¨ç†ç›¸æœºè§†é¢‘
    ./app_yolov8  --model=../../data/yolov8/yolov8n.trt     --size=640 --batch_size=2  --cam_id=0  --show
    
    ## 1280
    # infer camera
    ./app_yolov8  --model=../../data/yolov8/yolov8x6.trt     --size=1280 --batch_size=2  --cam_id=0  --show
    

å››ã€å‚è€ƒ
====

[https://github.com/FeiYull/TensorRT-Alpha](https://github.com/FeiYull/TensorRT-Alpha)

CV&DL