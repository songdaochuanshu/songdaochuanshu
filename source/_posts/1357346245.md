---
layout: post
title: "ç¼“å­˜&PWAå®è·µ"
date: "2022-05-27T01:43:41.738Z"
---
ç¼“å­˜&PWAå®è·µ
========

ç¼“å­˜&PWA å®è·µ
=========

ä¸€ã€èƒŒæ™¯
----

ä»ä¸Šä¸€ç¯‡[ã€Šå‰ç«¯åŠ¨ç”»å®ç°ä¸åŸç†åˆ†æã€‹](https://zhuanlan.zhihu.com/p/516695216)ï¼Œæˆ‘ä»¬ä» Performance è¿›è¡ŒåŠ¨ç”»çš„æ€§èƒ½åˆ†æï¼Œå¹¶æ ¹æ® Performance åˆ†ææ¥ä¼˜åŒ–åŠ¨ç”»ã€‚ä½†ï¼Œå‰ç«¯ä¸ä»…ä»…æ˜¯å®ç°æµç•…çš„åŠ¨ç”»ã€‚ToB é¡¹ç›®ä¼šç»å¸¸ä¸æ•°æ®çš„ä¿å­˜ã€æ¸²æŸ“æ‰“äº¤é“ã€‚ä¾‹å¦‚å¼€å‘ä¸­ï¼Œä¸ºäº†æé«˜ç”¨æˆ·ä½“éªŒï¼Œé‡åˆ°äº†ä¸€äº›åœºæ™¯ï¼Œå…¶å®å°±æ˜¯åœ¨åˆ©ç”¨æŸäº›æ‰‹æ®µï¼Œæ¥è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚

*   Select ä¸‹æ‹‰ï¼šåšå‰ç«¯åˆ†é¡µå±•ç¤º â†’ é¿å…ä¸€æ¬¡æ€§æ¸²æŸ“æ•°æ®é€ æˆæµè§ˆå™¨çš„å‡æ­»çŠ¶æ€ï¼›
*   indexedDBï¼šå­˜å‚¨æ•°æ® â†’ ç”¨æˆ·ä¸‹ä¸€æ¬¡è¿›å…¥æ—¶ï¼Œä¿å­˜ä¸Šä¸€æ¬¡ç¼–è¾‘çš„çŠ¶æ€ â€¦â€¦

é‚£ä¸å…å¼•å‘æ€è€ƒï¼Œæˆ‘ä»¬ä»ç¼“å­˜ä¸æ•°æ®å­˜å‚¨æ¥æ€è€ƒï¼Œè¯¥å¦‚ä½•ä¼˜åŒ–ï¼Ÿ

äºŒã€ HTTP ç¼“å­˜
----------

> **æ˜¯ä»€ä¹ˆï¼Ÿ**

Http ç¼“å­˜å…¶å®å°±æ˜¯æµè§ˆå™¨ä¿å­˜é€šè¿‡ HTTP è·å–çš„æ‰€æœ‰èµ„æºï¼Œ  
æ˜¯æµè§ˆå™¨å°†ç½‘ç»œèµ„æºå­˜å‚¨åœ¨æœ¬åœ°çš„ä¸€ç§è¡Œä¸ºã€‚

> **è¯·æ±‚çš„èµ„æºåœ¨å“ªé‡Œï¼Ÿ**

1.  6.8kB + 200 çŠ¶æ€ç ï¼š æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œå®é™…çš„è¯·æ±‚ï¼Œä»æœåŠ¡å™¨ä¸Šè·å–èµ„æºï¼›
2.  memory cache: èµ„æºç¼“å­˜åœ¨å†…å­˜ä¸­,ä¸ä¼šè¯·æ±‚æœåŠ¡å™¨ï¼Œä¸€èˆ¬å·²ç»åŠ è½½è¿‡è¯¥èµ„æºä¸”ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå½“å…³é—­é¡µé¢æ—¶ï¼Œæ­¤èµ„æºå°±è¢«å†…å­˜é‡Šæ”¾æ‰äº†ï¼›
3.  disk cache: èµ„æºç¼“å­˜åœ¨ç£ç›˜ä¸­ï¼Œä¸ä¼šè¯·æ±‚æœåŠ¡å™¨ï¼Œä½†æ˜¯è¯¥èµ„æºä¹Ÿä¸ä¼šéšç€å…³é—­é¡µé¢å°±é‡Šæ”¾æ‰ï¼›
4.  304 çŠ¶æ€ç ï¼šè¯·æ±‚æœåŠ¡å™¨ï¼Œå‘ç°èµ„æºæ²¡æœ‰è¢«æ›´æ”¹ï¼Œè¿”å› 304 åï¼Œèµ„æºä»æœ¬åœ°å–å‡ºï¼›
5.  service workerï¼š åº”ç”¨çº§åˆ«çš„å­˜å‚¨æ‰‹æ®µï¼›

### HTTP ç¼“å­˜åˆ†ç±»

#### 1\. å¼ºç¼“å­˜

1.  æµè§ˆå™¨åŠ è½½èµ„æºæ—¶ï¼Œä¼šå…ˆæ ¹æ®æœ¬åœ°ç¼“å­˜èµ„æºçš„ header ä¸­çš„ä¿¡æ¯åˆ¤æ–­æ˜¯å¦å‘½ä¸­å¼ºç¼“å­˜ã€‚å¦‚æœå‘½ä¸­ï¼Œåˆ™ä¸ä¼šåƒæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè€Œæ˜¯ç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–èµ„æºã€‚

3.  å¼ºç¼“å­˜å¯ä»¥é€šè¿‡è®¾ç½® HTTP Header æ¥å®ç°ï¼š  
    http1.0 â†’ Expires: å“åº”å¤´åŒ…å«æ—¥æœŸ/æ—¶é—´ï¼Œ å³åœ¨æ­¤æ—¶å€™ä¹‹åï¼Œå“åº”è¿‡æœŸã€‚  
    http1.1 â†’ Cache-Control:max-age=: è®¾ç½®ç¼“å­˜å­˜å‚¨çš„æœ€å¤§å‘¨æœŸï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ç¼“å­˜è¢«è®¤ä¸ºè¿‡æœŸ(å•ä½ç§’)ã€‚ä¸`Expires`ç›¸åï¼Œæ—¶é—´æ˜¯ç›¸å¯¹äºè¯·æ±‚çš„æ—¶é—´

ğŸ’¡ Cache-control

*   cache-control: max-age=3600 :è¡¨ç¤ºç›¸å¯¹æ—¶é—´
*   cache-control:no-cache â†’ å¯ä»¥å­˜å‚¨åœ¨æœ¬åœ°ç¼“å­˜çš„ï¼Œåªæ˜¯åœ¨åŸå§‹æœåŠ¡å™¨è¿›è¡Œæ–°é²œåº¦åœ¨éªŒè¯ä¹‹å‰ï¼Œç¼“å­˜ä¸èƒ½å°†å…¶æä¾›ç»™å®¢æˆ·ç«¯ä½¿ç”¨
*   cache-control: no-store â†’ ç¦æ­¢ç¼“å­˜å¯¹å“åº”è¿›è¡Œå¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£çš„ä¸ç¼“å­˜æ•°æ®åœ¨æœ¬åœ°ï¼›
*   catch-controlï¼špublic â†’ å¯ä»¥è¢«æ‰€æœ‰ç”¨æˆ·ç¼“å­˜ï¼ˆå¤šç”¨æˆ·å…±äº«ï¼‰ï¼ŒåŒ…æ‹¬ç»ˆç«¯ã€CDN ç­‰
*   cache-controlï¼š private â†’ ç§æœ‰ç¼“å­˜

#### 2\. åå•†ç¼“å­˜

1.  å½“æµè§ˆå™¨å¯¹æŸä¸ªèµ„æºçš„è¯·æ±‚æ²¡æœ‰å‘½ä¸­å¼ºç¼“å­˜ï¼Œå°±ä¼šå‘ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒéªŒè¯åå•†ç¼“å­˜æ˜¯å¦å‘½ä¸­ï¼Œå¦‚æœåå•†ç¼“å­˜å‘½ä¸­ï¼Œè¯·æ±‚è¿”å›çš„ http çŠ¶æ€ 304ï¼Œå¹¶ä¸”ä¼šæ˜¾ç¤º Not Modified çš„å­—ç¬¦ä¸²ï¼›
2.  åå•†ç¼“å­˜é€šè¿‡ã€last-Modifiedï¼Œif-Modified-Sinceã€‘ä¸ã€ETag, if-None-Matchã€‘æ¥ç®¡ç†çš„ã€‚

* * *

*   **ã€ŒLast-Modifiedã€If-Modified-Sinceã€**

last-Modified ï¼š è¡¨ç¤ºæœ¬åœ°æ–‡ä»¶æœ€åä¿®æ”¹çš„æ—¥æœŸï¼Œæµè§ˆå™¨ä¼šåœ¨è¯·æ±‚å¤´ä¸­å¸¦ä¸Š if-Modified-since(ä¹Ÿæ˜¯ä¸Šæ¬¡è¿”å›çš„ Last-Modified çš„å€¼)ï¼ŒæœåŠ¡å™¨ä¼šå°†è¿™ä¸ªå€¼ä¸èµ„æºä¿®æ”¹çš„æ—¶é—´è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœæ—¶é—´ä¸ä¸€è‡´ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›æ–°çš„èµ„æºï¼Œå¹¶ä¸”å°† Last-modified å€¼æ›´æ–°ï¼Œå¹¶ä½œä¸ºå“åº”å¤´è¿”å›ç»™æµè§ˆå™¨ã€‚å¦‚æœæ—¶é—´ä¸€è‡´ï¼Œè¡¨ç¤ºèµ„æºæ²¡æœ‰æ›´æ–°ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 304 çŠ¶æ€ï¼Œæµè§ˆå™¨æ‹¿åˆ°å“åº”çŠ¶æ€ç åä»æœ¬åœ°ç¼“å­˜ä¸­è¯»å–èµ„æºã€‚

*   ã€Œ**ETagã€If-None-Matchã€**

http 1.1 ä¸­ï¼Œ æœåŠ¡å™¨é€šè¿‡ Etag æ¥è®¾ç½®å“åº”å¤´ç¼“å­˜æ ‡ç¤ºã€‚Etag æ˜¯ç”±æœåŠ¡å™¨æ¥ç”Ÿæˆçš„ã€‚

ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†èµ„æºå’Œ ETag ä¸€å¹¶è¿”å›æµè§ˆå™¨ï¼Œæµè§ˆå™¨å°†ä¸¤è€…ç¼“å­˜åˆ°æœ¬åœ°ç¼“å­˜ä¸­ã€‚

ç¬¬äºŒæ¬¡è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šå°† ETag çš„å€¼æ”¾åˆ° If-None-Match è¯·æ±‚å¤´å»è®¿é—®æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚åï¼Œä¼šå°†æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶æ ‡è¯†ä¸æµè§ˆå™¨å‘æ¥çš„æ ‡è¯†è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœä¸åŒï¼Œ æœåŠ¡å™¨ä¼šè¿”å›æ›´æ–°çš„èµ„æºå’Œæ–°çš„ Etagï¼Œå¦‚æœç›¸åŒï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 304 çŠ¶æ€ç ï¼Œæµè§ˆå™¨è¯»å–ç¼“å­˜ã€‚

ğŸ’¡ æ€è€ƒä¸ºä»€ä¹ˆæœ‰äº† Last-Modified è¿™ä¸€å¯¹å„¿ï¼Œè¿˜éœ€è¦ Etag æ¥æ ‡è¯†æ˜¯å¦è¿‡æœŸè¿›è¡Œå‘½ä¸­åå•†ç¼“å­˜

1.  æ–‡ä»¶çš„å‘¨æœŸæ€§æ›´æ”¹ï¼Œä½†æ˜¯æ–‡ä»¶çš„å†…å®¹æ²¡æœ‰æ”¹å˜ï¼Œä»…ä»…æ”¹å˜äº†ä¿®æ”¹æ—¶é—´ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¹¶ä¸å¸Œæœ›å®¢æˆ·ç«¯è®¤ä¸ºè¯¥æ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œè€Œé‡æ–°è·å–ã€‚
2.  å¦‚æœæ–‡ä»¶æ–‡ä»¶é¢‘ç¹ä¿®æ”¹ï¼Œæ¯”å¦‚ 1s æ”¹äº† N æ¬¡ï¼ŒIf-Modified-Since æ— æ³•åˆ¤æ–­ä¿®æ”¹çš„ï¼Œä¼šå¯¼è‡´æ–‡ä»¶å·²ç»ä¿®æ”¹ä½†æ˜¯è·å–çš„èµ„æºè¿˜æ˜¯æ—§çš„ï¼Œä¼šå­˜åœ¨é—®é¢˜ã€‚
3.  æŸäº›æœåŠ¡å™¨ä¸èƒ½ç²¾ç¡®å¾—åˆ°æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ï¼Œå¯¼è‡´èµ„æºè·å–çš„é—®é¢˜ã€‚

âš ï¸ Â **å¦‚æœ Etag ä¸ Last-Modified åŒæ—¶å­˜åœ¨ï¼ŒæœåŠ¡å™¨ä¼šå…ˆæ£€æŸ¥ ETagï¼Œç„¶ååœ¨æ£€æŸ¥ Last-Modified, æœ€ç»ˆç¡®å®šæ˜¯è¿”å› 304 æˆ– 200ã€‚**

### HTTP ç¼“å­˜å®è·µ

æµ‹è¯•ç¯å¢ƒï¼š åˆ©ç”¨ Koaï¼Œæ­å»ºä¸€ä¸ª node æœåŠ¡ï¼Œç”¨æ¥æµ‹è¯•å¦‚ä½•å‘½ä¸­å¼ºç¼“å­˜è¿˜æ˜¯åå•†ç¼“å­˜

å½“ index.js æ²¡æœ‰é…ç½®ä»»ä½•å…³äºç¼“å­˜çš„é…ç½®æ—¶ï¼Œ æ— è®ºæ€ä¹ˆåˆ·æ–° chromeï¼Œéƒ½æ²¡æœ‰ç¼“å­˜æœºåˆ¶çš„ï¼›

*   æ³¨æ„âš ï¸ï¼šåœ¨å¼€å§‹å®éªŒä¹‹å‰è¦æŠŠ network é¢æ¿çš„ Disable cache å‹¾é€‰å»æ‰ï¼Œè¿™ä¸ªé€‰é¡¹è¡¨ç¤ºç¦ç”¨æµè§ˆå™¨ç¼“å­˜ï¼Œæµè§ˆå™¨è¯·æ±‚ä¼šå¸¦ä¸Š Cache-Control: no-cache å’Œ Pragma: no-cache å¤´éƒ¨ä¿¡æ¯ã€‚

#### 1\. å‘½ä¸­å¼ºç¼“å­˜

    app.use(async (ctx) => {
        // ctx.body = 'hello Koa'
        const url = ctx.request.url;
        if(url === '/'){
            // è®¿é—®è·Ÿè·¯å¾„è¿”å› index.html
            ctx.set('Content-type', 'text/html');
            ctx.body = await parseStatic('./index.html')
        }else {
            ctx.set('Content-Type', parseMime(url))
            ctx.set('Expires', new Date(Date.now() + 10000).toUTCString()) // å®éªŒ1
            ctx.set('Cache-Control','max-age=20') // å®éªŒ2
            ctx.body = await parseStatic(path.relative('/', url))
        }
    })
    
    app.listen(3000, () => {
        console.log('starting at port 3000')
    })
    

#### 2\. å‘½ä¸­åå•†ç¼“å­˜

             /**
             * å‘½ä¸­åå•†ç¼“å­˜
             * è®¾ç½® Last-Modified, If-Modified-Since
             */
             ctx.set('cache-control', 'no-cache'); // å…³é—­å¼ºç¼“å­˜
             const isModifiedSince = ctx.request.header['if-modified-since'];
             const fileStat = await getFileStat(filePath);
             if(isModifiedSince === fileStat.mtime.toGMTString()){
                 ctx.status = 304
             }else {
                 ctx.set('Last-Modified', fileStat.mtime.toGMTString())
             }  
             ctx.body = await parseStatic(path.relative('/', url))
    
            /**
             * å‘½ä¸­åå•†ç¼“å­˜
             * è®¾ç½® Etag, If-None-Match
             */
             ctx.set('cache-control', 'no-cache');
             const ifNoneMatch = ctx.request.headers['if-none-match'];
             const fileBuffer = await parseStatic(filePath);
             const hash = crypto.createHash('md5');
             hash.update(fileBuffer);
             const etag = `"${hash.digest('hex')}"`
             if (ifNoneMatch === etag) {
                ctx.status = 304
              } else {
                ctx.set('Etag', etag)
                ctx.body = fileBuffer
              }
        }
    

ä¸‰ã€ æµè§ˆå™¨ç¼“å­˜
--------

### 1.Cookies

*   MDN å®šä¹‰ï¼š æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶æŠ¥è®¯åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œä»–ä¼šåœ¨æµè§ˆå™¨ä¸‹æ¬¡æƒ³ç»Ÿä¸€æœåŠ¡å™¨å†æ¬¡å‘é€è¯·æ±‚æ—¶è¢«æºå¸¦å¹¶å‘é€åˆ°æœåŠ¡å™¨ä¸Šã€‚
*   åº”ç”¨åœºæ™¯ï¼š
    *   ä¼šè¯çŠ¶æ€ç®¡ç†ã€ç”¨æˆ·ç™»é™†çŠ¶æ€ï¼Œè´­ç‰©è½¦ï¼Œæ¸¸æˆåˆ†æ•°æˆ–å…¶ä»–éœ€è¦è®°å½•çš„ä¿¡æ¯ã€‘
    *   ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ã€ä¸»é¢˜ç­‰ï¼‰
    *   æµè§ˆå™¨è¡Œä¸ºè·Ÿè¸ªï¼ˆå¦‚è·Ÿè¸ªåˆ†æç”¨æˆ·è¡Œä¸ºç­‰ï¼‰
*   cookie çš„è¯»å–ä¸å†™å…¥ï¼š

    class Cookie {
    	getCookie: (name) => {
    		const reg = new RegExp('(^| )'+name+'=([^;]*)')
    		let match = document.cookie.match(reg); //  [å…¨é‡ï¼Œç©ºæ ¼ï¼Œvalueï¼Œâ€˜ï¼›â€™]
    		if(match) {return decodeURI(match[2])}
    	}
    	setCookie:(key,value,days,domain) => {
    		// username=John Smith; expires=Thu, 18 Dec 2043 12:00:00 GMT; path=/
    	  let d = new Date();
        d.setTime(d.getTime()+(days*24*60*60*1000));
        let expires = "; expires="+d.toGMTString();
    		let domain = domain ? '; domain='+domain : '';
    		document.cookie = name + '=' + value + expires + domain + '; path=/'
    		
    	}
    	deleteCookie: (name: string, domain?: string, path?: string)=> {
    		// åˆ é™¤cookieï¼Œåªéœ€è¦å°†æ—¶é—´è®¾ç½®ä¸ºè¿‡æœŸæ—¶é—´ï¼Œè€Œæ— éœ€åˆ é™¤cookieçš„value
            const d = new Date(0);
            domain = domain ? `; domain=${domain}` : '';
            path = path || '/';
            document.cookie =
                name + '=; expires=' + d.toUTCString() + domain + '; path=' + path;
        },
    }
    

*   å­˜åœ¨çš„é—®é¢˜ï¼š ç”±äºé€šè¿‡ Cookie å­˜å‚¨çš„æ•°æ®ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦åœ¨è¯·æ±‚å¤´ã€‚å¯¹ä¸ä¸€äº›æ•°æ®æ˜¯æ— éœ€äº¤ç»™æäº¤åç«¯çš„ï¼Œè¿™ä¸ªä¸å…ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ã€‚

### 2.WebStorage API

æµè§ˆå™¨èƒ½ä»¥ä¸€ç§æ¯”ä½¿ç”¨ Cookie æ›´ç›´è§‚çš„æ–¹å¼å­˜å‚¨é”®å€¼å¯¹

#### localStorage

ä¸ºæ¯ä¸€ä¸ªç»™å®šçš„æºï¼ˆgiven originï¼‰ç»´æŒä¸€ä¸ªç‹¬ç«‹çš„å­˜å‚¨åŒºåŸŸï¼Œæµè§ˆå™¨å…³é—­ï¼Œç„¶åé‡æ–°æ‰“å¼€åæ•°æ®ä»ç„¶å­˜åœ¨ã€‚

#### sessionStorage

ä¸ºæ¯ä¸€ä¸ªç»™å®šçš„æºï¼ˆgiven originï¼‰ç»´æŒä¸€ä¸ªç‹¬ç«‹çš„å­˜å‚¨åŒºåŸŸï¼Œè¯¥å­˜å‚¨åŒºåŸŸåœ¨é¡µé¢ä¼šè¯æœŸé—´å¯ç”¨ï¼ˆå³åªè¦æµè§ˆå™¨å¤„äºæ‰“å¼€çŠ¶æ€ï¼ŒåŒ…æ‹¬é¡µé¢é‡æ–°åŠ è½½å’Œæ¢å¤ï¼‰ã€‚

### 3.indexedDB ä¸ webSQL

#### webSQL

åŸºæœ¬æ“ä½œä¸å®é™…æ•°æ®åº“æ“ä½œåŸºæœ¬ä¸€è‡´ã€‚  
æœ€ç»ˆçš„æ•°æ®å»å‘ï¼Œä¸€èˆ¬åªæ˜¯åšä¸´æ—¶å­˜å‚¨å’Œå¤§å‹ç½‘ç«™çš„ä¸šåŠ¡è¿è¡Œå­˜å‚¨ç¼“å­˜çš„ä½œç”¨ï¼Œé¡µé¢åˆ·æ–°åè¯¥åº“å°±ä¸å­˜åœ¨äº†ã€‚è€Œå…¶æœ¬èº«ä¸å…³ç³»æ•°æ®åº“çš„æ¦‚å¿µæ¯”è¾ƒç›¸ä¼¼ã€‚

#### indexedDB

éšç€æµè§ˆå™¨çš„åŠŸèƒ½ä¸æ–­å¢å¼ºï¼Œè¶Šæ¥è¶Šå¤šçš„ç½‘ç«™å¼€å§‹è€ƒè™‘ï¼Œå°†å¤§é‡æ•°æ®å‚¨å­˜åœ¨å®¢æˆ·ç«¯ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä»æœåŠ¡å™¨è·å–æ•°æ®ï¼Œç›´æ¥ä»æœ¬åœ°è·å–æ•°æ®ã€‚ç°æœ‰çš„æµè§ˆå™¨æ•°æ®å‚¨å­˜æ–¹æ¡ˆï¼Œéƒ½ä¸é€‚åˆå‚¨å­˜å¤§é‡æ•°æ®ï¼›

IndexedDB æ˜¯æµè§ˆå™¨æä¾›çš„æœ¬åœ°æ•°æ®åº“ï¼Œ å…è®¸å‚¨å­˜å¤§é‡æ•°æ®ï¼Œæä¾›æŸ¥æ‰¾æ¥å£ï¼Œè¿˜èƒ½å»ºç«‹ç´¢å¼•ã€‚è¿™äº›éƒ½æ˜¯ LocalStorage æ‰€ä¸å…·å¤‡çš„ã€‚å°±æ•°æ®åº“ç±»å‹è€Œè¨€ï¼ŒIndexedDB ä¸å±äºå…³ç³»å‹æ•°æ®åº“ï¼ˆä¸æ”¯æŒ SQL æŸ¥è¯¢è¯­å¥ï¼‰ï¼Œæ›´æ¥è¿‘ NoSQL æ•°æ®åº“ã€‚

* * *

å››ã€åº”ç”¨ç¨‹åºç¼“å­˜
--------

### Service Worker

åœ¨æåŠ Service Worker ä¹‹å‰ï¼Œéœ€è¦å¯¹ web Worker æœ‰ä¸€äº›äº†è§£ï¼›

webWorker : Web Worker æ˜¯æµè§ˆå™¨å†…ç½®çš„çº¿ç¨‹æ‰€ä»¥å¯ä»¥è¢«ç”¨æ¥æ‰§è¡Œéé˜»å¡äº‹ä»¶å¾ªç¯çš„ JavaScript ä»£ç ã€‚ js æ˜¯å•çº¿ç¨‹ï¼Œä¸€æ¬¡åªèƒ½å®Œæˆä¸€ä»¶äº‹ï¼Œå¦‚æœå‡ºç°ä¸€ä¸ªå¤æ‚çš„ä»»åŠ¡ï¼Œçº¿ç¨‹å°±ä¼šè¢«é˜»å¡ï¼Œä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒï¼Œ Web Worker çš„ä½œç”¨å°±æ˜¯å…è®¸ä¸»çº¿ç¨‹åˆ›å»º worker çº¿ç¨‹ï¼Œä¸ä¸»çº¿ç¨‹åŒæ—¶è¿›è¡Œã€‚worker çº¿ç¨‹åªéœ€è´Ÿè´£å¤æ‚çš„è®¡ç®—ï¼Œç„¶åæŠŠç»“æœè¿”å›ç»™ä¸»çº¿ç¨‹å°±å¯ä»¥äº†ã€‚ç®€å•çš„ç†è§£å°±æ˜¯ï¼Œworker çº¿ç¨‹æ‰§è¡Œå¤æ‚è®¡ç®—å¹¶ä¸”é¡µé¢ï¼ˆä¸»çº¿ç¨‹ï¼‰ui å¾ˆæµç•…ï¼Œä¸ä¼šè¢«é˜»å¡ã€‚

* * *

**Service Worker** æ˜¯æµè§ˆå™¨å’Œç½‘ç»œä¹‹é—´çš„è™šæ‹Ÿä»£ç†ã€‚å…¶è§£å†³äº†å¦‚ä½•æ­£ç¡®ç¼“å­˜å¾€åç½‘ç«™èµ„æºå¹¶ä½¿å…¶åœ¨ç¦»çº¿æ—¶å¯ç”¨çš„é—®é¢˜ã€‚

Service Worker è¿è¡Œåœ¨ä¸€ä¸ªä¸é¡µé¢ js ä¸»çº¿ç¨‹ç‹¬ç«‹çš„çº¿ç¨‹ä¸Šï¼Œå¹¶ä¸”æ— æƒè®¿é—® DOM ç»“æ„ã€‚ä»–çš„ API æ˜¯éé˜»å¡çš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¹‹é—´å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚

ä»–ä¸ä»…ä»…æä¾›ç¦»çº¿åŠŸèƒ½ï¼Œè¿˜å¯ä»¥åšåŒ…æ‹¬å¤„ç†é€šçŸ¥ã€åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸Šæ‰§è¡Œç¹é‡çš„è®¡ç®—ç­‰äº‹åŠ¡ã€‚Service Workers éå¸¸å¼ºå¤§ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥æ§åˆ¶ç½‘ç»œè¯·æ±‚ï¼Œä¿®æ”¹ç½‘ç»œè¯·æ±‚ï¼Œè¿”å›ç¼“å­˜çš„è‡ªå®šä¹‰å“åº”æˆ–è€…åˆæˆå“åº”ã€‚

### 2.PWA

ğŸ’¡ PWAï¼Œå…¨ç§° Progressive web appsï¼Œå³æ¸è¿›å¼ Web åº”ç”¨ã€‚PWA æŠ€æœ¯ä¸»è¦ä½œç”¨ä¸ºæ„å»ºè·¨å¹³å°çš„ Web åº”ç”¨ç¨‹åºï¼Œå¹¶ä½¿å…¶å…·æœ‰ä¸åŸç”Ÿåº”ç”¨ç¨‹åºç›¸åŒçš„ç”¨æˆ·ä½“éªŒã€‚  
ğŸ’¡ PWA çš„æ ¸å¿ƒï¼š æœ€æ ¹æœ¬ã€æœ€åŸºæœ¬çš„ï¼Œå°±æ˜¯ Service Worker ä»¥åŠåœ¨å…¶å†…éƒ¨ä½¿ç”¨çš„ Cache APIã€‚åªè¦é€šè¿‡ Service Worker ä¸ Cache APIï¼Œå®ç°äº†å¯¹ç½‘ç«™é¡µé¢çš„ç¼“å­˜ã€å¯¹é¡µé¢è¯·æ±‚çš„æ‹¦æˆªã€å¯¹é¡µé¢ç¼“å­˜çš„æ“çºµ ã€‚

ä¸ºä»€ä¹ˆä½¿ç”¨ PWAï¼š

ä¼ ç»Ÿçš„ Web å­˜åœ¨çš„é—®é¢˜ï¼š

1.  ç¼ºä¹ç›´æ¥å…¥å£ï¼Œéœ€è¦è®°ä½ä»–çš„åŸŸåï¼Œæˆ–è€…æ˜¯ä¿å­˜åœ¨æ”¶è—å¤¹ï¼Œå¯»æ‰¾èµ·æ¥ä¸å¤Ÿæ–¹ä¾¿ï¼›
2.  ä¾èµ–äºç½‘ç»œã€‚åªè¦å®¢æˆ·ç«¯å¤„äºæ–­ç½‘çš„çŠ¶æ€ï¼Œæ•´ä¸ª web å°±å¤„äºç˜«ç—ªçŠ¶æ€ï¼Œå®¢æˆ·ç«¯æ— æ³•ä½¿ç”¨ï¼›
3.  æ— æ³•åƒ Native APP æ¨é€æ¶ˆæ¯ã€‚

ä¼ ç»Ÿ Native APP å­˜åœ¨çš„é—®é¢˜ï¼š

1.  éœ€è¦å®‰è£…ä¸ä¸‹è½½ã€‚å“ªæ€•åªæ˜¯ä½¿ç”¨ APP çš„æŸä¸ªåŠŸèƒ½ï¼Œä¹Ÿæ˜¯éœ€è¦å…¨ç›˜ä¸‹è½½çš„ï¼›
2.  å¼€å‘æˆæœ¬é«˜ï¼Œä¸€èˆ¬éœ€è¦å…¼å®¹å®‰å“ä¸ IOS ç³»ç»Ÿï¼›
3.  å‘å¸ƒéœ€è¦å®¡æ ¸ï¼›
4.  æ›´æ–°æˆæœ¬é«˜â€¦â€¦

PWA çš„å­˜åœ¨ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜æ‰€å¸¦æ¥çš„éº»çƒ¦ï¼š  
ä¼˜åŠ¿ï¼š

1.  æ¡Œé¢å…¥å£ï¼Œæ‰“å¼€ä¾¿æ·ï¼›
2.  ç¦»çº¿å¯ç”¨ï¼Œä¸ç”¨è¿‡åº¦ä¾èµ–ç½‘ç»œï¼›
3.  å®‰è£…æ–¹ä¾¿ï¼›
4.  ä¸€æ¬¡æ€§å¼€å‘ï¼Œæ— éœ€å®¡æ ¸ï¼Œæ‰€æœ‰å¹³å°å¯ç”¨ï¼›
5.  èƒ½å¤Ÿè¿›è¡Œæ¶ˆæ¯æ¨é€

*   Web App Manifest Web App Manifestï¼ˆWeb åº”ç”¨ç¨‹åºæ¸…å•ï¼‰æ¦‚æ‹¬åœ°è¯´æ˜¯ä¸€ä¸ªä»¥ JSON å½¢å¼é›†ä¸­ä¹¦å†™é¡µé¢ç›¸å…³ä¿¡æ¯å’Œé…ç½®çš„æ–‡ä»¶ã€‚

    {
      "short_name": "User Mgmt",
      "name": "User Management",
      "icons": [
        {
          "src": "favicon.ico",
          "sizes": "64x64 32x32 24x24 16x16",
          "type": "image/x-icon"
        },
        {
          "src": "logo192.png",
          "type": "image/png",
          "sizes": "192x192"
        },
        {
          "src": "logo512.png",
          "type": "image/png",
          "sizes": "512x512"
        }
      ],
      "start_url": ".", // è°ƒæ•´ç½‘ç«™çš„èµ·å§‹é“¾æ¥
      "display": "standalone", // è®¾å®šç½‘ç«™æç¤ºæ¨¡å¼ ï¼š standalone è¡¨ç¤ºéšè—æµè§ˆå™¨çš„UI
      "theme_color": "#000000", // è®¾å®šç½‘ç«™æ¯ä¸ªé¡µé¢çš„ä¸»é¢˜é¢œè‰²
      "background_color": "#ffffff" // è¨­å®šèƒŒæ™¯é¡è‰²
    }
    

*   ServiceWorker.js ä»£ç 

    /* eslint-disable no-restricted-globals */
    
    // ç¡®å®šå“ªäº›èµ„æºéœ€è¦ç¼“å­˜
    const CACHE_VERSION = 0;
    const CACHE_NAME = 'cache_v' + CACHE_VERSION;
    const CACHE_URL = [
      '/',
      'index.html',
      'favicon.ico',
      'serviceWorker.js',
      'static/js/bundle.js',
      'manifest.json',
      'users'
    ]
    const preCache = () => {
      return caches
        .open(CACHE_NAME)
        .then((cache) => {
          return cache.addAll(CACHE_URL)
        })
    }
    const clearCache = () => {
      return caches.keys().then(keys => {
        keys.forEach(key => {
          if (key !== CACHE_NAME) {
            caches.delete(key)
          }
        })
      })
    }
    // è¿›è¡Œç¼“å­˜
    self.addEventListener('install', (event) => {
      event.waitUntil(
        preCache()
      )
    })
    
    // åˆ é™¤æ—§çš„ç¼“å­˜
    self.addEventListener('activated', (event) => {
      event.waitUntil(
        clearCache()
      )
    })
    
    console.log('hello, service wold');
    
    self.addEventListener('fetch', (event) => {
      console.log('request:', event.request.url)
      event.respondWith(
        fetch(event.request).catch(() => { // ä¼˜å…ˆç½‘ç»œè¯·æ±‚ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™ä»ç¼“å­˜ä¸­æ‹¿èµ„æº
          return caches.match(event.request)
        })
      )
    })
    

*   PWA è°ƒè¯•

å½“ç¦»çº¿çš„æ—¶å€™ä¾ç„¶æ‹¿åˆ°ç¼“å­˜çš„èµ„æºï¼Œå¹¶ä¸”æ­£å¸¸å±•ç¤ºï¼Œå¯ä»¥çœ‹å‡ºèµ„æºè¢« serviceWorker ç¼“å­˜ã€‚

å€ŸåŠ©å¼€å‘è€…å·¥å…·ï¼š  
chrome devtools ï¼š chrome://inspect/#service-workers ï¼Œå¯ä»¥å±•ç¤ºå½“å‰è®¾å¤‡ä¸Šæ¿€æ´»å’Œå­˜å‚¨çš„ service worker

äº”ã€æ€»ç»“ä¸æ€è€ƒ
-------

å‚è€ƒä¼˜ç§€ç½‘ç«™ï¼š

1.  è¯­é›€ï¼š [https://www.yuque.com/dashboard](https://www.yuque.com/dashboard) ï¼›
2.  PWA ä¾‹å­ï¼š [https://mdn.github.io/pwa-examples/js13kpwa/](https://mdn.github.io/pwa-examples/js13kpwa/)