---
layout: post
title: "ä½“éªŒ Gitea Actions"
date: "2022-12-17T06:18:40.610Z"
---
ä½“éªŒ Gitea Actions
================

![ä½“éªŒ Gitea Actions](https://img2023.cnblogs.com/blog/2956540/202212/2956540-20221216190235348-718914885.png) Gitea Actions å®ç°äº†ä¸€ä¸ªå†…ç½®çš„ CI/CD ç³»ç»Ÿæ¡†æ¶ï¼Œå…¼å®¹ GitHub Actions çš„ YAML å·¥ä½œæµç¼–æ’æ ¼å¼ï¼Œå…¼å®¹ GitHub Marketplace ä¸­å¤§éƒ¨åˆ†ç°æœ‰çš„ Actions æ’ä»¶ã€‚

> å³å°†æ¨å‡ºçš„ Gitea Actions è‡´åŠ›äºæ‰“é€ ä¸€ä¸ª CI/CD å·¥å…·çš„æ ‡å‡†åè®®ï¼Œç¬¬ä¸‰æ–¹ CI ç³»ç»Ÿå¯ä»¥åŸºäºactions åè®®ä¸ Gitea å¹³å°é›†æˆï¼Œæä¾›ä¸€ç«™å¼ç®¡ç†æ–¹æ¡ˆã€‚Gitea Actions ä¸ºæ­¤èµ°å‡ºäº†ç¬¬ä¸€æ­¥ã€‚

å›é¡¾ GitHub Actions
-----------------

> [GitHub Actions](https://docs.github.com/zh/actions) æ˜¯ä¸€ç§æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ (CI/CD) å¹³å°ï¼Œå¯ç”¨äºè‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºå·¥ä½œæµç¨‹æ¥æ„å»ºå’Œæµ‹è¯•å­˜å‚¨åº“çš„æ¯ä¸ªæ‹‰å–è¯·æ±‚ï¼Œæˆ–å°†åˆå¹¶çš„æ‹‰å–è¯·æ±‚éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚
> 
> GitHub Actions ä¸ä»…ä»…æ˜¯ DevOpsï¼Œè¿˜å…è®¸ç”¨æˆ·åœ¨å­˜å‚¨åº“ä¸­å‘ç”Ÿå…¶ä»–äº‹ä»¶æ—¶è¿è¡Œå·¥ä½œæµç¨‹ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥è¿è¡Œå·¥ä½œæµç¨‹ï¼Œä»¥ä¾¿åœ¨æœ‰äººåˆ›å»ºæ–°é—®é¢˜æ—¶è‡ªåŠ¨æ·»åŠ ç›¸åº”çš„æ ‡ç­¾ã€‚
> 
> GitHub æä¾› Linuxã€Windows å’Œ macOS è™šæ‹Ÿæœºæ¥è¿è¡Œå·¥ä½œæµç¨‹ï¼Œæˆ–è€…åœ¨è‡ªæœ‰çš„æ•°æ®ä¸­å¿ƒæˆ–äº‘åŸºç¡€æ¶æ„ä¸­æ‰˜ç®¡è¿è¡Œå™¨ã€‚

Gitea çš„ DevOps ç”Ÿæ€
-----------------

å¾—ç›Šäºå¹¿å¤§å¼€æºç¤¾åŒºçš„æ”¯æŒï¼Œç›®å‰ Gitea å¯ä»¥è‰¯å¥½é€‚é…ä»¥ä¸‹ DevOps å·¥å…·ã€‚

*   Agola
*   AppVeyor
*   AWS Cloud Integration(webhook-to-s3)
*   buildbot-gitea
*   buildkite-connector
*   Concourse
*   Dex
*   Drone
*   Ghorg
*   gickup
*   Jenkins
*   å»ºæœ¨ CI
*   Metroline
*   Monitoring mixin
*   mvoCI
*   Renovate
*   Tea Runner
*   Woodpecker

> ç»è¿‡é•¿æœŸçš„ç¤¾åŒºäº’åŠ¨ï¼Œæˆ‘ä»¬è·å¾—äº†å¤§é‡ç¬¬ä¸‰æ–¹CIç³»ç»Ÿçš„é›†æˆæ–¹æ¡ˆã€‚ä½†æˆ‘ä»¬å§‹ç»ˆå‘ç°ï¼Œç‹¬ç«‹æ­å»ºå¹¶è¿ç»´ä¸€æ•´å¥—CIç³»ç»Ÿåªæ˜¯ä¸€å°éƒ¨åˆ†æå®¢çš„ä¸“é•¿ï¼Œå¯¹äºæ›´å¹¿æ³›çš„ç”¨æˆ·è€Œè¨€è¿™å¹¶ä¸æ˜¯ä¸ªç®€å•çš„å·¥ä½œï¼Œäºæ˜¯æˆ‘ä»¬å¼€å§‹å°è¯•ä¸ºæ­¤åŠªåŠ›ï¼Œè®©å·¥å…·æ›´å¥½åœ°ä¸ºäººæœåŠ¡ã€‚

æ‰“é€  Gitea Actions
----------------

ä¸å¯å¦è®¤ GitHub Actions æ‰“é€ äº†ä¸€å¥—å¾ˆæ£’çš„å·¥ä½œç¯å¢ƒï¼Œå®ƒçš„è®¾è®¡ç†å¿µä½¿ä»“åº“ä¸ CI å·¥å…·ä¹‹é—´æœ‰äº†æ›´åŠ ç´§å¯†çš„é›†æˆï¼Œå®ç°äº†ä»£ç å³é…ç½®ï¼ŒåŒæ—¶å¹³å°ç”¨æˆ·ä¸ºæ•´å¥—ç³»ç»Ÿæä¾›äº†ä¸°å¯Œçš„åº”ç”¨æ‰©å±•ï¼Œç›¸æ¯”ä¼ ç»Ÿæ¨¡å¼æ¥è¯´ï¼Œæ˜“ç”¨æ€§ä¸Šæ›´èƒœä¸€ç­¹ã€‚å¦‚æœèƒ½å°†å®ƒçš„ä¼˜ç‚¹ç§»æ¤åˆ° Gitea å°†æ˜¯ä»¶å¾ˆæ£’çš„äº‹æƒ…ã€‚

å¥½æ¶ˆæ¯æ˜¯ï¼Œç»è¿‡ä¸¤å¹´çš„è°ƒç ”ä¸è®¨è®ºï¼Œæˆ‘ä»¬ç»ˆäºå°† Gitea å†…ç½®CI/CDç³»ç»Ÿçš„å¼€å‘ä»»åŠ¡æä¸Šäº†æ—¥ç¨‹ã€‚ï¼ˆ[#13539](https://github.com/go-gitea/gitea/issues/13539)ï¼‰

### å¼€å‘è¿›å±•

> [https://github.com/go-gitea/gitea/issues/13539](https://github.com/go-gitea/gitea/issues/13539)

Gitea Actions å®ç°äº†ä¸€ä¸ªå†…ç½®çš„ CI/CD ç³»ç»Ÿæ¡†æ¶ï¼Œå…¼å®¹ GitHub Actions çš„ YAML å·¥ä½œæµç¼–æ’æ ¼å¼ï¼Œå…¼å®¹ GitHub Marketplace ä¸­å¤§éƒ¨åˆ†ç°æœ‰çš„ Actions æ’ä»¶ã€‚

ç³»ç»Ÿç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š

*   Gitea Actions åè®®çš„[å®šä¹‰](https://gitea.com/gitea/actions-proto-def)å’Œ [Golangå®ç°](https://gitea.com/gitea/actions-proto-go)
*   Actions Runner: åŸºäº [nektos/act](https://github.com/nektos/act/) å®ç°çš„ä»»åŠ¡å­ç³»ç»Ÿ
*   åœ¨ Gitea ä¸»ç¨‹åºä¸Šå®ç° Runner ä»»åŠ¡ç®¡ç†å’Œè°ƒåº¦æ¨¡å—

### è¿è¡Œæˆªå›¾

1.ç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥è®¿é—® Runners ç®¡ç†ç•Œé¢ï¼Œåˆ›å»ºã€ç¼–è¾‘å’Œåˆ é™¤ Runnerã€‚

![Runners ç®¡ç†ç•Œé¢](https://img2023.cnblogs.com/blog/2956540/202212/2956540-20221216185735144-1827303738.png)

2.é€šè¿‡ä»“åº“é¡¶éƒ¨çš„å¯¼èˆªæ‰“å¼€ Actionsï¼ŒæŸ¥çœ‹ CI æ„å»ºä¿¡æ¯ã€‚

![ä»“åº“ä¸‹çš„ Workflows åˆ—è¡¨](https://img2023.cnblogs.com/blog/2956540/202212/2956540-20221216185806634-746050733.png)

3.ç‚¹å‡»æŸä¸ª CI æ„å»ºç»“æœï¼ŒæŸ¥çœ‹æ—¥å¿—ã€‚

![ç‚¹å‡» Workflows æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—](https://img2023.cnblogs.com/blog/2956540/202212/2956540-20221216185829852-449815482.png)

### å°é²œä½“éªŒ

> âš  å®éªŒæ€§åŠŸèƒ½ï¼Œè¯·å‹¿ç”¨äºç”Ÿäº§ç¯å¢ƒ

#### å‡†å¤‡ç¯å¢ƒ

*   å†…å­˜ï¼šè‡³å°‘ 4GBï¼Œç”¨äºç¼–è¯‘ Gitea
*   Dockerï¼šå¯æ‰§è¡Œ docker å‘½ä»¤ï¼Œç”¨äºæ‹‰å–å’Œè¿è¡Œå®¹å™¨

#### æ­å»º

1.ç¼–è¯‘è¿è¡Œ Gitea

ä¸‹è½½å¸¦æœ‰ Actions æ¨¡å—çš„ Gitea æºä»£ç ï¼š

    # ç›®å‰å¯ä»¥ä» @wolfogre çš„å¼€å‘åˆ†æ”¯å…‹éš†å¸¦æœ‰ Actions æ¨¡å—çš„æºä»£ç åˆ°æœ¬åœ°ç¼–è¯‘ã€‚
    git clone https://github.com/wolfogre/gitea.git --branch=feature/bots
    cd gitea
    

ç¼–è¯‘æ–¹æ³•å¯ä»¥å‚è€ƒ[ä»æºä»£ç å®‰è£…](https://docs.gitea.io/zh-cn/install-from-source/)ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦å‡†å¤‡å¼€å‘ç¯å¢ƒ Node.js LTS (`nvm instal --lts`) å’Œ Golangã€‚

ä»¥ä¸‹æ˜¯æ¨èçš„æ‰“åŒ…æ–¹æ³•ï¼ˆå¸¦æœ‰SQLiteï¼Œæ–¹ä¾¿æœ¬åœ°æµ‹è¯•ï¼‰

    TAGS="bindata sqlite sqlite_unlock_notify" make build
    

å¯åŠ¨ Gitea ä¸»ç¨‹åºã€‚è¿™é‡Œå…ˆèµ°å®Œåˆå§‹åŒ–æ­¥éª¤ï¼Œä¼šç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä½äºå½“å‰ç›®å½•ä¸‹çš„

    ./custom/conf/app.ini
    

ç¼–è¾‘ä¸Šè¿°é…ç½®æ–‡ä»¶ï¼Œæ‰“å¼€ Actions åŠŸèƒ½ã€‚

    [actions]
    ENABLED = true
    

é‡æ–°å¯åŠ¨ç¨‹åºï¼š`./gitea web`

2.å¯åŠ¨ Runner

é¦–å…ˆç¼–è¯‘ `act_runner` ç¨‹åº

    git clone https://gitea.com/gitea/act_runner.git
    cd act_runner
    make build
    

ç„¶åå°† Runner æ³¨å†Œåˆ° Gitea æœåŠ¡å™¨ã€‚

*   æ–¹æ³•ä¸€ï¼šä½¿ç”¨äº¤äº’å‘½ä»¤é…ç½®

    $ ./act_runner register
    
    INFO Registering runner, arch=amd64, os=linux, version=0.1.5.
    WARN Runner in user-mode.
    INFO Enter the Gitea instance URL (for example, https://gitea.com/): [è¾“å…¥æœåŠ¡å™¨åœ°å€]
    INFO Enter the runner token: [è¾“å…¥ Runner ä»¤ç‰Œ]
    INFO Enter the runner name (if set empty, use hostname:ubuntu ): [è¾“å…¥ Runner åç§°]
    INFO Enter the runner labels, leave blank to use the default labels (comma-separated, for example, ubuntu-20.04:docker://node:16-bullseye,ubuntu-18.04:docker://node:16-buster): [è¾“å…¥ Runner æ ‡ç­¾]
    
    ...
    DEBU Successfully pinged the Gitea instance server
    INFO Runner registered successfully.
    

*   æ–¹æ³•äºŒï¼šéäº¤äº’å¼å‘½ä»¤
    *   `--no-interactive`
    *   `--instance` å¡«å†™æœåŠ¡å™¨åœ°å€
    *   `--token` å¡«å†™ç®¡ç†å‘˜ä»æœåŠ¡å™¨è·å–çš„ Actions ä»¤ç‰Œï¼ˆ`/admin/runners`ï¼‰

    ./act_runner register --instance http://<your_gitea_instance> --token <my_runner_token> --no-interactive
    

å¯åŠ¨ç¨‹åº

    ./act_runner daemon
    

3.ä¸ºä»“åº“å¯ç”¨ Actions åŠŸèƒ½

æ‚¨å¯ä»¥æ–°å»ºä¸€ä¸ªä»“åº“å¹¶æ‰‹åŠ¨å¼€å¯ä»“åº“è®¾ç½®ä¸­çš„ Actions åŠŸèƒ½ã€‚

![](https://img2023.cnblogs.com/blog/2956540/202212/2956540-20221216190134436-2076710159.png)

![å¯ç”¨ Actions åŠŸèƒ½](https://img2023.cnblogs.com/blog/2956540/202212/2956540-20221216185920682-1978990984.png)

åˆ·æ–°é¡µé¢åï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä»“åº“çš„é¡¶éƒ¨åŠŸèƒ½å¯¼èˆªæ ä¸­å¤šäº†ä¸€ä¸ª Actions åŠŸèƒ½ï¼Œç‚¹å‡» Actions è¿›å…¥å¯ä»¥çœ‹åˆ°ç›®å‰ä¸ºç©ºçš„ All Workflows ä»»åŠ¡åˆ—è¡¨ã€‚

![](https://img2023.cnblogs.com/blog/2956540/202212/2956540-20221216190004464-1714128000.png)

4.ä¸Šä¼  Workflows é…ç½®åˆ°ä»“åº“ç›®å½• `.gitea/workflows/build.yaml`ã€‚ç”±äº Gitea Actions å…¼å®¹ GitHub Actionsï¼Œå› æ­¤æ‚¨å¯ä»¥ä» GitHub æ–‡æ¡£ä¸­å¤åˆ¶ç¤ºä¾‹ã€‚å¼€å§‹å­¦ä¹ ä½¿ç”¨ Gitea Actions å§ï¼

    ğŸš€ é˜…è¯»æ–‡æ¡£
    https://docs.github.com/en/actions/quickstart
    

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå°†å®ƒä¿å­˜åˆ° `.gitea/workflows/build.yaml` æ—¶ä¼šè§¦å‘ CI å·¥ä½œï¼š

    name: Gitea Actions Demo
    run-name: ${{ github.actor }} is testing out Gitea Actions ğŸš€
    on: [push]
    jobs:
      Explore-Gitea-Actions:
        runs-on: ubuntu-latest
        steps:
          - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
          - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by Gitea!"
          - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
          - name: Check out repository code
            uses: actions/checkout@v3
          - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
          - run: echo "ğŸ–¥ï¸ The workflow is now ready to test your code on the runner."
          - name: List files in the repository
            run: |
              ls ${{ github.workspace }}
          - run: echo "ğŸ This job's status is ${{ job.status }}."
    

ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬å†æ¬¡å¯¼èˆªåˆ° Actions åŠŸèƒ½é¢æ¿ï¼Œå¯ä»¥çœ‹åˆ°åˆšåˆšåˆ›å»º Workflow å·²ç»æ‰§è¡Œå¹¶ä¸”è®°å½•ä¸‹äº†è¿è¡Œæ—¥å¿—ã€‚

![](https://img2023.cnblogs.com/blog/2956540/202212/2956540-20221216185806634-746050733.png)

5.æ£€æŸ¥ CI æ‰§è¡Œè¿‡ç¨‹äº§ç”Ÿçš„æ—¥å¿—ã€‚ä¸éš¾çœ‹å‡º Gitea Runner æ‹‰å–äº† Docker é•œåƒä½œä¸º CI æ„å»ºè¿‡ç¨‹æ‰€éœ€çš„åŸºç¡€ç¯å¢ƒã€‚

![](https://img2023.cnblogs.com/blog/2956540/202212/2956540-20221216190105074-1283893610.png)

6.ä» GitHub æ–‡æ¡£ä¸­äº†è§£æ›´å¤š Actions ç”¨æ³•ï¼ŒåŒæ—¶å¯ä»¥ä¸ºæˆ‘ä»¬æå‡ºæ”¹è¿›æ„è§!

    ğŸ¤– Implement actions
    https://github.com/go-gitea/gitea/pull/21937
    
    ğŸ”§ GitHub Actions
    https://docs.github.com/zh/actions/using-workflows