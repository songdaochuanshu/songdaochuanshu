---
layout: post
title: "Blazorç»„ä»¶è‡ªåšåä¸‰: VideoPlayer è§†é¢‘æ’­æ”¾å™¨"
date: "2022-12-15T05:15:35.950Z"
---
Blazorç»„ä»¶è‡ªåšåä¸‰: VideoPlayer è§†é¢‘æ’­æ”¾å™¨
===============================

Video.js æ˜¯ä¸€ä¸ªå…·æœ‰å¤§é‡åŠŸèƒ½çš„æµè¡Œçš„è§†é¢‘å’ŒéŸ³é¢‘ JavaScript åº“,ä»Šå¤©æˆ‘ä»¬è¯•è¯•é›†æˆåˆ° Blazor .

Blazor VideoPlayer è§†é¢‘æ’­æ”¾å™¨ ç»„ä»¶ [![nuget](https://img.shields.io/nuget/v/BootstrapBlazor.VideoPlayer.svg?style=flat-square)](https://www.nuget.org/packages/BootstrapBlazor.VideoPlayer#readme-body-tab)
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

#### ç¤ºä¾‹

[https://blazor.app1.es/videoPlayers](https://blazor.app1.es/videoPlayers)

#### 1\. æ–°å»ºå·¥ç¨‹b13video

    dotnet new blazorserver -o b13video
    

#### 2\. å°†é¡¹ç›®æ·»åŠ åˆ°è§£å†³æ–¹æ¡ˆä¸­ï¼š

    dotnet sln add b13video/b13video.csproj
    

#### 3\. `Pages\_Host.cshtml` å¼•ç”¨ `video-js.css`

    <link href="//vjs.zencdn.net/7.10.2/video-js.min.css" rel="stylesheet">
    

#### 4\. æ¥ä¸‹æ¥ï¼Œ`Pages\_Host.cshtml` å¼•ç”¨ `Video.js`, æ·»åŠ ä»¥ä¸‹è„šæœ¬æ–‡ä»¶åˆ°`Pages\_Host.cshtml`

    <script src="https://vjs.zencdn.net/7.10.2/video.js"></script>
    
    <script src="https://unpkg.com/video.js/dist/video.min.js"></script>
    <script src="https://unpkg.com/@@videojs/http-streaming/dist/videojs-http-streaming.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-youtube/2.6.1/Youtube.min.js"></script>
    

#### 5\. æ·»åŠ  app.js æ–‡ä»¶åˆ° `wwwroot`æ–‡ä»¶å¤¹

æ–‡ä»¶å†…å®¹

    function loadPlayer(id, options) {
      videojs(id, options);
    }
    

#### 6\. `Pages\_Host.cshtml` å¼•ç”¨ `app.js`

    <script src="./app.js"></script>
    

å®Œæ•´æ–‡ä»¶çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·

    @page "/"
    @using Microsoft.AspNetCore.Components.Web
    @namespace b13video.Pages
    @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
    
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <base href="~/" />
        <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
        <link href="css/site.css" rel="stylesheet" />
        <link href="b13video.styles.css" rel="stylesheet" />
        <link rel="icon" type="image/png" href="favicon.png" />
        <link href="//vjs.zencdn.net/7.10.2/video-js.min.css" rel="stylesheet">
        <component type="typeof(HeadOutlet)" render-mode="ServerPrerendered" />
    </head>
    <body>
        <component type="typeof(App)" render-mode="ServerPrerendered" />
    
        <div id="blazor-error-ui">
            <environment include="Staging,Production">
                An error has occurred. This application may no longer respond until reloaded.
            </environment>
            <environment include="Development">
                An unhandled exception has occurred. See browser dev tools for details.
            </environment>
            <a href="" class="reload">Reload</a>
            <a class="dismiss">ğŸ—™</a>
        </div>
    
        <script src="_framework/blazor.server.js"></script>
    
        <script src="https://unpkg.com/video.js/dist/video.min.js"></script>
        <script src="https://unpkg.com/@@videojs/http-streaming/dist/videojs-http-streaming.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-youtube/2.6.1/Youtube.min.js"></script>
        <script src="./app.js"></script>
    </body>
    </html>
    

#### 7\. Razor é¡µé¢, æˆ‘ä»¬ç›´æ¥åœ¨ `Index.razor` é‡Œæ·»åŠ 

    <video id="my-player"
           class="video-js"
           controls
           preload="auto"
           poster="//vjs.zencdn.net/v/oceans.png"
           data-setup='{}'>
        <source src="//vjs.zencdn.net/v/oceans.mp4" type="video/mp4" />
        <source src="//vjs.zencdn.net/v/oceans.webm" type="video/webm" />
        <source src="//vjs.zencdn.net/v/oceans.ogv" type="video/ogg" />
        <p class="vjs-no-js">
            To view this video please enable JavaScript, and consider upgrading to a
            web browser that
            <a href="https://videojs.com/html5-video-support/" target="_blank">
                supports HTML5 video
            </a>
        </p>
    </video>
    

#### è·‘ä¸€ä¸‹

![](https://img2023.cnblogs.com/blog/1980213/202212/1980213-20221214040705591-405490728.png)

#### 8\. å°è£…

å–æ¶ˆå‡ è¡Œhtmlç»„ä»¶è®¾å®š,æ”¹ä¸ºc#æä¾›å‚æ•°, æœ€ç»ˆä»£ç å¦‚ä¸‹

    <video id="my-player"
           class="video-js"
           muted >
        <p class="vjs-no-js">
            To view this video please enable JavaScript, and consider upgrading to a
            web browser that
    @ -17,3 +14,27 @@
            </a>
        </p>
    </video>
    

    @inject IJSRuntime jsRuntime
    @code{
        protected override async Task OnAfterRenderAsync(bool firstRender)
        {
            if (firstRender)
            {
                await jsRuntime.InvokeVoidAsync("loadPlayer", "my-player", new
                {
                    width = 600,
                    height = 300,
                    controls = true,
                    autoplay = true,
                    preload = "auto",
                    poster = "//vjs.zencdn.net/v/oceans.png",
                    sources = new[] {
                            new { type =  "application/x-mpegURL", src = "https://d2zihajmogu5jn.cloudfront.net/bipbop-advanced/bipbop_16x9_variant.m3u8"},
                            new { type =  "video/mp4", src = "//vjs.zencdn.net/v/oceans.mp4"}
                    }
                });
            }
        }
    
    }
    

è°ƒè¯•ä¸€ä¸‹,æˆåŠŸè¿è¡Œå°±è¿›å…¥ä¸‹ä¸€æ­¥.

#### 9\. ç»„ä»¶åŒ–. {æœ€ç»ˆä»£ç ,è¯·å¤§å®¶ç›´æ¥ä½¿ç”¨CVå¤§æ³•}

**Pages\\VideoPlayer.razor**

    @inject IJSRuntime jsRuntime
    @namespace Blazor100.Components
    
    <div @ref="element">
        <video id="video_@Id"
               class="video-js"
               muted
               webkit-playsinline
               playsinline
               x-webkit-airplay="allow"
               x5-video-player-type="h5"
               x5-video-player-fullscreen="true"
               x5-video-orientation="portraint">
            <p class="vjs-no-js">
                To view this video please enable JavaScript, and consider upgrading to a
                web browser that
                <a href="https://videojs.com/html5-video-support/" target="_blank">
                    supports HTML5 video
                </a>
            </p>
        </video>
        @if (Debug)
        {
            <pre>@info</pre>
        }
    </div>
    

**Pages\\VideoPlayer.razor.cs**

    using b13video.Pages;
    using Microsoft.AspNetCore.Components;
    using Microsoft.Extensions.Options;
    using Microsoft.JSInterop;
    using System.Text.Json.Serialization;
    using static System.Runtime.InteropServices.JavaScript.JSType;
    
    namespace Blazor100.Components; 
    
    public partial class VideoPlayer : IAsyncDisposable
    {
        [Inject] IJSRuntime? JS { get; set; }
        private IJSObjectReference? module;
        private DotNetObjectReference<VideoPlayer>? instance { get; set; }
        protected ElementReference element { get; set; }
        private bool init;
        private string? info;
    
        private string Id { get; set; } = Guid.NewGuid().ToString();
    
        /// <summary>
        /// èµ„æºç±»å‹
        /// </summary>
        [Parameter]
        public string? SourcesType { get; set; }
    
        /// <summary>
        /// èµ„æºåœ°å€
        /// </summary>
        [Parameter]
        public string? SourcesUrl { get; set; }
    
        [Parameter]
        public int Width { get; set; } = 300;
    
        [Parameter]
        public int Height { get; set; } = 200;
    
        [Parameter]
        public bool Controls { get; set; } = true;
    
        [Parameter]
        public bool Autoplay { get; set; } = true;
    
        [Parameter]
        public string Preload { get; set; } = "auto";
    
        /// <summary>
        /// è®¾ç½®å°é¢
        /// </summary>
        [Parameter]
        public string? Poster { get; set; }
    
        [Parameter]
        public VideoPlayerOption? Option { get; set; }
    
        [Parameter]
        public bool Debug { get; set; }
    
        protected override async Task OnAfterRenderAsync(bool firstRender)
        {
            try
            {
                if (firstRender)
                {
                    module = await JS!.InvokeAsync<IJSObjectReference>("import", "./app.js");
                    instance = DotNetObjectReference.Create(this);
    
                    Option = Option ?? new VideoPlayerOption()
                    {
                        Width = Width,
                        Height = Height,
                        Controls = Controls,
                        Autoplay = Autoplay,
                        Preload = Preload,
                        Poster = Poster,
                        //EnableSourceset= true,
                        //TechOrder= "['fakeYoutube', 'html5']"
                    };
                    Option.Sources.Add(new VideoSources(SourcesType, SourcesUrl));
    
                    try
                    {
                        await module.InvokeVoidAsync("loadPlayer", instance, "video_" + Id, Option);
                    }
                    catch (Exception e)
                    {
                        info = e.Message;
                        if (Debug) StateHasChanged();
                        Console.WriteLine(info);
                        if (OnError != null) await OnError.Invoke(info);
                    }
                }
            }
            catch (Exception e)
            {
                if (OnError != null) await OnError.Invoke(e.Message);
            }
        }
    
        async ValueTask IAsyncDisposable.DisposeAsync()
        {
            if (module is not null)
            {
                await module.InvokeVoidAsync("destroy", Id);
                await module.DisposeAsync();
            }
        }
    
    
        /// <summary>
        /// è·å¾—/è®¾ç½® é”™è¯¯å›è°ƒæ–¹æ³•
        /// </summary>
        [Parameter]
        public Func<string, Task>? OnError { get; set; }
    
        /// <summary>
        /// JSå›è°ƒæ–¹æ³•
        /// </summary>
        /// <param name="init"></param>
        /// <returns></returns>
        [JSInvokable]
        public void GetInit(bool init) => this.init = init;
    
        /// <summary>
        /// JSå›è°ƒæ–¹æ³•
        /// </summary>
        /// <param name="error"></param>
        /// <returns></returns>
        [JSInvokable]
        public async Task GetError(string error)
        {
            info = error;
            if (Debug) StateHasChanged();
            if (OnError != null) await OnError.Invoke(error);
        }
    
    }
    

**Pages\\VideoPlayerOption.cs**

    using System.Text.Json.Serialization;
    
    namespace b13video.Pages
    {
        public class VideoPlayerOption
        {
            [JsonPropertyName("width")]
            public int Width { get; set; } = 300;
    
            [JsonPropertyName("height")]
            public int Height { get; set; } = 200;
    
            [JsonPropertyName("controls")]
            public bool Controls { get; set; } = true;
    
            [JsonPropertyName("autoplay")]
            public bool Autoplay { get; set; } = true;
    
            [JsonPropertyName("preload")]
            public string Preload { get; set; } = "auto";
    
            /// <summary>
            /// æ’­æ”¾èµ„æº
            /// </summary>
            [JsonPropertyName("sources")]
            public List<VideoSources> Sources { get; set; } = new List<VideoSources>();
    
            /// <summary>
            /// è®¾ç½®å°é¢
            /// </summary>
            [JsonPropertyName("poster")]
            public string? Poster { get; set; } 
    
            //[JsonPropertyName("enableSourceset")]
            //public bool EnableSourceset { get; set; }
    
            //[JsonPropertyName("techOrder")]
            //public string? TechOrder { get; set; } = "['html5', 'flash']";
    
    
        }
    
    
        /// <summary>
        /// æ’­æ”¾èµ„æº
        /// </summary>
        public class VideoSources
        {
            public VideoSources() { }
    
            public VideoSources(string? type, string? src)
            {
                this.Type = type ?? throw new ArgumentNullException(nameof(type));
                this.Src = src ?? throw new ArgumentNullException(nameof(src));
            }
    
            /// <summary>
            /// èµ„æºç±»å‹<para></para>video/mp4<para></para>application/x-mpegURL<para></para>video/youtube
            /// </summary>
            [JsonPropertyName("type")]
            public string Type { get; set; } = "application/x-mpegURL";
    
            /// <summary>
            /// èµ„æºåœ°å€
            /// </summary>
            [JsonPropertyName("src")]
            public string Src { get; set; } = "application/x-mpegURL";
        } 
    }
    
    

**wwwroot\\app.js**

    var player = null;
    
    export function loadPlayer(instance, id, options) {
        console.log('player id', id);
        player = videojs(id, options);
    
        player.ready(function () {
           console.log('player.ready');
           var promise = player.play();
    
            if (promise !== undefined) {
                promise.then(function () {
                    console.log('Autoplay started!');
                }).catch(function (error) {
                    console.log('Autoplay was prevented.', error);
                    instance.invokeMethodAsync('GetError', 'Autoplay was prevented.'+ error);
                });
            }
            instance.invokeMethodAsync('GetInit', true);
        });
    
        return false;
    }
    
    export function destroy(id) {
        if (undefined !== player && null !== player) {
            player = null;
            console.log('destroy');
        }
    }
    

#### 10\. é¡µé¢è°ƒç”¨

    <div class="row">
    
        <div class="col-4">
            <VideoPlayer SourcesType="application/x-mpegURL" SourcesUrl="https://d2zihajmogu5jn.cloudfront.net/bipbop-advanced/bipbop_16x9_variant.m3u8" Debug="true" />
        </div>
        <div class="col-4">
            <VideoPlayer SourcesType="video/mp4" SourcesUrl="//vjs.zencdn.net/v/oceans.mp4" />
        </div>
        <div class="col-4">
            <VideoPlayer SourcesType="application/x-mpegURL" SourcesUrl="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" />
        </div>
    </div>
    

#### é¡¹ç›®æºç 

[Github](https://github.com/densen2014/Blazor100/tree/master/b13video)

#### çŸ¥è¯†å…±äº«è®¸å¯åè®®

æœ¬ä½œå“é‡‡ç”¨ [çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®](https://creativecommons.org/licenses/by-nc-sa/4.0/) è¿›è¡Œè®¸å¯ã€‚æ¬¢è¿è½¬è½½ã€ä½¿ç”¨ã€é‡æ–°å‘å¸ƒï¼Œä½†åŠ¡å¿…ä¿ç•™æ–‡ç« ç½²åAlexChowï¼ˆåŒ…å«é“¾æ¥ï¼š [https://github.com/densen2014](https://github.com/densen2014) ï¼‰ï¼Œä¸å¾—ç”¨äºå•†ä¸šç›®çš„ï¼ŒåŸºäºæœ¬æ–‡ä¿®æ”¹åçš„ä½œå“åŠ¡å¿…ä»¥ç›¸åŒçš„è®¸å¯å‘å¸ƒã€‚å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·[ä¸æˆ‘è”ç³»](zhouchuanglin@gmail.com) ã€‚

#### AlexChow

[ä»Šæ—¥å¤´æ¡](https://www.toutiao.com/c/user/token/MS4wLjABAAAAGMBzlmgJx0rytwH08AEEY8F0wIVXB2soJXXdUP3ohAE/?) | [åšå®¢å›­](https://www.cnblogs.com/densen2014) | [çŸ¥ä¹](https://www.zhihu.com/people/alex-chow-54) | [Gitee](https://gitee.com/densen2014) | [GitHub](https://github.com/densen2014)

![image](https://img2023.cnblogs.com/blog/1980213/202212/1980213-20221204072348577-1104876252.png)

* * *

#### Blazor ç»„ä»¶

[æ¡ç æ‰«æ ZXingBlazor](https://www.nuget.org/packages/ZXingBlazor#readme-body-tab)  
[![nuget](https://img.shields.io/nuget/v/ZXingBlazor.svg?style=flat-square)](https://www.nuget.org/packages/ZXingBlazor)  
[![stats](https://img.shields.io/nuget/dt/ZXingBlazor.svg?style=flat-square)](https://www.nuget.org/stats/packages/ZXingBlazor?groupby=Version)

[å›¾ç‰‡æµè§ˆå™¨ Viewer](https://www.nuget.org/packages/BootstrapBlazor.Viewer#readme-body-tab)

[æ¡ç æ‰«æ BarcodeScanner](Densen.Component.Blazor/BarcodeScanner.md)

[æ‰‹å†™ç­¾å Handwritten](Densen.Component.Blazor/Handwritten.md)

[æ‰‹å†™ç­¾å SignaturePad](https://www.nuget.org/packages/BootstrapBlazor.SignaturePad#readme-body-tab)

[å®šä½/æŒç»­å®šä½ Geolocation](https://www.nuget.org/packages/BootstrapBlazor.Geolocation#readme-body-tab)

[å±å¹•é”®ç›˜ OnScreenKeyboard](https://www.nuget.org/packages/BootstrapBlazor.OnScreenKeyboard#readme-body-tab)

[ç™¾åº¦åœ°å›¾ BaiduMap](https://www.nuget.org/packages/BootstrapBlazor.BaiduMap#readme-body-tab)

[è°·æ­Œåœ°å›¾ GoogleMap](https://www.nuget.org/packages/BootstrapBlazor.Maps#readme-body-tab)

[è“ç‰™å’Œæ‰“å° Bluetooth](https://www.nuget.org/packages/BootstrapBlazor.Bluetooth#readme-body-tab)

[PDFé˜…è¯»å™¨ PdfReader](https://www.nuget.org/packages/BootstrapBlazor.PdfReader#readme-body-tab)

[æ–‡ä»¶ç³»ç»Ÿè®¿é—® FileSystem](https://www.nuget.org/packages/BootstrapBlazor.FileSystem#readme-body-tab)

[å…‰å­¦å­—ç¬¦è¯†åˆ« OCR](https://www.nuget.org/packages/BootstrapBlazor.OCR#readme-body-tab)

[ç”µæ± ä¿¡æ¯/ç½‘ç»œä¿¡æ¯ WebAPI](https://www.nuget.org/packages/BootstrapBlazor.WebAPI#readme-body-tab)

æœ¬æ–‡æ¥è‡ªåšå®¢å›­ï¼Œä½œè€…ï¼šå‘¨åˆ›ç³ [AlexChow](https://www.cnblogs.com/densen2014/)ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼š[https://www.cnblogs.com/densen2014/p/16981092.html](https://www.cnblogs.com/densen2014/p/16981092.html)