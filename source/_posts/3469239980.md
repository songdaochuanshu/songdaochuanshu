---
layout: post
title: "Luffy /4/ å¤šæ–¹å¼ç™»å½•æ¥å£&ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢"
date: "2022-04-24T23:18:08.016Z"
---
Luffy /4/ å¤šæ–¹å¼ç™»å½•æ¥å£&ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢
==========================

![Luffy /4/ å¤šæ–¹å¼ç™»å½•æ¥å£&amp;ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢](https://img2022.cnblogs.com/blog/2608072/202204/2608072-20220424234502713-1716235551.png) å¤šæ–¹å¼ç™»å½•æ¥å£&ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢&å‘é€çŸ­ä¿¡æ¥å£

ç›®å½•

*   [Luffy /4/ å¤šæ–¹å¼ç™»å½•æ¥å£&ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢](#luffy-4-å¤šæ–¹å¼ç™»å½•æ¥å£ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢)
    *   [è…¾è®¯äº‘çŸ­ä¿¡](#è…¾è®¯äº‘çŸ­ä¿¡)
    *   [ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢](#ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢)
        *   [å¦‚ä½•å®ç°ç‚¹å‡»ç™»å½•æˆ–å›¾ç‰‡è¿›è¡Œè·³è½¬](#å¦‚ä½•å®ç°ç‚¹å‡»ç™»å½•æˆ–å›¾ç‰‡è¿›è¡Œè·³è½¬)
        *   [ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢å®ç°](#ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢å®ç°)
            *   [**Login.vue**](#loginvue)
            *   [**Register.vue**](#registervue)
            *   [**Header.vue**](#headervue)
    *   [æ¥å£å®ç°1](#æ¥å£å®ç°1)
        *   [éªŒè¯æ‰‹æœºå·æ˜¯å¦å­˜åœ¨æ¥å£](#éªŒè¯æ‰‹æœºå·æ˜¯å¦å­˜åœ¨æ¥å£)
        *   [å¤šæ–¹å¼ç™»å½•æ¥å£](#å¤šæ–¹å¼ç™»å½•æ¥å£)
    *   [æ¥å£å®ç°2](#æ¥å£å®ç°2)
        *   [**é…ç½®å‘é€çŸ­ä¿¡**](#é…ç½®å‘é€çŸ­ä¿¡)
        *   [å‘é€çŸ­ä¿¡æ¥å£](#å‘é€çŸ­ä¿¡æ¥å£)

Luffy /4/ å¤šæ–¹å¼ç™»å½•æ¥å£&ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢
==========================

**ç°åœ¨æ¯”è¾ƒå¸¸è§çš„ç™»å½•æ–¹å¼ï¼šæ‰‹æœºå·+éªŒè¯ç ï¼Œé‚®ç®±+å¯†ç ï¼Œç”¨æˆ·å+å¯†ç ï¼Œä¸‹é¢å®ç°ä¸€ä¸‹å¤šæ–¹å¼ç™»å½•æ¥å£**

**éœ€æ±‚æ¥å£**

    # ç™»é™†å’Œæ³¨å†ŒåŠŸèƒ½--->5ä¸ªæ¥å£
    -å¤šæ–¹å¼ç™»é™†æ¥å£(æ‰‹æœºå·ï¼Œé‚®ç®±ï¼Œç”¨æˆ·å +å¯†ç )
    -éªŒè¯æ‰‹æœºå·æ˜¯å¦å­˜åœ¨æ¥å£
      
    -å‘é€çŸ­ä¿¡éªŒè¯ç æ¥å£ # å€ŸåŠ©äºç¬¬ä¸‰æ–¹å‘é€çŸ­ä¿¡ï¼šé˜¿é‡Œï¼Œè…¾è®¯ï¼Œå®¹è”äº‘é€šè®¯ï¼Œåˆšæ³¨å†Œä¼šé€100æ¡çŸ­ä¿¡
    -æ‰‹æœºå·+éªŒè¯ç ç™»é™†æ¥å£
    -æ‰‹æœºå·+éªŒè¯ç +å¯†ç æ³¨å†Œæ¥å£
    

è…¾è®¯äº‘çŸ­ä¿¡
-----

è¿™é‡Œçš„çŸ­ä¿¡åŠŸèƒ½ä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹è…¾è®¯äº‘ï¼Œæ³¨å†Œå…¬ä¼—å·ç”³è¯·è…¾è®¯äº‘çŸ­ä¿¡åŠŸèƒ½ï¼Œä¼šé€100æ¡çŸ­ä¿¡ä¾›ä½ ç©ï¼›

ç”³è¯·å¥½å…¬ä¼—å·ï¼Œé€šè¿‡è¯¥åœ°å€https://console.cloud.tencent.com/smsv2/guideï¼Œè®¾ç½®

    """
    åˆ›å»ºçŸ­ä¿¡ç­¾å
    	-ç­¾åç®¡ç†---ã€‹åˆ›å»ºç­¾å--ã€‹ä½¿ç”¨å…¬ä¼—å·æäº¤ç”³è¯·---ã€‹å®¡æ ¸
    åˆ›å»ºçŸ­ä¿¡æ­£æ–‡æ¨¡æ¿
    	-æ­£æ–‡æ¨¡æ¿ç®¡ç†---ã€‹åˆ›å»ºæ­£æ–‡æ¨¡æ¿--ã€‹ç­‰å®¡æ ¸
    å‘é€çŸ­ä¿¡
    	-APIï¼ŒSDK
    """
    

ğŸ‘‰[å®˜ç½‘æ–‡æ¡£](https://cloud.tencent.com/document/product/382/43196)

**APIå’ŒSDKåŒºåˆ«**

    -APIæ¥å£ï¼Œé€šè¿‡HTTPè°ƒç”¨è…¾è®¯äº‘å‘é€çŸ­ä¿¡æ¥å£ï¼Œè…¾è®¯è´Ÿè´£æŠŠçŸ­ä¿¡å‘é€åˆ°æ‰‹æœºä¸Šï¼ŒHTTPæ¥å£åŸºäºå®ƒæ¥å†™ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦æˆ‘ä»¬å¤„ç†è¯·æ±‚å‚æ•°ï¼Œæˆ–è€…æºå¸¦å¾ˆå¤šå‚æ•°Â·Â·Â·
    
    -SDKï¼šç¬¬ä¸‰æ–¹ä½¿ç”¨ä¸åŒè¯­è¨€å°è£…å¥½äº†ï¼Œåªéœ€ä¸‹è½½å¯¼å…¥ï¼Œè°ƒç”¨å‡½æ•°å¤„ç†å³å¯
    

**ä½¿ç”¨SDK**

    # å‘çŸ­ä¿¡sdkçš„ä½¿ç”¨
    # 3.xçš„å‘é€çŸ­ä¿¡sdkï¼Œtencentcloud åŒ…å«çš„åŠŸèƒ½æ›´å¤š
    pip install tencentcloud-sdk-python
    # 2.xå‘é€çŸ­ä¿¡sdkï¼šhttps://cloud.tencent.com/document/product/382/11672
    # åªæ˜¯å‘çŸ­ä¿¡çš„sdkï¼ŒåŠŸèƒ½å°‘ï¼Œpy3.8ä»¥åä¸æ”¯æŒ
    pip install qcloudsms_py
    

ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢
--------

åœ¨å®ç°é¡µé¢å‰æˆ‘ä»¬æ€è€ƒå¦‚ä¸‹é—®é¢˜ï¼š

### å¦‚ä½•å®ç°ç‚¹å‡»ç™»å½•æˆ–å›¾ç‰‡è¿›è¡Œè·³è½¬

    # æ€è·¯ï¼šä½¿ç”¨vue-routerå®ç°é¡µé¢è·³è½¬ï¼Œè·³è½¬å°±æ¶‰åŠåˆ°è·¯ç”±ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠŠè·¯ç”±é…ç½®å¥½
    
    1.router/index.jsä¸­é…ç½®è¦è·³è½¬çš„è·¯ç”±ï¼Œè¿™é‡Œç™»å½•ä¸¾ä¾‹ï¼Œå†™ä¸€ä¸ªLoginç»„ä»¶(ç™»å½•é¡µé¢)ï¼Œç„¶ååœ¨index.jså¯¼å…¥ä½¿ç”¨ï¼šimport Login from "@/views/Login";
    """
    {
            path: '/login',
            name: 'login',
            component: Login
        }
    """
    2. è®¿é—®/loginè·¯å¾„å°±èƒ½å¤Ÿè·³è½¬åˆ°ç™»å½•é¡µé¢ç»„ä»¶
        
        
    # å®ç°ç‚¹å‡»è·³è½¬çš„ä¸¤ç§å¸¸ç”¨æ–¹æ³•
    ## æ–¹æ³•ä¸€ï¼šç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œå®ç°ç‚¹å‡»è·³è½¬
       this.$router.push('/login')
    ## æ–¹æ³•äºŒï¼šä½¿ç”¨ <router-link to=""></router-link>æ ‡ç­¾å®ç°è·³è½¬
      æ³¨å†Œï¼š<router-link to="/login"><span>æ³¨å†Œ</span></router-link>
      å›¾ç‰‡ï¼š<router-link to="/">
             <img src="../assets/img/head-logo.svg" alt="">
            </router-link>  
    

**`<router-link to=""></router-link>`æ ‡ç­¾å®ç°è·³è½¬ç¬¬ä¸‰æ–¹**

**æ•°æ®åº“æ·»åŠ ç¬¬ä¸‰æ–¹link**

![image-20220424202619568](https://s2.loli.net/2022/04/24/Eli4rvs5F6JCDUA.png)

**demo**

    <!--  è·³ç¬¬ä¸‰æ–¹  -->
    <!--å¦‚æœå›¾ç‰‡çš„è·³è½¬è·¯å¾„ä¸åŒ…å«httpï¼Œé‚£ä¹ˆå°±è·³è½¬æœ¬åœ° -->
    <div v-if="!(item.link.indexOf('http')>-1)">
    	<router-link :to="item.link">
            <img :src="item.image" alt="è¯¾ç¨‹å›¾">
         </router-link>
    </div>
    <!-- å¦‚æœå›¾ç‰‡åŒ…å«äº†httpé‚£ä¹ˆå°±è·³è½¬ç¬¬ä¸‰æ–¹ -->
    <div v-else>
    	<a :href="item.link"> 
        <img :src="item.image" alt="è¯¾ç¨‹å›¾">
        </a>
    </div>
    

**å¦‚æœä¸è¿›è¡Œå¤„ç†ï¼Œ`router-link`æ ‡ç­¾åªèƒ½è·³è½¬æœ¬åœ°ï¼Œå¦‚æœæƒ³è¦è·³è½¬ç¬¬ä¸‰æ–¹(ç™¾åº¦ï¼Œåšå®¢Â·Â·Â·)éœ€è¦è¿›ä¸€æ­¥å¤„ç†ï¼**

  

### ç™»å½•æ³¨å†Œå‰ç«¯é¡µé¢å®ç°

å®ç°çš„æ ·å¼æ˜¯åŸºäºå¼¹å‡ºæ¡†å®ç°ï¼Œå¼¹å‡ºçš„æ˜¯æ¨¡æ€æ¡†

#### **Login.vue**

    <template>
        <div class="login">
            <div class="box">
                <i class="el-icon-close" @click="close_login"></i>
                <div class="content">
                    <div class="nav">
                        <span :class="{active: login_method === 'is_pwd'}"
                              @click="change_login_method('is_pwd')">å¯†ç ç™»å½•</span>
                        <span :class="{active: login_method === 'is_sms'}"
                              @click="change_login_method('is_sms')">çŸ­ä¿¡ç™»å½•</span>
                    </div>
                    <el-form v-if="login_method === 'is_pwd'">
                        <el-input
                                placeholder="ç”¨æˆ·å/æ‰‹æœºå·/é‚®ç®±"
                                prefix-icon="el-icon-user"
                                v-model="username"
                                clearable>
                        </el-input>
                        <el-input
                                placeholder="å¯†ç "
                                prefix-icon="el-icon-key"
                                v-model="password"
                                clearable
                                show-password>
                        </el-input>
                        <el-button type="primary">ç™»å½•</el-button>
                    </el-form>
                    <el-form v-if="login_method === 'is_sms'">
                        <el-input
                                placeholder="æ‰‹æœºå·"
                                prefix-icon="el-icon-phone-outline"
                                v-model="mobile"
                                clearable
                                @blur="check_mobile">
                        </el-input>
                        <el-input
                                placeholder="éªŒè¯ç "
                                prefix-icon="el-icon-chat-line-round"
                                v-model="sms"
                                clearable>
                            <template slot="append">
                                <span class="sms" @click="send_sms">{{ sms_interval }}</span>
                            </template>
                        </el-input>
                        <el-button type="primary">ç™»å½•</el-button>
                    </el-form>
                    <div class="foot">
                        <span @click="go_register">ç«‹å³æ³¨å†Œ</span>
                    </div>
                </div>
            </div>
        </div>
    </template>
    
    <script>
        export default {
            name: "Login",
            data() {
                return {
                    username: '',
                    password: '',
                    mobile: '',
                    sms: '',
                    login_method: 'is_pwd',
                    sms_interval: 'è·å–éªŒè¯ç ',
                    is_send: false,
                }
            },
            methods: {
                close_login() {
                    this.$emit('close')
                },
                go_register() {
                    this.$emit('go')
                },
                change_login_method(method) {
                    this.login_method = method;
                },
                check_mobile() {
                    if (!this.mobile) return;
                    if (!this.mobile.match(/^1[3-9][0-9]{9}$/)) {
                        this.$message({
                            message: 'æ‰‹æœºå·æœ‰è¯¯',
                            type: 'warning',
                            duration: 1000,
                            onClose: () => {
                                this.mobile = '';
                            }
                        });
                        return false;
                    }
                    this.is_send = true;
                },
                send_sms() {
    
                    if (!this.is_send) return;
                    this.is_send = false;
                    let sms_interval_time = 60;
                    this.sms_interval = "å‘é€ä¸­...";
                    let timer = setInterval(() => {
                        if (sms_interval_time <= 1) {
                            clearInterval(timer);
                            this.sms_interval = "è·å–éªŒè¯ç ";
                            this.is_send = true; // é‡æ–°å›å¤ç‚¹å‡»å‘é€åŠŸèƒ½çš„æ¡ä»¶
                        } else {
                            sms_interval_time -= 1;
                            this.sms_interval = `${sms_interval_time}ç§’åå†å‘`;
                        }
                    }, 1000);
                }
            }
        }
    </script>
    
    <style scoped>
        .login {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.3);
        }
    
        .box {
            width: 400px;
            height: 420px;
            background-color: white;
            border-radius: 10px;
            position: relative;
            top: calc(50vh - 210px);
            left: calc(50vw - 200px);
        }
    
        .el-icon-close {
            position: absolute;
            font-weight: bold;
            font-size: 20px;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
    
        .el-icon-close:hover {
            color: darkred;
        }
    
        .content {
            position: absolute;
            top: 40px;
            width: 280px;
            left: 60px;
        }
    
        .nav {
            font-size: 20px;
            height: 38px;
            border-bottom: 2px solid darkgrey;
        }
    
        .nav > span {
            margin: 0 20px 0 35px;
            color: darkgrey;
            user-select: none;
            cursor: pointer;
            padding-bottom: 10px;
            border-bottom: 2px solid darkgrey;
        }
    
        .nav > span.active {
            color: black;
            border-bottom: 3px solid black;
            padding-bottom: 9px;
        }
    
        .el-input, .el-button {
            margin-top: 40px;
        }
    
        .el-button {
            width: 100%;
            font-size: 18px;
        }
    
        .foot > span {
            float: right;
            margin-top: 20px;
            color: orange;
            cursor: pointer;
        }
    
        .sms {
            color: orange;
            cursor: pointer;
            display: inline-block;
            width: 70px;
            text-align: center;
            user-select: none;
        }
    </style>
    

#### **Register.vue**

    <template>
        <div class="register">
            <div class="box">
                <i class="el-icon-close" @click="close_register"></i>
                <div class="content">
                    <div class="nav">
                        <span class="active">æ–°ç”¨æˆ·æ³¨å†Œ</span>
                    </div>
                    <el-form>
                        <el-input
                                placeholder="æ‰‹æœºå·"
                                prefix-icon="el-icon-phone-outline"
                                v-model="mobile"
                                clearable
                                @blur="check_mobile">
                        </el-input>
                        <el-input
                                placeholder="å¯†ç "
                                prefix-icon="el-icon-key"
                                v-model="password"
                                clearable
                                show-password>
                        </el-input>
                        <el-input
                                placeholder="éªŒè¯ç "
                                prefix-icon="el-icon-chat-line-round"
                                v-model="sms"
                                clearable>
                            <template slot="append">
                                <span class="sms" @click="send_sms">{{ sms_interval }}</span>
                            </template>
                        </el-input>
                        <el-button type="primary">æ³¨å†Œ</el-button>
                    </el-form>
                    <div class="foot">
                        <span @click="go_login">ç«‹å³ç™»å½•</span>
                    </div>
                </div>
            </div>
        </div>
    </template>
    
    <script>
        export default {
            name: "Register",
            data() {
                return {
                    mobile: '',
                    password: '',
                    sms: '',
                    sms_interval: 'è·å–éªŒè¯ç ',
                    is_send: false,
                }
            },
            methods: {
                close_register() {
                    this.$emit('close', false)
                },
                go_login() {
                    this.$emit('go')
                },
                check_mobile() {
                    if (!this.mobile) return;
                    if (!this.mobile.match(/^1[3-9][0-9]{9}$/)) {
                        this.$message({
                            message: 'æ‰‹æœºå·æœ‰è¯¯',
                            type: 'warning',
                            duration: 1000,
                            onClose: () => {
                                this.mobile = '';
                            }
                        });
                        return false;
                    }
                    this.is_send = true;
                },
                send_sms() {
                    if (!this.is_send) return;
                    this.is_send = false;
                    let sms_interval_time = 60;
                    this.sms_interval = "å‘é€ä¸­...";
                    let timer = setInterval(() => {
                        if (sms_interval_time <= 1) {
                            clearInterval(timer);
                            this.sms_interval = "è·å–éªŒè¯ç ";
                            this.is_send = true; // é‡æ–°å›å¤ç‚¹å‡»å‘é€åŠŸèƒ½çš„æ¡ä»¶
                        } else {
                            sms_interval_time -= 1;
                            this.sms_interval = `${sms_interval_time}ç§’åå†å‘`;
                        }
                    }, 1000);
                }
            }
        }
    </script>
    
    <style scoped>
        .register {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.3);
        }
    
        .box {
            width: 400px;
            height: 480px;
            background-color: white;
            border-radius: 10px;
            position: relative;
            top: calc(50vh - 240px);
            left: calc(50vw - 200px);
        }
    
        .el-icon-close {
            position: absolute;
            font-weight: bold;
            font-size: 20px;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
    
        .el-icon-close:hover {
            color: darkred;
        }
    
        .content {
            position: absolute;
            top: 40px;
            width: 280px;
            left: 60px;
        }
    
        .nav {
            font-size: 20px;
            height: 38px;
            border-bottom: 2px solid darkgrey;
        }
    
        .nav > span {
            margin-left: 90px;
            color: darkgrey;
            user-select: none;
            cursor: pointer;
            padding-bottom: 10px;
            border-bottom: 2px solid darkgrey;
        }
    
        .nav > span.active {
            color: black;
            border-bottom: 3px solid black;
            padding-bottom: 9px;
        }
    
        .el-input, .el-button {
            margin-top: 40px;
        }
    
        .el-button {
            width: 100%;
            font-size: 18px;
        }
    
        .foot > span {
            float: right;
            margin-top: 20px;
            color: orange;
            cursor: pointer;
        }
    
        .sms {
            color: orange;
            cursor: pointer;
            display: inline-block;
            width: 70px;
            text-align: center;
            user-select: none;
        }
    </style>
    

#### **Header.vue**

    <template>
        <div class="header">
            <div class="slogan">
                <p>è·¯é£å­¦åŸ | å¸®åŠ©æœ‰å¿—å‘çš„å¹´è½»äººé€šè¿‡åŠªåŠ›å­¦ä¹ è·å¾—ä½“é¢çš„å·¥ä½œå’Œç”Ÿæ´»</p>
            </div>
            <div class="nav">
                <ul class="left-part">
                    <li class="logo">
                        <router-link to="/">
                            <img src="../assets/img/head-logo.svg" alt="">
                        </router-link>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/free-course')" :class="{active: url_path === '/free-course'}">å…è´¹è¯¾</span>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/actual-course')" :class="{active: url_path === '/actual-course'}">å®æˆ˜è¯¾</span>
                    </li>
                    <li class="ele">
                        <span @click="goPage('/light-course')" :class="{active: url_path === '/light-course'}">è½»è¯¾</span>
                    </li>
                </ul>
    
                <div class="right-part">
                    <div>
                        <span @click="put_login">ç™»å½•</span>
                        <span class="line">|</span>
                        <span @click="put_register">æ³¨å†Œ</span>
                    </div>
                </div>
                <Login v-if="is_login" @close="close_login" @go="put_register"/>
                <Register v-if="is_register" @close="close_register" @go="put_login"/>
    
    
            </div>
        </div>
    
    </template>
    
    <script>
        import Login from "@/components/Login";
        import Register from "@/components/Register";
    
        export default {
            name: "Header",
            data() {
                return {
                    url_path: sessionStorage.url_path || '/',
                    is_login: false,
                    is_register: false
                }
            },
            methods: {
                goPage(url_path) {
                    // å·²ç»æ˜¯å½“å‰è·¯ç”±å°±æ²¡æœ‰å¿…è¦é‡æ–°è·³è½¬
                    if (this.url_path !== url_path) {
                        this.$router.push(url_path);
                    }
                    sessionStorage.url_path = url_path;
                },
                close_login() {
                    this.is_login = false
                },
                close_register() {
                    this.is_register = false
                },
                put_register() {
                    this.is_register = true
                    this.is_login = false
                },
                put_login() {
                    this.is_register = false
                    this.is_login = true
                }
    
            },
            created() {
                sessionStorage.url_path = this.$route.path;
                this.url_path = this.$route.path;
            },
            components: {
                Login, Register
            }
        }
    </script>
    
    <style scoped>
        .header {
            background-color: white;
            box-shadow: 0 0 5px 0 #aaa;
        }
    
        .header:after {
            content: "";
            display: block;
            clear: both;
        }
    
        .slogan {
            background-color: #eee;
            height: 40px;
        }
    
        .slogan p {
            width: 1200px;
            margin: 0 auto;
            color: #aaa;
            font-size: 13px;
            line-height: 40px;
        }
    
        .nav {
            background-color: white;
            user-select: none;
            width: 1200px;
            margin: 0 auto;
    
        }
    
        .nav ul {
            padding: 15px 0;
            float: left;
        }
    
        .nav ul:after {
            clear: both;
            content: '';
            display: block;
        }
    
        .nav ul li {
            float: left;
        }
    
        .logo {
            margin-right: 20px;
        }
    
        .ele {
            margin: 0 20px;
        }
    
        .ele span {
            display: block;
            font: 15px/36px 'å¾®è½¯é›…é»‘';
            border-bottom: 2px solid transparent;
            cursor: pointer;
        }
    
        .ele span:hover {
            border-bottom-color: orange;
        }
    
        .ele span.active {
            color: orange;
            border-bottom-color: orange;
        }
    
        .right-part {
            float: right;
        }
    
        .right-part .line {
            margin: 0 10px;
        }
    
        .right-part span {
            line-height: 68px;
            cursor: pointer;
        }
    </style>
    

![image-20220424225146317](https://s2.loli.net/2022/04/24/A3DrShOuWe842iX.png)

![image-20220424225202423](https://s2.loli.net/2022/04/24/gab12wpE9lRUoJT.png)

æ¥å£å®ç°1
-----

### éªŒè¯æ‰‹æœºå·æ˜¯å¦å­˜åœ¨æ¥å£

**æ€è·¯ï¼šæ•°æ®åº“æŸ¥è¯¢ï¼Œå­˜åœ¨è¿”å›`{â€œcodeâ€:â€œ100â€,â€œmsgâ€:â€œæˆåŠŸâ€}`**

**users/views.py**

    from .models import User
    from utils.reponse import APIResponse
    from rest_framework.exceptions import APIException
    from rest_framework.viewsets import ViewSet
    from rest_framework.decorators import action
    
    class MobilePhone(ViewSet):
        @action(methods=['GET'],detail=False)
        def check_mobile(self,request):
            try:
                # ä»è¯·æ±‚å‚æ•°è·å–æ‰‹æœºå·
                mobile = request.query_params.get('mobile')
                User.objects.get(mobile=mobile)
                # å­˜åœ¨è¿”å›`{â€œcodeâ€:â€œ100â€,â€œmsgâ€:â€œæˆåŠŸâ€}`
                return APIResponse()
            except Exception as e:
                raise APIException(str(e))
    

**users/urls.py**

    
    from django.urls import path, include
    from rest_framework.routers import SimpleRouter
    from .views import UserView
    
    router = SimpleRouter()
    # 127.0.0.1:8000/api/v1/user/mobile/check_mobile
    router.register('mobile',UserView , 'mobile')
    urlpatterns = [
        path('', include(router.urls)),
    ]
    

![image-20220424193157883](https://s2.loli.net/2022/04/24/cNSvA5LmKwxrs7l.png)

* * *

### å¤šæ–¹å¼ç™»å½•æ¥å£

**è§†å›¾**

    from .models import User
    from utils.reponse import APIResponse
    from rest_framework.exceptions import APIException
    from rest_framework.viewsets import ViewSet,GenericViewSet
    from rest_framework.decorators import action
    
    
    # éªŒè¯æ‰‹æœºå·æ˜¯å¦å­˜åœ¨
    class MobileView(ViewSet):
        @action(methods=['GET'],detail=False)
        def check_mobile(self,request):
            try:
                # ä»è¯·æ±‚å‚æ•°è·å–æ‰‹æœºå·
                mobile = request.query_params.get('mobile')
                User.objects.get(mobile=mobile)
                # å­˜åœ¨è¿”å›`{â€œcodeâ€:â€œ100â€,â€œmsgâ€:â€œæˆåŠŸâ€}`
                return APIResponse()
            except Exception as e:
                raise APIException(str(e))
    
    
    # å¤šæ–¹å¼ç™»å½•
    from .serializer import MulLoginSerializer
    
    
    class LoginView(GenericViewSet):
        serializer_class = MulLoginSerializer
        queryset = User
    
        # ä¸¤ä¸ªç™»é™†æ–¹å¼éƒ½å†™åœ¨è¿™é‡Œé¢ï¼ˆå¤šæ–¹å¼ï¼Œä¸€ä¸ªæ˜¯éªŒè¯ç ç™»é™†ï¼‰
        # loginä¸æ˜¯ä¿å­˜ï¼Œä½†æ˜¯ç”¨postï¼Œå’±ä»¬çš„æƒ³æ³•æ˜¯æŠŠéªŒè¯é€»è¾‘å†™åˆ°åºåˆ—åŒ–ç±»ä¸­
        @action(methods=["post"], detail=False)
        def mul_login(self, request):
            try:
                ser = MulLoginSerializer(data=request.data, context={'request': request})
                ser.is_valid(raise_exception=True)  # å¦‚æœæ ¡éªŒå¤±è´¥ï¼Œç›´æ¥æŠ›å¼‚å¸¸ï¼Œä¸éœ€è¦åŠ ifåˆ¤æ–­äº†
                token = ser.context.get('token')
                username = ser.context.get('username')
                icon = ser.context.get('icon')
                return APIResponse(token=token, username=username, icon=icon)  # {code:100,msg:æˆåŠŸï¼Œtoken:dsadsf,username:Hammer}
            except Exception as e:
                raise APIException(str(e))
    

**åºåˆ—åŒ–ç±»**

    from .models import User
    from rest_framework import serializers
    from rest_framework.exceptions import ValidationError
    
    
    # è¿™ä¸ªåºåˆ—åŒ–ç±»ï¼Œåªç”¨æ¥åšååºåˆ—åŒ–ï¼Œæ•°æ®æ ¡éªŒï¼Œæœ€åä¸ä¿å­˜ï¼Œä¸ç”¨æ¥åšåºåˆ—åŒ–
    class MulLoginSerializer(serializers.ModelSerializer):
        # ä¸€å®šè¦é‡å†™usernameè¿™ä¸ªå­—æ®µï¼Œå› ä¸ºusernameè¿™ä¸ªå­—æ®µæ ¡éªŒè§„åˆ™æ˜¯ä»Userè¡¨æ˜ å°„è¿‡æ¥çš„ï¼Œ
        # usernameæ˜¯å”¯ä¸€ï¼Œå‡è®¾æ•°æ®åº“ä¸­å­˜åœ¨HammerZeç”¨æˆ·ï¼Œä¼ å…¥HammerZeç”¨æˆ·ï¼Œå­—æ®µè‡ªå·±çš„æ ¡éªŒè§„åˆ™å°±ä¼šæ ¡éªŒå¤±è´¥ï¼Œå¤±è´¥åŸå› æ˜¯æ•°æ®åº“å­˜åœ¨ä¸€ä¸ªHammerZeç”¨æˆ·äº†
        # æ‰€ä»¥éœ€è¦é‡å†™è¿™ä¸ªå­—æ®µï¼Œå–æ¶ˆ æ‰å®ƒçš„unique
        username = serializers.CharField(max_length=18, min_length=3)  # ä¸€å®šè¦é‡å†™ï¼Œä¸é‡å†™ï¼Œå­—æ®µè‡ªå·±çš„æ ¡éªŒè¿‡ä¸å»ï¼Œå°±åˆ°ä¸äº†å…¨å±€é’©å­
    
        class Meta:
            model = User
            fields = ['username', 'password']
    
        def validate(self, attrs):
            # åœ¨è¿™é‡Œé¢å®Œæˆæ ¡éªŒï¼Œå¦‚æœæ ¡éªŒå¤±è´¥ï¼Œç›´æ¥æŠ›å¼‚å¸¸
            # 1 å¤šæ–¹å¼å¾—åˆ°user
            user = self._get_user(attrs)
            # 2  userç­¾å‘token
            token = self._get_token(user)
            # 3  æŠŠtoken,username,iconæ”¾åˆ°contextä¸­
            self.context['token'] = token
            self.context['username'] = user.username
            # å†™æ­»çš„è·¯å¾„
            # self.context['icon'] = 'http://127.0.0.1:8000/media/'+str(user.icon)  # å¯¹è±¡ImageFieldçš„å¯¹è±¡
            request = self.context['request']
            # request.META['HTTP_HOST']å–å‡ºæœåŠ¡ç«¯çš„ipåœ°å€
            icon = 'http://%s/media/%s' % (request.META['HTTP_HOST'], str(user.icon))
            self.context['icon'] =icon
            return attrs
    
        # æ­£åˆ™æ ¡éªŒç™»å½•æ–¹å¼
        # æ„æ€æ˜¯è¯¥æ–¹æ³•åªåœ¨ç±»å†…éƒ¨ç”¨ï¼Œä½†æ˜¯å¤–éƒ¨ä¹Ÿå¯ä»¥ç”¨ï¼Œå¦‚æœå†™æˆ__å°±åªèƒ½å†å†…éƒ¨ç”¨äº†
        def _get_user(self, attrs):
            import re
            username = attrs.get('username')
            if re.match(r'^1[3-9][0-9]{9}$', username):
                user = User.objects.filter(mobile=username).first()
            elif re.match(r'^.+@.+$', username):
                user = User.objects.filter(email=username).first()
            else:
                user = User.objects.filter(username=username).first()
    
            if not user:
                # raise ValidationError('ç”¨æˆ·ä¸å­˜åœ¨')
                raise ValidationError('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯')
    
            # å–å‡ºå‰ç«¯ä¼ å…¥çš„å¯†ç 
            password = attrs.get('password')
            if not user.check_password(password):  # å­¦authæ—¶è®²çš„ï¼Œé€šè¿‡æ˜æ–‡æ ¡éªŒå¯†ç 
                raise ValidationError("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯")
    
            return user
    
        def _get_token(self, user):
            # jwtæ¨¡å—ä¸­æä¾›çš„
            from rest_framework_jwt.serializers import jwt_payload_handler, jwt_encode_handler
            payload = jwt_payload_handler(user)
            token = jwt_encode_handler(payload)
            return token
    

**è·¯ç”±**

    from django.urls import path,include
    from user import views
    from rest_framework.routers import SimpleRouter
    router = SimpleRouter()
    router.register('mobile',views.MobileView,'mobile')  #  127.0.0.1:8000/api/v1/user/mobile/check_mobile
    router.register('login',views.LoginView , 'login')  #  127.0.0.1:8000/api/v1/user/login/mul_login
    urlpatterns = [
        path('',include(router.urls)),
    ]
    
    

**æµ‹è¯•**

![image-20220424224350744](https://s2.loli.net/2022/04/24/Q3ixRdKaI2Nw5uo.png)

![image-20220424224611093](https://s2.loli.net/2022/04/24/Q7vzfaLuIYWJhgM.png)

![image-20220424224629432](https://s2.loli.net/2022/04/24/nJshmdyQ27Kv593.png)

* * *

æ¥å£å®ç°2
-----

**å®ç°å‘é€çŸ­ä¿¡æ¥å£é…ç½®å’ŒéªŒè¯**

### **é…ç½®å‘é€çŸ­ä¿¡**

**\\libs\\tencent\_sms\_v3\__init_\_.py**

    from .sms import get_code, send_sms
    

**\\libs\\tencent\_sms\_v3\\sms.py**

    import random
    from . import settings
    from utils.log import logger
    from tencentcloud.common import credential
    from tencentcloud.common.exception.tencent_cloud_sdk_exception import TencentCloudSDKException
    # å¯¼å…¥å¯¹åº”äº§å“æ¨¡å—çš„client modelsã€‚
    from tencentcloud.sms.v20210111 import sms_client, models
    
    # å¯¼å…¥å¯é€‰é…ç½®ç±»
    from tencentcloud.common.profile.client_profile import ClientProfile
    from tencentcloud.common.profile.http_profile import HttpProfile
    
    
    # å†™ä¸¤ä¸ªå‡½æ•°ï¼Œ
    # è·å–éªŒè¯ç çš„å‡½æ•°
    def get_code(count=4):
        code_str = ''
        for i in range(count):
            num = random.randint(0, 9)
            code_str += str(num)
        return code_str
    
    
    # å‘é€çŸ­ä¿¡çš„å‡½æ•°
    
    def send_sms(phone, code):
        try:
            cred = credential.Credential(settings.SECRETID, settings.SECRETKEY)
            # å®ä¾‹åŒ–ä¸€ä¸ªhttpé€‰é¡¹ï¼Œå¯é€‰çš„ï¼Œæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚å¯ä»¥è·³è¿‡ã€‚
            httpProfile = HttpProfile()
            httpProfile.reqMethod = "POST"  # postè¯·æ±‚(é»˜è®¤ä¸ºpostè¯·æ±‚)
            httpProfile.reqTimeout = 30  # è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’(é»˜è®¤60ç§’)
            httpProfile.endpoint = "sms.tencentcloudapi.com"  # æŒ‡å®šæ¥å…¥åœ°åŸŸåŸŸå(é»˜è®¤å°±è¿‘æ¥å…¥)
            clientProfile = ClientProfile()
            clientProfile.signMethod = "TC3-HMAC-SHA256"  # æŒ‡å®šç­¾åç®—æ³•
            clientProfile.language = "en-US"
            clientProfile.httpProfile = httpProfile
            client = sms_client.SmsClient(cred, "ap-guangzhou", clientProfile)
            req = models.SendSmsRequest()
            req.SmsSdkAppId = settings.APPID
            req.SignName = settings.SIGNAME
            req.TemplateId = settings.TemplateId
            req.TemplateParamSet = [code,]
            req.PhoneNumberSet = ["+86%s"%phone,]
            req.SessionContext = ""
            req.ExtendCode = ""
            req.SenderId = ""
            client.SendSms(req)
            # print(resp.to_json_string(indent=2))
            return True
        except TencentCloudSDKException as err:
            # å¦‚æœçŸ­ä¿¡å‘é€å¤±è´¥ï¼Œè®°å½•ä¸€ä¸‹æ—¥å¿—--ã€‹ä¸€æ—¦ä½¿ç”¨äº†è®°å½•æ—¥å¿—ï¼Œä½¿ç”¨çš„æ˜¯django çš„æ—¥å¿—ï¼Œä»¥åè¿™ä¸ªåŒ…ï¼Œç»™åˆ«çš„æ¡†æ¶ç”¨ï¼Œè¦æ”¹æ—¥å¿—
            logger.error('æ‰‹æœºå·ä¸ºï¼š%så‘é€çŸ­ä¿¡å¤±è´¥ï¼Œå¤±è´¥åŸå› ï¼š%s'%phone,str(err))
    

**tencent\_sms\_v3\\settings.py**

    # éƒ½é…ç½®æˆè‡ªå·±çš„å°±è¡Œäº†ï¼Œå‚è€ƒå®˜ç½‘æ–‡æ¡£https://console.cloud.tencent.com/cam/capi
    # https://cloud.tencent.com/document/product/382/43196
    SECRETID=''
    SECRETKEY=''
    APPID = ""
    SIGNAME=''
    TemplateId = ""
    

### å‘é€çŸ­ä¿¡æ¥å£

**è§†å›¾**

    from libs import tencent_sms_v3
    
    class SendSmsView(ViewSet):
        @action(methods=['GET'],detail=False)
        def send_message(self, request):
            try:
                phone = request.query_params.get('phone')
                # ç”ŸæˆéªŒè¯ç 
                code = tencent_sms_v3.get_code()
                # codeè¦ä¿å­˜ï¼Œå¦åˆ™åé¢æ²¡æ³•éªŒè¯
                res = tencent_sms_v3.send_sms(phone, code)
                if res:
                    return APIResponse(msg='çŸ­ä¿¡å‘é€æˆåŠŸ')
                else:
                    raise APIException("çŸ­ä¿¡å‘é€å¤±è´¥")
            except Exception as e:
                raise APIException(str(e))
    

**è·¯ç”±**

    router.register('send',views.SendSmsView , 'send')  #  127.0.0.1:8000/api/v1/user/send/send_message/--->getè¯·æ±‚
    

**æµ‹è¯•**

![image-20220424233417661](https://s2.loli.net/2022/04/24/Zb28D7umTnfYKqj.png)