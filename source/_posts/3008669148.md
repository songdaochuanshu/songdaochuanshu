---
layout: post
title: "ã€å¾®æœåŠ¡ã€‘- Nacos - æ³¨å†Œä¸­å¿ƒ"
date: "2022-09-21T14:29:33.537Z"
---
ã€å¾®æœåŠ¡ã€‘- Nacos - æ³¨å†Œä¸­å¿ƒ
===================

æ³¨å†Œä¸­å¿ƒå¯ä»¥è¯´æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„â€é€šè®¯å½•â€œï¼Œå®ƒè®°å½•äº†æœåŠ¡å’ŒæœåŠ¡åœ°å€çš„æ˜ å°„å…³ç³»ã€‚åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼ŒæœåŠ¡ä¼šæ³¨å†Œåˆ°è¿™é‡Œï¼Œå½“æœåŠ¡éœ€è¦è°ƒç”¨å…¶å®ƒæœåŠ¡æ—¶ï¼Œå°±åˆ°è¿™é‡Œæ‰¾åˆ°æœåŠ¡çš„åœ°å€ï¼Œè¿›è¡Œè°ƒç”¨ã€‚

å¾®æœåŠ¡ - æ³¨å†Œä¸­å¿ƒ - Nacos
==================

> ğŸ˜„ç”Ÿå‘½ä¸æ¯ï¼Œå†™ä½œä¸æ­¢  
> ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°  
> ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·  
> ğŸ† [ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº](https://blog.csdn.net/qq_43843951) [@æ€’æ”¾å§å¾·å¾·](https://www.cnblogs.com/lyd-code/)  
> ğŸŒåˆ†äº«å­¦ä¹ å¿ƒå¾—ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ æˆé•¿ï¼

ä¸Šä¸€æ¬¡ä»‹ç»äº†Nacosçš„ç®€ä»‹ä»¥åŠç®€è¦ç†è§£ï¼Œè¿™æ¬¡å°±æ¥ä½¿ç”¨Nacosæ•´åˆSpringCloud Alibabaã€‚  
åŠªåŠ›å…‹åˆ¶è‡ªå·±ï¼Œæ‹’ç»æ‘†çƒ‚ï¼

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/img_convert/74ab38bd5e36061f3add790d8e96d452.png#pic_center)

ç›®å½•

*   [å¾®æœåŠ¡ - æ³¨å†Œä¸­å¿ƒ - Nacos](#å¾®æœåŠ¡---æ³¨å†Œä¸­å¿ƒ---nacos)
    *   [ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œ](#ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œ)
    *   [ä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°](#ä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°)
    *   [å®ä¾‹](#å®ä¾‹)
        *   [åˆ›å»ºçˆ¶å·¥ç¨‹](#åˆ›å»ºçˆ¶å·¥ç¨‹)
        *   [åˆ›å»ºæœåŠ¡](#åˆ›å»ºæœåŠ¡)
        *   [ç¼–å†™æ¨¡æ‹Ÿapi](#ç¼–å†™æ¨¡æ‹Ÿapi)

ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œ
-------

æœåŠ¡æ³¨å†Œè¡¨æ˜¯æ³¨å†Œä¸­å¿ƒçš„æ ¸å¿ƒï¼Œå®ƒç”¨æ¥è®°å½•å„ä¸ªå¾®æœåŠ¡å®ä¾‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å¾®æœåŠ¡çš„åç§°ã€IPã€ç«¯å£ç­‰ã€‚æœåŠ¡æ³¨å†Œè¡¨æä¾›æŸ¥è¯¢APIå’Œç®¡ç†APIï¼ŒæŸ¥è¯¢APIç”¨äºæŸ¥è¯¢å¯ç”¨çš„å¾®æœåŠ¡å®ä¾‹ï¼Œç®¡ç†APIç”¨äºæœåŠ¡çš„æ³¨å†Œä¸æ³¨é”€ã€‚æä¾›è€…å°†æœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œæ³¨å†Œä¸­å¿ƒä¼šå¯¹æœåŠ¡è¿›è¡Œå®ä¾‹å¥åº·ç›‘æ§ï¼Œæ¶ˆè´¹è€…é€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡ŒæœåŠ¡å‘ç°ï¼Œåœ¨è¿›è¡ŒæœåŠ¡è°ƒç”¨ã€‚é€šå¸¸æœåŠ¡è°ƒç”¨ä¼šä½¿ç”¨è´Ÿè½½å‡è¡¡ï¼Œå¸¸è§è´Ÿè½½å‡è¡¡æœ‰ribbonæˆ–è€…feignã€‚  
![image](https://img2022.cnblogs.com/blog/1954113/202209/1954113-20220921221517529-1633366836.png)

å¯¹äºæ³¨å†Œä¸­å¿ƒçš„ç†è§£ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ CSDNï¼š[10åˆ†é’Ÿå¸¦ä½ å½»åº•ææ‡‚æ³¨å†Œä¸­å¿ƒ\_Apple\_Webçš„åšå®¢-CSDNåšå®¢\_ä»€ä¹ˆæ˜¯æ³¨å†Œä¸­å¿ƒ](https://blog.csdn.net/belongtocode/article/details/118639474)

ä»€ä¹ˆæ˜¯æœåŠ¡å‘ç°
-------

åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ•´ä¸ªç³»ç»Ÿä¼šæŒ‰èŒè´£èƒ½åŠ›åˆ’åˆ†ä¸ºå¤šä¸ªæœåŠ¡ï¼Œé€šè¿‡æœåŠ¡ä¹‹é—´åä½œæ¥å®ç°ä¸šåŠ¡ç›®æ ‡ã€‚è¿™æ ·åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­å…ä¸äº†è¦è¿›è¡ŒæœåŠ¡é—´çš„è¿œç¨‹è°ƒç”¨ï¼ŒæœåŠ¡çš„æ¶ˆè´¹æ–¹è¦è°ƒç”¨æœåŠ¡çš„ç”Ÿäº§æ–¹ï¼Œä¸ºäº†å®Œæˆä¸€æ¬¡è¯·æ±‚ï¼Œæ¶ˆè´¹æ–¹éœ€è¦çŸ¥é“æœåŠ¡ç”Ÿäº§æ–¹çš„ç½‘ç»œä½ç½®(IPåœ°å€å’Œç«¯å£å·)ã€‚  
![image](https://img2022.cnblogs.com/blog/1954113/202209/1954113-20220921221532799-536545125.png)  
å†çœ‹è¿™å›¾ï¼Œå°†æ¯ä¸ªæœåŠ¡é›†ç¾¤éƒ½æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œç”±å…¶ç»Ÿä¸€ç®¡ç†ã€‚åœ¨æœåŠ¡ä¸­å¿ƒå°±ä¼šæœ‰æœåŠ¡æ³¨å†Œè¡¨ï¼Œåœ¨æœåŠ¡å®ä¾‹æœ¬èº«å¹¶ä¸è®°å½•æœåŠ¡ç”Ÿäº§æ–¹çš„ç½‘ç»œåœ°å€ï¼Œæ‰€æœ‰æœåŠ¡å®ä¾‹å†…éƒ¨éƒ½ä¼šåŒ…å«æœåŠ¡å‘ç°å®¢æˆ·ç«¯ã€‚

1)ã€åœ¨æ¯ä¸ªæœåŠ¡å¯åŠ¨çš„æ—¶å€™ï¼ŒæœåŠ¡ä¼šå‘æ³¨å†Œä¸­å¿ƒ(Nacos)æ³¨å†ŒæœåŠ¡ï¼Œä¸ŠæŠ¥è‡ªå·±çš„ç½‘ç»œåœ°å€(æœåŠ¡åï¼Œç«¯å£å·ç­‰)ä¿¡æ¯ã€‚æœåŠ¡ä¸­å¿ƒå°±ä¼šå½¢æˆæœåŠ¡æ³¨å†Œè¡¨ï¼Œè¿™æ˜¯æœåŠ¡å‘ç°çš„æ ¸å¿ƒã€‚å®ƒæ˜¯å­˜å‚¨äº†æ‰€æœ‰æœåŠ¡å®ä¾‹çš„æ•°æ®åº“ã€‚  
2)ã€å®¢æˆ·ç«¯ä¼šå®šæœŸä»æœåŠ¡ä¸­å¿ƒæ‹‰å–æœåŠ¡æ³¨å†Œè¡¨ï¼Œç¼“å­˜åœ¨å®¢æˆ·ç«¯ã€‚  
3)ã€å¦‚æœä¸€ä¸ªæœåŠ¡æœ‰è®¸å¤šå®ä¾‹é›†ç¾¤ï¼Œé‚£å°±éœ€è¦è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä»ä¸­é€‰å‡ºä¸€ä¸ªæ¥ã€‚

> åœ¨å¾®æœåŠ¡ç¯å¢ƒä¸­ï¼Œç”±äºæœåŠ¡è¿è¡Œå®ä¾‹çš„ç½‘ç»œåœ°å€æ˜¯ä¸æ–­åŠ¨æ€å˜åŒ–çš„ï¼ŒæœåŠ¡å®ä¾‹æ•°é‡çš„åŠ¨æ€å˜åŒ– ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨å›ºå®šçš„é…ç½®æ–‡ä»¶æ¥è®°å½•æœåŠ¡æä¾›æ–¹çš„ç½‘ç»œåœ°å€ï¼Œå¿…é¡»ä½¿ç”¨åŠ¨æ€çš„æœåŠ¡å‘ç°æœºåˆ¶ç”¨äºå®ç°å¾®æœåŠ¡é—´çš„ç›¸äº’æ„ŸçŸ¥ã€‚å„æœåŠ¡å®ä¾‹ä¼šä¸ŠæŠ¥è‡ªå·±çš„ç½‘ç»œåœ°å€ï¼Œè¿™æ ·æœåŠ¡ä¸­å¿ƒå°±å½¢æˆäº†ä¸€ä¸ªå®Œæ•´çš„æœåŠ¡æ³¨å†Œè¡¨ï¼Œå„æœåŠ¡å®ä¾‹ä¼šé€šè¿‡æœåŠ¡å‘ç°ä¸­å¿ƒæ¥è·å–è®¿é—®ç›®æ ‡æœåŠ¡çš„ç½‘ç»œåœ°å€ï¼Œä»è€Œå®ç°æœåŠ¡å‘ç°çš„æœºåˆ¶ã€‚

å®ä¾‹
--

åœ¨ä¹‹å‰å·²ç»æ›´æ–°äº†ä¸€ç¯‡ [ã€å¾®æœåŠ¡ã€‘Nacosåˆä½“éªŒ](https://blog.csdn.net/qq_43843951/article/details/126943642?spm=1001.2014.3001.5501)ï¼Œé‡Œé¢ä»‹ç»äº†Nacosçš„åŸºç¡€ä½¿ç”¨ï¼Œç°åœ¨æ¥é€šè¿‡SpringCloudå®ç°ä¸€ä¸ªå®ä¾‹ã€‚

### åˆ›å»ºçˆ¶å·¥ç¨‹

åˆ›å»ºçˆ¶çº§springcloudå·¥ç¨‹ï¼Œpom.xmlæ–‡ä»¶å¦‚ä¸‹ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ç‰ˆæœ¬é—®é¢˜ï¼Œå¯ä»¥åœ¨springcloud-alibabaçš„å¼€æºé¡¹ç›®ä¸­æŸ¥çœ‹å…·ä½“åœ°å€ï¼š[ç‰ˆæœ¬è¯´æ˜](https://github.com/alibaba/spring-cloud-alibaba/wiki/%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E)  
![image](https://img2022.cnblogs.com/blog/1954113/202209/1954113-20220921221550267-407366956.png)

    <?xml version="1.0" encoding="UTF-8"?>
    <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
        <modelVersion>4.0.0</modelVersion>
        <packaging>pom</packaging>
        <modules>
            <module>service-goods</module>
            <module>service-store</module>
        </modules>
        <parent>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-parent</artifactId>
            <version>2.4.2</version>
            <relativePath/> <!-- lookup parent from repository -->
        </parent>
        <groupId>com.lyd</groupId>
        <artifactId>spring-cloud-demo</artifactId>
        <version>0.0.1-SNAPSHOT</version>
        <name>spring-cloud-demo</name>
        <description>Demo project for Spring Boot</description>
        <properties>
            <java.version>1.8</java.version>
            <spring-cloud.version>2020.0.1</spring-cloud.version>
            <spring-cloud-alibaba.version>2021.1</spring-cloud-alibaba.version>
        </properties>
        <dependencies>
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-starter</artifactId>
            </dependency>
    
            <dependency>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
                <optional>true</optional>
            </dependency>
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-test</artifactId>
                <scope>test</scope>
            </dependency>
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-starter-bootstrap</artifactId>
            </dependency>
        </dependencies>
        <dependencyManagement>
            <dependencies>
                <dependency>
                    <groupId>org.springframework.cloud</groupId>
                    <artifactId>spring-cloud-dependencies</artifactId>
                    <version>${spring-cloud.version}</version>
                    <type>pom</type>
                    <scope>import</scope>
                </dependency>
                <dependency>
                    <groupId>com.alibaba.cloud</groupId>
                    <artifactId>spring-cloud-alibaba-dependencies</artifactId>
                    <version>${spring-cloud-alibaba.version}</version>
                    <type>pom</type>
                    <scope>import</scope>
                </dependency>
            </dependencies>
        </dependencyManagement>
        <build>
            <plugins>
                <plugin>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-maven-plugin</artifactId>
                    <configuration>
                        <excludes>
                            <exclude>
                                <groupId>org.projectlombok</groupId>
                                <artifactId>lombok</artifactId>
                            </exclude>
                        </excludes>
                    </configuration>
                </plugin>
            </plugins>
        </build>
    </project>
    

### åˆ›å»ºæœåŠ¡

åˆ›å»ºä¸€ä¸ªmavenæ¨¡å—ï¼Œç¼–å†™å¯åŠ¨ç±»å’Œbootstrap.ymlé…ç½®æ–‡ä»¶  
éœ€è¦åœ¨pomæ·»åŠ ä»¥ä¸‹ä¾èµ–åæ ‡ï¼š

*   **spring-cloud-starter-alibaba-nacos-discovery**ï¼šå°† Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œå¹¶å®ç°å¯¹å®ƒçš„è‡ªåŠ¨é…ç½®ä¸æœåŠ¡å‘ç°
*   **spring-boot-starter-web**ï¼šwebå¯åŠ¨å™¨ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†åµŒå…¥çš„ Servlet å®¹å™¨ä»¥åŠ SpringMVC çš„ä¾èµ–ï¼Œå¹¶ä¸º Spring MVC æä¾›äº†å¤§é‡è‡ªåŠ¨é…ç½®ï¼Œå¯ä»¥é€‚ç”¨äºå¤§å¤šæ•° Web å¼€å‘åœºæ™¯ã€‚

    <dependencies>
        <dependency>
            <groupId>com.alibaba.cloud</groupId>
            <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
    </dependencies>
    

å¯åŠ¨å™¨ç±»éœ€è¦æ·»åŠ æ³¨è§£  
**@EnableDiscoveryClientï¼š** å°†å¾®æœåŠ¡æ³¨å†Œåˆ°æœåŠ¡å‘ç°ç»„ä»¶ä¸Šï¼Œèƒ½å¤Ÿè®©æ³¨å†Œä¸­å¿ƒèƒ½å¤Ÿå‘ç°ï¼Œæ‰«æåˆ°æ”¹æœåŠ¡ã€‚

    package com.lyd.demo;
    import org.springframework.boot.SpringApplication;
    import org.springframework.boot.autoconfigure.SpringBootApplication;
    import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
    /**
     * @author: lyd
     * @description: å¯åŠ¨ç±»
     * @Date: 2022/9/20
     */
    @EnableDiscoveryClient
    @SpringBootApplication
    public class GoodsApplication {
        public static void main(String[] args) {
            SpringApplication.run(GoodsApplication.class, args);
        }
    }
    

åœ¨bootstrap.ymlæ–‡ä»¶ä¸Šç¼–å†™ä¸€äº›é…ç½®  
ä¿®æ”¹ç«¯å£å·ï¼ŒæœåŠ¡åå­—ç­‰ã€‚ephemeralï¼šè¡¨ç¤ºæ³¨å†Œçš„å®ä¾‹çš„å±æ€§ï¼Œé»˜è®¤æ˜¯true

    server:
      port: 8000
    spring:
      application:
        name: service-goods
      cloud:
        nacos:
          server-addr: 127.0.0.1:8848
          discovery:
            ephemeral: false # falseä¸ºæ°¸ä¹…å®ä¾‹ï¼Œtrueè¡¨ç¤ºä¸´æ—¶å®ä¾‹å¼€å¯ï¼Œæ³¨å†Œä¸ºä¸´æ—¶å®ä¾‹
    

åœ¨View/Tool Windows ä¸‹é¢æœ‰ä¸ªserviceså¯ä»¥æ‰“å¼€æŸ¥çœ‹æœåŠ¡ï¼Œæœ‰æ—¶å€™ä¼šæœ‰æç¤ºæ‰“å¼€ï¼Œåœ¨æ·»åŠ springbootå°±è¡Œã€‚  
![image](https://img2022.cnblogs.com/blog/1954113/202209/1954113-20220921221621822-1872797103.png)  
é€šè¿‡å³é”®copy Configuration å¯ä»¥èµ‹å€¼å¤šä¸ªå®ä¾‹ï¼Œåœ¨VM-optionsä¸­å†™ -Dserver.port=????æ¥é…ç½®æ–°çš„å®ä¾‹çš„ç«¯å£å·  
![image](https://img2022.cnblogs.com/blog/1954113/202209/1954113-20220921221632609-210939308.png)  
è¿è¡Œå¯åŠ¨ï¼Œå°±ä¼šå§æœåŠ¡æ³¨å†Œåˆ°nacosæ³¨å†Œä¸­ï¼Œæ­¤æ—¶å¯ä»¥åœ¨nacosç½‘é¡µä¸­æŸ¥çœ‹ã€‚  
![image](https://img2022.cnblogs.com/blog/1954113/202209/1954113-20220921221640588-1292174704.png)  
è¿™é‡Œèƒ½å¤Ÿæ˜¾ç¤ºæœåŠ¡çš„é›†ç¾¤ã€çŠ¶æ€ç­‰ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œå…¶ä»–æ“ä½œã€‚  
æ¥ä¸‹æ¥ç¼–å†™æœåŠ¡çš„ä¸€äº›å…·ä½“æ¨¡æ‹Ÿä¸šåŠ¡ï¼Œåœ¨è®©æœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨ã€‚

### ç¼–å†™æ¨¡æ‹Ÿapi

åœ¨service-storeä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªæ§åˆ¶ç±»ï¼Œé€šè¿‡/api/store/idè¿”å›è®¿é—®çš„ç«¯å£å’Œä¸€ä¸ªintegeræ•°å€¼

    package com.lyd.demo.controller;
    import org.springframework.beans.factory.annotation.Value;
    import org.springframework.web.bind.annotation.GetMapping;
    import org.springframework.web.bind.annotation.PathVariable;
    import org.springframework.web.bind.annotation.RequestMapping;
    import org.springframework.web.bind.annotation.RestController;
    import java.util.HashMap;
    import java.util.Map;
    /**
     * @author: lyd
     * @description: api
     * @Date: 2022/9/21
     */
    @RestController
    @RequestMapping("/api/store")
    public class StoreController {
        @Value("${server.port}")
        private String currentPort;
        @GetMapping("/{id}")
        public Map<String, Object> getStoreNum(@PathVariable String id) {
            Map<String, Object> map = new HashMap<>();
            map.put("port", currentPort);
            map.put("num", 10);
            return map;
        }
    }
    

åœ¨server-goodsæœåŠ¡ä¸­éœ€è¦æœ‰ä¸€ä¸ªå®ä½“ç±»ï¼Œæ¨¡æ‹Ÿè¯·æ±‚çš„æ•°æ®å®ä½“ã€‚

    package com.lyd.demo.entity;
    import lombok.Data;
    /**
     * @author: lyd
     * @description: å•†å“å®ä½“ç±»
     * @Date: 2022/9/21
     */
    @Data
    public class GoodsDto {
        private Long uid;
        private Integer number;
        private String name;
        private String code;
        private String size;
        private Double price;
        private String currentPort;
        private String serverPort;
    }
    

ç¼–å†™æ§åˆ¶ç±»ï¼Œæš´éœ²apiæ¥å£ï¼Œç­‰ä¸‹å°±æ˜¯è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå¹¶ä¸”é€šè¿‡RestTemplate.getForObjectæ¥è¿›è¡ŒæœåŠ¡é—´çš„è°ƒç”¨ï¼Œåœ¨æ­¤éœ€è¦å¯¼å…¥è´Ÿè½½å‡è¡¡ç­–ç•¥çš„åæ ‡ã€‚å¹¶ä¸”å¯ä»¥åœ¨å¯åŠ¨å™¨ä¸­æ³¨å…¥beanï¼Œå¼€å¯è´Ÿè½½å‡è¡¡ã€‚

    <!--è´Ÿè½½å‡è¡¡-->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-loadbalancer</artifactId>
    </dependency>
    

åœ¨å¯åŠ¨ç±»ä¸­å»æ³¨å…¥beanå¹¶ä¸”åŠ ä¸Šæ³¨è§£@LoadBalanced

    @Bean
    @LoadBalanced
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
    

å…·ä½“æ§åˆ¶ç±»ä»£ç å¦‚ä¸‹ï¼š  
æ³¨æ„URLæ˜¯[http://service-store/api/store/](http://service-store/api/store/)é€šè¿‡æœåŠ¡åæ¥çš„ï¼Œè¿™æ ·restTemplateå°±èƒ½ä½¿ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚

    package com.lyd.demo.controller;
    import com.fasterxml.jackson.core.JsonProcessingException;
    import com.fasterxml.jackson.databind.ObjectMapper;
    import com.lyd.demo.entity.GoodsDto;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.beans.factory.annotation.Value;
    import org.springframework.web.bind.annotation.GetMapping;
    import org.springframework.web.bind.annotation.PathVariable;
    import org.springframework.web.bind.annotation.RequestMapping;
    import org.springframework.web.bind.annotation.RestController;
    import org.springframework.web.client.RestTemplate;
    import java.util.Map;
    /**
     * @author: lyd
     * @description: api
     * @Date: 2022/9/21
     */
    @RestController
    @RequestMapping("/api")
    public class GoodsController {
        @Autowired
        private RestTemplate restTemplate;
        @Value("${server.port}")
        private String currentPort;
        @GetMapping("/{uid}")
        public GoodsDto getGoodsNum(@PathVariable String uid) throws JsonProcessingException {
            GoodsDto goodsDto = new GoodsDto();
            goodsDto.setUid(1L);
            goodsDto.setName("ç¬”è®°æœ¬");
            goodsDto.setCode("note:1");
            goodsDto.setSize("A6");
            goodsDto.setPrice(5.88);
            // å‘service-storeæœåŠ¡è¯·æ±‚æ•°æ®
            String object = restTemplate.getForObject("http://service-store/api/store/" + uid, String.class);
            ObjectMapper objectMapper = new ObjectMapper();
            Map map = objectMapper.readValue(object, Map.class);
            Integer number = (Integer) map.get("num");
            String port = (String) map.get("port");
            goodsDto.setNumber(number);
            goodsDto.setCurrentPort("è¯·æ±‚çš„ç«¯å£ï¼š" + port);
            goodsDto.setServerPort("å½“å‰çš„ç«¯å£ï¼š" + currentPort);
            return goodsDto;
        }
    }
    

å¯åŠ¨NacosæœåŠ¡å™¨åå°±å¯ä»¥å¯åŠ¨è¿™äº›æœåŠ¡ï¼Œä¸ºäº†æ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡çš„æ•ˆæœï¼ŒstoreæœåŠ¡å®ä¾‹å°±å¤åˆ¶äº†ä¸¤ä¸ª  
![image](https://img2022.cnblogs.com/blog/1954113/202209/1954113-20220921221701636-1683566111.png)

å¯åŠ¨ä¹‹åè®¿é—®ï¼š[http://localhost:8000/api/1](http://localhost:8000/api/1) å°±å¯ä»¥çœ‹åˆ°è¾“å‡ºçš„ç»“æœï¼Œæ¯æ¬¡è¾“å‡ºçš„è¯·æ±‚ç«¯å£éƒ½ä¸ä¸€æ ·ã€‚  
![image](https://img2022.cnblogs.com/blog/1954113/202209/1954113-20220921221710089-799102132.png)  
![image](https://img2022.cnblogs.com/blog/1954113/202209/1954113-20220921221713210-591776867.png)

ä»Šå¤©ç®—æ˜¯æŒºåå·çš„ï¼Œä¹‹å‰ç”¨æ¥å¯åŠ¨è‹¥ä¾æ¡†æ¶çš„nacosæœåŠ¡å™¨ä¸çŸ¥ä¸ºä»€ä¹ˆå°±ä¸èƒ½ç”¨äº†ï¼Œäºæ˜¯æäº†å¥½ä¹…å¹²è„†é‡æ–°å®‰è£…ä¸€ä¸ªNacosæœåŠ¡å™¨ï¼Œæœ€åæ‰æˆåŠŸã€‚

ğŸ‘åˆ›ä½œä¸æ˜“ï¼Œå¯èƒ½æœ‰äº›è¯­è¨€ä¸æ˜¯å¾ˆé€šç•…ï¼Œå¦‚æœ‰é”™è¯¯è¯·æŒ‡æ­£ï¼Œæ„Ÿè°¢è§‚çœ‹ï¼è®°å¾—ç‚¹èµå“¦ï¼ğŸ‘