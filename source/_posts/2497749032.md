---
layout: post
title: "Cert Manager ç”³è¯· SSL è¯ä¹¦æµç¨‹åŠç›¸å…³æ¦‚å¿µ - ä¸€"
date: "2023-01-20T09:16:15.245Z"
---
Cert Manager ç”³è¯· SSL è¯ä¹¦æµç¨‹åŠç›¸å…³æ¦‚å¿µ - ä¸€
=================================

2022.3.9 ç”¨ cert-manager ç”³è¯·æˆåŠŸé€šé…ç¬¦è¯ä¹¦ (`*.ewhisper.cn`), 2022.4.30 è¯¥è¯ä¹¦è·ç¦»è¿‡æœŸè¿˜æœ‰ 30 å¤©ï¼Œcert-manager è¿›è¡Œè‡ªåŠ¨ç»­æœŸï¼Œä½†æ˜¯å´å¤±è´¥äº†ã€‚ğŸ˜±ğŸ˜±ğŸ˜±

ç„¶åè¿‡äº†å‡ å¤©ï¼Œåœ¨ 2022.5.8, æœ€ç»ˆæˆåŠŸäº†ã€‚å¦‚ä¸‹å›¾ï¼š

![ç»­æœŸæˆåŠŸçš„ ewhisper.cn é€šé…ç¬¦è¯ä¹¦](https://img2023.cnblogs.com/other/3034537/202301/3034537-20230120100841448-752407002.png)

æ­£å¥½å€Ÿç€è¿™ä¸ªæƒ…å†µæ‹ä¸€ä¸‹ cert-manager çš„ SSL è¯ä¹¦ç”³è¯·æµç¨‹ä»¥åŠè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„ç›¸å…³æ¦‚å¿µã€‚

ä¸­è‹±æ–‡å¯¹ç…§è¡¨
------

è‹±æ–‡

è‹±æ–‡ - K8S CRD

ä¸­æ–‡

å¤‡æ³¨

certificates

`Certificate`

è¯ä¹¦

`certificates.cert-manager.io/v1`

certificate issuers

`Issuer`

è¯ä¹¦é¢å‘è€…

`issuers.cert-manager.io`

`ClusterIssuer`

é›†ç¾¤è¯ä¹¦é¢å‘è€…

`clusterissuers.cert-manager.io`

certificate request

`CertificateRequest`

è¯ä¹¦ç”³è¯·

`certificaterequests.cert-manager.io`

order

`Order`

ï¼ˆè¯ä¹¦ï¼‰è®¢å•

`orders.acme.cert-manager.io`

challenge

`Challenge`

ï¼ˆè¯ä¹¦ï¼‰æŒ‘æˆ˜

`challenges.acme.cert-manager.io`

SelfSigned

è‡ªç­¾å

cert-manager Issuer çš„ä¸€ç§

CA

è¯ä¹¦é¢å‘æœºæ„

Certificate Authority çš„ç¼©å†™ï¼›  
cert-manager Issuer çš„ä¸€ç§

Vault

é‡‘åº“

cert-manager Issuer çš„ä¸€ç§ï¼Œå³ Hashicorp Vault

Venafi

[Venafi](https://vaas.venafi.com/) åœ¨çº¿è¯ä¹¦åŠç†æœåŠ¡ï¼Œç›®å‰ç”¨çš„ä¸å¤šã€‚

External

å¤–éƒ¨

cert-manager Issuer çš„ä¸€ç§

ACME

è‡ªåŠ¨è¯ä¹¦ç®¡ç†ç¯å¢ƒ

Automated Certificate Management Environment çš„ç¼©å†™ï¼›  
cert-manager Issuer, åŒ…æ‹¬ HTTP01 å’Œ DNS01

Cert Manager ç®€ä»‹
---------------

cert-manager åœ¨ Kubernetes é›†ç¾¤ä¸­æ·»åŠ äº†è¯ä¹¦ (certificates) å’Œè¯ä¹¦é¢å‘è€… (certificate issuers) ä½œä¸ºèµ„æºç±»å‹ï¼Œå¹¶ç®€åŒ–äº†è·å–ã€æ›´æ–°å’Œä½¿ç”¨è¿™äº›è¯ä¹¦çš„è¿‡ç¨‹ã€‚

å®ƒå¯ä»¥ä»å„ç§æ”¯æŒçš„æ¥æºç­¾å‘è¯ä¹¦ï¼ŒåŒ…æ‹¬ [Let's Encrypt](https://letsencrypt.org/)ã€[HashiCorp Vault](https://www.vaultproject.io/) å’Œ [Venafi](https://www.venafi.com/) ä»¥åŠç§äºº PKIã€‚

> ğŸ“**Notes:**
> 
> å¸¸ç”¨çš„ä¸»æµæ¥æºæ˜¯ï¼š[Let's Encrypt](https://letsencrypt.org/)

å®ƒå°†ç¡®ä¿è¯ä¹¦æ˜¯æœ‰æ•ˆçš„å’Œæœ€æ–°çš„ï¼Œå¹¶è¯•å›¾åœ¨åˆ°æœŸå‰çš„ä¸€ä¸ªé…ç½®æ—¶é—´å†…æ›´æ–°è¯ä¹¦ã€‚

![è§£é‡Š cert-manager æ¶æ„çš„é«˜å±‚æ¬¡æ¦‚è§ˆå›¾](https://img2023.cnblogs.com/other/3034537/202301/3034537-20230120100841645-1643568407.svg)

Issuerï¼ˆè¯ä¹¦é¢å‘è€…ï¼‰
-------------

åœ¨å®‰è£…äº† cert-manager ä¹‹åï¼Œéœ€è¦é…ç½®çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä¸€ä¸ªè¯ä¹¦é¢å‘è€…ï¼Œç„¶åä½ å¯ä»¥ç”¨å®ƒæ¥ç­¾å‘è¯ä¹¦ã€‚

cert-manager å¸¦æœ‰ä¸€äº›å†…ç½®çš„è¯ä¹¦é¢å‘è€…ï¼Œå®ƒä»¬è¢«è¡¨ç¤ºä¸ºåœ¨`cert-manager.io`ç»„ä¸­ã€‚é™¤äº†å†…ç½®ç±»å‹å¤–ï¼Œä½ è¿˜å¯ä»¥å®‰è£…å¤–éƒ¨è¯ä¹¦é¢å‘è€…ã€‚å†…ç½®å’Œå¤–éƒ¨è¯ä¹¦é¢å‘è€…çš„å¾…é‡æ˜¯ä¸€æ ·çš„ï¼Œé…ç½®ä¹Ÿç±»ä¼¼ã€‚

æœ‰ä»¥ä¸‹å‡ ç§è¯ä¹¦é¢å‘è€…ç±»å‹ï¼š

*   è‡ªç­¾å (SelfSigned)
*   CAï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰
*   Hashicorp Vaultï¼ˆé‡‘åº“ï¼‰
*   Venafi (SaaS æœåŠ¡ï¼‰
*   Externalï¼ˆå¤–éƒ¨ï¼‰
*   ACMEï¼ˆè‡ªåŠ¨è¯ä¹¦ç®¡ç†ç¯å¢ƒï¼‰
    *   HTTP01
    *   DNS01

è¿™é‡Œå…ˆä¸åšè¯¦ç»†ä»‹ç»ï¼Œç›®å‰æˆ‘çš„ç¯å¢ƒæœ‰çš„è¯ä¹¦é¢å‘è€…ç¤ºä¾‹å¦‚ä¸‹ï¼š

### SelfSigned

å¦‚ä¸‹ï¼š

    apiVersion: cert-manager.io/v1
    kind: Issuer
    metadata:
      annotations:
        meta.helm.sh/release-name: cert-manager-webhook-dnspod
        meta.helm.sh/release-namespace: cert-manager
      labels:
        app: cert-manager-webhook-dnspod
        app.kubernetes.io/managed-by: Helm
        chart: cert-manager-webhook-dnspod-1.2.0
        heritage: Helm
        release: cert-manager-webhook-dnspod
      name: cert-manager-webhook-dnspod-selfsign
      namespace: cert-manager
    status:
      conditions:
        - lastTransitionTime: '2022-03-01T13:38:53Z'
          observedGeneration: 1
          reason: IsReady
          status: 'True'
          type: Ready
    spec:
      selfSigned: {}
    

### ACME - HTTP01

å¦‚ä¸‹ï¼š

    apiVersion: cert-manager.io/v1
    kind: Issuer
    metadata:
      annotations:
        meta.helm.sh/release-name: rancher
        meta.helm.sh/release-namespace: cattle-system
      generation: 2
      labels:
        app: rancher
        app.kubernetes.io/managed-by: Helm
        chart: rancher-2.6.4
        heritage: Helm
        release: rancher
      name: rancher
      namespace: cattle-system
    status:
      acme: {}
      conditions:
        - lastTransitionTime: '2022-03-08T14:34:08Z'
          message: The ACME account was registered with the ACME server
          observedGeneration: 2
          reason: ACMEAccountRegistered
          status: 'True'
          type: Ready
    spec:
      acme:
        preferredChain: ''
        privateKeySecretRef:
          name: letsencrypt-production
        server: https://acme-v02.api.letsencrypt.org/directory
        solvers:
          - http01:
              ingress: {}
    

### ACME - DNS01

å¦‚ä¸‹ï¼š

    apiVersion: cert-manager.io/v1
    kind: ClusterIssuer
    metadata:
      annotations:
        meta.helm.sh/release-name: cert-manager-webhook-dnspod
        meta.helm.sh/release-namespace: cert-manager
      labels:
        app: cert-manager-webhook-dnspod
        app.kubernetes.io/managed-by: Helm
        chart: cert-manager-webhook-dnspod-1.2.0
        heritage: Helm
        release: cert-manager-webhook-dnspod
    status:
      acme:
        lastRegisteredEmail: cuikaidong@foxmail.com
        uri: https://acme-v02.api.letsencrypt.org/acme/acct/431637010
      conditions:
        - lastTransitionTime: '2022-03-01T13:38:55Z'
          message: The ACME account was registered with the ACME server
          observedGeneration: 1
          reason: ACMEAccountRegistered
          status: 'True'
          type: Ready
    spec:
      acme:
        email: cuikaidong@foxmail.com
        preferredChain: ''
        privateKeySecretRef:
          name: cert-manager-webhook-dnspod-letsencrypt
        server: https://acme-v02.api.letsencrypt.org/directory
        solvers:
          - dns01:
              webhook:
                config:
                  secretId: <my-secret-id>
                  secretKeyRef:
                    key: secret-key
                    name: cert-manager-webhook-dnspod-secret
                  ttl: 600
                groupName: acme.imroc.cc
                solverName: dnspod
    

æ¥ä¸‹æ¥çœ‹çœ‹[è¯ä¹¦çš„ç”³è¯·æµç¨‹](https://ewhisper.cn/posts/43638/).

ç³»åˆ—æ–‡ç« 
----

*   [cert-manager TAG](https://ewhisper.cn/tags/cert-manager/)

ğŸ“šï¸ å‚è€ƒæ–‡æ¡£
--------

*   [cert-manager - cert-manager Documentation](https://cert-manager.io/docs/)
*   [ä½¿ç”¨ cert-manager ä¸º dnspod çš„åŸŸåç­¾å‘å…è´¹è¯ä¹¦ | kubernetes å­¦ä¹ ç¬”è®° (imroc.cc)](https://imroc.cc/k8s/trick/cert-manager-webhook-dnspod/)

> _ä¸‰äººè¡Œ, å¿…æœ‰æˆ‘å¸ˆ; çŸ¥è¯†å…±äº«, å¤©ä¸‹ä¸ºå…¬._ æœ¬æ–‡ç”±ä¸œé£å¾®é¸£æŠ€æœ¯åšå®¢ [EWhisper.cn](https://EWhisper.cn) ç¼–å†™.