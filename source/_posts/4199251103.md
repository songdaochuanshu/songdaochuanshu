---
layout: post
title: "åŸºäºtauri+vue3.xå¤šå¼€çª—å£|Tauriåˆ›å»ºå¤šçª—ä½“å®è·µ"
date: "2022-10-21T01:51:17.324Z"
---
åŸºäºtauri+vue3.xå¤šå¼€çª—å£|Tauriåˆ›å»ºå¤šçª—ä½“å®è·µ
===============================

æœ€è¿‘ä¸€ç§åœ¨æ£é¼“ Tauri é›†æˆ Vue3 æŠ€æœ¯å¼€å‘æ¡Œé¢ç«¯åº”ç”¨å®è·µï¼Œtauri å®ç°åˆ›å»ºå¤šçª—å£ï¼Œçª—å£ä¹‹é—´é€šè®¯åŠŸèƒ½ã€‚

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221020221729188-1785153541.png)

å¼€å§‹æ­£æ–‡ä¹‹å‰ï¼Œå…ˆæ¥äº†è§£ä¸‹ tauri ç»“åˆ vue3.js å¿«é€Ÿåˆ›å»ºé¡¹ç›®ã€‚

tauri åœ¨ github ä¸Š**staré«˜è¾¾53K+**ï¼Œè€Œä¸”å‘ˆå¿«é€Ÿå¢é•¿è¶‹åŠ¿ã€‚ç›¸æ¯”electronæ„å»ºåº”ç”¨æ›´å…·ä¼˜åŠ¿ã€‚

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221020220048910-1978522915.png)

åˆ†åˆ«ç”¨ Tauri å’Œ Electron æ‰“åŒ…æµ‹è¯•ä¸€ä¸ª _todo list_ ç¨‹åºã€‚

> Electronæ‰“åŒ…ä½“ç§¯Â Â 69Â  Mï¼ŒTauriæ‰“åŒ…ä½“ç§¯æ‰åªæœ‰Â Â 7.5Â Mã€‚

Tauri æ„å»ºçš„æ¡Œé¢åº”ç”¨ä½“ç§¯è¿œè¿œæ¯” Electron æ„å»ºçš„å°å¾—å¤šã€‚å› ä¸ºå®ƒæ”¾å¼ƒäº†ä½“ç§¯åºå¤§çš„ Chromium å†…æ ¸å’ŒNodejsï¼Œtauriå‰ç«¯é›†æˆäº† webviewï¼Œåç«¯ä½¿ç”¨ Rustã€‚è€Œä¸” Tauri æ„å»ºåº”ç”¨è¿˜æä¾›äº†è¯¸å¤šåˆå§‹åŒ–ç¨‹åºæ¨¡æ¿ï¼Œæ¯”å¦‚åŸç”Ÿ JavaScriptã€Vue2/3ã€Reactã€Svelte.jsã€SvelteKit ç­‰ã€‚

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221020221133560-518726467.png)

### å‡†å¤‡å·¥ä½œ

é¦–å…ˆæ‚¨éœ€è¦å®‰è£… Rust åŠå…¶ä»–ç³»ç»Ÿä¾èµ–ã€‚

*   "C++ ç”Ÿæˆå·¥å…·" å’Œ Windows 10 SDKã€‚
*   Tauri éœ€è¦ WebView2 æ‰èƒ½åœ¨ Windows ä¸Šå‘ˆç°ç½‘é¡µå†…å®¹ï¼Œæ‰€ä»¥æ‚¨å¿…é¡»å…ˆå®‰è£… WebView2ã€‚
*   Rust

å…·ä½“æ“ä½œï¼Œè¯·å‰å¾€Â [https://tauri.app/zh/v1/guides/getting-started/prerequisites](https://tauri.app/zh/v1/guides/getting-started/prerequisites) æ¥æŒ‰æ­¥éª¤æ“ä½œã€‚

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221020224439120-1145816253.png)

*   **åˆ›å»º tauri åˆå§‹åŒ–é¡¹ç›®**

å…·ä½“çš„å‰ç«¯æ¡†æ¶æ¨¡æ¿ï¼Œå¤§å®¶æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ã€‚

Â npm create tauri-appÂ 

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221020225003446-812943914.png)

*   **å¼€å‘/æ„å»ºæ‰“åŒ…**

Â tauri devÂ Â tauri buildÂ 

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221020225321741-878186470.png)

éå¸¸ç®€å•çš„å‡ æ­¥å°±èƒ½å¿«é€Ÿæ­å»º vue3+tauri æ¡Œé¢ç«¯æ¨¡æ¿ã€‚æ¥ä¸‹æ¥å°±èƒ½é¡ºåˆ©çš„å¼€å‘äº†ã€‚

tauri ä¹Ÿæä¾›äº†å¦‚ä¸‹å‡ ç§å¸¸ç”¨åˆ›å»ºå¤šçª—å£çš„æ–¹æ³•ã€‚

*   **tauri.conf.json**

{
  "tauri": {
    "windows": \[
      {
        "label": "external",
        "title": "Tauri App",
        "url": "https://tauri.app"
      },
      {
        "label": "local",
        "title": "Tauri",
        "url": "home.html"
      }
    \]
  }
}

*   **src-tauri/src/main.rs**

tauri::Builder::default()
  .setup(|app| {
    let docs\_window \= tauri::WindowBuilder::new(
      app,
      "external", /\* the unique window label \*/
      tauri::WindowUrl::External("https://tauri.app/".parse().unwrap())
    ).build()?;
    let local\_window \= tauri::WindowBuilder::new(
      app,
      "local",
      tauri::WindowUrl::App("index.html".into())
    ).build()?;
    Ok(())
})

*   **é€šè¿‡å‰ç«¯ JS åˆ›å»ºçª—å£ã€‚**

import { WebviewWindow } from '@tauri-apps/api/window'
const webview \= new WebviewWindow('main\_win', {
  url: '/home',
})

webview.once('tauri://created', function () {
  // webview window successfully created
})
webview.once('tauri://error', function (e) {
  // an error happened creating the webview window
})

å…·ä½“è¯¦ç»†çš„ä»‹ç»ï¼Œå¤§å®¶å¯ä»¥å»å®˜ç½‘æŸ¥çœ‹ï¼Œæ–‡æ¡£éƒ½æœ‰éå¸¸è¯¦ç»†çš„è®²è§£ã€‚

[https://tauri.app/zh/v1/guides/features/multiwindow](https://tauri.app/zh/v1/guides/features/multiwindow)

ä¸Šé¢ä»‹ç»çš„æ–¹æ³•æ¯”è¾ƒé€‚ç”¨äºä¸€äº›ç®€å•çš„çª—å£ï¼Œå¯¹äºä¸€äº›å¤æ‚å¤šå¼€çª—å£ï¼Œè¿˜å¾—å°è£…ä¸€ä¸ªçª—å£åˆ›å»ºå™¨ï¼Œç›´æ¥é€šè¿‡ä¼ å…¥å‚æ•°å¿«é€Ÿç”Ÿæˆçª—ä½“ã€‚

createWin({
    label: 'Home',
    title: 'ä¸»é¡µ',
    url: '/home',
    width: 800,
    height: 600,
})

æ–°å»ºä¸€ä¸ª windows æ–‡ä»¶å¤¹ï¼Œç”¨æ¥å°è£…çª—å£åŠè°ƒç”¨çª—å£ã€‚

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221020232022369-346214386.png)

/\*\*
 \* @desc    çª—å£å®¹å™¨
 \* @author: YXY  Qï¼š282310962
 \* @time    2022.10
 \*/

import { WebviewWindow, appWindow, getAll, getCurrent } from '@tauri-apps/api/window'
import { relaunch, exit } from '@tauri-apps/api/process'
import { emit, listen } from '@tauri-apps/api/event'

import { setWin } from './actions'

// ç³»ç»Ÿå‚æ•°é…ç½®
export const windowConfig = {
    label: null,            // çª—å£å”¯ä¸€label
    title: '',              // çª—å£æ ‡é¢˜
    url: '',                // è·¯ç”±åœ°å€url
    width: 900,             // çª—å£å®½åº¦
    height: 640,            // çª—å£é«˜åº¦
    minWidth: null,         // çª—å£æœ€å°å®½åº¦
    minHeight: null,        // çª—å£æœ€å°é«˜åº¦
    x: null,                // çª—å£ç›¸å¯¹äºå±å¹•å·¦ä¾§åæ ‡
    y: null,                // çª—å£ç›¸å¯¹äºå±å¹•é¡¶ç«¯åæ ‡
    center: true,           // çª—å£å±…ä¸­æ˜¾ç¤º
    resizable: true,        // æ˜¯å¦æ”¯æŒç¼©æ”¾
    maximized: false,       // æœ€å¤§åŒ–çª—å£
    decorations: false,     // çª—å£æ˜¯å¦æ— è¾¹æ¡†åŠå¯¼èˆªæ¡
    alwaysOnTop: false,     // ç½®é¡¶çª—å£
}

class Windows {
    constructor() {
        this.mainWin = null
    }

    // è·å–çª—å£
    getWin(label) {
        return WebviewWindow.getByLabel(label)
    }

    // è·å–å…¨éƒ¨çª—å£
    getAllWin() {
        return getAll()
    }

    // åˆ›å»ºæ–°çª—å£
    async createWin(options) {
        const args \= Object.assign({}, windowConfig, options)

        // åˆ¤æ–­çª—å£æ˜¯å¦å­˜åœ¨
        const existWin = getAll().find(w => w.label == args.label)
        if(existWin) {
            if(existWin.label.indexOf('main') == -1) {
                await existWin?.unminimize()
                await existWin?.setFocus()
                return
            }
            await existWin?.close()
        }

        // åˆ›å»ºçª—å£å¯¹è±¡
        let win = new WebviewWindow(args.label, args)
        
        // æ˜¯å¦æœ€å¤§åŒ–
        if(args.maximized && args.resizable) {
            win.maximize()
        }

        // çª—å£åˆ›å»ºå®Œæ¯•/å¤±è´¥
        win.once('tauri://created', async() => {
            console.log('window create success!')
            ...
        })

        win.once('tauri://error', async() => {
            console.log('window create error!')
        })
    }

    // å¼€å¯ä¸»è¿›ç¨‹ç›‘å¬äº‹ä»¶
    async listen() {
        // åˆ›å»ºæ–°çª—ä½“
        await listen('win-create', (event) => {
            console.log(event)
            this.createWin(JSON.parse(event.payload))
        })

        // æ˜¾ç¤ºçª—ä½“
        await listen('win-show', async(event) => {
            if(appWindow.label.indexOf('main') == -1) return
            await appWindow.show()
            await appWindow.unminimize()
            await appWindow.setFocus()
        })

        // éšè—çª—ä½“
        await listen('win-hide', async(event) => {
            if(appWindow.label.indexOf('main') == -1) return
            await appWindow.hide()
        })

        // é€€å‡ºåº”ç”¨
        await listen('win-exit', async(event) => {
            setWin('logout')
            await exit()
        })

        // é‡å¯åº”ç”¨
        await listen('win-relaunch', async(event) => {
            await relaunch()
        })

        // ä¸»/æ¸²æŸ“è¿›ç¨‹ä¼ å‚
        await listen('win-setdata', async(event) => {
            await emit('win-postdata', JSON.parse(event.payload))
        })
    }
}

export default Windows

actions.jsè¿›è¡Œä¸€äº›è°ƒç”¨å¤„ç†ã€‚

/\*\*
 \* å¤„ç†æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹çš„å¼‚æ­¥é€šä¿¡
 \*/

import { WebviewWindow } from '@tauri-apps/api/window'
import { emit } from '@tauri-apps/api/event'

/\*\*
 \* @desc åˆ›å»ºæ–°çª—å£
 \*/
export async function createWin(args) {
    await emit('win-create', args)
}

/\*\*
 \* @desc è·å–çª—å£
 \* @param args {string}
 \*/
export async function getWin(label) {
    return await WebviewWindow.getByLabel(label)
}

/\*\*
 \* @desc è®¾ç½®çª—å£
 \* @param type {string} 'show'|'hide'|'close'|'min'|'max'|'max2min'|'exit'|'relaunch'
 \*/
export async function setWin(type) {
    await emit('win-' + type)
}

/\*\*
 \* @desc ç™»å½•çª—å£
 \*/
export async function loginWin() {
    await createWin({
        label: 'Login',
        title: 'ç™»å½•',
        url: '/login',
        width: 320,
        height: 420,
        resizable: false,
        alwaysOnTop: true,
    })
}

// ...

åœ¨éœ€è¦è°ƒç”¨åˆ›å»ºçª—å£çš„.vueé¡µé¢ï¼Œå¼•å…¥actions.jsæ–‡ä»¶ã€‚

Â import { loginWin, createWin } from '@/windows/actions'Â 

const createManageWin = async() => {
    createWin({
        label: 'Manage',
        title: 'ç®¡ç†é¡µé¢',
        url: '/manage',
        width: 600,
        height: 450,
        minWidth: 300,
        minHeight: 200
    })
}

const createAboutWin \= async() => {
    createWin({
        label: 'About',
        title: 'å…³äºé¡µé¢',
        url: '/about',
        width: 500,
        height: 500,
        resizable: false,
        alwaysOnTop: true
    })
}

### ä¸€äº›æ³¨æ„ç‚¹

*   åˆ›å»ºç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221020233659627-2082559022.png)

use tauri::{
    AppHandle, Manager, 
    CustomMenuItem, SystemTray, SystemTrayEvent, SystemTrayMenu, SystemTrayMenuItem, SystemTraySubmenu
};

// æ‰˜ç›˜èœå•
pub fn menu() -> SystemTray {
    let quit \= CustomMenuItem::new("quit".to\_string(), "Quit");
    let show \= CustomMenuItem::new("show".to\_string(), "Show");
    let hide \= CustomMenuItem::new("hide".to\_string(), "Hide");
    let change\_ico \= CustomMenuItem::new("change\_ico".to\_string(), "Change Icon");
    let tray\_menu \= SystemTrayMenu::new()
        .add\_submenu(SystemTraySubmenu::new(
            "Language", // è¯­è¨€èœå•
            SystemTrayMenu::new()
                .add\_item(CustomMenuItem::new("lang\_english".to\_string(), "English"))
                .add\_item(CustomMenuItem::new("lang\_zh\_CN".to\_string(), "ç®€ä½“ä¸­æ–‡"))
                .add\_item(CustomMenuItem::new("lang\_zh\_HK".to\_string(), "ç¹ä½“ä¸­æ–‡")),
        ))
        .add\_native\_item(SystemTrayMenuItem::Separator) // åˆ†å‰²çº¿
        .add\_item(change\_ico)
        .add\_native\_item(SystemTrayMenuItem::Separator)
        .add\_item(hide)
        .add\_item(show)
        .add\_native\_item(SystemTrayMenuItem::Separator)
        .add\_item(quit);

    SystemTray::new().with\_menu(tray\_menu)
}

// æ‰˜ç›˜äº‹ä»¶
pub fn handler(app: &AppHandle, event: SystemTrayEvent) {
    match event {
        SystemTrayEvent::LeftClick {
            position: \_,
            size: \_,
            ..
        } \=> {
            println!("ç‚¹å‡»å·¦é”®");
        }
        SystemTrayEvent::RightClick {
            position: \_,
            size: \_,
            ..
        } \=> {
            println!("ç‚¹å‡»å³é”®");
        }
        SystemTrayEvent::DoubleClick {
            position: \_,
            size: \_,
            ..
        } \=> {
            println!("åŒå‡»");
        }
        SystemTrayEvent::MenuItemClick { id, .. } \=> match id.as\_str() {
            "change\_ico" => { // æ›´æ–°æ‰˜ç›˜å›¾æ ‡
                app.tray\_handle()
                    .set\_icon(tauri::Icon::Raw(
                        include\_bytes!("../icons/new.png").to\_vec()
                    ))
                    .unwrap();
            }
            lang if lang.contains("lang\_") => { // é€‰æ‹©è¯­è¨€ï¼ŒåŒ¹é… id å‰ç¼€åŒ…å« \`lang\_\` çš„äº‹ä»¶
                Lang::new(
                    app,
                    id, // ç‚¹å‡»èœå•çš„ id
                    vec!\[
                        Lang {
                            name: "English",
                            id: "lang\_english",
                        },
                        Lang {
                            name: "ç¹ä½“ä¸­æ–‡",
                            id: "lang\_zh\_HK",
                        },
                        Lang {
                            name: "ç®€ä½“ä¸­æ–‡",
                            id: "lang\_zh\_CN",
                        },
                    \],
                );
            }
            "hide" => {
                // let window = app.get\_window("main").unwrap();
                // window.show().unwrap();
                println!("ç‚¹å‡»éšè—");
            }
            "show" => {
                println!("ç‚¹å‡»æ˜¾ç¤º");
            }
            "quit" => {
                println!("ç‚¹å‡»é€€å‡º");
                std::process::exit(0);
            }
            \_ \=> {}
        },
        \_ \=> {}
    }
}

struct Lang<'a> {
    name: &'a str,
    id: &'a str,
}

impl Lang<'static> {
    fn new(app: &AppHandle, id: String, langs: Vec<Lang>) {
        // è·å–ç‚¹å‡»çš„èœå•é¡¹
        langs.iter().for\_each(|lang| {
            let handle \= app.tray\_handle().get\_item(lang.id);
            if lang.id.to\_string() == id.as\_str() {
                // è®¾ç½®èœå•åç§°
                handle.set\_title(format!("  {}", lang.name)).unwrap();
                // è¿˜å¯ä»¥ä½¿ç”¨ \`set\_selected\`ã€\`set\_enabled\` å’Œ \`set\_native\_image\`ï¼ˆä»…é™ macOSï¼‰
                handle.set\_selected(true).unwrap();
            } else {
                handle.set\_title(lang.name).unwrap();
                handle.set\_selected(false).unwrap();
            }
        });
    }
}

åˆ›å»ºæ‰˜ç›˜å›¾æ ‡ï¼Œé»˜è®¤å›¾æ ‡æ–‡ä»¶åœ¨src-tauri/iconsç›®å½•ä¸‹ã€‚å¦‚æœæƒ³ä½¿ç”¨è‡ªå®šä¹‰çš„.icoå›¾æ ‡ï¼Œå¯é€šè¿‡tauri.cong.jsonæ–‡ä»¶é…ç½®ã€‚

"systemTray": {
    "iconPath": "icons/tray.ico",
    "iconAsTemplate": true,
    "menuOnLeftClick": false
}

å¦‚æœsetIconæŠ¥é”™ï¼Œåˆ™éœ€è¦åœ¨ _src-tauri/src/Cargo.toml_ ä¸­é…ç½® **icon-ico** æˆ– **icon-png**

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221020234822038-820884678.png)

*   tauri é…ç½®è‡ªå®šä¹‰æ‹–æ‹½åŒºåŸŸã€‚

å½“åˆ›å»ºçª—å£çš„æ—¶å€™é…ç½®äº†Â decorations: falseÂ Â åˆ™ä¼šä¸æ˜¾ç¤ºçª—å£è¾¹æ¡†åŠé¡¶éƒ¨å¯¼èˆªæ ã€‚

æ­¤æ—¶åœ¨éœ€è¦æ‹–åŠ¨å…ƒç´ ä¸ŠåŠ ä¸€ä¸ªÂ Â data-tauri-drag-regionÂ å±æ€§ï¼Œå³å¯å®ç°è‡ªå®šä¹‰åŒºåŸŸæ‹–åŠ¨çª—å£åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½æœ‰äº›ç±»ä¼¼ electron ä¸­è‡ªå®šä¹‰æ‹–æ‹½Â _\-webkit-app-region: drag_

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221020235735488-1477701057.png)

ä¸è¿‡ç‚¹å‡»çª—å£å³é”®ï¼Œä¼šå‡ºç°ç³»ç»Ÿèœå•ã€‚è¿™æ ·æ˜¾å¾—åº”ç”¨ä¸å¤ŸåŸç”Ÿï¼Œå¯ä»¥ç®€å•çš„é€šè¿‡ç¦ç”¨å³é”®èœå•æ¥å±è”½åŠŸèƒ½ã€‚

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221020235957538-232201564.png)

export function disableWinMenu() {
    document.addEventListener('contextmenu', e => e.preventDefault())
}
disableWinMenu()

å¥½äº†ï¼ŒåŸºäº tauri+vue3 æ„å»ºå¤šçª—å£æ¡Œé¢åº”ç”¨å°±åˆ†äº«åˆ°è¿™é‡Œã€‚å¸Œæœ›å¯¹å¤§å®¶æœ‰ä¸¢ä¸¢å¸®åŠ©å“ˆ~~Â ğŸ˜™

**æœ€åé™„ä¸Šä¸€ä¸ª vue3+electron ä»¿macOsæ¡Œé¢UIç³»ç»Ÿ**

[https://www.cnblogs.com/xiaoyan2017/p/14926338.html](https://www.cnblogs.com/xiaoyan2017/p/14926338.html)

![](https://img2022.cnblogs.com/blog/1289798/202210/1289798-20221021000558591-284418673.gif)

æœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œæœªç»åšä¸»å…è®¸ä¸å¾—è½¬è½½ï¼Œæ¬¢è¿å¤§å®¶ä¸€èµ·äº¤æµ QQï¼ˆ282310962ï¼‰ wxï¼ˆxy190310ï¼‰