---
layout: post
title: "ç»å†äº†æºç çš„ç—›è‹¦ï¼ŒæŒæ¡DRFçš„æ ¸å¿ƒåºåˆ—åŒ–å™¨"
date: "2022-03-31T03:29:38.249Z"
---
ç»å†äº†æºç çš„ç—›è‹¦ï¼ŒæŒæ¡DRFçš„æ ¸å¿ƒåºåˆ—åŒ–å™¨
=====================

![ç»å†äº†æºç çš„ç—›è‹¦ï¼ŒæŒæ¡DRFçš„æ ¸å¿ƒåºåˆ—åŒ–å™¨](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010155407-438281478.png) DRFæ¡†æ¶æœ€æ ¸å¿ƒä¸è¿‡æ˜¯åºåˆ—åŒ–å™¨äº†ï¼Œç»§æ‰¿Serializerç±»ç¡®å®ç¹çï¼Œå­—æ®µï¼Œå­—æ®µå‚æ•°ï¼Œè€Œç»§æ‰¿ModelSerializerç±»å»åºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–å¤„ç†çš„æ—¶å€™å´ç«‹ç«¿è§å½±ï¼Œä¸éœ€è¦é‡å†™createå’Œupdateæ–¹æ³•ï¼Œå­—æ®µå’Œå­—æ®µå‚æ•°çš„ä¼ å…¥ä¹Ÿè½»å·§äº†å¾ˆå¤š~ä¸Šç¯‡èµ°è¿‡äº†æºç é‡ç¾åŒºï¼Œè¿™ç¯‡è¿˜ä¸æ¥æ‹¿æä¸€ä¸‹åºåˆ—åŒ–å™¨ï¼Ÿ

ç›®å½•

*   [DRFçš„æ ¸å¿ƒ--åºåˆ—åŒ–å™¨](#drfçš„æ ¸å¿ƒ--åºåˆ—åŒ–å™¨)
*   [åºåˆ—åŒ–å™¨](#åºåˆ—åŒ–å™¨)
    *   [ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–?](#ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–)
    *   [åºåˆ—åŒ–](#åºåˆ—åŒ–)
        *   [åºåˆ—åŒ–demo](#åºåˆ—åŒ–demo)
    *   [å­—æ®µç±»å‹](#å­—æ®µç±»å‹)
    *   [å­—æ®µå‚æ•°](#å­—æ®µå‚æ•°)
    *   [åºåˆ—åŒ–è‡ªå®šåˆ¶è¿”å›å­—æ®µ](#åºåˆ—åŒ–è‡ªå®šåˆ¶è¿”å›å­—æ®µ)
        *   [æ–¹æ³•ä¸€ï¼šåœ¨åºåˆ—åŒ–ç±»ï¼ˆserializers.pyï¼‰ä¸­å†™](#æ–¹æ³•ä¸€åœ¨åºåˆ—åŒ–ç±»serializerspyä¸­å†™)
        *   [æ–¹æ³•äºŒï¼šåœ¨è¡¨æ¨¡å‹ï¼ˆmodels.pyï¼‰ä¸­å†™](#æ–¹æ³•äºŒåœ¨è¡¨æ¨¡å‹modelspyä¸­å†™)
    *   [ååºåˆ—åŒ–](#ååºåˆ—åŒ–)
        *   [ååºåˆ—åŒ–demo](#ååºåˆ—åŒ–demo)
        *   [ååºåˆ—åŒ–ä¹‹å±€éƒ¨å’Œå…¨å±€é’©å­](#ååºåˆ—åŒ–ä¹‹å±€éƒ¨å’Œå…¨å±€é’©å­)
    *   [ModelSerializeræ¨¡å‹ç±»åºåˆ—åŒ–å™¨](#modelserializeræ¨¡å‹ç±»åºåˆ—åŒ–å™¨)
        *   [å­—æ®µå‚æ•°](#å­—æ®µå‚æ•°-1)

DRFçš„æ ¸å¿ƒ--åºåˆ—åŒ–å™¨
============

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220329232915872-881713548.png)

> ä¸Šä¸€ç¯‡ä»‹ç»äº†å¾ˆå¤šæœ‰å…³è§†å›¾ç±»ä»¥åŠDRFä¸­çš„APIViewæ‰§è¡Œæµç¨‹ã€Requestå¯¹è±¡çš„æºç åˆ†æï¼Œæºç éƒ½getäº†ğŸ‚ï¼›
> 
> DRFçš„æ ¸å¿ƒå½“ç„¶ä¸æ˜¯çŸ¥é“è§†å›¾ç±»æ‰§è¡Œæµç¨‹å°±å¯ä»¥äº†ï¼ŒDRFæ¡†æ¶çš„æ ¸å¿ƒé‚£å°±æ˜¯ **åºåˆ—åŒ–å™¨çš„ä½¿ç”¨**ï¼Œå¦‚ä½•ä½¿ç”¨åºåˆ—åŒ–å™¨å®ç° **åºåˆ—åŒ–**ã€ **ååºåˆ—åŒ–**ï¼Œä»¥åŠ**è§†å›¾**ï¼Œè¿™ç¯‡ä¼šä»‹ç»åˆ°~

åºåˆ—åŒ–å™¨
====

ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–?
------------

*   **åºåˆ—åŒ–**ï¼šåºåˆ—åŒ–å™¨ä¼šæŠŠæ¨¡å‹å¯¹è±¡ï¼ˆQuerySetå¯¹è±¡ï¼Œæ¯”å¦‚bookï¼‰è½¬æ¢æˆå­—å…¸ï¼Œç»è¿‡responseä»¥åå˜æˆäº†jsonå­—ç¬¦ä¸²
*   **ååºåˆ—åŒ–**ï¼šå°†å®¢æˆ·ç«¯ï¼ˆå‰ç«¯ï¼‰å‘é€è¿‡æ¥çš„æ•°æ®ï¼Œç»è¿‡requestä»¥åå˜æˆå­—å…¸ï¼ˆdataï¼‰ï¼Œåºåˆ—åŒ–å™¨å¯ä»¥æŠŠå­—å…¸è½¬æ¢æˆæ¨¡å‹å­˜åˆ°æ•°æ®åº“ä¸­
    *   **å­˜æ•°æ®åº“éœ€è¦æ ¡éªŒï¼Œååºåˆ—åŒ–å°±å¯ä»¥å¸®æˆ‘ä»¬å®Œæˆæ•°æ®çš„æ ¡éªŒåŠŸèƒ½**
*   é€šä¿—ç†è§£ä¸ºï¼š
    *   å“åº”ç»™å‰ç«¯çš„å†…å®¹éœ€è¦åºåˆ—åŒ–ï¼ˆç»™å‰ç«¯çœ‹ï¼‰ï¼Œå­˜æ•°æ®åº“çš„æ•°æ®å°±ååºåˆ—åŒ–ï¼›
    *   åºåˆ—åŒ–ï¼šæ¨¡å‹å¯¹è±¡----å­—å…¸---jsonå­—ç¬¦ä¸²
    *   ååºåˆ—åŒ–ï¼šjsonæ•°æ®---å­—å…¸----æ¨¡å‹å¯¹è±¡

å¯¼å…¥ï¼š`from rest_framework.serializers import Serializer`

åºåˆ—åŒ–
---

### åºåˆ—åŒ–demo

1.  åœ¨appä¸­æ–°å»ºserializer.pyï¼Œè‡ªå®šä¹‰ç±»ï¼Œç»§æ‰¿DRFæ¡†æ¶çš„**Serializer**åŠå…¶å­ç±»
2.  åœ¨ç±»ä¸­å†™è¦åºåˆ—åŒ–çš„å­—æ®µï¼ˆåºåˆ—åŒ–å“ªäº›å°±å†™å“ªäº›ï¼Œä¸åºåˆ—åŒ–çš„ä¸å†™ï¼‰
3.  ä½¿ç”¨åºåˆ—åŒ–ç±»ï¼Œè§†å›¾ç±»ä¸­ç”¨ï¼Œå¾—åˆ°åºåˆ—åŒ–ç±»å¯¹è±¡ï¼Œå¯¹è±¡.dataï¼Œé€šè¿‡Responseè¿”å›ç»™å‰ç«¯

**serializer.pyï¼šåºåˆ—åŒ–ç±»**

    from rest_framework import serializers
    
    
    # ç»§æ‰¿Serializer
    class BookSerializer(serializers.Serializer):
        '''
        max_length=32
        min_length=3  ååºåˆ—åŒ–ä¿å­˜æ ¡éªŒæ•°æ®çš„æ—¶å€™ç”¨ï¼Œåºåˆ—åŒ–ä¸ç”¨
        '''
        # å†™è¦åºåˆ—åŒ–çš„å­—æ®µ
        title = serializers.CharField()
        #  modelsä¸­ä½¿ç”¨äº†DecimalFieldï¼Œè¿™ä¸ªä½ç½®ä½¿ç”¨äº†CharFieldä¼šæŠŠå°æ•°ç±»å‹è½¬æˆå­—ç¬¦ä¸²,ä½¿ç”¨CharFieldæˆ–è€…DecimalFieldéƒ½å¯ä»¥
        # è¿™é‡Œä¸éœ€è¦æ‹…å¿ƒååºåˆ—åŒ–å­˜çš„é—®é¢˜
        price = serializers.CharField()
        authors = serializers.CharField()
    
    

**views.pyï¼šè§†å›¾ç±»**

    from rest_framework.views import APIView
    from .models import Book
    from .serializer import BookSerializer
    from rest_framework.response import Response
    
    
    # Create your views here.
    class BookView(APIView):
        def get(self, request):
            # ä»æ•°æ®åº“æŸ¥æ•°æ®ï¼Œåšåºåˆ—åŒ–
            book_list = Book.objects.all()
            # å®ä¾‹åŒ–ç±»ï¼Œä¼ å…¥åˆå§‹åŒ–çš„å‚æ•°ï¼Œinstanceå’Œmany
            '''
            instance:è¦åºåˆ—åŒ–çš„å¯¹è±¡  qsï¼Œå•ä¸ªå¯¹è±¡
            many:å¦‚æœæ˜¯qså¯¹è±¡ï¼Œmany=Trueï¼Œå¦‚æœæ˜¯å•ä¸ªå¯¹è±¡many=False
            '''
            ser = BookSerializer(instance=book_list, many=True)
            # ser.dataä½¿ç”¨æ¨¡å‹ç±»çš„å¯¹è±¡å¾—åˆ°åºåˆ—åŒ–åçš„å­—å…¸
            return Response(ser.data)
    

**urls.pyï¼šè·¯ç”±**

    path('books/', views.BookView.as_view()),
    

**model.pyï¼šæ¨¡å‹ç±»**

    from django.db import models
    
    class Book(models.Model):
        title = models.CharField(max_length=32)
        price = models.DecimalField(max_digits=5,decimal_places=2)
        authors = models.CharField(max_length=32)
    

**æµ‹è¯•**

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010216772-1993754842.png)

**æ³¨æ„**

*   è§†å›¾ç±»ä¸­çš„å‚æ•°`instance`å’Œ`many`çš„ä½¿ç”¨ï¼Œ**instance**æ˜¯è¦åºåˆ—åŒ–çš„å¯¹è±¡ï¼Œä¸€èˆ¬ä»æ•°æ®åº“ä¸­è·å–åˆ°çš„ï¼Œ**many=True**ä»£è¡¨è¦åºåˆ—åŒ–å¤šä¸ªå¯¹è±¡ï¼Œå¦‚æœæ˜¯å•ä¸ªå¯¹è±¡å°±ç­‰äº**False**
*   åºåˆ—åŒ–å™¨ä¸­ä¸è¦å†™**max\_length**ç­‰å‚æ•°ï¼Œååºåˆ—åŒ–éªŒè¯å­—æ®µç”¨
*   åœ¨å¯¹`BookSerializer`ç±»å®ä¾‹åŒ–ä¼ å…¥çš„å‚æ•°ä¸çŸ¥é“ä¼ ä»€ä¹ˆï¼Œç”±äºæˆ‘ä»¬æ²¡æœ‰å†™æ„é€ å‡½æ•°ï¼Œå»çˆ¶ç±»çœ‹éœ€è¦ä»€ä¹ˆå‚æ•°ä¼ ä»€ä¹ˆå°±å¯ä»¥äº†
*   ä½¿ç”¨æµè§ˆå™¨æµ‹å¾—æ—¶å€™ä¸€å®šè¦æ³¨å†Œ`rest_framework`

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010223943-528883255.png)

    # æºç 
    class BaseSerializer(Field):
        """
        The BaseSerializer class provides a minimal class which may be used
        for writing custom serializer implementations.
    
        Note that we strongly restrict the ordering of operations/properties
        that may be used on the serializer in order to enforce correct usage.
    
        In particular, if a `data=` argument is passed then:
    
        .is_valid() - Available.
        .initial_data - Available.
        .validated_data - Only available after calling `is_valid()`
        .errors - Only available after calling `is_valid()`
        .data - Only available after calling `is_valid()`
    
        If a `data=` argument is not passed then:
    
        .is_valid() - Not available.
        .initial_data - Not available.
        .validated_data - Not available.
        .errors - Not available.
        .data - Available.
        """
        
    BaseSerializerç±»æä¾›äº†ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„æœ€å°ç±»
    ç”¨äºç¼–å†™è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å®ç°ã€‚
    æ³¨æ„ï¼Œæˆ‘ä»¬ä¸¥æ ¼é™åˆ¶äº†æ“ä½œ/å±æ€§çš„é¡ºåº
    å¯ä»¥åœ¨åºåˆ—åŒ–å™¨ä¸Šä½¿ç”¨ï¼Œä»¥å¼ºåˆ¶æ­£ç¡®çš„ä½¿ç”¨ã€‚
    ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœä¼ é€’äº†' data= 'å‚æ•°ï¼Œåˆ™:
    .is_valid()â€”â€”å¯ç”¨ã€‚
    .initial_dataâ€”â€”å¯ç”¨ã€‚
    .validated_data -ä»…åœ¨è°ƒç”¨' is_valid() 'åå¯ç”¨
    .errors -ä»…åœ¨è°ƒç”¨' is_valid() 'åå¯ç”¨
    .data -ä»…åœ¨è°ƒç”¨' is_valid() 'åå¯ç”¨
    å¦‚æœæ²¡æœ‰ä¼ é€’' data= 'å‚æ•°ï¼Œåˆ™:
    .is_valid() -ä¸å¯ç”¨ã€‚
    .initial_data -ä¸å¯ç”¨ã€‚
    .validated_data -ä¸å¯ç”¨ã€‚
    .errors -ä¸å¯ç”¨ã€‚
    . data -å¯ç”¨ã€‚
    

å­—æ®µç±»å‹
----

**serializer.pyæ–‡ä»¶ä¸­å¸¸ç”¨çš„å­—æ®µ**

å­—æ®µ

å­—æ®µæ„é€ æ–¹å¼

**BooleanField**

BooleanField()

**NullBooleanField**

NullBooleanField()

**CharField**

CharField(max\_length=None, min\_length=None, allow\_blank=False, trim\_whitespace=True)

**EmailField**

EmailField(max\_length=None, min\_length=None, allow\_blank=False)

**RegexField**

RegexField(regex, max\_length=None, min\_length=None, allow\_blank=False)

**SlugField**

SlugField(max_length=50, min\_length=None, allow\_blank=False) æ­£åˆ™å­—æ®µï¼ŒéªŒè¯æ­£åˆ™æ¨¡å¼ \[a-zA-Z0-9_\-\]+

**URLField**

URLField(max\_length=200, min\_length=None, allow\_blank=False)

**UUIDField**

UUIDField(format=â€™hex\_verboseâ€™) format: 1) `'hex_verbose'` å¦‚`"5ce0e9a5-5ffa-654b-cee0-1238041fb31a"` 2ï¼‰ `'hex'` å¦‚ `"5ce0e9a55ffa654bcee01238041fb31a"` 3ï¼‰`'int'` - å¦‚: `"123456789012312313134124512351145145114"` 4ï¼‰`'urn'` å¦‚: `"urn:uuid:5ce0e9a5-5ffa-654b-cee0-1238041fb31a"`

**IPAddressField**

IPAddressField(protocol=â€™bothâ€™, unpack\_ipv4=False, \*\*options)

**IntegerField**

IntegerField(max\_value=None, min\_value=None)

**FloatField**

FloatField(max\_value=None, min\_value=None)

**DecimalField**

DecimalField(max\_digits, decimal\_places, coerce\_to\_string=None, max\_value=None, min\_value=None) max\_digits: æœ€å¤šä½æ•° decimal\_palces: å°æ•°ç‚¹ä½ç½®

**DateTimeField**

DateTimeField(format=api\_settings.DATETIME\_FORMAT, input\_formats=None)

**DateField**

DateField(format=api\_settings.DATE\_FORMAT, input\_formats=None)

**TimeField**

TimeField(format=api\_settings.TIME\_FORMAT, input\_formats=None)

**DurationField**

DurationField()

**ChoiceField**

ChoiceField(choices) choicesä¸Djangoçš„ç”¨æ³•ç›¸åŒ

**MultipleChoiceField**

MultipleChoiceField(choices)

**FileField**

FileField(max\_length=None, allow\_empty\_file=False, use\_url=UPLOADED\_FILES\_USE\_URL)

**ImageField**

ImageField(max\_length=None, allow\_empty\_file=False, use\_url=UPLOADED\_FILES\_USE\_URL)

**ListField**

ListField(child=, min\_length=None, max\_length=None)

**DictField**

DictField(child=)

**å¸¸ç”¨çš„æœ‰ï¼š**

      CharField
      IntegerField
      FloatField
      DecimalField
      DateTimeField
      DateField
    

**æ³¨æ„ï¼š**

    '''
    ListFieldå’ŒDictFieldåŸæ¥çš„modelsæ˜¯æ²¡æœ‰çš„ï¼Œä¸»è¦ç”¨æ¥åšååºåˆ—,å¤„ç†å‰ç«¯ä¼ å…¥çš„æ•°æ®
    '''
    æ¯”å¦‚æˆ‘ä»¬ä»å‰ç«¯æ¥æ”¶jsonæ ¼å¼æ•°æ®
    "hobby":["ç¯®çƒ","è¶³çƒ"] å¯ä»¥ç”¨ListFieldå¤„ç†
    "wife":{"name":"wh","age":20}  DictFieldç±»ä¼¼ä½¿ç”¨
    

å­—æ®µå‚æ•°
----

> å†™åœ¨ç±»ä¸­çš„å‚æ•°

**é€‰é¡¹å‚æ•°ï¼š**

å‚æ•°åç§°

ä½œç”¨

**max\_length**

æœ€å¤§é•¿åº¦ï¼ˆCharFieldï¼‰

**min\_lenght**

æœ€å°é•¿åº¦ï¼ˆCharFieldï¼‰

**allow\_blank**

æ˜¯å¦å…è®¸ä¸ºç©ºï¼ˆCharFieldï¼‰

**trim\_whitespace**

æ˜¯å¦æˆªæ–­ç©ºç™½å­—ç¬¦ï¼ˆCharFieldï¼‰

**max\_value**

æœ€å°å€¼ ï¼ˆIntegerFieldï¼‰

**min\_value**

æœ€å¤§å€¼ï¼ˆIntegerFieldï¼‰

**é€šç”¨å‚æ•°**ï¼š

å‚æ•°åç§°

è¯´æ˜

**read\_only**

è¡¨æ˜è¯¥å­—æ®µä»…ç”¨äºåºåˆ—åŒ–è¾“å‡ºï¼Œé»˜è®¤False

**write\_only**

è¡¨æ˜è¯¥å­—æ®µä»…ç”¨äºååºåˆ—åŒ–è¾“å…¥ï¼Œé»˜è®¤False

**required**

è¡¨æ˜è¯¥å­—æ®µåœ¨ååºåˆ—åŒ–æ—¶å¿…é¡»è¾“å…¥ï¼Œé»˜è®¤True

**default**

ååºåˆ—åŒ–æ—¶ä½¿ç”¨çš„é»˜è®¤å€¼

**allow\_null**

è¡¨æ˜è¯¥å­—æ®µæ˜¯å¦å…è®¸ä¼ å…¥Noneï¼Œé»˜è®¤False

**validators**

è¯¥å­—æ®µä½¿ç”¨çš„éªŒè¯å™¨(ä¸å¤ªç”¨)

**error\_messages**

åŒ…å«é”™è¯¯ç¼–å·ä¸é”™è¯¯ä¿¡æ¯çš„å­—å…¸

**label**

ç”¨äºHTMLå±•ç¤ºAPIé¡µé¢æ—¶ï¼Œæ˜¾ç¤ºçš„å­—æ®µåç§°

**help\_text**

ç”¨äºHTMLå±•ç¤ºAPIé¡µé¢æ—¶ï¼Œæ˜¾ç¤ºçš„å­—æ®µå¸®åŠ©æç¤ºä¿¡æ¯

æ€»ç»“ï¼š

    # é‡ç‚¹è®°å¿†ï¼š
    read_onlyï¼šè¡¨ç¤ºè¯¥å­—æ®µä»…ç”¨äºåºåˆ—åŒ–è¾“å‡ºï¼Œé»˜è®¤ä¸ºFasleï¼Œå¦‚æœread_only = True,è¿™ä¸ªå­—æ®µåªç”¨æ¥åšåºåˆ—åŒ–ï¼ˆå¯¹è±¡---json---å‰ç«¯ï¼‰
    
    write_only:è¡¨æ˜è¯¥å­—æ®µä»…ç”¨äºååºåˆ—åŒ–è¾“å…¥ï¼Œé»˜è®¤Falseï¼Œå¦‚æœwrite_only = True,é‚£ä¹ˆè¿™ä¸ªå­—æ®µåªç”¨æ¥åšååºåˆ—åŒ–ï¼ˆå‰ç«¯---json---å­˜æ•°æ®åº“ï¼‰
        
    # æ³¨æ„
    å¦‚æœä¸å†™read_onlyå’Œwrite_onlyè¡¨ç¤ºåŠåºåˆ—åŒ–åˆååºåˆ—åŒ–
    åƒä¸‡ä¸è¦åŒæ—¶å†™read_only=Trueå’Œwrite_only=Trueé€»è¾‘çŸ›ç›¾äº†ï¼Œéƒ½è¦å®ç°ç›´æ¥çœç•¥å³å¯
    

**demo**

    title=serializers.CharField(max_length=32,min_length=3)
    price=serializers.CharField(write_only=True,)
    author=serializers.CharField(write_only=True)
    
    # ä¸Šé¢titleå­—æ®µåŠåºåˆ—åŒ–ä¹Ÿååºåˆ—åŒ–ï¼Œpriceï¼Œauthorå­—æ®µåªååºåˆ—åŒ–
    # åºåˆ—åŒ–ç»™å‰ç«¯ï¼Œå‰ç«¯çœ‹åˆ°çš„å­—æ®µæ ·å­---ã€‹åªèƒ½çœ‹åˆ°name
    # ååºåˆ—åŒ–ï¼Œå‰ç«¯éœ€è¦ä¼ ä»€ä¹ˆè¿‡name,price,authoréƒ½ä¼ 
    

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010245651-468965342.png)

åºåˆ—åŒ–è‡ªå®šåˆ¶è¿”å›å­—æ®µ
----------

> å¦‚æœæˆ‘ä»¬æƒ³è‡ªå®šåˆ¶åºåˆ—åŒ–è¿”å›å­—æ®µçš„æ ·å¼ï¼Œå¯ä»¥ä½¿ç”¨ï¼Œæœ‰ä¸¤ç§æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šåœ¨åºåˆ—åŒ–ç±»ï¼ˆserializers.pyï¼‰ä¸­å†™

    '''serializer.py'''
    from rest_framework import serializers
    
    # ç»§æ‰¿Serializer
    class BookSerializer(serializers.Serializer):
        # å†™è¦åºåˆ—åŒ–çš„å­—æ®µ
        title = serializers.CharField(read_only=True)
        price = serializers.CharField(write_only=True)
        authors = serializers.CharField(write_only=True)
    
        # è‡ªå®šåˆ¶è¿”å›å­—æ®µ
        author_info = serializers.SerializerMethodField()
        # æ­é…æ–¹æ³•ï¼Œæ–¹æ³•åå¿…é¡»æ˜¯get_å­—æ®µåï¼Œè¯¥æ–¹æ³•è¿”å›ä»€ä¹ˆå­—æ®µï¼Œæ˜¾ç¤ºä»€ä¹ˆ
        def get_author_info(self,obj):
            # objæ˜¯å½“å‰æ•°æ®åº“bookå¯¹è±¡
            return obj.authors+'ç‰›æ°'
            # æ³¨æ„å­—ç¬¦ä¸²æ‹¼æ¥çš„é—®é¢˜
    
        price = serializers.SerializerMethodField()
        def get_price(self,obj):
            return "ä»·æ ¼æ˜¯ï¼š"+str(obj.price)
    

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010253871-162296788.png)

**æ€»ç»“ï¼š**

*   å¯ä»¥è‡ªå®šä¹‰è¿”å›çš„keyæˆ–è€…valueï¼Œæ¯”å¦‚priceå¯ä»¥è‡ªå®šä¹‰æˆprice\_downï¼Œé€šè¿‡è¿”å›å€¼æ¥æ§åˆ¶value
*   åœ¨åºåˆ—åŒ–ç±»ä¸­å†™éœ€è¦æ­é…`get_å­—æ®µ`çš„æ–¹æ³•ï¼Œæ¥è‡ªå®šåˆ¶å­—æ®µ

### æ–¹æ³•äºŒï¼šåœ¨è¡¨æ¨¡å‹ï¼ˆmodels.pyï¼‰ä¸­å†™

    '''models.py'''
    from django.db import models
    
    # Create your models here.
    class Book(models.Model):
        title = models.CharField(max_length=32)
        price = models.DecimalField(max_digits=5,decimal_places=2)
        authors = models.CharField(max_length=32)
    
    
        @property
        def price_info(self):
            return 'ä»·æ ¼æ˜¯ï¼š'+str(self.price)
    

    '''serializer.py'''
    from rest_framework import serializers
    
    # ç»§æ‰¿Serializer
    class BookSerializer(serializers.Serializer):
        # å†™è¦åºåˆ—åŒ–çš„å­—æ®µ
        title = serializers.CharField(read_only=True)
        price = serializers.CharField(write_only=True)
        authors = serializers.CharField(write_only=True)
        
        # è¯¥å­—æ®µæ˜¯ä»modelsçš„price_infoè¿”å›å€¼è·å–åˆ°çš„ï¼Œprice_infoæ–¹æ³•è¿”å›ä»€ä¹ˆï¼Œè¿™ä¸ªå­—æ®µå°±æ˜¯ä»€ä¹ˆ
        price_info = serializers.CharField()
    

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010301301-93138178.png)

**æ€»ç»“:**

*   åœ¨modelsä¸­å†™å’Œåºåˆ—åŒ–ç±»ä¸­å†™çš„åŒºåˆ«æ˜¯ï¼Œmodelsä¸­å¤„ç†å®Œè¿”å›ç»™åºåˆ—åŒ–ç±»ä¸­ç»§ç»­å½“æˆå­—æ®µå¤„ç†äº†

**æ³¨æ„:**

å¦‚æœæ˜¯è¿”å›çš„æ˜¯è¿™ç§æ ¼å¼çš„æ•°æ®ï¼Œéœ€è¦é‚£ä¹ˆåºåˆ—åŒ–ç±»ä¸­å°±ä¸èƒ½æŒ‡å®š`CharField`ç±»å‹ï¼Œè¿™æ ·ä¼šç›´æ¥è¿”å›å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸æ–¹ä¾¿åæœŸçš„å¤„ç†ï¼Œéœ€è¦æŒ‡å®šæˆListFieldç­‰ç±»å‹

    '''models.py'''
    def authors(self):
            return [{"name":"Hammer","age":18},{"name":"Hans","age":28}]
    '''serializer.py'''  
    authors = serializers.ListField()
    

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010307501-1636163210.png)

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010313075-156508972.png)

* * *

ååºåˆ—åŒ–
----

### ååºåˆ—åŒ–demo

*   æŠŠå‰ç«¯ä¼ å…¥çš„æ•°æ®ï¼Œæ”¾åˆ°Serializerå¯¹è±¡ä¸­:ser=BookSerializer(data=request.data)
    
*   æ ¡éªŒæ•°æ®ï¼šser.is\_valid()
    
*   ä¿å­˜ï¼Œser.save()ï¼Œä½†æ˜¯å¿…é¡»é‡å†™createï¼Œåœ¨åºåˆ—åŒ–ç±»ä¸­
    
    **ååºåˆ—åŒ–æ–°å¢**
    
    > POSTè¯·æ±‚å¤„ç†æ–°å¢
    
        '''views.py'''
        from rest_framework.views import APIView
        from .models import Book
        from rest_framework.response import Response
        from app01.serializer import  BookSerializer
        
        class BookView(APIView):
            
            def post(self,request):
                # ååºåˆ—åŒ–ï¼Œä¿å­˜åˆ°æ•°æ®åº“ä½¿ç”¨dataå‚æ•°
                deser = BookSerializer(data=request.data)
                # æ ¡éªŒæ•°æ®
                if deser.is_valid():
                    # ä¿å­˜éœ€è¦é‡å†™createæ–¹æ³•,ä¸ç„¶ä¸çŸ¥é“å­˜åˆ°å“ªä¸ªè¡¨
                    deser.save()
                    return Response(deser.data)
                return Response({'code':101,'msg':'æ ¡éªŒä¸é€šè¿‡','errors':deser.errors})
        
    
    > é‡å†™createæ–¹æ³•
    
        '''serializer.py'''
            def create(self, validated_data):
                # validated_dataæ˜¯æ ¡éªŒé€šè¿‡çš„æ•°æ®ï¼Œå°†æ ¡éªŒé€šè¿‡çš„æ•°æ®æ‰“æ•£å­˜å…¥æ•°æ®åº“
                book = Book.objects.create(**validated_data)
                return book
            
        
    

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010325075-776060280.png)

  

**ååºåˆ—åŒ–ä¿®æ”¹**

    # å¤„ç†ä¿®æ”¹å†å†™ä¸€ä¸ªè§†å›¾ç±»ï¼Œé˜²æ­¢getå†²çª
    class BookDetailView(APIView):
        # è·å–ä¸€æ¡çš„
        def get(self,request,pk):
            book = Book.objects.filter(pk=pk).first()
            ser = BookSerializer(instance=book)  # è¿™é‡Œè®¾ç½®äº†ä¸»é”®å€¼ï¼Œå•æ¡è®°å½•manyä¸éœ€è¦å†™
            return Response(ser.data)
        # åˆ é™¤ä¸€æ¡çš„
        def delete(self,request,pk):
            res = Book.objects.filter(pk=pk).delete()
            print(res) # (1, {'app01.Book': 1})
            # resæ˜¯å½±å“çš„è¡Œæ•°
            if res[0]>0:
                return Response({'code': 100, 'msg': 'åˆ é™¤æˆåŠŸ'})
            else:
                return  Response({'code': 103, 'msg': 'è¦åˆ é™¤çš„æ•°æ®ä¸å­˜åœ¨'})
    
        # ååºåˆ—åŒ–ä¿®æ”¹
        def put(self,request,pk):
            # ä¿®æ”¹å¤„ç†å•æ¡æ•°æ®ç”¨è¿‡pkç¡®å®šæ±‚æ”¹å“ªæ¡æ•°æ®
            book = Book.objects.filter(pk=pk).first()
            # åºåˆ—åŒ–å™¨ç±»å®ä¾‹åŒ–éœ€è¦ä¼ å…¥instanceï¼Œdataæ‰è¡¨ç¤ºä¿®æ”¹
            ser = BookSerializer(instance=book,data=request.data)
            if ser.is_valid():
                # é‡å†™updateæ–¹æ³•æ‰èƒ½å­˜å…¥
                ser.save()
                return Response(ser.data)
            return Response({'code':101,'msg':'æ ¡éªŒæœªé€šè¿‡','error':ser.errors})
    
    

> é‡å†™updateæ–¹æ³•

    '''serializer.py'''   
        def update(self, instance, validated_data):
            '''
            :param instance: è¡¨ç¤ºè¦ä¿®æ”¹çš„å¯¹è±¡
            :param validated_data: æ ¡éªŒé€šè¿‡çš„æ•°æ®
            :return: instance
            '''
            # å¦‚æœåªä¿®æ”¹ä¸€ä¸ªçš„æƒ…å†µï¼Œä»æ ¡éªŒé€šè¿‡çš„æ•°æ®ä¸­getåˆ°å…¶ä»–æ•°æ®æ˜¯noneï¼Œåšä¸€å±‚æ ¡éªŒ
            instance.title = validated_data.get('title')
            instance.price = validated_data.get('price')
            instance.authors = validated_data.get('authors')
            instance.save()  # ä¿å­˜åˆ°æ•°æ®åº“ä¸­
            return instance  # è¿”å›instanceå¯¹è±¡
    

**è·¯ç”±**

    urlpatterns = [
        path('admin/', admin.site.urls),
        path('books/', views.BookView.as_view()),
        path('books/<int:pk>', views.BookDetailView.as_view()),
    ]
    

**ä¸ºä»€ä¹ˆä¸é‡å†™å°±ä¼šæŠ›å¼‚å¸¸ï¼Ÿ**

    # æºç 
    def save(self, **kwargs):
            assert hasattr(self, '_errors'), (
                'You must call `.is_valid()` before calling `.save()`.'
            )
            
          def update(self, instance, validated_data):
            raise NotImplementedError('`update()` must be implemented.')
    
        def create(self, validated_data):
            raise NotImplementedError('`create()` must be implemented.')
    
        def save(self, **kwargs):
            assert hasattr(self, '_errors'), (
                'You must call `.is_valid()` before calling `.save()`.'
     Â·Â·Â·Â·Â·
            if self.instance is not None:
                self.instance = self.update(self.instance, validated_data)
                assert self.instance is not None, (
                    '`update()` did not return an object instance.'
                )
            else:
                self.instance = self.create(validated_data)
                assert self.instance is not None, (
                    '`create()` did not return an object instance.'
                )
    
            return self.instance
    '''
    å‘ç°å¦‚æœæˆ‘ä»¬ä¼ äº†instanceä¸æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå°±æ˜¯ä¿®æ”¹(update)ï¼Œä¸ä¼ å°±æ˜¯æ–°å¢(create)ï¼Œè°ƒç”¨saveï¼Œçˆ¶ç±»ä¸ç„¶å°±æŠ›å¼‚å¸¸
    '''
    

**æ€»ç»“**

*   ä¸ç®¡æ˜¯åºåˆ—åŒ–ä½¿ç”¨getæ–¹æ³•æˆ–è€…ååºåˆ—åŒ–ä½¿ç”¨postæ–¹æ³•éƒ½éœ€è¦åºåˆ—åŒ–ç±»å®ä¾‹åŒ–ï¼Œå¦‚æœæœ‰`instanceå‚æ•°`ä»£è¡¨æ˜¯åºåˆ—åŒ–ï¼Œå¦‚æœæœ‰`dataå‚æ•°`ä»£è¡¨æ˜¯æ–°å¢ï¼Œå¦‚æœéƒ½æœ‰å°±æ˜¯ä¿®æ”¹

**æ³¨æ„**

*   å¦‚æœä¿å­˜ä¸é‡å†™createæ–¹æ³•ï¼ŒæŠ¥é”™
    
        NotImplementedError at /books/
        `create()` must be implemented.
        
    
*   å¦‚æœä¿®æ”¹ä¸é‡å†™updateæ–¹æ³•ï¼ŒæŠ¥é”™
    
        NotImplementedError at /books/1
        `update()` must be implemented.
        
    

### ååºåˆ—åŒ–ä¹‹å±€éƒ¨å’Œå…¨å±€é’©å­

     '''serializer.py'''
        
        # å±€éƒ¨é’©å­
        def validate_title(self,attr):
            # attrå°±æ˜¯å‰ç«¯ä¼ å…¥çš„æ•°æ®
            # å±€éƒ¨æ ¡éªŒä¹¦å
            if attr.startswith('sb'):
                from django.core.exceptions import ValidationError
                raise ValidationError("åå­—ä¸èƒ½ä»¥sbå¼€å¤´")
            else:
                return attr  # æ²¡æœ‰é—®é¢˜ï¼Œæ­£å¸¸è¿”å›
    
    
        '''
        æ ¡éªŒé¡ºåº:å…ˆèµ°å­—æ®µè‡ªå·±è§„åˆ™ï¼Œå†èµ°å±€éƒ¨é’©å­ï¼Œå†èµ°å…¨å±€é’©å­
        '''
        # å…¨å±€é’©å­
        def validate(self,attrs):
            # attrsæ ¡éªŒè¿‡åçš„æ•°æ®,é€šè¿‡äº†å‰é¢æ ¡éªŒçš„è§„åˆ™
            if attrs.get('title') == attrs.get('authors'):
                from django.core.exceptions import ValidationError
                raise ValidationError('ä½œè€…åä¸èƒ½ç­‰äºä¹¦å')
            else:
                return attrs
    

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010342852-2116034521.png)

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010348802-64411222.png)

ModelSerializeræ¨¡å‹ç±»åºåˆ—åŒ–å™¨
----------------------

    # ModelSerializerå’Œè¡¨æ¨¡å‹æœ‰ç»‘å®šå…³ç³»
    class BookSerializer1(serializers.ModelSerializer):
        class Meta:
            model = Book  # æŒ‡å®šå’Œå“ªä¸ªè¡¨æœ‰å…³ç³»
            # æ‰€æœ‰å­—æ®µ
            # fields = '__all__'
            # è¿™é‡Œæ³¨æ„idå­—æ®µæ˜¯ä»è¡¨æ¨¡å‹æ˜ å°„è¿‡æ¥çš„ï¼Œautoè‡ªå¢çš„ï¼Œä¸ä¼ ä¹Ÿå¯ä»¥
            # è‡ªå®šåˆ¶çš„å­—æ®µä¸ä¼ å¿…é¡»æ³¨å†Œï¼Œåœ¨åˆ—è¡¨ä¸­
            fields = ['id', 'title', 'price', 'price_info']  # æŒ‡å®šå­—æ®µ
            extra_kwargs = {
                'title': {'write_only': True, 'max_length': 8, 'min_length': 3}
            }
        # æŒ‡å®šåºåˆ—åŒ–çš„å­—æ®µï¼šä¸¤ç§å†™æ³•ï¼šåœ¨åºåˆ—åŒ–ç±»ä¸­å†™ï¼›modelsä¸­å†™
        price_info = serializers.SerializerMethodField()
        def get_price_info(self, obj):
            return "ä»·æ ¼æ˜¯ï¼š" + str(obj.price)
        '''
        æ³¨æ„ï¼šè‡ªå®šåˆ¶å­—æ®µå¦‚æœå’Œè¡¨æ¨¡å‹è·å–åˆ°çš„å­—æ®µæ˜¯åŒåï¼Œé‚£ä¹ˆè‡ªå®šåˆ¶è¿”å›ç»™å‰ç«¯çš„å­—æ®µå€¼å°±è¢«è‡ªå®šåˆ¶è¦†ç›–äº†ï¼Œæ¯”å¦‚ï¼š
        title = serializers.SerializerMethodField()
        def get_title(self, obj):
            return "ä¹¦åæ˜¯ï¼š" + str(obj.title)
        '''
    
        #  å±€éƒ¨å’Œå…¨å±€é’©å­ï¼Œè·Ÿä¹‹å‰ä¸€æ ·ï¼Œä½†æ˜¯è¦æ³¨æ„å†™åœ¨Metaå¤–
    

psï¼šè§†å›¾ç±»ï¼Œè·¯ç”±å¤„ç†æ–¹å¼å’ŒSerializeræ˜¯ä¸€æ ·çš„

### å­—æ®µå‚æ•°

> ModelSerializerä¸­çš„å­—æ®µä¼ å‚ä¸éœ€è¦åœ¨å»æ‹¬å·å†…æŒ‡å®šäº†ï¼Œé€šè¿‡extra\_kwargsä¼ 

    extra_kwargs = {
                'title': {'write_only': True, 'max_length': 8, 'min_length': 3}
            }
    

**æ€»ç»“**

*   ModelSerializerç±»åºåˆ—åŒ–å™¨ä¸éœ€è¦é‡å†™createæ–¹æ³•å’Œupdateæ–¹æ³•äº†ï¼Œå› ä¸ºæ˜ç¡®æŒ‡å®šäº†æ“ä½œå“ªä¸ªè¡¨
*   å›ºå®šå†™æ³•ï¼ŒModelSerializerç±»å†…å†™Metaç±»ï¼Œç”¨æ¥æŒ‡å®šä¸€äº›å­—æ®µå’Œè¡¨æ¨¡å‹