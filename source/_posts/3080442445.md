---
layout: post
title: "ã€Šä¸Šä¼ é‚£äº›äº‹å„¿ä¹‹Nestä¸Koaã€‹â€”â€”æ–‡ä»¶æ ¼å¼æ€ä¹ˆäº†ï¼"
date: "2022-10-27T03:47:10.402Z"
---
ã€Šä¸Šä¼ é‚£äº›äº‹å„¿ä¹‹Nestä¸Koaã€‹â€”â€”æ–‡ä»¶æ ¼å¼æ€ä¹ˆäº†ï¼
===========================

[è½¬è½½è‡ªï¼šjuejin - é©¬ç¿ä¸æƒ³è¯´è¯](https://juejin.cn/post/7153558481155391495)

æ¦‚è¦
--

æœ¬æ–‡ä¸»è¦é’ˆå¯¹åœ¨ä½¿ç”¨nodeä½œä¸º**æœåŠ¡ç«¯**æ¥å£æ—¶ï¼Œå‰ç«¯ä¸Šä¼ ä¸Šä¼ æ–‡ä»¶è‡³**node**ä½œä¸ºä¸­è½¬ï¼Œå†æ¬¡ä¸Šä¼ è‡³**oss/cdn**çš„åœºæ™¯ã€‚ä»¥åŠé’ˆå¯¹åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¯¹åŒä¸€ä¸ªæ–‡ä»¶è¿›è¡Œ**ä¸åŒå½¢å¼**ä¹‹é—´è½¬æ¢çš„é—®é¢˜ã€‚

Blobã€Fileã€Bufferä¸stream
-----------------------

åœ¨è§£ç­”ä¸Šè¿°é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å…ˆäº†è§£ä¸€ä¸‹Blobã€Fileã€Bufferä¸streamè¿™å››è€…åˆ†åˆ«æ˜¯ä»€ä¹ˆã€‚ä»¥åŠè¿™å››è€…çš„å…³ç³»æ˜¯ä»€ä¹ˆæ ·çš„ã€‚

### Blob

> `Blob`Â å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªä¸å¯å˜ã€åŸå§‹æ•°æ®çš„ç±»æ–‡ä»¶å¯¹è±¡ã€‚

è¿™æ˜¯MDNå¯¹Blobçš„è¯´æ˜ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ‰€æœ‰çš„â€œæ•°æ®â€éƒ½å¯ä»¥ç”¨blobçš„æ ¼å¼è¿›è¡Œå­˜å‚¨ï¼Œè€Œä¸”ä¸ä¸€å®šæ˜¯ JavaScript åŸç”Ÿæ ¼å¼çš„æ•°æ®ã€‚åŒ…æ‹¬ä½†ä¸ä»…é™äº**æ–‡æœ¬ã€äºŒè¿›åˆ¶ã€æ–‡æ¡£æµ**ç­‰ã€‚è€Œé€šè¿‡Blobçš„å®ä¾‹æ–¹æ³•ï¼ˆ[`Blob.prototype.arrayBuffer()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob/arrayBuffer)ã€[`Blob.prototype.stream()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob/stream)ï¼‰ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†blobè½¬æ¢ä¸ºBufferå’ŒReadableStreamã€‚

### File

`File`æ¥å£åŸºäºÂ `Blob`ï¼Œç»§æ‰¿äº† blob çš„åŠŸèƒ½å¹¶å°†å…¶æ‰©å±•ä»¥æ”¯æŒç”¨æˆ·ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚æ¥å£æä¾›æœ‰å…³æ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¹¶å…è®¸ç½‘é¡µä¸­çš„ JavaScript è®¿é—®å…¶å†…å®¹ï¼Œä¸”å¯ä»¥ç”¨åœ¨ä»»æ„çš„ Blob ç±»å‹çš„ context ä¸­ã€‚  
  
éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒFileå¹¶æ²¡æœ‰ä»»ä½•å®šä¹‰æ–¹æ³•ï¼Œè€Œæ˜¯åªä»Blobç»§æ‰¿äº†sliceæ–¹æ³•ã€‚

### Buffer

Bufferæ˜¯æ•°æ®ä»¥äºŒè¿›åˆ¶å½¢å¼ä¸´æ—¶å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ç‰©ç†æ˜ å°„ã€‚åœ¨Nodejsä¸­ï¼ŒBufferç±»æ˜¯ç”¨äºç›´æ¥å¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„å…¨å±€ç±»å‹ã€‚å®ƒå¯ä»¥ä»¥å¤šç§æ–¹å¼æ„å»ºã€‚

### stream

Node.js ä¸­æœ‰å››ç§åŸºæœ¬çš„æµç±»å‹ï¼š

*   [`Writable`](https://nodejs.org/docs/latest-v15.x/api/stream.html#stream_class_stream_writable): å¯ä»¥å†™å…¥æ•°æ®çš„æµï¼ˆä¾‹å¦‚ï¼ŒÂ [`fs.createWriteStream()`](https://nodejs.org/docs/latest-v15.x/api/fs.html#fs_fs_createwritestream_path_options)ï¼‰ã€‚
*   [`Readable`](https://nodejs.org/docs/latest-v15.x/api/stream.html#stream_class_stream_readable)ï¼šå¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„æµï¼ˆä¾‹å¦‚ï¼ŒÂ [`fs.createReadStream()`](https://nodejs.org/docs/latest-v15.x/api/fs.html#fs_fs_createreadstream_path_options)ï¼‰ã€‚
*   [`Duplex`](https://nodejs.org/docs/latest-v15.x/api/stream.html#stream_class_stream_duplex): ä¸¤è€…éƒ½æ˜¯`Readable`å’Œçš„æµ`Writable`ï¼ˆä¾‹å¦‚ï¼ŒÂ [`net.Socket`](https://nodejs.org/docs/latest-v15.x/api/net.html#net_class_net_socket)ï¼‰ã€‚
*   [`Transform`](https://nodejs.org/docs/latest-v15.x/api/stream.html#stream_class_stream_transform)ï¼š`Duplex`å¯ä»¥åœ¨å†™å…¥å’Œè¯»å–æ•°æ®æ—¶ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®çš„æµï¼ˆä¾‹å¦‚ï¼Œ[`zlib.createDeflate()`](https://nodejs.org/docs/latest-v15.x/api/zlib.html#zlib_zlib_createdeflate_options)ï¼‰ã€‚

å¼€å‘å‰çš„è§„åˆ’
------

åœ¨æˆ‘ä»¬è¿›è¡Œæ–‡ä»¶ä¸Šä¼ çš„è¿‡ç¨‹ä¸­ï¼Œç»å†äº†ä¸¤ä¸ªé˜¶æ®µï¼š  

1.  è·å–å‰ç«¯ä¸Šä¼ çš„æ–‡ä»¶
2.  å¤„ç†æ–‡ä»¶åï¼Œè°ƒç”¨å†…éƒ¨æœåŠ¡ä¸Šä¼ è‡³cdn

å…¶å®è¿™æ ·çœ‹æ¥çš„è¯ï¼Œè¿™æ˜¯å¾ˆç®€å•çš„ä¸¤ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬åªéœ€è¦æ‹¿åˆ°**å‰ç«¯çš„æ–‡ä»¶**åä¼ é€’ç»™**å¦å¤–ä¸€ä¸ªæ¥å£**å°±å¯ä»¥äº†ï¼Œå¯æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰å‡ ä¸ªæˆ‘ä»¬ä¸å¾—å¿½è§†çš„é—®é¢˜ï¼š

1.  **æˆ‘ä»¬çš„nodeæœåŠ¡ä¸­è·å–åˆ°çš„å‰ç«¯ä¸Šä¼ çš„æ–‡ä»¶åˆ°åº•æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Ÿ**
2.  **æˆ‘ä»¬è¿›è¡Œä¸Šä¼ oss/cdnçš„æ¥å£ï¼Œéœ€è¦æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼åˆæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ**
3.  **æ–‡ä»¶åç§°å¦‚ä½•ä¿æŒä¸å˜/å¦‚ä½•è¿›è¡Œæ··æ·†ï¼Ÿ**
4.  **å¦‚ä½•å®Œæˆæ–‡ä»¶æ ¼å¼çš„æ ¡éªŒæˆ–è¿‡æ»¤ï¼Ÿ**

åªæœ‰åœ¨è€ƒè™‘æ¸…æ¥šäº†ä»¥ä¸Šè¿™äº›å†…å®¹çš„å¤„ç†ä¹‹åï¼Œæ‰åº”è¯¥æ¥è€ƒè™‘æˆ‘ä»¬æ¥å£æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘çš„å®Œå–„ä¸å¼€å‘ã€‚

å¼€å‘ä¸­çš„é—®é¢˜
------

ç”±äºä¸€äº›å†…éƒ¨åŸå› ï¼ŒNodeç«¯çš„å¼€å‘ç»å†äº†ä»koa2åˆ°expressçš„é‡æ„ã€‚æ‰€ä»¥é’ˆå¯¹ä¸¤ä¸ªæ¡†æ¶çš„æ–‡ä»¶å¤„ç†ï¼Œæˆ‘ä¹Ÿéƒ½æœ‰å¹¸ï¼ˆbushiï¼‰å…¨éƒ½ç»å†äº†ä¸€æ¬¡ã€‚

### nodeä¸Šä¼ æ ¼å¼

ç”±äºä¸Šä¼ è‡³ossçš„ç¬¬ä¸‰æ–¹æ¥å£å¯ä»¥åœ¨å‰ç«¯è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨nodeä¸­è¿›è¡Œè°ƒç”¨ï¼Œæ‰€ä»¥åœ¨Postmanä¸­å¯ä»¥æ¨¡ä»¿ä¸Šä¼ è¿‡ç¨‹ï¼Œç”±æ­¤å¯ä»¥çœ‹åˆ°ç¬¬ä¸‰æ–¹æ¥å£çœŸæ­£éœ€è¦æˆ‘ä»¬ä¼ å…¥çš„å…¶å®æ˜¯ä¸€ä¸ª`ReadStream`æ ¼å¼çš„æ–‡ä»¶ã€‚  
æ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡ä¹Ÿå¾ˆç®€å•ï¼Œé‚£å°±æ˜¯æ— è®ºæˆ‘ä»¬è·å–åˆ°ä»€ä¹ˆæ ¼å¼çš„æ–‡ä»¶ï¼Œéƒ½è½¬æ¢æˆä¸ºReadStreamæ ¼å¼å³å¯ã€‚  
![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2fd8f1227034219a1b55671fb3d9229~tplv-k3u1fbpfcp-watermark.image?)

### koa2

ä¸åŒäºåœ¨**koa**ä¸­ä½¿ç”¨**koa-bodyparser**æ¨¡å—æ¥å®Œæˆpostè¯·æ±‚çš„å¤„ç†ï¼›åœ¨**koa2**ä¸­ï¼Œä½¿ç”¨[`koa-body`](https://www.npmjs.com/package/koa-body)æ¨¡å—ä¸ä»…å¯ä»¥å®Œæˆå¯¹äºpostè¯·æ±‚çš„å¤„ç†ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿå¤„ç†æ–‡ä»¶ç±»å‹çš„ä¸Šä¼ ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬åªéœ€è¦é€šè¿‡`ctx.request.files`å³å¯è®¿é—®å‰ç«¯ä¸Šä¼ ç»™æˆ‘ä»¬çš„æ–‡ä»¶å®ä¾‹ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è·å–åˆ°çš„æ˜¯ä¸€ä¸ª`WriteStream`æ ¼å¼çš„æ–‡ä»¶ã€‚é€šè¿‡sizeã€nameã€typeç­‰å±æ€§ï¼Œå³å¯è·å–ç›¸åº”çš„å±æ€§ï¼Œç”¨äºè¿›è¡Œæ–‡ä»¶æ ¼å¼çš„**æ ¡éªŒä¸åˆ¤æ–­**ã€‚

å½“æˆ‘ç›´æ¥ä½¿ç”¨`fs.createReadStream`æ–¹æ³•å°†å®ƒè½¬æ¢ä¸ºæˆ‘ä»¬æ‰€éœ€è¦çš„æ ¼å¼æ—¶ï¼Œé—®é¢˜ä¹Ÿéšä¹‹è€Œæ¥ï¼š  
  
`ç”±äºä¸Šä¼ åçš„æ–‡ä»¶ç»è¿‡äº†koaçš„å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°çš„WriteStreamçš„pathå‘ç”Ÿäº†ä¸€äº›å˜åŒ–ï¼Œä»–å˜æˆäº†å†…å­˜ä¸­çš„ä¸€ä¸ªåœ°å€å¯¼è‡´æˆ‘ä»¬è½¬åŒ–ä¹‹åçš„æ–‡ä»¶åç§°ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œå˜æˆäº†ä¸€ä¸ªå†…å­˜ä¸­çš„åœ°å€ä¸²ã€‚`

å¾ˆæ˜¾ç„¶ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸æƒ³è¦çœ‹åˆ°çš„ï¼Œå› ä¸ºè¿™å¯¹äºæˆ‘ä»¬æ¥è¯´æ˜¯ä¸å¯æ§çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å°è¯•äº†ä¸¤ç§è§£å†³æ–¹å¼å‡æœ‰æ•ˆï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œé€‰æ‹©ã€‚

**1\. ä½¿ç”¨koa-bodyçš„é…ç½®å‚æ•°ï¼Œè¿›è¡Œåœ°å€è½¬å­˜ã€‚**

    app.use(body({
        multipart: true,
        formidable:{
            // ä¸Šä¼ å­˜æ”¾çš„è·¯åŠ²
            uploadDir: path.join(__dirname,'./temp'),
            // ä¿æŒåç¼€å\
            keepExtensions: true,
            onError(err){
               console.log(err)
            }
        }
    })); 
    

**2\. ä½¿ç”¨fså°†æ–‡ä»¶è½¬å­˜è‡³æœ¬åœ°ï¼Œä¸Šä¼ å®Œæˆåå†è¿›è¡Œåˆ é™¤**

    import * as fs from 'fs';
    
    const file = ctx.request.files.file;
    // é€šè¿‡originalnameè·å–æ–‡ä»¶åŸåç§°
    const newName = file.originalname;
    fs.writeFileSync(newName, file.path);
    const newFile = fs.createReadStream(newName);
    // ä½¿ç”¨newFileè¿›è¡Œæ–‡ä»¶ä¸Šä¼ ã€‚ã€‚ã€‚
    fs.rmSync(newName);
    

åœ¨å¤„ç†æ–‡ä»¶åç§°çš„è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥æ‰‹åŠ¨çš„ä½¿ç”¨`uuid`æ¥è¿›è¡Œåç§°çš„æ··æ·†ã€‚æœ‰äººå¯èƒ½è®¤ä¸ºï¼Œä¸ºä»€ä¹ˆå®æ„¿é‚£ä¹ˆéº»çƒ¦çš„è·å–åŸæ¥çš„åç§°ã€å†ä½¿ç”¨uuidé‡æ–°ç”Ÿæˆæ–°åç§°ï¼Œä¹Ÿä¸æ„¿æ„ç›´æ¥ä½¿ç”¨å†…å­˜åœ°å€ä½œä¸ºæ–‡ä»¶åç§°å‘¢ï¼Ÿ

å¾ˆæ˜¾ç„¶ï¼Œå› ä¸ºè¿™ä¸ªæµç¨‹å¯¹äºæˆ‘ä»¬æ¥è¯´æ˜¯**å¯æ§çš„**ã€‚

### NestJSâ•express

_ç”±äºä¸€äº›å…¬å¸å†…éƒ¨çš„å†å²åŸå› ï¼Œå¯¼è‡´åœ¨ä½¿ç”¨koa2çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç¼ºå°‘äº†ä¸€äº›swaggerç›¸å…³çš„åŠŸèƒ½å®ç°ã€‚ä¸å¾—ä¸ä½¿ç”¨NestJS+expressæ¥é‡æ„æ•´ä¸ªé¡¹ç›®_ğŸ˜­ğŸ˜­ğŸ˜­

è€Œåœ¨NestJSä¸­çš„ä¸Šä¼ ï¼Œåˆ™éœ€è¦ä½¿ç”¨NestJSæä¾›çš„**æ‹¦æˆªå™¨**`UseInterceptors`ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦ä¾èµ–`FileInterceptor`å’Œ`UploadedFile`æ¥å¯¹äºå•æ–‡ä»¶ä¸Šä¼ çš„å¤„ç†ã€‚`FileInterceptor`æ˜¯æ‹¦æˆªå™¨è´Ÿè´£å¤„ç†è¯·æ±‚æ¥å£åçš„æ–‡ä»¶ å†ä½¿ç”¨`UploadedFile`è¿›è¡Œæ–‡ä»¶æ¥æ”¶ã€‚

    import {  UploadedFile, UseInterceptors, Body, Post, Query } from '@nestjs/common';
    import {  FileInterceptor } from '@nestjs/platform-express';
    
    @Post('/upload')
    // "file" è¡¨ç¤º ä¸Šä¼ æ–‡ä»¶çš„é”®å
    @UseInterceptors(FileInterceptor('file'))
    public async uploadFileUsingPOST(
      @Query() query: any,
      @Body() body: any,
      @UploadedFile() file,
    ) {
      // bodyä¸ºform/dataä¸­çš„å…¶ä»–éæ–‡ä»¶å‚æ•°
      // queryä¸ºè¯·æ±‚ä¸­çš„Queryå‚æ•°
      console.log(file, body, query);
      return "ä¸Šä¼ æˆåŠŸ";
    }
    

ç”±äºæ€ç»´æƒ¯æ€§çš„å½±å“ï¼Œå¯¹äºæ–‡ä»¶çš„å¤„ç†äº§ç”Ÿäº†å…ˆå…¥ä¸ºä¸»çš„æ€æƒ³ï¼Œä¸‹æ„è¯†çš„è®¤ä¸ºæ¥å£ä¸­è·å–åˆ°çš„å‰ç«¯ä¸Šä¼ æ–‡ä»¶æ ¼å¼ä»ç„¶ä¸º`WriteStream`ï¼Œç»“æœåœ¨å¤„ç†è¿‡ç¨‹ä¸­å‘ç°æ–‡ä»¶æ ¼å¼å˜æˆäº†`Buffer`å½¢å¼çš„äºŒè¿›åˆ¶ã€‚å› æ­¤åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬å°±æœ‰éœ€è¦å†æ¬¡å¤„ç†ä»`Buffer`åˆ°`ReadStream`çš„è½¬æ¢ã€‚

è€Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘é¡ºä¾¿åšäº†**æ–‡ä»¶åç§°çš„æ··æ·†**ï¼Œè€Œæˆ‘é‡‡å–çš„æ–¹å¼ä¹Ÿæ˜¯ä¸€ä¸ªè¾ƒç¬¨çš„æ–¹å¼ï¼Œç›´æ¥ä¸Šä»£ç ï¼š

    import { v4 } from 'uuid';
    import * as fs from 'fs';
    
    // ä½¿ç”¨uuidä½œä¸ºæ–‡ä»¶åç§°ï¼Œå¹¶ä¸”ä¿ç•™æ–‡ä»¶åç¼€
    const newName: string = `${v4()}.${file.originalname.split('.')[1]}`;
    // å°†æ–‡ä»¶å†™å…¥æœ¬åœ°
    fs.writeFileSync(newName, file.buffer);
    // ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç”ŸæˆReadStream
    const newFile = fs.createReadStream(newName);
    // ç”Ÿæˆè¯·æ±‚ä½¿ç”¨çš„FormData
    const formData = new FormData();
    formData.append('files[]', newFile);
    
    /**
      POST formDataï¼Œå®Œæˆæ–‡ä»¶ä¸Šä¼ 
    */
    fs.rmSync(newName); // ä¸Šä¼ å®Œæˆåï¼Œç§»é™¤æœ¬åœ°æ–‡ä»¶
    

### æ–‡ä»¶æ ¼å¼æ ¡éªŒ

åœ¨è§£å†³äº†æ–‡ä»¶**ä¸Šä¼ é€»è¾‘**ä»¥åŠ**æ ¼å¼è½¬æ¢**çš„é—®é¢˜åï¼Œæˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯æ‰€æœ‰æ–‡ä»¶**ç±»å‹**éƒ½å…è®¸ä¸Šä¼ è‡³æˆ‘ä»¬çš„ossæˆ–cdnä¸Šå‘¢ï¼Ÿè¿™è¿‡ç¨‹ä¸­ä¼šä¸ä¼šæ··å…¥ä¸€äº›æˆ‘ä»¬â€œ**ä¸å–œæ¬¢**â€çš„æ–‡ä»¶ã€‚

è¿™é‡Œç®€å•ä»¥NestJSçš„é€»è¾‘ä¸ºä¾‹ï¼Œç®€å•åˆ—ä¸¾ä¸€ä¸‹ä»£ç ã€‚

    import {  UploadedFile, UseInterceptors, Body, Post, Query } from '@nestjs/common';
    import {  FileInterceptor } from '@nestjs/platform-express';
    
    @Post('/upload')
    @UseInterceptors(FileInterceptor('file'))
    public async uploadFileUsingPOST(
      @Query() query: any,
      @Body() body: any,
      @UploadedFile() file,
    ) {
      // å®šä¹‰æˆ‘ä»¬å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ç™½åå•      
      const filterType: string[] = ['image', 'video'];
      const { mimetype } = file;
      // åˆ¤æ–­å½“å‰ä¸Šä¼ è‡³æ¥å£çš„æ–‡ä»¶ç±»å‹æ˜¯å¦åœ¨ç™½åå•ä¸­ï¼Œå¦‚æœåœ¨åˆ™å…è®¸ä¸Šä¼ ï¼Œä¸åœ¨åˆ™è¿”å›é”™è¯¯ä¿¡æ¯
      if (filterType.findIndex((f: string) => mimetype.includes(f)) < 0) {
        return {
          result: -1,
          errMessage: "æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œä»…æ”¯æŒä¸Šä¼ å›¾ç‰‡ã€åŠ¨å›¾æˆ–è§†é¢‘",
          success: false
        };
      }
      return {
        result: 1,
        message: "ä¸Šä¼ æˆåŠŸ",
        success: true
      };
    }
    

æ€»ç»“
--

å…¶å®å•çº¯å°±é€»è¾‘æ¥è®²ï¼Œè¿™æ˜¯ä¸€ä»¶å¾ˆç®€å•çš„äº‹æƒ…ã€‚æ— éå°±æ˜¯æˆ‘ä»¬è·å–**æ–‡ä»¶æµ**åç”¨nodeæœåŠ¡ä½œä¸ºâ€œ**ä¸­è½¬ç«™**â€æ·»åŠ é€»è¾‘åå†ä¸Šä¼ è‡³â€œ**ç»ˆç‚¹**â€ã€‚åªä¸è¿‡é‡ç‚¹è¿˜æ˜¯åœ¨äºæˆ‘ä¸Šé¢åˆ—ä¸¾è¿‡çš„å››ä¸ªé—®é¢˜ä¸Šï¼š

> 1.  æˆ‘ä»¬çš„nodeæœåŠ¡ä¸­è·å–åˆ°çš„å‰ç«¯ä¸Šä¼ çš„æ–‡ä»¶åˆ°åº•æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Ÿ
> 2.  æˆ‘ä»¬è¿›è¡Œä¸Šä¼ oss/cdnçš„æ¥å£ï¼Œéœ€è¦æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶æ ¼å¼åˆæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ
> 3.  æ–‡ä»¶åç§°å¦‚ä½•ä¿æŒä¸å˜/å¦‚ä½•è¿›è¡Œæ··æ·†ï¼Ÿ
> 4.  å¦‚ä½•å®Œæˆæ–‡ä»¶æ ¼å¼çš„æ ¡éªŒæˆ–è¿‡æ»¤ï¼Ÿ

è€Œè§£å†³è¿™å››ä¸ªé—®é¢˜çš„é‡ç‚¹ï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ï¼š

1.  å¼„æ¸…æ¥šæˆ‘ä»¬**è·å–åˆ°çš„ç±»å‹**ä¸æˆ‘ä»¬**æœ€ç»ˆéœ€è¦çš„ç±»å‹**åˆ°åº•æ˜¯ä»€ä¹ˆï¼›
2.  å­¦ä¹ å¥½ä¸åŒæ–‡ä»¶ç±»å‹ä¹‹é—´çš„**å…³ç³»**ä¸**è½¬æ¢æ–¹å¼**ï¼›
3.  æƒ³æ˜ç™½æˆ‘ä»¬æœ€ç»ˆè¦ä¸Šä¼ çš„æ–‡ä»¶ä»¥ä¸€ä¸ªä»€ä¹ˆæ ·çš„**åå­—**æ¥è¿›è¡Œä¸Šä¼ ï¼›
4.  åšå¥½æ–‡ä»¶ç±»å‹çš„ç™½åå•æ§åˆ¶
5.  æœç»`æƒ¯æ€§æ€ç»´`ï¼Œäº†è§£æ¸…æ¥š`ä¸åŒæ¡†æ¶/æŠ€æœ¯æ ˆ`ä¹‹é—´åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒï¼Œå†ç€æ‰‹é€»è¾‘çš„å¼€å‘ã€‚

å‚è€ƒæ–‡çŒ®
----

[Blob - Web API æ¥å£å‚è€ƒ | MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)  
  
[File - Web API æ¥å£å‚è€ƒ | MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/File)  
  
[Stream | Node.js v15.14.0 Documentation](https://nodejs.org/docs/latest-v15.x/api/stream.html#stream_stream)  
  
[Buffer | Node.js v15.14.0 Documentaion](https://nodejs.org/docs/latest-v15.x/api/buffer.html#buffer_buffer)  
  
[NestJS - æ‹¦æˆªå™¨](https://docs.nestjs.cn/7/interceptors)  
  
[NestJS - æ–‡ä»¶ä¸Šä¼ ](https://docs.nestjs.cn/7/techniques?id=%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0)