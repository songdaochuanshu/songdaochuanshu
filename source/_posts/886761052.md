---
layout: post
title: "pthread_mutex_t & pthread_cond_t æ€»ç»“"
date: "2022-10-15T18:26:31.062Z"
---
pthread\_mutex\_t & pthread\_cond\_t æ€»ç»“
=======================================

pthread\_mutex\_t & pthread\_cond\_t æ€»ç»“
=======================================

ä¸€ã€å¤šçº¿ç¨‹å¹¶å‘
-------

### 1.1 å¤šçº¿ç¨‹å¹¶å‘å¼•èµ·çš„é—®é¢˜

æˆ‘ä»¬å…ˆæ¥çœ‹å¦‚ä¸‹ä»£ç ï¼š

    #include <stdio.h>
    #include <pthread.h>
    #include <unistd.h>
    #define MAX 1E7
    
    int giNum = 0;
    
    void *func1(void *arg)
    {
        int i;
        for (i = 1; i <= MAX; i++)
        {
            giNum++;
        }
        return NULL;
    }
    
    void *func2(void *arg)
    {
        int i;
        for (i = 1; i <= MAX; i++)
        {
            giNum++;
        }
        return NULL;
    }
    
    int main()
    {
        pthread_t th1;
        pthread_create(&th1, NULL, func1, NULL);
    
        pthread_t th2;
        pthread_create(&th2, NULL, func2, NULL);
    
        pthread_join(th1, NULL);
        pthread_join(th2, NULL);
    
        printf("giNum = %d\n", giNum);
    
        return 0;
    }
    

ä»£ç çš„å†…å®¹å¾ˆç®€å•ï¼š

1.  åˆ›å»ºäº†ä¸¤ä¸ªå­çº¿ç¨‹ th1ã€th2
2.  ä¸¤ä¸ªå­çº¿ç¨‹åˆ†åˆ«æ‰§è¡Œ`giNum++`æ“ä½œ
3.  æœ€åè¾“å‡º`giNum`çš„å€¼

ç›´è§‚åœ°çœ‹è¿‡å»ï¼š

*   th1 è¿è¡Œæ—¶`giNum++`è¦æ‰§è¡Œ \\(10^7\\) æ¬¡
    
*   th2 è¿è¡Œæ—¶`giNum++`ä¹Ÿè¦æ‰§è¡Œ \\(10^7\\) æ¬¡
    

ä¼¼ä¹è®¡ç®—å¾—åˆ°çš„æœ€å giNum åº”è¯¥æ˜¯ \\(2\\times10^7\\)ã€‚ä½†å®é™…ä¸Šæ˜¯è¿™æ ·çš„å—ï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿è¡Œç»“æœï¼š

![image-20221012221636410](https://img2022.cnblogs.com/blog/1494888/202210/1494888-20221015221459173-8766091.png)

å¤šæ¬¡è¿è¡Œï¼Œä½ ä¼šå‘ç°ï¼Œä»…æœ‰ä¸€æ¬¡ï¼ˆç”šè‡³æ²¡æœ‰ï¼‰ç»“æœæ˜¯æ­£ç¡®çš„ã€‚

### 1.2 çŸ¥æ ¹çŸ¥åº•

ä¸Šè¿°ä»£ç å¾—åˆ°çš„ç»“æœä¸ºä»€ä¹ˆä¸å¦‚é¡ºåºæ‰§è¡Œæ‰€é¢„æœŸçš„é‚£æ ·å‘¢ï¼Ÿå¯ä»¥ç”¨ç¨‹åºä¿®æ”¹å˜é‡å€¼æ—¶æ‰€ç»å†çš„ä¸‰ä¸ªæ­¥éª¤è§£é‡Šè¿™ä¸ªç°è±¡ï¼š

*   ä»å†…å­˜å•å…ƒè¯»å…¥å¯„å­˜å™¨
*   åœ¨å¯„å­˜å™¨ä¸­å¯¹å˜é‡æ“ä½œï¼ˆåŠ /å‡1ï¼‰
*   æŠŠæ–°å€¼å†™å›åˆ°å†…å­˜å•å…ƒ

å³å½“æˆ‘ä»¬å½“æˆ‘ä»¬æ‰§è¡Œ`giNum++`æ—¶ï¼Œåº•å±‚å‘ç”Ÿçš„äº‹ä»¶å…¶å®æ˜¯ï¼š

1.  å†…å­˜ä¸­è¯»å– giNumï¼›
2.  å°† giNum++ï¼›
3.  å°† giNum å†™å…¥åˆ°å†…å­˜ã€‚

è¿™ä¸æ˜¯ä¸€ä¸ªåŸå­åŒ–æ“ä½œï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹äº¤é”™è¿è¡Œçš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“å‘ç”Ÿç»“æœçš„ä¸¢å¤±ã€‚å› æ­¤æœ€åçš„ç»“æœè‚¯å®šæ˜¯è¦ \\(\\leq 2\\times10^7\\) çš„ã€‚è¿™ç§æƒ…å†µæœ‰ç§ä¸“æœ‰åè¯ï¼Œå« race conditionã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ã€ŒåŠ é”ã€ã€‚

äºŒã€çº¿ç¨‹é”
-----

### 2.1 äº’æ–¥é‡

å¤šçº¿ç¨‹ç¨‹åºä¸­å¯èƒ½ä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé‚£ä¹ˆå¦‚ä½•ä¿è¯æ•°æ®ä¸€è‡´å‘¢ï¼Ÿå¯ä»¥è€ƒè™‘åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®ã€‚

è€Œäº’æ–¥é‡ï¼ˆmutexï¼‰å°±æ˜¯ä¸€æŠŠé”ã€‚å¤šä¸ªçº¿ç¨‹åªæœ‰ä¸€æŠŠé”ä¸€ä¸ªé’¥åŒ™ï¼Œè°ä¸Šçš„é”å°±åªæœ‰è°èƒ½å¼€é”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¦è®¿é—®ä¸€ä¸ªå…±äº«å˜é‡æ—¶ï¼Œå…ˆç”¨é”æŠŠå˜é‡é”ä½ï¼Œç„¶åå†æ“ä½œï¼Œæ“ä½œå®Œäº†ä¹‹åå†é‡Šæ”¾æ‰é”ï¼›å½“å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿè¦è®¿é—®è¿™ä¸ªå˜é‡æ—¶ï¼Œå‘ç°è¿™ä¸ªå˜é‡è¢«é”ä½äº†ï¼Œæ— æ³•è®¿é—®ï¼Œå®ƒå°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°é”æ²¡äº†ï¼Œå®ƒå†ç»™è¿™ä¸ªå˜é‡ä¸Šä¸ªé”ï¼Œç„¶åä½¿ç”¨ï¼Œä½¿ç”¨å®Œäº†é‡Šæ”¾é”ï¼Œä»¥æ­¤è¿›è¡Œã€‚è¿™æ ·å³ä½¿æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®è¿™ä¸ªå˜é‡ï¼Œä¹Ÿå¥½åƒæ˜¯å¯¹è¿™ä¸ªå˜é‡çš„æ“ä½œæ˜¯é¡ºåºè¿›è¡Œçš„ã€‚

äº’æ–¥å˜é‡ä½¿ç”¨ç‰¹å®šçš„æ•°æ®ç±»å‹ï¼š`pthread_mutex_t`ã€‚ä½¿ç”¨äº’æ–¥é‡å‰è¦å…ˆåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–åˆåˆ†ä¸ºé™æ€åˆå§‹åŒ–å’ŒåŠ¨æ€åˆå§‹åŒ–ï¼š

*   é™æ€åˆå§‹åŒ–ï¼š`pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER`
*   åŠ¨æ€åˆå§‹åŒ–ï¼š`pthread_mutex_init(&mutex,NULL);`

> ç¬¬ä¸€ç§æ–¹æ³•ä»…å±€é™äºé™æ€åˆå§‹åŒ–çš„æ—¶å€™ä½¿ç”¨ï¼šå°†ã€Œå£°æ˜ã€å®šä¹‰ã€åˆå§‹åŒ–ã€ä¸€æ°”å‘µæˆï¼Œé™¤æ­¤ä¹‹å¤–çš„æƒ…å†µéƒ½åªèƒ½ä½¿ç”¨ pthread\_mutex\_initå‡½æ•°ã€‚

### 2.2 pthread\_mutex\_init

**å‡½æ•°åŸå‹ï¼š**int pthread\_mutex\_init(pthread\_mutex\_t \*restrict mutex, const pthread\_mutexattr\_t \*restrict attr);

**å¤´ æ–‡ ä»¶ï¼š**#include <pthread.h>

**è¿” å› å€¼ï¼š**æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›é”™è¯¯ç 

**å‚æ•°ä»‹ç»ï¼š**

1.  mutexï¼šæŒ‡å‘ pthread\_mutex\_t å£°æ˜çš„å˜é‡çš„åœ°å€
2.  attrï¼šæŒ‡å®šäº†æ–°å»ºäº’æ–¥é”çš„å±æ€§ã€‚ä¸€èˆ¬ç½®ä¸º NULLï¼ˆå¦‚æœå‚æ•°atträ¸º NULLï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„äº’æ–¥é”å±æ€§ï¼Œé»˜è®¤å±æ€§ä¸ºå¿«é€Ÿäº’æ–¥é” ï¼‰ã€‚

> restrict å…³é”®å­—åªç”¨äºé™åˆ¶æŒ‡é’ˆã€‚å‘Šè¯‰ç¼–è¯‘å™¨æ‰€æœ‰ä¿®æ”¹è¯¥æŒ‡é’ˆæŒ‡å‘å†…å­˜ä¸­çš„æ“ä½œï¼Œåªèƒ½é€šè¿‡æœ¬æŒ‡é’ˆå®Œæˆï¼Œä¸èƒ½é€šè¿‡é™¤äº†æœ¬æŒ‡é’ˆä¹‹å¤–çš„å˜é‡æˆ–æŒ‡é’ˆä¿®æ”¹ã€‚

å½“æˆ‘ä»¬é€šè¿‡ pthread\_mutex\_init() åˆå§‹åŒ–äº’æ–¥é‡åï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¸Šé”ï¼ˆpthread\_mutex\_lockï¼‰å’Œè§£é”ï¼ˆpthread\_mutex\_unlockï¼‰æ“ä½œäº†ã€‚

### 2.3 ä¸Šé” & è§£é”

ä¸Šé”

è§£é”

**å‡½æ•°åŸå‹**

pthread\_mutex\_lock(pthread\_mutex\_t \*mutex);

int pthread\_mutex\_unlock(pthread\_mutex\_t \*mutex);

**å¤´ æ–‡ ä»¶**

#include <pthread.h>

#include <pthread.h>

**è¿” å› å€¼**

æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›é”™è¯¯ç 

æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›é”™è¯¯ç 

è®©æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹äº’æ–¥é‡çš„ä½¿ç”¨æµç¨‹ï¼š

1.  é€šè¿‡ pthread\_mutex\_init() è´­ä¹°ä¸€æŠŠé”
2.  é€šè¿‡ pthread\_mutex\_lock() åŠ é”
3.  é€šè¿‡ pthread\_mutex\_unlock() è§£é”

ä¸‹é¢è®©æˆ‘ä»¬é€šè¿‡ã€Œé”ã€æ“ä½œä¿®æ”¹ä¸€ä¸‹ä¸Šè¿°ä»£ç ï¼š

    pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER; // é™æ€åˆå§‹åŒ–é”
    void *func1(void *arg)
    {
        pthread_mutex_lock(&mutex);
        puts("çº¿ç¨‹ th1 æŠ¢åˆ°é”");
        puts("çº¿ç¨‹ th1 å¼€å§‹æ‰§è¡Œ giNum++");
        int i;
        for (i = 1; i <= MAX; i++)
        {
            giNum++;
        }
        pthread_mutex_unlock(&mutex);
        return NULL;
    }
    
    void *func2(void *arg)
    {
        pthread_mutex_lock(&mutex);
        puts("çº¿ç¨‹ th2 æŠ¢åˆ°é”");
        puts("å¼€å§‹æ‰§è¡Œ giNum++");
        int i;
        for (i = 1; i <= MAX; i++)
        {
            giNum *= 2;
        }
        pthread_mutex_unlock(&mutex);
        return NULL;
    }
    

æ­¤æ—¶ï¼Œå†æ¬¡è¿è¡Œç¨‹åºï¼Œä½ ä¼šå‘ç°ä¸ç®¡è¿è¡Œå¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯ \\(giNum = 2\\times10^7\\)ã€‚

ä¸‹é¢æˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç åšä¸ªç®€å•çš„ä¿®æ”¹ï¼Œå°† func2 ä¸­çš„`giNum++`æ“ä½œä¿®æ”¹ä¸º`giNum *= 2`ï¼Œ

ä¸‰ã€æ¡ä»¶å˜é‡
------

### 3.1 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¡ä»¶å˜é‡

å¦‚æœæ²¡æœ‰æ¡ä»¶å˜é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç­‰å¾…ä¸€ä¸ªæ¡ä»¶æ»¡è¶³åˆ™ä¼šæ˜¯ä¸‹é¢è¿™æ ·çš„æ¨¡å‹ï¼š![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2022.cnblogs.com/blog/1494888/202210/1494888-20221015221458914-695880479.png)

*   é¦–å…ˆåŠ é”è¿›å…¥ä¸´ç•ŒåŒºå»æŸ¥çœ‹æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œä¸æ»¡è¶³åˆ™è§£é”ç¦»å¼€ä¸´ç•ŒåŒºï¼Œç¡çœ ä¸€æ®µæ—¶é—´å†ç»§ç»­å¾ªç¯åˆ¤æ–­ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹å¦‚æœåˆšç¦»å¼€ä¸´ç•ŒåŒºï¼Œæ¡ä»¶å˜ä¸ºæ»¡è¶³ï¼Œé‚£ä¹ˆçº¿ç¨‹å¿…é¡»è¿˜è¦ç­‰ä¸€æ®µæ—¶é—´é‡æ–°è¿›å…¥ä¸´ç•ŒåŒºæ‰èƒ½çŸ¥é“æ¡ä»¶æ»¡è¶³ï¼ˆå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œæ¡ä»¶ä¾æ—§ä¸€ç›´ä¿æŒæ»¡è¶³çš„è¯ï¼‰ï¼›å¦‚æœè¿™ä¸€å°æ®µæ—¶é—´æ¡ä»¶åˆå˜ä¸ºäº†ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹è¿˜è¦ç»§ç»­å¾ªç¯åˆ¤æ–­ï¼Œä¸æ–­åœ°åŠ é”è§£é”ï¼ˆä¼šå½±å“ä½¿ç”¨åŒä¸€æŠŠé”çš„å…¶ä»–çº¿ç¨‹ï¼‰ï¼Œè¿˜ä¸èƒ½ç¬¬ä¸€æ—¶é—´æ”¶åˆ°æ¡ä»¶æ»¡è¶³ã€‚

è¿™ç§æ¨¡å‹æ—¢è´¹æ—¶åˆå¼€é”€å¤§ï¼Œæ‰€ä»¥æ¡ä»¶å˜é‡çš„äº§ç”Ÿï¼Œæ­£æ˜¯ä¸ºäº†ä¸å¾ªç¯åŠ é”è§£é”ï¼Œå¹¶ä¸”ç¬¬ä¸€æ—¶é—´æ”¶åˆ°æ¡ä»¶æ»¡è¶³çš„é€šçŸ¥ã€‚

### 3.2 æ¡ä»¶å˜é‡å‡½æ•°ä»‹ç»

#### 3.2.1 pthread\_cond\_t

æ¡ä»¶å˜é‡ä½¿ç”¨ç‰¹å®šçš„æ•°æ®ç±»å‹ï¼š`pthread_cond_t`ã€‚ä½¿ç”¨æ¡ä»¶å˜é‡å‰è¦å…ˆåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–åˆåˆ†ä¸ºé™æ€åˆå§‹åŒ–å’ŒåŠ¨æ€åˆå§‹åŒ–ï¼š

*   é™æ€åˆå§‹åŒ–ï¼š`pthread_cond_t cond = PTHREAD_COND_INITIALIZER;`
*   åŠ¨æ€åˆå§‹åŒ–ï¼š`pthread_cond_init(&cond, NULL);`

> é™æ€åˆå§‹åŒ–çš„æ¡ä»¶å˜é‡åªèƒ½æ‹¥æœ‰é»˜è®¤çš„æ¡ä»¶å˜é‡å±æ€§ï¼Œä¸èƒ½è®¾ç½®å…¶ä»–æ¡ä»¶å˜é‡å±æ€§ã€‚

#### 3.2.2 pthread\_cond\_init

**å‡½æ•°åŸå‹ï¼š**int pthread\_cond\_init(pthread\_cond\_t \*restrict cond, const pthread\_condattr\_t \*restrict attr);

**å¤´ æ–‡ ä»¶ï¼š**#include <pthread.h>

**åŠŸ èƒ½ï¼š**å¯¹æ¡ä»¶å˜é‡åˆå§‹åŒ–

**è¿” å› å€¼ï¼š**æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›é”™è¯¯ç 

**å‚æ•°ä»‹ç»ï¼š**

1.  condï¼šéœ€è¦åˆå§‹åŒ–çš„æ¡ä»¶å˜é‡
2.  attrï¼šåˆå§‹åŒ–æ—¶æ¡ä»¶å˜é‡çš„å±æ€§ï¼Œä¸€èˆ¬ç½®ä¸º NULLï¼Œè¡¨ç¤ºä½¿ç”¨é»˜è®¤å±æ€§

#### 3.2.3 pthread\_cond\_destory

**å‡½æ•°åŸå‹ï¼š**int pthread\_cond\_destroy(pthread\_cond\_t \*cond);

**å¤´ æ–‡ ä»¶ï¼š**#include <pthread.h>

**åŠŸ èƒ½ï¼š**å¯¹æ¡ä»¶å˜é‡ååˆå§‹åŒ–ï¼ˆåœ¨æ¡ä»¶å˜é‡é‡Šæ”¾å†…å­˜ä¹‹å‰ï¼‰

**è¿” å› å€¼ï¼š**æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›é”™è¯¯ç 

**å‚æ•°ä»‹ç»ï¼š**éœ€è¦ååˆå§‹åŒ–çš„æ¡ä»¶å˜é‡

> å¤‡æ³¨ï¼šæ­¤å‡½æ•°åªæ˜¯ååˆå§‹åŒ–äº’æ–¥é‡ï¼Œå¹¶æ²¡æœ‰é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚å¦‚æœäº’æ–¥é‡æ˜¯é€šè¿‡ malloc ç­‰å‡½æ•°ç”³è¯·çš„ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ free æ‰äº’æ–¥é‡ä¹‹å‰è°ƒç”¨ pthread\_mutex\_destroy å‡½æ•°

#### 3.2.4 pthread\_cond\_wait

**å‡½æ•°åŸå‹ï¼š**int pthread\_cond\_wait(pthread\_cond\_t \*restrict cond, pthread\_mutex\_t \*restrict mutex);

**å¤´ æ–‡ ä»¶ï¼š**#include <pthread.h>

**åŠŸ èƒ½ï¼š**ç”¨äºé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰å¾…åˆ«çš„çº¿ç¨‹ä½¿ç”¨`pthread_cond_signal()`æˆ–`pthread_cond_broadcast()`æ¥å”¤é†’å®ƒ

**è¿” å› å€¼ï¼š**æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›é”™è¯¯ç 

> å‡½æ•° pthread\_cond\_wait å¿…é¡»ä¸ pthread\_mutex\_t é…å¥—ä½¿ç”¨ã€‚pthread\_cond\_wait() ä¸€æ—¦è¿›å…¥ wait çŠ¶æ€å°±ä¼šä¸»åŠ¨è°ƒç”¨ pthread\_mutex\_unlock() é‡Šæ”¾æ‰ mutexã€‚å½“å…¶ä»–çº¿ç¨‹é€šè¿‡ pthread\_cond\_signal() æˆ– pthread\_cond\_broadcast() æŠŠè¯¥çº¿ç¨‹å”¤é†’ï¼Œä½¿ pthread\_cond\_wait() è¿”å›æ—¶ï¼Œè¯¥çº¿ç¨‹åˆä¸»åŠ¨è°ƒç”¨ pthread\_mutex\_lock() æ¥è·å–è¯¥ mutexã€‚

#### 3.2.5 pthread\_cond\_signal

**å‡½æ•°åŸå‹ï¼š**int pthread\_cond\_signal(pthread\_cond\_t \*cond);

**å¤´ æ–‡ ä»¶ï¼š**#include <pthread.h>

**åŠŸ èƒ½ï¼š**å‘é€ä¸€ä¸ªä¿¡å·ç»™å¦å¤–ä¸€ä¸ªæ­£åœ¨å¤„äºé˜»å¡ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œä½¿å…¶è„±ç¦»é˜»å¡çŠ¶æ€

**è¿” å› å€¼ï¼š**æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›é”™è¯¯ç 

> ä½¿ç”¨ pthread\_cond\_signal ä¸€èˆ¬ä¸ä¼šæœ‰ã€ŒæƒŠç¾¤ç°è±¡ã€äº§ç”Ÿï¼Œå®ƒæœ€å¤šåªç»™ä¸€ä¸ªçº¿ç¨‹å‘ä¿¡å·ã€‚å‡å¦‚æœ‰å¤šä¸ªçº¿ç¨‹æ­£åœ¨é˜»å¡ç­‰å¾…ç€è¿™ä¸ªæ¡ä»¶å˜é‡çš„è¯ï¼Œé‚£ä¹ˆæ˜¯æ ¹æ®å„ç­‰å¾…çº¿ç¨‹ä¼˜å…ˆçº§çš„é«˜ä½ç¡®å®šå“ªä¸ªçº¿ç¨‹å…ˆæ¥æ”¶åˆ°ä¿¡å·å¹¶å¼€å§‹ç»§ç»­æ‰§è¡Œã€‚å¦‚æœå„çº¿ç¨‹ä¼˜å…ˆçº§ç›¸åŒï¼Œåˆ™æ ¹æ®ç­‰å¾…æ—¶é—´çš„é•¿çŸ­æ¥ç¡®å®šå“ªä¸ªçº¿ç¨‹è·å¾—ä¿¡å·ã€‚ä½†æ— è®ºå¦‚ä½•ä¸€ä¸ª pthread\_cond\_signal() è°ƒç”¨æœ€å¤šå‘ä¿¡ä¸€æ¬¡ã€‚

#### 3.2.6 pthread\_cond\_broadcast

**å‡½æ•°åŸå‹ï¼š**int pthread\_cond\_broadcast(pthread\_cond\_t \*cond);

**å¤´ æ–‡ ä»¶ï¼š**#include <pthread.h>

**åŠŸ èƒ½ï¼š**å”¤é†’ç­‰å¾…è¯¥æ¡ä»¶çš„æ‰€æœ‰çº¿ç¨‹

**è¿” å› å€¼ï¼š**æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å›é”™è¯¯ç 

> è¿™ä¸¤ä¸ªå‡½æ•° pthread\_cond\_broadcast() å’Œ pthread\_cond\_signal ç”¨äºé€šçŸ¥çº¿ç¨‹æ¡ä»¶å˜é‡å·²ç»æ»¡è¶³æ¡ä»¶ï¼ˆå˜ä¸ºçœŸï¼‰ã€‚åœ¨è°ƒç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ—¶ï¼Œæ˜¯åœ¨ç»™çº¿ç¨‹æˆ–è€…æ¡ä»¶å‘ä¿¡å·ã€‚

### 3.3 å¦‚ä½•ä½¿ç”¨æ¡ä»¶å˜é‡

æˆ‘ä»¬å¯¹ã€Œ2.3ã€ä¸­çš„å‡½æ•° func2 åšä¸ªç®€å•çš„ä¿®æ”¹ï¼š

    #define MAX 3
    
    void *func2(void *arg)
    {
        pthread_mutex_lock(&mutex);
        puts("çº¿ç¨‹ th2 æŠ¢åˆ°é”ï¼Œå¼€å§‹æ‰§è¡Œ giNum *= 2");
        int i;
        for (i = 1; i <= MAX; i++)
        {
            giNum *= 2;
        }
        pthread_mutex_unlock(&mutex);
        return NULL;
    }
    

å¯¹ func2() åšäº†ä¸ªå¾®å°çš„æ”¹åŠ¨ï¼šå°†`giNum++`ä¿®æ”¹ä¸ºäº†`giNum *= 2`ã€‚

è¿™æ ·çš„è¯ï¼Œçº¿ç¨‹æŠ¢åˆ°é”çš„é¡ºåºä¸åŒä¼šå½±å“`giNum`çš„æœ€ç»ˆç»“æœï¼š

1.  th1 å…ˆæŠ¢åˆ°é”ï¼šgiNum å…ˆæ‰§è¡ŒåŠ æ“ä½œï¼Œç„¶ååœ¨æ‰§è¡Œä¹˜æ“ä½œï¼Œæœ€ç»ˆç»“æœä¸º 24
2.  th2 å…ˆæŠ¢åˆ°é”ï¼šgiNum å…ˆæ‰§è¡Œä¹˜æ“ä½œï¼Œç„¶ååœ¨æ‰§è¡ŒåŠ æ“ä½œï¼Œæœ€ç»ˆç»“æœä¸º 3

![image-20221015163353196](https://img2022.cnblogs.com/blog/1494888/202210/1494888-20221015221458650-1976164814.png)

å¦‚æœå¦‚ä½•æ‰èƒ½åšåˆ°çº¿ç¨‹ th1 æ€»æ˜¯èƒ½å¤Ÿå…ˆæŠ¢åˆ°é”å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬é€šè¿‡æ¡ä»¶å˜é‡çš„æ–¹å¼æ¥å®ç°è¿™ä¸€æƒ³æ³•ã€‚

    #include <stdio.h>
    #include <pthread.h>
    #include <unistd.h>
    
    #define MAX 3
    #define TRUE 1
    #define FALSE 0
    
    int giNum = 0;
    int giFlag = FALSE; // TRUEï¼šæ‰§è¡Œçº¿ç¨‹ 2 çš„ä¹˜æ“ä½œ
    pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;  // é™æ€åˆå§‹åŒ–é”
    pthread_cond_t cond = PTHREAD_COND_INITIALIZER;     // é™æ€åˆå§‹åŒ–æ¡ä»¶å˜é‡
    
    void *func1(void *arg)
    {
        pthread_mutex_lock(&mutex);
        puts("çº¿ç¨‹ th1 æŠ¢åˆ°é”");
        puts("çº¿ç¨‹ th1 å¼€å§‹æ‰§è¡Œ giNum++");
        int i;
        for (i = 1; i <= MAX; i++)
        {
            giNum++;
        }
    
        giFlag = TRUE; // ä¿®æ”¹ giFlag çš„å€¼ï¼Œä½¿å¾—çº¿ç¨‹ th2 æ»¡è¶³æ¡ä»¶
        pthread_cond_signal(&cond); // å‘çº¿ç¨‹ th2 å‘å‡ºä¿¡å·
        pthread_mutex_unlock(&mutex);
        return NULL;
    }
    
    void *func2(void *arg)
    {
        pthread_mutex_lock(&mutex);
        puts("çº¿ç¨‹ th2 æŠ¢åˆ°é”");
        while (FALSE == giFlag) // ä¸æ»¡è¶³çº¿ç¨‹ th2 çš„æ‰§è¡Œæ¡ä»¶
        {
            puts("çº¿ç¨‹ th2 ä¸æ»¡è¶³æ¡ä»¶ï¼Œç­‰å¾…~");
            pthread_cond_wait(&cond, &mutex); // ç­‰å¾…è¢«è§¦å‘
        }
        puts("çº¿ç¨‹ th2 æ»¡è¶³æ¡ä»¶ï¼Œå¼€å§‹æ‰§è¡Œ giNum *= 2");
        int i;
        for (i = 1; i <= MAX; i++)
        {
            giNum *= 2;
        }
        pthread_mutex_unlock(&mutex);
        return NULL;
    }
    
    int main()
    {
        pthread_t th1;
        pthread_create(&th1, NULL, func1, NULL);
    
        pthread_t th2;
        pthread_create(&th2, NULL, func2, NULL);
    
        pthread_join(th1, NULL);
        pthread_join(th2, NULL);
    
        printf("giNum = %d\n", giNum);
    
        return 0;
    }
    

ç»è¿‡ä¿®æ”¹åçš„ä»£ç å°±å¯ä»¥ç¡®ä¿çº¿ç¨‹ th1 çš„ã€ŒåŠ ã€æ“ä½œä¼šå…ˆäºçº¿ç¨‹ th2 çš„ã€Œä¹˜ã€æ“ä½œï¼š

1.  æƒ…å†µä¸€ï¼šçº¿ç¨‹ th1 å…ˆæŠ¢åˆ°é”ï¼Œé¡ºåˆ©æ‰§è¡Œã€ŒåŠ ã€æ“ä½œï¼Œå¹¶å°†çº¿ç¨‹ th2 çš„è§¦å‘æ¡ä»¶`giFlag`ä¿®æ”¹ä¸º TRUEï¼›ç»§è€Œå½“çº¿ç¨‹ th2 æŠ¢åˆ°é”åï¼Œä¸ä¼šè¿›å…¥åˆ° while å¾ªç¯ã€‚![image-20221015210446897](https://img2022.cnblogs.com/blog/1494888/202210/1494888-20221015221458407-898846216.png)
2.  æƒ…å†µäºŒï¼šçº¿ç¨‹ th2 å…ˆæŠ¢åˆ°é”ï¼Œä½†ç”±äºæ­¤æ—¶`giFlag`ä¸º FALSEï¼Œæ‰€ä»¥ä¼šè¿›å…¥åˆ° while å¾ªç¯æ‰§è¡Œ pthread\_cond\_wait è¯­å¥ï¼Œå¹¶é˜»å¡åœ¨è¿™å„¿é‡Šæ”¾æ‰ mutexï¼›é‚£ä¹ˆæ­¤æ—¶çº¿ç¨‹ th1 å°±å¯ä»¥é¡ºåˆ©åŠ é”ï¼Œæ‰§è¡Œå®Œã€ŒåŠ ã€æ“ä½œåå°†`giFlag`ç½®ä¸º TRUEï¼Œå¹¶å‘å‡ºä¿¡å·ï¼Œä½¿å¾—çº¿ç¨‹ th2 å¯ä»¥ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚![image-20221015210511195](https://img2022.cnblogs.com/blog/1494888/202210/1494888-20221015221458020-1870776339.png)

å…³äºä¸ºä»€ä¹ˆè¦ä½¿ç”¨ while å¾ªç¯æ¥åˆ¤æ–­æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œè§£é‡Šå¦‚ä¸‹ï¼šæŸäº›åº”ç”¨ï¼Œå¦‚çº¿ç¨‹æ± ï¼Œpthread\_cond\_broadcast() å”¤é†’å…¨éƒ¨çº¿ç¨‹ï¼Œä½†æˆ‘ä»¬é€šå¸¸åªéœ€è¦ä¸€éƒ¨åˆ†çº¿ç¨‹å»åšæ‰§è¡Œä»»åŠ¡ï¼Œè€Œå…¶å®ƒçš„çº¿ç¨‹åˆ™éœ€è¦ç»§ç»­ waitï¼Œæ‰€ä»¥å¼ºçƒˆæ¨èå¯¹ pthread\_cond\_wait()  
ä½¿ç”¨ while å¾ªç¯æ¥åšæ¡ä»¶åˆ¤æ–­ã€‚

å››ã€æ·±å…¥ç†è§£æ¡ä»¶å˜é‡
----------

ä»¥ä¸‹å†…å®¹æ‘˜æŠ„è‡ª [linux ä¸‹ pthread\_cond\_t è¯¦è§£](https://blog.csdn.net/star871016/article/details/109642644)ï¼Œåšä¸»å†™çš„å¾ˆè¯¦ç»†ï¼Œé€šä¿—æ˜“æ‡‚ğŸ‘

### 4.1 æœ¬æ–‡ç›®çš„

é¦–å…ˆè¯´æ˜ï¼Œæœ¬æ–‡é‡ç‚¹ä¸åœ¨æ€ä¹ˆç”¨æ¡ä»¶å˜é‡ã€‚è¿™é‡Œæˆ‘å…ˆåˆ—å‡º apue ä¸­å¯¹äº pthread\_cond\_wait å‡½æ•°çš„è¿™ä¹ˆä¸€æ®µè¯ï¼šã€Œè°ƒç”¨è€…æŠŠ**é”ä½çš„äº’æ–¥é‡ä¼ ç»™å‡½æ•°**ï¼Œå‡½æ•°ç„¶åè‡ªåŠ¨æŠŠè°ƒç”¨çº¿ç¨‹æ”¾åˆ°ç­‰å¾…æ¡ä»¶çš„çº¿ç¨‹åˆ—è¡¨ä¸Šï¼Œ**å¯¹äº’æ–¥é‡è§£é”**ã€‚è¿™å°±å…³é—­äº†æ¡ä»¶æ£€æŸ¥å’Œçº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ç­‰å¾…æ¡ä»¶æ”¹å˜è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´çš„æ—¶é—´é€šé“ï¼Œè¿™æ ·çº¿ç¨‹å°±ä¸ä¼šé”™è¿‡æ¡ä»¶çš„ä»»ä½•å˜åŒ–ã€‚pthread\_cond\_wait è¿”å›æ—¶ï¼Œäº’æ–¥é‡å†æ¬¡è¢«é”ä½ã€‚ã€

è¿™æ®µè¯çš„ä¿¡æ¯é‡å¾ˆå¤§ï¼Œå…¶ä¸­å…³äºäº’æ–¥é‡çš„æ“ä½œå¯ä»¥ç†è§£ä¸ºä»¥ä¸‹ä¸‰ä¸ªç‚¹ï¼š

1.  è°ƒç”¨ pthread\_cond\_wait å‰éœ€è¦å…ˆå¯¹äº’æ–¥é‡ mutex ä¸Šé”ï¼Œä¹‹åæ‰èƒ½æŠŠ mutex ä¼ å…¥ pthread\_cond\_wait å‡½æ•°
2.  åœ¨ pthread\_cond\_wait å‡½æ•°å†…éƒ¨ï¼Œä¼šé¦–å…ˆå¯¹ä¼ å…¥çš„ mutex è§£é”
3.  å½“ä¿¡å·åˆ°æ¥åï¼Œpthread\_cond\_wait å‡½æ•°å†…éƒ¨åœ¨è¿”å›å‰ä¼šå»é”ä½ä¼ å…¥çš„ mutex

æˆ‘å½“æ—¶çœ‹åˆ°è¿™é‡Œï¼Œå„ç§ç–‘é—®ï¼š1ã€ä¼ å…¥å‰ä¸ºä½•è¦é”ï¼›2ã€ä¼ å…¥åä¸ºä½•è¦é‡Šæ”¾ï¼›3ã€è¿”å›æ—¶åˆä¸ºä½•å†æ¬¡é”ï¼Ÿæœ¬æ–‡å°±è¿™ä¸‰ä¸ªé—®é¢˜è¿›è¡Œè¯¦ç»†è§£é‡Šã€‚

### 4.2 ä¸‰ä¸ªé—®é¢˜

è¦å›ç­”é‚£ä¸‰ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦æ˜ç™½ã€Œç­‰å¾…ä¸å”¤é†’ã€çš„é…åˆã€‚å…¶å®è¿™ä¸ªå›¾å°±èƒ½è§£é‡Šä¸Šè¿°ä¸‰ä¸ªé—®é¢˜ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img2022.cnblogs.com/blog/1494888/202210/1494888-20221015221457559-683978807.png)

å›¾ä¸­æœ‰ä¸€ä¸ªå…³é”®ç‚¹ï¼Œå°±æ˜¯ã€Œåˆ¤æ–­æ¡ä»¶æ˜¯å¦æ»¡è¶³ã€çš„æ“ä½œï¼Œæ˜¯åœ¨ã€Œè°ƒç”¨ pthread\_cond\_wait ä¹‹å‰ã€é” mutex ä¹‹åã€å‘ç”Ÿçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ pthread\_cond\_wait ä¸å…·å¤‡åˆ¤æ–­æ¡ä»¶çš„èƒ½åŠ›ï¼Œéœ€è¦æˆ‘ä»¬åœ¨å¤–éƒ¨å†™åˆ¤æ–­è¯­å¥ï¼š

1.  æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œæ‰ä¼šè¿›å…¥ pthread\_cond\_wait
2.  è¿›å…¥ pthread\_cond\_wait å…ˆè§£é”ç„¶åå°±é©¬ä¸Šé˜»å¡
3.  pthread\_cond\_signal å”¤é†’çš„æ˜¯é˜»å¡åœ¨ pthread\_cond\_wait çš„çº¿ç¨‹

æŠŠè¿™ä¸ªåŸºæœ¬æµç¨‹å¼„æ¸…æ¥šåï¼Œå°±å¯ä»¥è§£é‡Šé‚£ä¸‰ä¸ªé—®é¢˜äº†ã€‚

#### 4.2.1 ä¼ å…¥å‰ä¸ºä½•è¦é”

> ä¼ å…¥å‰é” mutex æ˜¯ä¸ºäº†ä¿è¯çº¿ç¨‹ä»æ¡ä»¶åˆ¤æ–­åˆ°è¿›å…¥ pthread\_cond\_wait å‰ï¼Œæ¡ä»¶ä¸è¢«æ”¹å˜ã€‚

å¦‚æœæ²¡æœ‰ä¼ å…¥å‰çš„é”ï¼Œå°±ä¼šæœ‰è¿™æ ·çš„æƒ…å†µï¼šçº¿ç¨‹ A åœ¨ã€Œåˆ¤æ–­æ¡ä»¶ä¸æ»¡è¶³ä¹‹åã€è°ƒç”¨ pthread\_cond\_wait ä¹‹å‰ã€ï¼ŒA å› ä¸ºä¼‘çœ ã€åˆæˆ–è€…å› ä¸ºå¤šçº¿ç¨‹ä¸‹å¤šä¸ªçº¿ç¨‹æ‰§è¡Œé¡ºåºå’Œå¿«æ…¢çš„å› ç´ ï¼Œä»¤çº¿ç¨‹ B æ›´æ”¹äº†æ¡ä»¶ï¼Œä½¿å¾—æ¡ä»¶æ»¡è¶³ã€‚ä½†æ­¤æ—¶çº¿ç¨‹ A è¿˜æ²¡æœ‰è°ƒç”¨pthread\_cond\_waitã€‚ç­‰åˆ°çº¿ç¨‹ A å¯åŠ¨è°ƒç”¨ pthread\_cond\_wait åè™½ç„¶æ¡ä»¶æ»¡è¶³ï¼Œä½†å´æ”¶ä¸åˆ° pthread\_cond\_signal çš„å”¤é†’ï¼Œå°±ä¼šä¸€ç›´é˜»å¡ä¸‹å»ã€‚

ç»“åˆä¸‹é¢çš„ä¼ªä»£ç æ¥åŠ æ·±ç†è§£ï¼š

    /* çº¿ç¨‹Aæ‰§è¡Œå‡½æ•° */
    int giFlag = FALSE; // FALSEï¼šçº¿ç¨‹Aä¸æ»¡è¶³æ‰§è¡Œæ¡ä»¶
    void *funcA(void *arg)
    {
        // pthread_mutex_lock(&mutex); // ä¼ å…¥å‰ä¸åŠ é”
        while (FALSE == giFlag)
        {
            // åœ¨è°ƒç”¨pthread_cond_waitå‰ï¼Œçº¿ç¨‹Bå¯åŠ¨å¹¶æ‰§è¡Œäº†å‡½æ•°funcBï¼Œä¿®æ”¹æ¡ä»¶å¹¶å‘å‡ºä¿¡å·
            // ä½†æ­¤æ—¶ç”±äºçº¿ç¨‹Aè¿˜æœªæ‰§è¡Œpthread_cond_waitå‡½æ•°ï¼Œæ‰€ä»¥ä¼šå¿½ç•¥æ‰çº¿ç¨‹Bå‘å‡ºçš„ä¿¡å·
    
            // ç­‰åˆ°çº¿ç¨‹Aå¼€å§‹æ‰§è¡Œpthread_cond_waitæ—¶ï¼Œå·²ç»æ”¶ä¸åˆ°æ¥è‡ªçº¿ç¨‹Bçš„ä¿¡å·äº†ï¼Œä¼šä¸€ç›´é˜»å¡
            pthread_cond_wait(&cond, &mutex);
        }
    
        // ToDo
    
        pthread_mutex_unlock(&mutex);
        return NULL;
    }
    /* çº¿ç¨‹Bæ‰§è¡Œæ¡ä»¶ */
    void *funcB(void *arg)
    {
        pthread_mutex_lock(&mutex);
    
        // çº¿ç¨‹Bå°†giFlagç½®ä¸ºTRUEï¼Œå¹¶é€šè¿‡cond_signalå°†ä¿¡å·å‘é€ç»™äº†çº¿ç¨‹A
        giFlag = TRUE;
        pthread_cond_signal(&cond);
    
        pthread_mutex_unlock(&mutex);
        return NULL;
    }
    

#### 4.2.2 ä¼ å…¥åä¸ºä½•è¦é‡Šæ”¾

> ä¼ å…¥åè§£é”æ˜¯ä¸ºäº†æ¡ä»¶èƒ½å¤Ÿè¢«æ”¹å˜ã€‚

ä¼ å…¥åçš„è§£é”ï¼Œæ˜¯å› ä¸ºè°ƒç”¨ pthread\_cond\_signal çš„é‚£éƒ¨åˆ†ï¼Œéœ€è¦å…ˆåŠ é”æ›´æ”¹æ¡ä»¶åæ‰è°ƒç”¨ pthread\_cond\_signalï¼ˆæ›´æ”¹æ¡ä»¶ä¸ç­‰å¾…æ¡ä»¶æ»¡è¶³ï¼Œéƒ½æ˜¯é’ˆå¯¹æ¡ä»¶è¿™ä¸€ä¸ªèµ„æºçš„ç«äº‰ï¼Œæ‰€ä»¥è°ƒç”¨ pthread\_cond\_wait å’Œè°ƒç”¨ pthread\_cond\_signal çš„ä¸¤ä¸ªçº¿ç¨‹éœ€è¦åŒä¸€æŠŠé”ï¼‰ã€‚

å¦‚æœ pthread\_cond\_wait å†…ä¸å¯¹ mutex è§£é”ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨ pthread\_cond\_wait åï¼Œå…¶ä»–çº¿ç¨‹å°±ä¸èƒ½æ›´æ”¹æ¡ä»¶ï¼Œæ¡ä»¶å°±ä¼šä¸€ç›´ä¸æ»¡è¶³ã€‚

#### 4.2.3 è¿”å›æ—¶åˆä¸ºä½•å†æ¬¡é”

> 1.  è¿”å›å‰å†æ¬¡é” mutex æ˜¯ä¸ºäº†ä¿è¯æ¡ä»¶ä»ã€Œçº¿ç¨‹ä» pthread\_cond\_wait è¿”å›åã€åˆ°ã€Œå†æ¬¡æ¡ä»¶åˆ¤æ–­å‰ã€ä¸è¢«æ”¹å˜ã€‚
> 2.  ä½¿å¾—åœ¨ã€Œpthread\_cond\_signalä¹‹åã€ä¸ã€Œpthread\_mutex\_unlock ä¹‹å‰ã€å¯ä»¥æ‰§è¡Œå…¶ä»–çš„è¯­å¥ã€‚

å¯¹äº 1ï¼Œè¿™é‡Œçš„ç†ç”±ä¸ä¼ å…¥ pthread\_cond\_wait å‰é” mutex çš„ç†ç”±å·®ä¸å¤šã€‚å¦‚æœä¸é”ï¼Œé‚£ä¹ˆçº¿ç¨‹ A è°ƒç”¨ pthread\_cond\_waitåï¼Œæ¡ä»¶æ»¡è¶³ï¼Œçº¿ç¨‹ A è¢«å”¤é†’ï¼Œä» pthread\_cond\_wait è¿”å›ã€‚çº¿ç¨‹ B åœ¨æ­¤æ—¶æ›´æ”¹äº†æ¡ä»¶ï¼Œä½¿å¾—æ¡ä»¶ä¸æ»¡è¶³ï¼Œçº¿ç¨‹ A å¹¶ä¸çŸ¥é“æ¡ä»¶åˆè¢«æ›´æ”¹ï¼Œè¿˜æ˜¯ä»¥ä¸ºæ¡ä»¶æ»¡è¶³ï¼Œå°±å¯èƒ½å‡ºé”™ã€‚

å¯¹äº 2ï¼Œç”±äº mutex åœ¨è¿™æ—¶å·²ç»è¢«è¿™ä¸ªçº¿ç¨‹é”ä½ï¼Œè¿˜æ²¡æœ‰è§£é”ï¼Œæ‰€ä»¥è°ƒç”¨ pthread\_cond\_wait çš„é‚£ä¸ªçº¿ç¨‹åœ¨ pthread\_cond\_wait è¿”å›å‰çš„é” mutex çš„è¡Œä¸ºå°±ä¼šé˜»å¡ï¼Œç›´åˆ° pthread\_cond\_signal åçš„è¯­å¥æ‰§è¡Œå®Œå¹¶è§£é”ï¼Œpthread\_cond\_wait æ‰ä¼šè¿”å›ã€‚

### 4.3 pthread\_cond\_signal çš„ä¸¤ç§å†™æ³•

ç”±äº pthread\_cond\_wait è¿”å›å‰å†æ¬¡é”çš„è¡Œä¸ºï¼Œæ‰€ä»¥ pthread\_cond\_signal ä¸ä¸€å®šå¿…é¡»æ”¾åœ¨è§£é” mutexä¹‹å‰ã€‚

#### 4.3.1 å†™æ³•ä¸€

    {
        pthread_mutex_lock(&mutex);
        // ToDo
        pthread_cond_signal(&cond);
        // ToDo
        pthread_mutex_unlock(&mutex);
    }
    

ç¼ºç‚¹ï¼šåœ¨æŸäº›çº¿ç¨‹çš„å®ç°ä¸­ï¼Œä¼šé€ æˆç­‰å¾…çº¿ç¨‹ä»å†…æ ¸ä¸­è¢«å”¤é†’ï¼ˆæ¥æ”¶åˆ°äº† cond\_signal å‘å‡ºçš„ä¿¡å·)å›åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç„¶å pthread\_cond\_wait è¿”å›å‰éœ€è¦åŠ é”ï¼Œä½†æ˜¯å‘ç°é”æ²¡æœ‰è¢«é‡Šæ”¾ï¼Œåˆå›åˆ°å†…æ ¸ç©ºé—´æ‰€ä»¥ä¸€æ¥ä¸€å›ä¼šæœ‰æ€§èƒ½çš„é—®é¢˜ã€‚

ä½†æ˜¯åœ¨ LinuxThreads æˆ–è€… NPTL é‡Œé¢ï¼Œå°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚å› ä¸ºåœ¨ Linux çº¿ç¨‹ä¸­ï¼Œæœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œåˆ†åˆ«æ˜¯ cond\_wait é˜Ÿåˆ—å’Œmutex\_lock é˜Ÿåˆ—ï¼Œ cond\_signal åªæ˜¯è®©çº¿ç¨‹ä» cond\_wait é˜Ÿåˆ—ç§»åˆ° mutex\_lock é˜Ÿåˆ—ï¼Œè€Œä¸ç”¨è¿”å›åˆ°ç”¨æˆ·ç©ºé—´ï¼Œä¸ä¼šæœ‰æ€§èƒ½çš„æŸè€—ï¼Œæ‰€ä»¥Linuxä¸­è¿™æ ·ç”¨æ²¡é—®é¢˜ã€‚

#### 4.3.2 å†™æ³•äºŒ

    {
        pthread_mutex_lock(&mutex);
        // ToDo
        pthread_mutex_unlock(&mutex);
        pthread_cond_signal(&cond);
    }
    

ä¼˜ç‚¹ï¼šä¸ä¼šå‡ºç°ä¹‹å‰è¯´çš„é‚£ä¸ªæ½œåœ¨çš„æ€§èƒ½æŸè€—ï¼Œå› ä¸ºåœ¨ signal ä¹‹å‰å°±å·²ç»é‡Šæ”¾é”äº†

ç¼ºç‚¹ï¼šå¦‚æœ unlock ä¹‹å signal ä¹‹å‰ï¼Œå‘ç”Ÿè¿›ç¨‹äº¤æ¢ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆä¸æ˜¯ç­‰å¾…æ¡ä»¶çš„è¿›ç¨‹ï¼‰æ‹¿åˆ°è¿™æŠŠæ¢¦å¯ä»¥æ±‚çš„é”ååŠ é”æ“ä½œï¼Œé‚£ä¹ˆç­‰æœ€ç»ˆåˆ‡æ¢åˆ°ç­‰å¾…æ¡ä»¶çš„çº¿ç¨‹æ—¶é”è¢«åˆ«äººæ‹¿å»è¿˜æ²¡å½’è¿˜ï¼Œåªèƒ½ç»§ç»­ç­‰å¾…ã€‚

å‚è€ƒèµ„æ–™
----

*   [linuxçº¿ç¨‹äº’æ–¥é‡pthread\_mutex\_tä½¿ç”¨ç®€ä»‹](https://blog.csdn.net/guotianqing/article/details/80559865)
*   [pthread\_mutex\_t äº’æ–¥é” - ç®€ä¹¦ (jianshu.com)](https://www.jianshu.com/p/e1334db7113a)
*   [Cè¯­è¨€ä¸­pthread\_cond\_wait è¯¦è§£](https://blog.csdn.net/qq_39852676/article/details/121368186)
*   [Linuxä¸­ï¼Œpthread\_cond\_t, æ¡ä»¶å˜é‡çš„ä½¿ç”¨ä¸¾ä¾‹](https://blog.csdn.net/duan_jin_hui/article/details/68483298)
*   [linuxè¿›é˜¶52â€”â€”pthread\_cond\_t](https://blog.csdn.net/www_dong/article/details/120211090)
*   [å…³é”®å­— - restrict](https://blog.csdn.net/qazw9600/article/details/123381056)
*   [\*restrict åŠŸèƒ½](https://blog.csdn.net/quyang0602/article/details/7405560)