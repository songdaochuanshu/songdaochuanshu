---
layout: post
title: "ModelSerializeråºåˆ—åŒ–å™¨å®æˆ˜"
date: "2022-03-31T16:25:47.400Z"
---
ModelSerializeråºåˆ—åŒ–å™¨å®æˆ˜
=====================

![ModelSerializeråºåˆ—åŒ–å™¨å®æˆ˜](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331204518477-1421764727.png) ä½¿ç”¨ModelSerializeråºåˆ—åŒ–å™¨å¦‚ä½•å†™æ¥å£ï¼Ÿè¿™é‡Œæºç demoéƒ½å†™å…¨äº†~ä¸€çœ‹å°±æ‡‚ï¼

ç›®å½•

*   [ModelSerializeråºåˆ—åŒ–å™¨å®æˆ˜](#modelserializeråºåˆ—åŒ–å™¨å®æˆ˜)
*   [å•è¡¨æ“ä½œ](#å•è¡¨æ“ä½œ)
    *   [**åºåˆ—åŒ–å™¨ç±»**](#åºåˆ—åŒ–å™¨ç±»)
    *   [**è§†å›¾ç±»**](#è§†å›¾ç±»)
    *   [**è·¯ç”±**](#è·¯ç”±)
    *   [**æ¨¡å‹**](#æ¨¡å‹)
*   [å¤šè¡¨æ“ä½œ](#å¤šè¡¨æ“ä½œ)
    *   [**models.py**](#modelspy)
    *   [**serializer.py**](#serializerpy)
    *   [**views.py**](#viewspy)
    *   [urls.py](#urlspy)

ModelSerializeråºåˆ—åŒ–å™¨å®æˆ˜
---------------------

![ç»å†äº†æºç çš„ç—›è‹¦ï¼ŒæŒæ¡DRFçš„æ ¸å¿ƒåºåˆ—åŒ–å™¨](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331010155407-438281478.png)

> ä¸Šç¯‡ModelSerializeråºåˆ—åŒ–å™¨åšäº†ä¸€ä¸ªå°demoï¼Œæ¼”ç¤ºäº†å¦‚ä½•æ“ä½œå•è¡¨è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¥å®ç°äº”ä¸ªAPIçš„ä½¿ç”¨ï¼Œå¤šè¡¨å¤§å·®ä¸å·®ğŸ˜ï¼Œè¿™é‡Œå¯¹å››ä¸ªè¡¨å†™äº”ä¸ªAPIæ¥å£

å•è¡¨æ“ä½œ
----

> å•è¡¨æ“ä½œåºåˆ—åŒ–ç±»demoï¼š

### **åºåˆ—åŒ–å™¨ç±»**

    # ModelSerializerå’Œè¡¨æ¨¡å‹æœ‰ç»‘å®šå…³ç³»
    class BookSerializer1(serializers.ModelSerializer):
        class Meta:
            model = Book  # æŒ‡å®šå’Œå“ªä¸ªè¡¨æœ‰å…³ç³»
            # æ‰€æœ‰å­—æ®µ
            # fields = '__all__'
            # è¿™é‡Œæ³¨æ„idå­—æ®µæ˜¯ä»è¡¨æ¨¡å‹æ˜ å°„è¿‡æ¥çš„ï¼Œautoè‡ªå¢çš„ï¼Œä¸ä¼ ä¹Ÿå¯ä»¥
            # è‡ªå®šåˆ¶çš„å­—æ®µä¸ä¼ å¿…é¡»æ³¨å†Œï¼Œåœ¨åˆ—è¡¨ä¸­
            fields = ['id', 'title', 'price', 'price_info']  # æŒ‡å®šå­—æ®µ
            extra_kwargs = {
                'title': {'write_only': True, 'max_length': 8, 'min_length': 3}
            }
        # æŒ‡å®šåºåˆ—åŒ–çš„å­—æ®µï¼šä¸¤ç§å†™æ³•ï¼šåœ¨åºåˆ—åŒ–ç±»ä¸­å†™ï¼›modelsä¸­å†™
        price_info = serializers.SerializerMethodField()
        def get_price_info(self, obj):
            return "ä»·æ ¼æ˜¯ï¼š" + str(obj.price)
        '''
        æ³¨æ„ï¼šè‡ªå®šåˆ¶å­—æ®µå¦‚æœå’Œè¡¨æ¨¡å‹è·å–åˆ°çš„å­—æ®µæ˜¯åŒåï¼Œé‚£ä¹ˆè‡ªå®šåˆ¶è¿”å›ç»™å‰ç«¯çš„å­—æ®µå€¼å°±è¢«è‡ªå®šåˆ¶è¦†ç›–äº†ï¼Œæ¯”å¦‚ï¼š
        title = serializers.SerializerMethodField()
        def get_title(self, obj):
            return "ä¹¦åæ˜¯ï¼š" + str(obj.title)
        '''
    
        #  å±€éƒ¨å’Œå…¨å±€é’©å­ï¼Œè·Ÿä¹‹å‰ä¸€æ ·ï¼Œä½†æ˜¯è¦æ³¨æ„å†™åœ¨Metaå¤–
    

### **è§†å›¾ç±»**

    from rest_framework.views import APIView
    from .models import Book
    from rest_framework.response import Response
    from app01.serializer import  BookSerializer1
    class BookView1(APIView):
        def get(self, request):
            # ä»æ•°æ®åº“æŸ¥æ•°æ®ï¼Œåšåºåˆ—åŒ–
            book_list = Book.objects.all()
            # å®ä¾‹åŒ–ç±»ï¼Œä¼ å…¥åˆå§‹åŒ–çš„å‚æ•°ï¼Œinstanceå’Œmany
            '''
            instance:è¦åºåˆ—åŒ–çš„å¯¹è±¡  qsï¼Œå•ä¸ªå¯¹è±¡
            many:å¦‚æœæ˜¯qså¯¹è±¡ï¼Œmany=Trueï¼Œå¦‚æœæ˜¯å•ä¸ªå¯¹è±¡many=False
            '''
            ser = BookSerializer1(instance=book_list, many=True)
            # ser.dataä½¿ç”¨æ¨¡å‹ç±»çš„å¯¹è±¡å¾—åˆ°åºåˆ—åŒ–åçš„å­—å…¸
            return Response(ser.data)
    
        def post(self,request):
            # ååºåˆ—åŒ–ï¼Œä¿å­˜åˆ°æ•°æ®åº“ä½¿ç”¨dataå‚æ•°
            deser = BookSerializer1(data=request.data)
            # æ ¡éªŒæ•°æ®
            if deser.is_valid():
                # ä¿å­˜éœ€è¦é‡å†™createæ–¹æ³•,ä¸ç„¶ä¸çŸ¥é“å­˜åˆ°å“ªä¸ªè¡¨
                deser.save()
                return Response(deser.data)
            return Response({'code':101,'msg':'æ ¡éªŒä¸é€šè¿‡','errors':deser.errors})
    
    
    
    # å¤„ç†ä¿®æ”¹å†å†™ä¸€ä¸ªè§†å›¾ç±»ï¼Œé˜²æ­¢getå†²çª
    class BookDetailView1(APIView):
        def get(self,request,pk):
            book = Book.objects.filter(pk=pk).first()
            ser = BookSerializer1(instance=book)  # è¿™é‡Œè®¾ç½®äº†ä¸»é”®å€¼ï¼Œå•æ¡è®°å½•manyä¸éœ€è¦å†™
            return Response(ser.data)
        def delete(self,request,pk):
            res = Book.objects.filter(pk=pk).delete()
            print(res) # (1, {'app01.Book': 1})
            # resæ˜¯å½±å“çš„è¡Œæ•°
            if res[0]>0:
                return Response({'code': 100, 'msg': 'åˆ é™¤æˆåŠŸ'})
            else:
                return  Response({'code': 103, 'msg': 'è¦åˆ é™¤çš„æ•°æ®ä¸å­˜åœ¨'})
    
        # ååºåˆ—åŒ–ä¿®æ”¹
        def put(self,request,pk):
            # ä¿®æ”¹å¤„ç†å•æ¡æ•°æ®ç”¨è¿‡pkç¡®å®šæ±‚æ”¹å“ªæ¡æ•°æ®
            book = Book.objects.filter(pk=pk).first()
            # åºåˆ—åŒ–å™¨ç±»å®ä¾‹åŒ–éœ€è¦ä¼ å…¥instanceï¼Œdataæ‰è¡¨ç¤ºä¿®æ”¹
            ser = BookSerializer1(instance=book,data=request.data)
            if ser.is_valid():
                # é‡å†™updateæ–¹æ³•æ‰èƒ½å­˜å…¥
                ser.save()
                return Response(ser.data)
            return Response({'code':101,'msg':'æ ¡éªŒæœªé€šè¿‡','error':ser.errors})
    

### **è·¯ç”±**

    path('books1/', views.BookView1.as_view()),
    path('books1/<int:pk>', views.BookDetailView1.as_view()),
    

### **æ¨¡å‹**

    from django.db import models
    class Book(models.Model):
        title = models.CharField(max_length=32)
        price = models.DecimalField(max_digits=5,decimal_places=2)
        authors = models.CharField(max_length=32)
    

å¤šè¡¨æ“ä½œ
----

### **models.py**

    from django.db import models
    
    
    
    # build four model tables
    
    class Book(models.Model):
        name = models.CharField(max_length=32)
        price = models.DecimalField(decimal_places=2, max_digits=5)
        publish = models.ForeignKey(to='Publish', on_delete=models.CASCADE)
        authors = models.ManyToManyField(to='Author')
    
        def __str__(self):
            return self.name
    
        # è‡ªå®šåˆ¶å­—æ®µ
        @property
        def publish_detail(self):
            return {'name': self.publish.name, 'addr': self.publish.city}
    
        @property
        def author_list(self):
            l = []
            print(self.authors.all()) # <QuerySet [<Author: Author object (1)>, <Author: Author object (2)>]>
            for author in self.authors.all():
                print(author.author_detail) # AuthorDetail object (1)
                l.append({'name': author.name, 'age': author.age, 'addr': author.author_detail.addr})
            return l
    
    
    class Author(models.Model):
        name = models.CharField(max_length=32)
        age = models.IntegerField()
        author_detail = models.OneToOneField(to='AuthorDetail', on_delete=models.CASCADE)
    
        def __str__(self):
            return self.name
    
        @property
        def authordetail_info(self):
            return {'phone':self.author_detail.telephone,'addr':self.author_detail.addr}
    
    
    class AuthorDetail(models.Model):
        telephone = models.BigIntegerField()
        addr = models.CharField(max_length=64)
    
    
    class Publish(models.Model):
        name = models.CharField(max_length=32)
        city = models.CharField(max_length=32)
        email = models.EmailField()
    
    

### **serializer.py**

    from app01 import models
    from rest_framework import serializers
    
    
    # ä¹¦åºåˆ—åŒ–å™¨
    class BookSerializer(serializers.ModelSerializer):
        class Meta:
            # æŒ‡å®šå’Œå“ªä¸ªè¡¨æœ‰å…³ç³»
            model = models.Book
            # fields = '__all__'
            fields = ['id','name','price','publish','authors','publish_detail','author_list']
            # å°†å…³è”è¡¨çš„ä¿¡æ¯å…¨éƒ¨å–å‡ºæ¥ï¼Œä¸æ¨èä½¿ç”¨
            # depth = 1
    
            extra_kwargs = {
                'publish':{'write_only':True},
                'authors':{'write_only':True}
            }
    
    # ä½œè€…åºåˆ—åŒ–å™¨
    class AuthorSerializer(serializers.ModelSerializer):
        class Meta:
            # æŒ‡å®šå’Œå“ªä¸ªè¡¨æœ‰å…³ç³»
            model = models.Author
            # fields = '__all__'
            fields = ['id', 'name', 'age', 'author_detail', 'authordetail_info']
            extra_kwargs = {
                'author_detail': {'write_only': True},
            }
    
    
    # ä½œè€…è¯¦æƒ…åºåˆ—åŒ–å™¨
    class AuthorDetailSerializer(serializers.ModelSerializer):
        class Meta:
            # æŒ‡å®šå’Œå“ªä¸ªè¡¨æœ‰å…³ç³»
            model = models.AuthorDetail
            fields = '__all__'
    
    # å‡ºç‰ˆç¤¾åºåˆ—åŒ–å™¨
    class PublishSerializer(serializers.ModelSerializer):
        class Meta:
            # æŒ‡å®šå’Œå“ªä¸ªè¡¨æœ‰å…³ç³»
            model = models.Publish
            fields = '__all__'
    
    

### **views.py**

    from rest_framework.response import Response
    from rest_framework.views import APIView
    
    from app01 import models
    from app01 import serializer
    
    
    # ä¹¦è§†å›¾ç±»
    class BookView(APIView):
        def get(self, requets):
            # åºåˆ—åŒ–
            book_list = models.Book.objects.all()
            # åºåˆ—åŒ–å¤šæ¡æ•°æ®many=True
            ser = serializer.BookSerializer(instance=book_list, many=True)
            return Response(ser.data)
    
        def post(self, request):
            # è·å–ååºåˆ—åŒ–æ•°æ®
            ser = serializer.BookSerializer(data=request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡å­˜å…¥æ•°æ®åº“ï¼Œä¸éœ€è¦é‡å†™createæ–¹æ³•äº†
                ser.save()
                return Response({'code': 100, 'msg': 'æ–°å¢æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒå¤±è´¥
            return Response({'code': 101, 'msg': 'æ ¡éªŒæœªé€šè¿‡', 'error': ser.errors})
    
    
    class BookViewDetail(APIView):
        def get(self, request, pk):
            book = models.Book.objects.filter(pk=pk).first()
            ser = serializer.BookSerializer(instance=book)
            return Response(ser.data)
    
        def put(self, request, pk):
            book = models.Book.objects.filter(pk=pk).first()
            # ä¿®æ”¹ï¼Œinstanceå’Œdataéƒ½è¦ä¼ 
            ser = serializer.BookSerializer(instance=book, data=request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡ä¿®æ”¹ï¼Œä¸éœ€è¦é‡å†™update
                ser.save()
                return Response({'code:': 100, 'msg': 'ä¿®æ”¹æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒä¸é€šè¿‡
            return Response({'code:': 102, 'msg': 'æ ¡éªŒæœªé€šè¿‡ï¼Œä¿®æ”¹å¤±è´¥', 'error': ser.errors})
    
        def delete(self, request, pk):
            models.Book.objects.filter(pk=pk).delete()
            return Response({'code': 100, 'msg': 'åˆ é™¤æˆåŠŸ'})
    
    
    # ä½œè€…è§†å›¾ç±»
    class AuthorView(APIView):
        def get(self, requets):
            # åºåˆ—åŒ–
            author_list = models.Author.objects.all()
            # åºåˆ—åŒ–å¤šæ¡æ•°æ®many=True
            ser = serializer.AuthorSerializer(instance=author_list, many=True)
            return Response(ser.data)
    
        def post(self, request):
            # è·å–ååºåˆ—åŒ–æ•°æ®
            ser = serializer.AuthorSerializer(data=request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡å­˜å…¥æ•°æ®åº“ï¼Œä¸éœ€è¦é‡å†™createæ–¹æ³•äº†
                ser.save()
                return Response({'code': 100, 'msg': 'æ–°å¢æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒå¤±è´¥
            return Response({'code': 101, 'msg': 'æ ¡éªŒæœªé€šè¿‡', 'error': ser.errors})
    
    
    class AuthorViewDetail(APIView):
        def get(self, request, pk):
            book = models.Author.objects.filter(pk=pk).first()
            ser = serializer.AuthorSerializer(instance=book)
            return Response(ser.data)
    
        def put(self, request, pk):
            book = models.Author.objects.filter(pk=pk).first()
            # ä¿®æ”¹ï¼Œinstanceå’Œdataéƒ½è¦ä¼ 
            ser = serializer.AuthorSerializer(instance=book, data=request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡ä¿®æ”¹ï¼Œä¸éœ€è¦é‡å†™update
                ser.save()
                return Response({'code:': 100, 'msg': 'ä¿®æ”¹æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒä¸é€šè¿‡
            return Response({'code:': 102, 'msg': 'æ ¡éªŒæœªé€šè¿‡ï¼Œä¿®æ”¹å¤±è´¥', 'error': ser.errors})
    
        def delete(self, request, pk):
            models.Author.objects.filter(pk=pk).delete()
            return Response({'code': 100, 'msg': 'åˆ é™¤æˆåŠŸ'})
    
    
    # ä½œè€…è¯¦æƒ…è§†å›¾ç±»
    class AuthorDetailView(APIView):
        def get(self, requets):
            # åºåˆ—åŒ–
            author_list = models.AuthorDetail.objects.all()
            # åºåˆ—åŒ–å¤šæ¡æ•°æ®many=True
            ser = serializer.AuthorDetailSerializer(instance=author_list, many=True)
            return Response(ser.data)
    
        def post(self, request):
            # è·å–ååºåˆ—åŒ–æ•°æ®
            ser = serializer.AuthorDetailSerializer(data=request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡å­˜å…¥æ•°æ®åº“ï¼Œä¸éœ€è¦é‡å†™createæ–¹æ³•äº†
                ser.save()
                return Response({'code': 100, 'msg': 'æ–°å¢æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒå¤±è´¥
            return Response({'code': 101, 'msg': 'æ ¡éªŒæœªé€šè¿‡', 'error': ser.errors})
    
    
    class OneAuthorViewDetail(APIView):
        def get(self, request, pk):
            book = models.AuthorDetail.objects.filter(pk=pk).first()
            ser = serializer.AuthorDetailSerializer(instance=book)
            return Response(ser.data)
    
        def put(self, request, pk):
            book = models.AuthorDetail.objects.filter(pk=pk).first()
            # ä¿®æ”¹ï¼Œinstanceå’Œdataéƒ½è¦ä¼ 
            ser = serializer.AuthorDetailSerializer(instance=book, data=request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡ä¿®æ”¹ï¼Œä¸éœ€è¦é‡å†™update
                ser.save()
                return Response({'code:': 100, 'msg': 'ä¿®æ”¹æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒä¸é€šè¿‡
            return Response({'code:': 102, 'msg': 'æ ¡éªŒæœªé€šè¿‡ï¼Œä¿®æ”¹å¤±è´¥', 'error': ser.errors})
    
        def delete(self, request, pk):
            models.AuthorDetail.objects.filter(pk=pk).delete()
            return Response({'code': 100, 'msg': 'åˆ é™¤æˆåŠŸ'})
    
    # å‡ºç‰ˆç¤¾è§†å›¾ç±»
    class PublishView(APIView):
        def get(self, requets):
            # åºåˆ—åŒ–
            author_list = models.Publish.objects.all()
            # åºåˆ—åŒ–å¤šæ¡æ•°æ®many=True
            ser = serializer.PublishSerializer(instance=author_list, many=True)
            return Response(ser.data)
    
        def post(self, request):
            # è·å–ååºåˆ—åŒ–æ•°æ®
            ser = serializer.PublishSerializer(data=request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡å­˜å…¥æ•°æ®åº“ï¼Œä¸éœ€è¦é‡å†™createæ–¹æ³•äº†
                ser.save()
                return Response({'code': 100, 'msg': 'æ–°å¢æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒå¤±è´¥
            return Response({'code': 101, 'msg': 'æ ¡éªŒæœªé€šè¿‡', 'error': ser.errors})
    
    
    class PublishViewDetail(APIView):
        def get(self, request, pk):
            book = models.Publish.objects.filter(pk=pk).first()
            ser = serializer.PublishSerializer(instance=book)
            return Response(ser.data)
    
        def put(self, request, pk):
            book = models.Publish.objects.filter(pk=pk).first()
            # ä¿®æ”¹ï¼Œinstanceå’Œdataéƒ½è¦ä¼ 
            ser = serializer.PublishSerializer(instance=book, data=request.data)
            if ser.is_valid():
                # æ ¡éªŒé€šè¿‡ä¿®æ”¹ï¼Œä¸éœ€è¦é‡å†™update
                ser.save()
                return Response({'code:': 100, 'msg': 'ä¿®æ”¹æˆåŠŸ', 'data': ser.data})
            # æ ¡éªŒä¸é€šè¿‡
            return Response({'code:': 102, 'msg': 'æ ¡éªŒæœªé€šè¿‡ï¼Œä¿®æ”¹å¤±è´¥', 'error': ser.errors})
    
        def delete(self, request, pk):
            models.Publish.objects.filter(pk=pk).delete()
            return Response({'code': 100, 'msg': 'åˆ é™¤æˆåŠŸ'})
    

### urls.py

    from django.contrib import admin
    from django.urls import path
    
    from app01 import views
    
    urlpatterns = [
        path('admin/', admin.site.urls),
        # ä¹¦
        path('books/', views.BookView.as_view()),
        path('books/<int:pk>', views.BookViewDetail.as_view()),
    
        # ä½œè€…
        path('authors/', views.AuthorView.as_view()),
        path('authors/<int:pk>', views.AuthorViewDetail.as_view()),
    
        # ä½œè€…è¯¦æƒ…
        path('authorsdetail/', views.AuthorDetailView.as_view()),
        path('authorsdetail/<int:pk>', views.OneAuthorViewDetail.as_view()),
    
        # å‡ºç‰ˆç¤¾
        path('publish/', views.PublishView.as_view()),
        path('publishdetail/<int:pk>', views.PublishViewDetail.as_view()),
    ]
    

  

![image](https://img2022.cnblogs.com/blog/2608072/202203/2608072-20220331204338602-1073105680.png)

**Postmanè‡ªè¡Œæµ‹è¯•ï¼Œæˆ‘æµ‹äº†æµ‹éƒ½èƒ½ç”¨ï¼Œæœ‰é—®é¢˜æœ›æŒ‡æ­£~**