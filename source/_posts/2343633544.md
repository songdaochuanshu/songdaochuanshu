---
layout: post
title: "ã€æŒä¹…å±‚æ¡†æ¶ã€‘- SpringData - JPA"
date: "2022-10-03T05:43:51.856Z"
---
ã€æŒä¹…å±‚æ¡†æ¶ã€‘- SpringData - JPA
=========================

JPA å³Java Persistence APIã€‚æ˜¯ä¸€æ¬¾æŒä¹…å±‚æ¡†æ¶ï¼Œä¸­æ–‡åJavaæŒä¹…å±‚APIï¼Œæ˜¯JDK 5.0æ³¨è§£æˆ–XMLæè¿°å¯¹è±¡ï¼å…³ç³»è¡¨çš„æ˜ å°„å…³ç³»ï¼Œå¹¶å°†è¿è¡ŒæœŸçš„å®ä½“å¯¹è±¡æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ã€‚

SpringData - JPA
================

> ğŸ˜„ç”Ÿå‘½ä¸æ¯ï¼Œå†™ä½œä¸æ­¢  
> ğŸ”¥ ç»§ç»­è¸ä¸Šå­¦ä¹ ä¹‹è·¯ï¼Œå­¦ä¹‹åˆ†äº«ç¬”è®°  
> ğŸ‘Š æ€»æœ‰ä¸€å¤©æˆ‘ä¹Ÿèƒ½åƒå„ä½å¤§ä½¬ä¸€æ ·  
> ğŸ† [ä¸€ä¸ªæœ‰æ¢¦æœ‰æˆçš„äºº](https://blog.csdn.net/qq_43843951) [@æ€’æ”¾å§å¾·å¾·](https://www.cnblogs.com/lyd-code/)  
> ğŸŒåˆ†äº«å­¦ä¹ å¿ƒå¾—ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ æˆé•¿ï¼

![jpa.jpg](https://ucc.alicdn.com/pic/developer-ecology/a14196ccf9d54f1894460172f7da5254.jpg)

JPAç®€ä»‹
-----

JPA å³Java Persistence APIã€‚æ˜¯ä¸€æ¬¾æŒä¹…å±‚æ¡†æ¶ï¼Œä¸­æ–‡åJavaæŒä¹…å±‚APIï¼Œæ˜¯JDK 5.0æ³¨è§£æˆ–XMLæè¿°å¯¹è±¡ï¼å…³ç³»è¡¨çš„æ˜ å°„å…³ç³»ï¼Œå¹¶å°†è¿è¡ŒæœŸçš„å®ä½“å¯¹è±¡æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ã€‚JPAçš„å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰æ¨¡å‹æ˜¯åŸºäºHibernateã€‚æ˜¯ä¸€æ¬¾é¢å‘å¯¹è±¡çš„ORMæ¡†æ¶ï¼ŒJPAä¸éœ€è¦å…³å¿ƒæ•°æ®åº“å­—æ®µï¼Œé€šè¿‡æ³¨è§£å°†æ•°æ®åº“è¡¨ä¸å®ä½“å®Œæˆæ˜ å°„ï¼Œåœ¨javaä¸­çš„æ“ä½œåªéœ€è¦å¯¹å®ä½“è¿›è¡Œæ“ä½œå³å¯ã€‚

ä»€ä¹ˆæ˜¯ORMï¼Ÿ
-------

ORMï¼ˆObject-Relational Mappingï¼‰ è¡¨ç¤ºå¯¹è±¡å…³ç³»æ˜ å°„ã€‚åœ¨é¢å‘å¯¹è±¡çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œé€šè¿‡ORMï¼Œå°±å¯ä»¥æŠŠå¯¹è±¡æ˜ å°„åˆ°å…³ç³»å‹æ•°æ®åº“ä¸­ã€‚åªè¦æœ‰ä¸€å¥—ç¨‹åºèƒ½å¤Ÿåšåˆ°å»ºç«‹å¯¹è±¡ä¸æ•°æ®åº“çš„å…³è”ï¼Œæ“ä½œå¯¹è±¡å°±å¯ä»¥ç›´æ¥æ“ä½œæ•°æ®åº“æ•°æ®ï¼Œå°±å¯ä»¥è¯´è¿™å¥—ç¨‹åºå®ç°äº†ORMå¯¹è±¡å…³ç³»æ˜ å°„ã€‚ä¹Ÿå°±æ˜¯è¯´ORMæ˜¯å»ºç«‹äº†ä¸€ä¸ªå®ä½“ä¸æ•°æ®åº“è¡¨çš„å…³ç³»ï¼Œä½¿å¾—å¼€å‘è€…å¯¹å®ä½“çš„ç›´æ¥æ“ä½œè€Œä¸æ˜¯å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œä½†æ“ä½œå®ä½“ä¹Ÿå°±ç­‰åŒäºæ“ä½œäº†æ•°æ®åº“ã€‚  
ORMæ¡†æ¶è¿˜æœ‰ï¼šMyBatisã€Hibernate

SpringData-JPA
--------------

Spring Data JPA æ˜¯ Spring åŸºäº ORM æ¡†æ¶ã€JPA è§„èŒƒçš„åŸºç¡€ä¸Šå°è£…çš„ä¸€å¥—JPAåº”ç”¨æ¡†æ¶ï¼Œå¯ä½¿å¼€å‘è€…ç”¨æç®€çš„ä»£ç å³å¯å®ç°å¯¹æ•°æ®åº“çš„è®¿é—®å’Œæ“ä½œã€‚  
å®ƒæä¾›äº†åŒ…æ‹¬å¢åˆ æ”¹æŸ¥ç­‰åœ¨å†…çš„å¸¸ç”¨åŠŸèƒ½ï¼Œä¸”æ˜“äºæ‰©å±•ï¼å­¦ä¹ å¹¶ä½¿ç”¨ Spring Data JPA å¯ä»¥æå¤§æé«˜å¼€å‘æ•ˆç‡ï¼  
Spring Data JPA è®©æˆ‘ä»¬è§£è„±äº†DAOå±‚çš„æ“ä½œï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰CRUDéƒ½å¯ä»¥ä¾èµ–äºå®ƒæ¥å®ç°  
åœ¨å®é™…çš„å·¥ä½œå·¥ç¨‹ä¸­ï¼Œæ¨èä½¿ç”¨Spring Data JPA + ORMï¼ˆå¦‚ï¼šhibernateï¼‰å®Œæˆæ“ä½œï¼Œè¿™æ ·åœ¨åˆ‡æ¢ä¸åŒçš„ORMæ¡†æ¶æ—¶æä¾›äº†æå¤§çš„æ–¹ä¾¿ï¼ŒåŒæ—¶ä¹Ÿä½¿æ•°æ®åº“å±‚æ“ä½œæ›´åŠ ç®€å•ï¼Œæ–¹ä¾¿è§£è€¦ã€‚

SpringBootæ•´åˆJPA
---------------

æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹ç®€å•å­¦ä¹ ä¸€ä¸‹JPAï¼Œå¹¶ä¸”åœ¨æ¡ˆä¾‹ä¸­å­¦ä¹ ä¸€äº›ç›¸å…³çŸ¥è¯†ã€‚

### å¯¼å…¥ä¾èµ–

éœ€è¦å¯¼å…¥jpaåæ ‡å’Œmysqlä¾èµ–åŒ…

    <dependencies>
        <!--jpa-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        <!--Mysqlä¾èµ–åŒ…-->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <scope>runtime</scope>
        </dependency>
    </dependencies>
    

### ç¼–å†™é…ç½®æ–‡ä»¶

å…ˆé…ç½®æ•°æ®æºï¼Œé‡‡ç”¨mysql8.0ã€‚è¿˜åŒ…æ‹¬é…ç½®jpaçš„ç›¸å…³é…ç½®ã€‚ä¸»è¦æ˜¯é…ç½®jpaçš„sqlæ—¥å¿—æ‰“å°å’Œè‡ªåŠ¨åˆ›å»ºè¡¨æ ¼ã€‚

    spring:
      datasource:
        driver-class-name: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql://localhost:3306/springboot_demo?useUnicode=true&useSSL=false&characterEncoding=utf8&serverTimezone=Asia/Shanghai
        username: root
        password: 12356
    jpa:
      show-sql: true
      hibernate:
        ddl-auto: create # è‡ªåŠ¨åˆ›å»ºè¡¨æ ¼ï¼Œä¹‹åæ”¹æˆupdate
    

jpaçš„åº•å±‚æ˜¯é€šè¿‡hibernateæ‰§è¡Œçš„ï¼Œé€šè¿‡é…ç½®ddl-autoèƒ½å¤Ÿè‡ªåŠ¨åˆ›å»ºè¡¨ï¼Œä½†æ˜¯è¿™ä¸ªä¸å»ºè®®ä½¿ç”¨ï¼Œå¦‚æœæ˜¯createï¼Œåœ¨é¡¹ç›®è¿è¡Œçš„æ—¶å€™å°±ä¼šæŠŠå­˜åœ¨çš„è¡¨åˆ é™¤åœ¨æ·»åŠ ã€‚è¯¦æƒ…å¦‚ä¸‹ï¼š  
ddl-autoå±æ€§ç”¨äºè®¾ç½®è‡ªåŠ¨è¡¨å®šä¹‰ï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åœ¨æ•°æ®åº“ä¸­ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œè¡¨çš„ç»“æ„ä¼šæ ¹æ®æˆ‘ä»¬å®šä¹‰çš„å®ä½“ç±»å†³å®šï¼Œå®ƒæœ‰4ç§

*   create å¯åŠ¨æ—¶åˆ æ•°æ®åº“ä¸­çš„è¡¨ï¼Œç„¶ååˆ›å»ºï¼Œé€€å‡ºæ—¶ä¸åˆ é™¤æ•°æ®è¡¨
*   create-drop å¯åŠ¨æ—¶åˆ æ•°æ®åº“ä¸­çš„è¡¨ï¼Œç„¶ååˆ›å»ºï¼Œé€€å‡ºæ—¶åˆ é™¤æ•°æ®è¡¨ å¦‚æœè¡¨ä¸å­˜åœ¨æŠ¥é”™
*   update å¦‚æœå¯åŠ¨æ—¶è¡¨æ ¼å¼ä¸ä¸€è‡´åˆ™æ›´æ–°è¡¨ï¼ŒåŸæœ‰æ•°æ®ä¿ç•™
*   validate é¡¹ç›®å¯åŠ¨è¡¨ç»“æ„è¿›è¡Œæ ¡éªŒ å¦‚æœä¸ä¸€è‡´åˆ™æŠ¥é”™

æ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹ä½“éªŒjpaäº†

### åˆ›å»ºå®ä½“ç±»

å¯è§é€šè¿‡æ³¨è§£å¯ä»¥å®ç°å®ä½“ä¸æ•°æ®åº“çš„ç›´æ¥æ˜ å°„ï¼Œjpaæ“ä½œçš„å°±æ˜¯è¿™äº›å®ä½“å°±ç­‰åŒæ“ä½œæ•°æ®åº“çš„è¡¨ç»“æ„ã€‚

    package com.jpa.demo.domain;
    
    import lombok.Data;
    
    import javax.annotation.Generated;
    import javax.persistence.*;
    import java.io.Serializable;
    
    /**
     * @author: lyd
     * @description: å®ä½“User
     * @Date: 2022/10/2
     */
    @Data
    @Entity
    @Table(name = "sys_user")
    public class User implements Serializable {
        @Id
        @Column(name = "user_id")
        @GeneratedValue(strategy = GenerationType.IDENTITY) // è‡ªå¢
        private Long id;
    
        private String username;
    
        private String nickName;
    
        private String password;
    
    }
    

*   @Dataï¼šlombokä¸‹çš„æ³¨è§£ï¼Œä¸»è¦æ˜¯æ–¹ä¾¿å¼€å‘ï¼Œå‡å°‘å¯¹getã€setã€tostringçš„ç¼–å†™ã€‚è¿™ä¸ªéœ€è¦å¯¼å…¥ç›¸åº”çš„ä¾èµ–åæ ‡ã€‚
*   @Entityï¼šå£°æ˜æ˜¯ä¸€ä¸ªå®ä½“ã€‚
*   @Table(name = "sys\_user")ï¼šæŒ‡æ˜æ•°æ®åº“ä¸­è¡¨çš„åå­—å®ç°å®ä½“ä¸æ•°æ®è¡¨æ˜ å°„ã€‚
*   @Idï¼šå£°æ˜ä¸»é”®ã€‚
*   @Column(name = "user\_id")ï¼šæŒ‡æ˜æ˜¯è¡¨ä¸­çš„å“ªä¸ªå­—æ®µã€‚
*   @GeneratedValue(strategy = GenerationType.IDENTITY)ï¼š GenerationType.IDENTITYï¼šå®ç°è‡ªå¢

### å¯åŠ¨é¡¹ç›®

å½“æˆ‘ä»¬å¯åŠ¨é¡¹ç›®çš„æ—¶å€™ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„ã€‚  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/7063439f06924d45b63ed841585e2f59.png)

çœ‹ä¸€ä¸‹æ•°æ®åº“ï¼Œå‘ç°è¡¨å·²ç»è‡ªåŠ¨åˆ›å»º  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/77f6d12b1a554f889a4304a931597d95.png)

### å¯¹è¡¨æ“ä½œ

#### å¢åŠ æ•°æ®

é¦–å…ˆéœ€è¦åˆ›å»ºUserRepositoryæ¥å£ï¼Œè¦é€šè¿‡ç»§æ‰¿JpaRepository<T, ID>ï¼Œæä¾›å®ä½“ç±»å’Œidçš„ç±»å‹ã€‚

    /**
     * @author: lyd
     * @description: UserRepository
     * @Date: 2022/10/2
     */
    @Repository
    public interface UserRepository extends JpaRepository<User, Long>, JpaSpecificationExecutor<User> {
       
    }
    

ç¼–å†™æµ‹è¯•ç±»  
é€šè¿‡è°ƒç”¨saveæ–¹æ³•å³å¯å®Œæˆä¿å­˜æ“ä½œ

    package com.jpa.demo.test;
    import com.jpa.demo.domain.User;
    import com.jpa.demo.repository.UserRepository;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.boot.test.context.SpringBootTest;
    import org.junit.jupiter.api.Test;
    /**
     * @author: lyd
     * @description: æµ‹è¯•ç±»
     * @Date: 2022/10/2
     */
    @SpringBootTest
    public class JpaTest {
        @Autowired
        private UserRepository userRepository;
        @Test
        void InsertTest() {
            User user = new User();
            user.setNickName("æ€’æ”¾å§å¾·å¾·");
            user.setUsername("lyd_code");
            user.setPassword("lyd_open");
            User save = userRepository.save(user);
            System.out.println(save);
        }
    }
    

è¿è¡Œç»“æœ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/cbfdca91157f4f8fa7184ef25a09dc4f.png)

#### æŸ¥çœ‹æ•°æ®

é€šè¿‡findAllå°±å¯ä»¥ç›´æ¥è·å–å¾—åˆ°æ‰€æœ‰çš„æ•°æ®ã€‚

    @Test
    void QueryTest() {
        List<User> all = userRepository.findAll();
        all.forEach(System.out::println);
    }
    

å°±èƒ½åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ï¼š  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/fc485179af284e7286d731b917955738.png)

#### åˆ†é¡µæŸ¥æ‰¾

jpaä¹Ÿæ˜¯å®ç°äº†åˆ†é¡µæ“ä½œçš„æ–¹æ³•ã€‚é€šè¿‡PageRequest.of(0,1)å¯ä»¥å®Œæˆåˆ†é¡µã€‚

    @Test
    void PageRequestTest() {
        userRepository.findAll(PageRequest.of(0,1)).forEach(System.out::println);
    }
    

å…¶åº•å±‚å¯¹æ•°æ®åº“çš„æ“ä½œå°±ä¼šåŠ ä¸Šlimit.  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/6933ee953e4746a59375b28998949246.png)

#### æ ¹æ®IDæŸ¥æ‰¾

è¿”å›æ˜¯Optionalç±»ï¼ŒUserç±»å‹çš„æ•°ç»„

    @Test
    void FindByIdTest() {
        Optional<User> user = userRepository.findById(1L);
        System.out.println(user);
    }
    

> Java8 æ–°ç‰¹æ€§Optionalç±»  
> Optional ç±»æ–°ç‰¹æ€§
> 
> Optional ç±»æ˜¯ä¸€ä¸ªå¯ä»¥ä¸ºnullçš„å®¹å™¨å¯¹è±¡  
> å¦‚æœå€¼å­˜åœ¨åˆ™isPresent()æ–¹æ³•ä¼šè¿”å›trueï¼Œè°ƒç”¨get()æ–¹æ³•ä¼šè¿”å›è¯¥å¯¹è±¡  
> Optional æ˜¯ä¸ªå®¹å™¨ï¼šå®ƒå¯ä»¥ä¿å­˜ç±»å‹Tçš„å€¼ï¼Œæˆ–ä»…ä¿å­˜nullã€‚Optionalæä¾›å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨æ˜¾å¼è¿›è¡Œç©ºå€¼æ£€æµ‹  
> Optional ç±»çš„å¼•å…¥å¾ˆå¥½çš„è§£å†³ç©ºæŒ‡é’ˆå¼‚å¸¸

æ–¹æ³•å‘½åè§„åˆ™è‡ªå®šä¹‰æŸ¥è¯¢
-----------

æ–¹æ³•å‘½åè§„åˆ™æŸ¥è¯¢å°±æ˜¯æ ¹æ®æ–¹æ³•çš„åå­—ï¼Œå°±èƒ½åˆ›å»ºæŸ¥è¯¢ã€‚éœ€è¦æŒ‰ç…§Spring Data JPAæä¾›çš„æ–¹æ³•å‘½åè§„åˆ™å®šä¹‰æ–¹æ³•çš„åç§°ï¼Œå°±å¯ä»¥å®ŒæˆæŸ¥è¯¢å·¥ä½œã€‚Spring Data JPAåœ¨ç¨‹åºæ‰§è¡Œçš„æ—¶å€™ä¼šæ ¹æ®æ–¹æ³•åç§°è¿›è¡Œè§£æï¼Œå¹¶è‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢è¯­å¥è¿›è¡ŒæŸ¥è¯¢ã€‚é€šè¿‡jpaçš„è§„åˆ™è¦æ±‚æ¥å®ç°è‡ªå·±å‘½åæŸ¥è¯¢ã€‚  
æŒ‰ç…§Spring Data JPA å®šä¹‰çš„è§„åˆ™ï¼ŒæŸ¥è¯¢æ–¹æ³•ä»¥findByå¼€å¤´ï¼Œæ¶‰åŠæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œæ¡ä»¶çš„å±æ€§ç”¨æ¡ä»¶å…³é”®å­—è¿æ¥ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼šæ¡ä»¶å±æ€§é¦–å­—æ¯éœ€å¤§å†™ã€‚æ¡†æ¶åœ¨è¿›è¡Œæ–¹æ³•åè§£ææ—¶ï¼Œä¼šå…ˆæŠŠæ–¹æ³•åå¤šä½™çš„å‰ç¼€æˆªå–æ‰ï¼Œç„¶åå¯¹å‰©ä¸‹éƒ¨åˆ†è¿›è¡Œè§£æã€‚

### ç¼–å†™Repository

æ ¹æ®ä¸€å®šçš„è§„åˆ™æ¥ç¼–å†™æ–¹æ³•å‘½åã€‚jpaä¼šè‡ªåŠ¨è¯†åˆ«æ–¹æ³•åç§°è¿›è¡Œæ“ä½œã€‚

    package com.jpa.demo.repository;
    
    import com.jpa.demo.domain.User;
    import org.springframework.data.jpa.repository.JpaRepository;
    import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
    import org.springframework.stereotype.Repository;
    
    import java.util.List;
    
    /**
     * @author: lyd
     * @description: UserRepository
     * @Date: 2022/10/2
     */
    @Repository
    public interface UserRepository extends JpaRepository<User, Long>, JpaSpecificationExecutor<User> {
        //æ ¹æ®nicknameæŸ¥è¯¢
        List<User> findAllByNickName(String str);
    }
    

é€šè¿‡æµ‹è¯•å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/8612950a42f24396aaed9430ab59ab9f.png)

åœ¨ç¼–å†™repositoryçš„æ—¶å€™ä¼šæœ‰ä¸€äº›è§„åˆ™æç¤ºï¼Œä¹Ÿå°±æ˜¯åªæœ‰ç¬¦åˆè¿™äº›è§„åˆ™æ‰èƒ½å¤Ÿè¢«è¯†åˆ«ã€‚è¿™é‡Œåªæ˜¯å±•ç°äº†findxxxï¼Œå®é™…ä¸Šè¿˜æœ‰è®¸å¤šã€‚  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/8af3f95db9ba420c830c50c7fb5c09c5.png)

å…·ä½“çš„å…³é”®å­—ï¼Œä½¿ç”¨æ–¹æ³•å’Œç”Ÿäº§æˆSQLå¦‚ä¸‹è¡¨æ‰€ç¤º  
![QQå›¾ç‰‡20221003123118.png](https://ucc.alicdn.com/pic/developer-ecology/7ef20807d0d543b6840d653057d508b2.png)

ä½¿ç”¨JPQLçš„æ–¹å¼æŸ¥è¯¢(æ³¨è§£å¼SQL)
-------------------

é€šè¿‡Queryæ³¨è§£å¯ä»¥å®ç°æ›´å¤šçµæ´»çš„æ¡ä»¶æŸ¥è¯¢ç­‰SQLÂ·æ“ä½œã€‚@Query æ³¨è§£çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€åœ¨æ–¹æ³•ä¸Šé¢æ ‡æ³¨è¯¥æ³¨è§£ï¼ŒåŒæ—¶æä¾›ä¸€ä¸ªJPQLæŸ¥è¯¢è¯­å¥å³å¯ï¼Œå¹¶ä¸”ï¼Œåœ¨è¿™äº›SQLè¯­å¥ä¸­éƒ½æ˜¯ä½¿ç”¨å®ä½“æ¥è¿›è¡Œæ“ä½œï¼Œå¹¶éæ•°æ®åº“çš„è¡¨ç»“æ„æ¥æ“ä½œã€‚

### è®¡æ•°

é€šè¿‡Queryå¯ä»¥å†™è‡ªå·±çš„SQLè¯­å¥

    @Query("select count(u) from User u") // è¿™é‡Œä½¿ç”¨çš„æ˜¯å®ä½“ï¼Œå¹¶ä¸æ˜¯æ•°æ®åº“çš„è¡¨åå’Œå­—æ®µ
    Integer countUser();
    

æµ‹è¯•

    @Test
    void CountUser() {
        Integer integer = userRepository.countUser();
        System.out.println(integer);
    }
    

ç»“æœ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/446ffa37c1b44ebc95d0da4437ebcd8d.png)

### å‚æ•°ä¼ é€’

åœ¨é€šè¿‡æ³¨è§£å†™SQLçš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æ˜¯æºå¸¦å‚æ•°çš„ï¼Œè€ŒQueryé€šè¿‡?å ä½ç¬¦æ¥è·å¾—ä¼ æ¥çš„å‚æ•°æ•°æ®ï¼Œé€šè¿‡å‚æ•°çš„ä½ç½®å®šä½å“ªä¸ªå‚æ•°ã€‚

    //ä¿®æ”¹æ•°æ® ä¸€å®šåŠ ä¸Š@Modifying æ³¨è§£
    @Transactional
    @Modifying
    @Query("update User set username=?1 where id=?2")
    int updateUsernameByIds(String username,Long id);
    

ç»“æœ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/d1ef567a7d4b45b1b44acd5ceb651dec.png)

ä¹Ÿå¯ä»¥ä½¿ç”¨åŸç”Ÿçš„SQLï¼Œåªéœ€è¦åŠ ä¸Š nativeQuery = true å³å¯ã€‚

å®ä½“å…³ç³»å¯¹åº”
------

jpaä¸­å®ä½“åŒ…æ‹¬ä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šï¼Œå¤šå¯¹ä¸€å…³ç³»ï¼Œå¹¶ä¸”æä¾›äº†ç›¸åº”çš„æ³¨è§£ã€‚æ¥ä¸‹æ¥é€šè¿‡æ¡ˆä¾‹æ¥å®ç°å…³ç³»ã€‚

### ä¸€å¯¹ä¸€

é¦–å…ˆåˆ›å»ºéƒ¨é—¨è¡¨ï¼Œä½¿ç”¨æˆ·æŒ‡å‘ä¸€ä¸ªéƒ¨é—¨ã€‚

    package com.jpa.demo.domain;
    import lombok.Data;
    import javax.persistence.*;
    import java.io.Serializable;
    /**
     * @author: lyd
     * @description: éƒ¨é—¨
     * @Date: 2022/10/2
     */
    @Entity
    @Data
    @Table(name="sys_dept")
    public class Dept implements Serializable {
        @Id
        @Column(name = "dept_id")
        @GeneratedValue(strategy = GenerationType.IDENTITY)
        private Long id;
        private String name;
    }
    

åœ¨Userå®ä½“ä¸­åŠ å­—æ®µï¼Œé€šè¿‡OneToOneæ³¨è§£å®Œæˆã€‚

    @OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL) //è®¾ç½®å…³è”æ“ä½œä¸ºALL
    @JoinColumn(name = "dept_id")
    private Dept dept;
    

è¿™é‡Œçš„å…³è”çº§åˆ«ä¹Ÿæ˜¯æœ‰å¤šä¸ª,ä¸€èˆ¬è®¾ç½®ä¸ºallå°±è¡Œ

*   ALLï¼šæ‰€æœ‰æ“ä½œéƒ½è¿›è¡Œå…³è”æ“ä½œ
*   PERSISTï¼šæ’å…¥æ“ä½œæ—¶æ‰è¿›è¡Œå…³è”æ“ä½œ
*   REMOVEï¼šåˆ é™¤æ“ä½œæ—¶æ‰è¿›è¡Œå…³è”æ“ä½œ
*   MERGEï¼šä¿®æ”¹æ“ä½œæ—¶æ‰è¿›è¡Œå…³è”æ“ä½œ  
    è¿™æ ·å°±å¯ä»¥ç¼–å†™æµ‹è¯•

    @Test
    void OneToOneTest() {
        User user = new User();
        user.setNickName("çˆ±å›½å¾·å¾·");
        user.setUsername("lyd_code_studio");
        user.setPassword("lyd_open");
        Dept dept = new Dept();
        dept.setName("ç ”å‘éƒ¨");
        user.setDept(dept);
        User save = userRepository.save(user);
        System.out.println(save);
    }
    

é€šè¿‡æµ‹è¯•å¯å¾—æ•°æ®åº“ç»“æœï¼Œ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/856ba145a4eb4640828a557c1cde6e08.png)  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/12b8eedbf47d411f8877004b37eabfa4.png)  
é€šè¿‡å…³è”ï¼Œä¼šåœ¨ä¸¤ä¸ªè¡¨ä¸­è¿›è¡Œæ’å…¥ï¼Œåˆ é™¤ä¹Ÿæ˜¯ä¼šåˆ é™¤ä¸¤ä¸ªè¡¨ä¸­æ•°æ®ã€‚

### ä¸€å¯¹å¤š

    @OneToMany:
       	ä½œç”¨ï¼šå»ºç«‹ä¸€å¯¹å¤šçš„å…³ç³»æ˜ å°„
        å±æ€§ï¼š
        	targetEntityClassï¼šæŒ‡å®šå¤šçš„å¤šæ–¹çš„ç±»çš„å­—èŠ‚ç 
        	mappedByï¼šæŒ‡å®šä»è¡¨å®ä½“ç±»ä¸­å¼•ç”¨ä¸»è¡¨å¯¹è±¡çš„åç§°ã€‚
        	cascadeï¼šæŒ‡å®šè¦ä½¿ç”¨çš„çº§è”æ“ä½œ
        	fetchï¼šæŒ‡å®šæ˜¯å¦é‡‡ç”¨å»¶è¿ŸåŠ è½½
        	orphanRemovalï¼šæ˜¯å¦ä½¿ç”¨å­¤å„¿åˆ é™¤
    

åˆ›å»ºä¸€ä¸ªæ–‡ç« è¡¨æ¥å®ç°ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥å‘è¡¨å¤šä¸ªæ–‡ç« ï¼Œä¸€ä¸ªæ–‡ç« åªå±äºä¸€ä¸ªç”¨æˆ·ï¼Œå› æ­¤åœ¨ç”¨æˆ·è¡¨ä¸­æ˜¯ä¸€å¯¹å¤šï¼Œåœ¨æ–‡ç« è¡¨å°±æ˜¯å¤šå¯¹ä¸€ã€‚  
é€šè¿‡@ManyToOneæ³¨è§£å®Œæˆå…³ç³»

    package com.jpa.demo.domain;
    import lombok.Data;
    import javax.persistence.*;
    /**
     * @author: lyd
     * @description: æ–‡ç« è¡¨
     * @Date: 2022/10/2
     */
    @Data
    @Entity
    @Table(name="yun_article")
    public class Article {
        @Id
        @Column(name = "article_id")
        @GeneratedValue(strategy = GenerationType.IDENTITY)
        private Long id;
    
        @Column(nullable = false, length = 50) // æ˜ å°„ä¸ºå­—æ®µï¼Œå€¼ä¸èƒ½ä¸ºç©º
        private String title;
    
        @Basic(fetch = FetchType.LAZY) // æ‡’åŠ è½½
        @Column(nullable = false) // æ˜ å°„ä¸ºå­—æ®µï¼Œå€¼ä¸èƒ½ä¸ºç©º
        private String content;
    
        @ManyToOne(cascade={CascadeType.MERGE,CascadeType.REFRESH},optional=false)//å¯é€‰å±æ€§optional=false,è¡¨ç¤ºuserä¸èƒ½ä¸ºç©ºã€‚åˆ é™¤æ–‡ç« ï¼Œä¸å½±å“ç”¨æˆ·
        @JoinColumn(name="user_id")//è®¾ç½®åœ¨articleè¡¨ä¸­çš„å…³è”å­—æ®µ(å¤–é”®)
        private User user;
    }
    

åœ¨userå®ä½“è¿™è¾¹å°±æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼Œå¹¶ä¸”é€šè¿‡æ³¨è§£å®Œæˆã€‚

    @OneToMany(mappedBy = "user",cascade=CascadeType.ALL,fetch=FetchType.LAZY)
    //çº§è”ä¿å­˜ã€æ›´æ–°ã€åˆ é™¤ã€åˆ·æ–°;å»¶è¿ŸåŠ è½½ã€‚å½“åˆ é™¤ç”¨æˆ·ï¼Œä¼šçº§è”åˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰æ–‡ç« 
    //æ‹¥æœ‰mappedByæ³¨è§£çš„å®ä½“ç±»ä¸ºå…³ç³»è¢«ç»´æŠ¤ç«¯
    private Set<Article> articles;
    

æµ‹è¯•ï¼Œéœ€è¦åˆ›å»ºArticleRepository

    @Test
    void OneToMany() {
        User user = userRepository.getById(1L);
    
        Article article1=new Article();
        article1.setTitle("å¦‚ä½•å†™å¥½åšå®¢");
        article1.setContent("å¦‚ä½•å†™å¥½åšå®¢");
        article1.setUser(user);
        articleRepository.save(article1);
    
        Article article2=new Article();
        article2.setTitle("å¦‚ä½•æ›´è¿›ä¸€æ­¥å­¦ä¹ ");
        article2.setContent("ä¸æ–­åœ°å·");
        article2.setUser(user);
        articleRepository.save(article2);
    }
    

è¿è¡Œç»“æœ  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/17ee286271c646eba6e879985b9f9236.png)

æ•°æ®åº“ä¸­  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/e9941d24ccbc4b30a6102c406b90fe56.png)

### å¤šå¯¹å¤š

JPAä¸­ä½¿ç”¨@ManyToManyæ¥æ³¨è§£å¤šå¯¹å¤šçš„å…³ç³»ï¼Œç”±ä¸€ä¸ªå…³è”è¡¨æ¥ç»´æŠ¤ã€‚è¿™ä¸ªå…³è”è¡¨çš„è¡¨åé»˜è®¤æ˜¯ï¼šä¸»è¡¨å+ä¸‹åˆ’çº¿+ä»è¡¨åã€‚(ä¸»è¡¨æ˜¯æŒ‡å…³ç³»ç»´æŠ¤ç«¯å¯¹åº”çš„è¡¨,ä»è¡¨æŒ‡å…³ç³»è¢«ç»´æŠ¤ç«¯å¯¹åº”çš„è¡¨)ã€‚è¿™ä¸ªå…³è”è¡¨åªæœ‰ä¸¤ä¸ªå¤–é”®å­—æ®µï¼Œåˆ†åˆ«æŒ‡å‘ä¸»è¡¨IDå’Œä»è¡¨IDã€‚å­—æ®µçš„åç§°é»˜è®¤ä¸ºï¼šä¸»è¡¨å+ä¸‹åˆ’çº¿+ä¸»è¡¨ä¸­çš„ä¸»é”®åˆ—åï¼Œä»è¡¨å+ä¸‹åˆ’çº¿+ä»è¡¨ä¸­çš„ä¸»é”®åˆ—åã€‚é€šè¿‡@JoinTableæ¥å®ç°ä¸­é—´è¡¨ã€‚  
åˆ›å»ºè§’è‰²è¡¨

    package com.jpa.demo.domain;
    
    import lombok.Data;
    
    import javax.persistence.*;
    import java.io.Serializable;
    import java.util.Set;
    
    /**
     * @author: lyd
     * @description: è§’è‰²è¡¨
     * @Date: 2022/10/2
     */
    @Data
    @Entity
    @Table(name = "sys_role")
    public class Role implements Serializable {
        @Id
        @Column(name = "role_id")
        @GeneratedValue(strategy = GenerationType.IDENTITY)
        private Long id;
    
        @ManyToMany(mappedBy = "roles")
        private Set<User> users;
    
        private String name;
    
        @Column(name = "level")
        private Integer level = 3;
    
        private String description;
    }
    

åœ¨ç”¨æˆ·è¡¨ä¸­

    @ManyToMany
    @JoinTable(name = "sys_users_roles",
            joinColumns = {@JoinColumn(name = "user_id",referencedColumnName = "user_id")},
            inverseJoinColumns = {@JoinColumn(name = "role_id",referencedColumnName = "role_id")})
    private Set<Role> roles;
    

æµ‹è¯•

    @Test
    void ManyToMany() {
        Role role = new Role();
        role.setName("USER");
        role.setLevel(2);
        role.setDescription("ç®¡ç†å‘˜");
        roleRepository.save(role);
    
        Set<Role> roles = new HashSet<>();
        roles.add(role);
    
        User user = new User();
        user.setPassword("lyd_code");
        user.setNickName("æ€’æ”¾å¾·å¾·");
        user.setUsername("lyd_code");
        user.setRoles(roles);
    
        User save = userRepository.save(user);
        System.out.println(save);
    
    }
    

åœ¨æ•°æ®åº“ä¸­çš„ä¸­é—´è¡¨å°±èƒ½å¤Ÿçœ‹åˆ°å¦‚ä¸‹æ•°æ®ã€‚  
![image.png](https://ucc.alicdn.com/pic/developer-ecology/256b964a0d174d50b83676392eac50f0.png)

æ–‡ç« æ¨è
----

*   [å…ƒåŠ¨åŠ›æ–‡æ¡£åˆé›† - SPRING-DATA-JPA](https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E7%AC%AC%E4%B8%80%E7%AB%A0-orm%E6%A6%82%E8%BF%B0-%E4%BA%86%E8%A7%A3)
*   CSDNï¼š[https://blog.csdn.net/cmx1060220219/article/details/106259423](https://blog.csdn.net/cmx1060220219/article/details/106259423)
*   CSDNï¼š[https://blog.csdn.net/localhost01/article/details/83422893](https://blog.csdn.net/localhost01/article/details/83422893)

ğŸ‘åˆ›ä½œä¸æ˜“ï¼Œå¦‚æœ‰é”™è¯¯è¯·æŒ‡æ­£ï¼Œæ„Ÿè°¢è§‚çœ‹ï¼è®°å¾—ç‚¹èµå“¦ï¼ğŸ‘