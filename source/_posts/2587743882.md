---
layout: post
title: "Tomcatæ·±å…¥æµ…å‡ºâ€”â€”æœ€ç»ˆç« (å…­)"
date: "2022-07-11T17:27:59.627Z"
---
Tomcatæ·±å…¥æµ…å‡ºâ€”â€”æœ€ç»ˆç« (å…­)
==================

ç®€ä»‹Thymeleafï¼Œæœ‰ç‚¹æ°´

å‰è¨€
==

*   åˆ©ç”¨äº†å…­å¤©çš„æ—¶é—´ï¼Œå¯¹Tomcatçš„å†…å®¹è¿›è¡Œäº†æ•´ç†ğŸ˜Šã€‚
*   å­¦ä¹ ä¸æ˜“ã€æ•´ç†ä¹Ÿä¸æ˜“ï¼Œè‡ªå·±åšæŒçš„æ›´äº†ä¸‹æ¥ï¼Œå¾ˆä¸é”™ğŸ¤«ã€‚
*   å¸Œæœ›æ¯ä¸€ä½åœ¨åŠªåŠ›å‰è¡Œçš„å°ä¼™ä¼´ï¼Œéƒ½è¦ç›¸ä¿¡åšæŒå°±ä¼šæœ‰æ”¶è·ğŸ˜ã€‚
*   æœ¬æ¬¡Tomcatå°±æ¢å¯»åˆ°è¿™é‡Œï¼Œæ˜å¹´æˆ‘è¿˜ä¼šæ›´åŠ æ·±å…¥çš„æ¢å¯»ä¸€æ¬¡ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å…³æ³¨ä¸€ä¸‹ğŸ˜ã€‚

ä¸€ã€ThymeleafåŸºæœ¬é…ç½®
===============

*   ä¼—æ‰€å‘¨çŸ¥Thymeleafæ˜¯SpringBootå®˜æ–¹æ¨èçš„æ¨¡æ¿å¼•æ“ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦æ”¾åœ¨Tomcatè¿™é‡Œå‘¢ï¼Œå› ä¸ºJSPæœ‰ç‚¹è€~
*   è‡³äºæ˜¯å¦è¿˜éœ€è¦å­¦ä¹ jspï¼Œæˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œåæ­£æˆ‘æ˜¯å­¦äº†ï¼Œä½†æ˜¯ä»Šå¤©å¸¦ç»™å¤§å®¶ThymeleafçŸ¥è¯†å°ç»“ã€‚
*   é™„ä¸Šå®˜ç½‘æ–‡æ¡£é“¾æ¥https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html#what-is-thymeleaf

* * *

**é¦–å…ˆå¦‚æœæˆ‘ä»¬æƒ³åœ¨Tomcaté‡Œç”¨thymeleafï¼Œéœ€è¦æˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š**

*   è¿™é‡Œæ˜¯é¡¹ç›®æ‰€éœ€è¦ç”¨åˆ°çš„jaråŒ…

![](https://img2022.cnblogs.com/blog/2816773/202207/2816773-20220711112230426-1082852116.png)

*   ä¸‹é¢æˆ‘ä»¬è¿›è¡Œé…ç½®ä¿¡æ¯

    package com.meteor.thymeleaf;
    
    import org.thymeleaf.TemplateEngine;
    import org.thymeleaf.context.WebContext;
    import org.thymeleaf.templatemode.TemplateMode;
    import org.thymeleaf.templateresolver.ServletContextTemplateResolver;
    
    import javax.servlet.ServletContext;
    import javax.servlet.ServletException;
    import javax.servlet.http.HttpServlet;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletResponse;
    import java.io.IOException;
    
    public class ViewBaseServlet extends HttpServlet {
    
        //å®šä¹‰ç§æœ‰æ¨¡æ¿å¼•æ“å¯¹è±¡
        private TemplateEngine templateEngine;
    
        //é‡å†™init()æ–¹æ³•(å…¶æ˜¯servletçš„åˆå§‹åŒ–æ–¹æ³•)
        @Override
        public void init() throws ServletException {
            //1. è·å–å½“å‰Servletçš„ServletContextå¯¹è±¡
            ServletContext servletContext = this.getServletContext();
            //2. åˆ›å»ºThymeleafè§£æå™¨å¯¹è±¡,å…¶æ¥æ”¶:ä¸€ä¸ªServletContextå¯¹è±¡
            ServletContextTemplateResolver templateResolver = new ServletContextTemplateResolver(servletContext);
            //3. ç»™è§£æå™¨å¯¹è±¡è®¾ç½®å‚æ•°
            //3.1 è®¾ç½®è§£æçš„æ¨¡æ¿æ¨¡å¼, HTMLæ˜¯é»˜è®¤æ¨¡å¼ï¼Œæ˜ç¡®è®¾ç½®æ˜¯ä¸ºäº†ä»£ç æ›´å®¹æ˜“ç†è§£
            templateResolver.setTemplateMode(TemplateMode.HTML);
            //3.2 è®¾ç½®å‰ç¼€
            String viewPrefix = servletContext.getInitParameter("view-prefix");
            templateResolver.setPrefix(viewPrefix);
            //3.3 è®¾ç½®åç¼€
            String viewSuffix = servletContext.getInitParameter("view-suffix");
            templateResolver.setSuffix(viewSuffix);
            //3.4 è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´(æ¯«ç§’)
            templateResolver.setCacheTTLMs(60000L);
            //3.5 è®¾ç½®æ˜¯å¦ç¼“å­˜
            templateResolver.setCacheable(false);
            //3.6 è®¾ç½®æœåŠ¡å™¨ç«¯ç¼–ç æ–¹å¼
            templateResolver.setCharacterEncoding("utf-8");
    
            //4. å®ä¾‹åŒ–æ¨¡æ¿å¼•æ“å¯¹è±¡
            templateEngine = new TemplateEngine();
    
            //5. ç»™æ¨¡æ¿å¼•æ“å¯¹è±¡è®¾ç½®æ¨¡æ¿è§£æå™¨å¯¹è±¡
            templateEngine.setTemplateResolver(templateResolver);
        }
    
        //åˆ›å»ºå¤„ç†æ¨¡æ¿æ–‡ä»¶çš„å‡½æ•°
        protected void processTemplate(String templateName, HttpServletRequest req, HttpServletResponse resp) throws IOException{
            //1. è®¾ç½®å“åº”ä½“å†…å®¹ç±»å‹å’Œå­—ç¬¦é›†
            resp.setContentType("text/html;charset=UTF-8");
            //2. åˆ›å»ºWebContextå¯¹è±¡
            WebContext webContext = new WebContext(req,resp,getServletContext());
            //3. å¤„ç†æ¨¡æ¿æ•°æ®
            templateEngine.process(templateName,webContext,resp.getWriter());
        }
    }
    

*   åœ¨web.xmlä¸­é…ç§context

    <!-- åœ¨web.xmlæ–‡ä»¶ä¸­çš„ä¸Šä¸‹æ–‡å‚æ•°ä¸­é…ç½®è§†å›¾å‰ç¼€å’Œè§†å›¾åç¼€çš„ç›¸å…³å±æ€§å’Œå€¼,æ–¹ä¾¿åç»­servletè¯»å– -->
        <!-- è¯´æ˜ï¼šparam-valueä¸­è®¾ç½®çš„å‰ç¼€ã€åç¼€çš„å€¼ä¸æ˜¯å¿…é¡»å«è¿™ä¸ªåå­—ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µå’Œéœ€æ±‚è¿›è¡Œä¿®æ”¹ã€‚
            è¿™é‡Œç¤ºä¾‹å°†ç”¨äºè§†å›¾å‰ç¼€è®¾ç½®ä¸º: /WEB-INF/view/, è§†å›¾åç¼€è®¾ç½®ä¸º: .html -->
        <context-param>
            <param-name>view-prefix</param-name>
            <param-value>/</param-value>
        </context-param>
        <context-param>
            <param-name>view-suffix</param-name>
            <param-value>.html</param-value>
        </context-param>
    

*   æœ€åæˆ‘ä»¬å°±å¯ä»¥è¿›å…¥æµ‹è¯•ç¯èŠ‚äº†

    @WebServlet("/index")
    public class TestServlet extends ViewBaseServlet{
        @Override
        protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
            req.setAttribute("msg","ä¼ è¿‡æ¥çš„æ•°æ®~");
            //è¿™æ˜¯ä½ è¦è½¬åˆ°çš„é¡µé¢
            processTemplate("index",req,resp);
        }
    }
    

*   å…¶å®è¿™äº›é…ç½®åœ¨æˆ‘ä»¬çš„å®˜æ–¹æ–‡æ¡£ä¸­éƒ½æœ‰ï¼Œæ¨èå¤§å®¶å­¦ä¼šè·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ ğŸ‘»ã€‚

äºŒã€Thymeleafå¸¸ç”¨è¯­æ³•
===============

åŠ å…¥`<html xmlns:th="http://www.thymeleaf.org">`è§„èŒƒ

2.1 æ ‡å‡†å˜é‡è¡¨è¾¾å¼
-----------

    <p th:text="æ¬¢è¿Thymeleaf">Hello~</p>
    <h1 th:text="${msg}">msgä¼šæ›¿æ¢è¿™ä¸ªä¿¡æ¯/h1>
    
    <!-- å¯ä»¥å°†ä¼ è¿‡æ¥çš„å¯¹è±¡ï¼Œç®€å†™æˆè¿™æ ·-->
    <div th:object="${user}">
            <p th:text="*{id}">id</p>
            <p th:text="*{name}">name</p>
    </div>
    
    <!-- è¿æ¥è¡¨è¾¾å¼-->
    <a th:href="@{/stu/student(id=20,name='lx')}"
    <img src="" th:src="@{${å›¾ç‰‡åœ°å€}}" alt="">
    

2.2 each
--------

    <div th:each="li:${list}">
        <span th:text="${liStat.size}"></span>
        <span th:text="${li.id}"></span>
        <span th:text="${li.name}"></span>
    </div>
    

            ArrayList<User> list = new ArrayList<>();
            list.add(new User(1001,"Meteor"));
            list.add(new User(1002,"Meteors"));
            list.add(new User(1003,"Meteorss"));
            req.setAttribute("list",list);
    

2.3 if
------

    <div th:if="10 > 0">
        æ˜¾ç¤ºæ–‡æœ¬å†…å®¹
    </div>
    <div th:unless="10 > 0">
        æ˜¾ç¤ºæ–‡æœ¬å†…å®¹
    </div>
    

2.4 switch
----------

    <div th:switch="${sex}">
        <p th:case="m">æ˜¾ç¤ºç”·</p>
        <p th:case="f">æ˜¾ç¤ºå¥³</p>
        <p th:case="*">æ˜¾ç¤ºæœªçŸ¥</p>
    </div>
    

2.5 th:inline
-------------

    <div th:inline="text">
        <p>æ˜¾ç¤ºå§“åï¼š[[${key}]]</p>
    </div>
    
    <script type="text/javascript" th:inline="javascript">
        alert("è·å–æ¨¡æ¿æ•°æ®" + [[${method}]]);
    </script>
    
    <p th:text=" 'æˆ‘æ˜¯' + ${name} + ',å–œæ¬¢å¬ä»–çš„' + ${music}">
        æ˜¾ç¤ºæ•°æ®
    </p>
    

2.6 å†…ç½®å¯¹è±¡
--------

*   Â #request è¡¨ç¤º HttpServletRequest
    
*   Â #session è¡¨ç¤º HttpSessionå¯¹è±¡
    
*   session è¡¨ç¤º HttpSessionå¯¹è±¡ï¼Œæ˜¯#sessionç®€åŒ–çš„ä¸€ç§æ–¹å¼
    

    <p th:text="${#request.getAttribute('user')}"></p>
    <p th:text="${#request.getContextPath()}"></p>
    <p th:text="${#param.name}"></p>
    <p th:text="${#param.size()}"></p>
    

ä¸‰ã€ç»“å°¾
====

*   å¯¹äº**Tomcatçš„Servlet**å†…å®¹å°±æ€»ç»“è¿™ä¹ˆå¤šï¼Œè‹¥æƒ³æ·±å…¥å­¦ä¹ ç­‰å¾…åç»­æ›´æ–°ã€‚
*   æˆ‘å°†ä¼šç»§ç»­æ›´æ–°å…³äº**Javaæ–¹å‘**çš„å­¦ä¹ çŸ¥è¯†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å…³æ³¨ä¸€ä¸‹ã€‚
*   æ–‡ç« å†™å¾—æ¯”è¾ƒèµ°å¿ƒï¼Œç”¨äº†å¾ˆé•¿æ—¶é—´ï¼Œç»å¯¹**ä¸æ˜¯copy**è¿‡æ¥çš„ï¼
*   **å°Šé‡**æ¯ä¸€ä½å­¦ä¹ çŸ¥è¯†çš„äººï¼ŒåŒæ—¶ä¹Ÿ**å°Šé‡**æ¯ä¸€ä½åˆ†äº«çŸ¥è¯†çš„äººã€‚
*   ğŸ˜ä½ çš„**ç‚¹èµä¸å…³æ³¨**ï¼Œæ˜¯æˆ‘åŠªåŠ›å‰è¡Œçš„æ— é™åŠ¨åŠ›ã€‚ğŸ¤©