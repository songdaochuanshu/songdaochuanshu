---
layout: post
title: "《爆肝整理》保姆级系列教程-玩转Charles抓包神器教程(6)-Charles安卓手机抓包大揭秘"
date: "2023-02-08T09:17:23.142Z"
---
《爆肝整理》保姆级系列教程-玩转Charles抓包神器教程(6)-Charles安卓手机抓包大揭秘
=================================================

### 1.简介

Charles和Fiddler一样不但能截获各种浏览器发出的 HTTP 请求，也可以截获各种智能手机发出的HTTP/ HTTPS 请求。

Charles也能截获 Android 和 Windows Phone 等设备发出的 HTTP/HTTPS 请求。

今天宏哥讲解和分享Charles如何截获安卓移动端发出的 HTTP/HTTPS 请求。

### 2.环境准备

Charles如果想要实现手机抓包，需要先满足下面 3 个条件：

（1）电脑上安装有Charles抓包工具。

（2）安装有Charles的电脑必须跟手机处在同一个网络里，并且手机网络代理必须设置为Charles，当我们的手机发送数据时必须经过Charles这一层服务。

（3）在Charles中设置好捕获 HTTPS。

1.宏哥的环境是Windows 10版本 64位系统。如下图所示：

![](https://img2018.cnblogs.com/blog/1232840/201906/1232840-20190605155307021-483968621.png)

2.夜神模拟器的安卓版本是：5.1.1 。   如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230202112209386-1655062529.png)

### 3.大致思路步骤

1.电脑本地安装charles证书

2.查看电脑charles的IP和端口号

3.手机连接charles，抓取简单的http

4.charles设置ssl proxy setting

5.手机安装charles证书

### 4.为什么需要安装Charles的CA证书呢？

1）先理清一些概念的东西：

a)简单来说，https是http的安全版本，超文本传输协议http是以明文发送数据，而https是具有安全性的ssl加密传输协议，可以这么认为https＝http＋ssl。

b)采用https的服务器必须从CA申请一个用于证明服务器用途类型的证书，证书是唯一性，只用于对应的服务器。客户端要认可这个服务器是否是安全的，可以进行访问或者交易等操作，则需要进行对服务端的验证。

下图是客户端对服务器的验证过程：

![](https://img2022.cnblogs.com/blog/1232840/202210/1232840-20221017155422329-1390400640.png)

c)ssl证书，遵循了ssl协议，在客户端和服务器之间建立了一条ssl安全通道，一般ssl证书都是在验证服务器身份后颁发给客户端。

d)由于ssl技术已建立在所有主要的浏览器和web服务器程序中，因此，仅需安装服务器证书就可以激活ssl协议，所以客户端通过信任该证书，就相当于信任了该主机（服务器）。

下图是客户端和服务端加密通讯的流程：

![](https://img2022.cnblogs.com/blog/1232840/202210/1232840-20221017155345225-206762269.png)

2）通过以上一个简单的理顺之后，这也就为什么当我们在使用Charles进行抓包的时候需要安装证书，可以通过ssl数字证书中的私用密钥来解译加密的信息，展示在Charles中，但是Charles有一个特殊的地方，就是实际上客户端安装的是Charles的CA证书，然后Charles安装服务器的CA证书，实际上流程还是一样的。

![](https://img2022.cnblogs.com/blog/1232840/202210/1232840-20221017155407683-745262484.png)

### 5.安卓手机抓包配置

#### 5.1Charles PC端http配置

http是默认配置好的，要是默认安装完没配置好，我们就自己配置一下，默认的端口号是“8888”我们后面设置手机代理的的时候也要注意这个端口要保持一致。

Charles的配置：这是要打开代理功能，具体操作步骤如下：

1.启动Charles，点击“Proxy-->Proxy Settings”，然后在Proxy Settings中填好端口（8888），并且勾选上“Enable transparent HTTP proxying”，最后点击“OK”。如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202210/1232840-20221017160938531-1132020929.png)

2.查看运行Charles的电脑的IP地址，可以在命令行中运行ipconfig或者直接查看网络配置，如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202210/1232840-20221017161141068-801533118.png)

3.可以对照一下当前所安装的Charles中的ip地址是否一致，你可以直接在Charles上可以直接查看Charles的IP和端口，点击“Help-->SSL Proxying”，然后点击“Install Charles Root Certificate on a Mobile Device or Remote Browser”，如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202210/1232840-20221017162058212-1727013452.gif)

#### 5.2Charles PC端SSL（https）配置

无论电脑端还是手机端进行抓取Https的包，都需要先安装对应证书才能使用。具体操作步骤如下：

1.打开charles，点击help-->SSL Proxying-->Install Charles root  Certificate 安装证书，如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202209/1232840-20220928154713338-1834959882.gif)

2.点击完“Install Charles root  Certificate”后，然后点击“安装证书”，如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202209/1232840-20220928154958139-792055144.png)

3.点击“安装证书”后，选择存储位置“本地计算机”，点击“下一步”，如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202209/1232840-20220928155259731-163973539.png)

4.证书存储位置选择‘将所有的证书都放入下列存储’，然后点击证书存储后的“浏览”，证书存储选择“受信任的根证书颁发机构”，点击“确定”，如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202209/1232840-20220928155833665-1857855055.png)

5.点击“下一步”，如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202209/1232840-20220928155929070-559690160.png)

6.点击“完成”，提示导入成功。如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202209/1232840-20220928160134079-546175207.png)

7.点击proxy》 SSL Proxyng Settings。如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201151022553-1930933555.png)

8.打开界面如下 弄到跟我一样就可以 如果没有\*;443自己按add手动添host ：\*，port：443 。如下图所示：

![](https://p8.itc.cn/q_70/images03/20220926/a1d39add471d4cb18c4ecf67c4fd6509.png)

这样就可以抓取PC端的http和https类型的包了，接下来我们就来进行安卓手机端代理的配置。

#### 5.3安卓手机设置

本节内容适合所有的 Android设备。下面以夜神模拟器为例进行讲解，其他品牌的模拟器和真实的手机操作方法与此差不多。具体操作步骤如下：

1.在确定了手机和Charles在同一局域网下之后, 那么我们来到Android手机的设置选项下，找到夜神模拟器手机当前连接的WLAN（一些 Android 手机是单击右边的箭头，有的是长按弹出对话框），如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202207/1232840-20220712111350621-1087709686.png)

2.看到有一个wifi信号，**长按这个信号**，出现修改网络的弹窗。如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202207/1232840-20220712112923856-1575028830.png)

3.点击修改网络，选中高级选项，打开高级选项，将代理设为手动，代理服务器主机名填写电脑的IP，端口号填写为主机抓包工具的监听端口。如下图所示：

![](https://img2022.cnblogs.com/blog/1232840/202207/1232840-20220712113116884-1187495058.png)

4.点击保存，就成功完成代理的设置了。如下图所示：

 ![](https://img2022.cnblogs.com/blog/1232840/202207/1232840-20220712113421374-1414475632.png)

5.电脑出现允许代理的提示，点击Allow即可，如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202212/1232840-20221219150346347-430572369.png)

那么到此Android手机的网络代理设置就到此为止，其他不同型号的Android模拟器和真机设置大同小异，以此类推，实在不会的自己可以百度一下。到此处表示已经可以抓http的手机包了。

#### 5.4测试Charles捕获手机发出的 HTTP

1.打开手机上的浏览器，在浏览器中输入链接：http://open.vipexam.org。中科VIPExam考试学习资源数据库网站用的是 HTTP 协议而不是 HTTPS 协议，查看 Fiddler 是否捕获到了 HTTP 数据包。如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201154559962-1153249043.png)

2.打开手机上的 APP，在 APP 中进行一些操作，查看 Fiddler 是否能捕获到 HTTP 数据包。如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201154908491-334007776.png)

如果抓不到 HTTP 的包，很可能是 Windows 防火墙的问题，到控制面板中关闭防火墙后再试试。

#### 5.5测试Fiddler捕获手机发出的HTTPS

1.打开手机上的浏览器，在浏览器中输入HTTPS协议，查看Charles是否捕获到了HTTPS数据包。一直在报证书安全警告错误，无法抓取，因此需要我们安装证书，原因宏哥在抓取PC端Web页面包已经说过了，这里就不做赘述了。如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201155116705-1174475951.png)

2.打开手机上的APP，在APP中进行一些操作，查看Fiddler是否能捕获到HTTPS数据包。又出现了Unknown，如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201155401535-1833423359.png)

到此，我们知道了要想抓取手机端Https的数据，还的配置证书，证书不用问了，还是Charles下发的。

#### 5.6Android手机配置证书

通过前边宏哥的测试，我们知道在抓取Android手机数据包的时候 跟web端也是一样，都需要配置证书,否则是无法正常进行抓包的。之前已经在我们的android手机上配置好了Charles的代理服务了，那么现在就可以通过ip+port的方式来访问Charles从而下载对应的证书。具体操作步骤如下：

1.在Android手机上打开(自带)的浏览器，输入：**http://chls.pro/ssl** 来下载证书。如果不出意外的话就会出现如下界面:

 ![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201165050968-1542842811.png)

2.给证书命名为：CharlesRoot，点击“确定”，如下图所示：

 ![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201165233504-1144941837.png)

3.点击“确定”后，需要输入凭据存储的密码。如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201165409815-1361420923.png)

4.再次点击“确定”，提示需要设置锁屏密码（注：选择安装的文件后，需要输入手机的锁屏密码。Android一定要有锁屏密码才能安装证书），如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201165910562-791420496.png)

5.点击“确定”。按要求设置一个手机密码，自己设置一个，记住密码就行，最后不用了去系统-安全-密码中去掉即可，如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201170107552-1178665085.png)

6.完成锁屏密码后，提示证书已安装，证书安装成功后，如果你的手机系统没有设置密码或者锁屏图案，则系统会提示你设置锁屏图案或者密码。如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201170232926-103308013.png)

7.证书安装好后，查看已信任证书：具体位置在【设置--->安全--->信任的凭据--->用户】，如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201170417256-583070588.png)

### 6.开始Android抓包

通过前边的配置，我们现在可以开始抓安卓手机的https的包了。

1.打开手机上的浏览器，在浏览器中输入HTTPS协议的网站，例如：百度。如下图所示：

![](https://img2023.cnblogs.com/blog/1232840/202302/1232840-20230201171440810-755623128.png)

### 7.小结

 Charles和Fiddler一样，一个手机可以安装多个证书，但是每安装的一个证书里面都设置有IP地址，所以：安装的证书和电脑IP是一一对应的，当前的这个证书只能针对某一台电脑使用，更换电脑后，该证书将不能使用，只能重新安装与更换的电脑的IP相同的证书才能使用。

对了，关于Android7.0的版本在Fiddler那里已经详细地介绍了，只不过是工具换了一下，原理都差不多，这里和后边就不再做介绍了。而且这里介绍的和Fiddler抓包安卓手机的设置也基本一致，种种原因这里又啰嗦水了一遍。凑合看吧。

    为了方便大家在移动端也能看到我分享的博文，现已注册个人微信公众号，扫描左下方二维码即可，欢迎大家关注，有时间会及时分享相关技术博文。  
    为了方便大家互动讨论相关技术问题，现已组建专门的微信群，由于微信群满100，请您扫描右下方宏哥个人微信二维码拉你进群（请务必备注：已关注公众号进群）平时上班忙（和你一样），所以加好友不及时，请稍安勿躁~，欢迎大家加入这个大家庭，我们一起畅游知识的海洋。  
    感谢您花时间阅读此篇文章,如果您觉得这篇文章你学到了东西也是为了犒劳下博主的码字不易不妨打赏一下吧，让博主能喝上一杯咖啡，在此谢过了！  
    如果您觉得阅读本文对您有帮助，请点一下左下角“推荐”按钮，您的“推荐”将是我最大的写作动力！另外您也可以选择【**关注我**】，可以很方便找到我！  
    本文版权归作者和博客园共有，来源网址：[https://www.cnblogs.com/du-hong](https://www.cnblogs.com/du-hong) 欢迎各位转载，但是未经作者本人同意，转载文章之后必须在文章页面明显位置给出作者和原文连接，否则保留追究法律责任的权利！

![个人微信公众号](https://img2018.cnblogs.com/common/1741949/201911/1741949-20191119095948011-608816619.png) ![个人微信](https://img2018.cnblogs.com/common/1741949/201911/1741949-20191106101257091-849954564.png)