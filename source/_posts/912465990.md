---
layout: post
title: "ä»0æ­å»ºvue3ç»„ä»¶åº“: Inputç»„ä»¶"
date: "2022-11-11T10:23:17.822Z"
---
ä»0æ­å»ºvue3ç»„ä»¶åº“: Inputç»„ä»¶
====================

æœ¬ç¯‡æ–‡ç« å°†ä¸ºæˆ‘ä»¬çš„ç»„ä»¶åº“æ·»åŠ ä¸€ä¸ªæ–°æˆå‘˜:`Input`ç»„ä»¶ã€‚å…¶ä¸­`Input`ç»„ä»¶è¦å®ç°çš„åŠŸèƒ½æœ‰:

*   `åŸºç¡€ç”¨æ³•`
*   `ç¦ç”¨çŠ¶æ€`
*   `å°ºå¯¸å¤§å°`
*   `è¾“å…¥é•¿åº¦`
*   `å¯æ¸…ç©º`
*   `å¯†ç æ¡†`
*   `å¸¦Iconçš„è¾“å…¥æ¡†`
*   `æ–‡æœ¬åŸŸ`
*   `è‡ªé€‚åº”æ–‡æœ¬é«˜åº¦çš„æ–‡æœ¬åŸŸ`
*   `å¤åˆå‹è¾“å…¥æ¡†`

æ¯ä¸ªåŠŸèƒ½çš„å®ç°ä»£ç éƒ½åšäº†ç²¾ç®€,æ–¹ä¾¿å¤§å®¶å¿«é€Ÿå®šä½åˆ°æ ¸å¿ƒé€»è¾‘,æ¥ä¸‹æ¥å°±å¼€å§‹å¯¹è¿™äº›åŠŸèƒ½è¿›è¡Œä¸€ä¸€çš„å®ç°ã€‚

åŸºç¡€ç”¨æ³•
----

é¦–å…ˆå…ˆæ–°å»ºä¸€ä¸ª`input.vue`æ–‡ä»¶,ç„¶åå†™å…¥ä¸€ä¸ªæœ€åŸºæœ¬çš„`input`è¾“å…¥æ¡†

    <template>
      <div class="k-input">
        <input class="k-input__inner" />
      </div>
    </template>
    

ç„¶ååœ¨æˆ‘ä»¬çš„ vue é¡¹ç›®`examples`ä¸‹çš„`app.vue`å¼•å…¥`Input`ç»„ä»¶

    <template>
      <div class="Shake-demo">
        <Input />
      </div>
    </template>
    <script lang="ts" setup>
    import { Input } from "kitty-ui";
    </script>
    

æ­¤æ—¶é¡µé¢ä¸Šä¾¿å‡ºç°äº†åŸç”Ÿçš„è¾“å…¥æ¡†,æ‰€ä»¥éœ€è¦å¯¹è¿™ä¸ªè¾“å…¥æ¡†è¿›è¡Œæ ·å¼çš„æ·»åŠ ,åœ¨`input.vue`åŒçº§æ–°å»º`style/index.less`,`Input`æ ·å¼ä¾¿å†™åœ¨è¿™é‡Œ

    .k-input {
      font-size: 14px;
      display: inline-block;
      position: relative;
    
      .k-input__inner {
        background-color: #fff;
        border-radius: 4px;
        border: 1px solid #dcdfe6;
        box-sizing: border-box;
        color: #606266;
        display: inline-block;
        font-size: inherit;
        height: 40px;
        line-height: 40px;
        outline: none;
        padding: 0 15px;
        width: 100%;
        &::placeholder {
          color: #c2c2ca;
        }
    
        &:hover {
          border: 1px solid #c0c4cc;
        }
    
        &:focus {
          border: 1px solid #409eff;
        }
      }
    }
    

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b12194d84c214a83922c5b4c03f662f1~tplv-k3u1fbpfcp-watermark.image?)

æ¥ä¸‹æ¥è¦å®ç°`Input`ç»„ä»¶çš„æ ¸å¿ƒåŠŸèƒ½:**åŒå‘æ•°æ®ç»‘å®š**ã€‚å½“æˆ‘ä»¬åœ¨ vue ä¸­ä½¿ç”¨`input`è¾“å…¥æ¡†çš„æ—¶å€™,æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨`v-model`æ¥å®ç°**åŒå‘æ•°æ®ç»‘å®š**,`v-model`å…¶å®å°±æ˜¯`value @input`ç»“åˆçš„è¯­æ³•ç³–ã€‚è€Œåœ¨ vue3 ç»„ä»¶ä¸­ä½¿ç”¨`v-model`åˆ™è¡¨ç¤ºçš„æ˜¯`modelValue @update:modelValue`çš„è¯­æ³•ç³–ã€‚æ¯”å¦‚`Input`ç»„ä»¶ä¸ºä¾‹

    <Input v-model="tel" />
    

å…¶å®å°±æ˜¯

    <Input :modelValue="tel" @update:modelValue="tel = $event" />
    

æ‰€ä»¥åœ¨`input.vue`ä¸­æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥å®ç°`Input`ç»„ä»¶çš„**åŒå‘æ•°æ®ç»‘å®š**,è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨`setup`è¯­æ³•

    <template>
      <div class="k-input">
        <input
          class="k-input__inner"
          :value="inputProps.modelValue"
          @input="changeInputVal"
        />
      </div>
    </template>
    <script lang="ts" setup>
    //ç»„ä»¶å‘½å
    defineOptions({
      name: "k-input",
    });
    //ç»„ä»¶æ¥æ”¶çš„å€¼ç±»å‹
    type InputProps = {
      modelValue?: string | number;
    };
    
    //ç»„ä»¶å‘é€äº‹ä»¶ç±»å‹
    type InputEmits = {
      (e: "update:modelValue", value: string): void;
    };
    
    //withDefaultså¯ä»¥ä¸ºpropsæ·»åŠ é»˜è®¤å€¼ç­‰
    const inputProps = withDefaults(defineProps<InputProps>(), {
      modelValue: "",
    });
    const inputEmits = defineEmits<InputEmits>();
    
    const changeInputVal = (event: Event) => {
      inputEmits("update:modelValue", (event.target as HTMLInputElement).value);
    };
    </script>
    

![GIF333.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f642eccfd55b462087877de8503d8032~tplv-k3u1fbpfcp-watermark.image?)

åˆ°è¿™é‡Œ`åŸºç¡€ç”¨æ³•`å°±å®Œæˆäº†,æ¥ä¸‹æ¥å¼€å§‹å®ç°`ç¦ç”¨çŠ¶æ€`

ç¦ç”¨çŠ¶æ€
----

è¿™ä¸ªæ¯”è¾ƒç®€å•,åªè¦æ ¹æ®`props`çš„`disabled`æ¥èµ‹äºˆç¦ç”¨ç±»åå³å¯

    <template>
      <div class="k-input" :class="styleClass">
        <input
          class="k-input__inner"
          :value="inputProps.modelValue"
          @input="changeInputVal"
          :disabled="inputProps.disabled"
        />
      </div>
    </template>
    <script lang="ts" setup>
    //...
    type InputProps = {
      modelValue?: string | number;
      disabled?: boolean;
    };
    //...
    
    //æ ¹æ®propsæ›´æ”¹ç±»å
    const styleClass = computed(() => {
      return {
        "is-disabled": inputProps.disabled,
      };
    });
    </script>
    

ç„¶åç»™`is-disabled`å†™äº›æ ·å¼

    //...
    
    .k-input.is-disabled {
      .k-input__inner {
        background-color: #f5f7fa;
        border-color: #e4e7ed;
        color: #c0c4cc;
        cursor: not-allowed;
        &::placeholder {
          color: #c3c4cc;
        }
      }
    }
    

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d9e61468671488f8d2ee094b89bf4f8~tplv-k3u1fbpfcp-watermark.image?)

å°ºå¯¸
--

æŒ‰é’®å°ºå¯¸åŒ…æ‹¬`medium`,`small`,`mini`,ä¸ä¼ åˆ™æ˜¯é»˜è®¤å°ºå¯¸ã€‚åŒæ ·çš„æ ¹æ®`props`çš„`size`æ¥èµ‹äºˆä¸åŒç±»å

    const styleClass = computed(() => {
      return {
        "is-disabled": inputProps.disabled,
        [`k-input--${inputProps.size}`]: inputProps.size,
      };
    });
    

ç„¶åå†™è¿™ä¸‰ä¸ªç±»åçš„ä¸åŒæ ·å¼

    //...
    .k-input.k-input--medium {
      .k-input__inner {
        height: 36px;
        &::placeholder {
          font-size: 15px;
        }
      }
    }
    
    .k-input.k-input--small {
      .k-input__inner {
        height: 32px;
    
        &::placeholder {
          font-size: 14px;
        }
      }
    }
    
    .k-input.k-input--mini {
      .k-input__inner {
        height: 28px;
    
        &::placeholder {
          font-size: 13px;
        }
      }
    }
    

ç»§æ‰¿åŸç”Ÿ input å±æ€§
-------------

åŸç”Ÿçš„`input`æœ‰`type`,`placeholder`ç­‰å±æ€§,è¿™é‡Œå¯ä»¥ä½¿ç”¨ vue3 ä¸­çš„`useAttrs`æ¥å®ç°`props`ç©¿é€.å­ç»„ä»¶å¯ä»¥é€šè¿‡`v-bind`å°†`props`ç»‘å®š

    <template>
      <div class="k-input" :class="styleClass">
        <input
          class="k-input__inner"
          :value="inputProps.modelValue"
          @input="changeInputVal"
          :disabled="inputProps.disabled"
          v-bind="attrs"
        />
      </div>
    </template>
    <script lang="ts" setup>
    //...
    
    const attrs = useAttrs();
    </script>
    

å¯æ¸…ç©º
---

é€šè¿‡`clearable`å±æ€§ã€`Input`çš„å€¼æ˜¯å¦ä¸ºç©ºä»¥åŠæ˜¯å¦é¼ æ ‡æ˜¯å¦ç§»å…¥æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ˜¾ç¤ºå¯æ¸…ç©ºå›¾æ ‡ã€‚å›¾æ ‡åˆ™ä½¿ç”¨ç»„ä»¶åº“çš„`Icon`ç»„ä»¶

    <template>
      <div
        class="k-input"
        @mouseenter="isEnter = true"
        @mouseleave="isEnter = false"
        :class="styleClass"
      >
        <input
          class="k-input__inner"
          :disabled="inputProps.disabled"
          v-bind="attrs"
          :value="inputProps.modelValue"
          @input="changeInputVal"
        />
        <div
          @click="clearValue"
          v-if="inputProps.clearable && isClearAbled"
          v-show="isFoucs"
          class="k-input__suffix"
        >
          <Icon name="error" />
        </div>
      </div>
    </template>
    <script setup lang="ts">
    //...
    import Icon from "../icon/index";
    //...
    //åŒå‘æ•°æ®ç»‘å®š&æ¥æ”¶å±æ€§
    type InputProps = {
      modelValue?: string | number;
      disabled?: boolean;
      size?: string;
      clearable?: boolean;
    };
    //...
    const isClearAbled = ref(false);
    const changeInputVal = (event: Event) => {
      //å¯æ¸…é™¤clearable
      (event.target as HTMLInputElement).value
        ? (isClearAbled.value = true)
        : (isClearAbled.value = false);
    
      inputEmits("update:modelValue", (event.target as HTMLInputElement).value);
    };
    
    //æ¸…é™¤input value
    const isEnter = ref(true);
    const clearValue = () => {
      inputEmits("update:modelValue", "");
    };
    </script>
    

æ¸…é™¤å›¾æ ‡éƒ¨åˆ† css æ ·å¼

    .k-input__suffix {
      position: absolute;
      right: 10px;
      height: 100%;
      top: 0;
      display: flex;
      align-items: center;
      cursor: pointer;
      color: #c0c4cc;
    }
    

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/159aaad8a4764edc86174f4e662653a5~tplv-k3u1fbpfcp-watermark.image?)

å¯†ç æ¡† show-password
-----------------

é€šè¿‡ä¼ å…¥`show-password`å±æ€§å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¯åˆ‡æ¢æ˜¾ç¤ºéšè—çš„å¯†ç æ¡†ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯å¦‚æœä¼ äº†`clearable`åˆ™ä¸ä¼šæ˜¾ç¤ºåˆ‡æ¢æ˜¾ç¤ºéšè—çš„å›¾æ ‡

    <template>
      <div
        class="k-input"
        @mouseenter="isEnter = true"
        @mouseleave="isEnter = false"
        :class="styleClass"
      >
        <input
          ref="ipt"
          class="k-input__inner"
          :disabled="inputProps.disabled"
          v-bind="attrs"
          :value="inputProps.modelValue"
          @input="changeInputVal"
        />
        <div class="k-input__suffix" v-show="isShowEye">
          <Icon @click="changeType" :name="eyeIcon" />
        </div>
      </div>
    </template>
    <script setup lang="ts">
    //...
    const attrs = useAttrs();
    
    //...
    
    //æ˜¾ç¤ºéšè—å¯†ç æ¡† showPassword
    const ipt = ref();
    Promise.resolve().then(() => {
      if (inputProps.showPassword) {
        ipt.value.type = "password";
      }
    });
    const eyeIcon = ref("browse");
    const isShowEye = computed(() => {
      return (
        inputProps.showPassword && inputProps.modelValue && !inputProps.clearable
      );
    });
    const changeType = () => {
      if (ipt.value.type === "password") {
        eyeIcon.value = "eye-close";
        ipt.value.type = attrs.type || "text";
        return;
      }
      ipt.value.type = "password";
      eyeIcon.value = "browse";
    };
    </script>
    

> è¿™é‡Œæ˜¯é€šè¿‡è·å–`input`å…ƒç´ ,ç„¶åé€šè¿‡å®ƒçš„`type`å±æ€§è¿›è¡Œåˆ‡æ¢,å…¶ä¸­`browse`å’Œ`eye-close`åˆ†åˆ«æ˜¯`Icon`ç»„ä»¶ä¸­çœ¼ç›å¼€ä¸é—­,æ•ˆæœå¦‚ä¸‹

![password.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b85f237f2a4141f6b2fab06e5e7a710a~tplv-k3u1fbpfcp-watermark.image?)

å¸¦ Icon çš„è¾“å…¥æ¡†
-----------

é€šè¿‡`prefix-icon`å’Œ`suffix-icon` å±æ€§å¯ä»¥ä¸º`Input`ç»„ä»¶æ·»åŠ é¦–å°¾å›¾æ ‡ã€‚

å¯ä»¥é€šè¿‡`è®¡ç®—å±æ€§`åˆ¤æ–­å‡ºæ˜¯å¦æ˜¾ç¤ºé¦–å°¾å›¾æ ‡,é˜²æ­¢å’Œå‰é¢çš„`clearable`å’Œ`show-password`å†²çª.è¿™é‡Œä»£ç åšäº†

    <template>
      <div class="k-input">
        <input
          ref="ipt"
          class="k-input__inner"
          :class="{ ['k-input--prefix']: isShowPrefixIcon }"
          :disabled="inputProps.disabled"
          v-bind="attrs"
          :value="inputProps.modelValue"
          @input="changeInputVal"
        />
    
        <div class="k-input__prefix" v-if="isShowPrefixIcon">
          <Icon :name="inputProps.prefixIcon" />
        </div>
        <div class="k-input__suffix no-cursor" v-if="isShowSuffixIcon">
          <Icon :name="inputProps.suffixIcon" />
        </div>
      </div>
    </template>
    <script setup lang="ts">
    //...
    type InputProps = {
      prefixIcon?: string;
      suffixIcon?: string;
    };
    
    //...
    
    //å¸¦Iconè¾“å…¥æ¡†
    const isShowSuffixIcon = computed(() => {
      return (
        inputProps.suffixIcon && !inputProps.clearable && !inputProps.showPassword
      );
    });
    const isShowPrefixIcon = computed(() => {
      return inputProps.prefixIcon;
    });
    </script>
    

ç›¸å…³æ ·å¼éƒ¨åˆ†

    .k-input__suffix,
    .k-input__prefix {
      position: absolute;
      right: 10px;
      height: 100%;
      top: 0;
      display: flex;
      align-items: center;
      cursor: pointer;
      color: #c0c4cc;
      font-size: 15px;
    }
    
    .no-cursor {
      cursor: default;
    }
    
    .k-input--prefix.k-input__inner {
      padding-left: 30px;
    }
    
    .k-input__prefix {
      position: absolute;
      width: 20px;
      cursor: default;
      left: 10px;
    }
    

åœ¨`app.vue`ä¸­ä½¿ç”¨æ•ˆæœå¦‚ä¸‹

    <template>
      <div class="input-demo">
        <Input v-model="tel" suffixIcon="edit" placeholder="è¯·è¾“å…¥å†…å®¹" />
    
        <Input v-model="tel" prefixIcon="edit" placeholder="è¯·è¾“å…¥å†…å®¹" />
      </div>
    </template>
    <script lang="ts" setup>
    import { Input } from "kitty-ui";
    import { ref } from "vue";
    const tel = ref("");
    </script>
    <style lang="less">
    .input-demo {
      width: 200px;
    }
    </style>
    

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/120889972cc640ba850dba34b3298d3f~tplv-k3u1fbpfcp-watermark.image?)

æ–‡æœ¬åŸŸ
---

å°†`type`å±æ€§çš„å€¼æŒ‡å®šä¸º`textarea`å³å¯å±•ç¤ºæ–‡æœ¬åŸŸæ¨¡å¼ã€‚å®ƒç»‘å®šçš„äº‹ä»¶ä»¥åŠå±æ€§å’Œ`input`åŸºæœ¬ä¸€æ ·

    <template>
      <div class="k-textarea" v-if="attrs.type === 'textarea'">
        <textarea
          class="k-textarea__inner"
          :style="textareaStyle"
          v-bind="attrs"
          ref="textarea"
          :value="inputProps.modelValue"
          @input="changeInputVal"
        />
      </div>
      <div
        v-else
        class="k-input"
        @mouseenter="isEnter = true"
        @mouseleave="isEnter = false"
        :class="styleClass"
      >
        ...
      </div>
    </template>
    

æ ·å¼åŸºæœ¬ä¹Ÿå°±æ˜¯`focus`,`hover`æ”¹å˜ border é¢œè‰²

    .k-textarea {
      width: 100%;
    
      .k-textarea__inner {
        display: block;
        padding: 5px 15px;
        line-height: 1.5;
        box-sizing: border-box;
        width: 100%;
        font-size: inherit;
        color: #606266;
        background-color: #fff;
        background-image: none;
        border: 1px solid #dcdfe6;
        border-radius: 4px;
    
        &::placeholder {
          color: #c2c2ca;
        }
    
        &:hover {
          border: 1px solid #c0c4cc;
        }
    
        &:focus {
          outline: none;
          border: 1px solid #409eff;
        }
      }
    }
    

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9818fc2060cb418e8e0168cd7d0289e0~tplv-k3u1fbpfcp-watermark.image?)

å¯è‡ªé€‚åº”é«˜åº¦æ–‡æœ¬åŸŸ
---------

ç»„ä»¶å¯ä»¥é€šè¿‡æ¥æ”¶`autosize`å±æ€§æ¥å¼€å¯è‡ªé€‚åº”é«˜åº¦,åŒæ—¶`autosize`ä¹Ÿå¯ä»¥ä¼ å¯¹è±¡å½¢å¼æ¥æŒ‡å®šæœ€å°å’Œæœ€å¤§è¡Œé«˜

    type AutosizeObj = {
        minRows?: number
        maxRows?: number
    }
    type InputProps = {
        autosize?: boolean | AutosizeObj
    }
    

å…·ä½“å®ç°åŸç†æ˜¯é€šè¿‡ç›‘å¬è¾“å…¥æ¡†å€¼çš„å˜åŒ–æ¥è°ƒæ•´`textarea`çš„æ ·å¼,å…¶ä¸­ç”¨åˆ°äº†ä¸€äº›åŸç”Ÿçš„æ–¹æ³•è­¬å¦‚`window.getComputedStyle(è·å–åŸç”Ÿcsså¯¹è±¡)`,`getPropertyValue(è·å–csså±æ€§å€¼)`ç­‰,æ‰€ä»¥åŸç”Ÿ`js`å¿˜è®°çš„å¯ä»¥å¤ä¹ ä¸€ä¸‹

    ...
    const textareaStyle = ref<any>()
    const textarea = shallowRef<HTMLTextAreaElement>()
    watch(() => inputProps.modelValue, () => {
        if (attrs.type === 'textarea' && inputProps.autosize) {
            const minRows = isObject(inputProps.autosize) ? (inputProps.autosize as AutosizeObj).minRows : undefined
            const maxRows = isObject(inputProps.autosize) ? (inputProps.autosize as AutosizeObj).maxRows : undefined
            nextTick(() => {
                textareaStyle.value = calcTextareaHeight(textarea.value!, minRows, maxRows)
            })
        }
    
    }, { immediate: true })
    

å…¶ä¸­`calcTextareaHeight`ä¸º

    const isNumber = (val: any): boolean => {
        return typeof val === 'number'
    }
    //éšè—çš„å…ƒç´ 
    let hiddenTextarea: HTMLTextAreaElement | undefined = undefined
    
    //éšè—å…ƒç´ æ ·å¼
    const HIDDEN_STYLE = `
      height:0 !important;
      visibility:hidden !important;
      overflow:hidden !important;
      position:absolute !important;
      z-index:-1000 !important;
      top:0 !important;
      right:0 !important;
    `
    
    const CONTEXT_STYLE = [
        'letter-spacing',
        'line-height',
        'padding-top',
        'padding-bottom',
        'font-family',
        'font-weight',
        'font-size',
        'text-rendering',
        'text-transform',
        'width',
        'text-indent',
        'padding-left',
        'padding-right',
        'border-width',
        'box-sizing',
    ]
    
    type NodeStyle = {
        contextStyle: string
        boxSizing: string
        paddingSize: number
        borderSize: number
    }
    
    type TextAreaHeight = {
        height: string
        minHeight?: string
    }
    
    function calculateNodeStyling(targetElement: Element): NodeStyle {
      //è·å–å®é™…textareaæ ·å¼è¿”å›å¹¶èµ‹å€¼ç»™éšè—çš„textarea
        const style = window.getComputedStyle(targetElement)
    
        const boxSizing = style.getPropertyValue('box-sizing')
    
        const paddingSize =
            Number.parseFloat(style.getPropertyValue('padding-bottom')) +
            Number.parseFloat(style.getPropertyValue('padding-top'))
    
        const borderSize =
            Number.parseFloat(style.getPropertyValue('border-bottom-width')) +
            Number.parseFloat(style.getPropertyValue('border-top-width'))
    
        const contextStyle = CONTEXT_STYLE.map(
            (name) => `${name}:${style.getPropertyValue(name)}`
        ).join(';')
    
        return { contextStyle, paddingSize, borderSize, boxSizing }
    }
    
    export function calcTextareaHeight(
        targetElement: HTMLTextAreaElement,
        minRows = 1,
        maxRows?: number
    ): TextAreaHeight {
        if (!hiddenTextarea) {
          //åˆ›å»ºéšè—çš„textarea
            hiddenTextarea = document.createElement('textarea')
            document.body.appendChild(hiddenTextarea)
        }
        //ç»™éšè—çš„teatareaèµ‹äºˆå®é™…textareaçš„æ ·å¼ä»¥åŠå€¼(value)
        const { paddingSize, borderSize, boxSizing, contextStyle } =
            calculateNodeStyling(targetElement)
        hiddenTextarea.setAttribute('style', `${contextStyle};${HIDDEN_STYLE}`)
        hiddenTextarea.value = targetElement.value || targetElement.placeholder || ''
        //éšè—textareaæ•´ä¸ªé«˜åº¦,åŒ…æ‹¬å†…è¾¹è·padding,border
        let height = hiddenTextarea.scrollHeight
        const result = {} as TextAreaHeight
        //åˆ¤æ–­boxSizing,è¿”å›å®é™…é«˜åº¦
        if (boxSizing === 'border-box') {
            height = height + borderSize
        } else if (boxSizing === 'content-box') {
            height = height - paddingSize
        }
    
        hiddenTextarea.value = ''
        //è®¡ç®—å•è¡Œé«˜åº¦
        const singleRowHeight = hiddenTextarea.scrollHeight - paddingSize
    
        if (isNumber(minRows)) {
            let minHeight = singleRowHeight * minRows
            if (boxSizing === 'border-box') {
                minHeight = minHeight + paddingSize + borderSize
            }
            height = Math.max(minHeight, height)
            result.minHeight = `${minHeight}px`
        }
        if (isNumber(maxRows)) {
            let maxHeight = singleRowHeight * maxRows!
            if (boxSizing === 'border-box') {
                maxHeight = maxHeight + paddingSize + borderSize
            }
            height = Math.min(maxHeight, height)
        }
        result.height = `${height}px`
        hiddenTextarea.parentNode?.removeChild(hiddenTextarea)
        hiddenTextarea = undefined
    
        return result
    }
    
    

> è¿™é‡Œçš„é€»è¾‘ç¨å¾®å¤æ‚ä¸€ç‚¹,å¤§è‡´å°±æ˜¯åˆ›å»ºä¸€ä¸ªéšè—çš„`textarea`,ç„¶åæ¯æ¬¡å½“è¾“å…¥æ¡†å€¼å‘ç”Ÿå˜åŒ–æ—¶,å°†å®ƒçš„`value`èµ‹å€¼ä¸ºç»„ä»¶çš„`textarea`çš„`value`,æœ€åè®¡ç®—å‡ºè¿™ä¸ªéšè—çš„`textarea`çš„`scrollHeight`ä»¥åŠå…¶å®ƒ`padding`ä¹‹ç±»çš„å€¼å¹¶ä½œä¸ºé«˜åº¦è¿”å›èµ‹å€¼ç»™ç»„ä»¶ä¸­çš„`textarea`

æœ€ååœ¨`app.vue`ä¸­ä½¿ç”¨

    <template>
      <div class="input-demo">
        <Input
          v-model="tel"
          :autosize="{ minRows: 2 }"
          type="textarea"
          suffixIcon="edit"
          placeholder="è¯·è¾“å…¥å†…å®¹"
        />
      </div>
    </template>
    

![GIFtextarea.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51428313def9439abd2a312ecca8fe7b~tplv-k3u1fbpfcp-watermark.image?)

å¤åˆå‹è¾“å…¥æ¡†
------

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤åˆå‹è¾“å…¥æ¡†æ¥å‰ç½®æˆ–è€…åç½®æˆ‘ä»¬çš„å…ƒç´ ,å¦‚ä¸‹æ‰€ç¤º

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7aa2cef434be472183200625524d2650~tplv-k3u1fbpfcp-watermark.image?)

è¿™é‡Œæˆ‘ä»¬å€ŸåŠ© vue3 ä¸­çš„`slot`è¿›è¡Œå®ç°,å…¶ä¸­ç”¨åˆ°äº†`useSlots`æ¥åˆ¤æ–­ç”¨æˆ·ä½¿ç”¨äº†å“ªä¸ªæ’æ§½,ä»è€Œå±•ç¤ºä¸åŒæ ·å¼

    import { useSlots } from "vue";
    
    //å¤åˆè¾“å…¥æ¡†
    const slots = useSlots();
    

åŒæ—¶`template`ä¸­æ¥æ”¶å‰åä¸¤ä¸ªæ’æ§½

    <template>
      <div
        class="k-input"
        @mouseenter="isEnter = true"
        @mouseleave="isEnter = false"
        :class="styleClass"
      >
        <div class="k-input__prepend" v-if="slots.prepend">
          <slot name="prepend"></slot>
        </div>
        <input
          ref="ipt"
          class="k-input__inner"
          :class="inputStyle"
          :disabled="inputProps.disabled"
          v-bind="attrs"
          :value="inputProps.modelValue"
          @input="changeInputVal"
        />
        <div class="k-input__append" v-if="slots.append">
          <slot name="append"></slot>
        </div>
      </div>
    </template>
    <script setup lang="ts">
    import { useSlots } from "vue";
    const styleClass = computed(() => {
      return {
        ["k-input-group k-input-prepend"]: slots.prepend,
        ["k-input-group k-input-append"]: slots.append,
      };
    });
    //å¤åˆè¾“å…¥æ¡†
    const slots = useSlots();
    </script>
    

æœ€åç»™ä¸¤ä¸ªæ’æ§½å†™ä¸Šæ ·å¼å°±å®ç°äº†**å¤åˆå‹è¾“å…¥æ¡†**å•¦

    .k-input.k-input-group.k-input-append,
    .k-input.k-input-group.k-input-prepend {
      line-height: normal;
      display: inline-table;
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    
      .k-input__inner {
        border-radius: 0 4px 4px 0;
      }
    
      //å¤åˆè¾“å…¥æ¡†
      .k-input__prepend,
      .k-input__append {
        background-color: #f5f7fa;
        color: #909399;
        vertical-align: middle;
        display: table-cell;
        position: relative;
        border: 1px solid #dcdfe6;
        border-radius: 4 0px 0px 4px;
        padding: 0 20px;
        width: 1px;
        white-space: nowrap;
      }
    
      .k-input__append {
        border-radius: 0 4px 4px 0px;
      }
    }
    
    .k-input.k-input-group.k-input-append {
      .k-input__inner {
        border-top-right-radius: 0px;
        border-bottom-right-radius: 0px;
      }
    }
    

åœ¨`app.vue`ä¸­ä½¿ç”¨

    <template>
        <div class="input-demo">
            <Input v-model="tel" placeholder="è¯·è¾“å…¥å†…å®¹">
            <template #prepend>
                http://
            </template>
            </Input>
            <Input v-model="tel" placeholder="è¯·è¾“å…¥å†…å®¹">
            <template #append>
                .com
            </template>
            </Input>
        </div>
    </template>
    

æ€»ç»“
--

ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„`Input`ç»„ä»¶å…¶å®åŒ…å«çš„å†…å®¹è¿˜æ˜¯å¾ˆå¤šçš„,åšå®Œä¹‹åä¼šå‘ç°å¯¹è‡ªå·±å¾ˆå¤šåœ°æ–¹éƒ½æœ‰æå‡å’Œå¸®åŠ©ã€‚

å¦‚æœä½ å¯¹vue3ç»„ä»¶åº“å¼€å‘ä¹Ÿæ„Ÿå…´è¶£çš„è¯å¯ä»¥å…³æ³¨æˆ‘,ç»„ä»¶åº“çš„æ‰€æœ‰å®ç°ç»†èŠ‚éƒ½åœ¨ä»¥å¾€æ–‡ç« é‡Œï¼ŒåŒ…æ‹¬`ç¯å¢ƒæ­å»º`ï¼Œ`è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ`ï¼Œ`æ–‡æ¡£æ­å»º`ï¼Œ`vitestå•å…ƒæµ‹è¯•`ç­‰ç­‰ã€‚

> å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©åŠ¨åŠ¨æŒ‡å¤´ç‚¹ä¸ªèµğŸ‘å§~

æºç åœ°å€
----

[kitty-ui: ä¸€ä¸ªä½¿ç”¨Vite+Tsæ­å»ºçš„Vue3ç»„ä»¶åº“](https://gitee.com/geeksdidi/kittyui)