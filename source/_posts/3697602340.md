---
layout: post
title: "ç”¨Flutterå†™äº†ä¸ªåšå®¢å›­APP"
date: "2022-12-13T16:23:40.815Z"
---
ç”¨Flutterå†™äº†ä¸ªåšå®¢å›­APP
=================

æœ€è¿‘åœ¨æ‘¸é±¼æ—¶çœ‹åˆ°äº†ä¸€äº›åšå®¢å›­APIæ–‡ç« ï¼Œå°±æƒ³ç€æ‘¸é±¼æ—¶å†™ä¸ªAPPç»ƒç»ƒæ‰‹ã€‚

ç°é˜¶æ®µå®ç°äº†ä»¥ä¸‹åŠŸèƒ½æ¨¡å—ï¼š

*   åšå®¢æµè§ˆã€è¯„è®º
*   æ–°é—»æµè§ˆ
*   é—ªå­˜æµè§ˆã€å‘å¸ƒã€è¯„è®º
*   åšé—®æµè§ˆ
*   ç”¨æˆ·ç™»å½•

åšé—®æš‚æ—¶åªæ”¯æŒæµè§ˆï¼Œä¸æ”¯æŒå›ç­”æé—®ç­‰æ“ä½œã€‚

æ”¯æŒiOSã€Androidå¹³å°ã€‚

æˆªå›¾
--

æµ…è‰²æ¨¡å¼ï¼š

![Light.jpg](https://vip2.loli.io/2022/12/13/JBI4a9U67pxKfzg.jpg)

æ·±è‰²æ¨¡å¼ï¼š

![Dark.jpg](https://vip2.loli.io/2022/12/13/frWo4glTZVASURB.jpg)

API
---

å¼€å‘å‰éœ€è¦å…ˆåˆ°[https://api.cnblogs.com/](https://api.cnblogs.com/)ç”³è¯·API KEYï¼Œç”³è¯·é€šè¿‡æ‰èƒ½ä½¿ç”¨åšå®¢å›­çš„APIã€‚

è¾“å…¥ä¸€ä¸‹ä¸ªäººä¿¡æ¯è·Ÿåº”ç”¨ä¿¡æ¯ï¼Œæäº¤åç­‰å¾…åšå®¢å›­çš„å®¡æ ¸ã€‚é€šè¿‡å®¡æ ¸åä¼šæ”¶åˆ°ä¸€å°åŒ…å«ClientIdå’ŒClientSecretçš„é‚®ä»¶ã€‚

![ç”³è¯·APIKEY.png](https://vip2.loli.io/2022/12/13/RMje6ZhWmrIzYik.png)

[åšå®¢å›­APIæ–‡æ¡£](https://api.cnblogs.com/help)ä¸Šçš„APIä¸å…¨ï¼Œæœ‰äº›APIéœ€è¦åˆ°[Github](https://github.com/cnblogs/openapi)ä¸­æŸ¥è¯¢ã€‚

å¼€å‘
--

APIç”³è¯·å®Œæˆå°±å¯ä»¥æ„‰å¿«çš„è¿›è¡Œå¼€å‘äº†ã€‚  
Flutterç‰ˆæœ¬è¿™æ¬¡é€‰æ‹©äº†æœ€æ–°çš„3.3ï¼ŒåŸºäºGetXæ¡†æ¶+Dioæ¥å¼€å‘ï¼Œä¸å¾—ä¸è¯´GetXä¸€æŠŠæ¢­çš„æ„Ÿè§‰æ˜¯çœŸçš„çˆ½ã€‚

ç›®å½•ç»“æ„è·ŸGetXæ¡†æ¶å·®ä¸å¤šï¼ŒæŒ‰æˆ‘è‡ªå·±çš„ä¹ æƒ¯è¿›è¡Œäº†ä¸€äº›æ”¹åŠ¨ï¼š

*   `app` ä¸€äº›é€šç”¨çš„ç±»åŠæ ·å¼
*   `services` æä¾›æ•°æ®å­˜å‚¨ç­‰æœåŠ¡
*   `requests` è¯·æ±‚çš„å°è£…
*   `generated` ç”Ÿæˆçš„å›½é™…åŒ–æ–‡ä»¶,ä½¿ç”¨ `get generate locales`ç”Ÿæˆ
*   `modules` æ¨¡å—ï¼Œæ¯ä¸ªä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼ŒviewåŠcontroller
*   `widgets` è‡ªå®šä¹‰çš„å°ç»„ä»¶
*   `routes` è·¯ç”±å®šä¹‰
*   `models` å®ä½“ç±»

ä¸ªäººç»ƒæ‰‹é¡¹ç›®å°±åŠ ä¸Šäº†ä¸€äº›ä»¥å‰æ²¡ç”¨è¿‡åŒ…è·Ÿç‰¹æ€§ä½“éªŒä¸€ä¸‹(å¦‚lottieã€getxå›½é™…åŒ–)ã€‚

è¿™ä¸ªé¡¹ç›®æ¯”è¾ƒç®€å•ï¼ŒæŠ€æœ¯ä¸Šæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¸»è¦è¯´ä¸‹åšæ–‡çš„å±•ç¤ºï¼š

### åšæ–‡å±•ç¤º

åšæ–‡ç”±äºæ˜¯HTMLå¯Œæ–‡æœ¬ä¸”æœ‰ä¸€äº›å¤æ‚æ ·å¼ï¼ŒæŠŠæ–‡ç« å†…å®¹è½¬ä¸ºFlutter Widgetæ˜¾ç¤ºçš„ä½“éªŒæŒºå·®ï¼Œæ‰€ä»¥è¿˜æ˜¯ä½¿ç”¨WebViewæ¥å±•ç¤ºã€‚

åœ¨è¿™é‡Œæˆ‘é€‰æ‹©äº†`flutter_inappwebview`åŒ…ï¼Œè¿™ä¸ªåŒ…ä¼šæ¯”å®˜æ–¹çš„`webview_flutter`åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œæ›´æ–°ä¹Ÿæ›´é¢‘ç¹ã€‚

HTMLåŠ è½½æµç¨‹å¦‚ä¸‹ï¼š

1.  åœ¨assetsä¸­æ·»åŠ HTMLï¼Œé¢„ç•™å†…å®¹ã€jsã€cssæ§½ä½
2.  åœ¨assetsä¸­æ·»åŠ ä¸¤ä¸ªcssæ ·å¼ï¼Œåˆ†åˆ«å¯¹åº”æµ…è‰²æ¨¡å¼åŠæ·±è‰²æ¨¡å¼ï¼›csså†…å®¹å¯ä»¥ä»ä»»æ„æ–‡ç« çš„Webé¡µé¢æŠ“å–
3.  åœ¨assetsä¸­æ·»åŠ JSï¼Œç¼–å†™WebViewä¸APPçš„äº¤äº’
4.  åœ¨assetsä¸­æ·»åŠ highlight.jsï¼Œå®ç°ä»£ç çš„é«˜äº®
5.  å°†jsã€csså¡«å……è‡³HTML,csséœ€è¦æ ¹æ®APPä¸»é¢˜é€‰æ‹©
6.  é€šè¿‡APIè¯»å–åšæ–‡å†…å®¹ï¼Œå¹¶å¡«å……åˆ°HTMLä¸­
7.  é€šè¿‡`webViewController.loadData(data: html)`åœ¨APPä¸­æ˜¾ç¤ºåšæ–‡

å…·ä½“å®ç°å¯ä»¥çœ‹æºä»£ç ã€‚å®ç°æ•ˆæœï¼š

![åšæ–‡.jpg](https://vip2.loli.io/2022/12/13/e3YWqNuIVMx1onT.jpg)

ç”±äºé¡¹ç›®ä¾èµ–WebView(æ–‡ç« ã€ç™»å½•)ï¼Œæ‰€ä»¥åªæ”¯æŒiOSã€Androidå¹³å°ã€‚è¦æ”¯æŒå…¶ä»–å¹³å°ä¹Ÿä¸éš¾ï¼Œåªéœ€è¦æŠŠæ–‡ç« å†…å®¹è½¬ä¸ºFlutter Widgetæ˜¾ç¤ºå†æ›´æ”¹ä¸‹ç™»å½•é€»è¾‘å³å¯ã€‚

è‡ªåŠ¨æ‰“åŒ…
----

ä½¿ç”¨Github Actionså¯ä»¥å¾ˆç®€å•çš„è‡ªåŠ¨å®Œæˆæ‰“åŒ…å‘å¸ƒçš„æ­¥éª¤ã€‚

å…³äºGithub Actionsçš„ä»‹ç»ï¼Œå¯ä»¥çœ‹ä¸‹[å®˜æ–¹æ–‡æ¡£](https://docs.github.com/cn/actions)ã€‚

åœ¨é¡¹ç›®åˆ›å»ºæ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª.github/workflowsï¼Œç„¶ååˆ›å»ºä¸€ä¸ªxxxx.ymlï¼Œå†™å…¥ä»¥ä¸‹ä»£ç ã€‚

    name: app-build-action
    #æ¨é€Tagæ—¶è§¦å‘
    on:
      push:
        tags:
          - "*"
    jobs:
      build-ios-android:
        # ä½¿ç”¨macOSé•œåƒ,å¦‚æœä¸éœ€è¦æ‰“åŒ…iOSï¼Œå¯ä»¥æ›¿æ¢æˆUbuntu
        runs-on: macos-latest
        permissions:
          contents: write
        steps:
          #ç­¾å‡ºä»£ç  
          - uses: actions/checkout@v2
            with:
              ref: master
           #å†™å‡ºENVæ–‡ä»¶
          - name: Create .env
            run: |
              echo "CLIENT_ID=${{ secrets.CLIENT_ID }}" > .env
              echo "CLIENT_SECRET=${{ secrets.CLIENT_SECRET }}" >> .env
          #APKç­¾åè®¾ç½®
          - name: Download Android keystore
            id: android_keystore
            uses: timheuer/base64-to-file@v1.2
            with:
              fileName: keystore.jks
              encodedString: ${{ secrets.KEYSTORE_BASE64 }}
          - name: Create key.properties
            run: |
              echo "storeFile=${{ steps.android_keystore.outputs.filePath }}" > android/key.properties
              echo "storePassword=${{ secrets.STORE_PASSWORD }}" >> android/key.properties
              echo "keyPassword=${{ secrets.KEY_PASSWORD }}" >> android/key.properties
              echo "keyAlias=${{ secrets.KEY_ALIAS }}" >> android/key.properties
          #è®¾ç½®JAVAç¯å¢ƒ
          - uses: actions/setup-java@v3
            with:
              distribution: 'zulu'
              java-version: "12.x"
              cache: 'gradle'
          #è®¾ç½®Flutter
          - name: Flutter action
            uses: subosito/flutter-action@v2
            with:
              flutter-version: '3.3.9'
              cache: true 
          - name: Restore packages
            run: flutter pub get
          #æ‰“åŒ…APK
          - name: Build APK
            run: flutter build apk --release
          #ä¸Šä¼ APKè‡³Artifacts
          - name: Upload APK to Artifacts
            uses: actions/upload-artifact@v3
            with:
              name: app-release.apk
              path: |
                build/app/outputs/flutter-apk/app-release.apk
          #æ‰“åŒ…iOS
          - name: Build IPA
            run: flutter build ios --release --no-codesign
          #åˆ›å»ºæœªç­¾åipa
          - name: Create IPA
            run: |
              mkdir build/ios/iphoneos/Payload
              cp -R build/ios/iphoneos/Runner.app build/ios/iphoneos/Payload/Runner.app
              zip -q -r build/ios/iphoneos/ios_no_sign.ipa build/ios/iphoneos/Payload
          #ä¸Šä¼ IPAè‡³Artifacts
          - name: Upload IPA to Artifacts
            uses: actions/upload-artifact@v3
            with:
              name: ios_no_sign.ipa
              path: |
                build/ios/iphoneos/ios_no_sign.ipa
          #ä»document/new_version.jsonè¯»å–ç‰ˆæœ¬ä¿¡æ¯
          - name: Read version
            id: version
            uses: juliangruber/read-file-action@v1
            with:
              path: document/new_version.json
          - name: Echo version
            run: echo "${{ fromJson(steps.version.outputs.content).version }}"
          - name: Echo version content
            run: echo "${{ fromJson(steps.version.outputs.content).version_desc }}"
          #å‘å¸ƒè‡³Github Release
          - name: Upload Release
            uses: ncipollo/release-action@v1
            with:
              allowUpdates: true
              artifactErrorsFailBuild: true
              artifacts: "build/app/outputs/flutter-apk/app-release.apk,build/ios/iphoneos/ios_no_sign.ipa"
              name: "${{ fromJson(steps.version.outputs.content).version }}"
              body: "${{ fromJson(steps.version.outputs.content).version_desc }}"
              token: ${{ secrets.TOKEN }}
          #å®Œæˆ
          - run: echo "ğŸ This job's status is ${{ job.status }}."
    

è¿è¡Œè„šæœ¬å‰ï¼Œéœ€è¦å…ˆåˆ°Githubé¡¹ç›®è®¾ç½®-Secrets-Actionsä¸­æ·»åŠ ä»¥ä¸‹å­—æ®µ

`CLIENT_ID` åšå®¢å›­API ClientId  
`CLIENT_SECRET` åšå®¢å›­API ClientSecret  
`KEYSTORE_BASE64` APKç­¾åæ–‡ä»¶ï¼Œè½¬ä¸ºBASE64  
`KEY_ALIAS` APKç­¾åkeyAlias  
`KEY_PASSWORD` APKç­¾åkeyPassword  
`STORE_PASSWORD` APKç­¾åstorePassword  
`TOKEN` Github Token

Github Token[ç‚¹è¿™é‡Œ](https://github.com/settings/tokens)æ·»åŠ ï¼Œæ³¨æ„éœ€è¦æƒé™çš„è®¾ç½®ã€‚

![secrets.png](https://vip2.loli.io/2022/12/13/fg2zGxc4IqjVX7W.png)

è®¾ç½®å®Œæˆåï¼Œå½“æƒ³è¦æ‰“åŒ…ä¸€ä¸ªæ–°ç‰ˆæœ¬æ—¶ï¼Œåªéœ€è¦æäº¤ä»£ç å¹¶æ‰“ä¸ŠTagæ¨é€è‡³Githubï¼Œå³å¯è‡ªåŠ¨æ‰“åŒ…ã€‚

æ€»ç»“
--

è¿™ä¸ªé¡¹ç›®æ²¡å•¥éš¾åº¦ä¸”åšå®¢å›­APIæ–‡æ¡£è¿˜æ˜¯æ¯”è¾ƒå…¨é¢ï¼ŒåŸºæœ¬å¯¹ç€APIåšä¸ªUIå°±è¡Œäº†ã€‚

å¤©å†·å˜æ‡’äº†ï¼Œæœ‰äº›åŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œï¼Œè¿‡æ®µæ—¶é—´å†æ…¢æ…¢å®Œå–„äº†ã€‚

é¡¹ç›®å¼€æºåœ°å€:[https://github.com/xiaoyaocz/flutter\_cnblogs](https://github.com/xiaoyaocz/flutter_cnblogs),æœ‰å…´è¶£å¯ä»¥åˆ°Releaseä¸­ä¸‹è½½å®‰è£…åŒ…ä½“éªŒä¸€ä¸‹ã€‚