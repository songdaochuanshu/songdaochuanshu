---
layout: post
title: "vue大型电商项目尚品汇（后台篇）day04"
date: "2022-06-19T03:40:42.148Z"
---
vue大型电商项目尚品汇（后台篇）day04
======================

昨天太晚就没来得及更新，今天是spu管理界面，这个界面一共有三个界面需要切换，完成了两个界面，而且今天的难度在于最后两个章节，富有一定的逻辑性，当然中间也有很多需要注意的，比如ElementUI的照片墙需要添加list属性而且值为你的数据并且必须是一个数组必须有name、url属性

一.spu管理
=======

1.按钮与三级联动可操作性
-------------

当进入属性的添加这个界面我们的三级联动应该不可点击

![image-20220618094325001](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093156074-293314190.png)

![image-20220618094337002](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093156459-678660099.png)

以及我们没有添加属性值不应该能够点击保存

![image-20220618094505826](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093156717-482154266.png)

2.spu介绍
-------

![image-20220618094607197](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093157074-1372167577.png)

spu和sku就是类与实例的关系

![image-20220618094708823](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093157404-191551938.png)

添加

![image-20220618094840632](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093157697-987839704.png)

修改

![image-20220618094917898](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093158061-1427434005.png)

等等

3.静态
----

两个card构成，上面还是我们的三级联动

![image-20220618102850143](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093158368-92213276.png)

下面这个card先是一个button然后一个table，然后一组button，出现了多次button，后期会封装一个el-button，利用$attrs这个api

![image-20220618103403289](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093158629-522612334.png)

然后分页器

![image-20220618103601387](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093158906-1112348190.png)

![image-20220618103606895](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093159155-1253033572.png)

4.动态展示spu列表
-----------

应该在获取到3id这里来发

![image-20220618114335010](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093159398-35241062.png)

渲染数据

![image-20220618114604145](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093159653-953514492.png)

然后是我们的button这里，封装一个hintbutton，让其有悬浮提示效果

![image-20220618114635750](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093159921-2113649354.png)

来一个全局组件，title显示提示内容，利用两个api $attrs直接绑定在组件上可以让其有传过来的所有属性，后面是直接有父组件传过来的事件绑定（包括触发方式和回调）

![image-20220618114952980](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093200199-1493427455.png)

![image-20220618115357448](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093200484-797551391.png)

然后把分页器也做了，注意current-change这个事件可以直接写在获取列表这个回调里面，投机取巧

![image-20220618115850004](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093200743-760661905.png)

![image-20220618115856063](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093200987-1717578216.png)

5.spu管理内容切换
-----------

在我们spu管理内容界面一共有三个界面需要切换，一个是现在的列表展示，一个是spu的管理，一个是sku的管理，如果只有两个用true和false来切换即可，但是这里有三个页面所以需要一个动态数据，而切换的依据就是看数字是否匹配

![image-20220618110311121](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093201242-1830586682.png)

后面两个组件由于内容比较多，我就单独写为两个组件引入进来

![image-20220618111237444](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093201492-1410887333.png)

6.spuform静态
-----------

首先应该点击添加和修改进入spuform界面

![image-20220618155606066](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093201761-750832684.png)

注意这里是组件标签，但是为什么直接写上系统事件可以实现，因为我们封装了，组件那边用一个$listeners直接获取了这个事件的触发方式和回调，用一个v-on绑定

![image-20220618155743091](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093202052-421954242.png)

![image-20220618155800468](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093202308-121326620.png)

主要就是记住el-form里面每一项表单要配合el-form-item就行了

![image-20220618161015500](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093202574-1831054714.png)

![image-20220618160941627](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093202906-565654980.png)

7.spuform业务分析
-------------

点击取消回到0页面，用到自定义事件

![image-20220618165802999](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093203228-138712420.png)

![image-20220618165808058](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093203452-1097061921.png)

![image-20220618165814368](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093203689-831736588.png)

![image-20220618165818489](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093203912-2130713828.png)

然后就是每次点击编辑进入spuform这个页面都会发送四个请求，主要是每次点进来都要发送，而且也不能写在mounted里面，因为并没有销毁路由，按理说可以给编辑按钮来一个点击事件，但是需要这些请求回来的数据是在子组件，而编辑按钮是在父组件。

这里不能用自定义事件，因为要数据的是在子组件并不是要把数据发到父组件，可以现在父组件点击发起请求然后props给到子组件，但是过于麻烦了，这里可以用过ref拿到子组件的实例对象，然后在子组件methods定义一个发起请求的函数，当父组件一点击编辑的按钮，就用这个实例对象里面的这个方法就调用到了子组件的请求函数了

![image-20220618170507673](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093204153-990386732.png)

![image-20220618171805090](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093204407-299845621.png)

![image-20220618171813423](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093204676-1726876025.png)

8.获取spuform数据
-------------

先整理接口

![image-20220618173705435](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093204909-1952682190.png)

接下来四个接口全部请求，然后给到我们对应的响应式数据

![image-20220618174514808](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093205175-2075597138.png)

9.spuform数据展示
-------------

*   首先spu名称通过v-model进行收集

![image-20220618181526278](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093205458-774443158.png)

这样一弄确实可以进行双向收集

![image-20220618181603639](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093205705-332394283.png)

但是要考虑到一点，我们是因为点击的修改所以进来会发请求，spudata里面才会有这些属性，那如果我点击新增spu，没发请求，我也要手机，到时候点击保存要发起保存请求，这个时候怎么办

观察接口可以发现需要这么一堆数据，给到请求

![image-20220618181839506](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093205976-124011460.png)

直接将其放到spudata里面，这时候就算是没发请求我也可以收集到数据

*   品牌部分

直接遍历，然后收集tmid

![image-20220618182431649](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093206208-1309920568.png)

*   spu描述
    
    ![image-20220618182548317](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093206457-82046517.png)
    
*   spu图片
    
    因为我们这里要照片墙类型展示，所以要添加一个很重要的属性 **file-list而且值应该为你这个存放图片的数组**，而且查看官网文档可知，添加了这个属性后，你的照片这里的数据必须为一个数组，每一个照片数据为一个对象必须有name和url两个属性
    
    ![image-20220618184533492](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093206694-2046917347.png)
    
    那么我这里就可以这么做，照片墙两个事件，一个是上传了文件后的回调，一个是删除了文件后的回调，这只是题外话，我在发起获得这些照片的接口那里就可以对这个list做一些操作
    
    ![image-20220618184548191](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093206953-1494785781.png)
    
*   销售属性
    
    首先我们表格里面展示的是spu自身已经选择的销售属性
    
    ![image-20220618215837525](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093207191-245162930.png)
    
    然后属性值名称用到动态编辑标签
    
    ![image-20220618220711396](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093207482-1552665959.png)
    
    然后是我们button和input的切换，当初做并不是直接在data来一个赋值让其点击一下切换，你要考虑到这里不光是一行数据，如果都用这个来控制切换到时候就会出现你切换大家一起切换，所以要在各自的对象里面加上这个属性
    
    ![image-20220618221327029](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093207766-2082741538.png)
    
    上面只是先占位，真正添加进对象后面再做，先把表格最后一个删除按钮做了
    
    ![image-20220618221501688](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093208021-1179865197.png)
    
    下面最重要的一个功能，全平台一共有三个销售属性，你自己可能已经选择了一些，那么我就要把剩下没有选择的筛选出来，这里用一个计算属性来做
    

这里面的逻辑有点绕注意，用系统总共的数组去筛选，再遍历你已有的数据，用every也就是全部满足才返回true，我就去比较老数据看是不是不等于你已经有的数据，全部满足就返回

![image-20220618223135864](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093208283-1459098097.png)

然后就可以用我们筛选好的数据去渲染到表单

![image-20220618223442161](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093208537-560599758.png)

![image-20220618223505138](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093208802-1228451651.png)

10.spu照片墙
---------

我们前面完成了照片墙的显示，但是并没有完成他的收集功能

可以看到我们照片墙上面有两个事件，on-preview表示图片预览的时候触发的事件，在这里不需要收集，on-remove表示的是图片删除的时候触发的事件，这里需要收集数据

![image-20220618224929722](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093209042-1228609444.png)

他有两个参数，file表示你删除的那个文件，fileList表示的是剩余的文件

![image-20220618225119747](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093209308-233165061.png)

下一个问题，那么我们上传图片怎么来收集，可以用upload组件的on-success事件，表示的是文件上传成功触发的回调

![image-20220618225232696](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093209580-265687750.png)

他的三个参数分别是，上传成功返回的一些信息，上传成功那张图的一些信息，上传成功后所有的图片信息

![image-20220618225335018](https://img2022.cnblogs.com/blog/2680817/202206/2680817-20220619093209840-283689581.png)