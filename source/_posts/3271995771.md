---
layout: post
title: "蓝牙模块测试那些事之从机测试"
date: "2023-01-14T15:15:00.762Z"
---
蓝牙模块测试那些事之从机测试
==============

![蓝牙模块测试那些事之从机测试](https://img2023.cnblogs.com/blog/2999540/202301/2999540-20230113225609799-2118079001.png) 本文主要目的是在拿到一个蓝牙模块后，将其作为从机来对一些基本的软件功能进行测试，用以快速验证是否满足基本的使用需求和功能指标。

​　　**摘要：**本文主要目的是在拿到一个蓝牙模块后，将其作为从机来对一些基本的软件功能进行测试，用以快速验证是否满足基本的使用需求和功能指标。针对测试的方法和测试的项目进行总结，作为对蓝牙模块从设备模式下的功能的一个初步评估。

**一、测试目的**
==========

        1、快速验证蓝牙模块从机模式下的基本功能。

        2、初步评估蓝牙模块从机模式下通信参数指标是否满足软件功能需求。

        3、掌握蓝牙调试助手的使用方法。

        4、熟悉蓝牙模块从机相关测试方法。

        5、熟悉蓝牙模块相关设置命令和含义。

* * *

**二、测试工具**
==========

![](https://img-blog.csdnimg.cn/img_convert/a2672f69af24c6eec2c9c0189f3078d5.png)​

**硬件：**

        1、蓝牙模块一个，后续需要根据蓝牙模块是单模还是双模进行针对性的协议测试。

        2、USB转串口线，用于连接蓝牙模块和PC端通信，设置命令和数据收发，当然蓝牙模块还有别的类型的接口，这里仅对串口蓝牙模块进行测试。

        3、手机一个或多个，用于连接上蓝牙模块后收发数据，可以使用多个品牌的手机，进行不同手机系统兼容性测试。

**软件：**

       1、PC端串口调试工具软件，用于收发从蓝牙模块串口的数据，如sscom，xcom，Secure CRT等。

        2、手机端蓝牙调试助手，用于和蓝牙模块连接后，通过手机蓝牙收发蓝牙模块的空中数据。根据用的蓝牙模块是单模还是双模选择，如BLE调试助手，SPP调试助手，调试全能王等。

**关于蓝牙调试助手：**

        1、针对不同协议进行测试时使用的蓝牙助手工具也不同，分别使用SPP蓝牙助手和BLE蓝牙助手。

![](https://img-blog.csdnimg.cn/img_convert/cb3124277738491b1fb6127094cd0a16.jpeg)​

        2、打开蓝牙调试助手，搜索蓝牙设备，找到需要测试的蓝牙模块进行连接。

![](https://img-blog.csdnimg.cn/img_convert/475a3cc6d4e6b144ce2b4fba71bdd991.png)​

        3、蓝牙服务相关

        连上之后，就会看到几个蓝牙服务，实时日志里也会看到连接状态的提示；使用蓝牙对外提供服务的设备，需要有对应的服务功能。蓝牙服务分为服务、特性、属性三个部分：

（1）、服务（Service）

        每一个具体的蓝牙应用是由多个服务（Service）组成的，而每一个服务（Service）又是由多个特性（Characteristic）组成的。服务（Service） 可以理解为一个房间，当这个房间为空的时候他什么也不是，不能提供任何的服务功能，所以，房间里面至少需要有一个或多个家俱，不同的家俱有不同的功能，这就是特性（Characteristic）。不同的服务（Service）应该有不同的编号(UUID)，用以区分不同的服务(Service)。

        比如蓝牙连上之后，可以看到这几个蓝牙服务，Generic Access、Generic Attribute、Device Information以及Unknown Service。

![](https://img-blog.csdnimg.cn/img_convert/cd04bba505c00bad154852fac3f16490.jpeg)​

（2）、特性（Characteristic）

        特性（Characteristic） 是依附于某个服务（Service）的，就像前面说到房间里每样家俱可以提供与之相关的不同功能。同样，我们需要给每样家俱分配一个编号，这就是特性（Characteristic）的UUID。我们知道，每种家俱会有一个或多个不同的子功能，这个子功能就是特性（Characteristic）所包含的属性（Property） 。例如床单可以更换、床的高低可以调整。

        比如服务Generic Access的含义是“通用访问”，下面有特性：

        DeviceName，设备名。

        Appearance，说明自己是个什么设备（比如蓝牙鼠标）。

        Peripheral Preferred Connection Parameters，外设首选连接参数。

        服务Generic Attribute的含义是“通用属性”，下面有特性：

        ServiceChanged，服务改变。

![](https://img-blog.csdnimg.cn/img_convert/fab7a18de17fa10f2eae4e3386f1b2ef.jpeg)​

（3）、属性（Property）

        通常的数据交互的属性有如下几个：

        Read：读属性，具有这个属性的特性是可读的，也就是说这个属性允许手机来读取一些信息。手机可以发送指令来读取某个具有读属性UUID的信息。

        Notify：通知属性， 具有这个属性的特性是可以发送通知的，也就是说具有这个属性的特性（Characteristic），蓝牙模块可以主动发送信息给手机。Notify是一直读取，Read是想读取的时候读取。

        Write：写属性， 具有这个属性的特性是可以接收写入数据的。通常手机发送数据给蓝牙模块就是通过这个属性完成的。这个属性在Write 完成后，会发送写入完成结果的反馈给手机，然后手机再可以写入下一包或处理后续业务，这个属性在写入一包数据后，需要等待应用层返回写入结果，速度比较慢。

        WriteWithout Response：写属性，从字面意思上看，只是写，不需要返回写的结果，这个属性的特点是不需要应用层返回，完全依靠协议层完成，速度快，但是写入速度超过协议处理速度的时候，会丢包。

        Indication：在手机收到蓝牙模块数据后会主动回一个应答，有确认机制，蓝牙模块收到应答后才继续发送下一个数据，保证数据正确到达，也起到了流控的作用。Notify无确认机制，不会保证数据发送是否到达。

![](https://img-blog.csdnimg.cn/img_convert/47a73acb5c559e8dd7f852a045da04ab.jpeg)​

（4）、UUID

        通用唯一标识符。是蓝牙组织联盟定义的用于区分蓝牙服务和特性的的标识符，总长度为128 Bit。UUID 用于标识蓝牙服务以及通讯特征访问属性，不同的蓝牙服务和属性使用不同的访问方法，就像人们语言交流一样，语言相同才能正常交流（找到正确的UUID，才能使用正确的功能）。

        简单理解UUID就是编号，对应不同服务的一个唯一的编号，用于区分不同的服务及服务特性的个体。服务和特性都有各自的UUID。他很像网络应用中的端口号，例如80是HTTP协议的端口，他提供的是HTTP服务。

        为了明确标准的蓝牙服务，蓝牙技术联盟SIG定义UUID共用了一个基本的UUID。总共128Bit，据蓝牙官网Assigned Numbers | Bluetooth® Technology Website里的文档Service Discovery，可以看到基本的UUID为：

![](https://img-blog.csdnimg.cn/img_convert/5a29270e099ba65dc394a178575a2ae3.png)​

        128Bit的UUID占用16个字节，在变成个传输的时候都很不方便，所以蓝牙联盟定义了一个UUID的基地址，允许在此基础上使用16Bit的UUID，进一步简化基本UUID:

        **0x0000xxxx-0000-1000-8000-00805F9B34FB**

        每一个蓝牙技术联盟定义的属性有一个唯一的16BitUUID，以代替上面的基本UUID的‘x’部分。使用16Bit的UUID便于记忆和操作，如SIG定义了“Device Information”的16BitUUID为0x180A。

        也就是说，不管是什么样的蓝牙设备，只要你提供设备信息（Device Information） 的服务功能，就必须使用”0x180A“的UUID号。这样，当应用程序需要读取这蓝牙设备的设备信息时，只需要找到对应UUID号为0x180A的服务，就可以获取到。

        技术联盟已定义好较多的标准服务UUID。根据蓝牙官网的16bit UUID文档，可以看到：

![](https://img-blog.csdnimg.cn/img_convert/d7576206b8e596d866613ce36640ec1e.png)​

        同时，也允许厂商定义自己的UUID，以满足已定义服务外的功能实现。很多厂家的蓝牙串口模块（及某些服务）并没真正使用规定的标准UUID编号，而使用自己定义的UUID。

* * *

**三、测试项目**
==========

**1、协议功能**
----------

        蓝牙模块按照对蓝牙协议栈支持的数量可以分为单模模块（经典蓝牙或低功耗蓝牙）和双模模块（经典蓝牙和低功耗蓝牙），如经典蓝牙的数据传输基于SPP协议，低功耗蓝牙的数据传输基于BLE协议。同样针对不同协议进行测试时使用的蓝牙助手工具也不同，分别使用SPP蓝牙助手和BLE蓝牙助手，后续的测试项目中针对蓝牙模块支持的协议的不同，要使用对应的蓝牙助手进行连接以应对不同协议的测试。

![](https://img-blog.csdnimg.cn/img_convert/fdb8dd6cef8c81261e97447a1d36fa02.png)​

**2、波特率支持**
-----------

        主要是选用蓝牙模块规格书中支持的蓝牙串口波特率来进行和手机通信测试，一般蓝牙模块都有对应的命令对蓝牙模块的波特率进行修改。根据项目的蓝牙模块串口通信要求，为蓝牙模块设置对应的波特率，从而满足单位时间内数据带宽的要求，这里的波特率指的是蓝牙模块上硬件串口的数据吞吐量，实际要看透传理论最大空中速度（如一定距离内，数据从模块发送至手机的空中速度为10KB/s），只要串口的输入速度小于等于数据在空中的发送速度，模块就没有字节限制。实际速度会根据软硬件差异、环境、距离等的不同而有所差异。

        为蓝牙模块设置好固定的波特率后，需要在PC端串口调试工具上设置好对应的波特率进行数据收发。

![](https://img-blog.csdnimg.cn/img_convert/14b75ac8b0e20eec1478413c45f773c8.png)​

**3、发送间隔**
----------

        在对应的蓝牙协议模式下，分别在手机蓝牙助手上设置数据自动发送的间隔和PC端串口工具的自动发送间隔，设置好后，可以测试手机给蓝牙模块发送或者蓝牙模块给手机发送，以及手机和蓝牙模块同时互相发送这种全双工通信的情况，主要是为了模拟在软件程序开发中实际通信时的每包数据的发送间隔，验证在设置的数据包时间间隔下的通信效率。当然，测试时需要设置好相互发送的每包数据长度。

        分别在PC端串口调试工具和蓝牙调试助手上设置好每包数据循环发送的时间间隔，观察互发互收的情况。

![](https://img-blog.csdnimg.cn/img_convert/95aa286aaf3b31fcdced8fac0ff3b77b.png)​

![](https://img-blog.csdnimg.cn/img_convert/15b0336d6282d36d2e43eec189098cb9.png)​

**4、丢包率**
---------

        指测试中所丢失数据包数量占所发送数据的比率。手机蓝牙助手和PC端的串口工具都可以检测到数据包发送的数量和接收的数量，因此可以为蓝牙模块设定好固定的波特率，以及分别在蓝牙助手和PC端串口工具上设置需要发送的数据包长度，在一定通信距离和时间内测试手机给蓝牙模块发送或者蓝牙模块给手机发送，以及手机和蓝牙模块同时互相发送这种全双工通信的情况，观察双方收发数据包的个数是否有丢失。

        可以分别在PC端串口调试工具和蓝牙调试助手上观察相互收发的数据字节长度，来确认是否有数据丢包的情况。

![](https://img-blog.csdnimg.cn/img_convert/3396b2cf08cd589e465c5d088c6cbb96.png)​

![](https://img-blog.csdnimg.cn/img_convert/7bcded691a3b1653d7c96912a31ebdf4.png)​

**5、通信距离**
----------

        测量通信距离是使用用手机离蓝牙模块一段距离后通信的数据是否正常，当然，这个和具体蓝牙模块设计的射频发射功率，接收灵敏度，收发环境，空中速率，无线电压以及天线的类型和位置有关系，同样可以选定不同的场景测试，如直线或非直线距离，是否穿墙及穿墙的层数等。一般可以先通过命令修改好蓝牙模块的射频功率，同时配置好数据发送间隔和包长等参数后，进行一个初步模拟实际使用时的通信距离测试。

        可以在蓝牙调试助手上看到扫描到的模块信号的强度，dbm 中文是分贝毫瓦，是一个表示无线功率的绝对值。它的数值是以1mw功率为基准的一个比值。计算公式如下：dbm=10log（p/1mw）

        为什么常见的信号强度都是负数的值呢？因为1mw = 0 dbm， 而随着信号在空间内传播，又受到障碍物的干扰，能量会衰减，所以常见的接收端显示的信号强度都为负值，表示比1mw弱。由此也可以得知，信号强度这个值越大，表示信号越好。比如-30dbm比-90dbm好。

        尝试分别在近距离和远距离测试蓝牙模块，可以在蓝牙调试助手上观察到信号强度的变化。

![](https://img-blog.csdnimg.cn/img_convert/e9e06742c6e0eeecef33e38c77fbe2ac.png)​

![](https://img-blog.csdnimg.cn/img_convert/bec5121f895a9731a6a4d6a2c56e9f9a.png)​

**6、通信回连测试**
------------

        如果一个蓝牙设备已经与蓝牙中心设备连接上，那么当该蓝牙设备的断电重启，其依然会和配对过的中心主设备连接上，而不需要重新走配对的流程，这个过程叫做回连。

        当设备重启之后，蓝牙协议栈以及所有的上层的profile都要重新进行初始化，之前的配对信息是保存在文件bt\_config.conf中，蓝牙起来之后，会去加载这个文件，去解析曾经配对过的设备，对于已经配对过的设备，并且配对信息保持完整，那么就会对该设备发起回连。手机连接蓝牙模块后，蓝牙模块断电再上电，在蓝牙调试助手上观察蓝牙模块回连状态。

![](https://img-blog.csdnimg.cn/img_convert/8128f54b8d8e50473979af34643f4e70.png)​

**7、通信稳定性**
-----------

        需要说明的是这里的通信稳定性仅仅是在正常的环境下，对蓝牙模块进行一个基本综合测试。主要是进行一个长时间的手机和蓝牙模块通信数据收发测试，选定好波特率、包长、通信包发送时间间隔、通信距离等参数后，进行例如1h或更长时间的数据收发测试后，检查是否有丢包，误码，断连等异常情况发生。

**8、兼容性测试**
-----------

        安卓手机版本众多，各大安卓品牌都深度定制，略有差异。所以为了达到好的效果，需要使用不同品牌和型号的手机来测试蓝牙模块的数据传输，这也是有必要的。

* * *

**四、总结**
========

        最后用一张思维导图作为蓝牙模块从机的测试总结。

![](https://img-blog.csdnimg.cn/img_convert/d2c73dc103acc032710adf991158cd9c.png)

* * *

 **更多技术内容和书籍资料获取敬请关注微信公众号“明解嵌入式”**

![](https://img2022.cnblogs.com/blog/2999540/202210/2999540-20221022000235287-740833429.png)

​

本文来自博客园，作者：[Sharemaker](https://www.cnblogs.com/Sharemaker/)，转载请注明原文链接：[https://www.cnblogs.com/Sharemaker/p/17050946.html](https://www.cnblogs.com/Sharemaker/p/17050946.html)