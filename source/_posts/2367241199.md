---
layout: post
title: "ä¸ºä»€ä¹ˆè¯´ Gradle æ˜¯ Android è¿›é˜¶ç»•ä¸å»çš„å â€”â€” Gradle ç³»åˆ—(1)"
date: "2022-05-16T07:20:54.080Z"
---
ä¸ºä»€ä¹ˆè¯´ Gradle æ˜¯ Android è¿›é˜¶ç»•ä¸å»çš„å â€”â€” Gradle ç³»åˆ—(1)
=============================================

Gradle ä½œä¸ºå®˜æ–¹ä¸»æ¨çš„æ„å»ºç³»ç»Ÿï¼Œç›®å‰å·²ç»æ·±åº¦åº”ç”¨äº Android çš„å¤šä¸ªæŠ€æœ¯ä½“ç³»ä¸­ï¼Œä¾‹å¦‚ç»„ä»¶åŒ–å¼€å‘ã€äº§ç‰©æ„å»ºã€å•å…ƒæµ‹è¯•ç­‰ã€‚å¯è§ï¼Œè¦æˆä¸º Android é«˜çº§å·¥ç¨‹å¸ˆ Gradle æ˜¯å¿…é¡»æŒæ¡çš„çŸ¥è¯†ç‚¹ã€‚åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘å°†å¸¦ä½ ç”±æµ…å…¥æ·±å»ºç«‹ Gradle çš„åŸºæœ¬æ¦‚å¿µï¼Œæ¶‰åŠ Gradle ç”Ÿå‘½å‘¨æœŸã€Projectã€Task ç­‰çŸ¥è¯†ç‚¹ï¼Œè¿™äº›å†…å®¹ä¹Ÿæ˜¯ Gradle åœ¨é¢è¯•å…«è‚¡æ–‡ä¸­å®¹æ˜“é‡è§çš„é—®é¢˜ã€‚

> **è¯·ç‚¹èµï¼Œä½ çš„ç‚¹èµå¯¹æˆ‘æ„ä¹‰é‡å¤§ï¼Œæ»¡è¶³ä¸‹æˆ‘çš„è™šè£å¿ƒã€‚**
> 
> ğŸ”¥ **Hiï¼Œæˆ‘æ˜¯å°å½­ã€‚æœ¬æ–‡å·²æ”¶å½•åˆ° [GitHub Â· Android-NoteBook](https://github.com/pengxurui/Android-NoteBook) ä¸­ã€‚è¿™é‡Œæœ‰ Android è¿›é˜¶æˆé•¿çŸ¥è¯†ä½“ç³»ï¼Œæœ‰å¿—åŒé“åˆçš„æœ‹å‹ï¼Œæ¬¢è¿è·Ÿç€æˆ‘ä¸€èµ·æˆé•¿ã€‚ï¼ˆè”ç³»æ–¹å¼åœ¨ GitHubï¼‰**

å‰è¨€
--

Gradle ä½œä¸ºå®˜æ–¹ä¸»æ¨çš„æ„å»ºç³»ç»Ÿï¼Œç›®å‰å·²ç»æ·±åº¦åº”ç”¨äº Android çš„å¤šä¸ªæŠ€æœ¯ä½“ç³»ä¸­ï¼Œä¾‹å¦‚ç»„ä»¶åŒ–å¼€å‘ã€äº§ç‰©æ„å»ºã€å•å…ƒæµ‹è¯•ç­‰ã€‚å¯è§ï¼Œè¦æˆä¸º Android é«˜çº§å·¥ç¨‹å¸ˆ Gradle æ˜¯å¿…é¡»æŒæ¡çš„çŸ¥è¯†ç‚¹ã€‚åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘å°†å¸¦ä½ ç”±æµ…å…¥æ·±å»ºç«‹ Gradle çš„åŸºæœ¬æ¦‚å¿µï¼Œæ¶‰åŠ Gradle ç”Ÿå‘½å‘¨æœŸã€Projectã€Task ç­‰çŸ¥è¯†ç‚¹ï¼Œè¿™äº›å†…å®¹ä¹Ÿæ˜¯ Gradle åœ¨é¢è¯•å…«è‚¡æ–‡ä¸­å®¹æ˜“é‡è§çš„é—®é¢˜ã€‚

ä»è¿™ç¯‡æ–‡ç« å¼€å§‹ï¼Œæˆ‘å°†å¸¦ä½ å…¨é¢æŒæ¡ Gradle æ„å»ºç³»ç»Ÿï¼Œç³»åˆ—æ–‡ç« ï¼š

*   [1ã€Gradle åŸºç¡€](https://juejin.cn/post/7092367604211253256)
*   2ã€Gradle æ’ä»¶
*   3ã€Gradle ä¾èµ–ç®¡ç†
*   4ã€APG Transform

* * *

1\. è®¤è¯† Gradle
-------------

Gradle å¹¶ä¸ä»…ä»…æ˜¯ä¸€ä¸ªè¯­è¨€ï¼Œè€Œæ˜¯ä¸€å¥—æ„å»ºå·¥å…·ã€‚åœ¨æ—©æœŸï¼Œè½¯ä»¶æ„å»ºåªæœ‰ç¼–è¯‘å’Œæ‰“åŒ…ç­‰ç®€å•éœ€æ±‚ï¼Œä½†è½¯ä»¶å¼€å‘çš„å‘å±•ï¼Œç°åœ¨çš„æ„å»ºå˜å¾—æ›´åŠ å¤æ‚ã€‚è€Œæ„å»ºå·¥å…·å°±æ˜¯åœ¨è¿™ä¸€èƒŒæ™¯ä¸‹è¡ç”Ÿå‡ºæ¥çš„å·¥å…·é“¾ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…å¯é‡å¤ã€è‡ªåŠ¨åŒ–åœ°ç”Ÿæˆç›®æ ‡äº§ç‰©ã€‚ä¾‹å¦‚ Antã€Maven å’Œ ivy ä¹Ÿæ˜¯å†å²æ¼”åŒ–è¿‡ç¨‹ä¸­è¯ç”Ÿçš„æ„å»ºå·¥å…·ã€‚

### 1.1 Gradle çš„ä¼˜ç¼ºç‚¹

ç›¸æ¯”äºæ—©æœŸå‡ºç°çš„æ„å»ºå·¥å…·ï¼ŒGradle èƒ½å¤Ÿè„±é¢–è€Œå‡ºä¸»è¦æ˜¯ä»¥ä¸‹ä¼˜ç‚¹ï¼š

*   **è¡¨è¾¾æ€§çš„ DSLï¼š** Gradle æ„å»ºè„šæœ¬é‡‡ç”¨åŸºäº Groovy çš„ DSL é¢†åŸŸç‰¹å®šè¯­è¨€ï¼Œè€Œä¸æ˜¯é‡‡ç”¨ä¼ ç»Ÿçš„ XML æ–‡ä»¶ï¼Œç›¸æ¯” Maven ç­‰æ„å»ºç³»ç»Ÿæ›´åŠ ç®€æ´ï¼›
*   **åŸºäº Java è™šæ‹Ÿæœºï¼š** Groovy è¯­è¨€åŸºäº Java è™šæ‹Ÿæœºï¼Œè¿™ä½¿å¾— Gradle æ”¯æŒç”¨ Java / Kotlin ä»£ç ç¼–å†™æ„å»ºè„šæœ¬ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åªå­¦ä¹ ä¸€å°éƒ¨åˆ† Groovy è¯­æ³•å°±èƒ½ä¸Šæ‰‹ Gradle è„šæœ¬ï¼Œé™ä½äº† Gradle çš„å­¦ä¹ å¼ºåº¦ï¼›
*   **çº¦å®šä¼˜å…ˆäºé…ç½®ï¼š** Gradle å…·æœ‰çº¦å®šä¼˜å…ˆäºé…ç½®çš„åŸåˆ™ï¼Œå³ä¸ºå±æ€§æä¾›é»˜è®¤å€¼ï¼Œç›¸æ¯” Ant ç­‰æ„å»ºç³»ç»Ÿæ›´å®¹æ˜“ä¸Šæ‰‹ã€‚æˆ‘ä»¬åœ¨å¼€å‘ Gradle æ’ä»¶æ—¶ä¹Ÿéœ€è¦éµå¾ªè¿™ä¸€åŸåˆ™ã€‚

Gradle ä¹Ÿæœ‰æ˜æ˜¾çš„ç¼ºç‚¹ï¼Œä¾‹å¦‚ï¼š

*   **è¾ƒå¼±çš„å‘åå…¼å®¹æ€§ï¼š** Gradle æ˜¯ä¸€ä¸ªå¿«é€Ÿå‘å±•çš„å·¥å…·ï¼Œæ–°ç‰ˆæœ¬ç»å¸¸ä¼šæ‰“ç ´å‘åå…¼å®¹æ€§ï¼Œæœ‰ç»éªŒçš„åŒå­¦å°±çŸ¥é“ï¼Œä¸€ä¸ªå·¥ç¨‹åœ¨ä½ç‰ˆæœ¬ Gradle å¯ä»¥ç¼–è¯‘ï¼Œä½†æ¢äº†æ–°ç‰ˆæœ¬ Gradle å¯èƒ½å°±ç¼–è¯‘ä¸é€šè¿‡äº†ã€‚

### 1.2 Gradle å·¥ç¨‹çš„åŸºæœ¬ç»“æ„

åœ¨ Android Studio ä¸­åˆ›å»ºæ–°é¡¹ç›®æ—¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹ä¸ Gradle ç›¸å…³æ–‡ä»¶ã€‚è¿™äº›å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œç®€å•æ¢³ç†ä¸‹å„ä¸ªæ–‡ä»¶çš„ä½œç”¨ï¼š

    .
    â”œâ”€â”€ a-subproject
    â”‚   â””â”€â”€ build.gradle
    â”œâ”€â”€ build.gradle
    â”œâ”€â”€ settings.gradle
    â”œâ”€â”€ gradle.properties
    â”œâ”€â”€ local.properties
    â”œâ”€â”€ gradle
    â”‚   â””â”€â”€ wrapper
    â”‚       â”œâ”€â”€ gradle-wrapper.jar
    â”‚       â””â”€â”€ gradle-wrapper.properties
    â”œâ”€â”€ gradlew
    â””â”€â”€ gradlew.bat
    

*   **settings.gradle æ–‡ä»¶ï¼š** ç”¨äºç¡®å®šå“ªäº›æ¨¡å—å‚ä¸æ„å»ºï¼›
*   **é¡¹ç›®çº§ build.gradle æ–‡ä»¶ï¼š** ç”¨äºå®šä¹‰æ‰€æœ‰å­æ¨¡å—å…¬å…±çš„é…ç½®å‚æ•°ï¼›
*   **æ¨¡å—çº§ build.gradle æ–‡ä»¶ï¼š** ç”¨äºå®šä¹‰å­æ¨¡å—çš„é…ç½®å‚æ•°ï¼Œå®ƒå¯ä»¥è¦†ç›–é¡¹ç›®çº§ build.gradle æ–‡ä»¶ä¸­å®šä¹‰çš„é…ç½®ï¼›
*   **gradle/warpperï¼š** è´Ÿè´£è‡ªåŠ¨ä¸‹è½½å®‰è£…é¡¹ç›®æ‰€éœ€çš„ Gradle ç¯å¢ƒçš„è„šæœ¬ï¼›
*   **gradle.propertiesï¼š** ç”¨ä½œé¡¹ç›®çº§ Gradle é…ç½®é¡¹ï¼Œä¼šè¦†ç›–å…¨å±€çš„é…ç½®é¡¹ï¼›
*   **local.propertiesï¼š** ç”¨ä½œé¡¹ç›®çš„ç§æœ‰å±æ€§é…ç½®ï¼Œä¾‹å¦‚ SDK å®‰è£…ç›®å½•ï¼Œä¸€èˆ¬ä¸æŠŠ local.properties åŠ å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚

### 1.3 Gradle ä¸­çš„é‡è¦æ¦‚å¿µ

*   **Gradleï¼š** æä¾›æ ¸å¿ƒæ„å»ºæµç¨‹ï¼Œä½†ä¸æä¾›å…·ä½“æ„å»ºé€»è¾‘ï¼›
*   **Gradle æ’ä»¶ï¼š** Gradle æä¾›çš„æ˜¯ä¸€å¥—æ ¸å¿ƒçš„æ„å»ºæœºåˆ¶ï¼Œè€Œ Gradle æ’ä»¶æ­£æ˜¯è¿è¡Œåœ¨è¿™å¥—æœºåˆ¶ä¸Šçš„ä¸€äº›å…·ä½“æ„å»ºé€»è¾‘ï¼Œæœ¬è´¨ä¸Šå’Œ .gradle æ–‡ä»¶æ²¡æœ‰åŒºåˆ«ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„ Android æ„å»ºæµç¨‹å°±æ˜¯ç”± Android Gradle Plugin å¼•å…¥çš„æ„å»ºé€»è¾‘ï¼›
*   **Gradle Daemonï¼š** ç”¨äºæå‡æ„å»ºé€Ÿåº¦çš„åå°è¿›ç¨‹ï¼›
*   **Gradle Wrapperï¼š** å¯¹ Gradle çš„å°è£…ï¼Œå¢åŠ äº†è‡ªåŠ¨ä¸‹è½½å®‰è£… Gradle ç¯å¢ƒçš„èƒ½åŠ›ï¼›
*   **ç¯å¢ƒå˜é‡ GRADLEï¼š** ç”¨äºå®šä¹‰ Gradle çš„å®‰è£…ç›®å½•ï¼›
*   **ç¯å¢ƒå˜é‡ GRADLE\_USER\_HOMEï¼š** ç”¨äºå®šä¹‰ Gradle è¿è¡Œè¿‡ç¨‹çš„æ–‡ä»¶å­˜å‚¨ç›®å½•ï¼Œä¾‹å¦‚ Gradle Wrapper è‡ªåŠ¨å®‰è£…çš„ Gradle ç¯å¢ƒã€æ„å»ºç¼“å­˜ç­‰ï¼›

### 1.4 Gradle Daemon

**[Gradle Daemon](https://docs.gradle.org/current/userguide/gradle_daemon.html) æ˜¯ Gradle 3.0 å¼•å…¥çš„æ„å»ºä¼˜åŒ–ç­–ç•¥ï¼Œé€šè¿‡è§„é¿é‡å¤åˆ›å»º JVM å’Œå†…å­˜ç¼“å­˜çš„æ‰‹æ®µæå‡äº†æ„å»ºé€Ÿåº¦ã€‚** Daemon è¿›ç¨‹æ‰æ˜¯æ‰§è¡Œæ„å»ºçš„è¿›ç¨‹ï¼Œå½“æ„å»ºç»“æŸåï¼ŒDaemon è¿›ç¨‹å¹¶ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­ç­‰å¾…æ‰¿æ¥ä¸‹ä¸€æ¬¡æ„å»ºã€‚æ ¹æ®å®˜æ–¹æ–‡æ¡£è¯´æ˜ï¼ŒGradle Daemon èƒ½å¤Ÿé™ä½ 15-75% çš„æ„å»ºæ—¶é—´ã€‚

Daemon çš„ä¼˜åŒ–æ•ˆæœä¸»è¦ä½“ç°åœ¨ 3 æ–¹é¢ï¼š

*   **1ã€ç¼©çŸ­ JVM è™šæ‹Ÿæœºå¯åŠ¨æ—¶é—´ï¼š** ä¸éœ€è¦é‡å¤åˆ›å»ºï¼›
*   **2ã€JIT ç¼–è¯‘ï¼š** Daemon è¿›ç¨‹ä¼šæ‰§è¡Œ JIT ç¼–è¯‘ï¼Œæœ‰åŠ©äºæå‡åç»­æ„å»ºçš„å­—èŠ‚ç æ‰§è¡Œæ•ˆç‡ï¼›
*   **3ã€æ„å»ºç¼“å­˜ï¼š** æ„å»ºè¿‡ç¨‹ä¸­åŠ è½½çš„ç±»ã€èµ„æºæˆ–è€… Task çš„è¾“å…¥å’Œè¾“å‡ºä¼šä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥è¢«åç»­æ„å»ºå¤ç”¨ã€‚

ç›¸å…³çš„ Gradle å‘½ä»¤ï¼š

*   **gradle â€”statusï¼š** æŸ¥çœ‹å­˜æ´»çš„ Daemon è¿›ç¨‹ä¿¡æ¯ï¼›
*   **gradle â€”stopï¼š** åœæ­¢æ‰€æœ‰ Daemon è¿›ç¨‹ã€‚

> **æç¤ºï¼š** å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ„å»ºéƒ½ä¼šå¤ç”¨åŒä¸€ä¸ª Daemon è¿›ç¨‹ï¼Œå¦‚æœå·²å­˜æ´»çš„ Daemon è¿›ç¨‹æ— æ³•æ»¡è¶³æ–°æ„å»ºçš„éœ€æ±‚ï¼Œåˆ™ Gradle ä¼šæ–°å»ºä¸€ä¸ªæ–°çš„ Daemon è¿›ç¨‹ã€‚å½±å“å› ç´ ï¼š
> 
> *   Gradle ç‰ˆæœ¬ï¼š ä¸åŒ Gradle ç‰ˆæœ¬çš„æ„å»ºä¸ä¼šå…³è”åˆ°åŒä¸€ä¸ª Daemon è¿›ç¨‹ï¼›
> *   Gradle è™šæ‹Ÿæœºå‚æ•°ï¼š ä¸æ»¡è¶³çš„è™šæ‹Ÿæœºå‚æ•°ä¸ä¼šå…³è”åˆ°åŒä¸€ä¸ª Daemon è¿›ç¨‹ã€‚

### 1.5 Gradle Wrapper

**Gradle Wrapper æœ¬è´¨æ˜¯å¯¹ Gradle çš„ä¸€å±‚åŒ…è£…ï¼Œä¼šåœ¨æ‰§è¡Œ Gradle æ„å»ºä¹‹å‰è‡ªåŠ¨ä¸‹è½½å®‰è£… Gradle ç¯å¢ƒã€‚** åœ¨å¼€å§‹æ‰§è¡Œ Gradle æ„å»ºæ—¶ï¼Œå¦‚æœå½“å‰è®¾å¤‡ä¸­è¿˜æœªå®‰è£…æ‰€éœ€ç‰ˆæœ¬çš„ Gradle ç¯å¢ƒï¼ŒGradle Wrapper ä¼šå…ˆå¸®ä½ ä¸‹è½½å®‰è£…ä¸‹æ¥ï¼Œå°†æ¥å…¶ä»–éœ€è¦è¿™ä¸ª Gradle ç‰ˆæœ¬çš„å·¥ç¨‹ä¹Ÿå¯ä»¥ç›´æ¥å¤ç”¨ã€‚

![file](https://img2022.cnblogs.com/other/2839502/202205/2839502-20220516112233816-1183646558.png)

Android Studio é»˜è®¤ä½¿ç”¨ Gradle Wrapper æ‰§è¡Œæ„å»ºï¼Œä½ å¯ä»¥åœ¨è®¾ç½®ä¸­ä¿®æ”¹è¿™ä¸€è¡Œä¸ºï¼š

![file](https://img2022.cnblogs.com/other/2839502/202205/2839502-20220516112234655-1096386194.png)

å‘½ä»¤è¡Œä¹Ÿæœ‰åŒºåˆ†ï¼š

*   `gradle` ï¼šä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡å®šä¹‰çš„ Gradle ç¯å¢ƒè¿›è¡Œæ„å»ºï¼›
*   `gradlew` ï¼šä½¿ç”¨ Gradle Wrapper æ‰§è¡Œæ„å»ºã€‚

ä¸ºä»€ä¹ˆ Gradle å®˜æ–¹ä»æ—©æœŸå°±ä¸“é—¨æ¨å‡ºä¸€ä¸ªè‡ªåŠ¨å®‰è£…ç¯å¢ƒå·¥å…·å‘¢ï¼Œæˆ‘è®¤ä¸ºåŸå› æœ‰ 2 ä¸ªï¼š

*   **ç¡®ä¿ Gradle ç‰ˆæœ¬æ­£ç¡®æ€§ï¼š** é‰´äº Gradle æœ‰è¾ƒå¼±å‘åå…¼å®¹æ€§çš„ç‰¹ç‚¹ï¼ŒGradle Wrapper èƒ½å¤Ÿä»é¡¹ç›®å·¥ç¨‹çº§åˆ«å›ºåŒ–é¡¹ç›®æ‰€éœ€è¦çš„ Gradle ç‰ˆæœ¬ï¼Œä»è€Œç¡®ä¿åŒä¸€ä¸ªå·¥ç¨‹ç§»æ¤åˆ°å…¶ä»–ç”µè„‘åèƒ½å¤Ÿæ­£ç¡®åœ°ã€å¯é‡å¤åœ°æ„å»ºï¼›
*   **å‡å°‘äº†æ‰‹åŠ¨å®‰è£… Gradle ç¯å¢ƒçš„å·¥ä½œé‡ï¼š** å•å•ä» Gradle 4 åˆ° Gradle 7 å°±æœ‰å¤§å¤§å°å°åå‡ ä¸ªç‰ˆæœ¬ï¼Œè€Œä¸”æ¯ä¸ªå·¥ç¨‹æ‰€éœ€è¦çš„ Gradle ç‰ˆæœ¬ä¸å°½ç›¸åŒï¼Œä½¿ç”¨ Gradle Wrapper èƒ½å¤Ÿå‡å°‘æ‰‹åŠ¨å®‰è£…ç¯å¢ƒçš„å·¥ä½œé‡ï¼›

ç®€å•è¯´ä¸‹ Gradle Wrapper ç›¸å…³çš„æ–‡ä»¶ï¼Œä¸»è¦æœ‰ 4 ä¸ªï¼š

*   **gradlew & gradlew.batï¼š** åœ¨ Linux æˆ– Mac ä¸Šå¯ç”¨çš„ Shell è„šæœ¬ï¼Œä»¥åŠåœ¨ Window ä¸Šå¯ç”¨çš„ Batch è„šæœ¬ï¼Œç”¨äºä»¥ Gradle Wrapper çš„æ–¹å¼æ‰§è¡Œæ„å»ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å‘½ä»¤è¡Œä½¿ç”¨ `gradlew` æ‰æ˜¯åŸºäº Gradle Wrapper æ‰§è¡Œçš„ï¼Œè€Œä½¿ç”¨ `gradle` å‘½ä»¤æ˜¯ç›´æ¥åŸºäºç³»ç»Ÿå®‰è£…çš„ Gradle ç¯å¢ƒæ‰§è¡Œç¼–è¯‘ï¼›
*   **gradle-wrapper.jarï¼š** è´Ÿè´£ä¸‹è½½å®‰è£… Gradle ç¯å¢ƒçš„è„šæœ¬ï¼›
*   **gradle-wrapper.propertiesï¼š** Gradle Wrapper çš„é…ç½®æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯å†³å®š Gradle ç‰ˆæœ¬å’Œå®‰è£…ç›®å½•ï¼š
    *   distributionBase + distributionPathï¼šæŒ‡å®š Gradle ç¯å¢ƒå®‰è£…è·¯å¾„ï¼›
    *   zipStoreBase + zipStorePathï¼šæŒ‡å®š Gradle å®‰è£…åŒ…çš„å­˜å‚¨è·¯å¾„ï¼›
    *   distributionUrlï¼šæŒ‡å®šç‰ˆæœ¬ Gradle çš„ä¸‹è½½åœ°å€ï¼Œé€šè¿‡è¿™ä¸ªå‚æ•°å¯ä»¥é…ç½®é¡¹ç›®å·¥ç¨‹æ‰€éœ€è¦çš„ Gradle ç‰ˆæœ¬ã€‚

    distributionBase=GRADLE_USER_HOME
    distributionPath=wrapper/dists
    distributionUrl=https\://services.gradle.org/distributions/gradle-6.0.1-bin.zip
    zipStoreBase=GRADLE_USER_HOME
    zipStorePath=wrapper/dists
    

> **æç¤ºï¼š** GRADLE\_USER\_HOME çš„é»˜è®¤å€¼æ˜¯ `ç”¨æˆ·ç›®å½•/.gradle`ï¼Œå¯ä»¥é€šè¿‡ç³»ç»Ÿç¯å¢ƒå˜é‡ GRADLE\_USER\_HOME ä¿®æ”¹ã€‚

### 1.6 gradle.properties æ„å»ºç¯å¢ƒé…ç½®

Gradle æ˜¯è¿è¡Œåœ¨ Java è™šæ‹Ÿæœºçš„ï¼Œgradle.properties æ–‡ä»¶å¯ä»¥é…ç½® Gradle æ„å»ºçš„è¿è¡Œç¯å¢ƒï¼Œå¹¶ä¸”ä¼šè¦†ç›– Android Studio è®¾ç½®ä¸­çš„å…¨å±€é…ç½®ï¼Œå®Œæ•´æ„å»ºç¯å¢ƒé…ç½®è§å®˜æ–¹æ–‡æ¡£ï¼š[Build Enviroment](https://docs.gradle.org/current/userguide/build_environment.html)ã€‚å¸¸ç”¨çš„é…ç½®é¡¹ä¸¾ä¾‹ï¼š

    # Gradle Daemon å¼€å…³ï¼Œé»˜è®¤ ture
    org.gradle.daemon=true  
    
    # è™šæ‹Ÿæœºå‚æ•°
    org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8
    
    # å¤šæ¨¡å—å·¥ç¨‹å¹¶è¡Œç¼–è¯‘å¤šä¸ªæ¨¡å—ï¼Œä¼šæ¶ˆè€—æ›´å¤šå†…å­˜
    org.gradle.parallel=true  
    

é™¤äº†æ„å»ºç¯å¢ƒé…ç½®ï¼Œå…¶ä»–é…ç½®ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„é”®å€¼å¯¹æ–¹å¼æ”¾åœ¨ gradle.properties ä¸­ï¼Œå¹¶ç›´æ¥åœ¨ .gradle æ–‡ä»¶ä¸­å¼•ç”¨ã€‚

* * *

2\. Groovy å¿…çŸ¥å¿…ä¼š
---------------

Groovy æ˜¯ä» Java è™šæ‹Ÿæœºè¡ç”Ÿå‡ºæ¥çš„è¯­è¨€ï¼Œç”±äºæˆ‘ä»¬éƒ½å…·å¤‡ä¸€å®šçš„ Java åŸºç¡€ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰å¿…è¦å®Œå…¨ä»é›¶å¼€å§‹å­¦ä¹  Groovyã€‚æ¢³ç† Groovy ä¸ Java ä¹‹é—´æœ‰å·®å¼‚çš„åœ°æ–¹ï¼Œæˆ–è®¸æ˜¯æ›´é«˜æ•ˆçš„å­¦ä¹ æ–¹å¼ï¼š

### 2.1 ä¸€äº›å°å·®å¼‚

*   **åˆ†å·ï¼š** è¯­å¥å…è®¸ä¸ä»¥åˆ†å· ; ç»“å°¾ï¼›
*   **publicï¼š** é»˜è®¤çš„è®¿é—®ä¿®é¥°ç¬¦ä¸º publicï¼›
*   **getter / setterï¼š** Groovy ä¼šä¸ºæ¯ä¸ª field åˆ›å»ºå¯¹åº”çš„ getter / setter æ–¹æ³•ï¼Œåœ¨è®¿é—® obj.field / obj.field=â€â€ æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨è®¿é—® getField() å’Œ setField(â€â€)ï¼›
*   **æ”¯æŒé™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹ï¼š** Groovy æ—¢æ”¯æŒ Java çš„é™æ€ç±»å‹ï¼Œä¹Ÿæ”¯æŒé€šè¿‡ `def` å…³é”®å­—å£°æ˜åŠ¨æ€ç±»å‹ï¼ˆé™æ€ç±»å‹å’ŒåŠ¨æ€ç±»å‹çš„å…³é”®åŒºåˆ«åœ¨äº â€ç±»å‹æ£€æŸ¥æ˜¯å¦å€¾å‘äºåœ¨ç¼–è¯‘æ—¶æ‰§è¡Œâ€œã€‚ä¾‹å¦‚ Java æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œæ„å‘³ç€ç±»å‹æ£€æŸ¥ä¸»è¦ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å®Œæˆï¼‰ï¼›
*   **å­—ç¬¦ä¸²ï¼š** Groovy æ”¯æŒä¸‰ç§æ ¼å¼å®šä¹‰å­—ç¬¦ä¸² â€”â€” å•å¼•å·ã€åŒå¼•å·å’Œä¸‰å¼•å·
    *   å•å¼•å·ï¼šçº¯ç²¹çš„å­—ç¬¦ä¸²ï¼Œä¸ Java çš„åŒå¼•å·å­—ç¬¦ä¸²ç±»ä¼¼ï¼›
    *   åŒå¼•å·ï¼šæ”¯æŒåœ¨å¼•å·å†…é€šè¿‡ $ å…³é”®å­—ç›´æ¥å¼•ç”¨å˜é‡å€¼ï¼›
    *   ä¸‰å¼•å·ï¼šæ”¯æŒæ¢è¡Œã€‚

### 2.2 å‡½æ•°

*   **å‡½æ•°å®šä¹‰ï¼š** Groovy æ”¯æŒé€šè¿‡è¿”å›ç±»å‹æˆ– def å…³é”®å­—å®šä¹‰å‡½æ•°ã€‚def å…³é”®å­—å®šä¹‰çš„å‡½æ•°å¦‚æœæ²¡æœ‰ return å…³é”®å­—è¿”å›å€¼ï¼Œåˆ™é»˜è®¤ä¼šè¿”å› nullã€‚ä¾‹å¦‚ï¼š

    // ä½¿ç”¨ def å…³é”®å­—
    def methodName() {
        // Method Code
    }
    
    String methodName() {
        // Method Code
    }
    

*   **å‚æ•°åï¼š** Groovy æ”¯æŒä¸æŒ‡å®šå‚æ•°ç±»å‹ã€‚ä¾‹å¦‚ï¼š

    // çœç•¥å‚æ•°ç±»å‹
    def methodName(param1, param2) {
        // Method Code
    }
    
    def methodName(String param1, String param2) {
        // Method Code
    }
    

*   **é»˜è®¤å‚æ•°ï¼š** Groovy æ”¯æŒæŒ‡å®šå‡½æ•°å‚æ•°é»˜è®¤å€¼ï¼Œé»˜è®¤å‚æ•°å¿…é¡»æ”¾åœ¨å‚æ•°åˆ—è¡¨æœ«å°¾ã€‚ä¾‹å¦‚ï¼š

    def methodName(param1, param2 = 1) {
        // Method Code
    }
    

*   **è¿”å›å€¼ï¼š** å¯ä»¥çœç•¥ returnï¼Œé»˜è®¤è¿”å›æœ€åä¸€è¡Œè¯­å¥çš„å€¼ã€‚ä¾‹å¦‚ï¼š

    def methodName() {
        return "è¿”å›å€¼"
    }
    ç­‰ä»·äº
    def methodName() {
        "è¿”å›å€¼"
    }
    

*   **invokeMethod & methodMissingï¼š**
    *   **invokeMethodï¼š** åˆ†æ´¾å¯¹è±¡ä¸Šæ‰€æœ‰æ–¹æ³•è°ƒç”¨ï¼ŒåŒ…æ‹¬å·²å®šä¹‰å’Œæœªå®šä¹‰çš„æ–¹æ³•ï¼Œéœ€è¦å®ç° GroovyInterceptable æ¥å£ï¼›
    *   **methodMissingï¼š** åˆ†æ´¾å¯¹è±¡ä¸Šæ‰€æœ‰ä¸ºå®šä¹‰æ–¹æ³•çš„è°ƒç”¨ã€‚

    // å®ç° GroovyInterceptable æ¥å£ï¼Œæ‰ä¼šæŠŠæ–¹æ³•è°ƒç”¨åˆ†æ´¾åˆ° invokeMethodã€‚
    class Student implements GroovyInterceptable{
        def name;
    
        def hello() {
            println "Hello ${name}"
        }
    
        @Override
        Object invokeMethod(String name, Object args) {
            System.out.println "invokeMethod : $name"
        }
    }
    
    def student = new Student(name: "Tom")
    
    student.hello()
    student.hello1()
    
    è¾“å‡ºï¼š
    invokeMethod : hello
    invokeMethod : hello1
    
    -------------------------------------------------------------
    
    class Student {
        def name;
    
        def hello() {
            println "Hello ${name}"
        }
    
        @Override
        Object methodMissing(String name, Object args) {
            System.out.println "methodMissing : $name"
        }
    }
    
    def student = new Student(name: "Tom")
    
    student.hello()
    student.hello1()
    
    è¾“å‡ºï¼š
    Hello Tom
    methodMissing hello1
    

### 2.3 é›†åˆ

Groovy æ”¯æŒé€šè¿‡ \[\] å…³é”®å­—å®šä¹‰ List åˆ—è¡¨æˆ– Map é›†åˆï¼š

*   **åˆ—è¡¨ï¼š** ä¾‹å¦‚ def list = \[1, 2, 3, 4\]
*   **é›†åˆï¼š** ä¾‹å¦‚ def map = \[â€™nameâ€™:â€™Tomâ€™, â€˜ageâ€™:18\]ï¼Œç©ºé›†åˆ \[:\]
*   **èŒƒå›´ï¼š** ä¾‹å¦‚ def range = 1 .. 10
*   **éå†ï¼š**

    // åˆ—è¡¨
    def list = [10, 11, 12]
    list.each { value ->
    }
    list.eachWIthIndex { value, index ->
    }
    
    // é›†åˆ
    def map = [â€™nameâ€™:â€™Tomâ€™, â€˜ageâ€™:18]
    map.each { key, value ->
    }
    map.eachWithIndex { entry, index ->
    }
    map.eachWithIndex { key, value, index ->
    }
    

### 2.4 é—­åŒ…

Groovy é—­åŒ…æ˜¯ä¸€ä¸ªåŒ¿åä»£ç å—ï¼Œå¯ä»¥ä½œä¸ºå€¼ä¼ é€’ç»™å˜é‡æˆ–å‡½æ•°å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶å‚æ•°å’Œæä¾›è¿”å›å€¼ï¼Œå½¢å¼ä¸Šä¸ Java / Kotlin çš„ lambda è¡¨è¾¾å¼ç±»ä¼¼ã€‚ä¾‹å¦‚ä»¥ä¸‹æ˜¯æœ‰æ•ˆçš„é—­åŒ…ï¼š

    { 123 }                                          
    
    { -> 123 }                                       
    
    { println it }
    
    { it -> println it }
    
    { name -> println name }                            
    
    { String x, int y ->                                
        println "hey ${x} the value is ${y}"
    }
    

*   **é—­åŒ…ç±»å‹ï¼š** Groovy å°†é—­åŒ…å®šä¹‰ä¸º `groovy.lang.Closure` çš„å®ä¾‹ï¼Œä½¿å¾—é—­åŒ…å¯ä»¥åƒå…¶ä»–ç±»å‹çš„å€¼ä¸€æ ·å¤åˆ¶ç»™å˜é‡ã€‚ä¾‹å¦‚ï¼š

    Closure c = { 123 }
    
    // å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ def å…³é”®å­—
    def c = { 123 }
    

*   **é—­åŒ…è°ƒç”¨ï¼š** é—­åŒ…å¯ä»¥åƒæ–¹æ³•ä¸€æ ·è¢«è°ƒç”¨ï¼Œå¯ä»¥é€šè¿‡ Closure#call() å®Œæˆï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡å˜é‡å®Œæˆã€‚ä¾‹å¦‚ï¼š

    def c = { 123 }
    
    // é€šè¿‡ Closure#call() è°ƒç”¨
    c.call()
    
    // ç›´æ¥é€šè¿‡å˜é‡åè°ƒç”¨
    c()
    

*   **éšå¼å‚æ•°ï¼š** é—­åŒ…é»˜è®¤è‡³å°‘æœ‰ä¸€ä¸ªå½¢å¼å‚æ•°ï¼Œå¦‚æœé—­åŒ…æ²¡æœ‰æ˜¾å¼å®šä¹‰å‚æ•°åˆ—è¡¨ï¼ˆä½¿ç”¨ `â†’`ï¼‰ï¼ŒGroovy æ€»æ˜¯å¸¦æœ‰éšå¼æ·»åŠ ä¸€ä¸ªå‚æ•° itã€‚å¦‚æœè°ƒç”¨è€…æ²¡æœ‰ä½¿ç”¨ä»»ä½•å®å‚ï¼Œåˆ™ it ä¸ºç©ºã€‚å½“ä½ éœ€è¦å£°æ˜ä¸€ä¸ªä¸æ¥æ”¶ä»»ä½•å‚æ•°çš„é—­åŒ…ï¼Œé‚£ä¹ˆå¿…é¡»ç”¨æ˜¾å¼çš„ç©ºå‚æ•°åˆ—è¡¨å£°æ˜ã€‚ä¾‹å¦‚ï¼š

    // å¸¦éšå¼å‚æ•° it
    def greeting = { "Hello, $it!" }
    assert greeting('Patrick') == 'Hello, Patrick!'
    
    // ä¸å¸¦éšå¼å‚æ•° it
    def magicNumber = { -> 42 }
    // error ä¸å…è®¸ä¼ é€’å‚æ•°
    magicNumber(11)
    

*   **é—­åŒ…å‚æ•°ç®€åŒ–ï¼š** å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯é—­åŒ…ç±»å‹çš„åŒ–ï¼Œåœ¨è°ƒç”¨æ—¶å¯ä»¥ç®€åŒ–ï¼Œçœç•¥åœ†æ‹¬å·ï¼š

    def methodName(String param1, Closure closure) {
        // Method Code
    }
    
    // è°ƒç”¨ï¼š
    methodName("Hello") {
        // Closure Code
    }
    

*   **thisã€ownerã€delegateï¼š** é—­åŒ…å§”æ‰˜æ˜¯ Groovy Closure ç›¸æ¯” Java Lambda æœ€å¤§çš„åŒºåˆ«ï¼Œé€šè¿‡ä¿®æ”¹é—­åŒ…çš„å§”æ‰˜å¯ä»¥å®ç°çµæ´»å¤šæ ·çš„ DSLã€‚å…ˆè®¤è¯†é—­åŒ…ä¸­çš„ä¸‰ä¸ªå˜é‡ï¼š
    *   **thisï¼š** å®šä¹‰é—­åŒ…çš„å¤–éƒ¨ç±»ï¼Œthis ä¸€å®šæŒ‡å‘ç±»å¯¹è±¡ï¼›
    *   **ownerï¼š** å®šä¹‰é—­åŒ…çš„å¤–éƒ¨å¯¹è±¡ï¼Œowner å¯èƒ½æ˜¯ç±»å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æ˜¯æ›´å¤–ä¸€å±‚çš„é—­åŒ…ï¼›
    *   **delegateï¼š** é»˜è®¤æƒ…å†µ delegate ç­‰åŒäº ownerï¼Œthis å’Œ owner çš„è¯­ä¹‰æ— æ³•ä¿®æ”¹ï¼Œè€Œ delegate å¯ä»¥ä¿®æ”¹ã€‚
*   **é—­åŒ…å§”æ‰˜ç­–ç•¥ï¼š** åœ¨é—­åŒ…ä¸­ï¼Œå¦‚æœä¸€ä¸ªå±æ€§æ²¡æœ‰æ˜¾å¼å£°æ˜æ¥æ”¶è€…å¯¹è±¡ï¼Œåˆ™ä¼šé€šè¿‡é—­åŒ…ä»£ç†è§£æç­–ç•¥å¯»æ‰¾å®šä¹‰çš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š

    class Person {
        String name
    }
    def p = new Person(name:'Igor')
    def cl = { 
        // ç›¸å½“äº delegate.name.toUpperCase()
        name.toUpperCase() 
    }                 
    cl.delegate = p                                 
    assert cl() == 'IGOR'
    

é—­åŒ…å®šä¹‰äº†å¤šç§è§£æç­–ç•¥ï¼Œå¯ä»¥é€šè¿‡ `Closure#resolveStrategy=Closure.DELEGATE_FIRST` ä¿®æ”¹ï¼š

*   **Closure.OWNER\_FIRSTï¼ˆé»˜è®¤ï¼‰ï¼š** ä¼˜å…ˆåœ¨ owner å¯¹è±¡ä¸­å¯»æ‰¾ï¼Œå†å» delegate å¯¹è±¡ä¸­å¯»æ‰¾ï¼›
*   **Closure.DELEGATE\_FIRSTï¼š** ä¼˜å…ˆåœ¨ delegate å¯¹è±¡ä¸­å¯»æ‰¾ï¼Œå†å» owner å¯¹è±¡ä¸­å¯»æ‰¾ï¼›
*   **Closure.OWNER\_ONLYï¼š** åªåœ¨ owner å¯¹è±¡ä¸­å¯»æ‰¾ï¼›
*   **Closure.DELEGATE\_ONLYï¼š** åªåœ¨ delegate å¯¹è±¡ä¸­å¯»æ‰¾ï¼›
*   **Closure.TO\_SELFï¼š** åªåœ¨é—­åŒ…æœ¬èº«å¯»æ‰¾ï¼›

* * *

3\. Gradle æ„å»ºç”Ÿå‘½å‘¨æœŸ
-----------------

Gradle å°†æ„å»ºåˆ’åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š **åˆå§‹åŒ– - é…ç½® - æ‰§è¡Œ** ã€‚ç†è§£æ„å»ºç”Ÿå‘½å‘¨æœŸï¼ˆGradle Build Lifecycleï¼‰éå¸¸é‡è¦ï¼Œå¦åˆ™ä½ å¯èƒ½è¿è„šæœ¬ä¸­çš„æ¯ä¸ªä»£ç å•å…ƒçš„æ‰§è¡Œæ—¶æœºéƒ½æä¸æ¸…æ¥šã€‚

### 3.1 åˆå§‹åŒ–é˜¶æ®µ

ç”±äº Gradle æ”¯æŒå•æ¨¡å—æ„å»ºæˆ–å¤šæ¨¡å—æ„å»ºï¼Œå› æ­¤åœ¨åˆå§‹åŒ–é˜¶æ®µï¼ˆInitialization Phaseï¼‰ï¼ŒGradle éœ€è¦çŸ¥é“å“ªäº›æ¨¡å—å°†å‚ä¸æ„å»ºã€‚ä¸»è¦åŒ…å« 4 æ­¥ï¼š

*   **1ã€æ‰§è¡Œ Init è„šæœ¬ï¼š** [Initialization Scripts](https://docs.gradle.org/6.0.1/userguide/init_scripts.html) ä¼šåœ¨æ„å»ºæœ€å¼€å§‹æ‰§è¡Œï¼Œä¸€èˆ¬ç”¨äºè®¾ç½®å…¨å±€å±æ€§ã€å£°æ˜å‘¨æœŸç›‘å¬ã€æ—¥å¿—æ‰“å°ç­‰ã€‚Gradle æ”¯æŒå¤šç§é…ç½® Init è„šæœ¬çš„æ–¹æ³•ï¼Œä»¥ä¸‹æ–¹å¼é…ç½®çš„æ‰€æœ‰ Init è„šæœ¬éƒ½ä¼šè¢«æ‰§è¡Œï¼š
    *   gradle å‘½ä»¤è¡ŒæŒ‡å®šçš„æ–‡ä»¶ï¼š`gradle â€”init-script <file>`
    *   USER\_HOME/.gradle/init.gradle æ–‡ä»¶
    *   USER\_HOME/.gradle/init.d/ æ–‡ä»¶å¤¹ä¸‹çš„ .gradle æ–‡ä»¶
    *   GRADLE\_HOME/init.d/ æ–‡ä»¶å¤¹ä¸‹çš„ .gradle æ–‡ä»¶
*   **2ã€å®ä¾‹åŒ– [Settings](https://docs.gradle.org/current/dsl/org.gradle.api.initialization.Settings.html) æ¥å£å®ä¾‹ï¼š** è§£ææ ¹ç›®å½•ä¸‹çš„ `settings.gradle` æ–‡ä»¶ï¼Œå¹¶å®ä¾‹åŒ–ä¸€ä¸ª Settings æ¥å£å®ä¾‹ï¼›
*   **3ã€æ‰§è¡Œ settings.gradle è„šæœ¬ï¼š** åœ¨ settings.gradle æ–‡ä»¶ä¸­çš„ä»£ç ä¼šåœ¨åˆå§‹åŒ–é˜¶æ®µæ‰§è¡Œï¼›
*   **4ã€å®ä¾‹åŒ– Project æ¥å£å®ä¾‹ï¼š** Gradle ä¼šè§£æ `include` å£°æ˜çš„æ¨¡å—ï¼Œå¹¶ä¸ºæ¯ä¸ªæ¨¡å— `build.gradle` æ–‡ä»¶å®ä¾‹åŒ– Project æ¥å£å®ä¾‹ã€‚Gradle é»˜è®¤ä¼šåœ¨å·¥ç¨‹æ ¹ç›®å½•ä¸‹å¯»æ‰¾ include åŒ…å«çš„é¡¹ç›®ï¼Œå¦‚æœä½ æƒ³åŒ…å«å…¶ä»–å·¥ç¨‹ç›®å½•ä¸‹çš„é¡¹ç›®ï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š

    // å¼•ç”¨å½“å‰å·¥ç¨‹ç›®å½•ä¸‹çš„æ¨¡å—
    include ':app'
    
    // å¼•ç”¨å…¶ä»–å·¥ç¨‹ç›®å½•ä¸‹çš„æ¨¡å—
    include 'video' // æ˜“é”™ç‚¹ï¼šä¸è¦åŠ â€™å†’å· :â€˜
    project(:video).projectDir = new File("..\\libs\\video")
    

> **æç¤ºï¼š** æ¨¡å— build.gradle æ–‡ä»¶çš„æ‰§è¡Œé¡ºåºå’Œ include é¡ºåºæ²¡æœ‰å…³ç³»ã€‚

### 3.2 é…ç½®é˜¶æ®µ

é…ç½®é˜¶æ®µï¼ˆConfiguration Phaseï¼‰å°†æ‰§è¡Œ build.gradle ä¸­çš„æ„å»ºé€»è¾‘ï¼Œä»¥å®Œæˆ Project çš„é…ç½®ã€‚ä¸»è¦åŒ…å« 3 æ­¥ï¼š

*   **1ã€ä¸‹è½½æ’ä»¶å’Œä¾èµ–ï¼š** Project é€šå¸¸éœ€è¦ä¾èµ–å…¶ä»–æ’ä»¶æˆ– Project æ¥å®Œæˆå·¥ä½œï¼Œå¦‚æœæœ‰éœ€è¦å…ˆä¸‹è½½ï¼›
*   **2ã€æ‰§è¡Œè„šæœ¬ä»£ç ï¼š** åœ¨ build.gradle æ–‡ä»¶ä¸­çš„ä»£ç ä¼šåœ¨é…ç½®é˜¶æ®µæ‰§è¡Œï¼›
*   **3ã€æ„é€  Task DAGï¼š** æ ¹æ® Task çš„ä¾èµ–å…³ç³»æ„é€ ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ï¼Œä»¥ä¾¿åœ¨æ‰§è¡Œé˜¶æ®µæŒ‰ç…§ä¾èµ–å…³ç³»æ‰§è¡Œ Taskã€‚

> **æç¤ºï¼š** æ‰§è¡Œä»»ä½• Gradle æ„å»ºå‘½ä»¤ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œåˆå§‹åŒ–é˜¶æ®µå’Œé…ç½®é˜¶æ®µã€‚

### 3.3 æ‰§è¡Œé˜¶æ®µ

åœ¨é…ç½®é˜¶æ®µå·²ç»æ„é€ äº† Task DAGï¼Œæ‰§è¡Œé˜¶æ®µï¼ˆExecution Phaseï¼‰å°±æ˜¯æŒ‰ç…§ä¾èµ–å…³ç³»æ‰§è¡Œ Taskã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªå®¹æ˜“ç†è§£é”™è¯¯çš„åœ°æ–¹ï¼š

*   **1ã€Task é…ç½®ä»£ç åœ¨é…ç½®é˜¶æ®µæ‰§è¡Œï¼Œè€Œ Task åŠ¨ä½œåœ¨æ‰§è¡Œé˜¶æ®µæ‰§è¡Œï¼›**
*   **2ã€å³ä½¿æ‰§è¡Œä¸€ä¸ª Taskï¼Œæ•´ä¸ªå·¥ç¨‹çš„åˆå§‹åŒ–é˜¶æ®µå’Œæ‰€æœ‰ Project çš„é…ç½®é˜¶æ®µä¹Ÿéƒ½ä¼šæ‰§è¡Œï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒæ‰§è¡Œè¿‡ç¨‹ä¸­è®¿é—®æ„å»ºæ¨¡å‹çš„ä»»ä½•éƒ¨åˆ†ã€‚**

> **åŸæ–‡ï¼š** This means that when a single task, from a single project is requested,Â _all_Â projects of a multi-project build are configured first. The reason every project needs to be configured is to support the flexibility of accessing and changing any part of the Gradle project model.

ä»‹ç»å®Œä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸé˜¶æ®µåï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ Demo ä½“ä¼šå„ä¸ªä»£ç å•å…ƒæ‰€å¤„çš„æ‰§è¡Œé˜¶æ®µï¼š

`USER_HOME/.gradle/init.gradle`

    println 'init.gradle:This is executed during the initialization phase.'
    

`settings.gradle`

    rootProject.name = 'basic'
    println 'settings.gradle:This is executed during the initialization phase.'
    

`build.gradle`

    println 'build.gradle:This is executed during the configuration phase.'
    
    tasks.register('test') {
        doFirst {
            println 'build.gradle:This is executed first during the execution phase.'
        }
        doLast {
            println 'build.gradle:This is executed last during the execution phase.'
        }
        // æ˜“é”™ç‚¹ï¼šè¿™é‡Œåœ¨é…ç½®é˜¶æ®µæ‰§è¡Œ
        println 'build.gradle:This is executed during the configuration phase as well.'
    }
    

è¾“å‡ºï¼š

    Executing tasks: [test] in project /Users/pengxurui/workspace/public/EasyUpload
    
    init.gradle:This is executed during the initialization phase.
    settings.gradle:This is executed during the initialization phase.
    
    > Configure project :
    build.gradle:This is executed during the configuration phase.
    build.gradle:This is executed during the configuration phase as well.
    
    > Task :test
    build.gradle:This is executed first during the execution phase.
    build.gradle:This is executed last during the execution phase.
    
    ...
    

> **æç¤ºï¼š** Task åœ¨æ‰§è¡Œé˜¶æ®µæ‰§è¡Œæœ‰ä¸€ä¸ªç‰¹ä¾‹ï¼Œå³é€šè¿‡ Project#defaultTasks æŒ‡å®šé»˜è®¤ä»»åŠ¡ï¼Œä¼šåœ¨é…ç½®é˜¶æ®µä¼šæ‰§è¡Œï¼Œè§ **ç¬¬ 6.2 èŠ‚** ï¼Œäº†è§£å³å¯ã€‚

### 3.4 ç”Ÿå‘½å‘¨æœŸç›‘å¬

Gradle æä¾›äº†ä¸€ç³»åˆ—ç›‘å¬æ„å»ºç”Ÿå‘½å‘¨æœŸæµç¨‹çš„æ¥å£ï¼Œå¤§éƒ¨åˆ†çš„èŠ‚ç‚¹éƒ½æœ‰ç›´æ¥çš„ Hook ç‚¹ï¼Œè¿™é‡Œæˆ‘æ€»ç»“ä¸€äº›å¸¸ç”¨çš„ï¼š

*   **1ã€ç›‘å¬åˆå§‹åŒ–é˜¶æ®µ**

Gradle æ¥å£æä¾›äº†ç›‘å¬ Settings åˆå§‹åŒ–é˜¶æ®µçš„æ–¹æ³•ï¼š

`settings.gradle`

    // Settings é…ç½®å®Œæ¯•
    gradle.settingsEvaluated {
        ...
    }
    
    // æ‰€æœ‰ Project å¯¹è±¡åˆ›å»ºï¼ˆæ³¨æ„ï¼šæ­¤æ—¶ build.gradle ä¸­çš„é…ç½®ä»£ç è¿˜æœªæ‰§è¡Œï¼‰
    gradle.projectsLoaded {
        ...
    }
    

*   **2ã€ç›‘å¬é…ç½®é˜¶æ®µ**

Project æ¥å£æä¾›äº†ç›‘å¬å½“å‰ Project é…ç½®é˜¶æ®µæ‰§è¡Œçš„æ–¹æ³•ï¼Œå…¶ä¸­ afterEvaluate å¸¸ç”¨äºåœ¨ Project é…ç½®å®Œæˆåç»§ç»­å¢åŠ é¢å¤–çš„é…ç½®ï¼Œä¾‹å¦‚ Hook æ„å»ºè¿‡ç¨‹ä¸­çš„ Taskã€‚

    // æ‰§è¡Œ build.gradle å‰
    project.beforeEvaluate { 
        ...
    }
    
    // æ‰§è¡Œ build.gradle å
    project.afterEvaluate { 
        ...
    }
    

é™¤æ­¤ä¹‹å¤–ï¼ŒGradle æ¥å£ä¹Ÿæä¾›äº†é…ç½®é˜¶æ®µçš„ç›‘å¬ï¼š

    // æ‰§è¡Œ build.gradle å‰
    gradle.beforeProject { project ->
        ...
    }
    
    // æ‰§è¡Œ build.gradle å
    gradle.afterProject { project ->
        // é…ç½®åï¼Œæ— è®ºæˆåŠŸæˆ–å¤±è´¥
        if (project.state.failure) {
            println "Evaluation of $project FAILED"
        } else {
            println "Evaluation of $project succeeded"
        }
    }
    
    // ä¸ project.beforeEvaluate å’Œ project.afterEvaluate ç­‰ä»·
    gradle.addProjectEvaluationListener(new ProjectEvaluationListener() {
        @Override
        void beforeEvaluate(Project project) {
            ...
        }
    
        @Override
        void afterEvaluate(Project project, ProjectState projectState) {
            ...
        }
    })
    
    // ä¾èµ–å…³ç³»è§£æå®Œæ¯•
    gradle.addListener(new DependencyResolutionListener() {
        @Override
        void beforeResolve(ResolvableDependencies dependencies) {
            ....
        }
    
        @Override
        void afterResolve(ResolvableDependencies dependencies) {
            ....
        }
    })
    
    // Task DAG æ„é€ å®Œæ¯•
    gradle.taskGraph.whenReady {   
    }
    
    // ä¸ gradle.taskGraph.whenReady ç­‰ä»·
    gradle.addListener(new TaskExecutionGraphListener() {
        @Override
        void graphPopulated(TaskExecutionGraph graph) {
            ...
        }
    })
    
    // æ‰€æœ‰ Project çš„ build.gradle æ‰§è¡Œå®Œæ¯•
    gradle.projectsEvaluated {
        ...
    }
    

*   **3ã€ç›‘å¬æ‰§è¡Œé˜¶æ®µ**

Gradle æ¥å£æä¾›äº†æ‰§è¡Œé˜¶æ®µçš„ç›‘å¬ï¼š

    gradle.addListener(new TaskExecutionListener() {
    
        // æ‰§è¡Œ Task å‰
        @Override
        void beforeExecute(Task task) {
            ...
        }
    
        // æ‰§è¡Œ Task å
        @Override
        void afterExecute(Task task, TaskState state) {
            ...
        }
    })
    
    gradle.addListener(new TaskActionListener() {
    
        // å¼€å§‹æ‰§è¡Œ Action åˆ—è¡¨å‰ï¼Œå›è°ƒæ—¶æœºç•¥æ™šäº TaskExecutionListener#beforeExecute
        @Override
        void beforeActions(Task task) {
            ...
        }
    
        // æ‰§è¡Œ Action åˆ—è¡¨å®Œæ¯•ï¼Œå›è°ƒæ—¶æœºç•¥æ—©äº TaskExecutionListener#afterExecute
        @Override
        void afterActions(Task task) {
            ...
        }
    })
    
    // æ‰§è¡Œ Task å‰
    gradle.taskGraph.beforeTask { Task task ->
    }
    
    // æ‰§è¡Œ Task å
    gradle.taskGraph.afterTask { Task task, TaskState state ->
        if (state.failure) {
            println "FAILED"
        }
        else {
            println "done"
        }
    }
    

*   **4ã€ç›‘å¬ Task åˆ›å»º**

TaskContainer æ¥å£æä¾›äº†ç›‘å¬ Task æ·»åŠ çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ Task æ·»åŠ åˆ° Project æ—¶æ”¶åˆ°å›è°ƒï¼š

    tasks.whenTaskAdded { task ->
    }
    

*   **5ã€ç›‘å¬æ„å»ºç»“æŸ**

å½“æ‰€æœ‰ Task æ‰§è¡Œå®Œæ¯•ï¼Œæ„å‘³ç€æ„å»ºç»“æŸï¼š

    gradle.buildFinished {
        ...
    }
    

* * *

4\. Project æ ¸å¿ƒ API
==================

[Project](https://docs.gradle.org/current/dsl/org.gradle.api.Project.html) å¯ä»¥ç†è§£ä¸ºæ¨¡å—çš„æ„å»ºç®¡ç†å™¨ï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼ŒGradle ä¼šä¸ºæ¯ä¸ªæ¨¡å—çš„ build.gradle æ–‡ä»¶å®ä¾‹åŒ–ä¸€ä¸ªæ¥å£å¯¹è±¡ã€‚åœ¨ .gradle è„šæœ¬ä¸­ç¼–å†™çš„ä»£ç ï¼Œæœ¬è´¨ä¸Šå¯ä»¥ç†è§£ä¸ºæ˜¯åœ¨ä¸€ä¸ª Project å­ç±»ä¸­ç¼–å†™çš„ã€‚

### 4.1 Project API

Project æä¾›äº†ä¸€ç³»åˆ—æ“ä½œ Project å¯¹è±¡çš„ APIï¼š

*   **getProject()ï¼š** è¿”å›å½“å‰ Projectï¼›
*   **getParent()ï¼š** è¿”å›çˆ¶ Projectï¼Œå¦‚æœåœ¨å·¥ç¨‹ RootProject ä¸­è°ƒç”¨ï¼Œåˆ™ä¼šè¿”å› nullï¼›
*   **getRootProject()ï¼š** è¿”å›å·¥ç¨‹ RootProjectï¼›
*   **getAllprojects()ï¼š** è¿”å›ä¸€ä¸ª Project Set é›†åˆï¼ŒåŒ…å«å½“å‰ Project ä¸æ‰€æœ‰å­ Projectï¼›
*   **getSubprojects()ï¼š** è¿”å›ä¸€ä¸ª Project Set é›†åˆï¼ŒåŒ…å«æ‰€æœ‰å­ Projectï¼›
*   **project(String)ï¼š** è¿”å›æŒ‡å®š Projectï¼Œä¸å­˜åœ¨æ—¶æŠ›å‡º UnKnownProjectExceptionï¼›
*   **findProject(String)ï¼š** è¿”å›æŒ‡å®š Projectï¼Œä¸å­˜åœ¨æ—¶è¿”å› nullï¼›
*   **allprojects(Closure)ï¼š** ä¸ºå½“å‰ Project ä»¥åŠæ‰€æœ‰å­ Project å¢åŠ é…ç½®ï¼›
*   **subprojects(Closure)ï¼š** ä¸ºæ‰€æœ‰å­ Project å¢åŠ é…ç½®ã€‚

### 4.2 Project å±æ€§ API

Project æä¾›äº†ä¸€ç³»åˆ—æ“ä½œå±æ€§çš„ APIï¼Œé€šè¿‡å±æ€§ API å¯ä»¥å®ç°åœ¨ Project ä¹‹é—´å…±äº«é…ç½®å‚æ•°ï¼š

*   **hasProperty(String)ï¼š** åˆ¤æ–­æ˜¯å¦å­˜åœ¨æŒ‡å®šå±æ€§åï¼›
*   **property(Stirng)ï¼š** è·å–å±æ€§å€¼ï¼Œå¦‚æœå±æ€§ä¸å­˜åœ¨åˆ™æŠ›å‡º MissingPropertyExceptionï¼›
*   **findProperty(String)ï¼š** è·å–å±æ€§å€¼ï¼Œå¦‚æœå±æ€§ä¸å­˜åœ¨åˆ™è¿”å› nullï¼›
*   **setProperty(String, Object)ï¼š** è®¾ç½®å±æ€§å€¼ï¼Œå¦‚æœå±æ€§ä¸å­˜åœ¨åˆ™æŠ›å‡º MissingPropertyExceptionã€‚

å®é™…ä¸Šï¼Œä½ ä¸ä¸€å®šéœ€è¦æ˜¾ç¤ºè°ƒç”¨è¿™äº› APIï¼Œå½“æˆ‘ä»¬ç›´æ¥ä½¿ç”¨å±æ€§åæ—¶ï¼ŒGradle ä¼šå¸®æˆ‘ä»¬éšå¼è°ƒç”¨ property() æˆ– setProperty()ã€‚ä¾‹å¦‚ï¼š

`build.gradle`

    name => ç›¸å½“äº project.getProperty("name")
    project.name = "Peng" => ç›¸å½“äº project.setProperty("name", "Peng")
    

**4.2.1 å±æ€§åŒ¹é…ä¼˜å…ˆçº§**

Project å±æ€§çš„æ¦‚å¿µæ¯”æˆ‘ä»¬ç†è§£çš„å­—æ®µæ¦‚å¿µè¦å¤æ‚äº›ï¼Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„é”®å€¼å¯¹ã€‚Project å®šä¹‰äº† 4 ç§å‘½åç©ºé—´ï¼ˆscopesï¼‰çš„å±æ€§ â€”â€” **è‡ªæœ‰å±æ€§ã€Extension å±æ€§ã€ext å±æ€§ã€Taskã€‚** å½“æˆ‘ä»¬é€šè¿‡è®¿é—®å±æ€§æ—¶ï¼Œä¼šæŒ‰ç…§è¿™ä¸ªä¼˜å…ˆçº§é¡ºåºæœç´¢ã€‚

`getProperty()` çš„æœç´¢è¿‡ç¨‹ï¼š

*   1ã€è‡ªæœ‰å±æ€§ï¼š Project å¯¹è±¡è‡ªèº«æŒæœ‰çš„å±æ€§ï¼Œä¾‹å¦‚ rootProject å±æ€§ï¼›
*   2ã€Extension å±æ€§ï¼›
*   3ã€ext å±æ€§ï¼›
*   4ã€Taskï¼š æ·»åŠ åˆ° Project ä¸Šçš„ Task ä¹Ÿæ”¯æŒé€šè¿‡å±æ€§ API è®¿é—®ï¼›
*   5ã€çˆ¶ Project çš„ ext å±æ€§ï¼š ä¼šè¢«å­ Project ç»§æ‰¿ï¼Œå› æ­¤å½“ 1 ~ 5 æœªå‘½ä¸­æ—¶ï¼Œä¼šç»§ç»­ä»çˆ¶ Project æœç´¢ã€‚éœ€è¦æ³¨æ„ï¼š **ä»çˆ¶ Project ç»§æ‰¿çš„å±æ€§æ˜¯åªè¯»çš„ï¼›**
*   6ã€ä»¥ä¸Šæœªå‘½ä¸­ï¼ŒæŠ›å‡º MissingPropertyException æˆ–è¿”å› nullã€‚

`setProperty()` çš„æœç´¢è·¯å¾„ï¼ˆç”±äºéƒ¨åˆ†å±æ€§æ˜¯åªè¯»çš„ï¼Œæœç´¢è·¯å¾„è¾ƒçŸ­ï¼‰ï¼š

*   1ã€è‡ªæœ‰å±æ€§
*   2ã€ext é¢å¤–å±æ€§

> **æç¤ºï¼š** å…¶å®è¿˜æœ‰ Convention å‘½åç©ºé—´ï¼Œä¸è¿‡å·²ç»è¿‡æ—¶äº†ï¼Œæˆ‘ä»¬ä¸è€ƒè™‘ã€‚

**4.2.2 Extension æ‰©å±•**

Extension æ‰©å±•æ˜¯æ’ä»¶ä¸ºå¤–éƒ¨æ„å»ºè„šæœ¬æä¾›çš„é…ç½®é¡¹ï¼Œç”¨äºæ”¯æŒå¤–éƒ¨è‡ªå®šä¹‰æ’ä»¶çš„å·¥ä½œæ–¹å¼ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªå¯¹å¤–å¼€æ”¾çš„ Java Bean æˆ– Groovy Beanã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„ `android{}` å°±æ˜¯ Android Gradle Plugin æä¾›çš„æ‰©å±•ã€‚

å…³äºæ’ä»¶ Extension æ‰©å±•çš„æ›´å¤šå†…å®¹ï¼Œè§ä¸‹ä¸€ç¯‡æ–‡ç« ã€‚

**4.2.3 ext å±æ€§**

Gradle ä¸º Project å’Œ Task æä¾›äº† ext å‘½åç©ºé—´ï¼Œç”¨äºå®šä¹‰é¢å¤–å±æ€§ã€‚å¦‚å‰æ‰€è¿°ï¼Œå­ Project ä¼šç»§æ‰¿ çˆ¶ Project å®šä¹‰çš„ ext å±æ€§ï¼Œä½†æ˜¯åªè¯»çš„ã€‚æˆ‘ä»¬ç»å¸¸ä¼šåœ¨ Root Project ä¸­å®šä¹‰ ext å±æ€§ï¼Œè€Œåœ¨å­ Project ä¸­å¯ä»¥ç›´æ¥å¤ç”¨å±æ€§å€¼ï¼Œä¾‹å¦‚ï¼š

`é¡¹ç›® build.gradle`

    ext {
        kotlin_version = '1.4.31'
    }
    

`æ¨¡å— build.gradle`

    // å¦‚æœå­ Project ä¹Ÿå®šä¹‰äº† kotlin_version å±æ€§ï¼Œåˆ™ä¸ä¼šå¼•ç”¨çˆ¶ Project
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"
    

### 4.3 Project æ–‡ä»¶ API

**4.3.1 æ–‡ä»¶è·¯å¾„**

*   **getRootDir()ï¼š** Project çš„æ ¹ç›®å½•ï¼ˆä¸æ˜¯å·¥ç¨‹æ ¹ç›®å½•ï¼‰
*   **getProjectDir()ï¼š** åŒ…å« build æ–‡ä»¶å¤¹çš„é¡¹ç›®ç›®å½•
*   **getBuildDir()ï¼š** build æ–‡ä»¶å¤¹ç›®å½•

**4.3.2 æ–‡ä»¶è·å–**

*   **File file(Object path)ï¼š** è·å–å•ä¸ªæ–‡ä»¶ï¼Œç›¸å¯¹ä½ç½®ä»å½“å‰ Project ç›®å½•å¼€å§‹
*   **ConfigurableFileCollection files(Object... paths)ï¼š** è·å–å¤šä¸ªæ–‡ä»¶ï¼Œç›¸å¯¹ä½ç½®ä»å½“å‰ Project ç›®å½•å¼€å§‹

    def destFile = file('releases.xml')
    if (destFile != null && !destFile.exists()) {
        destFile.createNewFile()
    }
    

**4.3.3 æ–‡ä»¶æ‹·è´**

*   **copy(Closure)ï¼š** æ–‡ä»¶æ‹·è´ï¼Œå‚æ•°é—­åŒ…ç”¨äºé…ç½® [CodeSpec](https://docs.gradle.org/current/javadoc/org/gradle/api/file/CopySpec.html) å¯¹è±¡

    copy {
        // æ¥æºæ–‡ä»¶
        from file("build/outputs/apk")
        // ç›®æ ‡æ–‡ä»¶
        into getRootProject().getBuildDir().path + "/apk/"
        exclude {
            // æ’é™¤ä¸éœ€è¦æ‹·è´çš„æ–‡ä»¶
        }
        rename {
            // å¯¹æ‹·è´è¿‡æ¥çš„æ–‡ä»¶è¿›è¡Œé‡å‘½å
        }
    }
    

**4.3.4 æ–‡ä»¶éå†**

*   **fileTree(Object baseDir)ï¼š** å°†æŒ‡å®šç›®å½•è½¬åŒ–ä¸ºæ–‡ä»¶æ ‘ï¼Œå†è¿›è¡Œéå†æ“ä½œ

    fileTree("build/outputs/apk") { FileTree fileTree ->
        fileTree.visit { FileTreeElement fileTreeElement ->
            // æ–‡ä»¶æ“ä½œ
        }
    }
    

* * *

5\. Task æ ¸å¿ƒ API
===============

Project çš„æ„å»ºé€»è¾‘ç”±ä¸€ç³»åˆ— [Task](https://docs.gradle.org/current/dsl/org.gradle.api.Task.html) çš„ç»„æˆï¼Œæ¯ä¸ª Task è´Ÿè´£å®Œæˆä¸€ä¸ªåŸºæœ¬çš„å·¥ä½œï¼Œä¾‹å¦‚ Javac ç¼–è¯‘ Taskã€èµ„æºç¼–è¯‘ Taskã€Lint æ£€æŸ¥ Taskï¼Œç­¾å Taskç­‰ã€‚åœ¨æ„å»ºé…ç½®é˜¶æ®µï¼ŒGradle ä¼šæ ¹æ® Task çš„ä¾èµ–å…³ç³»æ„é€ ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ï¼Œä»¥ä¾¿åœ¨æ‰§è¡Œé˜¶æ®µæŒ‰ç…§ä¾èµ–å…³ç³»æ‰§è¡Œ Taskã€‚

### 5.1 åˆ›å»ºç®€å• Task

Gradle æ”¯æŒä¸¤ç§åˆ›å»ºç®€å• Task çš„è¯­æ³•ï¼š

*   **1ã€é€šè¿‡ task å…³é”®å­—ï¼š**

    // åˆ›å»ºåä¸º MyTask çš„ä»»åŠ¡
    task MyTask(group: "MyGroup") {
        // Task é…ç½®ä»£ç 
    }
    

*   **2ã€é€šè¿‡ TaskContainer æ–¹æ³•ï¼š** é€šè¿‡ Project çš„ [TaskContainer](https://docs.gradle.org/current/javadoc/org/gradle/api/tasks/TaskContainer.html) å±æ€§ï¼Œå¯ä»¥åˆ›å»º Taskï¼Œåˆ†ä¸ºçƒ­åˆ›å»ºå’Œæ‡’åˆ›å»ºï¼š
    *   **Task create(String, Closure) çƒ­åˆ›å»ºï¼š** ç«‹å³å®ä¾‹åŒ– Task å¯¹è±¡ï¼›
    *   **TaskProvider register(String, Closure) æ‡’åˆ›å»ºï¼š** æ³¨å†Œ Task æ„é€ å™¨ï¼Œä½†ä¸ä¼šå®ä¾‹åŒ–å¯¹è±¡ã€‚åˆ›å»º Task æ“ä½œä¼šå»¶è¿Ÿåˆ°è®¿é—®è¯¥ Task æ—¶ï¼Œä¾‹å¦‚é€šè¿‡ TaskProvider#get() æˆ– TaskContainer#getByName()ã€‚

    // åˆ›å»ºåä¸º MyTask çš„ä»»åŠ¡
    project.tasks.create(name: "MyTask") {
        // Task é…ç½®ä»£ç 
    }
    

### 5.2 åˆ›å»ºå¢å¼º Taskï¼ˆè‡ªå®šä¹‰ Task ç±»å‹ï¼‰

é™¤äº†ç®€å•åˆ›å»º Task çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ Task ç±»å‹ï¼ŒGradle å°†è¿™ç±» Task ç§°ä¸ºå¢å¼º Taskã€‚å¢å¼º Task çš„å¯é‡ç”¨æ€§æ›´å¥½ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æš´éœ²å±æ€§çš„æ–¹å¼æ¥å®šåˆ¶ Task çš„è¡Œä¸ºã€‚

*   **1ã€DefaultTaskï¼š** è‡ªå®šä¹‰ Task å¿…é¡»ç»§æ‰¿ DefaultTaskã€‚

    class CustomTask extends DefaultTask {
        final String message
        final int number
    }
    

*   **2ã€å¸¦å‚æ•°åˆ›å»º Taskï¼š** é™¤äº†å¯ä»¥åœ¨åˆ›å»º Task åé…ç½®å±æ€§å€¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è°ƒç”¨ TaskContainer#create() æ—¶ä¼ é€’æ„é€ å™¨å‚æ•°ã€‚ä¸ºäº†å°†å€¼ä¼ é€’ç»™ä»»åŠ¡æ„é€ å‡½æ•°ï¼Œå¿…é¡»ä½¿ç”¨ `@Inject` æ³¨è§£ä¿®é¥°æ„é€ å™¨ã€‚

    class CustomTask extends DefaultTask {
        final String message
        final int number
    
        @Inject
        CustomTask(String message, int number) {
            this.message = message
            this.number = number
        }
    }
    

    // ç¬¬äºŒä¸ªå‚æ•°ä¸º Task ç±»å‹
    tasks.register('myTask', CustomTask, 'hello', 42)
    

### 5.3 è·å–å·²åˆ›å»º Task

å¯ä»¥è·å– TaskContainer ä¸­å·²åˆ›å»ºçš„ä»»åŠ¡ï¼Œå¯¹äºé€šè¿‡ register æ³¨å†Œçš„ä»»åŠ¡ä¼šåœ¨è¿™ä¸ªæ—¶æœºå®ä¾‹åŒ–ã€‚ä¾‹å¦‚ï¼š

*   **Task getByName(String)ï¼š** è·å– Taskï¼Œå¦‚æœ Task ä¸å­˜åœ¨åˆ™æŠ›å‡º UnKnownDomainObjectExceptionï¼›
*   **Task findByName(String)ï¼š** è·å– Taskï¼Œå¦‚æœ Task ä¸å­˜åœ¨åˆ™è¿”å› nullã€‚

    // è·å–å·²åˆ›å»ºçš„ Task
    project.MyTask.name => ç­‰åŒäº project.tasks.getByName("MyTask").name
    

### 5.4 è®¾ç½® Task å±æ€§

è®¾ç½® Task å±æ€§çš„è¯­æ³•ä¸»è¦æœ‰ä¸‰ç§ï¼š

*   **1ã€åœ¨åˆ›å»º Task æ—¶è®¾ç½®**

    task MyTask(group: "MyGroup")
    

*   **2ã€é€šè¿‡ setter æ–¹æ³•è®¾ç½®**

    task MyTask {
        group = "MyGroup" => ç­‰åŒäº setGroup("MyGroup")
    }
    

*   **3ã€é€šè¿‡ ext é¢å¤–å±æ€§è®¾ç½®ï¼š** Task ä¹Ÿæ”¯æŒä¸ Project ç±»ä¼¼çš„é¢å¤–å±æ€§ã€‚ä¾‹å¦‚ï¼š

    task MyTask(group:"111") {
        ext.goods = 2
    }
    
    ext.goods = 1
    
    println MyTask.good
    
    è¾“å‡ºï¼š2
    

Task å¸¸ç”¨çš„è‡ªæœ‰å±æ€§å¦‚ä¸‹ï¼š

å±æ€§

æè¿°

name

Task æ ‡è¯†ç¬¦ï¼Œåœ¨å®šä¹‰ Task æ—¶æŒ‡å®š

group

Task æ‰€å±çš„ç»„

description

Task çš„æè¿°ä¿¡æ¯

type

Taskç±»å‹ï¼Œé»˜è®¤ä¸º DefaultTask

actions

åŠ¨ä½œåˆ—è¡¨

dependsOn

ä¾èµ–åˆ—è¡¨

**æ³¨æ„äº‹é¡¹ï¼š**

*   ä¸¥æ ¼é¿å…ä½¿ç”¨å¸¦ç©ºæ ¼çš„ Task `name`ï¼Œå¦åˆ™åœ¨ä¸€äº›ç‰ˆæœ¬çš„ Android Studio ä¸­ä¼šè¢«æˆªæ–­ï¼Œå¯¼è‡´ä¸å…¼å®¹ï¼›
*   Android Studio çš„ Gradle é¢æ¿ä¼šæŒ‰ç…§ `group` å±æ€§å¯¹ Task è¿›è¡Œåˆ†ç»„æ˜¾ç¤ºã€‚å…¶ä¸­ï¼Œ Tasks ç»„ä¸º Root Project ä¸­çš„ Taskï¼Œå…¶ä»–åˆ†ç»„ä¸ºå„ä¸ª Project ä¸­çš„ Taskï¼ŒæœªæŒ‡å®š group çš„ Task ä¼šåˆ†é…åœ¨ other ä¸­ã€‚

![file](https://img2022.cnblogs.com/other/2839502/202205/2839502-20220516112234983-248559908.png)

### 5.5 æ‰§è¡Œ Task

*   **1ã€å‘½ä»¤è¡Œï¼š** gradlew :\[æ¨¡å—å\]:\[ä»»åŠ¡å\]ï¼Œä¾‹å¦‚ï¼šgradlew -q :app:dependencies
*   **2ã€IDE å·¥å…·ï¼š** é€šè¿‡ IDE æä¾›çš„ç”¨æˆ·ç•Œé¢å·¥å…·æ‰§è¡Œï¼Œä¾‹å¦‚ Gradle é¢æ¿æˆ–ç»¿è‰²ä¸‰è§’å½¢ï¼Œæ”¯æŒæ™®é€šæ‰§è¡Œå’Œè°ƒè¯•æ‰§è¡Œï¼›
*   **3ã€é»˜è®¤ä»»åŠ¡ï¼š** é€šè¿‡ Project#defaultTasks å¯ä»¥æŒ‡å®š Project é…ç½®é˜¶æ®µçš„é»˜è®¤ä»»åŠ¡ï¼Œåœ¨é…ç½®é˜¶æ®µä¼šæ‰§è¡Œï¼ˆè¿™è¯´æ˜ Task æ˜¯æœ‰å¯èƒ½åœ¨é…ç½®é˜¶æ®µæ‰§è¡Œçš„ï¼Œäº†è§£å³å¯ï¼Œä¸ç”¨é’»ç‰›è§’å°–ï¼‰ã€‚

`build.gradle`

    defaultTasks 'hello','hello2'
    
    task hello {
        println "defaultTasks hello"
    }
    
    task hello2 {
        println "defaultTasks hello2"
    }
    
    è¾“å‡ºï¼š
    > Configure project :easyupload
    defaultTasks hello
    defaultTasks hello2
    --afterEvaluate--
    --taskGraph.whenReady--
    

### 5.6 Task Action åŠ¨ä½œ

æ¯ä¸ª Task å†…éƒ¨éƒ½ä¿æŒäº†ä¸€ä¸ª Action åˆ—è¡¨ `actions`ï¼Œæ‰§è¡Œ Task å°±æ˜¯æŒ‰é¡ºåºæ‰§è¡Œè¿™ä¸ªåˆ—è¡¨ï¼ŒAction æ˜¯æ¯” Task æ›´ç»†çš„ä»£ç å•å…ƒã€‚Task æ”¯æŒæ·»åŠ å¤šä¸ªåŠ¨ä½œï¼ŒTask æä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥æ·»åŠ  Actionï¼š

*   **doFirst(Closure)ï¼š** åœ¨ Action åˆ—è¡¨å¤´éƒ¨æ·»åŠ ä¸€ä¸ª Actionï¼›
*   **doLast(Closure)ï¼š** åœ¨ Action åˆ—è¡¨å°¾éƒ¨æ·»åŠ ä¸€ä¸ª Actionã€‚

    task MyTask
    
    MyTask.doFirst{
        println "Action doFirst 1"
    }
    
    MyTask.doFirst{
        println "Action doFirst 2"
    }
    
    MyTask.doLast{
        println "Action doLast 1"
    }
    
    æ‰§è¡Œ MyTask è¾“å‡º:
    
    Action doFirst 2
    Action doFirst 1
    Action doLast 1
    

å¯¹äºè‡ªå®šä¹‰ Taskï¼Œè¿˜å¯ä»¥é€šè¿‡ `@TaskAction` æ³¨è§£æ·»åŠ é»˜è®¤ Actionã€‚ä¾‹å¦‚ï¼š

    abstract class CustomTask extends DefaultTask {
        @TaskAction
        def greet() {
            println 'hello from GreetingTask'
        }
    }
    

### 5.7 è·³è¿‡ Task çš„æ‰§è¡Œ

å¹¶ä¸æ˜¯æ‰€æœ‰ Task éƒ½ä¼šè¢«æ‰§è¡Œï¼ŒGradle æä¾›äº†å¤šä¸ªæ–¹æ³•æ¥æ§åˆ¶è·³è¿‡ Task çš„æ‰§è¡Œï¼š

*   **1ã€onlyIf{}ï¼š** é—­åŒ…ä¼šåœ¨å³å°†æ‰§è¡Œ Task ä¹‹å‰æ‰§è¡Œï¼Œé—­åŒ…è¿”å›å€¼å†³å®šäº†æ˜¯å¦æ‰§è¡Œ Taskï¼›
*   **2ã€enabled å±æ€§ï¼š** Task çš„ enabled å±æ€§é»˜è®¤ä¸º trueï¼Œè®¾ç½®ä¸º false è¡¨ç¤ºæ— æ•ˆä»»åŠ¡ï¼Œä¸éœ€è¦æ‰§è¡Œã€‚

å‰©ä¸‹ä¸¤ç§æ–¹å¼å…è®¸åœ¨æ‰§è¡Œ Task çš„è¿‡ç¨‹ä¸­ä¸­æ–­æ‰§è¡Œï¼š

*   **3ã€Task å¼‚å¸¸ï¼š** Task æä¾›äº†ä¸¤ä¸ªå¼‚å¸¸ï¼Œèƒ½å¤Ÿå½“ Action æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼Œå°†è·³è¿‡æ‰§è¡Œå¹¶ç»§ç»­åç»­çš„æ„å»ºè¿‡ç¨‹ï¼š
    *   **[StopActionException](https://docs.gradle.org/current/javadoc/org/gradle/api/tasks/StopActionException.html)ï¼š** ä¸­æ–­å½“å‰ Actionï¼Œå¹¶ç»§ç»­å½“å‰ Task çš„ä¸‹ä¸€ä¸ª Actionï¼›
    *   **[StopExecutionException](https://docs.gradle.org/current/javadoc/org/gradle/api/tasks/StopExecutionException.html)ï¼š** ä¸­æ–­å½“å‰ Taskï¼Œå¹¶ç»§ç»­ Task ä¾èµ–æ ‘ä¸Šçš„ä¸‹ä¸€ä¸ª Actionã€‚
*   **4ã€timeouts å±æ€§ï¼š** å½“ Task æ‰§è¡Œæ—¶é—´åˆ°è¾¾ timeouts è¶…æ—¶æ—¶é—´æ—¶ï¼Œæ‰§è¡Œçº¿ç¨‹ä¼šæ”¶åˆ°ä¸€ä¸ªä¸­æ–­ä¿¡å·ï¼Œå¯ä»¥å€Ÿæ­¤è®¸æ§åˆ¶ Task çš„æ‰§è¡Œæ—¶é—´ï¼ˆå‰ææ˜¯ Task è¦å“åº”ä¸­æ–­ä¿¡å·ï¼‰ã€‚

### 5.8 Task ä¾èµ–å…³ç³»

é€šè¿‡å»ºç«‹ Task çš„ä¾èµ–å…³ç³»å¯ä»¥æ„å»ºå®Œæˆçš„ Task æœ‰å‘æ— ç¯å›¾ï¼š

*   **dependsOn å¼ºä¾èµ–ï¼š** Task é€šè¿‡ dependsOn å±æ€§å»ºç«‹å¼ºä¾èµ–å…³ç³»ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ dependsOn å±æ€§è®¾ç½®ä¾èµ–åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ dependsOn() æ–¹æ³•æ·»åŠ ä¸€ä¸ªä¾èµ–ï¼›
*   **è¾“å…¥è¾“å‡ºéšå¼ä¾èµ–ï¼š** é€šè¿‡å»ºç«‹ Task ä¹‹é—´çš„è¾“å…¥å’Œè¾“å‡ºå…³ç³»ï¼Œä¹Ÿä¼šéšå¼å»ºç«‹ä¾èµ–å…³ç³»ã€‚ä¾‹å¦‚ Transform Task ä¹‹é—´å°±æ˜¯é€šè¿‡è¾“å…¥è¾“å‡ºå»ºç«‹çš„ä¾èµ–å…³ç³»ã€‚

    
    // é€šè¿‡å±æ€§è®¾ç½®ä¾èµ–åˆ—è¡¨
    task task3(dependsOn: [task1, task2]) {
    }
    
    // æ·»åŠ ä¾èµ–
    task3.dependsOn(task1, task2)
    
    ä¾èµ–å…³ç³»ï¼štask3 ä¾èµ–äº [task1, task2]ï¼Œåœ¨æ‰§è¡Œ task3 å‰ä¸€å®šä¼šæ‰§è¡Œ task1 å’Œ task2
    

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ§åˆ¶ä¸¤ä¸ªä»»åŠ¡çš„æ‰§è¡Œé¡ºåºéå¸¸æœ‰ç”¨ï¼Œè€Œä¸ä¼šåœ¨è¿™äº›ä»»åŠ¡ä¹‹é—´å¼•å…¥æ˜¾å¼ä¾èµ–å…³ç³»ï¼Œå¯ä»¥ç†è§£ä¸ºå¼±ä¾èµ–ã€‚ **ä»»åŠ¡æ’åºå’Œä»»åŠ¡ä¾èµ–å…³ç³»ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œæ’åºè§„åˆ™ä¸å½±å“å°†æ‰§è¡Œå“ªäº›ä»»åŠ¡ï¼Œåªå½±å“ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºã€‚**

*   **mustRunAfter å¼ºåˆ¶é¡ºåºï¼š** æŒ‡å®šå¼ºåˆ¶è¦æ±‚çš„ä»»åŠ¡æ‰§è¡Œé¡ºåºï¼›
*   **shouldRunAfter éå¼ºåˆ¶é¡ºåºï¼š** æŒ‡å®šéå¼ºåˆ¶çš„ä»»åŠ¡æ‰§è¡Œé¡ºåºï¼Œåœ¨ä¸¤ç§æƒ…å†µä¸‹ä¼šæ”¾å¼ƒæ­¤è§„åˆ™ï¼š1ã€è¯¥è§„åˆ™é€ æˆç¯å½¢é¡ºåºï¼›2ã€å¹¶è¡Œæ‰§è¡Œå¹¶ä¸”ä»»åŠ¡çš„æ‰€æœ‰ä¾èµ–é¡¹éƒ½å·²ç»å®Œæˆã€‚

    task3 mustRunAfter(task1, task2)
    task3 shouldRunAfter(task1, task2)
    
    ä¾èµ–å…³ç³»ï¼šæ— ï¼Œåœ¨æ‰§è¡Œ task3 å‰ä¸ä¸€å®šä¼šæ‰§è¡Œ task1 å’Œ task2
    é¡ºåºå…³ç³»ï¼š[task1, task2] ä¼˜å…ˆäº task3
    

### 5.9 Finalizer Task

ç»™ä¸€ä¸ª Task æ·»åŠ  Finalizer ç»ˆç»“å™¨ä»»åŠ¡åï¼Œæ— è®º Task æ‰§è¡ŒæˆåŠŸè¿˜æ˜¯æ‰§è¡Œå¤±è´¥ï¼Œéƒ½ä¼šæ‰§è¡Œç»ˆç»“å™¨ï¼Œè¿™å¯¹äºéœ€è¦åœ¨ Task æ‰§è¡Œå®Œæ¯•åæ¸…ç†èµ„æºçš„æƒ…å†µéå¸¸æœ‰ç”¨ã€‚

    // taskY æ˜¯ taskX çš„ç»ˆç»“å™¨
    taskX finalizedBy taskY
    

* * *

6\. å¢é‡æ„å»º
========

### 6.1 ä»€ä¹ˆæ˜¯å¢é‡æ„å»ºï¼Ÿ

ä»»ä½•æ„å»ºå·¥å…·éƒ½ä¼šå°½é‡é¿å…é‡å¤æ‰§è¡Œç›¸åŒå·¥ä½œï¼Œè¿™ä¸€ç‰¹æ€§ç§°ä¸º Incremental Build å¢é‡æ„å»ºï¼Œè¿™ä¸€ç‰¹æ€§èƒ½å¤ŸèŠ‚çœå¤§é‡æ„å»ºæ—¶é—´ã€‚ä¾‹å¦‚ç¼–è¯‘è¿‡æºæ–‡ä»¶åå°±ä¸åº”è¯¥é‡å¤ç¼–è¯‘ï¼Œé™¤éå‘ç”Ÿäº†å½±å“è¾“å‡ºçš„æ›´æ”¹ï¼ˆä¾‹å¦‚ä¿®æ”¹æˆ–åˆ é™¤æºæ–‡ä»¶ï¼‰ã€‚

Gradle é€šè¿‡å¯¹æ¯”è‡ªä»ä¸Šä¸€æ¬¡æ„å»ºä¹‹åï¼ŒTask çš„ `inputs` å’Œ `outputs` æ˜¯å¦å˜åŒ–ï¼Œæ¥å†³å®šæ˜¯å¦è·³è¿‡æ‰§è¡Œã€‚å¦‚æœç›¸åŒï¼Œåˆ™ Gralde è®¤ä¸º Task æ˜¯æœ€æ–°çš„ï¼Œä»è€Œä¼šè·³è¿‡æ‰§è¡Œã€‚åœ¨ Build Outputs ä¸­çœ‹åˆ° Task åç§°æ—è¾¹å‡ºç° `UP-TO-DATE` æ ‡å¿—ï¼Œå³è¯´æ˜è¯¥ Task æ˜¯è¢«è·³è¿‡çš„ã€‚ä¾‹å¦‚ï¼š

    > Task :easyupload:compileJava NO-SOURCE
    > Task :easyupload:compileGroovy UP-TO-DATE
    > Task :easyupload:pluginDescriptors UP-TO-DATE
    > Task :easyupload:processResources UP-TO-DATE
    > Task :easyupload:classes UP-TO-DATE
    > Task :easyupload:jar UP-TO-DATE
    > Task :easyupload:uploadArchives
    

é‚£ä¹ˆï¼Œåœ¨å®šä¹‰ Task çš„è¾“å…¥è¾“å‡ºæ—¶ï¼Œè¦éµå¾ªä¸€ä¸ªåŸåˆ™ï¼šå¦‚æœ Task çš„ä¸€ä¸ªå±æ€§ä¼šå½±å“è¾“å‡ºï¼Œé‚£ä¹ˆåº”è¯¥å°†è¯¥å±æ€§æ³¨å†Œä¸ºè¾“å…¥ï¼Œå¦åˆ™ä¼šå½±å“ Task æ‰§è¡Œï¼›ç›¸åï¼Œå¦‚æœ Task çš„ä¸€ä¸ªå±æ€§ä¸ä¼šå½±å“è¾“å‡ºï¼Œé‚£ä¹ˆä¸åº”è¯¥å°†è¯¥å±æ€§æ³¨å†Œä¸ºè¾“å…¥ï¼Œå¦åˆ™ Task ä¼šåœ¨ä¸å¿…è¦æ—¶æ‰§è¡Œã€‚

### 6.2 Task è¾“å…¥è¾“å‡º

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒTask éœ€è¦æ¥æ”¶ä¸€äº› input è¾“å…¥ï¼Œå¹¶ç”Ÿæˆä¸€äº› output è¾“å‡ºã€‚ä¾‹å¦‚ç¼–è¯‘ä»»åŠ¡ï¼Œè¾“å…¥æ˜¯æºæ–‡ä»¶ï¼Œè€Œè¾“å‡ºæ˜¯ Class æ–‡ä»¶ã€‚Task ä½¿ç”¨ [TaskInputs](https://docs.gradle.org/current/javadoc/org/gradle/api/tasks/TaskInputs.html) å’Œ [TaskOutputs](https://docs.gradle.org/current/javadoc/org/gradle/api/tasks/TaskOutputs.html) ç®¡ç†è¾“å…¥è¾“å‡ºï¼š

*   **Task#inputsï¼š** è¿”å› Task çš„ TaskInputs è¾“å…¥ç®¡ç†å™¨ï¼›
*   **Task#outputsï¼š** è¿”å› Task çš„ TaskOutputs è¾“å‡ºç®¡ç†å™¨ã€‚

![file](https://img2022.cnblogs.com/other/2839502/202205/2839502-20220516112235330-1029162725.png)

å¯¹äº Task çš„è¾“å…¥è¾“å‡ºï¼Œæˆ‘ä»¬ç”¨é¢å‘å¯¹è±¡çš„æ¦‚å¿µå»ç†è§£æ˜¯æ²¡é—®é¢˜çš„ã€‚å¦‚æœæˆ‘ä»¬æŠŠ Task ç†è§£ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œåˆ™ Task çš„è¾“å…¥å°±æ˜¯å‡½æ•°çš„å‚æ•°ï¼Œè€Œ Task çš„è¾“å‡ºå°±æ˜¯å‡½æ•°çš„è¿”å›å€¼ã€‚åœ¨æ­¤ç†è§£çš„åŸºç¡€ä¸Šï¼Œå†è®°ä½ 2 ä¸ªå…³é”®ç‚¹ï¼š

*   **1ã€éšå¼ä¾èµ–ï¼š** å¦‚æœä¸€ä¸ª Task çš„è¾“å…¥æ˜¯å¦ä¸€ä¸ª Task çš„è¾“å‡ºï¼ŒGradle ä¼šæ¨æ–­å‡ºä¸¤è€…ä¹‹é—´çš„å¼ºä¾èµ–å…³ç³»ï¼›
*   **2ã€åœ¨é…ç½®é˜¶æ®µå£°æ˜ï¼š** ç”±äº Task çš„è¾“å…¥è¾“å‡ºä¼šç”¨äºæ„å»ºä¾èµ–å…³ç³»ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥ç¡®ä¿åœ¨é…ç½®é˜¶æ®µå®šä¹‰è¾“å…¥è¾“å‡ºï¼Œè€Œä¸æ˜¯åœ¨æ‰§è¡Œé˜¶æ®µå®šä¹‰ã€‚

**Task æ”¯æŒä¸‰ç§å½¢å¼çš„è¾“å…¥ï¼š**

*   **1ã€ç®€å•å€¼ï¼š** åŒ…æ‹¬æ•°å€¼ã€å­—ç¬¦ä¸²å’Œä»»ä½•å®ç° Serializable çš„ç±»ï¼›
*   **2ã€æ–‡ä»¶ï¼š** åŒ…æ‹¬å•ä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶ç›®å½•ï¼›
*   **3ã€åµŒå¥—å¯¹è±¡ï¼š** ä¸æ»¡è¶³ä»¥ä¸Šä¸¤ç§æ¡ä»¶ï¼Œä½†å…¶å­—æ®µå£°æ˜ä¸ºè¾“å…¥ã€‚

    public abstract class ProcessTemplates extends DefaultTask {
    
        @Input
        public abstract Property<TemplateEngineType> getTemplateEngine();
    
        @InputFiles
        public abstract ConfigurableFileCollection getSourceFiles();
    
        @Nested
        public abstract TemplateData getTemplateData();
    
        @OutputDirectory
        public abstract DirectoryProperty getOutputDir();
    
        @TaskAction
        public void processTemplates() {
            // ...
        }
    }
    
    public abstract class TemplateData {
    
        @Input
        public abstract Property<String> getName();
    
        @Input
        public abstract MapProperty<String, String> getVariables();
    }
    

### 6.3 Task è¾“å…¥è¾“å‡ºæ ¡éªŒ

é€šè¿‡æ³¨è§£æ–¹å¼æ³¨å†Œè¾“å…¥è¾“å‡ºæ—¶ï¼ŒGradle ä¼šåœ¨é…ç½®é˜¶æ®µä¼šå¯¹å±æ€§å€¼è¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœå±æ€§å€¼ä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™ Gradle ä¼šæŠ›å‡º `TaskValidationException` å¼‚å¸¸ã€‚ç‰¹æ®Šæƒ…å†µæ—¶ï¼Œå¦‚æœå…è®¸è¾“å…¥ä¸º null å€¼ï¼Œå¯ä»¥æ·»åŠ  `@Optional` æ³¨è§£è¡¨ç¤ºè¾“å…¥å¯ç©ºã€‚

*   **@InputFileï¼š** éªŒè¯è¯¥å±æ€§å€¼ä¸ä¸º nullï¼Œå¹¶ä¸”å…³è”ä¸€ä¸ªæ–‡ä»¶ï¼ˆè€Œä¸æ˜¯æ–‡ä»¶å¤¹ï¼‰ï¼Œä¸”è¯¥æ–‡ä»¶å­˜åœ¨ï¼›
*   **@InputDirectoryï¼š** éªŒè¯è¯¥å±æ€§å€¼ä¸ä¸º nullï¼Œå¹¶ä¸”å…³è”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆè€Œä¸æ˜¯æ–‡ä»¶ï¼‰ï¼Œä¸”è¯¥æ–‡ä»¶å¤¹å­˜åœ¨ï¼›
*   **@OutputDirectoryï¼š** éªŒè¯è¯¥å±æ€§å€¼ä¸ä¸º nullï¼Œå¹¶ä¸”å…³è”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆè€Œä¸æ˜¯æ–‡ä»¶ï¼‰ï¼Œå½“è¯¥æ–‡ä»¶å¤¹ä¸å­˜åœ¨æ—¶ä¼šåˆ›å»ºè¯¥æ–‡ä»¶å¤¹ã€‚

* * *

7\. æ€»ç»“
======

åˆ°è¿™é‡Œï¼ŒGradle åŸºç¡€çš„éƒ¨åˆ†å°±è®²å®Œäº†ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« æˆ‘ä»¬æ¥è®¨è®º Gradle æ’ä»¶ã€‚æä¸ªé—®é¢˜ï¼Œä½ çŸ¥é“ Gradle æ’ä»¶å’Œ .gradle æ–‡ä»¶æœ‰åŒºåˆ«å—ï¼Ÿå…³æ³¨æˆ‘ï¼Œå¸¦ä½ äº†è§£æ›´å¤šã€‚

* * *

#### å‚è€ƒèµ„æ–™

*   ã€Šå®æˆ˜ Gradleã€‹â€”â€” \[ç¾\] Benjamin Muschko è‘—ï¼Œæå»º æœ±æœ¬å¨ æ¨æŸ³ è¯‘
*   ã€ŠGradle for Androidã€‹â€”â€” Kevin Pelgrims è‘—ï¼Œä½™å°ä¹ è¯‘
*   [Groovy å‚è€ƒæ–‡æ¡£](http://groovy-lang.org/documentation.html) â€”â€” Groovy å®˜æ–¹æ–‡æ¡£
*   [Gradle è¯´æ˜æ–‡æ¡£](https://docs.gradle.org/current/userguide/build_lifecycle.html) â€”â€” Gradle å®˜æ–¹æ–‡æ¡£
*   [Gradle DSL å‚è€ƒæ–‡æ¡£](https://docs.gradle.org/current/dsl/index.html) â€”â€” Gradle å®˜æ–¹æ–‡æ¡£
*   [æ·±å…¥æ¢ç´¢ Gradle è‡ªåŠ¨åŒ–æ„å»ºæŠ€æœ¯ï¼ˆç³»åˆ—ï¼‰](https://juejin.cn/post/6844904122492125198) â€”â€” jsonchao è‘—