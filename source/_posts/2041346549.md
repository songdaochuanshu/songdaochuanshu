---
layout: post
title: "MOS管实现的STC自动下载电路"
date: "2022-05-29T09:19:04.188Z"
---
MOS管实现的STC自动下载电路
----------------

![MOS管实现的STC自动下载电路](https://img2022.cnblogs.com/blog/650273/202205/650273-20220529151600986-1693629849.png) STC MCU在烧录时, 需要断电重置后才能进入烧录状态, 通常是用手按开关比较繁琐. 如果利用STC-ISP在烧录开始时会拉低RTS的特性, 可以实现烧录开始时自动断电复位. 下面的电路适用于烧录下载STC MCU.

目录
==

*   [MOSFET, MOS管基础和电路](https://www.cnblogs.com/milton/p/16272596.html)
*   [MOS管实现的STC自动下载电路](https://www.cnblogs.com/milton/p/16323894.html)

三极管配合 PMOS 管控制电路开关
==================

STC MCU在烧录时, 需要断电重置后才能进入烧录状态, 通常是用手按开关比较繁琐. 如果利用STC-ISP在烧录开始时会拉低RTS的特性, 可以实现烧录开始时自动断电复位.

电路仿真测试
======

下面的电路适用于烧录下载STC MCU. 使用LTspice模拟. V2 为方波, 电压\[0, 3.3V\], 宽度1.5s  
![](https://img2022.cnblogs.com/blog/650273/202205/650273-20220516192810849-105187632.png)

以下为模拟输出, 绿色为三极管基极电压, 红色为MOS管栅极(Gate)电压, 蓝色为负载(R1)两端电压.  
![](https://img2022.cnblogs.com/blog/650273/202205/650273-20220516192818726-2072441118.png)

对电路中元件的说明:

*   V2: 用于模拟开关的通断, MCU的高低电平
*   C1: 这个电容用于短时拉低三极管基极电压, 关闭三极管. C1值取值在1uF - 4.7uF之间, 值越小输出的截止时间越短, 值越大截止时间越长
*   C2: 是为了压制方波上行时造成的高电平毛刺, 不能太大, 取值 0.5uF - 1uF 即可
*   R4: 延长C1的充放电时间, 不能太小, 太小的话方波上升沿对C1叠加的电压太高会造成输出截止, 也不能太大, 太大的话输出截止时间太短, 最后可能就完全没有截止动作, 取值在 3K - 8K 之间
*   R3: 为了给三极管基极提供电压使其导通
*   R2和R6: 用于三极管限流和分压, 如果V1和V2没有压差, R6可以不要. 但是当V2小于V1时, 需要用R6将三极管的基极电压往上抬一点, 否则V2的下降沿会产生比较高的负电压.
*   R1: 模拟负载

电路的工作原理:

*   稳定工作时, 因为C1等价于断路, 所以三极管的基极电压为正, 三极管导通, 电流在R2和R6之间产生的分压, 使得PMOS管栅极电压差不多是1/2的V1, 因为栅极(Gate)电压低于源极(Source), PMOS管导通
*   当V2跳变为0V(可以等价为短路, 合上开关等), 电压突变时, C1视为通路, 立刻拉低三极管基极电压, 此时三极管断开, PMOS管栅极电压拉高到VCC, 因为与源极电压相等, PMOS管关闭
*   C1通过R3和R4充电后, 进入新的稳态, 等价于断路, 三极管的基极电压恢复为正, 三极管重新导通, R2和R6的分压再次拉低PMOS管栅极电压, PMOS管再次导通
*   当V2再次跳变回3.3V, 电压突变时, C1视为通路, 正电压叠加到C1上在三极管基极产生高于V2的电压(模拟中如果R3, R4较小, 可能会高出V1, 高出V1会导致PMOS管截止, 这种情况要避免), 只要三极管基极电压不高于V1, PMOS会继续保持导通

电路中V2可以换成一个微动开关, 或者用RTS控制, 实现在通讯前拉低RTS重启MCU.

电路原型测试
======

使用面包板对上面的电路进行测试

*   MOS管使用SI2301, SOT23封装, 用一个SOT89的转接板凑合应付
*   三极管使用SS8050
*   因为没有2.2uF的电容, 暂时用一个4.7uF的电容代替
*   负载用两颗LED方便演示
*   用杜邦线手工切换高低电平

![](https://img2022.cnblogs.com/blog/650273/202205/650273-20220522083511791-596758560.jpg)

测试的情况:

*   因为2.2uF换成了4.75uF导致反向的电动势增大, 所以在输入端高低电平为\[0, 3.3V\]时工作正常, 但是在\[0, 5V\], 从低电平跳到高电平时LED有一个明显的闪烁, 反向的毛刺太高导致了MOS管出现通断变化. 将R2减小为5K, 拉低栅极电压基准, 这样在\[0, 3.3V\]和\[0, 5V\]都工作正常了.
*   同样电路, 仅替换SS8050为S9013, 运行结果一样.

测试视频: [https://www.bilibili.com/video/BV19Y411F7CX](https://www.bilibili.com/video/BV19Y411F7CX)

最终电路和实物
=======

电路图
---

![](https://img2022.cnblogs.com/blog/650273/202205/650273-20220529145528378-1674628352.png)

为兼容无RTS环境的烧录, 增加了一个开关

### 支持RTS的环境

接线 V->V, G->G, T->T, R->R, RTS->RTS, 由软件触发RTS拉低断电

### 不支持RTS的环境

接线 V->V, G->G, T->T, R->R, RTS短接(图中的2和3), 按下轻触开关可以触发RTS拉低断电

实物
--

### 背面

SS8050和SI2301都是SOT23封装, 非常小, 直接贴在背面. 有两个电阻因为要穿过其它元件, 为节省位置也放在背面. 在测试正常后, 这一面就用热熔胶封上了.

![](https://img2022.cnblogs.com/blog/650273/202205/650273-20220529150021517-953844124.jpg)  
  

### 正面

灯是从键盘上换下来的, 不是常用色. 分别对VCC和GND增加了4个排针, 方便平时使用.

![](https://img2022.cnblogs.com/blog/650273/202205/650273-20220529150029586-727814645.jpg)  
  

### 连线

![](https://img2022.cnblogs.com/blog/650273/202205/650273-20220529150036634-2039625420.jpg)

视频演示
----

视频中使用STC-ISP执行了三次Check, 可以看到有三次断电的过程  
[https://www.bilibili.com/video/BV1nr4y1x7Uq](https://www.bilibili.com/video/BV1nr4y1x7Uq)

最后
==

对于几十到几百毫秒的断电, 用三极管配合MOS管比较简单, 如果需要一秒以上的断电, 可以考虑将前面部分换成NE555.

posted on 2022-05-29 15:16  [Milton](https://www.cnblogs.com/milton/)  阅读(10)  评论(0)  [编辑](https://i.cnblogs.com/EditPosts.aspx?postid=16323894)  [收藏](javascript:void(0))  [举报](javascript:void(0))