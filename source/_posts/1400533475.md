---
layout: post
title: "æƒ³æ—©ç‚¹ä¸‹ç­ï¼Ÿè¯•è¯•Aormåº“å§ï¼Œæ›´æ–¹ä¾¿çš„è¿›è¡ŒGoæ•°æ®åº“æ“ä½œ"
date: "2022-12-09T07:14:48.575Z"
---
æƒ³æ—©ç‚¹ä¸‹ç­ï¼Ÿè¯•è¯•Aormåº“å§ï¼Œæ›´æ–¹ä¾¿çš„è¿›è¡ŒGoæ•°æ®åº“æ“ä½œ
============================

ä½¿ç”¨goè¿›è¡Œé¡¹ç›®å¼€å‘ï¼Œå¤§å¤šæ•°äººä¼šä½¿ç”¨gormï¼Œä½†æ˜¯gormæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæˆ‘æ— æ³•æ¥å—ã€‚äºæ˜¯å¼€å‘å‡ºäº†aormï¼Œç›®å‰èƒ½æœ‰æ»¡è¶³æ—¥å¸¸å¼€å‘éœ€æ±‚ï¼Œå¹¶ä¸”å®Œå–„äº†ä½¿ç”¨æ–‡æ¡£ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©åˆ°å¤§å®¶ã€‚

ä½¿ç”¨goè¿›è¡Œé¡¹ç›®å¼€å‘ï¼Œå¤§å¤šæ•°äººä¼šä½¿ç”¨gormï¼Œä½†æ˜¯gormæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæˆ‘æ— æ³•æ¥å—ã€‚äºæ˜¯å¼€å‘å‡ºäº†aormï¼Œç›®å‰èƒ½æœ‰æ»¡è¶³æ—¥å¸¸å¼€å‘éœ€æ±‚ï¼Œå¹¶ä¸”å®Œå–„äº†ä½¿ç”¨æ–‡æ¡£ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©åˆ°å¤§å®¶ã€‚

Aorm
====

Golangæ“ä½œæ•°æ®åº“å¦‚æ­¤ç®€å•

ç»™ä¸ª â­ å§ï¼Œå¦‚æœè¿™ä¸ªé¡¹ç›®å¸®åŠ©åˆ°ä½ 

ğŸŒŸ ç‰¹æ€§
-----

*    ä»£ç ç®€æ´ï¼Œé«˜æ€§èƒ½
*    æ”¯æŒ MySQL æ•°æ®åº“
*    æ”¯æŒ ç©ºå€¼æŸ¥è¯¢
*    æ”¯æŒ è‡ªåŠ¨è¿ç§»
*    æ”¯æŒ SQL æ‹¼æ¥
*    æ”¯æŒ å…¶ä»–æ•°æ®åº“, ä¾‹å¦‚ MSSQL

ğŸŒŸ å¦‚ä½•ä½¿ç”¨
-------

*   [å¯¼å…¥](#%E5%AF%BC%E5%85%A5)
*   [å®šä¹‰æ•°æ®ç»“æ„](#%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84)
*   [è¿æ¥æ•°æ®åº“](#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93)
*   [è‡ªåŠ¨è¿ç§»](#%E8%87%AA%E5%8A%A8%E8%BF%81%E7%A7%BB)
*   [åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥](#%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5)
    *   [å¢åŠ ä¸€æ¡è®°å½•](#%E5%A2%9E%E5%8A%A0%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95)
    *   [è·å–ä¸€æ¡è®°å½•](#%E8%8E%B7%E5%8F%96%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95)
    *   [è·å–å¤šæ¡è®°å½•](#%E8%8E%B7%E5%8F%96%E5%A4%9A%E6%9D%A1%E8%AE%B0%E5%BD%95)
    *   [æ›´æ–°è®°å½•](#%E6%9B%B4%E6%96%B0%E8%AE%B0%E5%BD%95)
    *   [åˆ é™¤è®°å½•](#%E5%88%A0%E9%99%A4%E8%AE%B0%E5%BD%95)
*   [é«˜çº§æŸ¥è¯¢](#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2)
    *   [æŸ¥è¯¢æŒ‡å®šè¡¨](#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E8%A1%A8)
    *   [æŸ¥è¯¢æŒ‡å®šå­—æ®µ](#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5)
    *   [æŸ¥è¯¢æ¡ä»¶](#%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6)
    *   [æŸ¥è¯¢æ¡ä»¶ç›¸å…³æ“ä½œ](#%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C)
    *   [è”åˆæŸ¥è¯¢](#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2)
    *   [åˆ†ç»„æŸ¥è¯¢](#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2)
    *   [ç­›é€‰](#%E7%AD%9B%E9%80%89)
    *   [æ’åº](#%E6%8E%92%E5%BA%8F)
    *   [åˆ†é¡µæŸ¥è¯¢](#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2)
    *   [æ‚²è§‚é”](#%E6%82%B2%E8%A7%82%E9%94%81)
    *   [è‡ªå¢æ“ä½œ](#%E8%87%AA%E5%A2%9E%E6%93%8D%E4%BD%9C)
    *   [è‡ªå‡æ“ä½œ](#%E8%87%AA%E5%87%8F%E6%93%8D%E4%BD%9C)
    *   [æŸ¥è¯¢æŸå­—æ®µçš„å€¼(å­—ç¬¦ä¸²)](#%E6%9F%A5%E8%AF%A2%E6%9F%90%E5%AD%97%E6%AE%B5%E7%9A%84%E5%80%BC(%E5%AD%97%E7%AC%A6%E4%B8%B2))
    *   [æŸ¥è¯¢æŸå­—æ®µçš„å€¼(Int64)](#%E6%9F%A5%E8%AF%A2%E6%9F%90%E5%AD%97%E6%AE%B5%E7%9A%84%E5%80%BC(Int64))
    *   [æŸ¥è¯¢æŸå­—æ®µçš„å€¼(Float32)](#%E6%9F%A5%E8%AF%A2%E6%9F%90%E5%AD%97%E6%AE%B5%E7%9A%84%E5%80%BC(Float32))
    *   [æŸ¥è¯¢æŸå­—æ®µçš„å€¼(Float64)](#%E6%9F%A5%E8%AF%A2%E6%9F%90%E5%AD%97%E6%AE%B5%E7%9A%84%E5%80%BC(Float64))
*   [èšåˆæŸ¥è¯¢](#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2)
    *   [Count](#count)
    *   [Sum](#sum)
    *   [AVG](#avg)
    *   [Min](#min)
    *   [Max](#max)
*   [é€šç”¨æ“ä½œ](#%E9%80%9A%E7%94%A8%E6%93%8D%E4%BD%9C)
    *   [Query](#query)
    *   [Exec](#exec)
*   [äº‹åŠ¡æ“ä½œ](#%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C)
*   [æ¸…ç©ºè¡¨æ•°æ®](#%E6%B8%85%E7%A9%BA%E8%A1%A8%E6%95%B0%E6%8D%AE)
*   [å·¥å…·ç±»](#%E5%B7%A5%E5%85%B7%E7%B1%BB)

### å¯¼å…¥

        import (
            "database/sql"
            _ "github.com/go-sql-driver/mysql" 
            "github.com/tangpanqing/aorm"
        )
    

`database/sql` æ˜¯golangçš„æ ‡å‡†åº“ï¼Œæä¾›äº†æ“ä½œæ•°æ®åº“çš„æ¥å£  
`github.com/go-sql-driver/mysql` æ“ä½œmysqlæ•°æ®åº“çš„é©±åŠ¨  
`github.com/tangpanqing/aorm` å¯¹sqlçš„æ“ä½œè¿›è¡ŒåŒ…è£…ï¼Œä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿

ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸‹è½½å’Œä½¿ç”¨ä»–ä»¬

        go get -u github.com/go-sql-driver/mysql
    

        go get -u github.com/tangpanqing/aorm
    

### å®šä¹‰æ•°æ®ç»“æ„

        type Person struct {
            Id         aorm.Int    `aorm:"primary;auto_increment" json:"id"`
            Name       aorm.String `aorm:"size:100;not null;comment:åå­—" json:"name"`
            Sex        aorm.Bool   `aorm:"index;comment:æ€§åˆ«" json:"sex"`
            Age        aorm.Int    `aorm:"index;comment:å¹´é¾„" json:"age"`
            Type       aorm.Int    `aorm:"index;comment:ç±»å‹" json:"type"`
            CreateTime aorm.Time   `aorm:"comment:åˆ›å»ºæ—¶é—´" json:"createTime"`
            Money      aorm.Float  `aorm:"comment:é‡‘é¢" json:"money"`
            Test       aorm.Float  `aorm:"type:double;comment:æµ‹è¯•" json:"test"`
        }
    

### è¿æ¥æ•°æ®åº“

        //connect
        db, err := sql.Open("mysql", "root:root@tcp(localhost:3306)/database_name?charset=utf8mb4&parseTime=True&loc=Local")
        if err != nil {
            panic(err)
        }
        defer db.Close()
        
        //ping test
        err1 := db.Ping()
        if err1 != nil {
            panic(err1)
        }
    

### è‡ªåŠ¨è¿ç§»

ä½¿ç”¨ `AutoMigrate` æ–¹æ³•, è¡¨åå°†æ˜¯ç»“æ„ä½“åå­—çš„ä¸‹åˆ’çº¿å½¢å¼ï¼Œå¦‚`person`

        aorm.Use(db).Opinion("ENGINE", "InnoDB").Opinion("COMMENT", "ç”¨æˆ·è¡¨").AutoMigrate(&Person{})
    

ä½¿ç”¨ `Migrate` æ–¹æ³•, ä½ å¯ä»¥ä½¿ç”¨å…¶ä»–çš„è¡¨å

        aorm.Use(db).Opinion("ENGINE", "InnoDB").Opinion("COMMENT", "ç”¨æˆ·è¡¨").Migrate("person_1", &Person{})
    

ä½¿ç”¨ `ShowCreateTable` æ–¹æ³•, ä½ å¯ä»¥è·å¾—åˆ›å»ºè¡¨çš„sqlè¯­å¥

        showCreate := aorm.Use(db).ShowCreateTable("person")
        fmt.Println(showCreate)
    

å¦‚ä¸‹

        CREATE TABLE `person` (
            `id` int NOT NULL AUTO_INCREMENT,
            `name` varchar(100) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'åå­—',
            `sex` tinyint DEFAULT NULL COMMENT 'æ€§åˆ«',
            `age` int DEFAULT NULL COMMENT 'å¹´é¾„',
            `type` int DEFAULT NULL COMMENT 'ç±»å‹',
            `create_time` datetime DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
            `money` float DEFAULT NULL COMMENT 'é‡‘é¢',
            `article_body` text COLLATE utf8mb4_general_ci COMMENT 'æ–‡ç« å†…å®¹',
            `test` double DEFAULT NULL COMMENT 'æµ‹è¯•',
            PRIMARY KEY (`id`),
            KEY `idx_person_sex` (`sex`),
            KEY `idx_person_age` (`age`),
            KEY `idx_person_type` (`type`)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='äººå‘˜è¡¨'
    

### åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥

#### å¢åŠ ä¸€æ¡è®°å½•

        id, errInsert := aorm.Use(db).Debug(true).Insert(&Person{
            Name:       aorm.StringFrom("Alice"),
            Sex:        aorm.BoolFrom(false),
            Age:        aorm.IntFrom(18),
            Type:       aorm.IntFrom(0),
            CreateTime: aorm.TimeFrom(time.Now()),
            Money:      aorm.FloatFrom(100.15987654321),
            Test:       aorm.FloatFrom(200.15987654321987654321),
        })
        if errInsert != nil {
            fmt.Println(errInsert)
        }
        fmt.Println(id)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        INSERT INTO person (name,sex,age,type,create_time,money,test) VALUES (?,?,?,?,?,?,?)
        Alice false 18 0 2022-12-07 10:10:26.1450773 +0800 CST m=+0.031808801 100.15987654321 200.15987654321987
    

#### è·å–ä¸€æ¡è®°å½•

        var person Person
        errFind := aorm.Use(db).Debug(true).Where(&Person{Id: aorm.IntFrom(id)}).GetOne(&person)
        if errFind != nil {
            fmt.Println(errFind)
        }
        fmt.Println(person)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT * FROM person WHERE id = ? Limit ?,?
        1 0 1
    

#### è·å–å¤šæ¡è®°å½•

        var list []Person
        errSelect := aorm.Use(db).Debug(true).Where(&Person{Type: aorm.IntFrom(0)}).GetMany(&list)
        if errSelect != nil {
            fmt.Println(errSelect)
        }
        for i := 0; i < len(list); i++ {
            fmt.Println(list[i])
        }
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT * FROM person WHERE type = ?
        0
    

#### æ›´æ–°è®°å½•

        countUpdate, errUpdate := aorm.Use(db).Debug(true).Where(&Person{Id: aorm.IntFrom(id)}).Update(&Person{Name: aorm.StringFrom("Bob")})
        if errUpdate != nil {
            fmt.Println(errUpdate)
        }
        fmt.Println(countUpdate)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        UPDATE person SET name=? WHERE id = ?
        Bob 1
    

#### åˆ é™¤è®°å½•

        countDelete, errDelete := aorm.Use(db).Debug(true).Where(&Person{Id: aorm.IntFrom(id)}).Delete()
        if errDelete != nil {
            fmt.Println(errDelete)
        }
        fmt.Println(countDelete)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        DELETE FROM person WHERE id = ?
        1
    

### é«˜çº§æŸ¥è¯¢

#### æŸ¥è¯¢æŒ‡å®šè¡¨

ä½¿ç”¨ `Table` æ–¹æ³•, ä½ å¯ä»¥åœ¨æŸ¥è¯¢æ—¶æŒ‡å®šè¡¨å

        aorm.Use(db).Debug(true).Table("person_1").Insert(&Person{Name: aorm.StringFrom("Cherry")})
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        INSERT INTO person_1 (name) VALUES (?)
        Cherry
    

#### æŸ¥è¯¢æŒ‡å®šå­—æ®µ

ä½¿ç”¨ `Select` æ–¹æ³•, ä½ å¯ä»¥åœ¨æŸ¥è¯¢æ—¶æŒ‡å®šå­—æ®µ

        var listByFiled []Person
        aorm.Use(db).Debug(true).Select("name,age").Where(&Person{Age: aorm.IntFrom(18)}).GetMany(&listByFiled)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT name,age FROM person WHERE age = ?
        18
    

#### æŸ¥è¯¢æ¡ä»¶

ä½¿ç”¨ `WhereArr` æ–¹æ³•, ä½ å¯ä»¥åœ¨æŸ¥è¯¢æ—¶æ·»åŠ æ›´å¤šæŸ¥è¯¢æ¡ä»¶

        var listByWhere []Person
        
        var where1 []aorm.WhereItem
        where1 = append(where1, aorm.WhereItem{Field: "type", Opt: aorm.Eq, Val: 0})
        where1 = append(where1, aorm.WhereItem{Field: "age", Opt: aorm.In, Val: []int{18, 20}})
        where1 = append(where1, aorm.WhereItem{Field: "money", Opt: aorm.Between, Val: []float64{100.1, 200.9}})
        where1 = append(where1, aorm.WhereItem{Field: "money", Opt: aorm.Eq, Val: 100.15})
        where1 = append(where1, aorm.WhereItem{Field: "name", Opt: aorm.Like, Val: []string{"%", "li", "%"}})
        
        aorm.Use(db).Debug(true).Table("person").WhereArr(where1).GetMany(&listByWhere)
        for i := 0; i < len(listByWhere); i++ {
            fmt.Println(listByWhere[i])
        }
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT * FROM person WHERE type = ? AND age IN (?,?) AND money BETWEEN (?) AND (?) AND CONCAT(money,'') = ? AND name LIKE concat('%',?,'%')
        0 18 20 100.1 200.9 100.15 li
    

#### æŸ¥è¯¢æ¡ä»¶ç›¸å…³æ“ä½œ

`aorm.Eq` ç­‰åŒäº `=`  
`aorm.Ne` ç­‰åŒäº `!=`  
`aorm.Gt` ç­‰åŒäº `>`  
`aorm.Ge` ç­‰åŒäº `>=`  
`aorm.Lt` ç­‰åŒäº `<`  
`aorm.Le` ç­‰åŒäº `<=`

`aorm.In` ç­‰åŒäº `IN`  
`aorm.NotIn` ç­‰åŒäº `NOT IN`  
`aorm.Like` ç­‰åŒäº `LIKE`  
`aorm.NotLike` ç­‰åŒäº `NOT LIKE`  
`aorm.Between` ç­‰åŒäº `BETWEEN`  
`aorm.NotBetween` ç­‰åŒäº `NOT BETWEEN`

#### è”åˆæŸ¥è¯¢

ä½¿ç”¨ `LeftJoin` æ–¹æ³•, ä½ å¯ä»¥ä½¿ç”¨è”åˆæŸ¥è¯¢

        var list2 []ArticleVO
        
        var where2 []aorm.WhereItem
        where2 = append(where2, aorm.WhereItem{Field: "o.type", Opt: aorm.Eq, Val: 0})
        where2 = append(where2, aorm.WhereItem{Field: "p.age", Opt: aorm.In, Val: []int{18, 20}})
        
        aorm.Use(db).Debug(true).
            Table("article o").
            LeftJoin("person p", "p.id=o.person_id").
            Select("o.*").
            Select("p.name as person_name").
            WhereArr(where2).
            GetMany(&list2)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT o.*,p.name as person_name FROM article o LEFT JOIN person p ON p.id=o.person_id WHERE o.type = ? AND p.age IN (?,?)
        0 18 20
    

å…¶ä»–çš„è”åˆæŸ¥è¯¢æ–¹æ³•è¿˜æœ‰ `RightJoin`, `Join`

#### åˆ†ç»„æŸ¥è¯¢

ä½¿ç”¨ `GroupBy` æ–¹æ³•, ä½ å¯ä»¥è¿›è¡Œåˆ†ç»„æŸ¥è¯¢

        type PersonAge struct {
            Age         aorm.Int
            AgeCount    aorm.Int
        }
    
        var personAge PersonAge
        
        var where []aorm.WhereItem
        where = append(where, aorm.WhereItem{Field: "type", Opt: aorm.Eq, Val: 0})
    
        err := aorm.Use(db).Debug(true).
            Table("person").
            Select("age").
            Select("count(age) as age_count").
            GroupBy("age").
            WhereArr(where).
            GetOne(&personAge)
        if err != nil {
            panic(err)
        }
    	fmt.Println(personAge)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT age,count(age) as age_count FROM person WHERE type = ? GROUP BY age Limit ?,?
        0 0 1
    

#### ç­›é€‰

ä½¿ç”¨ `HavingArr` ä»¥åŠ `Having` æ–¹æ³•, ä½ å¯ä»¥å¯¹åˆ†ç»„æŸ¥è¯¢çš„ç»“æœè¿›è¡Œç­›é€‰

        var listByHaving []PersonAge
        
        var where3 []aorm.WhereItem
        where3 = append(where3, aorm.WhereItem{Field: "type", Opt: aorm.Eq, Val: 0})
        
        var having []aorm.WhereItem
        having = append(having, aorm.WhereItem{Field: "age_count", Opt: aorm.Gt, Val: 4})
        
        err := aorm.Use(db).Debug(true).
            Table("person").
            Select("age").
            Select("count(age) as age_count").
            GroupBy("age").
            WhereArr(where3).
            HavingArr(having).
            GetMany(&listByHaving)
        if err != nil {
            panic(err)
        }
        fmt.Println(listByHaving)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT age,count(age) as age_count FROM person WHERE type = ? GROUP BY age Having age_count > ?
        0 4
    

#### æ’åº

ä½¿ç”¨ `OrderBy` æ–¹æ³•, ä½ å¯ä»¥å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åº

        var listByOrder []Person
    
        var where []aorm.WhereItem
        where = append(where, aorm.WhereItem{Field: "type", Opt: aorm.Eq, Val: 0})
    	
        err := aorm.Use(db).Debug(true).
            Table("person").
            WhereArr(where).
            OrderBy("age", aorm.Desc).
            GetMany(&listByOrder)
        if err != nil {
            panic(err)
        }
        fmt.Println(listByOrder)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT * FROM person WHERE type = ? Order BY age DESC
        0
    

#### åˆ†é¡µæŸ¥è¯¢

ä½¿ç”¨ `Limit` æˆ–è€… `Page` æ–¹æ³•, ä½ å¯ä»¥è¿›è¡Œåˆ†é¡µæŸ¥è¯¢

        var list3 []Person
    
        var where1 []aorm.WhereItem
        where1 = append(where1, aorm.WhereItem{Field: "type", Opt: aorm.Eq, Val: 0})
    	
        err1 := aorm.Use(db).Debug(true).
            Table("person").
            WhereArr(where1).
            Limit(50, 10).
            GetMany(&list3)
        if err1 != nil {
            panic(err1)
        }
        fmt.Println(list3)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT * FROM person WHERE type = ? Limit ?,?
        0 50 10
    

        var list4 []Person
    
        var where2 []aorm.WhereItem
        where2 = append(where2, aorm.WhereItem{Field: "type", Opt: aorm.Eq, Val: 0})
    	
        err := aorm.Use(db).Debug(true).
            Table("person").
            WhereArr(where2).
            Page(3, 10).
            GetMany(&list4)
        if err != nil {
            panic(err)
        }
        fmt.Println(list4)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT * FROM person WHERE type = ? Limit ?,?
        0 20 10
    

#### æ‚²è§‚é”

ä½¿ç”¨ `LockForUpdate` æ–¹æ³•, ä½ å¯ä»¥åœ¨æŸ¥è¯¢æ—¶å€™é”ä½æŸäº›è®°å½•ï¼Œç¦æ­¢ä»–ä»¬è¢«ä¿®æ”¹

        var itemByLock Person
        err := aorm.Use(db).Debug(true).LockForUpdate(true).Where(&Person{Id: aorm.IntFrom(id)}).GetOne(&itemByLock)
        if err != nil {
            panic(err)
        }
        fmt.Println(itemByLock)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT * FROM person WHERE id = ? Limit ?,?  FOR UPDATE
        2 0 1
    

#### è‡ªå¢æ“ä½œ

ä½¿ç”¨ `Increment` æ–¹æ³•, ä½ å¯ä»¥ç›´æ¥æ“ä½œæŸå­—æ®µå¢åŠ æ•°å€¼

        count, err := aorm.Use(db).Debug(true).Where(&Person{Id: aorm.IntFrom(id)}).Increment("age", 1)
        if err != nil {
            panic(err)
        }
        fmt.Println(count)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        UPDATE person SET age=age+? WHERE id = ?
        1 2
    

#### è‡ªå‡æ“ä½œ

ä½¿ç”¨ `Decrement` æ–¹æ³•, ä½ å¯ä»¥ç›´æ¥æ“ä½œæŸå­—æ®µå‡å°‘æ•°å€¼

        count, err := aorm.Use(db).Debug(true).Where(&Person{Id: aorm.IntFrom(id)}).Decrement("age", 2)
        if err != nil {
            panic(err)
        }
        fmt.Println(count)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        UPDATE person SET age=age-? WHERE id = ?
        2 2
    

#### æŸ¥è¯¢æŸå­—æ®µçš„å€¼(å­—ç¬¦ä¸²)

ä½¿ç”¨ `Value` æ–¹æ³•, ä½ å¯ä»¥ç›´æ¥è·å–åˆ°æŸå­—æ®µçš„å€¼ã€‚  
æ³¨æ„ï¼Œè¿”å›å€¼æ˜¯å­—ç¬¦ä¸²

        name, err := aorm.Use(db).Debug(true).Where(&Person{Id: aorm.IntFrom(id)}).Value("name")
        if err != nil {
            panic(err)
        }
        fmt.Println(name)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT name FROM person WHERE id = ? Limit ?,?
        2 0 1
    

æ‰“å°ç»“æœä¸º `Alice`

#### æŸ¥è¯¢æŸå­—æ®µçš„å€¼(Int64)

ä½¿ç”¨ `ValueInt64` æ–¹æ³•, ä½ å¯ä»¥ç›´æ¥è·å–åˆ°æŸå­—æ®µçš„å€¼ã€‚  
æ³¨æ„ï¼Œè¿”å›å€¼æ˜¯Int64

        age, err := aorm.Use(db).Debug(true).Where(&Person{Id: aorm.IntFrom(id)}).ValueInt64("age")
        if err != nil {
            panic(err)
        }
        fmt.Println(age)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT age FROM person WHERE id = ? Limit ?,?
        2 0 1
    

æ‰“å°ç»“æœä¸º `17`

#### æŸ¥è¯¢æŸå­—æ®µçš„å€¼(Float32)

ä½¿ç”¨ `ValueFloat32` æ–¹æ³•, ä½ å¯ä»¥ç›´æ¥è·å–åˆ°æŸå­—æ®µçš„å€¼ã€‚  
æ³¨æ„ï¼Œè¿”å›å€¼æ˜¯Float32

        money, err := aorm.Use(db).Debug(true).Where(&Person{Id: aorm.IntFrom(id)}).ValueFloat32("money")
        if err != nil {
            panic(err)
        }
        fmt.Println(money)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT money FROM person WHERE id = ? Limit ?,?
        2 0 1
    

æ‰“å°ç»“æœä¸º `100.159874`

### æŸ¥è¯¢æŸå­—æ®µçš„å€¼(Float64)

ä½¿ç”¨ `ValueFloat64` æ–¹æ³•, ä½ å¯ä»¥ç›´æ¥è·å–åˆ°æŸå­—æ®µçš„å€¼ã€‚  
æ³¨æ„ï¼Œè¿”å›å€¼æ˜¯Float64

        test, err := aorm.Use(db).Debug(true).Where(&Person{Id: aorm.IntFrom(id)}).ValueFloat64("test")
        if err != nil {
            panic(err)
        }
        fmt.Println(test)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT test FROM person WHERE id = ? Limit ?,?
        2 0 1
    

æ‰“å°ç»“æœä¸º `200.15987654321987`

### èšåˆæŸ¥è¯¢

#### Count

ä½¿ç”¨ `Count` æ–¹æ³•, ä½ å¯ä»¥æŸ¥è¯¢å‡ºè®°å½•æ€»æ•°é‡

        count, err := aorm.Use(db).Debug(true).Where(&Person{Age: aorm.IntFrom(18)}).Count("*")
        if err != nil {
            panic(err)
        }
        fmt.Println(count)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT count(*) as c FROM person WHERE age = ?
        18
    

#### Sum

ä½¿ç”¨ `Sum` æ–¹æ³•, ä½ å¯ä»¥æŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„æŸå­—æ®µä¹‹å’Œ

        sum, err := aorm.Use(db).Debug(true).Where(&Person{Age: aorm.IntFrom(18)}).Sum("age")
        if err != nil {
            panic(err)
        }
        fmt.Println(sum)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT sum(age) as c FROM person WHERE age = ?
        18
    

#### Avg

ä½¿ç”¨ `Avg` æ–¹æ³•, ä½ å¯ä»¥æŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„æŸå­—æ®µå¹³å‡å€¼

        avg, err := aorm.Use(db).Debug(true).Where(&Person{Age: aorm.IntFrom(18)}).Avg("age")
        if err != nil {
            panic(err)
        }
        fmt.Println(avg)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT avg(age) as c FROM person WHERE age = ?
        18
    

#### Min

ä½¿ç”¨ `Min` æ–¹æ³•, ä½ å¯ä»¥æŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„æŸå­—æ®µæœ€å°å€¼

        min, err := aorm.Use(db).Debug(true).Where(&Person{Age: aorm.IntFrom(18)}).Min("age")
        if err != nil {
            panic(err)
        }
        fmt.Println(min)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT min(age) as c FROM person WHERE age = ?
        18
    

#### Max

ä½¿ç”¨ `Max` æ–¹æ³•, ä½ å¯ä»¥æŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„æŸå­—æ®µæœ€å¤§å€¼

        max, err := aorm.Use(db).Debug(true).Where(&Person{Age: aorm.IntFrom(18)}).Max("age")
        if err != nil {
            panic(err)
        }
        fmt.Println(max)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT max(age) as c FROM person WHERE age = ?
        18
    

### é€šç”¨æ“ä½œ

ä½¿ç”¨ `Query` æ–¹æ³•, ä½ å¯ä»¥æ‰§è¡Œè‡ªå®šä¹‰çš„æŸ¥è¯¢

#### Query

        resQuery, err := aorm.Use(db).Debug(true).Query("SELECT * FROM person WHERE id=? AND type=?", 1, 3)
        if err != nil {
            panic(err)
        }
        fmt.Println(resQuery)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT * FROM person WHERE id=? AND type=?
        1 3
    

#### Exec

ä½¿ç”¨ `Exec` æ–¹æ³•, ä½ å¯ä»¥æ‰§è¡Œè‡ªå®šä¹‰çš„ä¿®æ”¹æ“ä½œ

        resExec, err := aorm.Use(db).Debug(true).Exec("UPDATE person SET name = ? WHERE id=?", "Bob", 3)
        if err != nil {
            panic(err)
        }
        fmt.Println(resExec.RowsAffected())
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        UPDATE person SET name = ? WHERE id=?
        Bob 3
    

### äº‹åŠ¡æ“ä½œ

ä½¿ç”¨ `db` çš„ `Begin` æ–¹æ³•, å¼€å§‹ä¸€ä¸ªäº‹åŠ¡  
ç„¶åä½¿ç”¨ `Commit` æ–¹æ³•æäº¤äº‹åŠ¡ï¼Œ`Rollback` æ–¹æ³•å›æ»šäº‹åŠ¡

        tx, _ := db.Begin()
        
        id, errInsert := aorm.Use(tx).Insert(&Person{
            Name: aorm.StringFrom("Alice"),
        })
        
        if errInsert != nil {
            fmt.Println(errInsert)
            tx.Rollback()
            return
        }
        
        countUpdate, errUpdate := aorm.Use(tx).Where(&Person{
            Id: aorm.IntFrom(id),
        }).Update(&Person{
            Name: aorm.StringFrom("Bob"),
        })
        
        if errUpdate != nil {
            fmt.Println(errUpdate)
            tx.Rollback()
            return
        }
        
        fmt.Println(countUpdate)
        tx.Commit()
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        INSERT INTO person (name) VALUES (?)
        Alice
                                  
        UPDATE person SET name=? WHERE id = ?
        Bob 3
    

### æ¸…ç©ºè¡¨æ•°æ®

ä½¿ç”¨ `Truncate` æ–¹æ³•, ä½ å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ¸…ç©ºä¸€ä¸ªè¡¨

        count, err := aorm.Use(db).Table("person").Truncate()
        if err != nil {
            panic(err)
        }
        fmt.Println(count)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        TRUNCATE TABLE person
    

### å·¥å…·ç±»

ä½¿ç”¨ `Ul` æˆ–è€… `UnderLine` æ–¹æ³•, ä½ å¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä»é©¼å³°å†™æ³•è½¬æ¢æˆä¸‹åˆ’çº¿å†™æ³•  
ä¾‹å¦‚, è½¬æ¢ `personId` æˆ `person_id`

        var list2 []ArticleVO
        var where2 []aorm.WhereItem
        where2 = append(where2, aorm.WhereItem{Field: "o.type", Opt: aorm.Eq, Val: 0})
        where2 = append(where2, aorm.WhereItem{Field: "p.age", Opt: aorm.In, Val: []int{18, 20}})
    	
        aorm.Use(db).Debug(true).
            Table("article o").
            LeftJoin("person p", aorm.Ul("p.id=o.personId")).
            Select("o.*").
            Select(aorm.Ul("p.name as personName")).
            WhereArr(where2).
            GetMany(&list2)
    

ä¸Šè¿°ä»£ç è¿è¡Œåå¾—åˆ°çš„SQLé¢„å¤„ç†è¯­å¥ä»¥åŠç›¸å…³å‚æ•°å¦‚ä¸‹

        SELECT o.*,p.name as person_name FROM article o LEFT JOIN person p ON p.id=o.person_id WHERE o.type = ? AND p.age IN (?,?)
        0 18 20
    

ä½œè€…
--

ğŸ‘¤ **tangpanqing**

*   Twitter: [@tangpanqing](https://twitter.com/tangpanqing)
*   Github: [@tangpanqing](https://github.com/tangpanqing)

å¸Œæœ›èƒ½å¾—åˆ°ä½ çš„æ”¯æŒ
---------

ç»™ä¸ª â­ å§ï¼Œå¦‚æœè¿™ä¸ªé¡¹ç›®å¸®åŠ©åˆ°ä½ 