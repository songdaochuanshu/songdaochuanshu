---
layout: post
title: "两个宝藏|关于我在github上冲浪时的一个小技巧。"
date: "2022-03-21T11:15:46.382Z"
---
两个宝藏|关于我在github上冲浪时的一个小技巧。
==========================

你好呀，我是歪歪。

前几天在 github 上冲浪的时候，发现了两个宝藏东西。

我也不藏着掖着了，拿出来给大家分享一下。

这两个宝藏是关于 arthas 和 SOFARegistry 的，这两个东西都是阿里开源的项目。

arthas 大家应该都比较耳熟能详了，知道它是阿里搞出来的一款 Java 诊断工具。

而 SOFARegistry 是个啥玩意？好像没怎么听说过呢？

我接触这个东西的时间也不算长，但是我大概知道它是个什么东西，我觉得是一个轮子，但是这个轮子还挺厉害的。

不着急，等下就给你摆一摆。

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320165617.png)

arthas
------

arthas 这个玩意，我都不记得我之前的文章中出现了多少次了。基本上都是关于它的使用实际操作案例或者说是官方提供的练手 Demo。

它的使用范围也还是非常的广泛：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320144433.png)

那么，我在它的 github 上又发现了什么宝藏东西呢？

就藏在它的 issue 的 Labels 里面：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320144554.png)

点开 Labels，你会发现有个叫做 user-case 的标签：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320145303.png)

这个标签下的 issues，就是我想说的第一个宝藏：

> https://github.com/alibaba/arthas/issues?page=1&q=label%3Auser-case

我给你截屏第一页的内容，你看看是不是很有一种想要点进去看看具体是啥的欲望：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320145646.png)

比如给你看看工行的这个 user-case：

> https://github.com/lyghzh/pub/blob/main/doc/%E5%B7%A5%E5%95%86%E9%93%B6%E8%A1%8C%E6%89%93%E9%80%A0%E5%9C%A8%E7%BA%BF%E8%AF%8A%E6%96%AD%E5%B9%B3%E5%8F%B0%E7%9A%84%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5.md

我之前其实一直认为大家会觉得 Arthas 在生产上运行其实是一件非常危险的事情。

它就是一把双刃剑，用的好了，早点下班，用的不好，说不定背个生产事故。

所以，采取因噎废食的方法，干脆就不使用了。

工行，作为一个银行，在这个方面的考虑肯定也更加的多。

在他们的落地困难点上，首当其冲的就是“信息安全”的问题，这是它们的基础红线，也是银行的立根之点：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320150445.png)

那么它是怎么在生产上使用 Arthas 呢？

在这个 case 里面，给出了这个问题的答案。

> 我们设计了一套轻巧的架构，让开发人员以Web UI的方式，便捷、直观的使用各类在线诊断能力。那么我们是怎么做的呢？

基于 Arthas 的功能，再次封装了一个 web UI 页面出来，藏在这个页面背后的接口，可以对执行结果进行剪裁和修改，处理成 json 格式数据返回给平台做展示。

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320150929.png)

文章中除了介绍整体架构之外，还提供了实际使用的效果。

比如控制面板看起来就很眼熟的样子：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320151107.png)

就是基于 Arthas 原生的响应，搞了一个展示页面。

页面上的这些数据都是 Arthas 返回的：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320151400.png)

还有反编译的功能：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320151522.png)

但是在文章中并没有看到热加载相关的内容，我猜肯定是对于这类危险的功能，从 web 页面上就进行了屏蔽。

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320151818.png)

在这个 issues 下面，我还发现别人提到另外一个类似的项目：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320151942.png)

这是去哪儿开源的一个 Java 应用诊断工具：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320152434.png)

不延伸了，学不过来了。

再比如这个案例：

> https://github.com/alibaba/arthas/issues/1892

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320153142.png)

然后他使用 Trace 一点点的追踪时间消耗比较大的方法，再一点点的进行修复。

经过了四次优化之后，相同请求的调用链路耗时，从最开始的 343ms 降低到了 27ms，你说这不香吗？

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320153424.png)

然后，他给出了结论，也就是这次优化的点：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320153525.png)

你可以发现其实都不是什么特别大的优化，就是一些我们平时在使用的细枝末节的东西。

最后，他还写了一个“强烈推荐”：动态追踪技术漫谈。

好吧，这个也是我很久之前就收藏了的网站，不藏着了。也拿出来一并分享了：

> https://blog.openresty.com.cn/cn/dynamic-tracing/

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320154352.png)

这个博客里面的文章质量非常的高，博客的主人是章亦春，他是开源项目 OpenResty 的创始人，同时也是 OpenResty Inc. 公司的创始人和 CEO。

咱就是说，大佬背书，放心阅读。

这里我只是在第一个宝藏中随便挑了两个案例出来，剩下的你自己去挖掘吧。

SOFARegistry
------------

SOFARegistry 是个啥？

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320154954.png)

其实我理解它就是一个注册中心的轮子。或者更具体一点的说就是具有阿里特色的 Eureka。

这是它的 github 地址：

> https://github.com/sofastack/sofa-registry

你看到其中的 sofastack 了吗？

SOFARegistry 只是一个棋子，sofastack 才是棋盘。

这是一个 Stack，是一个技术栈，是一个金融领域的架构方案。

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320155725.png)

它下面的项目非常多，从主要项目的名称命名，什么 xxxBoot，xxxRPC，xxxRegistry 你就可以看出，用这些项目我们可以搭建出一个完整的项目：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320155800.png)

关于 SOFARegistry 的宝藏也藏在它的 Labels 里面：

> https://github.com/sofastack/sofa-registry/issues?q=is%3Aissue+is%3Aopen+label%3Aevent%2Fsource-code-analyze

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320160757.png)

这个叫做 event/source-code-analyze 的 Label，你别看没几个东西，但是里面全是源码分析。

而且是官方发起的活动，文章内容会有专人 review，力保准确性：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320161523.png)

这次一共发布了 9 个源码解析的任务：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320161847.png)

任务难度有高有低。根据任务难度有不同的奖励措施：

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320161712.png)

有机会成为社区的 Contributor 或者直接是 Member，还是相当有吸引力的。

比如我们看一下关于数据倒排索引的这个任务：

> https://github.com/sofastack/sofa-registry/issues/202

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320163228.png)

它的 issues 描述里面也指出了需要写什么内容，去看哪一部分的代码。

指路已经指的很明确了。

最后解析文章提交的格式是 md 格式： ![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320163255.png)

我们可以直接下载下来进行阅读。

到时候对于想要深入理解 SOFARegistry 的同学来说就是一个很好的切入口。

虽然 SOFARegistry 知道的人不对，但是我还是想把 SOFARegistry 的这个活动写出来，让更多的人知道他们有这样的活动。

因为我觉得这个活动非常的好，源码解析，是我看到一种全新的参与开源项目建设的方式。

最后，关于这两个宝藏，告诉我一个什么道理？

它告诉我：逛开源项目的时候要多注意它的 Labels，说不定藏着什么好东西。反正我以前是很少关注 Labels 的，我一直以为只有项目维护者才关心 Labels。

![](https://why-image-1300252878.cos.ap-chengdu.myqcloud.com/img/83/20220320165308.png)

最后，文章首发于公众号\[why技术\]，欢迎大家来关注呀，比心。