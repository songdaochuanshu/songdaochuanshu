---
layout: post
title: "Eureka åŸºæœ¬æ•™ç¨‹"
date: "2022-03-18T12:29:20.278Z"
---
Eureka åŸºæœ¬æ•™ç¨‹
===========

ç›®å½•

*   [Eureka åŸºæœ¬æ•™ç¨‹](#eureka-åŸºæœ¬æ•™ç¨‹)
    *   [RestTemplate ä½¿ç”¨](#resttemplate-ä½¿ç”¨)
    *   [Eureka ä½¿ç”¨](#eureka-ä½¿ç”¨)
        *   [æ³¨å†Œä¸­å¿ƒ](#æ³¨å†Œä¸­å¿ƒ)
        *   [æä¾›è€…](#æä¾›è€…)
        *   [æ¶ˆè´¹è€…](#æ¶ˆè´¹è€…)

Eureka åŸºæœ¬æ•™ç¨‹
===========

RestTemplate ä½¿ç”¨
---------------

å­¦ä¹ Eurakaçš„åŒå­¦ç›´æ¥æ»‘åˆ°æœ€ä¸‹é¢, è¿™é‡Œå…ˆä¸ºåˆå­¦è€…ä»‹ç» RestTemplate.

å¹³æ—¶æˆ‘ä»¬ä½¿ç”¨ Http å·¥å…·å‘é€è¯·æ±‚é€šå¸¸éƒ½ä¼šæœ‰ä¸¤ä¸ªæ­¥éª¤, å…ˆè°ƒç”¨è¯·æ±‚æ‹¿åˆ°å“åº”ä¿¡æ¯, å†å°†å“åº”ä¿¡æ¯é€šè¿‡ JSON å·¥å…·è§£æå¹¶è½¬æ¢ä¸ºå®ä½“ç±». æ€»çš„æ¥è¯´, RestTemplate æ˜¯ spring æä¾›çš„ä¸€ä¸ªç”¨æ¥æ¨¡æ‹Ÿæµè§ˆå™¨å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”çš„ä¸€ä¸ªç±», å®ƒèƒ½åŸºäº Http åè®®å®ç°è¿œç¨‹è°ƒç”¨. ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯, å®ƒå‘é€çš„æ˜¯åŒæ­¥è¯·æ±‚.

çˆ¶å·¥ç¨‹ä¾èµ–:

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.6.4</version>
    </parent>
    

å³é”®çˆ¶å·¥ç¨‹åˆ›å»ºæ–° maven é¡¹ç›®, å–åä¸º eurekademo.

é¡¹ç›®å¼•å…¥ä¾èµ–:

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
    <!-- https://mvnrepository.com/artifact/junit/junit -->
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <scope>test</scope>
    </dependency>
    

EurekaDemoApplicationTest.java:

    @SpringBootTest
    public class EurekaDemoApplicationTest {
        
        @Test
        public void testGet() {
            RestTemplate restTemplate = new RestTemplate();
            //æ¨¡æ‹Ÿæµè§ˆå™¨çš„è¯·æ±‚å¤´, å¾ˆå¤šå›½å†…å…è´¹çš„ api éƒ½æœ‰è¿™ç§é™åˆ¶, ä¸€èˆ¬æˆ‘ä»¬ä¼šæŠŠä»¥ä¸‹é…ç½®è¯·æ±‚å¤´çš„ä»£ç å†™åœ¨ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­, é€šè¿‡ restTemplate.setClientHttpRequestInitializers() é…ç½®è¿›å»
            HttpHeaders headers = new HttpHeaders();
            headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));
            headers.add("user-agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36");
            HttpEntity<String> entity = new HttpEntity<>("parameters", headers);
            //èŠ‚å‡æ—¥æŸ¥è¯¢å…è´¹ api
            ResponseEntity<Holiday> forObject = restTemplate.exchange("http://timor.tech/api/holiday/info/2022-01-01", HttpMethod.GET, entity, Holiday.class);
            System.out.println(forObject.getBody());
            /*
            //ä¸€èˆ¬ä¼ä¸šè‡ªå·±å°è£…çš„æ¥å£ä¸ä¼šå¯¹å¤–å¼€æ”¾, æ‰€ä»¥ä¸éœ€è¦å‘ä¸Šé¢é‚£ä¹ˆéº»çƒ¦, ä¸‹é¢çš„ä»£ç åªæ˜¯æ‰“ä¸ªæ¯”æ–¹, å®é™…æ‰§è¡Œä¼šæŠ¥é”™ == start
            Holiday h1 = restTemplate.getForObject("http://timor.tech/api/holiday/info/2022-01-01", Holiday.class);
            Holiday h2 = restTemplate.postForObject("http://timor.tech/api/holiday/info/2022-01-01", null, Holiday.class);
            // == end
            */
        }
    }
    

Eureka ä½¿ç”¨
---------

### æ³¨å†Œä¸­å¿ƒ

ä½œç”¨: ç®¡ç†é¡¹ç›®é›†ç¾¤è€Œæš´éœ²çš„æ¥å£æœåŠ¡, æä¾›æœåŠ¡æ³¨å†Œä¸å‘ç°çš„åŠŸèƒ½.

*   æœåŠ¡æ³¨å†Œ: æä¾›è€… (æš´éœ²è‡ªå·±çš„æœåŠ¡ç»™å¤–éƒ¨è°ƒç”¨çš„è§’è‰²) å‘ Eureka æœåŠ¡å™¨æ³¨å†Œè‡ªå·±.
    
*   æœåŠ¡å‘ç°: æ¶ˆè´¹è€… (å»è°ƒç”¨æš´éœ²å‡ºæ¥çš„æœåŠ¡çš„è§’è‰²) ä» Eureka æœåŠ¡å™¨è·å–æä¾›è€…çš„åœ°å€åˆ—è¡¨.
    

å…¶ä¸­ Eureka æœåŠ¡å™¨ä¹Ÿå¯ä»¥é›†ç¾¤, å’Œå…¶ä»– Eureka æœåŠ¡å™¨ç›¸äº’å…±äº«è‡ªå·±çš„èµ„æº.

æ¥ä¸‹æ¥å°±å¼€å§‹æ­å»ºä¸€ä¸ª Eureka æœåŠ¡å™¨.

çˆ¶å·¥ç¨‹ pom æ·»åŠ é…ç½®:

    <properties>
        <spring.cloud.version>2021.0.1</spring.cloud.version>
    </properties>
    
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring.cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>
    

eurekademo é¡¹ç›®ä¸­æ·»åŠ ä¾èµ–:

    <!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-eureka-client -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
    </dependency>
    

application.yml:

    server:
      port: 8080
    spring:
      application:
        name: eureka-server
    
    # eurekaæœåŠ¡å™¨é…ç½®, æ¯ä¸ªå±æ€§èµ‹ä»€ä¹ˆç±»å‹çš„å€¼éƒ½å¯ä»¥æŒ‰ä½ ctrl ç‚¹å‡»å±æ€§åè¿›å»æ‰¾åˆ° set æ“ä½œ
    eureka:
      client:
        service-url:
          defaultZone: http://localhost:8080/eureka #é»˜è®¤æœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€, å¤šä¸ªä½¿ç”¨ ',' éš”å¼€
        register-with-eureka: false #æ˜¯å¦æ³¨å†Œ, é»˜è®¤å€¼ true, ç”±äºè¿™ä¸ªé¡¹ç›®ä½œä¸º eureka çš„æ³¨å†Œä¸­å¿ƒä½¿ç”¨, æ³¨å†Œè‡ªå·±ä¼šæŠ¥é”™, é…ç½®å…¶ä»–æ³¨å†Œä¸­å¿ƒåœ°å€ä¸ä¼šæŠ¥é”™
        fetch-registry: false #æ˜¯å¦æ£€ç´¢æœåŠ¡, é»˜è®¤å€¼ true, åŸºæœ¬ä¸Šè¿™ä¸ªé¡¹ç›®ä¸ä¼šå»å¤„ç†ä¸šåŠ¡åŠŸèƒ½, æ‰€ä»¥ä¹Ÿä¸éœ€è¦æ£€ç´¢å…¶ä»–æœåŠ¡, é›†ç¾¤æ³¨å†Œä¸­å¿ƒçš„è¯å°±èµ‹ true
      server:
        eviction-interval-timer-in-ms: 10000 #æ³¨å†Œä¸­å¿ƒæ¸…ç†æ— æ•ˆèŠ‚ç‚¹çš„æ—¶é—´é—´éš”, é»˜è®¤ä¸º 60000L , å•ä½æ¯«ç§’ ms
    

åˆ›å»ºå¯åŠ¨ç±» EurekaDemoApplication , æ³¨æ„ç»„ç»‡å groupId + .eurekademo ä¸ºå¯åŠ¨ç±»çš„çˆ¶åŒ…, æˆ‘çš„ groupId ä¸º `com.kent` , æ‰€ä»¥çˆ¶åŒ…ä¸º `com.kent.eurekademo` :

    /**
     * @Title: EurekaDemoApplication
     * @Description: eureka æœåŠ¡å™¨æ³¨å†Œä¸­å¿ƒ
     * @author: kent
     * @date: 2022/3/16 14:53
     * @Version: 1.0
     */
    @SpringBootApplication
    @EnableEurekaServer //boot çš„ç‰¹ç‚¹å°±æ˜¯éœ€è¦ Enable
    public class EurekaDemoApplication {
    
        public static void main(String[] args) {
            SpringApplication.run(EurekaDemoApplication.class, args);
        }
    }
    

ok , ç›´æ¥ run èµ·æ¥! å¯åŠ¨æˆåŠŸåè®¿é—® [http://127.0.0.1:8080/](http://127.0.0.1:8080/) å°±å¯ä»¥çœ‹åˆ° eureka å±•ç¤ºçš„ä¸€äº›åŸºæœ¬ä¿¡æ¯. è‹±æ–‡çœ‹ä¸æ‡‚çš„è¯, æœ€å¥½é…å¤‡ä¸€ä¸ªç½‘æ˜“æœ‰é“è¯å…¸. ğŸ˜„

![](https://img2022.cnblogs.com/blog/2408661/202203/2408661-20220318170406505-1742726253.png)

### æä¾›è€…

å³é”®çˆ¶å·¥ç¨‹åˆ›å»ºæ–° maven é¡¹ç›® consumerdemo

é¡¹ç›®å¼•å…¥ä¾èµ–:

    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-eureka-client -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
    </dependency>
    

application.yml é…ç½®:

    server:
      port: 15050
    spring:
      application:
        name: consumerdemo
    # ä½¿ç”¨ eureka æš´éœ²è‡ªèº«åœ°å€, æ‹‰å–å…¶ä»–æœåŠ¡åœ°å€
    eureka:
      client:
        fetch-registry: true
        register-with-eureka: true # fetch-registry ä¸ register-with-eureka éƒ½ä¸º true è¡¨ç¤ºå³ä¸ºæä¾›è€…, äº¦ä¸ºæ¶ˆè´¹è€…
        service-url:
          defaultZone: http://127.0.0.1:8080/eureka
        eureka-server-connect-timeout-seconds: 10 # è¿æ¥æ³¨å†Œä¸­å¿ƒè¶…æ—¶æ—¶é—´, é»˜è®¤ 5, å•ä½ç§’, ä¸€èˆ¬å’Œæ³¨å†Œä¸­å¿ƒæœåŠ¡å¤±æ•ˆæ—¶é—´é…ç½®ä¸€è‡´
        eureka-server-read-timeout-seconds: 10 # è¯»å–æœåŠ¡åˆ—è¡¨çš„è¶…æ—¶æ—¶é—´, é»˜è®¤ 8, å•ä½ç§’
      instance:
        #hostname: ${spring.application.name} # ä¸»æœºåç§°, ä½œç”¨äº eureka ç®¡ç†é¡µé¢æœåŠ¡å®ä¾‹åˆ—è¡¨çš„é“¾æ¥åœ°å€, é»˜è®¤æ˜¯è‡ªå·±ç”µè„‘å, prefer-ip-address.instance.eureka=false é»˜è®¤å–è¿™ä¸ª
        appname: ${spring.application.name} # å®ä¾‹åç§°, é»˜è®¤ä½¿ç”¨ spring.application.name çš„å€¼, ä¸€èˆ¬ä¸é…ç½®
        prefer-ip-address: true # ä½¿ç”¨ ip åœ°å€å®šä¹‰åœ¨æ³¨å†Œä¸­å¿ƒçš„åœ°å€, ä½œç”¨äº eureka ç®¡ç†é¡µé¢æœåŠ¡å®ä¾‹åˆ—è¡¨çš„é“¾æ¥åœ°å€, é»˜è®¤ä¸º false
        #ip-address: 127.0.0.1 # ä¸»æœº ip åœ°å€, åŸºæœ¬ä¸Šä¸é…ç½®, prefer-ip-address.instance.eureka=true ä¼˜å…ˆå–è¿™ä¸ª
        lease-renewal-interval-in-seconds: 5 # æœåŠ¡ç»­çº¦é—´éš”æ—¶é—´, é»˜è®¤ä¸º 90, å•ä½ç§’
    

åˆ›å»ºå¯åŠ¨ç±» ConsumerDemoApplication.java , æ·»åŠ æ³¨è§£ @EnableEurekaClient, é‚£ä¹ˆå¯åŠ¨èµ·æ¥è¿™ä¸ªæä¾›è€…å°±å¼€å§‹ç”Ÿæ•ˆäº†.

### æ¶ˆè´¹è€…

åˆ›å»ºé¡¹ç›®çš„è¿‡ç¨‹ä»¥åŠé…ç½®éƒ½å’Œæä¾›è€…ä¸€æ ·.

ç°åœ¨å°±æ˜¯çœ‹çœ‹æ€ä¹ˆè°ƒç”¨, åˆ›å»ºä¸€ä¸ªå‰ç«¯æ§åˆ¶å™¨:

    @RestController
    public class HelloEurekaController {
    
        @Autowired
        private DiscoveryClient discoveryClient;
    
        @Autowired
        private RestTemplate restTemplate;
    
        @GetMapping("testPort")
        public String testPort() {
            // æ ¹æ®æœåŠ¡åè·å–å®ä¾‹åˆ—è¡¨
            List<ServiceInstance> serviceInstances = discoveryClient.getInstances("consumerdemo");
            ServiceInstance serviceInstance = serviceInstances.get(0);
            return "http://" + serviceInstance.getHost() + ":" + serviceInstance.getPort();
        }
    }
    

è¿™é‡Œå·²ç»æ‹¿åˆ°æä¾›è€…çš„è®¿é—®åœ°å€, è¯¥æ€ä¹ˆè°ƒç”¨æˆ‘æƒ³åº”è¯¥éš¾ä¸å€’ä½ ä»¬ğŸ˜„