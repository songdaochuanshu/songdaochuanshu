---
layout: post
title: "å¼ é«˜å…´çš„ Entity Framework Core å³å­¦å³ç”¨ï¼šï¼ˆä¸€ï¼‰åˆ›å»ºç¬¬ä¸€ä¸ª EF Core åº”ç”¨"
date: "2022-03-22T12:31:27.653Z"
---
å¼ é«˜å…´çš„ Entity Framework Core å³å­¦å³ç”¨ï¼šï¼ˆä¸€ï¼‰åˆ›å»ºç¬¬ä¸€ä¸ª EF Core åº”ç”¨
===================================================

å†™åœ¨å‰é¢
----

Entity Framework Core (EF Core) æ˜¯ .NET å¹³å°æµè¡Œçš„å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰æ¡†æ¶ã€‚è™½ç„¶ .NET å¹³å°ä¸­ ORM æ¡†æ¶æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ Dapperã€NHibernateã€PetaPoco ç­‰ï¼Œå¹¶ä¸” EF Core çš„æ€§èƒ½ä¹Ÿä¸æ˜¯æœ€ä¼˜çš„ï¼ˆè¿™æ˜¯ç”±äº EF çš„å®ä½“è·Ÿè¸ªç‰¹æ€§ï¼Œå°†å…¶ç¦ç”¨åå¯ä»¥å¤§å¹…æå‡æ€§èƒ½ï¼‰ï¼Œä½†ä¾ç„¶å¸å¼•åˆ°å¾ˆå¤šåç«¯å¼€å‘è€…çš„ä½¿ç”¨ï¼ŒåŸå› å¦‚ä¸‹ï¼š

1.  EF Core ç”± .NET å®˜æ–¹è¿›è¡Œå¼€å‘ç»´æŠ¤ï¼Œå‡ºç°é—®é¢˜è§£å†³è¾ƒä¸ºåŠæ—¶ï¼Œè¿™æ˜¯å¾ˆå¤šå›½äº§ ORM æ¡†æ¶ä¸å…·æœ‰çš„ä¼˜åŠ¿ï¼›
2.  EF Core å’Œ C# è¯­æ³•é«˜åº¦ç»‘å®šï¼Œä½¿ç”¨ LINQ ä¸å†éœ€è¦ç¼–å†™å¤æ‚çš„æ•°æ®åº“è®¿é—®ä»£ç ï¼›
3.  EF Core æ”¯æŒå¤§éƒ¨åˆ†æµè¡Œçš„æ•°æ®åº“ï¼Œåˆ‡æ¢æ•°æ®åº“æ—¶åªéœ€è¦æ›´æ”¹æ•°æ®åº“è®¿é—®é©±åŠ¨ï¼Œå¹¶ä¸éœ€è¦æ›´æ”¹ä¸šåŠ¡é€»è¾‘ã€‚  
    å› æ­¤åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ EF Core ä¸ä¸€å®šæ˜¯æœ€ä¼˜çš„ï¼Œä½†ä¸€å®šä¸ä¼šé”™ã€‚

ã€Šå¼ é«˜å…´çš„ Entity Framework Core å³å­¦å³ç”¨ã€‹ç³»åˆ—åšå®¢å°†ä¼šä»å®è·µçš„è§’åº¦å»ä»‹ç» EF Coreã€‚ç”±äºå­¦ä¹ çš„æ˜¯æ•°æ®åº“è®¿é—®æŠ€æœ¯ï¼Œå› æ­¤è¿˜éœ€è¦ä¸€ä¸ªæ•°æ®åº“ä¾›æˆ‘ä»¬å®è·µã€‚å°†æ ¹æ®å¦‚ä¸‹èƒŒæ™¯è®¾è®¡ä¸€ä¸ªæ•°æ®åº“ï¼Œæœ¬ç³»åˆ—åšå®¢å°†åŸºäºæ­¤æ•°æ®åº“è¿›è¡Œå®è·µï¼š

> æ–°å† è‚ºç‚çš„æµè¡Œæ‰“ç ´äº†äººä»¬åŸæœ‰çš„æ­£å¸¸ç”Ÿæ´»ã€‚ä¸ºäº†æ›´å¥½åœ°é¢„é˜²å’Œæ§åˆ¶ç–«æƒ…ï¼Œæˆ‘ä»¬å†³å®šå¼€å‘ä¸€ä¸ªç—…æ¯’æ£€æµ‹ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºè®°å½•å…¬æ°‘çš„æ ¸é…¸æ£€æµ‹æŠ¥å‘Šã€‚æ ¸é…¸æ£€æµ‹åœ¨åŒ»é™¢è¿›è¡Œï¼Œæ‰€æœ‰æ£€æµ‹æŠ¥å‘Šå°†ç”±ç—…æ¯’æ£€æµ‹ç®¡ç†ç³»ç»Ÿæ”¶é›†ç»Ÿè®¡ã€‚å½“å‰æœ‰å¤šå®¶åŒ»é™¢å¯ä»¥è¿›è¡Œæ ¸é…¸æ£€æµ‹ï¼Œæœªæ¥è¿™äº›åŒ»é™¢çš„æ•°é‡ä¹Ÿä¼šå¢åŠ ã€‚è€ƒè™‘åˆ°ç—…æ¯’çš„å˜å¼‚ä»¥åŠæœªæ¥çš„æ‰©å±•æ€§ï¼Œç—…æ¯’æ£€æµ‹ç®¡ç†ç³»ç»Ÿè¿˜éœ€è¦æ”¯æŒå­˜å‚¨ä¸åŒç—…æ¯’çš„æ£€æµ‹æŠ¥å‘Šã€‚æ ¸é…¸æ£€æµ‹çš„æµç¨‹ç”±æ”¶é›†æ‚£è€…çš„åŸºæœ¬ä¿¡æ¯å¼€å§‹ï¼Œç„¶åæ˜¯æ”¶é›†æ ·æœ¬çš„ç±»å‹ï¼Œæœ€åå‡ºå…·å¸¦æœ‰åŒ»ç”Ÿå§“åçš„æ ¸é…¸æ£€æµ‹æŠ¥å‘Šã€‚

ã€Šå¼ é«˜å…´çš„ Entity Framework Core å³å­¦å³ç”¨ã€‹ç³»åˆ—åšå®¢ä½¿ç”¨ .NET 6 å’Œ EF Core 6 è¿›è¡Œç¼–ç ï¼Œä¿è¯äº†æŠ€æœ¯çš„æ—¶æ•ˆæ€§ã€‚å’Œç»å¤§éƒ¨åˆ† EF Core çš„æ•™ç¨‹ä¸åŒï¼Œè¿™é‡Œå¹¶æ²¡æœ‰é€‰æ‹©ä½¿ç”¨ SQL Serverï¼Œè€Œæ˜¯ä½¿ç”¨ PostgreSQL æ•°æ®åº“ã€‚æ­¤å¤„å¹¶æ²¡æœ‰å¦è®¤ SQL Server æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æ•°æ®åº“ï¼Œå¹¶ä¸” EF çš„å¾ˆå¤šç‰¹æ€§åœ¨ SQL Server ä¸Šè¡¨ç°æ›´å¥½ï¼Œå¯ä»¥è¯´ SQL Server æ˜¯ EF Core çš„æœ€ä½³å®è·µã€‚ä½† SQL Server æœ€è‡´å‘½çš„é—®é¢˜æ˜¯é—­æºå¹¶ä¸”æ”¶è´¹ï¼Œç°åœ¨è™½ç„¶å¯ä»¥è·¨å¹³å°è¿è¡Œï¼Œä½†è¿™ä¸ªæ–¹å‘ä»æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚PostgreSQL å¼€æºä¸”å…è´¹ï¼Œç”šè‡³å¯ä»¥è¿è¡Œåœ¨ ARM çš„ Linux å¼€å‘æ¿ä¸Šï¼Œæ€§èƒ½ä¹Ÿè¦ä¼˜äº MySQLã€‚PostgreSQL æ‰©å±•æ€§é«˜ï¼Œæ‹¥æœ‰åºå¤§çš„æ’ä»¶ç¾¤ï¼Œå¹¶ä¸”è¿˜å…·æœ‰ä¸€äº›â€œé¢†å…ˆæ—¶ä»£â€çš„åŠŸèƒ½ï¼Œå¯ä»¥è¯´æ˜¯æ•°æ®åº“ç•Œçš„ C#ã€‚å½“ç„¶æœ¬ç³»åˆ—åšå®¢å¹¶æ²¡æœ‰æ¶‰åŠåˆ°æ•°æ®åº“çš„åŸç”Ÿæ“ä½œï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨ PostgreSQLï¼Œå¯ä»¥ç›´æ¥å°† NuGet åŒ…æ›¿æ¢æˆå¯¹åº”æ•°æ®åº“çš„å³å¯ï¼Œè¿™ä¹Ÿæ˜¯ EF Core çš„ä¼˜åŠ¿ã€‚

ã€Šå¼ é«˜å…´çš„ Entity Framework Core å³å­¦å³ç”¨ã€‹ç³»åˆ—åšå®¢å…±åˆ†ä¸º 4 ä¸ªéƒ¨åˆ†ï¼š

1.  ç¬¬ä¸€éƒ¨åˆ†å°†ä» 0 å¼€å§‹åˆ›å»ºä¸€ä¸ª EF Core åº”ç”¨ï¼Œä»‹ç»äº†ä½¿ç”¨ Database First çš„æ–¹å¼ä»¥åŠæ‰‹å·¥çš„æ–¹å¼ç”Ÿæˆå®ä½“ç±»ï¼Œå¹¶ä¸”å°è¯•æŸ¥è¯¢ä¸€å¼ è¡¨çš„æ•°æ®ï¼›
2.  ç¬¬äºŒéƒ¨åˆ†ä»‹ç»äº† EF Core çš„å®ä½“çŠ¶æ€ä»¥åŠå¢åˆ æ”¹æŸ¥ç­‰æ•°æ®åº“æ“ä½œï¼›
3.  ç¬¬ä¸‰éƒ¨åˆ†å®ç°äº†ä¸€ä¸ª EF Core çš„å¸®åŠ©ç±»ï¼Œä»¥ç®€åŒ–æ•°æ®åº“çš„æ“ä½œå’Œå¢å¼ºæ‰©å±•æ€§ï¼›
4.  ç¬¬å››éƒ¨åˆ†ä½¿ç”¨ Razor å¼•æ“å®ç°äº†ä¸€ä¸ªå®ä½“ç±»ç”Ÿæˆå·¥å…·ã€‚

æ¯ä¸€ç¯‡åšå®¢åœ¨ä»‹ç»åŠŸèƒ½ç‚¹æ—¶éƒ½é™„å¸¦æœ‰ç®€å•çš„ç¤ºä¾‹ï¼Œæ¯ä¸€ç« çš„æœ€åè¿˜é™„æœ‰è‹¥å¹²ä¸ªå°ç»ƒä¹ ï¼Œå¸Œæœ›è¯»è€…å¯ä»¥å€Ÿç€ç»ƒä¹ å¸®åŠ©ç†è§£ï¼Œä¹‹åæ ¹æ®é¡¹ç›®ä¸­é‡åˆ°çš„é—®é¢˜å†å­¦ä¹ å…¶ä»–çš„å†…å®¹ã€‚æ¬¢è¿æ‰¹è¯„ä¸æŒ‡æ­£ï¼Œæœ‰ä»»ä½•çš„é—®é¢˜éƒ½å¯ä»¥é€šè¿‡é‚®ä»¶æˆ–è€…è¯„è®ºçš„æ–¹å¼ä¸æˆ‘äº¤æµã€‚

å¼ é«˜å…´  
2022å¹´3æœˆ22æ—¥

* * *

æœ¬æ–‡å°†ä½¿ç”¨ .NET 6 åˆ›å»ºä¸€ä¸ªæ§åˆ¶å°ç¨‹åºï¼Œä» 0 å¼€å§‹ï¼Œå­¦ä¹  EF Core çš„ä½¿ç”¨ã€‚é€šè¿‡æœ¬æ–‡ä½ å¯ä»¥å­¦åˆ°ï¼š

1.  ä½¿ç”¨ Database First çš„æ–¹å¼ç”Ÿæˆå®ä½“ç±»ï¼›
2.  ç†Ÿæ‚‰å®ä½“ç±»ä¸­çš„ EF Core Attributeï¼›
3.  æŸ¥è¯¢ä¸€å¼ è¡¨çš„æ•°æ®ï¼›
4.  ä½¿ç”¨ `Docker` æ‹‰å–é•œåƒã€‚

ç›®å½•

*   [å†™åœ¨å‰é¢](#å†™åœ¨å‰é¢)
*   [å‡†å¤‡å·¥ä½œ](#å‡†å¤‡å·¥ä½œ)
    *   [å®‰è£… PostgreSQL](#å®‰è£…-postgresql)
        *   [ç›´æ¥å®‰è£…](#ç›´æ¥å®‰è£…)
        *   [ä½¿ç”¨ Docker æ‹‰å–é•œåƒ](#ä½¿ç”¨-docker-æ‹‰å–é•œåƒ)
    *   [æ•°æ®åº“çš„è¡¨ç»“æ„](#æ•°æ®åº“çš„è¡¨ç»“æ„)
*   [Code First ä¸ Database First](#code-first-ä¸-database-first)
*   [åˆ›å»ºä¸€ä¸ª EF Core åº”ç”¨](#åˆ›å»ºä¸€ä¸ª-ef-core-åº”ç”¨)
    *   [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
    *   [é¡¹ç›®ä¾èµ–](#é¡¹ç›®ä¾èµ–)
    *   [ä½¿ç”¨ Scaffold-DbContext å‘½ä»¤ç”Ÿæˆå®ä½“ç±»](#ä½¿ç”¨-scaffold-dbcontext-å‘½ä»¤ç”Ÿæˆå®ä½“ç±»)
    *   [æ‰‹åŠ¨åˆ›å»ºå®ä½“ç±»](#æ‰‹åŠ¨åˆ›å»ºå®ä½“ç±»)
        *   [å®ä½“å±æ€§](#å®ä½“å±æ€§)
            *   [è¡¨çš„æ˜ å°„](#è¡¨çš„æ˜ å°„)
            *   [åˆ—çš„æ˜ å°„](#åˆ—çš„æ˜ å°„)
            *   [ä¸»é”®çš„æ˜ å°„](#ä¸»é”®çš„æ˜ å°„)
        *   [å¯¼èˆªå±æ€§](#å¯¼èˆªå±æ€§)
    *   [åˆ›å»ºæ•°æ®åº“ä¸Šä¸‹æ–‡](#åˆ›å»ºæ•°æ®åº“ä¸Šä¸‹æ–‡)
    *   [ä»æ•°æ®åº“ä¸­æŸ¥è¯¢](#ä»æ•°æ®åº“ä¸­æŸ¥è¯¢)

å‡†å¤‡å·¥ä½œ
----

å‡†å¤‡å·¥ä½œåŒ…å«ä¸¤éƒ¨åˆ†ï¼šå®‰è£…æ•°æ®åº“ä¸åˆ›å»ºæ•°æ®åº“ã€‚EF Core å¯¹ PostgreSQL çš„ç‰ˆæœ¬æ²¡æœ‰è¦æ±‚ï¼Œä½†åç»­çš„åšå®¢åœ¨ä»‹ç»ç¼–å†™å®ä½“ç±»ç”Ÿæˆå·¥å…·æ—¶è¦æ±‚ 12 åŠä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚

### å®‰è£… PostgreSQL

#### ç›´æ¥å®‰è£…

PostgreSQL æ”¯æŒåœ¨ç»å¤§å¤šæ•°æ“ä½œç³»ç»Ÿä¸‹è¿è¡Œï¼Œä¸‹è½½åœ°å€ï¼š[https://www.postgresql.org/download](https://www.postgresql.org/download)

Windows ä¸‹è½½ exe å®‰è£…åŒ…ï¼Œå®‰è£…æ—¶ç›´æ¥ç‚¹å‡»â€œä¸‹ä¸€æ­¥â€å³å¯ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚å¦‚æœä½¿ç”¨ Debian ç³»åˆ—çš„ Linux å‘è¡Œç‰ˆæ—¶ï¼Œç›´æ¥ä½¿ç”¨ apt è¿›è¡Œå®‰è£…ï¼Œä¹Ÿæ— éœ€å…¶ä»–æ“ä½œã€‚å…¶ä»–çš„æ“ä½œç³»ç»Ÿå»ºè®®æ ¹æ®ä¸‹è½½åœ°å€ä¸­çš„å®‰è£…æŒ‡å—è¿›è¡Œæ“ä½œã€‚

#### ä½¿ç”¨ Docker æ‹‰å–é•œåƒ

1.  æ‹‰å– PostgreSQL é•œåƒï¼š

    docker pull postgres
    

2.  åˆ›å»ºå·ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®åº“æ•°æ®ï¼š

    docker volume create pgsql_data
    

3.  è¿è¡Œé•œåƒï¼Œç«¯å£æ˜ å°„ä¸º `54321`ï¼Œå¯†ç é…ç½®ä¸ºå¼±å¯†ç  `@Passw0rd`ï¼š

    docker run -d --name pgsql -p 54321:5432 --restart=always -e POSTGRES_PASSWORD='@Passw0rd' -e TZ='Asia/Shanghai' -e ALLOW_IP_RANGE=0.0.0.0/0 -v pgsql_data:/var/lib/postgresql postgres
    

### æ•°æ®åº“çš„è¡¨ç»“æ„

æ•°æ®åº“çš„è®¾è®¡å–å†³äºä¸šåŠ¡çš„éœ€æ±‚ï¼Œå¯¹åŒæ ·çš„ä¸šåŠ¡ï¼Œæ¯ä¸ªäººçš„è®¾è®¡éƒ½æœ‰å¯èƒ½ä¸åŒï¼Œæ•°æ®åº“çš„è®¾è®¡å¹¶æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œè¯»è€…ä»¬æˆ–è®¸æœ‰æ›´å¥½çš„è®¾è®¡æ–¹æ¡ˆï¼Œè¿™é‡Œç»™å‡ºçš„è¡¨ç»“æ„ä»…ä¾›å‚è€ƒï¼Œåªæ˜¯ä¸ºäº†æ»¡è¶³æ•™ç¨‹çš„éœ€è¦ï¼š

![](https://img2022.cnblogs.com/blog/1085877/202203/1085877-20220322171451622-257817532.jpg)

ğŸ›ˆÂ é‡è¦

è¡¨ç»“æ„è¿™é‡Œä¸è¿‡å¤šçš„è®²è§£ï¼Œè™½ç„¶ä½¿ç”¨ EF Core å¹¶ä¸éœ€è¦æŒæ¡å¤æ‚çš„æ•°æ®åº“çŸ¥è¯†ï¼Œä¹Ÿä¸éœ€è¦ä¼šå†™å¤æ‚çš„ SQLï¼Œä½†å¿…è¦çš„è¡¨ç»“æ„å…³ç³»è¿˜æ˜¯åº”è¯¥è¦ç†è§£ã€‚

ä¸‹é¢ä½¿ç”¨ç†Ÿæ‚‰çš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œå¦‚ pgAdminã€Navicat ç­‰ï¼Œåˆ›å»ºæ•°æ®åº“ `pandemic`ï¼Œå…·ä½“çš„æ‰§è¡Œ SQL å¦‚ä¸‹ï¼Œåˆ å‡äº†å­—æ®µæ³¨é‡Šç­‰ä¸å¿…è¦çš„è¯­å¥ï¼š

    create table doctor (
       id                   SERIAL not null,
       name                 VARCHAR(20)          not null,
       hospital_id          INT4                 not null,
       is_deleted           INT4                 not null default 0,
       creator_id           VARCHAR(50)          null,
       created_dt           TIMESTAMP            not null default 'now()',
       modifier_id          VARCHAR(50)          null,
       modified_dt          TIMESTAMP            not null default 'now()',
       constraint PK_DOCTOR primary key (id)
    );
    create table hospital (
       id                   SERIAL not null,
       name                 VARCHAR(20)          not null,
       is_deleted           INT4                 not null default 0,
       creator_id           VARCHAR(50)          null,
       created_dt           TIMESTAMP            not null default 'now()',
       modifier_id          VARCHAR(50)          null,
       modified_dt          TIMESTAMP            not null default 'now()',
       constraint PK_HOSPITAL primary key (id)
    );
    create table patient (
       id                   SERIAL not null,
       name                 VARCHAR(20)          not null,
       sex                  VARCHAR(10)          null,
       age                  INT2                 null,
       mobile               VARCHAR(15)          null,
       is_deleted           INT4                 not null default 0,
       creator_id           VARCHAR(50)          null,
       created_dt           TIMESTAMP            not null default 'now()',
       modifier_id          VARCHAR(50)          null,
       modified_dt          TIMESTAMP            not null default 'now()',
       constraint PK_PATIENT primary key (id)
    );
    create table report (
       id                   SERIAL not null,
       report_type_cd       VARCHAR(20)          not null,
       doctor_id            INT4                 not null,
       patient_id           INT4                 not null,
       result               BOOL                 not null default FALSE,
       collect_time         TIMESTAMP            null,
       test_time            TIMESTAMP            null,
       report_time          TIMESTAMP            null,
       description          VARCHAR(200)         null,
       is_deleted           INT4                 not null default 0,
       creator_id           VARCHAR(50)          null,
       created_dt           TIMESTAMP            not null default 'now()',
       modifier_id          VARCHAR(50)          null,
       modified_dt          TIMESTAMP            not null default 'now()',
       constraint PK_REPORT primary key (id)
    );
    create table report_type (
       cd                   VARCHAR(20)          not null,
       name                 VARCHAR(20)          null,
       description          VARCHAR(200)         null default 'covid',
       is_deleted           INT4                 not null default 0,
       creator_id           VARCHAR(50)          null,
       created_dt           TIMESTAMP            not null default 'now()',
       modifier_id          VARCHAR(50)          null,
       modified_dt          TIMESTAMP            not null default 'now()',
       constraint PK_REPORT_TYPE primary key (cd)
    );
    
    alter table doctor
       add constraint FK_DOCTOR_REFERENCE_HOSPITAL foreign key (hospital_id)
          references hospital (id)
          on delete restrict on update restrict;
    alter table report
       add constraint FK_REPORT_REFERENCE_DOCTOR foreign key (doctor_id)
          references doctor (id)
          on delete restrict on update restrict;
    alter table report
       add constraint FK_REPORT_REFERENCE_REPORT_T foreign key (report_type_cd)
          references report_type (cd)
          on delete restrict on update restrict;
    alter table report
       add constraint FK_REPORT_REFERENCE_PATIENT foreign key (patient_id)
          references patient (id)
          on delete restrict on update restrict;
    
    INSERT INTO report_type (cd, name) VALUES ('COVID-1', 'æ–°å† è‚ºç‚1å·');
    INSERT INTO report_type (cd, name) VALUES ('COVID-2', 'æ–°å† è‚ºç‚2å·');
    INSERT INTO report_type (cd, name) VALUES ('COVID-3', 'æ–°å† è‚ºç‚3å·');
    INSERT INTO report_type (cd, name) VALUES ('COVID-4', 'æ–°å† è‚ºç‚4å·');
    INSERT INTO report_type (cd, name) VALUES ('COVID-5', 'æ–°å† è‚ºç‚5å·');
    

Code First ä¸ Database First
---------------------------

Code First å’Œ Database First ç®—æ˜¯ EF ä¸­æ¯”è¾ƒæœ‰ç‰¹è‰²çš„åŠŸèƒ½ã€‚ç®€å•æ¥è¯´ Code First æ˜¯å…ˆç¼–å†™ C# å®ä½“ç±»ï¼ŒEF ä¼šæ ¹æ®å®ä½“ç±»ä¹‹é—´çš„å…³ç³»åˆ›å»ºæ•°æ®åº“ï¼›Database First æ˜¯å…ˆè®¾è®¡å’Œåˆ›å»ºæ•°æ®åº“ï¼ŒEF æ ¹æ®æ•°æ®åº“çš„è¡¨ç»“æ„ç”Ÿæˆ C# å®ä½“ç±»ã€‚å¯¹äºä¸ç†Ÿæ‚‰æ•°æ®åº“çš„å¼€å‘è€…æ¥è¯´ï¼ŒCode First ä¼¼ä¹éå¸¸æ–¹ä¾¿ï¼Œä¸éœ€è¦æŒæ¡æ•°æ®åº“çš„çŸ¥è¯†ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°æ®åº“è¿›è¡Œå¼€å‘ã€‚Code First æ˜¯è¢«åº”ç”¨äºé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain Driven Designï¼‰ä¸­çš„ï¼Œç”±äºä½œè€…å¹¶æ²¡æœ‰ DDD çš„å®è·µï¼Œå› æ­¤æ— æ³•è¯„åˆ¤ Code First çš„å®ç”¨æ€§ã€‚å®é™…ä¸Šæ•°æ®åº“è®¾è®¡æœ‰å¾ˆå¤šä¼˜ç§€çš„è½¯ä»¶ï¼Œå¦‚ PowerDesignerã€Navicat Data Modeler ç­‰ï¼Œå¹¶ä¸éœ€è¦æ‰‹åŠ¨çš„ç¼–å†™åˆ›å»ºæ•°æ®åº“çš„ SQLï¼Œå› æ­¤ Database First æ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„æ–¹å¼ã€‚è€Œ Code First ä¸­æ‰‹åŠ¨ç¼–å†™å®ä½“ç±»è¿™ä¸€æ­¥æ˜¯ä¸å¯é¿å…çš„ï¼Œåœ¨å¤§å‹é¡¹ç›®ä¸­æ•°åä¸Šç™¾çš„å®ä½“ç±»ï¼Œè¿™äº›å·¥ä½œé‡æ˜¯ä¸å®¹å°è§‘çš„ã€‚å› æ­¤æœ¬æ–‡ä¸ä¼šä»‹ç» Code First çš„æœ‰å…³æ“ä½œã€‚

åˆ›å»ºä¸€ä¸ª EF Core åº”ç”¨
---------------

é¡¹ç›®åœ°å€ï¼š[https://github.com/ZhangGaoxing/ef-core-demo](https://github.com/ZhangGaoxing/ef-core-demo)

### é¡¹ç›®ç»“æ„

åˆ›å»ºä¸€ä¸ªæ§åˆ¶å°åº”ç”¨å’Œç±»åº“ï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

![](https://img2022.cnblogs.com/blog/1085877/202203/1085877-20220322171505207-1358072576.jpg)

`Pandemic` ä¸ºæ§åˆ¶å°åº”ç”¨ï¼Œç”¨äºå®è·µ EF Core çš„æœ‰å…³æ“ä½œï¼›`Pandemic.Models` ä¸ºç±»åº“ï¼Œç”¨äºæä¾›æ•°æ®åº“ä¸Šä¸‹æ–‡å’Œå®ä½“ç±»ã€‚

### é¡¹ç›®ä¾èµ–

`Pandemic` éœ€è¦å¼•ç”¨é¡¹ç›® `Pandemic.Models`ï¼š

    <ItemGroup>
      <ProjectReference Include="..\Pandemic.Models\Pandemic.Models.csproj" />
    </ItemGroup>
    

`Pandemic.Models` æ·»åŠ å¦‚ä¸‹ NuGet åŒ…å¼•ç”¨ï¼š

    <ItemGroup>
      <PackageReference Include="Npgsql.EntityFrameworkCore.PostgreSQL" Version="6.0.3" />
    </ItemGroup>
    

### ä½¿ç”¨ Scaffold-DbContext å‘½ä»¤ç”Ÿæˆå®ä½“ç±»

æ¥ä¸‹æ¥ä½¿ç”¨ Database First çš„æ–¹å¼å»ç”Ÿæˆå®ä½“ç±»ã€‚`Scaffold-DbContext` é¡¾åæ€ä¹‰è¯‘ä¸ºâ€œæ•°æ®åº“ä¸Šä¸‹æ–‡è„šæ‰‹æ¶â€ï¼Œé€šè¿‡æ­¤å‘½ä»¤ç”Ÿæˆå®ä½“ç±»å’Œæ•°æ®åº“ä¸Šä¸‹æ–‡ã€‚ç”±äºæ–°ç‰ˆæœ¬çš„ .NET å·²ç»ä¸å†é›†æˆ EF Core Tools äº†ï¼Œå› æ­¤éœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ  NuGet åŒ… `Microsoft.EntityFrameworkCore.Tools`ã€‚ä¸‹é¢åˆ‡æ¢åˆ° `Pandemic.Models`ï¼Œå³æä¾›å®ä½“ç±»çš„é¡¹ç›®ä¸­å®‰è£… NuGet åŒ… `Microsoft.EntityFrameworkCore.Tools`ã€‚å®‰è£…å®Œæˆåï¼Œæ‰“å¼€ Visual Studio ä¸­çš„ **å·¥å…· - NuGet åŒ…ç®¡ç†å™¨ - ç¨‹åºåŒ…ç®¡ç†å™¨æ§åˆ¶å°** æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

1.  åˆ‡æ¢åˆ°é¡¹ç›® `Pandemic.Models`ï¼š
    
        PM> cd .\Pandemic.Models
        
    
2.  è¿è¡Œå®ä½“ç±»ç”Ÿæˆå‘½ä»¤ `Scaffold-DbContext`ï¼Œè¯¥å‘½ä»¤çš„è¯¦ç»†å‚æ•°è¯·å‚è€ƒ [https://docs.microsoft.com/zh-cn/ef/core/cli/powershell#scaffold-dbcontext](https://docs.microsoft.com/zh-cn/ef/core/cli/powershell#scaffold-dbcontext) ï¼š
    
        Scaffold-DbContext -Connection "Server=127.0.0.1;Port=54321;Database=pandemic;User Id=postgres;Password=@Passw0rd;" -Provider Npgsql.EntityFrameworkCore.PostgreSQL -Context PandemicContext
        
    
    ![](https://img2022.cnblogs.com/blog/1085877/202203/1085877-20220322171528887-441624788.jpg)

ğŸ’¡Â æç¤º

æ‰§è¡Œ Scaffold-DbContext å‘½ä»¤æŠ¥é”™æ—¶ï¼Œè¯·å°† Pandemic.Models è®¾ä¸ºå¯åŠ¨é¡¹ç›®ï¼Œå¹¶ä¸”å°†â€œç¨‹åºåŒ…ç®¡ç†å™¨æ§åˆ¶å°â€ä¸­çš„â€œé»˜è®¤é¡¹ç›®â€ä¹Ÿè®¾ç½®ä¸º Pandemic.Modelsã€‚

æ­£å¸¸è¿è¡Œæ²¡æœ‰æŠ¥é”™åï¼Œå®ä½“ç±»ä¸æ•°æ®åº“ä¸Šä¸‹æ–‡å°±ç”Ÿæˆå®Œæ¯•äº†ã€‚

![](https://img2022.cnblogs.com/blog/1085877/202203/1085877-20220322171538170-2872975.jpg)

ä¹‹åæ‰“å¼€æ•°æ®åº“ä¸Šä¸‹æ–‡ `PandemicContext.cs`ï¼Œä¼šå‘ç°å…¶ä¸­è¿˜æ˜¯æœ‰äº›è®¸çš„é—®é¢˜ï¼Œæ¯”å¦‚åˆ›å»ºæ—¶é—´å­—æ®µ `created_dt` çš„é»˜è®¤å€¼ä¸º PostgreSQL ä¸­çš„ `now()` å‡½æ•°ï¼Œä½† EF å¹¶æ²¡æœ‰å°†å…¶è¯†åˆ«å‡ºæ¥ï¼š

![](https://img2022.cnblogs.com/blog/1085877/202203/1085877-20220322171546527-1668052622.jpg)

è¿˜éœ€è¦æ‰‹åŠ¨çš„è¿›è¡Œä¸€äº›è°ƒæ•´ï¼š

![](https://img2022.cnblogs.com/blog/1085877/202203/1085877-20220322171554984-2129967146.jpg)

ç”±æ­¤å¯è§ Database First çš„æœ€ä½³å®è·µåº”è¯¥ä½¿ç”¨ SQL Serverï¼Œè¿™ç§é”™è¯¯åªèƒ½å¸Œæœ›å¾®è½¯åœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬å°½å¿«è§£å†³ã€‚

### æ‰‹åŠ¨åˆ›å»ºå®ä½“ç±»

ä¸‹é¢å°†æ‰‹åŠ¨ç¼–å†™ä¸¤ä¸ªå®ä½“ç±» `Hospital.cs` å’Œ `Doctor.cs`ï¼Œä»¥ç†Ÿæ‚‰ EF Core Attribute æ˜¯å¦‚ä½•å°†æ•°æ®åº“è¡¨å’Œå®ä½“ç±»ä¹‹é—´å»ºç«‹è”ç³»çš„ã€‚

#### å®ä½“å±æ€§

æ¯ä¸€ä¸ªå®ä½“ç±»éƒ½æœ‰ä¸€ç»„å±æ€§ï¼ŒEF Core ä¼šå°†å®ä½“å±æ€§æ˜ å°„åˆ°æ•°æ®åº“è¡¨ä¸­çš„åˆ—ã€‚

##### è¡¨çš„æ˜ å°„

å¯¹æ•°æ®åº“è¡¨è¿›è¡Œæ˜ å°„ï¼Œä½¿ç”¨ `Table()` Attributeã€‚

    [Table("hospital")]
    public class Hospital { }
    

##### åˆ—çš„æ˜ å°„

å¯¹æ•°æ®åº“è¡¨ä¸­çš„åˆ—è¿›è¡Œæ˜ å°„ï¼Œä½¿ç”¨ `Column()` Attributeã€‚

    [Table("hospital")]
    public class Hospital
    {
        [Column("id")]
        public int Id { get; set; }
    }
    

##### ä¸»é”®çš„æ˜ å°„

å¯¹æ•°æ®åº“è¡¨ä¸­çš„ä¸»é”®è¿›è¡Œæ˜ å°„ï¼Œä½¿ç”¨ `Key()` Attributeã€‚å½“ä¸»é”®æ˜¯è‡ªå¢é”®æ—¶ï¼Œè¿˜éœ€è¦è®¾ç½® `DatabaseGenerated()` Attributeã€‚

    [Table("hospital")]
    public class Hospital
    {
        [Key]
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        [Column("id")]
        public int Id { get; set; }
    }
    

ä½¿ç”¨ä¸Šæ–‡ä»‹ç»çš„ Attribute å®Œæ•´çš„æ˜ å°„åŒ»é™¢ç±» `Hospital.cs` ä»¥åŠåŒ»ç”Ÿç±» `Doctor.cs`ï¼š

    [Table("hospital")]
    public class Hospital
    {
        [Key]
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        [Column("id")]
        public int Id { get; set; }
    
        [Column("name")]
        public string Name { get; set; }
    
        [Column("is_deleted")]
        public int IsDeleted { get; set; } = 0;
    
        [Column("creator_id")]
        public string CreatorId { get; set; }
    
        [Column("created_dt")]
        public DateTime CreatedDt { get; set; } = DateTime.Now;
    
        [Column("modifier_id")]
        public string ModifierId { get; set; }
    
        [Column("modified_dt")]
        public DateTime ModifiedDt { get; set; } = DateTime.Now;
    }
    

    [Table("doctor")]
    public class Doctor
    {
        [Key]
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        [Column("id")]
        public int Id { get; set; }
    
        [Column("name")]
        public string Name { get; set; }
    
        [Column("hospital_id")]
        public int HospitalId { get; set; }
    
        [Column("is_deleted")]
        public int IsDeleted { get; set; } = 0;
    
        [Column("creator_id")]
        public string CreatorId { get; set; }
    
        [Column("created_dt")]
        public DateTime CreatedDt { get; set; } = DateTime.Now;
    
        [Column("modifier_id")]
        public string ModifierId { get; set; }
    
        [Column("modified_dt")]
        public DateTime ModifiedDt { get; set; } = DateTime.Now;
    }
    

#### å¯¼èˆªå±æ€§

å¯¼èˆªï¼ˆNavigationï¼‰å±æ€§æ˜¯æ•°æ®åº“è¡¨ä¹‹é—´çš„å…³ç³»åœ¨å®ä½“ç±»ä¸­çš„ä½“ç°ã€‚è®¾ç½®å¥½å®ä½“ç±»ä¹‹é—´çš„å¯¼èˆªå±æ€§åï¼Œå¯ä»¥é€šè¿‡å¯¼èˆªå±æ€§è½»æ¾çš„æŸ¥è¯¢åˆ°å…³è”å®ä½“çš„æ•°æ®ã€‚åœ¨è®¾ç½®å¯¼èˆªå±æ€§ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦ç†æ¸…æ¥šåŒ»é™¢å’ŒåŒ»ç”Ÿå­˜åœ¨ç€æ€æ ·çš„æ•°é‡å…³ç³»ï¼ŒåŒ»ç”Ÿæ˜¯åŒ»é™¢çš„é™„å±ï¼Œä¸€å®¶åŒ»é™¢ä¸‹é¢ä¼šæœ‰å¤šååŒ»ç”Ÿï¼Œå› æ­¤åŒ»é™¢å’ŒåŒ»ç”Ÿä¹‹é—´æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä¸‹é¢åªä¿ç•™ä¸»é”®ã€å¤–é”®å’Œå¯¼èˆªå±æ€§ã€‚

    [Table("doctor")]
    public class Doctor
    {
        [Key]
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        [Column("id")]
        public int Id { get; set; }
    
        [Column("hospital_id")]
        public int HospitalId { get; set; }
    
        [ForeignKey("HospitalId")]
        public virtual Hospital Hospital { get; set; }
    }
    

    [Table("hospital")]
    public class Hospital
    {
        [Key]
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        [Column("id")]
        public int Id { get; set; }
    
        public virtual List<Doctor> Doctors { get; set; }
    }
    

æ•°æ®åº“è¡¨ä¹‹é—´é€šè¿‡å¤–é”®å»ºç«‹æ•°é‡å…³ç³»ï¼Œå› æ­¤é…ç½®å¯¼èˆªå±æ€§ä½¿ç”¨ `ForeignKey()` Attributeã€‚

ğŸ’¡Â æç¤º

å¯¼èˆªå±æ€§ä¸­çš„ virtual å…³é”®å­—ä¸æ˜¯å¿…é¡»çš„ï¼Œå½“ä½¿ç”¨æ‡’åŠ è½½ï¼ˆlazy loadingï¼‰æ—¶æ‰æœ‰æ„ä¹‰ã€‚åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸å»ºè®®ä½¿ç”¨æ‡’åŠ è½½ï¼Œè¿™ä¼šæ‹–æ…¢æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦ã€‚

### åˆ›å»ºæ•°æ®åº“ä¸Šä¸‹æ–‡

æ•°æ®åº“ä¸Šä¸‹æ–‡ï¼ˆDbContextï¼‰æ˜¯ EF ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚DbContext çš„å®ä¾‹è¡¨ç¤ºç¨‹åºä¸æ•°æ®åº“çš„ä¸€ä¸ªä¼šè¯ï¼ˆsessionï¼‰ï¼Œé€šè¿‡ DbContext å®ä¾‹å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹å’ŒæŸ¥è¯¢ã€‚

ä¸ºäº†åœ¨ç¨‹åºä¸­è®¿é—®æ•°æ®åº“ `pandemic`ï¼Œä½¿æ•°æ®åº“è¡¨ä¸åˆ›å»ºçš„ C# å®ä½“ç±»å»ºç«‹æ˜ å°„ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ä¸Šä¸‹æ–‡ç±» `PandemicContext.cs`ï¼Œè¯¥ç±»æ´¾ç”Ÿè‡ª `Microsoft.EntityFrameworkCore.DbContext`ã€‚

    public class PandemicContext : DbContext
    {
        public PandemicContext() { }
    
        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder) { }
    
        protected override void OnModelCreating(ModelBuilder modelBuilder) { }
    }
    

`OnConfiguring()` æ–¹æ³•ç”¨äºé…ç½®æ•°æ®åº“çš„ä¸€äº›è®¾ç½®ï¼Œæ¯”å¦‚è¿æ¥å­—ç¬¦ä¸²ã€æ—¥å¿—ç­‰ï¼š

    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
    {
        optionsBuilder.UseNpgsql("Server=127.0.0.1;Port=54321;Database=pandemic;User Id=postgres;Password=@Passw0rd;");
    }
    

âš ï¸Â è­¦å‘Š

ä¸å»ºè®®å°†å¯†ç ä»¥æ˜æ–‡çš„æ–¹å¼æš´éœ²åœ¨ç¨‹åºä¸­ï¼Œåœ¨ .NET ä¸­å­—ç¬¦ä¸²å¹¶ä¸æ˜¯åŠ å¯†çš„ï¼Œå¯†ç å¯èƒ½ä¼šçŸ­æš‚çš„å‡ºç°åœ¨å†…å­˜ä¸­ï¼Œæˆ–æ˜¯å¯¹ç¨‹åºçš„åç¼–è¯‘éƒ½å¯èƒ½ä¼šé€ æˆå¯†ç çš„æ³„éœ²ã€‚æœ€ä¼˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸ä½¿ç”¨å¯†ç è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæˆ–æ˜¯é€šè¿‡è¯»å–å¤–éƒ¨é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·ä¹Ÿä¾¿äºç¨‹åºçš„ç»´æŠ¤ã€‚

`OnModelCreating()` æ–¹æ³•ç”¨äºé…ç½®æ•°æ®åº“è¡¨ä¸å®ä½“ç±»ä¹‹é—´çš„æ˜ å°„ã€‚ç”±äºæ•°æ®åº“è¡¨ä¸­é…ç½®äº†è½¯åˆ é™¤æ ‡è®° `is_deleted`ï¼Œå½“ `is_deleted = 1` æ—¶è®¤ä¸ºè¯¥æ¡æ•°æ®æ˜¯åˆ é™¤çš„ï¼Œå› æ­¤è¿˜éœ€è¦å¯¹è·å–çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œä½¿ç”¨ `HasQueryFilter()` æ–¹æ³•ï¼š

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Hospital>()
            .HasQueryFilter(x => x.IsDeleted == 0);
        modelBuilder.Entity<Doctor>()
            .HasQueryFilter(x => x.IsDeleted == 0);
        modelBuilder.Entity<Report>()
            .HasQueryFilter(x => x.IsDeleted == 0);
        modelBuilder.Entity<ReportType>()
            .HasQueryFilter(x => x.IsDeleted == 0);
        modelBuilder.Entity<Patient>()
            .HasQueryFilter(x => x.IsDeleted == 0);
    }
    

æ•°æ®åº“ä¸Šä¸‹æ–‡ä¸­é€šå¸¸è¿˜åŒ…æ‹¬æ¯ä¸ªå®ä½“ç±»çš„ `DbSet<TEntity>` å±æ€§ã€‚`DbSet<TEntity>` æ˜¯ç”¨äºä¿®æ”¹å’ŒæŸ¥è¯¢å®ä½“çš„æ•°æ®ï¼Œå¯¹ `DbSet<TEntity>` çš„ LINQ æŸ¥è¯¢ä¼šè½¬æ¢ä¸ºå¯¹åº”æ•°æ®åº“è¡¨çš„æŸ¥è¯¢ã€‚æœ€ç»ˆçš„æ•°æ®åº“ä¸Šä¸‹æ–‡ç±» `PandemicContext.cs` å¦‚ä¸‹æ‰€ç¤ºï¼š

    public class PandemicContext : DbContext
    {
        public DbSet<Hospital> Hospitals { get; set; }
        public DbSet<Doctor> Doctors { get; set; }
        public DbSet<Report> Reports { get; set; }
        public DbSet<ReportType> ReportTypes { get; set; }
        public DbSet<Patient> Patients { get; set; }
    
        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        {
            optionsBuilder.UseNpgsql("Server=127.0.0.1;Port=54321;Database=pandemic;User Id=postgres;Password=@Passw0rd;");
        }
    
        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            modelBuilder.Entity<Hospital>()
                .HasQueryFilter(x => x.IsDeleted == 0);
            modelBuilder.Entity<Doctor>()
                .HasQueryFilter(x => x.IsDeleted == 0);
            modelBuilder.Entity<Report>()
                .HasQueryFilter(x => x.IsDeleted == 0);
            modelBuilder.Entity<ReportType>()
                .HasQueryFilter(x => x.IsDeleted == 0);
            modelBuilder.Entity<Patient>()
                .HasQueryFilter(x => x.IsDeleted == 0);
        }
    }
    

ğŸ’¡Â æç¤º

DbSet<TEntity> å±æ€§å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œåªæ˜¯ä¸ºäº†ç®€åŒ–æ“ä½œï¼Œåœ¨å®ä¾‹åŒ–æ•°æ®åº“ä¸Šä¸‹æ–‡åï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨ Set<TEntity>() æ–¹æ³•è·å–å®ä½“ç±»çš„ DbSetã€‚

### ä»æ•°æ®åº“ä¸­æŸ¥è¯¢

å°†å®ä½“ç±»é…ç½®å®Œå…³ç³»ä»¥åŠåˆ›å»ºæ•°æ®åº“ä¸Šä¸‹æ–‡åï¼Œå°±å¯ä»¥é€šè¿‡å®ä¾‹åŒ–æ•°æ®åº“ä¸Šä¸‹æ–‡å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚ä¸‹é¢åˆ‡æ¢åˆ° `Pandemic` æ§åˆ¶å°åº”ç”¨æŸ¥è¯¢ `report_type` è¿™å¼ è¡¨ä¸­çš„æ•°æ®ï¼š

    using Pandemic.Models;
    PandemicContext context = new PandemicContext();
    var types = context.ReportTypes.ToList();
    

![](https://img2022.cnblogs.com/blog/1085877/202203/1085877-20220322171616699-247047685.jpg)

âœï¸Â ç»ƒä¹ 

1\. è¯•ç€ç¼–å†™å‰©ä¸‹çš„å®ä½“ç±»ï¼›

2\. æ¯”è¾ƒä¸€ä¸‹ Database First ç”Ÿæˆçš„å®ä½“ç±»å’Œæ•°æ®åº“ä¸Šä¸‹æ–‡ï¼Œä¸æ‰‹å·¥ç¼–å†™çš„æœ‰ä½•ä¸åŒï¼›

3\. ä¸ä½¿ç”¨ DbSet<TEntity> å±æ€§æŸ¥è¯¢ report\_type è¡¨çš„æ•°æ®ã€‚